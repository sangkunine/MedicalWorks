(()=>{var __webpack_modules__={2474:e=>{var t={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},n=function(){"use strict";var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,r=799,i=3406,a=2276,o=1567,s=3784,l=5793,c=2896;function u(){}function h(e,t){for(var n,r,i=0,a=[],o=16;o>0&&!e[o-1];)o--;a.push({children:[],index:0});var s,l=a[0];for(n=0;n<o;n++){for(r=0;r<e[n];r++){for((l=a.pop()).children[l.index]=t[i];l.index>0;)l=a.pop();for(l.index++,a.push(l);a.length<=n;)a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s;i++}n+1<o&&(a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s)}return a[0].children}function d(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function f(t,n,r,i,a,o,s,l,c){r.precision,r.samplesPerLine,r.scanLines;var u=r.mcusPerLine,h=r.progressive,f=(r.maxH,r.maxV,n),p=0,m=0;function g(){if(m>0)return m--,p>>m&1;if(255==(p=t[n++])){var e=t[n++];if(e)throw"unexpected marker: "+(p<<8|e).toString(16)}return m=7,p>>>7}function v(e){for(var t,n=e;null!==(t=g());){if("number"==typeof(n=n[t]))return n;if("object"!=typeof n)throw"invalid huffman sequence"}return null}function y(e){for(var t=0;e>0;){var n=g();if(null===n)return;t=t<<1|n,e--}return t}function _(e){var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var b=0;var E,w=0;function x(e,t,n,r,i){var a=n%u;t(e,d(e,(n/u|0)*e.v+r,a*e.h+i))}function T(e,t,n){t(e,d(e,n/e.blocksPerLine|0,n%e.blocksPerLine))}var A,M,S,R,k,P,L=i.length;P=h?0===o?0===l?function(e,t){var n=v(e.huffmanTableDC),r=0===n?0:_(n)<<c;e.blockData[t]=e.pred+=r}:function(e,t){e.blockData[t]|=g()<<c}:0===l?function(t,n){if(b>0)b--;else for(var r=o,i=s;r<=i;){var a=v(t.huffmanTableAC),l=15&a,u=a>>4;if(0!==l){var h=e[r+=u];t.blockData[n+h]=_(l)*(1<<c),r++}else{if(u<15){b=y(u)+(1<<u)-1;break}r+=16}}}:function(t,n){for(var r=o,i=s,a=0;r<=i;){var l=e[r];switch(w){case 0:var u=v(t.huffmanTableAC),h=15&u;if(a=u>>4,0===h)a<15?(b=y(a)+(1<<a),w=4):(a=16,w=1);else{if(1!==h)throw"invalid ACn encoding";E=_(h),w=a?2:3}continue;case 1:case 2:t.blockData[n+l]?t.blockData[n+l]+=g()<<c:0==--a&&(w=2==w?3:0);break;case 3:t.blockData[n+l]?t.blockData[n+l]+=g()<<c:(t.blockData[n+l]=E<<c,w=0);break;case 4:t.blockData[n+l]&&(t.blockData[n+l]+=g()<<c)}r++}4===w&&0==--b&&(w=0)}:function(t,n){var r=v(t.huffmanTableDC),i=0===r?0:_(r);t.blockData[n]=t.pred+=i;for(var a=1;a<64;){var o=v(t.huffmanTableAC),s=15&o,l=o>>4;if(0!==s){var c=e[a+=l];t.blockData[n+c]=_(s),a++}else{if(l<15)break;a+=16}}};var C,I,N,F,O=0;for(I=1==L?i[0].blocksPerLine*i[0].blocksPerColumn:u*r.mcusPerColumn,a||(a=I);O<I;){for(M=0;M<L;M++)i[M].pred=0;if(b=0,1==L)for(A=i[0],k=0;k<a;k++)T(A,P,O),O++;else for(k=0;k<a;k++){for(M=0;M<L;M++)for(N=(A=i[M]).h,F=A.v,S=0;S<F;S++)for(R=0;R<N;R++)x(A,P,O,S,R);O++}if(m=0,(C=t[n]<<8|t[n+1])<=65280)throw"marker was not found";if(!(C>=65488&&C<=65495))break;n+=2}return n-f}function p(e,t,u){var h,d,f,p,m,g,v,y,_,b,E=e.quantizationTable;for(b=0;b<64;b++)u[b]=e.blockData[t+b]*E[b];for(b=0;b<8;++b){var w=8*b;0!==u[1+w]||0!==u[2+w]||0!==u[3+w]||0!==u[4+w]||0!==u[5+w]||0!==u[6+w]||0!==u[7+w]?(h=l*u[0+w]+128>>8,d=l*u[4+w]+128>>8,f=u[2+w],p=u[6+w],m=c*(u[1+w]-u[7+w])+128>>8,y=c*(u[1+w]+u[7+w])+128>>8,g=u[3+w]<<4,v=u[5+w]<<4,_=h-d+1>>1,h=h+d+1>>1,d=_,_=f*s+p*o+128>>8,f=f*o-p*s+128>>8,p=_,_=m-v+1>>1,m=m+v+1>>1,v=_,_=y+g+1>>1,g=y-g+1>>1,y=_,_=h-p+1>>1,h=h+p+1>>1,p=_,_=d-f+1>>1,d=d+f+1>>1,f=_,_=m*a+y*i+2048>>12,m=m*i-y*a+2048>>12,y=_,_=g*r+v*n+2048>>12,g=g*n-v*r+2048>>12,v=_,u[0+w]=h+y,u[7+w]=h-y,u[1+w]=d+v,u[6+w]=d-v,u[2+w]=f+g,u[5+w]=f-g,u[3+w]=p+m,u[4+w]=p-m):(_=l*u[0+w]+512>>10,u[0+w]=_,u[1+w]=_,u[2+w]=_,u[3+w]=_,u[4+w]=_,u[5+w]=_,u[6+w]=_,u[7+w]=_)}for(b=0;b<8;++b){var x=b;0!==u[8+x]||0!==u[16+x]||0!==u[24+x]||0!==u[32+x]||0!==u[40+x]||0!==u[48+x]||0!==u[56+x]?(h=l*u[0+x]+2048>>12,d=l*u[32+x]+2048>>12,f=u[16+x],p=u[48+x],m=c*(u[8+x]-u[56+x])+2048>>12,y=c*(u[8+x]+u[56+x])+2048>>12,g=u[24+x],v=u[40+x],_=h-d+1>>1,h=h+d+1>>1,d=_,_=f*s+p*o+2048>>12,f=f*o-p*s+2048>>12,p=_,_=m-v+1>>1,m=m+v+1>>1,v=_,_=y+g+1>>1,g=y-g+1>>1,y=_,_=h-p+1>>1,h=h+p+1>>1,p=_,_=d-f+1>>1,d=d+f+1>>1,f=_,_=m*a+y*i+2048>>12,m=m*i-y*a+2048>>12,y=_,_=g*r+v*n+2048>>12,g=g*n-v*r+2048>>12,v=_,u[0+x]=h+y,u[56+x]=h-y,u[8+x]=d+v,u[48+x]=d-v,u[16+x]=f+g,u[40+x]=f-g,u[24+x]=p+m,u[32+x]=p-m):(_=l*u[b+0]+8192>>14,u[0+x]=_,u[8+x]=_,u[16+x]=_,u[24+x]=_,u[32+x]=_,u[40+x]=_,u[48+x]=_,u[56+x]=_)}for(b=0;b<64;++b){var T=t+b,A=u[b];A=A<=-2056/e.bitConversion?0:A>=2024/e.bitConversion?255/e.bitConversion:A+2056/e.bitConversion>>4,e.blockData[T]=A}}function m(e,t){for(var n=t.blocksPerLine,r=t.blocksPerColumn,i=new Int32Array(64),a=0;a<r;a++)for(var o=0;o<n;o++){p(t,d(t,a,o),i)}return t.blockData}function g(e){return e<=0?0:e>=255?255:0|e}return u.prototype={load:function(e){var t=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(e.indexOf("data:")>-1){for(var n=e.indexOf("base64,")+7,r=atob(e.substring(n)),i=new Uint8Array(r.length),a=r.length-1;a>=0;a--)i[a]=r.charCodeAt(a);t(r)}else{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){var e=new Uint8Array(o.response);t(e)}.bind(this),o.send(null)}},parse:function(n){function r(){var e=n[l]<<8|n[l+1];return l+=2,e}function i(){var e=r(),t=n.subarray(l,l+e-2);return l+=t.length,t}function a(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),r=0;r<e.components.length;r++){W=e.components[r];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*W.h/e.maxH),a=Math.ceil(Math.ceil(e.scanLines/8)*W.v/e.maxV),o=t*W.h,s=64*(n*W.v)*(o+1);W.blockData=new Int16Array(s),W.blocksPerLine=i,W.blocksPerColumn=a}e.mcusPerLine=t,e.mcusPerColumn=n}var o,s,l=0,c=(n.length,null),u=null,d=[],p=[],g=[],v=r();if(65496!=v)throw"SOI not found";for(v=r();65497!=v;){var y,_;switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var b=i();65504===v&&74===b[0]&&70===b[1]&&73===b[2]&&70===b[3]&&0===b[4]&&(c={version:{major:b[5],minor:b[6]},densityUnits:b[7],xDensity:b[8]<<8|b[9],yDensity:b[10]<<8|b[11],thumbWidth:b[12],thumbHeight:b[13],thumbData:b.subarray(14,14+3*b[12]*b[13])}),65518===v&&65===b[0]&&100===b[1]&&111===b[2]&&98===b[3]&&101===b[4]&&0===b[5]&&(u={version:b[6],flags0:b[7]<<8|b[8],flags1:b[9]<<8|b[10],transformCode:b[11]});break;case 65499:for(var E=r()+l-2;l<E;){var w=n[l++],x=new Int32Array(64);if(w>>4==0)for(y=0;y<64;y++){x[e[y]]=n[l++]}else{if(w>>4!=1)throw"DQT: invalid table spec";for(y=0;y<64;y++){x[e[y]]=r()}}d[15&w]=x}break;case 65472:case 65473:case 65474:if(o)throw"Only single frame JPEGs supported";r(),(o={}).extended=65473===v,o.progressive=65474===v,o.precision=n[l++],o.scanLines=r(),o.samplesPerLine=r(),o.components=[],o.componentIds={};var T,A=n[l++],M=0,S=0;for(G=0;G<A;G++){T=n[l];var R=n[l+1]>>4,k=15&n[l+1];M<R&&(M=R),S<k&&(S=k);var P=n[l+2];_=o.components.push({h:R,v:k,quantizationTable:d[P],quantizationTableId:P,bitConversion:255/((1<<o.precision)-1)}),o.componentIds[T]=_-1,l+=3}o.maxH=M,o.maxV=S,a(o);break;case 65476:var L=r();for(G=2;G<L;){var C=n[l++],I=new Uint8Array(16),N=0;for(y=0;y<16;y++,l++)N+=I[y]=n[l];var F=new Uint8Array(N);for(y=0;y<N;y++,l++)F[y]=n[l];G+=17+N,(C>>4==0?g:p)[15&C]=h(I,F)}break;case 65501:r(),s=r();break;case 65498:r();var O=n[l++],H=[];for(G=0;G<O;G++){var D=o.componentIds[n[l++]];W=o.components[D];var U=n[l++];W.huffmanTableDC=g[U>>4],W.huffmanTableAC=p[15&U],H.push(W)}var B=n[l++],z=n[l++],V=n[l++],j=f(n,l,o,H,s,B,z,V>>4,15&V);l+=j;break;default:if(255==n[l-3]&&n[l-2]>=192&&n[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+v.toString(16)}v=r()}switch(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=c,this.adobe=u,this.components=[],o.components.length){case 1:this.colorspace=t.Grayscale;break;case 3:this.adobe?this.colorspace=t.AdobeRGB:this.colorspace=t.RGB;break;case 4:this.colorspace=t.CYMK;break;default:this.colorspace=t.Unknown}for(var G=0;G<o.components.length;G++){var W;(W=o.components[G]).quantizationTable||null===W.quantizationTableId||(W.quantizationTable=d[W.quantizationTableId]),this.components.push({output:m(0,W),scaleX:W.h/o.maxH,scaleY:W.v/o.maxV,blocksPerLine:W.blocksPerLine,blocksPerColumn:W.blocksPerColumn,bitConversion:W.bitConversion})}},getData16:function(e,t){if(1!==this.components.length)throw"Unsupported color mode";var n,r,i,a,o,s,l=this.width/e,c=this.height/t,u=0,h=this.components.length,f=new Uint16Array(e*t*h),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(s=0;s<h;s++){for(var m,g,v,y=(n=this.components[s]).blocksPerLine,_=n.blocksPerColumn,b=y<<3,E=0,w=0;w<_;w++)for(var x=w<<3,T=0;T<y;T++){var A=d(n,w,T),M=(u=0,T<<3);for(m=0;m<8;m++){E=(x+m)*b;for(g=0;g<8;g++)p[E+M+g]=n.output[A+u++]}}for(r=n.scaleX*l,i=n.scaleY*c,u=s,o=0;o<t;o++)for(a=0;a<e;a++)v=(0|o*i)*b+(0|a*r),f[u]=p[v],u+=h}return f},getData:function(e,t){var n,r,i,a,o,s,l,c,u,h,f,p,m,v,y,_=this.width/e,b=this.height/t,E=0,w=this.components.length,x=e*t*w,T=new Uint8Array(x),A=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(s=0;s<w;s++){for(var M,S,R,k=(n=this.components[s]).blocksPerLine,P=n.blocksPerColumn,L=k<<3,C=0,I=0;I<P;I++)for(var N=I<<3,F=0;F<k;F++){var O=d(n,I,F),H=(E=0,F<<3);for(M=0;M<8;M++){C=(N+M)*L;for(S=0;S<8;S++)A[C+H+S]=n.output[O+E++]*n.bitConversion}}for(r=n.scaleX*_,i=n.scaleY*b,E=s,o=0;o<t;o++)for(a=0;a<e;a++)R=(0|o*i)*L+(0|a*r),T[E]=A[R],E+=w}switch(w){case 1:case 2:break;case 3:if(y=!0,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(s=0;s<x;s+=w)l=T[s],c=T[s+1],p=g(l-179.456+1.402*(u=T[s+2])),m=g(l+135.459-.344*c-.714*u),v=g(l-226.816+1.772*c),T[s]=p,T[s+1]=m,T[s+2]=v;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(y=!1,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(s=0;s<x;s+=w)l=T[s],c=T[s+1],h=g(434.456-l-1.402*(u=T[s+2])),f=g(119.541-l+.344*c+.714*u),l=g(481.816-l-1.772*c),T[s]=h,T[s+1]=f,T[s+2]=l;break;default:throw"Unsupported color mode"}return T}},u}();e.exports&&(e.exports=n)},3033:function(e){"use strict";var t=function(){var e={LL:0,LH:1,HL:1,HH:2};function t(){this.failOnCorruptedImage=!1}function r(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function o(e,t){for(var n,r=e.SIZ,i=[],a=Math.ceil((r.Xsiz-r.XTOsiz)/r.XTsiz),o=Math.ceil((r.Ysiz-r.YTOsiz)/r.YTsiz),s=0;s<o;s++)for(var l=0;l<a;l++)(n={}).tx0=Math.max(r.XTOsiz+l*r.XTsiz,r.XOsiz),n.ty0=Math.max(r.YTOsiz+s*r.YTsiz,r.YOsiz),n.tx1=Math.min(r.XTOsiz+(l+1)*r.XTsiz,r.Xsiz),n.ty1=Math.min(r.YTOsiz+(s+1)*r.YTsiz,r.Ysiz),n.width=n.tx1-n.tx0,n.height=n.ty1-n.ty0,n.components=[],i.push(n);e.tiles=i;for(var c=0,u=r.Csiz;c<u;c++)for(var h=t[c],d=0,f=i.length;d<f;d++){var p={};n=i[d],p.tcx0=Math.ceil(n.tx0/h.XRsiz),p.tcy0=Math.ceil(n.ty0/h.YRsiz),p.tcx1=Math.ceil(n.tx1/h.XRsiz),p.tcy1=Math.ceil(n.ty1/h.YRsiz),p.width=p.tcx1-p.tcx0,p.height=p.tcy1-p.tcy0,n.components[c]=p}}function s(e,t,n){var r=t.codingStyleParameters,i={};return r.entropyCoderWithCustomPrecincts?(i.PPx=r.precinctsSizes[n].PPx,i.PPy=r.precinctsSizes[n].PPy):(i.PPx=15,i.PPy=15),i.xcb_=n>0?Math.min(r.xcb,i.PPx-1):Math.min(r.xcb,i.PPx),i.ycb_=n>0?Math.min(r.ycb,i.PPy-1):Math.min(r.ycb,i.PPy),i}function l(e,t,n){var r=1<<n.PPx,i=1<<n.PPy,a=0===t.resLevel,o=1<<n.PPx+(a?0:-1),s=1<<n.PPy+(a?0:-1),l=t.trx1>t.trx0?Math.ceil(t.trx1/r)-Math.floor(t.trx0/r):0,c=t.try1>t.try0?Math.ceil(t.try1/i)-Math.floor(t.try0/i):0,u=l*c;t.precinctParameters={precinctWidth:r,precinctHeight:i,numprecinctswide:l,numprecinctshigh:c,numprecincts:u,precinctWidthInSubband:o,precinctHeightInSubband:s}}function c(e,t,n){var r,i,a,o,s=n.xcb_,l=n.ycb_,c=1<<s,u=1<<l,h=t.tbx0>>s,d=t.tby0>>l,f=t.tbx1+c-1>>s,p=t.tby1+u-1>>l,m=t.resolution.precinctParameters,g=[],v=[];for(i=d;i<p;i++)for(r=h;r<f;r++){if((a={cbx:r,cby:i,tbx0:c*r,tby0:u*i,tbx1:c*(r+1),tby1:u*(i+1)}).tbx0_=Math.max(t.tbx0,a.tbx0),a.tby0_=Math.max(t.tby0,a.tby0),a.tbx1_=Math.min(t.tbx1,a.tbx1),a.tby1_=Math.min(t.tby1,a.tby1),o=Math.floor((a.tbx0_-t.tbx0)/m.precinctWidthInSubband)+Math.floor((a.tby0_-t.tby0)/m.precinctHeightInSubband)*m.numprecinctswide,a.precinctNumber=o,a.subbandType=t.type,a.Lblock=3,!(a.tbx1_<=a.tbx0_||a.tby1_<=a.tby0_)){g.push(a);var y=v[o];void 0!==y?(r<y.cbxMin?y.cbxMin=r:r>y.cbxMax&&(y.cbxMax=r),i<y.cbyMin?y.cbxMin=i:i>y.cbyMax&&(y.cbyMax=i)):v[o]=y={cbxMin:r,cbyMin:i,cbxMax:r,cbyMax:i},a.precinct=y}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:l,numcodeblockwide:f-h+1,numcodeblockhigh:p-d+1},t.codeblocks=g,t.precincts=v}function u(e,t,n){for(var r=[],i=e.subbands,a=0,o=i.length;a<o;a++)for(var s=i[a].codeblocks,l=0,c=s.length;l<c;l++){var u=s[l];u.precinctNumber===t&&r.push(u)}return{layerNumber:n,codeblocks:r}}function h(e){for(var t=e.SIZ,n=e.currentTile.index,r=e.tiles[n],i=r.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;s<a;s++)o=Math.max(o,r.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,c=0,h=0,d=0;this.nextPacket=function(){for(;l<i;l++){for(;c<=o;c++){for(;h<a;h++){var e=r.components[h];if(!(c>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[c],n=t.precinctParameters.numprecincts;d<n;){var s=u(t,d,l);return d++,s}d=0}}h=0}c=0}}}function d(e){for(var t=e.SIZ,n=e.currentTile.index,r=e.tiles[n],i=r.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;s<a;s++)o=Math.max(o,r.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,c=0,h=0,d=0;this.nextPacket=function(){for(;l<=o;l++){for(;c<i;c++){for(;h<a;h++){var e=r.components[h];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts;d<n;){var s=u(t,d,c);return d++,s}d=0}}h=0}c=0}}}function g(e){var t,n,r,i,a=e.SIZ,o=e.currentTile.index,s=e.tiles[o],l=s.codingStyleDefaultParameters.layersCount,c=a.Csiz,h=0;for(r=0;r<c;r++){var d=s.components[r];h=Math.max(h,d.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(h+1);for(n=0;n<=h;++n){var p=0;for(r=0;r<c;++r){var m=s.components[r].resolutions;n<m.length&&(p=Math.max(p,m[n].precinctParameters.numprecincts))}f[n]=p}t=0,n=0,r=0,i=0,this.nextPacket=function(){for(;n<=h;n++){for(;i<f[n];i++){for(;r<c;r++){var e=s.components[r];if(!(n>e.codingStyleParameters.decompositionLevelsCount)){var a=e.resolutions[n],o=a.precinctParameters.numprecincts;if(!(i>=o)){for(;t<l;){var d=u(a,i,t);return t++,d}t=0}}}r=0}i=0}}}function v(e){var t=e.SIZ,n=e.currentTile.index,r=e.tiles[n],i=r.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(r),s=o,l=0,c=0,h=0,d=0,f=0;this.nextPacket=function(){for(;f<s.maxNumHigh;f++){for(;d<s.maxNumWide;d++){for(;h<a;h++){for(var e=r.components[h],t=e.codingStyleParameters.decompositionLevelsCount;c<=t;c++){var n=e.resolutions[c],p=o.components[h].resolutions[c],m=_(d,f,p,s,n);if(null!==m){for(;l<i;){var g=u(n,m,l);return l++,g}l=0}}c=0}h=0}d=0}}}function y(e){var t=e.SIZ,n=e.currentTile.index,r=e.tiles[n],i=r.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(r),s=0,l=0,c=0,h=0,d=0;this.nextPacket=function(){for(;c<a;++c){for(var e=r.components[c],t=o.components[c],n=e.codingStyleParameters.decompositionLevelsCount;d<t.maxNumHigh;d++){for(;h<t.maxNumWide;h++){for(;l<=n;l++){var f=e.resolutions[l],p=t.resolutions[l],m=_(h,d,p,t,f);if(null!==m){for(;s<i;){var g=u(f,m,s);return s++,g}s=0}}l=0}h=0}d=0}}}function _(e,t,n,r,i){var a=e*r.minWidth,o=t*r.minHeight;if(a%n.width!=0||o%n.height!=0)return null;var s=o/n.width*i.precinctParameters.numprecinctswide;return a/n.height+s}function b(e){for(var t=e.components.length,n=Number.MAX_VALUE,r=Number.MAX_VALUE,i=0,a=0,o=new Array(t),s=0;s<t;s++){for(var l=e.components[s],c=l.codingStyleParameters.decompositionLevelsCount,u=new Array(c+1),h=Number.MAX_VALUE,d=Number.MAX_VALUE,f=0,p=0,m=1,g=c;g>=0;--g){var v=l.resolutions[g],y=m*v.precinctParameters.precinctWidth,_=m*v.precinctParameters.precinctHeight;h=Math.min(h,y),d=Math.min(d,_),f=Math.max(f,v.precinctParameters.numprecinctswide),p=Math.max(p,v.precinctParameters.numprecinctshigh),u[g]={width:y,height:_},m<<=1}n=Math.min(n,h),r=Math.min(r,d),i=Math.max(i,f),a=Math.max(a,p),o[s]={resolutions:u,minWidth:h,minHeight:d,maxNumWide:f,maxNumHigh:p}}return{components:o,minWidth:n,minHeight:r,maxNumWide:i,maxNumHigh:a}}function E(e){for(var t=e.SIZ,n=e.currentTile.index,r=e.tiles[n],i=t.Csiz,a=0;a<i;a++){for(var o=r.components[a],u=o.codingStyleParameters.decompositionLevelsCount,f=[],p=[],m=0;m<=u;m++){var _,b=s(0,o,m),E={},w=1<<u-m;if(E.trx0=Math.ceil(o.tcx0/w),E.try0=Math.ceil(o.tcy0/w),E.trx1=Math.ceil(o.tcx1/w),E.try1=Math.ceil(o.tcy1/w),E.resLevel=m,l(0,E,b),f.push(E),0===m)(_={}).type="LL",_.tbx0=Math.ceil(o.tcx0/w),_.tby0=Math.ceil(o.tcy0/w),_.tbx1=Math.ceil(o.tcx1/w),_.tby1=Math.ceil(o.tcy1/w),_.resolution=E,c(0,_,b),p.push(_),E.subbands=[_];else{var x=1<<u-m+1,T=[];(_={}).type="HL",_.tbx0=Math.ceil(o.tcx0/x-.5),_.tby0=Math.ceil(o.tcy0/x),_.tbx1=Math.ceil(o.tcx1/x-.5),_.tby1=Math.ceil(o.tcy1/x),_.resolution=E,c(0,_,b),p.push(_),T.push(_),(_={}).type="LH",_.tbx0=Math.ceil(o.tcx0/x),_.tby0=Math.ceil(o.tcy0/x-.5),_.tbx1=Math.ceil(o.tcx1/x),_.tby1=Math.ceil(o.tcy1/x-.5),_.resolution=E,c(0,_,b),p.push(_),T.push(_),(_={}).type="HH",_.tbx0=Math.ceil(o.tcx0/x-.5),_.tby0=Math.ceil(o.tcy0/x-.5),_.tbx1=Math.ceil(o.tcx1/x-.5),_.tby1=Math.ceil(o.tcy1/x-.5),_.resolution=E,c(0,_,b),p.push(_),T.push(_),E.subbands=T}}o.resolutions=f,o.subbands=p}var A=r.codingStyleDefaultParameters.progressionOrder;switch(A){case 0:r.packetsIterator=new h(e);break;case 1:r.packetsIterator=new d(e);break;case 2:r.packetsIterator=new g(e);break;case 3:r.packetsIterator=new v(e);break;case 4:r.packetsIterator=new y(e);break;default:throw new Error("JPX Error: Unsupported progression order "+A)}}function w(e,t,n,r){var i,a=0,o=0,s=!1;function l(e){for(;o<e;){if(n+a>=t.length)throw new Error("Unexpected EOF");var r=t[n+a];a++,s?(i=i<<7|r,o+=7,s=!1):(i=i<<8|r,o+=8),255===r&&(s=!0)}return i>>>(o-=e)&(1<<e)-1}function c(e){return 255===t[n+a-1]&&t[n+a]===e?(u(1),!0):255===t[n+a]&&t[n+a+1]===e&&(u(2),!0)}function u(e){a+=e}function h(){o=0,s&&(a++,s=!1)}function d(){if(0===l(1))return 1;if(0===l(1))return 2;var e=l(2);return e<3?e+3:(e=l(5))<31?e+6:(e=l(7))+37}for(var p=e.currentTile.index,m=e.tiles[p],g=e.COD.sopMarkerUsed,v=e.COD.ephMarkerUsed,y=m.packetsIterator;a<r;)try{h(),g&&c(145)&&u(4);var _=y.nextPacket();if(void 0===_)return;if(!l(1))continue;for(var b,E=_.layerNumber,w=[],x=0,T=_.codeblocks.length;x<T;x++){var A=(b=_.codeblocks[x]).precinct,R=b.cbx-A.cbxMin,k=b.cby-A.cbyMin,P=!1,L=!1;if(void 0!==b.included)P=!!l(1);else{var C,I;if(void 0!==(A=b.precinct).inclusionTree)C=A.inclusionTree;else{var N=A.cbxMax-A.cbxMin+1,F=A.cbyMax-A.cbyMin+1;C=new S(N,F),I=new M(N,F),A.inclusionTree=C,A.zeroBitPlanesTree=I}for(C.reset(R,k,E);;){if(a>=t.length)return;if(C.isAboveThreshold())break;if(C.isKnown())C.nextLevel();else if(l(1)){if(C.setKnown(),C.isLeaf()){b.included=!0,P=L=!0;break}C.nextLevel()}else C.incrementValue()}}if(P){if(L){for((I=A.zeroBitPlanesTree).reset(R,k);;){if(a>=t.length)return;if(l(1)){if(!I.nextLevel())break}else I.incrementValue()}b.zeroBitPlanes=I.value}for(var O=d();l(1);)b.Lblock++;var H=f(O),D=l((O<1<<H?H-1:H)+b.Lblock);w.push({codeblock:b,codingpasses:O,dataLength:D})}}for(h(),v&&c(146);w.length>0;){var U=w.shift();void 0===(b=U.codeblock).data&&(b.data=[]),b.data.push({data:t,start:n+a,end:n+a+U.dataLength,codingpasses:U.codingpasses}),a+=U.dataLength}}catch(e){return}return a}function x(e,t,r,i,a,o,s,l){for(var c=i.tbx0,u=i.tby0,h=i.tbx1-i.tbx0,d=i.codeblocks,f="H"===i.type.charAt(0)?1:0,p="H"===i.type.charAt(1)?t:0,m=0,g=d.length;m<g;++m){var v=d[m],y=v.tbx1_-v.tbx0_,_=v.tby1_-v.tby0_;if(0!==y&&0!==_&&void 0!==v.data){var b,E;b=new R(y,_,v.subbandType,v.zeroBitPlanes,o),E=2;var w,x,T,A=v.data,M=0,S=0;for(w=0,x=A.length;w<x;w++)M+=(T=A[w]).end-T.start,S+=T.codingpasses;var k=new Int16Array(M),P=0;for(w=0,x=A.length;w<x;w++){var L=(T=A[w]).data.subarray(T.start,T.end);k.set(L,P),P+=L.length}var C=new n(k,0,M);for(b.setDecoder(C),w=0;w<S;w++){switch(E){case 0:b.runSignificancePropogationPass();break;case 1:b.runMagnitudeRefinementPass();break;case 2:b.runCleanupPass(),l&&b.checkSegmentationSymbol()}E=(E+1)%3}var I,N,F,O=v.tbx0_-c+(v.tby0_-u)*h,H=b.coefficentsSign,D=b.coefficentsMagnitude,U=b.bitsDecoded,B=s?0:.5;P=0;var z="LL"!==i.type;for(w=0;w<_;w++){var V=2*(O/h|0)*(t-h)+f+p;for(I=0;I<y;I++){if(0!==(N=D[P])){N=(N+B)*a,0!==H[P]&&(N=-N),F=U[P];var j=z?V+(O<<1):O;e[j]=s&&F>=o?N:N*(1<<o-F)}O++,P++}O+=h-y}}}}function T(t,n,r){for(var i=n.components[r],a=i.codingStyleParameters,o=i.quantizationParameters,s=a.decompositionLevelsCount,l=o.SPqcds,c=o.scalarExpounded,u=o.guardBits,h=a.segmentationSymbolUsed,d=t.components[r].precision,f=a.reversibleTransformation,p=f?new L:new P,m=[],g=0,v=0;v<=s;v++){for(var y=i.resolutions[v],_=y.trx1-y.trx0,b=y.try1-y.try0,E=new Float32Array(_*b),w=0,T=y.subbands.length;w<T;w++){var A,M;c?(A=l[g].mu,M=l[g].epsilon,g++):(A=l[0].mu,M=l[0].epsilon+(v>0?1-v:0));var S=y.subbands[w],R=e[S.type];x(E,_,0,S,f?1:Math.pow(2,d+R-M)*(1+A/2048),u+M-1,f,h)}m.push({width:_,height:b,items:E})}var k=p.calculate(m,i.tcx0,i.tcy0);return{left:i.tcx0,top:i.tcy0,width:k.width,height:k.height,items:k.items}}function A(e,t){for(var n=e.SIZ.Csiz,r=e.tiles[t],i=0;i<n;i++){var a=r.components[i],o=void 0!==e.currentTile.QCC[i]?e.currentTile.QCC[i]:e.currentTile.QCD;a.quantizationParameters=o;var s=void 0!==e.currentTile.COC[i]?e.currentTile.COC[i]:e.currentTile.COD;a.codingStyleParameters=s}r.codingStyleDefaultParameters=e.currentTile.COD}t.prototype={parse:function(e){if(65359!==p(e,0))for(var t=0,n=e.length;t<n;){var r=8,o=m(e,t),s=m(e,t+4);if(t+=r,1===o&&(o=4294967296*m(e,t)+m(e,t+4),t+=8,r+=8),0===o&&(o=n-t+r),o<r)throw new Error("JPX Error: Invalid box field size");var l=o-r,c=!0;switch(s){case 1785737832:c=!1;break;case 1668246642:var u=e[t];e[t+1],e[t+2];if(1===u){var h=m(e,t+3);switch(h){case 16:case 17:case 18:break;default:a("Unknown colorspace "+h)}}else 2===u&&i("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,t,t+l);break;case 1783636e3:218793738!==m(e,t)&&a("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:a("Unsupported header type "+s+" ("+String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s)+")")}c&&(t+=l)}else this.parseCodestream(e,0,e.length)},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){if(65361===(t<<8|(t=e.getByte()))){e.skip(4);var n=e.getInt32()>>>0,r=e.getInt32()>>>0,i=e.getInt32()>>>0,a=e.getInt32()>>>0;e.skip(16);var o=e.getUint16();return this.width=n-i,this.height=r-a,this.componentsCount=o,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,t,n){var i={};try{for(var s=!1,l=t;l+1<n;){var c=p(e,l);l+=2;var u,h,d,f,g,v,y=0;switch(c){case 65359:i.mainHeader=!0;break;case 65497:break;case 65361:y=p(e,l);var _={};_.Xsiz=m(e,l+4),_.Ysiz=m(e,l+8),_.XOsiz=m(e,l+12),_.YOsiz=m(e,l+16),_.XTsiz=m(e,l+20),_.YTsiz=m(e,l+24),_.XTOsiz=m(e,l+28),_.YTOsiz=m(e,l+32);var b=p(e,l+36);_.Csiz=b;var x=[];u=l+38;for(var M=0;M<b;M++){var S={precision:1+(127&e[u]),isSigned:!!(128&e[u]),XRsiz:e[u+1],YRsiz:e[u+1]};r(S,_),x.push(S)}i.SIZ=_,i.components=x,o(i,x),i.QCC=[],i.COC=[];break;case 65372:y=p(e,l);var R={};switch(u=l+2,31&(h=e[u++])){case 0:f=8,g=!0;break;case 1:f=16,g=!1;break;case 2:f=16,g=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(R.noQuantization=8===f,R.scalarExpounded=g,R.guardBits=h>>5,d=[];u<y+l;){var k={};8===f?(k.epsilon=e[u++]>>3,k.mu=0):(k.epsilon=e[u]>>3,k.mu=(7&e[u])<<8|e[u+1],u+=2),d.push(k)}R.SPqcds=d,i.mainHeader?i.QCD=R:(i.currentTile.QCD=R,i.currentTile.QCC=[]);break;case 65373:y=p(e,l);var P,L={};switch(u=l+2,i.SIZ.Csiz<257?P=e[u++]:(P=p(e,u),u+=2),31&(h=e[u++])){case 0:f=8,g=!0;break;case 1:f=16,g=!1;break;case 2:f=16,g=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(L.noQuantization=8===f,L.scalarExpounded=g,L.guardBits=h>>5,d=[];u<y+l;)k={},8===f?(k.epsilon=e[u++]>>3,k.mu=0):(k.epsilon=e[u]>>3,k.mu=(7&e[u])<<8|e[u+1],u+=2),d.push(k);L.SPqcds=d,i.mainHeader?i.QCC[P]=L:i.currentTile.QCC[P]=L;break;case 65362:y=p(e,l);var C={};u=l+2;var I=e[u++];C.entropyCoderWithCustomPrecincts=!!(1&I),C.sopMarkerUsed=!!(2&I),C.ephMarkerUsed=!!(4&I),C.progressionOrder=e[u++],C.layersCount=p(e,u),u+=2,C.multipleComponentTransform=e[u++],C.decompositionLevelsCount=e[u++],C.xcb=2+(15&e[u++]),C.ycb=2+(15&e[u++]);var N=e[u++];if(C.selectiveArithmeticCodingBypass=!!(1&N),C.resetContextProbabilities=!!(2&N),C.terminationOnEachCodingPass=!!(4&N),C.verticalyStripe=!!(8&N),C.predictableTermination=!!(16&N),C.segmentationSymbolUsed=!!(32&N),C.reversibleTransformation=e[u++],C.entropyCoderWithCustomPrecincts){for(var F=[];u<y+l;){var O=e[u++];F.push({PPx:15&O,PPy:O>>4})}C.precinctsSizes=F}var H=[];if(C.selectiveArithmeticCodingBypass&&H.push("selectiveArithmeticCodingBypass"),C.resetContextProbabilities&&H.push("resetContextProbabilities"),C.terminationOnEachCodingPass&&H.push("terminationOnEachCodingPass"),C.verticalyStripe&&H.push("verticalyStripe"),C.predictableTermination&&H.push("predictableTermination"),H.length>0)throw s=!0,new Error("JPX Error: Unsupported COD options ("+H.join(", ")+")");i.mainHeader?i.COD=C:(i.currentTile.COD=C,i.currentTile.COC=[]);break;case 65424:y=p(e,l),(v={}).index=p(e,l+2),v.length=m(e,l+4),v.dataEnd=v.length+l-2,v.partIndex=e[l+8],v.partsCount=e[l+9],i.mainHeader=!1,0===v.partIndex&&(v.COD=i.COD,v.COC=i.COC.slice(0),v.QCD=i.QCD,v.QCC=i.QCC.slice(0)),i.currentTile=v;break;case 65427:0===(v=i.currentTile).partIndex&&(A(i,v.index),E(i)),w(i,e,l,y=v.dataEnd-l);break;case 65365:case 65367:case 65368:case 65380:y=p(e,l);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+c.toString(16))}l+=y}}catch(e){if(s||this.failOnCorruptedImage)throw e;a("Trying to recover from "+e.message)}this.tiles=function(e){for(var t=e.SIZ,n=e.components,r=t.Csiz,i=[],a=0,o=e.tiles.length;a<o;a++){var s,l=e.tiles[a],c=[];for(s=0;s<r;s++)c[s]=T(e,l,s);var u=c[0];if(D=n[0].isSigned)var h=new Int16Array(u.items.length*r);else h=new Uint16Array(u.items.length*r);var d,f,p,m,g,v,y,_,b,E,w,x,A,M,S,R={left:u.left,top:u.top,width:u.width,height:u.height,items:h},k=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var P=4===r,L=c[0].items,C=c[1].items,I=c[2].items,N=P?c[3].items:null;f=.5+(128<<(d=n[0].precision-8)),m=-(g=.5*(p=255*(1<<d)));var F=l.components[0],O=r-3;if(y=L.length,F.codingStyleParameters.reversibleTransformation)for(v=0;v<y;v++,k+=O)_=L[v]+f,b=C[v],w=(x=_-((E=I[v])+b>>2))+E,A=x+b,h[k++]=w<=0?0:w>=p?255:w>>d,h[k++]=x<=0?0:x>=p?255:x>>d,h[k++]=A<=0?0:A>=p?255:A>>d;else for(v=0;v<y;v++,k+=O)_=L[v]+f,b=C[v],w=_+1.402*(E=I[v]),x=_-.34413*b-.71414*E,A=_+1.772*b,h[k++]=w<=0?0:w>=p?255:w>>d,h[k++]=x<=0?0:x>=p?255:x>>d,h[k++]=A<=0?0:A>=p?255:A>>d;if(P)for(v=0,k=3;v<y;v++,k+=4)M=N[v],h[k]=M<=m?0:M>=g?255:M+f>>d}else for(s=0;s<r;s++)if(8===n[s].precision){var H=c[s].items;for(f=.5+(128<<(d=n[s].precision-8)),m=-(p=127.5*(1<<d)),k=s,v=0,y=H.length;v<y;v++)S=H[v],h[k]=S<=m?0:S>=p?255:S+f>>d,k+=r}else{var D=n[s].isSigned;H=c[s].items;if(D)for(k=s,v=0,y=H.length;v<y;v++)h[k]=H[v],k+=r;else{f=.5+(128<<(d=n[s].precision-8));var U=Math.pow(2,n[s].precision)-1;for(k=s,v=0,y=H.length;v<y;v++)S=H[v],h[k]=Math.max(Math.min(S+f,U),0),k+=r}}i.push(R)}return i}(i),this.width=i.SIZ.Xsiz-i.SIZ.XOsiz,this.height=i.SIZ.Ysiz-i.SIZ.YOsiz,this.componentsCount=i.SIZ.Csiz}};var M=function(){function e(e,t){var n=f(Math.max(e,t))+1;this.levels=[];for(var r=0;r<n;r++){var i={width:e,height:t,items:[]};this.levels.push(i),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t){for(var n,r=0,i=0;r<this.levels.length;){var a=e+t*(n=this.levels[r]).width;if(void 0!==n.items[a]){i=n.items[a];break}n.index=a,e>>=1,t>>=1,r++}r--,(n=this.levels[r]).items[n.index]=i,this.currentLevel=r,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return--e<0?(this.value=n,!1):(this.currentLevel=e,(t=this.levels[e]).items[t.index]=n,!0)}},e}(),S=function(){function e(e,t){var n=f(Math.max(e,t))+1;this.levels=[];for(var r=0;r<n;r++){for(var i=new Uint8Array(e*t),a=new Uint8Array(e*t),o=0,s=i.length;o<s;o++)i[o]=0,a[o]=0;var l={width:e,height:t,items:i,status:a};this.levels.push(l),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t,n){this.currentStopValue=n;for(var r=0;r<this.levels.length;){var i=this.levels[r],a=e+t*i.width;i.index=a,e>>=1,t>>=1,r++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var e=this.currentLevel;if(--e<0)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var e=this.currentLevel,t=this.levels[e];return t.items[t.index]>this.currentStopValue},isKnown:function(){var e=this.currentLevel,t=this.levels[e];return t.status[t.index]>0},setKnown:function(){var e=this.currentLevel,t=this.levels[e];t.status[t.index]=1}},e}(),R=function(){var e=17,t=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),n=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),r=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);function i(e,i,a,o,s){this.width=e,this.height=i,this.contextLabelTable="HH"===a?r:"HL"===a?n:t;var l=e*i;this.neighborsSignificance=new Uint8Array(l),this.coefficentsSign=new Uint8Array(l),this.coefficentsMagnitude=s>14?new Uint32Array(l):s>6?new Uint16Array(l):new Uint8Array(l),this.processingFlags=new Uint8Array(l);var c=new Uint8Array(l);if(0!==o)for(var u=0;u<l;u++)c[u]=o;this.bitsDecoded=c,this.reset()}return i.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[17]=92,this.contexts[18]=6},setNeighborsSignificance:function(e,t,n){var r,i=this.neighborsSignificance,a=this.width,o=this.height,s=t>0,l=t+1<a;e>0&&(r=n-a,s&&(i[r-1]+=16),l&&(i[r+1]+=16),i[r]+=4),e+1<o&&(r=n+a,s&&(i[r-1]+=16),l&&(i[r+1]+=16),i[r]+=4),s&&(i[n-1]+=1),l&&(i[n+1]+=1),i[n]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,r=this.coefficentsMagnitude,i=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,s=this.contexts,l=this.contextLabelTable,c=this.bitsDecoded,u=0;u<n;u+=4)for(var h=0;h<t;h++)for(var d=u*t+h,f=0;f<4;f++,d+=t){var p=u+f;if(p>=n)break;if(o[d]&=-2,!r[d]&&a[d]){var m=l[a[d]];if(e.readBit(s,m)){var g=this.decodeSignBit(p,h,d);i[d]=g,r[d]=1,this.setNeighborsSignificance(p,h,d),o[d]|=2}c[d]++,o[d]|=1}}},decodeSignBit:function(e,t,n){var r,i,a,o,s,l,c=this.width,u=this.height,h=this.coefficentsMagnitude,d=this.coefficentsSign;o=t>0&&0!==h[n-1],t+1<c&&0!==h[n+1]?(a=d[n+1],r=o?1-a-(i=d[n-1]):1-a-a):r=o?1-(i=d[n-1])-i:0;var f=3*r;return o=e>0&&0!==h[n-c],e+1<u&&0!==h[n+c]?(a=d[n+c],r=o?1-a-(i=d[n-c])+f:1-a-a+f):r=o?1-(i=d[n-c])-i+f:f,r>=0?(s=9+r,l=this.decoder.readBit(this.contexts,s)):(s=9-r,l=1^this.decoder.readBit(this.contexts,s)),l},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,n=this.width,r=this.height,i=this.coefficentsMagnitude,a=this.neighborsSignificance,o=this.contexts,s=this.bitsDecoded,l=this.processingFlags,c=n*r,u=4*n,h=0;h<c;h=e){e=Math.min(c,h+u);for(var d=0;d<n;d++)for(var f=h+d;f<e;f+=n)if(i[f]&&0==(1&l[f])){var p=16;if(0!=(2&l[f]))l[f]^=2,p=0===(127&a[f])?15:14;var m=t.readBit(o,p);i[f]=i[f]<<1|m,s[f]++,l[f]|=1}}},runCleanupPass:function(){for(var t,n=this.decoder,r=this.width,i=this.height,a=this.neighborsSignificance,o=this.coefficentsMagnitude,s=this.coefficentsSign,l=this.contexts,c=this.contextLabelTable,u=this.bitsDecoded,h=this.processingFlags,d=r,f=2*r,p=3*r,m=0;m<i;m=t){t=Math.min(m+4,i);for(var g=m*r,v=m+3<i,y=0;y<r;y++){var _,b=g+y,E=0,w=b,x=m;if(v&&0===h[b]&&0===h[b+d]&&0===h[b+f]&&0===h[b+p]&&0===a[b]&&0===a[b+d]&&0===a[b+f]&&0===a[b+p]){if(!n.readBit(l,18)){u[b]++,u[b+d]++,u[b+f]++,u[b+p]++;continue}0!==(E=n.readBit(l,e)<<1|n.readBit(l,e))&&(x=m+E,w+=E*r),_=this.decodeSignBit(x,y,w),s[w]=_,o[w]=1,this.setNeighborsSignificance(x,y,w),h[w]|=2,w=b;for(var T=m;T<=x;T++,w+=r)u[w]++;E++}for(x=m+E;x<t;x++,w+=r)if(!o[w]&&0==(1&h[w])){var A=c[a[w]];1===n.readBit(l,A)&&(_=this.decodeSignBit(x,y,w),s[w]=_,o[w]=1,this.setNeighborsSignificance(x,y,w),h[w]|=2),u[w]++}}}},checkSegmentationSymbol:function(){var t=this.decoder,n=this.contexts;if(10!==(t.readBit(n,e)<<3|t.readBit(n,e)<<2|t.readBit(n,e)<<1|t.readBit(n,e)))throw new Error("JPX Error: Invalid segmentation symbol")}},i}(),k=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var r=e[0],i=1,a=e.length;i<a;i++)r=this.iterate(r,e[i],t,n);return r},e.prototype.extend=function(e,t,n){var r=t-1,i=t+1,a=t+n-2,o=t+n;e[r--]=e[i++],e[o++]=e[a--],e[r--]=e[i++],e[o++]=e[a--],e[r--]=e[i++],e[o++]=e[a--],e[r]=e[i],e[o]=e[a]},e.prototype.iterate=function(e,t,n,r){var i,a,o,s,l,c,u=e.width,h=e.height,d=e.items,f=t.width,p=t.height,m=t.items;for(o=0,i=0;i<h;i++)for(s=2*i*f,a=0;a<u;a++,o++,s+=2)m[s]=d[o];d=e.items=null;var g=new Float32Array(f+8);if(1===f){if(0!=(1&n))for(c=0,o=0;c<p;c++,o+=f)m[o]*=.5}else for(c=0,o=0;c<p;c++,o+=f)g.set(m.subarray(o,o+f),4),this.extend(g,4,f),this.filter(g,4,f),m.set(g.subarray(4,4+f),o);var v=16,y=[];for(i=0;i<v;i++)y.push(new Float32Array(p+8));var _,b=0;if(e=4+p,1===p){if(0!=(1&r))for(l=0;l<f;l++)m[l]*=.5}else for(l=0;l<f;l++){if(0===b){for(v=Math.min(f-l,v),o=l,s=4;s<e;o+=f,s++)for(_=0;_<v;_++)y[_][s]=m[o+_];b=v}var E=y[--b];if(this.extend(E,4,p),this.filter(E,4,p),0===b)for(o=l-v+1,s=4;s<e;o+=f,s++)for(_=0;_<v;_++)m[o+_]=y[_][s]}return{width:f,height:p,items:m}},e}(),P=function(){function e(){k.call(this)}return e.prototype=Object.create(k.prototype),e.prototype.filter=function(e,t,n){var r,i,a,o,s=n>>1,l=-1.586134342059924,c=-.052980118572961,u=.882911075530934,h=.443506852043971,d=1.230174104914001;for(r=(t|=0)-3,i=s+4;i--;r+=2)e[r]*=.8128930661159609;for(a=h*e[(r=t-2)-1],i=s+3;i--&&(o=h*e[r+1],e[r]=d*e[r]-a-o,i--);r+=2)a=h*e[(r+=2)+1],e[r]=d*e[r]-a-o;for(a=u*e[(r=t-1)-1],i=s+2;i--&&(o=u*e[r+1],e[r]-=a+o,i--);r+=2)a=u*e[(r+=2)+1],e[r]-=a+o;for(a=c*e[(r=t)-1],i=s+1;i--&&(o=c*e[r+1],e[r]-=a+o,i--);r+=2)a=c*e[(r+=2)+1],e[r]-=a+o;if(0!==s)for(a=l*e[(r=t+1)-1],i=s;i--&&(o=l*e[r+1],e[r]-=a+o,i--);r+=2)a=l*e[(r+=2)+1],e[r]-=a+o},e}(),L=function(){function e(){k.call(this)}return e.prototype=Object.create(k.prototype),e.prototype.filter=function(e,t,n){var r,i,a=n>>1;for(r=t|=0,i=a+1;i--;r+=2)e[r]-=e[r-1]+e[r+1]+2>>2;for(r=t+1,i=a;i--;r+=2)e[r]+=e[r-1]+e[r+1]>>1},e}();return t}(),n=function(){var e=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];function t(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}return t.prototype={byteIn:function(){var e=this.data,t=this.bp;255===e[t]?e[t+1]>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t);this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(t,n){var r,i=t[n]>>1,a=1&t[n],o=e[i],s=o.qe,l=this.a-s;if(this.chigh<s)l<s?(l=s,r=a,i=o.nmps):(l=s,r=1^a,1===o.switchFlag&&(a=r),i=o.nlps);else{if(this.chigh-=s,0!=(32768&l))return this.a=l,a;l<s?(r=1^a,1===o.switchFlag&&(a=r),i=o.nlps):(r=a,i=o.nmps)}do{0===this.ct&&this.byteIn(),l<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&l));return this.a=l,t[n]=i<<1|a,r}},t}(),r="undefined"==typeof window?this:window;r.PDFJS||(r.PDFJS={}),r.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};function i(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function a(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}var o;PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},PDFJS.UnsupportedManager=(o=[],{listen:function(e){o.push(e)},notify:function(e){a('Unsupported feature "'+e+'"');for(var t=0,n=o.length;t<n;t++)o[t](e)}});function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}PDFJS.isValidUrl=function(e,t){if(!e)return!1;var n=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);if(!n)return t;switch(n=n[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}},PDFJS.shadow=s;PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};var l=function(){function e(e,t){this.name="PasswordException",this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.PasswordException=l;var c=function(){function e(e,t){this.name="UnknownErrorException",this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=c;var u=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=u;var h=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=h;var d=function(){function e(e,t){this.name="UnexpectedResponseException",this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=d;(function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e})(),function(){function e(e,t){this.begin=e,this.end=t,this.message="Missing data ["+e+", "+t+")"}e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e}(),function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e}();function f(e){for(var t=1,n=0;e>t;)t<<=1,n++;return n}function p(e,t){return e[t]<<8|e[t+1]}function m(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return s(PDFJS,"isLittleEndian",((e=new Uint8Array(2))[0]=1,1===new Uint16Array(e.buffer)[0]));var e}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return s(PDFJS,"hasCanvasTypedArrays",((e=document.createElement("canvas")).width=e.height=1,void 0!==e.getContext("2d").createImageData(1,1).data.buffer));var e}});!function(){function e(r,i){this.buffer=r,this.byteLength=r.length,this.length=void 0===i?this.byteLength>>2:i,function(r){for(;t<r;)Object.defineProperty(e.prototype,t,n(t)),t++}(this.length)}e.prototype=Object.create(null);var t=0;function n(e){return{get:function(){var t=this.buffer,n=e<<2;return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0},set:function(t){var n=this.buffer,r=e<<2;n[r]=255&t,n[r+1]=t>>8&255,n[r+2]=t>>16&255,n[r+3]=t>>>24&255}}}}();var g=PDFJS.Util=function(){function e(){}var t=["rgb(",0,",",0,",",0,")"];return e.makeCssRgb=function(e,n,r){return t[1]=e,t[3]=n,t[5]=r,t.join("")},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n]},e.getAxialAlignedBoundingBox=function(t,n){var r=e.applyTransform(t,n),i=e.applyTransform(t.slice(2,4),n),a=e.applyTransform([t[0],t[3]],n),o=e.applyTransform([t[2],t[1]],n);return[Math.min(r[0],i[0],a[0],o[0]),Math.min(r[1],i[1],a[1],o[1]),Math.max(r[0],i[0],a[0],o[0]),Math.max(r[1],i[1],a[1],o[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(n+a)/2,s=Math.sqrt((n+a)*(n+a)-4*(n*a-i*r))/2,l=o+s||1,c=o-s||1;return[Math.sqrt(l),Math.sqrt(c)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function r(e,t){return e-t}var i=[t[0],t[2],n[0],n[2]].sort(r),a=[t[1],t[3],n[1],n[3]].sort(r),o=[];return t=e.normalizeRect(t),n=e.normalizeRect(n),(i[0]===t[0]&&i[1]===n[0]||i[0]===n[0]&&i[1]===t[0])&&(o[0]=i[1],o[2]=i[2],(a[0]===t[1]&&a[1]===n[1]||a[0]===n[1]&&a[1]===t[1])&&(o[1]=a[1],o[3]=a[2],o))},e.sign=function(e){return e<0?-1:1},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t){for(;e&&!e.has(t);)e=e.get("Parent");return e?e.get(t):null},e.inherit=function(e,t,n){for(var r in e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n)e.prototype[r]=n[r]},e.loadScript=function(e,t){var n=document.createElement("script"),r=!1;n.setAttribute("src",e),t&&(n.onload=function(){r||t(),r=!0}),document.getElementsByTagName("head")[0].appendChild(n)},e}();PDFJS.PageViewport=function(){function e(e,t,n,r,i,a){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=r,this.offsetY=i;var o,s,l,c,u,h,d,f,p=(e[2]+e[0])/2,m=(e[3]+e[1])/2;switch(n=(n%=360)<0?n+360:n){case 180:o=-1,s=0,l=0,c=1;break;case 90:o=0,s=1,l=1,c=0;break;case 270:o=0,s=-1,l=-1,c=0;break;default:o=1,s=0,l=0,c=-1}a&&(l=-l,c=-c),0===o?(u=Math.abs(m-e[1])*t+r,h=Math.abs(p-e[0])*t+i,d=Math.abs(e[3]-e[1])*t,f=Math.abs(e[2]-e[0])*t):(u=Math.abs(p-e[0])*t+r,h=Math.abs(m-e[1])*t+i,d=Math.abs(e[2]-e[0])*t,f=Math.abs(e[3]-e[1])*t),this.transform=[o*t,s*t,l*t,c*t,u-o*t*p-l*t*m,h-s*t*p-c*t*m],this.width=d,this.height=f,this.fontScale=t}return e.prototype={clone:function(t){var n="scale"in(t=t||{})?t.scale:this.scale,r="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,r,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return g.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=g.applyTransform([e[0],e[1]],this.transform),n=g.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return g.applyInverseTransform([e,t],this.transform)}},e}();function v(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e}PDFJS.createPromiseCapability=v,function(){if(r.Promise)return"function"!=typeof r.Promise.all&&(r.Promise.all=function(e){var t,n,i=0,a=[],o=new r.Promise((function(e,r){t=e,n=r}));return e.forEach((function(e,r){i++,e.then((function(e){a[r]=e,0===--i&&t(a)}),n)})),0===i&&t(a),o}),"function"!=typeof r.Promise.resolve&&(r.Promise.resolve=function(e){return new r.Promise((function(t){t(e)}))}),"function"!=typeof r.Promise.reject&&(r.Promise.reject=function(e){return new r.Promise((function(t,n){n(e)}))}),void("function"!=typeof r.Promise.prototype.catch&&(r.Promise.prototype.catch=function(e){return r.Promise.prototype.then(void 0,e)}));var e={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(e){0!==e._status&&(this.handlers=this.handlers.concat(e._handlers),e._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=Date.now()+1;this.handlers.length>0;){var t=this.handlers.shift(),n=t.thisPromise._status,r=t.thisPromise._value;try{1===n?"function"==typeof t.onResolve&&(r=t.onResolve(r)):"function"==typeof t.onReject&&(r=t.onReject(r),n=1,t.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(t.thisPromise))}catch(e){n=2,r=e}if(t.nextPromise._updateStatus(n,r),Date.now()>=e)break}this.handlers.length>0?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(e){e._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===e&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var e=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(e-this.unhandledRejections[t].time>500){var n=this.unhandledRejections[t].promise._value,r="Unhandled rejection: "+n;n.stack&&(r+="\n"+n.stack),a(r),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};function t(e){this._status=0,this._handlers=[];try{e.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(e){this._reject(e)}}t.all=function(e){var n,r,i=new t((function(e,t){n=e,r=t})),a=e.length,o=[];if(0===a)return n(o),i;function s(e){2!==i._status&&(o=[],r(e))}for(var l=0,c=e.length;l<c;++l){var u=e[l],h=function(e){return function(t){2!==i._status&&(o[e]=t,0===--a&&n(o))}}(l);t.isPromise(u)?u.then(h,s):h(u)}return i},t.isPromise=function(e){return e&&"function"==typeof e.then},t.resolve=function(e){return new t((function(t){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(n,r){1!==this._status&&2!==this._status&&(1===n&&t.isPromise(r)?r.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,2)):(this._status=n,this._value=r,2===n&&0===this._handlers.length&&(this._unhandledRejection=!0,e.addUnhandledRejection(this)),e.scheduleHandlers(this)))},_resolve:function(e){this._updateStatus(1,e)},_reject:function(e){this._updateStatus(2,e)},then:function(n,r){var i=new t((function(e,t){this.resolve=e,this.reject=t}));return this._handlers.push({thisPromise:this,onResolve:n,onReject:r,nextPromise:i}),e.scheduleHandlers(this),i},catch:function(e){return this.then(void 0,e)}},r.Promise=t}();var y;!function(){function e(e,t,n){for(;e.length<n;)e+=t;return e}function t(){this.started={},this.times=[],this.enabled=!0}t.prototype={time:function(e){this.enabled&&(e in this.started&&a("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||a("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t,n,r=this.times,i="",a=0;for(t=0,n=r.length;t<n;++t){var o=r[t].name;o.length>a&&(a=o.length)}for(t=0,n=r.length;t<n;++t){var s=r[t],l=s.end-s.start;i+=e(s.name," ",a)+" "+l+"ms\n"}return i}}}();PDFJS.createBlob=function(e,t){if("undefined"!=typeof Blob)return new Blob([e],{type:t});var n=new MozBlobBuilder;return n.append(e),n.getBlob(t)},PDFJS.createObjectURL=(y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",function(e,t){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var n=PDFJS.createBlob(e,t);return URL.createObjectURL(n)}for(var r="data:"+t+";base64,",i=0,a=e.length;i<a;i+=3){var o=255&e[i],s=255&e[i+1],l=255&e[i+2];r+=y[o>>2]+y[(3&o)<<4|s>>4]+y[i+1<a?(15&s)<<2|l>>6:64]+y[i+2<a?63&l:64]}return r});e.exports&&(e.exports=t)},2649:(e,t,n)=>{"use strict";n.r(t);var r=n(743);!function(){class e extends THREE.Loader{constructor(e){super(e),this.availableExtensions=[]}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this,n=new THREE.TextureLoader(this.manager);function i(e){const t=[],n=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship");for(let e=0;e<n.length;e++){const r=n[e],i={target:r.getAttribute("Target"),id:r.getAttribute("Id"),type:r.getAttribute("Type")};t.push(i)}return t}function a(e){const t={id:e.getAttribute("id"),basematerials:[]},n=e.querySelectorAll("base");for(let e=0;e<n.length;e++){const r=c(n[e]);r.index=e,t.basematerials.push(r)}return t}function o(e){const t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},n=e.querySelectorAll("tex2coord"),r=[];for(let e=0;e<n.length;e++){const t=n[e],i=t.getAttribute("u"),a=t.getAttribute("v");r.push(parseFloat(i),parseFloat(a))}return t.uvs=new Float32Array(r),t}function s(e){const t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},n=e.querySelectorAll("color"),r=[],i=new THREE.Color;for(let e=0;e<n.length;e++){const t=n[e].getAttribute("color");i.setStyle(t.substring(0,7)),i.convertSRGBToLinear(),r.push(i.r,i.g,i.b)}return t.colors=new Float32Array(r),t}function l(e){const t={id:e.getAttribute("id")},n=e.querySelectorAll("pbmetallic"),r=[];for(let e=0;e<n.length;e++){const t=n[e];r.push({name:t.getAttribute("name"),metallicness:parseFloat(t.getAttribute("metallicness")),roughness:parseFloat(t.getAttribute("roughness"))})}return t.data=r,t}function c(e){const t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}function u(e){const t={};t.objectId=e.getAttribute("objectid");const n=e.getAttribute("transform");return n&&(t.transform=h(n)),t}function h(e){const t=[];e.split(" ").forEach((function(e){t.push(parseFloat(e))}));const n=new THREE.Matrix4;return n.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),n}function d(e){const t={type:e.getAttribute("type")},n=e.getAttribute("id");n&&(t.id=n);const r=e.getAttribute("pid");r&&(t.pid=r);const i=e.getAttribute("pindex");i&&(t.pindex=i);const a=e.getAttribute("thumbnail");a&&(t.thumbnail=a);const o=e.getAttribute("partnumber");o&&(t.partnumber=o);const s=e.getAttribute("name");s&&(t.name=s);const l=e.querySelector("mesh");l&&(t.mesh=function(e){const t={},n=[],r=e.querySelectorAll("vertices vertex");for(let e=0;e<r.length;e++){const t=r[e],i=t.getAttribute("x"),a=t.getAttribute("y"),o=t.getAttribute("z");n.push(parseFloat(i),parseFloat(a),parseFloat(o))}t.vertices=new Float32Array(n);const i=[],a=[],o=e.querySelectorAll("triangles triangle");for(let e=0;e<o.length;e++){const t=o[e],n=t.getAttribute("v1"),r=t.getAttribute("v2"),s=t.getAttribute("v3"),l=t.getAttribute("p1"),c=t.getAttribute("p2"),u=t.getAttribute("p3"),h=t.getAttribute("pid"),d={};d.v1=parseInt(n,10),d.v2=parseInt(r,10),d.v3=parseInt(s,10),a.push(d.v1,d.v2,d.v3),l&&(d.p1=parseInt(l,10)),c&&(d.p2=parseInt(c,10)),u&&(d.p3=parseInt(u,10)),h&&(d.pid=h),0<Object.keys(d).length&&i.push(d)}return t.triangleProperties=i,t.triangles=new Uint32Array(a),t}(l));const c=e.querySelector("components");return c&&(t.components=function(e){const t=[],n=e.querySelectorAll("component");for(let e=0;e<n.length;e++){const r=u(n[e]);t.push(r)}return t}(c)),t}function f(e){const t={unit:e.getAttribute("unit")||"millimeter"},n=e.querySelectorAll("metadata");n&&(t.metadata=function(e){const t={};for(let n=0;n<e.length;n++){const r=e[n],i=r.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=r.textContent)}return t}(n));const r=e.querySelector("resources");r&&(t.resources=function(e){const t={basematerials:{}},n=e.querySelectorAll("basematerials");for(let e=0;e<n.length;e++){const r=a(n[e]);t.basematerials[r.id]=r}t.texture2d={};const r=e.querySelectorAll("texture2d");for(let e=0;e<r.length;e++){const n={id:(i=r[e]).getAttribute("id"),path:i.getAttribute("path"),contenttype:i.getAttribute("contenttype"),tilestyleu:i.getAttribute("tilestyleu"),tilestylev:i.getAttribute("tilestylev"),filter:i.getAttribute("filter")};t.texture2d[n.id]=n}var i;t.colorgroup={};const c=e.querySelectorAll("colorgroup");for(let e=0;e<c.length;e++){const n=s(c[e]);t.colorgroup[n.id]=n}t.pbmetallicdisplayproperties={};const u=e.querySelectorAll("pbmetallicdisplayproperties");for(let e=0;e<u.length;e++){const n=l(u[e]);t.pbmetallicdisplayproperties[n.id]=n}t.texture2dgroup={};const h=e.querySelectorAll("texture2dgroup");for(let e=0;e<h.length;e++){const n=o(h[e]);t.texture2dgroup[n.id]=n}t.object={};const f=e.querySelectorAll("object");for(let e=0;e<f.length;e++){const n=d(f[e]);t.object[n.id]=n}return t}(r));const i=e.querySelector("build");return i&&(t.build=function(e){const t=[],n=e.querySelectorAll("item");for(let e=0;e<n.length;e++){const r=n[e],i={objectId:r.getAttribute("objectid")},a=r.getAttribute("transform");a&&(i.transform=h(a)),t.push(i)}return t}(i)),t}function p(e,t,r,i){const a=e.texid,o=r.resources.texture2d[a];if(o){const e=i[o.path],t=o.contenttype,r=new Blob([e],{type:t}),a=URL.createObjectURL(r),s=n.load(a,(function(){URL.revokeObjectURL(a)}));switch(s.encoding=THREE.sRGBEncoding,o.tilestyleu){case"wrap":s.wrapS=THREE.RepeatWrapping;break;case"mirror":s.wrapS=THREE.MirroredRepeatWrapping;break;case"none":case"clamp":s.wrapS=THREE.ClampToEdgeWrapping;break;default:s.wrapS=THREE.RepeatWrapping}switch(o.tilestylev){case"wrap":s.wrapT=THREE.RepeatWrapping;break;case"mirror":s.wrapT=THREE.MirroredRepeatWrapping;break;case"none":case"clamp":s.wrapT=THREE.ClampToEdgeWrapping;break;default:s.wrapT=THREE.RepeatWrapping}switch(o.filter){case"auto":s.magFilter=THREE.LinearFilter,s.minFilter=THREE.LinearMipmapLinearFilter;break;case"linear":s.magFilter=THREE.LinearFilter,s.minFilter=THREE.LinearFilter;break;case"nearest":s.magFilter=THREE.NearestFilter,s.minFilter=THREE.NearestFilter;break;default:s.magFilter=THREE.LinearFilter,s.minFilter=THREE.LinearMipmapLinearFilter}return s}return null}function m(e,t,n,r,i,a,o){const s=o.pindex,l={};for(let e=0,n=t.length;e<n;e++){const n=t[e],r=void 0!==n.p1?n.p1:s;void 0===l[r]&&(l[r]=[]),l[r].push(n)}const c=Object.keys(l),u=[];for(let t=0,s=c.length;t<s;t++){const s=c[t],h=l[s],d=E(e.basematerials[s],r,i,a,o,w),f=new THREE.BufferGeometry,p=[],m=n.vertices;for(let e=0,t=h.length;e<t;e++){const t=h[e];p.push(m[3*t.v1+0]),p.push(m[3*t.v1+1]),p.push(m[3*t.v1+2]),p.push(m[3*t.v2+0]),p.push(m[3*t.v2+1]),p.push(m[3*t.v2+2]),p.push(m[3*t.v3+0]),p.push(m[3*t.v3+1]),p.push(m[3*t.v3+2])}f.setAttribute("position",new THREE.Float32BufferAttribute(p,3));const g=new THREE.Mesh(f,d);u.push(g)}return u}function g(e,t,n,r,i,a,o){const s=new THREE.BufferGeometry,l=[],c=[],u=n.vertices,h=e.uvs;for(let e=0,n=t.length;e<n;e++){const n=t[e];l.push(u[3*n.v1+0]),l.push(u[3*n.v1+1]),l.push(u[3*n.v1+2]),l.push(u[3*n.v2+0]),l.push(u[3*n.v2+1]),l.push(u[3*n.v2+2]),l.push(u[3*n.v3+0]),l.push(u[3*n.v3+1]),l.push(u[3*n.v3+2]),c.push(h[2*n.p1+0]),c.push(h[2*n.p1+1]),c.push(h[2*n.p2+0]),c.push(h[2*n.p2+1]),c.push(h[2*n.p3+0]),c.push(h[2*n.p3+1])}s.setAttribute("position",new THREE.Float32BufferAttribute(l,3)),s.setAttribute("uv",new THREE.Float32BufferAttribute(c,2));const d=E(e,r,i,a,o,p),f=new THREE.MeshPhongMaterial({map:d,flatShading:!0});return new THREE.Mesh(s,f)}function v(e,t,n,r,i,a){const o=new THREE.BufferGeometry,s=[],l=[],c=n.vertices,u=e.colors;for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n.v1,i=n.v2,o=n.v3;s.push(c[3*r+0]),s.push(c[3*r+1]),s.push(c[3*r+2]),s.push(c[3*i+0]),s.push(c[3*i+1]),s.push(c[3*i+2]),s.push(c[3*o+0]),s.push(c[3*o+1]),s.push(c[3*o+2]);const h=void 0!==n.p1?n.p1:a.pindex,d=void 0!==n.p2?n.p2:h,f=void 0!==n.p3?n.p3:h;l.push(u[3*h+0]),l.push(u[3*h+1]),l.push(u[3*h+2]),l.push(u[3*d+0]),l.push(u[3*d+1]),l.push(u[3*d+2]),l.push(u[3*f+0]),l.push(u[3*f+1]),l.push(u[3*f+2])}o.setAttribute("position",new THREE.Float32BufferAttribute(s,3)),o.setAttribute("color",new THREE.Float32BufferAttribute(l,3));const h=new THREE.MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new THREE.Mesh(o,h)}function y(e){const t=new THREE.BufferGeometry;t.setIndex(new THREE.BufferAttribute(e.triangles,1)),t.setAttribute("position",new THREE.BufferAttribute(e.vertices,3));const n=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});return new THREE.Mesh(t,n)}function _(e,t){return void 0!==t.resources.texture2dgroup[e]?"texture":void 0!==t.resources.basematerials[e]?"material":void 0!==t.resources.colorgroup[e]?"vertexColors":"default"===e?"default":void 0}function b(e,t,n,r,i){const a=new THREE.Group,o=function(e,t,n,r,i,a){const o=Object.keys(e),s=[];for(let l=0,c=o.length;l<c;l++){const c=o[l],u=e[c];switch(_(c,r)){case"material":const e=m(r.resources.basematerials[c],u,t,n,r,i,a);for(let t=0,n=e.length;t<n;t++)s.push(e[t]);break;case"texture":const o=r.resources.texture2dgroup[c];s.push(g(o,u,t,n,r,i,a));break;case"vertexColors":const l=r.resources.colorgroup[c];s.push(v(l,u,t,0,0,a));break;case"default":s.push(y(t));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}return s}(function(e,t,n){const r={},i=t.triangleProperties,a=n.pid;for(let e=0,t=i.length;e<t;e++){const t=i[e];let n=void 0!==t.pid?t.pid:a;void 0===n&&(n="default"),void 0===r[n]&&(r[n]=[]),r[n].push(t)}return r}(0,e,i),e,t,n,r,i);for(let e=0,t=o.length;e<t;e++)a.add(o[e]);return a}function E(e,t,n,r,i,a){return void 0!==e.build||(e.build=a(e,t,n,r,i)),e.build}function w(e,t,n){let r;const i=e.displaypropertiesid,a=n.resources.pbmetallicdisplayproperties;if(null!==i&&void 0!==a[i]){const t=a[i].data[e.index];r=new THREE.MeshStandardMaterial({flatShading:!0,roughness:t.roughness,metalness:t.metallicness})}else r=new THREE.MeshPhongMaterial({flatShading:!0});r.name=e.name;const o=e.displaycolor,s=o.substring(0,7);return r.color.setStyle(s),r.color.convertSRGBToLinear(),9===o.length&&(r.opacity=parseInt(o.charAt(7)+o.charAt(8),16)/255),r}function x(e,t,n,r){const i=new THREE.Group;for(let a=0;a<e.length;a++){const o=e[a];let s=t[o.objectId];void 0===s&&(T(o.objectId,t,n,r),s=t[o.objectId]);const l=s.clone(),c=o.transform;c&&l.applyMatrix4(c),i.add(l)}return i}function T(e,n,r,i){const a=r.resources.object[e];if(a.mesh){const e=a.mesh;!function(e,n,r){if(!e)return;const i=[],a=Object.keys(e);for(let e=0;e<a.length;e++){const n=a[e];for(let e=0;e<t.availableExtensions.length;e++){const r=t.availableExtensions[e];r.ns===n&&i.push(r)}}for(let t=0;t<i.length;t++){const a=i[t];a.apply(r,e[a.ns],n)}}(r.extensions,e,r.xml),n[a.id]=E(e,n,r,i,a,b)}else{const e=a.components;n[a.id]=E(e,n,r,i,a,x)}}const A=function(e){let t,n,a=null,o=null;const s=[],l=[],c=[],u=[];let h;const d={},p={};try{a=r.unzipSync(new Uint8Array(e))}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(o in a)o.match(/\_rels\/.rels$/)?t=o:o.match(/3D\/_rels\/.*\.model\.rels$/)?n=o:o.match(/^3D\/.*\.model$/)?s.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)?l.push(o):o.match(/^3D\/Textures?\/.*/)?c.push(o):o.match(/^3D\/Other\/.*/)&&u.push(o);const m=a[t],g=i(THREE.LoaderUtils.decodeText(m));if(n){const e=a[n];h=i(THREE.LoaderUtils.decodeText(e))}for(let e=0;e<s.length;e++){const t=s[e],n=a[t],r=THREE.LoaderUtils.decodeText(n),i=(new DOMParser).parseFromString(r,"application/xml");"model"!==i.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",t);const o=i.querySelector("model"),l={};for(let e=0;e<o.attributes.length;e++){const t=o.attributes[e];t.name.match(/^xmlns:(.+)$/)&&(l[t.value]=RegExp.$1)}const c=f(o);c.xml=o,0<Object.keys(l).length&&(c.extensions=l),d[t]=c}for(let e=0;e<c.length;e++){const t=c[e];p[t]=a[t].buffer}return{rels:g,modelRels:h,model:d,printTicket:{},texture:p,other:{}}}(e);return function(e,t){const n=new THREE.Group,r=function(e){for(let t=0;t<e.length;t++){const n=e[t];if("model"===n.target.split(".").pop().toLowerCase())return n}}(t.rels),i=t.model[r.target.substring(1)].build;for(let t=0;t<i.length;t++){const r=i[t],a=e[r.objectId],o=r.transform;o&&a.applyMatrix4(o),n.add(a)}return n}(function(e){const t=e.model,n=e.modelRels,r={},i=Object.keys(t),a={};if(n)for(let t=0,r=n.length;t<r;t++){const r=n[t],i=r.target.substring(1);e.texture[i]&&(a[r.target]=e.texture[i])}for(let e=0;e<i.length;e++){const n=t[i[e]],o=Object.keys(n.resources.object);for(let e=0;e<o.length;e++){T(o[e],r,n,a)}}return r}(A),A)}addExtension(e){this.availableExtensions.push(e)}}THREE.ThreeMFLoader=e,THREE.ThreeMFLoader.MaterialsAndPropertiesExtension={ns:"http://schemas.microsoft.com/3dmanufacturing/material/2015/02",apply:function(e,t,n){for(var r=e.querySelectorAll("colorgroup"),i=0;i<r.length;i++){var a=r[i];if(a.prefix===t){for(var o=a.getAttribute("id"),s=a.querySelectorAll("color"),l=[],c=0;c<s.length;c++){var u=s[c].getAttribute("color");u.match(/#[0-9a-fA-F]{8}/)?l.push(new THREE.Color(u.substring(0,7))):l.push(new THREE.Color(u))}for(var h=[],d=0;d<n.triangleProperties.length;d++){var f=n.triangleProperties[d];if(f.pid===o){var p=l[f.p1],m=l[f.p2||f.p1],g=l[f.p3||f.p1];h.push(p.r,p.g,p.b),h.push(m.r,m.g,m.b),h.push(g.r,g.g,g.b)}}n.colors=new Float32Array(h.length);for(var v=0;v<h.length;v++)n.colors[v]=h[v]}}}}}()},3572:(e,t,n)=>{"use strict";n.r(t);var r=n(743);!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){function t(e){let t="AMF Material";const r=e.attributes.id.textContent;let i={r:1,g:1,b:1,a:1},a=null;for(let r=0;r<e.childNodes.length;r++){const a=e.childNodes[r];"metadata"===a.nodeName&&void 0!==a.attributes.type?"name"===a.attributes.type.value&&(t=a.textContent):"color"===a.nodeName&&(i=n(a))}return a=new THREE.MeshPhongMaterial({flatShading:!0,color:new THREE.Color(i.r,i.g,i.b),name:t}),1!==i.a&&(a.transparent=!0,a.opacity=i.a),{id:r,material:a}}function n(e){const t={r:1,g:1,b:1,a:1};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];"r"===r.nodeName?t.r=r.textContent:"g"===r.nodeName?t.g=r.textContent:"b"===r.nodeName?t.b=r.textContent:"a"===r.nodeName&&(t.a=r.textContent)}return t}function i(e){const t={name:"",triangles:[],materialid:null};let n=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);n;){if("metadata"===n.nodeName)void 0!==n.attributes.type&&"name"===n.attributes.type.value&&(t.name=n.textContent);else if("triangle"===n.nodeName){const e=n.getElementsByTagName("v1")[0].textContent,r=n.getElementsByTagName("v2")[0].textContent,i=n.getElementsByTagName("v3")[0].textContent;t.triangles.push(e,r,i)}n=n.nextElementSibling}return t}function a(e){const t=[],n=[];let r=e.firstElementChild;for(;r;){if("vertex"===r.nodeName){let e=r.firstElementChild;for(;e;){if("coordinates"===e.nodeName){const n=e.getElementsByTagName("x")[0].textContent,r=e.getElementsByTagName("y")[0].textContent,i=e.getElementsByTagName("z")[0].textContent;t.push(n,r,i)}else if("normal"===e.nodeName){const t=e.getElementsByTagName("nx")[0].textContent,r=e.getElementsByTagName("ny")[0].textContent,i=e.getElementsByTagName("nz")[0].textContent;n.push(t,r,i)}e=e.nextElementSibling}}r=r.nextElementSibling}return{vertices:t,normals:n}}function o(e){const t=e.attributes.id.textContent,r={name:"amfobject",meshes:[]};let o=null,s=e.firstElementChild;for(;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(r.name=s.textContent);else if("color"===s.nodeName)o=n(s);else if("mesh"===s.nodeName){let e=s.firstElementChild;const t={vertices:[],normals:[],volumes:[],color:o};for(;e;){if("vertices"===e.nodeName){const n=a(e);t.normals=t.normals.concat(n.normals),t.vertices=t.vertices.concat(n.vertices)}else"volume"===e.nodeName&&t.volumes.push(i(e));e=e.nextElementSibling}r.meshes.push(t)}s=s.nextElementSibling}return{id:t,obj:r}}const s=function(e){let t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){let n=null,i=null;console.log("THREE.AMFLoader: Loading Zip");try{n=r.unzipSync(new Uint8Array(e))}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(i in n)if(".amf"===i.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+i),t=new DataView(n[i].buffer)}const n=THREE.LoaderUtils.decodeText(t),i=(new DOMParser).parseFromString(n,"application/xml");return"amf"!==i.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):i}(e);let l="",c="";const u=function(e){let t=1,n="millimeter";void 0!==e.documentElement.attributes.unit&&(n=e.documentElement.attributes.unit.value.toLowerCase());const r={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==r[n]&&(t=r[n]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(s),h={},d={},f=s.documentElement.childNodes;let p,m;for(p=0;p<f.length;p++){const e=f[p];if("metadata"===e.nodeName)void 0!==e.attributes.type&&("name"===e.attributes.type.value?l=e.textContent:"author"===e.attributes.type.value&&(c=e.textContent));else if("material"===e.nodeName){const n=t(e);h[n.id]=n.material}else if("object"===e.nodeName){const t=o(e);d[t.id]=t.obj}}const g=new THREE.Group,v=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});g.name=l,g.userData.author=c,g.userData.loader="AMF";for(const e in d){const t=d[e],n=t.meshes,r=new THREE.Group;for(r.name=t.name||"",p=0;p<n.length;p++){let e=v;const t=n[p],i=new THREE.Float32BufferAttribute(t.vertices,3);let a=null;if(t.normals.length&&(a=new THREE.Float32BufferAttribute(t.normals,3)),t.color){const n=t.color;e=v.clone(),e.color=new THREE.Color(n.r,n.g,n.b),1!==n.a&&(e.transparent=!0,e.opacity=n.a)}const o=t.volumes;for(m=0;m<o.length;m++){const t=o[m],n=new THREE.BufferGeometry;let s=e;n.setIndex(t.triangles),n.setAttribute("position",i.clone()),a&&n.setAttribute("normal",a.clone()),void 0!==h[t.materialId]&&(s=h[t.materialId]),n.scale(u,u,u),r.add(new THREE.Mesh(n,s.clone()))}}g.add(r)}return g}}THREE.AMFLoader=e}()},9211:()=>{THREE.AnaglyphEffect=class{constructor(e,t=512,n=512){this.colorMatrixLeft=(new THREE.Matrix3).fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=(new THREE.Matrix3).fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);const r=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=new THREE.Scene,a=new THREE.StereoCamera,o={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},s=new THREE.WebGLRenderTarget(t,n,o),l=new THREE.WebGLRenderTarget(t,n,o),c=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:s.texture},mapRight:{value:l.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),u=new THREE.Mesh(new THREE.PlaneGeometry(2,2),c);i.add(u),this.setSize=function(t,n){e.setSize(t,n);const r=e.getPixelRatio();s.setSize(t*r,n*r),l.setSize(t*r,n*r)},this.render=function(t,n){const o=e.getRenderTarget();t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),a.update(n),e.setRenderTarget(s),e.clear(),e.render(t,a.cameraL),e.setRenderTarget(l),e.clear(),e.render(t,a.cameraR),e.setRenderTarget(null),e.render(i,r),e.setRenderTarget(o)},this.dispose=function(){s&&s.dispose(),l&&l.dispose(),u&&u.geometry.dispose(),c&&c.dispose()}}}},385:()=>{!function(){const e={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\n\t\t\tfloat lum = dot( lumCoeff, base.rgb );\n\t\t\tvec3 blend = vec3( lum );\n\n\t\t\tfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\n\n\t\t\tvec3 result1 = 2.0 * base.rgb * blend;\n\t\t\tvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\n\n\t\t\tvec3 newColor = mix( result1, result2, L );\n\n\t\t\tfloat A2 = opacity * base.a;\n\t\t\tvec3 mixRGB = A2 * newColor.rgb;\n\t\t\tmixRGB += ( ( 1.0 - A2 ) * base.rgb );\n\n\t\t\tgl_FragColor = vec4( mixRGB, base.a );\n\n\t\t}"};THREE.BleachBypassShader=e}()},5:()=>{class e extends THREE.Pass{constructor(e,t,n){super();var r=n.width||window.innerWidth||1,i=n.height||window.innerHeight||1,a=n.vignetting||0;this.scene=e,this.camera=t,this.mouse=new THREE.Vector2,this.width=r,this.height=i;var o=THREE.BokehDepthShader,s=THREE.UniformsUtils.clone(o.uniforms);this.materialDepth=new THREE.ShaderMaterial({uniforms:s,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),s.mNear.value=t.near,s.mFar.value=t.far,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(r/-2,r/2,i/2,i/-2,-1e4,1e4),this.camera2.position.z=100,this.scene2.add(this.camera2);var l={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureDepth=new THREE.WebGLRenderTarget(r,i,l),this.rtTextureColor=new THREE.WebGLRenderTarget(r,i,l);var c=3,u=4,h=THREE.BokehShader,d=THREE.UniformsUtils.clone(h.uniforms);d.textureWidth.value=r,d.textureHeight.value=i,d.shaderFocus.value=1,d.vignetting.value=a,this.materialBokeh=new THREE.ShaderMaterial({uniforms:d,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{RINGS:c,SAMPLES:u}}),this.materialBokeh.uniforms.tColor.value=this.rtTextureColor.texture,this.materialBokeh.uniforms.tDepth.value=this.rtTextureDepth.texture;var f=new THREE.Mesh(new THREE.PlaneBufferGeometry(r,i),this.materialBokeh);f.position.z=-500,this.scene2.add(f)}render(e,t,n,r,i){var a=this.scene,o=this.camera,s=this.materialBokeh.uniforms,l=this.materialDepth.uniforms,c=.5,u=.5;c=.5*this.mouse.x+.5,u=.5*this.mouse.y+.5,s.focusCoords.value.set(c,u),s.znear.value=o.near,s.zfar.value=o.far,l.mNear.value=o.near,l.mFar.value=o.far,e.setRenderTarget(this.rtTextureColor),e.clear(),e.render(a,o),a.overrideMaterial=this.materialDepth,e.setRenderTarget(this.rtTextureDepth),e.clear(),e.render(a,o),a.overrideMaterial=null,this.renderToScreen||(e.setRenderTarget(t),this.clear&&e.clear()),e.render(this.scene2,this.camera2)}}e.prototype.isBokehPass=!0,THREE.BokehPass=e},159:()=>{!function(){const e={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:1},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new THREE.Vector2}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tColor;\n\t\tuniform sampler2D tDepth;\n\t\tuniform float textureWidth;\n\t\tuniform float textureHeight;\n\n\t\tuniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below\n\t\tuniform float focalLength; //focal length in mm\n\t\tuniform float fstop; //f-stop value\n\t\tuniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)\n\n\t\t/*\n\t\tmake sure that these two values are the same for your camera, otherwise distances will be wrong.\n\t\t*/\n\n\t\tuniform float znear; // camera clipping start\n\t\tuniform float zfar; // camera clipping end\n\n\t\t//------------------------------------------\n\t\t//user variables\n\n\t\tconst int samples = SAMPLES; //samples on the first ring\n\t\tconst int rings = RINGS; //ring count\n\n\t\tconst int maxringsamples = rings * samples;\n\n\t\tuniform bool manualdof; // manual dof calculation\n\t\tfloat ndofstart = 1.0; // near dof blur start\n\t\tfloat ndofdist = 2.0; // near dof blur falloff distance\n\t\tfloat fdofstart = 1.0; // far dof blur start\n\t\tfloat fdofdist = 3.0; // far dof blur falloff distance\n\n\t\tfloat CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)\n\n\t\tuniform bool vignetting; // use optical lens vignetting\n\n\t\tfloat vignout = 1.3; // vignetting outer border\n\t\tfloat vignin = 0.0; // vignetting inner border\n\t\tfloat vignfade = 22.0; // f-stops till vignete fades\n\n\t\tuniform bool shaderFocus;\n\t\t// disable if you use external focalDepth value\n\n\t\tuniform vec2 focusCoords;\n\t\t// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)\n\t\t// if center of screen use vec2(0.5, 0.5);\n\n\t\tuniform float maxblur;\n\t\t//clamp value of max blur (0.0 = no blur, 1.0 default)\n\n\t\tuniform float threshold; // highlight threshold;\n\t\tuniform float gain; // highlight gain;\n\n\t\tuniform float bias; // bokeh edge bias\n\t\tuniform float fringe; // bokeh chromatic aberration / fringing\n\n\t\tuniform bool noise; //use noise instead of pattern for sample dithering\n\n\t\tuniform float dithering;\n\n\t\tuniform bool depthblur; // blur the depth buffer\n\t\tfloat dbsize = 1.25; // depth blur size\n\n\t\t/*\n\t\tnext part is experimental\n\t\tnot looking good with small sample and ring count\n\t\tlooks okay starting from samples = 4, rings = 4\n\t\t*/\n\n\t\tuniform bool pentagon; //use pentagon as bokeh shape?\n\t\tfloat feather = 0.4; //pentagon shape feather\n\n\t\t//------------------------------------------\n\n\t\tfloat penta(vec2 coords) {\n\t\t\t//pentagonal shape\n\t\t\tfloat scale = float(rings) - 1.3;\n\t\t\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);\n\t\t\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);\n\t\t\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);\n\t\t\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);\n\t\t\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);\n\t\t\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);\n\n\t\t\tvec4  one = vec4( 1.0 );\n\n\t\t\tvec4 P = vec4((coords),vec2(scale, scale));\n\n\t\t\tvec4 dist = vec4(0.0);\n\t\t\tfloat inorout = -4.0;\n\n\t\t\tdist.x = dot( P, HS0 );\n\t\t\tdist.y = dot( P, HS1 );\n\t\t\tdist.z = dot( P, HS2 );\n\t\t\tdist.w = dot( P, HS3 );\n\n\t\t\tdist = smoothstep( -feather, feather, dist );\n\n\t\t\tinorout += dot( dist, one );\n\n\t\t\tdist.x = dot( P, HS4 );\n\t\t\tdist.y = HS5.w - abs( P.z );\n\n\t\t\tdist = smoothstep( -feather, feather, dist );\n\t\t\tinorout += dist.x;\n\n\t\t\treturn clamp( inorout, 0.0, 1.0 );\n\t\t}\n\n\t\tfloat bdepth(vec2 coords) {\n\t\t\t// Depth buffer blur\n\t\t\tfloat d = 0.0;\n\t\t\tfloat kernel[9];\n\t\t\tvec2 offset[9];\n\n\t\t\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;\n\n\t\t\toffset[0] = vec2(-wh.x,-wh.y);\n\t\t\toffset[1] = vec2( 0.0, -wh.y);\n\t\t\toffset[2] = vec2( wh.x -wh.y);\n\n\t\t\toffset[3] = vec2(-wh.x,  0.0);\n\t\t\toffset[4] = vec2( 0.0,   0.0);\n\t\t\toffset[5] = vec2( wh.x,  0.0);\n\n\t\t\toffset[6] = vec2(-wh.x, wh.y);\n\t\t\toffset[7] = vec2( 0.0,  wh.y);\n\t\t\toffset[8] = vec2( wh.x, wh.y);\n\n\t\t\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;\n\t\t\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;\n\t\t\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;\n\n\n\t\t\tfor( int i=0; i<9; i++ ) {\n\t\t\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;\n\t\t\t\td += tmp * kernel[i];\n\t\t\t}\n\n\t\t\treturn d;\n\t\t}\n\n\n\t\tvec3 color(vec2 coords,float blur) {\n\t\t\t//processing the sample\n\n\t\t\tvec3 col = vec3(0.0);\n\t\t\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);\n\n\t\t\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;\n\t\t\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;\n\t\t\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;\n\n\t\t\tvec3 lumcoeff = vec3(0.299,0.587,0.114);\n\t\t\tfloat lum = dot(col.rgb, lumcoeff);\n\t\t\tfloat thresh = max((lum-threshold)*gain, 0.0);\n\t\t\treturn col+mix(vec3(0.0),col,thresh*blur);\n\t\t}\n\n\t\tvec3 debugFocus(vec3 col, float blur, float depth) {\n\t\t\tfloat edge = 0.002*depth; //distance based edge smoothing\n\t\t\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);\n\t\t\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);\n\n\t\t\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);\n\t\t\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);\n\n\t\t\treturn col;\n\t\t}\n\n\t\tfloat linearize(float depth) {\n\t\t\treturn -zfar * znear / (depth * (zfar - znear) - zfar);\n\t\t}\n\n\t\tfloat vignette() {\n\t\t\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));\n\t\t\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);\n\t\t\treturn clamp(dist,0.0,1.0);\n\t\t}\n\n\t\tfloat gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n\t\t\tfloat rings2 = float(rings);\n\t\t\tfloat step = PI*2.0 / float(ringsamples);\n\t\t\tfloat pw = cos(j*step)*i;\n\t\t\tfloat ph = sin(j*step)*i;\n\t\t\tfloat p = 1.0;\n\t\t\tif (pentagon) {\n\t\t\t\tp = penta(vec2(pw,ph));\n\t\t\t}\n\t\t\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;\n\t\t\treturn 1.0 * mix(1.0, i /rings2, bias) * p;\n\t\t}\n\n\t\tvoid main() {\n\t\t\t//scene depth calculation\n\n\t\t\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);\n\n\t\t\t// Blur depth?\n\t\t\tif ( depthblur ) {\n\t\t\t\tdepth = linearize(bdepth(vUv.xy));\n\t\t\t}\n\n\t\t\t//focal plane calculation\n\n\t\t\tfloat fDepth = focalDepth;\n\n\t\t\tif (shaderFocus) {\n\n\t\t\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);\n\n\t\t\t}\n\n\t\t\t// dof blur factor calculation\n\n\t\t\tfloat blur = 0.0;\n\n\t\t\tif (manualdof) {\n\t\t\t\tfloat a = depth-fDepth; // Focal plane\n\t\t\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF\n\t\t\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof\n\t\t\t\tblur = (a>0.0) ? b : c;\n\t\t\t} else {\n\t\t\t\tfloat f = focalLength; // focal length in mm\n\t\t\t\tfloat d = fDepth*1000.0; // focal plane in mm\n\t\t\t\tfloat o = depth*1000.0; // depth in mm\n\n\t\t\t\tfloat a = (o*f)/(o-f);\n\t\t\t\tfloat b = (d*f)/(d-f);\n\t\t\t\tfloat c = (d-f)/(d*fstop*CoC);\n\n\t\t\t\tblur = abs(a-b)*c;\n\t\t\t}\n\n\t\t\tblur = clamp(blur,0.0,1.0);\n\n\t\t\t// calculation of pattern for dithering\n\n\t\t\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;\n\n\t\t\t// getting blur x and y step factor\n\n\t\t\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;\n\t\t\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;\n\n\t\t\t// calculation of final color\n\n\t\t\tvec3 col = vec3(0.0);\n\n\t\t\tif(blur < 0.05) {\n\t\t\t\t//some optimization thingy\n\t\t\t\tcol = texture2D(tColor, vUv.xy).rgb;\n\t\t\t} else {\n\t\t\t\tcol = texture2D(tColor, vUv.xy).rgb;\n\t\t\t\tfloat s = 1.0;\n\t\t\t\tint ringsamples;\n\n\t\t\t\tfor (int i = 1; i <= rings; i++) {\n\t\t\t\t\t/*unboxstart*/\n\t\t\t\t\tringsamples = i * samples;\n\n\t\t\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {\n\t\t\t\t\t\tif (j >= ringsamples) break;\n\t\t\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);\n\t\t\t\t\t}\n\t\t\t\t\t/*unboxend*/\n\t\t\t\t}\n\n\t\t\t\tcol /= s; //divide by sample count\n\t\t\t}\n\n\t\t\tif (showFocus) {\n\t\t\t\tcol = debugFocus(col, blur, depth);\n\t\t\t}\n\n\t\t\tif (vignetting) {\n\t\t\t\tcol *= vignette();\n\t\t\t}\n\n\t\t\tgl_FragColor.rgb = col;\n\t\t\tgl_FragColor.a = 1.0;\n\t\t}"},t={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:"\n\n\t\tvarying float vViewZDepth;\n\n\t\tvoid main() {\n\n\t\t\t#include <begin_vertex>\n\t\t\t#include <project_vertex>\n\n\t\t\tvViewZDepth = - mvPosition.z;\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float mNear;\n\t\tuniform float mFar;\n\n\t\tvarying float vViewZDepth;\n\n\t\tvoid main() {\n\n\t\t\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );\n\t\t\tgl_FragColor = vec4( vec3( color ), 1.0 );\n\n\t\t}"};THREE.BokehDepthShader=t,THREE.BokehShader=e}()},3675:()=>{THREE.BufferGeometryUtils=class{static computeTangents(e){e.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use THREE.BufferGeometry.computeTangents() instead.")}static mergeBufferGeometries(e,t=!1){const n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,l=new THREE.BufferGeometry;let c=0;for(let u=0;u<e.length;++u){const h=e[u];let d=0;if(n!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in h.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(h.attributes[e]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(s!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in h.morphAttributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[e]&&(o[e]=[]),o[e].push(h.morphAttributes[e])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(h.userData),t){let e;if(n)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}l.addGroup(c,e,u),c+=e}}if(n){let t=0;const n=[];for(let r=0;r<e.length;++r){const i=e[r].index;for(let e=0;e<i.count;++e)n.push(i.getX(e)+t);t+=e[r].attributes.position.count}l.setIndex(n)}for(const e in a){const t=this.mergeBufferAttributes(a[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;l.setAttribute(e,t)}for(const e in o){const t=o[e][0].length;if(0===t)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[e]=[];for(let n=0;n<t;++n){const t=[];for(let r=0;r<o[e].length;++r)t.push(o[e][r][n]);const r=this.mergeBufferAttributes(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;l.morphAttributes[e].push(r)}}return l}static mergeBufferAttributes(e){let t,n,r,i=0;for(let a=0;a<e.length;++a){const o=e[a];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.normalized must be consistent across matching attributes."),null;i+=o.array.length}const a=new t(i);let o=0;for(let t=0;t<e.length;++t)a.set(e[t].array,o),o+=e[t].array.length;return new THREE.BufferAttribute(a,n,r)}static interleaveAttributes(e){let t,n=0,r=0;for(let i=0,a=e.length;i<a;++i){const a=e[i];if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=a.array.length,r+=a.itemSize}const i=new THREE.InterleavedBuffer(new t(n),r);let a=0;const o=[],s=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.itemSize,c=n.count,u=new THREE.InterleavedBufferAttribute(i,r,a,n.normalized);o.push(u),a+=r;for(let e=0;e<c;e++)for(let t=0;t<r;t++)u[l[t]](e,n[s[t]](e))}return o}static estimateBytesUsed(e){let t=0;for(const n in e.attributes){const r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}static mergeVertices(e,t=1e-4){t=Math.max(t,Number.EPSILON);const n={},r=e.getIndex(),i=e.getAttribute("position"),a=r?r.count:i.count;let o=0;const s=Object.keys(e.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"];for(let t=0,n=s.length;t<n;t++){const n=s[t];l[n]=[];const r=e.morphAttributes[n];r&&(c[n]=new Array(r.length).fill().map((()=>[])))}const d=Math.log10(1/t),f=Math.pow(10,d);for(let t=0;t<a;t++){const i=r?r.getX(t):t;let a="";for(let t=0,n=s.length;t<n;t++){const n=s[t],r=e.getAttribute(n),o=r.itemSize;for(let e=0;e<o;e++)a+=~~(r[h[e]](i)*f)+","}if(a in n)u.push(n[a]);else{for(let t=0,n=s.length;t<n;t++){const n=s[t],r=e.getAttribute(n),a=e.morphAttributes[n],o=r.itemSize,u=l[n],d=c[n];for(let e=0;e<o;e++){const t=h[e];if(u.push(r[t](i)),a)for(let e=0,n=a.length;e<n;e++)d[e].push(a[e][t](i))}}n[a]=o,u.push(o),o++}}const p=e.clone();for(let t=0,n=s.length;t<n;t++){const n=s[t],r=e.getAttribute(n),i=new r.array.constructor(l[n]),a=new THREE.BufferAttribute(i,r.itemSize,r.normalized);if(p.setAttribute(n,a),n in c)for(let t=0;t<c[n].length;t++){const r=e.morphAttributes[n][t],i=new r.array.constructor(c[n][t]),a=new THREE.BufferAttribute(i,r.itemSize,r.normalized);p.morphAttributes[n][t]=a}}return p.setIndex(u),p}static toTrianglesDrawMode(e,t){if(t===THREE.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===THREE.TriangleFanDrawMode||t===THREE.TriangleStripDrawMode){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(t===THREE.TriangleFanDrawMode)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(i),a.clearGroups(),a}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}static computeMorphedAttributes(e){if(!0!==e.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type THREE.BufferGeometry."),null;const t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;function u(e,u,h,d,f,p,m,g,v){t.fromBufferAttribute(h,p),n.fromBufferAttribute(h,m),r.fromBufferAttribute(h,g);const y=e.morphTargetInfluences;if(u.morphTargets&&d&&y){s.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(let e=0,u=d.length;e<u;e++){const u=y[e],h=d[e];0!==u&&(i.fromBufferAttribute(h,p),a.fromBufferAttribute(h,m),o.fromBufferAttribute(h,g),f?(s.addScaledVector(i,u),l.addScaledVector(a,u),c.addScaledVector(o,u)):(s.addScaledVector(i.sub(t),u),l.addScaledVector(a.sub(n),u),c.addScaledVector(o.sub(r),u)))}t.add(s),n.add(l),r.add(c)}e.isSkinnedMesh&&(e.boneTransform(p,t),e.boneTransform(m,n),e.boneTransform(g,r)),v[3*p+0]=t.x,v[3*p+1]=t.y,v[3*p+2]=t.z,v[3*m+0]=n.x,v[3*m+1]=n.y,v[3*m+2]=n.z,v[3*g+0]=r.x,v[3*g+1]=r.y,v[3*g+2]=r.z}const h=e.geometry,d=e.material;let f,p,m;const g=h.index,v=h.attributes.position,y=h.morphAttributes.position,_=h.morphTargetsRelative,b=h.attributes.normal,E=h.morphAttributes.position,w=h.groups,x=h.drawRange;let T,A,M,S,R,k,P,L;const C=new Float32Array(v.count*v.itemSize),I=new Float32Array(b.count*b.itemSize);if(null!==g)if(Array.isArray(d))for(T=0,M=w.length;T<M;T++)for(R=w[T],k=d[R.materialIndex],P=Math.max(R.start,x.start),L=Math.min(R.start+R.count,x.start+x.count),A=P,S=L;A<S;A+=3)f=g.getX(A),p=g.getX(A+1),m=g.getX(A+2),u(e,k,v,y,_,f,p,m,C),u(e,k,b,E,_,f,p,m,I);else for(P=Math.max(0,x.start),L=Math.min(g.count,x.start+x.count),T=P,M=L;T<M;T+=3)f=g.getX(T),p=g.getX(T+1),m=g.getX(T+2),u(e,d,v,y,_,f,p,m,C),u(e,d,b,E,_,f,p,m,I);else if(void 0!==v)if(Array.isArray(d))for(T=0,M=w.length;T<M;T++)for(R=w[T],k=d[R.materialIndex],P=Math.max(R.start,x.start),L=Math.min(R.start+R.count,x.start+x.count),A=P,S=L;A<S;A+=3)f=A,p=A+1,m=A+2,u(e,k,v,y,_,f,p,m,C),u(e,k,b,E,_,f,p,m,I);else for(P=Math.max(0,x.start),L=Math.min(v.count,x.start+x.count),T=P,M=L;T<M;T+=3)f=T,p=T+1,m=T+2,u(e,d,v,y,_,f,p,m,C),u(e,d,b,E,_,f,p,m,I);return{positionAttribute:v,normalAttribute:b,morphedPositionAttribute:new THREE.Float32BufferAttribute(C,3),morphedNormalAttribute:new THREE.Float32BufferAttribute(I,3)}}}},3138:()=>{THREE.ColladaExporter=class{parse(e,t,n={}){""!==(n=Object.assign({version:"1.4.1",author:null,textureDirectory:""},n)).textureDirectory&&(n.textureDirectory=`${n.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/"));const r=n.version;if("1.4.1"!==r&&"1.5.0"!==r)return console.warn(`ColladaExporter : Version ${r} not supported for export. Only 1.4.1 and 1.5.0.`),null;let i,a;function o(e,t){return i=i||document.createElement("canvas"),a=a||i.getContext("2d"),i.width=e.width,i.height=e.height,a.drawImage(e,0,0),function(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0,r=n.length;e<r;e++)n[e]=t.charCodeAt(e);return n}(i.toDataURL(`image/${t}`,1).replace(/^data:image\/(png|jpg);base64,/,""))}const s=["getX","getY","getZ","getW"];function l(e){if(e.isInterleavedBufferAttribute){const t=new e.array.constructor(e.count*e.itemSize),n=e.itemSize;for(let r=0,i=e.count;r<i;r++)for(let i=0;i<n;i++)t[r*n+i]=e[s[i]](r);return t}return e.array}function c(e,t,n,r){const i=l(e);return`<source id="${t}"><float_array id="${t}-array" count="${i.length}">`+i.join(" ")+"</float_array><technique_common>"+`<accessor source="#${t}-array" count="${Math.floor(i.length/e.itemSize)}" stride="${e.itemSize}">`+n.map((e=>`<param name="${e}" type="${r}" />`)).join("")+"</accessor></technique_common></source>"}let u;function h(e){let t=p.get(e);if(null==t){t=`image-${g.length+1}`;const i="png",a=e.name||t;let s=`<image id="${t}" name="${a}">`;s+="1.5.0"===r?`<init_from><ref>${n.textureDirectory}${a}.${i}</ref></init_from>`:`<init_from>${n.textureDirectory}${a}.${i}</init_from>`,s+="</image>",g.push(s),p.set(e,t),m.push({directory:n.textureDirectory,name:a,ext:i,data:o(e.image,i),original:e})}return t}const d=new WeakMap,f=new WeakMap,p=new WeakMap,m=[],g=[],v=[],y=[],_=[],b=function e(t){let n=`<node name="${t.name}">`;if(n+=function(e){return e.updateMatrix(),u=u||new THREE.Matrix4,u.copy(e.matrix),u.transpose(),`<matrix>${u.toArray().join(" ")}</matrix>`}(t),!0===t.isMesh&&null!==t.geometry){const e=function(e){let t=d.get(e);if(!t){const a=e;if(!0!==a.isBufferGeometry)throw new Error("THREE.ColladaExporter: Geometry is not of type THREE.BufferGeometry.");const o=`Mesh${v.length+1}`,s=a.index?a.index.count*a.index.itemSize:a.attributes.position.count,u=null!=a.groups&&0!==a.groups.length?a.groups:[{start:0,count:s,materialIndex:0}];let h=`<geometry id="${o}"${e.name?` name="${e.name}"`:""}><mesh>`;const f=`${o}-position`,p=`${o}-vertices`;h+=c(a.attributes.position,f,["X","Y","Z"],"float"),h+=`<vertices id="${p}"><input semantic="POSITION" source="#${f}" /></vertices>`;let m=`<input semantic="VERTEX" source="#${p}" offset="0" />`;if("normal"in a.attributes){const e=`${o}-normal`;h+=c(a.attributes.normal,e,["X","Y","Z"],"float"),m+=`<input semantic="NORMAL" source="#${e}" offset="0" />`}if("uv"in a.attributes){const e=`${o}-texcoord`;h+=c(a.attributes.uv,e,["S","T"],"float"),m+=`<input semantic="TEXCOORD" source="#${e}" offset="0" set="0" />`}if("uv2"in a.attributes){const e=`${o}-texcoord2`;h+=c(a.attributes.uv2,e,["S","T"],"float"),m+=`<input semantic="TEXCOORD" source="#${e}" offset="0" set="1" />`}if("color"in a.attributes){const e=`${o}-color`;h+=c(a.attributes.color,e,["X","Y","Z"],"uint8"),m+=`<input semantic="COLOR" source="#${e}" offset="0" />`}let g=null;if(a.index)g=l(a.index);else{g=new Array(s);for(let e=0,t=g.length;e<t;e++)g[e]=e}for(let e=0,t=u.length;e<t;e++){const t=u[e],a=(n=g,r=t.start,i=t.count,Array.isArray(n)?n.slice(r,r+i):new n.constructor(n.buffer,r*n.BYTES_PER_ELEMENT,i)),o=a.length/3;h+=`<triangles material="MESH_MATERIAL_${t.materialIndex}" count="${o}">`,h+=m,h+=`<p>${a.join(" ")}</p>`,h+="</triangles>"}h+="</mesh></geometry>",v.push(h),t={meshid:o,bufferGeometry:a},d.set(e,t)}var n,r,i;return t}(t.geometry),r=e.meshid,i=e.bufferGeometry;let a,o=null;const s=t.material||new THREE.MeshBasicMaterial,u=Array.isArray(s)?s:[s];a=i.groups.length>u.length?new Array(i.groups.length):new Array(u.length),o=a.fill().map(((e,t)=>function(e){let t=f.get(e);if(null==t){t=`Mat${y.length+1}`;let n="phong";!0===e.isMeshLambertMaterial?n="lambert":!0===e.isMeshBasicMaterial&&(n="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with THREE.MeshBasicMaterial."));const r=e.emissive?e.emissive:new THREE.Color(0,0,0),i=e.color?e.color:new THREE.Color(0,0,0),a=e.specular?e.specular:new THREE.Color(1,1,1),o=e.shininess||0,s=e.reflectivity||0;let l="";!0===e.transparent&&(l+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(l+=`<transparency><float>${e.opacity}</float></transparency>`));const c=`<technique sid="common"><${n}><emission>`+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${r.r} ${r.g} ${r.b} 1</color>`)+"</emission>"+("constant"!==n?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${i.r} ${i.g} ${i.b} 1</color>`)+"</diffuse>":"")+("constant"!==n?"<bump>"+(e.normalMap?'<texture texture="bump-sampler" texcoord="TEXCOORD" />':"")+"</bump>":"")+("phong"===n?`<specular><color sid="specular">${a.r} ${a.g} ${a.b} 1</color></specular><shininess>`+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${o}</float>`)+"</shininess>":"")+`<reflective><color>${i.r} ${i.g} ${i.b} 1</color></reflective>`+`<reflectivity><float>${s}</float></reflectivity>`+l+`</${n}></technique>`,u=`<effect id="${t}-effect"><profile_COMMON>`+(e.map?`<newparam sid="diffuse-surface"><surface type="2D"><init_from>${h(e.map)}</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>`:"")+(e.specularMap?`<newparam sid="specular-surface"><surface type="2D"><init_from>${h(e.specularMap)}</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>`:"")+(e.emissiveMap?`<newparam sid="emissive-surface"><surface type="2D"><init_from>${h(e.emissiveMap)}</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>`:"")+(e.normalMap?`<newparam sid="bump-surface"><surface type="2D"><init_from>${h(e.normalMap)}</init_from></surface></newparam><newparam sid="bump-sampler"><sampler2D><source>bump-surface</source></sampler2D></newparam>`:"")+c+(e.side===THREE.DoubleSide?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>",d=`<material id="${t}"${e.name?` name="${e.name}"`:""}><instance_effect url="#${t}-effect" /></material>`;_.push(d),y.push(u),f.set(e,t)}return t}(u[t%u.length]))),n+=`<instance_geometry url="#${r}">`+(null!=o?"<bind_material><technique_common>"+o.map(((e,t)=>`<instance_material symbol="MESH_MATERIAL_${t}" target="#${e}" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>`)).join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach((t=>n+=e(t))),n+="</node>",n}(e);let E=`<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="${"1.4.1"===r?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${r}"><asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>`+(null!==n.author?`<author>${n.author}</author>`:"")+"</contributor>"+`<created>${(new Date).toISOString()}</created>`+`<modified>${(new Date).toISOString()}</modified><up_axis>Y_UP</up_axis></asset>`;E+=`<library_images>${g.join("")}</library_images>`,E+=`<library_effects>${y.join("")}</library_effects>`,E+=`<library_materials>${_.join("")}</library_materials>`,E+=`<library_geometries>${v.join("")}</library_geometries>`,E+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${b}</visual_scene></library_visual_scenes>`,E+='<scene><instance_visual_scene url="#Scene"/></scene>',E+="</COLLADA>";const w={data:function(e){const t=/^<\//,n=/(\?>$)|(\/>$)/,r=/<[^>]+>[^<]*<\/[^<]+>/,i=(e,t)=>t>0?e+i(e,t-1):"";let a=0;return e.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map((e=>{r.test(e)||n.test(e)||!t.test(e)||a--;const o=`${i("  ",a)}${e}`;return r.test(e)||n.test(e)||t.test(e)||a++,o})).join("\n")}(E),textures:m};return"function"==typeof t&&requestAnimationFrame((()=>t(w))),w}}},1088:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e,t){function n(e,t){const n=[],r=e.childNodes;for(let e=0,i=r.length;e<i;e++){const i=r[e];i.nodeName===t&&n.push(i)}return n}function r(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,r=t.length;e<r;e++)n[e]=t[e];return n}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,r=t.length;e<r;e++)n[e]=parseFloat(t[e]);return n}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,r=t.length;e<r;e++)n[e]=parseInt(t[e]);return n}function o(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,r,i){const a=n(e,t)[0];if(void 0!==a){const e=n(a,r);for(let t=0;t<e.length;t++)i(e[t])}}function h(e,t){for(const n in e){e[n].build=t(e[n])}}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){const t={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const e=o(r.getAttribute("source")),n=r.getAttribute("semantic");t.inputs[n]=e}}return t}function p(e){const t={};let n=e.getAttribute("target").split("/");const r=n.shift();let i=n.shift();const a=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)n=i.split("."),i=n.shift(),t.member=n.shift();else if(a){const e=i.split("(");i=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=r,t.sid=i,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}function m(e){const t=[],n=e.channels,r=e.samplers,i=e.sources;for(const e in n)if(n.hasOwnProperty(e)){const a=n[e],o=r[a.sampler],s=o.inputs.INPUT,l=o.inputs.OUTPUT;E(v(a,i[s],i[l]),t)}return t}function g(e){return d(Ye.animations[e],m)}function v(e,t,n){const r=Ye.nodes[e.id],i=Fe(r.id),a=r.transforms[e.sid],o=r.matrix.clone().transpose();let s,l,c,u,h,d;const f={};switch(a){case"matrix":for(c=0,u=t.array.length;c<u;c++)if(s=t.array[c],l=c*n.stride,void 0===f[s]&&(f[s]={}),!0===e.arraySyntax){const t=n.array[l],r=e.indices[0]+4*e.indices[1];f[s][r]=t}else for(h=0,d=n.stride;h<d;h++)f[s][h]=n.array[l+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',a)}const p=function(e,t){const n=[];for(const t in e)n.push({time:parseFloat(t),value:e[t]});n.sort(r);for(let e=0;e<16;e++)w(n,e,t.elements[e]);return n;function r(e,t){return e.time-t.time}}(f,o);return{name:i.uuid,keyframes:p}}const y=new THREE.Vector3,_=new THREE.Vector3,b=new THREE.Quaternion;function E(e,t){const n=e.keyframes,r=e.name,i=[],a=[],o=[],s=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],r=t.time,l=t.value;Te.fromArray(l).transpose(),Te.decompose(y,b,_),i.push(r),a.push(y.x,y.y,y.z),o.push(b.x,b.y,b.z,b.w),s.push(_.x,_.y,_.z)}return a.length>0&&t.push(new THREE.VectorKeyframeTrack(r+".position",i,a)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(r+".quaternion",i,o)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(r+".scale",i,s)),t}function w(e,t,n){let r,i,a,o=!0;for(i=0,a=e.length;i<a;i++)r=e[i],void 0===r.value[t]?r.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)r=e[i],r.value[t]=n;else!function(e,t){let n,r;for(let i=0,a=e.length;i<a;i++){const a=e[i];if(null===a.value[t]){if(n=x(e,i,t),r=T(e,i,t),null===n){a.value[t]=r.value[t];continue}if(null===r){a.value[t]=n.value[t];continue}A(a,n,r,t)}}}(e,t)}function x(e,t,n){for(;t>=0;){const r=e[t];if(null!==r.value[n])return r;t--}return null}function T(e,t,n){for(;t<e.length;){const r=e[t];if(null!==r.value[n])return r;t++}return null}function A(e,t,n,r){n.time-t.time!=0?e.value[r]=(e.time-t.time)*(n.value[r]-t.value[r])/(n.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function M(e){const t=[],n=e.name,r=e.end-e.start||-1,i=e.animations;for(let e=0,n=i.length;e<n;e++){const n=g(i[e]);for(let e=0,r=n.length;e<r;e++)t.push(n[e])}return new THREE.AnimationClip(n,r,t)}function S(e){return d(Ye.clips[e],M)}function R(e){const t={sources:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(r.textContent);break;case"source":const e=r.getAttribute("id");t.sources[e]=ie(r);break;case"joints":t.joints=k(r);break;case"vertex_weights":t.vertexWeights=P(r)}}return t}function k(e){const t={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const e=r.getAttribute("semantic"),n=o(r.getAttribute("source"));t.inputs[e]=n}}return t}function P(e){const t={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const e=r.getAttribute("semantic"),n=o(r.getAttribute("source")),i=parseInt(r.getAttribute("offset"));t.inputs[e]={id:n,offset:i};break;case"vcount":t.vcount=a(r.textContent);break;case"v":t.v=a(r.textContent)}}return t}function L(e){const t={id:e.id},n=Ye.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){const t=4,n={joints:[],indices:{array:[],stride:t},weights:{array:[],stride:t}},r=e.sources,i=e.vertexWeights,a=i.vcount,o=i.v,s=i.inputs.JOINT.offset,l=i.inputs.WEIGHT.offset,c=e.sources[e.joints.inputs.JOINT],u=e.sources[e.joints.inputs.INV_BIND_MATRIX],h=r[i.inputs.WEIGHT.id].array;let d,f,p,m=0;for(d=0,p=a.length;d<p;d++){const e=a[d],r=[];for(f=0;f<e;f++){const e=o[m+s],t=h[o[m+l]];r.push({index:e,weight:t}),m+=2}for(r.sort(g),f=0;f<t;f++){const e=r[f];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}e.bindShapeMatrix?n.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():n.bindMatrix=(new THREE.Matrix4).identity();for(d=0,p=c.array.length;d<p;d++){const e=c.array[d],t=(new THREE.Matrix4).fromArray(u.array,d*u.stride).transpose();n.joints.push({name:e,boneInverse:t})}return n;function g(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function C(e){return void 0!==e.build?e.build:e.init_from}function I(e){const t=Ye.images[e];return void 0!==t?d(t,C):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function N(e){const t={surfaces:{},samplers:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"newparam":F(r,t);break;case"technique":t.technique=D(r);break;case"extra":t.extra=G(r)}}return t}function F(e,t){const n=e.getAttribute("sid");for(let r=0,i=e.childNodes.length;r<i;r++){const i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[n]=O(i);break;case"sampler2D":t.samplers[n]=H(i)}}}function O(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"init_from":t.init_from=r.textContent}}return t}function H(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"source":t.source=r.textContent}}return t}function D(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=r.nodeName,t.parameters=U(r)}}return t}function U(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[r.nodeName]=B(r);break;case"transparent":t[r.nodeName]={opaque:r.getAttribute("opaque"),data:B(r)}}}return t}function B(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"color":t[r.nodeName]=i(r.textContent);break;case"float":t[r.nodeName]=parseFloat(r.textContent);break;case"texture":t[r.nodeName]={id:r.getAttribute("texture"),extra:z(r)}}}return t}function z(e){const t={technique:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"extra":V(r,t)}}return t}function V(e,t){for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique":j(r,t)}}}function j(e,t){for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=0:t.technique[r.nodeName]=parseInt(r.textContent)}}}function G(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique":t.technique=W(r)}}return t}function W(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"double_sided":t[r.nodeName]=parseInt(r.textContent)}}return t}function q(e){return e}function X(e){const t=(n=e.url,d(Ye.effects[n],q));var n;const r=t.profile.technique,i=t.profile.extra;let a;switch(r.type){case"phong":case"blinn":a=new THREE.MeshPhongMaterial;break;case"lambert":a=new THREE.MeshLambertMaterial;break;default:a=new THREE.MeshBasicMaterial}function o(e){const n=t.profile.samplers[e.id];let r=null;if(void 0!==n){r=I(t.profile.surfaces[n.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=I(e.id);if(null!==r){const t=function(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(n=n.toLowerCase(),n){case"tga":t=Ge;break;default:t=je}return t}(r);if(void 0!==t){const n=t.load(r),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===s(i.technique)){const e=i.technique;n.wrapS=e.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=e.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.offset.set(e.offsetU||0,e.offsetV||0),n.repeat.set(e.repeatU||1,e.repeatV||1)}else n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping;return n}return console.warn("THREE.ColladaLoader: THREE.Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}a.name=e.name||"";const l=r.parameters;for(const e in l){const t=l[e];switch(e){case"diffuse":t.color&&a.color.fromArray(t.color),t.texture&&(a.map=o(t.texture));break;case"specular":t.color&&a.specular&&a.specular.fromArray(t.color),t.texture&&(a.specularMap=o(t.texture));break;case"bump":t.texture&&(a.normalMap=o(t.texture));break;case"ambient":t.texture&&(a.lightMap=o(t.texture));break;case"shininess":t.float&&a.shininess&&(a.shininess=t.float);break;case"emission":t.color&&a.emissive&&a.emissive.fromArray(t.color),t.texture&&(a.emissiveMap=o(t.texture))}}let c=l.transparent,u=l.transparency;if(void 0===u&&c&&(u={float:1}),void 0===c&&u&&(c={opaque:"A_ONE",data:{color:[1,1,1,1]}}),c&&u)if(c.data.texture)a.transparent=!0;else{const e=c.data.color;switch(c.opaque){case"A_ONE":a.opacity=e[3]*u.float;break;case"RGB_ZERO":a.opacity=1-e[0]*u.float;break;case"A_ZERO":a.opacity=1-e[3]*u.float;break;case"RGB_ONE":a.opacity=e[0]*u.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',c.opaque)}a.opacity<1&&(a.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(a.side=THREE.DoubleSide),a}function Y(e){return d(Ye.materials[e],X)}function K(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];switch(n.nodeName){case"technique_common":return Z(n)}}return{}}function Z(e){const t={};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=Q(r)}}return t}function Q(e){const t={};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function J(e){let t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,r=e.optics.parameters.xmag;const i=e.optics.parameters.aspect_ratio;r=void 0===r?n*i:r,n=void 0===n?r/i:n,r*=.5,n*=.5,t=new THREE.OrthographicCamera(-r,r,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name||"",t}function $(e){const t=Ye.cameras[e];return void 0!==t?d(t,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=r.nodeName,t.parameters=te(r)}}return t}function te(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"color":const e=i(r.textContent);t.color=(new THREE.Color).fromArray(e);break;case"falloff_angle":t.falloffAngle=parseFloat(r.textContent);break;case"quadratic_attenuation":const n=parseFloat(r.textContent);t.distance=n?Math.sqrt(1/n):0}}return t}function ne(e){let t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function re(e){const t=Ye.lights[e];return void 0!==t?d(t,ne):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){const t={array:[],stride:3};for(let a=0;a<e.childNodes.length;a++){const o=e.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=r(o.textContent);break;case"technique_common":const e=n(o,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function ae(e){const t={};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];1===r.nodeType&&(t[r.getAttribute("semantic")]=o(r.getAttribute("source")))}return t}function oe(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const e=o(r.getAttribute("source")),n=r.getAttribute("semantic"),i=parseInt(r.getAttribute("offset")),s=parseInt(r.getAttribute("set")),l=s>0?n+s:n;t.inputs[l]={id:e,offset:i},t.stride=Math.max(t.stride,i+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=a(r.textContent);break;case"p":t.p=a(r.textContent)}}return t}function se(e){let t=0;for(let n=0,r=e.length;n<r;n++){!0===e[n].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){const t={},n=e.sources,r=e.vertices,i=e.primitives;if(0===i.length)return{};const a=function(e){const t={};for(let n=0;n<e.length;n++){const r=e[n];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(i);for(const e in a){const i=a[e];se(i),t[e]=ce(i,n,r)}return t}function ce(e,t,n){const r={},i={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],u=4,h=[],d=4,f=new THREE.BufferGeometry,p=[];let m=0;for(let r=0;r<e.length;r++){const u=e[r],d=u.inputs;let g=0;switch(u.type){case"lines":case"linestrips":g=2*u.count;break;case"triangles":g=3*u.count;break;case"polylist":for(let e=0;e<u.count;e++){const t=u.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",u.type)}f.addGroup(m,g,r),m+=g,u.material&&p.push(u.material);for(const r in d){const f=d[r];switch(r){case"VERTEX":for(const r in n){const d=n[r];switch(r){case"POSITION":const n=i.array.length;if(ue(u,t[d],f.offset,i.array),i.stride=t[d].stride,t.skinWeights&&t.skinIndices&&(ue(u,t.skinIndices,f.offset,c),ue(u,t.skinWeights,f.offset,h)),!1===u.hasUV&&!0===e.uvsNeedsFix){const e=(i.array.length-n)/i.stride;for(let t=0;t<e;t++)o.array.push(0,0)}break;case"NORMAL":ue(u,t[d],f.offset,a.array),a.stride=t[d].stride;break;case"COLOR":ue(u,t[d],f.offset,l.array),l.stride=t[d].stride;break;case"TEXCOORD":ue(u,t[d],f.offset,o.array),o.stride=t[d].stride;break;case"TEXCOORD1":ue(u,t[d],f.offset,s.array),o.stride=t[d].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',r)}}break;case"NORMAL":ue(u,t[f.id],f.offset,a.array),a.stride=t[f.id].stride;break;case"COLOR":ue(u,t[f.id],f.offset,l.array),l.stride=t[f.id].stride;break;case"TEXCOORD":ue(u,t[f.id],f.offset,o.array),o.stride=t[f.id].stride;break;case"TEXCOORD1":ue(u,t[f.id],f.offset,s.array),s.stride=t[f.id].stride}}}return i.array.length>0&&f.setAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),a.array.length>0&&f.setAttribute("normal",new THREE.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&f.setAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),o.array.length>0&&f.setAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&f.setAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&f.setAttribute("skinIndex",new THREE.Float32BufferAttribute(c,u)),h.length>0&&f.setAttribute("skinWeight",new THREE.Float32BufferAttribute(h,d)),r.data=f,r.type=e[0].type,r.materialKeys=p,r}function ue(e,t,n,r){const i=e.p,a=e.stride,o=e.vcount;function s(e){let t=i[e+n]*c;const a=t+c;for(;t<a;t++)r.push(l[t])}const l=t.array,c=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=o.length;t<n;t++){const n=o[t];if(4===n){const t=e+1*a,n=e+2*a,r=e+3*a;s(e+0*a),s(t),s(r),s(t),s(n),s(r)}else if(3===n){const t=e+1*a,n=e+2*a;s(e+0*a),s(t),s(n)}else if(n>4)for(let t=1,r=n-2;t<=r;t++){const n=e+a*t,r=e+a*(t+1);s(e+0*a),s(n),s(r)}e+=a*n}}else for(let e=0,t=i.length;e<t;e+=a)s(e)}function he(e){return d(Ye.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function fe(e,t){for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=pe(r);break;case"link":t.links.push(ge(r))}}}function pe(e){let t;for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=me(r)}}return t}function me(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":const e=i(r.textContent);t.axis.fromArray(e);break;case"limits":const n=r.getElementsByTagName("max")[0],a=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(a.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ge(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(ve(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(r))}}return t}function ve(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(ge(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(r))}}return t}function ye(e){const t={type:e.nodeName},n=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(n);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(n),t.angle=THREE.MathUtils.degToRad(n[3])}return t}function _e(e,t){for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":be(r,t)}}}function be(e,t){for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=i(r.textContent);break;case"mass":t.mass=i(r.textContent)[0]}}}function Ee(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":const e=r.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substr(0,n.length-1)}}return t}function we(e){return void 0!==e.build?e.build:e}function xe(e){const t=[],n=Ue.querySelector('[id="'+e.id+'"]');for(let e=0;e<n.childNodes.length;e++){const r=n.childNodes[e];if(1!==r.nodeType)continue;let a,o;switch(r.nodeName){case"matrix":a=i(r.textContent);const e=(new THREE.Matrix4).fromArray(a).transpose();t.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:e});break;case"translate":case"scale":a=i(r.textContent),o=(new THREE.Vector3).fromArray(a),t.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:o});break;case"rotate":a=i(r.textContent),o=(new THREE.Vector3).fromArray(a);const n=THREE.MathUtils.degToRad(a[3]);t.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:o,angle:n})}}return t}const Te=new THREE.Matrix4,Ae=new THREE.Vector3;function Me(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1!==r.nodeType)continue;let a;switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),Me(r);break;case"instance_camera":t.instanceCameras.push(o(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Se(r));break;case"instance_light":t.instanceLights.push(o(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Se(r));break;case"instance_node":t.instanceNodes.push(o(r.getAttribute("url")));break;case"matrix":a=i(r.textContent),t.matrix.multiply(Te.fromArray(a).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":a=i(r.textContent),Ae.fromArray(a),t.matrix.multiply(Te.makeTranslation(Ae.x,Ae.y,Ae.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":a=i(r.textContent);const e=THREE.MathUtils.degToRad(a[3]);t.matrix.multiply(Te.makeRotationAxis(Ae.fromArray(a),e)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":a=i(r.textContent),t.matrix.scale(Ae.fromArray(a)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return Ne(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ye.nodes[t.id]=t,t}function Se(e){const t={id:o(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];switch(r.nodeName){case"bind_material":const e=r.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const r=e[n],i=r.getAttribute("symbol"),a=r.getAttribute("target");t.materials[i]=o(a)}break;case"skeleton":t.skeletons.push(o(r.textContent))}}return t}function Re(e,t){const n=[],r=[];let i,a,o;for(i=0;i<e.length;i++){const r=e[i];let a;if(Ne(r))a=Fe(r),ke(a,t,n);else if(s=r,void 0!==Ye.visualScenes[s]){const e=Ye.visualScenes[r].children;for(let r=0;r<e.length;r++){const i=e[r];if("JOINT"===i.type){ke(Fe(i.id),t,n)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",r)}var s;for(i=0;i<t.length;i++)for(a=0;a<n.length;a++)if(o=n[a],o.bone.name===t[i].name){r[i]=o,o.processed=!0;break}for(i=0;i<n.length;i++)o=n[i],!1===o.processed&&(r.push(o),o.processed=!0);const l=[],c=[];for(i=0;i<r.length;i++)o=r[i],l.push(o.bone),c.push(o.boneInverse);return new THREE.Skeleton(l,c)}function ke(e,t,n){e.traverse((function(e){if(!0===e.isBone){let r;for(let n=0;n<t.length;n++){const i=t[n];if(i.name===e.name){r=i.boneInverse;break}}void 0===r&&(r=new THREE.Matrix4),n.push({bone:e,boneInverse:r,processed:!1})}}))}function Pe(e){const t=[],n=e.matrix,r=e.nodes,i=e.type,a=e.instanceCameras,o=e.instanceControllers,s=e.instanceLights,l=e.instanceGeometries,c=e.instanceNodes;for(let e=0,n=r.length;e<n;e++)t.push(Fe(r[e]));for(let e=0,n=a.length;e<n;e++){const n=$(a[e]);null!==n&&t.push(n.clone())}for(let e=0,n=o.length;e<n;e++){const n=o[e],r=(u=n.id,d(Ye.controllers[u],L)),i=Ie(he(r.id),n.materials),a=Re(n.skeletons,r.skin.joints);for(let e=0,n=i.length;e<n;e++){const n=i[e];n.isSkinnedMesh&&(n.bind(a,r.skin.bindMatrix),n.normalizeSkinWeights()),t.push(n)}}var u;for(let e=0,n=s.length;e<n;e++){const n=re(s[e]);null!==n&&t.push(n.clone())}for(let e=0,n=l.length;e<n;e++){const n=l[e],r=Ie(he(n.id),n.materials);for(let e=0,n=r.length;e<n;e++)t.push(r[e])}for(let e=0,n=c.length;e<n;e++)t.push(Fe(c[e]).clone());let h;if(0===r.length&&1===t.length)h=t[0];else{h="JOINT"===i?new THREE.Bone:new THREE.Group;for(let e=0;e<t.length;e++)h.add(t[e])}return h.name="JOINT"===i?e.sid:e.name,h.matrix.copy(n),h.matrix.decompose(h.position,h.quaternion,h.scale),h}const Le=new THREE.MeshBasicMaterial({color:16711935});function Ce(e,t){const n=[];for(let r=0,i=e.length;r<i;r++){const i=t[e[r]];void 0===i?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),n.push(Le)):n.push(Y(i))}return n}function Ie(e,t){const n=[];for(const r in e){const i=e[r],a=Ce(i.materialKeys,t);0===a.length&&("lines"===r||"linestrips"===r?a.push(new THREE.LineBasicMaterial):a.push(new THREE.MeshPhongMaterial));const o=void 0!==i.data.attributes.skinIndex;if(o)for(let e=0,t=a.length;e<t;e++)a[e].skinning=!0;const s=1===a.length?a[0]:a;let l;switch(r){case"lines":l=new THREE.LineSegments(i.data,s);break;case"linestrips":l=new THREE.Line(i.data,s);break;case"triangles":case"polylist":l=o?new THREE.SkinnedMesh(i.data,s):new THREE.Mesh(i.data,s)}n.push(l)}return n}function Ne(e){return void 0!==Ye.nodes[e]}function Fe(e){return d(Ye.nodes[e],Pe)}function Oe(e){const t=new THREE.Group;t.name=e.name;const n=e.children;for(let e=0;e<n.length;e++){const r=n[e];t.add(Fe(r.id))}return t}function He(e){return d(Ye.visualScenes[e],Oe)}if(0===e.length)return{scene:new THREE.Scene};const De=(new DOMParser).parseFromString(e,"application/xml"),Ue=n(De,"COLLADA")[0],Be=De.getElementsByTagName("parsererror")[0];if(void 0!==Be){const e=n(Be,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(Be),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const ze=Ue.getAttribute("version");console.log("THREE.ColladaLoader: File version",ze);const Ve=function(e){return{unit:l(n(e,"unit")[0]),upAxis:c(n(e,"up_axis")[0])}}(n(Ue,"asset")[0]),je=new THREE.TextureLoader(this.manager);let Ge;je.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Ge=new THREE.TGALoader(this.manager),Ge.setPath(this.resourcePath||t));const We=[];let qe={},Xe=0;const Ye={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(Ue,"library_animations","animation",(function e(t){const n={sources:{},samplers:{},channels:{}};let r=!1;for(let i=0,a=t.childNodes.length;i<a;i++){const a=t.childNodes[i];if(1!==a.nodeType)continue;let o;switch(a.nodeName){case"source":o=a.getAttribute("id"),n.sources[o]=ie(a);break;case"sampler":o=a.getAttribute("id"),n.samplers[o]=f(a);break;case"channel":o=a.getAttribute("target"),n.channels[o]=p(a);break;case"animation":e(a),r=!0;break;default:console.log(a)}}!1===r&&(Ye.animations[t.getAttribute("id")||THREE.MathUtils.generateUUID()]=n)})),u(Ue,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"instance_animation":t.animations.push(o(r.getAttribute("url")))}}Ye.clips[e.getAttribute("id")]=t})),u(Ue,"library_controllers","controller",(function(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"skin":t.id=o(r.getAttribute("source")),t.skin=R(r);break;case"morph":t.id=o(r.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ye.controllers[e.getAttribute("id")]=t})),u(Ue,"library_images","image",(function(e){const t={init_from:n(e,"init_from")[0].textContent};Ye.images[e.getAttribute("id")]=t})),u(Ue,"library_effects","effect",(function(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"profile_COMMON":t.profile=N(r)}}Ye.effects[e.getAttribute("id")]=t})),u(Ue,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"instance_effect":t.url=o(r.getAttribute("url"))}}Ye.materials[e.getAttribute("id")]=t})),u(Ue,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"optics":t.optics=K(r)}}Ye.cameras[e.getAttribute("id")]=t})),u(Ue,"library_lights","light",(function(e){let t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":t=ee(r)}}Ye.lights[e.getAttribute("id")]=t})),u(Ue,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(e,"mesh")[0];if(void 0!==r){for(let e=0;e<r.childNodes.length;e++){const n=r.childNodes[e];if(1!==n.nodeType)continue;const i=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[i]=ie(n);break;case"vertices":t.vertices=ae(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(n));break;default:console.log(n)}}Ye.geometries[e.getAttribute("id")]=t}})),u(Ue,"library_nodes","node",Me),u(Ue,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const n=t[e];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Xe++)}}(e);const r=n(e,"node");for(let e=0;e<r.length;e++)t.children.push(Me(r[e]));Ye.visualScenes[e.getAttribute("id")]=t})),u(Ue,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":fe(r,t)}}Ye.kinematicsModels[e.getAttribute("id")]=t})),u(Ue,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"rigid_body":t.rigidBodies[r.getAttribute("name")]={},_e(r,t.rigidBodies[r.getAttribute("name")])}}Ye.physicsModels[e.getAttribute("id")]=t})),u(Ue,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ee(r))}}Ye.kinematicsScenes[o(e.getAttribute("url"))]=t})),h(Ye.animations,m),h(Ye.clips,M),h(Ye.controllers,L),h(Ye.images,C),h(Ye.effects,q),h(Ye.materials,X),h(Ye.cameras,J),h(Ye.lights,ne),h(Ye.geometries,le),h(Ye.visualScenes,Oe),function(){const e=Ye.clips;if(!0===s(e)){if(!1===s(Ye.animations)){const e=[];for(const t in Ye.animations){const n=g(t);for(let t=0,r=n.length;t<r;t++)e.push(n[t])}We.push(new THREE.AnimationClip("default",-1,e))}}else for(const t in e)We.push(S(t))}(),function(){const e=Object.keys(Ye.kinematicsModels)[0],t=Object.keys(Ye.kinematicsScenes)[0],n=Object.keys(Ye.visualScenes)[0];if(void 0===e||void 0===t)return;const r=(i=e,d(Ye.kinematicsModels[i],de));var i;const a=function(e){return d(Ye.kinematicsScenes[e],we)}(t),o=He(n),s=a.bindJointAxis,l={};for(let e=0,t=s.length;e<t;e++){const t=s[e],n=Ue.querySelector('[sid="'+t.target+'"]');if(n){const e=n.parentElement;c(t.jointIndex,e)}}function c(e,t){const n=t.getAttribute("name"),i=r.joints[e];o.traverse((function(r){r.name===n&&(l[e]={object:r,transforms:xe(t),joint:i,position:i.zeroPosition})}))}const u=new THREE.Matrix4;qe={joints:r&&r.joints,getJointValue:function(e){const t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const n=l[e];if(n){const r=n.joint;if(t>r.limits.max||t<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const i=n.object,a=r.axis,o=n.transforms;Te.identity();for(let n=0;n<o.length;n++){const i=o[n];if(i.sid&&-1!==i.sid.indexOf(e))switch(r.type){case"revolute":Te.multiply(u.makeRotationAxis(a,THREE.MathUtils.degToRad(t)));break;case"prismatic":Te.multiply(u.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(i.type){case"matrix":Te.multiply(i.obj);break;case"translate":Te.multiply(u.makeTranslation(i.obj.x,i.obj.y,i.obj.z));break;case"scale":Te.scale(i.obj);break;case"rotate":Te.multiply(u.makeRotationAxis(i.obj,i.angle))}}i.matrix.copy(Te),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();const Ke=function(e){return He(o(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(Ue,"scene")[0]);return Ke.animations=We,"Z_UP"===Ve.upAxis&&Ke.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ke.scale.multiplyScalar(Ve.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),We},kinematics:qe,library:Ye,scene:Ke}}}THREE.ColladaLoader=e}()},864:()=>{!function(){const e=new THREE.Vector3,t=new THREE.Line3,n=new THREE.Plane,r=new THREE.Vector3,i=new THREE.Triangle;class a{constructor(){this.normal=new THREE.Vector3,this.midpoint=new THREE.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}static create(e,t,n){const r=new a,i=new o(e,r),s=new o(t,r),l=new o(n,r);return i.next=l.prev=s,s.next=i.prev=l,l.next=s.prev=i,r.edge=i,r.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),n=this.edge.next.head();return i.set(e.point,t.point,n.point),i.getNormal(this.normal),i.getMidpoint(this.midpoint),this.area=i.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class o{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class s{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class l{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this}remove(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return null===this.head}}THREE.ConvexHull=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new l,this.unassigned=new l,this.vertices=[]}setFromPoints(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.vertices.push(new s(e[t]));return this.compute(),this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){const n=e.geometry;if(void 0!==n){if(n.isGeometry)return void console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");if(n.isBufferGeometry){const r=n.attributes.position;if(void 0!==r)for(let n=0,i=r.count;n<i;n++){const i=new THREE.Vector3;i.fromBufferAttribute(r,n).applyMatrix4(e.matrixWorld),t.push(i)}}}})),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let n=0,r=t.length;n<r;n++){if(t[n].distanceToPoint(e)>this.tolerance)return!1}return!0}intersectRay(e,t){const n=this.faces;let r=-1/0,i=1/0;for(let t=0,a=n.length;t<a;t++){const a=n[t],o=a.distanceToPoint(e.origin),s=a.normal.dot(e.direction);if(o>0&&s>=0)return null;const l=0!==s?-o/s:0;if(!(l<=0)&&(s>0?i=Math.min(l,i):r=Math.max(l,r),r>i))return null}return r!==-1/0?e.at(r,t):e.at(i,t),t}intersectsRay(t){return null!==this.intersectRay(t,e)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(null!==e.outside){const t=e.outside;let n=e.outside;for(;null!==n.next&&n.next.face===e;)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const n=this.removeAllVerticesFromFace(e);if(void 0!==n)if(void 0===t)this.unassigned.appendChain(n);else{let e=n;do{const n=e.next;t.distanceToPoint(e.point)>this.tolerance?this.addVertexToFace(e,t):this.unassigned.append(e),e=n}while(null!==e)}return this}resolveUnassignedPoints(e){if(!1===this.unassigned.isEmpty()){let t=this.unassigned.first();do{const n=t.next;let r=this.tolerance,i=null;for(let n=0;n<e.length;n++){const a=e[n];if(0===a.mark){const e=a.distanceToPoint(t.point);if(e>r&&(r=e,i=a),r>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(t,i),t=n}while(null!==t)}return this}computeExtremes(){const e=new THREE.Vector3,t=new THREE.Vector3,n=[],r=[];for(let e=0;e<3;e++)n[e]=r[e]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let i=0,a=this.vertices.length;i<a;i++){const a=this.vertices[i],o=a.point;for(let t=0;t<3;t++)o.getComponent(t)<e.getComponent(t)&&(e.setComponent(t,o.getComponent(t)),n[t]=a);for(let e=0;e<3;e++)o.getComponent(e)>t.getComponent(e)&&(t.setComponent(e,o.getComponent(e)),r[e]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:n,max:r}}computeInitialHull(){const e=this.vertices,i=this.computeExtremes(),o=i.min,s=i.max;let l=0,c=0;for(let e=0;e<3;e++){const t=s[e].point.getComponent(e)-o[e].point.getComponent(e);t>l&&(l=t,c=e)}const u=o[c],h=s[c];let d,f;l=0,t.set(u.point,h.point);for(let n=0,i=this.vertices.length;n<i;n++){const i=e[n];if(i!==u&&i!==h){t.closestPointToPoint(i.point,!0,r);const e=r.distanceToSquared(i.point);e>l&&(l=e,d=i)}}l=-1,n.setFromCoplanarPoints(u.point,h.point,d.point);for(let t=0,r=this.vertices.length;t<r;t++){const r=e[t];if(r!==u&&r!==h&&r!==d){const e=Math.abs(n.distanceToPoint(r.point));e>l&&(l=e,f=r)}}const p=[];if(n.distanceToPoint(f.point)<0){p.push(a.create(u,h,d),a.create(f,h,u),a.create(f,d,h),a.create(f,u,d));for(let e=0;e<3;e++){const t=(e+1)%3;p[e+1].getEdge(2).setTwin(p[0].getEdge(t)),p[e+1].getEdge(1).setTwin(p[t+1].getEdge(0))}}else{p.push(a.create(u,d,h),a.create(f,u,h),a.create(f,h,d),a.create(f,d,u));for(let e=0;e<3;e++){const t=(e+1)%3;p[e+1].getEdge(2).setTwin(p[0].getEdge((3-e)%3)),p[e+1].getEdge(0).setTwin(p[t+1].getEdge(1))}}for(let e=0;e<4;e++)this.faces.push(p[e]);for(let t=0,n=e.length;t<n;t++){const n=e[t];if(n!==u&&n!==h&&n!==d&&n!==f){l=this.tolerance;let e=null;for(let t=0;t<4;t++){const r=this.faces[t].distanceToPoint(n.point);r>l&&(l=r,e=this.faces[t])}null!==e&&this.addVertexToFace(n,e)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const n=this.faces[t];0===n.mark&&e.push(n)}return this.faces=e,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let e,t=0;const n=this.assigned.first().face;let r=n.outside;do{const i=n.distanceToPoint(r.point);i>t&&(t=i,e=r),r=r.next}while(null!==r&&r.face===n);return e}}computeHorizon(e,t,n,r){let i;this.deleteFaceVertices(n),n.mark=1,i=null===t?t=n.getEdge(0):t.next;do{const t=i.twin,n=t.face;0===n.mark&&(n.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,t,n,r):r.push(i)),i=i.next}while(i!==t);return this}addAdjoiningFace(e,t){const n=a.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let n=null,r=null;for(let i=0;i<t.length;i++){const a=t[i],o=this.addAdjoiningFace(e,a);null===n?n=o:o.next.setTwin(r),this.newFaces.push(o.face),r=o}return n.next.setTwin(r),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}}()},235:()=>{!function(){const e={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new THREE.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:"\n\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float cKernel[ KERNEL_SIZE_INT ];\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 imageCoord = vUv;\n\t\t\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\t\t\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\n\t\t\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\t\t\timageCoord += uImageIncrement;\n\n\t\t\t}\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}",buildKernel:function(e){let n=2*Math.ceil(3*e)+1;n>25&&(n=25);const r=.5*(n-1),i=new Array(n);let a=0;for(let o=0;o<n;++o)i[o]=t(o-r,e),a+=i[o];for(let e=0;e<n;++e)i[e]/=a;return i}};function t(e,t){return Math.exp(-e*e/(2*t*t))}THREE.ConvolutionShader=e}()},1790:()=>{var e;e={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"},THREE.CopyShader=e},3861:()=>{!function(){class e extends THREE.CompressedTextureLoader{constructor(e){super(e)}parse(e,t){const n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,n,r){const i=n*r*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i);let s=0,l=0;for(let e=0;e<r;e++)for(let e=0;e<n;e++){const e=a[l];l++;const t=a[l];l++;const n=a[l];l++;const r=a[l];l++,o[s]=n,s++,o[s]=t,s++,o[s]=e,s++,o[s]=r,s++}return o}const a=r("DXT1"),o=r("DXT3"),s=r("DXT5"),l=r("ETC1"),c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!c[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;let u;const h=c[21];let d=!1;switch(h){case a:u=8,n.format=THREE.RGB_S3TC_DXT1_Format;break;case o:u=16,n.format=THREE.RGBA_S3TC_DXT3_Format;break;case s:u=16,n.format=THREE.RGBA_S3TC_DXT5_Format;break;case l:u=8,n.format=THREE.RGB_ETC1_Format;break;default:if(!(32===c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(f=h,String.fromCharCode(255&f,f>>8&255,f>>16&255,f>>24&255))),n;d=!0,u=64,n.format=THREE.RGBAFormat}var f;n.mipmapCount=1,131072&c[2]&&!1!==t&&(n.mipmapCount=Math.max(1,c[7]));const p=c[28];if(n.isCubemap=!!(512&p),n.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=c[4],n.height=c[3];let m=c[1]+4;const g=n.isCubemap?6:1;for(let t=0;t<g;t++){let t=n.width,r=n.height;for(let a=0;a<n.mipmapCount;a++){let a,o;d?(a=i(e,m,t,r),o=a.length):(o=Math.max(4,t)/4*Math.max(4,r)/4*u,a=new Uint8Array(e,m,o));const s={data:a,width:t,height:r};n.mipmaps.push(s),m+=o,t=Math.max(t>>1,1),r=Math.max(r>>1,1)}}return n}}THREE.DDSLoader=e}()},3538:()=>{!function(){const e=new WeakMap;class t extends THREE.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const i=new THREE.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{const n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(r)}),n,r)}decodeDracoFile(e,t,n,r){const i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)}decodeGeometry(t,n){for(const e in n.attributeTypes){const t=n.attributeTypes[e];void 0!==t.BYTES_PER_ELEMENT&&(n.attributeTypes[e]=t.name)}const r=JSON.stringify(n);if(e.has(t)){const n=e.get(t);if(n.key===r)return n.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const a=this.workerNextTaskID++,o=t.byteLength,s=this._getWorker(a,o).then((e=>(i=e,new Promise(((e,r)=>{i._callbacks[a]={resolve:e,reject:r},i.postMessage({type:"decode",id:a,taskConfig:n,buffer:t},[t])}))))).then((e=>this._createGeometry(e.geometry)));return s.catch((()=>!0)).then((()=>{i&&a&&this._releaseTask(i,a)})),e.set(t,{key:r,promise:s}),s}_createGeometry(e){const t=new THREE.BufferGeometry;e.index&&t.setIndex(new THREE.BufferAttribute(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],i=r.name,a=r.array,o=r.itemSize;t.setAttribute(i,new THREE.BufferAttribute(a,o))}return t}_loadLibrary(e,t){const n=new THREE.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,r)=>{n.load(e,t,void 0,r)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=n.toString(),a=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function n(){let e,t;function n(e,t,n,r,i,a){const o=a.num_components(),s=n.num_points()*o,l=s*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,a,c,l,u);const h=new i(e.HEAPF32.buffer,u,s).slice();return e._free(u),{name:r,array:h,itemSize:o}}onmessage=function(r){const i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const r=i.buffer,a=i.taskConfig;t.then((e=>{const t=e.draco,o=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(r),r.byteLength);try{const e=function(e,t,r,i){const a=i.attributeIDs,o=i.attributeTypes;let s,l;const c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)s=new e.Mesh,l=t.DecodeBufferToMesh(r,s);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");s=new e.PointCloud,l=t.DecodeBufferToPointCloud(r,s)}if(!l.ok()||0===s.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const r in a){const l=self[o[r]];let c,h;if(i.useUniqueIDs)h=a[r],c=t.GetAttributeByUniqueId(s,h);else{if(h=t.GetAttributeId(s,e[a[r]]),-1===h)continue;c=t.GetAttribute(s,h)}u.attributes.push(n(e,t,s,r,l,c))}c===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){const r=3*n.num_faces(),i=4*r,a=e._malloc(i);t.GetTrianglesUInt32Array(n,i,a);const o=new Uint32Array(e.HEAPF32.buffer,a,r).slice();return e._free(a),{array:o,itemSize:1}}(e,t,s));return e.destroy(s),u}(t,o,s,a),r=e.attributes.map((e=>e.array.buffer));e.index&&r.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},r)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s),t.destroy(o)}}))}}}THREE.DRACOLoader=t}()},8084:()=>{const e=/\bvoid\s+main\s*\(\s*\)\s*{/g;function t(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,n){let r=THREE.ShaderChunk[n];return r?t(r):e}))}const n=Object.assign||function(){let e=arguments[0];for(let t=1,n=arguments.length;t<n;t++){let n=arguments[t];if(n)for(let t in n)n.hasOwnProperty(t)&&(e[t]=n[t])}return e};let r=0;const i=Date.now(),a=new WeakMap;function o(e,t){return"uniforms"===e?void 0:t}THREE.createDerivedMaterial=function(s,l){const c=function(e){return JSON.stringify(e,o)}(l);let u=a.get(s);if(u||(u=Object.create(null),a.set(s,u)),u[c])return u[c].clone();const h=++r,d=`_derivedShaders${h}`,f=`_onBeforeCompile${h}`;let p,m;function g(r){s.onBeforeCompile.call(this,r);const{vertex:a,fragment:o}=this[d]||(this[d]={vertex:{},fragment:{}});if(a.source!==r.vertexShader||o.source!==r.fragmentShader){const n=function({vertexShader:n,fragmentShader:r},i,a){let{vertexDefs:o,vertexTransform:s,vertexMainIntro:l,fragmentDefs:c,fragmentDiffuseTransform:u,fragmentMainIntro:h,fragmentColorTransform:d,timeUniform:f}=i;if(f){const e=`\nuniform float ${f};\n`;o=(o||"")+e,c=(c||"")+e}(o||s||l)&&(s&&(n=t(n),o=`\n        ${o||""}\n        void vertexTransform_${a}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n          ${s}\n        }\n      `,n=n.replace(/\b(position|normal|uv)\b/g,((e,t,n,r)=>/\battribute\s+vec3\s+$/.test(r.substr(0,n))?t:`_${t}_${a}`)),l=`\n        vec3 _position_${a} = vec3(position);\n        vec3 _normal_${a} = vec3(normal);\n        vec2 _uv_${a} = vec2(uv);\n        vertexTransform_${a}(_position_${a}, _normal_${a}, _uv_${a});\n        ${l||""}\n      `),n=n.replace(e,`${o||""}\n\n$&\n\n${l||""}`));(c||u||h||d)&&(r=t(r),u&&(c=`\n        ${c||""}\n        void fragmentDiffuseTransform_${a}(inout vec3 diffuse) {\n          ${u}\n        }\n      `,r=r.replace(/\b(diffuse)\b/g,((e,t,n,r)=>/\buniform\s+vec3\s+$/.test(r.substr(0,n))?t:`_${t}_${a}`)),h=`\n        vec3 _diffuse_${a} = diffuse;\n        fragmentDiffuseTransform_${a}(_diffuse_${a});\n        ${h||""}\n      `),r=r.replace(e,`\n      ${c||""}\n      void threejsMain_${a}() {\n      ${h||""}\n    `),r+=`\n      void main() {\n        threejsMain_${a}();\n        ${d||""}\n      }\n    `);return{vertexShader:n,fragmentShader:r}}(r,l,h);a.source=r.vertexShader,a.result=n.vertexShader,o.source=r.fragmentShader,o.result=n.fragmentShader}r.vertexShader=a.result,r.fragmentShader=o.result,n(r.uniforms,this.uniforms),l.timeUniform&&(r.uniforms[l.timeUniform]={get value(){return Date.now()-i}}),this[f]&&this[f](r)}function v(){this._listeners=void 0}v.prototype=Object.create(s,{constructor:{value:v},isDerivedMaterial:{value:!0},baseMaterial:{value:s},onBeforeCompile:{get:()=>g,set(e){this[f]=e}},copy:{value:function(e){return s.copy.call(this,e),s.isShaderMaterial||s.isDerivedMaterial||(this.extensions=e.extensions,this.defines=n({},e.defines),this.uniforms=THREE.UniformsUtils.clone(e.uniforms)),this}},getDepthMaterial:{value:function(){let e=this._depthMaterial;return e||(m||(m=createDerivedMaterial(s.isDerivedMaterial?s.getDepthMaterial():new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking}),l),m.defines.IS_DEPTH_MATERIAL=""),e=this._depthMaterial=m.clone()),e}},getDistanceMaterial:{value:function(){let e=this._distanceMaterial;return e||(p||(p=createDerivedMaterial(s.isDerivedMaterial?s.getDistanceMaterial():new THREE.MeshDistanceMaterial,l),p.defines.IS_DISTANCE_MATERIAL=""),e=this._distanceMaterial=p.clone()),e}},dispose:{value(){const{_depthMaterial:e,_distanceMaterial:t}=this;e&&e.dispose(),t&&t.dispose(),s.dispose.call(this)}}});const y=new v;return y.copy(s),y.uniforms=n(THREE.UniformsUtils.clone(s.uniforms||{}),l.uniforms),y.defines=n({},s.defines,l.defines),y.defines.DERIVED_MATERIAL=h,y.extensions=n({},s.extensions,l.extensions),u[c]=y,y.clone()};const s={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};THREE.getShadersForMaterial=function(e){let t=s[e.type];return t?THREE.ShaderLib[t]:e},THREE.getShaderUniformTypes=function(e){let t,n=/\buniform\s+(int|float|vec[234])\s+([A-Za-z_][\w]*)/g,r=Object.create(null);for(;null!==(t=n.exec(e));)r[t[2]]=t[1];return r}},6999:()=>{!function(){const e={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\tuniform int byp; //should we apply the glitch ?\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDisp;\n\n\t\tuniform float amount;\n\t\tuniform float angle;\n\t\tuniform float seed;\n\t\tuniform float seed_x;\n\t\tuniform float seed_y;\n\t\tuniform float distortion_x;\n\t\tuniform float distortion_y;\n\t\tuniform float col_s;\n\n\t\tvarying vec2 vUv;\n\n\n\t\tfloat rand(vec2 co){\n\t\t\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tif(byp<1) {\n\t\t\t\tvec2 p = vUv;\n\t\t\t\tfloat xs = floor(gl_FragCoord.x / 0.5);\n\t\t\t\tfloat ys = floor(gl_FragCoord.y / 0.5);\n\t\t\t\t//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch\n\t\t\t\tvec4 normal = texture2D (tDisp, p*seed*seed);\n\t\t\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {\n\t\t\t\t\tif(seed_x>0.){\n\t\t\t\t\t\tp.y = 1. - (p.y + distortion_y);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.y = distortion_y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {\n\t\t\t\t\tif(seed_y>0.){\n\t\t\t\t\t\tp.x=distortion_x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.x = 1. - (p.x + distortion_x);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.x+=normal.x*seed_x*(seed/5.);\n\t\t\t\tp.y+=normal.y*seed_y*(seed/5.);\n\t\t\t\t//base from RGB shift shader\n\t\t\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));\n\t\t\t\tvec4 cr = texture2D(tDiffuse, p + offset);\n\t\t\t\tvec4 cga = texture2D(tDiffuse, p);\n\t\t\t\tvec4 cb = texture2D(tDiffuse, p - offset);\n\t\t\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\t\t\t\t//add noise\n\t\t\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);\n\t\t\t\tgl_FragColor = gl_FragColor+ snow;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl_FragColor=texture2D (tDiffuse, vUv);\n\t\t\t}\n\t\t}"};THREE.DigitalGlitch=e}()},900:()=>{!function(){const e={uniforms:{tDiffuse:{value:null},tSize:{value:new THREE.Vector2(256,256)},center:{value:new THREE.Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec2 center;\n\t\tuniform float angle;\n\t\tuniform float scale;\n\t\tuniform vec2 tSize;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tfloat pattern() {\n\n\t\t\tfloat s = sin( angle ), c = cos( angle );\n\n\t\t\tvec2 tex = vUv * tSize - center;\n\t\t\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\n\n\t\t\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat average = ( color.r + color.g + color.b ) / 3.0;\n\n\t\t\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n\n\t\t}"};THREE.DotScreenShader=e}()},9174:()=>{!function(){const e=new THREE.Plane,t=new THREE.Raycaster,n=new THREE.Vector2,r=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Matrix4;class s extends THREE.EventDispatcher{constructor(s,l,c){super();let u=null,h=null;const d=[],f=this;function p(){c.addEventListener("pointermove",g),c.addEventListener("pointerdown",v),c.addEventListener("pointerup",y),c.addEventListener("pointerleave",y),c.addEventListener("touchmove",_,{passive:!1}),c.addEventListener("touchstart",b,{passive:!1}),c.addEventListener("touchend",E)}function m(){c.removeEventListener("pointermove",g),c.removeEventListener("pointerdown",v),c.removeEventListener("pointerup",y),c.removeEventListener("pointerleave",y),c.removeEventListener("touchmove",_),c.removeEventListener("touchstart",b),c.removeEventListener("touchend",E),c.style.cursor=""}function g(p){if(!1!==f.enabled)switch(p.preventDefault(),p.pointerType){case"mouse":case"pen":!function(p){const m=c.getBoundingClientRect();if(n.x=(p.clientX-m.left)/m.width*2-1,n.y=-(p.clientY-m.top)/m.height*2+1,t.setFromCamera(n,l),u&&f.enabled)return t.ray.intersectPlane(e,i)&&u.position.copy(i.sub(r).applyMatrix4(o)),void f.dispatchEvent({type:"drag",object:u});if(d.length=0,t.setFromCamera(n,l),t.intersectObjects(s,!0,d),d.length>0){const t=d[0].object;e.setFromNormalAndCoplanarPoint(l.getWorldDirection(e.normal),a.setFromMatrixPosition(t.matrixWorld)),h!==t&&null!==h&&(f.dispatchEvent({type:"hoveroff",object:h}),c.style.cursor="auto",h=null),h!==t&&(f.dispatchEvent({type:"hoveron",object:t}),c.style.cursor="pointer",h=t)}else null!==h&&(f.dispatchEvent({type:"hoveroff",object:h}),c.style.cursor="auto",h=null)}(p)}}function v(h){if(!1!==f.enabled)switch(h.preventDefault(),h.pointerType){case"mouse":case"pen":!function(h){h.preventDefault(),d.length=0,t.setFromCamera(n,l),t.intersectObjects(s,!0,d),d.length>0&&(u=!0===f.transformGroup?s[0]:d[0].object,t.ray.intersectPlane(e,i)&&(o.copy(u.parent.matrixWorld).invert(),r.copy(i).sub(a.setFromMatrixPosition(u.matrixWorld))),c.style.cursor="move",f.dispatchEvent({type:"dragstart",object:u}))}(h)}}function y(e){if(!1!==f.enabled)switch(e.preventDefault(),e.pointerType){case"mouse":case"pen":!function(e){e.preventDefault(),u&&(f.dispatchEvent({type:"dragend",object:u}),u=null);c.style.cursor=h?"pointer":"auto"}(e)}}function _(a){if(!1===f.enabled)return;a.preventDefault(),a=a.changedTouches[0];const s=c.getBoundingClientRect();return n.x=(a.clientX-s.left)/s.width*2-1,n.y=-(a.clientY-s.top)/s.height*2+1,t.setFromCamera(n,l),u&&f.enabled?(t.ray.intersectPlane(e,i)&&u.position.copy(i.sub(r).applyMatrix4(o)),void f.dispatchEvent({type:"drag",object:u})):void 0}function b(h){if(!1===f.enabled)return;h.preventDefault(),h=h.changedTouches[0];const p=c.getBoundingClientRect();n.x=(h.clientX-p.left)/p.width*2-1,n.y=-(h.clientY-p.top)/p.height*2+1,d.length=0,t.setFromCamera(n,l),t.intersectObjects(s,!0,d),d.length>0&&(u=!0===f.transformGroup?s[0]:d[0].object,e.setFromNormalAndCoplanarPoint(l.getWorldDirection(e.normal),a.setFromMatrixPosition(u.matrixWorld)),t.ray.intersectPlane(e,i)&&(o.copy(u.parent.matrixWorld).invert(),r.copy(i).sub(a.setFromMatrixPosition(u.matrixWorld))),c.style.cursor="move",f.dispatchEvent({type:"dragstart",object:u}))}function E(e){!1!==f.enabled&&(e.preventDefault(),u&&(f.dispatchEvent({type:"dragend",object:u}),u=null),c.style.cursor="auto")}p(),this.enabled=!0,this.transformGroup=!1,this.activate=p,this.deactivate=m,this.dispose=function(){m()},this.getObjects=function(){return s}}}THREE.DragControls=s}()},5470:()=>{!function(){const e=new THREE.OrthographicCamera(-1,1,1,-1,0,1),t=new THREE.BufferGeometry;t.setAttribute("position",new THREE.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),t.setAttribute("uv",new THREE.Float32BufferAttribute([0,2,0,0,2,0],2));THREE.EffectComposer=class{constructor(e,t){if(this.renderer=e,void 0===t){const n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},r=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let t=0,r=this.passes.length;t<r;t++){const r=this.passes[t];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),r.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(r instanceof THREE.MaskPass?n=!0:r instanceof THREE.ClearMaskPass&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}},THREE.FullScreenQuad=class{constructor(e){this._mesh=new THREE.Mesh(t,e)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,e)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},THREE.Pass=class{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}}()},2509:(e,t,n)=>{"use strict";n.r(t);var r=n(743);n(8080);!function(){let e,t,n;class i extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(t,n){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===E(e,0,t.length)}(t))e=(new c).parse(t);else{const n=E(t);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(t){const r=e[t-1];return e=e.slice(n+t),n++,r}for(let e=0;e<t.length;++e){if(r(1)===t[e])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(d(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(n));e=(new l).parse(n)}const r=new THREE.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new a(r,this.manager).parse(e)}}class a{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){t=this.parseConnections();const e=this.parseImages(),r=this.parseTextures(e),i=this.parseMaterials(r),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,i),n}parseConnections(){const t=new Map;if("Connections"in e){e.Connections.connections.forEach((function(e){const n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});const a={ID:r,relationship:i};t.get(n).parents.push(a),t.has(r)||t.set(r,{parents:[],children:[]});const o={ID:n,relationship:i};t.get(r).children.push(o)}))}return t}parseImages(){const t={},n={};if("Video"in e.Objects){const r=e.Objects.Video;for(const e in r){const i=r[e];if(t[parseInt(e)]=i.RelativeFilename||i.Filename,"Content"in i){const t=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,a="string"==typeof i.Content&&""!==i.Content;if(t||a){const t=this.parseImage(r[e]);n[i.RelativeFilename||i.Filename]=t}}}}for(const e in t){const r=t[e];void 0!==n[r]?t[e]=n[r]:t[e]=t[e].split("\\").pop()}return t}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(r){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof t)return"data:"+i+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:i}))}}parseTextures(t){const n=new Map;if("Texture"in e.Objects){const r=e.Objects.Texture;for(const e in r){const i=this.parseTexture(r[e],t);n.set(parseInt(e),i)}}return n}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,i=e.WrapModeV,a=void 0!==r?r.value:0,o=void 0!==i?i.value:0;if(n.wrapS=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}return n}loadTexture(e,n){let r;const i=this.textureLoader.path,a=t.get(e.id).children;let o;void 0!==a&&a.length>0&&void 0!==n[a[0].ID]&&(r=n[a[0].ID],0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));const s=e.FileName.slice(-3).toLowerCase();if("tga"===s){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new THREE.Texture):o=t.load(r)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new THREE.Texture):o=this.textureLoader.load(r);return this.textureLoader.setPath(i),o}parseMaterials(t){const n=new Map;if("Material"in e.Objects){const r=e.Objects.Material;for(const e in r){const i=this.parseMaterial(r[e],t);null!==i&&n.set(parseInt(e),i)}}return n}parseMaterial(e,n){const r=e.id,i=e.attrName;let a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!t.has(r))return null;const o=this.parseParameters(e,n,r);let s;switch(a.toLowerCase()){case"phong":s=new THREE.MeshPhongMaterial;break;case"lambert":s=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to THREE.MeshPhongMaterial.',a),s=new THREE.MeshPhongMaterial}return s.setValues(o),s.name=i,s}parseParameters(e,n,r){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));const a=this;return t.get(r).children.forEach((function(e){const t=e.relationship;switch(t){case"Bump":i.bumpMap=a.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(n,e.ID),i.map.encoding=THREE.sRGBEncoding;break;case"DisplacementColor":i.displacementMap=a.getTexture(n,e.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(n,e.ID),i.emissiveMap.encoding=THREE.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(n,e.ID);break;case"ReflectionColor":i.envMap=a.getTexture(n,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping,i.envMap.encoding=THREE.sRGBEncoding;break;case"SpecularColor":i.specularMap=a.getTexture(n,e.ID),i.specularMap.encoding=THREE.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=a.getTexture(n,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),i}getTexture(n,r){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=t.get(r).children[0].ID),n.get(r)}parseDeformers(){const n={},r={};if("Deformer"in e.Objects){const i=e.Objects.Deformer;for(const e in i){const a=i[e],o=t.get(parseInt(e));if("Skin"===a.attrType){const t=this.parseSkeleton(o,i);t.ID=e,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,n[e]=t}else if("BlendShape"===a.attrType){const t={id:e};t.rawTargets=this.parseMorphTargets(o,i),t.id=e,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[e]=t}}}return{skeletons:n,morphTargets:r}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const r=t[e.ID];if("Cluster"!==r.attrType)return;const i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)})),{rawBones:n,bones:[]}}parseMorphTargets(e,n){const r=[];for(let i=0;i<e.children.length;i++){const a=e.children[i],o=n[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(s)}return r}parseScene(r,i,a){n=new THREE.Group;const o=this.parseModels(r.skeletons,i,a),l=e.Objects.Model,c=this;o.forEach((function(e){const r=l[e.ID];c.setLookAtProperties(e,r);t.get(e.ID).parents.forEach((function(t){const n=o.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&n.add(e)})),this.bindSkeleton(r.skeletons,i,o),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=y(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const u=(new s).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=u,n=n.children[0]),n.animations=u}parseModels(n,r,i){const a=new Map,o=e.Objects.Model;for(const e in o){const s=parseInt(e),l=o[e],c=t.get(s);let u=this.buildSkeleton(c,n,s,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,r,i);break;case"NurbsCurve":u=this.createCurve(c,r);break;case"LimbNode":case"Root":u=new THREE.Bone;break;case"Null":default:u=new THREE.Group}u.name=l.attrName?THREE.PropertyBinding.sanitizeNodeName(l.attrName):"",u.ID=s}this.getTransformData(u,l),a.set(s,u)}return a}buildSkeleton(e,t,n,r){let i=null;return e.parents.forEach((function(e){for(const a in t){const o=t[a];o.rawBones.forEach((function(t,a){if(t.ID===e.ID){const e=i;i=new THREE.Bone,i.matrixWorld.copy(t.transformLink),i.name=r?THREE.PropertyBinding.sanitizeNodeName(r):"",i.ID=n,o.bones[a]=i,null!==e&&i.add(e)}}))}})),i}createCamera(t){let n,r;if(t.children.forEach((function(t){const n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new THREE.Object3D;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let t=1;void 0!==r.NearPlane&&(t=r.NearPlane.value/1e3);let i=1e3;void 0!==r.FarPlane&&(i=r.FarPlane.value/1e3);let a=window.innerWidth,o=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,o=r.AspectHeight.value);const s=a/o;let l=45;void 0!==r.FieldOfView&&(l=r.FieldOfView.value);const c=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:n=new THREE.PerspectiveCamera(l,s,t,i),null!==c&&n.setFocalLength(c);break;case 1:n=new THREE.OrthographicCamera(-a/2,a/2,o/2,-o/2,t,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),n=new THREE.Object3D}}return n}createLight(t){let n,r;if(t.children.forEach((function(t){const n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new THREE.Object3D;else{let e;e=void 0===r.LightType?0:r.LightType.value;let t=16777215;void 0!==r.Color&&(t=(new THREE.Color).fromArray(r.Color.value));let i=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(i=0);let a=0;void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const o=1;switch(e){case 0:n=new THREE.PointLight(t,i,a,o);break;case 1:n=new THREE.DirectionalLight(t,i);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=THREE.MathUtils.degToRad(r.InnerAngle.value));let s=0;void 0!==r.OuterAngle&&(s=THREE.MathUtils.degToRad(r.OuterAngle.value),s=Math.max(s,1)),n=new THREE.SpotLight(t,i,a,e,s,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a THREE.PointLight."),n=new THREE.PointLight(t,i)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n}createMesh(e,t,n){let r,i=null,a=null;const o=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&o.push(n.get(e.ID))})),o.length>1?a=o:o.length>0?a=o[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(o.forEach((function(e){e.skinning=!0})),r=new THREE.SkinnedMesh(i,a),r.normalizeSkinWeights()):r=new THREE.Mesh(i,a),r}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?_(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(r,i){if("LookAtProperty"in i){t.get(r.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){const e=i.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(e),n.add(r.target)):r.lookAt((new THREE.Vector3).fromArray(e))}}}))}}bindSkeleton(e,n,r){const i=this.parsePoseNodes();for(const a in e){const o=e[a];t.get(parseInt(o.ID)).parents.forEach((function(e){if(n.has(e.ID)){const n=e.ID;t.get(n).parents.forEach((function(e){if(r.has(e.ID)){r.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in e.Objects){const n=e.Objects.Pose;for(const e in n)if("BindPose"===n[e].attrType){const r=n[e].PoseNode;Array.isArray(r)?r.forEach((function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)})):t[r.Node]=(new THREE.Matrix4).fromArray(r.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){const t=e.GlobalSettings.AmbientColor.value,r=t[0],i=t[1],a=t[2];if(0!==r||0!==i||0!==a){const e=new THREE.Color(r,i,a);n.add(new THREE.AmbientLight(e,1))}}}setupMorphMaterials(){const e=this;n.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(n,r){e.setupMorphMaterial(t,n,r)})):e.setupMorphMaterial(t,t.material))}))}setupMorphMaterial(e,t,r){const i=e.uuid,a=t.uuid;let o=!1;if(n.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===a&&e.uuid!==i&&(o=!0)})):e.material.uuid===a&&e.uuid!==i&&(o=!0))})),!0===o){const n=t.clone();n.morphTargets=!0,void 0===r?e.material=n:e.material[r]=n}else t.morphTargets=!0}}class o{parse(n){const r=new Map;if("Geometry"in e.Objects){const i=e.Objects.Geometry;for(const e in i){const a=t.get(parseInt(e)),o=this.parseGeometry(a,i[e],n);r.set(parseInt(e),o)}}return r}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(t,n,r){const i=r.skeletons,a=[],o=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0===o.length)return;const s=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);t.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&a.push(r.morphTargets[e.ID])}));const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=_(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const u=y(c);return this.genGeometry(n,s,a,u)}genGeometry(e,t,n,r){const i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);const a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new THREE.Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(r),i.setAttribute("position",s),o.colors.length>0&&i.setAttribute("color",new THREE.Float32BufferAttribute(o.colors,3)),t&&(i.setAttribute("skinIndex",new THREE.Uint16BufferAttribute(o.weightsIndices,4)),i.setAttribute("skinWeight",new THREE.Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){const e=(new THREE.Matrix3).getNormalMatrix(r),t=new THREE.Float32BufferAttribute(o.normal,3);t.applyNormalMatrix(e),i.setAttribute("normal",t)}if(o.uvs.forEach((function(e,t){let n="uv"+(t+1).toString();0===t&&(n="uv"),i.setAttribute(n,new THREE.Float32BufferAttribute(o.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach((function(n,r){n!==e&&(i.addGroup(t,r-t,e),e=n,t=r)})),i.groups.length>0){const t=i.groups[i.groups.length-1],n=t.start+t.count;n!==o.materialIndex.length&&i.addGroup(n,o.materialIndex.length-n,e)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,a=[],o=[],s=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,f){let p,g=!1;d<0&&(d^=-1,g=!0);let v=[],y=[];if(a.push(3*d,3*d+1,3*d+2),e.color){const t=m(f,n,d,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){y.push(e.weight),v.push(e.id)})),y.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const e=[0,0,0,0],t=[0,0,0,0];y.forEach((function(n,r){let i=n,a=v[r];t.forEach((function(t,n,r){if(i>t){r[n]=i,i=t;const o=e[n];e[n]=a,a=o}}))})),v=e,y=t}for(;y.length<4;)y.push(0),v.push(0);for(let e=0;e<4;++e)c.push(y[e]),u.push(v[e])}if(e.normal){const t=m(f,n,d,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=m(f,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const r=m(f,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])})),r++,g&&(h.genFace(t,e,a,p,o,s,l,c,u,r),n++,r=0,a=[],o=[],s=[],l=[],c=[],u=[])})),t}genFace(e,t,n,r,i,a,o,s,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(u-1)]),e.colors.push(a[3*(u-1)+1]),e.colors.push(a[3*(u-1)+2]),e.colors.push(a[3*u]),e.colors.push(a[3*u+1]),e.colors.push(a[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(u-1)]),e.uvs[n].push(o[n][2*(u-1)+1]),e.uvs[n].push(o[n][2*u]),e.uvs[n].push(o[n][2*u+1])}))}addMorphTargets(t,n,r,i){if(0===r.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const a=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const o=e.Objects.Geometry[r.geoID];void 0!==o&&a.genMorphGeometry(t,n,o,i,r.name)}))}))}genMorphGeometry(e,t,n,r,i){const a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l);for(let e=0;e<s.length;e++){const t=3*s[e];c[t]=o[3*e],c[t+1]=o[3*e+1],c[t+2]=o[3*e+2]}const u={vertexIndices:a,vertexPositions:c},h=this.genBuffers(u),d=new THREE.Float32BufferAttribute(h.vertex,3);d.name=i||n.attrName,d.applyMatrix4(r),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,i=[];for(let e=0;e<r.length;++e)i.push(e);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;const n=t-1,r=e.KnotVector.a,i=[],a=e.Points.a;for(let e=0,t=a.length;e<t;e+=4)i.push((new THREE.Vector4).fromArray(a,e));let o,s;if("Closed"===e.Form)i.push(i[0]);else if("Periodic"===e.Form){o=n,s=r.length-1-o;for(let e=0;e<n;++e)i.push(i[e])}const l=new THREE.NURBSCurve(n,r,i,o,s).getPoints(7*i.length),c=new Float32Array(3*l.length);l.forEach((function(e,t){e.toArray(c,3*t)}));const u=new THREE.BufferGeometry;return u.setAttribute("position",new THREE.BufferAttribute(c,3)),u}}class s{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const r=t[n],i=this.addClip(r);e.push(i)}return e}parseClips(){if(void 0===e.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const n=this.parseAnimationLayers(t);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const t=e.Objects.AnimationCurveNode,n=new Map;for(const e in t){const r=t[e];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const e={id:r.id,attr:r.attrName,curves:{}};n.set(e.id,e)}}return n}parseAnimationCurves(n){const r=e.Objects.AnimationCurve;for(const e in r){const i={id:r[e].id,times:r[e].KeyTime.a.map(f),values:r[e].KeyValueFloat.a},a=t.get(i.id);if(void 0!==a){const e=a.parents[0].ID,t=a.parents[0].relationship;t.match(/X/)?n.get(e).curves.x=i:t.match(/Y/)?n.get(e).curves.y=i:t.match(/Z/)?n.get(e).curves.z=i:t.match(/d|DeformPercent/)&&n.has(e)&&(n.get(e).curves.morph=i)}}}parseAnimationLayers(r){const i=e.Objects.AnimationLayer,a=new Map;for(const o in i){const i=[],s=t.get(parseInt(o));if(void 0!==s){s.children.forEach((function(a,o){if(r.has(a.ID)){const s=r.get(a.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===i[o]){const r=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==r){const t=e.Objects.Model[r.toString()];if(void 0===t)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",a);const s={modelName:t.attrName?THREE.PropertyBinding.sanitizeNodeName(t.attrName):"",ID:t.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(e){e.ID===t.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new THREE.Matrix4),"PreRotation"in t&&(s.preRotation=t.PreRotation.value),"PostRotation"in t&&(s.postRotation=t.PostRotation.value),i[o]=s}}i[o]&&(i[o][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===i[o]){const n=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=t.get(n).parents[0].ID,s=t.get(r).parents[0].ID,l=t.get(s).parents[0].ID,c=e.Objects.Model[l],u={modelName:c.attrName?THREE.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:e.Objects.Deformer[n].attrName};i[o]=u}i[o][s.attr]=s}}})),a.set(parseInt(o),i)}}return a}parseAnimStacks(n){const r=e.Objects.AnimationStack,i={};for(const e in r){const a=t.get(parseInt(e)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=n.get(a[0].ID);i[e]={name:r[e].attrName,layer:o}}return i}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new THREE.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let n=new THREE.Vector3,r=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new THREE.Euler).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,r){const i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,n);return new THREE.VectorKeyframeTrack(e+"."+r,i,a)}generateRotationTrack(e,t,n,r,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.MathUtils.degToRad));const o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,n);void 0!==r&&((r=r.map(THREE.MathUtils.degToRad)).push(a),r=(new THREE.Euler).fromArray(r),r=(new THREE.Quaternion).setFromEuler(r)),void 0!==i&&((i=i.map(THREE.MathUtils.degToRad)).push(a),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).invert());const l=new THREE.Quaternion,c=new THREE.Euler,u=[];for(let e=0;e<s.length;e+=3)c.set(s[e],s[e+1],s[e+2],a),l.setFromEuler(c),void 0!==r&&l.premultiply(r),void 0!==i&&l.multiply(i),l.toArray(u,e/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),i=n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==n&&(t[e]=i,n=i,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const r=n,i=[];let a=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){const e=t.x.values[a];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==o){const e=t.y.values[o];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==s){const e=t.z.values[s];i.push(e),r[2]=e}else i.push(r[2])})),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){const a=i/180,o=r/a;let s=n+o;const l=e.times[t-1],c=(e.times[t]-l)/a;let u=l+c;const h=[],d=[];for(;u<e.times[t];)h.push(u),u+=c,d.push(s),s+=o;e.times=w(e.times,t,h),e.values=w(e.values,t,d)}}}}class l{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){const i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(i||a)return;const o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,n[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},a=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in o?("PoseNode"===n?o.PoseNode.push(i):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==a.id&&(o[n][a.id]=i)):"number"==typeof a.id?(o[n]={},o[n][a.id]=i):"Properties70"!==n&&(o[n]="PoseNode"===n?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===r){const e=i.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let o=i.split(",").slice(3);o=o.map((function(e){return e.trim().replace(/^"/,"")})),r="connections",i=[t,n],function(e,t){for(let n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i,o),void 0===a[r]&&(a[r]=[])}"Node"===r&&(a.id=i),r in a&&Array.isArray(a[r])?a[r].push(i):"a"!==r?a[r]=i:a.a=i,this.setCurrentProp(a,r),"a"===r&&","!==i.slice(-1)&&(a.a=b(i))}else this.parseNodeSpecialProperty(e,r,i)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],a=r[1],o=r[2],s=r[3];let l=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class c{parse(e){const t=new u(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new h;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&r.add(e.name,e)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),o=e.getString(a);if(0===r)return null;const s=[];for(let t=0;t<i;t++)s.push(this.parseProperty(e));const l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){const r=this.parseNode(e,t);null!==r&&this.parseSubNode(o,n,r)}return n.propertyList=s,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==o&&(n.name=o),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],a=n.propertyList[3];let o;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),o="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:r,type2:i,flag:a,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}void 0===r&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const s=r.unzlibSync(new Uint8Array(e.getArrayBuffer(o))),l=new u(s.buffer);switch(t){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class u{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let n=0;n<e;n++)t[n]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}}class h{add(e,t){this[e]=t}}function d(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}const p=[];function m(e,t,n,r){let i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);const a=i*r.dataSize,o=a+r.dataSize;return function(e,t,n,r){for(let i=n,a=0;i<r;i++,a++)e[a]=t[i];return e}(p,r.buffer,a,o)}const g=new THREE.Euler,v=new THREE.Vector3;function y(e){const t=new THREE.Matrix4,n=new THREE.Matrix4,r=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c=new THREE.Matrix4,u=new THREE.Matrix4,h=new THREE.Matrix4,d=new THREE.Matrix4,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(v.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(THREE.MathUtils.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(g.fromArray(t))}if(e.rotation){const t=e.rotation.map(THREE.MathUtils.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(g.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(THREE.MathUtils.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(g.fromArray(t)),i.invert()}e.scale&&a.scale(v.fromArray(e.scale)),e.scalingOffset&&s.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),u.copy(e.parentMatrixWorld));const p=(new THREE.Matrix4).copy(n).multiply(r).multiply(i),m=new THREE.Matrix4;m.extractRotation(u);const y=new THREE.Matrix4;y.copyPosition(u);const _=new THREE.Matrix4,b=(new THREE.Matrix4).copy(y).invert().multiply(u);_.copy(m).invert().multiply(b);const E=a,w=new THREE.Matrix4;if(0===f)w.copy(m).multiply(p).multiply(_).multiply(E);else if(1===f)w.copy(m).multiply(_).multiply(p).multiply(E);else{const e=(new THREE.Matrix4).scale((new THREE.Vector3).setFromMatrixScale(h)),t=(new THREE.Matrix4).copy(e).invert(),n=(new THREE.Matrix4).copy(_).multiply(t);w.copy(m).multiply(p).multiply(n).multiply(E)}const x=new THREE.Matrix4;x.copy(c).invert();const T=new THREE.Matrix4;T.copy(o).invert();let A=new THREE.Matrix4;A.copy(t).multiply(l).multiply(c).multiply(n).multiply(r).multiply(i).multiply(x).multiply(s).multiply(o).multiply(a).multiply(T);const M=(new THREE.Matrix4).copyPosition(A),S=(new THREE.Matrix4).copy(u).multiply(M);return d.copyPosition(S),A=(new THREE.Matrix4).copy(d).multiply(w),A.premultiply(u.invert()),A}function _(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported THREE.Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function E(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,n))}function w(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}THREE.FBXLoader=i}()},5435:()=>{!function(){const e={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:'\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires "#version 130" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}'};THREE.FXAAShader=e}()},7342:()=>{!function(){const e=new THREE.Vector3,t=new THREE.Spherical,n=new THREE.Vector3;function r(e){e.preventDefault()}THREE.FirstPersonControls=class{constructor(i,a){void 0===a&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),a=document),this.object=i,this.domElement=a,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;let o=0,s=0;this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}},this.onKeyUp=function(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}},this.lookAt=function(e,t,r){return e.isVector3?n.copy(e):n.set(e,t,r),this.object.lookAt(n),f(this),this},this.update=function(){const e=new THREE.Vector3;return function(t){if(!1===this.enabled)return;if(this.heightSpeed){const e=THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*(e*this.heightCoef)}else this.autoSpeedFactor=0;const n=t*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.moveUp&&this.object.translateY(n),this.moveDown&&this.object.translateY(-n);let r=t*this.lookSpeed;this.activeLook||(r=0);let i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),s-=this.mouseX*r,this.lookVertical&&(o-=this.mouseY*r*i),o=Math.max(-85,Math.min(85,o));let a=THREE.MathUtils.degToRad(90-o);const l=THREE.MathUtils.degToRad(s);this.constrainVertical&&(a=THREE.MathUtils.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;e.setFromSphericalCoords(1,a,l).add(c),this.object.lookAt(e)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",r),this.domElement.removeEventListener("mousedown",c),this.domElement.removeEventListener("mousemove",l),this.domElement.removeEventListener("mouseup",u),window.removeEventListener("keydown",h),window.removeEventListener("keyup",d)};const l=this.onMouseMove.bind(this),c=this.onMouseDown.bind(this),u=this.onMouseUp.bind(this),h=this.onKeyDown.bind(this),d=this.onKeyUp.bind(this);function f(n){const r=n.object.quaternion;e.set(0,0,-1).applyQuaternion(r),t.setFromVector3(e),o=90-THREE.MathUtils.radToDeg(t.phi),s=THREE.MathUtils.radToDeg(t.theta)}this.domElement.addEventListener("contextmenu",r),this.domElement.addEventListener("mousemove",l),this.domElement.addEventListener("mousedown",c),this.domElement.addEventListener("mouseup",u),window.addEventListener("keydown",h),window.addEventListener("keyup",d),this.handleResize(),f(this)}}}()},9607:()=>{!function(){const e={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:"\n\n\t\tuniform float mRefractionRatio;\n\t\tuniform float mFresnelBias;\n\t\tuniform float mFresnelScale;\n\t\tuniform float mFresnelPower;\n\n\t\tvarying vec3 vReflect;\n\t\tvarying vec3 vRefract[3];\n\t\tvarying float vReflectionFactor;\n\n\t\tvoid main() {\n\n\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t\t\tvec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n\n\t\t\tvec3 I = worldPosition.xyz - cameraPosition;\n\n\t\t\tvReflect = reflect( I, worldNormal );\n\t\t\tvRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );\n\t\t\tvRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );\n\t\t\tvRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );\n\t\t\tvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );\n\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t}",fragmentShader:"\n\n\t\tuniform samplerCube tCube;\n\n\t\tvarying vec3 vReflect;\n\t\tvarying vec3 vRefract[3];\n\t\tvarying float vReflectionFactor;\n\n\t\tvoid main() {\n\n\t\t\tvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n\t\t\tvec4 refractedColor = vec4( 1.0 );\n\n\t\t\trefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\n\t\t\trefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\n\t\t\trefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\n\n\t\t\tgl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n\n\t\t}"};THREE.FresnelShader=e}()},5992:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e),this.splitLayer=!1}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){let t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1};const n=[];let r;const i=new THREE.LineBasicMaterial({color:16711680});i.name="path";const a=new THREE.LineBasicMaterial({color:65280});function o(e){r={vertex:[],pathVertex:[],z:e.z},n.push(r)}function s(e,n){return t.relative?n:n-e}function l(e,n){return t.relative?e+n:n}a.name="extruded";const c=e.replace(/;.+/g,"").split("\n");for(let e=0;e<c.length;e++){const n=c[e].split(" "),i=n[0].toUpperCase(),a={};if(n.splice(1).forEach((function(e){if(void 0!==e[0]){const t=e[0].toLowerCase(),n=parseFloat(e.substring(1));a[t]=n}})),"G0"===i||"G1"===i){const e={x:void 0!==a.x?l(t.x,a.x):t.x,y:void 0!==a.y?l(t.y,a.y):t.y,z:void 0!==a.z?l(t.z,a.z):t.z,e:void 0!==a.e?l(t.e,a.e):t.e,f:void 0!==a.f?l(t.f,a.f):t.f};s(t.e,e.e)>0&&(e.extruding=s(t.e,e.e)>0,null!=r&&e.z==r.z||o(e)),u=t,h=e,void 0===r&&o(u),t.extruding?(r.vertex.push(u.x,u.y,u.z),r.vertex.push(h.x,h.y,h.z)):(r.pathVertex.push(u.x,u.y,u.z),r.pathVertex.push(h.x,h.y,h.z)),t=e}else if("G2"===i||"G3"===i);else if("G90"===i)t.relative=!1;else if("G91"===i)t.relative=!0;else if("G92"===i){const e=t;e.x=void 0!==a.x?a.x:e.x,e.y=void 0!==a.y?a.y:e.y,e.z=void 0!==a.z?a.z:e.z,e.e=void 0!==a.e?a.e:e.e,t=e}}var u,h;function d(e,t,n){const r=new THREE.BufferGeometry;r.setAttribute("position",new THREE.Float32BufferAttribute(e,3));const o=new THREE.LineSegments(r,t?a:i);o.name="layer"+n,f.add(o)}const f=new THREE.Group;if(f.name="gcode",this.splitLayer)for(let e=0;e<n.length;e++){const t=n[e];d(t.vertex,!0,e),d(t.pathVertex,!1,e)}else{const e=[],t=[];for(let r=0;r<n.length;r++){const i=n[r],a=i.vertex,o=i.pathVertex;for(let t=0;t<a.length;t++)e.push(a[t]);for(let e=0;e<o.length;e++)t.push(o[e])}d(e,!0,n.length),d(t,!1,n.length)}return f.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),f}}THREE.GCodeLoader=e}()},5071:()=>{!function(){class e{constructor(){this.pluginCallbacks=[],this.register((function(e){return new R(e)})),this.register((function(e){return new k(e)})),this.register((function(e){return new P(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n){const r=new S,i=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)i.push(this.pluginCallbacks[e](r));r.setPlugins(i),r.write(e,t,n)}}const t=0,n=1,r=2,i=3,a=4,o=5121,s=5123,l=5126,c=5125,u=34962,h=34963,d=9728,f=9729,p=9984,m=9985,g=9986,v=9987,y=33071,_=33648,b=10497,E={};E[THREE.NearestFilter]=d,E[THREE.NearestMipmapNearestFilter]=p,E[THREE.NearestMipmapLinearFilter]=g,E[THREE.LinearFilter]=f,E[THREE.LinearMipmapNearestFilter]=m,E[THREE.LinearMipmapLinearFilter]=v,E[THREE.ClampToEdgeWrapping]=y,E[THREE.RepeatWrapping]=b,E[THREE.MirroredRepeatWrapping]=_;const w={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function x(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function T(e){return 4*Math.ceil(e/4)}function A(e,t=0){const n=T(e.byteLength);if(n!==e.byteLength){const r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(let i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}let M=null;class S{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}write(e,t,n){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e);const r=this;Promise.all(this.pending).then((function(){const e=r.buffers,n=r.json,i=r.options,a=r.extensionsUsed,o=new Blob(e,{type:"application/octet-stream"}),s=Object.keys(a);if(s.length>0&&(n.extensionsUsed=s),n.buffers&&n.buffers.length>0&&(n.buffers[0].byteLength=o.size),!0===i.binary){const e=new window.FileReader;e.readAsArrayBuffer(o),e.onloadend=function(){const r=A(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,r.byteLength,!0),i.setUint32(4,5130562,!0);const a=A(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;const t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0,r=e.length;n<r;n++){const r=e.charCodeAt(n);t[n]=r>255?32:r}return t.buffer}(JSON.stringify(n)),32),o=new DataView(new ArrayBuffer(8));o.setUint32(0,a.byteLength,!0),o.setUint32(4,1313821514,!0);const s=new ArrayBuffer(12),l=new DataView(s);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);const c=12+o.byteLength+a.byteLength+i.byteLength+r.byteLength;l.setUint32(8,c,!0);const u=new Blob([s,o,a,i,r],{type:"application/octet-stream"}),h=new window.FileReader;h.readAsArrayBuffer(u),h.onloadend=function(){t(h.result)}}}else if(n.buffers&&n.buffers.length>0){const e=new window.FileReader;e.readAsDataURL(o),e.onloadend=function(){const r=e.result;n.buffers[0].uri=r,t(n)}}else t(n)}))}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const n=this.options,r=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&i.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in i.gltfExtensions)t.extensions[e]=i.gltfExtensions[e],r[e]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e){return this.uids.has(e)||this.uids.set(e,this.uid++),this.uids.get(e)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new THREE.Vector3;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new THREE.Vector3;for(let e=0,t=n.count;e<t;e++)r.fromBufferAttribute(n,e),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),n.setXYZ(e,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(r.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,i){const a=this.json;let h;a.bufferViews||(a.bufferViews=[]),h=t===o?1:t===s?2:4;const d=T(r*e.itemSize*h),f=new DataView(new ArrayBuffer(d));let p=0;for(let i=n;i<n+r;i++)for(let n=0;n<e.itemSize;n++){let r;e.itemSize>4?r=e.array[i*e.itemSize+n]:0===n?r=e.getX(i):1===n?r=e.getY(i):2===n?r=e.getZ(i):3===n&&(r=e.getW(i)),t===l?f.setFloat32(p,r,!0):t===c?f.setUint32(p,r,!0):t===s?f.setUint16(p,r,!0):t===o&&f.setUint8(p,r),p+=h}const m={buffer:this.processBuffer(f.buffer),byteOffset:this.byteOffset,byteLength:d};void 0!==i&&(m.target=i),i===u&&(m.byteStride=e.itemSize*h),this.byteOffset+=d,a.bufferViews.push(m);return{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise((function(r){const i=new window.FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){const e=A(i.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,r(n.bufferViews.push(a)-1)}}))}processAccessor(e,t,n,r){const i=this.options,a=this.json;let d;if(e.array.constructor===Float32Array)d=l;else if(e.array.constructor===Uint32Array)d=c;else if(e.array.constructor===Uint16Array)d=s;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");d=o}if(void 0===n&&(n=0),void 0===r&&(r=e.count),i.truncateDrawRange&&void 0!==t&&null===t.index){const i=n+r,a=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),(r=Math.min(i,a)-n)<0&&(r=0)}if(0===r)return null;const f=function(e,t,n){const r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=t;i<t+n;i++)for(let t=0;t<e.itemSize;t++){let n;e.itemSize>4?n=e.array[i*e.itemSize+t]:0===t?n=e.getX(i):1===t?n=e.getY(i):2===t?n=e.getZ(i):3===t&&(n=e.getW(i)),r.min[t]=Math.min(r.min[t],n),r.max[t]=Math.max(r.max[t],n)}return r}(e,n,r);let p;void 0!==t&&(p=e===t.index?h:u);const m=this.processBufferView(e,d,n,r,p),g={bufferView:m.id,byteOffset:m.byteOffset,componentType:d,count:r,max:f.max,min:f.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(g.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(g)-1}processImage(e,t,n){const r=this,i=r.cache,a=r.json,o=r.options,s=r.pending;i.images.has(e)||i.images.set(e,{});const l=i.images.get(e),c=t===THREE.RGBAFormat?"image/png":"image/jpeg",u=c+":flipY/"+n.toString();if(void 0!==l[u])return l[u];a.images||(a.images=[]);const h={mimeType:c};if(o.embedImages){const i=M=M||document.createElement("canvas");i.width=Math.min(e.width,o.maxTextureSize),i.height=Math.min(e.height,o.maxTextureSize);const a=i.getContext("2d");if(!0===n&&(a.translate(0,i.height),a.scale(1,-1)),"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)a.drawImage(e,0,0,i.width,i.height);else{t!==THREE.RGBAFormat&&t!==THREE.RGBFormat&&console.error("GLTFExporter: Only RGB and RGBA formats are supported."),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let n=e.data;if(t===THREE.RGBFormat){n=new Uint8ClampedArray(e.height*e.width*4);for(let t=0,r=0;t<n.length;t+=4,r+=3)n[t+0]=e.data[r+0],n[t+1]=e.data[r+1],n[t+2]=e.data[r+2],n[t+3]=255}a.putImageData(new ImageData(n,e.width,e.height),0,0)}!0===o.binary?s.push(new Promise((function(e){i.toBlob((function(t){r.processBufferViewImage(t).then((function(t){h.bufferView=t,e()}))}),c)}))):h.uri=i.toDataURL(c)}else h.uri=e.src;const d=a.images.push(h)-1;return l[u]=d,d}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:E[e.magFilter],minFilter:E[e.minFilter],wrapS:E[e.wrapS],wrapT:E[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY)};e.name&&(r.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,r)}));const i=n.textures.push(r)-1;return t.textures.set(e,i),i}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const i=e.color.toArray().concat([e.opacity]);if(x(i,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=i),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){const t={index:this.processTexture(e.metalnessMap)};this.applyTextureTransform(t,e.metalnessMap),r.pbrMetallicRoughness.metallicRoughnessTexture=t}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){const t={index:this.processTexture(e.map)};this.applyTextureTransform(t,e.map),r.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(x(t,[0,0,0])||(r.emissiveFactor=t),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(t,e.emissiveMap),r.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),r.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),r.occlusionTexture=t}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===THREE.DoubleSide&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,r)}));const a=n.materials.push(r)-1;return t.materials.set(e,a),a}processMesh(e){const o=this.cache,s=this.json,l=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,n=e.material.length;t<n;t++)l.push(e.material[t].uuid);else l.push(e.material.uuid);const c=l.join(":");if(o.meshes.has(c))return o.meshes.get(c);const u=e.geometry;let h;if(h=e.isLineSegments?n:e.isLineLoop?r:e.isLine?i:e.isPoints?t:e.material.wireframe?n:a,!0!==u.isBufferGeometry)throw new Error("THREE.GLTFExporter: Geometry is not of type THREE.BufferGeometry.");const d={},f={},p=[],m=[],g={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},v=u.getAttribute("normal");void 0===v||this.isNormalizedNormalAttribute(v)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),u.setAttribute("normal",this.createNormalizedNormalAttribute(v)));let y=null;for(let e in u.attributes){if("morph"===e.substr(0,5))continue;const t=u.attributes[e];e=g[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),o.attributes.has(this.getUID(t))){f[e]=o.attributes.get(this.getUID(t));continue}y=null;const n=t.array;"JOINTS_0"!==e||n instanceof Uint16Array||n instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),y=new THREE.BufferAttribute(new Uint16Array(n),t.itemSize,t.normalized));const r=this.processAccessor(y||t,u);null!==r&&(f[e]=r,o.attributes.set(this.getUID(t),r))}if(void 0!==v&&u.setAttribute("normal",v),0===Object.keys(f).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const t=[],n=[],r={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)r[e.morphTargetDictionary[t]]=t;for(let i=0;i<e.morphTargetInfluences.length;++i){const a={};let s=!1;for(const e in u.morphAttributes){if("position"!==e&&"normal"!==e){s||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),s=!0);continue}const t=u.morphAttributes[e][i],n=e.toUpperCase(),r=u.attributes[e];if(o.attributes.has(this.getUID(t))){a[n]=o.attributes.get(this.getUID(t));continue}const l=t.clone();if(!u.morphTargetsRelative)for(let e=0,n=t.count;e<n;e++)l.setXYZ(e,t.getX(e)-r.getX(e),t.getY(e)-r.getY(e),t.getZ(e)-r.getZ(e));a[n]=this.processAccessor(l,u),o.attributes.set(this.getUID(r),a[n])}m.push(a),t.push(e.morphTargetInfluences[i]),void 0!==e.morphTargetDictionary&&n.push(r[i])}d.weights=t,n.length>0&&(d.extras={},d.extras.targetNames=n)}const _=Array.isArray(e.material);if(_&&0===u.groups.length)return null;const b=_?e.material:[e.material],E=_?u.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,t=E.length;e<t;e++){const t={mode:h,attributes:f};if(this.serializeUserData(u,t),m.length>0&&(t.targets=m),null!==u.index){let n=this.getUID(u.index);void 0===E[e].start&&void 0===E[e].count||(n+=":"+E[e].start+":"+E[e].count),o.attributes.has(n)?t.indices=o.attributes.get(n):(t.indices=this.processAccessor(u.index,u,E[e].start,E[e].count),o.attributes.set(n,t.indices)),null===t.indices&&delete t.indices}const n=this.processMaterial(b[E[e].materialIndex]);null!==n&&(t.material=n),p.push(t)}d.primitives=p,s.meshes||(s.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,d)}));const w=s.meshes.push(d)-1;return o.meshes.set(c,w),w}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(t,n){const r=this.json,i=this.nodeMap;r.animations||(r.animations=[]);const a=(t=e.Utils.mergeMorphTargetTracks(t.clone(),n)).tracks,o=[],s=[];for(let e=0;e<a.length;++e){const t=a[e],r=THREE.PropertyBinding.parseTrackName(t.name);let l=THREE.PropertyBinding.findNode(n,r.nodeName);const c=w[r.propertyName];if("bones"===r.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(r.objectIndex):void 0),!l||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',t.name),null;const u=1;let h,d=t.values.length/t.times.length;c===w.morphTargetInfluences&&(d/=l.morphTargetInfluences.length),!0===t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=t.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",s.push({input:this.processAccessor(new THREE.BufferAttribute(t.times,u)),output:this.processAccessor(new THREE.BufferAttribute(t.values,d)),interpolation:h}),o.push({sampler:s.length-1,target:{node:i.get(l),path:c}})}return r.animations.push({name:t.name||"clip_"+r.animations.length,samplers:s,channels:o}),r.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],i=e.skeleton;if(void 0===i)return null;const a=e.skeleton.bones[0];if(void 0===a)return null;const o=[],s=new Float32Array(16*i.bones.length),l=new THREE.Matrix4;for(let t=0;t<i.bones.length;++t)o.push(n.get(i.bones[t])),l.copy(i.boneInverses[t]),l.multiply(e.bindMatrix).toArray(s,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new THREE.BufferAttribute(s,16)),joints:o,skeleton:n.get(a)});return r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const i={};if(n.trs){const t=e.quaternion.toArray(),n=e.position.toArray(),r=e.scale.toArray();x(t,[0,0,0,1])||(i.rotation=t),x(n,[0,0,0])||(i.translation=n),x(r,[1,1,1])||(i.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===x(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(i.matrix=e.matrix.elements);if(""!==e.name&&(i.name=String(e.name)),this.serializeUserData(e,i),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(i.mesh=t)}else e.isCamera&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let r=0,i=e.children.length;r<i;r++){const i=e.children[r];if(i.visible||!1===n.onlyVisible){const e=this.processNode(i);null!==e&&t.push(e)}}t.length>0&&(i.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,i)}));const a=t.nodes.push(i)-1;return r.set(e,a),a}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);const i=[];for(let t=0,r=e.children.length;t<r;t++){const r=e.children[t];if(r.visible||!1===n.onlyVisible){const e=this.processNode(r);null!==e&&i.push(e)}}i.length>0&&(r.nodes=i),this.serializeUserData(e,r)}processObjects(e){const t=new THREE.Scene;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const n=[];for(let t=0;t<e.length;t++)e[t]instanceof THREE.Scene?this.processScene(e[t]):n.push(e[t]);n.length>0&&this.processObjects(n);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class R{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,r=n.json,i=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},i[this.name]=!0);const o=r.extensions[this.name].lights;o.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class k{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class P{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const n=this.writer,r=n.extensionsUsed,i={};t.pbrMetallicRoughness.baseColorFactor&&(i.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const a=[1,1,1];if(e.specular.toArray(a,0),i.specularFactor=a,i.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(i.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const t={index:n.processTexture(e.specularMap)};n.applyTextureTransform(t,e.specularMap),i.specularGlossinessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}e.Utils={insertKeyframe:function(e,t){const n=.001,r=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+r),o=e.createInterpolant(new e.ValueBufferType(r));let s;if(0===e.times.length){i[0]=t;for(let e=0;e<r;e++)a[e]=0;s=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<n)return 0;i[0]=t,i.set(e.times,1),a.set(o.evaluate(t),0),a.set(e.values,r),s=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<n)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),a.set(e.values,0),a.set(o.evaluate(t),e.values.length),s=i.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<n)return l;if(e.times[l]<t&&e.times[l+1]>t){i.set(e.times.slice(0,l+1),0),i[l+1]=t,i.set(e.times.slice(l+1),l+2),a.set(e.values.slice(0,(l+1)*r),0),a.set(o.evaluate(t),(l+1)*r),a.set(e.values.slice((l+1)*r),(l+2)*r),s=l+1;break}}return e.times=i,e.values=a,s},mergeMorphTargetTracks:function(e,t){const n=[],r={},i=e.tracks;for(let e=0;e<i.length;++e){let a=i[e];const o=THREE.PropertyBinding.parseTrackName(a.name),s=THREE.PropertyBinding.findNode(t,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex){n.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(THREE.InterpolateLinear)}const l=s.morphTargetInfluences.length,c=s.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let u;if(void 0===r[s.uuid]){u=a.clone();const e=new u.ValueBufferType(l*u.times.length);for(let t=0;t<u.times.length;t++)e[t*l+c]=u.values[t];u.name=(o.nodeName||"")+".morphTargetInfluences",u.values=e,r[s.uuid]=u,n.push(u);continue}const h=a.createInterpolant(new a.ValueBufferType(1));u=r[s.uuid];for(let e=0;e<u.times.length;e++)u.values[e*l+c]=h.evaluate(u.times[e]);for(let e=0;e<a.times.length;e++){const t=this.insertKeyframe(u,a.times[e]);u.values[t*l+c]=a.values[e]}}return e.tracks=n,e}},THREE.GLTFExporter=e}()},3818:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new a(e)})),this.register((function(e){return new s(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new o(e)})),this.register((function(e){return new r(e)})),this.register((function(e){return new c(e)}))}load(e,t,n,r){const i=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){r?r(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},s=new THREE.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{i.parse(n,a,(function(n){t(n),i.manager.itemEnd(e)}),o)}catch(e){o(e)}}),n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,a){let o;const s={},l={};if("string"==typeof e)o=e;else{if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===u){try{s[n.KHR_BINARY_GLTF]=new f(e)}catch(e){return void(a&&a(e))}o=s[n.KHR_BINARY_GLTF].content}else o=THREE.LoaderUtils.decodeText(new Uint8Array(e))}const c=JSON.parse(o);if(void 0===c.asset||c.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new G(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](h);l[t.name]=t,s[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){const t=c.extensionsUsed[e],r=c.extensionsRequired||[];switch(t){case n.KHR_MATERIALS_UNLIT:s[t]=new i;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new v;break;case n.KHR_DRACO_MESH_COMPRESSION:s[t]=new p(c,this.dracoLoader);break;case n.KHR_TEXTURE_TRANSFORM:s[t]=new m;break;case n.KHR_MESH_QUANTIZATION:s[t]=new y;break;default:r.indexOf(t)>=0&&void 0===l[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}h.setExtensions(s),h.setPlugins(l),h.parse(r,a)}}function t(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class r{constructor(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let o;const s=new THREE.Color(16777215);void 0!==a.color&&s.fromArray(a.color);const l=void 0!==a.range?a.range:0;switch(a.type){case"directional":o=new THREE.DirectionalLight(s),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new THREE.PointLight(s),o.distance=l;break;case"spot":o=new THREE.SpotLight(s),o.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,o.angle=a.spot.outerConeAngle,o.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return o.position.set(0,0,0),o.decay=2,void 0!==a.intensity&&(o.intensity=a.intensity),o.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(o),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class i{constructor(){this.name=n.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(e,t,n){const r=[];e.color=new THREE.Color(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)}}class a{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new THREE.Vector2(e,-e)}return Promise.all(i)}}class o{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class s{constructor(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],a=n.images[i.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)}}class l{constructor(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const a=i.extensions[t],o=r.images[a.source];let s=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,o,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class c{constructor(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,i.ready]).then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,a=e.count,o=e.byteStride,s=new ArrayBuffer(a*o),l=new Uint8Array(t[0],n,r);return i.decodeGltfBuffer(new Uint8Array(s),a,o,l,e.mode,e.filter),s}))}return null}}const u="glTF",h=1313821514,d=5130562;class f{constructor(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==u)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,i=new DataView(e,12);let a=0;for(;a<r;){const t=i.getUint32(a,!0);a+=4;const n=i.getUint32(a,!0);if(a+=4,n===h){const n=new Uint8Array(e,12+a,t);this.content=THREE.LoaderUtils.decodeText(n)}else if(n===d){const n=12+a;this.body=e.slice(n,n+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class p{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(const e in a){const t=L[e]||e.toLowerCase();o[t]=a[e]}for(const t in e.attributes){const r=L[t]||t.toLowerCase();if(void 0!==a[t]){const i=n.accessors[e.attributes[t]],a=S[i.componentType];l[r]=a,s[r]=!0===i.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=s[t];void 0!==r&&(n.normalized=r)}t(e)}),o,l)}))}))}}class m{constructor(){this.name=n.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e}}class g extends THREE.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class v{constructor(){this.name=n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return g}extendParams(e,t,n){const r=t.extensions[this.name];e.color=new THREE.Color(1,1,1),e.opacity=1;const i=[];if(Array.isArray(r.diffuseFactor)){const t=r.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){const t=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",t)),i.push(n.assignTexture(e,"specularMap",t))}return Promise.all(i)}createMaterial(e){const t=new g(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=THREE.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class y{constructor(){this.name=n.KHR_MESH_QUANTIZATION}}class _ extends THREE.Interpolant{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}}_.prototype.beforeStart_=_.prototype.copySampleValue_,_.prototype.afterEnd_=_.prototype.copySampleValue_,_.prototype.interpolate_=function(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=r-t,u=(n-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let e=0;e!==o;e++){const t=a[p+e+o],n=a[p+e+s]*c,r=a[f+e+o],l=a[f+e]*c;i[e]=v*t+y*n+m*r+g*l}return i};const b=0,E=1,w=2,x=3,T=4,A=5,M=6,S={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},R={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},k={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},P={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},L={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},C={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},N="OPAQUE",F="MASK",O="BLEND";function H(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function D(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function U(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function B(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function z(e){const t=e.extensions&&e.extensions[n.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+V(t.attributes):e.indices+":"+V(e.attributes)+":"+e.mode,r}function V(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function j(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class G{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};D(i,a,r),U(a,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone();return r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,n){r.load(H(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);const i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],a=P[r.type],o=S[r.componentType],s=o.BYTES_PER_ELEMENT,l=s*a,c=r.byteOffset||0,u=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,h=!0===r.normalized;let d,f;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let l=t.cache.get(n);l||(d=new o(i,e*u,r.count*u/s),l=new THREE.InterleavedBuffer(d,u/s),t.cache.add(n,l)),f=new THREE.InterleavedBufferAttribute(l,a,c%u/s,h)}else d=null===i?new o(r.count*a):new o(i,c,r.count*a),f=new THREE.BufferAttribute(d,a,h);if(void 0!==r.sparse){const t=P.SCALAR,n=S[r.sparse.indices.componentType],s=r.sparse.indices.byteOffset||0,l=r.sparse.values.byteOffset||0,c=new n(e[1],s,r.sparse.count*t),u=new o(e[2],l,r.sparse.count*a);null!==i&&(f=new THREE.BufferAttribute(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(f.setX(t,u[e*a]),a>=2&&f.setY(t,u[e*a+1]),a>=3&&f.setZ(t,u[e*a+2]),a>=4&&f.setW(t,u[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e],i=t.images[r.source];let a=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,n){const r=this,i=this.json,a=this.options,o=i.textures[e],s=self.URL||self.webkitURL;let l=t.uri,c=!1,u=!0;if("image/jpeg"===t.mimeType&&(u=!1),void 0!==t.bufferView)l=r.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);u=6===t||4===t||3===t}c=!0;const n=new Blob([e],{type:t.mimeType});return l=s.createObjectURL(n),l}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(l).then((function(e){return new Promise((function(t,r){let i=t;!0===n.isImageBitmapLoader&&(i=function(e){t(new THREE.CanvasTexture(e))}),n.load(H(e,a.path),i,void 0,r)}))})).then((function(t){!0===c&&s.revokeObjectURL(l),t.flipY=!1,o.name&&(t.name=o.name),u||(t.format=THREE.RGBFormat);const n=(i.samplers||{})[o.sampler]||{};return t.magFilter=R[n.magFilter]||THREE.LinearFilter,t.minFilter=R[n.minFilter]||THREE.LinearMipmapLinearFilter,t.wrapS=k[n.wrapS]||THREE.RepeatWrapping,t.wrapT=k[n.wrapT]||THREE.RepeatWrapping,r.associations.set(t,{type:"textures",index:e}),t}))}assignTexture(e,t,r){const i=this;return this.getDependency("texture",r.index).then((function(a){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(a);a=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),i.associations.set(a,t)}}e[t]=a}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0!==t.attributes.color,i=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,o=Object.keys(t.morphAttributes).length>0,s=o&&void 0!==t.morphAttributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(r||i||a||o){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),a&&(e+="skinning:"),r&&(e+="vertex-colors:"),i&&(e+="flat-shading:"),o&&(e+="morph-targets:"),s&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=n.clone(),a&&(t.skinning=!0),r&&(t.vertexColors=!0),i&&(t.flatShading=!0),o&&(t.morphTargets=!0),s&&(t.morphNormals=!0),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(e){const t=this,r=this.json,i=this.extensions,a=r.materials[e];let o;const s={},l=a.extensions||{},c=[];if(l[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=i[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=e.getMaterialType(),c.push(e.extendParams(s,a,t))}else if(l[n.KHR_MATERIALS_UNLIT]){const e=i[n.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),c.push(e.extendParams(s,a,t))}else{const n=a.pbrMetallicRoughness||{};if(s.color=new THREE.Color(1,1,1),s.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;s.color.fromArray(e),s.opacity=e[3]}void 0!==n.baseColorTexture&&c.push(t.assignTexture(s,"map",n.baseColorTexture)),s.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,s.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(c.push(t.assignTexture(s,"metalnessMap",n.metallicRoughnessTexture)),c.push(t.assignTexture(s,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===a.doubleSided&&(s.side=THREE.DoubleSide);const u=a.alphaMode||N;return u===O?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,u===F&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&o!==THREE.MeshBasicMaterial&&(c.push(t.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new THREE.Vector2(1,-1),void 0!==a.normalTexture.scale&&s.normalScale.set(a.normalTexture.scale,-a.normalTexture.scale)),void 0!==a.occlusionTexture&&o!==THREE.MeshBasicMaterial&&(c.push(t.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&o!==THREE.MeshBasicMaterial&&(s.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&o!==THREE.MeshBasicMaterial&&c.push(t.assignTexture(s,"emissiveMap",a.emissiveTexture)),Promise.all(c).then((function(){let r;return r=o===g?i[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new o(s),a.name&&(r.name=a.name),r.map&&(r.map.encoding=THREE.sRGBEncoding),r.emissiveMap&&(r.emissiveMap.encoding=THREE.sRGBEncoding),U(r,a),t.associations.set(r,{type:"materials",index:e}),a.extensions&&D(i,r,a),r}))}createUniqueName(e){const t=THREE.PropertyBinding.sanitizeNodeName(e||"");let n=t;for(let e=1;this.nodeNamesUsed[n];++e)n=t+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,r=this.extensions,i=this.primitiveCache;function a(e){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return q(n,e,t)}))}const o=[];for(let r=0,s=e.length;r<s;r++){const s=e[r],l=z(s),c=i[l];if(c)o.push(c.promise);else{let e;e=s.extensions&&s.extensions[n.KHR_DRACO_MESH_COMPRESSION]?a(s):q(new THREE.BufferGeometry,s,t),i[l]={primitive:s,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],a=i.primitives,o=[];for(let e=0,t=a.length;e<t;e++){const t=void 0===a[e].material?(void 0===(s=this.cache).DefaultMaterial&&(s.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),s.DefaultMaterial):this.getDependency("material",a[e].material);o.push(t)}var s;return o.push(t.loadGeometries(a)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),s=n[n.length-1],l=[];for(let n=0,c=s.length;n<c;n++){const c=s[n],u=a[n];let h;const d=o[n];if(u.mode===T||u.mode===A||u.mode===M||void 0===u.mode)h=!0===i.isSkinnedMesh?new THREE.SkinnedMesh(c,d):new THREE.Mesh(c,d),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),u.mode===A?h.geometry=X(h.geometry,THREE.TriangleStripDrawMode):u.mode===M&&(h.geometry=X(h.geometry,THREE.TriangleFanDrawMode));else if(u.mode===E)h=new THREE.LineSegments(c,d);else if(u.mode===x)h=new THREE.Line(c,d);else if(u.mode===w)h=new THREE.LineLoop(c,d);else{if(u.mode!==b)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new THREE.Points(c,d)}Object.keys(h.geometry.morphAttributes).length>0&&B(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),U(h,i),u.extensions&&D(r,h,u),t.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];const c=new THREE.Group;for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new THREE.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),U(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json.animations[e],n=[],r=[],i=[],a=[],o=[];for(let e=0,s=t.channels.length;e<s;e++){const s=t.channels[e],l=t.samplers[s.sampler],c=s.target,u=void 0!==c.node?c.node:c.id,h=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;n.push(this.getDependency("node",u)),r.push(this.getDependency("accessor",h)),i.push(this.getDependency("accessor",d)),a.push(l),o.push(c)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(n){const r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],n=i[e],c=a[e],u=o[e],h=s[e];if(void 0===t)continue;let d;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,C[h.path]){case C.weights:d=THREE.NumberKeyframeTrack;break;case C.rotation:d=THREE.QuaternionKeyframeTrack;break;case C.position:case C.scale:default:d=THREE.VectorKeyframeTrack}const f=t.name?t.name:t.uuid,p=void 0!==u.interpolation?I[u.interpolation]:THREE.InterpolateLinear,m=[];C[h.path]===C.weights?t.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(f);let g=c.array;if(c.normalized){const e=j(g.constructor),t=new Float32Array(g.length);for(let n=0,r=g.length;n<r;n++)t[n]=g[n]*e;g=t}for(let e=0,t=m.length;e<t;e++){const t=new d(m[e]+"."+C[h.path],n.array,g,p);"CUBICSPLINE"===u.interpolation&&(t.createInterpolant=function(e){return new _(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}const c=t.name?t.name:"animation_"+e;return new THREE.AnimationClip(c,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,r=this,i=t.nodes[e],a=i.name?r.createUniqueName(i.name):"";return function(){const t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==i.camera&&t.push(r.getDependency("camera",i.camera).then((function(e){return r._getNodeRef(r.cameraCache,i.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let o;if(o=!0===i.isBone?new THREE.Bone:t.length>1?new THREE.Group:1===t.length?t[0]:new THREE.Object3D,o!==t[0])for(let e=0,n=t.length;e<n;e++)o.add(t[e]);if(i.name&&(o.userData.name=i.name,o.name=a),U(o,i),i.extensions&&D(n,o,i),void 0!==i.matrix){const e=new THREE.Matrix4;e.fromArray(i.matrix),o.applyMatrix4(e)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return r.associations.set(o,{type:"nodes",index:e}),o}))}loadScene(e){const t=this.json,n=this.extensions,r=this.json.scenes[e],i=this,a=new THREE.Group;r.name&&(a.name=i.createUniqueName(r.name)),U(a,r),r.extensions&&D(n,a,r);const o=r.nodes||[],s=[];for(let e=0,n=o.length;e<n;e++)s.push(W(o[e],a,t,i));return Promise.all(s).then((function(){return a}))}}function W(e,t,n,r){const i=n.nodes[e];return r.getDependency("node",e).then((function(e){if(void 0===i.skin)return e;let t;return r.getDependency("skin",i.skin).then((function(e){t=e;const n=[];for(let e=0,i=t.joints.length;e<i;e++)n.push(r.getDependency("node",t.joints[e]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const r=[],i=[];for(let e=0,a=n.length;e<a;e++){const a=n[e];if(a){r.push(a);const n=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*e),i.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new THREE.Skeleton(r,i),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const a=[];if(i.children){const t=i.children;for(let i=0,o=t.length;i<o;i++){const o=t[i];a.push(W(o,e,n,r))}}return Promise.all(a)}))}function q(e,t,n){const r=t.attributes,i=[];function a(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(const t in r){const n=L[t]||t.toLowerCase();n in e.attributes||i.push(a(r[t],n))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(r)}return U(e,t),function(e,t,n){const r=t.attributes,i=new THREE.Box3;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new THREE.Vector3(t[0],t[1],t[2]),new THREE.Vector3(a[0],a[1],a[2])),e.normalized){const t=j(S[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new THREE.Vector3,t=new THREE.Vector3;for(let r=0,i=a.length;r<i;r++){const i=a[r];if(void 0!==i.POSITION){const r=n.json.accessors[i.POSITION],a=r.min,o=r.max;if(void 0!==a&&void 0!==o){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),r.normalized){const e=j(S[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const o=new THREE.Sphere;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=o}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);const a=[],o=[];for(let s=0,l=t.length;s<l;s++){const l=t[s];if(r){const t=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;a.push(t)}if(i){const t=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal;o.push(t)}}return Promise.all([Promise.all(a),Promise.all(o)]).then((function(t){const n=t[0],a=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function X(e,t){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(t===THREE.TriangleFanDrawMode)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(i),a}THREE.GLTFLoader=e}()},3425:()=>{THREE.GPUComputationRenderer=class{constructor(e,t,n){this.variables=[],this.currentTextureIndex=0;let r=THREE.FloatType;const i=new THREE.Scene,a=new THREE.Camera;a.position.z=1;const o={passThruTexture:{value:null}},s=u("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",o),l=new THREE.Mesh(new THREE.PlaneGeometry(2,2),s);function c(n){n.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function u(e,t){t=t||{};const n=new THREE.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return c(n),n}i.add(l),this.setDataType=function(e){return r=e,this},this.addVariable=function(e,t,n){const r={name:e,initialValueTexture:n,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};return this.variables.push(r),r},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===n.capabilities.isWebGL2&&!1===n.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===n.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let n=0;n<this.variables.length;n++){const r=this.variables[n];r.renderTargets[0]=this.createRenderTarget(e,t,r.wrapS,r.wrapT,r.minFilter,r.magFilter),r.renderTargets[1]=this.createRenderTarget(e,t,r.wrapS,r.wrapT,r.minFilter,r.magFilter),this.renderTexture(r.initialValueTexture,r.renderTargets[0]),this.renderTexture(r.initialValueTexture,r.renderTargets[1]);const i=r.material,a=i.uniforms;if(null!==r.dependencies)for(let e=0;e<r.dependencies.length;e++){const t=r.dependencies[e];if(t.name!==r.name){let e=!1;for(let n=0;n<this.variables.length;n++)if(t.name===this.variables[n].name){e=!0;break}if(!e)return"Variable dependency not found. Variable="+r.name+", dependency="+t.name}a[t.name]={value:null},i.fragmentShader="\nuniform sampler2D "+t.name+";\n"+i.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let n=0,r=this.variables.length;n<r;n++){const r=this.variables[n];if(null!==r.dependencies){const t=r.material.uniforms;for(let n=0,i=r.dependencies.length;n<i;n++){const i=r.dependencies[n];t[i.name].value=i.renderTargets[e].texture}}this.doRenderTarget(r.material,r.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=c,this.createShaderMaterial=u,this.createRenderTarget=function(n,i,a,o,s,l){return n=n||e,i=i||t,a=a||THREE.ClampToEdgeWrapping,o=o||THREE.ClampToEdgeWrapping,s=s||THREE.NearestFilter,l=l||THREE.NearestFilter,new THREE.WebGLRenderTarget(n,i,{wrapS:a,wrapT:o,minFilter:s,magFilter:l,format:THREE.RGBAFormat,type:r,depthBuffer:!1})},this.createTexture=function(){const n=new Float32Array(e*t*4);return new THREE.DataTexture(n,e,t,THREE.RGBAFormat,THREE.FloatType)},this.renderTexture=function(e,t){o.passThruTexture.value=e,this.doRenderTarget(s,t),o.passThruTexture.value=null},this.doRenderTarget=function(e,t){const r=n.getRenderTarget();l.material=e,n.setRenderTarget(t),n.render(i,a),l.material=s,n.setRenderTarget(r)}}}},9929:()=>{!function(){const e={uniforms:{tDiffuse:{value:null}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 tex = texture2D( tDiffuse, vUv );\n\n\t\t\tgl_FragColor = LinearTosRGB( tex ); // optional: LinearToGamma( tex, float( GAMMA_FACTOR ) );\n\n\t\t}"};THREE.GammaCorrectionShader=e}()},6842:()=>{!function(){const e=new THREE.Matrix4,t=new THREE.Object3D,n=new THREE.Vector3;class r extends THREE.EventDispatcher{constructor(){super(),this.uuid=THREE.MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){const t=(new THREE.Matrix3).getNormalMatrix(e);for(let t=0,n=this.vertices.length;t<n;t++){this.vertices[t].applyMatrix4(e)}for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];n.normal.applyMatrix3(t).normalize();for(let e=0,r=n.vertexNormals.length;e<r;e++)n.vertexNormals[e].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(t){return e.makeRotationX(t),this.applyMatrix4(e),this}rotateY(t){return e.makeRotationY(t),this.applyMatrix4(e),this}rotateZ(t){return e.makeRotationZ(t),this.applyMatrix4(e),this}translate(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix4(e),this}scale(t,n,r){return e.makeScale(t,n,r),this.applyMatrix4(e),this}lookAt(e){return t.lookAt(e),t.updateMatrix(),this.applyMatrix4(t.matrix),this}fromBufferGeometry(e){const t=this,n=null!==e.index?e.index:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const i=r.position,o=r.normal,s=r.color,l=r.uv,c=r.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let e=0;e<i.count;e++)t.vertices.push((new THREE.Vector3).fromBufferAttribute(i,e)),void 0!==s&&t.colors.push((new THREE.Color).fromBufferAttribute(s,e));function u(e,n,r,i){const u=void 0===s?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],h=void 0===o?[]:[(new THREE.Vector3).fromBufferAttribute(o,e),(new THREE.Vector3).fromBufferAttribute(o,n),(new THREE.Vector3).fromBufferAttribute(o,r)],d=new a(e,n,r,h,u,i);t.faces.push(d),void 0!==l&&t.faceVertexUvs[0].push([(new THREE.Vector2).fromBufferAttribute(l,e),(new THREE.Vector2).fromBufferAttribute(l,n),(new THREE.Vector2).fromBufferAttribute(l,r)]),void 0!==c&&t.faceVertexUvs[1].push([(new THREE.Vector2).fromBufferAttribute(c,e),(new THREE.Vector2).fromBufferAttribute(c,n),(new THREE.Vector2).fromBufferAttribute(c,r)])}const h=e.groups;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)void 0!==n?u(n.getX(e),n.getX(e+1),n.getX(e+2),t.materialIndex):u(e,e+1,e+2,t.materialIndex)}else if(void 0!==n)for(let e=0;e<n.count;e+=3)u(n.getX(e),n.getX(e+1),n.getX(e+2));else for(let e=0;e<i.count;e+=3)u(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(n).negate(),this.translate(n.x,n.y,n.z),this}normalize(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new THREE.Matrix4;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){const e=new THREE.Vector3,t=new THREE.Vector3;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],i=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];e.subVectors(o,a),t.subVectors(i,a),e.cross(t),e.normalize(),r.normal.copy(e)}}computeVertexNormals(e=!0){const t=new Array(this.vertices.length);for(let e=0,n=this.vertices.length;e<n;e++)t[e]=new THREE.Vector3;if(e){const e=new THREE.Vector3,n=new THREE.Vector3;for(let r=0,i=this.faces.length;r<i;r++){const i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),n.subVectors(a,o),e.cross(n),t[i.a].add(e),t[i.b].add(e),t[i.c].add(e)}}else{this.computeFaceNormals();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let e=0,n=this.vertices.length;e<n;e++)t[e].normalize();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(t[n.a]),r[1].copy(t[n.b]),r[2].copy(t[n.c])):(r[0]=t[n.a].clone(),r[1]=t[n.b].clone(),r[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],n=t.vertexNormals;3===n.length?(n[0].copy(t.normal),n[1].copy(t.normal),n[2].copy(t.normal)):(n[0]=t.normal.clone(),n[1]=t.normal.clone(),n[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,n=t.vertexNormals.length;e<n;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}const e=new r;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,r=this.faces.length;t<r;t++){const t=new THREE.Vector3,r={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};e.push(t),n.push(r)}}const n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],r=n.faceNormals[e],i=n.vertexNormals[e];r.copy(t.normal),i.a.copy(t.vertexNormals[0]),i.b.copy(t.vertexNormals[1]),i.c.copy(t.vertexNormals[2])}}for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,n=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let r;const i=this.vertices.length,o=this.vertices,s=e.vertices,l=this.faces,c=e.faces,u=this.colors,h=e.colors;void 0!==t&&(r=(new THREE.Matrix3).getNormalMatrix(t));for(let e=0,n=s.length;e<n;e++){const n=s[e].clone();void 0!==t&&n.applyMatrix4(t),o.push(n)}for(let e=0,t=h.length;e<t;e++)u.push(h[e].clone());for(let e=0,t=c.length;e<t;e++){const t=c[e];let o,s;const u=t.vertexNormals,h=t.vertexColors,d=new a(t.a+i,t.b+i,t.c+i);d.normal.copy(t.normal),void 0!==r&&d.normal.applyMatrix3(r).normalize();for(let e=0,t=u.length;e<t;e++)o=u[e].clone(),void 0!==r&&o.applyMatrix3(r).normalize(),d.vertexNormals.push(o);d.color.copy(t.color);for(let e=0,t=h.length;e<t;e++)s=h[e],d.vertexColors.push(s.clone());d.materialIndex=t.materialIndex+n,l.push(d)}for(let t=0,n=e.faceVertexUvs.length;t<n;t++){const n=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,r=n.length;e<r;e++){const r=n[e],i=[];for(let e=0,t=r.length;e<t;e++)i.push(r[e].clone());this.faceVertexUvs[t].push(i)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(e=4){const t={},n=[],r=[],i=Math.pow(10,e);for(let e=0,a=this.vertices.length;e<a;e++){const a=this.vertices[e],o=Math.round(a.x*i)+"_"+Math.round(a.y*i)+"_"+Math.round(a.z*i);void 0===t[o]?(t[o]=e,n.push(this.vertices[e]),r[e]=n.length-1):r[e]=r[t[o]]}const a=[];for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.a=r[t.a],t.b=r[t.b],t.c=r[t.c];const n=[t.a,t.b,t.c];for(let t=0;t<3;t++)if(n[t]===n[(t+1)%3]){a.push(e);break}}for(let e=a.length-1;e>=0;e--){const t=a[e];this.faces.splice(t,1);for(let e=0,n=this.faceVertexUvs.length;e<n;e++)this.faceVertexUvs[e].splice(t,1)}const o=this.vertices.length-n.length;return this.vertices=n,o}setFromPoints(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];this.vertices.push(new THREE.Vector3(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){const e=this.faces,t=e.length;for(let n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let i,a;n&&n.length===t&&(i=[]),r&&r.length===t&&(a=[]);for(let o=0;o<t;o++){const t=e[o]._id;i&&i.push(n[t]),a&&a.push(r[t])}i&&(this.faceVertexUvs[0]=i),a&&(this.faceVertexUvs[1]=a)}toJSON(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}const t=[];for(let e=0;e<this.vertices.length;e++){const n=this.vertices[e];t.push(n.x,n.y,n.z)}const n=[],r=[],i={},a=[],o={},s=[],l={};for(let e=0;e<this.faces.length;e++){const t=this.faces[e],r=!0,i=!1,a=void 0!==this.faceVertexUvs[0][e],o=t.normal.length()>0,s=t.vertexNormals.length>0,l=1!==t.color.r||1!==t.color.g||1!==t.color.b,f=t.vertexColors.length>0;let p=0;if(p=c(p,0,0),p=c(p,1,r),p=c(p,2,i),p=c(p,3,a),p=c(p,4,o),p=c(p,5,s),p=c(p,6,l),p=c(p,7,f),n.push(p),n.push(t.a,t.b,t.c),n.push(t.materialIndex),a){const t=this.faceVertexUvs[0][e];n.push(d(t[0]),d(t[1]),d(t[2]))}if(o&&n.push(u(t.normal)),s){const e=t.vertexNormals;n.push(u(e[0]),u(e[1]),u(e[2]))}if(l&&n.push(h(t.color)),f){const e=t.vertexColors;n.push(h(e[0]),h(e[1]),h(e[2]))}}function c(e,t,n){return n?e|1<<t:e&~(1<<t)}function u(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==i[t]||(i[t]=r.length/3,r.push(e.x,e.y,e.z)),i[t]}function h(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==o[t]||(o[t]=a.length,a.push(e.getHex())),o[t]}function d(e){const t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=s.length/2,s.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=r,a.length>0&&(e.data.colors=a),s.length>0&&(e.data.uvs=[s]),e.data.faces=n,e}clone(){return(new r).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let e=0,n=t.length;e<n;e++)this.vertices.push(t[e].clone());const n=e.colors;for(let e=0,t=n.length;e<t;e++)this.colors.push(n[e].clone());const r=e.faces;for(let e=0,t=r.length;e<t;e++)this.faces.push(r[e].clone());for(let t=0,n=e.faceVertexUvs.length;t<n;t++){const n=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,r=n.length;e<r;e++){const r=n[e],i=[];for(let e=0,t=r.length;e<t;e++){const t=r[e];i.push(t.clone())}this.faceVertexUvs[t].push(i)}}const i=e.morphTargets;for(let e=0,t=i.length;e<t;e++){const t={};if(t.name=i[e].name,void 0!==i[e].vertices){t.vertices=[];for(let n=0,r=i[e].vertices.length;n<r;n++)t.vertices.push(i[e].vertices[n].clone())}if(void 0!==i[e].normals){t.normals=[];for(let n=0,r=i[e].normals.length;n<r;n++)t.normals.push(i[e].normals[n].clone())}this.morphTargets.push(t)}const a=e.morphNormals;for(let e=0,t=a.length;e<t;e++){const t={};if(void 0!==a[e].vertexNormals){t.vertexNormals=[];for(let n=0,r=a[e].vertexNormals.length;n<r;n++){const r=a[e].vertexNormals[n],i={};i.a=r.a.clone(),i.b=r.b.clone(),i.c=r.c.clone(),t.vertexNormals.push(i)}}if(void 0!==a[e].faceNormals){t.faceNormals=[];for(let n=0,r=a[e].faceNormals.length;n<r;n++)t.faceNormals.push(a[e].faceNormals[n].clone())}this.morphNormals.push(t)}const o=e.skinWeights;for(let e=0,t=o.length;e<t;e++)this.skinWeights.push(o[e].clone());const s=e.skinIndices;for(let e=0,t=s.length;e<t;e++)this.skinIndices.push(s[e].clone());const l=e.lineDistances;for(let e=0,t=l.length;e<t;e++)this.lineDistances.push(l[e]);const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){const e=(new i).fromGeometry(this),t=new THREE.BufferGeometry,n=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",new THREE.BufferAttribute(n,3).copyVector3sArray(e.vertices)),e.normals.length>0){const n=new Float32Array(3*e.normals.length);t.setAttribute("normal",new THREE.BufferAttribute(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const n=new Float32Array(3*e.colors.length);t.setAttribute("color",new THREE.BufferAttribute(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const n=new Float32Array(2*e.uvs.length);t.setAttribute("uv",new THREE.BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const n=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",new THREE.BufferAttribute(n,2).copyVector2sArray(e.uvs2))}t.groups=e.groups;for(const n in e.morphTargets){const r=[],i=e.morphTargets[n];for(let e=0,t=i.length;e<t;e++){const t=i[e],n=new THREE.Float32BufferAttribute(3*t.data.length,3);n.name=t.name,r.push(n.copyVector3sArray(t.data))}t.morphAttributes[n]=r}if(e.skinIndices.length>0){const n=new THREE.Float32BufferAttribute(4*e.skinIndices.length,4);t.setAttribute("skinIndex",n.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const n=new THREE.Float32BufferAttribute(4*e.skinWeights.length,4);t.setAttribute("skinWeight",n.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new THREE.BufferGeometry;const n=e.geometry;if(e.isPoints||e.isLine){const e=new THREE.Float32BufferAttribute(3*n.vertices.length,3),r=new THREE.Float32BufferAttribute(3*n.colors.length,3);if(t.setAttribute("position",e.copyVector3sArray(n.vertices)),t.setAttribute("color",r.copyColorsArray(n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){const e=new THREE.Float32BufferAttribute(n.lineDistances.length,1);t.setAttribute("lineDistance",e.copyArray(n.lineDistances))}null!==n.boundingSphere&&(t.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(t.boundingBox=n.boundingBox.clone())}else e.isMesh&&(t=n.toBufferGeometry());return t}}r.prototype.isGeometry=!0;class i{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let n,r,i;const a=e.faces;for(r=0;r<a.length;r++){const e=a[r];e.materialIndex!==i&&(i=e.materialIndex,void 0!==n&&(n.count=3*r-n.start,t.push(n)),n={start:3*r,materialIndex:i})}void 0!==n&&(n.count=3*r-n.start,t.push(n)),this.groups=t}fromGeometry(e){const t=e.faces,n=e.vertices,r=e.faceVertexUvs,i=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,o=e.morphTargets,s=o.length;let l;if(s>0){l=[];for(let e=0;e<s;e++)l[e]={name:o[e].name,data:[]};this.morphTargets.position=l}const c=e.morphNormals,u=c.length;let h;if(u>0){h=[];for(let e=0;e<u;e++)h[e]={name:c[e].name,data:[]};this.morphTargets.normal=h}const d=e.skinIndices,f=e.skinWeights,p=d.length===n.length,m=f.length===n.length;n.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let e=0;e<t.length;e++){const g=t[e];this.vertices.push(n[g.a],n[g.b],n[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const e=g.normal;this.normals.push(e,e,e)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const e=g.color;this.colors.push(e,e,e)}if(!0===i){const t=r[0][e];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",e),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}if(!0===a){const t=r[1][e];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",e),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}for(let e=0;e<s;e++){const t=o[e].vertices;l[e].data.push(t[g.a],t[g.b],t[g.c])}for(let t=0;t<u;t++){const n=c[t].vertexNormals[e];h[t].data.push(n.a,n.b,n.c)}p&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),m&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}class a{constructor(e,t,n,r,i,a=0){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new THREE.Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new THREE.Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=a}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}THREE.Face3=a,THREE.Geometry=r}()},1553:()=>{!function(){class e extends THREE.Pass{constructor(e=64){super(),void 0===THREE.DigitalGlitch&&console.error("THREE.GlitchPass relies on THREE.DigitalGlitch");const t=THREE.DigitalGlitch;this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new THREE.FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=THREE.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=THREE.MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=THREE.MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=THREE.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=THREE.MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=THREE.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=THREE.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=THREE.MathUtils.randFloat(0,1),this.uniforms.seed_x.value=THREE.MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=THREE.MathUtils.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}generateTrigger(){this.randX=THREE.MathUtils.randInt(120,240)}generateHeightmap(e){const t=new Float32Array(e*e*3),n=e*e;for(let e=0;e<n;e++){const n=THREE.MathUtils.randFloat(0,1);t[3*e+0]=n,t[3*e+1]=n,t[3*e+2]=n}return new THREE.DataTexture(t,e,e,THREE.RGBFormat,THREE.FloatType)}}THREE.GlitchPass=e}()},801:()=>{!function(){const e={uniforms:{tInput:{value:null}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t vUv = uv;\n\t\t gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t }",fragmentShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tInput;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );\n\n\t\t}"},t={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new THREE.Vector3}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t vUv = uv;\n\t\t gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t }",fragmentShader:'\n\n\t\t#define TAPS_PER_PASS 6.0\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tInput;\n\n\t\tuniform vec3 vSunPositionScreenSpace;\n\t\tuniform float fStepSize; // filter step size\n\n\t\tvoid main() {\n\n\t\t// delta from current pixel to "sun" position\n\n\t\t\tvec2 delta = vSunPositionScreenSpace.xy - vUv;\n\t\t\tfloat dist = length( delta );\n\n\t\t// Step vector (uv space)\n\n\t\t\tvec2 stepv = fStepSize * delta / dist;\n\n\t\t// Number of iterations between pixel and sun\n\n\t\t\tfloat iters = dist/fStepSize;\n\n\t\t\tvec2 uv = vUv.xy;\n\t\t\tfloat col = 0.0;\n\n\t\t// This breaks ANGLE in Chrome 22\n\t\t//\t- see http://code.google.com/p/chromium/issues/detail?id=153105\n\n\t\t/*\n\t\t// Unrolling didnt do much on my hardware (ATI Mobility Radeon 3450),\n\t\t// so i\'ve just left the loop\n\n\t\t"for ( float i = 0.0; i < TAPS_PER_PASS; i += 1.0 ) {",\n\n\t\t// Accumulate samples, making sure we dont walk past the light source.\n\n\t\t// The check for uv.y < 1 would not be necessary with "border" UV wrap\n\t\t// mode, with a black border color. I don\'t think this is currently\n\t\t// exposed by three.js. As a result there might be artifacts when the\n\t\t// sun is to the left, right or bottom of screen as these cases are\n\t\t// not specifically handled.\n\n\t\t"\tcol += ( i <= iters && uv.y < 1.0 ? texture2D( tInput, uv ).r : 0.0 );",\n\t\t"\tuv += stepv;",\n\n\t\t"}",\n\t\t*/\n\n\t\t// Unrolling loop manually makes it work in ANGLE\n\n\t\t\tfloat f = min( 1.0, max( vSunPositionScreenSpace.z / 1000.0, 0.0 ) ); // used to fade out godrays\n\n\t\t\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n\t\t\tuv += stepv;\n\n\t\t\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n\t\t\tuv += stepv;\n\n\t\t\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n\t\t\tuv += stepv;\n\n\t\t\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n\t\t\tuv += stepv;\n\n\t\t\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n\t\t\tuv += stepv;\n\n\t\t\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n\t\t\tuv += stepv;\n\n\t\t// Should technically be dividing by \'iters but \'TAPS_PER_PASS\' smooths out\n\t\t// objectionable artifacts, in particular near the sun position. The side\n\t\t// effect is that the result is darker than it should be around the sun, as\n\t\t// TAPS_PER_PASS is greater than the number of samples actually accumulated.\n\t\t// When the result is inverted (in the shader \'godrays_combine this produces\n\t\t// a slight bright spot at the position of the sun, even when it is occluded.\n\n\t\t\tgl_FragColor = vec4( col/TAPS_PER_PASS );\n\t\t\tgl_FragColor.a = 1.0;\n\n\t\t}'},n={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tColors;\n\t\tuniform sampler2D tGodRays;\n\n\t\tuniform float fGodRayIntensity;\n\n\t\tvoid main() {\n\n\t\t// Since THREE.MeshDepthMaterial renders foreground objects white and background\n\t\t// objects black, the god-rays will be white streaks. Therefore value is inverted\n\t\t// before being combined with tColors\n\n\t\t\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );\n\t\t\tgl_FragColor.a = 1.0;\n\n\t\t}"},r={uniforms:{vSunPositionScreenSpace:{value:new THREE.Vector3},fAspect:{value:1},sunColor:{value:new THREE.Color(16772608)},bgColor:{value:new THREE.Color(0)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform vec3 vSunPositionScreenSpace;\n\t\tuniform float fAspect;\n\n\t\tuniform vec3 sunColor;\n\t\tuniform vec3 bgColor;\n\n\t\tvoid main() {\n\n\t\t\tvec2 diff = vUv - vSunPositionScreenSpace.xy;\n\n\t\t// Correct for aspect ratio\n\n\t\t\tdiff.x *= fAspect;\n\n\t\t\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );\n\t\t\tprop = 0.35 * pow( 1.0 - prop, 3.0 );\n\n\t\t\tgl_FragColor.xyz = ( vSunPositionScreenSpace.z > 0.0 ) ? mix( sunColor, bgColor, 1.0 - prop ) : bgColor;\n\t\t\tgl_FragColor.w = 1.0;\n\n\t\t}"};THREE.GodRaysCombineShader=n,THREE.GodRaysDepthMaskShader=e,THREE.GodRaysFakeSunShader=r,THREE.GodRaysGenerateShader=t}()},5847:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e),this.hdrLoader=new THREE.RGBELoader,this.type=THREE.UnsignedByteType}load(e,t,n,r){Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(e),e=t,t=n,n=r,r=arguments[4]);const i=new THREE.CubeTexture;switch(i.type=this.type,i.type){case THREE.UnsignedByteType:i.encoding=THREE.RGBEEncoding,i.format=THREE.RGBAFormat,i.minFilter=THREE.NearestFilter,i.magFilter=THREE.NearestFilter,i.generateMipmaps=!1;break;case THREE.FloatType:case THREE.HalfFloatType:i.encoding=THREE.LinearEncoding,i.format=THREE.RGBFormat,i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.generateMipmaps=!1}const a=this;let o=0;function s(t,n,r,s){new THREE.FileLoader(a.manager).setPath(a.path).setResponseType("arraybuffer").setWithCredentials(a.withCredentials).load(e[t],(function(e){o++;const r=a.hdrLoader.parse(e);if(r){if(void 0!==r.data){const e=new THREE.DataTexture(r.data,r.width,r.height);e.type=i.type,e.encoding=i.encoding,e.format=i.format,e.minFilter=i.minFilter,e.magFilter=i.magFilter,e.generateMipmaps=i.generateMipmaps,i.images[t]=e}6===o&&(i.needsUpdate=!0,n&&n(i))}}),r,s)}for(let i=0;i<e.length;i++)s(i,t,n,r);return i}setDataType(e){return this.type=e,this.hdrLoader.setDataType(e),this}}THREE.HDRCubeTextureLoader=e}()},1517:()=>{!function(){const e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let t=0;t<256;t++)e[256+t]=e[t];function t(e){return e*e*e*(e*(6*e-15)+10)}function n(e,t,n){return t+e*(n-t)}function r(e,t,n,r){const i=15&e,a=i<8?t:n,o=i<4?n:12==i||14==i?t:r;return(0==(1&i)?a:-a)+(0==(2&i)?o:-o)}THREE.ImprovedNoise=class{noise(i,a,o){const s=Math.floor(i),l=Math.floor(a),c=Math.floor(o),u=255&s,h=255&l,d=255&c,f=(i-=s)-1,p=(a-=l)-1,m=(o-=c)-1,g=t(i),v=t(a),y=t(o),_=e[u]+h,b=e[_]+d,E=e[_+1]+d,w=e[u+1]+h,x=e[w]+d,T=e[w+1]+d;return n(y,n(v,n(g,r(e[b],i,a,o),r(e[x],f,a,o)),n(g,r(e[E],i,p,o),r(e[T],f,p,o))),n(v,n(g,r(e[b+1],i,a,m),r(e[x+1],f,a,m)),n(g,r(e[E+1],i,p,m),r(e[T+1],f,p,m))))}}}()},5151:(e,t,n)=>{"use strict";n.r(t);var r=n(743);!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=new THREE.LoadingManager;t.setURLModifier((function(e){const t=function(e){for(const t in n)if(t.substr(-e.length)===e)return n[t]}(e);if(t){console.log("Loading",e);const n=new Blob([t.buffer],{type:"application/octet-stream"});return URL.createObjectURL(n)}return e}));const n=r.unzipSync(new Uint8Array(e));if(n["doc.kml"]){const e=(new DOMParser).parseFromString(r.strFromU8(n["doc.kml"]),"application/xml").querySelector("Placemark Model Link href");if(e){return new THREE.ColladaLoader(t).parse(r.strFromU8(n[e.textContent]))}}else{console.warn("KMZLoader: Missing doc.kml file.");for(const e in n){if("dae"===e.split(".").pop().toLowerCase()){return new THREE.ColladaLoader(t).parse(r.strFromU8(n[e]))}}}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new THREE.Group}}}THREE.KMZLoader=e}()},2596:()=>{function e(){}var t,n,r,i;e.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,n=0,r=t.length;n<r;n+=2){var i=t[n],a=t[n+1];if(i.test(e))return a}return null}},Object.assign(e.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,n){for(var r=[],i=0;i<e.length;++i)r[i]=this.createMaterial(e[i],t,n);return r},createMaterial:(t={NoBlending:THREE.NoBlending,NormalBlending:THREE.NormalBlending,AdditiveBlending:THREE.AdditiveBlending,SubtractiveBlending:THREE.SubtractiveBlending,MultiplyBlending:THREE.MultiplyBlending,CustomBlending:THREE.CustomBlending},n=new THREE.Color,r=new THREE.TextureLoader,i=new THREE.MaterialLoader,function(a,o,s){var l={};function c(t,n,i,a,c){var u,h=o+t,d=e.Handlers.get(h);null!==d?u=d.load(h):(r.setCrossOrigin(s),u=r.load(h)),void 0!==n&&(u.repeat.fromArray(n),1!==n[0]&&(u.wrapS=THREE.RepeatWrapping),1!==n[1]&&(u.wrapT=THREE.RepeatWrapping)),void 0!==i&&u.offset.fromArray(i),void 0!==a&&("repeat"===a[0]&&(u.wrapS=THREE.RepeatWrapping),"mirror"===a[0]&&(u.wrapS=THREE.MirroredRepeatWrapping),"repeat"===a[1]&&(u.wrapT=THREE.RepeatWrapping),"mirror"===a[1]&&(u.wrapT=THREE.MirroredRepeatWrapping)),void 0!==c&&(u.anisotropy=c);var f=THREE.MathUtils.generateUUID();return l[f]=u,f}var u={uuid:THREE.MathUtils.generateUUID(),type:"MeshLambertMaterial"};for(var h in a){var d=a[h];switch(h){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":u.name=d;break;case"blending":u.blending=t[d];break;case"colorAmbient":case"mapAmbient":console.warn("THREE_Loader.createMaterial:",h,"is no longer supported.");break;case"colorDiffuse":u.color=n.fromArray(d).getHex();break;case"colorSpecular":u.specular=n.fromArray(d).getHex();break;case"colorEmissive":u.emissive=n.fromArray(d).getHex();break;case"specularCoef":u.shininess=d;break;case"shading":"basic"===d.toLowerCase()&&(u.type="MeshBasicMaterial"),"phong"===d.toLowerCase()&&(u.type="MeshPhongMaterial"),"standard"===d.toLowerCase()&&(u.type="MeshStandardMaterial");break;case"mapDiffuse":u.map=c(d,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":u.emissiveMap=c(d,a.mapEmissiveRepeat,a.mapEmissiveOffset,a.mapEmissiveWrap,a.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":u.lightMap=c(d,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":u.aoMap=c(d,a.mapAORepeat,a.mapAOOffset,a.mapAOWrap,a.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":u.bumpMap=c(d,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy);break;case"mapBumpScale":u.bumpScale=d;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":u.normalMap=c(d,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy);break;case"mapNormalFactor":u.normalScale=d;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":u.specularMap=c(d,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":u.metalnessMap=c(d,a.mapMetalnessRepeat,a.mapMetalnessOffset,a.mapMetalnessWrap,a.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":u.roughnessMap=c(d,a.mapRoughnessRepeat,a.mapRoughnessOffset,a.mapRoughnessWrap,a.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":u.alphaMap=c(d,a.mapAlphaRepeat,a.mapAlphaOffset,a.mapAlphaWrap,a.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":u.side=THREE.BackSide;break;case"doubleSided":u.side=THREE.DoubleSide;break;case"transparency":console.warn("THREE_Loader.createMaterial: transparency has been renamed to opacity"),u.opacity=d;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":u[h]=d;break;case"vertexColors":!0===d&&(u.vertexColors=THREE.VertexColors),"face"===d&&(u.vertexColors=THREE.FaceColors);break;default:console.error("THREE_Loader.createMaterial: Unsupported",h,d)}}return"MeshBasicMaterial"===u.type&&delete u.emissive,"MeshPhongMaterial"!==u.type&&delete u.specular,u.opacity<1&&(u.transparent=!0),i.setTextures(l),i.parse(u)})}),THREE.LegacyJSONLoader=function(){function t(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1}return Object.assign(t.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){var i=this,a=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){var r=JSON.parse(n),o=r.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(r,a);t(l.geometry,l.materials)}),n,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,n){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var r=new THREE.Geometry;return function(e,t){function n(e,t){return e&1<<t}var r,i,a,o,s,l,c,u,h,d,f,p,m,g,v,y,_,b,E,w,x,T,A,M,S,R,k,P=e.faces,L=e.vertices,C=e.normals,I=e.colors,N=e.scale,F=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&F++;for(r=0;r<F;r++)t.faceVertexUvs[r]=[]}for(o=0,s=L.length;o<s;)(b=new THREE.Vector3).x=L[o++]*N,b.y=L[o++]*N,b.z=L[o++]*N,t.vertices.push(b);for(o=0,s=P.length;o<s;)if(f=n(d=P[o++],0),p=n(d,1),m=n(d,3),g=n(d,4),v=n(d,5),y=n(d,6),_=n(d,7),f){if((w=new THREE.Face3).a=P[o],w.b=P[o+1],w.c=P[o+3],(x=new THREE.Face3).a=P[o+1],x.b=P[o+2],x.c=P[o+3],o+=4,p&&(h=P[o++],w.materialIndex=h,x.materialIndex=h),a=t.faces.length,m)for(r=0;r<F;r++)for(M=e.uvs[r],t.faceVertexUvs[r][a]=[],t.faceVertexUvs[r][a+1]=[],i=0;i<4;i++)R=M[2*(u=P[o++])],k=M[2*u+1],S=new THREE.Vector2(R,k),2!==i&&t.faceVertexUvs[r][a].push(S),0!==i&&t.faceVertexUvs[r][a+1].push(S);if(g&&(c=3*P[o++],w.normal.set(C[c++],C[c++],C[c]),x.normal.copy(w.normal)),v)for(r=0;r<4;r++)c=3*P[o++],A=new THREE.Vector3(C[c++],C[c++],C[c]),2!==r&&w.vertexNormals.push(A),0!==r&&x.vertexNormals.push(A);if(y&&(T=I[l=P[o++]],w.color.setHex(T),x.color.setHex(T)),_)for(r=0;r<4;r++)T=I[l=P[o++]],2!==r&&w.vertexColors.push(new THREE.Color(T)),0!==r&&x.vertexColors.push(new THREE.Color(T));t.faces.push(w),t.faces.push(x)}else{if((E=new THREE.Face3).a=P[o++],E.b=P[o++],E.c=P[o++],p&&(h=P[o++],E.materialIndex=h),a=t.faces.length,m)for(r=0;r<F;r++)for(M=e.uvs[r],t.faceVertexUvs[r][a]=[],i=0;i<3;i++)R=M[2*(u=P[o++])],k=M[2*u+1],S=new THREE.Vector2(R,k),t.faceVertexUvs[r][a].push(S);if(g&&(c=3*P[o++],E.normal.set(C[c++],C[c++],C[c])),v)for(r=0;r<3;r++)c=3*P[o++],A=new THREE.Vector3(C[c++],C[c++],C[c]),E.vertexNormals.push(A);if(y&&(l=P[o++],E.color.setHex(I[l])),_)for(r=0;r<3;r++)l=P[o++],E.vertexColors.push(new THREE.Color(I[l]));t.faces.push(E)}}(t,r),function(e,t){var n=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;r<i;r+=n){var a=e.skinWeights[r],o=n>1?e.skinWeights[r+1]:0,s=n>2?e.skinWeights[r+2]:0,l=n>3?e.skinWeights[r+3]:0;t.skinWeights.push(new THREE.Vector4(a,o,s,l))}if(e.skinIndices)for(r=0,i=e.skinIndices.length;r<i;r+=n){var c=e.skinIndices[r],u=n>1?e.skinIndices[r+1]:0,h=n>2?e.skinIndices[r+2]:0,d=n>3?e.skinIndices[r+3]:0;t.skinIndices.push(new THREE.Vector4(c,u,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(t,r),function(e,t){var n=e.scale;if(void 0!==e.morphTargets)for(var r=0,i=e.morphTargets.length;r<i;r++){t.morphTargets[r]={},t.morphTargets[r].name=e.morphTargets[r].name,t.morphTargets[r].vertices=[];for(var a=t.morphTargets[r].vertices,o=e.morphTargets[r].vertices,s=0,l=o.length;s<l;s+=3){var c=new THREE.Vector3;c.x=o[s]*n,c.y=o[s+1]*n,c.z=o[s+2]*n,a.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=t.faces,h=e.morphColors[0].colors;for(r=0,i=u.length;r<i;r++)u[r].color.fromArray(h,3*r)}}(t,r),function(e,t){var n=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var i=0;i<r.length;i++){var a=THREE.AnimationClip.parseAnimation(r[i],t.bones);a&&n.push(a)}if(t.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);n=n.concat(o)}n.length>0&&(t.animations=n)}(t,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:r}:{geometry:r,materials:e.prototype.initMaterials(t.materials,this.resourcePath||n,this.crossOrigin)}}}),t}()},7542:()=>{class e extends THREE.Group{constructor(){super(),this.type="LensFlare",this.positionScreen=new THREE.Vector3,this.flareVisible=!1;var e=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.needsUpdate=!0;var t=new THREE.DataTexture(new Uint8Array(1024),16,16,THREE.RGBAFormat);t.minFilter=THREE.NearestFilter,t.magFilter=THREE.NearestFilter,t.needsUpdate=!0;var n=THREE.LensFlare.Shader,r=new THREE.RawShaderMaterial({uniforms:n.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,depthWrite:!1}),i=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),r);i.frustumCulled=!1;var a=new THREE.Vector2,o=new THREE.Vector2,s=new THREE.Box2,l=0;this.update=function(n,r,u){if(n instanceof THREE.WebGLRenderer){var h=n.info.render.frame;if(l!==h){l=h;var d=u.w/u.z,f=.5*u.z,p=.5*u.w,m=16/u.w;a.set(m*d,m),s.min.set(u.x,u.y),s.max.set(u.x+(u.z-16),u.y+(u.w-16)),this.positionScreen.setFromMatrixPosition(this.matrixWorld),this.positionScreen.applyMatrix4(r.matrixWorldInverse),this.positionScreen.applyMatrix4(r.projectionMatrix),o.x=u.x+this.positionScreen.x*f+f-8,o.y=u.y+this.positionScreen.y*p+p-8,!0===s.containsPoint(o)?(this.flareVisible=!0,n.copyFramebufferToTexture(o,e),i.material.uniforms.renderType.value=0,i.material.uniforms.scale.value=a,i.material.uniforms.screenPosition.value=this.positionScreen,i.material.depthTest=!0,n.render(i,r),n.copyFramebufferToTexture(o,t),i.material.uniforms.renderType.value=1,i.material.uniforms.map.value=e,i.material.depthTest=!1,n.render(i,r),function(){for(var e=2*-c.positionScreen.x,t=2*-c.positionScreen.y,n=0,r=c.children.length;n<r;n++){var i=c.children[n];i.flarePosition.x=c.positionScreen.x+e*i.flareDistance,i.flarePosition.y=c.positionScreen.y+t*i.flareDistance}}()):this.flareVisible=!1}}};var c=this;this.getOcclusionMap=function(){return t},this.dispose=function(){i.material.dispose(),e.dispose(),t.dispose()}}}e.prototype.isLensFlare=!0,THREE.LensFlare=e,THREE.LensFlare.Shader={uniforms:{renderType:{value:0},map:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform lowp int renderType;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else {","\t\tgl_FragColor = texture2D( map, vUV );","\t}","}"].join("\n")};class t extends THREE.Mesh{constructor(e,t,n,r,i,a){super(),this.type="LensFlareElement",this.frustumCulled=!1,this.renderOrder=1/0,this.flareTexture=e,this.flareSize=t||1,this.flareDistance=n||0,this.flareBlending=i||THREE.AdditiveBlending,this.flareColor=r||new THREE.Color(16777215),this.flareOpacity=a||1,this.flarePosition=new THREE.Vector3,this.flareRotation=0,this.geometry=new THREE.PlaneBufferGeometry(2,2);var o=THREE.LensFlareElement.Shader;this.material=new THREE.RawShaderMaterial({uniforms:o.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:this.flareBlending,transparent:!0,depthWrite:!1});var s=new THREE.Vector2,l=new THREE.Vector4;this.onBeforeRender=function(e,t,n,r,i,a){var o=this.parent;if(null!==o){e.getCurrentViewport(l),o.update(e,n,l);var c=this.flareSize/l.w,u=l.w/l.z;s.set(c*u,c),this.material.uniforms.map.value=this.flareTexture,this.material.uniforms.occlusionMap.value=o.getOcclusionMap(),this.material.uniforms.opacity.value=this.flareOpacity,this.material.uniforms.color.value=this.flareColor,this.material.uniforms.scale.value=s,this.material.uniforms.rotation.value=this.flareRotation,this.material.uniforms.screenPosition.value=this.flarePosition,!1===o.flareVisible&&(this.material.uniforms.opacity.value=0)}else console.error("THREE.LensFlareElement: LensFlareElement not assigned to a LensFlare. Rendering not possible.")},this.dispose=function(){this.material.dispose()}}}t.prototype.isLensFlareElement=!0,THREE.LensFlareElement=t,THREE.LensFlareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},opacity:{value:1},color:{value:null},scale:{value:null},rotation:{value:0},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );"," visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tvVisibility *= 1.0 - visibility.a / 9.0;","\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= opacity * vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")}},6707:()=>{!function(){const e={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};THREE.LuminosityHighPassShader=e}()},4559:()=>{!function(){class e{constructor(e,t){this.lut=[],this.setColorMap(e,t)}set(t){return t instanceof e&&this.copy(t),this}setMin(e){return this.minV=e,this}setMax(e){return this.maxV=e,this}setColorMap(e,n=32){this.map=t[e]||t.rainbow,this.n=n;const r=1/this.n;this.lut.length=0;for(let e=0;e<=1;e+=r)for(let t=0;t<this.map.length-1;t++)if(e>=this.map[t][0]&&e<this.map[t+1][0]){const n=this.map[t][0],r=this.map[t+1][0],i=new THREE.Color(this.map[t][1]),a=new THREE.Color(this.map[t+1][1]),o=i.lerp(a,(e-n)/(r-n));this.lut.push(o)}return this}copy(e){return this.lut=e.lut,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this}getColor(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);let t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]}addColorMap(e,n){t[e]=n}createCanvas(){const e=document.createElement("canvas");return e.width=1,e.height=this.n,this.updateCanvas(e),e}updateCanvas(e){const t=e.getContext("2d",{alpha:!1}),n=t.getImageData(0,0,1,this.n),r=n.data;let i=0;const a=1/this.n;for(let e=1;e>=0;e-=a)for(let t=this.map.length-1;t>=0;t--)if(e<this.map[t][0]&&e>=this.map[t-1][0]){const n=this.map[t-1][0],a=this.map[t][0],o=new THREE.Color(this.map[t-1][1]),s=new THREE.Color(this.map[t][1]),l=o.lerp(s,(e-n)/(a-n));r[4*i]=Math.round(255*l.r),r[4*i+1]=Math.round(255*l.g),r[4*i+2]=Math.round(255*l.b),r[4*i+3]=255,i+=1}return t.putImageData(n,0,0),e}}e.prototype.lut=[],e.prototype.map=[],e.prototype.n=256,e.prototype.minV=0,e.prototype.maxV=1;const t={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]};THREE.ColorMapKeywords=t,THREE.Lut=e}()},7862:()=>{!function(){const e=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];class t extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(t){const n=new DataView(t),r={},i=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"];for(let e=0;e<i.length;e++)r[i[e]]=n.getInt32(4*e,!0);if(844121161!==r.ident||8!==r.version)return void console.error("Not a valid MD2 file");if(r.offset_end!==n.byteLength)return void console.error("Corrupted MD2 file");const a=new THREE.BufferGeometry,o=[];let s=r.offset_st;for(let e=0,t=r.num_st;e<t;e++){const e=n.getInt16(s+0,!0),t=n.getInt16(s+2,!0);o.push(e/r.skinwidth,1-t/r.skinheight),s+=4}s=r.offset_tris;const l=[],c=[];for(let e=0,t=r.num_tris;e<t;e++)l.push(n.getUint16(s+0,!0),n.getUint16(s+2,!0),n.getUint16(s+4,!0)),c.push(n.getUint16(s+6,!0),n.getUint16(s+8,!0),n.getUint16(s+10,!0)),s+=12;const u=new THREE.Vector3,h=new THREE.Vector3,d=[],f=[];s=r.offset_frames;for(let t=0,i=r.num_frames;t<i;t++){h.set(n.getFloat32(s+0,!0),n.getFloat32(s+4,!0),n.getFloat32(s+8,!0)),u.set(n.getFloat32(s+12,!0),n.getFloat32(s+16,!0),n.getFloat32(s+20,!0)),s+=24;for(let e=0;e<16;e++){const t=n.getUint8(s+e,!0);if(0===t)break;d[e]=t}const t={name:String.fromCharCode.apply(null,d),vertices:[],normals:[]};s+=16;for(let i=0;i<r.num_vertices;i++){let r=n.getUint8(s++,!0),i=n.getUint8(s++,!0),a=n.getUint8(s++,!0);const o=e[n.getUint8(s++,!0)];r=r*h.x+u.x,i=i*h.y+u.y,a=a*h.z+u.z,t.vertices.push(r,a,i),t.normals.push(o[0],o[2],o[1])}f.push(t)}const p=[],m=[],g=[],v=f[0].vertices,y=f[0].normals;for(let e=0,t=l.length;e<t;e++){let t=3*l[e];const n=v[t],r=v[t+1],i=v[t+2];p.push(n,r,i);const a=y[t],s=y[t+1],u=y[t+2];m.push(a,s,u);t=2*c[e];const h=o[t],d=o[t+1];g.push(h,d)}a.setAttribute("position",new THREE.Float32BufferAttribute(p,3)),a.setAttribute("normal",new THREE.Float32BufferAttribute(m,3)),a.setAttribute("uv",new THREE.Float32BufferAttribute(g,2));const _=[],b=[];for(let e=0,t=f.length;e<t;e++){const t=f[e],n=t.name;if(t.vertices.length>0){const e=[];for(let n=0,r=l.length;n<r;n++){const r=3*l[n],i=t.vertices[r],a=t.vertices[r+1],o=t.vertices[r+2];e.push(i,a,o)}const r=new THREE.Float32BufferAttribute(e,3);r.name=n,_.push(r)}if(t.normals.length>0){const e=[];for(let n=0,r=l.length;n<r;n++){const r=3*l[n],i=t.normals[r],a=t.normals[r+1],o=t.normals[r+2];e.push(i,a,o)}const r=new THREE.Float32BufferAttribute(e,3);r.name=n,b.push(r)}}return a.morphAttributes.position=_,a.morphAttributes.normal=b,a.morphTargetsRelative=!1,a.animations=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(f,10),a}}THREE.MD2Loader=t}()},1617:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=""===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,n){const r=e.split("\n");let i={};const a=/\s+/,o={};for(let e=0;e<r.length;e++){let t=r[e];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;const n=t.indexOf(" ");let s=n>=0?t.substring(0,n):t;s=s.toLowerCase();let l=n>=0?t.substring(n+1):"";if(l=l.trim(),"newmtl"===s)i={name:l},o[l]=i;else if("ka"===s||"kd"===s||"ks"===s||"ke"===s){const e=l.split(a,3);i[s]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[s]=l}const s=new t(this.resourcePath||n,this.materialOptions);return s.setCrossOrigin(this.crossOrigin),s.setManager(this.manager),s.setMaterials(o),s}}class t{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:THREE.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:THREE.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const r=e[n],i={};t[n]=i;for(const e in r){let t=!0,n=r[e];const a=e.toLowerCase();switch(a){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(t=!1)}t&&(i[a]=n)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],r={name:e,side:this.side};function i(e,n){if(r[e])return;const i=t.getTextureParams(n,r),a=t.loadTexture((o=t.baseUrl,"string"!=typeof(s=i.url)||""===s?"":/^https?:\/\//i.test(s)?s:o+s));var o,s;a.repeat.copy(i.scale),a.offset.copy(i.offset),a.wrapS=t.wrap,a.wrapT=t.wrap,r[e]=a}for(const e in n){const t=n[e];let a;if(""!==t)switch(e.toLowerCase()){case"kd":r.color=(new THREE.Color).fromArray(t);break;case"ks":r.specular=(new THREE.Color).fromArray(t);break;case"ke":r.emissive=(new THREE.Color).fromArray(t);break;case"map_kd":i("map",t);break;case"map_ks":i("specularMap",t);break;case"map_ke":i("emissiveMap",t);break;case"norm":i("normalMap",t);break;case"map_bump":case"bump":i("bumpMap",t);break;case"map_d":i("alphaMap",t),r.transparent=!0;break;case"ns":r.shininess=parseFloat(t);break;case"d":a=parseFloat(t),a<1&&(r.opacity=a,r.transparent=!0);break;case"tr":a=parseFloat(t),this.options&&this.options.invertTrProperty&&(a=1-a),a>0&&(r.opacity=1-a,r.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(r),this.materials[e]}getTextureParams(e,t){const n={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},r=e.split(/\s+/);let i;return i=r.indexOf("-bm"),i>=0&&(t.bumpScale=parseFloat(r[i+1]),r.splice(i,2)),i=r.indexOf("-s"),i>=0&&(n.scale.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),i=r.indexOf("-o"),i>=0&&(n.offset.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),n.url=r.join(" ").trim(),n}loadTexture(e,t,n,r,i){const a=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;let o=a.getHandler(e);null===o&&(o=new THREE.TextureLoader(a)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const s=o.load(e,n,r,i);return void 0!==t&&(s.mapping=t),s}}THREE.MTLLoader=e}()},3230:()=>{!function(){class e extends THREE.Pass{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),i=e.state;let a,o;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(a=0,o=1):(a=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class t extends THREE.Pass{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}THREE.ClearMaskPass=t,THREE.MaskPass=e}()},7684:()=>{class e extends THREE.Object3D{constructor(e,t,n,r){function i(e,t){return void 0!==e?e:t}super(),this.name="mirror_"+this.id,r=r||{},this.matrixNeedsUpdate=!0;var a=i(r.textureWidth,512),o=i(r.textureHeight,512);this.clipBias=i(r.clipBias,0),this.renderer=e,this.scene=n,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4,t instanceof THREE.PerspectiveCamera?this.camera=t:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mesh=new THREE.Object3D,this.texture=new THREE.WebGLRenderTarget(a,o),this.tempTexture=new THREE.WebGLRenderTarget(a,o),THREE.Math.isPowerOfTwo(a)&&THREE.Math.isPowerOfTwo(o)||(this.texture.texture.generateMipmaps=!1,this.tempTexture.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()}renderWithMirror(e){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var t=e.camera;e.camera=this.mirrorCamera,e.render(!0),e.material.uniforms.mirrorSampler.value=e.tempTexture.texture,this.render(),this.matrixNeedsUpdate=!0,e.material.uniforms.mirrorSampler.value=e.texture.texture,e.camera=t,e.updateTextureMatrix()}updateTextureMatrix(){function e(e){return e?e<0?-1:1:0}null!=this.parent&&(this.mesh=this.parent),this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal=new THREE.Vector3(0,1,0).applyEuler(this.mesh.rotation);var t=new THREE.Vector3(0,0,1).applyEuler(this.camera.rotation);if(this.normal.dot(t)<0){var n=new THREE.Vector3(0,0,1).applyEuler(this.mesh.rotation);this.normal.reflect(n)}var r=this.mesh.position.clone().sub(this.cameraWorldPosition);r.reflect(this.normal).negate(),r.add(this.mesh.position),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mesh.position.clone().sub(this.lookAtPosition);i.reflect(this.normal).negate(),i.add(this.mesh.position),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(r),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(i),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.copy(this.mirrorCamera.matrixWorld).invert(),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mesh.position),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var a=new THREE.Vector4,o=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+o.elements[8])/o.elements[0],a.y=(e(this.clipPlane.y)+o.elements[9])/o.elements[5],a.z=-1,a.w=(1+o.elements[10])/o.elements[14];var s=new THREE.Vector4;s=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),o.elements[2]=s.x,o.elements[6]=s.y,o.elements[10]=s.z+1-this.clipBias,o.elements[14]=s.w;var l=new THREE.Vector3;l.setFromMatrixPosition(this.camera.matrixWorld),this.eye=l}render(e){if(this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0,void 0!==this.scene&&this.scene instanceof THREE.Scene){var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.setRenderTarget(t),this.renderer.clear(),this.renderer.render(this.scene,this.mirrorCamera)}}}e.prototype.isMirrorRenderer=!0,THREE.MirrorRenderer=e},5640:(e,t,n)=>{"use strict";n.r(t);var r=n(743);!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){let n=e,i=0;const a=new Int8Array(new Int16Array([1]).buffer)[0]>0,o={};const s=function(e,t){null==t&&(t=1);let r=1,o=Uint8Array;switch(e){case"uchar":break;case"schar":o=Int8Array;break;case"ushort":o=Uint16Array,r=2;break;case"sshort":o=Int16Array,r=2;break;case"uint":o=Uint32Array,r=4;break;case"sint":o=Int32Array,r=4;break;case"float":o=Float32Array,r=4;break;case"complex":case"double":o=Float64Array,r=8}let s=new o(n.slice(i,i+=t*r));return true!=a&&(s=function(e,t){const n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(let r=0;r<e.byteLength;r+=t)for(let e=r+t-1,i=r;e>i;e--,i++){const t=n[i];n[i]=n[e],n[e]=t}return e}(s,r)),1==t?s[0]:s}("uchar",e.byteLength),l=s.length;let c,u=null,h=0;for(c=1;c<l;c++)if(10==s[c-1]&&10==s[c]){u=this.parseChars(s,0,c-2),h=c+1;break}if(function(e){let n,r,i,a,s,l,c,u;const h=e.split(/\r?\n/);for(c=0,u=h.length;c<u;c++)s=h[c],s.match(/NRRD\d+/)?o.isNrrd=!0:s.match(/^#/)||(l=s.match(/(.*):(.*)/))&&(r=l[1].trim(),n=l[2].trim(),i=t[r],i?i.call(o,n):o[r]=n);if(!o.isNrrd)throw new Error("Not an NRRD file");if("bz2"===o.encoding||"bzip2"===o.encoding)throw new Error("Bzip is not supported");if(!o.vectors&&(o.vectors=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],o.spacings))for(a=0;a<=2;a++)isNaN(o.spacings[a])||o.vectors[a].multiplyScalar(o.spacings[a])}(u),n=s.subarray(h),"gz"===o.encoding.substring(0,2))n=r.gunzipSync(new Uint8Array(n));else if("ascii"===o.encoding||"text"===o.encoding||"txt"===o.encoding||"hex"===o.encoding)n=function(e,t,n){let r,i="";t=t||0,n=n||e.length;const a=o.sizes.reduce((function(e,t){return e*t}),1);let s=10;"hex"===o.encoding&&(s=16);const l=new o.__array(a);let c=0,u=parseInt;o.__array!==Float32Array&&o.__array!==Float64Array||(u=parseFloat);for(let a=t;a<n;a++)r=e[a],(r<9||r>13)&&32!==r?i+=String.fromCharCode(r):(""!==i&&(l[c]=u(i,s),c++),i="");return""!==i&&(l[c]=u(i,s),c++),l}(n);else if("raw"===o.encoding){const e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n[t];n=e}n=n.buffer;const d=new THREE.Volume;d.header=o,d.data=new o.__array(n);const f=d.computeMinMax(),p=f[0],m=f[1];d.windowLow=p,d.windowHigh=m,d.dimensions=[o.sizes[0],o.sizes[1],o.sizes[2]],d.xLength=d.dimensions[0],d.yLength=d.dimensions[1],d.zLength=d.dimensions[2];const g=new THREE.Vector3(o.vectors[0][0],o.vectors[0][1],o.vectors[0][2]).length(),v=new THREE.Vector3(o.vectors[1][0],o.vectors[1][1],o.vectors[1][2]).length(),y=new THREE.Vector3(o.vectors[2][0],o.vectors[2][1],o.vectors[2][2]).length();d.spacing=[g,v,y],d.matrix=new THREE.Matrix4;let _=1,b=1;if("left-posterior-superior"==o.space?(_=-1,b=-1):"left-anterior-superior"===o.space&&(_=-1),o.vectors){const e=o.vectors;d.matrix.set(_*e[0][0],_*e[1][0],_*e[2][0],0,b*e[0][1],b*e[1][1],b*e[2][1],0,1*e[0][2],1*e[1][2],1*e[2][2],0,0,0,0,1)}else d.matrix.set(_,0,0,0,0,b,0,0,0,0,1,0,0,0,0,1);return d.inverseMatrix=new THREE.Matrix4,d.inverseMatrix.copy(d.matrix).invert(),d.RASDimensions=new THREE.Vector3(d.xLength,d.yLength,d.zLength).applyMatrix4(d.matrix).round().toArray().map(Math.abs),d.lowerThreshold===-1/0&&(d.lowerThreshold=p),d.upperThreshold===1/0&&(d.upperThreshold=m),d}parseChars(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length);let r="",i=0;for(i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}}const t={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){let t;return this.sizes=function(){const n=e.split(/\s+/),r=[];for(let e=0,i=n.length;e<i;e++)t=n[e],r.push(parseInt(t,10));return r}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){let t,n;const r=e.match(/\(.*?\)/g);return this.vectors=function(){const e=[];for(let i=0,a=r.length;i<a;i++)n=r[i],e.push(function(){const e=n.slice(1,-1).split(/,/),r=[];for(let n=0,i=e.length;n<i;n++)t=e[n],r.push(parseFloat(t));return r}());return e}()},spacings:function(e){let t;const n=e.split(/\s+/);return this.spacings=function(){const e=[];for(let r=0,i=n.length;r<i;r++)t=n[r],e.push(parseFloat(t));return e}()}};THREE.NRRDLoader=e}()},8080:()=>{!function(){class e extends THREE.Curve{constructor(e,t,n,r,i){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new THREE.Vector4(t.x,t.y,t.z,t.w)}}getPoint(e,t=new THREE.Vector3){const n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=THREE.NURBSUtils.calcBSplinePoint(this.degree,this.knots,this.controlPoints,r);return 1!==i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}getTangent(e,t=new THREE.Vector3){const n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=THREE.NURBSUtils.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}}THREE.NURBSCurve=e}()},6136:()=>{THREE.NURBSSurface=class{constructor(e,t,n,r,i){this.degree1=e,this.degree2=t,this.knots1=n,this.knots2=r,this.controlPoints=[];const a=n.length-e-1,o=r.length-t-1;for(let e=0;e<a;++e){this.controlPoints[e]=[];for(let t=0;t<o;++t){const n=i[e][t];this.controlPoints[e][t]=new THREE.Vector4(n.x,n.y,n.z,n.w)}}}getPoint(e,t,n){const r=this.knots1[0]+e*(this.knots1[this.knots1.length-1]-this.knots1[0]),i=this.knots2[0]+t*(this.knots2[this.knots2.length-1]-this.knots2[0]);THREE.NURBSUtils.calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,r,i,n)}}},3723:()=>{THREE.NURBSUtils=class{static findSpan(e,t,n){const r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;let i=e,a=r,o=Math.floor((i+a)/2);for(;t<n[o]||t>=n[o+1];)t<n[o]?a=o:i=o,o=Math.floor((i+a)/2);return o}static calcBasisFunctions(e,t,n,r){const i=[],a=[],o=[];i[0]=1;for(let s=1;s<=n;++s){a[s]=t-r[e+1-s],o[s]=r[e+s]-t;let n=0;for(let e=0;e<s;++e){const t=o[e+1],r=a[s-e],l=i[e]/(t+r);i[e]=n+t*l,n=r*l}i[s]=n}return i}static calcBSplinePoint(e,t,n,r){const i=this.findSpan(e,r,t),a=this.calcBasisFunctions(i,r,e,t),o=new THREE.Vector4(0,0,0,0);for(let t=0;t<=e;++t){const r=n[i-e+t],s=a[t],l=r.w*s;o.x+=r.x*l,o.y+=r.y*l,o.z+=r.z*l,o.w+=r.w*s}return o}static calcBasisFunctionDerivatives(e,t,n,r,i){const a=[];for(let e=0;e<=n;++e)a[e]=0;const o=[];for(let e=0;e<=r;++e)o[e]=a.slice(0);const s=[];for(let e=0;e<=n;++e)s[e]=a.slice(0);s[0][0]=1;const l=a.slice(0),c=a.slice(0);for(let r=1;r<=n;++r){l[r]=t-i[e+1-r],c[r]=i[e+r]-t;let n=0;for(let e=0;e<r;++e){const t=c[e+1],i=l[r-e];s[r][e]=t+i;const a=s[e][r-1]/s[r][e];s[e][r]=n+t*a,n=i*a}s[r][r]=n}for(let e=0;e<=n;++e)o[0][e]=s[e][n];for(let e=0;e<=n;++e){let t=0,i=1;const l=[];for(let e=0;e<=n;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=r;++a){let r=0;const c=e-a,u=n-a;e>=a&&(l[i][0]=l[t][0]/s[u+1][c],r=l[i][0]*s[c][u]);const h=e-1<=u?a-1:n-e;for(let e=c>=-1?1:-c;e<=h;++e)l[i][e]=(l[t][e]-l[t][e-1])/s[u+1][c+e],r+=l[i][e]*s[c+e][u];e<=u&&(l[i][a]=-l[t][a-1]/s[u+1][e],r+=l[i][a]*s[e][u]),o[a][e]=r;const d=t;t=i,i=d}}let u=n;for(let e=1;e<=r;++e){for(let t=0;t<=n;++t)o[e][t]*=u;u*=n-e}return o}static calcBSplineDerivatives(e,t,n,r,i){const a=i<e?i:e,o=[],s=this.findSpan(e,r,t),l=this.calcBasisFunctionDerivatives(s,r,e,a,t),c=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),r=t.w;t.x*=r,t.y*=r,t.z*=r,c[e]=t}for(let t=0;t<=a;++t){const n=c[s-e].clone().multiplyScalar(l[t][0]);for(let r=1;r<=e;++r)n.add(c[s-e+r].clone().multiplyScalar(l[t][r]));o[t]=n}for(let e=a+1;e<=i+1;++e)o[e]=new THREE.Vector4(0,0,0);return o}static calcKoverI(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let r=1;for(let e=2;e<=t;++e)r*=e;for(let n=2;n<=e-t;++n)r*=n;return n/r}static calcRationalCurveDerivatives(e){const t=e.length,n=[],r=[];for(let i=0;i<t;++i){const t=e[i];n[i]=new THREE.Vector3(t.x,t.y,t.z),r[i]=t.w}const i=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(i[e-n].clone().multiplyScalar(this.calcKoverI(e,n)*r[n]));i[e]=t.divideScalar(r[0])}return i}static calcNURBSDerivatives(e,t,n,r,i){const a=this.calcBSplineDerivatives(e,t,n,r,i);return this.calcRationalCurveDerivatives(a)}static calcSurfacePoint(e,t,n,r,i,a,o,s){const l=this.findSpan(e,a,n),c=this.findSpan(t,o,r),u=this.calcBasisFunctions(l,a,e,n),h=this.calcBasisFunctions(c,o,t,r),d=[];for(let n=0;n<=t;++n){d[n]=new THREE.Vector4(0,0,0,0);for(let r=0;r<=e;++r){const a=i[l-e+r][c-t+n].clone(),o=a.w;a.x*=o,a.y*=o,a.z*=o,d[n].add(a.multiplyScalar(u[r]))}}const f=new THREE.Vector4(0,0,0,0);for(let e=0;e<=t;++e)f.add(d[e].multiplyScalar(h[e]));f.divideScalar(f.w),s.set(f.x,f.y,f.z)}}},6834:()=>{THREE.OBJExporter=class{parse(e){let t="",n=0,r=0,i=0;const a=new THREE.Vector3,o=new THREE.Color,s=new THREE.Vector3,l=new THREE.Vector2,c=[];return e.traverse((function(e){!0===e.isMesh&&function(e){let o=0,u=0,h=0;const d=e.geometry,f=new THREE.Matrix3;if(!0!==d.isBufferGeometry)throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");const p=d.getAttribute("position"),m=d.getAttribute("normal"),g=d.getAttribute("uv"),v=d.getIndex();if(t+="o "+e.name+"\n",e.material&&e.material.name&&(t+="usemtl "+e.material.name+"\n"),void 0!==p)for(let n=0,r=p.count;n<r;n++,o++)a.x=p.getX(n),a.y=p.getY(n),a.z=p.getZ(n),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if(void 0!==g)for(let e=0,n=g.count;e<n;e++,h++)l.x=g.getX(e),l.y=g.getY(e),t+="vt "+l.x+" "+l.y+"\n";if(void 0!==m){f.getNormalMatrix(e.matrixWorld);for(let e=0,n=m.count;e<n;e++,u++)s.x=m.getX(e),s.y=m.getY(e),s.z=m.getZ(e),s.applyMatrix3(f).normalize(),t+="vn "+s.x+" "+s.y+" "+s.z+"\n"}if(null!==v)for(let e=0,a=v.count;e<a;e+=3){for(let t=0;t<3;t++){const a=v.getX(e+t)+1;c[t]=n+a+(m||g?"/"+(g?r+a:"")+(m?"/"+(i+a):""):"")}t+="f "+c.join(" ")+"\n"}else for(let e=0,a=p.count;e<a;e+=3){for(let t=0;t<3;t++){const a=e+t+1;c[t]=n+a+(m||g?"/"+(g?r+a:"")+(m?"/"+(i+a):""):"")}t+="f "+c.join(" ")+"\n"}n+=o,r+=h,i+=u}(e),!0===e.isLine&&function(e){let r=0;const i=e.geometry,o=e.type;if(!0!==i.isBufferGeometry)throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");const s=i.getAttribute("position");if(t+="o "+e.name+"\n",void 0!==s)for(let n=0,i=s.count;n<i;n++,r++)a.x=s.getX(n),a.y=s.getY(n),a.z=s.getZ(n),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if("Line"===o){t+="l ";for(let e=1,r=s.count;e<=r;e++)t+=n+e+" ";t+="\n"}if("LineSegments"===o)for(let e=1,r=e+1,i=s.count;e<i;e+=2,r=e+1)t+="l "+(n+e)+" "+(n+r)+"\n";n+=r}(e),!0===e.isPoints&&function(e){let r=0;const i=e.geometry;if(!0!==i.isBufferGeometry)throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");const s=i.getAttribute("position"),l=i.getAttribute("color");if(t+="o "+e.name+"\n",void 0!==s)for(let n=0,i=s.count;n<i;n++,r++)a.fromBufferAttribute(s,n),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z,void 0!==l&&(o.fromBufferAttribute(l,n),t+=" "+o.r+" "+o.g+" "+o.b),t+="\n";t+="p ";for(let e=1,r=s.count;e<=r;e++)t+=n+e+" ";t+="\n",n+=r}(e)})),t}}},4271:()=>{!function(){const e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,r=/^usemap /,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3;function c(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){const e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const r=this.normals,i=this.object.geometry.normals;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){const r=this.vertices,c=this.object.geometry.normals;i.fromArray(r,e),a.fromArray(r,t),o.fromArray(r,n),l.subVectors(o,a),s.subVectors(i,a),l.cross(s),l.normalize(),c.push(l.x,l.y,l.z),c.push(l.x,l.y,l.z),c.push(l.x,l.y,l.z)},addColor:function(e,t,n){const r=this.colors,i=this.object.geometry.colors;void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){const r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0],r[e+1]),i.push(r[t+0],r[t+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,i,a,o,s,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==o&&""!==o){const e=this.normals.length;u=this.parseNormalIndex(o,e),h=this.parseNormalIndex(s,e),d=this.parseNormalIndex(l,e),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==r&&""!==r){const e=this.uvs.length;u=this.parseUVIndex(r,e),h=this.parseUVIndex(i,e),d=this.parseUVIndex(a,e),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,r=e.length;n<r;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let t=0,r=e.length;t<r;t++)this.addVertexLine(this.parseVertexIndex(e[t],n));for(let e=0,n=t.length;e<n;e++)this.addUVLine(this.parseUVIndex(t[e],r))}};return e.startObject("",!1),e}class u extends THREE.Loader{constructor(e){super(e),this.materials=null}load(e,t,n,r){const i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}setMaterials(e){return this.materials=e,this}parse(i){const a=new c;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));const o=i.split("\n");let s="",l="",u=0,h=[];const d="function"==typeof"".trimLeft;for(let i=0,c=o.length;i<c;i++)if(s=o[i],s=d?s.trimLeft():s.trim(),u=s.length,0!==u&&(l=s.charAt(0),"#"!==l))if("v"===l){const e=s.split(/\s+/);switch(e[0]){case"v":a.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?a.colors.push(parseFloat(e[4]/255),parseFloat(e[5]/255),parseFloat(e[6]/255)):a.colors.push(void 0,void 0,void 0);break;case"vn":a.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":a.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===l){const e=s.substr(1).trim().split(/\s+/),t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.length>0){const e=r.split("/");t.push(e)}}const n=t[0];for(let e=1,r=t.length-1;e<r;e++){const r=t[e],i=t[e+1];a.addFace(n[0],r[0],i[0],n[1],r[1],i[1],n[2],r[2],i[2])}}else if("l"===l){const e=s.substring(1).trim().split(" ");let t=[];const n=[];if(-1===s.indexOf("/"))t=e;else for(let r=0,i=e.length;r<i;r++){const i=e[r].split("/");""!==i[0]&&t.push(i[0]),""!==i[1]&&n.push(i[1])}a.addLineGeometry(t,n)}else if("p"===l){const e=s.substr(1).trim().split(" ");a.addPointGeometry(e)}else if(null!==(h=e.exec(s))){const e=(" "+h[0].substr(1).trim()).substr(1);a.startObject(e)}else if(n.test(s))a.object.startMaterial(s.substring(7).trim(),a.materialLibraries);else if(t.test(s))a.materialLibraries.push(s.substring(7).trim());else if(r.test(s))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===l){if(h=s.split(" "),h.length>1){const e=h[1].trim().toLowerCase();a.object.smooth="0"!==e&&"off"!==e}else a.object.smooth=!0;const e=a.object.currentMaterial();e&&(e.smooth=a.object.smooth)}else{if("\0"===s)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+s+'"')}a.finalize();const f=new THREE.Group;f.materialLibraries=[].concat(a.materialLibraries);if(!0===!(1===a.objects.length&&0===a.objects[0].geometry.vertices.length))for(let e=0,t=a.objects.length;e<t;e++){const t=a.objects[e],n=t.geometry,r=t.materials,i="Line"===n.type,o="Points"===n.type;let s=!1;if(0===n.vertices.length)continue;const l=new THREE.BufferGeometry;l.setAttribute("position",new THREE.Float32BufferAttribute(n.vertices,3)),n.normals.length>0&&l.setAttribute("normal",new THREE.Float32BufferAttribute(n.normals,3)),n.colors.length>0&&(s=!0,l.setAttribute("color",new THREE.Float32BufferAttribute(n.colors,3))),!0===n.hasUVIndices&&l.setAttribute("uv",new THREE.Float32BufferAttribute(n.uvs,2));const c=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],n=t.name+"_"+t.smooth+"_"+s;let l=a.materials[n];if(null!==this.materials)if(l=this.materials.create(t.name),!i||!l||l instanceof THREE.LineBasicMaterial){if(o&&l&&!(l instanceof THREE.PointsMaterial)){const e=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(e,l),e.color.copy(l.color),e.map=l.map,l=e}}else{const e=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(e,l),e.color.copy(l.color),l=e}void 0===l&&(l=i?new THREE.LineBasicMaterial:o?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial,l.name=t.name,l.flatShading=!t.smooth,l.vertexColors=s,a.materials[n]=l),c.push(l)}let u;if(c.length>1){for(let e=0,t=r.length;e<t;e++){const t=r[e];l.addGroup(t.groupStart,t.groupCount,e)}u=i?new THREE.LineSegments(l,c):o?new THREE.Points(l,c):new THREE.Mesh(l,c)}else u=i?new THREE.LineSegments(l,c[0]):o?new THREE.Points(l,c[0]):new THREE.Mesh(l,c[0]);u.name=t.name,f.add(u)}else if(a.vertices.length>0){const e=new THREE.PointsMaterial({size:1,sizeAttenuation:!1}),t=new THREE.BufferGeometry;t.setAttribute("position",new THREE.Float32BufferAttribute(a.vertices,3)),a.colors.length>0&&void 0!==a.colors[0]&&(t.setAttribute("color",new THREE.Float32BufferAttribute(a.colors,3)),e.vertexColors=!0);const n=new THREE.Points(t,e);f.add(n)}return f}}THREE.OBJLoader=u}()},6427:()=>{THREE.ShaderLib.ocean_sim_vertex={vertexShader:["varying vec2 vUV;","void main (void) {","vUV = position.xy * 0.5 + 0.5;","gl_Position = vec4(position, 1.0);","}"].join("\n")},THREE.ShaderLib.ocean_subtransform={uniforms:{u_input:{value:null},u_transformSize:{value:512},u_subtransformSize:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","uniform sampler2D u_input;","uniform float u_transformSize;","uniform float u_subtransformSize;","varying vec2 vUV;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","void main (void) {","#ifdef HORIZONTAL","float index = vUV.x * u_transformSize - 0.5;","#else","float index = vUV.y * u_transformSize - 0.5;","#endif","float evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);","#ifdef HORIZONTAL","vec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","#else","vec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;","#endif","float twiddleArgument = -2.0 * PI * (index / u_subtransformSize);","vec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));","vec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);","vec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);","gl_FragColor = vec4(outputA, outputB);","}"].join("\n")},THREE.ShaderLib.ocean_initial_spectrum={uniforms:{u_wind:{value:new THREE.Vector2(10,10)},u_resolution:{value:512},u_size:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","const float CM = 0.23;","uniform vec2 u_wind;","uniform float u_resolution;","uniform float u_size;","float square (float x) {","return x * x;","}","float omega (float k) {","return sqrt(G * k * (1.0 + square(k / KM)));","}","float tanh_ (float x) {","return (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 K = (2.0 * PI * vec2(n, m)) / u_size;","float k = length(K);","float l_wind = length(u_wind);","float Omega = 0.84;","float kp = G * square(Omega / l_wind);","float c = omega(k) / k;","float cp = omega(kp) / kp;","float Lpm = exp(-1.25 * square(kp / k));","float gamma = 1.7;","float sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));","float Gamma = exp(-square(sqrt(k / kp) - 1.0) / 2.0 * square(sigma));","float Jp = pow(gamma, Gamma);","float Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));","float alphap = 0.006 * sqrt(Omega);","float Bl = 0.5 * alphap * cp / c * Fp;","float z0 = 0.000037 * square(l_wind) / G * pow(l_wind / cp, 0.9);","float uStar = 0.41 * l_wind / log(10.0 / z0);","float alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));","float Fm = exp(-0.25 * square(k / KM - 1.0));","float Bh = 0.5 * alpham * CM / c * Fm * Lpm;","float a0 = log(2.0) / 4.0;","float am = 0.13 * uStar / CM;","float Delta = tanh_(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));","float cosPhi = dot(normalize(u_wind), normalize(K));","float S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));","float dk = 2.0 * PI / u_size;","float h = sqrt(S / 2.0) * dk;","if (K.x == 0.0 && K.y == 0.0) {","h = 0.0;","}","gl_FragColor = vec4(h, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_phase={uniforms:{u_phases:{value:null},u_deltaTime:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform sampler2D u_phases;","uniform float u_deltaTime;","uniform float u_resolution;","uniform float u_size;","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","float deltaTime = 1.0 / 60.0;","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","float deltaPhase = omega(length(waveVector)) * u_deltaTime;","phase = mod(phase + deltaPhase, 2.0 * PI);","gl_FragColor = vec4(phase, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_spectrum={uniforms:{u_size:{value:null},u_resolution:{value:null},u_choppiness:{value:null},u_phases:{value:null},u_initialSpectrum:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform float u_size;","uniform float u_resolution;","uniform float u_choppiness;","uniform sampler2D u_phases;","uniform sampler2D u_initialSpectrum;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","vec2 multiplyByI (vec2 z) {","return vec2(-z[1], z[0]);","}","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","vec2 phaseVector = vec2(cos(phase), sin(phase));","vec2 h0 = texture2D(u_initialSpectrum, vUV).rg;","vec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;","h0Star.y *= -1.0;","vec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));","vec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;","vec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;","if (waveVector.x == 0.0 && waveVector.y == 0.0) {","h = vec2(0.0);","hX = vec2(0.0);","hZ = vec2(0.0);","}","gl_FragColor = vec4(hX + multiplyByI(h), hZ);","}"].join("\n")},THREE.ShaderLib.ocean_normals={uniforms:{u_displacementMap:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","varying vec2 vUV;","uniform sampler2D u_displacementMap;","uniform float u_resolution;","uniform float u_size;","void main (void) {","float texel = 1.0 / u_resolution;","float texelSize = u_size / u_resolution;","vec3 center = texture2D(u_displacementMap, vUV).rgb;","vec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;","vec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;","vec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;","vec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;","vec3 topRight = cross(right, top);","vec3 topLeft = cross(top, left);","vec3 bottomLeft = cross(left, bottom);","vec3 bottomRight = cross(bottom, right);","gl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);","}"].join("\n")},THREE.ShaderChunk.screenplane_pars_vertex=["const float infinite = 150000.0;","const float screenScale = 1.2;","const vec3 groundNormal = vec3( 0.0, 1.0, 0.0 );","varying vec3 vCamPosition;","vec3 interceptPlane( in vec3 source, in vec3 dir, in vec3 normal, float height )","{","\tfloat distance = ( - height - dot( normal, source ) ) / dot( normal, dir );","\tif( distance < 0.0 )","\t\treturn source + dir * distance;","\telse ","\t\treturn - ( vec3( source.x, height, source.z ) + vec3( dir.x, height, dir.z ) * infinite );","}","mat3 getRotation()","{","\treturn mat3( ","\t\tviewMatrix[0].xyz,","\t\tviewMatrix[1].xyz,","\t\tviewMatrix[2].xyz","\t);","}","vec3 getCameraPos( in mat3 rotation )","{","\treturn - viewMatrix[3].xyz * rotation;","}","vec2 getImagePlan()","{","\tfloat focal = projectionMatrix[0].x;","\tfloat aspect = projectionMatrix[1].y;","\treturn vec2( ( uv.x - 0.5 ) * screenScale * aspect, ( uv.y - 0.5 ) * screenScale * focal );","}","vec3 getCamRay( in mat3 rotation, in vec2 screenUV )","{","\treturn vec3( screenUV.x, screenUV.y, projectionMatrix[0].x ) * rotation;","}","vec3 computeProjectedPosition()","{","\tmat3 cameraRotation = getRotation();","\tvec3 camPosition = getCameraPos( cameraRotation );","\tvCamPosition = camPosition;","\tvec2 screenUV = getImagePlan();","\tvec3 ray = getCamRay( cameraRotation, screenUV );","\tvec3 finalPos = interceptPlane( camPosition, ray, groundNormal, -u_groundHeight );","\tfloat distance = length( finalPos );","\tif( distance > infinite )","\t\tfinalPos *= infinite / distance;","\treturn finalPos;","}"].join("\n"),THREE.ShaderChunk.screenplane_vertex=["vec4 screenPlaneWorldPosition = vec4( computeProjectedPosition(), 1.0 );"].join("\n"),THREE.ShaderChunk.screenplane_pars_fragment=["varying vec3 vCamPosition;"].join("\n"),THREE.ShaderChunk.oceanfft_pars_vertex=["uniform sampler2D u_displacementMap;","uniform float u_geometrySize;","uniform float u_size;"].join("\n"),THREE.ShaderChunk.oceanfft_vertex=["vec3 displacement = texture2D( u_displacementMap, worldPosition.xz * 0.002 ).rgb * ( u_geometrySize / u_size );","vec4 oceanfftWorldPosition = worldPosition + vec4( displacement, 0.0 );"].join("\n"),THREE.ShaderLib.ocean_main={uniforms:{u_displacementMap:{value:null},u_reflection:{value:null},u_normalMap:{value:null},u_geometrySize:{value:null},u_size:{value:null},u_mirrorMatrix:{value:null},u_oceanColor:{value:null},u_sunDirection:{value:null},u_exposure:{value:null},u_groundHeight:{value:null}},vertexShader:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vec4 worldPosition = screenPlaneWorldPosition;",THREE.ShaderChunk.oceanfft_vertex,"vWorldPosition = oceanfftWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * oceanfftWorldPosition;","gl_Position = projectionMatrix * viewMatrix * oceanfftWorldPosition;","}"].join("\n"),vertexShaderNoTexLookup:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vWorldPosition = screenPlaneWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * screenPlaneWorldPosition;","gl_Position = projectionMatrix * viewMatrix * screenPlaneWorldPosition;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform sampler2D u_reflection;","uniform sampler2D u_normalMap;","uniform vec3 u_oceanColor;","uniform vec3 u_sunDirection;","uniform float u_exposure;","vec3 hdr (vec3 color, float exposure) {","return 1.0 - exp(-color * exposure);","}",THREE.ShaderChunk.screenplane_pars_fragment,"void main (void) {","vec3 normal = texture2D( u_normalMap, vWorldPosition.xz * 0.002 ).rgb;","vec3 view = normalize( vCamPosition - vWorldPosition );","vec3 reflection = normalize( reflect( -u_sunDirection, normal ) );","float specularFactor = pow( max( 0.0, dot( view, reflection ) ), 500.0 ) * 20.0;","vec3 distortion = 200.0 * normal * vec3( 1.0, 0.0, 0.1 );","vec3 reflectionColor = texture2DProj( u_reflection, vReflectCoordinates.xyz + distortion ).xyz;","float distanceRatio = min( 1.0, log( 1.0 / length( vCamPosition - vWorldPosition ) * 3000.0 + 1.0 ) );","distanceRatio *= distanceRatio;","distanceRatio = distanceRatio * 0.7 + 0.3;","normal = ( distanceRatio * normal + vec3( 0.0, 1.0 - distanceRatio, 0.0 ) ) * 0.5;","normal /= length( normal );","float fresnel = pow( 1.0 - dot( normal, view ), 2.0 );","float skyFactor = ( fresnel + 0.2 ) * 10.0;","vec3 waterColor = ( 1.0 - fresnel ) * u_oceanColor;","vec3 color = ( skyFactor + specularFactor + waterColor ) * reflectionColor + waterColor * 0.5 ;","color = hdr( color, u_exposure );","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")}},2700:()=>{!function(){const e={type:"change"},t={type:"start"},n={type:"end"};class r extends THREE.EventDispatcher{constructor(r,i){super(),void 0===i&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=r,this.domElement=i,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",j),this._domElementKeyEvents=e},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(e),a.update(),s=o.NONE},this.update=function(){const t=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(r.up,new THREE.Vector3(0,1,0)),i=n.clone().invert(),p=new THREE.Vector3,m=new THREE.Quaternion,g=2*Math.PI;return function(){const r=a.object.position;t.copy(r).sub(a.target),t.applyQuaternion(n),c.setFromVector3(t),a.autoRotate&&s===o.NONE&&T(2*Math.PI/60/60*a.autoRotateSpeed),a.enableDamping?(c.theta+=u.theta*a.dampingFactor,c.phi+=u.phi*a.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let v=a.minAzimuthAngle,y=a.maxAzimuthAngle;return isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=g:v>Math.PI&&(v-=g),y<-Math.PI?y+=g:y>Math.PI&&(y-=g),c.theta=v<=y?Math.max(v,Math.min(y,c.theta)):c.theta>(v+y)/2?Math.max(v,c.theta):Math.min(y,c.theta)),c.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(a.minDistance,Math.min(a.maxDistance,c.radius)),!0===a.enableDamping?a.target.addScaledVector(d,a.dampingFactor):a.target.add(d),t.setFromSpherical(c),t.applyQuaternion(i),r.copy(a.target).add(t),a.object.lookAt(a.target),!0===a.enableDamping?(u.theta*=1-a.dampingFactor,u.phi*=1-a.dampingFactor,d.multiplyScalar(1-a.dampingFactor)):(u.set(0,0,0),d.set(0,0,0)),h=1,!!(f||p.distanceToSquared(a.object.position)>l||8*(1-m.dot(a.object.quaternion))>l)&&(a.dispatchEvent(e),p.copy(a.object.position),m.copy(a.object.quaternion),f=!1,!0)}}(),this.dispose=function(){a.domElement.removeEventListener("contextmenu",X),a.domElement.removeEventListener("pointerdown",U),a.domElement.removeEventListener("wheel",V),a.domElement.removeEventListener("touchstart",G),a.domElement.removeEventListener("touchend",q),a.domElement.removeEventListener("touchmove",W),a.domElement.ownerDocument.removeEventListener("pointermove",B),a.domElement.ownerDocument.removeEventListener("pointerup",z),null!==a._domElementKeyEvents&&a._domElementKeyEvents.removeEventListener("keydown",j)};const a=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const l=1e-6,c=new THREE.Spherical,u=new THREE.Spherical;let h=1;const d=new THREE.Vector3;let f=!1;const p=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,_=new THREE.Vector2,b=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2;function x(){return Math.pow(.95,a.zoomSpeed)}function T(e){u.theta-=e}function A(e){u.phi-=e}const M=function(){const e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),d.add(e)}}(),S=function(){const e=new THREE.Vector3;return function(t,n){!0===a.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(a.object.up,e)),e.multiplyScalar(t),d.add(e)}}(),R=function(){const e=new THREE.Vector3;return function(t,n){const r=a.domElement;if(a.object.isPerspectiveCamera){const i=a.object.position;e.copy(i).sub(a.target);let o=e.length();o*=Math.tan(a.object.fov/2*Math.PI/180),M(2*t*o/r.clientHeight,a.object.matrix),S(2*n*o/r.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(M(t*(a.object.right-a.object.left)/a.object.zoom/r.clientWidth,a.object.matrix),S(n*(a.object.top-a.object.bottom)/a.object.zoom/r.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function k(e){a.object.isPerspectiveCamera?h/=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function P(e){a.object.isPerspectiveCamera?h*=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function L(e){p.set(e.clientX,e.clientY)}function C(e){v.set(e.clientX,e.clientY)}function I(e){if(1==e.touches.length)p.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);p.set(t,n)}}function N(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,n)}}function F(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);b.set(0,r)}function O(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,n)}g.subVectors(m,p).multiplyScalar(a.rotateSpeed);const t=a.domElement;T(2*Math.PI*g.x/t.clientHeight),A(2*Math.PI*g.y/t.clientHeight),p.copy(m)}function H(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,n)}_.subVectors(y,v).multiplyScalar(a.panSpeed),R(_.x,_.y),v.copy(y)}function D(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);E.set(0,r),w.set(0,Math.pow(E.y/b.y,a.zoomSpeed)),k(w.y),b.copy(E)}function U(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){let n;switch(e.preventDefault(),a.domElement.focus?a.domElement.focus():window.focus(),e.button){case 0:n=a.mouseButtons.LEFT;break;case 1:n=a.mouseButtons.MIDDLE;break;case 2:n=a.mouseButtons.RIGHT;break;default:n=-1}switch(n){case THREE.MOUSE.DOLLY:if(!1===a.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enablePan)return;C(e),s=o.PAN}else{if(!1===a.enableRotate)return;L(e),s=o.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enableRotate)return;L(e),s=o.ROTATE}else{if(!1===a.enablePan)return;C(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&(a.domElement.ownerDocument.addEventListener("pointermove",B),a.domElement.ownerDocument.addEventListener("pointerup",z),a.dispatchEvent(t))}(e)}}function B(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===a.enabled)return;switch(e.preventDefault(),s){case o.ROTATE:if(!1===a.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),g.subVectors(m,p).multiplyScalar(a.rotateSpeed);const t=a.domElement;T(2*Math.PI*g.x/t.clientHeight),A(2*Math.PI*g.y/t.clientHeight),p.copy(m),a.update()}(e);break;case o.DOLLY:if(!1===a.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),w.subVectors(E,b),w.y>0?k(x()):w.y<0&&P(x()),b.copy(E),a.update()}(e);break;case o.PAN:if(!1===a.enablePan)return;!function(e){y.set(e.clientX,e.clientY),_.subVectors(y,v).multiplyScalar(a.panSpeed),R(_.x,_.y),v.copy(y),a.update()}(e)}}(e)}}function z(e){switch(e.pointerType){case"mouse":case"pen":!function(e){if(a.domElement.ownerDocument.removeEventListener("pointermove",B),a.domElement.ownerDocument.removeEventListener("pointerup",z),!1===a.enabled)return;a.dispatchEvent(n),s=o.NONE}()}}function V(e){!1===a.enabled||!1===a.enableZoom||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),a.dispatchEvent(t),function(e){e.deltaY<0?P(x()):e.deltaY>0&&k(x()),a.update()}(e),a.dispatchEvent(n))}function j(e){!1!==a.enabled&&!1!==a.enablePan&&function(e){let t=!1;switch(e.code){case a.keys.UP:R(0,a.keyPanSpeed),t=!0;break;case a.keys.BOTTOM:R(0,-a.keyPanSpeed),t=!0;break;case a.keys.LEFT:R(a.keyPanSpeed,0),t=!0;break;case a.keys.RIGHT:R(-a.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),a.update())}(e)}function G(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(a.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===a.enableRotate)return;I(e),s=o.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===a.enablePan)return;N(e),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(a.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&F(e),a.enablePan&&N(e)}(e),s=o.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&F(e),a.enableRotate&&I(e)}(e),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&a.dispatchEvent(t)}}function W(e){if(!1!==a.enabled)switch(e.preventDefault(),s){case o.TOUCH_ROTATE:if(!1===a.enableRotate)return;O(e),a.update();break;case o.TOUCH_PAN:if(!1===a.enablePan)return;H(e),a.update();break;case o.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&D(e),a.enablePan&&H(e)}(e),a.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&D(e),a.enableRotate&&O(e)}(e),a.update();break;default:s=o.NONE}}function q(e){!1!==a.enabled&&(a.dispatchEvent(n),s=o.NONE)}function X(e){!1!==a.enabled&&e.preventDefault()}a.domElement.addEventListener("contextmenu",X),a.domElement.addEventListener("pointerdown",U),a.domElement.addEventListener("wheel",V,{passive:!1}),a.domElement.addEventListener("touchstart",G,{passive:!1}),a.domElement.addEventListener("touchend",q),a.domElement.addEventListener("touchmove",W,{passive:!1}),this.update()}}THREE.MapControls=class extends r{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE}},THREE.OrbitControls=r}()},5100:()=>{THREE.OrthographicTrackballControls=function(e,t){var n=this,r=-1,i=0,a=1,o=2,s=3,l=4;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var c=!0,u=r,h=r,d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,v=0,y=0,_=new THREE.Vector2,b=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var E={type:"change"},w={type:"start"},x={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var T,A,M,S,R,k,P=(T=new THREE.Vector2,function(e,t){return T.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height),T}),L=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,a){r.set((i-.5*n.screen.width-n.screen.left)/n.radius,(.5*n.screen.height+n.screen.top-a)/n.radius,0);var o=r.length();return n.noRoll?o<Math.SQRT1_2?r.z=Math.sqrt(1-o*o):r.z=.5/o:o>1?r.normalize():r.z=Math.sqrt(1-o*o),d.copy(n.object.position).sub(n.target),e.copy(n.object.up).setLength(r.y),e.add(t.copy(n.object.up).cross(d).setLength(r.x)),e.add(d.setLength(r.z)),e}}();function C(e){!1!==n.enabled&&(window.removeEventListener("keydown",C),h=u,u===r&&(e.keyCode!==n.keys[i]||n.noRotate?e.keyCode!==n.keys[a]||n.noZoom?e.keyCode!==n.keys[o]||n.noPan||(u=o):u=a:u=i))}function I(e){!1!==n.enabled&&(u=h,window.addEventListener("keydown",C,!1))}function N(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),u===r&&(u=e.button),u!==i||n.noRotate?u!==a||n.noZoom?u!==o||n.noPan||(_.copy(P(e.pageX,e.pageY)),b.copy(_)):(m.copy(P(e.pageX,e.pageY)),g.copy(m)):(f.copy(L(e.pageX,e.pageY)),p.copy(f)),document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",O,!1),n.dispatchEvent(w))}function F(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),u!==i||n.noRotate?u!==a||n.noZoom?u!==o||n.noPan||b.copy(P(e.pageX,e.pageY)):g.copy(P(e.pageX,e.pageY)):p.copy(L(e.pageX,e.pageY)))}function O(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),u=r,document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",O),n.dispatchEvent(x))}function H(e){if(!1!==n.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),m.y+=.01*t,n.dispatchEvent(w),n.dispatchEvent(x)}}function D(e){if(!1!==n.enabled){switch(e.touches.length){case 1:u=s,f.copy(L(e.touches[0].pageX,e.touches[0].pageY)),p.copy(f);break;case 2:u=l;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;y=v=Math.sqrt(t*t+i*i);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;_.copy(P(a,o)),b.copy(_);break;default:u=r}n.dispatchEvent(w)}}function U(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:p.copy(L(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;y=Math.sqrt(t*t+i*i);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(P(a,o));break;default:u=r}}function B(e){if(!1!==n.enabled){switch(e.touches.length){case 1:p.copy(L(e.touches[0].pageX,e.touches[0].pageY)),f.copy(p);break;case 2:v=y=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(P(t,i)),_.copy(b)}u=r,n.dispatchEvent(x)}}function z(e){e.preventDefault()}this.rotateCamera=(A=new THREE.Vector3,M=new THREE.Quaternion,function(){var e=Math.acos(f.dot(p)/f.length()/p.length());e&&(A.crossVectors(f,p).normalize(),e*=n.rotateSpeed,M.setFromAxisAngle(A,-e),d.applyQuaternion(M),n.object.up.applyQuaternion(M),p.applyQuaternion(M),n.staticMoving?f.copy(p):(M.setFromAxisAngle(A,e*(n.dynamicDampingFactor-1)),f.applyQuaternion(M)),c=!0)}),this.zoomCamera=function(){if(u===l){var e=y/v;v=y,n.object.zoom*=e,c=!0}else{e=1+(g.y-m.y)*n.zoomSpeed;Math.abs(e-1)>1e-6&&e>0&&(n.object.zoom/=e,n.staticMoving?m.copy(g):m.y+=(g.y-m.y)*this.dynamicDampingFactor,c=!0)}},this.panCamera=(S=new THREE.Vector2,R=new THREE.Vector3,k=new THREE.Vector3,function(){if(S.copy(b).sub(_),S.lengthSq()){var e=(n.object.right-n.object.left)/n.object.zoom,t=(n.object.top-n.object.bottom)/n.object.zoom;S.x*=e*n.panSpeed,S.y*=t*n.panSpeed,k.copy(d).cross(n.object.up).setLength(S.x),k.add(R.copy(n.object.up).setLength(S.y)),n.object.position.add(k),n.target.add(k),n.staticMoving?_.copy(b):_.add(S.subVectors(b,_).multiplyScalar(n.dynamicDampingFactor)),c=!0}}),this.update=function(){d.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||(n.zoomCamera(),c&&n.object.updateProjectionMatrix()),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,d),n.object.lookAt(n.target),c&&(n.dispatchEvent(E),c=!1)},this.reset=function(){u=r,h=r,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),d.subVectors(n.object.position,n.target),n.object.left=n.left0,n.object.right=n.right0,n.object.top=n.top0,n.object.bottom=n.bottom0,n.object.lookAt(n.target),n.dispatchEvent(E),c=!1},this.disableEvents=function(){this.domElement.removeEventListener("contextmenu",z,!1),this.domElement.removeEventListener("mousedown",N,!1),this.domElement.removeEventListener("wheel",H,!1),this.domElement.removeEventListener("MozMousePixelScroll",H,!1),this.domElement.removeEventListener("touchstart",D,!1),this.domElement.removeEventListener("touchend",B,!1),this.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",O,!1),window.removeEventListener("keydown",C,!1),window.removeEventListener("keyup",I,!1)},this.dispose=this.disableEvents,this.enableEvents=function(){this.domElement.addEventListener("contextmenu",z,!1),this.domElement.addEventListener("mousedown",N,!1),this.domElement.addEventListener("wheel",H,!1),this.domElement.addEventListener("MozMousePixelScroll",H,!1),this.domElement.addEventListener("touchstart",D,!1),this.domElement.addEventListener("touchend",B,!1),this.domElement.addEventListener("touchmove",U,!1),window.addEventListener("keydown",C,!1),window.addEventListener("keyup",I,!1)},this.enableEvents(),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls},8726:()=>{!function(){class e extends THREE.Pass{constructor(e,t,n,r){super(),this.renderScene=t,this.renderCamera=n,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);const i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=THREE.DoubleSide,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var n=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===THREE.CopyShader&&console.error("THREE.OutlinePass relies on THREE.CopyShader");const s=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new THREE.FullScreenQuad(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let n=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,r),this.renderTargetBlurBuffer1.setSize(n,r),this.renderTargetEdgeBuffer1.setSize(n,r),this.separableBlurMaterial1.uniforms.texSize.value.set(n,r),n=Math.round(n/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(n,r),this.renderTargetEdgeBuffer2.setSize(n,r),this.separableBlurMaterial2.uniforms.texSize.value.set(n,r)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function n(n){n.isMesh&&(!0===e?n.visible=t.get(n):(t.set(n,n.visible),n.visible=e))}for(let e=0;e<this.selectedObjects.length;e++){this.selectedObjects[e].traverse(n)}}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,n=[];function r(e){e.isMesh&&n.push(e)}for(let e=0;e<this.selectedObjects.length;e++){this.selectedObjects[e].traverse(r)}this.renderScene.traverse((function(r){if(r.isMesh||r.isSprite){let i=!1;for(let e=0;e<n.length;e++){if(n[e].id===r.id){i=!0;break}}if(!1===i){const n=r.visible;!1!==e&&!0!==t.get(r)||(r.visible=e),t.set(r,n)}}else(r.isPoints||r.isLine)&&(!0===e?r.visible=t.get(r):(t.set(r,r.visible),r.visible=e))}))}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(t,n,r,i,a){if(this.selectedObjects.length>0){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const n=t.autoClear;t.autoClear=!1,a&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const i=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=i,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const e=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(e),this.tempPulseColor2.multiplyScalar(e)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=e.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=e.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=e.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=e.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,a&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(r),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=n}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,t.setRenderTarget(null),this.fsQuad.render(t))}getPrepareMaskMaterial(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:"#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tuniform mat4 textureMatrix;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <morphtarget_vertex>\n\t\t\t\t\t#include <skinning_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t\tvPosition = mvPosition;\n\t\t\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\t\t\tprojTexCoord = textureMatrix * worldPosition;\n\n\t\t\t\t}",fragmentShader:"#include <packing>\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tuniform sampler2D depthTexture;\n\t\t\t\tuniform vec2 cameraNearFar;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\n\t\t\t\t\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );\n\t\t\t\t\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\n\t\t\t\t\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\n\n\t\t\t\t}"})}getEdgeDetectionMaterial(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec3 visibleEdgeColor;\n\t\t\t\tuniform vec3 hiddenEdgeColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\n\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\n\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\n\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\n\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\n\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\n\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\n\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\n\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\n\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\n\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\n\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\n\t\t\t\t}"})}getSeperableBlurMaterial(e){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float kernelRadius;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\n\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\n\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\n\t\t\t\t\tvec2 uvOffset = delta;\n\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\n\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\t\t\tuvOffset += delta;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\n\t\t\t\t}"})}getOverlayMaterial(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform sampler2D edgeTexture1;\n\t\t\t\tuniform sampler2D edgeTexture2;\n\t\t\t\tuniform sampler2D patternTexture;\n\t\t\t\tuniform float edgeStrength;\n\t\t\t\tuniform float edgeGlow;\n\t\t\t\tuniform bool usePatternTexture;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\n\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\n\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\n\t\t\t\t\tif(usePatternTexture)\n\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\n\t\t\t\t\tgl_FragColor = finalColor;\n\t\t\t\t}",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}e.BlurDirectionX=new THREE.Vector2(1,0),e.BlurDirectionY=new THREE.Vector2(0,1),THREE.OutlinePass=e}()},7181:()=>{THREE.PLYExporter=class{parse(e,t,n){function r(t){e.traverse((function(e){if(!0===e.isMesh){const n=e,r=n.geometry;if(!0!==r.isBufferGeometry)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");!0===r.hasAttribute("position")&&t(n,r)}}))}t&&"object"==typeof t&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),n=t,t=void 0);const i=(n=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},n)).excludeAttributes;let a=!1,o=!1,s=!1,l=0,c=0;e.traverse((function(e){if(!0===e.isMesh){const t=e.geometry;if(!0!==t.isBufferGeometry)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");const n=t.getAttribute("position"),r=t.getAttribute("normal"),i=t.getAttribute("uv"),u=t.getAttribute("color"),h=t.getIndex();if(void 0===n)return;l+=n.count,c+=h?h.count/3:n.count/3,void 0!==r&&(a=!0),void 0!==i&&(s=!0),void 0!==u&&(o=!0)}}));const u=-1===i.indexOf("index");if(a=a&&-1===i.indexOf("normal"),o=o&&-1===i.indexOf("color"),s=s&&-1===i.indexOf("uv"),u&&c!==Math.floor(c))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;let h=`ply\nformat ${n.binary?n.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0\nelement vertex ${l}\nproperty float x\nproperty float y\nproperty float z\n`;!0===a&&(h+="property float nx\nproperty float ny\nproperty float nz\n"),!0===s&&(h+="property float s\nproperty float t\n"),!0===o&&(h+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===u&&(h+=`element face ${c}\nproperty list uchar int vertex_index\n`),h+="end_header\n";const d=new THREE.Vector3,f=new THREE.Matrix3;let p=null;if(!0===n.binary){const e=(new TextEncoder).encode(h),t=l*(12+(a?12:0)+(o?3:0)+(s?8:0)),i=u?13*c:0,m=new DataView(new ArrayBuffer(e.length+t+i));new Uint8Array(m.buffer).set(e,0);let g=e.length,v=e.length+t,y=0;r((function(e,t){const r=t.getAttribute("position"),i=t.getAttribute("normal"),l=t.getAttribute("uv"),c=t.getAttribute("color"),h=t.getIndex();f.getNormalMatrix(e.matrixWorld);for(let t=0,u=r.count;t<u;t++)d.x=r.getX(t),d.y=r.getY(t),d.z=r.getZ(t),d.applyMatrix4(e.matrixWorld),m.setFloat32(g,d.x,n.littleEndian),g+=4,m.setFloat32(g,d.y,n.littleEndian),g+=4,m.setFloat32(g,d.z,n.littleEndian),g+=4,!0===a&&(null!=i?(d.x=i.getX(t),d.y=i.getY(t),d.z=i.getZ(t),d.applyMatrix3(f).normalize(),m.setFloat32(g,d.x,n.littleEndian),g+=4,m.setFloat32(g,d.y,n.littleEndian),g+=4,m.setFloat32(g,d.z,n.littleEndian),g+=4):(m.setFloat32(g,0,n.littleEndian),g+=4,m.setFloat32(g,0,n.littleEndian),g+=4,m.setFloat32(g,0,n.littleEndian),g+=4)),!0===s&&(null!=l?(m.setFloat32(g,l.getX(t),n.littleEndian),g+=4,m.setFloat32(g,l.getY(t),n.littleEndian),g+=4):!1!==s&&(m.setFloat32(g,0,n.littleEndian),g+=4,m.setFloat32(g,0,n.littleEndian),g+=4)),!0===o&&(null!=c?(m.setUint8(g,Math.floor(255*c.getX(t))),g+=1,m.setUint8(g,Math.floor(255*c.getY(t))),g+=1,m.setUint8(g,Math.floor(255*c.getZ(t))),g+=1):(m.setUint8(g,255),g+=1,m.setUint8(g,255),g+=1,m.setUint8(g,255),g+=1));if(!0===u)if(null!==h)for(let e=0,t=h.count;e<t;e+=3)m.setUint8(v,3),v+=1,m.setUint32(v,h.getX(e+0)+y,n.littleEndian),v+=4,m.setUint32(v,h.getX(e+1)+y,n.littleEndian),v+=4,m.setUint32(v,h.getX(e+2)+y,n.littleEndian),v+=4;else for(let e=0,t=r.count;e<t;e+=3)m.setUint8(v,3),v+=1,m.setUint32(v,y+e,n.littleEndian),v+=4,m.setUint32(v,y+e+1,n.littleEndian),v+=4,m.setUint32(v,y+e+2,n.littleEndian),v+=4;y+=r.count})),p=m.buffer}else{let e=0,t="",n="";r((function(r,i){const l=i.getAttribute("position"),h=i.getAttribute("normal"),p=i.getAttribute("uv"),m=i.getAttribute("color"),g=i.getIndex();f.getNormalMatrix(r.matrixWorld);for(let e=0,n=l.count;e<n;e++){d.x=l.getX(e),d.y=l.getY(e),d.z=l.getZ(e),d.applyMatrix4(r.matrixWorld);let n=d.x+" "+d.y+" "+d.z;!0===a&&(null!=h?(d.x=h.getX(e),d.y=h.getY(e),d.z=h.getZ(e),d.applyMatrix3(f).normalize(),n+=" "+d.x+" "+d.y+" "+d.z):n+=" 0 0 0"),!0===s&&(null!=p?n+=" "+p.getX(e)+" "+p.getY(e):!1!==s&&(n+=" 0 0")),!0===o&&(n+=null!=m?" "+Math.floor(255*m.getX(e))+" "+Math.floor(255*m.getY(e))+" "+Math.floor(255*m.getZ(e)):" 255 255 255"),t+=n+"\n"}if(!0===u){if(null!==g)for(let t=0,r=g.count;t<r;t+=3)n+=`3 ${g.getX(t+0)+e}`,n+=` ${g.getX(t+1)+e}`,n+=` ${g.getX(t+2)+e}\n`;else for(let t=0,r=l.count;t<r;t+=3)n+=`3 ${e+t} ${e+t+1} ${e+t+2}\n`;c+=g?g.count/3:l.count/3}e+=l.count})),p=`${h}${t}${u?`${n}\n`:"\n"}`}return"function"==typeof t&&requestAnimationFrame((()=>t(p))),p}}},8085:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,n,r){const i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){function t(e){let t="",n=0;const r=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==r&&(t=r[1],n=new Blob([r[0]]).size);const i={comments:[],elements:[],headerLength:n,objInfo:""},a=t.split("\n");let o;function s(e,t){const n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}for(let e=0;e<a.length;e++){let t=a[e];if(t=t.trim(),""===t)continue;const n=t.split(/\s+/),r=n.shift();switch(t=n.join(" "),r){case"format":i.format=n[0],i.version=n[1];break;case"comment":i.comments.push(t);break;case"element":void 0!==o&&i.elements.push(o),o={},o.name=n[0],o.count=parseInt(n[1]),o.properties=[];break;case"property":o.properties.push(s(n,u.propertyNameMapping));break;case"obj_info":i.objInfo=t;break;default:console.log("unhandled",r,n)}}return void 0!==o&&i.elements.push(o),i}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){const r=t.split(/\s+/),i={};for(let t=0;t<e.length;t++)if("list"===e[t].type){const a=[],o=n(r.shift(),e[t].countType);for(let i=0;i<o;i++)a.push(n(r.shift(),e[t].itemType));i[e[t].name]=a}else i[e[t].name]=n(r.shift(),e[t].type);return i}function i(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let i;let s="";null!==(i=/end_header\s([\s\S]*)$/.exec(e))&&(s=i[1]);const l=s.split("\n");let c=0,u=0;for(let e=0;e<l.length;e++){let i=l[e];if(i=i.trim(),""===i)continue;u>=t.elements[c].count&&(c++,u=0);const a=r(t.elements[c].properties,i);o(n,t.elements[c].name,a),u++}return a(n)}function a(e){let t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed(),t.setAttribute("uv",new THREE.Float32BufferAttribute(e.faceVertexUvs,2))),t.computeBoundingSphere(),t}function o(e,t,n){if("vertex"===t)e.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&e.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&e.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&e.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===t){const t=n.vertex_indices||n.vertex_index,r=n.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),r&&6===r.length&&(e.faceVertexUvs.push(r[0],r[1]),e.faceVertexUvs.push(r[2],r[3]),e.faceVertexUvs.push(r[4],r[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3]))}}function s(e,t,n,r){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function l(e,t,n,r){const i={};let a,o=0;for(let l=0;l<n.length;l++)if("list"===n[l].type){const c=[];a=s(e,t+o,n[l].countType,r);const u=a[0];o+=a[1];for(let i=0;i<u;i++)a=s(e,t+o,n[l].itemType,r),c.push(a[0]),o+=a[1];i[n[l].name]=c}else a=s(e,t+o,n[l].type,r),i[n[l].name]=a[0],o+=a[1];return[i,o]}let c;const u=this;if(e instanceof ArrayBuffer){const n=THREE.LoaderUtils.decodeText(new Uint8Array(e)),r=t(n);c="ascii"===r.format?i(n,r):function(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},r="binary_little_endian"===t.format,i=new DataView(e,t.headerLength);let s,c=0;for(let e=0;e<t.elements.length;e++)for(let a=0;a<t.elements[e].count;a++){s=l(i,c,t.elements[e].properties,r),c+=s[1];const a=s[0];o(n,t.elements[e].name,a)}return a(n)}(e,r)}else c=i(e,t(e));return c}}THREE.PLYLoader=e}()},6716:()=>{THREE.ParallaxBarrierEffect=class{constructor(e){const t=new THREE.OrthographicCamera(-1,1,1,-1,0,1),n=new THREE.Scene,r=new THREE.StereoCamera,i={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},a=new THREE.WebGLRenderTarget(512,512,i),o=new THREE.WebGLRenderTarget(512,512,i),s=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:a.texture},mapRight:{value:o.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),l=new THREE.Mesh(new THREE.PlaneGeometry(2,2),s);n.add(l),this.setSize=function(t,n){e.setSize(t,n);const r=e.getPixelRatio();a.setSize(t*r,n*r),o.setSize(t*r,n*r)},this.render=function(i,s){i.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),r.update(s),e.setRenderTarget(a),e.clear(),e.render(i,r.cameraL),e.setRenderTarget(o),e.clear(),e.render(i,r.cameraR),e.setRenderTarget(null),e.render(n,t)}}}},8721:()=>{class e{constructor(e,t,n){this.checkCompatibility(n),this.renderer=n,this.size=e||128,this.resolution=new THREE.Vector2(this.size,this.size),this.rt_1=new THREE.WebGLRenderTarget(this.size,this.size,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType,stencilBuffer:!1}),this.rt_2=this.rt_1.clone(),this.rt_3=this.rt_1.clone(),this.counter=0,this.texturePass=this.createTexturePassProgram(),this.simulatePass=this.createSimulatePassProgram(t),this.boundTextures=[],this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2)),this.scene.add(this.mesh)}checkCompatibility(e){var t=e.getContext();null!==t.getExtension("OES_texture_float")?0!==t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)||this.onError("Vertex Shader Textures don't work"):this.onError("No Float Textures")}onError(e){console.log(e)}createDebugScene(){var e=new THREE.Object3D;e.position.z=0;var t,n=new THREE.PlaneBufferGeometry(100,100);return(t=new THREE.Mesh(n,new THREE.MeshBasicMaterial({map:this.rt_1}))).position.set(-105,0,0),e.add(t),(t=new THREE.Mesh(n,new THREE.MeshBasicMaterial({map:this.rt_2}))).position.set(0,0,0),e.add(t),(t=new THREE.Mesh(n,new THREE.MeshBasicMaterial({map:this.rt_3}))).position.set(105,0,0),e.add(t),e}removeDebugScene(e){e.remove(this.debugScene)}addDebugScene(e){e.add(this.debugScene)}createTexturePassProgram(){return new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:null}},vertexShader:this.VSPass,fragmentShader:this.FSPass})}createSimulatePassProgram(e){var t={t_oPos:{type:"t",value:null},t_pos:{type:"t",value:null},resolution:{type:"v2",value:this.resolution}};return new THREE.ShaderMaterial({uniforms:t,vertexShader:this.VSPass,fragmentShader:e})}update(){var e=this.counter%3;0==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_1.texture,this.simulatePass.uniforms.t_pos.value=this.rt_2.texture,this.pass(this.simulatePass,this.rt_3),this.ooOutput=this.rt_1.texture,this.oOutput=this.rt_2.texture,this.output=this.rt_3.texture):1==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_2.texture,this.simulatePass.uniforms.t_pos.value=this.rt_3.texture,this.pass(this.simulatePass,this.rt_1),this.ooOutput=this.rt_2.texture,this.oOutput=this.rt_3.texture,this.output=this.rt_1.texture):2==e&&(this.simulatePass.uniforms.t_oPos.value=this.rt_3.texture,this.simulatePass.uniforms.t_pos.value=this.rt_1.texture,this.pass(this.simulatePass,this.rt_2),this.ooOutput=this.rt_3.texture,this.oOutput=this.rt_1.texture,this.output=this.rt_2.texture),this.counter++,this.bindTextures()}render(e,t,n){this.renderer.setRenderTarget(n),this.renderer.render(e,t)}pass(e,t){this.mesh.material=e,this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.camera)}out(e){this.mesh.material=e.material,this.renderer.render(this.scene,this.camera)}setUniforms(e){for(var t in e)this.simulatePass.uniforms[t]=e[t];this.simulatePass.uniforms.t_pos={type:"t",value:null},this.simulatePass.uniforms.t_oPos={type:"t",value:null},this.simulatePass.uniforms.resolution={type:"v2",value:this.resolution}}setUniform(e,t){this.simulatePass.uniforms[e]=t}reset(e){this.texture=e,this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,this.rt_1),this.pass(this.texturePass,this.rt_2),this.pass(this.texturePass,this.rt_3)}passTexture(e,t){this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,t)}resetRand(e,t,n,r){e=e||100,t=t||0,n=n||0,r=r||0;for(var i=new Float32Array(this.size*this.size*4),a=0;a<i.length;a+=4)i[a+0]=t+(Math.random()-.5)*e,i[a+1]=n+(Math.random()-.5)*e,i[a+2]=r+(Math.random()-.5)*e,i[a+3]=100;var o=new THREE.DataTexture(i,this.size,this.size,THREE.RGBAFormat,THREE.FloatType);o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.needsUpdate=!0,this.reset(o)}addBoundTexture(e,t){this.boundTextures.push([e,t])}bindTextures(){for(var e=0;e<this.boundTextures.length;e++){var t=this.boundTextures[e][0],n=this.boundTextures[e][1];t.value=this[n]}}}e.prototype.VSPass=["varying vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = vec4( position, 1.0 );","}"].join("\n"),e.prototype.FSPass=["uniform sampler2D uTexture;","varying vec2 vUv;","void main() {","  vec4 c = texture2D( uTexture , vUv );","  gl_FragColor = c;","}"].join("\n"),e.prototype.isPhysicsRenderer=!0,THREE.PhysicsRenderer=e},4419:()=>{!function(){class e extends THREE.DataTextureLoader{constructor(e){super(e),this.type=THREE.UnsignedByteType}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;let r=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=s.indexOf("\n"))&&a<t&&r<e.byteLength;)o+=s,a+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=a+i+1),o+s.slice(0,i))},r=function(e,t,n,r){const i=e[t+3],a=Math.pow(2,i-128)/255;n[r+0]=e[t+0]*a,n[r+1]=e[t+1]*a,n[r+2]=e[t+2]*a},i=function(e,t,n,r){const i=e[t+3],a=Math.pow(2,i-128)/255;n[r+0]=THREE.DataUtils.toHalfFloat(e[t+0]*a),n[r+1]=THREE.DataUtils.toHalfFloat(e[t+1]*a),n[r+2]=THREE.DataUtils.toHalfFloat(e[t+2]*a)},a=new Uint8Array(e);a.pos=0;const o=function(e){const r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=n(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(s.valid|=1,s.programtype=c[1],s.string+=l+"\n";l=n(e),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(r))&&(s.gamma=parseFloat(c[1],10)),(c=l.match(i))&&(s.exposure=parseFloat(c[1],10)),(c=l.match(a))&&(s.valid|=2,s.format=c[1]),(c=l.match(o))&&(s.valid|=4,s.height=parseInt(c[1],10),s.width=parseInt(c[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid?4&s.valid?s:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==o){const e=o.width,n=o.height,s=function(e,n,r){const i=n;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(i!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const a=new Uint8Array(4*n*r);if(!a.length)return t(4,"unable to allocate buffer space");let o=0,s=0;const l=4*i,c=new Uint8Array(4),u=new Uint8Array(l);let h=r;for(;h>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(c[0]=e[s++],c[1]=e[s++],c[2]=e[s++],c[3]=e[s++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=i)return t(3,"bad rgbe scanline format");let n,r=0;for(;r<l&&s<e.byteLength;){n=e[s++];const i=n>128;if(i&&(n-=128),0===n||r+n>l)return t(3,"bad scanline data");if(i){const t=e[s++];for(let e=0;e<n;e++)u[r++]=t}else u.set(e.subarray(s,s+n),r),r+=n,s+=n}const d=i;for(let e=0;e<d;e++){let t=0;a[o]=u[e+t],t+=i,a[o+1]=u[e+t],t+=i,a[o+2]=u[e+t],t+=i,a[o+3]=u[e+t],o+=4}h--}return a}(a.subarray(a.pos),e,n);if(-1!==s){let t,a,l,c;switch(this.type){case THREE.UnsignedByteType:t=s,a=THREE.RGBEFormat,l=THREE.UnsignedByteType;break;case THREE.FloatType:c=s.length/4*3;const e=new Float32Array(c);for(let t=0;t<c;t++)r(s,4*t,e,3*t);t=e,a=THREE.RGBFormat,l=THREE.FloatType;break;case THREE.HalfFloatType:c=s.length/4*3;const n=new Uint16Array(c);for(let e=0;e<c;e++)i(s,4*e,n,3*e);t=n,a=THREE.RGBFormat,l=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:n,data:t,header:o.string,gamma:o.gamma,exposure:o.exposure,format:a,type:l}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,(function(e,n){switch(e.type){case THREE.UnsignedByteType:e.encoding=THREE.RGBEEncoding,e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case THREE.FloatType:case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,r)}}THREE.RGBELoader=e}()},6288:()=>{!function(){class e extends THREE.Mesh{constructor(t,n={}){super(t),this.type="Reflector";const r=this,i=void 0!==n.color?new THREE.Color(n.color):new THREE.Color(8355711),a=n.textureWidth||512,o=n.textureHeight||512,s=n.clipBias||0,l=n.shader||e.ReflectorShader,c=new THREE.Plane,u=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Matrix4,p=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,g=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector4,_=new THREE.Matrix4,b=new THREE.PerspectiveCamera,E={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},w=new THREE.WebGLRenderTarget(a,o,E);THREE.MathUtils.isPowerOfTwo(a)&&THREE.MathUtils.isPowerOfTwo(o)||(w.texture.generateMipmaps=!1);const x=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});x.uniforms.tDiffuse.value=w.texture,x.uniforms.color.value=i,x.uniforms.textureMatrix.value=_,this.material=x,this.onBeforeRender=function(e,t,n){if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),f.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),g.subVectors(h,d),g.dot(u)>0)return;g.reflect(u).negate(),g.add(h),f.extractRotation(n.matrixWorld),p.set(0,0,-1),p.applyMatrix4(f),p.add(d),v.subVectors(h,p),v.reflect(u).negate(),v.add(h),b.position.copy(g),b.up.set(0,1,0),b.up.applyMatrix4(f),b.up.reflect(u),b.lookAt(v),b.far=n.far,b.updateMatrixWorld(),b.projectionMatrix.copy(n.projectionMatrix),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(b.projectionMatrix),_.multiply(b.matrixWorldInverse),_.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(b.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const i=b.projectionMatrix;y.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],y.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],y.z=-1,y.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(y)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-s,i.elements[14]=m.w,w.texture.encoding=THREE.LinearEncoding,r.visible=!1;const a=e.getRenderTarget(),o=e.xr.enabled,l=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,b),e.xr.enabled=o,e.shadowMap.autoUpdate=l,e.setRenderTarget(a);const E=n.viewport;void 0!==E&&e.state.viewport(E),r.visible=!0},this.getRenderTarget=function(){return w}}}e.prototype.isReflector=!0,e.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"},THREE.Reflector=e}()},822:()=>{!function(){class e extends THREE.Mesh{constructor(t,n={}){super(t),this.type="Refractor";const r=this,i=void 0!==n.color?new THREE.Color(n.color):new THREE.Color(8355711),a=n.textureWidth||512,o=n.textureHeight||512,s=n.clipBias||0,l=n.shader||e.RefractorShader,c=new THREE.PerspectiveCamera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const u=new THREE.Plane,h=new THREE.Matrix4,d={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},f=new THREE.WebGLRenderTarget(a,o,d);THREE.MathUtils.isPowerOfTwo(a)&&THREE.MathUtils.isPowerOfTwo(o)||(f.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=f.texture,this.material.uniforms.textureMatrix.value=h;!function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Matrix4,r=new THREE.Vector3,i=new THREE.Vector3}();const p=function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;return function(){r.matrixWorld.decompose(t,n,i),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),m=function(){const e=new THREE.Plane,t=new THREE.Vector4,n=new THREE.Vector4;return function(r){c.matrixWorld.copy(r.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(r.projectionMatrix),c.far=r.far,e.copy(u),e.applyMatrix4(c.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);const i=c.projectionMatrix;n.x=(Math.sign(t.x)+i.elements[8])/i.elements[0],n.y=(Math.sign(t.y)+i.elements[9])/i.elements[5],n.z=-1,n.w=(1+i.elements[10])/i.elements[14],t.multiplyScalar(2/t.dot(n)),i.elements[2]=t.x,i.elements[6]=t.y,i.elements[10]=t.z+1-s,i.elements[14]=t.w}}();this.onBeforeRender=function(e,t,n){f.texture.encoding=e.outputEncoding,!0!==n.userData.refractor&&(p(),function(e){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(e.projectionMatrix),h.multiply(e.matrixWorldInverse),h.multiply(r.matrixWorld)}(n),m(n),function(e,t,n){r.visible=!1;const i=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(f),!1===e.autoClear&&e.clear(),e.render(t,c),e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i);const s=n.viewport;void 0!==s&&e.state.viewport(s),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return f}}}e.prototype.isRefractor=!0,e.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec4 vUv;\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"},THREE.Refractor=e}()},7613:()=>{!function(){class e extends THREE.Pass{constructor(e,t,n,r,i){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new THREE.Color}render(e,t,n){const r=e.autoClear;let i,a;e.autoClear=!1,void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=r}}THREE.RenderPass=e}()},2025:()=>{!function(){class e extends THREE.Pass{constructor(e,t,n,r){super(),this.width=void 0!==n?n:512,this.height=void 0!==r?r:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();const i=new THREE.DepthTexture;i.type=THREE.UnsignedShortType,this.beautyRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.normalRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthTexture:i}),this.ssaoRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===THREE.SSAOShader&&console.error("THREE.SSAOPass: The pass relies on THREE.SSAOShader."),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOShader.uniforms),vertexShader:THREE.SSAOShader.vertexShader,fragmentShader:THREE.SSAOShader.fragmentShader,blending:THREE.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new THREE.MeshNormalMaterial,this.normalMaterial.blending=THREE.NoBlending,this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOBlurShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOBlurShader.uniforms),vertexShader:THREE.SSAOBlurShader.vertexShader,fragmentShader:THREE.SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAODepthShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAODepthShader.uniforms),vertexShader:THREE.SSAODepthShader.vertexShader,fragmentShader:THREE.SSAODepthShader.fragmentShader,blending:THREE.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.CopyShader.uniforms),vertexShader:THREE.CopyShader.vertexShader,fragmentShader:THREE.CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:THREE.DstColorFactor,blendDst:THREE.ZeroFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.DstAlphaFactor,blendDstAlpha:THREE.ZeroFactor,blendEquationAlpha:THREE.AddEquation}),this.fsQuad=new THREE.FullScreenQuad(null),this.originalClearColor=new THREE.Color}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,n){switch(t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.output){case e.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;case e.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;case e.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;case e.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:n);break;case e.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;case e.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.CustomBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(e,t,n,r,i){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,null!=r&&(e.setClearColor(r),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,n,r,i){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,r=t.clearColor||r,i=t.clearAlpha||i,null!=r&&(e.setClearColor(r),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(){const e=this.kernelSize,t=this.kernel;for(let n=0;n<e;n++){const r=new THREE.Vector3;r.x=2*Math.random()-1,r.y=2*Math.random()-1,r.z=Math.random(),r.normalize();let i=n/e;i=THREE.MathUtils.lerp(.1,1,i*i),r.multiplyScalar(i),t.push(r)}}generateRandomKernelRotations(){void 0===THREE.SimplexNoise&&console.error("THREE.SSAOPass: The pass relies on THREE.SimplexNoise.");const e=new THREE.SimplexNoise,t=new Float32Array(64);for(let n=0;n<16;n++){const r=4*n,i=2*Math.random()-1,a=2*Math.random()-1,o=0,s=e.noise3d(i,a,o);t[r]=s,t[r+1]=s,t[r+2]=s,t[r+3]=1}this.noiseTexture=new THREE.DataTexture(t,4,4,THREE.RGBAFormat,THREE.FloatType),this.noiseTexture.wrapS=THREE.RepeatWrapping,this.noiseTexture.wrapT=THREE.RepeatWrapping}overrideVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse((function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)}))}restoreVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse((function(e){const n=t.get(e);e.visible=n})),t.clear()}}e.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5},THREE.SSAOPass=e}()},9681:()=>{!function(){const e={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new THREE.Vector2},cameraProjectionMatrix:{value:new THREE.Matrix4},cameraInverseProjectionMatrix:{value:new THREE.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tNormal;\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;\n\n\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t float occlusion = 0.0;\n\n\t\t for ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t}"},t={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},n={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"};THREE.SSAOBlurShader=n,THREE.SSAODepthShader=t,THREE.SSAOShader=e}()},3202:()=>{THREE.STLExporter=class{parse(e,t={}){const n=void 0!==t.binary&&t.binary,r=[];let i,a=0;e.traverse((function(e){if(e.isMesh){const t=e.geometry;if(!0!==t.isBufferGeometry)throw new Error("THREE.STLExporter: Geometry is not of type THREE.BufferGeometry.");const n=t.index,i=t.getAttribute("position");a+=null!==n?n.count/3:i.count/3,r.push({object3d:e,geometry:t})}}));let o=80;if(!0===n){const e=new ArrayBuffer(2*a+3*a*4*4+80+4);i=new DataView(e),i.setUint32(o,a,!0),o+=4}else i="",i+="solid exported\n";const s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector3;for(let e=0,t=r.length;e<t;e++){const t=r[e].object3d,n=r[e].geometry,i=n.index,a=n.getAttribute("position");if(null!==i)for(let e=0;e<i.count;e+=3)f(i.getX(e+0),i.getX(e+1),i.getX(e+2),a,t);else for(let e=0;e<a.count;e+=3)f(e+0,e+1,e+2,a,t)}return!1===n&&(i+="endsolid exported\n"),i;function f(e,t,r,a,f){s.fromBufferAttribute(a,e),l.fromBufferAttribute(a,t),c.fromBufferAttribute(a,r),!0===f.isSkinnedMesh&&(f.boneTransform(e,s),f.boneTransform(t,l),f.boneTransform(r,c)),s.applyMatrix4(f.matrixWorld),l.applyMatrix4(f.matrixWorld),c.applyMatrix4(f.matrixWorld),function(e,t,r){u.subVectors(r,t),h.subVectors(e,t),u.cross(h).normalize(),d.copy(u).normalize(),!0===n?(i.setFloat32(o,d.x,!0),o+=4,i.setFloat32(o,d.y,!0),o+=4,i.setFloat32(o,d.z,!0),o+=4):(i+="\tfacet normal "+d.x+" "+d.y+" "+d.z+"\n",i+="\t\touter loop\n")}(s,l,c),p(s),p(l),p(c),!0===n?(i.setUint16(o,0,!0),o+=2):(i+="\t\tendloop\n",i+="\tendfacet\n")}function p(e){!0===n?(i.setFloat32(o,e.x,!0),o+=4,i.setFloat32(o,e.y,!0),o+=4,i.setFloat32(o,e.z,!0),o+=4):i+="\t\t\tvertex "+e.x+" "+e.y+" "+e.z+"\n"}}}},3215:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){function t(e,t,n){for(let r=0,i=e.length;r<i;r++)if(e[r]!==t.getUint8(n+r,!1))return!1;return!0}const n=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer||t}return e}(e);return function(e){const n=new DataView(e);if(84+50*n.getUint32(80,!0)===n.byteLength)return!0;const r=[115,111,108,105,100];for(let e=0;e<5;e++)if(t(r,n,e))return!1;return!0}(n)?function(e){const t=new DataView(e),n=t.getUint32(80,!0);let r,i,a,o,s,l,c,u,h=!1;for(let e=0;e<70;e++)1129270351==t.getUint32(e,!1)&&82==t.getUint8(e+4)&&61==t.getUint8(e+5)&&(h=!0,o=new Float32Array(3*n*3),s=t.getUint8(e+6)/255,l=t.getUint8(e+7)/255,c=t.getUint8(e+8)/255,u=t.getUint8(e+9)/255);const d=new THREE.BufferGeometry,f=new Float32Array(3*n*3),p=new Float32Array(3*n*3);for(let e=0;e<n;e++){const n=84+50*e,u=t.getFloat32(n,!0),d=t.getFloat32(n+4,!0),m=t.getFloat32(n+8,!0);if(h){const e=t.getUint16(n+48,!0);0==(32768&e)?(r=(31&e)/31,i=(e>>5&31)/31,a=(e>>10&31)/31):(r=s,i=l,a=c)}for(let s=1;s<=3;s++){const l=n+12*s,c=3*e*3+3*(s-1);f[c]=t.getFloat32(l,!0),f[c+1]=t.getFloat32(l+4,!0),f[c+2]=t.getFloat32(l+8,!0),p[c]=u,p[c+1]=d,p[c+2]=m,h&&(o[c]=r,o[c+1]=i,o[c+2]=a)}}return d.setAttribute("position",new THREE.BufferAttribute(f,3)),d.setAttribute("normal",new THREE.BufferAttribute(p,3)),h&&(d.setAttribute("color",new THREE.BufferAttribute(o,3)),d.hasColors=!0,d.alpha=u),d}(n):function(e){const t=new THREE.BufferGeometry,n=/solid([\s\S]*?)endsolid/g,r=/facet([\s\S]*?)endfacet/g;let i=0;const a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,o=new RegExp("vertex"+a+a+a,"g"),s=new RegExp("normal"+a+a+a,"g"),l=[],c=[],u=new THREE.Vector3;let h,d=0,f=0,p=0;for(;null!==(h=n.exec(e));){f=p;const e=h[0];for(;null!==(h=r.exec(e));){let e=0,t=0;const n=h[0];for(;null!==(h=s.exec(n));)u.x=parseFloat(h[1]),u.y=parseFloat(h[2]),u.z=parseFloat(h[3]),t++;for(;null!==(h=o.exec(n));)l.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),c.push(u.x,u.y,u.z),e++,p++;1!==t&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+i),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+i),i++}const n=f,a=p-f;t.addGroup(n,a,d),d++}return t.setAttribute("position",new THREE.Float32BufferAttribute(l,3)),t.setAttribute("normal",new THREE.Float32BufferAttribute(c,3)),t}("string"!=typeof(r=e)?THREE.LoaderUtils.decodeText(new Uint8Array(r)):r);var r}}THREE.STLLoader=e}()},356:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this;function n(e,t,n,i,a,o,s,l){if(0==t||0==n)return void e.lineTo(l.x,l.y);i=i*Math.PI/180,t=Math.abs(t),n=Math.abs(n);const c=(s.x-l.x)/2,u=(s.y-l.y)/2,h=Math.cos(i)*c+Math.sin(i)*u,d=-Math.sin(i)*c+Math.cos(i)*u;let f=t*t,p=n*n;const m=h*h,g=d*d,v=m/f+g/p;if(v>1){const e=Math.sqrt(v);f=(t*=e)*t,p=(n*=e)*n}const y=f*g+p*m,_=(f*p-y)/y;let b=Math.sqrt(Math.max(0,_));a===o&&(b=-b);const E=b*t*d/n,w=-b*n*h/t,x=Math.cos(i)*E-Math.sin(i)*w+(s.x+l.x)/2,T=Math.sin(i)*E+Math.cos(i)*w+(s.y+l.y)/2,A=r(1,0,(h-E)/t,(d-w)/n),M=r((h-E)/t,(d-w)/n,(-h-E)/t,(-d-w)/n)%(2*Math.PI);e.currentPath.absellipse(x,T,t,n,A,A+M,0===o,i)}function r(e,t,n,r){const i=e*n+t*r,a=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r);let o=Math.acos(Math.max(-1,Math.min(1,i/a)));return e*r-t*n<0&&(o=-o),o}function i(e,t){t=Object.assign({},t);let n={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)n=Object.assign(n,f["."+t[e]])}function r(r,i,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(r)&&(t[i]=a(e.getAttribute(r))),n[r]&&(t[i]=a(n[r])),e.style&&""!==e.style[r]&&(t[i]=a(e.style[r]))}function i(e){return Math.max(0,Math.min(1,c(e)))}function a(e){return Math.max(0,c(e))}return e.hasAttribute("id")&&(n=Object.assign(n,f["#"+e.getAttribute("id")])),r("fill","fill"),r("fill-opacity","fillOpacity",i),r("opacity","opacity",i),r("stroke","stroke"),r("stroke-opacity","strokeOpacity",i),r("stroke-width","strokeWidth",a),r("stroke-linejoin","strokeLineJoin"),r("stroke-linecap","strokeLineCap"),r("stroke-miterlimit","strokeMiterLimit",a),r("visibility","visibility"),t}function a(e,t){return e-(t-e)}function o(e,t,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const r={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let i=0,a=!0,o="",s="";const l=[];function c(e,t,n){const r=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw r.partial=n,r}function u(){""!==o&&(""===s?l.push(Number(o)):l.push(Number(o)*Math.pow(10,Number(s)))),o="",s=""}let h;const d=e.length;for(let f=0;f<d;f++)if(h=e[f],Array.isArray(t)&&t.includes(l.length%n)&&r.FLAGS.test(h))i=1,o=h,u();else{if(0===i){if(r.WHITESPACE.test(h))continue;if(r.DIGIT.test(h)||r.SIGN.test(h)){i=1,o=h;continue}if(r.POINT.test(h)){i=2,o=h;continue}r.COMMA.test(h)&&(a&&c(h,f,l),a=!0)}if(1===i){if(r.DIGIT.test(h)){o+=h;continue}if(r.POINT.test(h)){o+=h,i=2;continue}if(r.EXP.test(h)){i=3;continue}r.SIGN.test(h)&&1===o.length&&r.SIGN.test(o[0])&&c(h,f,l)}if(2===i){if(r.DIGIT.test(h)){o+=h;continue}if(r.EXP.test(h)){i=3;continue}r.POINT.test(h)&&"."===o[o.length-1]&&c(h,f,l)}if(3===i){if(r.DIGIT.test(h)){s+=h;continue}if(r.SIGN.test(h)){if(""===s){s+=h;continue}1===s.length&&r.SIGN.test(s)&&c(h,f,l)}}r.WHITESPACE.test(h)?(u(),i=0,a=!1):r.COMMA.test(h)?(u(),i=0,a=!0):r.SIGN.test(h)?(u(),i=1,o=h):r.POINT.test(h)?(u(),i=2,o=h):c(h,f,l)}return u(),l}const s=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(e){let n,r="px";if("string"==typeof e||e instanceof String)for(let t=0,n=s.length;t<n;t++){const n=s[t];if(e.endsWith(n)){r=n,e=e.substring(0,e.length-n.length);break}}return"px"===r&&"px"!==t.defaultUnit?n=l.in[t.defaultUnit]/t.defaultDPI:(n=l[r][t.defaultUnit],n<0&&(n=l[r].in*t.defaultDPI)),n*parseFloat(e)}function u(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const d=[],f={},p=[],m=new THREE.Matrix3,g=new THREE.Matrix3,v=new THREE.Matrix3,y=new THREE.Matrix3,_=new THREE.Vector2,b=new THREE.Vector3,E=new THREE.Matrix3,w=(new DOMParser).parseFromString(e,"image/svg+xml");!function e(t,r){if(1!==t.nodeType)return;const s=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=function(e){const t=new THREE.Matrix3,n=m;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const n=c(e.getAttribute("x")),r=c(e.getAttribute("y"));t.translate(n,r)}if(e.hasAttribute("transform")){const r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){const i=r[e].trim();if(""===i)continue;const a=i.indexOf("("),s=i.length;if(a>0&&a<s){const e=i.substr(0,a),t=o(i.substr(a+1,s-a-1));switch(n.identity(),e){case"translate":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),n.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,i=0;e=-t[0]*Math.PI/180,t.length>=3&&(r=t[1],i=t[2]),g.identity().translate(-r,-i),v.identity().rotate(e),y.multiplyMatrices(v,g),g.identity().translate(r,i),n.multiplyMatrices(g,y)}break;case"scale":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),n.scale(e,r)}break;case"skewX":1===t.length&&n.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&n.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&n.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(n)}}return t}(e);p.length>0&&t.premultiply(p[p.length-1]);return E.copy(t),p.push(t),t}(t);let l=!0,w=null;switch(t.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const n=e.sheet.cssRules[t];if(1!==n.type)continue;const r=n.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<r.length;e++)f[r[e]]=Object.assign(f[r[e]]||{},n.style)}}(t);break;case"g":r=i(t,r);break;case"path":r=i(t,r),t.hasAttribute("d")&&(w=function(e){const t=new THREE.ShapePath,r=new THREE.Vector2,i=new THREE.Vector2,s=new THREE.Vector2;let l=!0,c=!1;const u=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let e=0,h=u.length;e<h;e++){const h=u[e],d=h.charAt(0),f=h.substr(1).trim();let p;switch(!0===l&&(c=!0,l=!1),d){case"M":p=o(f);for(let e=0,n=p.length;e<n;e+=2)r.x=p[e+0],r.y=p[e+1],i.x=r.x,i.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"H":p=o(f);for(let e=0,n=p.length;e<n;e++)r.x=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"V":p=o(f);for(let e=0,n=p.length;e<n;e++)r.y=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"L":p=o(f);for(let e=0,n=p.length;e<n;e+=2)r.x=p[e+0],r.y=p[e+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"C":p=o(f);for(let e=0,n=p.length;e<n;e+=6)t.bezierCurveTo(p[e+0],p[e+1],p[e+2],p[e+3],p[e+4],p[e+5]),i.x=p[e+2],i.y=p[e+3],r.x=p[e+4],r.y=p[e+5],0===e&&!0===c&&s.copy(r);break;case"S":p=o(f);for(let e=0,n=p.length;e<n;e+=4)t.bezierCurveTo(a(r.x,i.x),a(r.y,i.y),p[e+0],p[e+1],p[e+2],p[e+3]),i.x=p[e+0],i.y=p[e+1],r.x=p[e+2],r.y=p[e+3],0===e&&!0===c&&s.copy(r);break;case"Q":p=o(f);for(let e=0,n=p.length;e<n;e+=4)t.quadraticCurveTo(p[e+0],p[e+1],p[e+2],p[e+3]),i.x=p[e+0],i.y=p[e+1],r.x=p[e+2],r.y=p[e+3],0===e&&!0===c&&s.copy(r);break;case"T":p=o(f);for(let e=0,n=p.length;e<n;e+=2){const n=a(r.x,i.x),o=a(r.y,i.y);t.quadraticCurveTo(n,o,p[e+0],p[e+1]),i.x=n,i.y=o,r.x=p[e+0],r.y=p[e+1],0===e&&!0===c&&s.copy(r)}break;case"A":p=o(f,[3,4],7);for(let e=0,a=p.length;e<a;e+=7){if(p[e+5]==r.x&&p[e+6]==r.y)continue;const a=r.clone();r.x=p[e+5],r.y=p[e+6],i.x=r.x,i.y=r.y,n(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],a,r),0===e&&!0===c&&s.copy(r)}break;case"m":p=o(f);for(let e=0,n=p.length;e<n;e+=2)r.x+=p[e+0],r.y+=p[e+1],i.x=r.x,i.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"h":p=o(f);for(let e=0,n=p.length;e<n;e++)r.x+=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"v":p=o(f);for(let e=0,n=p.length;e<n;e++)r.y+=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"l":p=o(f);for(let e=0,n=p.length;e<n;e+=2)r.x+=p[e+0],r.y+=p[e+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"c":p=o(f);for(let e=0,n=p.length;e<n;e+=6)t.bezierCurveTo(r.x+p[e+0],r.y+p[e+1],r.x+p[e+2],r.y+p[e+3],r.x+p[e+4],r.y+p[e+5]),i.x=r.x+p[e+2],i.y=r.y+p[e+3],r.x+=p[e+4],r.y+=p[e+5],0===e&&!0===c&&s.copy(r);break;case"s":p=o(f);for(let e=0,n=p.length;e<n;e+=4)t.bezierCurveTo(a(r.x,i.x),a(r.y,i.y),r.x+p[e+0],r.y+p[e+1],r.x+p[e+2],r.y+p[e+3]),i.x=r.x+p[e+0],i.y=r.y+p[e+1],r.x+=p[e+2],r.y+=p[e+3],0===e&&!0===c&&s.copy(r);break;case"q":p=o(f);for(let e=0,n=p.length;e<n;e+=4)t.quadraticCurveTo(r.x+p[e+0],r.y+p[e+1],r.x+p[e+2],r.y+p[e+3]),i.x=r.x+p[e+0],i.y=r.y+p[e+1],r.x+=p[e+2],r.y+=p[e+3],0===e&&!0===c&&s.copy(r);break;case"t":p=o(f);for(let e=0,n=p.length;e<n;e+=2){const n=a(r.x,i.x),o=a(r.y,i.y);t.quadraticCurveTo(n,o,r.x+p[e+0],r.y+p[e+1]),i.x=n,i.y=o,r.x=r.x+p[e+0],r.y=r.y+p[e+1],0===e&&!0===c&&s.copy(r)}break;case"a":p=o(f,[3,4],7);for(let e=0,a=p.length;e<a;e+=7){if(0==p[e+5]&&0==p[e+6])continue;const a=r.clone();r.x+=p[e+5],r.y+=p[e+6],i.x=r.x,i.y=r.y,n(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],a,r),0===e&&!0===c&&s.copy(r)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(r.copy(s),t.currentPath.currentPoint.copy(r),l=!0);break;default:console.warn(h)}c=!1}return t}(t));break;case"rect":r=i(t,r),w=function(e){const t=c(e.getAttribute("x")||0),n=c(e.getAttribute("y")||0),r=c(e.getAttribute("rx")||0),i=c(e.getAttribute("ry")||0),a=c(e.getAttribute("width")),o=c(e.getAttribute("height")),s=new THREE.ShapePath;s.moveTo(t+2*r,n),s.lineTo(t+a-2*r,n),(0!==r||0!==i)&&s.bezierCurveTo(t+a,n,t+a,n,t+a,n+2*i);s.lineTo(t+a,n+o-2*i),(0!==r||0!==i)&&s.bezierCurveTo(t+a,n+o,t+a,n+o,t+a-2*r,n+o);s.lineTo(t+2*r,n+o),(0!==r||0!==i)&&s.bezierCurveTo(t,n+o,t,n+o,t,n+o-2*i);s.lineTo(t,n+2*i),(0!==r||0!==i)&&s.bezierCurveTo(t,n,t,n,t+2*r,n);return s}(t);break;case"polygon":r=i(t,r),w=function(e){function t(e,t,n){const a=c(t),o=c(n);0===i?r.moveTo(a,o):r.lineTo(a,o),i++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new THREE.ShapePath;let i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!0,r}(t);break;case"polyline":r=i(t,r),w=function(e){function t(e,t,n){const a=c(t),o=c(n);0===i?r.moveTo(a,o):r.lineTo(a,o),i++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new THREE.ShapePath;let i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!1,r}(t);break;case"circle":r=i(t,r),w=function(e){const t=c(e.getAttribute("cx")||0),n=c(e.getAttribute("cy")||0),r=c(e.getAttribute("r")||0),i=new THREE.Path;i.absarc(t,n,r,0,2*Math.PI);const a=new THREE.ShapePath;return a.subPaths.push(i),a}(t);break;case"ellipse":r=i(t,r),w=function(e){const t=c(e.getAttribute("cx")||0),n=c(e.getAttribute("cy")||0),r=c(e.getAttribute("rx")||0),i=c(e.getAttribute("ry")||0),a=new THREE.Path;a.absellipse(t,n,r,i,0,2*Math.PI);const o=new THREE.ShapePath;return o.subPaths.push(a),o}(t);break;case"line":r=i(t,r),w=function(e){const t=c(e.getAttribute("x1")||0),n=c(e.getAttribute("y1")||0),r=c(e.getAttribute("x2")||0),i=c(e.getAttribute("y2")||0),a=new THREE.ShapePath;return a.moveTo(t,n),a.lineTo(r,i),a.currentPath.autoClose=!1,a}(t);break;case"defs":l=!1;break;case"use":r=i(t,r);const s=t.href.baseVal.substring(1),u=t.viewportElement.getElementById(s);u?e(u,r):console.warn("SVGLoader: 'use node' references non-existent node id: "+s)}if(w&&(void 0!==r.fill&&"none"!==r.fill&&w.color.setStyle(r.fill),function(e,t){function n(e){b.set(e.x,e.y,1).applyMatrix3(t),e.set(b.x,b.y)}const r=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths;for(let e=0,a=i.length;e<a;e++){const a=i[e].curves;for(let e=0;e<a.length;e++){const i=a[e];i.isLineCurve?(n(i.v1),n(i.v2)):i.isCubicBezierCurve?(n(i.v0),n(i.v1),n(i.v2),n(i.v3)):i.isQuadraticBezierCurve?(n(i.v0),n(i.v1),n(i.v2)):i.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),_.set(i.aX,i.aY),n(_),i.aX=_.x,i.aY=_.y,i.xRadius*=u(t),i.yRadius*=h(t))}}}(w,E),d.push(w),w.userData={node:t,style:r}),l){const n=t.childNodes;for(let t=0;t<n.length;t++)e(n[t],r)}s&&(p.pop(),p.length>0?E.copy(p[p.length-1]):E.identity())}(w.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:d,xml:w.documentElement}}static createShapes(e){const t=999999999,n=0,r=1,i=2,a=3,o=4,s=5,l=6,c={loc:n,t:0};function u(e,t,r,a){const o=e.x,s=t.x,l=r.x,u=a.x,d=e.y,f=t.y,p=r.y,m=a.y,g=(u-l)*(d-p)-(m-p)*(o-l),v=(m-p)*(s-o)-(u-l)*(f-d),y=g/v,_=((s-o)*(d-p)-(f-d)*(o-l))/v;if(0===v&&0!==g||y<=0||y>=1||_<0||_>1)return null;if(0===g&&0===v){for(let l=0;l<2;l++){if(h(0===l?r:a,e,t),c.loc==n){const e=0===l?r:a;return{x:e.x,y:e.y,t:c.t}}if(c.loc==i){return{x:+(o+c.t*(s-o)).toPrecision(10),y:+(d+c.t*(f-d)).toPrecision(10),t:c.t}}}return null}for(let i=0;i<2;i++)if(h(0===i?r:a,e,t),c.loc==n){const e=0===i?r:a;return{x:e.x,y:e.y,t:c.t}}return{x:+(o+y*(s-o)).toPrecision(10),y:+(d+y*(f-d)).toPrecision(10),t:y}}function h(e,t,u){const h=u.x-t.x,d=u.y-t.y,f=e.x-t.x,p=e.y-t.y,m=h*p-f*d;if(e.x===t.x&&e.y===t.y)return c.loc=n,void(c.t=0);if(e.x===u.x&&e.y===u.y)return c.loc=r,void(c.t=1);if(m<-Number.EPSILON)return void(c.loc=a);if(m>Number.EPSILON)return void(c.loc=o);if(h*f<0||d*p<0)return void(c.loc=s);if(Math.sqrt(h*h+d*d)<Math.sqrt(f*f+p*p))return void(c.loc=l);let g;g=0!==h?f/h:p/d,c.loc=i,c.t=g}function d(e,t,n){const r=new THREE.Vector2;t.getCenter(r);const i=[];return n.forEach((t=>{if(t.boundingBox.containsPoint(r)){(function(e,t){const n=[],r=[];for(let i=1;i<e.length;i++){const a=e[i-1],o=e[i];for(let e=1;e<t.length;e++){const i=u(a,o,t[e-1],t[e]);null!==i&&void 0===n.find((e=>e.t<=i.t+Number.EPSILON&&e.t>=i.t-Number.EPSILON))&&(n.push(i),r.push(new THREE.Vector2(i.x,i.y)))}}return r})(e,t.points).forEach((e=>{i.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),i.sort(((e,t)=>e.point.x-t.point.x)),i}let f=0,p=t,m=-999999999,g=e.subPaths.map((e=>{const n=e.getPoints();let r=-999999999,i=t,a=-999999999,o=t;for(let e=0;e<n.length;e++){const t=n[e];t.y>r&&(r=t.y),t.y<i&&(i=t.y),t.x>a&&(a=t.x),t.x<o&&(o=t.x)}return m<=a&&(m=a+1),p>=o&&(p=o-1),{points:n,isCW:THREE.ShapeUtils.isClockWise(n),identifier:f++,boundingBox:new THREE.Box2(new THREE.Vector2(o,i),new THREE.Vector2(a,r))}}));g=g.filter((e=>e.points.length>0));const v=g.map((t=>function(e,t,n,r,i){null!=i&&""!==i||(i="nonzero");const a=new THREE.Vector2;e.boundingBox.getCenter(a);const o=d([new THREE.Vector2(n,a.y),new THREE.Vector2(r,a.y)],e.boundingBox,t);o.sort(((e,t)=>e.point.x-t.point.x));const s=[],l=[];o.forEach((t=>{t.identifier===e.identifier?s.push(t):l.push(t)}));const c=s[0].point.x,u=[];let h=0;for(;h<l.length&&l[h].point.x<c;)u.length>0&&u[u.length-1]===l[h].identifier?u.pop():u.push(l[h].identifier),h++;if(u.push(e.identifier),"evenodd"===i){const t=u.length%2==0,n=u[u.length-2];return{identifier:e.identifier,isHole:t,for:n}}if("nonzero"===i){let n=!0,r=null,i=null;for(let e=0;e<u.length;e++){const a=u[e];n?(i=t[a].isCW,n=!1,r=a):i!==t[a].isCW&&(i=t[a].isCW,n=!0)}return{identifier:e.identifier,isHole:n,for:r}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}(t,g,p,m,e.userData.style.fillRule))),y=[];return g.forEach((e=>{if(!v[e.identifier].isHole){const t=new THREE.Shape(e.points);v.filter((t=>t.isHole&&t.for===e.identifier)).forEach((e=>{const n=g[e.identifier];t.holes.push(new THREE.Path(n.points))})),y.push(t)}})),y}static getStrokeStyle(e,t,n,r,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:n=void 0!==n?n:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:i=void 0!==i?i:4}}static pointsToStroke(t,n,r,i){const a=[],o=[],s=[];if(0===e.pointsToStrokeWithBuffers(t,n,r,i,a,o,s))return null;const l=new THREE.BufferGeometry;return l.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),l.setAttribute("normal",new THREE.Float32BufferAttribute(o,3)),l.setAttribute("uv",new THREE.Float32BufferAttribute(s,2)),l}static pointsToStrokeWithBuffers(e,t,n,r,i,a,o,s){const l=new THREE.Vector2,c=new THREE.Vector2,u=new THREE.Vector2,h=new THREE.Vector2,d=new THREE.Vector2,f=new THREE.Vector2,p=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,_=new THREE.Vector2,b=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,T=new THREE.Vector2;n=void 0!==n?n:12,r=void 0!==r?r:.001,s=void 0!==s?s:0;const A=(e=function(e){let t=!1;for(let n=1,i=e.length-1;n<i;n++)if(e[n].distanceTo(e[n+1])<r){t=!0;break}if(!t)return e;const n=[];n.push(e[0]);for(let t=1,i=e.length-1;t<i;t++)e[t].distanceTo(e[t+1])>=r&&n.push(e[t]);return n.push(e[e.length-1]),n}(e)).length;if(A<2)return 0;const M=e[0].equals(e[A-1]);let S,R,k=e[0];const P=t.strokeWidth/2,L=1/(A-1);let C,I,N,F,O=0,H=!1,D=0,U=3*s,B=2*s;z(e[0],e[1],l).multiplyScalar(P),m.copy(e[0]).sub(l),g.copy(e[0]).add(l),v.copy(m),y.copy(g);for(let n=1;n<A;n++){S=e[n],R=n===A-1?M?e[1]:void 0:e[n+1];const r=l;if(z(k,S,r),u.copy(r).multiplyScalar(P),_.copy(S).sub(u),b.copy(S).add(u),C=O+L,I=!1,void 0!==R){z(S,R,c),u.copy(c).multiplyScalar(P),E.copy(S).sub(u),w.copy(S).add(u),N=!0,u.subVectors(R,k),r.dot(u)<0&&(N=!1),1===n&&(H=N),u.subVectors(R,S),u.normalize();const e=Math.abs(r.dot(u));if(0!==e){const n=P/e;u.multiplyScalar(-n),h.subVectors(S,k),d.copy(h).setLength(n).add(u),x.copy(d).negate();const r=d.length(),i=h.length();h.divideScalar(i),f.subVectors(R,S);const a=f.length();switch(f.divideScalar(a),h.dot(x)<i&&f.dot(x)<a&&(I=!0),T.copy(d).add(S),x.add(S),F=!1,I?N?(w.copy(x),b.copy(x)):(E.copy(x),_.copy(x)):G(),t.strokeLineJoin){case"bevel":W(N,I,C);break;case"round":q(N,I),N?j(S,_,E,C,0):j(S,w,b,C,1);break;case"miter":case"miter-clip":default:const e=P*t.strokeMiterLimit/r;if(e<1){if("miter-clip"!==t.strokeLineJoin){W(N,I,C);break}q(N,I),N?(f.subVectors(T,_).multiplyScalar(e).add(_),p.subVectors(T,E).multiplyScalar(e).add(E),V(_,C,0),V(f,C,0),V(S,C,.5),V(S,C,.5),V(f,C,0),V(p,C,0),V(S,C,.5),V(p,C,0),V(E,C,0)):(f.subVectors(T,b).multiplyScalar(e).add(b),p.subVectors(T,w).multiplyScalar(e).add(w),V(b,C,1),V(f,C,1),V(S,C,.5),V(S,C,.5),V(f,C,1),V(p,C,1),V(S,C,.5),V(p,C,1),V(w,C,1))}else I?(N?(V(g,O,1),V(m,O,0),V(T,C,0),V(g,O,1),V(T,C,0),V(x,C,1)):(V(g,O,1),V(m,O,0),V(T,C,1),V(m,O,0),V(x,C,0),V(T,C,1)),N?E.copy(T):w.copy(T)):N?(V(_,C,0),V(T,C,0),V(S,C,.5),V(S,C,.5),V(T,C,0),V(E,C,0)):(V(b,C,1),V(T,C,1),V(S,C,.5),V(S,C,.5),V(T,C,1),V(w,C,1)),F=!0}}else G()}else G();M||n!==A-1||X(e[0],v,y,N,!0,O),O=C,k=S,m.copy(E),g.copy(w)}if(M){if(I&&i){let e=T,t=x;H!==N&&(e=x,t=T),N?(F||H)&&(t.toArray(i,0),t.toArray(i,9),F&&e.toArray(i,3)):!F&&H||(t.toArray(i,3),t.toArray(i,9),F&&e.toArray(i,0))}}else X(S,_,b,N,!1,C);return D;function z(e,t,n){return n.subVectors(t,e),n.set(-n.y,n.x).normalize()}function V(e,t,n){i&&(i[U]=e.x,i[U+1]=e.y,i[U+2]=0,a&&(a[U]=0,a[U+1]=0,a[U+2]=1),U+=3,o&&(o[B]=t,o[B+1]=n,B+=2)),D+=3}function j(e,t,r,i,a){l.copy(t).sub(e).normalize(),c.copy(r).sub(e).normalize();let o=Math.PI;const s=l.dot(c);Math.abs(s)<1&&(o=Math.abs(Math.acos(s))),o/=n,u.copy(t);for(let t=0,r=n-1;t<r;t++)h.copy(u).rotateAround(e,o),V(u,i,a),V(h,i,a),V(e,i,.5),u.copy(h);V(h,i,a),V(r,i,a),V(e,i,.5)}function G(){V(g,O,1),V(m,O,0),V(_,C,0),V(g,O,1),V(_,C,1),V(b,C,0)}function W(e,t,n){t?e?(V(g,O,1),V(m,O,0),V(_,C,0),V(g,O,1),V(_,C,0),V(x,C,1),V(_,n,0),V(E,n,0),V(x,n,.5)):(V(g,O,1),V(m,O,0),V(b,C,1),V(m,O,0),V(x,C,0),V(b,C,1),V(b,n,1),V(w,n,0),V(x,n,.5)):e?(V(_,n,0),V(E,n,0),V(S,n,.5)):(V(b,n,1),V(w,n,0),V(S,n,.5))}function q(e,t){t&&(e?(V(g,O,1),V(m,O,0),V(_,C,0),V(g,O,1),V(_,C,0),V(x,C,1),V(_,O,0),V(S,C,.5),V(x,C,1),V(S,C,.5),V(E,O,0),V(x,C,1)):(V(g,O,1),V(m,O,0),V(b,C,1),V(m,O,0),V(x,C,0),V(b,C,1),V(b,O,1),V(x,C,0),V(S,C,.5),V(S,C,.5),V(x,C,0),V(w,O,1)))}function X(e,n,r,a,o,s){switch(t.strokeLineCap){case"round":o?j(e,r,n,s,.5):j(e,n,r,s,.5);break;case"square":if(o)l.subVectors(n,e),c.set(l.y,-l.x),u.addVectors(l,c).add(e),h.subVectors(c,l).add(e),a?(u.toArray(i,3),h.toArray(i,0),h.toArray(i,9)):(u.toArray(i,3),u.toArray(i,9),h.toArray(i,0));else{l.subVectors(r,e),c.set(l.y,-l.x),u.addVectors(l,c).add(e),h.subVectors(c,l).add(e);const t=i.length;a?(u.toArray(i,t-3),h.toArray(i,t-6),h.toArray(i,t-12)):(u.toArray(i,t-6),h.toArray(i,t-3),h.toArray(i,t-12))}}}}}THREE.SVGLoader=e}()},8233:()=>{!function(){const e={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float amount;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\t\t\tvec3 c = color.rgb;\n\n\t\t\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n\t\t\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n\t\t\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n\n\t\t\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n\n\t\t}"};THREE.SepiaShader=e}()},8695:()=>{!function(){class e extends THREE.Pass{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.FullScreenQuad(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}THREE.ShaderPass=e}()},6868:()=>{THREE.SimplexNoise=class{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(let e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,n){return e[0]*t+e[1]*n}dot3(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r}dot4(e,t,n,r,i){return e[0]*t+e[1]*n+e[2]*r+e[3]*i}noise(e,t){let n,r,i;const a=(e+t)*(.5*(Math.sqrt(3)-1)),o=Math.floor(e+a),s=Math.floor(t+a),l=(3-Math.sqrt(3))/6,c=(o+s)*l,u=e-(o-c),h=t-(s-c);let d,f;u>h?(d=1,f=0):(d=0,f=1);const p=u-d+l,m=h-f+l,g=u-1+2*l,v=h-1+2*l,y=255&o,_=255&s,b=this.perm[y+this.perm[_]]%12,E=this.perm[y+d+this.perm[_+f]]%12,w=this.perm[y+1+this.perm[_+1]]%12;let x=.5-u*u-h*h;x<0?n=0:(x*=x,n=x*x*this.dot(this.grad3[b],u,h));let T=.5-p*p-m*m;T<0?r=0:(T*=T,r=T*T*this.dot(this.grad3[E],p,m));let A=.5-g*g-v*v;return A<0?i=0:(A*=A,i=A*A*this.dot(this.grad3[w],g,v)),70*(n+r+i)}noise3d(e,t,n){let r,i,a,o;const s=(e+t+n)*(1/3),l=Math.floor(e+s),c=Math.floor(t+s),u=Math.floor(n+s),h=1/6,d=(l+c+u)*h,f=e-(l-d),p=t-(c-d),m=n-(u-d);let g,v,y,_,b,E;f>=p?p>=m?(g=1,v=0,y=0,_=1,b=1,E=0):f>=m?(g=1,v=0,y=0,_=1,b=0,E=1):(g=0,v=0,y=1,_=1,b=0,E=1):p<m?(g=0,v=0,y=1,_=0,b=1,E=1):f<m?(g=0,v=1,y=0,_=0,b=1,E=1):(g=0,v=1,y=0,_=1,b=1,E=0);const w=f-g+h,x=p-v+h,T=m-y+h,A=f-_+2*h,M=p-b+2*h,S=m-E+2*h,R=f-1+.5,k=p-1+.5,P=m-1+.5,L=255&l,C=255&c,I=255&u,N=this.perm[L+this.perm[C+this.perm[I]]]%12,F=this.perm[L+g+this.perm[C+v+this.perm[I+y]]]%12,O=this.perm[L+_+this.perm[C+b+this.perm[I+E]]]%12,H=this.perm[L+1+this.perm[C+1+this.perm[I+1]]]%12;let D=.6-f*f-p*p-m*m;D<0?r=0:(D*=D,r=D*D*this.dot3(this.grad3[N],f,p,m));let U=.6-w*w-x*x-T*T;U<0?i=0:(U*=U,i=U*U*this.dot3(this.grad3[F],w,x,T));let B=.6-A*A-M*M-S*S;B<0?a=0:(B*=B,a=B*B*this.dot3(this.grad3[O],A,M,S));let z=.6-R*R-k*k-P*P;return z<0?o=0:(z*=z,o=z*z*this.dot3(this.grad3[H],R,k,P)),32*(r+i+a+o)}noise4d(e,t,n,r){const i=this.grad4,a=this.simplex,o=this.perm,s=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,u,h,d,f;const p=(e+t+n+r)*s,m=Math.floor(e+p),g=Math.floor(t+p),v=Math.floor(n+p),y=Math.floor(r+p),_=(m+g+v+y)*l,b=e-(m-_),E=t-(g-_),w=n-(v-_),x=r-(y-_),T=(b>E?32:0)+(b>w?16:0)+(E>w?8:0)+(b>x?4:0)+(E>x?2:0)+(w>x?1:0),A=a[T][0]>=3?1:0,M=a[T][1]>=3?1:0,S=a[T][2]>=3?1:0,R=a[T][3]>=3?1:0,k=a[T][0]>=2?1:0,P=a[T][1]>=2?1:0,L=a[T][2]>=2?1:0,C=a[T][3]>=2?1:0,I=a[T][0]>=1?1:0,N=a[T][1]>=1?1:0,F=a[T][2]>=1?1:0,O=a[T][3]>=1?1:0,H=b-A+l,D=E-M+l,U=w-S+l,B=x-R+l,z=b-k+2*l,V=E-P+2*l,j=w-L+2*l,G=x-C+2*l,W=b-I+3*l,q=E-N+3*l,X=w-F+3*l,Y=x-O+3*l,K=b-1+4*l,Z=E-1+4*l,Q=w-1+4*l,J=x-1+4*l,$=255&m,ee=255&g,te=255&v,ne=255&y,re=o[$+o[ee+o[te+o[ne]]]]%32,ie=o[$+A+o[ee+M+o[te+S+o[ne+R]]]]%32,ae=o[$+k+o[ee+P+o[te+L+o[ne+C]]]]%32,oe=o[$+I+o[ee+N+o[te+F+o[ne+O]]]]%32,se=o[$+1+o[ee+1+o[te+1+o[ne+1]]]]%32;let le=.6-b*b-E*E-w*w-x*x;le<0?c=0:(le*=le,c=le*le*this.dot4(i[re],b,E,w,x));let ce=.6-H*H-D*D-U*U-B*B;ce<0?u=0:(ce*=ce,u=ce*ce*this.dot4(i[ie],H,D,U,B));let ue=.6-z*z-V*V-j*j-G*G;ue<0?h=0:(ue*=ue,h=ue*ue*this.dot4(i[ae],z,V,j,G));let he=.6-W*W-q*q-X*X-Y*Y;he<0?d=0:(he*=he,d=he*he*this.dot4(i[oe],W,q,X,Y));let de=.6-K*K-Z*Z-Q*Q-J*J;return de<0?f=0:(de*=de,f=de*de*this.dot4(i[se],K,Z,Q,J)),27*(c+u+h+d+f)}}},1701:()=>{!function(){const e=new THREE.Vector3,t=new THREE.Vector3;function n(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function r(e,t){const n=t.position.distanceTo(e.position);let r=0;const i=[];for(let n=0,r=e.faces.length;n<r;n++){const r=e.faces[n];r.hasVertex(t)&&i.push(r)}for(let t=0,n=e.faces.length;t<n;t++){let n=1;const a=e.faces[t];for(let e=0;e<i.length;e++){const t=i[e],r=a.normal.dot(t.normal);n=Math.min(n,(1.001-r)/2)}r=Math.max(r,n)}i.length<2&&(r=1);return n*r+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(let t=0;t<e.neighbors.length;t++){const n=r(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=n,e.minCost=n,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=n,n<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=n)}e.collapseCost=e.totalCost/e.costCount}function a(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){n(e.neighbors.pop().neighbors,e)}n(t,e)}function o(e,t){n(t,e),e.v1&&n(e.v1.faces,e),e.v2&&n(e.v2.faces,e),e.v3&&n(e.v3.faces,e);const r=[e.v1,e.v2,e.v3];for(let e=0;e<3;e++){const t=r[e],n=r[(e+1)%3];t&&n&&(t.removeIfNonNeighbor(n),n.removeIfNonNeighbor(t))}}function s(e,t,n,r){if(!r)return void a(n,e);const s=[];for(let e=0;e<n.neighbors.length;e++)s.push(n.neighbors[e]);for(let e=n.faces.length-1;e>=0;e--)n.faces[e].hasVertex(r)&&o(n.faces[e],t);for(let e=n.faces.length-1;e>=0;e--)n.faces[e].replaceVertex(n,r);a(n,e);for(let e=0;e<s.length;e++)i(s[e])}function l(e){let t=e[0];for(let n=0;n<e.length;n++)e[n].collapseCost<t.collapseCost&&(t=e[n]);return t}class c{constructor(e,t,n,r,i,a){this.a=r,this.b=i,this.c=a,this.v1=e,this.v2=t,this.v3=n,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(n),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(n),n.faces.push(this),n.addUniqueNeighbor(e),n.addUniqueNeighbor(t)}computeNormal(){const n=this.v1.position,r=this.v2.position,i=this.v3.position;e.subVectors(i,r),t.subVectors(n,r),e.cross(t).normalize(),this.normal.copy(e)}hasVertex(e){return e===this.v1||e===this.v2||e===this.v3}replaceVertex(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),n(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()}}class u{constructor(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}addUniqueNeighbor(e){var t,n;t=this.neighbors,n=e,-1===t.indexOf(n)&&t.push(n)}removeIfNonNeighbor(e){const t=this.neighbors,n=this.faces,r=t.indexOf(e);if(-1!==r){for(let t=0;t<n.length;t++)if(n[t].hasVertex(e))return;t.splice(r,1)}}}THREE.SimplifyModifier=class{constructor(){if(void 0===THREE.BufferGeometryUtils)throw"THREE.SimplifyModifier relies on THREE.BufferGeometryUtils"}modify(e,t){if(!0===e.isGeometry)return void console.error("THREE.SimplifyModifier no longer supports Geometry. Use THREE.BufferGeometry instead.");const n=(e=e.clone()).attributes;for(const t in n)"position"!==t&&e.deleteAttribute(t);const r=[],a=[],o=(e=THREE.BufferGeometryUtils.mergeVertices(e)).getAttribute("position");for(let e=0;e<o.count;e++){const t=(new THREE.Vector3).fromBufferAttribute(o,e),n=new u(t,e);r.push(n)}let h,d=e.getIndex();if(null!==d)for(let e=0;e<d.count;e+=3){const t=d.getX(e),n=d.getX(e+1),i=d.getX(e+2),o=new c(r[t],r[n],r[i],t,n,i);a.push(o)}else for(let e=0;e<o.count;e+=3){const t=e,n=e+1,i=e+2,o=new c(r[t],r[n],r[i],t,n,i);a.push(o)}for(let e=0,t=r.length;e<t;e++)i(r[e]);let f=t;for(;f--;){if(h=l(r),!h){console.log("THREE.SimplifyModifier: No next vertex");break}s(r,a,h,h.collapseNeighbor)}const p=new THREE.BufferGeometry,m=[];d=[];for(let e=0;e<r.length;e++){const t=r[e].position;m.push(t.x,t.y,t.z)}for(let e=0;e<a.length;e++){const t=a[e],n=r.indexOf(t.v1),i=r.indexOf(t.v2),o=r.indexOf(t.v3);d.push(n,i,o)}return p.setAttribute("position",new THREE.Float32BufferAttribute(m,3)),p.setIndex(d),p}}}()},9413:()=>{THREE.StereoEffect=class{constructor(e){const t=new THREE.StereoCamera;t.aspect=.5;const n=new THREE.Vector2;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,n){e.setSize(t,n)},this.render=function(r,i){r.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),t.update(i),e.getSize(n),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,n.width/2,n.height),e.setViewport(0,0,n.width/2,n.height),e.render(r,t.cameraL),e.setScissor(n.width/2,0,n.width/2,n.height),e.setViewport(n.width/2,0,n.width/2,n.height),e.render(r,t.cameraR),e.setScissorTest(!1)}}}},3531:()=>{!function(){class e extends THREE.Loader{constructor(e){super(e),this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]}load(e,t,n,r){const i=this,a=""===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e,t){this.group=new THREE.Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(let e=0;e<this.meshes.length;e++)this.group.add(this.meshes[e]);return this.group}readFile(e,a){const o=new DataView(e),s=this.readChunk(o);if(s.id===n||s.id===r||s.id===t){let e=this.nextChunk(o,s);for(;0!==e;){if(e===i){const e=this.readDWord(o);this.debugMessage("3DS file version: "+e)}else e===h?(this.resetPosition(o),this.readMeshData(o,a)):this.debugMessage("Unknown main chunk: "+e.toString(16));e=this.nextChunk(o,s)}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,t){const n=this.readChunk(e);let r=this.nextChunk(e,n);for(;0!==r;){if(r===d){const t=+this.readDWord(e);this.debugMessage("Mesh Version: "+t)}else if(r===f){const t=this.readFloat(e);this.debugMessage("Master scale: "+t),this.group.scale.set(t,t,t)}else r===N?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):r===p?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+r.toString(16));r=this.nextChunk(e,n)}}readNamedObject(e){const t=this.readChunk(e),n=this.readString(e,64);t.cur=this.position;let r=this.nextChunk(e,t);for(;0!==r;){if(r===F){this.resetPosition(e);const t=this.readMesh(e);t.name=n,this.meshes.push(t)}else this.debugMessage("Unknown named object chunk: "+r.toString(16));r=this.nextChunk(e,t)}this.endChunk(t)}readMaterialEntry(e,t){const n=this.readChunk(e);let r=this.nextChunk(e,n);const i=new THREE.MeshPhongMaterial;for(;0!==r;){if(r===m)i.name=this.readString(e,64),this.debugMessage("   Name: "+i.name);else if(r===x)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(r===T){const t=this.readByte(e);i.wireframeLinewidth=t,this.debugMessage("   Wireframe Thickness: "+t)}else if(r===E)i.side=THREE.DoubleSide,this.debugMessage("   DoubleSided");else if(r===w)this.debugMessage("   Additive Blending"),i.blending=THREE.AdditiveBlending;else if(r===v)this.debugMessage("   Diffuse THREE.Color"),i.color=this.readColor(e);else if(r===y)this.debugMessage("   Specular THREE.Color"),i.specular=this.readColor(e);else if(r===g)this.debugMessage("   Ambient color"),i.color=this.readColor(e);else if(r===_){const t=this.readPercentage(e);i.shininess=100*t,this.debugMessage("   Shininess : "+t)}else if(r===b){const t=this.readPercentage(e);i.opacity=1-t,this.debugMessage("  Transparency : "+t),i.transparent=i.opacity<1}else r===A?(this.debugMessage("   ColorMap"),this.resetPosition(e),i.map=this.readMap(e,t)):r===S?(this.debugMessage("   BumpMap"),this.resetPosition(e),i.bumpMap=this.readMap(e,t)):r===M?(this.debugMessage("   OpacityMap"),this.resetPosition(e),i.alphaMap=this.readMap(e,t)):r===R?(this.debugMessage("   SpecularMap"),this.resetPosition(e),i.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+r.toString(16));r=this.nextChunk(e,n)}this.endChunk(n),this.materials[i.name]=i}readMesh(e){const t=this.readChunk(e);let n=this.nextChunk(e,t);const r=new THREE.BufferGeometry,i=new THREE.MeshPhongMaterial,a=new THREE.Mesh(r,i);for(a.name="mesh";0!==n;){if(n===O){const t=this.readWord(e);this.debugMessage("   Vertex: "+t);const n=[];for(let r=0;r<t;r++)n.push(this.readFloat(e)),n.push(this.readFloat(e)),n.push(this.readFloat(e));r.setAttribute("position",new THREE.Float32BufferAttribute(n,3))}else if(n===H)this.resetPosition(e),this.readFaceArray(e,a);else if(n===U){const t=this.readWord(e);this.debugMessage("   UV: "+t);const n=[];for(let r=0;r<t;r++)n.push(this.readFloat(e)),n.push(this.readFloat(e));r.setAttribute("uv",new THREE.Float32BufferAttribute(n,2))}else if(n===B){this.debugMessage("   Tranformation Matrix (TODO)");const t=[];for(let n=0;n<12;n++)t[n]=this.readFloat(e);const n=new THREE.Matrix4;n.elements[0]=t[0],n.elements[1]=t[6],n.elements[2]=t[3],n.elements[3]=t[9],n.elements[4]=t[2],n.elements[5]=t[8],n.elements[6]=t[5],n.elements[7]=t[11],n.elements[8]=t[1],n.elements[9]=t[7],n.elements[10]=t[4],n.elements[11]=t[10],n.elements[12]=0,n.elements[13]=0,n.elements[14]=0,n.elements[15]=1,n.transpose();const i=new THREE.Matrix4;i.copy(n).invert(),r.applyMatrix4(i),n.decompose(a.position,a.quaternion,a.scale)}else this.debugMessage("   Unknown mesh chunk: "+n.toString(16));n=this.nextChunk(e,t)}return this.endChunk(t),r.computeVertexNormals(),a}readFaceArray(e,t){const n=this.readChunk(e),r=this.readWord(e);this.debugMessage("   Faces: "+r);const i=[];for(let t=0;t<r;++t)i.push(this.readWord(e),this.readWord(e),this.readWord(e)),this.readWord(e);t.geometry.setIndex(i);let a=0,o=0;for(;this.position<n.end;){const n=this.readChunk(e);if(n.id===D){this.debugMessage("      Material THREE.Group"),this.resetPosition(e);const n=this.readMaterialGroup(e),r=3*n.index.length;t.geometry.addGroup(o,r,a),o+=r,a++;const i=this.materials[n.name];!1===Array.isArray(t.material)&&(t.material=[]),void 0!==i&&t.material.push(i)}else this.debugMessage("      Unknown face array chunk: "+n.toString(16));this.endChunk(n)}1===t.material.length&&(t.material=t.material[0]),this.endChunk(n)}readMap(e,t){const n=this.readChunk(e);let r=this.nextChunk(e,n),i={};const a=new THREE.TextureLoader(this.manager);for(a.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);0!==r;){if(r===k){const n=this.readString(e,128);i=a.load(n),this.debugMessage("      File: "+t+n)}else r===C?(i.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+i.offset.x)):r===I?(i.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+i.offset.y)):r===P?(i.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+i.repeat.x)):r===L?(i.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+r.toString(16));r=this.nextChunk(e,n)}return this.endChunk(n),i}readMaterialGroup(e){this.readChunk(e);const t=this.readString(e,64),n=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+n);const r=[];for(let t=0;t<n;++t)r.push(this.readWord(e));return{name:t,index:r}}readColor(e){const t=this.readChunk(e),n=new THREE.Color;if(t.id===o||t.id===s){const t=this.readByte(e),r=this.readByte(e),i=this.readByte(e);n.setRGB(t/255,r/255,i/255),this.debugMessage("      THREE.Color: "+n.r+", "+n.g+", "+n.b)}else if(t.id===a||t.id===l){const t=this.readFloat(e),r=this.readFloat(e),i=this.readFloat(e);n.setRGB(t,r,i),this.debugMessage("      THREE.Color: "+n.r+", "+n.g+", "+n.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),n}readChunk(e){const t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t}endChunk(e){this.position=e.end}nextChunk(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{const n=this.readChunk(e);return t.cur+=n.size,n.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}}resetPosition(){this.position-=6}readByte(e){const t=e.getUint8(this.position,!0);return this.position+=1,t}readFloat(e){try{const t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}}readInt(e){const t=e.getInt32(this.position,!0);return this.position+=4,t}readShort(e){const t=e.getInt16(this.position,!0);return this.position+=2,t}readDWord(e){const t=e.getUint32(this.position,!0);return this.position+=4,t}readWord(e){const t=e.getUint16(this.position,!0);return this.position+=2,t}readString(e,t){let n="";for(let r=0;r<t;r++){const t=this.readByte(e);if(!t)break;n+=String.fromCharCode(t)}return n}readPercentage(e){const t=this.readChunk(e);let n;switch(t.id){case c:n=this.readShort(e)/100;break;case u:n=this.readFloat(e);break;default:this.debugMessage("      Unknown percentage chunk: "+t.toString(16))}return this.endChunk(t),n}debugMessage(e){this.debug&&console.log(e)}}const t=19789,n=15786,r=49725,i=2,a=16,o=17,s=18,l=19,c=48,u=49,h=15677,d=15678,f=256,p=45055,m=40960,g=40976,v=40992,y=41008,_=41024,b=41040,E=41089,w=41091,x=41093,T=41095,A=41472,M=41488,S=41520,R=41476,k=41728,P=41812,L=41814,C=41816,I=41818,N=16384,F=16640,O=16656,H=16672,D=16688,U=16704,B=16736;THREE.TDSLoader=e}()},6889:()=>{!function(){class e extends THREE.DataTextureLoader{constructor(e){super(e)}parse(e){const t=0,n=1,r=2,i=3,a=9,o=10,s=11,l=48,c=4,u=0,h=1,d=2,f=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let p=0;const m=new Uint8Array(e),g={id_length:m[p++],colormap_type:m[p++],image_type:m[p++],colormap_index:m[p++]|m[p++]<<8,colormap_length:m[p++]|m[p++]<<8,colormap_size:m[p++],origin:[m[p++]|m[p++]<<8,m[p++]|m[p++]<<8],width:m[p++]|m[p++]<<8,height:m[p++]|m[p++]<<8,pixel_size:m[p++],flags:m[p++]};!function(e){switch(e.image_type){case n:case a:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case r:case i:case o:case s:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(g),g.id_length+p>e.length&&console.error("THREE.TGALoader: No data."),p+=g.id_length;let v=!1,y=!1,_=!1;switch(g.image_type){case a:v=!0,y=!0;break;case n:y=!0;break;case o:v=!0;break;case r:break;case s:v=!0,_=!0;break;case i:_=!0}const b=new Uint8Array(g.width*g.height*4),E=function(e,t,n,r,i){let a,o;const s=n.pixel_size>>3,l=n.width*n.height*s;if(t&&(o=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),e){let e,t,n;a=new Uint8Array(l);let o=0;const c=new Uint8Array(s);for(;o<l;)if(e=i[r++],t=1+(127&e),128&e){for(n=0;n<s;++n)c[n]=i[r++];for(n=0;n<t;++n)a.set(c,o+n*s);o+=s*t}else{for(t*=s,n=0;n<t;++n)a[o+n]=i[r++];o+=t}}else a=i.subarray(r,r+=t?n.width*n.height:l);return{pixel_data:a,palettes:o}}(v,y,g,p,m);return function(e,t,n,r,i){let a,o,s,p,m,v;switch((g.flags&l)>>c){default:case d:a=0,s=1,m=t,o=0,p=1,v=n;break;case u:a=0,s=1,m=t,o=n-1,p=-1,v=-1;break;case f:a=t-1,s=-1,m=-1,o=0,p=1,v=n;break;case h:a=t-1,s=-1,m=-1,o=n-1,p=-1,v=-1}if(_)switch(g.pixel_size){case 8:!function(e,t,n,r,i,a,o,s){let l,c,u,h=0;const d=g.width;for(u=t;u!==r;u+=n)for(c=i;c!==o;c+=a,h++)l=s[h],e[4*(c+d*u)+0]=l,e[4*(c+d*u)+1]=l,e[4*(c+d*u)+2]=l,e[4*(c+d*u)+3]=255}(e,o,p,v,a,s,m,r);break;case 16:!function(e,t,n,r,i,a,o,s){let l,c,u=0;const h=g.width;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=a,u+=2)e[4*(l+h*c)+0]=s[u+0],e[4*(l+h*c)+1]=s[u+0],e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+3]=s[u+1]}(e,o,p,v,a,s,m,r);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(g.pixel_size){case 8:!function(e,t,n,r,i,a,o,s,l){const c=l;let u,h,d,f=0;const p=g.width;for(d=t;d!==r;d+=n)for(h=i;h!==o;h+=a,f++)u=s[f],e[4*(h+p*d)+3]=255,e[4*(h+p*d)+2]=c[3*u+0],e[4*(h+p*d)+1]=c[3*u+1],e[4*(h+p*d)+0]=c[3*u+2]}(e,o,p,v,a,s,m,r,i);break;case 16:!function(e,t,n,r,i,a,o,s){let l,c,u,h=0;const d=g.width;for(u=t;u!==r;u+=n)for(c=i;c!==o;c+=a,h+=2)l=s[h+0]+(s[h+1]<<8),e[4*(c+d*u)+0]=(31744&l)>>7,e[4*(c+d*u)+1]=(992&l)>>2,e[4*(c+d*u)+2]=(31&l)>>3,e[4*(c+d*u)+3]=32768&l?0:255}(e,o,p,v,a,s,m,r);break;case 24:!function(e,t,n,r,i,a,o,s){let l,c,u=0;const h=g.width;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=a,u+=3)e[4*(l+h*c)+3]=255,e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+1]=s[u+1],e[4*(l+h*c)+0]=s[u+2]}(e,o,p,v,a,s,m,r);break;case 32:!function(e,t,n,r,i,a,o,s){let l,c,u=0;const h=g.width;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=a,u+=4)e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+1]=s[u+1],e[4*(l+h*c)+0]=s[u+2],e[4*(l+h*c)+3]=s[u+3]}(e,o,p,v,a,s,m,r);break;default:console.error("THREE.TGALoader: Format not supported.")}}(b,g.width,g.height,E.pixel_data,E.palettes),{data:b,width:g.width,height:g.height,flipY:!0,generateMipmaps:!0,minFilter:THREE.LinearMipmapLinearFilter}}}THREE.TGALoader=e}()},7879:()=>{THREE.TessellateModifier=class{constructor(e=.1,t=6){this.maxEdgeLength=e,this.maxIterations=t}modify(e){if(!0===e.isGeometry)return console.error("THREE.TessellateModifier no longer supports Geometry. Use THREE.BufferGeometry instead."),e;null!==e.index&&(e=e.toNonIndexed());const t=this.maxIterations,n=this.maxEdgeLength*this.maxEdgeLength,r=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=[r,i,a,o],l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,h=new THREE.Vector3,d=[l,c,u,h],f=new THREE.Color,p=new THREE.Color,m=new THREE.Color,g=new THREE.Color,v=[f,p,m,g],y=new THREE.Vector2,_=new THREE.Vector2,b=new THREE.Vector2,E=new THREE.Vector2,w=[y,_,b,E],x=new THREE.Vector2,T=new THREE.Vector2,A=new THREE.Vector2,M=new THREE.Vector2,S=[x,T,A,M],R=e.attributes,k=void 0!==R.normal,P=void 0!==R.color,L=void 0!==R.uv,C=void 0!==R.uv2;let I=R.position.array,N=k?R.normal.array:null,F=P?R.color.array:null,O=L?R.uv.array:null,H=C?R.uv2.array:null,D=I,U=N,B=F,z=O,V=H,j=0,G=!0;function W(e,t,n){const r=s[e],i=s[t],a=s[n];if(D.push(r.x,r.y,r.z),D.push(i.x,i.y,i.z),D.push(a.x,a.y,a.z),k){const r=d[e],i=d[t],a=d[n];U.push(r.x,r.y,r.z),U.push(i.x,i.y,i.z),U.push(a.x,a.y,a.z)}if(P){const r=v[e],i=v[t],a=v[n];B.push(r.x,r.y,r.z),B.push(i.x,i.y,i.z),B.push(a.x,a.y,a.z)}if(L){const r=w[e],i=w[t],a=w[n];z.push(r.x,r.y),z.push(i.x,i.y),z.push(a.x,a.y)}if(C){const r=S[e],i=S[t],a=S[n];V.push(r.x,r.y),V.push(i.x,i.y),V.push(a.x,a.y)}}for(;G&&j<t;){j++,G=!1,I=D,D=[],k&&(N=U,U=[]),P&&(F=B,B=[]),L&&(O=z,z=[]),C&&(H=V,V=[]);for(let e=0,t=0,s=I.length;e<s;e+=9,t+=6){r.fromArray(I,e+0),i.fromArray(I,e+3),a.fromArray(I,e+6),k&&(l.fromArray(N,e+0),c.fromArray(N,e+3),u.fromArray(N,e+6)),P&&(f.fromArray(F,e+0),p.fromArray(F,e+3),m.fromArray(F,e+6)),L&&(y.fromArray(O,t+0),_.fromArray(O,t+2),b.fromArray(O,t+4)),C&&(x.fromArray(H,t+0),T.fromArray(H,t+2),A.fromArray(H,t+4));const s=r.distanceToSquared(i),d=i.distanceToSquared(a),v=r.distanceToSquared(a);s>n||d>n||v>n?(G=!0,s>=d&&s>=v?(o.lerpVectors(r,i,.5),k&&h.lerpVectors(l,c,.5),P&&g.lerpColors(f,p,.5),L&&E.lerpVectors(y,_,.5),C&&M.lerpVectors(x,T,.5),W(0,3,2),W(3,1,2)):d>=s&&d>=v?(o.lerpVectors(i,a,.5),k&&h.lerpVectors(c,u,.5),P&&g.lerpColors(p,m,.5),L&&E.lerpVectors(_,b,.5),C&&M.lerpVectors(T,A,.5),W(0,1,3),W(3,2,0)):(o.lerpVectors(r,a,.5),k&&h.lerpVectors(l,u,.5),P&&g.lerpColors(f,m,.5),L&&E.lerpVectors(y,b,.5),C&&M.lerpVectors(x,A,.5),W(0,1,3),W(3,1,2))):W(0,1,2)}}const q=new THREE.BufferGeometry;return q.setAttribute("position",new THREE.Float32BufferAttribute(D,3)),k&&q.setAttribute("normal",new THREE.Float32BufferAttribute(U,3)),P&&q.setAttribute("color",new THREE.Float32BufferAttribute(B,3)),L&&q.setAttribute("uv",new THREE.Float32BufferAttribute(z,2)),C&&q.setAttribute("uv2",new THREE.Float32BufferAttribute(V,2)),q}}},9443:()=>{"use strict";window.ThreeBSP=function(){var e,t=1e-5;return(e=function(e){this.matrix=new THREE.Matrix4,this.create(e)}).prototype.subtract=function(t){var n=this.tree.clone(),r=t.tree.clone();return n.invert(),n.clipTo(r),r.clipTo(n),r.invert(),r.clipTo(n),r.invert(),n.build(r.allPolygons()),n.invert(),(n=new e(n)).matrix=this.matrix,n},e.prototype.union=function(t){var n=this.tree.clone(),r=t.tree.clone();return n.clipTo(r),r.clipTo(n),r.invert(),r.clipTo(n),r.invert(),n.build(r.allPolygons()),(n=new e(n)).matrix=this.matrix,n},e.prototype.intersect=function(t){var n=this.tree.clone(),r=t.tree.clone();return n.invert(),r.clipTo(n),r.invert(),n.clipTo(r),r.clipTo(n),n.build(r.allPolygons()),n.invert(),(n=new e(n)).matrix=this.matrix,n},e.prototype.create=function(t){if(t instanceof THREE.Geometry)this.fromGeometry(t);else if(t instanceof THREE.BufferGeometry)this.fromBufferGeometry(t);else{if(!(t instanceof THREE.Mesh)){if(t instanceof e.Node)return this.tree=t,this;throw new Error("ThreeBSP: is unable to create a BSP for the given input")}this.fromMesh(t)}},e.prototype.fromGeometry=function(t){var n,r,i,a,o,s,l,c=[];for(n=0,r=t.faces.length;n<r;n++)i=t.faces[n],o=t.faceVertexUvs[0][n],l=new e.Polygon,a=t.vertices[i.a],s=o?new THREE.Vector2(o[0].x,o[0].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[0],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.b],s=o?new THREE.Vector2(o[1].x,o[1].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[1],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.c],s=o?new THREE.Vector2(o[2].x,o[2].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[2],s)).applyMatrix4(this.matrix),l.vertices.push(a),l.calculateProperties(),c.push(l);this.tree=new e.Node(c)},e.prototype.fromIndexedBufferGeometry=function(t){var n,r,i,a,o,s,l,c,u,h,d,f,p,m=t.index.array,g=t.attributes.position.array,v=t.attributes.normal.array,y=t.attributes.uv.array,_=[];for(n=0,r=m.length;n<r;n+=3){for(o=new e.Polygon,s=0;s<3;s++)c=(l=3*(i=m[n+s]))+1,u=l+2,d=(h=2*i)+1,f=v?new THREE.Vector3(v[l],v[c],v[u]):null,p=y?new THREE.Vector2(y[h],y[d]):null,(a=new e.Vertex(g[l],g[c],g[u],f,p)).applyMatrix4(this.matrix),o.vertices.push(a);o.calculateProperties(),_.push(o)}this.tree=new e.Node(_)},e.prototype.fromNonIndexedBufferGeometry=function(t){var n,r,i,a,o,s,l=t.attributes.position.array,c=t.attributes.normal.array,u=t.attributes.uv.array,h=[];for(n=0,r=l.length;n<r;n+=9)a=new e.Polygon,o=c?new THREE.Vector3(c[n],c[n+1],c[n+2]):null,s=u?new THREE.Vector2(u[n],u[n+1]):null,(i=new e.Vertex(l[n],l[n+1],l[n+2],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=c?new THREE.Vector3(c[n+3],c[n+4],c[n+5]):null,s=u?new THREE.Vector2(u[n+2],u[n+3]):null,(i=new e.Vertex(l[n+3],l[n+4],l[n+5],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=c?new THREE.Vector3(c[n+6],c[n+7],c[n+8]):null,s=u?new THREE.Vector2(u[n+4],u[n+5]):null,(i=new e.Vertex(l[n+6],l[n+7],l[n+8])).applyMatrix4(this.matrix),a.vertices.push(i),a.calculateProperties(),h.push(a);this.tree=new e.Node(h)},e.prototype.fromBufferGeometry=function(e){null===e.index?this.fromNonIndexedBufferGeometry(e):this.fromIndexedBufferGeometry(e)},e.prototype.fromMesh=function(e){var t=e.geometry;e.updateMatrix(),this.matrix=e.matrix.clone(),this.create(t)},e.prototype.toGeometry=function(){var e,t,n,r,i,a,o,s,l,c,u=(new THREE.Matrix4).copy(this.matrix).invert(),h=new THREE.Geometry,d=this.tree.allPolygons(),f=d.length,p={};for(e=0;e<f;e++)for(r=(n=d[e]).vertices.length,t=2;t<r;t++)c=[],s=n.vertices[0],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==p[s.x+","+s.y+","+s.z]?i=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),i=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=n.vertices[t-1],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==p[s.x+","+s.y+","+s.z]?a=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),a=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=n.vertices[t],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==p[s.x+","+s.y+","+s.z]?o=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),o=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),l=new THREE.Face3(i,a,o,new THREE.Vector3(n.normal.x,n.normal.y,n.normal.z)),h.faces.push(l),h.faceVertexUvs[0].push(c);return h},e.prototype.toBufferGeometry=function(){var e,t,n,r,i,a,o,s,l=(new THREE.Matrix4).copy(this.matrix).invert(),c=new THREE.BufferGeometry,u=[],h=[],d=[],f=[],p=this.tree.allPolygons(),m=p.length,g={},v=0;for(e=0;e<m;e++)for(r=(n=p[e]).vertices.length,t=2;t<r;t++)[],(s=n.vertices[0]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==g[s.x+","+s.y+","+s.z]?i=g[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),i=v,d.push(n.normal.x,n.normal.y,n.normal.z),v++),(s=n.vertices[t-1]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==g[s.x+","+s.y+","+s.z]?a=g[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),a=v,d.push(n.normal.x,n.normal.y,n.normal.z),v++),(s=n.vertices[t]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==g[s.x+","+s.y+","+s.z]?o=g[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),o=v,d.push(n.normal.x,n.normal.y,n.normal.z),v++),u.push(i,a,o);return c.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(f),2)),c.setAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3)),c.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(d),3)),c.setIndex(new THREE.BufferAttribute(new Uint32Array(u),1)),c},e.prototype.toMesh=function(e){var t=this.toGeometry(),n=new THREE.Mesh(t,e);return n.position.setFromMatrixPosition(this.matrix),n.rotation.setFromRotationMatrix(this.matrix),n},(e.Polygon=function(e,t,n){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=void 0}).prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],n=this.vertices[2];return this.normal=t.clone().subtract(e).cross(n.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this},e.Polygon.prototype.clone=function(){var t,n,r=new e.Polygon;for(t=0,n=this.vertices.length;t<n;t++)r.vertices.push(this.vertices[t].clone());return r.calculateProperties(),r},e.Polygon.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},e.Polygon.prototype.classifyVertex=function(e){var n=this.normal.dot(e)-this.w;return n<-1e-5?2:n>t?1:0},e.Polygon.prototype.classifySide=function(e){var t,n,r,i=0,a=0,o=e.vertices.length;for(t=0;t<o;t++)n=e.vertices[t],1===(r=this.classifyVertex(n))?i++:2===r&&a++;return i>0&&0===a?1:0===i&&a>0?2:0===i&&0===a?0:3},e.Polygon.prototype.splitPolygon=function(t,n,r,i,a){var o=this.classifySide(t);if(0===o)(this.normal.dot(t.normal)>0?n:r).push(t);else if(1===o)i.push(t);else if(2===o)a.push(t);else{var s,l,c,u,h,d,f,p,m,g=[],v=[];for(l=0,s=t.vertices.length;l<s;l++)c=(l+1)%s,d=t.vertices[l],f=t.vertices[c],u=this.classifyVertex(d),h=this.classifyVertex(f),2!=u&&g.push(d),1!=u&&v.push(d),3==(u|h)&&(p=(this.w-this.normal.dot(d))/this.normal.dot(f.clone().subtract(d)),m=d.interpolate(f,p),g.push(m),v.push(m));g.length>=3&&i.push(new e.Polygon(g).calculateProperties()),v.length>=3&&a.push(new e.Polygon(v).calculateProperties())}},(e.Vertex=function(e,t,n,r,i){this.x=e,this.y=t,this.z=n,this.normal=r||new THREE.Vector3,this.uv=i||new THREE.Vector2}).prototype.clone=function(){return new e.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},e.Vertex.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.Vertex.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.Vertex.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.Vertex.prototype.cross=function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},e.Vertex.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},e.Vertex.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.Vertex.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this},e.Vertex.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},e.Vertex.prototype.applyMatrix4=function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},(e.Node=function(t){var n,r,i=[],a=[];if(this.polygons=[],this.front=this.back=void 0,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),n=0,r=t.length;n<r;n++)this.divider.splitPolygon(t[n],this.polygons,this.polygons,i,a);i.length>0&&(this.front=new e.Node(i)),a.length>0&&(this.back=new e.Node(a))}}).isConvex=function(e){var t,n;for(t=0;t<e.length;t++)for(n=0;n<e.length;n++)if(t!==n&&2!==e[t].classifySide(e[n]))return!1;return!0},e.Node.prototype.build=function(t){var n,r,i=[],a=[];for(this.divider||(this.divider=t[0].clone()),n=0,r=t.length;n<r;n++)this.divider.splitPolygon(t[n],this.polygons,this.polygons,i,a);i.length>0&&(this.front||(this.front=new e.Node),this.front.build(i)),a.length>0&&(this.back||(this.back=new e.Node),this.back.build(a))},e.Node.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.Node.prototype.clone=function(){var t=new e.Node;return t.divider=this.divider.clone(),t.polygons=this.polygons.map((function(e){return e.clone()})),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t},e.Node.prototype.invert=function(){var e,t,n;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),n=this.front,this.front=this.back,this.back=n,this},e.Node.prototype.clipPolygons=function(e){var t,n,r,i;if(!this.divider)return e.slice();for(r=[],i=[],t=0,n=e.length;t<n;t++)this.divider.splitPolygon(e[t],r,i,r,i);return this.front&&(r=this.front.clipPolygons(r)),i=this.back?this.back.clipPolygons(i):[],r.concat(i)},e.Node.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e}()},303:()=>{!function(){const e={type:"change"},t={type:"start"},n={type:"end"};class r extends THREE.EventDispatcher{constructor(r,i){super(),void 0===i&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),i===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');const a=this,o=-1,s=0,l=1,c=2,u=3,h=4;this.object=r,this.domElement=i,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;const d=1e-6,f=new THREE.Vector3;let p=1,m=o,g=o,v=0,y=0,_=0;const b=new THREE.Vector3,E=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector3,T=new THREE.Vector2,A=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const e=a.domElement.getBoundingClientRect(),t=a.domElement.ownerDocument.documentElement;a.screen.left=e.left+window.pageXOffset-t.clientLeft,a.screen.top=e.top+window.pageYOffset-t.clientTop,a.screen.width=e.width,a.screen.height=e.height};const R=function(){const e=new THREE.Vector2;return function(t,n){return e.set((t-a.screen.left)/a.screen.width,(n-a.screen.top)/a.screen.height),e}}(),k=function(){const e=new THREE.Vector2;return function(t,n){return e.set((t-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(a.screen.height+2*(a.screen.top-n))/a.screen.width),e}}();function P(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(e.preventDefault(),m===o)switch(e.button){case a.mouseButtons.LEFT:m=s;break;case a.mouseButtons.MIDDLE:m=l;break;case a.mouseButtons.RIGHT:m=c;break;default:m=o}const n=g!==o?g:m;n!==s||a.noRotate?n!==l||a.noZoom?n!==c||a.noPan||(M.copy(R(e.pageX,e.pageY)),S.copy(M)):(T.copy(R(e.pageX,e.pageY)),A.copy(T)):(w.copy(k(e.pageX,e.pageY)),E.copy(w));a.domElement.ownerDocument.addEventListener("pointermove",L),a.domElement.ownerDocument.addEventListener("pointerup",C),a.dispatchEvent(t)}(e)}}function L(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===a.enabled)return;e.preventDefault();const t=g!==o?g:m;t!==s||a.noRotate?t!==l||a.noZoom?t!==c||a.noPan||S.copy(R(e.pageX,e.pageY)):A.copy(R(e.pageX,e.pageY)):(E.copy(w),w.copy(k(e.pageX,e.pageY)))}(e)}}function C(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===a.enabled)return;e.preventDefault(),m=o,a.domElement.ownerDocument.removeEventListener("pointermove",L),a.domElement.ownerDocument.removeEventListener("pointerup",C),a.dispatchEvent(n)}(e)}}function I(e){!1!==a.enabled&&(window.removeEventListener("keydown",I),g===o&&(e.code!==a.keys[s]||a.noRotate?e.code!==a.keys[l]||a.noZoom?e.code!==a.keys[c]||a.noPan||(g=c):g=l:g=s))}function N(){!1!==a.enabled&&(g=o,window.addEventListener("keydown",I))}function F(e){if(!1!==a.enabled&&!0!==a.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:T.y-=.025*e.deltaY;break;case 1:T.y-=.01*e.deltaY;break;default:T.y-=25e-5*e.deltaY}a.dispatchEvent(t),a.dispatchEvent(n)}}function O(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:m=u,w.copy(k(e.touches[0].pageX,e.touches[0].pageY)),E.copy(w);break;default:m=h;const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;y=v=Math.sqrt(t*t+n*n);const r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(R(r,i)),S.copy(M)}a.dispatchEvent(t)}}function H(e){if(!1!==a.enabled)switch(e.preventDefault(),e.touches.length){case 1:E.copy(w),w.copy(k(e.touches[0].pageX,e.touches[0].pageY));break;default:const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;y=Math.sqrt(t*t+n*n);const r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;S.copy(R(r,i))}}function D(e){if(!1!==a.enabled){switch(e.touches.length){case 0:m=o;break;case 1:m=u,w.copy(k(e.touches[0].pageX,e.touches[0].pageY)),E.copy(w)}a.dispatchEvent(n)}}function U(e){!1!==a.enabled&&e.preventDefault()}this.rotateCamera=function(){const e=new THREE.Vector3,t=new THREE.Quaternion,n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3;return function(){o.set(w.x-E.x,w.y-E.y,0);let s=o.length();s?(b.copy(a.object.position).sub(a.target),n.copy(b).normalize(),r.copy(a.object.up).normalize(),i.crossVectors(r,n).normalize(),r.setLength(w.y-E.y),i.setLength(w.x-E.x),o.copy(r.add(i)),e.crossVectors(o,b).normalize(),s*=a.rotateSpeed,t.setFromAxisAngle(e,s),b.applyQuaternion(t),a.object.up.applyQuaternion(t),x.copy(e),_=s):!a.staticMoving&&_&&(_*=Math.sqrt(1-a.dynamicDampingFactor),b.copy(a.object.position).sub(a.target),t.setFromAxisAngle(x,_),b.applyQuaternion(t),a.object.up.applyQuaternion(t)),E.copy(w)}}(),this.zoomCamera=function(){let e;m===h?(e=v/y,v=y,a.object.isPerspectiveCamera?b.multiplyScalar(e):a.object.isOrthographicCamera?(a.object.zoom*=e,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(A.y-T.y)*a.zoomSpeed,1!==e&&e>0&&(a.object.isPerspectiveCamera?b.multiplyScalar(e):a.object.isOrthographicCamera?(a.object.zoom/=e,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),a.staticMoving?T.copy(A):T.y+=(A.y-T.y)*this.dynamicDampingFactor)},this.panCamera=function(){const e=new THREE.Vector2,t=new THREE.Vector3,n=new THREE.Vector3;return function(){if(e.copy(S).sub(M),e.lengthSq()){if(a.object.isOrthographicCamera){const t=(a.object.right-a.object.left)/a.object.zoom/a.domElement.clientWidth,n=(a.object.top-a.object.bottom)/a.object.zoom/a.domElement.clientWidth;e.x*=t,e.y*=n}e.multiplyScalar(b.length()*a.panSpeed),n.copy(b).cross(a.object.up).setLength(e.x),n.add(t.copy(a.object.up).setLength(e.y)),a.object.position.add(n),a.target.add(n),a.staticMoving?M.copy(S):M.add(e.subVectors(S,M).multiplyScalar(a.dynamicDampingFactor))}}}(),this.checkDistances=function(){a.noZoom&&a.noPan||(b.lengthSq()>a.maxDistance*a.maxDistance&&(a.object.position.addVectors(a.target,b.setLength(a.maxDistance)),T.copy(A)),b.lengthSq()<a.minDistance*a.minDistance&&(a.object.position.addVectors(a.target,b.setLength(a.minDistance)),T.copy(A)))},this.update=function(){b.subVectors(a.object.position,a.target),a.noRotate||a.rotateCamera(),a.noZoom||a.zoomCamera(),a.noPan||a.panCamera(),a.object.position.addVectors(a.target,b),a.object.isPerspectiveCamera?(a.checkDistances(),a.object.lookAt(a.target),f.distanceToSquared(a.object.position)>d&&(a.dispatchEvent(e),f.copy(a.object.position))):a.object.isOrthographicCamera?(a.object.lookAt(a.target),(f.distanceToSquared(a.object.position)>d||p!==a.object.zoom)&&(a.dispatchEvent(e),f.copy(a.object.position),p=a.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){m=o,g=o,a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.up.copy(a.up0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),b.subVectors(a.object.position,a.target),a.object.lookAt(a.target),a.dispatchEvent(e),f.copy(a.object.position),p=a.object.zoom},this.dispose=function(){a.domElement.removeEventListener("contextmenu",U),a.domElement.removeEventListener("pointerdown",P),a.domElement.removeEventListener("wheel",F),a.domElement.removeEventListener("touchstart",O),a.domElement.removeEventListener("touchend",D),a.domElement.removeEventListener("touchmove",H),a.domElement.ownerDocument.removeEventListener("pointermove",L),a.domElement.ownerDocument.removeEventListener("pointerup",C),window.removeEventListener("keydown",I),window.removeEventListener("keyup",N)},this.domElement.addEventListener("contextmenu",U),this.domElement.addEventListener("pointerdown",P),this.domElement.addEventListener("wheel",F,{passive:!1}),this.domElement.addEventListener("touchstart",O,{passive:!1}),this.domElement.addEventListener("touchend",D),this.domElement.addEventListener("touchmove",H,{passive:!1}),this.domElement.ownerDocument.addEventListener("pointermove",L),this.domElement.ownerDocument.addEventListener("pointerup",C),window.addEventListener("keydown",I),window.addEventListener("keyup",N),this.handleResize(),this.update()}}THREE.TrackballControls=r}()},841:()=>{!function(){const e=new THREE.Raycaster,t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Quaternion,i={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},a={type:"change"},o={type:"mouseDown"},s={type:"mouseUp",mode:null},l={type:"objectChange"};class c extends THREE.Object3D{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.visible=!1,this.domElement=t;const n=new P;this._gizmo=n,this.add(n);const r=new L;this._plane=r,this.add(r);const i=this;function o(e,t){let o=t;Object.defineProperty(i,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,r[e]=t,n[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(a))}}),i[e]=t,r[e]=t,n[e]=t}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Quaternion,m=new THREE.Quaternion,g=new THREE.Vector3,v=new THREE.Quaternion,y=new THREE.Vector3,_=new THREE.Vector3,b=new THREE.Vector3,E=new THREE.Vector3;o("worldPosition",s),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",m),o("cameraPosition",g),o("cameraQuaternion",v),o("pointStart",y),o("pointEnd",_),o("rotationAxis",b),o("rotationAngle",0),o("eye",E),this._offset=new THREE.Vector3,this._startNorm=new THREE.Vector3,this._endNorm=new THREE.Vector3,this._cameraScale=new THREE.Vector3,this._parentPosition=new THREE.Vector3,this._parentQuaternion=new THREE.Quaternion,this._parentQuaternionInv=new THREE.Quaternion,this._parentScale=new THREE.Vector3,this._worldScaleStart=new THREE.Vector3,this._worldQuaternionInv=new THREE.Quaternion,this._worldScale=new THREE.Vector3,this._positionStart=new THREE.Vector3,this._quaternionStart=new THREE.Quaternion,this._scaleStart=new THREE.Vector3,this._getPointer=u.bind(this),this._onPointerDown=d.bind(this),this._onPointerHover=h.bind(this),this._onPointerMove=f.bind(this),this._onPointerUp=p.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(void 0===this.object||!0===this.dragging)return;e.setFromCamera(t,this.camera);const n=m(this._gizmo.picker[this.mode],e);this.axis=n?n.object.name:null}pointerDown(t){if(void 0!==this.object&&!0!==this.dragging&&0===t.button&&null!==this.axis){e.setFromCamera(t,this.camera);const n=m(this._plane,e,!0);if(n){let e=this.space;if("scale"===this.mode?e="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(e="world"),"local"===e&&"rotate"===this.mode){const e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(n.point).sub(this.worldPositionStart)}this.dragging=!0,o.mode=this.mode,this.dispatchEvent(o)}}pointerMove(o){const s=this.axis,c=this.mode,u=this.object;let h=this.space;if("scale"===c?h="local":"E"!==s&&"XYZE"!==s&&"XYZ"!==s||(h="world"),void 0===u||null===s||!1===this.dragging||-1!==o.button)return;e.setFromCamera(o,this.camera);const d=m(this._plane,e,!0);if(d){if(this.pointEnd.copy(d.point).sub(this.worldPositionStart),"translate"===c)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===h&&"XYZ"!==s&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===s.indexOf("X")&&(this._offset.x=0),-1===s.indexOf("Y")&&(this._offset.y=0),-1===s.indexOf("Z")&&(this._offset.z=0),"local"===h&&"XYZ"!==s?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),u.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===h&&(u.position.applyQuaternion(r.copy(this._quaternionStart).invert()),-1!==s.search("X")&&(u.position.x=Math.round(u.position.x/this.translationSnap)*this.translationSnap),-1!==s.search("Y")&&(u.position.y=Math.round(u.position.y/this.translationSnap)*this.translationSnap),-1!==s.search("Z")&&(u.position.z=Math.round(u.position.z/this.translationSnap)*this.translationSnap),u.position.applyQuaternion(this._quaternionStart)),"world"===h&&(u.parent&&u.position.add(t.setFromMatrixPosition(u.parent.matrixWorld)),-1!==s.search("X")&&(u.position.x=Math.round(u.position.x/this.translationSnap)*this.translationSnap),-1!==s.search("Y")&&(u.position.y=Math.round(u.position.y/this.translationSnap)*this.translationSnap),-1!==s.search("Z")&&(u.position.z=Math.round(u.position.z/this.translationSnap)*this.translationSnap),u.parent&&u.position.sub(t.setFromMatrixPosition(u.parent.matrixWorld))));else if("scale"===c){if(-1!==s.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),n.set(e,e,e)}else t.copy(this.pointStart),n.copy(this.pointEnd),t.applyQuaternion(this._worldQuaternionInv),n.applyQuaternion(this._worldQuaternionInv),n.divide(t),-1===s.search("X")&&(n.x=1),-1===s.search("Y")&&(n.y=1),-1===s.search("Z")&&(n.z=1);u.scale.copy(this._scaleStart).multiply(n),this.scaleSnap&&(-1!==s.search("X")&&(u.scale.x=Math.round(u.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==s.search("Y")&&(u.scale.y=Math.round(u.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==s.search("Z")&&(u.scale.z=Math.round(u.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===c){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(t.setFromMatrixPosition(this.camera.matrixWorld));"E"===s?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===s?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(t.copy(this.rotationAxis).cross(this.eye))*e):"X"!==s&&"Y"!==s&&"Z"!==s||(this.rotationAxis.copy(i[s]),t.copy(i[s]),"local"===h&&t.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(t.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===h&&"E"!==s&&"XYZE"!==s?(u.quaternion.copy(this._quaternionStart),u.quaternion.multiply(r.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),u.quaternion.copy(r.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),u.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(a),this.dispatchEvent(l)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function u(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=e.changedTouches?e.changedTouches[0]:e,n=this.domElement.getBoundingClientRect();return{x:(t.clientX-n.left)/n.width*2-1,y:-(t.clientY-n.top)/n.height*2+1,button:e.button}}}function h(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function d(e){this.enabled&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function f(e){this.enabled&&this.pointerMove(this._getPointer(e))}function p(e){this.enabled&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function m(e,t,n){const r=t.intersectObject(e,!0);for(let e=0;e<r.length;e++)if(r[e].object.visible||n)return r[e];return!1}c.prototype.isTransformControls=!0;const g=new THREE.Euler,v=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,0,0),_=new THREE.Matrix4,b=new THREE.Quaternion,E=new THREE.Quaternion,w=new THREE.Vector3,x=new THREE.Matrix4,T=new THREE.Vector3(1,0,0),A=new THREE.Vector3(0,1,0),M=new THREE.Vector3(0,0,1),S=new THREE.Vector3,R=new THREE.Vector3,k=new THREE.Vector3;class P extends THREE.Object3D{constructor(){super(),this.type="TransformControlsGizmo";const e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1,toneMapped:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const r=e.clone();r.opacity=.33;const i=e.clone();i.color.set(16711680);const a=e.clone();a.color.set(65280);const o=e.clone();o.color.set(255);const s=e.clone();s.opacity=.25;const l=s.clone();l.color.set(16776960);const c=s.clone();c.color.set(65535);const u=s.clone();u.color.set(16711935);e.clone().color.set(16776960);const h=t.clone();h.color.set(16711680);const d=t.clone();d.color.set(65280);const f=t.clone();f.color.set(255);const p=t.clone();p.color.set(65535);const m=t.clone();m.color.set(16711935);const g=t.clone();g.color.set(16776960);const v=t.clone();v.color.set(7895160);const y=g.clone();y.opacity=.25;const _=new THREE.CylinderGeometry(0,.05,.2,12,1,!1),b=new THREE.BoxGeometry(.125,.125,.125),E=new THREE.BufferGeometry;function w(e,t){const n=new THREE.BufferGeometry,r=[];for(let n=0;n<=64*t;++n)r.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return n.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),n}E.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));const x={X:[[new THREE.Mesh(_,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(_,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(E,h)]],Y:[[new THREE.Mesh(_,a),[0,1,0],null,null,"fwd"],[new THREE.Mesh(_,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(E,d),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(_,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(_,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(E,f),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),s.clone()),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneGeometry(.295,.295),l.clone()),[.15,.15,0]],[new THREE.Line(E,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(E,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(E,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(E,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(E,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},T={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),n)]],XY:[[new THREE.Mesh(new THREE.PlaneGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},A={START:[[new THREE.Mesh(new THREE.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new THREE.Line(function(){const e=new THREE.BufferGeometry;return e.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),r),null,null,null,"helper"]],X:[[new THREE.Line(E,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronGeometry(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),d),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),f),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),v),null,[0,Math.PI/2,0]]]},S={AXIS:[[new THREE.Line(E,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},R={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.1,2,24),n)]],XYZE:[[new THREE.Mesh(new THREE.SphereGeometry(.7,10,8),n)]]},k={X:[[new THREE.Mesh(b,i),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(E,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(b,a),[0,.8,0]],[new THREE.Line(E,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(b,o),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(E,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(b,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(E,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(E,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(b,c),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(E,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(b,u),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(E,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(E,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),s.clone()),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),s.clone()),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),s.clone()),[0,0,1.1]]]},P={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(b,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(b,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(b,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.2),n),[0,0,1.1]]]},L={X:[[new THREE.Line(E,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(e){const t=new THREE.Object3D;for(const n in e)for(let r=e[n].length;r--;){const i=e[n][r][0].clone(),a=e[n][r][1],o=e[n][r][2],s=e[n][r][3],l=e[n][r][4];i.name=n,i.tag=l,a&&i.position.set(a[0],a[1],a[2]),o&&i.rotation.set(o[0],o[1],o[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();const c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(x)),this.add(this.gizmo.rotate=C(M)),this.add(this.gizmo.scale=C(k)),this.add(this.picker.translate=C(T)),this.add(this.picker.rotate=C(R)),this.add(this.picker.scale=C(P)),this.add(this.helper.translate=C(A)),this.add(this.helper.rotate=C(S)),this.add(this.helper.scale=C(L)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n="local"===("scale"===this.mode?this.space:"local")?this.worldQuaternion:E;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let e=0;e<i.length;e++){const a=i[e];let o;if(a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==a.tag){if(a.quaternion.copy(n),"translate"===this.mode||"scale"===this.mode){const e=.99,t=.2,r=0;"X"!==a.name&&"XYZX"!==a.name||Math.abs(v.copy(T).applyQuaternion(n).dot(this.eye))>e&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Y"!==a.name&&"XYZY"!==a.name||Math.abs(v.copy(A).applyQuaternion(n).dot(this.eye))>e&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Z"!==a.name&&"XYZZ"!==a.name||Math.abs(v.copy(M).applyQuaternion(n).dot(this.eye))>e&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XY"===a.name&&Math.abs(v.copy(M).applyQuaternion(n).dot(this.eye))<t&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"YZ"===a.name&&Math.abs(v.copy(T).applyQuaternion(n).dot(this.eye))<t&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XZ"===a.name&&Math.abs(v.copy(A).applyQuaternion(n).dot(this.eye))<t&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),-1!==a.name.search("X")&&(v.copy(T).applyQuaternion(n).dot(this.eye)<r?"fwd"===a.tag?a.visible=!1:a.scale.x*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Y")&&(v.copy(A).applyQuaternion(n).dot(this.eye)<r?"fwd"===a.tag?a.visible=!1:a.scale.y*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Z")&&(v.copy(M).applyQuaternion(n).dot(this.eye)<r?"fwd"===a.tag?a.visible=!1:a.scale.z*=-1:"bwd"===a.tag&&(a.visible=!1))}else"rotate"===this.mode&&(b.copy(n),v.copy(this.eye).applyQuaternion(r.copy(n).invert()),-1!==a.name.search("E")&&a.quaternion.setFromRotationMatrix(_.lookAt(this.eye,y,A)),"X"===a.name&&(r.setFromAxisAngle(T,Math.atan2(-v.y,v.z)),r.multiplyQuaternions(b,r),a.quaternion.copy(r)),"Y"===a.name&&(r.setFromAxisAngle(A,Math.atan2(v.x,v.z)),r.multiplyQuaternions(b,r),a.quaternion.copy(r)),"Z"===a.name&&(r.setFromAxisAngle(M,Math.atan2(v.y,v.x)),r.multiplyQuaternions(b,r),a.quaternion.copy(r)));a.visible=a.visible&&(-1===a.name.indexOf("X")||this.showX),a.visible=a.visible&&(-1===a.name.indexOf("Y")||this.showY),a.visible=a.visible&&(-1===a.name.indexOf("Z")||this.showZ),a.visible=a.visible&&(-1===a.name.indexOf("E")||this.showX&&this.showY&&this.showZ),a.material._opacity=a.material._opacity||a.material.opacity,a.material._color=a.material._color||a.material.color.clone(),a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled?this.axis&&(a.name===this.axis||this.axis.split("").some((function(e){return a.name===e}))?(a.material.opacity=1,a.material.color.lerp(new THREE.Color(1,1,1),.5)):(a.material.opacity*=.25,a.material.color.lerp(new THREE.Color(1,1,1),.5))):(a.material.opacity*=.5,a.material.color.lerp(new THREE.Color(1,1,1),.5))}else a.visible=!1,"AXIS"===a.name?(a.position.copy(this.worldPositionStart),a.visible=!!this.axis,"X"===this.axis&&(r.setFromEuler(g.set(0,0,0)),a.quaternion.copy(n).multiply(r),Math.abs(v.copy(T).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),"Y"===this.axis&&(r.setFromEuler(g.set(0,0,Math.PI/2)),a.quaternion.copy(n).multiply(r),Math.abs(v.copy(A).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),"Z"===this.axis&&(r.setFromEuler(g.set(0,Math.PI/2,0)),a.quaternion.copy(n).multiply(r),Math.abs(v.copy(M).applyQuaternion(n).dot(this.eye))>.9&&(a.visible=!1)),"XYZE"===this.axis&&(r.setFromEuler(g.set(0,Math.PI/2,0)),v.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(_.lookAt(y,v,A)),a.quaternion.multiply(r),a.visible=this.dragging),"E"===this.axis&&(a.visible=!1)):"START"===a.name?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):"END"===a.name?(a.position.copy(this.worldPosition),a.visible=this.dragging):"DELTA"===a.name?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),t.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),t.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(t),a.visible=this.dragging):(a.quaternion.copy(n),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=-1!==this.axis.search(a.name)))}super.updateMatrixWorld(e)}}P.prototype.isTransformControlsGizmo=!0;class L extends THREE.Mesh{constructor(){super(new THREE.PlaneGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane"}updateMatrixWorld(e){let n=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(n="local"),S.copy(T).applyQuaternion("local"===n?this.worldQuaternion:E),R.copy(A).applyQuaternion("local"===n?this.worldQuaternion:E),k.copy(M).applyQuaternion("local"===n?this.worldQuaternion:E),v.copy(R),this.mode){case"translate":case"scale":switch(this.axis){case"X":v.copy(this.eye).cross(S),w.copy(S).cross(v);break;case"Y":v.copy(this.eye).cross(R),w.copy(R).cross(v);break;case"Z":v.copy(this.eye).cross(k),w.copy(k).cross(v);break;case"XY":w.copy(k);break;case"YZ":w.copy(S);break;case"XZ":v.copy(k),w.copy(R);break;case"XYZ":case"E":w.set(0,0,0)}break;case"rotate":default:w.set(0,0,0)}0===w.length()?this.quaternion.copy(this.cameraQuaternion):(x.lookAt(t.set(0,0,0),w,v),this.quaternion.setFromRotationMatrix(x)),super.updateMatrixWorld(e)}}L.prototype.isTransformControlsPlane=!0,THREE.TransformControls=c,THREE.TransformControlsGizmo=P,THREE.TransformControlsPlane=L}()},2003:function(e,t,n){var r,i=n(2530),a=function(){this._tweens={},this._tweensAddedDuringUpdate={}};a.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:s.now();n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[n[r]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var o,s=new a;s.Group=a,s._nextId=0,s.nextId=function(){return s._nextId++},"undefined"==typeof self&&void 0!==i&&i.hrtime?s.now=function(){var e=i.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?s.now=self.performance.now.bind(self.performance):void 0!==Date.now?s.now=Date.now:s.now=function(){return(new Date).getTime()},s.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=s.Easing.Linear.None,this._interpolationFunction=s.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||s,this._id=s.nextId()},s.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?s.now()+parseFloat(e):e:s.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n,r=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,r):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?i+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=i+(a-i)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},s.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-s.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*s.Easing.Bounce.In(2*e):.5*s.Easing.Bounce.Out(2*e-1)+.5}}},s.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=s.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=s.Interpolation.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*a(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=s.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=s.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(o=[1],function(e){var t=1;if(o[e])return o[e];for(var n=e;n>1;n--)t*=n;return o[e]=t,t}),CatmullRom:function(e,t,n,r,i){var a=.5*(n-e),o=.5*(r-t),s=i*i;return(2*t-2*n+a+o)*(i*s)+(-3*t+3*n-2*a-o)*s+a*i+t}}},void 0===(r=function(){return s}.apply(t,[]))||(e.exports=r)},7763:()=>{!function(){const e={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n\t\t\tgl_FragColor = vec4( vec3( depth ), opacity );\n\n\t\t}"};THREE.UnpackDepthRGBAShader=e}()},8168:()=>{!function(){class e extends THREE.Pass{constructor(e,t,n,r){super(),this.strength=void 0!==t?t:1,this.radius=n,this.threshold=r,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);const i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){const t=new THREE.WebGLRenderTarget(a,o,i);t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(t);const n=new THREE.WebGLRenderTarget(a,o,i);n.texture.name="UnrealBloomPass.v"+e,n.texture.generateMipmaps=!1,this.renderTargetsVertical.push(n),a=Math.round(a/2),o=Math.round(o/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");const s=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(s.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[e])),this.separableBlurMaterials[e].uniforms.texSize.value=new THREE.Vector2(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");const c=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.basic=new THREE.MeshBasicMaterial,this.fsQuad=new THREE.FullScreenQuad(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let n=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(n,r);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(n,r),this.renderTargetsVertical[e].setSize(n,r),this.separableBlurMaterials[e].uniforms.texSize.value=new THREE.Vector2(n,r),n=Math.round(n/2),r=Math.round(r/2)}render(t,n,r,i,a){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),a&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let s=this.renderTargetBright;for(let n=0;n<this.nMips;n++)this.fsQuad.material=this.separableBlurMaterials[n],this.separableBlurMaterials[n].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[n].uniforms.direction.value=e.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[n]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[n].uniforms.colorTexture.value=this.renderTargetsHorizontal[n].texture,this.separableBlurMaterials[n].uniforms.direction.value=e.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[n]),t.clear(),this.fsQuad.render(t),s=this.renderTargetsVertical[n];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(r),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=o}getSeperableBlurMaterial(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}e.BlurDirectionX=new THREE.Vector2(1,0),e.BlurDirectionY=new THREE.Vector2(0,1),THREE.UnrealBloomPass=e}()},8694:(e,t,n)=>{"use strict";n.r(t);var r=n(3946),i=n.n(r);!function(){class e extends THREE.Loader{constructor(e){if(super(e),void 0===i())throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.")}load(e,t,n,r){const i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e,n){const s={};function l(e){e.DEF&&(s[e.DEF]=e);const t=e.fields;for(let e=0,n=t.length;e<n;e++){const n=t[e];if("node"===n.type){const e=n.values;for(let t=0,n=e.length;t<n;t++)l(e[t])}}}function c(e){return e.USE?function(e){const t=c(s[e]);return t.isObject3D||t.isMaterial?t.clone():t}(e.USE):(void 0!==e.build||(e.build=function(e){const t=e.name;let n;switch(t){case"Group":case"Transform":case"Collision":n=function(e){const t=new THREE.Group,n=e.fields;for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.name,a=r.values;switch(i){case"bboxCenter":case"bboxSize":case"center":break;case"children":d(a,t);break;case"collide":break;case"rotation":const e=new THREE.Vector3(a[0],a[1],a[2]),n=a[3];t.quaternion.setFromAxisAngle(e,n);break;case"scale":t.scale.set(a[0],a[1],a[2]);break;case"scaleOrientation":break;case"translation":t.position.set(a[0],a[1],a[2]);break;case"proxy":break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"Background":n=function(e){const t=new THREE.Group;let n,r,i,a;const o=e.fields;for(let e=0,t=o.length;e<t;e++){const t=o[e],s=t.name,l=t.values;switch(s){case"groundAngle":n=l;break;case"groundColor":r=l;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":i=l;break;case"skyColor":a=l;break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}const s=1e4;if(a){const e=new THREE.SphereGeometry(s,32,16),n=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,depthWrite:!1,depthTest:!1});a.length>3?(I(e,s,i,C(a),!0),n.vertexColors=!0):n.color.setRGB(a[0],a[1],a[2]);const r=new THREE.Mesh(e,n);t.add(r)}if(r&&r.length>0){const e=new THREE.SphereGeometry(s,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),i=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});I(e,s,n,C(r),!1);const a=new THREE.Mesh(e,i);t.add(a)}return t.renderOrder=-1/0,t}(e);break;case"Shape":n=function(e){const t=e.fields;let n,r,i=new THREE.MeshBasicMaterial({color:0});for(let e=0,r=t.length;e<r;e++){const r=t[e],a=r.name,o=r.values;switch(a){case"appearance":null!==o[0]&&(i=c(o[0]));break;case"geometry":null!==o[0]&&(n=c(o[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}if(n&&n.attributes.position){const e=n._type;if("points"===e){const e=new THREE.PointsMaterial({color:16777215});void 0!==n.attributes.color?e.vertexColors=!0:i.isMeshPhongMaterial&&e.color.copy(i.emissive),r=new THREE.Points(n,e)}else if("line"===e){const e=new THREE.LineBasicMaterial({color:16777215});void 0!==n.attributes.color?e.vertexColors=!0:i.isMeshPhongMaterial&&e.color.copy(i.emissive),r=new THREE.LineSegments(n,e)}else void 0!==n._solid&&(i.side=n._solid?THREE.FrontSide:THREE.DoubleSide),void 0!==n.attributes.color&&(i.vertexColors=!0),r=new THREE.Mesh(n,i)}else r=new THREE.Object3D,r.visible=!1;return r}(e);break;case"Appearance":n=function(e){let t,n=new THREE.MeshPhongMaterial;const r=e.fields;for(let e=0,i=r.length;e<i;e++){const i=r[e],a=i.name,o=i.values;switch(a){case"material":if(null!==o[0]){const e=c(o[0]);e.diffuseColor&&n.color.copy(e.diffuseColor),e.emissiveColor&&n.emissive.copy(e.emissiveColor),e.shininess&&(n.shininess=e.shininess),e.specularColor&&n.specular.copy(e.specularColor),e.transparency&&(n.opacity=1-e.transparency),e.transparency>0&&(n.transparent=!0)}else n=new THREE.MeshBasicMaterial({color:0});break;case"texture":const e=o[0];null!==e&&("ImageTexture"!==e.name&&"PixelTexture"!==e.name||(n.map=c(e)));break;case"textureTransform":null!==o[0]&&(t=c(o[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}if(n.map){if(n.map.__type){switch(n.map.__type){case o.INTENSITY_ALPHA:n.opacity=1;break;case o.RGB:n.color.set(16777215);break;case o.RGBA:n.color.set(16777215),n.opacity=1}delete n.map.__type}t&&(n.map.center.copy(t.center),n.map.rotation=t.rotation,n.map.repeat.copy(t.scale),n.map.offset.copy(t.translation))}return n}(e);break;case"Material":n=function(e){const t={},n=e.fields;for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.name,a=r.values;switch(i){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new THREE.Color(a[0],a[1],a[2]);break;case"emissiveColor":t.emissiveColor=new THREE.Color(a[0],a[1],a[2]);break;case"shininess":t.shininess=a[0];break;case"specularColor":t.emissiveColor=new THREE.Color(a[0],a[1],a[2]);break;case"transparency":t.transparency=a[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"ImageTexture":n=function(e){let t,n=THREE.RepeatWrapping,r=THREE.RepeatWrapping;const i=e.fields;for(let e=0,a=i.length;e<a;e++){const a=i[e],o=a.name,s=a.values;switch(o){case"url":const e=s[0];e&&(t=N.load(e));break;case"repeatS":!1===s[0]&&(n=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===s[0]&&(r=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}t&&(t.wrapS=n,t.wrapT=r);return t}(e);break;case"PixelTexture":n=function(e){let t,n=THREE.RepeatWrapping,r=THREE.RepeatWrapping;const i=e.fields;for(let e=0,a=i.length;e<a;e++){const a=i[e],o=a.name,s=a.values;switch(o){case"image":const e=s[0],i=s[1],a=s[2],l=2===a||4===a,c=h(a),d=new Uint8Array(e*i*(!0===l?4:3)),f={r:0,g:0,b:0,a:0};for(let e=3,t=0,n=s.length;e<n;e++,t++)if(u(s[e],c,f),!0===l){const e=4*t;d[e+0]=f.r,d[e+1]=f.g,d[e+2]=f.b,d[e+3]=f.a}else{const e=3*t;d[e+0]=f.r,d[e+1]=f.g,d[e+2]=f.b}t=new THREE.DataTexture(d,e,i,!0===l?THREE.RGBAFormat:THREE.RGBFormat),t.__type=c;break;case"repeatS":!1===s[0]&&(n=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===s[0]&&(r=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}t&&(t.wrapS=n,t.wrapT=r);return t}(e);break;case"TextureTransform":n=function(e){const t={center:new THREE.Vector2,rotation:new THREE.Vector2,scale:new THREE.Vector2,translation:new THREE.Vector2},n=e.fields;for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.name,a=r.values;switch(i){case"center":t.center.set(a[0],a[1]);break;case"rotation":t.rotation=a[0];break;case"scale":t.scale.set(a[0],a[1]);break;case"translation":t.translation.set(a[0],a[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"IndexedFaceSet":n=function(e){let t,n,r,i,a,o,s,l,u=!0,h=!0,d=0,g=!0,v=!0;const y=e.fields;for(let e=0,f=y.length;e<f;e++){const f=y[e],p=f.name,m=f.values;switch(p){case"color":const e=m[0];null!==e&&(t=c(e));break;case"coord":const f=m[0];null!==f&&(n=c(f));break;case"normal":const y=m[0];null!==y&&(r=c(y));break;case"texCoord":const _=m[0];null!==_&&(i=c(_));break;case"ccw":u=m[0];break;case"colorIndex":a=m;break;case"colorPerVertex":g=m[0];break;case"convex":break;case"coordIndex":o=m;break;case"creaseAngle":d=m[0];break;case"normalIndex":s=m;break;case"normalPerVertex":v=m[0];break;case"solid":h=m[0];break;case"texCoordIndex":l=m;break;default:console.warn("THREE.VRMLLoader: Unknown field:",p)}}if(void 0===o)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new THREE.BufferGeometry;const _=f(o,u);let b,E,w;if(t)if(!0===g)if(a&&a.length>0){b=T(_,f(a,u),t,3)}else b=S(_,new THREE.Float32BufferAttribute(t,3));else if(a&&a.length>0){b=A(_,p(m(t,a),o))}else{b=A(_,p(t,o))}if(r)if(!0===v)if(s&&s.length>0){E=T(_,f(s,u),r,3)}else E=S(_,new THREE.Float32BufferAttribute(r,3));else if(s&&s.length>0){E=A(_,p(m(r,s),o))}else{E=A(_,p(r,o))}else E=P(_,n,d);if(i)if(l&&l.length>0){w=T(_,f(l,u),i,2)}else w=S(_,new THREE.Float32BufferAttribute(i,2));const x=new THREE.BufferGeometry,M=S(_,new THREE.Float32BufferAttribute(n,3));x.setAttribute("position",M),x.setAttribute("normal",E),b&&x.setAttribute("color",b);w&&x.setAttribute("uv",w);return x._solid=h,x._type="mesh",x}(e);break;case"IndexedLineSet":n=function(e){let t,n,r,i,a=!0;const o=e.fields;for(let e=0,s=o.length;e<s;e++){const s=o[e],l=s.name,u=s.values;switch(l){case"color":const e=u[0];null!==e&&(t=c(e));break;case"coord":const o=u[0];null!==o&&(n=c(o));break;case"colorIndex":r=u;break;case"colorPerVertex":a=u[0];break;case"coordIndex":i=u;break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}let s;const l=g(i);if(t)if(!0===a)if(r.length>0){s=T(l,g(r),t,3)}else s=S(l,new THREE.Float32BufferAttribute(t,3));else if(r.length>0){s=M(l,v(m(t,r),i))}else{s=M(l,v(t,i))}const u=new THREE.BufferGeometry,h=S(l,new THREE.Float32BufferAttribute(n,3));u.setAttribute("position",h),s&&u.setAttribute("color",s);return u._type="line",u}(e);break;case"PointSet":n=function(e){let t,n;const r=e.fields;for(let e=0,i=r.length;e<i;e++){const i=r[e],a=i.name,o=i.values;switch(a){case"color":const e=o[0];null!==e&&(t=c(e));break;case"coord":const r=o[0];null!==r&&(n=c(r));break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}const i=new THREE.BufferGeometry;i.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),t&&i.setAttribute("color",new THREE.Float32BufferAttribute(t,3));return i._type="points",i}(e);break;case"Box":n=function(e){const t=new THREE.Vector3(2,2,2),n=e.fields;for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.name,a=r.values;switch(i){case"size":t.x=a[0],t.y=a[1],t.z=a[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return new THREE.BoxGeometry(t.x,t.y,t.z)}(e);break;case"Cone":n=function(e){let t=1,n=2,r=!1;const i=e.fields;for(let e=0,a=i.length;e<a;e++){const a=i[e],o=a.name,s=a.values;switch(o){case"bottom":r=!s[0];break;case"bottomRadius":t=s[0];break;case"height":n=s[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.ConeGeometry(t,n,16,1,r)}(e);break;case"Cylinder":n=function(e){let t=1,n=2;const r=e.fields;for(let e=0,i=r.length;e<i;e++){const i=r[e],a=i.name,o=i.values;switch(a){case"bottom":break;case"radius":t=o[0];break;case"height":n=o[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}return new THREE.CylinderGeometry(t,t,n,16,1)}(e);break;case"Sphere":n=function(e){let t=1;const n=e.fields;for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.name,a=r.values;switch(i){case"radius":t=a[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return new THREE.SphereGeometry(t,16,16)}(e);break;case"ElevationGrid":n=function(e){let t,n,r,i,a=!0,o=!0,s=!0,l=!0,u=0,h=2,d=2,f=1,p=1;const m=e.fields;for(let e=0,g=m.length;e<g;e++){const g=m[e],v=g.name,y=g.values;switch(v){case"color":const e=y[0];null!==e&&(t=c(e));break;case"normal":const m=y[0];null!==m&&(n=c(m));break;case"texCoord":const g=y[0];null!==g&&(r=c(g));break;case"height":i=y;break;case"ccw":l=y[0];break;case"colorPerVertex":a=y[0];break;case"creaseAngle":u=y[0];break;case"normalPerVertex":o=y[0];break;case"solid":s=y[0];break;case"xDimension":h=y[0];break;case"xSpacing":f=y[0];break;case"zDimension":d=y[0];break;case"zSpacing":p=y[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",v)}}const g=[],v=[],y=[],_=[];for(let e=0;e<d;e++)for(let s=0;s<h;s++){const l=e*h+s,c=f*e,u=i[l],m=p*s;if(g.push(c,u,m),t&&!0===a){const e=t[3*l+0],n=t[3*l+1],r=t[3*l+2];y.push(e,n,r)}if(n&&!0===o){const e=n[3*l+0],t=n[3*l+1],r=n[3*l+2];v.push(e,t,r)}if(r){const e=r[2*l+0],t=r[2*l+1];_.push(e,t)}else _.push(e/(h-1),s/(d-1))}const b=[];for(let e=0;e<h-1;e++)for(let t=0;t<d-1;t++){const n=e+t*h,r=e+(t+1)*h,i=e+1+(t+1)*h,a=e+1+t*h;!0===l?(b.push(n,i,r),b.push(i,n,a)):(b.push(n,r,i),b.push(i,a,n))}const E=S(b,new THREE.Float32BufferAttribute(g,3)),w=S(b,new THREE.Float32BufferAttribute(_,2));let x,T;if(t)if(!1===a){for(let e=0;e<h-1;e++)for(let n=0;n<d-1;n++){const r=e+n*(h-1),i=t[3*r+0],a=t[3*r+1],o=t[3*r+2];y.push(i,a,o),y.push(i,a,o),y.push(i,a,o),y.push(i,a,o),y.push(i,a,o),y.push(i,a,o)}x=new THREE.Float32BufferAttribute(y,3)}else x=S(b,new THREE.Float32BufferAttribute(y,3));if(n)if(!1===o){for(let e=0;e<h-1;e++)for(let t=0;t<d-1;t++){const r=e+t*(h-1),i=n[3*r+0],a=n[3*r+1],o=n[3*r+2];v.push(i,a,o),v.push(i,a,o),v.push(i,a,o),v.push(i,a,o),v.push(i,a,o),v.push(i,a,o)}T=new THREE.Float32BufferAttribute(v,3)}else T=S(b,new THREE.Float32BufferAttribute(v,3));else T=P(b,g,u);const A=new THREE.BufferGeometry;A.setAttribute("position",E),A.setAttribute("normal",T),A.setAttribute("uv",w),x&&A.setAttribute("color",x);return A._solid=s,A._type="mesh",A}(e);break;case"Extrusion":n=function(e){let t,n,r=[1,1,1,-1,-1,-1,-1,1,1,1],i=[0,0,0,0,1,0],a=!0,o=!0,s=0,l=!0,c=!0;const u=e.fields;for(let e=0,h=u.length;e<h;e++){const h=u[e],d=h.name,f=h.values;switch(d){case"beginCap":a=f[0];break;case"ccw":o=f[0];break;case"convex":break;case"creaseAngle":s=f[0];break;case"crossSection":r=f;break;case"endCap":l=f[0];break;case"orientation":n=f;break;case"scale":t=f;break;case"solid":c=f[0];break;case"spine":i=f;break;default:console.warn("THREE.VRMLLoader: Unknown field:",d)}}const h=r[0]===r[r.length-2]&&r[1]===r[r.length-1],d=[],f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Quaternion;for(let e=0,a=0,o=0,s=i.length;e<s;e+=3,a+=2,o+=4){f.fromArray(i,e),p.x=t?t[a+0]:1,p.y=1,p.z=t?t[a+1]:1,m.x=n?n[o+0]:0,m.y=n?n[o+1]:0,m.z=n?n[o+2]:1;const s=n?n[o+3]:0;for(let e=0,t=r.length;e<t;e+=2)g.x=r[e+0],g.y=0,g.z=r[e+1],g.multiply(p),v.setFromAxisAngle(m,s),g.applyQuaternion(v),g.add(f),d.push(g.x,g.y,g.z)}const y=[],_=i.length/3,b=r.length/2;for(let e=0;e<_-1;e++)for(let t=0;t<b-1;t++){const n=t+e*b;let r=t+1+e*b;const i=t+(e+1)*b;let a=t+1+(e+1)*b;t===b-2&&!0===h&&(r=e*b,a=(e+1)*b),!0===o?(y.push(n,r,i),y.push(i,r,a)):(y.push(n,i,r),y.push(i,a,r))}if(!0===a||!0===l){const e=[];for(let t=0,n=r.length;t<n;t+=2)e.push(new THREE.Vector2(r[t],r[t+1]));const t=THREE.ShapeUtils.triangulateShape(e,[]),n=[];for(let e=0,r=t.length;e<r;e++){const r=t[e];n.push(r[0],r[1],r[2])}if(!0===a)for(let e=0,t=n.length;e<t;e+=3)!0===o?y.push(n[e+0],n[e+1],n[e+2]):y.push(n[e+0],n[e+2],n[e+1]);if(!0===l){const e=b*(_-1);for(let t=0,r=n.length;t<r;t+=3)!0===o?y.push(e+n[t+0],e+n[t+2],e+n[t+1]):y.push(e+n[t+0],e+n[t+1],e+n[t+2])}}const E=S(y,new THREE.Float32BufferAttribute(d,3)),w=P(y,d,s),x=new THREE.BufferGeometry;return x.setAttribute("position",E),x.setAttribute("normal",w),x._solid=c,x._type="mesh",x}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":n=function(e){return e.fields[0].values}(e);break;case"WorldInfo":n=function(e){const t={},n=e.fields;for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.name,a=r.values;switch(i){case"title":t.title=a[0];break;case"info":t.info=a;break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"Anchor":case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",t)}void 0!==n&&void 0!==e.DEF&&!0===n.hasOwnProperty("name")&&(n.name=e.DEF);return n}(e)),e.build)}function u(e,t,n){let r;switch(t){case o.INTENSITY:r=parseInt(e),n.r=r,n.g=r,n.b=r;break;case o.INTENSITY_ALPHA:r=parseInt("0x"+e.substring(2,4)),n.r=r,n.g=r,n.b=r,n.a=parseInt("0x"+e.substring(4,6));break;case o.RGB:n.r=parseInt("0x"+e.substring(2,4)),n.g=parseInt("0x"+e.substring(4,6)),n.b=parseInt("0x"+e.substring(6,8));break;case o.RGBA:n.r=parseInt("0x"+e.substring(2,4)),n.g=parseInt("0x"+e.substring(4,6)),n.b=parseInt("0x"+e.substring(6,8)),n.a=parseInt("0x"+e.substring(8,10))}}function h(e){let t;switch(e){case 1:t=o.INTENSITY;break;case 2:t=o.INTENSITY_ALPHA;break;case 3:t=o.RGB;break;case 4:t=o.RGBA}return t}function d(e,t){for(let n=0,r=e.length;n<r;n++){const r=c(e[n]);r instanceof THREE.Object3D&&t.add(r)}}function f(e,t){const n=[];let r=0;for(let i=0,a=e.length;i<a;i++){const o=e[r],s=e[i+(t?1:2)],l=e[i+(t?2:1)];n.push(o,s,l),(-1===e[i+3]||i+3>=a)&&(i+=3,r=i+1)}return n}function p(e,t){const n=[];let r=0;for(let i=0,a=t.length;i<a;i++){const o=3*r,s=e[o],l=e[o+1],c=e[o+2];n.push(s,l,c),(-1===t[i+3]||i+3>=a)&&(i+=3,r++)}return n}function m(e,t){const n=[];for(let r=0,i=t.length;r<i;r++){const i=3*t[r],a=e[i],o=e[i+1],s=e[i+2];n.push(a,o,s)}return n}function g(e){const t=[];for(let n=0,r=e.length;n<r;n++){const i=e[n],a=e[n+1];t.push(i,a),(-1===e[n+2]||n+2>=r)&&(n+=2)}return t}function v(e,t){const n=[];let r=0;for(let i=0,a=t.length;i<a;i++){const o=3*r,s=e[o],l=e[o+1],c=e[o+2];n.push(s,l,c),(-1===t[i+2]||i+2>=a)&&(i+=2,r++)}return n}const y=new THREE.Vector3,_=new THREE.Vector3,b=new THREE.Vector3,E=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2;function T(e,t,n,r){const i=[];for(let a=0,o=e.length;a<o;a+=3){const e=t[a],o=t[a+1],s=t[a+2];2===r?(E.fromArray(n,e*r),w.fromArray(n,o*r),x.fromArray(n,s*r),i.push(E.x,E.y),i.push(w.x,w.y),i.push(x.x,x.y)):(y.fromArray(n,e*r),_.fromArray(n,o*r),b.fromArray(n,s*r),i.push(y.x,y.y,y.z),i.push(_.x,_.y,_.z),i.push(b.x,b.y,b.z))}return new THREE.Float32BufferAttribute(i,r)}function A(e,t){const n=[];for(let r=0,i=0,a=e.length;r<a;r+=3,i++)y.fromArray(t,3*i),n.push(y.x,y.y,y.z),n.push(y.x,y.y,y.z),n.push(y.x,y.y,y.z);return new THREE.Float32BufferAttribute(n,3)}function M(e,t){const n=[];for(let r=0,i=0,a=e.length;r<a;r+=2,i++)y.fromArray(t,3*i),n.push(y.x,y.y,y.z),n.push(y.x,y.y,y.z);return new THREE.Float32BufferAttribute(n,3)}function S(e,t){const n=t.array,r=t.itemSize,i=new n.constructor(e.length*r);let a=0,o=0;for(let t=0,s=e.length;t<s;t++){a=e[t]*r;for(let e=0;e<r;e++)i[o++]=n[a++]}return new THREE.Float32BufferAttribute(i,r)}const R=new THREE.Vector3,k=new THREE.Vector3;function P(e,t,n){const r=[],i={};for(let n=0,o=e.length;n<o;n+=3){const o=e[n],s=e[n+1],l=e[n+2],c=new a(o,s,l);y.fromArray(t,3*o),_.fromArray(t,3*s),b.fromArray(t,3*l),k.subVectors(b,_),R.subVectors(y,_),k.cross(R),k.normalize(),c.normal.copy(k),void 0===i[o]&&(i[o]=[]),void 0===i[s]&&(i[s]=[]),void 0===i[l]&&(i[l]=[]),i[o].push(c.normal),i[s].push(c.normal),i[l].push(c.normal),r.push(c)}const o=[];for(let e=0,a=r.length;e<a;e++){const a=r[e],s=L(i[a.a],a.normal,n),l=L(i[a.b],a.normal,n),c=L(i[a.c],a.normal,n);y.fromArray(t,3*a.a),_.fromArray(t,3*a.b),b.fromArray(t,3*a.c),o.push(s.x,s.y,s.z),o.push(l.x,l.y,l.z),o.push(c.x,c.y,c.z)}return new THREE.Float32BufferAttribute(o,3)}function L(e,t,n){const r=new THREE.Vector3;if(0===n)r.copy(t);else for(let i=0,a=e.length;i<a;i++)e[i].angleTo(t)<n&&r.add(e[i]);return r.normalize()}function C(e){const t=[];for(let n=0,r=e.length;n<r;n+=3)t.push(new THREE.Color(e[n],e[n+1],e[n+2]));return t}function I(e,t,n,r,i){const a=[],o=!0===i?0:Math.PI;for(let e=0,s=r.length;e<s;e++){let r=0===e?0:n[e-1];r=!0===i?r:o-r;const s=new THREE.Vector3;s.setFromSphericalCoords(t,r,0),a.push(s)}const s=e.index,l=e.attributes.position,c=new THREE.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),u=new THREE.Vector3,h=new THREE.Color;for(let e=0;e<s.count;e++){const t=s.getX(e);let n,o;u.fromBufferAttribute(l,t);let d=1;for(let e=1;e<a.length;e++){n=e-1,o=e;const t=a[n],r=a[o];if(!0===i){if(u.y<=t.y&&u.y>r.y){d=Math.abs(t.y-u.y)/Math.abs(t.y-r.y);break}}else if(u.y>=t.y&&u.y<r.y){d=Math.abs(t.y-u.y)/Math.abs(t.y-r.y);break}}const f=r[n],p=r[o];h.copy(f).lerp(p,d),c.setXYZ(t,h.r,h.g,h.b)}e.setAttribute("color",c)}const N=new THREE.TextureLoader(this.manager);if(N.setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),-1===e.indexOf("#VRML V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){const t=e.nodes,n=new THREE.Scene;for(let e=0,n=t.length;e<n;e++){l(t[e])}for(let e=0,r=t.length;e<r;e++){const r=t[e],i=c(r);i instanceof THREE.Object3D&&n.add(i),"WorldInfo"===r.name&&(n.userData.worldInfo=i)}return n}(function(e){const n=function(){const e=i().createToken,t=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),n=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:t}),r=["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"],a=e({name:"Version",pattern:/#VRML.*/,longer_alt:n}),o=e({name:"NodeName",pattern:new RegExp(r.join("|")),longer_alt:n}),s=e({name:"DEF",pattern:/DEF/,longer_alt:n}),l=e({name:"USE",pattern:/USE/,longer_alt:n}),c=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:n}),u=e({name:"TO",pattern:/TO/,longer_alt:n}),h=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/}),d=e({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),f=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),p=e({name:"TrueLiteral",pattern:/TRUE/}),m=e({name:"FalseLiteral",pattern:/FALSE/}),g=e({name:"NullLiteral",pattern:/NULL/}),v=e({name:"LSquare",pattern:/\[/}),y=e({name:"RSquare",pattern:/]/}),_=e({name:"LCurly",pattern:/{/}),b=e({name:"RCurly",pattern:/}/}),E=e({name:"Comment",pattern:/#.*/,group:i().Lexer.SKIPPED}),w=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:i().Lexer.SKIPPED}),o,s,l,c,u,p,m,g,a,n,t,h,d,f,v,y,_,b,E],x={};for(let e=0,t=w.length;e<t;e++){const t=w[e];x[t.name]=t}return{tokens:w,tokenVocabulary:x}}(),a=new t(n.tokens),o=new r(n.tokenVocabulary),s=function(e){function t(){e.call(this),this.validateVisitor()}function n(e,t){const n={type:null,values:[]};if(t.node){n.type="node";for(let r=0,i=t.node.length;r<i;r++){const i=t.node[r];n.values.push(e.visit(i))}}if(t.use){n.type="use";for(let r=0,i=t.use.length;r<i;r++){const i=t.use[r];n.values.push(e.visit(i))}}if(t.StringLiteral){n.type="string";for(let e=0,r=t.StringLiteral.length;e<r;e++){const r=t.StringLiteral[e];n.values.push(r.image.replace(/'|"/g,""))}}if(t.NumberLiteral){n.type="number";for(let e=0,r=t.NumberLiteral.length;e<r;e++){const r=t.NumberLiteral[e];n.values.push(parseFloat(r.image))}}if(t.HexLiteral){n.type="hex";for(let e=0,r=t.HexLiteral.length;e<r;e++){const r=t.HexLiteral[e];n.values.push(r.image)}}if(t.TrueLiteral){n.type="boolean";for(let e=0,r=t.TrueLiteral.length;e<r;e++){"TRUE"===t.TrueLiteral[e].image&&n.values.push(!0)}}if(t.FalseLiteral){n.type="boolean";for(let e=0,r=t.FalseLiteral.length;e<r;e++){"FALSE"===t.FalseLiteral[e].image&&n.values.push(!1)}}return t.NullLiteral&&(n.type="null",t.NullLiteral.forEach((function(){n.values.push(null)}))),n}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){const t={version:this.visit(e.version),nodes:[],routes:[]};for(let n=0,r=e.node.length;n<r;n++){const r=e.node[n];t.nodes.push(this.visit(r))}if(e.route)for(let n=0,r=e.route.length;n<r;n++){const r=e.route[n];t.routes.push(this.visit(r))}return t},version:function(e){return e.Version[0].image},node:function(e){const t={name:e.NodeName[0].image,fields:[]};if(e.field)for(let n=0,r=e.field.length;n<r;n++){const r=e.field[n];t.fields.push(this.visit(r))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){const t={name:e.Identifier[0].image,type:null,values:null};let n;return e.singleFieldValue&&(n=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(n=this.visit(e.multiFieldValue[0])),t.type=n.type,t.values=n.values,t},def:function(e){return(e.Identifier||e.NodeName)[0].image},use:function(e){return{USE:(e.Identifier||e.NodeName)[0].image}},singleFieldValue:function(e){return n(this,e)},multiFieldValue:function(e){return n(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(o.getBaseCstVisitorConstructor()),l=a.lex(e);o.input=l.tokens;const c=o.vrml();if(o.errors.length>0)throw console.error(o.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return s.visit(c)}(e))}}class t{constructor(e){this.lexer=new(i().Lexer)(e)}lex(e){const t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}}const n=i().CstParser;class r extends n{constructor(e){super(e);const t=this,n=e.Version,r=e.LCurly,i=e.RCurly,a=e.LSquare,o=e.RSquare,s=e.Identifier,l=e.RouteIdentifier,c=e.StringLiteral,u=e.HexLiteral,h=e.NumberLiteral,d=e.TrueLiteral,f=e.FalseLiteral,p=e.NullLiteral,m=e.DEF,g=e.USE,v=e.ROUTE,y=e.TO,_=e.NodeName;t.RULE("vrml",(function(){t.SUBRULE(t.version),t.AT_LEAST_ONE((function(){t.SUBRULE(t.node)})),t.MANY((function(){t.SUBRULE(t.route)}))})),t.RULE("version",(function(){t.CONSUME(n)})),t.RULE("node",(function(){t.OPTION((function(){t.SUBRULE(t.def)})),t.CONSUME(_),t.CONSUME(r),t.MANY((function(){t.SUBRULE(t.field)})),t.CONSUME(i)})),t.RULE("field",(function(){t.CONSUME(s),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])})),t.RULE("def",(function(){t.CONSUME(m),t.OR([{ALT:function(){t.CONSUME(s)}},{ALT:function(){t.CONSUME(_)}}])})),t.RULE("use",(function(){t.CONSUME(g),t.OR([{ALT:function(){t.CONSUME(s)}},{ALT:function(){t.CONSUME(_)}}])})),t.RULE("singleFieldValue",(function(){t.AT_LEAST_ONE((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(f)}},{ALT:function(){t.CONSUME(p)}}])}))})),t.RULE("multiFieldValue",(function(){t.CONSUME(a),t.MANY((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(p)}}])})),t.CONSUME(o)})),t.RULE("route",(function(){t.CONSUME(v),t.CONSUME(l),t.CONSUME(y),t.CONSUME2(l)})),this.performSelfAnalysis()}}class a{constructor(e,t,n){this.a=e,this.b=t,this.c=n,this.normal=new THREE.Vector3}}const o={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};THREE.VRMLLoader=e}()},507:(e,t,n)=>{"use strict";n.r(t);var r=n(743);!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){function t(e,t){const n=e.length,r=new Float32Array(n+t.length);return r.set(e),r.set(t,n),r}var n=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==n[0].indexOf("xml")?function(e){function n(e){var t,n,r,i,a,o,s="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],c=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=u.length;for(t=0;t<h;t++)l[t]=u[t];for(t=0;t<h;++t)c[u.charCodeAt(t)]=t;if(c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63,(h=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=new s(3*h/4-(a="="===e[h-2]?2:"="===e[h-1]?1:0)),r=a>0?h-4:h;var d=0;for(t=0,n=0;t<r;t+=4,n+=3)i=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],o[d++]=(16711680&i)>>16,o[d++]=(65280&i)>>8,o[d++]=255&i;return 2===a?(i=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,o[d++]=255&i):1===a&&(i=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,o[d++]=i>>8&255,o[d++]=255&i),o}function i(e,i){var a,s,l,c,u=0;if("UInt64"===o.attributes.header_type?u=8:"UInt32"===o.attributes.header_type&&(u=4),"binary"===e.attributes.format&&i){var h,d,f,p,m,g;if("Float32"===e.attributes.type)var v=new Float32Array;else"Int64"===e.attributes.type&&(v=new Int32Array);d=(h=n(e["#text"]))[0];for(var y=1;y<u-1;y++)d|=h[y]<<y*u;for(p=(d+3)*u,g=p+=p%3>0?3-p%3:0,(m=[]).push(g),f=3*u,y=0;y<d;y++){for(var _=h[y*u+f],b=1;b<u-1;b++)_|=h[y*u+f+b]<<8*b;g+=_,m.push(g)}for(y=0;y<m.length-1;y++)E=r.unzlibSync(h.slice(m[y],m[y+1])).buffer,"Float32"===e.attributes.type?v=t(v,E=new Float32Array(E)):"Int64"===e.attributes.type&&(s=E=new Int32Array(E),l=void 0,c=void 0,l=(a=v).length,(c=new Int32Array(l+s.length)).set(a),c.set(s,l),v=c);delete e["#text"],"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(v=v.filter((function(e,t){if(t%2!=1)return!0})))}else{if("binary"!==e.attributes.format||i)if(e["#text"])var E=e["#text"].split(/\s+/).filter((function(e){if(""!==e)return e}));else E=new Int32Array(0).buffer;else E=(E=n(e["#text"])).slice(u).buffer;delete e["#text"],"Float32"===e.attributes.type?v=new Float32Array(E):"Int32"===e.attributes.type?v=new Int32Array(E):"Int64"===e.attributes.type&&(v=new Int32Array(E),"binary"===e.attributes.format&&(v=v.filter((function(e,t){if(t%2!=1)return!0}))))}return v}var a=null;if(window.DOMParser)try{a=(new DOMParser).parseFromString(e,"text/xml")}catch(e){a=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((a=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!a.loadXML())throw new Error(a.parseError.reason+a.parseError.srcText)}catch(e){a=null}}var o=function e(t){var n={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){n.attributes={};for(var r=0;r<t.attributes.length;r++){var i=t.attributes.item(r);n.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===t.nodeType&&(n=t.nodeValue.trim());if(t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++){var o=t.childNodes.item(a),s=o.nodeName;if(void 0===n[s])""!==(c=e(o))&&(n[s]=c);else{if(void 0===n[s].push){var l=n[s];n[s]=[l]}var c;""!==(c=e(o))&&n[s].push(c)}}return n}(a.documentElement),s=[],l=[],c=[];if(o.PolyData){for(var u=o.PolyData.Piece,h=o.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],f=0,p=d.length;f<p;){var m=u[d[f]];if(m&&m.DataArray){if("[object Array]"===Object.prototype.toString.call(m.DataArray))var g=m.DataArray;else g=[m.DataArray];for(var v=0,y=g.length;v<y;)"#text"in g[v]&&g[v]["#text"].length>0&&(g[v].text=i(g[v],h)),v++;switch(d[f]){case"PointData":var _=parseInt(u.attributes.NumberOfPoints),b=m.attributes.Normals;if(_>0)for(var E=0,w=g.length;E<w;E++)if(b===g[E].attributes.Name){var x=g[E].attributes.NumberOfComponents;(l=new Float32Array(_*x)).set(g[E].text,0)}break;case"Points":(_=parseInt(u.attributes.NumberOfPoints))>0&&(x=m.DataArray.attributes.NumberOfComponents,(s=new Float32Array(_*x)).set(m.DataArray.text,0));break;case"Strips":var T=parseInt(u.attributes.NumberOfStrips);if(T>0){var A=new Int32Array(m.DataArray[0].text.length),M=new Int32Array(m.DataArray[1].text.length);A.set(m.DataArray[0].text,0),M.set(m.DataArray[1].text,0);var S=T+A.length;c=new Uint32Array(3*S-9*T);var R=0;for(E=0,w=T;E<w;E++){for(var k=[],P=0,L=M[E],C=0;P<L-C;P++)k.push(A[P]),E>0&&(C=M[E-1]);var I=0;for(L=M[E],C=0;I<L-C-2;I++)I%2?(c[R++]=k[I],c[R++]=k[I+2],c[R++]=k[I+1]):(c[R++]=k[I],c[R++]=k[I+1],c[R++]=k[I+2]),E>0&&(C=M[E-1])}}break;case"Polys":var N=parseInt(u.attributes.NumberOfPolys);if(N>0){A=new Int32Array(m.DataArray[0].text.length),M=new Int32Array(m.DataArray[1].text.length),A.set(m.DataArray[0].text,0),M.set(m.DataArray[1].text,0),S=N+A.length,c=new Uint32Array(3*S-9*N),R=0;var F=0;for(E=0,w=N,C=0;E<w;){var O=[];for(P=0,L=M[E];P<L-C;)O.push(A[F++]),P++;for(I=1;I<L-C-1;)c[R++]=O[0],c[R++]=O[I],c[R++]=O[I+1],I++;C=M[++E-1]}}}}f++}var H=new THREE.BufferGeometry;return H.setIndex(new THREE.BufferAttribute(c,1)),H.setAttribute("position",new THREE.BufferAttribute(s,3)),l.length===s.length&&H.setAttribute("normal",new THREE.BufferAttribute(l,3)),H}throw new Error("Unsupported DATASET type")}(THREE.LoaderUtils.decodeText(e)):n[2].includes("ASCII")?function(e){for(var t,n=[],r=[],i=[],a=[],o=/^[^\d.\s-]+/,s=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,c=/^POINTS /,u=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,f=/^CELL_DATA[ ]+(\d+)/,p=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,g=!1,v=!1,y=!1,_=!1,b=!1,E=!1,w=!1,x=e.split("\n"),T=0,A=x.length;T<A;T++){var M=x[T].trim();if(0===M.indexOf("DATASET")){var S=M.split(" ")[1];if("POLYDATA"!==S)throw new Error("Unsupported DATASET type: "+S)}else if(g)for(;null!==(t=s.exec(M))&&null===o.exec(M);){var R=parseFloat(t[1]),k=parseFloat(t[2]),P=parseFloat(t[3]);r.push(R,k,P)}else if(v){if(null!==(t=l.exec(M))){var L=parseInt(t[1]),C=t[2].split(/\s+/);if(L>=3)for(var I=parseInt(C[0]),N=1,F=0;F<L-2;++F)O=parseInt(C[N]),H=parseInt(C[N+1]),n.push(I,O,H),N++}}else if(y){if(null!==(t=l.exec(M))){var O,H;if(L=parseInt(t[1]),C=t[2].split(/\s+/),L>=3)for(F=0;F<L-2;F++)F%2==1?(I=parseInt(C[F]),O=parseInt(C[F+2]),H=parseInt(C[F+1]),n.push(I,O,H)):(I=parseInt(C[F]),O=parseInt(C[F+1]),H=parseInt(C[F+2]),n.push(I,O,H))}}else if(_||b)if(E)for(;null!==(t=s.exec(M))&&null===o.exec(M);){var D=parseFloat(t[1]),U=parseFloat(t[2]),B=parseFloat(t[3]);i.push(D,U,B)}else if(w)for(;null!==(t=s.exec(M))&&null===o.exec(M);){var z=parseFloat(t[1]),V=parseFloat(t[2]),j=parseFloat(t[3]);a.push(z,V,j)}null!==u.exec(M)?(v=!0,g=!1,y=!1):null!==c.exec(M)?(v=!1,g=!0,y=!1):null!==h.exec(M)?(v=!1,g=!1,y=!0):null!==d.exec(M)?(_=!0,g=!1,v=!1,y=!1):null!==f.exec(M)?(b=!0,g=!1,v=!1,y=!1):null!==p.exec(M)?(E=!0,w=!1,g=!1,v=!1,y=!1):null!==m.exec(M)&&(w=!0,E=!1,g=!1,v=!1,y=!1)}var G=new THREE.BufferGeometry;if(G.setIndex(n),G.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),a.length===r.length&&G.setAttribute("normal",new THREE.Float32BufferAttribute(a,3)),i.length!==n.length)i.length===r.length&&G.setAttribute("color",new THREE.Float32BufferAttribute(i,3));else{var W=(G=G.toNonIndexed()).attributes.position.count/3;if(i.length===3*W){var q=[];for(T=0;T<W;T++)D=i[3*T+0],U=i[3*T+1],B=i[3*T+2],q.push(D,U,B),q.push(D,U,B),q.push(D,U,B);G.setAttribute("color",new THREE.Float32BufferAttribute(q,3))}}return G}(THREE.LoaderUtils.decodeText(e)):function(e){var t,n,r,i,a,o,s,l=new Uint8Array(e),c=new DataView(e),u=[],h=[],d=[],f=[],p=0;function m(e,t){for(var n=t,r=e[n],i=[];10!==r;)i.push(String.fromCharCode(r)),r=e[++n];return{start:t,end:n,next:n+1,parsedString:i.join("")}}for(;;){if(0===(s=(o=m(l,p)).parsedString).indexOf("DATASET")){var g=s.split(" ")[1];if("POLYDATA"!==g)throw new Error("Unsupported DATASET type: "+g)}else if(0===s.indexOf("POINTS")){for(f.push(s),t=4*(i=parseInt(s.split(" ")[1],10))*3,u=new Float32Array(3*i),n=o.next,r=0;r<i;r++)u[3*r]=c.getFloat32(n,!1),u[3*r+1]=c.getFloat32(n+4,!1),u[3*r+2]=c.getFloat32(n+8,!1),n+=12;o.next=o.next+t+1}else if(0===s.indexOf("TRIANGLE_STRIPS")){var v=parseInt(s.split(" ")[1],10);t=4*(w=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*w-9*v);var y=0;for(n=o.next,r=0;r<v;r++){var _=c.getInt32(n,!1),b=[];for(n+=4,a=0;a<_;a++)b.push(c.getInt32(n,!1)),n+=4;for(var E=0;E<_-2;E++)E%2?(d[y++]=b[E],d[y++]=b[E+2],d[y++]=b[E+1]):(d[y++]=b[E],d[y++]=b[E+1],d[y++]=b[E+2])}o.next=o.next+t+1}else if(0===s.indexOf("POLYGONS")){var w;for(v=parseInt(s.split(" ")[1],10),t=4*(w=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*w-9*v),y=0,n=o.next,r=0;r<v;r++){for(_=c.getInt32(n,!1),b=[],n+=4,a=0;a<_;a++)b.push(c.getInt32(n,!1)),n+=4;for(E=1;E<_-1;E++)d[y++]=b[0],d[y++]=b[E],d[y++]=b[E+1]}o.next=o.next+t+1}else if(0===s.indexOf("POINT_DATA")){for(i=parseInt(s.split(" ")[1],10),o=m(l,o.next),t=4*i*3,h=new Float32Array(3*i),n=o.next,r=0;r<i;r++)h[3*r]=c.getFloat32(n,!1),h[3*r+1]=c.getFloat32(n+4,!1),h[3*r+2]=c.getFloat32(n+8,!1),n+=12;o.next=o.next+t}if((p=o.next)>=l.byteLength)break}var x=new THREE.BufferGeometry;return x.setIndex(new THREE.BufferAttribute(d,1)),x.setAttribute("position",new THREE.BufferAttribute(u,3)),h.length===u.length&&x.setAttribute("normal",new THREE.BufferAttribute(h,3)),x}(e)}}THREE.VTKLoader=e}()},9127:()=>{!function(){const e={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float offset;\n\t\tuniform float darkness;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t// Eskil's vignette\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n\t\t\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n\t\t}"};THREE.VignetteShader=e}()},5144:()=>{var e;(e=function(e,t,n,r,i){if(arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(n)||1,r){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(i);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(i);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(i);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(i);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(i);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(i);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(i);break;case"Float64":case"float64":case"double":this.data=new Float64Array(i);break;default:this.data=new Uint8Array(i)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new THREE.Matrix3,this.matrix.identity();var a=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return a},set:function(e){a=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}});var o=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}}),this.sliceList=[]}).prototype={constructor:e,getData:function(e,t,n){return this.data[n*this.xLength*this.yLength+t*this.xLength+e]},access:function(e,t,n){return n*this.xLength*this.yLength+t*this.xLength+e},reverseAccess:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),n=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-n*this.xLength,n,t]},map:function(e,t){var n=this.data.length;t=t||this;for(var r=0;r<n;r++)this.data[r]=e.call(t,this.data[r],r,this.data);return this},extractPerpendicularPlane:function(e,t){var n,r,i,a,o,s,l,c,u=(new THREE.Matrix4).identity(),h=this,d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3(this.xLength,this.yLength,this.zLength);switch(e){case"x":d.set(1,0,0),f.set(0,0,-1),p.set(0,-1,0),o=this.spacing[2],s=this.spacing[1],c=new THREE.Vector3(t,0,0),u.multiply((new THREE.Matrix4).makeRotationY(Math.PI/2)),l=(h.RASDimensions[0]-1)/2,u.setPosition(new THREE.Vector3(t-l,0,0));break;case"y":d.set(0,1,0),f.set(1,0,0),p.set(0,0,1),o=this.spacing[0],s=this.spacing[2],c=new THREE.Vector3(0,t,0),u.multiply((new THREE.Matrix4).makeRotationX(-Math.PI/2)),l=(h.RASDimensions[1]-1)/2,u.setPosition(new THREE.Vector3(0,t-l,0));break;case"z":default:d.set(0,0,1),f.set(1,0,0),p.set(0,-1,0),o=this.spacing[0],s=this.spacing[1],c=new THREE.Vector3(0,0,t),l=(h.RASDimensions[2]-1)/2,u.setPosition(new THREE.Vector3(0,0,t-l))}f.applyMatrix4(h.inverseMatrix).normalize(),f.argVar="i",p.applyMatrix4(h.inverseMatrix).normalize(),p.argVar="j",d.applyMatrix4(h.inverseMatrix).normalize(),n=Math.floor(Math.abs(f.dot(m))),r=Math.floor(Math.abs(p.dot(m))),i=Math.abs(n*o),a=Math.abs(r*s),c=Math.abs(Math.round(c.applyMatrix4(h.inverseMatrix).dot(d)));var g=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],v=[f,p,d].find((function(e){return Math.abs(e.dot(g[0]))>.9})),y=[f,p,d].find((function(e){return Math.abs(e.dot(g[1]))>.9})),_=[f,p,d].find((function(e){return Math.abs(e.dot(g[2]))>.9}));return{iLength:n,jLength:r,sliceAccess:function(e,t){var n=v===d?c:"i"===v.argVar?e:t,r=y===d?c:"i"===y.argVar?e:t,i=_===d?c:"i"===_.argVar?e:t,a=v.dot(g[0])>0?n:h.xLength-1-n,o=y.dot(g[1])>0?r:h.yLength-1-r,s=_.dot(g[2])>0?i:h.zLength-1-i;return h.access(a,o,s)},matrix:u,planeWidth:i,planeHeight:a}},extractSlice:function(e,t){var n=new THREE.VolumeSlice(this,t,e);return this.sliceList.push(n),n},repaintAllSlices:function(){return this.sliceList.forEach((function(e){e.repaint()})),this},computeMinMax:function(){var e=1/0,t=-1/0,n=this.data.length,r=0;for(r=0;r<n;r++)if(!isNaN(this.data[r])){var i=this.data[r];e=Math.min(e,i),t=Math.max(t,i)}return this.min=e,this.max=t,[e,t]}},THREE.Volume=e},1362:()=>{!function(){const e={uniforms:{u_size:{value:new THREE.Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new THREE.Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:'\n\n\t\tvarying vec4 v_nearpos;\n\t\tvarying vec4 v_farpos;\n\t\tvarying vec3 v_position;\n\n\t\tvoid main() {\n\t\t\t\t// Prepare transforms to map to "camera view". See also:\n\t\t\t\t// https://threejs.org/docs/#api/renderers/webgl/WebGLProgram\n\t\t\t\tmat4 viewtransformf = modelViewMatrix;\n\t\t\t\tmat4 viewtransformi = inverse(modelViewMatrix);\n\n\t\t\t\t// Project local vertex coordinate to camera position. Then do a step\n\t\t\t\t// backward (in cam coords) to the near clipping plane, and project back. Do\n\t\t\t\t// the same for the far clipping plane. This gives us all the information we\n\t\t\t\t// need to calculate the ray and truncate it to the viewing cone.\n\t\t\t\tvec4 position4 = vec4(position, 1.0);\n\t\t\t\tvec4 pos_in_cam = viewtransformf * position4;\n\n\t\t\t\t// Intersection of ray and near clipping plane (z = -1 in clip coords)\n\t\t\t\tpos_in_cam.z = -pos_in_cam.w;\n\t\t\t\tv_nearpos = viewtransformi * pos_in_cam;\n\n\t\t\t\t// Intersection of ray and far clipping plane (z = +1 in clip coords)\n\t\t\t\tpos_in_cam.z = pos_in_cam.w;\n\t\t\t\tv_farpos = viewtransformi * pos_in_cam;\n\n\t\t\t\t// Set varyings and output pos\n\t\t\t\tv_position = position;\n\t\t\t\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;\n\t\t}',fragmentShader:"\n\n\t\t\t\tprecision highp float;\n\t\t\t\tprecision mediump sampler3D;\n\n\t\t\t\tuniform vec3 u_size;\n\t\t\t\tuniform int u_renderstyle;\n\t\t\t\tuniform float u_renderthreshold;\n\t\t\t\tuniform vec2 u_clim;\n\n\t\t\t\tuniform sampler3D u_data;\n\t\t\t\tuniform sampler2D u_cmdata;\n\n\t\t\t\tvarying vec3 v_position;\n\t\t\t\tvarying vec4 v_nearpos;\n\t\t\t\tvarying vec4 v_farpos;\n\n\t\t\t\t// The maximum distance through our rendering volume is sqrt(3).\n\t\t\t\tconst int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3\n\t\t\t\tconst int REFINEMENT_STEPS = 4;\n\t\t\t\tconst float relative_step_size = 1.0;\n\t\t\t\tconst vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);\n\t\t\t\tconst vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);\n\t\t\t\tconst vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);\n\t\t\t\tconst float shininess = 40.0;\n\n\t\t\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n\t\t\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n\n\t\t\t\tfloat sample1(vec3 texcoords);\n\t\t\t\tvec4 apply_colormap(float val);\n\t\t\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);\n\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\t// Normalize clipping plane info\n\t\t\t\t\t\tvec3 farpos = v_farpos.xyz / v_farpos.w;\n\t\t\t\t\t\tvec3 nearpos = v_nearpos.xyz / v_nearpos.w;\n\n\t\t\t\t\t\t// Calculate unit vector pointing in the view direction through this fragment.\n\t\t\t\t\t\tvec3 view_ray = normalize(nearpos.xyz - farpos.xyz);\n\n\t\t\t\t\t\t// Compute the (negative) distance to the front surface or near clipping plane.\n\t\t\t\t\t\t// v_position is the back face of the cuboid, so the initial distance calculated in the dot\n\t\t\t\t\t\t// product below is the distance from near clip plane to the back of the cuboid\n\t\t\t\t\t\tfloat distance = dot(nearpos - v_position, view_ray);\n\t\t\t\t\t\tdistance = max(distance, min((-0.5 - v_position.x) / view_ray.x,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.x - 0.5 - v_position.x) / view_ray.x));\n\t\t\t\t\t\tdistance = max(distance, min((-0.5 - v_position.y) / view_ray.y,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.y - 0.5 - v_position.y) / view_ray.y));\n\t\t\t\t\t\tdistance = max(distance, min((-0.5 - v_position.z) / view_ray.z,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.z - 0.5 - v_position.z) / view_ray.z));\n\n\t\t\t\t\t\t// Now we have the starting position on the front surface\n\t\t\t\t\t\tvec3 front = v_position + view_ray * distance;\n\n\t\t\t\t\t\t// Decide how many steps to take\n\t\t\t\t\t\tint nsteps = int(-distance / relative_step_size + 0.5);\n\t\t\t\t\t\tif ( nsteps < 1 )\n\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t// Get starting location and step vector in texture coordinates\n\t\t\t\t\t\tvec3 step = ((v_position - front) / u_size) / float(nsteps);\n\t\t\t\t\t\tvec3 start_loc = front / u_size;\n\n\t\t\t\t\t\t// For testing: show the number of steps. This helps to establish\n\t\t\t\t\t\t// whether the rays are correctly oriented\n\t\t\t\t\t\t//'gl_FragColor = vec4(0.0, float(nsteps) / 1.0 / u_size.x, 1.0, 1.0);\n\t\t\t\t\t\t//'return;\n\n\t\t\t\t\t\tif (u_renderstyle == 0)\n\t\t\t\t\t\t\t\tcast_mip(start_loc, step, nsteps, view_ray);\n\t\t\t\t\t\telse if (u_renderstyle == 1)\n\t\t\t\t\t\t\t\tcast_iso(start_loc, step, nsteps, view_ray);\n\n\t\t\t\t\t\tif (gl_FragColor.a < 0.05)\n\t\t\t\t\t\t\t\tdiscard;\n\t\t\t\t}\n\n\n\t\t\t\tfloat sample1(vec3 texcoords) {\n\t\t\t\t\t\t/* Sample float value from a 3D texture. Assumes intensity data. */\n\t\t\t\t\t\treturn texture(u_data, texcoords.xyz).r;\n\t\t\t\t}\n\n\n\t\t\t\tvec4 apply_colormap(float val) {\n\t\t\t\t\t\tval = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);\n\t\t\t\t\t\treturn texture2D(u_cmdata, vec2(val, 0.5));\n\t\t\t\t}\n\n\n\t\t\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n\t\t\t\t\t\tfloat max_val = -1e6;\n\t\t\t\t\t\tint max_i = 100;\n\t\t\t\t\t\tvec3 loc = start_loc;\n\n\t\t\t\t\t\t// Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n\t\t\t\t\t\t// non-constant expression. So we use a hard-coded max, and an additional condition\n\t\t\t\t\t\t// inside the loop.\n\t\t\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {\n\t\t\t\t\t\t\t\tif (iter >= nsteps)\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t// Sample from the 3D texture\n\t\t\t\t\t\t\t\tfloat val = sample1(loc);\n\t\t\t\t\t\t\t\t// Apply MIP operation\n\t\t\t\t\t\t\t\tif (val > max_val) {\n\t\t\t\t\t\t\t\t\t\tmax_val = val;\n\t\t\t\t\t\t\t\t\t\tmax_i = iter;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Advance location deeper into the volume\n\t\t\t\t\t\t\t\tloc += step;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Refine location, gives crispier images\n\t\t\t\t\t\tvec3 iloc = start_loc + step * (float(max_i) - 0.5);\n\t\t\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);\n\t\t\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {\n\t\t\t\t\t\t\t\tmax_val = max(max_val, sample1(iloc));\n\t\t\t\t\t\t\t\tiloc += istep;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Resolve final color\n\t\t\t\t\t\tgl_FragColor = apply_colormap(max_val);\n\t\t\t\t}\n\n\n\t\t\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n\t\t\t\t\t\tgl_FragColor = vec4(0.0);\t// init transparent\n\t\t\t\t\t\tvec4 color3 = vec4(0.0);\t// final color\n\t\t\t\t\t\tvec3 dstep = 1.5 / u_size;\t// step to sample derivative\n\t\t\t\t\t\tvec3 loc = start_loc;\n\n\t\t\t\t\t\tfloat low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);\n\n\t\t\t\t\t\t// Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n\t\t\t\t\t\t// non-constant expression. So we use a hard-coded max, and an additional condition\n\t\t\t\t\t\t// inside the loop.\n\t\t\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {\n\t\t\t\t\t\t\t\tif (iter >= nsteps)\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t// Sample from the 3D texture\n\t\t\t\t\t\t\t\tfloat val = sample1(loc);\n\n\t\t\t\t\t\t\t\tif (val > low_threshold) {\n\t\t\t\t\t\t\t\t\t\t// Take the last interval in smaller steps\n\t\t\t\t\t\t\t\t\t\tvec3 iloc = loc - 0.5 * step;\n\t\t\t\t\t\t\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);\n\t\t\t\t\t\t\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\tval = sample1(iloc);\n\t\t\t\t\t\t\t\t\t\t\t\tif (val > u_renderthreshold) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = add_lighting(val, iloc, dstep, view_ray);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tiloc += istep;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Advance location deeper into the volume\n\t\t\t\t\t\t\t\tloc += step;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\n\t\t\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)\n\t\t\t\t{\n\t\t\t\t\t// Calculate color by incorporating lighting\n\n\t\t\t\t\t\t// View direction\n\t\t\t\t\t\tvec3 V = normalize(view_ray);\n\n\t\t\t\t\t\t// calculate normal vector from gradient\n\t\t\t\t\t\tvec3 N;\n\t\t\t\t\t\tfloat val1, val2;\n\t\t\t\t\t\tval1 = sample1(loc + vec3(-step[0], 0.0, 0.0));\n\t\t\t\t\t\tval2 = sample1(loc + vec3(+step[0], 0.0, 0.0));\n\t\t\t\t\t\tN[0] = val1 - val2;\n\t\t\t\t\t\tval = max(max(val1, val2), val);\n\t\t\t\t\t\tval1 = sample1(loc + vec3(0.0, -step[1], 0.0));\n\t\t\t\t\t\tval2 = sample1(loc + vec3(0.0, +step[1], 0.0));\n\t\t\t\t\t\tN[1] = val1 - val2;\n\t\t\t\t\t\tval = max(max(val1, val2), val);\n\t\t\t\t\t\tval1 = sample1(loc + vec3(0.0, 0.0, -step[2]));\n\t\t\t\t\t\tval2 = sample1(loc + vec3(0.0, 0.0, +step[2]));\n\t\t\t\t\t\tN[2] = val1 - val2;\n\t\t\t\t\t\tval = max(max(val1, val2), val);\n\n\t\t\t\t\t\tfloat gm = length(N); // gradient magnitude\n\t\t\t\t\t\tN = normalize(N);\n\n\t\t\t\t\t\t// Flip normal so it points towards viewer\n\t\t\t\t\t\tfloat Nselect = float(dot(N, V) > 0.0);\n\t\t\t\t\t\tN = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;\n\n\t\t\t\t\t\t// Init colors\n\t\t\t\t\t\tvec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);\n\t\t\t\t\t\tvec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);\n\t\t\t\t\t\tvec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);\n\n\t\t\t\t\t\t// note: could allow multiple lights\n\t\t\t\t\t\tfor (int i=0; i<1; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t // Get light direction (make sure to prevent zero devision)\n\t\t\t\t\t\t\t\tvec3 L = normalize(view_ray);\t//lightDirs[i];\n\t\t\t\t\t\t\t\tfloat lightEnabled = float( length(L) > 0.0 );\n\t\t\t\t\t\t\t\tL = normalize(L + (1.0 - lightEnabled));\n\n\t\t\t\t\t\t\t\t// Calculate lighting properties\n\t\t\t\t\t\t\t\tfloat lambertTerm = clamp(dot(N, L), 0.0, 1.0);\n\t\t\t\t\t\t\t\tvec3 H = normalize(L+V); // Halfway vector\n\t\t\t\t\t\t\t\tfloat specularTerm = pow(max(dot(H, N), 0.0), shininess);\n\n\t\t\t\t\t\t\t\t// Calculate mask\n\t\t\t\t\t\t\t\tfloat mask1 = lightEnabled;\n\n\t\t\t\t\t\t\t\t// Calculate colors\n\t\t\t\t\t\t\t\tambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;\n\t\t\t\t\t\t\t\tdiffuse_color +=\tmask1 * lambertTerm;\n\t\t\t\t\t\t\t\tspecular_color += mask1 * specularTerm * specular_color;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Calculate final color by componing different components\n\t\t\t\t\t\tvec4 final_color;\n\t\t\t\t\t\tvec4 color = apply_colormap(val);\n\t\t\t\t\t\tfinal_color = color * (ambient_color + diffuse_color) + specular_color;\n\t\t\t\t\t\tfinal_color.a = color.a;\n\t\t\t\t\t\treturn final_color;\n\t\t\t\t}"};THREE.VolumeRenderShader1=e}()},8:()=>{var e;(e=function(e,t,n){var r=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,r.geometryNeedsUpdate=!0,t}}),this.axis=n||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new THREE.Texture(this.canvas);i.minFilter=THREE.LinearFilter,i.wrapS=i.wrapT=THREE.ClampToEdgeWrapping;var a=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide,transparent:!0});this.mesh=new THREE.Mesh(this.geometry,a),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()}).prototype={constructor:e,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,n=this.sliceAccess,r=this.volume,i=this.canvasBuffer,a=this.ctxBuffer,o=a.getImageData(0,0,e,t),s=o.data,l=r.data,c=r.upperThreshold,u=r.lowerThreshold,h=r.windowLow,d=r.windowHigh,f=0;if("label"===r.dataType)for(var p=0;p<t;p++)for(var m=0;m<e;m++){var g=l[n(m,p)];g=g>=this.colorMap.length?g%this.colorMap.length+1:g;var v=this.colorMap[g];s[4*f]=v>>24&255,s[4*f+1]=v>>16&255,s[4*f+2]=v>>8&255,s[4*f+3]=255&v,f++}else for(p=0;p<t;p++)for(m=0;m<e;m++){var y=l[n(m,p)],_=255;_=c>=y&&u<=y?_:0,y=(y=Math.floor(255*(y-h)/(d-h)))>255?255:y<0?0:0|y,s[4*f]=y,s[4*f+1]=y,s[4*f+2]=y,s[4*f+3]=_,f++}a.putImageData(o,0,0),this.ctx.drawImage(i,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new THREE.PlaneGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}},THREE.VolumeSlice=e},3946:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t,n){"use strict";function r(e){return e&&0===e.length}function i(e){return null==e?[]:Object.keys(e)}function a(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++)t.push(e[n[r]]);return t}function o(e,t){for(var n=[],r=i(e),a=0;a<r.length;a++){var o=r[a];n.push(t.call(null,e[o],o))}return n}function s(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t.call(null,e[r],r));return n}function l(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?t=t.concat(l(r)):t.push(r)}return t}function c(e){return r(e)?void 0:e[0]}function u(e){var t=e&&e.length;return t?e[t-1]:void 0}function h(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t.call(null,e[n],n);else{if(!C(e))throw Error("non exhaustive match");var r=i(e);for(n=0;n<r.length;n++){var a=r[n],o=e[a];t.call(null,o,a)}}}function d(e){return"string"==typeof e}function f(e){return void 0===e}function p(e){return e instanceof Function}function m(e,t){return void 0===t&&(t=1),e.slice(t,e.length)}function g(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)}function v(e,t){var n=[];if(Array.isArray(e))for(var r=0;r<e.length;r++){var i=e[r];t.call(null,i)&&n.push(i)}return n}function y(e,t){return v(e,(function(e){return!t(e)}))}function _(e,t){for(var n=Object.keys(e),r={},i=0;i<n.length;i++){var a=n[i],o=e[a];t(o)&&(r[a]=o)}return r}function b(e,t){return!!C(e)&&e.hasOwnProperty(t)}function E(e,t){return void 0!==T(e,(function(e){return e===t}))}function w(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}function x(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function T(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t.call(null,r))return r}}function A(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];t.call(null,i)&&n.push(i)}return n}function M(e,t,n){for(var r=Array.isArray(e),o=r?e:a(e),s=r?[]:i(e),l=n,c=0;c<o.length;c++)l=t.call(null,l,o[c],r?c:s[c]);return l}function S(e){return y(e,(function(e){return null==e}))}function R(e,t){void 0===t&&(t=function(e){return e});var n=[];return M(e,(function(e,r){var i=t(r);return E(n,i)?e:(n.push(i),e.concat(r))}),[])}function k(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=[null].concat(t);return Function.bind.apply(e,r)}function P(e){return Array.isArray(e)}function L(e){return e instanceof RegExp}function C(e){return e instanceof Object}function I(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function N(e,t){return y(e,(function(e){return E(t,e)}))}function F(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function O(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function H(e,t){var n=w(e);return n.sort((function(e,n){return t(e)-t(n)})),n}function D(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var n={},r=0;r<e.length;r++)n[e[r]]=t[r];return n}function U(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++)for(var a=t[r],o=i(a),s=0;s<o.length;s++){var l=o[s];e[l]=a[l]}return e}function B(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++){var a=t[r];if(!f(a))for(var o=i(a),s=0;s<o.length;s++){var l=o[s];b(e,l)||(e[l]=a[l])}}return e}function z(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return B.apply(null,[{}].concat(e))}function V(e,t){var n={};return h(e,(function(e){var r=t(e),i=n[r];i?i.push(e):n[r]=[e]})),n}function j(e,t){for(var n=x(e),r=i(t),a=0;a<r.length;a++){var o=r[a],s=t[o];n[o]=s}return n}function G(){}function W(e){return e}function q(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(void 0!==r?r:void 0)}return t}function X(e){console&&console.error&&console.error("Error: "+e)}function Y(e){console&&console.warn&&console.warn("Warning: "+e)}function K(){return"function"==typeof Map}function Z(e,t){t.forEach((function(t){var n=t.prototype;Object.getOwnPropertyNames(n).forEach((function(r){if("constructor"!==r){var i=Object.getOwnPropertyDescriptor(n,r);i&&(i.get||i.set)?Object.defineProperty(e.prototype,r,i):e.prototype[r]=t.prototype[r]}}))}))}function Q(e){function t(){}t.prototype=e;var n=new t;function r(){return typeof n.bar}return r(),r(),e}Object.defineProperty(t,"__esModule",{value:!0}),t.isEmpty=r,t.keys=i,t.values=a,t.mapValues=o,t.map=s,t.flatten=l,t.first=c,t.last=u,t.forEach=h,t.isString=d,t.isUndefined=f,t.isFunction=p,t.drop=m,t.dropRight=g,t.filter=v,t.reject=y,t.pick=_,t.has=b,t.contains=E,t.cloneArr=w,t.cloneObj=x,t.find=T,t.findAll=A,t.reduce=M,t.compact=S,t.uniq=R,t.partial=k,t.isArray=P,t.isRegExp=L,t.isObject=C,t.every=I,t.difference=N,t.some=F,t.indexOf=O,t.sortBy=H,t.zipObject=D,t.assign=U,t.assignNoOverwrite=B,t.defaults=z,t.groupBy=V,t.merge=j,t.NOOP=G,t.IDENTITY=W,t.packArray=q,t.PRINT_ERROR=X,t.PRINT_WARNING=Y,t.isES2015MapSupported=K,t.applyMixins=Z,t.toFastProperties=Q},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),s=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),a.forEach(this.definition,(function(t){t.accept(e)}))},e}();t.AbstractProduction=s;var l=function(e){function t(t){var n=e.call(this,[])||this;return n.idx=1,a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(s);t.NonTerminal=l;var c=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.orgText="",a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.Rule=c;var u=function(e){function t(t){var n=e.call(this,t.definition)||this;return a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.Flat=u;var h=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.Option=h;var d=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.RepetitionMandatory=d;var f=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.RepetitionMandatoryWithSeparator=f;var p=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.Repetition=p;var m=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.RepetitionWithSeparator=m;var g=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,a.assign(n,a.pick(t,(function(e){return void 0!==e}))),n}return i(t,e),t}(s);t.Alternation=g;var v=function(){function e(e){this.idx=1,a.assign(this,a.pick(e,(function(e){return void 0!==e})))}return e.prototype.accept=function(e){e.visit(this)},e}();function y(e){function t(e){return a.map(e,y)}if(e instanceof l)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof u)return{type:"Flat",definition:t(e.definition)};if(e instanceof h)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof d)return{type:"RepetitionMandatory",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof f)return{type:"RepetitionMandatoryWithSeparator",name:e.name,idx:e.idx,separator:y(new v({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof m)return{type:"RepetitionWithSeparator",name:e.name,idx:e.idx,separator:y(new v({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof p)return{type:"Repetition",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof g)return{type:"Alternation",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof v){var n={type:"Terminal",name:o.tokenName(e.terminalType),label:o.tokenLabel(e.terminalType),idx:e.idx},r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=a.isRegExp(r)?r.source:r),n}if(e instanceof c)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}t.Terminal=v,t.serializeGrammar=function(e){return a.map(e,y)},t.serializeProduction=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(4),a=n(15),o=n(7);function s(e){return r.isString(e.LABEL)&&""!==e.LABEL}function l(e){return r.isObject(e)&&e.hasOwnProperty("tokenName")&&r.isString(e.tokenName)?e.tokenName:i.functionName(e)}t.tokenLabel=function(e){return s(e)?e.LABEL:l(e)},t.hasTokenLabel=s,t.tokenName=l;var c="parent",u="categories",h="label",d="group",f="push_mode",p="pop_mode",m="longer_alt",g="line_breaks",v="start_chars_hint";function y(e){return function(e){var t=e.name,n=e.pattern,a={};if(i.defineNameProp(a,t)||(a.tokenName=t),r.isUndefined(n)||(a.PATTERN=n),r.has(e,c))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return r.has(e,u)&&(a.CATEGORIES=e[u]),o.augmentTokenTypes([a]),r.has(e,h)&&(a.LABEL=e[h]),r.has(e,d)&&(a.GROUP=e[d]),r.has(e,p)&&(a.POP_MODE=e[p]),r.has(e,f)&&(a.PUSH_MODE=e[f]),r.has(e,m)&&(a.LONGER_ALT=e[m]),r.has(e,g)&&(a.LINE_BREAKS=e[g]),r.has(e,v)&&(a.START_CHARS_HINT=e[v]),a}(e)}t.createToken=y,t.EOF=y({name:"EOF",pattern:a.Lexer.NA}),o.augmentTokenTypes([t.EOF]),t.createTokenInstance=function(e,t,n,r,i,a,o,s){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return o.tokenStructuredMatcher(e,t)}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=n(0),s=n(26),l=n(2),c=n(23),u=n(16),h=n(10),d=n(24),f=n(25),p=n(31),m=n(32),g=n(34),v=n(35),y=n(36),_=n(37),b=n(38);t.END_OF_FILE=l.createTokenInstance(l.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:h.defaultParserErrorProvider,serializedGrammar:null}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",e[e.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={})),t.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var E=function(){function e(e,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG),this.ignoredIssues=t.DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(n),this.initLexerAdapter(),this.initLooksAhead(n),this.initRecognizerEngine(e,n),this.initRecoverable(n),this.initTreeBuilder(n),this.initContentAssist(),this.ignoredIssues=o.has(n,"ignoredIssues")?n.ignoredIssues:t.DEFAULT_PARSER_CONFIG.ignoredIssues,o.toFastProperties(this)}return e.performSelfAnalysis=function(e){e.performSelfAnalysis()},e.prototype.performSelfAnalysis=function(){var t,n=this;this.selfAnalysisDone=!0;var r=a.classNameFromInstance(this),i=this.gastProductionsCache;if(this.serializedGrammar){var l=c.deserializeGrammar(this.serializedGrammar,this.tokensMap);o.forEach(l,(function(e){n.gastProductionsCache.put(e.name,e)}))}var f=d.resolveGrammar({rules:i.values()});if(this.definitionErrors.push.apply(this.definitionErrors,f),o.isEmpty(f)){var p=d.validateGrammar({rules:i.values(),maxLookahead:this.maxLookahead,tokenTypes:o.values(this.tokensMap),ignoredIssues:this.ignoredIssues,errMsgProvider:h.defaultGrammarValidatorErrorProvider,grammarName:r});this.definitionErrors.push.apply(this.definitionErrors,p)}if(o.isEmpty(this.definitionErrors)){var m=s.computeAllProdsFollows(i.values());this.resyncFollows=m}var g=u.analyzeCst(i.values(),this.fullRuleNameToShort);if(this.allRuleNames=g.allRuleNames,!e.DEFER_DEFINITION_ERRORS_HANDLING&&!o.isEmpty(this.definitionErrors))throw t=o.map(this.definitionErrors,(function(e){return e.message})),new Error("Parser Definition Errors detected:\n "+t.join("\n-------------------------------\n"))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();t.Parser=E,o.applyMixins(E,[f.Recoverable,p.LooksAhead,m.TreeBuilder,g.LexerAdapter,y.RecognizerEngine,v.RecognizerApi,_.ErrorHandler,b.ContentAssist]);var w=function(e){function n(n,r){void 0===r&&(r=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(r);return i.outputCst=!0,e.call(this,n,i)||this}return i(n,e),n}(E);t.CstParser=w;var x=function(e){function n(n,r){void 0===r&&(r=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(r);return i.outputCst=!1,e.call(this,n,i)||this}return i(n,e),n}(E);t.EmbeddedActionsParser=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.classNameFromInstance=function(e){return o(e.constructor)};var i=/^\s*function\s*(\S*)\s*\(/,a="name";function o(e){return e.name||e.toString().match(i)[1]}t.functionName=o,t.defineNameProp=function(e,t){var n=Object.getOwnPropertyDescriptor(e,a);return!(!r.isUndefined(n)&&!n.configurable||(Object.defineProperty(e,a,{enumerable:!1,configurable:!0,writable:!1,value:t}),0))};var s=function(){function e(){this._state={}}return e.prototype.keys=function(){return r.keys(this._state)},e.prototype.values=function(){return r.values(this._state)},e.prototype.put=function(e,t){this._state[e]=t},e.prototype.putAll=function(e){this._state=r.assign(this._state,e._state)},e.prototype.get=function(e){return this._state[e]},e.prototype.containsKey=function(e){return r.has(this._state,e)},e.prototype.clear=function(){this._state={}},e}();t.HashTable=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(){function e(){}return e.prototype.visit=function(e){if(e instanceof r.NonTerminal)return this.visitNonTerminal(e);if(e instanceof r.Flat)return this.visitFlat(e);if(e instanceof r.Option)return this.visitOption(e);if(e instanceof r.RepetitionMandatory)return this.visitRepetitionMandatory(e);if(e instanceof r.RepetitionMandatoryWithSeparator)return this.visitRepetitionMandatoryWithSeparator(e);if(e instanceof r.RepetitionWithSeparator)return this.visitRepetitionWithSeparator(e);if(e instanceof r.Repetition)return this.visitRepetition(e);if(e instanceof r.Alternation)return this.visitAlternation(e);if(e instanceof r.Terminal)return this.visitTerminal(e);if(e instanceof r.Rule)return this.visitRule(e);throw Error("non exhaustive match")},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();t.GAstVisitor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i="MismatchedTokenException",a="NoViableAltException",o="EarlyExitException",s="NotAllInputParsedException",l=[i,a,o,s];function c(e,t,n){this.name=i,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}function u(e,t,n){this.name=a,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}function h(e,t){this.name=s,this.message=e,this.token=t,this.resyncedTokens=[]}function d(e,t,n){this.name=o,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}Object.freeze(l),t.isRecognitionException=function(e){return r.contains(l,e.name)},t.MismatchedTokenException=c,c.prototype=Error.prototype,t.NoViableAltException=u,u.prototype=Error.prototype,t.NotAllInputParsedException=h,h.prototype=Error.prototype,t.EarlyExitException=d,d.prototype=Error.prototype},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(4),a=n(2);function o(e){for(var t=r.cloneArr(e),n=e,i=!0;i;){n=r.compact(r.flatten(r.map(n,(function(e){return e.CATEGORIES}))));var a=r.difference(n,t);t=t.concat(a),r.isEmpty(a)?i=!1:n=a}return t}function s(e){r.forEach(e,(function(e){h(e)||(t.tokenIdxToClass.put(t.tokenShortNameIdx,e),e.tokenTypeIdx=t.tokenShortNameIdx++),d(e)&&!r.isArray(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),d(e)||(e.CATEGORIES=[]),f(e)||(e.categoryMatches=[]),p(e)||(e.categoryMatchesMap={}),m(e)||(e.tokenName=a.tokenName(e))}))}function l(e){r.forEach(e,(function(e){e.categoryMatches=[],r.forEach(e.categoryMatchesMap,(function(n,r){e.categoryMatches.push(t.tokenIdxToClass.get(r).tokenTypeIdx)}))}))}function c(e){r.forEach(e,(function(e){u([],e)}))}function u(e,t){r.forEach(e,(function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0})),r.forEach(t.CATEGORIES,(function(n){var i=e.concat(t);r.contains(i,n)||u(i,n)}))}function h(e){return r.has(e,"tokenTypeIdx")}function d(e){return r.has(e,"CATEGORIES")}function f(e){return r.has(e,"categoryMatches")}function p(e){return r.has(e,"categoryMatchesMap")}function m(e){return r.has(e,"tokenName")}t.tokenStructuredMatcher=function(e,t){var n=e.tokenTypeIdx;return n===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[n]},t.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},t.tokenShortNameIdx=1,t.tokenIdxToClass=new i.HashTable,t.augmentTokenTypes=function(e){var t=o(e);s(t),c(t),l(t),r.forEach(t,(function(e){e.isParent=e.categoryMatches.length>0}))},t.expandCategories=o,t.assignTokenDefaultProps=s,t.assignCategoriesTokensProp=l,t.assignCategoriesMapProp=c,t.singleAssignCategoriesToksMap=u,t.hasShortKeyProperty=h,t.hasCategoriesProperty=d,t.hasExtendingTokensTypesProperty=f,t.hasExtendingTokensTypesMapProperty=p,t.hasTokenNameProperty=m,t.isTokenType=function(e){return r.has(e,"tokenTypeIdx")}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(1),s=n(5),l=n(2);t.isSequenceProd=function(e){return e instanceof o.Flat||e instanceof o.Option||e instanceof o.Repetition||e instanceof o.RepetitionMandatory||e instanceof o.RepetitionMandatoryWithSeparator||e instanceof o.RepetitionWithSeparator||e instanceof o.Terminal||e instanceof o.Rule},t.isOptionalProd=function e(t,n){return void 0===n&&(n=[]),!!(t instanceof o.Option||t instanceof o.Repetition||t instanceof o.RepetitionWithSeparator)||(t instanceof o.Alternation?a.some(t.definition,(function(t){return e(t,n)})):!(t instanceof o.NonTerminal&&a.contains(n,t))&&t instanceof o.AbstractProduction&&(t instanceof o.NonTerminal&&n.push(t),a.every(t.definition,(function(t){return e(t,n)}))))},t.isBranchingProd=function(e){return e instanceof o.Alternation},t.getProductionDslName=function(e){if(e instanceof o.NonTerminal)return"SUBRULE";if(e instanceof o.Option)return"OPTION";if(e instanceof o.Alternation)return"OR";if(e instanceof o.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof o.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof o.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof o.Repetition)return"MANY";if(e instanceof o.Terminal)return"CONSUME";throw Error("non exhaustive match")};var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return i(t,e),t.prototype.visitTerminal=function(e){var t=l.tokenName(e.terminalType)+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(s.GAstVisitor);t.DslMethodsCollectorVisitor=c},function(e,t,n){"use strict";function r(e,t,n){return n|t|e}Object.defineProperty(t,"__esModule",{value:!0}),t.BITS_FOR_METHOD_IDX=4,t.BITS_FOR_OCCURRENCE_IDX=4,t.BITS_FOR_RULE_IDX=24,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_METHOD_IDX,t.OPTION_IDX=2<<t.BITS_FOR_METHOD_IDX,t.MANY_IDX=3<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_METHOD_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_METHOD_IDX,t.getKeyForAutomaticLookahead=r;var i=32-t.BITS_FOR_ALT_IDX;t.getKeyForAltIndex=function(e,t,n,a){var o=a+1<<i;return r(e,t,n)|o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(0),a=n(0),o=n(1),s=n(8),l=n(11),c=n(17),u=n(3);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,n=e.actual;return e.previous,e.ruleName,"Expecting "+(r.hasTokenLabel(t)?"--\x3e "+r.tokenLabel(t)+" <--":"token of type --\x3e "+r.tokenName(t)+" <--")+" but found --\x3e '"+n.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,n=e.actual,i=(e.previous,e.customUserDescription),o=(e.ruleName,"\nbut found: '"+a.first(n).image+"'");if(i)return"Expecting: "+i+o;var s=a.reduce(t,(function(e,t){return e.concat(t)}),[]),l=a.map(s,(function(e){return"["+a.map(e,(function(e){return r.tokenLabel(e)})).join(", ")+"]"}));return"Expecting: one of these possible Token sequences:\n"+a.map(l,(function(e,t){return"  "+(t+1)+". "+e})).join("\n")+o},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,n=e.actual,i=e.customUserDescription,o=(e.ruleName,"\nbut found: '"+a.first(n).image+"'");return i?"Expecting: "+i+o:"Expecting: expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+a.map(t,(function(e){return"["+a.map(e,(function(e){return r.tokenLabel(e)})).join(",")+"]"})).join(" ,")+">"+o}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var n,i=e.name,l=a.first(t),c=l.idx,u=s.getProductionDslName(l),h=(n=l)instanceof o.Terminal?r.tokenName(n.terminalType):n instanceof o.NonTerminal?n.nonTerminalName:"",d="->"+u+"<- with numerical suffix: ->"+c+"<-\n                  "+(h?"and argument: ->"+h+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+i+"<-.\n                  "+(0===c?"Also note that numerical suffix 0 means "+u+" without any suffix.":"")+"\n                  To fix this make sure each usage of "+u+" "+(h?"with the argument: ->"+h+"<-":"")+"\n                  in the rule ->"+i+"<- has a different occurrence index (0-5), as that combination acts as a unique\n                  position key in the grammar, which is needed by the parsing engine.\n                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return(d=d.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildInvalidNestedRuleNameError:function(e,t){return"Invalid nested rule name: ->"+t.name+"<- inside rule: ->"+e.name+"<-\nit must match the pattern: ->"+l.validNestedRuleName.toString()+"<-.\nNote that this means a nested rule name must start with the '$'(dollar) sign."},buildDuplicateNestedRuleNameError:function(e,t){return"Duplicate nested rule name: ->"+a.first(t).name+"<- inside rule: ->"+e.name+"<-\nA nested name must be unique in the scope of a top level grammar rule."},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=a.map(e.prefixPath,(function(e){return r.tokenLabel(e)})).join(", "),n=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+n+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nhttps://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=a.map(e.prefixPath,(function(e){return r.tokenLabel(e)})).join(", "),n=0===e.alternation.idx?"":e.alternation.idx,i="Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+n+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n",o=c.VERSION.replace(/\./g,"_");return i+"To Resolve this, try one of of the following: \n1. Refactor your grammar to be LL(K) for the current value of k (by default k="+u.DEFAULT_PARSER_CONFIG.maxLookahead+"})\n2. Increase the value of K for your grammar by providing a larger 'maxLookahead' value in the parser's config\n3. This issue can be ignored (if you know what you are doing...), see https://sap.github.io/chevrotain/documentation/"+o+"/interfaces/iparserconfig.html#ignoredissues for more details\n"},buildEmptyRepetitionError:function(e){var t=s.getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"Invalid Grammar Token name: ->"+r.tokenName(e.tokenType)+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+t+" --\x3e "+i.map(e.leftRecursionPath,(function(e){return e.name})).concat([t]).join(" --\x3e ")+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"Invalid grammar rule name: ->"+e.topLevelRule.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof o.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(0),s=n(3),l=n(8),c=n(2),u=n(12),h=n(16),d=n(13),f=n(1),p=n(5);function m(e){return l.getProductionDslName(e)+"_#_"+e.idx+"_#_"+g(e)}function g(e){return e instanceof f.Terminal?c.tokenName(e.terminalType):e instanceof f.NonTerminal?e.nonTerminalName:""}t.validateGrammar=function(e,t,n,r,i,u){var d=a.map(e,(function(e){return function(e,t){var n=new v;e.accept(n);var r=n.allProductions,i=a.groupBy(r,m),o=a.pick(i,(function(e){return e.length>1}));return a.map(a.values(o),(function(n){var r=a.first(n),i=t.buildDuplicateFoundError(e,n),o=l.getProductionDslName(r),c={message:i,type:s.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:o,occurrence:r.idx},u=g(r);return u&&(c.parameter=u),c}))}(e,i)})),f=a.map(e,(function(e){return w(e,e,i)})),p=[],x=[],T=[];o.every(f,o.isEmpty)&&(p=o.map(e,(function(e){return A(e,i)})),x=o.map(e,(function(e){return M(e,t,r,i)})),T=k(e,t,i));var S=function(e,t,n){var r=[],i=o.map(t,(function(e){return c.tokenName(e)}));return o.forEach(e,(function(e){var t=e.name;if(o.contains(i,t)){var a=n.buildNamespaceConflictError(e);r.push({message:a,type:s.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}})),r}(e,n,i),P=a.map(n,(function(e){return b(e,i)})),L=function(e,t){var n=[];return o.forEach(e,(function(e){var r=new h.NamedDSLMethodsCollectorVisitor("");e.accept(r);var i=o.map(r.result,(function(e){return e.orgProd}));n.push(o.map(i,(function(n){return _(e,n,t)})))})),o.flatten(n)}(e,i),C=function(e,t){var n=[];return o.forEach(e,(function(e){var r=new h.NamedDSLMethodsCollectorVisitor("");e.accept(r);var i=o.groupBy(r.result,(function(e){return e.name})),a=o.pick(i,(function(e){return e.length>1}));o.forEach(o.values(a),(function(r){var i=o.map(r,(function(e){return e.orgProd})),a=t.buildDuplicateNestedRuleNameError(e,i);n.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})}))})),n}(e,i),I=o.map(e,(function(e){return R(e,i)})),N=o.map(e,(function(e){return y(e,i)})),F=o.map(e,(function(t){return E(t,e,u,i)}));return a.flatten(d.concat(P,L,C,T,f,p,x,S,I,N,F))},t.identifyProductionForDuplicates=m;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function y(e,n){var r=[],i=e.name;return i.match(t.validTermsPattern)||r.push({message:n.buildInvalidRuleNameError({topLevelRule:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:i}),r}function _(e,n,r){var i,a=[];return n.name.match(t.validNestedRuleName)||(i=r.buildInvalidNestedRuleNameError(e,n),a.push({message:i,type:s.ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:e.name})),a}function b(e,n){var r=[];return c.tokenName(e).match(t.validTermsPattern)||r.push({message:n.buildTokenNameError({tokenType:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_TOKEN_NAME}),r}function E(e,t,n,r){var i=[];if(o.reduce(t,(function(t,n){return n.name===e.name?t+1:t}),0)>1){var a=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function w(e,t,n,r){void 0===r&&(r=[]);var i=[],o=x(t.definition);if(a.isEmpty(o))return[];var l=e.name;a.contains(o,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:s.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:l});var c=a.difference(o,r.concat([e])),u=a.map(c,(function(t){var i=a.cloneArr(r);return i.push(t),w(e,t,n,i)}));return i.concat(a.flatten(u))}function x(e){var t=[];if(a.isEmpty(e))return t;var n=a.first(e);if(n instanceof f.NonTerminal)t.push(n.referencedRule);else if(n instanceof f.Flat||n instanceof f.Option||n instanceof f.RepetitionMandatory||n instanceof f.RepetitionMandatoryWithSeparator||n instanceof f.RepetitionWithSeparator||n instanceof f.Repetition)t=t.concat(x(n.definition));else if(n instanceof f.Alternation)t=a.flatten(a.map(n.definition,(function(e){return x(e.definition)})));else if(!(n instanceof f.Terminal))throw Error("non exhaustive match");var r=l.isOptionalProd(n),i=e.length>1;if(r&&i){var o=a.drop(e);return t.concat(x(o))}return t}t.OccurrenceValidationCollector=v,t.validTermsPattern=/^[a-zA-Z_]\w*$/,t.validNestedRuleName=new RegExp(t.validTermsPattern.source.replace("^","^\\$")),t.validateRuleName=y,t.validateNestedRuleName=_,t.validateTokenName=b,t.validateRuleDoesNotAlreadyExist=E,t.validateRuleIsOverridden=function(e,t,n){var r,i=[];return a.contains(t,e)||(r="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+n+"<-as it is not defined in any of the super grammars ",i.push({message:r,type:s.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),i},t.validateNoLeftRecursion=w,t.getFirstNoneTerminal=x;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return i(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(p.GAstVisitor);function A(e,t){var n=new T;e.accept(n);var r=n.alternations;return a.reduce(r,(function(n,r){var i=a.dropRight(r.definition),o=a.map(i,(function(n,i){var o=d.nextPossibleTokensAfter([n],[],null,1);return a.isEmpty(o)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:r,emptyChoiceIdx:i}),type:s.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:r.idx,alternative:i+1}:null}));return n.concat(a.compact(o))}),[])}function M(e,t,n,r){var i=new T;e.accept(i);var c=i.alternations,h=n[e.name];return h&&(c=o.reject(c,(function(e){return h[l.getProductionDslName(e)+(0===e.idx?"":e.idx)]}))),a.reduce(c,(function(n,i){var l=i.idx,c=u.getLookaheadPathsForOr(l,e,t),h=function(e,t,n,r){var i=[],l=o.reduce(e,(function(t,n,r){return o.forEach(n,(function(n){var a=[r];o.forEach(e,(function(e,t){r!==t&&u.containsPath(e,n)&&a.push(t)})),a.length>1&&!u.containsPath(i,n)&&(i.push(n),t.push({alts:a,path:n}))})),t}),[]);return a.map(l,(function(e){var i=o.map(e.alts,(function(e){return e+1}));return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:[e.alts]}}))}(c,i,e,r),d=P(c,i,e,r);return n.concat(h,d)}),[])}t.validateEmptyOrAlternative=A,t.validateAmbiguousAlternationAlternatives=M;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function R(e,t){var n=new T;e.accept(n);var r=n.alternations;return a.reduce(r,(function(n,r){return r.definition.length>255&&n.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:r}),type:s.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:r.idx}),n}),[])}function k(e,t,n){var r=[];return o.forEach(e,(function(e){var i=new S;e.accept(i);var a=i.allProductions;o.forEach(a,(function(i){var a=u.getProdType(i),l=i.idx,c=u.getLookaheadPathsForOptionalProd(l,e,a,t)[0];if(o.isEmpty(o.flatten(c))){var h=n.buildEmptyRepetitionError({topLevelRule:e,repetition:i});r.push({message:h,type:s.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}}))})),r}function P(e,t,n,r){var i=[],a=o.reduce(e,(function(e,t,n){var r=o.map(t,(function(e){return{idx:n,path:e}}));return e.concat(r)}),[]);return o.forEach(a,(function(e){var l=e.idx,c=e.path,h=o.findAll(a,(function(e){return e.idx<l&&u.isStrictPrefixOfPath(e.path,c)})),d=o.map(h,(function(e){var i=[e.idx+1,l+1],a=0===t.idx?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:a,alternatives:i}}));i=i.concat(d)})),i}t.RepetionCollector=S,t.validateTooManyAlts=R,t.validateSomeNonEmptyLookaheadPath=k,t.checkPrefixAlternativesAmbiguities=P},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(0),s=n(13),l=n(14),c=n(7),u=n(1),h=n(5);!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(a=t.PROD_TYPE||(t.PROD_TYPE={})),t.getProdType=function(e){if(e instanceof u.Option)return a.OPTION;if(e instanceof u.Repetition)return a.REPETITION;if(e instanceof u.RepetitionMandatory)return a.REPETITION_MANDATORY;if(e instanceof u.RepetitionMandatoryWithSeparator)return a.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof u.RepetitionWithSeparator)return a.REPETITION_WITH_SEPARATOR;if(e instanceof u.Alternation)return a.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,n,r,i,a){var o=m(e,t,n);return a(o,r,y(o)?c.tokenStructuredMatcherNoCategories:c.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,n,r,i,a){var o=g(e,t,i,n),s=y(o)?c.tokenStructuredMatcherNoCategories:c.tokenStructuredMatcher;return a(o[0],s,r)},t.buildAlternativesLookAheadFunc=function(e,t,n,r){var i=e.length,a=o.every(e,(function(e){return o.every(e,(function(e){return 1===e.length}))}));if(t)return function(t){for(var r=o.map(t,(function(e){return e.GATE})),a=0;a<i;a++){var s=e[a],l=s.length,c=r[a];if(void 0===c||!1!==c.call(this))e:for(var u=0;u<l;u++){for(var h=s[u],d=h.length,f=0;f<d;f++){var p=this.LA(f+1);if(!1===n(p,h[f]))continue e}return a}}};if(a&&!r){var s=o.map(e,(function(e){return o.flatten(e)})),l=o.reduce(s,(function(e,t,n){return o.forEach(t,(function(t){o.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=n),o.forEach(t.categoryMatches,(function(t){o.has(e,t)||(e[t]=n)}))})),e}),[]);return function(){var e=this.LA(1);return l[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var r=e[t],a=r.length;e:for(var o=0;o<a;o++){for(var s=r[o],l=s.length,c=0;c<l;c++){var u=this.LA(c+1);if(!1===n(u,s[c]))continue e}return t}}}},t.buildSingleAlternativeLookaheadFunction=function(e,t,n){var r=o.every(e,(function(e){return 1===e.length})),i=e.length;if(r&&!n){var a=o.flatten(e);if(1===a.length&&o.isEmpty(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var l=o.reduce(a,(function(e,t,n){return e[t.tokenTypeIdx]=!0,o.forEach(t.categoryMatches,(function(t){e[t]=!0})),e}),[]);return function(){var e=this.LA(1);return!0===l[e.tokenTypeIdx]}}return function(){e:for(var n=0;n<i;n++){for(var r=e[n],a=r.length,o=0;o<a;o++){var s=this.LA(o+1);if(!1===t(s,r[o]))continue e}return!0}return!1}};var d=function(e){function t(t,n,r){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=n,i.targetProdType=r,i}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,n,r){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=n.concat(r),!0)},t.prototype.walkOption=function(t,n,r){this.checkIsTarget(t,a.OPTION,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkAtLeastOne=function(t,n,r){this.checkIsTarget(t,a.REPETITION_MANDATORY,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkAtLeastOneSep=function(t,n,r){this.checkIsTarget(t,a.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkMany=function(t,n,r){this.checkIsTarget(t,a.REPETITION,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkManySep=function(t,n,r){this.checkIsTarget(t,a.REPETITION_WITH_SEPARATOR,n,r)||e.prototype.walkOption.call(this,t,n,r)},t}(l.RestWalker),f=function(e){function t(t,n){var r=e.call(this)||this;return r.targetOccurrence=t,r.targetProdType=n,r.result=[],r}return i(t,e),t.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,a.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,a.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,a.ALTERNATION)},t}(h.GAstVisitor);function p(e,t){function n(e,t){return o.reduce(e,(function(e,n,r){if(r!==t){var i=o.map(n,(function(e){return e.partialPath}));return e.concat(i)}return e}),[])}function r(e,t){return void 0===o.find(e,(function(e){return o.every(t,(function(t,n){return(r=t)===(i=e[n])||r&&i&&(r.categoryMatchesMap[i.tokenTypeIdx]||i.categoryMatchesMap[r.tokenTypeIdx]);var r,i}))}))}function i(e){for(var t=[],n=0;n<e;n++)t.push([]);return t}for(var a=o.map(e,(function(e){return s.possiblePathsFrom([e],1)})),l=i(a.length),c=a,u=1;u<=t;u++){var h=c;c=i(h.length);for(var d=0;d<h.length;d++)for(var f=h[d],p=n(h,d),m=0;m<f.length;m++){var g=f[m].partialPath,y=f[m].suffixDef;if(r(p,g)||o.isEmpty(y)||g.length===t){var _=l[d];v(_,g)||_.push(g)}else{var b=s.possiblePathsFrom(y,u+1,g);c[d]=c[d].concat(b)}}}return l}function m(e,t,n){var r=new f(e,a.ALTERNATION);return t.accept(r),p(r.result,n)}function g(e,t,n,r){var i=new f(e,n);t.accept(i);var a=i.result,o=new d(t,e,n).startWalking();return p([new u.Flat({definition:a}),new u.Flat({definition:o})],r)}function v(e,t){return void 0!==o.find(e,(function(e){return t.length===e.length&&o.every(t,(function(t,n){return t===e[n]||e[n].categoryMatchesMap[t.tokenTypeIdx]}))}))}function y(e){return o.every(e,(function(e){return o.every(e,(function(e){return o.every(e,(function(e){return o.isEmpty(e.categoryMatches)}))}))}))}t.lookAheadSequenceFromAlternatives=p,t.getLookaheadPathsForOr=m,t.getLookaheadPathsForOptionalProd=g,t.containsPath=v,t.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&o.every(e,(function(e,n){var r=t[n];return e===r||r.categoryMatchesMap[e.tokenTypeIdx]}))},t.areTokenCategoriesNotUsed=y},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(14),o=n(0),s=n(2),l=n(21),c=n(1),u=function(e){function t(t,n){var r=e.call(this)||this;return r.topProd=t,r.path=n,r.possibleTokTypes=[],r.nextProductionName="",r.nextProductionOccurrence=0,r.found=!1,r.isAtEndOfPath=!1,r}return i(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=o.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=o.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,n){void 0===n&&(n=[]),this.found||e.prototype.walk.call(this,t,n)},t.prototype.walkProdRef=function(e,t,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var r=t.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,r)}},t.prototype.updateExpectedNext=function(){o.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(a.RestWalker);t.AbstractNextPossibleTokensWalker=u;var h=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.path=n,r.nextTerminalName="",r.nextTerminalOccurrence=0,r.nextTerminalName=s.tokenName(r.path.lastTok),r.nextTerminalOccurrence=r.path.lastTokOccurrence,r}return i(t,e),t.prototype.walkTerminal=function(e,t,n){if(this.isAtEndOfPath&&s.tokenName(e.terminalType)===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var r=t.concat(n),i=new c.Flat({definition:r});this.possibleTokTypes=l.first(i),this.found=!0}},t}(u);t.NextAfterTokenWalker=h;var d=function(e){function t(t,n){var r=e.call(this)||this;return r.topRule=t,r.occurrence=n,r.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},r}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(a.RestWalker);t.AbstractNextTerminalAfterProductionWalker=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkMany=function(t,n,r){if(t.idx===this.occurrence){var i=o.first(n.concat(r));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkMany.call(this,t,n,r)},t}(d);t.NextTerminalAfterManyWalker=f;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkManySep=function(t,n,r){if(t.idx===this.occurrence){var i=o.first(n.concat(r));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkManySep.call(this,t,n,r)},t}(d);t.NextTerminalAfterManySepWalker=p;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOne=function(t,n,r){if(t.idx===this.occurrence){var i=o.first(n.concat(r));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOne.call(this,t,n,r)},t}(d);t.NextTerminalAfterAtLeastOneWalker=m;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOneSep=function(t,n,r){if(t.idx===this.occurrence){var i=o.first(n.concat(r));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,n,r)},t}(d);function v(e,t,n,r){var i=o.cloneArr(n);i.push(e.name);var a=o.cloneArr(r);return a.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:a}}t.NextTerminalAfterAtLeastOneSepWalker=g,t.possiblePathsFrom=function e(t,n,r){void 0===r&&(r=[]),r=o.cloneArr(r);var i=[],a=0;function s(s){var l=e(s.concat(o.drop(t,a+1)),n,r);return i.concat(l)}for(;r.length<n&&a<t.length;){var l=t[a];if(l instanceof c.Flat)return s(l.definition);if(l instanceof c.NonTerminal)return s(l.definition);if(l instanceof c.Option)i=s(l.definition);else{if(l instanceof c.RepetitionMandatory)return s(u=l.definition.concat([new c.Repetition({definition:l.definition})]));if(l instanceof c.RepetitionMandatoryWithSeparator)return s(u=[new c.Flat({definition:l.definition}),new c.Repetition({definition:[new c.Terminal({terminalType:l.separator})].concat(l.definition)})]);if(l instanceof c.RepetitionWithSeparator){var u=l.definition.concat([new c.Repetition({definition:[new c.Terminal({terminalType:l.separator})].concat(l.definition)})]);i=s(u)}else if(l instanceof c.Repetition)u=l.definition.concat([new c.Repetition({definition:l.definition})]),i=s(u);else{if(l instanceof c.Alternation)return o.forEach(l.definition,(function(e){i=s(e.definition)})),i;if(!(l instanceof c.Terminal))throw Error("non exhaustive match");r.push(l.terminalType)}}a++}return i.push({partialPath:r,suffixDef:o.drop(t,a)}),i},t.nextPossibleTokensAfter=function(e,t,n,r){var i=["EXIT_NONE_TERMINAL"],a=!1,s=t.length,l=s-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!o.isEmpty(h);){var d=h.pop();if("EXIT_ALTERNATIVE"!==d){var f=d.def,p=d.idx,m=d.ruleStack,g=d.occurrenceStack;if(!o.isEmpty(f)){var y=f[0];if("EXIT_NONE_TERMINAL"===y){var _={idx:p,def:o.drop(f),ruleStack:o.dropRight(m),occurrenceStack:o.dropRight(g)};h.push(_)}else if(y instanceof c.Terminal)if(p<s-1){var b=p+1;n(t[b],y.terminalType)&&(_={idx:b,def:o.drop(f),ruleStack:m,occurrenceStack:g},h.push(_))}else{if(p!==s-1)throw Error("non exhaustive match");u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:g}),a=!0}else if(y instanceof c.NonTerminal){var E=o.cloneArr(m);E.push(y.nonTerminalName);var w=o.cloneArr(g);w.push(y.idx),_={idx:p,def:y.definition.concat(i,o.drop(f)),ruleStack:E,occurrenceStack:w},h.push(_)}else if(y instanceof c.Option){var x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:g};h.push(x),h.push("EXIT_ALTERNATIVE");var T={idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:g};h.push(T)}else if(y instanceof c.RepetitionMandatory){var A=new c.Repetition({definition:y.definition,idx:y.idx});_={idx:p,def:y.definition.concat([A],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(_)}else if(y instanceof c.RepetitionMandatoryWithSeparator){var M=new c.Terminal({terminalType:y.separator});A=new c.Repetition({definition:[M].concat(y.definition),idx:y.idx}),_={idx:p,def:y.definition.concat([A],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(_)}else if(y instanceof c.RepetitionWithSeparator){x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:g},h.push(x),h.push("EXIT_ALTERNATIVE"),M=new c.Terminal({terminalType:y.separator});var S=new c.Repetition({definition:[M].concat(y.definition),idx:y.idx});T={idx:p,def:y.definition.concat([S],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(T)}else if(y instanceof c.Repetition)x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:g},h.push(x),h.push("EXIT_ALTERNATIVE"),S=new c.Repetition({definition:y.definition,idx:y.idx}),T={idx:p,def:y.definition.concat([S],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(T);else if(y instanceof c.Alternation)for(var R=y.definition.length-1;R>=0;R--){var k={idx:p,def:y.definition[R].definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:g};h.push(k),h.push("EXIT_ALTERNATIVE")}else if(y instanceof c.Flat)h.push({idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:g});else{if(!(y instanceof c.Rule))throw Error("non exhaustive match");h.push(v(y,p,m,g))}}}else a&&o.last(h).idx<=l&&h.pop()}return u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(1),a=function(){function e(){}return e.prototype.walk=function(e,t){var n=this;void 0===t&&(t=[]),r.forEach(e.definition,(function(a,o){var s=r.drop(e.definition,o+1);if(a instanceof i.NonTerminal)n.walkProdRef(a,s,t);else if(a instanceof i.Terminal)n.walkTerminal(a,s,t);else if(a instanceof i.Flat)n.walkFlat(a,s,t);else if(a instanceof i.Option)n.walkOption(a,s,t);else if(a instanceof i.RepetitionMandatory)n.walkAtLeastOne(a,s,t);else if(a instanceof i.RepetitionMandatoryWithSeparator)n.walkAtLeastOneSep(a,s,t);else if(a instanceof i.RepetitionWithSeparator)n.walkManySep(a,s,t);else if(a instanceof i.Repetition)n.walkMany(a,s,t);else{if(!(a instanceof i.Alternation))throw Error("non exhaustive match");n.walkOr(a,s,t)}}))},e.prototype.walkTerminal=function(e,t,n){},e.prototype.walkProdRef=function(e,t,n){},e.prototype.walkFlat=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkOption=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkAtLeastOne=function(e,t,n){var r=[new i.Option({definition:e.definition})].concat(t,n);this.walk(e,r)},e.prototype.walkAtLeastOneSep=function(e,t,n){var r=o(e,t,n);this.walk(e,r)},e.prototype.walkMany=function(e,t,n){var r=[new i.Option({definition:e.definition})].concat(t,n);this.walk(e,r)},e.prototype.walkManySep=function(e,t,n){var r=o(e,t,n);this.walk(e,r)},e.prototype.walkOr=function(e,t,n){var a=this,o=t.concat(n);r.forEach(e.definition,(function(e){var t=new i.Flat({definition:[e]});a.walk(t,o)}))},e}();function o(e,t,n){return[new i.Option({definition:[new i.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}t.RestWalker=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),i=n(0),a=n(7),o=n(20);!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var s={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:o.defaultLexerErrorProvider};Object.freeze(s);var l=function(){function e(e,t){var n=this;if(void 0===t&&(t=s),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");if(this.config=i.merge(s,t),this.config.lineTerminatorsPattern===s.lineTerminatorsPattern)this.config.lineTerminatorsPattern=r.LineTerminatorOptimizedTester;else if(this.config.lineTerminatorCharacters===s.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking);var o,l=!0;i.isArray(e)?((o={modes:{}}).modes[r.DEFAULT_MODE]=i.cloneArr(e),o[r.DEFAULT_MODE]=r.DEFAULT_MODE):(l=!1,o=i.cloneObj(e)),this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(r.performRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(r.performWarningRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),o.modes=o.modes?o.modes:{},i.forEach(o.modes,(function(e,t){o.modes[t]=i.reject(e,(function(e){return i.isUndefined(e)}))}));var c=i.keys(o.modes);if(i.forEach(o.modes,(function(e,o){if(n.modes.push(o),n.lexerDefinitionErrors=n.lexerDefinitionErrors.concat(r.validatePatterns(e,c)),i.isEmpty(n.lexerDefinitionErrors)){a.augmentTokenTypes(e);var s=r.analyzeTokenTypes(e,{lineTerminatorCharacters:n.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode});n.patternIdxToConfig[o]=s.patternIdxToConfig,n.charCodeToPatternIdxToConfig[o]=s.charCodeToPatternIdxToConfig,n.emptyGroups=i.merge(n.emptyGroups,s.emptyGroups),n.hasCustom=s.hasCustom||n.hasCustom,n.canModeBeOptimized[o]=s.canBeOptimized}})),this.defaultMode=o.defaultMode,!i.isEmpty(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){var u=i.map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+u)}if(i.forEach(this.lexerDefinitionWarning,(function(e){i.PRINT_WARNING(e.message)})),r.SUPPORT_STICKY?(this.chopInput=i.IDENTITY,this.match=this.matchWithTest):(this.updateLastIndex=i.NOOP,this.match=this.matchWithExec),l&&(this.handleModes=i.NOOP),!1===this.trackStartLines&&(this.computeNewColumn=i.IDENTITY),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=i.NOOP),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+this.config.positionTracking+'"');this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?this.addToken=this.addTokenUsingPush:this.addToken=this.addTokenUsingMemberAccess;var h=i.reduce(this.canModeBeOptimized,(function(e,t,n){return!1===t&&e.push(n),e}),[]);if(t.ensureOptimizations&&!i.isEmpty(h))throw Error("Lexer Modes: < "+h.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!i.isEmpty(this.lexerDefinitionErrors)){var n=i.map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+n)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var n,a,o,s,l,c,u,h,d,f,p,m,g=this,v=e,y=v.length,_=0,b=0,E=this.hasCustom?0:Math.floor(e.length/10),w=new Array(E),x=[],T=this.trackStartLines?1:void 0,A=this.trackStartLines?1:void 0,M=r.cloneEmptyGroups(this.emptyGroups),S=this.trackStartLines,R=this.config.lineTerminatorsPattern,k=0,P=[],L=[],C=[],I=[];Object.freeze(I);var N,F=void 0,O=function(e){if(1===C.length&&void 0===e.tokenType.PUSH_MODE){var t=g.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);x.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{C.pop();var n=i.last(C);P=g.patternIdxToConfig[n],L=g.charCodeToPatternIdxToConfig[n],k=P.length;var r=g.canModeBeOptimized[n]&&!1===g.config.safeMode;F=L&&r?function(e){var t=L[e];return void 0===t?I:t}:function(){return P}}};function H(e){C.push(e),L=this.charCodeToPatternIdxToConfig[e],P=this.patternIdxToConfig[e],k=P.length,k=P.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;F=L&&t?function(e){var t=L[e];return void 0===t?I:t}:function(){return P}}for(H.call(this,t);_<y;){l=null;var D=v.charCodeAt(_),U=F(D),B=U.length;for(n=0;n<B;n++){var z=(N=U[n]).pattern;if(!1!==(Q=N.short)?D===Q&&(l=z):!0===N.isCustom?l=null!==(m=z.exec(v,_,w,M))?m[0]:m:(this.updateLastIndex(z,_),l=this.match(z,e,_)),null!==l){if(void 0!==(s=N.longerAlt)){var V=P[s],j=V.pattern;!0===V.isCustom?o=null!==(m=j.exec(v,_,w,M))?m[0]:m:(this.updateLastIndex(j,_),o=this.match(j,e,_)),o&&o.length>l.length&&(l=o,N=V)}break}}if(null!==l){if(c=l.length,void 0!==(u=N.group)&&(h=N.tokenTypeIdx,d=this.createTokenInstance(l,_,h,N.tokenType,T,A,c),!1===u?b=this.addToken(w,b,d):M[u].push(d)),e=this.chopInput(e,c),_+=c,A=this.computeNewColumn(A,c),!0===S&&!0===N.canLineTerminator){var G=0,W=void 0,q=void 0;R.lastIndex=0;do{!0===(W=R.test(l))&&(q=R.lastIndex-1,G++)}while(W);0!==G&&(T+=G,A=c-q,this.updateTokenEndLineColumnLocation(d,u,q,G,T,A,c))}this.handleModes(N,O,H,d)}else{for(var X=_,Y=T,K=A,Z=!1;!Z&&_<y;)for(v.charCodeAt(_),e=this.chopInput(e,1),_++,a=0;a<k;a++){var Q,J=P[a];if(z=J.pattern,!1!==(Q=J.short)?v.charCodeAt(_)===Q&&(Z=!0):!0===J.isCustom?Z=null!==z.exec(v,_,w,M):(this.updateLastIndex(z,_),Z=null!==z.exec(e)),!0===Z)break}f=_-X,p=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,X,f,Y,K),x.push({offset:X,line:Y,column:K,length:f,message:p})}}return this.hasCustom||(w.length=b),{tokens:w,groups:M,errors:x}},e.prototype.handleModes=function(e,t,n,r){if(!0===e.pop){var i=e.push;t(r),void 0!==i&&n.call(this,i)}else void 0!==e.push&&n.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,n,r,i,a,o){var s,l;void 0!==t&&(l=(s=n===o-1)?-1:0,1===r&&!0===s||(e.endLine=i+l,e.endColumn=a-1-l))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,n,r){return{image:e,startOffset:t,tokenTypeIdx:n,tokenType:r}},e.prototype.createStartOnlyToken=function(e,t,n,r,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:n,tokenType:r}},e.prototype.createFullToken=function(e,t,n,r,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:n,tokenType:r}},e.prototype.addToken=function(e,t,n){return 666},e.prototype.addTokenUsingPush=function(e,t,n){return e.push(n),t},e.prototype.addTokenUsingMemberAccess=function(e,t,n){return e[t]=n,++t},e.prototype.match=function(e,t,n){return null},e.prototype.matchWithTest=function(e,t,n){return!0===e.test(t)?t.substring(n,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var n=e.exec(t);return null!==n?n[0]:n},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();t.Lexer=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(4),s=n(9),l=n(1),c=n(5);t.addTerminalToCst=function(e,t,n){void 0===e.children[n]?e.children[n]=[t]:e.children[n].push(t)},t.addNoneTerminalToCst=function(e,t,n){void 0===e.children[t]?e.children[t]=[n]:e.children[t].push(n)};var u=function(e){function t(t){var n=e.call(this)||this;return n.result=[],n.ruleIdx=t,n}return i(t,e),t.prototype.collectNamedDSLMethod=function(e,t,n){if(!a.isUndefined(e.name)){var r=void 0;if(e instanceof l.Option||e instanceof l.Repetition||e instanceof l.RepetitionMandatory||e instanceof l.Alternation)r=new t({definition:e.definition,idx:e.idx});else{if(!(e instanceof l.RepetitionMandatoryWithSeparator||e instanceof l.RepetitionWithSeparator))throw Error("non exhaustive match");r=new t({definition:e.definition,idx:e.idx,separator:e.separator})}var i=[r],o=s.getKeyForAutomaticLookahead(this.ruleIdx,n,e.idx);this.result.push({def:i,key:o,name:e.name,orgProd:e})}},t.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,l.Option,s.OPTION_IDX)},t.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,l.Repetition,s.MANY_IDX)},t.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatory,s.AT_LEAST_ONE_IDX)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatoryWithSeparator,s.AT_LEAST_ONE_SEP_IDX)},t.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionWithSeparator,s.MANY_SEP_IDX)},t.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,l.Alternation,s.OR_IDX);var n=e.definition.length>1;a.forEach(e.definition,(function(r,i){if(!a.isUndefined(r.name)){var o=r.definition;o=n?[new l.Option({definition:r.definition})]:r.definition;var c=s.getKeyForAltIndex(t.ruleIdx,s.OR_IDX,e.idx,i);t.result.push({def:o,key:c,name:r.name,orgProd:r})}}))},t}(c.GAstVisitor);t.NamedDSLMethodsCollectorVisitor=u,t.analyzeCst=function(e,t){var n={dictDef:new o.HashTable,allRuleNames:[]};return a.forEach(e,(function(e){var r=t.get(e.name);n.allRuleNames.push(e.name);var i=new u(r);e.accept(i),a.forEach(i.result,(function(t){t.def,t.key;var r=t.name;n.allRuleNames.push(e.name+r)}))})),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="4.6.0"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(15),a=n(2),o=n(6),s=n(17),l=n(10),c=n(39),u=n(5),h=n(1),d=n(24),f=n(40),p=n(20),m={};m.VERSION=s.VERSION,m.Parser=r.Parser,m.CstParser=r.CstParser,m.EmbeddedActionsParser=r.EmbeddedActionsParser,m.ParserDefinitionErrorType=r.ParserDefinitionErrorType,m.Lexer=i.Lexer,m.LexerDefinitionErrorType=i.LexerDefinitionErrorType,m.EOF=a.EOF,m.tokenName=a.tokenName,m.tokenLabel=a.tokenLabel,m.tokenMatcher=a.tokenMatcher,m.createToken=a.createToken,m.createTokenInstance=a.createTokenInstance,m.EMPTY_ALT=r.EMPTY_ALT,m.defaultParserErrorProvider=l.defaultParserErrorProvider,m.isRecognitionException=o.isRecognitionException,m.EarlyExitException=o.EarlyExitException,m.MismatchedTokenException=o.MismatchedTokenException,m.NotAllInputParsedException=o.NotAllInputParsedException,m.NoViableAltException=o.NoViableAltException,m.defaultLexerErrorProvider=p.defaultLexerErrorProvider,m.Flat=h.Flat,m.Repetition=h.Repetition,m.RepetitionWithSeparator=h.RepetitionWithSeparator,m.RepetitionMandatory=h.RepetitionMandatory,m.RepetitionMandatoryWithSeparator=h.RepetitionMandatoryWithSeparator,m.Option=h.Option,m.Alternation=h.Alternation,m.NonTerminal=h.NonTerminal,m.Terminal=h.Terminal,m.Rule=h.Rule,m.GAstVisitor=u.GAstVisitor,m.serializeGrammar=h.serializeGrammar,m.serializeProduction=h.serializeProduction,m.resolveGrammar=d.resolveGrammar,m.defaultGrammarResolverErrorProvider=l.defaultGrammarResolverErrorProvider,m.validateGrammar=d.validateGrammar,m.defaultGrammarValidatorErrorProvider=l.defaultGrammarValidatorErrorProvider,m.assignOccurrenceIndices=d.assignOccurrenceIndices,m.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")},m.createSyntaxDiagramsCode=c.createSyntaxDiagramsCode,m.generateParserFactory=f.generateParserFactory,m.generateParserModule=f.generateParserModule,e.exports=m},function(e,t,n){var r,i,a;"undefined"!=typeof self&&self,i=[],void 0===(a="function"==typeof(r=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var n={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(n,"global");break;case"i":s(n,"ignoreCase");break;case"m":s(n,"multiLine");break;case"u":s(n,"unicode");break;case"y":s(n,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:"Alternative",value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}l(e);var t=this.disjunction();return this.consumeChar(")"),{type:e,value:t}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var n=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:n,atMost:n};break;case",":t=this.isDigit()?{atLeast:n,atMost:this.integerIncludingZero()}:{atLeast:n,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;l(t)}if(!0!==e||void 0!==t)return l(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t},e.prototype.atom=function(){var e;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),l(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){return{type:"GroupBackReference",value:this.positiveInteger()}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=c;break;case"D":e=c,t=!0;break;case"s":e=h;break;case"S":e=h,t=!0;break;case"w":e=u;break;case"W":e=u,t=!0}return l(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\v")}return l(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){return{type:"Character",value:a(this.popChar())}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:a(this.popChar())}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var n=this.classAtom();if("Character"===n.type&&this.isRangeDash()){this.consumeChar("-");var r=this.classAtom();if("Character"===r.type){if(r.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:r.value})}else o(n.value,e),e.push(a("-")),o(r.value,e)}else o(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++}var t=this.disjunction();this.consumeChar(")");var n={type:"Group",capturing:e,value:t};return e&&(n.idx=this.groupIdx),n},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===i.test(e))throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===r.test(e))throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return r.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",r=0;r<e;r++){var i=this.popChar();if(!1===n.test(i))throw Error("Expecting a HexDecimal digits");t+=i}return{type:"Character",value:parseInt(t,16)}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t,n=/[0-9a-fA-F]/,r=/[0-9]/,i=/[1-9]/;function a(e){return e.charCodeAt(0)}function o(e,t){void 0!==e.length?e.forEach((function(e){t.push(e)})):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function l(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var c=[];for(t=a("0");t<=a("9");t++)c.push(t);var u=[a("_")].concat(c);for(t=a("a");t<=a("z");t++)u.push(t);for(t=a("A");t<=a("Z");t++)u.push(t);var h=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\v"),a("\t"),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a("\u2028"),a("\u2029"),a(" "),a(" "),a("　"),a("\ufeff")];function d(){}return d.prototype.visitChildren=function(e){for(var t in e){var n=e[t];e.hasOwnProperty(t)&&(void 0!==n.type?this.visit(n):Array.isArray(n)&&n.forEach((function(e){this.visit(e)}),this))}},d.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},d.prototype.visitPattern=function(e){},d.prototype.visitFlags=function(e){},d.prototype.visitDisjunction=function(e){},d.prototype.visitAlternative=function(e){},d.prototype.visitStartAnchor=function(e){},d.prototype.visitEndAnchor=function(e){},d.prototype.visitWordBoundary=function(e){},d.prototype.visitNonWordBoundary=function(e){},d.prototype.visitLookahead=function(e){},d.prototype.visitNegativeLookahead=function(e){},d.prototype.visitCharacter=function(e){},d.prototype.visitSet=function(e){},d.prototype.visitGroup=function(e){},d.prototype.visitGroupBackReference=function(e){},d.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:d,VERSION:"0.4.0"}})?r.apply(t,i):r)||(e.exports=a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,n,r,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+n+" characters."}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(1),a=n(8);function o(e){if(e instanceof i.NonTerminal)return o(e.referencedRule);if(e instanceof i.Terminal)return c(e);if(a.isSequenceProd(e))return s(e);if(a.isBranchingProd(e))return l(e);throw Error("non exhaustive match")}function s(e){for(var t,n=[],i=e.definition,s=0,l=i.length>s,c=!0;l&&c;)t=i[s],c=a.isOptionalProd(t),n=n.concat(o(t)),s+=1,l=i.length>s;return r.uniq(n)}function l(e){var t=r.map(e.definition,(function(e){return o(e)}));return r.uniq(r.flatten(t))}function c(e){return[e.terminalType]}t.first=o,t.firstForSequence=s,t.firstForBranching=l,t.firstForTerminal=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN="_~IN~_"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(29),a=n(0),o=n(1);!function(e){e[e.OPTION=0]="OPTION",e[e.OR=1]="OR",e[e.MANY=2]="MANY",e[e.MANY_SEP=3]="MANY_SEP",e[e.AT_LEAST_ONE=4]="AT_LEAST_ONE",e[e.AT_LEAST_ONE_SEP=5]="AT_LEAST_ONE_SEP",e[e.REF=6]="REF",e[e.TERMINAL=7]="TERMINAL",e[e.FLAT=8]="FLAT"}(r=t.ProdType||(t.ProdType={}));var s=/(?:\s*{\s*NAME\s*:\s*["'`]([\w$]*)["'`])?/,l=new RegExp(s.source.replace("{","").replace(")?","\\s*,)?")),c=/\.\s*CONSUME(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,u=new RegExp(c.source,"g"),h=/\.\s*SUBRULE(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,d=new RegExp(h.source,"g"),f=/\.\s*OPTION(\d+)?\s*\(/,p=new RegExp(f.source+s.source),m=new RegExp(f.source,"g"),g=/\.\s*MANY(\d+)?\s*\(/,v=new RegExp(g.source+s.source),y=new RegExp(g.source,"g"),_=/\s*SEP\s*:\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,b=new RegExp(/\.\s*MANY_SEP(\d+)?\s*\(\s*{/.source+l.source+_.source),E=new RegExp(b.source,"g"),w=new RegExp(/\.\s*AT_LEAST_ONE_SEP(\d+)?\s*\(\s*{/.source+l.source+_.source),x=new RegExp(w.source,"g"),T=/\.\s*AT_LEAST_ONE(\d+)?\s*\(/,A=new RegExp(T.source+s.source),M=new RegExp(T.source,"g"),S=/\.\s*OR(\d+)?\s*\(/,R=new RegExp(S.source+s.source),k=new RegExp(S.source,"g"),P=new RegExp(l.source+/\s*(ALT)\s*:/.source),L=new RegExp(P.source,"g");function C(e,n,i){switch(e.type){case r.AT_LEAST_ONE:return function(e,t,n){return I(A,new o.RepetitionMandatory({definition:[]}),e,t,n)}(e,n,i);case r.AT_LEAST_ONE_SEP:return function(e,t,n){return N(e,t,o.RepetitionMandatoryWithSeparator,w,n)}(e,n,i);case r.MANY_SEP:return function(e,t,n){return N(e,t,o.RepetitionWithSeparator,b,n)}(e,n,i);case r.MANY:return function(e,t,n){return I(v,new o.Repetition({definition:[]}),e,t,n)}(e,n,i);case r.OPTION:return function(e,t,n){return I(p,new o.Option({definition:[]}),e,t,n)}(e,n,i);case r.OR:return function(e,t,n){return I(R,new o.Alternation({definition:[]}),e,t,n)}(e,n,i);case r.FLAT:return function(e,t,n){var r=new o.Flat({definition:[]}),i=P.exec(e.text)[1];return a.isUndefined(i)||(r.name=i),F(r,e.range,t,n)}(e,n,i);case r.REF:return function(e){var t=h.exec(e.text),n=void 0===t[1]?0:parseInt(t[1],10),r=t[2];return new o.NonTerminal({nonTerminalName:r,idx:n})}(e);case r.TERMINAL:return function(e,n){var r=c.exec(e.text),i=void 0===r[1]?0:parseInt(r[1],10),a=r[2],s=t.terminalNameToConstructor[a];if(!s)throw Error("Terminal Token name: <"+a+"> not found in rule: <"+n+">  \n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#TERMINAL_NAME_NOT_FOUND\n\tFor Further details.");return new o.Terminal({terminalType:s,idx:i})}(e,i);default:throw Error("non exhaustive match")}}function I(e,t,n,r,i){var o=e.exec(n.text),s=void 0===o[1];t.idx=s?0:parseInt(o[1],10);var l=o[2];return a.isUndefined(l)||(t.name=l),F(t,n.range,r,i)}function N(e,n,r,i,o){var s=i.exec(e.text),l=void 0===s[1]?0:parseInt(s[1],10),c=s[3],u=t.terminalNameToConstructor[c];if(!u)throw Error("Separator Terminal Token name: "+c+" not found");var h=new r({definition:[],separator:u,idx:l}),d=s[2];return a.isUndefined(d)||(h.name=d),F(h,e.range,n,o)}function F(e,t,n,r){var i=O(t,n),o=a.sortBy(i,(function(e){return e.range.start})),s=[];return a.forEach(o,(function(e){s.push(C(e,n,r))})),e.definition=s,e}function O(e,t){return a.filter(t,(function(n){var r=e.strictlyContainsRange(n.range),i=a.every(t,(function(t){var r=t.range.strictlyContainsRange(n.range),i=t.range.isStrictlyContainedInRange(e);return!(r&&i)}));return r&&i}))}t.terminalNameToConstructor={},t.buildTopProduction=function(e,n,r){t.terminalNameToConstructor=r;var a=G(j(z("  "+e)));return function(e,t,n,r){return F(new o.Rule({name:e,definition:[],orgText:r}),t,n,e)}(n,new i.Range(0,e.length+2),a,e)},t.buildProdGast=C,t.getDirectlyContainedRanges=O;var H=/\/\/.*/g,D=/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\//g,U=/(NAME\s*:\s*)?"([^\\"]|\\([bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/g,B=/(NAME\s*:\s*)?'([^\\']|\\([bfnrtv'\\\/]|u[0-9a-fA-F]{4}))*'/g;function z(e){return e.replace(H,"").replace(D,"")}function V(e,t){return void 0!==t?e:""}function j(e){return e.replace(U,V).replace(B,V)}function G(e){var t=W(e),n=q(e),r=X(e),i=Y(e),a=K(e),o=Z(e),s=Q(e),l=J(e);return[].concat(t,n,r,i,a,o,s,l)}function W(e){return ne(e,r.TERMINAL,u)}function q(e){return ne(e,r.REF,d)}function X(e){return re(e,r.AT_LEAST_ONE,M)}function Y(e){return re(e,r.AT_LEAST_ONE_SEP,x)}function K(e){return re(e,r.MANY,y)}function Z(e){return re(e,r.MANY_SEP,E)}function Q(e){return re(e,r.OPTION,m)}function J(e){var t=re(e,r.OR,k),n=te(t);return t.concat(n)}t.removeComments=z,t.removeStringLiterals=j,t.createRanges=G,t.createTerminalRanges=W,t.createRefsRanges=q,t.createAtLeastOneRanges=X,t.createAtLeastOneSepRanges=Y,t.createManyRanges=K,t.createManySepRanges=Z,t.createOptionRanges=Q,t.createOrRanges=J;var $=a.partial(ae,"{","}"),ee=a.partial(ae,"(",")");function te(e){var t=[];return a.forEach(e,(function(e){var n=ie(e.text,r.FLAT,L,$),i=e.range.start;a.forEach(n,(function(e){e.range.start+=i,e.range.end+=i})),t=t.concat(n)})),a.uniq(t,(function(e){return e.type+"~"+e.range.start+"~"+e.range.end+"~"+e.text}))}function ne(e,t,n){for(var r,a=[];r=n.exec(e);){var o=r.index,s=n.lastIndex,l=new i.Range(o,s),c=r[0];a.push({range:l,text:c,type:t})}return a}function re(e,t,n){return ie(e,t,n,ee)}function ie(e,t,n,r){for(var a,o=[];a=n.exec(e);){var s=a.index,l=r(s+a[0].length,e),c=new i.Range(s,l),u=e.substr(s,l-s+1);o.push({range:c,text:u,type:t})}return o}function ae(e,t,n,r){for(var i=[1],o=-1;!a.isEmpty(i)&&o+n<r.length;){o++;var s=r.charAt(n+o);s===e?i.push(1):s===t&&i.pop()}if(a.isEmpty(i))return o+n;throw new Error("INVALID INPUT TEXT, UNTERMINATED PARENTHESIS")}function oe(e,t){return a.map(e,(function(e){return se(e,t)}))}function se(e,t){switch(e.type){case"NonTerminal":return new o.NonTerminal({nonTerminalName:e.name,idx:e.idx});case"Flat":return new o.Flat({name:e.name,definition:oe(e.definition,t)});case"Option":return new o.Option({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatory":return new o.RepetitionMandatory({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatoryWithSeparator":return new o.RepetitionMandatoryWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"RepetitionWithSeparator":return new o.RepetitionWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"Repetition":return new o.Repetition({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Alternation":return new o.Alternation({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Terminal":return new o.Terminal({terminalType:t[e.name],idx:e.idx});case"Rule":return new o.Rule({name:e.name,orgText:e.orgText,definition:oe(e.definition,t)})}}t.createOrPartRanges=te,t.findClosingOffset=ae,t.deserializeGrammar=oe,t.deserializeProduction=se},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(4),a=n(30),o=n(11),s=n(10),l=n(8);t.resolveGrammar=function(e){e=r.defaults(e,{errMsgProvider:s.defaultGrammarResolverErrorProvider});var t=new i.HashTable;return r.forEach(e.rules,(function(e){t.put(e.name,e)})),a.resolveGrammar(t,e.errMsgProvider)},t.validateGrammar=function(e){return e=r.defaults(e,{errMsgProvider:s.defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),o.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)},t.assignOccurrenceIndices=function(e){r.forEach(e.rules,(function(e){var t=new l.DslMethodsCollectorVisitor;e.accept(t),r.forEach(t.dslMethods,(function(e){r.forEach(e,(function(e,t){e.idx=t+1}))}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(0),a=n(6),o=n(22),s=n(4),l=n(3);function c(e){this.name=t.IN_RULE_RECOVERY_EXCEPTION,this.message=e}t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",t.InRuleRecoveryException=c,c.prototype=Error.prototype;var u=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap=new s.HashTable,this.resyncFollows=new s.HashTable,this.recoveryEnabled=i.has(e,"recoveryEnabled")?e.recoveryEnabled:l.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=h)},e.prototype.getTokenToInsert=function(e){var t=r.createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,n,r){for(var o=this,s=this.findReSyncTokenType(),l=this.exportLexerState(),c=[],u=!1,h=this.LA(1),d=this.LA(1),f=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:r,actual:h,previous:e,ruleName:o.getCurrRuleFullName()}),n=new a.MismatchedTokenException(t,h,o.LA(0));n.resyncedTokens=i.dropRight(c),o.SAVE_ERROR(n)};!u;){if(this.tokenMatcher(d,r))return void f();if(n.call(this))return f(),void e.apply(this,t);this.tokenMatcher(d,s)?u=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,c))}this.importLexerState(l)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t){return void 0!==e&&void 0!==t&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var n=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(n)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new c("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var n=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if(i.isEmpty(t))return!1;var r=this.LA(1);return void 0!==i.find(t,(function(e){return n.tokenMatcher(r,e)}))},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(t);return i.contains(n,e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),n=2;;){var r=t.tokenType;if(i.contains(e,r))return r;t=this.LA(n),n++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return t.EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,n=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(n=i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_STACK[t]})),r=i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_OCCURRENCE_STACK[t]}))),i.map(n,(function(i,a){return 0===a?t.EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(i),idxInCallingRule:r[a],inRule:e.shortRuleNameToFullName(n[a-1])}}))},e.prototype.flattenFollowSet=function(){var e=this,t=i.map(this.buildFullFollowKeyStack(),(function(t){return e.getFollowSetFromFollowKey(t)}));return i.flatten(t)},e.prototype.getFollowSetFromFollowKey=function(e){if(e===t.EOF_FOLLOW_KEY)return[r.EOF];var n=e.ruleName+e.idxInCallingRule+o.IN+e.inRule;return this.resyncFollows.get(n)},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,r.EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],n=this.LA(1);!1===this.tokenMatcher(n,e);)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,t);return i.dropRight(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,n,r,i,a){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)?i.map(this.RULE_STACK,(function(t){return e.shortRuleNameToFullName(t)})):i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])}))},e}();function h(e,t,n,i,a,o){var s=this.getKeyForAutomaticLookahead(i,a),l=this.firstAfterRepMap.get(s);if(void 0===l){var c=this.getCurrRuleFullName();l=new o(this.getGAstProductions().get(c),a).startWalking(),this.firstAfterRepMap.put(s,l)}var u=l.token,h=l.occurrence,d=l.isEndOfRule;1===this.RULE_STACK.length&&d&&void 0===u&&(u=r.EOF,h=1),this.shouldInRepetitionRecoveryBeTried(u,h)&&this.tryInRepetitionRecovery(e,t,n,u)}t.Recoverable=u,t.attemptInRepetitionRecovery=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(14),o=n(4),s=n(21),l=n(0),c=n(22),u=n(2),h=n(1),d=function(e){function t(t){var n=e.call(this)||this;return n.topProd=t,n.follows=new o.HashTable,n}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,n){},t.prototype.walkProdRef=function(e,t,n){var r=f(e.referencedRule,e.idx)+this.topProd.name,i=t.concat(n),a=new h.Flat({definition:i}),o=s.first(a);this.follows.put(r,o)},t}(a.RestWalker);function f(e,t){return e.name+t+c.IN}t.ResyncFollowsWalker=d,t.computeAllProdsFollows=function(e){var t=new o.HashTable;return l.forEach(e,(function(e){var n=new d(e).startWalking();t.putAll(n)})),t},t.buildBetweenProdsFollowPrefix=f,t.buildInProdFollowPrefix=function(e){return u.tokenName(e.terminalType)+e.idx+c.IN}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(19),o=n(2),s=n(15),l=n(0),c=n(28),u=new a.RegExpParser,h="PATTERN";function d(e){var t=l.filter(e,(function(e){return!l.has(e,h)}));return{errors:l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- missing static 'PATTERN' property",type:s.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}})),valid:l.difference(e,t)}}function f(e){var t=l.filter(e,(function(e){var t=e[h];return!(l.isRegExp(t)||l.isFunction(t)||l.has(t,"exec")||l.isString(t))}));return{errors:l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:s.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}})),valid:l.difference(e,t)}}t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,t.disableSticky=function(){t.SUPPORT_STICKY=!1},t.enableSticky=function(){t.SUPPORT_STICKY=!0},t.analyzeTokenTypes=function(e,n){n=l.defaults(n,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"]});var r=l.reject(e,(function(e){return e[h]===s.Lexer.NA})),i=!1,a=l.map(r,(function(e){var t=e[h];if(l.isRegExp(t)){var r=t.source;return 1===r.length&&"^"!==r&&"$"!==r&&"."!==r?r:2!==r.length||"\\"!==r[0]||l.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],r[1])?n.useSticky?A(t):T(t):r[1]}if(l.isFunction(t))return i=!0,{exec:t};if(l.has(t,"exec"))return i=!0,t;if("string"==typeof t){if(1===t.length)return t;var a=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(a);return n.useSticky?A(o):T(o)}throw Error("non exhaustive match")})),u=l.map(r,(function(e){return e.tokenTypeIdx})),d=l.map(r,(function(e){var t=e.GROUP;if(t!==s.Lexer.SKIPPED){if(l.isString(t))return t;if(l.isUndefined(t))return!1;throw Error("non exhaustive match")}})),f=l.map(r,(function(e){var t=e.LONGER_ALT;if(t)return l.indexOf(r,t)})),p=l.map(r,(function(e){return e.PUSH_MODE})),m=l.map(r,(function(e){return l.has(e,"POP_MODE")})),g=P(n.lineTerminatorCharacters),v=l.map(r,(function(e){return!1}));"onlyOffset"!==n.positionTracking&&(v=l.map(r,(function(e){return l.has(e,"LINE_BREAKS")?e.LINE_BREAKS:!1===R(e,g)?c.canMatchCharCode(g,e.PATTERN):void 0})));var y=l.map(r,M),_=l.map(a,S),b=l.reduce(r,(function(e,t){var n=t.GROUP;return l.isString(n)&&n!==s.Lexer.SKIPPED&&(e[n]=[]),e}),{}),E=l.map(a,(function(e,t){return{pattern:a[t],longerAlt:f[t],canLineTerminator:v[t],isCustom:y[t],short:_[t],group:d[t],push:p[t],pop:m[t],tokenTypeIdx:u[t],tokenType:r[t]}}));function w(e,t,n){void 0===e[t]&&(e[t]=[]),e[t].push(n)}var x=!0,k=[];return n.safeMode||(k=l.reduce(r,(function(e,t,r){if("string"==typeof t.PATTERN){var i=t.PATTERN.charCodeAt(0);w(e,i,E[r])}else if(l.isArray(t.START_CHARS_HINT))l.forEach(t.START_CHARS_HINT,(function(t){var n="string"==typeof t?t.charCodeAt(0):t;w(e,n,E[r])}));else if(l.isRegExp(t.PATTERN))if(t.PATTERN.unicode)x=!1,n.ensureOptimizations&&l.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var a=c.getStartCodes(t.PATTERN,n.ensureOptimizations);l.isEmpty(a)&&(x=!1),l.forEach(a,(function(t){w(e,t,E[r])}))}else n.ensureOptimizations&&l.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tTokenType: <"+o.tokenName(t)+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),x=!1;return e}),[])),x&&k.length<65536&&(k=l.packArray(k)),{emptyGroups:b,patternIdxToConfig:E,charCodeToPatternIdxToConfig:k,hasCustom:i,canBeOptimized:x}},t.validatePatterns=function(e,t){var n=[],r=d(e);n=n.concat(r.errors);var i=f(r.valid),a=i.valid;return(n=(n=(n=(n=n.concat(i.errors)).concat(function(e){var t=[],n=l.filter(e,(function(e){return l.isRegExp(e[h])}));return(t=(t=(t=(t=t.concat(m(n))).concat(y(n))).concat(_(n))).concat(b(n))).concat(g(n))}(a))).concat(E(a))).concat(w(a,t))).concat(x(a))},t.findMissingPatterns=d,t.findInvalidPatterns=f;var p=/[^\\][\$]/;function m(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),n=l.filter(e,(function(e){var n=e[h];try{var r=u.pattern(n.toString()),i=new t;return i.visit(r),i.found}catch(e){return p.test(n.source)}}));return l.map(n,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function g(e){var t=l.filter(e,(function(e){return e[h].test("")}));return l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' must not match an empty string",type:s.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}}))}t.findEndOfInputAnchor=m,t.findEmptyMatchRegExps=g;var v=/[^\\[][\^]|^\^/;function y(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),n=l.filter(e,(function(e){var n=e[h];try{var r=u.pattern(n.toString()),i=new t;return i.visit(r),i.found}catch(e){return v.test(n.source)}}));return l.map(n,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function _(e){var t=l.filter(e,(function(e){var t=e[h];return t instanceof RegExp&&(t.multiline||t.global)}));return l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:s.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}}))}function b(e){var t=[],n=l.map(e,(function(n){return l.reduce(e,(function(e,r){return n.PATTERN.source!==r.PATTERN.source||l.contains(t,r)||r.PATTERN===s.Lexer.NA||(t.push(r),e.push(r)),e}),[])}));n=l.compact(n);var r=l.filter(n,(function(e){return e.length>1}));return l.map(r,(function(e){var t=l.map(e,(function(e){return o.tokenName(e)}));return{message:"The same RegExp pattern ->"+l.first(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:s.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}}))}function E(e){var t=l.filter(e,(function(e){if(!l.has(e,"GROUP"))return!1;var t=e.GROUP;return t!==s.Lexer.SKIPPED&&t!==s.Lexer.NA&&!l.isString(t)}));return l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:s.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}}))}function w(e,t){var n=l.filter(e,(function(e){return void 0!==e.PUSH_MODE&&!l.contains(t,e.PUSH_MODE)}));return l.map(n,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:s.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}}))}function x(e){var t=[],n=l.reduce(e,(function(e,t,n){var r,i=t.PATTERN;return i===s.Lexer.NA||(l.isString(i)?e.push({str:i,idx:n,tokenType:t}):l.isRegExp(i)&&(r=i,void 0===l.find([".","\\","[","]","|","^","$","(",")","?","*","+","{"],(function(e){return-1!==r.source.indexOf(e)})))&&e.push({str:i.source,idx:n,tokenType:t})),e}),[]);return l.forEach(e,(function(e,r){l.forEach(n,(function(n){var i=n.str,a=n.idx,c=n.tokenType;if(r<a&&function(e,t){if(l.isRegExp(t)){var n=t.exec(e);return null!==n&&0===n.index}if(l.isFunction(t))return t(e,0,[],{});if(l.has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(i,e.PATTERN)){var u="Token: ->"+o.tokenName(c)+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+o.tokenName(e)+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:u,type:s.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,c]})}}))})),t}function T(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function A(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function M(e){var t=e.PATTERN;if(l.isRegExp(t))return!1;if(l.isFunction(t))return!0;if(l.has(t,"exec"))return!0;if(l.isString(t))return!1;throw Error("non exhaustive match")}function S(e){return!(!l.isString(e)||1!==e.length)&&e.charCodeAt(0)}function R(e,t){if(l.has(e,"LINE_BREAKS"))return!1;if(l.isRegExp(e.PATTERN)){try{c.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(l.isString(e.PATTERN))return!1;if(M(e))return{issue:s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function k(e,t){if(t.issue===s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function P(e){return l.map(e,(function(e){return l.isString(e)&&e.length>0?e.charCodeAt(0):e}))}t.findStartOfInputAnchor=y,t.findUnsupportedFlags=_,t.findDuplicatePatterns=b,t.findInvalidGroupType=E,t.findModesThatDoNotExist=w,t.findUnreachablePatterns=x,t.addStartOfInput=T,t.addStickyFlag=A,t.performRuntimeChecks=function(e,n,r){var i=[];return l.has(e,t.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),l.has(e,t.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),l.has(e,t.MODES)&&l.has(e,t.DEFAULT_MODE)&&!l.has(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a "+t.DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),l.has(e,t.MODES)&&l.forEach(e.modes,(function(e,t){l.forEach(e,(function(e,n){l.isUndefined(e)&&i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+n+">\n",type:s.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})}))})),i},t.performWarningRuntimeChecks=function(e,t,n){var r=[],i=!1,a=l.compact(l.flatten(l.mapValues(e.modes,(function(e){return e})))),o=l.reject(a,(function(e){return e[h]===s.Lexer.NA})),u=P(n);return t&&l.forEach(o,(function(e){var t=R(e,u);if(!1!==t){var n={message:k(e,t),type:t.issue,tokenType:e};r.push(n)}else l.has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):c.canMatchCharCode(u,e.PATTERN)&&(i=!0)})),t&&!i&&r.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:s.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),r},t.cloneEmptyGroups=function(e){var t={},n=l.keys(e);return l.forEach(n,(function(n){var r=e[n];if(!l.isArray(r))throw Error("non exhaustive match");t[n]=[]})),t},t.isCustomPattern=M,t.isShortPattern=S,t.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,n=this.lastIndex;n<t;n++){var r=e.charCodeAt(n);if(10===r)return this.lastIndex=n+1,!0;if(13===r)return 10===e.charCodeAt(n+1)?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0},t.buildLineBreakIssueMessage=k},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(19),o=n(0),s=new a.RegExpParser,l="Complement Sets are not supported for first char optimization";function c(e){switch(e.type){case"Disjunction":return o.flatten(o.map(e.value,c));case"Alternative":for(var t=[],n=e.value,r=0;r<n.length;r++){var i=n[r];if(!o.contains(["GroupBackReference","Lookahead","NegativeLookahead","StartAnchor","EndAnchor","WordBoundary","NonWordBoundary"],i.type)){var a=i;switch(a.type){case"Character":t.push(a.value);break;case"Set":if(!0===a.complement)throw Error(l);o.forEach(a.value,(function(e){if("number"==typeof e)t.push(e);else for(var n=e,r=n.from;r<=n.to;r++)t.push(r)}));break;case"Group":var s=c(a.value);o.forEach(s,(function(e){return t.push(e)}));break;default:throw Error("Non Exhaustive Match")}var u=void 0!==a.quantifier&&0===a.quantifier.atLeast;if("Group"===a.type&&!1===d(a)||"Group"!==a.type&&!1===u)break}}return t;default:throw Error("non exhaustive match!")}}function u(e){var t=[];return o.forEach(e,(function(e){t.push(e);var n=String.fromCharCode(e);n.toUpperCase()!==n?t.push(n.toUpperCase().charCodeAt(0)):n.toLowerCase()!==n&&t.push(n.toLowerCase().charCodeAt(0))})),t}function h(e,t){return o.find(e.value,(function(e){if("number"==typeof e)return o.contains(t,e);var n=e;return void 0!==o.find(t,(function(e){return n.from<=e&&e<=n.to}))}))}function d(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(o.isArray(e.value)?o.every(e.value,d):d(e.value))}t.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',t.getStartCodes=function(e,n){void 0===n&&(n=!1);try{var r=s.pattern(e.toString()),i=c(r.value);return r.flags.ignoreCase&&(i=u(i)),i}catch(r){if(r.message===l)n&&o.PRINT_WARNING(t.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var h="";n&&(h="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),o.PRINT_ERROR(t.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+a.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+h)}}return[]},t.firstChar=c,t.applyIgnoreCase=u;var f=function(e){function t(t){var n=e.call(this)||this;return n.targetCharCodes=t,n.found=!1,n}return i(t,e),t.prototype.visitChildren=function(t){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)},t.prototype.visitCharacter=function(e){o.contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===h(e,this.targetCharCodes)&&(this.found=!0):void 0!==h(e,this.targetCharCodes)&&(this.found=!0)},t}(a.BaseRegExpVisitor);t.canMatchCharCode=function(e,t){if(t instanceof RegExp){var n=s.pattern(t.toString()),r=new f(e);return r.visit(n),r.found}return void 0!==o.find(t,(function(t){return o.contains(e,t.charCodeAt(0))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){if(this.start=e,this.end=t,!i(e,t))throw new Error("INVALID RANGE")}return e.prototype.contains=function(e){return this.start<=e&&this.end>=e},e.prototype.containsRange=function(e){return this.start<=e.start&&this.end>=e.end},e.prototype.isContainedInRange=function(e){return e.containsRange(this)},e.prototype.strictlyContainsRange=function(e){return this.start<e.start&&this.end>e.end},e.prototype.isStrictlyContainedInRange=function(e){return e.strictlyContainsRange(this)},e}();function i(e,t){return!(e<0||t<e)}t.Range=r,t.isValidRange=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),o=n(0),s=n(5);t.resolveGrammar=function(e,t){var n=new l(e,t);return n.resolveRefs(),n.errors};var l=function(e){function t(t,n){var r=e.call(this)||this;return r.nameToTopRule=t,r.errMsgProvider=n,r.errors=[],r}return i(t,e),t.prototype.resolveRefs=function(){var e=this;o.forEach(this.nameToTopRule.values(),(function(t){e.currTopLevel=t,t.accept(e)}))},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule.get(e.nonTerminalName);if(t)e.referencedRule=t;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:a.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(s.GAstVisitor);t.GastRefResolverVisitor=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=n(0),a=n(3),o=n(9),s=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=i.has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:a.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=i.has(e,"maxLookahead")?e.maxLookahead:a.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=i.isES2015MapSupported()?new Map:[],i.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.lookAheadBuilderForOptional=function(e,t,n){return r.buildSingleAlternativeLookaheadFunction(e,t,n)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,n,i){return r.buildAlternativesLookAheadFunc(e,t,n,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var n=this.getLastExplicitRuleShortName();return o.getKeyForAutomaticLookahead(n,e,t)},e.prototype.getLookaheadFuncForOr=function(e,t){var n=this.getKeyForAutomaticLookahead(o.OR_IDX,e),a=this.getLaFuncFromCache(n);if(void 0===a){var s=this.getCurrRuleFullName(),l=this.getGAstProductions().get(s),c=i.some(t,(function(e){return i.isFunction(e.GATE)}));return a=r.buildLookaheadFuncForOr(e,l,this.maxLookahead,c,this.dynamicTokensEnabled,this.lookAheadBuilderForAlternatives),this.setLaFuncCache(n,a),a}return a},e.prototype.getLookaheadFuncForOption=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,r.PROD_TYPE.OPTION)},e.prototype.getLookaheadFuncForMany=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,r.PROD_TYPE.REPETITION)},e.prototype.getLookaheadFuncForManySep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,r.PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.getLookaheadFuncForAtLeastOne=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,r.PROD_TYPE.REPETITION_MANDATORY)},e.prototype.getLookaheadFuncForAtLeastOneSep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,r.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.getLookaheadFuncFor=function(e,t,n,i){var a=this.getLaFuncFromCache(e);if(void 0===a){var o=this.getCurrRuleFullName(),s=this.getGAstProductions().get(o);return a=r.buildLookaheadFuncForOptionalProd(t,s,n,this.dynamicTokensEnabled,i,this.lookAheadBuilderForOptional),this.setLaFuncCache(e,a),a}return a},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();t.LooksAhead=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),i=n(0),a=n(33),o=n(9),s=n(3),l=function(){function e(){}return e.prototype.initTreeBuilder=function(e){this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=i.has(e,"outputCst")?e.outputCst:s.DEFAULT_PARSER_CONFIG.outputCst,this.outputCst||(this.cstInvocationStateUpdate=i.NOOP,this.cstFinallyStateUpdate=i.NOOP,this.cstPostTerminal=i.NOOP,this.cstPostNonTerminal=i.NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst)},e.prototype.cstNestedInvocationStateUpdate=function(e,t){this.CST_STACK.push({name:e,fullName:this.shortRuleNameToFull.get(this.getLastExplicitRuleShortName())+e,children:{}})},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1),this.CST_STACK.push({name:e,children:{}})},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostTerminal=function(e,t){var n=this.CST_STACK[this.CST_STACK.length-1];r.addTerminalToCst(n,t,e)},e.prototype.cstPostNonTerminal=function(e,t){r.addNoneTerminalToCst(this.CST_STACK[this.CST_STACK.length-1],t,e)},e.prototype.getBaseCstVisitorConstructor=function(){if(i.isUndefined(this.baseCstVisitorConstructor)){var e=a.createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(i.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=a.createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var n;return void 0!==e.NAME?(n=e.NAME,this.nestedRuleInvocationStateUpdate(n,t),n):void 0},e.prototype.nestedAltBeforeClause=function(e,t,n,r){var i,a=this.getLastExplicitRuleShortName(),s=o.getKeyForAltIndex(a,n,t,r);return void 0!==e.NAME?(i=e.NAME,this.nestedRuleInvocationStateUpdate(i,s),{shortName:s,nestedName:i}):void 0},e.prototype.nestedRuleFinallyClause=function(e,t){var n=this.CST_STACK,i=n[n.length-1];this.nestedRuleFinallyStateUpdate();var a=n[n.length-1];r.addNoneTerminalToCst(a,t,i)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}();t.TreeBuilder=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),a=n(4),o=n(11);function s(e,t){for(var n=i.keys(e),r=n.length,a=0;a<r;a++)for(var o=e[n[a]],s=o.length,l=0;l<s;l++){var c=o[l];void 0===c.tokenTypeIdx&&(void 0!==c.fullName?this[c.fullName](c.children,t):this[c.name](c.children,t))}}function l(e,t){var n=c(e,t),r=h(e,t);return n.concat(r)}function c(e,t){var n=i.map(t,(function(t){if(!i.isFunction(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+a.functionName(e.constructor)+" CST Visitor.",type:r.MISSING_METHOD,methodName:t}}));return i.compact(n)}t.defaultVisit=s,t.createBaseSemanticVisitorConstructor=function(e,t){var n=function(){};return a.defineNameProp(n,e+"BaseSemantics"),(n.prototype={visit:function(e,t){if(i.isArray(e)&&(e=e[0]),!i.isUndefined(e))return void 0!==e.fullName?this[e.fullName](e.children,t):this[e.name](e.children,t)},validateVisitor:function(){var e=l(this,t);if(!i.isEmpty(e)){var n=i.map(e,(function(e){return e.msg}));throw Error("Errors Detected in CST Visitor <"+a.functionName(this.constructor)+">:\n\t"+n.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=n,n._RULE_NAMES=t,n},t.createBaseVisitorConstructorWithDefaults=function(e,t,n){var r=function(){};a.defineNameProp(r,e+"BaseSemanticsWithDefaults");var o=Object.create(n.prototype);return i.forEach(t,(function(e){o[e]=s})),(r.prototype=o).constructor=r,r},function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(r=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={})),t.validateVisitor=l,t.validateMissingCstMethods=c;var u=["constructor","visit","validateVisitor"];function h(e,t){var n=[];for(var s in e)o.validTermsPattern.test(s)&&i.isFunction(e[s])&&!i.contains(u,s)&&!i.contains(t,s)&&n.push({msg:"Redundant visitor method: <"+s+"> on "+a.functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+o.validTermsPattern.source+"/.",type:r.REDUNDANT_METHOD,methodName:s});return n}t.validateRedundantMethods=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):r.END_OF_FILE},e.prototype.LA=function(e){return this.currIdx+e<0||this.tokVectorLength<=this.currIdx+e?r.END_OF_FILE:this.tokVector[this.currIdx+e]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();t.LexerAdapter=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(6),a=n(3),o=n(10),s=n(23),l=n(11),c=n(1),u=function(){function e(){}return e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,n){if(void 0===n&&(n=a.DEFAULT_RULE_CONFIG),r.contains(this.definedRulesNames,e)){var i={message:o.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}if(this.definedRulesNames.push(e),!this.gastProductionsCache.containsKey(e)&&!this.serializedGrammar){var l=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,l)}var c=this.defineRule(e,t,n);return this[e]=c,c},e.prototype.OVERRIDE_RULE=function(e,t,n){void 0===n&&(n=a.DEFAULT_RULE_CONFIG);var r=[];if(r=r.concat(l.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,r),!this.serializedGrammar){var i=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,i)}var o=this.defineRule(e,t,n);return this[e]=o,o},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var n=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(i.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return c.serializeGrammar(this.gastProductionsCache.values())},e}();t.RecognizerApi=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(9),a=n(6),o=n(12),s=n(13),l=n(3),c=n(25),u=n(2),h=n(7),d=n(4),f=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=d.classNameFromInstance(this),this.shortRuleNameToFull=new d.HashTable,this.fullRuleNameToShort=new d.HashTable,this.ruleShortNameIdx=256,this.tokenMatcher=h.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache=new d.HashTable,this.serializedGrammar=r.has(t,"serializedGrammar")?t.serializedGrammar:l.DEFAULT_PARSER_CONFIG.serializedGrammar,r.isArray(e)){if(r.isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(r.isArray(e))this.tokensMap=r.reduce(e,(function(e,t){return e[u.tokenName(t)]=t,e}),{});else if(r.has(e,"modes")&&r.every(r.flatten(r.values(e.modes)),h.isTokenType)){var n=r.flatten(r.values(e.modes)),i=r.uniq(n);this.tokensMap=r.reduce(i,(function(e,t){return e[u.tokenName(t)]=t,e}),{})}else{if(!r.isObject(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=r.cloneObj(e)}this.tokensMap.EOF=u.EOF;var a=r.every(r.values(e),(function(e){return r.isEmpty(e.categoryMatches)}));this.tokenMatcher=a?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,h.augmentTokenTypes(r.values(this.tokensMap))},e.prototype.defineRule=function(e,t,n){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var o,s=r.has(n,"resyncEnabled")?n.resyncEnabled:l.DEFAULT_RULE_CONFIG.resyncEnabled,c=r.has(n,"recoveryValueFunc")?n.recoveryValueFunc:l.DEFAULT_RULE_CONFIG.recoveryValueFunc,u=this.ruleShortNameIdx<<i.BITS_FOR_METHOD_IDX+i.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull.put(u,e),this.fullRuleNameToShort.put(e,u),(o=function(n,r){return void 0===n&&(n=0),this.ruleInvocationStateUpdate(u,e,n),function(e){try{return!0===this.outputCst?(t.apply(this,e),this.CST_STACK[this.CST_STACK.length-1]):t.apply(this,e)}catch(e){var n=1===this.RULE_STACK.length,r=s&&!this.isBackTracking()&&this.recoveryEnabled;if(a.isRecognitionException(e)){if(r){var i,o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))return e.resyncedTokens=this.reSyncTo(o),this.outputCst?((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i):c();throw this.outputCst&&((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,e.partialCstResult=i),e}if(n)return this.moveToTerminatedState(),c();throw e}throw e}finally{this.ruleFinallyStateUpdate()}}.call(this,r)}).ruleName=e,o},e.prototype.optionInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t),r=this.nestedRuleBeforeClause(e,n);try{return this.optionInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.optionInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t);return this.optionInternalLogic(e,t,n)},e.prototype.optionInternalLogic=function(e,t,n){var r,i,a=this,o=this.getLookaheadFuncForOption(n,t);if(void 0!==e.DEF){if(r=e.DEF,void 0!==(i=e.GATE)){var s=o;o=function(){return i.call(a)&&s.call(a)}}}else r=e;if(!0===o.call(this))return r.call(this)},e.prototype.atLeastOneInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{return this.atLeastOneInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,n)},e.prototype.atLeastOneInternalLogic=function(e,t,n){var r,a,l=this,c=this.getLookaheadFuncForAtLeastOne(n,e);if(void 0!==t.DEF){if(r=t.DEF,void 0!==(a=t.GATE)){var u=c;c=function(){return a.call(l)&&u.call(l)}}}else r=t;if(!0!==c.call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var h=this.doSingleRepetition(r);!0===c.call(this)&&!0===h;)h=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],c,i.AT_LEAST_ONE_IDX,e,s.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{this.atLeastOneSepFirstInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,n)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,n){var r=this,a=t.DEF,l=t.SEP;if(!0!==this.getLookaheadFuncForAtLeastOneSep(n,e).call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);a.call(this);for(var c=function(){return r.tokenMatcher(r.LA(1),l)};!0===this.tokenMatcher(this.LA(1),l);)this.CONSUME(l),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,l,c,a,s.NextTerminalAfterAtLeastOneSepWalker],c,i.AT_LEAST_ONE_SEP_IDX,e,s.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(i.MANY_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{return this.manyInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.manyInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(i.MANY_IDX,e);return this.manyInternalLogic(e,t,n)},e.prototype.manyInternalLogic=function(e,t,n){var r,a,o=this,l=this.getLookaheadFuncForMany(n,e);if(void 0!==t.DEF){if(r=t.DEF,void 0!==(a=t.GATE)){var c=l;l=function(){return a.call(o)&&c.call(o)}}}else r=t;for(var u=!0;!0===l.call(this)&&!0===u;)u=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],l,i.MANY_IDX,e,s.NextTerminalAfterManyWalker)},e.prototype.manySepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{this.manySepFirstInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,n)},e.prototype.manySepFirstInternalLogic=function(e,t,n){var r=this,a=t.DEF,o=t.SEP;if(!0===this.getLookaheadFuncForManySep(n,e).call(this)){a.call(this);for(var l=function(){return r.tokenMatcher(r.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,l,a,s.NextTerminalAfterManySepWalker],l,i.MANY_SEP_IDX,e,s.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,n,r,a){for(;n();)this.CONSUME(t),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,n,r,a],n,i.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,t){var n=r.isArray(e)?e:e.DEF,i=this.getLookaheadFuncForOr(t,n).call(this,n);if(void 0!==i)return n[i].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.orInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(i.OR_IDX,t),a=this.nestedRuleBeforeClause(e,n);try{var o=r.isArray(e)?e:e.DEF,s=this.getLookaheadFuncForOr(t,o).call(this,o);if(void 0!==s){var l=o[s],c=this.nestedAltBeforeClause(l,t,i.OR_IDX,s);try{return l.ALT.call(this)}finally{void 0!==c&&this.nestedRuleFinallyClause(c.shortName,c.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{void 0!==a&&this.nestedRuleFinallyClause(n,a)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new a.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,n){var r;try{var i=void 0!==n?n.ARGS:void 0;return r=e.call(this,t,i),this.cstPostNonTerminal(r,void 0!==n&&void 0!==n.LABEL?n.LABEL:e.ruleName),r}catch(t){throw a.isRecognitionException(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==n&&void 0!==n.LABEL?n.LABEL:e.ruleName),delete t.partialCstResult),t}},e.prototype.consumeInternal=function(e,t,n){var r;try{var i=this.LA(1);if(!0!==this.tokenMatcher(i,e)){var o=void 0,s=this.LA(0);throw o=void 0!==n&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:i,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new a.MismatchedTokenException(o,i,s))}this.consumeToken(),r=i}catch(n){if(!this.recoveryEnabled||"MismatchedTokenException"!==n.name||this.isBackTracking())throw n;var l=this.getFollowsForInRuleRecovery(e,t);try{r=this.tryInRuleRecovery(e,l)}catch(e){throw e.name===c.IN_RULE_RECOVERY_EXCEPTION?n:e}}return this.cstPostTerminal(void 0!==n&&void 0!==n.LABEL?n.LABEL:e.tokenName,r),r},e.prototype.saveRecogState=function(){var e=this.errors,t=r.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return!r.isEmpty(this.isBackTrackingStack)},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull.get(e)},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull.get(e)},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),u.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();t.RecognizerEngine=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(0),a=n(12),o=n(3),s=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=i.defaults(e.errorMessageProvider,o.DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(r.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return i.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,n){for(var i=this.getCurrRuleFullName(),o=this.getGAstProductions().get(i),s=a.getLookaheadPathsForOptionalProd(e,o,t,this.maxLookahead)[0],l=[],c=1;c<this.maxLookahead;c++)l.push(this.LA(c));var u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:l,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new r.EarlyExitException(u,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var n=this.getCurrRuleFullName(),i=this.getGAstProductions().get(n),o=a.getLookaheadPathsForOr(e,i,this.maxLookahead),s=[],l=1;l<=this.maxLookahead;l++)s.push(this.LA(l));var c=this.LA(0),u=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:c,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new r.NoViableAltException(u,this.LA(1),c))},e}();t.ErrorHandler=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(0),a=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var n=this.gastProductionsCache.get(e);if(i.isUndefined(n))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return r.nextPossibleTokensAfter([n],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=i.first(e.ruleStack),n=this.getGAstProductions().get(t);return new r.NextAfterTokenWalker(n,e).startWalking()},e}();t.ContentAssist=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17);t.createSyntaxDiagramsCode=function(e,t){var n=void 0===t?{}:t,i=n.resourceBase,a=void 0===i?"https://unpkg.com/chevrotain@"+r.VERSION+"/diagrams/":i,o=n.css;return"\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n\n<link rel='stylesheet' href='"+(void 0===o?"https://unpkg.com/chevrotain@"+r.VERSION+"/diagrams/diagrams.css":o)+"'>\n\n<script src='"+a+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+a+"src/diagrams_builder.js'><\/script>\n<script src='"+a+"src/diagrams_behavior.js'><\/script>\n<script src='"+a+'src/main.js\'><\/script>\n\n<div id="diagrams" align="center"></div>    \n\n<script>\n    window.serializedGrammar = '+JSON.stringify(e,null,"  ")+';\n<\/script>\n\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41);t.generateParserFactory=function(e){var t=r.genWrapperFunction({name:e.name,rules:e.rules}),i=new Function("tokenVocabulary","config","chevrotain",t);return function(t){return i(e.tokenVocabulary,t,n(18))}},t.generateParserModule=function(e){return r.genUmdModule({name:e.name,rules:e.rules})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(2),a=n(1),o="\n";function s(e){return"\nfunction "+e.name+"(tokenVocabulary, config) {\n    // invoke super constructor\n    // No support for embedded actions currently, so we can 'hardcode'\n    // The use of CstParser.\n    chevrotain.CstParser.call(this, tokenVocabulary, config)\n\n    const $ = this\n\n    "+l(e.rules)+"\n\n    // very important to call this after all the rules have been defined.\n    // otherwise the parser may not work correctly as it will lack information\n    // derived during the self analysis phase.\n    this.performSelfAnalysis(this)\n}\n\n// inheritance as implemented in javascript in the previous decade... :(\n"+e.name+".prototype = Object.create(chevrotain.CstParser.prototype)\n"+e.name+".prototype.constructor = "+e.name+"    \n    "}function l(e){return r.map(e,(function(e){return c(e,1)})).join("\n")}function c(e,t){var n=v(t,'$.RULE("'+e.name+'", function() {')+o;return(n+=g(e.definition,t+1))+(v(t+1,"})")+o)}function u(e,t){var n=i.tokenName(e.terminalType);return v(t,"$.CONSUME"+e.idx+"(this.tokensMap."+n+")"+o)}function h(e,t){return v(t,"$.SUBRULE"+e.idx+"($."+e.nonTerminalName+")"+o)}function d(e,t){var n=v(t,"$.OR"+e.idx+"([")+o;return(n+=r.map(e.definition,(function(e){return f(e,t+1)})).join(","+o))+(o+v(t,"])"+o))}function f(e,t){var n=v(t,"{")+o;return e.name&&(n+=v(t+1,'NAME: "'+e.name+'",')+o),n+=v(t+1,"ALT: function() {")+o,n+=g(e.definition,t+1),(n+=v(t+1,"}")+o)+v(t,"}")}function p(e,t,n){var r=v(n,"$."+(e+t.idx)+"(");return t.name||t.separator?(r+="{"+o,t.name&&(r+=v(n+1,'NAME: "'+t.name+'"')+","+o),t.separator&&(r+=v(n+1,"SEP: this.tokensMap."+i.tokenName(t.separator))+","+o),r+="DEF: "+m(t.definition,n+2)+o,r+=v(n,"}")+o):r+=m(t.definition,n+1),r+(v(n,")")+o)}function m(e,t){var n="function() {"+o;return(n+=g(e,t))+(v(t,"}")+o)}function g(e,t){var n="";return r.forEach(e,(function(e){n+=function(e,t){if(e instanceof a.NonTerminal)return h(e,t);if(e instanceof a.Option)return p("OPTION",e,t);if(e instanceof a.RepetitionMandatory)return p("AT_LEAST_ONE",e,t);if(e instanceof a.RepetitionMandatoryWithSeparator)return p("AT_LEAST_ONE_SEP",e,t);if(e instanceof a.RepetitionWithSeparator)return p("MANY_SEP",e,t);if(e instanceof a.Repetition)return p("MANY",e,t);if(e instanceof a.Alternation)return d(e,t);if(e instanceof a.Terminal)return u(e,t);if(e instanceof a.Flat)return g(e.definition,t);throw Error("non exhaustive match")}(e,t+1)})),n}function v(e,t){return Array(4*e+1).join(" ")+t}t.genUmdModule=function(e){return"\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['chevrotain'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('chevrotain'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(root.b);\n    }\n}(typeof self !== 'undefined' ? self : this, function (chevrotain) {\n\n"+s(e)+"\n    \nreturn {\n    "+e.name+": "+e.name+" \n}\n}));\n"},t.genWrapperFunction=function(e){return"    \n"+s(e)+"\nreturn new "+e.name+"(tokenVocabulary, config)    \n"},t.genClass=s,t.genAllRules=l,t.genRule=c,t.genTerminal=u,t.genNonTerminal=h,t.genAlternation=d,t.genSingleAlt=f}])},6549:function(e){e.exports=function(){"use strict";var e=Math.pow(2,-52),t=function(t){var o=t.length>>1;if(o>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;var s=2*o-5,l=this.triangles=new Uint32Array(3*s),c=this.halfedges=new Int32Array(3*s);this._hashSize=Math.ceil(Math.sqrt(o));for(var u=this.hullPrev=new Uint32Array(o),h=this.hullNext=new Uint32Array(o),d=this.hullTri=new Uint32Array(o),f=new Int32Array(this._hashSize).fill(-1),p=new Uint32Array(o),m=1/0,g=1/0,v=-1/0,y=-1/0,_=0;_<o;_++){var b=t[2*_],E=t[2*_+1];b<m&&(m=b),E<g&&(g=E),b>v&&(v=b),E>y&&(y=E),p[_]=_}for(var w,x,T,A=(m+v)/2,M=(g+y)/2,S=1/0,R=0;R<o;R++){var k=n(A,M,t[2*R],t[2*R+1]);k<S&&(w=R,S=k)}var P=t[2*w],L=t[2*w+1];S=1/0;for(var C=0;C<o;C++)if(C!==w){var I=n(P,L,t[2*C],t[2*C+1]);I<S&&I>0&&(x=C,S=I)}for(var N=t[2*x],F=t[2*x+1],O=1/0,H=0;H<o;H++)if(H!==w&&H!==x){var D=i(P,L,N,F,t[2*H],t[2*H+1]);D<O&&(T=H,O=D)}var U=t[2*T],B=t[2*T+1];if(O===1/0)throw new Error("No Delaunay triangulation exists for this input.");if(r(P,L,N,F,U,B)){var z=x,V=N,j=F;x=T,N=U,F=B,T=z,U=V,B=j}var G=function(e,t,n,r,i,a){var o=n-e,s=r-t,l=i-e,c=a-t,u=o*o+s*s,h=l*l+c*c,d=.5/(o*c-s*l);return{x:e+(c*u-s*h)*d,y:t+(o*h-l*u)*d}}(P,L,N,F,U,B);this._cx=G.x,this._cy=G.y;for(var W=new Float64Array(o),q=0;q<o;q++)W[q]=n(t[2*q],t[2*q+1],G.x,G.y);!function e(t,n,r,i){if(i-r<=20)for(var o=r+1;o<=i;o++){for(var s=t[o],l=n[s],c=o-1;c>=r&&n[t[c]]>l;)t[c+1]=t[c--];t[c+1]=s}else{var u=r+1,h=i;a(t,r+i>>1,u),n[t[r]]>n[t[i]]&&a(t,r,i),n[t[u]]>n[t[i]]&&a(t,u,i),n[t[r]]>n[t[u]]&&a(t,r,u);for(var d=t[u],f=n[d];;){do{u++}while(n[t[u]]<f);do{h--}while(n[t[h]]>f);if(h<u)break;a(t,u,h)}t[r+1]=t[h],t[h]=d,i-u+1>=h-r?(e(t,n,u,i),e(t,n,r,h-1)):(e(t,n,r,h-1),e(t,n,u,i))}}(p,W,0,o-1),this.hullStart=w;var X=3;h[w]=u[T]=x,h[x]=u[w]=T,h[T]=u[x]=w,d[w]=0,d[x]=1,d[T]=2,f[this._hashKey(P,L)]=w,f[this._hashKey(N,F)]=x,f[this._hashKey(U,B)]=T,this.trianglesLen=0,this._addTriangle(w,x,T,-1,-1,-1);for(var Y=0,K=void 0,Z=void 0;Y<p.length;Y++){var Q=p[Y],J=t[2*Q],$=t[2*Q+1];if(!(Y>0&&Math.abs(J-K)<=e&&Math.abs($-Z)<=e)&&(K=J,Z=$,Q!==w&&Q!==x&&Q!==T)){for(var ee=0,te=0,ne=this._hashKey(J,$);te<this._hashSize&&(-1===(ee=f[(ne+te)%this._hashSize])||ee===h[ee]);te++);for(var re=ee=u[ee],ie=void 0;ie=h[re],!r(J,$,t[2*re],t[2*re+1],t[2*ie],t[2*ie+1]);)if((re=ie)===ee){re=-1;break}if(-1!==re){var ae=this._addTriangle(re,Q,h[re],-1,-1,d[re]);d[Q]=this._legalize(ae+2),d[re]=ae,X++;for(var oe=h[re];ie=h[oe],r(J,$,t[2*oe],t[2*oe+1],t[2*ie],t[2*ie+1]);)ae=this._addTriangle(oe,Q,ie,d[Q],-1,d[oe]),d[Q]=this._legalize(ae+2),h[oe]=oe,X--,oe=ie;if(re===ee)for(;r(J,$,t[2*(ie=u[re])],t[2*ie+1],t[2*re],t[2*re+1]);)ae=this._addTriangle(ie,Q,re,-1,d[re],d[ie]),this._legalize(ae+2),d[ie]=ae,h[re]=re,X--,re=ie;this.hullStart=u[Q]=re,h[re]=u[oe]=Q,h[Q]=oe,f[this._hashKey(J,$)]=Q,f[this._hashKey(t[2*re],t[2*re+1])]=re}}}this.hull=new Uint32Array(X);for(var se=0,le=this.hullStart;se<X;se++)this.hull[se]=le,le=h[le];this.hullPrev=this.hullNext=this.hullTri=null,this.triangles=l.subarray(0,this.trianglesLen),this.halfedges=c.subarray(0,this.trianglesLen)};function n(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}function r(e,t,n,r,i,a){return(r-t)*(i-n)-(n-e)*(a-r)<0}function i(e,t,n,r,i,a){var o=n-e,s=r-t,l=i-e,c=a-t,u=o*o+s*s,h=l*l+c*c,d=.5/(o*c-s*l),f=(c*u-s*h)*d,p=(o*h-l*u)*d;return f*f+p*p}function a(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function o(e){return e[0]}function s(e){return e[1]}return t.from=function(e,n,r){void 0===n&&(n=o),void 0===r&&(r=s);for(var i=e.length,a=new Float64Array(2*i),l=0;l<i;l++){var c=e[l];a[2*l]=n(c),a[2*l+1]=r(c)}return new t(a)},t.prototype._hashKey=function(e,t){return Math.floor((n=e-this._cx,r=t-this._cy,i=n/(Math.abs(n)+Math.abs(r)),(r>0?3-i:1+i)/4*this._hashSize))%this._hashSize;var n,r,i},t.prototype._legalize=function(e){var t=this.triangles,n=this.coords,r=this.halfedges,i=r[e],a=e-e%3,o=i-i%3,s=a+(e+1)%3,l=a+(e+2)%3,c=o+(i+2)%3;if(-1===i)return l;var u,h,d,f,p,m,g,v,y,_,b,E,w,x,T,A,M=t[l],S=t[e],R=t[s],k=t[c];if(u=n[2*M],h=n[2*M+1],d=n[2*S],f=n[2*S+1],p=n[2*R],m=n[2*R+1],(y=u-(g=n[2*k]))*((E=f-(v=n[2*k+1]))*(A=(w=p-g)*w+(x=m-v)*x)-(T=(b=d-g)*b+E*E)*x)-(_=h-v)*(b*A-T*w)+(y*y+_*_)*(b*x-E*w)<0){t[e]=k,t[i]=M;var P=r[c];if(-1===P){var L=this.hullStart;do{if(this.hullTri[L]===c){this.hullTri[L]=e;break}L=this.hullNext[L]}while(L!==this.hullStart)}this._link(e,P),this._link(i,r[l]),this._link(l,c);var C=o+(i+1)%3;return this._legalize(e),this._legalize(C)}return l},t.prototype._link=function(e,t){this.halfedges[e]=t,-1!==t&&(this.halfedges[t]=e)},t.prototype._addTriangle=function(e,t,n,r,i,a){var o=this.trianglesLen;return this.triangles[o]=e,this.triangles[o+1]=t,this.triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o},t}()},16:(e,t,n)=>{var r;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||a;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||f(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var o=t._howls[n]._soundById(r[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||f(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var o=t._howls[n]._soundById(r[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,f()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=r&&parseInt(r[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||a,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),n=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||n)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var r=function(){a._autoResume();var t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),void 0===t.start?t.noteOn(0):t.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),t.onended=function(){t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchstart",r,!0),document.removeEventListener("touchend",r,!0)}};return document.addEventListener("touchstart",r,!0),document.addEventListener("touchend",r,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then((function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())})))}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return a.ctx||f(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhrWithCredentials=e.xhrWithCredentials||!1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,void 0!==a.ctx&&a.ctx&&a.mobileAutoEnable&&a._enableMobileAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=this,t=null;if(a.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var r,i;if(e._format&&e._format[n])r=e._format[n];else{if("string"!=typeof(i=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(i))||(r=/\.([^.]+)$/.exec(i.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&a.codecs(r)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new s(e),e._webAudio&&c(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e){e="__default";for(var i=0,o=0;o<n._sounds.length;o++)n._sounds[o]._paused&&!n._sounds[o]._ended&&(i++,r=n._sounds[o]._id);1===i?e=null:r=null}}var s=r?n._soundById(r):n._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==n._state){s._sprite=e,s._ended=!1;var l=s._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(r&&!s._paused)return t||setTimeout((function(){n._emit("play",s._id)}),0),s._id;n._webAudio&&a._autoResume();var c=Math.max(0,s._seek>0?s._seek:n._sprite[e][0]/1e3),u=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-c),h=1e3*u/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=c,s._start=n._sprite[e][0]/1e3,s._stop=(n._sprite[e][0]+n._sprite[e][1])/1e3,s._loop=!(!s._loop&&!n._sprite[e][2]);var d=s._node;if(n._webAudio){var f=function(){n._refreshBuffer(s);var e=s._muted||n._muted?0:s._volume;d.gain.setValueAtTime(e,a.ctx.currentTime),s._playStart=a.ctx.currentTime,void 0===d.bufferSource.start?s._loop?d.bufferSource.noteGrainOn(0,c,86400):d.bufferSource.noteGrainOn(0,c,u):s._loop?d.bufferSource.start(0,c,86400):d.bufferSource.start(0,c,u),h!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h)),t||setTimeout((function(){n._emit("play",s._id)}),0)};"running"===a.state?f():(n.once("resume",f),n._clearTimer(s._id))}else{var p=function(){d.currentTime=c,d.muted=s._muted||n._muted||a._muted||d.muted,d.volume=s._volume*a.volume(),d.playbackRate=s._rate;try{var e=d.play();if("undefined"!=typeof Promise&&e instanceof Promise&&(n._playLock=!0,e.then((function(){n._playLock=!1,n._loadQueue()}))),d.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");h!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h)),t||n._emit("play",s._id)}catch(e){n._emit("playerror",s._id,e)}},m=window&&window.ejecta||!d.readyState&&a._navigator.isCocoonJS;if(4===d.readyState||m)p();else{var g=function(){p(),d.removeEventListener(a._canPlayEvent,g,!1)};d.addEventListener(a._canPlayEvent,g,!1),n._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),r=0;r<n.length;r++){t._clearTimer(n[r]);var i=t._soundById(n[r]);if(i&&!i._paused&&(i._seek=t.seek(n[r]),i._rateSeek=0,i._paused=!0,t._stopFade(n[r]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var r=n._getSoundIds(e),i=0;i<r.length;i++){n._clearTimer(r[i]);var a=n._soundById(r[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,n._stopFade(r[i]),a._node&&(n._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),n._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause())),t||n._emit("stop",a._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(t),i=0;i<r.length;i++){var o=n._soundById(r[i]);o&&(o._muted=e,o._interval&&n._stopFade(o._id),n._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),n._emit("mute",o._id))}return n},volume:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]){var o=r._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(n=t?r._soundById(t):r._sounds[0])?n._volume:0;if("loaded"!==r._state)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===t&&(r._volume=e),t=r._getSoundIds(t);for(var l=0;l<t.length;l++)(n=r._soundById(t[l]))&&(n._volume=e,i[2]||r._stopFade(t[l]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,a.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*a.volume()),r._emit("volume",n._id));return r},fade:function(e,t,n,r){var i=this;if("loaded"!==i._state)return i._queue.push({event:"fade",action:function(){i.fade(e,t,n,r)}}),i;i.volume(e,r);for(var o=i._getSoundIds(r),s=0;s<o.length;s++){var l=i._soundById(o[s]);if(l){if(r||i._stopFade(o[s]),i._webAudio&&!l._muted){var c=a.ctx.currentTime,u=c+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,c),l._node.gain.linearRampToValueAtTime(t,u)}i._startFadeInterval(l,e,t,n,o[s],void 0===r)}}return i},_startFadeInterval:function(e,t,n,r,i,a){var o=this,s=t,l=n-t,c=Math.abs(l/.01),u=Math.max(4,c>0?r/c:r),h=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var i=(Date.now()-h)/r;h=Date.now(),s+=l*i,s=Math.max(0,s),s=Math.min(1,s),s=Math.round(100*s)/100,o._webAudio?e._volume=s:o.volume(s,e._id,!0),a&&(o._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(n,e._id),o._emit("fade",e._id))}),u)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=r._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],r._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=r._getSoundIds(t),o=0;o<a.length;o++)(n=r._soundById(a[o]))&&(n._loop=e,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return r},rate:function(){var e,t,n,r=this,i=arguments;if(0===i.length)t=r._sounds[0]._id;else if(1===i.length){var o=r._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(n=r._soundById(t))?n._rate:r._rate;if("loaded"!==r._state)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===t&&(r._rate=e),t=r._getSoundIds(t);for(var l=0;l<t.length;l++)if(n=r._soundById(t[l])){n._rateSeek=r.seek(t[l]),n._playStart=r._webAudio?a.ctx.currentTime:n._playStart,n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):n._node&&(n._node.playbackRate=e);var c=r.seek(t[l]),u=(r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-c,h=1e3*u/Math.abs(n._rate);!r._endTimers[t[l]]&&n._paused||(r._clearTimer(t[l]),r._endTimers[t[l]]=setTimeout(r._ended.bind(r,n),h)),r._emit("rate",n._id)}return r},seek:function(){var e,t,n=this,r=arguments;if(0===r.length)t=n._sounds[0]._id;else if(1===r.length){var i=n._getSoundIds(),o=i.indexOf(r[0]);o>=0?t=parseInt(r[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if(void 0===t)return n;if("loaded"!==n._state)return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var s=n._soundById(t);if(s){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var l=n.playing(t)?a.ctx.currentTime-s._playStart:0,c=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(c+l*Math.abs(s._rate))}return s._node.currentTime}var u=n.playing(t);u&&n.pause(t,!0),s._seek=e,s._ended=!1,n._clearTimer(t),u&&n.play(t,!0),!n._webAudio&&s._node&&(s._node.currentTime=e),n._emit("seek",t)}return n},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var r=0;r<t._sounds.length;r++)if(!t._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,r=t._soundById(e);return r&&(n=t._sprite[r._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++){if(t[n]._paused||e.stop(t[n]._id),!e._webAudio)/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(t[n]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(a._canPlayEvent,t[n]._loadFn,!1);delete t[n]._node,e._clearTimer(t[n]._id);var r=a._howls.indexOf(e);r>=0&&a._howls.splice(r,1)}var i=!0;for(n=0;n<a._howls.length;n++)if(a._howls[n]._src===e._src){i=!1;break}return l&&i&&delete l[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,r){var i=this["_on"+e];return"function"==typeof t&&i.push(r?{id:n,fn:t,once:r}:{id:n,fn:t}),this},off:function(e,t,n){var r=this,i=r["_on"+e],a=0;if("number"==typeof t&&(n=t,t=null),t||n)for(a=0;a<i.length;a++){var o=n===i[a].id;if(t===i[a].fn&&o||!t&&o){i.splice(a,1);break}}else if(e)r["_on"+e]=[];else{var s=Object.keys(r);for(a=0;a<s.length;a++)0===s[a].indexOf("_on")&&Array.isArray(r[s[a]])&&(r[s[a]]=[])}return r},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var r=this,i=r["_on"+e],a=i.length-1;a>=0;a--)i[a].id&&i[a].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(r,i[a].fn),0),i[a].once&&r.off(e,i[a].fn,i[a].id));return r},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,(function(){e._queue.shift(),e._loadQueue()})),t.action()}return e},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var r=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&r&&t.stop(e._id,!0).play(e._id),t._webAudio&&r){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),a._autoSuspend()),t._webAudio||r||t.stop(e._id),t},_clearTimer:function(e){var t=this;return t._endTimers[e]&&(clearTimeout(t._endTimers[e]),delete t._endTimers[e]),t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new s(e)},_drain:function(){var e=this,t=e._pool,n=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&n++;for(r=e._sounds.length-1;r>=0;r--){if(n<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){if(a._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=a._scratchBuffer}catch(e){}}return e.bufferSource=null,this}};var s=function(e){this._parent=e,this.init()};s.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=a._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),e._node.gain.setValueAtTime(n,a.ctx.currentTime),e._node.paused=!0,e._node.connect(a.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(a._canPlayEvent,e._loadFn,!1),e._node.src=t._src,e._node.preload="auto",e._node.volume=n*a.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(a._canPlayEvent,e._loadFn,!1)}};var l={},c=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);h(r.buffer,e)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.withCredentials=e._xhrWithCredentials,a.responseType="arraybuffer",a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?h(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},u(a)}},u=function(e){try{e.send()}catch(t){e.onerror()}},h=function(e,t){a.ctx.decodeAudioData(e,(function(e){e&&t._sounds.length>0&&(l[t._src]=e,d(t,e))}),(function(){t._emit("loaderror",null,"Decoding audio data failed.")}))},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},f=function(){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(e){a.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var r=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());(a._navigator&&a._navigator.standalone&&!r||a._navigator&&!a._navigator.standalone&&!r)&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:1,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()};void 0===(r=function(){return{Howler:a,Howl:o}}.apply(t,[]))||(e.exports=r),t.Howler=a,t.Howl=o,"undefined"!=typeof window?(window.HowlerGlobal=i,window.Howler=a,window.Howl=o,window.Sound=s):void 0!==n.g&&(n.g.HowlerGlobal=i,n.g.Howler=a,n.g.Howl=o,n.g.Sound=s)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,n="number"!=typeof n?r._pos[2]:n,"number"!=typeof e?r._pos:(r._pos=[e,t,n],r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,n,r,i,a){var o=this;if(!o.ctx||!o.ctx.listener)return o;var s=o._orientation;return t="number"!=typeof t?s[1]:t,n="number"!=typeof n?s[2]:n,r="number"!=typeof r?s[3]:r,i="number"!=typeof i?s[4]:i,a="number"!=typeof a?s[5]:a,"number"!=typeof e?s:(o._orientation=[e,t,n,r,i,a],o.ctx.listener.setOrientation(e,t,n,r,i,a),o)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(e,n)}}),r;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0]}for(var a=r._getSoundIds(n),o=0;o<a.length;o++){var s=r._soundById(a[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,i),"spatial"===i?s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(e,n,r,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,n,r,i)}}),a;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,void 0===i){if("number"!=typeof e)return a._pos;a._pos=[e,n,r]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,n,r],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),l._panner.setPosition(e,n,r)),a._emit("pos",l._id)}}return a},Howl.prototype.orientation=function(e,n,r,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,n,r,i)}}),a;if(n="number"!=typeof n?a._orientation[1]:n,r="number"!=typeof r?a._orientation[2]:r,void 0===i){if("number"!=typeof e)return a._orientation;a._orientation=[e,n,r]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,n,r],l._node&&(l._panner||(l._pos||(l._pos=a._pos||[0,0,-.5]),t(l,"spatial")),l._panner.setOrientation(e,n,r)),a._emit("orientation",l._id)}}return a},Howl.prototype.pannerAttr=function(){var e,n,r,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(r=i._soundById(parseInt(a[0],10)))?r._pannerAttr:i._pannerAttr;e=a[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],n=parseInt(a[1],10));for(var o=i._getSoundIds(n),s=0;s<o.length;s++)if(r=i._soundById(o[s])){var l=r._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var c=r._panner;c?(c.coneInnerAngle=l.coneInnerAngle,c.coneOuterAngle=l.coneOuterAngle,c.coneOuterGain=l.coneOuterGain,c.distanceModel=l.distanceModel,c.maxDistance=l.maxDistance,c.refDistance=l.refDistance,c.rolloffFactor=l.rolloffFactor,c.panningModel=l.panningModel):(r._pos||(r._pos=i._pos||[0,0,-.5]),t(r,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()},5623:e=>{"use strict";var t=9007199254740991,n=new Float32Array(1);new Uint32Array(n.buffer)[0]=2139095040;var r=n[0];n=new Float32Array(1);new Uint32Array(n.buffer)[0]=4286578688;var i=n[0];function a(e){return Math.floor(e)}function o(e){return Math.ceil(e)}function s(e){return"string"==typeof e}function l(e){return function(e){return("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))&&e.valueOf()==e.valueOf()}(e)&&e%1==0}function c(e){return l(e)&&e>=0}function u(e,n){var r,i;if(!s(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!c(n))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+n+"`.");if(0===e.length||0===n)return"";if(e.length*n>t)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(r="",i=n;1==(1&i)&&(r+=e),0!==(i>>>=1);)e+=e;return r}function h(e){for(var t,n="";e>0;)n=(t=e/2)===(e=a(t))?"0"+n:"1"+n;return n}e.exports=function(e){var n,l,d,f,p,m,g;if(l=e<0||1/e===i?"1":"0",e===r||e===i)return l+(f=u("1",8))+(d=u("0",23));if(e!=e)return l+(f=u("1",8))+(d="1"+u("0",22));if(0===e)return l+(f=u("0",8))+(d=u("0",23));if(m=(e=function(e){return e<0?-e:0===e?0:e}(e))-(p=a(e)),p=h(p),m=function(e){var t,n,r,i;if(t="",0===e)return t;for(i=149,r=0;r<149&&((n=2*e)>=1?(e=n-1,t+="1",149===i&&(i=r)):(e=n,t+="0"),!(1===n||r-i>24));r++);return t}(m),p)f=p.length-1;else{for(g=0;g<m.length;g++)if("1"===m[g]){n=g+1;break}f=-n}return d=p+m,f<0?(f<=-127&&(n=126),d=d.substring(n)):d=d.substring(1),l+(f=function(e,n,r){var i,a;if(!s(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!c(n))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+n+"`.");if(arguments.length>2){if(!s(a=r))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+a+"`.");if(0===a.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else a=" ";if(n>t)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(i=(n-e.length)/a.length)<=0?e:u(a,i=o(i))+e}(f=h(f+127),8,"0"))+(d=function(e,n,r){var i,a;if(!s(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!c(n))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+n+"`.");if(arguments.length>2){if(!s(a=r))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+a+"`.");if(0===a.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else a=" ";if(n>t)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(i=(n-e.length)/a.length)<=0?e:e+u(a,i=o(i))}(d,23,"0").substring(0,23))}},3108:(e,t,n)=>{e.exports=function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return i(t[o][1][e]||e)}),c,c.exports,e,t,n,r)}return n[o].exports}for(var a=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){t.exports={version:"1.5.0"}},{}],2:[function(e,t,n){"use strict";var r=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x},i=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(e){this.head_=e},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(e){this.tail_=e},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(e){this.search_node_=e},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},i.prototype.locatePoint=function(e){var t=e.x,n=this.findSearchNode(t),r=n.point.x;if(t===r){if(e!==n.point)if(e===n.prev.point)n=n.prev;else{if(e!==n.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");n=n.next}}else if(t<r)for(;(n=n.prev)&&e!==n.point;);else for(;(n=n.next)&&e!==n.point;);return n&&(this.search_node_=n),n},t.exports=i,t.exports.Node=r},{}],3:[function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"Assert Failed")}t.exports=r},{}],4:[function(e,t,n){"use strict";var r=e("./xy"),i=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};i.prototype.toString=function(){return r.toStringBase(this)},i.prototype.toJSON=function(){return{x:this.x,y:this.y}},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.set_zero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},i.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},i.prototype.mul=function(e){return this.x*=e,this.y*=e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},i.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},i.negate=function(e){return new i(-e.x,-e.y)},i.add=function(e,t){return new i(e.x+t.x,e.y+t.y)},i.sub=function(e,t){return new i(e.x-t.x,e.y-t.y)},i.mul=function(e,t){return new i(e*t.x,e*t.y)},i.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new i(-e*t.y,e*t.x):"number"==typeof t?new i(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},i.toString=r.toString,i.compare=r.compare,i.cmp=r.compare,i.equals=r.equals,i.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=i},{"./xy":11}],5:[function(e,t,n){"use strict";var r=e("./xy"),i=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var n=0;n<t.length;n++)this.message+=" "+r.toString(t[n])};i.prototype=new Error,i.prototype.constructor=i,t.exports=i},{"./xy":11}],6:[function(e,t,r){(function(t){"use strict";var n=t.poly2tri;r.noConflict=function(){return t.poly2tri=n,r},r.VERSION=e("../dist/version.json").version,r.PointError=e("./pointerror"),r.Point=e("./point"),r.Triangle=e("./triangle"),r.SweepContext=e("./sweepcontext");var i=e("./sweep");r.triangulate=i.triangulate,r.sweep={Triangulate:i.triangulate}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,n){"use strict";function r(e){e.initTriangulation(),e.createAdvancingFront(),i(e),a(e)}function i(e){var t,n=e.pointCount();for(t=1;t<n;++t)for(var r=e.getPoint(t),i=o(e,r),a=r._p2t_edge_list,l=0;a&&l<a.length;++l)s(e,a[l],i)}function a(e){for(var t=e.front().head().next.triangle,n=e.front().head().next.point;!t.getConstrainedEdgeCW(n);)t=t.neighborCCW(n);e.meshClean(t)}function o(e,t){var n=e.locateNode(t),r=u(e,t,n);return t.x<=n.point.x+D&&h(e,n),d(e,r),r}function s(e,t,n){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,c(n.triangle,t.p,t.q)||(b(e,t,n),l(e,t.p,t.q,n.triangle,t.q))}function l(e,t,n,r,i){if(!c(r,t,n)){var a=r.pointCCW(i),o=B(n,a,t);if(o===U.COLLINEAR)throw new N("poly2tri EdgeEvent: Collinear not supported!",[n,a,t]);var s=r.pointCW(i),u=B(n,s,t);if(u===U.COLLINEAR)throw new N("poly2tri EdgeEvent: Collinear not supported!",[n,s,t]);o===u?l(e,t,n,r=o===U.CW?r.neighborCCW(i):r.neighborCW(i),i):k(e,t,n,r,i)}}function c(e,t,n){var r=e.edgeIndex(t,n);if(-1!==r){e.markConstrainedEdgeByIndex(r);var i=e.getNeighbor(r);return i&&i.markConstrainedEdgeByPoints(t,n),!0}return!1}function u(e,t,n){var r=new F(t,n.point,n.next.point);r.markNeighbor(n.triangle),e.addToMap(r);var i=new O(t);return i.next=n.next,i.prev=n,n.next.prev=i,n.next=i,p(e,r)||e.mapTriangleToNodes(r),i}function h(e,t){var n=new F(t.prev.point,t.point,t.next.point);n.markNeighbor(t.prev.triangle),n.markNeighbor(t.triangle),e.addToMap(n),t.prev.next=t.next,t.next.prev=t.prev,p(e,n)||e.mapTriangleToNodes(n)}function d(e,t){for(var n=t.next;n.next&&!V(n.point,n.next.point,n.prev.point);)h(e,n),n=n.next;for(n=t.prev;n.prev&&!V(n.point,n.next.point,n.prev.point);)h(e,n),n=n.prev;t.next&&t.next.next&&f(t)&&v(e,t)}function f(e){var t=e.point.x-e.next.next.point.x,n=e.point.y-e.next.next.point.y;return I(n>=0,"unordered y"),t>=0||Math.abs(t)<n}function p(e,t){for(var n=0;n<3;++n)if(!t.delaunay_edge[n]){var r=t.getNeighbor(n);if(r){var i=t.getPoint(n),a=r.oppositePoint(t,i),o=r.index(a);if(r.constrained_edge[o]||r.delaunay_edge[o]){t.constrained_edge[n]=r.constrained_edge[o];continue}if(m(i,t.pointCCW(i),t.pointCW(i),a)){t.delaunay_edge[n]=!0,r.delaunay_edge[o]=!0,g(t,i,r,a);var s=!p(e,t);return s&&e.mapTriangleToNodes(t),(s=!p(e,r))&&e.mapTriangleToNodes(r),t.delaunay_edge[n]=!1,r.delaunay_edge[o]=!1,!0}}}return!1}function m(e,t,n,r){var i=e.x-r.x,a=e.y-r.y,o=t.x-r.x,s=t.y-r.y,l=i*s-o*a;if(l<=0)return!1;var c=n.x-r.x,u=n.y-r.y,h=c*a-i*u;return!(h<=0)&&(i*i+a*a)*(o*u-c*s)+(o*o+s*s)*h+(c*c+u*u)*l>0}function g(e,t,n,r){var i,a,o,s,l,c,u,h,d,f,p,m;i=e.neighborCCW(t),a=e.neighborCW(t),o=n.neighborCCW(r),s=n.neighborCW(r),l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=n.getConstrainedEdgeCCW(r),h=n.getConstrainedEdgeCW(r),d=e.getDelaunayEdgeCCW(t),f=e.getDelaunayEdgeCW(t),p=n.getDelaunayEdgeCCW(r),m=n.getDelaunayEdgeCW(r),e.legalize(t,r),n.legalize(r,t),n.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,f),e.setDelaunayEdgeCCW(r,p),n.setDelaunayEdgeCW(r,m),n.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(r,u),n.setConstrainedEdgeCW(r,h),e.clearNeighbors(),n.clearNeighbors(),i&&n.markNeighbor(i),a&&e.markNeighbor(a),o&&e.markNeighbor(o),s&&n.markNeighbor(s),e.markNeighbor(n)}function v(e,t){for(B(t.point,t.next.point,t.next.next.point)===U.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,y(e,e.basin.bottom_node))}}function y(e,t){if(!_(e,t)&&(h(e,t),t.prev!==e.basin.left_node||t.next!==e.basin.right_node)){if(t.prev===e.basin.left_node){if(B(t.point,t.next.point,t.next.next.point)===U.CW)return;t=t.next}else if(t.next===e.basin.right_node){if(B(t.point,t.prev.point,t.prev.prev.point)===U.CCW)return;t=t.prev}else t=t.prev.point.y<t.next.point.y?t.prev:t.next;y(e,t)}}function _(e,t){var n;return n=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>n}function b(e,t,n){e.edge_event.right?E(e,t,n):A(e,t,n)}function E(e,t,n){for(;n.next.point.x<t.p.x;)B(t.q,n.next.point,t.p)===U.CCW?w(e,t,n):n=n.next}function w(e,t,n){n.point.x<t.p.x&&(B(n.point,n.next.point,n.next.next.point)===U.CCW?x(e,t,n):(T(e,t,n),w(e,t,n)))}function x(e,t,n){h(e,n.next),n.next.point!==t.p&&B(t.q,n.next.point,t.p)===U.CCW&&B(n.point,n.next.point,n.next.next.point)===U.CCW&&x(e,t,n)}function T(e,t,n){B(n.next.point,n.next.next.point,n.next.next.next.point)===U.CCW?x(e,t,n.next):B(t.q,n.next.next.point,t.p)===U.CCW&&T(e,t,n.next)}function A(e,t,n){for(;n.prev.point.x>t.p.x;)B(t.q,n.prev.point,t.p)===U.CW?M(e,t,n):n=n.prev}function M(e,t,n){n.point.x>t.p.x&&(B(n.point,n.prev.point,n.prev.prev.point)===U.CW?R(e,t,n):(S(e,t,n),M(e,t,n)))}function S(e,t,n){B(n.prev.point,n.prev.prev.point,n.prev.prev.prev.point)===U.CW?R(e,t,n.prev):B(t.q,n.prev.prev.point,t.p)===U.CW&&S(e,t,n.prev)}function R(e,t,n){h(e,n.prev),n.prev.point!==t.p&&B(t.q,n.prev.point,t.p)===U.CW&&B(n.point,n.prev.point,n.prev.prev.point)===U.CW&&R(e,t,n)}function k(e,t,n,r,i){var a=r.neighborAcross(i);I(a,"FLIP failed due to missing triangle!");var o=a.oppositePoint(r,i);if(r.getConstrainedEdgeAcross(i)){var s=r.index(i);throw new N("poly2tri Intersecting Constraints",[i,o,r.getPoint((s+1)%3),r.getPoint((s+2)%3)])}z(i,r.pointCCW(i),r.pointCW(i),o)?(g(r,i,a,o),e.mapTriangleToNodes(r),e.mapTriangleToNodes(a),i===n&&o===t?n===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(t,n),a.markConstrainedEdgeByPoints(t,n),p(e,r),p(e,a)):k(e,t,n,r=P(e,B(n,o,t),r,a,i,o),i)):(C(e,t,n,r,a,L(t,n,a,o)),l(e,t,n,r,i))}function P(e,t,n,r,i,a){var o;return t===U.CCW?(o=r.edgeIndex(i,a),r.delaunay_edge[o]=!0,p(e,r),r.clearDelaunayEdges(),n):(o=n.edgeIndex(i,a),n.delaunay_edge[o]=!0,p(e,n),n.clearDelaunayEdges(),r)}function L(e,t,n,r){var i=B(t,r,e);if(i===U.CW)return n.pointCCW(r);if(i===U.CCW)return n.pointCW(r);throw new N("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,r,e])}function C(e,t,n,r,i,a){var o=i.neighborAcross(a);I(o,"FLIP failed due to missing triangle");var s=o.oppositePoint(i,a);z(n,r.pointCCW(n),r.pointCW(n),s)?k(e,n,s,o,s):C(e,t,n,r,o,L(t,n,o,s))}var I=e("./assert"),N=e("./pointerror"),F=e("./triangle"),O=e("./advancingfront").Node,H=e("./utils"),D=H.EPSILON,U=H.Orientation,B=H.orient2d,z=H.inScanArea,V=H.isAngleObtuse;n.triangulate=r},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,n){"use strict";var r=e("./pointerror"),i=e("./point"),a=e("./triangle"),o=e("./sweep"),s=e("./advancingfront"),l=s.Node,c=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new r("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},d=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new h,this.initEdges(this.points_)};d.prototype.addHole=function(e){this.initEdges(e);var t,n=e.length;for(t=0;t<n;t++)this.points_.push(e[t]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(e){var t,n=e.length;for(t=0;t<n;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},d.prototype.addPoint=function(e){return this.points_.push(e),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},d.prototype.triangulate=function(){return o.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(e){this.head_=e},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(e){this.tail_=e},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var e,t=this.points_[0].x,n=this.points_[0].x,r=this.points_[0].y,a=this.points_[0].y,o=this.points_.length;for(e=1;e<o;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<n&&(n=s.x),s.y>r&&(r=s.y),s.y<a&&(a=s.y)}this.pmin_=new i(n,a),this.pmax_=new i(t,r);var l=.3*(t-n),c=.3*(r-a);this.head_=new i(t+l,a-c),this.tail_=new i(n-l,a-c),this.points_.sort(i.compare)},d.prototype.initEdges=function(e){var t,n=e.length;for(t=0;t<n;++t)this.edge_list.push(new c(e[t],e[(t+1)%n]))},d.prototype.getPoint=function(e){return this.points_[e]},d.prototype.addToMap=function(e){this.map_.push(e)},d.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},d.prototype.createAdvancingFront=function(){var e,t,n,r=new a(this.points_[0],this.tail_,this.head_);this.map_.push(r),e=new l(r.getPoint(1),r),t=new l(r.getPoint(0),r),n=new l(r.getPoint(2)),this.front_=new s(e,n),e.next=t,t.next=n,t.prev=e,n.prev=t},d.prototype.removeNode=function(e){},d.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var n=this.front_.locatePoint(e.pointCW(e.getPoint(t)));n&&(n.triangle=e)}},d.prototype.removeFromMap=function(e){var t,n=this.map_,r=n.length;for(t=0;t<r;t++)if(n[t]===e){n.splice(t,1);break}},d.prototype.meshClean=function(e){for(var t,n,r=[e];t=r.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),n=0;n<3;n++)t.constrained_edge[n]||r.push(t.getNeighbor(n))},t.exports=d},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,n){"use strict";var r=function(e,t,n){this.points_=[e,t,n],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},i=e("./xy").toString;r.prototype.toString=function(){return"["+i(this.points_[0])+i(this.points_[1])+i(this.points_[2])+"]"},r.prototype.getPoint=function(e){return this.points_[e]},r.prototype.GetPoint=r.prototype.getPoint,r.prototype.getPoints=function(){return this.points_},r.prototype.getNeighbor=function(e){return this.neighbors_[e]},r.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},r.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},r.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},r.prototype.isInterior=function(){return this.interior_},r.prototype.setInterior=function(e){return this.interior_=e,this},r.prototype.markNeighborPointers=function(e,t,n){var r=this.points_;if(e===r[2]&&t===r[1]||e===r[1]&&t===r[2])this.neighbors_[0]=n;else if(e===r[0]&&t===r[2]||e===r[2]&&t===r[0])this.neighbors_[1]=n;else{if(!(e===r[0]&&t===r[1]||e===r[1]&&t===r[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=n}},r.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},r.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},r.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},r.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},r.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},r.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},r.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},r.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},r.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},r.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},r.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},r.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},r.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},r.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},r.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},r.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},r.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},r.prototype.oppositePoint=function(e,t){var n=e.pointCW(t);return this.pointCW(n)},r.prototype.legalize=function(e,t){var n=this.points_;if(e===n[0])n[1]=n[0],n[0]=n[2],n[2]=t;else if(e===n[1])n[2]=n[1],n[1]=n[0],n[0]=t;else{if(e!==n[2])throw new Error("poly2tri Invalid Triangle.legalize() call");n[0]=n[2],n[2]=n[1],n[1]=t}},r.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},r.prototype.edgeIndex=function(e,t){var n=this.points_;if(e===n[0]){if(t===n[1])return 2;if(t===n[2])return 1}else if(e===n[1]){if(t===n[2])return 0;if(t===n[0])return 2}else if(e===n[2]){if(t===n[0])return 1;if(t===n[1])return 0}return-1},r.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},r.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},r.prototype.markConstrainedEdgeByPoints=function(e,t){var n=this.points_;t===n[0]&&e===n[1]||t===n[1]&&e===n[0]?this.constrained_edge[2]=!0:t===n[0]&&e===n[2]||t===n[2]&&e===n[0]?this.constrained_edge[1]=!0:(t===n[1]&&e===n[2]||t===n[2]&&e===n[1])&&(this.constrained_edge[0]=!0)},t.exports=r},{"./xy":11}],10:[function(e,t,n){"use strict";function r(e,t,n){var r=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);return r>-o&&r<o?s.COLLINEAR:r>0?s.CCW:s.CW}function i(e,t,n,r){return!((e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)>=-o||(e.x-n.x)*(r.y-n.y)-(r.x-n.x)*(e.y-n.y)<=o)}function a(e,t,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)<0}var o=1e-12;n.EPSILON=o;var s={CW:1,CCW:-1,COLLINEAR:0};n.Orientation=s,n.orient2d=r,n.inScanArea=i,n.isAngleObtuse=a},{}],11:[function(e,t,n){"use strict";function r(e){return"("+e.x+";"+e.y+")"}function i(e){var t=e.toString();return"[object Object]"===t?r(e):t}function a(e,t){return e.y===t.y?e.x-t.x:e.y-t.y}function o(e,t){return e.x===t.x&&e.y===t.y}t.exports={toString:i,toStringBase:r,compare:a,equals:o}},{}]},{},[6])(6)},5744:function(e,t,n){var r;!function(i){function a(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function o(e,t){if("function"!=typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function s(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){s.prototype.dispatch.apply(e,arguments)}}a.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},s.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,r){var i=this._indexOfListener(e,n);if(-1!==i){if((e=this._bindings[i]).isOnce()!==t)throw Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else e=new a(this,e,t,n,r),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if((n=this._bindings[r])._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return o(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return o(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){o(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var l=s;l.Signal=s,void 0===(r=function(){return l}.call(t,n,t,e))||(e.exports=r)}()},2865:(e,t)=>{"use strict";var n,r,i,a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a=function(e){var t=Math.round,n=Math.abs,r=Math.min,i=Math.max,a=Math.sqrt;function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function c(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(e,t,n){var r,i,o,s,l,c,u,h,d,f,p,m=t.params.Points.threshold;for(l=0,u=e.length;l<u;++l)if(null!==(f=(d=e[l]).points))for(c=0,h=f.length;c<h;++c)p=f[c],(s=t.ray.distanceSqToPoint(p))<m*m&&(r=t.ray.closestPointToPoint(p,new I),(i=t.ray.origin.distanceTo(r))>=t.near&&i<=t.far&&(o=a(s),n.push(new j(i,o,r,d.data[c]))))}function v(e,t,n,r,i,a){var o=0;return e>t&&e>n?(i<e&&(o|=2),a<e&&(o|=1)):t>n?(r<t&&(o|=4),a<t&&(o|=1)):(r<n&&(o|=4),i<n&&(o|=2)),o}function y(e,t,n,r){var i,a=0;return t<n?(i=t,a=0):(i=n,a=1),r<i&&(a=2),W[e][a]}function _(e,t,n){var a,o,s,l,c,u,h,d,f,p=X.min.set(0,0,0),m=X.max.subVectors(e.max,e.min),g=e.getDimensions(Y.min),v=Y.max.copy(g).multiplyScalar(.5),y=K.origin.copy(t.origin),_=K.direction.copy(t.direction);return y.sub(e.getCenter(q)).add(v),n.value=0,0>_.x&&(y.x=g.x-y.x,_.x=-_.x,n.value|=4),0>_.y&&(y.y=g.y-y.y,_.y=-_.y,n.value|=2),0>_.z&&(y.z=g.z-y.z,_.z=-_.z,n.value|=1),a=1/_.x,o=1/_.y,s=1/_.z,l=(p.x-y.x)*a,c=(m.x-y.x)*a,u=(p.y-y.y)*o,h=(m.y-y.y)*o,d=(p.z-y.z)*s,f=(m.z-y.z)*s,i(i(l,u),d)<r(r(c,h),f)?[l,u,d,c,h,f]:null}function b(e,t,n,r,i,a,o,s){if(0<=i&&0<=a&&0<=o){var l=e.children;if(null===l)s.push(e);else{var c=.5*(t+i),u=.5*(n+a),h=.5*(r+o),d=Z.value,f=v(t,n,r,c,u,h);do{0===f?(b(l[d],t,n,r,c,u,h,s),f=y(f,c,u,h)):1===f?(b(l[1^d],t,n,h,c,u,o,s),f=y(f,c,u,o)):2===f?(b(l[2^d],t,u,r,c,a,h,s),f=y(f,c,a,h)):3===f?(b(l[3^d],t,u,h,c,a,o,s),f=y(f,c,a,o)):4===f?(b(l[4^d],c,n,r,i,u,h,s),f=y(f,i,u,h)):5===f?(b(l[5^d],c,n,h,i,u,o,s),f=y(f,i,u,o)):6===f?(b(l[6^d],c,u,r,i,a,h,s),f=y(f,i,a,h)):7===f&&(b(l[7^d],c,u,h,i,a,o,s),f=8)}while(8>f)}}}function E(e){var t,n,r,i=e.children,a=0;if(null!==i)for(t=0,n=i.length;t<n;++t)(r=1+E(i[t]))>a&&(a=r);return a}function w(e,t,n){var r,i,a=e.children;if(te.min=e.min,te.max=e.max,t.intersectsBox(te))if(null!==a)for(r=0,i=a.length;r<i;++r)w(a[r],t,n);else n.push(e)}function x(e,t,n,r){var i,a,o=e.children;if(n===t)r.push(e);else if(null!==o)for(++n,i=0,a=o.length;i<a;++i)x(o[i],t,n,r)}function T(e){var t,n,r=e.children,i=0;if(null!==r)for(t=0,n=r.length;t<n;++t)i+=T(r[t]);else null!==e.points&&(i=e.points.length);return i}function A(e,t,n,r,i){var a,o,s=r.children,l=!1,c=!1;if(r.contains(e,n.bias)){if(null===s){if(null===r.points)r.points=[],r.data=[];else for(a=0,o=r.points.length;!l&&a<o;++a)l=r.points[a].equals(e);l?(r.data[a-1]=t,c=!0):r.points.length<n.maxPoints||i===n.maxDepth?(r.points.push(e.clone()),r.data.push(t),++n.pointCount,c=!0):(r.split(),r.redistribute(n.bias),s=r.children)}if(null!==s)for(++i,a=0,o=s.length;!c&&a<o;++a)c=A(e,t,n,s[a],i)}return c}function M(e,t,n,r){var i,a,o,s,l,c=n.children,u=null;if(n.contains(e,t.bias))if(null!==c)for(i=0,a=c.length;null===u&&i<a;++i)u=M(e,t,c[i],n);else if(null!==n.points)for(o=n.points,s=n.data,i=0,a=o.length;i<a;++i)if(o[i].equals(e)){l=a-1,u=s[i],i<l&&(o[i]=o[l],s[i]=s[l]),o.pop(),s.pop(),--t.pointCount,null!==r&&T(r)<=t.maxPoints&&r.merge();break}return u}function S(e,t,n){var r,i,a,o=n.children,s=null;if(n.contains(e,t.bias))if(null!==o)for(r=0,i=o.length;null===s&&r<i;++r)s=S(e,t,o[r]);else if(null!==n.points)for(r=0,i=(a=n.points).length;null===s&&r<i;++r)e.equals(a[r])&&(s=n.data[r]);return s}function R(e,t,n,r,i,a){var o,s,l,c=r.children,u=null;if(r.contains(e,n.bias))if(r.contains(t,n.bias)){if(null!==c)for(++a,o=0,s=c.length;null===u&&o<s;++o)u=R(e,t,n,c[o],r,a);else if(null!==r.points)for(o=0,s=(l=r.points).length;o<s;++o)if(e.equals(l[o])){l[o].copy(t),u=r.data[o];break}}else A(t,u=M(e,n,r,i),n,i,a-1);return u}function k(e,t,n,r){var i,a,o=null,s=t;if(null!==r.children){var l,c,u=r.children.map((function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}})).sort((function(e,t){return e.distance-t.distance}));for(i=0,a=u.length;i<a&&(!(l=u[i].octant).contains(e,s)||null===(c=k(e,s,n,l))||(o=c,0!==(s=c.distance)));++i);}else if(null!==r.points){var h,d=r.points,f=-1;for(i=0,a=d.length;i<a;++i)if(d[i].equals(e)){if(!n){s=0,f=i;break}}else(h=e.distanceTo(d[i]))<s&&(s=h,f=i);0<=f&&(o={point:d[f],data:r.data[f],distance:s})}return o}function P(e,t,n,r,i){var a,o,s,l=r.children;if(null!==l)for(a=0,o=l.length;a<o;++a)(s=l[a]).contains(e,t)&&P(e,t,n,s,i);else if(null!==r.points){var c,u=r.points;for(a=0,o=u.length;a<o;++a)(c=u[a]).equals(e)?!n&&i.push({point:c.clone(),data:r.data[a]}):c.distanceToSquared(e)<=t*t&&i.push({point:c.clone(),data:r.data[a]})}}var L=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],C=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],I=function(){var e=Math.cos,o=Math.sin;function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;s(this,l),this.x=e,this.y=t,this.z=n}return c(l,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(t,n,r){var i=o(n)*t;return this.x=i*o(r),this.y=e(n)*t,this.z=i*e(r),this}},{key:"setFromCylindrical",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(t,n,r){return this.x=t*o(n),this.y=r,this.z=t*e(n),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,c=s*n+o*t-i*r,u=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,n=e.y,r=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,r),this}},{key:"angleTo",value:function(e){var t=Math.acos,n=this.dot(e)/a(this.lengthSquared()*e.lengthSquared());return t(r(i(n,-1),1))}},{key:"manhattanLength",value:function(){return n(this.x)+n(this.y)+n(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return a(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return n(this.x-e.x)+n(this.y-e.y)+n(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"distanceTo",value:function(e){return a(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=r(this.x,e.x),this.y=r(this.y,e.y),this.z=r(this.z,e.z),this}},{key:"max",value:function(e){return this.x=i(this.x,e.x),this.y=i(this.y,e.y),this.z=i(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=i(e.x,r(t.x,this.x)),this.y=i(e.y,r(t.y,this.y)),this.z=i(e.z,r(t.z,this.z)),this}},{key:"floor",value:function(){var e=Math.floor;return this.x=e(this.x),this.y=e(this.y),this.z=e(this.z),this}},{key:"ceil",value:function(){var e=Math.ceil;return this.x=e(this.x),this.y=e(this.y),this.z=e(this.z),this}},{key:"round",value:function(){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),l}(),N=new I,F=[new I,new I,new I,new I,new I,new I,new I,new I],O=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new I(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I(-1/0,-1/0,-1/0);s(this,e),this.min=t,this.max=n}return c(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new I;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new I;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),t=0,n=e.length;t<n;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=N.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return N.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,n=this.max;return this.isEmpty()||(F[0].set(t.x,t.y,t.z).applyMatrix4(e),F[1].set(t.x,t.y,n.z).applyMatrix4(e),F[2].set(t.x,n.y,t.z).applyMatrix4(e),F[3].set(t.x,n.y,n.z).applyMatrix4(e),F[4].set(n.x,t.y,t.z).applyMatrix4(e),F[5].set(n.x,t.y,n.z).applyMatrix4(e),F[6].set(n.x,n.y,t.z).applyMatrix4(e),F[7].set(n.x,n.y,n.z).applyMatrix4(e),this.setFromPoints(F)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:"containsBox",value:function(e){var t=this.min,n=this.max,r=e.min,i=e.max;return t.x<=r.x&&i.x<=n.x&&t.y<=r.y&&i.y<=n.y&&t.z<=r.z&&i.z<=n.z}},{key:"intersectsBox",value:function(e){var t=this.min,n=this.max,r=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&r.x<=n.x&&r.y<=n.y&&r.z<=n.z}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,N).distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),H=[new I,new I,new I,new I],D=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new I,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I;s(this,e),this.origin=t,this.direction=n}return c(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,H[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=H[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):H[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return a(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction),n=0===t?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/t;return 0<=n?n:null}},{key:"distanceSquaredToSegment",value:function(e,t,a,o){var s,l,c,u,h,d=H[0].copy(e).add(t).multiplyScalar(.5),f=H[1].copy(t).sub(e).normalize(),p=H[2].copy(this.origin).sub(d),m=.5*e.distanceTo(t),g=-this.direction.dot(f),v=p.dot(this.direction),y=-p.dot(f),_=p.lengthSq(),b=n(1-g*g);return 0<b?(l=g*v-y,c=m*b,0<=(s=g*y-v)?h=l>=-c?l<=c?(s*=u=1/b)*(s+g*(l*=u)+2*v)+l*(g*s+l+2*y)+_:-(s=i(0,-(g*(l=m)+v)))*s+l*(l+2*y)+_:-(s=i(0,-(g*(l=-m)+v)))*s+l*(l+2*y)+_:l<=-c?h=-(s=i(0,-(-g*m+v)))*s+(l=0<s?-m:r(i(-m,-y),m))*(l+2*y)+_:l<=c?(s=0,h=(l=r(i(-m,-y),m))*(l+2*y)+_):h=-(s=i(0,-(g*m+v)))*s+(l=0<s?m:r(i(-m,-y),m))*(l+2*y)+_):h=-(s=i(0,-(g*(l=0<g?-m:m)+v)))*s+l*(l+2*y)+_,void 0!==a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),void 0!==o&&o.copy(f).multiplyScalar(l).add(d),h}},{key:"intersectSphere",value:function(e){var t,n,r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I,o=H[0].subVectors(e.center,this.origin),s=o.dot(this.direction),l=o.dot(o)-s*s,c=e.radius*e.radius,u=null;return l<=c&&(r=s+(t=a(c-l)),(0<=(n=s-t)||0<=r)&&(u=0>n?this.at(r,i):this.at(n,i))),u}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"intersectPlane",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I,n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t,n,r,i,a,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I,l=this.origin,c=this.direction,u=e.min,h=e.max,d=1/c.x,f=1/c.y,p=1/c.z,m=null;return 0<=d?(t=(u.x-l.x)*d,n=(h.x-l.x)*d):(t=(h.x-l.x)*d,n=(u.x-l.x)*d),0<=f?(r=(u.y-l.y)*f,i=(h.y-l.y)*f):(r=(h.y-l.y)*f,i=(u.y-l.y)*f),t<=i&&r<=n&&((r>t||t!=t)&&(t=r),(i<n||n!=n)&&(n=i),0<=p?(a=(u.z-l.z)*p,o=(h.z-l.z)*p):(a=(h.z-l.z)*p,o=(u.z-l.z)*p),t<=o&&a<=n&&((a>t||t!=t)&&(t=a),(o<n||n!=n)&&(n=o),0<=n&&(m=this.at(0<=t?t:n,s)))),m}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,H[0])}},{key:"intersectTriangle",value:function(e,t,n,r,i){var a,o,s,l,c,u=this.direction,h=H[0],d=H[1],f=H[2],p=H[3],m=null;return d.subVectors(t,e),f.subVectors(n,e),p.crossVectors(d,f),0===(a=u.dot(p))||r&&0<a||(0<a?o=1:(o=-1,a=-a),h.subVectors(this.origin,e),0<=(s=o*u.dot(f.crossVectors(h,f)))&&0<=(l=o*u.dot(d.cross(h)))&&s+l<=a&&0<=(c=-o*h.dot(p))&&(m=this.at(c/a,i))),m}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),U=new I,B=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new I,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;s(this,e),this.min=t,this.size=n,this.children=null}return c(e,[{key:"getCenter",value:function(e){return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(e){return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e,t,n=this.min,r=this.getCenter(U),i=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=C[e],a[e]=new this.constructor(new I(0===t[0]?n.x:r.x,0===t[1]?n.y:r.y,0===t[2]?n.z:r.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),z=new I,V=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new I,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new I;s(this,e),this.min=t,this.max=n,this.children=null}return c(e,[{key:"getCenter",value:function(e){return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(e){return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e,t,n=this.min,r=this.max,i=this.getCenter(z),a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=C[e],a[e]=new this.constructor(new I(0===t[0]?n.x:i.x,0===t[1]?n.y:i.y,0===t[2]?n.z:i.z),new I(0===t[0]?i.x:r.x,0===t[1]?i.y:r.y,0===t[2]?i.z:r.z))}}]),e}(),j=function e(t,n,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;s(this,e),this.distance=t,this.distanceToRay=n,this.point=r,this.object=i},G=function e(){s(this,e),this.value=0},W=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],q=new I,X=new O,Y=new O,K=new D,Z=new G,Q=function(){function e(){s(this,e)}return c(e,null,[{key:"intersectOctree",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],r=_(e,t,Z);null!==r&&b.apply(void 0,[e.root].concat(m(r),[n]))}}]),e}(),J=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];s(this,e),this.value=t,this.done=n}return c(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),$=new O,ee=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;s(this,e),this.octree=t,this.region=n,this.cull=null!==n,this.result=new J,this.trace=null,this.indices=null,this.reset()}return c(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&($.min=e.min,$.max=e.max,(!this.cull||this.region.intersectsBox($))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e,t,n,r=this.cull,i=this.region,a=this.indices,o=this.trace,s=null,l=o.length-1;null===s&&0<=l;)if(e=a[l]++,t=o[l].children,8>e)if(null!==t){if(n=t[e],r&&($.min=n.min,$.max=n.max,!i.intersectsBox($)))continue;o.push(n),a.push(0),++l}else s=o.pop(),a.pop();else o.pop(),a.pop(),--l;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),te=new O,ne=function(){function e(t){s(this,e),this.root=t}return c(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"cull",value:function(e){var t=[];return w(this.root,e,t),t}},{key:"getDepth",value:function(){return E(this.root)}},{key:"findNodesByLevel",value:function(e){var t=[];return x(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Q.intersectOctree(this,e.ray,t),t}},{key:"leaves",value:function(e){return new ee(this,e)}},{key:Symbol.iterator,value:function(){return new ee(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),re=new I,ie=function(e){function t(e,n){var r;return s(this,t),(r=f(this,h(t).call(this,e,n))).points=null,r.data=null,r}return u(t,e),c(t,[{key:"distanceToSquared",value:function(e){return re.copy(e).clamp(this.min,this.max).sub(e).lengthSquared()}},{key:"distanceToCenterSquared",value:function(e){var t=this.getCenter(re),n=e.x-t.x,r=e.y-t.x,i=e.z-t.z;return n*n+r*r+i*i}},{key:"contains",value:function(e,t){var n=this.min,r=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=r.x+t&&e.y<=r.y+t&&e.z<=r.z+t}},{key:"redistribute",value:function(e){var t,n,r,i,a,o,s,l=this.children,c=this.points,u=this.data;if(null!==l&&null!==c){for(t=0,r=c.length;t<r;++t)for(o=c[t],s=u[t],n=0,i=l.length;n<i;++n)if((a=l[n]).contains(o,e)){null===a.points&&(a.points=[],a.data=[]),a.points.push(o),a.data.push(s);break}this.points=null,this.data=null}}},{key:"merge",value:function(){var e=this.children;if(null!==e){var t,n,r,i=[],a=[];for(t=0,n=e.length;t<n;++t)null!==(r=e[t]).points&&(i=i.concat(r.points),a=a.concat(r.data));this.children=null,this.points=i,this.data=a}}}]),t}(V),ae=function(e){function n(e,r){var a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,c=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return s(this,n),(a=f(this,h(n).call(this,new ie(e,r)))).bias=i(0,o),a.maxPoints=i(1,t(l)),a.maxDepth=i(0,t(c)),a.pointCount=0,a}return u(n,e),c(n,[{key:"countPoints",value:function(e){return T(e)}},{key:"insert",value:function(e,t){return A(e,t,this,this.root,0)}},{key:"remove",value:function(e){return M(e,this,this.root,null)}},{key:"get",value:function(e){return S(e,this,this.root)}},{key:"move",value:function(e,t){return R(e,t,this,this.root,null,0)}},{key:"findNearestPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],r=k(e,t,n,this.root);return null!==r&&(r.point=r.point.clone()),r}},{key:"findPoints",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],r=[];return P(e,t,n,this.root,r),r}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=p(h(n.prototype),"raycast",this).call(this,e);return 0<r.length&&g(r,e,t),t}}]),n}(ne);e.CubicOctant=B,e.Flags=G,e.Octant=V,e.Octree=ne,e.OctreeIterator=ee,e.OctreeRaycaster=Q,e.PointOctant=ie,e.PointOctree=ae,e.RayPointIntersection=j,e.edges=L,e.findEntryOctant=v,e.findNextOctant=y,e.intersectOctree=_,e.layout=C,e.testPoints=g,Object.defineProperty(e,"__esModule",{value:!0})},"object"===o(t)?a(t):(r=[t],void 0===(i="function"==typeof(n=a)?n.apply(t,r):n)||(e.exports=i))},9756:e=>{var t=function(){function e(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),n(++r%i.children.length)}),!1);var a=(performance||Date).now(),o=a,s=0,l=e(new t.Panel("FPS","#0ff","#002")),c=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:e,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:i,setMode:n}};t.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,u=2*o,h=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,d,f,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,f,p),{dom:m,update:function(l,v){r=Math.min(r,l),i=Math.max(i,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,d),g.fillStyle=t,g.fillText(a(l)+" "+e+" ("+a(r)+"-"+a(i)+")",c,u),g.drawImage(m,h+o,d,f-o,p,h,d,f-o,p),g.fillRect(h+f-o,d,o,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+f-o,d,o,a((1-l/v)*p))}}},e.exports=t},5370:function(e,t){!function(e){"use strict";const t="128",n={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},i=0,a=1,o=2,s=3,l=0,c=1,u=2,h=3,d=0,f=1,p=2,m=1,g=2,v=0,y=1,_=2,b=3,E=4,w=5,x=100,T=101,A=102,M=103,S=104,R=200,k=201,P=202,L=203,C=204,I=205,N=206,F=207,O=208,H=209,D=210,U=0,B=1,z=2,V=3,j=4,G=5,W=6,q=7,X=0,Y=1,K=2,Z=0,Q=1,J=2,$=3,ee=4,te=5,ne=300,re=301,ie=302,ae=303,oe=304,se=306,le=307,ce=1e3,ue=1001,he=1002,de=1003,fe=1004,pe=1004,me=1005,ge=1005,ve=1006,ye=1007,_e=1007,be=1008,Ee=1008,we=1009,xe=1010,Te=1011,Ae=1012,Me=1013,Se=1014,Re=1015,ke=1016,Pe=1017,Le=1018,Ce=1019,Ie=1020,Ne=1021,Fe=1022,Oe=1023,He=1024,De=1025,Ue=Oe,Be=1026,ze=1027,Ve=1028,je=1029,Ge=1030,We=1031,qe=1032,Xe=1033,Ye=33776,Ke=33777,Ze=33778,Qe=33779,Je=35840,$e=35841,et=35842,tt=35843,nt=36196,rt=37492,it=37496,at=37808,ot=37809,st=37810,lt=37811,ct=37812,ut=37813,ht=37814,dt=37815,ft=37816,pt=37817,mt=37818,gt=37819,vt=37820,yt=37821,_t=36492,bt=37840,Et=37841,wt=37842,xt=37843,Tt=37844,At=37845,Mt=37846,St=37847,Rt=37848,kt=37849,Pt=37850,Lt=37851,Ct=37852,It=37853,Nt=2200,Ft=2201,Ot=2202,Ht=2300,Dt=2301,Ut=2302,Bt=2400,zt=2401,Vt=2402,jt=2500,Gt=2501,Wt=0,qt=1,Xt=2,Yt=3e3,Kt=3001,Zt=3007,Qt=3002,Jt=3003,$t=3004,en=3005,tn=3006,nn=3200,rn=3201,an=0,on=1,sn=0,ln=7680,cn=7681,un=7682,hn=7683,dn=34055,fn=34056,pn=5386,mn=512,gn=513,vn=514,yn=515,_n=516,bn=517,En=518,wn=519,xn=35044,Tn=35048,An=35040,Mn=35045,Sn=35049,Rn=35041,kn=35046,Pn=35050,Ln=35042,Cn="100",In="300 es";class Nn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const Fn=[];for(let e=0;e<256;e++)Fn[e]=(e<16?"0":"")+e.toString(16);let On=1234567;const Hn=Math.PI/180,Dn=180/Math.PI;function Un(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Fn[255&e]+Fn[e>>8&255]+Fn[e>>16&255]+Fn[e>>24&255]+"-"+Fn[255&t]+Fn[t>>8&255]+"-"+Fn[t>>16&15|64]+Fn[t>>24&255]+"-"+Fn[63&n|128]+Fn[n>>8&255]+"-"+Fn[n>>16&255]+Fn[n>>24&255]+Fn[255&r]+Fn[r>>8&255]+Fn[r>>16&255]+Fn[r>>24&255]).toUpperCase()}function Bn(e,t,n){return Math.max(t,Math.min(n,e))}function zn(e,t){return(e%t+t)%t}function Vn(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)}function jn(e,t,n){return e!==t?(n-e)/(t-e):0}function Gn(e,t,n){return(1-n)*e+n*t}function Wn(e,t,n,r){return Gn(e,t,1-Math.exp(-n*r))}function qn(e,t=1){return t-Math.abs(zn(e,2*t)-t)}function Xn(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)}function Yn(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)}function Kn(e,t){return e+Math.floor(Math.random()*(t-e+1))}function Zn(e,t){return e+Math.random()*(t-e)}function Qn(e){return e*(.5-Math.random())}function Jn(e){return void 0!==e&&(On=e%2147483647),On=16807*On%2147483647,(On-1)/2147483646}function $n(e){return e*Hn}function er(e){return e*Dn}function tr(e){return 0==(e&e-1)&&0!==e}function nr(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function rr(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function ir(e,t,n,r,i){const a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),c=a((t+r)/2),u=o((t+r)/2),h=a((t-r)/2),d=o((t-r)/2),f=a((r-t)/2),p=o((r-t)/2);switch(i){case"XYX":e.set(s*u,l*h,l*d,s*c);break;case"YZY":e.set(l*d,s*u,l*h,s*c);break;case"ZXZ":e.set(l*h,l*d,s*u,s*c);break;case"XZX":e.set(s*u,l*p,l*f,s*c);break;case"YXY":e.set(l*f,s*u,l*p,s*c);break;case"ZYZ":e.set(l*p,l*f,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}var ar=Object.freeze({__proto__:null,DEG2RAD:Hn,RAD2DEG:Dn,generateUUID:Un,clamp:Bn,euclideanModulo:zn,mapLinear:Vn,inverseLerp:jn,lerp:Gn,damp:Wn,pingpong:qn,smoothstep:Xn,smootherstep:Yn,randInt:Kn,randFloat:Zn,randFloatSpread:Qn,seededRandom:Jn,degToRad:$n,radToDeg:er,isPowerOfTwo:tr,ceilPowerOfTwo:nr,floorPowerOfTwo:rr,setQuaternionFromProperEuler:ir});class or{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}or.prototype.isVector2=!0;class sr{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,a,o,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],f=n[8],p=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],b=r[2],E=r[5],w=r[8];return i[0]=a*p+o*v+s*b,i[3]=a*m+o*y+s*E,i[6]=a*g+o*_+s*w,i[1]=l*p+c*v+u*b,i[4]=l*m+c*y+u*E,i[7]=l*g+c*_+u*w,i[2]=h*p+d*v+f*b,i[5]=h*m+d*y+f*E,i[8]=h*g+d*_+f*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,h=o*s-c*i,d=l*i-a*s,f=t*u+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(o*n-r*a)*p,e[3]=h*p,e[4]=(c*t-r*s)*p,e[5]=(r*i-o*t)*p,e[6]=d*p,e[7]=(n*s-l*t)*p,e[8]=(a*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,o){const s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*l,r[6]=t*o+n*c,r[1]=-n*i+t*s,r[4]=-n*a+t*l,r[7]=-n*o+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let lr;sr.prototype.isMatrix3=!0;class cr{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===lr&&(lr=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),lr.width=e.width,lr.height=e.height;const n=lr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=lr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let ur=0;class hr extends Nn{constructor(e=hr.DEFAULT_IMAGE,t=hr.DEFAULT_MAPPING,n=ue,r=ue,i=ve,a=be,o=Oe,s=we,l=1,c=Yt){super(),Object.defineProperty(this,"id",{value:ur++}),this.uuid=Un(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new or(0,0),this.repeat=new or(1,1),this.center=new or(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new sr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(this.isDataTexture&&(r=document.createElement("canvas").getContext("2d").getImageData(0,0,r.width,r.height)),void 0===r.uuid&&(r.uuid=Un()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(dr(r[e].image)):t.push(dr(r[e]))}else t=dr(r);e.images[r.uuid]={uuid:r.uuid,url:t}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ne)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ce:e.x=e.x-Math.floor(e.x);break;case ue:e.x=e.x<0?0:1;break;case he:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ce:e.y=e.y-Math.floor(e.y);break;case ue:e.y=e.y<0?0:1;break;case he:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function dr(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?cr.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}hr.DEFAULT_IMAGE=void 0,hr.DEFAULT_MAPPING=ne,hr.prototype.isTexture=!0;class fr{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],h=s[1],d=s[5],f=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(c-h)<a&&Math.abs(u-p)<a&&Math.abs(f-m)<a){if(Math.abs(c+h)<o&&Math.abs(u+p)<o&&Math.abs(f+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(d+1)/2,v=(g+1)/2,y=(c+h)/4,_=(u+p)/4,b=(f+m)/4;return e>s&&e>v?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=_/n):s>v?s<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=y/r,i=b/r):v<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=_/i,r=b/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-f)/v,this.y=(u-p)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}fr.prototype.isVector4=!0;class pr extends Nn{constructor(e,t,n){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new fr(0,0,e,t),this.scissorTest=!1,this.viewport=new fr(0,0,e,t),n=n||{},this.texture=new hr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:ve,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}pr.prototype.isWebGLRenderTarget=!0;class mr extends pr{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}mr.prototype.isWebGLMultisampleRenderTarget=!0;class gr{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,a,o){let s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(u!==p||s!==h||l!==d||c!==f){let e=1-o;const t=s*h+l*d+c*f+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,o=Math.sin(o*a)/i}const i=o*n;if(s=s*e+h*i,l=l*e+d*i,c=c*e+f*i,u=u*e+p*i,e===1-o){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){const o=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[a],h=i[a+1],d=i[a+2],f=i[a+3];return e[t]=o*f+c*u+s*d-l*h,e[t+1]=s*f+c*h+l*u-o*d,e[t+2]=l*f+c*d+o*h-s*u,e[t+3]=c*f-o*u-s*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=s(n/2),d=s(r/2),f=s(i/2);switch(a){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],h=n+o+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-s)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Bn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+r*l-i*s,this._y=r*c+a*s+i*o-n*l,this._z=i*c+a*l+n*s-r*o,this._w=a*c-n*o-r*s-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=a*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}gr.prototype.isQuaternion=!0;class vr{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_r.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_r.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,c=s*n+o*t-i*r,u=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return yr.copy(this).projectOnVector(e),this.sub(yr)}reflect(e){return this.sub(yr.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Bn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}vr.prototype.isVector3=!0;const yr=new vr,_r=new gr;class br{constructor(e=new vr(1/0,1/0,1/0),t=new vr(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],c=e[s+1],u=e[s+2];l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>a&&(a=c),u>o&&(o=u)}return this.min.set(t,n,r),this.max.set(i,a,o),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),c=e.getY(s),u=e.getZ(s);l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>a&&(a=c),u>o&&(o=u)}return this.min.set(t,n,r),this.max.set(i,a,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=wr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new vr),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new vr),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),xr.copy(t.boundingBox),xr.applyMatrix4(e.matrixWorld),this.union(xr));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new vr),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,wr),wr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Pr),Lr.subVectors(this.max,Pr),Tr.subVectors(e.a,Pr),Ar.subVectors(e.b,Pr),Mr.subVectors(e.c,Pr),Sr.subVectors(Ar,Tr),Rr.subVectors(Mr,Ar),kr.subVectors(Tr,Mr);let t=[0,-Sr.z,Sr.y,0,-Rr.z,Rr.y,0,-kr.z,kr.y,Sr.z,0,-Sr.x,Rr.z,0,-Rr.x,kr.z,0,-kr.x,-Sr.y,Sr.x,0,-Rr.y,Rr.x,0,-kr.y,kr.x,0];return!!Nr(t,Tr,Ar,Mr,Lr)&&(t=[1,0,0,0,1,0,0,0,1],!!Nr(t,Tr,Ar,Mr,Lr)&&(Cr.crossVectors(Sr,Rr),t=[Cr.x,Cr.y,Cr.z],Nr(t,Tr,Ar,Mr,Lr)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new vr),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return wr.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(wr).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Er[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Er[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Er[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Er[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Er[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Er[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Er[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Er[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Er)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}br.prototype.isBox3=!0;const Er=[new vr,new vr,new vr,new vr,new vr,new vr,new vr,new vr],wr=new vr,xr=new br,Tr=new vr,Ar=new vr,Mr=new vr,Sr=new vr,Rr=new vr,kr=new vr,Pr=new vr,Lr=new vr,Cr=new vr,Ir=new vr;function Nr(e,t,n,r,i){for(let a=0,o=e.length-3;a<=o;a+=3){Ir.fromArray(e,a);const o=i.x*Math.abs(Ir.x)+i.y*Math.abs(Ir.y)+i.z*Math.abs(Ir.z),s=t.dot(Ir),l=n.dot(Ir),c=r.dot(Ir);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const Fr=new br,Or=new vr,Hr=new vr,Dr=new vr;class Ur{constructor(e=new vr,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Fr.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new vr),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new br),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Dr.subVectors(e,this.center);const t=Dr.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Dr.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return Hr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Or.copy(e.center).add(Hr)),this.expandByPoint(Or.copy(e.center).sub(Hr)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Br=new vr,zr=new vr,Vr=new vr,jr=new vr,Gr=new vr,Wr=new vr,qr=new vr;class Xr{constructor(e=new vr,t=new vr(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new vr),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Br)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new vr),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Br.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Br.copy(this.direction).multiplyScalar(t).add(this.origin),Br.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){zr.copy(e).add(t).multiplyScalar(.5),Vr.copy(t).sub(e).normalize(),jr.copy(this.origin).sub(zr);const i=.5*e.distanceTo(t),a=-this.direction.dot(Vr),o=jr.dot(this.direction),s=-jr.dot(Vr),l=jr.lengthSq(),c=Math.abs(1-a*a);let u,h,d,f;if(c>0)if(u=a*s-o,h=a*o-s,f=i*c,u>=0)if(h>=-f)if(h<=f){const e=1/c;u*=e,h*=e,d=u*(u+a*h+2*o)+h*(a*u+h+2*s)+l}else h=i,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;else h=-i,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;else h<=-f?(u=Math.max(0,-(-a*i+o)),h=u>0?-i:Math.min(Math.max(-i,-s),i),d=-u*u+h*(h+2*s)+l):h<=f?(u=0,h=Math.min(Math.max(-i,-s),i),d=h*(h+2*s)+l):(u=Math.max(0,-(a*i+o)),h=u>0?i:Math.min(Math.max(-i,-s),i),d=-u*u+h*(h+2*s)+l);else h=a>0?-i:i,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Vr).multiplyScalar(h).add(zr),d}intersectSphere(e,t){Br.subVectors(e.center,this.origin);const n=Br.dot(this.direction),r=Br.dot(Br)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||i>r?null:((i>n||n!=n)&&(n=i),(a<r||r!=r)&&(r=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Br)}intersectTriangle(e,t,n,r,i){Gr.subVectors(t,e),Wr.subVectors(n,e),qr.crossVectors(Gr,Wr);let a,o=this.direction.dot(qr);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}jr.subVectors(this.origin,e);const s=a*this.direction.dot(Wr.crossVectors(jr,Wr));if(s<0)return null;const l=a*this.direction.dot(Gr.cross(jr));if(l<0)return null;if(s+l>o)return null;const c=-a*jr.dot(qr);return c<0?null:this.at(c/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Yr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,a,o,s,l,c,u,h,d,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Yr).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Kr.setFromMatrixColumn(e,0).length(),i=1/Kr.setFromMatrixColumn(e,1).length(),a=1/Kr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-o*s,t[2]=i-e*l,t[6]=r+n*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e+i*o,t[4]=r*o-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=n*o-r,t[6]=i+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e-i*o,t[4]=-a*u,t[8]=r+n*o,t[1]=n+r*o,t[5]=a*c,t[9]=i-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=s*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=a*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=o*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Qr,e,Jr)}lookAt(e,t,n){const r=this.elements;return ti.subVectors(e,t),0===ti.lengthSq()&&(ti.z=1),ti.normalize(),$r.crossVectors(n,ti),0===$r.lengthSq()&&(1===Math.abs(n.z)?ti.x+=1e-4:ti.z+=1e-4,ti.normalize(),$r.crossVectors(n,ti)),$r.normalize(),ei.crossVectors(ti,$r),r[0]=$r.x,r[4]=ei.x,r[8]=ti.x,r[1]=$r.y,r[5]=ei.y,r[9]=ti.y,r[2]=$r.z,r[6]=ei.z,r[10]=ti.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],E=r[0],w=r[4],x=r[8],T=r[12],A=r[1],M=r[5],S=r[9],R=r[13],k=r[2],P=r[6],L=r[10],C=r[14],I=r[3],N=r[7],F=r[11],O=r[15];return i[0]=a*E+o*A+s*k+l*I,i[4]=a*w+o*M+s*P+l*N,i[8]=a*x+o*S+s*L+l*F,i[12]=a*T+o*R+s*C+l*O,i[1]=c*E+u*A+h*k+d*I,i[5]=c*w+u*M+h*P+d*N,i[9]=c*x+u*S+h*L+d*F,i[13]=c*T+u*R+h*C+d*O,i[2]=f*E+p*A+m*k+g*I,i[6]=f*w+p*M+m*P+g*N,i[10]=f*x+p*S+m*L+g*F,i[14]=f*T+p*R+m*C+g*O,i[3]=v*E+y*A+_*k+b*I,i[7]=v*w+y*M+_*P+b*N,i[11]=v*x+y*S+_*L+b*F,i[15]=v*T+y*R+_*C+b*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*s*u-r*l*u-i*o*h+n*l*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*a*h-r*a*d+r*l*c-i*s*c)+e[11]*(+t*l*u-t*o*d-i*a*u+n*a*d+i*o*c-n*l*c)+e[15]*(-r*o*c-t*s*u+t*o*h+r*a*u-n*a*h+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=u*m*l-p*h*l+p*s*d-o*m*d-u*s*g+o*h*g,y=f*h*l-c*m*l-f*s*d+a*m*d+c*s*g-a*h*g,_=c*p*l-f*u*l+f*o*d-a*p*d-c*o*g+a*u*g,b=f*u*s-c*p*s-f*o*h+a*p*h+c*o*m-a*u*m,E=t*v+n*y+r*_+i*b;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/E;return e[0]=v*w,e[1]=(p*h*i-u*m*i-p*r*d+n*m*d+u*r*g-n*h*g)*w,e[2]=(o*m*i-p*s*i+p*r*l-n*m*l-o*r*g+n*s*g)*w,e[3]=(u*s*i-o*h*i-u*r*l+n*h*l+o*r*d-n*s*d)*w,e[4]=y*w,e[5]=(c*m*i-f*h*i+f*r*d-t*m*d-c*r*g+t*h*g)*w,e[6]=(f*s*i-a*m*i-f*r*l+t*m*l+a*r*g-t*s*g)*w,e[7]=(a*h*i-c*s*i+c*r*l-t*h*l-a*r*d+t*s*d)*w,e[8]=_*w,e[9]=(f*u*i-c*p*i-f*n*d+t*p*d+c*n*g-t*u*g)*w,e[10]=(a*p*i-f*o*i+f*n*l-t*p*l-a*n*g+t*o*g)*w,e[11]=(c*o*i-a*u*i-c*n*l+t*u*l+a*n*d-t*o*d)*w,e[12]=b*w,e[13]=(c*p*r-f*u*r+f*n*h-t*p*h-c*n*m+t*u*m)*w,e[14]=(f*o*r-a*p*r-f*n*s+t*p*s+a*n*m-t*o*m)*w,e[15]=(a*u*r-c*o*r+c*n*s-t*u*s-a*n*h+t*o*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+n,c*s-r*a,0,l*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,f=i*u,p=a*c,m=a*u,g=o*u,v=s*l,y=s*c,_=s*u,b=n.x,E=n.y,w=n.z;return r[0]=(1-(p+g))*b,r[1]=(d+_)*b,r[2]=(f-y)*b,r[3]=0,r[4]=(d-_)*E,r[5]=(1-(h+g))*E,r[6]=(m+v)*E,r[7]=0,r[8]=(f+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Kr.set(r[0],r[1],r[2]).length();const a=Kr.set(r[4],r[5],r[6]).length(),o=Kr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Zr.copy(this);const s=1/i,l=1/a,c=1/o;return Zr.elements[0]*=s,Zr.elements[1]*=s,Zr.elements[2]*=s,Zr.elements[4]*=l,Zr.elements[5]*=l,Zr.elements[6]*=l,Zr.elements[8]*=c,Zr.elements[9]*=c,Zr.elements[10]*=c,t.setFromRotationMatrix(Zr),n.x=i,n.y=a,n.z=o,this}makePerspective(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,s=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,a){const o=this.elements,s=1/(t-e),l=1/(n-r),c=1/(a-i),u=(t+e)*s,h=(n+r)*l,d=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Yr.prototype.isMatrix4=!0;const Kr=new vr,Zr=new Yr,Qr=new vr(0,0,0),Jr=new vr(1,1,1),$r=new vr,ei=new vr,ti=new vr,ni=new Yr,ri=new gr;class ii{constructor(e=0,t=0,n=0,r=ii.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(Bn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Bn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Bn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-Bn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Bn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Bn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ni.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ni,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return ri.setFromEuler(this),this.setFromQuaternion(ri,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new vr(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ii.prototype.isEuler=!0,ii.DefaultOrder="XYZ",ii.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ai{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let oi=0;const si=new vr,li=new gr,ci=new Yr,ui=new vr,hi=new vr,di=new vr,fi=new gr,pi=new vr(1,0,0),mi=new vr(0,1,0),gi=new vr(0,0,1),vi={type:"added"},yi={type:"removed"};class _i extends Nn{constructor(){super(),Object.defineProperty(this,"id",{value:oi++}),this.uuid=Un(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=_i.DefaultUp.clone();const e=new vr,t=new ii,n=new gr,r=new vr(1,1,1);function i(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(i),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Yr},normalMatrix:{value:new sr}}),this.matrix=new Yr,this.matrixWorld=new Yr,this.matrixAutoUpdate=_i.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ai,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return li.setFromAxisAngle(e,t),this.quaternion.multiply(li),this}rotateOnWorldAxis(e,t){return li.setFromAxisAngle(e,t),this.quaternion.premultiply(li),this}rotateX(e){return this.rotateOnAxis(pi,e)}rotateY(e){return this.rotateOnAxis(mi,e)}rotateZ(e){return this.rotateOnAxis(gi,e)}translateOnAxis(e,t){return si.copy(e).applyQuaternion(this.quaternion),this.position.add(si.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(pi,e)}translateY(e){return this.translateOnAxis(mi,e)}translateZ(e){return this.translateOnAxis(gi,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(ci.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ui.copy(e):ui.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),hi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ci.lookAt(hi,ui,this.up):ci.lookAt(ui,hi,this.up),this.quaternion.setFromRotationMatrix(ci),r&&(ci.extractRotation(r.matrixWorld),li.setFromRotationMatrix(ci),this.quaternion.premultiply(li.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(vi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(yi)),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(yi)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ci.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ci.multiply(e.parent.matrixWorld)),e.applyMatrix4(ci),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new vr),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new gr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hi,e,di),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new vr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hi,fi,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new vr),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),c=a(e.animations);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}_i.DefaultUp=new vr(0,1,0),_i.DefaultMatrixAutoUpdate=!0,_i.prototype.isObject3D=!0;const bi=new vr,Ei=new vr,wi=new sr;class xi{constructor(e=new vr(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=bi.subVectors(n,t).cross(Ei.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new vr),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new vr);const n=e.delta(bi),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new vr),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||wi.getNormalMatrix(e),r=this.coplanarPoint(bi).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}xi.prototype.isPlane=!0;const Ti=new vr,Ai=new vr,Mi=new vr,Si=new vr,Ri=new vr,ki=new vr,Pi=new vr,Li=new vr,Ci=new vr,Ii=new vr;class Ni{constructor(e=new vr,t=new vr,n=new vr){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new vr),r.subVectors(n,t),Ti.subVectors(e,t),r.cross(Ti);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Ti.subVectors(r,t),Ai.subVectors(n,t),Mi.subVectors(e,t);const a=Ti.dot(Ti),o=Ti.dot(Ai),s=Ti.dot(Mi),l=Ai.dot(Ai),c=Ai.dot(Mi),u=a*l-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new vr),0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*s-o*c)*h,f=(a*c-o*s)*h;return i.set(1-d-f,f,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Si),Si.x>=0&&Si.y>=0&&Si.x+Si.y<=1}static getUV(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,Si),s.set(0,0),s.addScaledVector(i,Si.x),s.addScaledVector(a,Si.y),s.addScaledVector(o,Si.z),s}static isFrontFacing(e,t,n,r){return Ti.subVectors(n,t),Ai.subVectors(e,t),Ti.cross(Ai).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ti.subVectors(this.c,this.b),Ai.subVectors(this.a,this.b),.5*Ti.cross(Ai).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new vr),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ni.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new xi),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ni.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return Ni.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Ni.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ni.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new vr);const n=this.a,r=this.b,i=this.c;let a,o;Ri.subVectors(r,n),ki.subVectors(i,n),Li.subVectors(e,n);const s=Ri.dot(Li),l=ki.dot(Li);if(s<=0&&l<=0)return t.copy(n);Ci.subVectors(e,r);const c=Ri.dot(Ci),u=ki.dot(Ci);if(c>=0&&u<=c)return t.copy(r);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return a=s/(s-c),t.copy(n).addScaledVector(Ri,a);Ii.subVectors(e,i);const d=Ri.dot(Ii),f=ki.dot(Ii);if(f>=0&&d<=f)return t.copy(i);const p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return o=l/(l-f),t.copy(n).addScaledVector(ki,o);const m=c*f-d*u;if(m<=0&&u-c>=0&&d-f>=0)return Pi.subVectors(i,r),o=(u-c)/(u-c+(d-f)),t.copy(r).addScaledVector(Pi,o);const g=1/(m+p+h);return a=p*g,o=h*g,t.copy(n).addScaledVector(Ri,a).addScaledVector(ki,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Fi=0;function Oi(){Object.defineProperty(this,"id",{value:Fi++}),this.uuid=Un(),this.name="",this.type="Material",this.fog=!0,this.blending=y,this.side=d,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=C,this.blendDst=I,this.blendEquation=x,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=wn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ln,this.stencilZFail=ln,this.stencilZPass=ln,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Oi.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Oi,isMaterial:!0,onBuild:function(){},onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===m;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==y&&(n.blending=this.blending),this.side!==d&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Oi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});const Hi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Di={h:0,s:0,l:0},Ui={h:0,s:0,l:0};function Bi(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function zi(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Vi(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class ji{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=zn(e,1),t=Bn(t,0,1),n=Bn(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Bi(i,r,e+1/3),this.g=Bi(i,r,e),this.b=Bi(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Hi[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=zi(e.r),this.g=zi(e.g),this.b=zi(e.b),this}copyLinearToSRGB(e){return this.r=Vi(e.r),this.g=Vi(e.g),this.b=Vi(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),a=Math.min(t,n,r);let o,s;const l=(a+i)/2;if(a===i)o=0,s=0;else{const e=i-a;switch(s=l<=.5?e/(i+a):e/(2-i-a),i){case t:o=(n-r)/e+(n<r?6:0);break;case n:o=(r-t)/e+2;break;case r:o=(t-n)/e+4}o/=6}return e.h=o,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Di),Di.h+=e,Di.s+=t,Di.l+=n,this.setHSL(Di.h,Di.s,Di.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Di),e.getHSL(Ui);const n=Gn(Di.h,Ui.h,t),r=Gn(Di.s,Ui.s,t),i=Gn(Di.l,Ui.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}ji.NAMES=Hi,ji.prototype.isColor=!0,ji.prototype.r=1,ji.prototype.g=1,ji.prototype.b=1;class Gi extends Oi{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new ji(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}Gi.prototype.isMeshBasicMaterial=!0;const Wi=new vr,qi=new or;class Xi{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=xn,this.updateRange={offset:0,count:-1},this.version=0,this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new ji),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new or),t[n++]=i.x,t[n++]=i.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new vr),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new fr),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)qi.fromBufferAttribute(this,t),qi.applyMatrix3(e),this.setXY(t,qi.x,qi.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Wi.fromBufferAttribute(this,t),Wi.applyMatrix3(e),this.setXYZ(t,Wi.x,Wi.y,Wi.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Wi.x=this.getX(t),Wi.y=this.getY(t),Wi.z=this.getZ(t),Wi.applyMatrix4(e),this.setXYZ(t,Wi.x,Wi.y,Wi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Wi.x=this.getX(t),Wi.y=this.getY(t),Wi.z=this.getZ(t),Wi.applyNormalMatrix(e),this.setXYZ(t,Wi.x,Wi.y,Wi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Wi.x=this.getX(t),Wi.y=this.getY(t),Wi.z=this.getZ(t),Wi.transformDirection(e),this.setXYZ(t,Wi.x,Wi.y,Wi.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==xn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Xi.prototype.isBufferAttribute=!0;class Yi extends Xi{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Ki extends Xi{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Zi extends Xi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Qi extends Xi{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Ji extends Xi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class $i extends Xi{constructor(e,t,n){super(new Int32Array(e),t,n)}}class ea extends Xi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class ta extends Xi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}ta.prototype.isFloat16BufferAttribute=!0;class na extends Xi{constructor(e,t,n){super(new Float32Array(e),t,n)}}class ra extends Xi{constructor(e,t,n){super(new Float64Array(e),t,n)}}function ia(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}const aa={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function oa(e,t){return new aa[e](t)}let sa=0;const la=new Yr,ca=new _i,ua=new vr,ha=new br,da=new br,fa=new vr;class pa extends Nn{constructor(){super(),Object.defineProperty(this,"id",{value:sa++}),this.uuid=Un(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ia(e)>65535?ea:Ji)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new sr).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}rotateX(e){return la.makeRotationX(e),this.applyMatrix4(la),this}rotateY(e){return la.makeRotationY(e),this.applyMatrix4(la),this}rotateZ(e){return la.makeRotationZ(e),this.applyMatrix4(la),this}translate(e,t,n){return la.makeTranslation(e,t,n),this.applyMatrix4(la),this}scale(e,t,n){return la.makeScale(e,t,n),this.applyMatrix4(la),this}lookAt(e){return ca.lookAt(e),ca.updateMatrix(),this.applyMatrix4(ca.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ua).negate(),this.translate(ua.x,ua.y,ua.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new na(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new br);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new vr(-1/0,-1/0,-1/0),new vr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ha.setFromBufferAttribute(n),this.morphTargetsRelative?(fa.addVectors(this.boundingBox.min,ha.min),this.boundingBox.expandByPoint(fa),fa.addVectors(this.boundingBox.max,ha.max),this.boundingBox.expandByPoint(fa)):(this.boundingBox.expandByPoint(ha.min),this.boundingBox.expandByPoint(ha.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ur);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new vr,1/0);if(e){const n=this.boundingSphere.center;if(ha.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];da.setFromBufferAttribute(n),this.morphTargetsRelative?(fa.addVectors(ha.min,da.min),ha.expandByPoint(fa),fa.addVectors(ha.max,da.max),ha.expandByPoint(fa)):(ha.expandByPoint(da.min),ha.expandByPoint(da.max))}ha.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)fa.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(fa));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],o=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)fa.fromBufferAttribute(a,t),o&&(ua.fromBufferAttribute(e,t),fa.add(ua)),r=Math.max(r,n.distanceToSquared(fa))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,a=t.uv.array,o=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Xi(new Float32Array(4*o),4));const s=t.tangent.array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new vr,c[e]=new vr;const u=new vr,h=new vr,d=new vr,f=new or,p=new or,m=new or,g=new vr,v=new vr;function y(e,t,n){u.fromArray(r,3*e),h.fromArray(r,3*t),d.fromArray(r,3*n),f.fromArray(a,2*e),p.fromArray(a,2*t),m.fromArray(a,2*n),h.sub(u),d.sub(u),p.sub(f),m.sub(f);const i=1/(p.x*m.y-m.x*p.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(i),v.copy(d).multiplyScalar(p.x).addScaledVector(h,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(v),c[t].add(v),c[n].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)y(n[e+0],n[e+1],n[e+2])}const b=new vr,E=new vr,w=new vr,x=new vr;function T(e){w.fromArray(i,3*e),x.copy(w);const t=l[e];b.copy(t),b.sub(w.multiplyScalar(w.dot(t))).normalize(),E.crossVectors(x,t);const n=E.dot(c[e])<0?-1:1;s[4*e]=b.x,s[4*e+1]=b.y,s[4*e+2]=b.z,s[4*e+3]=n}for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)T(n[e+0]),T(n[e+1]),T(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Xi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new vr,i=new vr,a=new vr,o=new vr,s=new vr,l=new vr,c=new vr,u=new vr;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),f=e.getX(h+1),p=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,f),a.fromBufferAttribute(t,p),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,d),s.fromBufferAttribute(n,f),l.fromBufferAttribute(n,p),o.add(c),s.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(f,s.x,s.y,s.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,l=Math.min(o.length,i.length-s);for(let e=0,t=s;e<l;e++,t++)i[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)fa.fromBufferAttribute(e,t),fa.normalize(),e.setXYZ(t,fa.x,fa.y,fa.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let o=0,s=0;for(let e=0,i=t.length;e<i;e++){o=t[e]*r;for(let e=0;e<r;e++)a[s++]=n[o++]}return new Xi(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new pa,n=this.index.array,r=this.attributes;for(const i in r){const a=e(r[i],n);t.setAttribute(i,a)}const i=this.morphAttributes;for(const r in i){const a=[],o=i[r];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);a.push(r)}t.morphAttributes[r]=a}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let e=0,n=a.length;e<n;e++){const n=a[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],a=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];a.push(r.toJSON(e.data))}a.length>0&&(r[t]=a,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new pa).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let e=0,t=a.length;e<t;e++){const t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}pa.prototype.isBufferGeometry=!0;const ma=new Yr,ga=new Xr,va=new Ur,ya=new vr,_a=new vr,ba=new vr,Ea=new vr,wa=new vr,xa=new vr,Ta=new vr,Aa=new vr,Ma=new vr,Sa=new or,Ra=new or,ka=new or,Pa=new vr,La=new vr;class Ca extends _i{constructor(e=new pa,t=new Gi){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),va.copy(n.boundingSphere),va.applyMatrix4(i),!1===e.ray.intersectsSphere(va))return;if(ma.copy(i).invert(),ga.copy(e.ray).applyMatrix4(ma),null!==n.boundingBox&&!1===ga.intersectsBox(n.boundingBox))return;let a;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position,s=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,f=h.length;n<f;n++){const f=h[n],p=r[f.materialIndex];for(let n=Math.max(f.start,d.start),r=Math.min(f.start+f.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);a=Na(this,p,e,ga,o,s,l,c,u,r,h,d),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=f.materialIndex,t.push(a))}}else for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),f=i.getX(n+2);a=Na(this,r,e,ga,o,s,l,c,u,h,d,f),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}else if(void 0!==o)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],f=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3)a=Na(this,f,e,ga,o,s,l,c,u,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=i.materialIndex,t.push(a))}else for(let n=Math.max(0,d.start),i=Math.min(o.count,d.start+d.count);n<i;n+=3)a=Na(this,r,e,ga,o,s,l,c,u,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Ia(e,t,n,r,i,a,o,s){let l;if(l=t.side===f?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==p,s),null===l)return null;La.copy(s),La.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(La);return c<n.near||c>n.far?null:{distance:c,point:La.clone(),object:e}}function Na(e,t,n,r,i,a,o,s,l,c,u,h){ya.fromBufferAttribute(i,c),_a.fromBufferAttribute(i,u),ba.fromBufferAttribute(i,h);const d=e.morphTargetInfluences;if(t.morphTargets&&a&&d){Ta.set(0,0,0),Aa.set(0,0,0),Ma.set(0,0,0);for(let e=0,t=a.length;e<t;e++){const t=d[e],n=a[e];0!==t&&(Ea.fromBufferAttribute(n,c),wa.fromBufferAttribute(n,u),xa.fromBufferAttribute(n,h),o?(Ta.addScaledVector(Ea,t),Aa.addScaledVector(wa,t),Ma.addScaledVector(xa,t)):(Ta.addScaledVector(Ea.sub(ya),t),Aa.addScaledVector(wa.sub(_a),t),Ma.addScaledVector(xa.sub(ba),t)))}ya.add(Ta),_a.add(Aa),ba.add(Ma)}e.isSkinnedMesh&&t.skinning&&(e.boneTransform(c,ya),e.boneTransform(u,_a),e.boneTransform(h,ba));const f=Ia(e,t,n,r,ya,_a,ba,Pa);if(f){s&&(Sa.fromBufferAttribute(s,c),Ra.fromBufferAttribute(s,u),ka.fromBufferAttribute(s,h),f.uv=Ni.getUV(Pa,ya,_a,ba,Sa,Ra,ka,new or)),l&&(Sa.fromBufferAttribute(l,c),Ra.fromBufferAttribute(l,u),ka.fromBufferAttribute(l,h),f.uv2=Ni.getUV(Pa,ya,_a,ba,Sa,Ra,ka,new or));const e={a:c,b:u,c:h,normal:new vr,materialIndex:0};Ni.getNormal(ya,_a,ba,e.normal),f.face=e}return f}Ca.prototype.isMesh=!0;class Fa extends pa{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const o=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const s=[],l=[],c=[],u=[];let h=0,d=0;function f(e,t,n,r,i,a,f,p,m,g,v){const y=a/m,_=f/g,b=a/2,E=f/2,w=p/2,x=m+1,T=g+1;let A=0,M=0;const S=new vr;for(let a=0;a<T;a++){const o=a*_-E;for(let s=0;s<x;s++){const h=s*y-b;S[e]=h*r,S[t]=o*i,S[n]=w,l.push(S.x,S.y,S.z),S[e]=0,S[t]=0,S[n]=p>0?1:-1,c.push(S.x,S.y,S.z),u.push(s/m),u.push(1-a/g),A+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+x*e,r=h+t+x*(e+1),i=h+(t+1)+x*(e+1),a=h+(t+1)+x*e;s.push(n,r,a),s.push(r,i,a),M+=6}o.addGroup(d,M,v),d+=M,h+=A}f("z","y","x",-1,-1,n,t,e,a,i,0),f("z","y","x",1,-1,n,t,-e,a,i,1),f("x","z","y",1,1,e,n,t,r,a,2),f("x","z","y",1,-1,e,n,-t,r,a,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new na(l,3)),this.setAttribute("normal",new na(c,3)),this.setAttribute("uv",new na(u,2))}}function Oa(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Ha(e){const t={};for(let n=0;n<e.length;n++){const r=Oa(e[n]);for(const e in r)t[e]=r[e]}return t}const Da={clone:Oa,merge:Ha};var Ua="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",Ba="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class za extends Oi{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Ua,this.fragmentShader=Ba,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Oa(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}za.prototype.isShaderMaterial=!0;class Va extends _i{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Yr,this.projectionMatrix=new Yr,this.projectionMatrixInverse=new Yr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new vr),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Va.prototype.isCamera=!0;class ja extends Va{constructor(e=50,t=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Dn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Hn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Dn*Math.atan(Math.tan(.5*Hn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Hn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}ja.prototype.isPerspectiveCamera=!0;const Ga=90,Wa=1;class qa extends _i{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new ja(Ga,Wa,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new vr(1,0,0)),this.add(r);const i=new ja(Ga,Wa,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new vr(-1,0,0)),this.add(i);const a=new ja(Ga,Wa,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new vr(0,1,0)),this.add(a);const o=new ja(Ga,Wa,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new vr(0,-1,0)),this.add(o);const s=new ja(Ga,Wa,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new vr(0,0,1)),this.add(s);const l=new ja(Ga,Wa,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new vr(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,a,o,s,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}class Xa extends hr{constructor(e,t,n,r,i,a,o,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:re,n,r,i,a,o=void 0!==o?o:Fe,s,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Xa.prototype.isCubeTexture=!0;class Ya extends pr{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new Xa(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ve,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Oe,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Fa(5,5,5),i=new za({name:"CubemapFromEquirect",uniforms:Oa(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:f,blending:v});i.uniforms.tEquirect.value=t;const a=new Ca(r,i),o=t.minFilter;return t.minFilter===be&&(t.minFilter=ve),new qa(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}Ya.prototype.isWebGLCubeRenderTarget=!0;class Ka extends hr{constructor(e,t,n,r,i,a,o,s,l,c,u,h){super(null,a,o,s,l,c,r,i,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:de,this.minFilter=void 0!==c?c:de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Ka.prototype.isDataTexture=!0;const Za=new Ur,Qa=new vr;class Ja{constructor(e=new xi,t=new xi,n=new xi,r=new xi,i=new xi,a=new xi){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-r,u-s,p-h,y-m).normalize(),t[1].setComponents(o+r,u+s,p+h,y+m).normalize(),t[2].setComponents(o+i,u+l,p+d,y+g).normalize(),t[3].setComponents(o-i,u-l,p-d,y-g).normalize(),t[4].setComponents(o-a,u-c,p-f,y-v).normalize(),t[5].setComponents(o+a,u+c,p+f,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Za.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Za)}intersectsSprite(e){return Za.center.set(0,0,0),Za.radius=.7071067811865476,Za.applyMatrix4(e.matrixWorld),this.intersectsSphere(Za)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Qa.x=r.normal.x>0?e.max.x:e.min.x,Qa.y=r.normal.y>0?e.max.y:e.min.y,Qa.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Qa)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function $a(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function eo(e,t){const n=t.isWebGL2,r=new WeakMap;function i(t,r){const i=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,i,a),t.onUploadCallback();let s=e.FLOAT;return i instanceof Float32Array?s=e.FLOAT:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=e.HALF_FLOAT:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=e.UNSIGNED_SHORT:i instanceof Int16Array?s=e.SHORT:i instanceof Uint32Array?s=e.UNSIGNED_INT:i instanceof Int32Array?s=e.INT:i instanceof Int8Array?s=e.BYTE:i instanceof Uint8Array&&(s=e.UNSIGNED_BYTE),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}function a(t,r,i){const a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}function o(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)}function s(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))}function l(e,t){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);void 0===n?r.set(e,i(e,t)):n.version<e.version&&(a(n.buffer,e,t),n.version=e.version)}return{get:o,remove:s,update:l}}class to extends pa{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,o=Math.floor(n),s=Math.floor(r),l=o+1,c=s+1,u=e/o,h=t/s,d=[],f=[],p=[],m=[];for(let e=0;e<c;e++){const t=e*h-a;for(let n=0;n<l;n++){const r=n*u-i;f.push(r,-t,0),p.push(0,0,1),m.push(n/o),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<o;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),a=t+1+l*e;d.push(n,r,a),d.push(r,i,a)}this.setIndex(d),this.setAttribute("position",new na(f,3)),this.setAttribute("normal",new na(p,3)),this.setAttribute("uv",new na(m,2))}}const no={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},ro={common:{diffuse:{value:new ji(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new sr},uv2Transform:{value:new sr},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new or(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ji(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ji(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new sr}},sprite:{diffuse:{value:new ji(15658734)},opacity:{value:1},center:{value:new or(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new sr}}},io={basic:{uniforms:Ha([ro.common,ro.specularmap,ro.envmap,ro.aomap,ro.lightmap,ro.fog]),vertexShader:no.meshbasic_vert,fragmentShader:no.meshbasic_frag},lambert:{uniforms:Ha([ro.common,ro.specularmap,ro.envmap,ro.aomap,ro.lightmap,ro.emissivemap,ro.fog,ro.lights,{emissive:{value:new ji(0)}}]),vertexShader:no.meshlambert_vert,fragmentShader:no.meshlambert_frag},phong:{uniforms:Ha([ro.common,ro.specularmap,ro.envmap,ro.aomap,ro.lightmap,ro.emissivemap,ro.bumpmap,ro.normalmap,ro.displacementmap,ro.fog,ro.lights,{emissive:{value:new ji(0)},specular:{value:new ji(1118481)},shininess:{value:30}}]),vertexShader:no.meshphong_vert,fragmentShader:no.meshphong_frag},standard:{uniforms:Ha([ro.common,ro.envmap,ro.aomap,ro.lightmap,ro.emissivemap,ro.bumpmap,ro.normalmap,ro.displacementmap,ro.roughnessmap,ro.metalnessmap,ro.fog,ro.lights,{emissive:{value:new ji(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:no.meshphysical_vert,fragmentShader:no.meshphysical_frag},toon:{uniforms:Ha([ro.common,ro.aomap,ro.lightmap,ro.emissivemap,ro.bumpmap,ro.normalmap,ro.displacementmap,ro.gradientmap,ro.fog,ro.lights,{emissive:{value:new ji(0)}}]),vertexShader:no.meshtoon_vert,fragmentShader:no.meshtoon_frag},matcap:{uniforms:Ha([ro.common,ro.bumpmap,ro.normalmap,ro.displacementmap,ro.fog,{matcap:{value:null}}]),vertexShader:no.meshmatcap_vert,fragmentShader:no.meshmatcap_frag},points:{uniforms:Ha([ro.points,ro.fog]),vertexShader:no.points_vert,fragmentShader:no.points_frag},dashed:{uniforms:Ha([ro.common,ro.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:no.linedashed_vert,fragmentShader:no.linedashed_frag},depth:{uniforms:Ha([ro.common,ro.displacementmap]),vertexShader:no.depth_vert,fragmentShader:no.depth_frag},normal:{uniforms:Ha([ro.common,ro.bumpmap,ro.normalmap,ro.displacementmap,{opacity:{value:1}}]),vertexShader:no.normal_vert,fragmentShader:no.normal_frag},sprite:{uniforms:Ha([ro.sprite,ro.fog]),vertexShader:no.sprite_vert,fragmentShader:no.sprite_frag},background:{uniforms:{uvTransform:{value:new sr},t2D:{value:null}},vertexShader:no.background_vert,fragmentShader:no.background_frag},cube:{uniforms:Ha([ro.envmap,{opacity:{value:1}}]),vertexShader:no.cube_vert,fragmentShader:no.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:no.equirect_vert,fragmentShader:no.equirect_frag},distanceRGBA:{uniforms:Ha([ro.common,ro.displacementmap,{referencePosition:{value:new vr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:no.distanceRGBA_vert,fragmentShader:no.distanceRGBA_frag},shadow:{uniforms:Ha([ro.lights,ro.fog,{color:{value:new ji(0)},opacity:{value:1}}]),vertexShader:no.shadow_vert,fragmentShader:no.shadow_frag}};function ao(e,t,n,r,i){const a=new ji(0);let o,s,l=0,c=null,u=0,h=null;function p(n,i,p,g){let v=!0===i.isScene?i.background:null;v&&v.isTexture&&(v=t.get(v));const y=e.xr,_=y.getSession&&y.getSession();_&&"additive"===_.environmentBlendMode&&(v=null),null===v?m(a,l):v&&v.isColor&&(m(v,1),g=!0),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===se)?(void 0===s&&(s=new Ca(new Fa(1,1,1),new za({name:"BackgroundCubeMaterial",uniforms:Oa(io.cube.uniforms),vertexShader:io.cube.vertexShader,fragmentShader:io.cube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=v,s.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v._needsFlipEnvMap?-1:1,c===v&&u===v.version&&h===e.toneMapping||(s.material.needsUpdate=!0,c=v,u=v.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null)):v&&v.isTexture&&(void 0===o&&(o=new Ca(new to(2,2),new za({name:"BackgroundMaterial",uniforms:Oa(io.background.uniforms),vertexShader:io.background.vertexShader,fragmentShader:io.background.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),o.material.uniforms.uvTransform.value.copy(v.matrix),c===v&&u===v.version&&h===e.toneMapping||(o.material.needsUpdate=!0,c=v,u=v.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}function m(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),l=t,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,m(a,l)},render:p}}function oo(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},l=m(null);let c=l;function u(t,r,i,a,s){let l=!1;if(o){const e=p(a,i,r);c!==e&&(c=e,d(c.object)),l=g(a,s),l&&v(a,s)}else{const e=!0===r.wireframe;c.geometry===a.id&&c.program===i.id&&c.wireframe===e||(c.geometry=a.id,c.program=i.id,c.wireframe=e,l=!0)}!0===t.isInstancedMesh&&(l=!0),null!==s&&n.update(s,e.ELEMENT_ARRAY_BUFFER),l&&(x(t,r,i,a),null!==s&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(s).buffer))}function h(){return r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()}function d(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function f(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e,t,n){const r=!0===n.wireframe;let i=s[e.id];void 0===i&&(i={},s[e.id]=i);let a=i[t.id];void 0===a&&(a={},i[t.id]=a);let o=a[r];return void 0===o&&(o=m(h()),a[r]=o),o}function m(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function g(e,t){const n=c.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],a=r[e];if(void 0===t)return!0;if(t.attribute!==a)return!0;if(t.data!==a.data)return!0;i++}return c.attributesNum!==i||c.index!==t}function v(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],a={};a.attribute=t,t.data&&(a.data=t.data),n[e]=a,i++}c.attributes=n,c.attributesNum=i,c.index=t}function y(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function _(e){b(e,0)}function b(n,i){const a=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function E(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function w(t,n,i,a,o,s){!0!==r.isWebGL2||i!==e.INT&&i!==e.UNSIGNED_INT?e.vertexAttribPointer(t,n,i,a,o,s):e.vertexAttribIPointer(t,n,i,o,s)}function x(i,a,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;y();const l=s.attributes,c=o.getAttributes(),u=a.defaultAttributeValues;for(const t in c){const r=c[t];if(r>=0){const a=l[t];if(void 0!==a){const t=a.normalized,i=a.itemSize,o=n.get(a);if(void 0===o)continue;const l=o.buffer,c=o.type,u=o.bytesPerElement;if(a.isInterleavedBufferAttribute){const n=a.data,o=n.stride,h=a.offset;n&&n.isInstancedInterleavedBuffer?(b(r,n.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)):_(r),e.bindBuffer(e.ARRAY_BUFFER,l),w(r,i,c,t,o*u,h*u)}else a.isInstancedBufferAttribute?(b(r,a.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)):_(r),e.bindBuffer(e.ARRAY_BUFFER,l),w(r,i,c,t,0,0)}else if("instanceMatrix"===t){const t=n.get(i.instanceMatrix);if(void 0===t)continue;const a=t.buffer,o=t.type;b(r+0,1),b(r+1,1),b(r+2,1),b(r+3,1),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(r+0,4,o,!1,64,0),e.vertexAttribPointer(r+1,4,o,!1,64,16),e.vertexAttribPointer(r+2,4,o,!1,64,32),e.vertexAttribPointer(r+3,4,o,!1,64,48)}else if("instanceColor"===t){const t=n.get(i.instanceColor);if(void 0===t)continue;const a=t.buffer,o=t.type;b(r,1),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(r,3,o,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r,n);break;case 3:e.vertexAttrib3fv(r,n);break;case 4:e.vertexAttrib4fv(r,n);break;default:e.vertexAttrib1fv(r,n)}}}}E()}function T(){S();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)f(n[e].object),delete n[e];delete t[e]}delete s[e]}}function A(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)f(n[e].object),delete n[e];delete t[e]}delete s[e.id]}function M(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)f(r[e].object),delete r[e];delete n[e.id]}}function S(){R(),c!==l&&(c=l,d(c.object))}function R(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:S,resetDefaultState:R,dispose:T,releaseStatesOfGeometry:A,releaseStatesOfProgram:M,initAttributes:y,enableAttribute:_,disableUnusedAttributes:E}}function so(e,t,n,r){const i=r.isWebGL2;let a;function o(e){a=e}function s(t,r){e.drawArrays(a,t,r),n.update(r,a,1)}function l(r,o,s){if(0===s)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](a,r,o,s),n.update(o,a,s)}this.setMode=o,this.render=s,this.renderInstances=l}function lo(e,t,n){let r;function i(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const l=a(s);l!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",l,"instead."),s=l);const c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=h>0,_=o||t.has("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:i,getMaxPrecision:a,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:o?e.getParameter(e.MAX_SAMPLES):0}}function co(e){const t=this;let n=null,r=0,i=!1,a=!1;const o=new xi,s=new sr,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,n,r,i){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==i||null===c){const t=r+4*a,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==a;++t,n+=4)o.copy(e[t]).applyMatrix4(i,s),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){const o=0!==e.length||t||0!==r||i;return i=t,n=u(e,a,0),r=e.length,o},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1,c()},this.setState=function(t,o,s){const h=t.clippingPlanes,d=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||a&&!f)a?u(null):c();else{const e=a?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=u(h,o,t,s);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function uo(e){let t=new WeakMap;function n(e,t){return t===ae?e.mapping=re:t===oe&&(e.mapping=ie),e}function r(r){if(r&&r.isTexture){const a=r.mapping;if(a===ae||a===oe){if(t.has(r))return n(t.get(r).texture,r.mapping);{const a=r.image;if(a&&a.height>0){const o=e.getRenderTarget(),s=new Ya(a.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),e.setRenderTarget(o),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}function a(){t=new WeakMap}return{get:r,dispose:a}}function ho(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function fo(e,t,n,r){const i={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",o),delete i[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t}function l(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}}function c(e){const n=[],r=e.index,i=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{const e=i.array;o=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const s=new(ia(n)>65535?ea:Ji)(n,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}function u(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&c(e)}else c(e);return a.get(e)}return{get:s,update:l,getWireframeAttribute:u}}function po(e,t,n,r){const i=r.isWebGL2;let a,o,s;function l(e){a=e}function c(e){o=e.type,s=e.bytesPerElement}function u(t,r){e.drawElements(a,r,o,t*s),n.update(r,a,1)}function h(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](a,l,o,r*s,c),n.update(l,a,c)}this.setMode=l,this.setIndex=c,this.render=u,this.renderInstances=h}function mo(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:r,update:n}}function go(e,t){return e[0]-t[0]}function vo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function yo(e){const t={},n=new Float32Array(8),r=[];for(let e=0;e<8;e++)r[e]=[e,0];function i(i,a,o,s){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=t[a.id];if(void 0===u){u=[];for(let e=0;e<c;e++)u[e]=[e,0];t[a.id]=u}for(let e=0;e<c;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(vo);for(let e=0;e<8;e++)e<c&&u[e][1]?(r[e][0]=u[e][0],r[e][1]=u[e][1]):(r[e][0]=Number.MAX_SAFE_INTEGER,r[e][1]=0);r.sort(go);const h=o.morphTargets&&a.morphAttributes.position,d=o.morphNormals&&a.morphAttributes.normal;let f=0;for(let e=0;e<8;e++){const t=r[e],i=t[0],o=t[1];i!==Number.MAX_SAFE_INTEGER&&o?(h&&a.getAttribute("morphTarget"+e)!==h[i]&&a.setAttribute("morphTarget"+e,h[i]),d&&a.getAttribute("morphNormal"+e)!==d[i]&&a.setAttribute("morphNormal"+e,d[i]),n[e]=o,f+=o):(h&&!0===a.hasAttribute("morphTarget"+e)&&a.deleteAttribute("morphTarget"+e),d&&!0===a.hasAttribute("morphNormal"+e)&&a.deleteAttribute("morphNormal"+e),n[e]=0)}const p=a.morphTargetsRelative?1:1-f;s.getUniforms().setValue(e,"morphTargetBaseInfluence",p),s.getUniforms().setValue(e,"morphTargetInfluences",n)}return{update:i}}function _o(e,t,n,r){let i=new WeakMap;function a(a){const o=r.render.frame,l=a.geometry,c=t.get(a,l);return i.get(c)!==o&&(t.update(c),i.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER)),c}function o(){i=new WeakMap}function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:a,dispose:o}}io.physical={uniforms:Ha([io.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new or(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ji(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:no.meshphysical_vert,fragmentShader:no.meshphysical_frag};class bo extends hr{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=de,this.minFilter=de,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}bo.prototype.isDataTexture2DArray=!0;class Eo extends hr{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=de,this.minFilter=de,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Eo.prototype.isDataTexture3D=!0;const wo=new hr,xo=new bo,To=new Eo,Ao=new Xa,Mo=[],So=[],Ro=new Float32Array(16),ko=new Float32Array(9),Po=new Float32Array(4);function Lo(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=Mo[i];if(void 0===a&&(a=new Float32Array(i),Mo[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function Co(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Io(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function No(e,t){let n=So[t];void 0===n&&(n=new Int32Array(t),So[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Fo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Oo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Co(n,t))return;e.uniform2fv(this.addr,t),Io(n,t)}}function Ho(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Co(n,t))return;e.uniform3fv(this.addr,t),Io(n,t)}}function Do(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Co(n,t))return;e.uniform4fv(this.addr,t),Io(n,t)}}function Uo(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Co(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Io(n,t)}else{if(Co(n,r))return;Po.set(r),e.uniformMatrix2fv(this.addr,!1,Po),Io(n,r)}}function Bo(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Co(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Io(n,t)}else{if(Co(n,r))return;ko.set(r),e.uniformMatrix3fv(this.addr,!1,ko),Io(n,r)}}function zo(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Co(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Io(n,t)}else{if(Co(n,r))return;Ro.set(r),e.uniformMatrix4fv(this.addr,!1,Ro),Io(n,r)}}function Vo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function jo(e,t){const n=this.cache;Co(n,t)||(e.uniform2iv(this.addr,t),Io(n,t))}function Go(e,t){const n=this.cache;Co(n,t)||(e.uniform3iv(this.addr,t),Io(n,t))}function Wo(e,t){const n=this.cache;Co(n,t)||(e.uniform4iv(this.addr,t),Io(n,t))}function qo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Xo(e,t){const n=this.cache;Co(n,t)||(e.uniform2uiv(this.addr,t),Io(n,t))}function Yo(e,t){const n=this.cache;Co(n,t)||(e.uniform3uiv(this.addr,t),Io(n,t))}function Ko(e,t){const n=this.cache;Co(n,t)||(e.uniform4uiv(this.addr,t),Io(n,t))}function Zo(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||wo,i)}function Qo(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||To,i)}function Jo(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Ao,i)}function $o(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||xo,i)}function es(e){switch(e){case 5126:return Fo;case 35664:return Oo;case 35665:return Ho;case 35666:return Do;case 35674:return Uo;case 35675:return Bo;case 35676:return zo;case 5124:case 35670:return Vo;case 35667:case 35671:return jo;case 35668:case 35672:return Go;case 35669:case 35673:return Wo;case 5125:return qo;case 36294:return Xo;case 36295:return Yo;case 36296:return Ko;case 35678:case 36198:case 36298:case 36306:case 35682:return Zo;case 35679:case 36299:case 36307:return Qo;case 35680:case 36300:case 36308:case 36293:return Jo;case 36289:case 36303:case 36311:case 36292:return $o}}function ts(e,t){e.uniform1fv(this.addr,t)}function ns(e,t){const n=Lo(t,this.size,2);e.uniform2fv(this.addr,n)}function rs(e,t){const n=Lo(t,this.size,3);e.uniform3fv(this.addr,n)}function is(e,t){const n=Lo(t,this.size,4);e.uniform4fv(this.addr,n)}function as(e,t){const n=Lo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function os(e,t){const n=Lo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ss(e,t){const n=Lo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ls(e,t){e.uniform1iv(this.addr,t)}function cs(e,t){e.uniform2iv(this.addr,t)}function us(e,t){e.uniform3iv(this.addr,t)}function hs(e,t){e.uniform4iv(this.addr,t)}function ds(e,t){e.uniform1uiv(this.addr,t)}function fs(e,t){e.uniform2uiv(this.addr,t)}function ps(e,t){e.uniform3uiv(this.addr,t)}function ms(e,t){e.uniform4uiv(this.addr,t)}function gs(e,t,n){const r=t.length,i=No(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||wo,i[e])}function vs(e,t,n){const r=t.length,i=No(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||Ao,i[e])}function ys(e){switch(e){case 5126:return ts;case 35664:return ns;case 35665:return rs;case 35666:return is;case 35674:return as;case 35675:return os;case 35676:return ss;case 5124:case 35670:return ls;case 35667:case 35671:return cs;case 35668:case 35672:return us;case 35669:case 35673:return hs;case 5125:return ds;case 36294:return fs;case 36295:return ps;case 36296:return ms;case 35678:case 36198:case 36298:case 36306:case 35682:return gs;case 35680:case 36300:case 36308:case 36293:return vs}}function _s(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=es(t.type)}function bs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=ys(t.type)}function Es(e){this.id=e,this.seq=[],this.map={}}bs.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Io(t,e)},Es.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}};const ws=/(\w+)(\])?(\[|\.)?/g;function xs(e,t){e.seq.push(t),e.map[t.id]=t}function Ts(e,t,n){const r=e.name,i=r.length;for(ws.lastIndex=0;;){const a=ws.exec(r),o=ws.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===i){xs(n,void 0===c?new _s(s,e,t):new bs(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new Es(s),xs(n,e)),n=e}}}function As(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Ts(n,e.getUniformLocation(t,n.name),this)}}function Ms(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}As.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},As.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},As.upload=function(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}},As.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let Ss=0;function Rs(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}function ks(e){switch(e){case Yt:return["Linear","( value )"];case Kt:return["sRGB","( value )"];case Qt:return["RGBE","( value )"];case $t:return["RGBM","( value, 7.0 )"];case en:return["RGBM","( value, 16.0 )"];case tn:return["RGBD","( value, 256.0 )"];case Zt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Jt:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Ps(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+Rs(e.getShaderSource(t))}function Ls(e,t){const n=ks(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Cs(e,t){const n=ks(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Is(e,t){let n;switch(t){case Q:n="Linear";break;case J:n="Reinhard";break;case $:n="OptimizedCineon";break;case ee:n="ACESFilmic";break;case te:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Ns(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Hs).join("\n")}function Fs(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}function Os(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i).name;n[r]=e.getAttribLocation(t,r)}return n}function Hs(e){return""!==e}function Ds(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Us(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Bs=/^[ \t]*#include +<([\w\d./]+)>/gm;function zs(e){return e.replace(Bs,Vs)}function Vs(e,t){const n=no[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return zs(n)}const js=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Gs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ws(e){return e.replace(Gs,Xs).replace(js,qs)}function qs(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Xs(e,t,n,r)}function Xs(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Ys(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ks(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===c?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===u?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===h&&(t="SHADOWMAP_TYPE_VSM"),t}function Zs(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case re:case ie:t="ENVMAP_TYPE_CUBE";break;case se:case le:t="ENVMAP_TYPE_CUBE_UV"}return t}function Qs(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ie:case le:t="ENVMAP_MODE_REFRACTION"}return t}function Js(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case X:t="ENVMAP_BLENDING_MULTIPLY";break;case Y:t="ENVMAP_BLENDING_MIX";break;case K:t="ENVMAP_BLENDING_ADD"}return t}function $s(e,t,n,r){const i=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=Ks(n),c=Zs(n),u=Qs(n),h=Js(n),d=e.gammaFactor>0?e.gammaFactor:1,f=n.isWebGL2?"":Ns(n),p=Fs(a),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[p].filter(Hs).join("\n"),g.length>0&&(g+="\n"),v=[f,p].filter(Hs).join("\n"),v.length>0&&(v+="\n")):(g=[Ys(n),"#define SHADER_NAME "+n.shaderName,p,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Hs).join("\n"),v=[f,Ys(n),"#define SHADER_NAME "+n.shaderName,p,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Z?"#define TONE_MAPPING":"",n.toneMapping!==Z?no.tonemapping_pars_fragment:"",n.toneMapping!==Z?Is("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",no.encodings_pars_fragment,n.map?Ls("mapTexelToLinear",n.mapEncoding):"",n.matcap?Ls("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Ls("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Ls("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Ls("lightMapTexelToLinear",n.lightMapEncoding):"",Cs("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Hs).join("\n")),o=zs(o),o=Ds(o,n),o=Us(o,n),s=zs(s),s=Ds(s,n),s=Us(s,n),o=Ws(o),s=Ws(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===In?"":"out highp vec4 pc_fragColor;",n.glslVersion===In?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const _=y+g+o,b=y+v+s,E=Ms(i,i.VERTEX_SHADER,_),w=Ms(i,i.FRAGMENT_SHADER,b);if(i.attachShader(m,E),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),e.debug.checkShaderErrors){const e=i.getProgramInfoLog(m).trim(),t=i.getShaderInfoLog(E).trim(),n=i.getShaderInfoLog(w).trim();let r=!0,a=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS)){r=!1;const t=Ps(i,E,"vertex"),n=Ps(i,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"gl.VALIDATE_STATUS",i.getProgramParameter(m,i.VALIDATE_STATUS),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(a=!1);a&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let x,T;return i.deleteShader(E),i.deleteShader(w),this.getUniforms=function(){return void 0===x&&(x=new As(i,m)),x},this.getAttributes=function(){return void 0===T&&(T=Os(i,m)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=Ss++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=E,this.fragmentShader=w,this}function el(e,t,n,r,i,a){const o=[],s=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},g=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(e){const t=e.skeleton.bones;if(c)return 1024;{const e=u,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}function y(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Yt,t}function _(i,o,u,g,_){const b=g.fog,E=i.isMeshStandardMaterial?g.environment:null,w=t.get(i.envMap||E),x=m[i.type],T=_.isSkinnedMesh?v(_):0;let A,M;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),x){const e=io[x];A=e.vertexShader,M=e.fragmentShader}else A=i.vertexShader,M=i.fragmentShader;const S=e.getRenderTarget();return{isWebGL2:s,shaderID:x,shaderName:i.type,vertexShader:A,fragmentShader:M,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:h,outputEncoding:null!==S?y(S.texture):e.outputEncoding,map:!!i.map,mapEncoding:y(i.map),matcap:!!i.matcap,matcapEncoding:y(i.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:y(w),envMapCubeUV:!!w&&(w.mapping===se||w.mapping===le),lightMap:!!i.lightMap,lightMapEncoding:y(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:y(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===on,tangentSpaceNormalMap:i.normalMapType===an,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&_.geometry&&_.geometry.attributes.color&&4===_.geometry.attributes.color.itemSize,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!b,useFog:i.fog,fogExp2:b&&b.isFogExp2,flatShading:!!i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:i.skinning&&T>0,maxBones:T,useVertexTexture:c,morphTargets:i.morphTargets,morphNormals:i.morphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:Z,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===p,flipSided:i.side===f,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}}function b(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<g.length;e++)n.push(t[g[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()}function E(e){const t=m[e.type];let n;if(t){const e=io[t];n=Da.clone(e.uniforms)}else n=e.uniforms;return n}function w(t,n){let r;for(let e=0,t=o.length;e<t;e++){const t=o[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new $s(e,n,t,i),o.push(r)),r}function x(e){if(0==--e.usedTimes){const t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}}return{getParameters:_,getProgramCacheKey:b,getUniforms:E,acquireProgram:w,releaseProgram:x,programs:o}}function tl(){let e=new WeakMap;function t(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n}function n(t){e.delete(t)}function r(t,n,r){e.get(t)[n]=r}function i(){e=new WeakMap}return{get:t,remove:n,update:r,dispose:i}}function nl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function rl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function il(e){const t=[];let n=0;const r=[],i=[],a={id:-1};function o(){n=0,r.length=0,i.length=0}function s(r,i,o,s,l,c){let u=t[n];const h=e.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||a,groupOrder:s,renderOrder:r.renderOrder,z:l,group:c},t[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||a,u.groupOrder=s,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}function l(e,t,n,a,o,l){const c=s(e,t,n,a,o,l);(!0===n.transparent?i:r).push(c)}function c(e,t,n,a,o,l){const c=s(e,t,n,a,o,l);(!0===n.transparent?i:r).unshift(c)}function u(e,t){r.length>1&&r.sort(e||nl),i.length>1&&i.sort(t||rl)}function h(){for(let e=n,r=t.length;e<r;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}}return{opaque:r,transparent:i,init:o,push:l,unshift:c,finish:h,sort:u}}function al(e){let t=new WeakMap;function n(n,r){let i;return!1===t.has(n)?(i=new il(e),t.set(n,[i])):r>=t.get(n).length?(i=new il(e),t.get(n).push(i)):i=t.get(n)[r],i}function r(){t=new WeakMap}return{get:n,dispose:r}}function ol(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new vr,color:new ji};break;case"SpotLight":n={position:new vr,direction:new vr,color:new ji,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new vr,color:new ji,distance:0,decay:0};break;case"HemisphereLight":n={direction:new vr,skyColor:new ji,groundColor:new ji};break;case"RectAreaLight":n={color:new ji,position:new vr,halfWidth:new vr,halfHeight:new vr}}return e[t.id]=n,n}}}function sl(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new or};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new or,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}let ll=0;function cl(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function ul(e,t){const n=new ol,r=sl(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new vr);const a=new vr,o=new Yr,s=new Yr;function l(a){let o=0,s=0,l=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let c=0,u=0,h=0,d=0,f=0,p=0,m=0,g=0;a.sort(cl);for(let e=0,t=a.length;e<t;e++){const t=a[e],v=t.color,y=t.intensity,_=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=v.r*y,s+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=b,i.directionalShadowMatrix[c]=t.shadow.matrix,p++}i.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=b,i.spotShadowMatrix[h]=t.shadow.matrix,g++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=b,i.pointShadowMatrix[u]=t.shadow.matrix,m++}i.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),i.hemi[f]=e,f++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=ro.LTC_FLOAT_1,i.rectAreaLTC2=ro.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=ro.LTC_HALF_1,i.rectAreaLTC2=ro.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=o,i.ambient[1]=s,i.ambient[2]=l;const v=i.hash;v.directionalLength===c&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===f&&v.numDirectionalShadows===p&&v.numPointShadows===m&&v.numSpotShadows===g||(i.directional.length=c,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=f,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=f,v.numDirectionalShadows=p,v.numPointShadows=m,v.numSpotShadows=g,i.version=ll++)}function c(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),s.identity(),o.copy(d.matrixWorld),o.premultiply(h),s.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}}return{setup:l,setupView:c,state:i}}function hl(e,t){const n=new ul(e,t),r=[],i=[];function a(){r.length=0,i.length=0}function o(e){r.push(e)}function s(e){i.push(e)}function l(){n.setup(r)}function c(e){n.setupView(r,e)}return{init:a,state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:s}}function dl(e,t){let n=new WeakMap;function r(r,i=0){let a;return!1===n.has(r)?(a=new hl(e,t),n.set(r,[a])):i>=n.get(r).length?(a=new hl(e,t),n.get(r).push(a)):a=n.get(r)[i],a}function i(){n=new WeakMap}return{get:r,dispose:i}}class fl extends Oi{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=nn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}fl.prototype.isMeshDepthMaterial=!0;class pl extends Oi{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new vr,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}pl.prototype.isMeshDistanceMaterial=!0;var ml="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",gl="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function vl(e,t,n){let r=new Ja;const i=new or,a=new or,o=new fr,s=[],l=[],u={},m=n.maxTextureSize,g={0:f,1:d,2:p},y=new za({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new or},radius:{value:4}},vertexShader:gl,fragmentShader:ml}),_=y.clone();_.defines.HORIZONTAL_PASS=1;const b=new pa;b.setAttribute("position",new Xi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new Ca(b,y),w=this;function x(n,r){const i=t.update(E);y.uniforms.shadow_pass.value=n.map.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,y,E,null),_.uniforms.shadow_pass.value=n.mapPass.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,_,E,null)}function T(e,t,n){const r=e<<0|t<<1|n<<2;let i=s[r];return void 0===i&&(i=new fl({depthPacking:rn,morphTargets:e,skinning:t}),s[r]=i),i}function A(e,t,n){const r=e<<0|t<<1|n<<2;let i=l[r];return void 0===i&&(i=new pl({morphTargets:e,skinning:t}),l[r]=i),i}function M(t,n,r,i,a,o,s){let l=null,c=T,d=t.customDepthMaterial;if(!0===i.isPointLight&&(c=A,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===r.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=c(e,i,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const e=l.uuid,t=r.uuid;let n=u[e];void 0===n&&(n={},u[e]=n);let i=n[t];void 0===i&&(i=l.clone(),n[t]=i),l=i}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=s===h?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:g[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=a,l.farDistance=o),l}function S(n,i,a,o,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===h)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=M(n,r,u,o,a.near,a.far,s);e.renderBufferDirect(a,null,r,t,n,c)}}}else if(i.visible){const t=M(n,r,i,o,a.near,a.far,s);e.renderBufferDirect(a,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)S(l[e],i,a,o,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=c,this.render=function(t,n,s){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(v),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;i.copy(u.mapSize);const f=u.getFrameExtents();if(i.multiply(f),a.copy(u.mapSize),(i.x>m||i.y>m)&&(i.x>m&&(a.x=Math.floor(m/f.x),i.x=a.x*f.x,u.mapSize.x=a.x),i.y>m&&(a.y=Math.floor(m/f.y),i.y=a.y*f.y,u.mapSize.y=a.y)),null===u.map&&!u.isPointLightShadow&&this.type===h){const e={minFilter:ve,magFilter:ve,format:Oe};u.map=new pr(i.x,i.y,e),u.map.texture.name=c.name+".shadowMap",u.mapPass=new pr(i.x,i.y,e),u.camera.updateProjectionMatrix()}if(null===u.map){const e={minFilter:de,magFilter:de,format:Oe};u.map=new pr(i.x,i.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const p=u.getViewportCount();for(let e=0;e<p;e++){const t=u.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(o),u.updateMatrices(c,e),r=u.getFrustum(),S(n,s,u.camera,c,this.type)}u.isPointLightShadow||this.type!==h||x(u,s),u.needsUpdate=!1}w.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function yl(e,t,n){const r=n.isWebGL2;function s(){let t=!1;const n=new fr;let r=null;const i=new fr(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}}function l(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?_e(e.DEPTH_TEST):be(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case U:e.depthFunc(e.NEVER);break;case B:e.depthFunc(e.ALWAYS);break;case z:e.depthFunc(e.LESS);break;case V:e.depthFunc(e.LEQUAL);break;case j:e.depthFunc(e.EQUAL);break;case G:e.depthFunc(e.GEQUAL);break;case W:e.depthFunc(e.GREATER);break;case q:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}}function c(){let t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(n){t||(n?_e(e.STENCIL_TEST):be(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null}}}const u=new s,h=new l,d=new c;let m={},g=null,X={},Y=null,K=!1,Z=null,Q=null,J=null,$=null,ee=null,te=null,ne=null,re=!1,ie=null,ae=null,oe=null,se=null,le=null;const ce=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ue=!1,he=0;const de=e.getParameter(e.VERSION);-1!==de.indexOf("WebGL")?(he=parseFloat(/^WebGL (\d)/.exec(de)[1]),ue=he>=1):-1!==de.indexOf("OpenGL ES")&&(he=parseFloat(/^OpenGL ES (\d)/.exec(de)[1]),ue=he>=2);let fe=null,pe={};const me=new fr(0,0,e.canvas.width,e.canvas.height),ge=new fr(0,0,e.canvas.width,e.canvas.height);function ve(t,n,r){const i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let t=0;t<r;t++)e.texImage2D(n+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return a}const ye={};function _e(t){!0!==m[t]&&(e.enable(t),m[t]=!0)}function be(t){!1!==m[t]&&(e.disable(t),m[t]=!1)}function Ee(t){t!==g&&(e.bindFramebuffer(e.FRAMEBUFFER,t),g=t)}function we(t,n){null===n&&null!==g&&(n=g),X[t]!==n&&(e.bindFramebuffer(t,n),X[t]=n,r&&(t===e.DRAW_FRAMEBUFFER&&(X[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(X[e.DRAW_FRAMEBUFFER]=n)))}function xe(t){return Y!==t&&(e.useProgram(t),Y=t,!0)}ye[e.TEXTURE_2D]=ve(e.TEXTURE_2D,e.TEXTURE_2D,1),ye[e.TEXTURE_CUBE_MAP]=ve(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),u.setClear(0,0,0,1),h.setClear(1),d.setClear(0),_e(e.DEPTH_TEST),h.setFunc(V),Re(!1),ke(a),_e(e.CULL_FACE),Me(v);const Te={[x]:e.FUNC_ADD,[T]:e.FUNC_SUBTRACT,[A]:e.FUNC_REVERSE_SUBTRACT};if(r)Te[M]=e.MIN,Te[S]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(Te[M]=e.MIN_EXT,Te[S]=e.MAX_EXT)}const Ae={[R]:e.ZERO,[k]:e.ONE,[P]:e.SRC_COLOR,[C]:e.SRC_ALPHA,[D]:e.SRC_ALPHA_SATURATE,[O]:e.DST_COLOR,[N]:e.DST_ALPHA,[L]:e.ONE_MINUS_SRC_COLOR,[I]:e.ONE_MINUS_SRC_ALPHA,[H]:e.ONE_MINUS_DST_COLOR,[F]:e.ONE_MINUS_DST_ALPHA};function Me(t,n,r,i,a,o,s,l){if(t!==v){if(!1===K&&(_e(e.BLEND),K=!0),t===w)a=a||n,o=o||r,s=s||i,n===Q&&a===ee||(e.blendEquationSeparate(Te[n],Te[a]),Q=n,ee=a),r===J&&i===$&&o===te&&s===ne||(e.blendFuncSeparate(Ae[r],Ae[i],Ae[o],Ae[s]),J=r,$=i,te=o,ne=s),Z=t,re=null;else if(t!==Z||l!==re){if(Q===x&&ee===x||(e.blendEquation(e.FUNC_ADD),Q=x,ee=x),l)switch(t){case y:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case _:e.blendFunc(e.ONE,e.ONE);break;case b:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case E:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case y:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case _:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case b:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case E:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}J=null,$=null,te=null,ne=null,Z=t,re=l}}else!0===K&&(be(e.BLEND),K=!1)}function Se(t,n){t.side===p?be(e.CULL_FACE):_e(e.CULL_FACE);let r=t.side===f;n&&(r=!r),Re(r),t.blending===y&&!1===t.transparent?Me(v):Me(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),h.setFunc(t.depthFunc),h.setTest(t.depthTest),h.setMask(t.depthWrite),u.setMask(t.colorWrite);const i=t.stencilWrite;d.setTest(i),i&&(d.setMask(t.stencilWriteMask),d.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),d.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Le(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?_e(e.SAMPLE_ALPHA_TO_COVERAGE):be(e.SAMPLE_ALPHA_TO_COVERAGE)}function Re(t){ie!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),ie=t)}function ke(t){t!==i?(_e(e.CULL_FACE),t!==ae&&(t===a?e.cullFace(e.BACK):t===o?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):be(e.CULL_FACE),ae=t}function Pe(t){t!==oe&&(ue&&e.lineWidth(t),oe=t)}function Le(t,n,r){t?(_e(e.POLYGON_OFFSET_FILL),se===n&&le===r||(e.polygonOffset(n,r),se=n,le=r)):be(e.POLYGON_OFFSET_FILL)}function Ce(t){t?_e(e.SCISSOR_TEST):be(e.SCISSOR_TEST)}function Ie(t){void 0===t&&(t=e.TEXTURE0+ce-1),fe!==t&&(e.activeTexture(t),fe=t)}function Ne(t,n){null===fe&&Ie();let r=pe[fe];void 0===r&&(r={type:void 0,texture:void 0},pe[fe]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ye[t]),r.type=t,r.texture=n)}function Fe(){const t=pe[fe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)}function Oe(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function He(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function De(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function Ue(t){!1===me.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),me.copy(t))}function Be(t){!1===ge.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ge.copy(t))}function ze(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),m={},fe=null,pe={},g=null,X={},Y=null,K=!1,Z=null,Q=null,J=null,$=null,ee=null,te=null,ne=null,re=!1,ie=null,ae=null,oe=null,se=null,le=null,me.set(0,0,e.canvas.width,e.canvas.height),ge.set(0,0,e.canvas.width,e.canvas.height),u.reset(),h.reset(),d.reset()}return{buffers:{color:u,depth:h,stencil:d},enable:_e,disable:be,bindFramebuffer:we,bindXRFramebuffer:Ee,useProgram:xe,setBlending:Me,setMaterial:Se,setFlipSided:Re,setCullFace:ke,setLineWidth:Pe,setPolygonOffset:Le,setScissorTest:Ce,activeTexture:Ie,bindTexture:Ne,unbindTexture:Fe,compressedTexImage2D:Oe,texImage2D:He,texImage3D:De,scissor:Ue,viewport:Be,reset:ze}}function _l(e,t,n,r,i,a,o){const s=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let f,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?rr:Math.floor,a=r(i*e.width),o=r(i*e.height);void 0===f&&(f=m(a,o));const s=n?m(a,o):f;return s.width=a,s.height=o,s.getContext("2d").drawImage(e,0,0,a,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return tr(e.width)&&tr(e.height)}function y(e){return!s&&(e.wrapS!==ue||e.wrapT!==ue||e.minFilter!==de&&e.minFilter!==ve)}function _(e,t){return e.generateMipmaps&&t&&e.minFilter!==de&&e.minFilter!==ve}function b(t,n,i,a){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log2(Math.max(i,a))}function E(n,r,i){if(!1===s)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let a=r;return r===e.RED&&(i===e.FLOAT&&(a=e.R32F),i===e.HALF_FLOAT&&(a=e.R16F),i===e.UNSIGNED_BYTE&&(a=e.R8)),r===e.RGB&&(i===e.FLOAT&&(a=e.RGB32F),i===e.HALF_FLOAT&&(a=e.RGB16F),i===e.UNSIGNED_BYTE&&(a=e.RGB8)),r===e.RGBA&&(i===e.FLOAT&&(a=e.RGBA32F),i===e.HALF_FLOAT&&(a=e.RGBA16F),i===e.UNSIGNED_BYTE&&(a=e.RGBA8)),a!==e.R16F&&a!==e.R32F&&a!==e.RGBA16F&&a!==e.RGBA32F||t.get("EXT_color_buffer_float"),a}function w(t){return t===de||t===fe||t===me?e.NEAREST:e.LINEAR}function x(e){const t=e.target;t.removeEventListener("dispose",x),A(t),t.isVideoTexture&&d.delete(t),o.memory.textures--}function T(e){const t=e.target;t.removeEventListener("dispose",T),M(t),o.memory.textures--}function A(t){const n=r.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),r.remove(t))}function M(t){const n=t.texture,i=r.get(t),a=r.get(n);if(t){if(void 0!==a.__webglTexture&&e.deleteTexture(a.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);r.remove(n),r.remove(t)}}let S=0;function R(){S=0}function k(){const e=S;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),S+=1,e}function P(t,i){const a=r.get(t);if(t.isVideoTexture&&Y(t),t.version>0&&a.__version!==t.version){const e=t.image;if(void 0===e)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==e.complete)return void D(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D,a.__webglTexture)}function L(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?D(a,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture))}function C(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?D(a,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_3D,a.__webglTexture))}function I(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?U(a,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture))}const N={[ce]:e.REPEAT,[ue]:e.CLAMP_TO_EDGE,[he]:e.MIRRORED_REPEAT},F={[de]:e.NEAREST,[fe]:e.NEAREST_MIPMAP_NEAREST,[me]:e.NEAREST_MIPMAP_LINEAR,[ve]:e.LINEAR,[ye]:e.LINEAR_MIPMAP_NEAREST,[be]:e.LINEAR_MIPMAP_LINEAR};function O(n,a,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,N[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,N[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,N[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,F[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,F[a.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===ue&&a.wrapT===ue||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,w(a.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,w(a.minFilter)),a.minFilter!==de&&a.minFilter!==ve&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(a.type===Re&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&a.type===ke&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function H(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",x),t.__webglTexture=e.createTexture(),o.memory.textures++)}function D(t,r,i){let o=e.TEXTURE_2D;r.isDataTexture2DArray&&(o=e.TEXTURE_2D_ARRAY),r.isDataTexture3D&&(o=e.TEXTURE_3D),H(t,r),n.activeTexture(e.TEXTURE0+i),n.bindTexture(o,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const l=y(r)&&!1===v(r.image),c=g(r.image,l,!1,u),h=v(c)||s,d=a.convert(r.format);let f,p=a.convert(r.type),m=E(r.internalFormat,d,p);O(o,r,h);const w=r.mipmaps;if(r.isDepthTexture)m=e.DEPTH_COMPONENT,s?m=r.type===Re?e.DEPTH_COMPONENT32F:r.type===Se?e.DEPTH_COMPONENT24:r.type===Ie?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===Re&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Be&&m===e.DEPTH_COMPONENT&&r.type!==Ae&&r.type!==Se&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ae,p=a.convert(r.type)),r.format===ze&&m===e.DEPTH_COMPONENT&&(m=e.DEPTH_STENCIL,r.type!==Ie&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ie,p=a.convert(r.type))),n.texImage2D(e.TEXTURE_2D,0,m,c.width,c.height,0,d,p,null);else if(r.isDataTexture)if(w.length>0&&h){for(let t=0,r=w.length;t<r;t++)f=w[t],n.texImage2D(e.TEXTURE_2D,t,m,f.width,f.height,0,d,p,f.data);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(e.TEXTURE_2D,0,m,c.width,c.height,0,d,p,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,i=w.length;t<i;t++)f=w[t],r.format!==Oe&&r.format!==Fe?null!==d?n.compressedTexImage2D(e.TEXTURE_2D,t,m,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,t,m,f.width,f.height,0,d,p,f.data);t.__maxMipLevel=w.length-1}else if(r.isDataTexture2DArray)n.texImage3D(e.TEXTURE_2D_ARRAY,0,m,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(e.TEXTURE_3D,0,m,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(w.length>0&&h){for(let t=0,r=w.length;t<r;t++)f=w[t],n.texImage2D(e.TEXTURE_2D,t,m,d,p,f);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(e.TEXTURE_2D,0,m,d,p,c),t.__maxMipLevel=0;_(r,h)&&b(o,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function U(t,r,i){if(6!==r.image.length)return;H(t,r),n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=o||l?l?r.image[e].image:r.image[e]:g(r.image[e],!1,!0,c);const h=u[0],d=v(h)||s,f=a.convert(r.format),p=a.convert(r.type),m=E(r.internalFormat,f,p);let y;if(O(e.TEXTURE_CUBE_MAP,r,d),o){for(let t=0;t<6;t++){y=u[t].mipmaps;for(let i=0;i<y.length;i++){const a=y[i];r.format!==Oe&&r.format!==Fe?null!==f?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,m,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,m,a.width,a.height,0,f,p,a.data)}}t.__maxMipLevel=y.length-1}else{y=r.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,u[t].width,u[t].height,0,f,p,u[t].data);for(let r=0;r<y.length;r++){const i=y[r].image[t].image;n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,m,i.width,i.height,0,f,p,i.data)}}else{n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,f,p,u[t]);for(let r=0;r<y.length;r++){const i=y[r];n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,m,f,p,i.image[t])}}t.__maxMipLevel=y.length}_(r,d)&&b(e.TEXTURE_CUBE_MAP,r,h.width,h.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function B(t,i,o,s){const l=i.texture,c=a.convert(l.format),u=a.convert(l.type),h=E(l.internalFormat,c,u);s===e.TEXTURE_3D||s===e.TEXTURE_2D_ARRAY?n.texImage3D(s,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(s,0,h,i.width,i.height,0,c,u,null),n.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,o,s,r.get(l).__webglTexture,0),n.bindFramebuffer(e.FRAMEBUFFER,null)}function z(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=e.DEPTH_COMPONENT16;if(r){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Re?i=e.DEPTH_COMPONENT32F:t.type===Se&&(i=e.DEPTH_COMPONENT24));const r=X(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const t=X(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,t,e.DEPTH24_STENCIL8,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=n.texture,i=a.convert(t.format),o=a.convert(t.type),s=E(t.internalFormat,i,o);if(r){const t=X(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,t,s,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function V(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),P(i.depthTexture,0);const a=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Be)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(i.depthTexture.format!==ze)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}function j(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");V(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),z(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),z(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function G(t){const i=t.texture,l=r.get(t),c=r.get(i);t.addEventListener("dispose",T),c.__webglTexture=e.createTexture(),c.__version=i.version,o.memory.textures++;const u=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultisampleRenderTarget,d=i.isDataTexture3D||i.isDataTexture2DArray,f=v(t)||s;if(!s||i.format!==Fe||i.type!==Re&&i.type!==ke||(i.format=Oe,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){l.__webglFramebuffer=[];for(let t=0;t<6;t++)l.__webglFramebuffer[t]=e.createFramebuffer()}else if(l.__webglFramebuffer=e.createFramebuffer(),h)if(s){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,l.__webglColorRenderbuffer);const r=a.convert(i.format),o=a.convert(i.type),s=E(i.internalFormat,r,o),c=X(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,s,t.width,t.height),n.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,l.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),z(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),O(e.TEXTURE_CUBE_MAP,i,f);for(let n=0;n<6;n++)B(l.__webglFramebuffer[n],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n);_(i,f)&&b(e.TEXTURE_CUBE_MAP,i,t.width,t.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else{let r=e.TEXTURE_2D;d&&(s?r=i.isDataTexture3D?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(r,c.__webglTexture),O(r,i,f),B(l.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,r),_(i,f)&&b(e.TEXTURE_2D,i,t.width,t.height),n.bindTexture(e.TEXTURE_2D,null)}t.depthBuffer&&j(t)}function W(t){const i=t.texture;if(_(i,v(t)||s)){const a=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=r.get(i).__webglTexture;n.bindTexture(a,o),b(a,i,t.width,t.height),n.bindTexture(a,null)}}function q(t){if(t.isWebGLMultisampleRenderTarget)if(s){const i=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT);const s=r.get(t);n.bindFramebuffer(e.READ_FRAMEBUFFER,s.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,s.__webglFramebuffer),e.blitFramebuffer(0,0,i,a,0,0,i,a,o,e.NEAREST),n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function X(e){return s&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}function Y(e){const t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}let K=!1,Z=!1;function Q(e,t){e&&e.isWebGLRenderTarget&&(!1===K&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),K=!0),e=e.texture),P(e,t)}function J(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===Z&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Z=!0),e=e.texture),I(e,t)}this.allocateTextureUnit=k,this.resetTextureUnits=R,this.setTexture2D=P,this.setTexture2DArray=L,this.setTexture3D=C,this.setTextureCube=I,this.setupRenderTarget=G,this.updateRenderTargetMipmap=W,this.updateMultisampleRenderTarget=q,this.safeSetTexture2D=Q,this.safeSetTextureCube=J}function bl(e,t,n){const r=n.isWebGL2;function i(n){let i;if(n===we)return e.UNSIGNED_BYTE;if(n===Pe)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Le)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Ce)return e.UNSIGNED_SHORT_5_6_5;if(n===xe)return e.BYTE;if(n===Te)return e.SHORT;if(n===Ae)return e.UNSIGNED_SHORT;if(n===Me)return e.INT;if(n===Se)return e.UNSIGNED_INT;if(n===Re)return e.FLOAT;if(n===ke)return r?e.HALF_FLOAT:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(n===Ne)return e.ALPHA;if(n===Fe)return e.RGB;if(n===Oe)return e.RGBA;if(n===He)return e.LUMINANCE;if(n===De)return e.LUMINANCE_ALPHA;if(n===Be)return e.DEPTH_COMPONENT;if(n===ze)return e.DEPTH_STENCIL;if(n===Ve)return e.RED;if(n===je)return e.RED_INTEGER;if(n===Ge)return e.RG;if(n===We)return e.RG_INTEGER;if(n===qe)return e.RGB_INTEGER;if(n===Xe)return e.RGBA_INTEGER;if(n===Ye||n===Ke||n===Ze||n===Qe){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Ye)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ke)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Ze)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Qe)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Je||n===$e||n===et||n===tt){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===Je)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===$e)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===et)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===tt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===nt)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((n===rt||n===it)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(n===rt)return i.COMPRESSED_RGB8_ETC2;if(n===it)return i.COMPRESSED_RGBA8_ETC2_EAC}return n===at||n===ot||n===st||n===lt||n===ct||n===ut||n===ht||n===dt||n===ft||n===pt||n===mt||n===gt||n===vt||n===yt||n===bt||n===Et||n===wt||n===xt||n===Tt||n===At||n===Mt||n===St||n===Rt||n===kt||n===Pt||n===Lt||n===Ct||n===It?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?n:null):n===_t?(i=t.get("EXT_texture_compression_bptc"),null!==i?n:null):n===Ie?r?e.UNSIGNED_INT_24_8:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}return{convert:i}}class El extends ja{constructor(e=[]){super(),this.cameras=e}}El.prototype.isArrayCamera=!0;class wl extends _i{constructor(){super(),this.type="Group"}}wl.prototype.isGroup=!0;const xl={type:"move"};class Tl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new wl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new wl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new vr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new vr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new wl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new vr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new vr),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(xl))),l&&e.hand){a=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const e=new wl;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}const i=l.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}}class Al extends Nn{constructor(e,t){super();const n=this,r=e.state;let i=null,a=1,o=null,s="local-floor",l=null;const c=[],u=new Map,h=new ja;h.layers.enable(1),h.viewport=new fr;const d=new ja;d.layers.enable(2),d.viewport=new fr;const f=[h,d],p=new El;p.layers.enable(1),p.layers.enable(2);let m=null,g=null;function v(e){const t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){u.forEach((function(e,t){e.disconnect(t)})),u.clear(),m=null,g=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),M.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function _(e){const t=i.inputSources;for(let e=0;e<c.length;e++)u.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=u.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),u.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=u.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new Tl,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new Tl,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new Tl,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=async function(e){if(i=e,null!==i){i.addEventListener("select",v),i.addEventListener("selectstart",v),i.addEventListener("selectend",v),i.addEventListener("squeeze",v),i.addEventListener("squeezestart",v),i.addEventListener("squeezeend",v),i.addEventListener("end",y),i.addEventListener("inputsourceschange",_);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const r={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:a},l=new XRWebGLLayer(i,t,r);i.updateRenderState({baseLayer:l}),o=await i.requestReferenceSpace(s),M.setContext(i),M.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const b=new vr,E=new vr;function w(e,t,n){b.setFromMatrixPosition(t.matrixWorld),E.setFromMatrixPosition(n.matrixWorld);const r=b.distanceTo(E),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*u,f=o*h,p=r/(-u+h),m=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+p,v=s+p,y=d-m,_=f+(r-m),w=l*s/v*g,x=c*s/v*g;e.projectionMatrix.makePerspective(y,_,w,x,g,v)}function x(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){p.near=d.near=h.near=e.near,p.far=d.far=h.far=e.far,m===p.near&&g===p.far||(i.updateRenderState({depthNear:p.near,depthFar:p.far}),m=p.near,g=p.far);const t=e.parent,n=p.cameras;x(p,t);for(let e=0;e<n.length;e++)x(n[e],t);e.matrixWorld.copy(p.matrixWorld),e.matrix.copy(p.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);return 2===n.length?w(p,h,d):p.projectionMatrix.copy(h.projectionMatrix),p};let T=null;function A(e,t){if(l=t.getViewerPose(o),null!==l){const e=l.views,t=i.renderState.baseLayer;r.bindXRFramebuffer(t.framebuffer);let n=!1;e.length!==p.cameras.length&&(p.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){const i=e[r],a=t.getViewport(i),o=f[r];o.matrix.fromArray(i.transform.matrix),o.projectionMatrix.fromArray(i.projectionMatrix),o.viewport.set(a.x,a.y,a.width,a.height),0===r&&p.matrix.copy(o.matrix),!0===n&&p.cameras.push(o)}}const n=i.inputSources;for(let e=0;e<c.length;e++){const r=c[e],i=n[e];r.update(i,t,o)}T&&T(e,t)}const M=new $a;M.setAnimationLoop(A),this.setAnimationLoop=function(e){T=e},this.dispose=function(){}}}function Ml(e){function t(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}function n(e,t,n,f){t.isMeshBasicMaterial?r(e,t):t.isMeshLambertMaterial?(r(e,t),l(e,t)):t.isMeshToonMaterial?(r(e,t),u(e,t)):t.isMeshPhongMaterial?(r(e,t),c(e,t)):t.isMeshStandardMaterial?(r(e,t),t.isMeshPhysicalMaterial?d(e,t):h(e,t)):t.isMeshMatcapMaterial?(r(e,t),p(e,t)):t.isMeshDepthMaterial?(r(e,t),m(e,t)):t.isMeshDistanceMaterial?(r(e,t),g(e,t)):t.isMeshNormalMaterial?(r(e,t),v(e,t)):t.isLineBasicMaterial?(i(e,t),t.isLineDashedMaterial&&a(e,t)):t.isPointsMaterial?o(e,t,n,f):t.isSpriteMaterial?s(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}function r(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const r=e.get(n).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const i=e.get(r).__maxMipLevel;void 0!==i&&(t.maxMipLevel.value=i)}let i,a;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?a=n.aoMap:n.lightMap&&(a=n.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),t.uv2Transform.value.copy(a.matrix))}function i(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}function a(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function o(e,t,n,r){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}function s(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function l(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function c(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function u(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function h(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===f&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===f&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}function d(e,t){h(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===f&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}function p(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function m(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function g(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}function v(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function Sl(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}function Rl(e){const t=void 0!==(e=e||{}).canvas?e.canvas:Sl(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Yt,this.physicallyCorrectLights=!1,this.toneMapping=Z,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,_=null,b=-1,E=null;const w=new fr,x=new fr;let T=null,A=t.width,M=t.height,S=1,R=null,k=null;const P=new fr(0,0,A,M),L=new fr(0,0,A,M);let C=!1;const I=new Ja;let N=!1,F=!1;const O=new Yr,H=new vr,D={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===_?S:1}let B,z,V,j,G,W,q,X,Y,K,Q,J,$,ee,te,ne,re,ie,ae,oe,se,le,ce=n;function ue(e,n){for(let r=0;r<e.length;r++){const i=e[r],a=t.getContext(i,n);if(null!==a)return a}return null}try{const e={alpha:r,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",pe,!1),null===ce){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ce=ue(t,e),null===ce)throw ue(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function he(){B=new ho(ce),z=new lo(ce,B,e),B.init(z),se=new bl(ce,B,z),V=new yl(ce,B,z),j=new mo(ce),G=new tl,W=new _l(ce,B,V,G,z,se,j),q=new uo(m),X=new eo(ce,z),le=new oo(ce,B,X,z),Y=new fo(ce,X,j,le),K=new _o(ce,Y,X,j),ie=new yo(ce),te=new co(G),Q=new el(m,q,B,z,le,te),J=new Ml(G),$=new al(G),ee=new dl(B,z),re=new ao(m,q,V,K,s),ne=new vl(m,K,z),ae=new so(ce,B,j,z),oe=new po(ce,B,j,z),j.programs=Q.programs,m.capabilities=z,m.extensions=B,m.properties=G,m.renderLists=$,m.shadowMap=ne,m.state=V,m.info=j}he();const de=new Al(m,ce);function fe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function pe(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=j.autoReset,t=ne.enabled,n=ne.autoUpdate,r=ne.needsUpdate,i=ne.type;he(),j.autoReset=e,ne.enabled=t,ne.autoUpdate=n,ne.needsUpdate=r,ne.type=i}function me(e){const t=e.target;t.removeEventListener("dispose",me),ge(t)}function ge(e){ve(e),G.remove(e)}function ve(e){const t=G.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))}function ye(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}this.xr=de,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const e=B.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=B.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return S},this.setPixelRatio=function(e){void 0!==e&&(S=e,this.setSize(A,M,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new or),e.set(A,M)},this.setSize=function(e,n,r){de.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(A=e,M=n,t.width=Math.floor(e*S),t.height=Math.floor(n*S),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new or),e.set(A*S,M*S).floor()},this.setDrawingBufferSize=function(e,n,r){A=e,M=n,S=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new fr),e.copy(w)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),V.viewport(w.copy(P).multiplyScalar(S).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,n,r){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,r),V.scissor(x.copy(L).multiplyScalar(S).floor())},this.getScissorTest=function(){return C},this.setScissorTest=function(e){V.setScissorTest(C=e)},this.setOpaqueSort=function(e){R=e},this.setTransparentSort=function(e){k=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new ji),e.copy(re.getClearColor())},this.setClearColor=function(){re.setClearColor.apply(re,arguments)},this.getClearAlpha=function(){return re.getClearAlpha()},this.setClearAlpha=function(){re.setClearAlpha.apply(re,arguments)},this.clear=function(e,t,n){let r=0;(void 0===e||e)&&(r|=ce.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=ce.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=ce.STENCIL_BUFFER_BIT),ce.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",pe,!1),$.dispose(),ee.dispose(),G.dispose(),q.dispose(),K.dispose(),le.dispose(),de.dispose(),de.removeEventListener("sessionstart",Ee),de.removeEventListener("sessionend",xe),Te.stop()},this.renderBufferImmediate=function(e,t){le.initAttributes();const n=G.get(e);e.hasPositions&&!n.position&&(n.position=ce.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ce.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ce.createBuffer()),e.hasColors&&!n.color&&(n.color=ce.createBuffer());const r=t.getAttributes();e.hasPositions&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.position),ce.bufferData(ce.ARRAY_BUFFER,e.positionArray,ce.DYNAMIC_DRAW),le.enableAttribute(r.position),ce.vertexAttribPointer(r.position,3,ce.FLOAT,!1,0,0)),e.hasNormals&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.normal),ce.bufferData(ce.ARRAY_BUFFER,e.normalArray,ce.DYNAMIC_DRAW),le.enableAttribute(r.normal),ce.vertexAttribPointer(r.normal,3,ce.FLOAT,!1,0,0)),e.hasUvs&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.uv),ce.bufferData(ce.ARRAY_BUFFER,e.uvArray,ce.DYNAMIC_DRAW),le.enableAttribute(r.uv),ce.vertexAttribPointer(r.uv,2,ce.FLOAT,!1,0,0)),e.hasColors&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.color),ce.bufferData(ce.ARRAY_BUFFER,e.colorArray,ce.DYNAMIC_DRAW),le.enableAttribute(r.color),ce.vertexAttribPointer(r.color,3,ce.FLOAT,!1,0,0)),le.disableUnusedAttributes(),ce.drawArrays(ce.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=D);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=Ce(e,t,r,i);V.setMaterial(r,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=Y.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&ie.update(i,n,r,s),le.setup(i,r,s,n,l);let d=ae;null!==l&&(u=X.get(l),d=oe,d.setIndex(u));const f=null!==l?l.count:c.count,p=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==a?a.start*h:0,v=null!==a?a.count*h:1/0,y=Math.max(p,g),_=Math.min(f,p+m,g+v)-1,b=Math.max(0,_-y+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(V.setLineWidth(r.wireframeLinewidth*U()),d.setMode(ce.LINES)):d.setMode(ce.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),V.setLineWidth(e*U()),i.isLineSegments?d.setMode(ce.LINES):i.isLineLoop?d.setMode(ce.LINE_LOOP):d.setMode(ce.LINE_STRIP)}else i.isPoints?d.setMode(ce.POINTS):i.isSprite&&d.setMode(ce.TRIANGLES);if(i.isInstancedMesh)d.renderInstances(y,b,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,b,e)}else d.render(y,b)}},this.compile=function(e,t){d=ee.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++)Pe(n[r],e,t);else Pe(n,e,t)}))};let _e=null;function be(e){_e&&_e(e)}function Ee(){Te.stop()}function xe(){Te.start()}const Te=new $a;function Ae(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(O);const t=K.update(e),i=e.material;i.visible&&h.push(e,t,i,n,H.z,null)}}else if(e.isImmediateRenderObject)r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(O),h.push(e,null,e.material,n,H.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==j.render.frame&&(e.skeleton.update(),e.skeleton.frame=j.render.frame),!e.frustumCulled||I.intersectsObject(e))){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(O);const t=K.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let a=0,o=r.length;a<o;a++){const o=r[a],s=i[o.materialIndex];s&&s.visible&&h.push(e,t,s,n,H.z,o)}}else i.visible&&h.push(e,t,i,n,H.z,null)}const i=e.children;for(let e=0,a=i.length;e<a;e++)Ae(i[e],t,n,r)}function Me(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],o=a.object,s=a.geometry,l=null===r?a.material:r,c=a.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,r=e.length;n<r;n++){const r=e[n];o.layers.test(r.layers)&&(V.viewport(w.copy(r.viewport)),d.setupLightsView(r),Se(o,t,r,s,l,c))}}else Se(o,t,n,s,l,c)}}function Se(e,t,n,r,i,a){if(e.onBeforeRender(m,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const r=Ce(n,t,i,e);V.setMaterial(i),le.reset(),ye(e,r)}else m.renderBufferDirect(n,t,r,i,e,a);e.onAfterRender(m,t,n,r,i,a)}function Pe(e,t,n){!0!==t.isScene&&(t=D);const r=G.get(e),i=d.state.lights,a=d.state.shadowsArray,o=i.state.version,s=Q.getParameters(e,i.state,a,t,n),l=Q.getProgramCacheKey(s);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=q.get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",me),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return Le(e,s),u}else s.uniforms=Q.getUniforms(e),e.onBuild(s,m),e.onBeforeCompile(s,m),u=Q.acquireProgram(s,l),c.set(l,u),r.uniforms=s.uniforms;const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=te.uniform),Le(e,s),r.needsLights=Ne(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const f=u.getUniforms(),p=As.seqWithValue(f.seq,h);return r.currentProgram=u,r.uniformsList=p,u}function Le(e,t){const n=G.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function Ce(e,t,n,r){!0!==t.isScene&&(t=D),W.resetTextureUnits();const i=t.fog,a=n.isMeshStandardMaterial?t.environment:null,o=null===_?m.outputEncoding:_.texture.encoding,s=q.get(n.envMap||a),l=!0===n.vertexColors&&r.geometry&&r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,c=G.get(n),u=d.state.lights;if(!0===N&&(!0===F||e!==E)){const t=e===E&&n.id===b;te.setState(n,e,t)}let h=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==u.state.version||c.outputEncoding!==o||r.isInstancedMesh&&!1===c.instancing?h=!0:r.isInstancedMesh||!0!==c.instancing?c.envMap!==s||n.fog&&c.fog!==i?h=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===te.numPlanes&&c.numIntersection===te.numIntersection?c.vertexAlphas!==l&&(h=!0):h=!0:h=!0:(h=!0,c.__version=n.version);let f=c.currentProgram;!0===h&&(f=Pe(n,t,r));let p=!1,g=!1,v=!1;const y=f.getUniforms(),w=c.uniforms;if(V.useProgram(f.program)&&(p=!0,g=!0,v=!0),n.id!==b&&(b=n.id,g=!0),p||E!==e){if(y.setValue(ce,"projectionMatrix",e.projectionMatrix),z.logarithmicDepthBuffer&&y.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),E!==e&&(E=e,g=!0,v=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=y.map.cameraPosition;void 0!==t&&t.setValue(ce,H.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&y.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&y.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){y.setOptional(ce,r,"bindMatrix"),y.setOptional(ce,r,"bindMatrixInverse");const e=r.skeleton;if(e){const t=e.bones;if(z.floatVertexTextures){if(null===e.boneTexture){let n=Math.sqrt(4*t.length);n=nr(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(e.boneMatrices);const i=new Ka(r,n,n,Oe,Re);e.boneMatrices=r,e.boneTexture=i,e.boneTextureSize=n}y.setValue(ce,"boneTexture",e.boneTexture,W),y.setValue(ce,"boneTextureSize",e.boneTextureSize)}else y.setOptional(ce,e,"boneMatrices")}}return(g||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,y.setValue(ce,"receiveShadow",r.receiveShadow)),g&&(y.setValue(ce,"toneMappingExposure",m.toneMappingExposure),c.needsLights&&Ie(w,v),i&&n.fog&&J.refreshFogUniforms(w,i),J.refreshMaterialUniforms(w,n,S,M),As.upload(ce,c.uniformsList,w,W)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(As.upload(ce,c.uniformsList,w,W),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&y.setValue(ce,"center",r.center),y.setValue(ce,"modelViewMatrix",r.modelViewMatrix),y.setValue(ce,"normalMatrix",r.normalMatrix),y.setValue(ce,"modelMatrix",r.matrixWorld),f}function Ie(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function Ne(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Te.setAnimationLoop(be),"undefined"!=typeof window&&Te.setContext(window),this.setAnimationLoop=function(e){_e=e,de.setAnimationLoop(e),null===e?Te.stop():Te.start()},de.addEventListener("sessionstart",Ee),de.addEventListener("sessionend",xe),this.render=function(e,t){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===de.enabled&&!0===de.isPresenting&&(t=de.getCamera(t)),!0===e.isScene&&e.onBeforeRender(m,e,t,n||_),d=ee.get(e,p.length),d.init(),p.push(d),O.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(O),F=this.localClippingEnabled,N=te.init(this.clippingPlanes,F,t),h=$.get(e,f.length),h.init(),f.push(h),Ae(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(R,k),!0===N&&te.beginShadows();const i=d.state.shadowsArray;ne.render(i,e,t),d.setupLights(),d.setupLightsView(t),!0===N&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),re.render(h,e,t,r);const a=h.opaque,o=h.transparent;a.length>0&&Me(a,e,t),o.length>0&&Me(o,e,t),null!==_&&(W.updateRenderTargetMipmap(_),W.updateMultisampleRenderTarget(_)),!0===e.isScene&&e.onAfterRender(m,e,t),V.buffers.depth.setTest(!0),V.buffers.depth.setMask(!0),V.buffers.color.setMask(!0),V.setPolygonOffset(!1),le.resetDefaultState(),b=-1,E=null,p.pop(),d=p.length>0?p[p.length-1]:null,f.pop(),h=f.length>0?f[f.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTarget=function(e,t=0,n=0){_=e,v=t,y=n,e&&void 0===G.get(e).__webglFramebuffer&&W.setupRenderTarget(e);let r=null,i=!1,a=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(a=!0);const o=G.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=o[t],i=!0):r=e.isWebGLMultisampleRenderTarget?G.get(e).__webglMultisampledFramebuffer:o,w.copy(e.viewport),x.copy(e.scissor),T=e.scissorTest}else w.copy(P).multiplyScalar(S).floor(),x.copy(L).multiplyScalar(S).floor(),T=C;if(V.bindFramebuffer(ce.FRAMEBUFFER,r),V.viewport(w),V.scissor(x),V.setScissorTest(T),i){const r=G.get(e.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(a){const r=G.get(e.texture),i=t||0;ce.framebufferTextureLayer(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=G.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){V.bindFramebuffer(ce.FRAMEBUFFER,s);try{const o=e.texture,s=o.format,l=o.type;if(s!==Oe&&se.convert(s)!==ce.getParameter(ce.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===ke&&(B.has("EXT_color_buffer_half_float")||z.isWebGL2&&B.has("EXT_color_buffer_float"));if(!(l===we||se.convert(l)===ce.getParameter(ce.IMPLEMENTATION_COLOR_READ_TYPE)||l===Re&&(z.isWebGL2||B.has("OES_texture_float")||B.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ce.checkFramebufferStatus(ce.FRAMEBUFFER)===ce.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ce.readPixels(t,n,r,i,se.convert(s),se.convert(l),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==_?G.get(_).__webglFramebuffer:null;V.bindFramebuffer(ce.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r),o=se.convert(t.format);W.setTexture2D(t,0),ce.copyTexImage2D(ce.TEXTURE_2D,n,o,e.x,e.y,i,a,0),V.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,a=t.image.height,o=se.convert(n.format),s=se.convert(n.type);W.setTexture2D(n,0),ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,n.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ce.texSubImage2D(ce.TEXTURE_2D,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?ce.compressedTexSubImage2D(ce.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ce.texSubImage2D(ce.TEXTURE_2D,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&ce.generateMipmap(ce.TEXTURE_2D),V.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:a,height:o,data:s}=n.image,l=se.convert(r.format),c=se.convert(r.type);let u;if(r.isDataTexture3D)W.setTexture3D(r,0),u=ce.TEXTURE_3D;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");W.setTexture2DArray(r,0),u=ce.TEXTURE_2D_ARRAY}ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,r.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,r.unpackAlignment);const h=ce.getParameter(ce.UNPACK_ROW_LENGTH),d=ce.getParameter(ce.UNPACK_IMAGE_HEIGHT),f=ce.getParameter(ce.UNPACK_SKIP_PIXELS),p=ce.getParameter(ce.UNPACK_SKIP_ROWS),g=ce.getParameter(ce.UNPACK_SKIP_IMAGES);ce.pixelStorei(ce.UNPACK_ROW_LENGTH,a),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,o),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,e.min.x),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,e.min.y),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,e.min.z),ce.texSubImage3D(u,i,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,s),ce.pixelStorei(ce.UNPACK_ROW_LENGTH,h),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,d),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,f),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,p),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,g),0===i&&r.generateMipmaps&&ce.generateMipmap(u),V.unbindTexture()},this.initTexture=function(e){W.setTexture2D(e,0),V.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,V.reset(),le.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class kl extends Rl{}kl.prototype.isWebGL1Renderer=!0;class Pl{constructor(e,t=25e-5){this.name="",this.color=new ji(e),this.density=t}clone(){return new Pl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Pl.prototype.isFogExp2=!0;class Ll{constructor(e,t=1,n=1e3){this.name="",this.color=new ji(e),this.near=t,this.far=n}clone(){return new Ll(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Ll.prototype.isFog=!0;class Cl extends _i{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Cl.prototype.isScene=!0;class Il{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=xn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Un(),this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Un()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new Il(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Un()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Il.prototype.isInterleavedBuffer=!0;const Nl=new vr;class Fl{constructor(e,t,n,r){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Nl.x=this.getX(t),Nl.y=this.getY(t),Nl.z=this.getZ(t),Nl.applyMatrix4(e),this.setXYZ(t,Nl.x,Nl.y,Nl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Nl.x=this.getX(t),Nl.y=this.getY(t),Nl.z=this.getZ(t),Nl.applyNormalMatrix(e),this.setXYZ(t,Nl.x,Nl.y,Nl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Nl.x=this.getX(t),Nl.y=this.getY(t),Nl.z=this.getZ(t),Nl.transformDirection(e),this.setXYZ(t,Nl.x,Nl.y,Nl.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Xi(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Fl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Fl.prototype.isInterleavedBufferAttribute=!0;class Ol extends Oi{constructor(e){super(),this.type="SpriteMaterial",this.color=new ji(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Hl;Ol.prototype.isSpriteMaterial=!0;const Dl=new vr,Ul=new vr,Bl=new vr,zl=new or,Vl=new or,jl=new Yr,Gl=new vr,Wl=new vr,ql=new vr,Xl=new or,Yl=new or,Kl=new or;class Zl extends _i{constructor(e){if(super(),this.type="Sprite",void 0===Hl){Hl=new pa;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Il(e,5);Hl.setIndex([0,1,2,0,2,3]),Hl.setAttribute("position",new Fl(t,3,0,!1)),Hl.setAttribute("uv",new Fl(t,2,3,!1))}this.geometry=Hl,this.material=void 0!==e?e:new Ol,this.center=new or(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ul.setFromMatrixScale(this.matrixWorld),jl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Bl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ul.multiplyScalar(-Bl.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const a=this.center;Ql(Gl.set(-.5,-.5,0),Bl,a,Ul,r,i),Ql(Wl.set(.5,-.5,0),Bl,a,Ul,r,i),Ql(ql.set(.5,.5,0),Bl,a,Ul,r,i),Xl.set(0,0),Yl.set(1,0),Kl.set(1,1);let o=e.ray.intersectTriangle(Gl,Wl,ql,!1,Dl);if(null===o&&(Ql(Wl.set(-.5,.5,0),Bl,a,Ul,r,i),Yl.set(0,1),o=e.ray.intersectTriangle(Gl,ql,Wl,!1,Dl),null===o))return;const s=e.ray.origin.distanceTo(Dl);s<e.near||s>e.far||t.push({distance:s,point:Dl.clone(),uv:Ni.getUV(Dl,Gl,Wl,ql,Xl,Yl,Kl,new or),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Ql(e,t,n,r,i,a){zl.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Vl.x=a*zl.x-i*zl.y,Vl.y=i*zl.x+a*zl.y):Vl.copy(zl),e.copy(t),e.x+=Vl.x,e.y+=Vl.y,e.applyMatrix4(jl)}Zl.prototype.isSprite=!0;const Jl=new vr,$l=new vr;class ec extends _i{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Jl.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Jl);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Jl.setFromMatrixPosition(e.matrixWorld),$l.setFromMatrixPosition(this.matrixWorld);const n=Jl.distanceTo($l)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const tc=new vr,nc=new fr,rc=new fr,ic=new vr,ac=new Yr;class oc extends Ca{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Yr,this.bindMatrixInverse=new Yr}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new fr,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;nc.fromBufferAttribute(r.attributes.skinIndex,e),rc.fromBufferAttribute(r.attributes.skinWeight,e),tc.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=rc.getComponent(e);if(0!==r){const i=nc.getComponent(e);ac.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(ic.copy(tc).applyMatrix4(ac),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}oc.prototype.isSkinnedMesh=!0;class sc extends _i{constructor(){super(),this.type="Bone"}}sc.prototype.isBone=!0;const lc=new Yr,cc=new Yr;class uc{constructor(e=[],t=[]){this.uuid=Un(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Yr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Yr;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:cc;lc.multiplyMatrices(i,t[r]),lc.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new uc(this.bones,this.boneInverses)}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new sc),this.bones.push(i),this.boneInverses.push((new Yr).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}const hc=new Yr,dc=new Yr,fc=[],pc=new Ca;class mc extends Ca{constructor(e,t,n){super(e,t),this.instanceMatrix=new Xi(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(pc.geometry=this.geometry,pc.material=this.material,void 0!==pc.material)for(let i=0;i<r;i++){this.getMatrixAt(i,hc),dc.multiplyMatrices(n,hc),pc.matrixWorld=dc,pc.raycast(e,fc);for(let e=0,n=fc.length;e<n;e++){const n=fc[e];n.instanceId=i,n.object=this,t.push(n)}fc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Xi(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}mc.prototype.isInstancedMesh=!0;class gc extends Oi{constructor(e){super(),this.type="LineBasicMaterial",this.color=new ji(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}gc.prototype.isLineBasicMaterial=!0;const vc=new vr,yc=new vr,_c=new Yr,bc=new Xr,Ec=new Ur;class wc extends _i{constructor(e=new pa,t=new gc){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)vc.fromBufferAttribute(t,e-1),yc.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=vc.distanceTo(yc);e.setAttribute("lineDistance",new na(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ec.copy(n.boundingSphere),Ec.applyMatrix4(r),Ec.radius+=i,!1===e.ray.intersectsSphere(Ec))return;_c.copy(r).invert(),bc.copy(e.ray).applyMatrix4(_c);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new vr,c=new vr,u=new vr,h=new vr,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r)for(let n=Math.max(0,a.start),o=Math.min(r.count,a.start+a.count)-1;n<o;n+=d){const a=r.getX(n),o=r.getX(n+1);if(l.fromBufferAttribute(i,a),c.fromBufferAttribute(i,o),bc.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(h);d<e.near||d>e.far||t.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,a.start),r=Math.min(i.count,a.start+a.count)-1;n<r;n+=d){if(l.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1),bc.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}wc.prototype.isLine=!0;const xc=new vr,Tc=new vr;class Ac extends wc{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)xc.fromBufferAttribute(t,e),Tc.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+xc.distanceTo(Tc);e.setAttribute("lineDistance",new na(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Ac.prototype.isLineSegments=!0;class Mc extends wc{constructor(e,t){super(e,t),this.type="LineLoop"}}Mc.prototype.isLineLoop=!0;class Sc extends Oi{constructor(e){super(),this.type="PointsMaterial",this.color=new ji(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}Sc.prototype.isPointsMaterial=!0;const Rc=new Yr,kc=new Xr,Pc=new Ur,Lc=new vr;class Cc extends _i{constructor(e=new pa,t=new Sc){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Pc.copy(n.boundingSphere),Pc.applyMatrix4(r),Pc.radius+=i,!1===e.ray.intersectsSphere(Pc))return;Rc.copy(r).invert(),kc.copy(e.ray).applyMatrix4(Rc);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i)for(let n=Math.max(0,a.start),l=Math.min(i.count,a.start+a.count);n<l;n++){const a=i.getX(n);Lc.fromBufferAttribute(o,a),Ic(Lc,a,s,r,e,t,this)}else for(let n=Math.max(0,a.start),i=Math.min(o.count,a.start+a.count);n<i;n++)Lc.fromBufferAttribute(o,n),Ic(Lc,n,s,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Ic(e,t,n,r,i,a,o){const s=kc.distanceSqToPoint(e);if(s<n){const n=new vr;kc.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:o})}}Cc.prototype.isPoints=!0;class Nc extends hr{constructor(e,t,n,r,i,a,o,s,l){super(e,t,n,r,i,a,o,s,l),this.format=void 0!==o?o:Fe,this.minFilter=void 0!==a?a:ve,this.magFilter=void 0!==i?i:ve,this.generateMipmaps=!1;const c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Nc.prototype.isVideoTexture=!0;class Fc extends hr{constructor(e,t,n,r,i,a,o,s,l,c,u,h){super(null,a,o,s,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Fc.prototype.isCompressedTexture=!0;class Oc extends hr{constructor(e,t,n,r,i,a,o,s,l){super(e,t,n,r,i,a,o,s,l),this.needsUpdate=!0}}Oc.prototype.isCanvasTexture=!0;class Hc extends hr{constructor(e,t,n,r,i,a,o,s,l,c){if((c=void 0!==c?c:Be)!==Be&&c!==ze)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Be&&(n=Ae),void 0===n&&c===ze&&(n=Ie),super(null,r,i,a,o,s,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:de,this.minFilter=void 0!==s?s:de,this.flipY=!1,this.generateMipmaps=!1}}Hc.prototype.isDepthTexture=!0;class Dc extends pa{constructor(e=1,t=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],a=[],o=[],s=[],l=new vr,c=new or;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),a.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(a[u]/e+1)/2,c.y=(a[u+1]/e+1)/2,s.push(c.x,c.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new na(a,3)),this.setAttribute("normal",new na(o,3)),this.setAttribute("uv",new na(s,2))}}class Uc extends pa{constructor(e=1,t=1,n=1,r=8,i=1,a=!1,o=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let f=0;const p=[],m=n/2;let g=0;function v(){const a=new vr,v=new vr;let y=0;const _=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*s+o,l=Math.sin(i),p=Math.cos(i);v.x=y*l,v.y=-g*n+m,v.z=y*p,u.push(v.x,v.y,v.z),a.set(l,_,p).normalize(),h.push(a.x,a.y,a.z),d.push(t,1-g),c.push(f++)}p.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=p[t][e],r=p[t+1][e],i=p[t+1][e+1],a=p[t][e+1];c.push(n,r,a),c.push(r,i,a),y+=6}l.addGroup(g,y,0),g+=y}function y(n){const i=f,a=new or,p=new vr;let v=0;const y=!0===n?e:t,_=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*_,0),h.push(0,_,0),d.push(.5,.5),f++;const b=f;for(let e=0;e<=r;e++){const t=e/r*s+o,n=Math.cos(t),i=Math.sin(t);p.x=y*i,p.y=m*_,p.z=y*n,u.push(p.x,p.y,p.z),h.push(0,_,0),a.x=.5*n+.5,a.y=.5*i*_+.5,d.push(a.x,a.y),f++}for(let e=0;e<r;e++){const t=i+e,r=b+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}v(),!1===a&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new na(u,3)),this.setAttribute("normal",new na(h,3)),this.setAttribute("uv",new na(d,2))}}class Bc extends Uc{constructor(e=1,t=1,n=8,r=1,i=!1,a=0,o=2*Math.PI){super(0,e,t,n,r,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}}class zc extends pa{constructor(e,t,n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],a=[];function o(e){const n=new vr,r=new vr,i=new vr;for(let a=0;a<t.length;a+=3)d(t[a+0],n),d(t[a+1],r),d(t[a+2],i),s(n,r,i,e)}function s(e,t,n,r){const i=r+1,a=[];for(let r=0;r<=i;r++){a[r]=[];const o=e.clone().lerp(n,r/i),s=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)a[r][e]=0===e&&r===i?o:o.clone().lerp(s,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(h(a[e][n+1]),h(a[e+1][n]),h(a[e][n])):(h(a[e][n+1]),h(a[e+1][n+1]),h(a[e+1][n]))}}function l(e){const t=new vr;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}function c(){const e=new vr;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];const n=m(e)/2/Math.PI+.5,r=g(e)/Math.PI+.5;a.push(n,1-r)}f(),u()}function u(){for(let e=0;e<a.length;e+=6){const t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),o=Math.min(t,n,r);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}function h(e){i.push(e.x,e.y,e.z)}function d(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function f(){const e=new vr,t=new vr,n=new vr,r=new vr,o=new or,s=new or,l=new or;for(let c=0,u=0;c<i.length;c+=9,u+=6){e.set(i[c+0],i[c+1],i[c+2]),t.set(i[c+3],i[c+4],i[c+5]),n.set(i[c+6],i[c+7],i[c+8]),o.set(a[u+0],a[u+1]),s.set(a[u+2],a[u+3]),l.set(a[u+4],a[u+5]),r.copy(e).add(t).add(n).divideScalar(3);const h=m(r);p(o,u+0,e,h),p(s,u+2,t,h),p(l,u+4,n,h)}}function p(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}function g(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}o(r),l(n),c(),this.setAttribute("position",new na(i,3)),this.setAttribute("normal",new na(i.slice(),3)),this.setAttribute("uv",new na(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}}class Vc extends zc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const jc=new vr,Gc=new vr,Wc=new vr,qc=new Ni;class Xc extends pa{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=4,r=Math.pow(10,n),i=Math.cos(Hn*t),a=e.getIndex(),o=e.getAttribute("position"),s=a?a.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<s;e+=3){a?(l[0]=a.getX(e),l[1]=a.getX(e+1),l[2]=a.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:s}=qc;if(t.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),s.fromBufferAttribute(o,l[2]),qc.getNormal(Wc),u[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,u[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,u[2]=`${Math.round(s.x*r)},${Math.round(s.y*r)},${Math.round(s.z*r)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],a=qc[c[e]],o=qc[c[t]],s=`${n}_${r}`,f=`${r}_${n}`;f in h&&h[f]?(Wc.dot(h[f].normal)<=i&&(d.push(a.x,a.y,a.z),d.push(o.x,o.y,o.z)),h[f]=null):s in h||(h[s]={index0:l[e],index1:l[t],normal:Wc.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];jc.fromBufferAttribute(o,t),Gc.fromBufferAttribute(o,n),d.push(jc.x,jc.y,jc.z),d.push(Gc.x,Gc.y,Gc.z)}this.setAttribute("position",new na(d,3))}}const Yc={triangulate:function(e,t,n){n=n||2;const r=t&&t.length,i=r?t[0]*n:e.length;let a=Kc(e,0,i,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c,u,h,d,f;if(r&&(a=nu(e,t,a,n)),e.length>80*n){s=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<s&&(s=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-s,u-l),f=0!==f?1/f:0}return Qc(a,o,n,s,l,f),o}};function Kc(e,t,n,r,i){let a,o;if(i===Au(e,t,n,r)>0)for(a=t;a<n;a+=r)o=wu(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=wu(a,e[a],e[a+1],o);return o&&pu(o,o.next)&&(xu(o),o=o.next),o}function Zc(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!pu(r,r.next)&&0!==fu(r.prev,r,r.next))r=r.next;else{if(xu(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Qc(e,t,n,r,i,a,o){if(!e)return;!o&&a&&su(e,r,i,a);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,a?$c(e,r,i,a):Jc(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),xu(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Qc(e=eu(Zc(e),t,n),t,n,r,i,a,2):2===o&&tu(e,t,n,r,i,a):Qc(Zc(e),t,n,r,i,a,1);break}}function Jc(e){const t=e.prev,n=e,r=e.next;if(fu(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(hu(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&fu(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function $c(e,t,n,r){const i=e.prev,a=e,o=e.next;if(fu(i,a,o)>=0)return!1;const s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=cu(s,l,t,n,r),d=cu(c,u,t,n,r);let f=e.prevZ,p=e.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&hu(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&fu(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&hu(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&fu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&hu(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&fu(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&hu(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&fu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function eu(e,t,n){let r=e;do{const i=r.prev,a=r.next.next;!pu(i,a)&&mu(i,r,r.next,a)&&_u(i,a)&&_u(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),xu(r),xu(r.next),r=e=a),r=r.next}while(r!==e);return Zc(r)}function tu(e,t,n,r,i,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&du(o,e)){let s=Eu(o,e);return o=Zc(o,o.next),s=Zc(s,s.next),Qc(o,t,n,r,i,a),void Qc(s,t,n,r,i,a)}e=e.next}o=o.next}while(o!==e)}function nu(e,t,n,r){const i=[];let a,o,s,l,c;for(a=0,o=t.length;a<o;a++)s=t[a]*r,l=a<o-1?t[a+1]*r:e.length,c=Kc(e,s,l,r,!1),c===c.next&&(c.steiner=!0),i.push(uu(c));for(i.sort(ru),a=0;a<i.length;a++)iu(i[a],n),n=Zc(n,n.next);return n}function ru(e,t){return e.x-t.x}function iu(e,t){if(t=au(e,t)){const n=Eu(t,e);Zc(t,t.next),Zc(n,n.next)}}function au(e,t){let n=t;const r=e.x,i=e.y;let a,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>o){if(o=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}a=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!a)return null;if(r===o)return a;const s=a,l=a.x,c=a.y;let u,h=1/0;n=a;do{r>=n.x&&n.x>=l&&r!==n.x&&hu(i<c?r:o,i,l,c,i<c?o:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),_u(n,e)&&(u<h||u===h&&(n.x>a.x||n.x===a.x&&ou(a,n)))&&(a=n,h=u)),n=n.next}while(n!==s);return a}function ou(e,t){return fu(e.prev,e,t.prev)<0&&fu(t.next,e,e.next)<0}function su(e,t,n,r){let i=e;do{null===i.z&&(i.z=cu(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,lu(i)}function lu(e){let t,n,r,i,a,o,s,l,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ,r);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,c*=2}while(o>1);return e}function cu(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function uu(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function hu(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function du(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!yu(e,t)&&(_u(e,t)&&_u(t,e)&&bu(e,t)&&(fu(e.prev,e,t.prev)||fu(e,t.prev,t))||pu(e,t)&&fu(e.prev,e,e.next)>0&&fu(t.prev,t,t.next)>0)}function fu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function pu(e,t){return e.x===t.x&&e.y===t.y}function mu(e,t,n,r){const i=vu(fu(e,t,n)),a=vu(fu(e,t,r)),o=vu(fu(n,r,e)),s=vu(fu(n,r,t));return i!==a&&o!==s||!(0!==i||!gu(e,n,t))||!(0!==a||!gu(e,r,t))||!(0!==o||!gu(n,e,r))||!(0!==s||!gu(n,t,r))}function gu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function vu(e){return e>0?1:e<0?-1:0}function yu(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&mu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function _u(e,t){return fu(e.prev,e,e.next)<0?fu(e,t,e.next)>=0&&fu(e,e.prev,t)>=0:fu(e,t,e.prev)<0||fu(e,e.next,t)<0}function bu(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}function Eu(e,t){const n=new Tu(e.i,e.x,e.y),r=new Tu(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function wu(e,t,n,r){const i=new Tu(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function xu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Tu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Au(e,t,n,r){let i=0;for(let a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}class Mu{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return Mu.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];Su(e),Ru(n,e);let a=e.length;t.forEach(Su);for(let e=0;e<t.length;e++)r.push(a),a+=t[e].length,Ru(n,t[e]);const o=Yc.triangulate(n,r);for(let e=0;e<o.length;e+=3)i.push(o.slice(e,e+3));return i}}function Su(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Ru(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class ku extends pa{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++)a(e[t]);function a(e){const a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Pu;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,v,y,_,b,E=!1;p&&(g=p.getSpacedPoints(s),E=!0,c=!1,v=p.computeFrenetFrames(s,!1),y=new vr,_=new vr,b=new vr),c||(f=0,u=0,h=0,d=0);const w=e.extractPoints(o);let x=w.shape;const T=w.holes;if(!Mu.isClockWise(x)){x=x.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];Mu.isClockWise(t)&&(T[e]=t.reverse())}}const A=Mu.triangulateShape(x,T),M=x;for(let e=0,t=T.length;e<t;e++){const t=T[e];x=x.concat(t)}function S(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const R=x.length,k=A.length;function P(e,t,n){let r,i,a;const o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),f=t.x-s/h,p=t.y+o/h,m=((n.x-c/d-f)*c-(n.y+l/d-p)*l)/(o*c-s*l);r=f+o*m-e.x,i=p+s*m-e.y;const g=r*r+i*i;if(g<=2)return new or(r,i);a=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(r=-s,i=o,a=Math.sqrt(u)):(r=o,i=s,a=Math.sqrt(u/2))}return new or(r/a,i/a)}const L=[];for(let e=0,t=M.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),L[e]=P(M[e],M[n],M[r]);const C=[];let I,N=L.concat();for(let e=0,t=T.length;e<t;e++){const t=T[e];I=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),I[e]=P(t[e],t[r],t[i]);C.push(I),N=N.concat(I)}for(let e=0;e<f;e++){const t=e/f,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=M.length;e<t;e++){const t=S(M[e],L[e],r);U(t.x,t.y,-n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];I=C[e];for(let e=0,i=t.length;e<i;e++){const i=S(t[e],I[e],r);U(i.x,i.y,-n)}}}const F=h+d;for(let e=0;e<R;e++){const t=c?S(x[e],N[e],F):x[e];E?(_.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(_).add(y),U(b.x,b.y,b.z)):U(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<R;t++){const n=c?S(x[t],N[t],F):x[t];E?(_.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(_).add(y),U(b.x,b.y,b.z)):U(n.x,n.y,l/s*e)}for(let e=f-1;e>=0;e--){const t=e/f,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=M.length;e<t;e++){const t=S(M[e],L[e],r);U(t.x,t.y,l+n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];I=C[e];for(let e=0,i=t.length;e<i;e++){const i=S(t[e],I[e],r);E?U(i.x,i.y+g[s-1].y,g[s-1].x+n):U(i.x,i.y,l+n)}}}function O(){const e=r.length/3;if(c){let e=0,t=R*e;for(let e=0;e<k;e++){const n=A[e];B(n[2]+t,n[1]+t,n[0]+t)}e=s+2*f,t=R*e;for(let e=0;e<k;e++){const n=A[e];B(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<k;e++){const t=A[e];B(t[2],t[1],t[0])}for(let e=0;e<k;e++){const t=A[e];B(t[0]+R*s,t[1]+R*s,t[2]+R*s)}}n.addGroup(e,r.length/3-e,0)}function H(){const e=r.length/3;let t=0;D(M,t),t+=M.length;for(let e=0,n=T.length;e<n;e++){const n=T[e];D(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}function D(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=s+2*f;e<n;e++){const n=R*e,a=R*(e+1);z(t+r+n,t+i+n,t+i+a,t+r+a)}}}function U(e,t,n){a.push(e),a.push(t),a.push(n)}function B(e,t,i){V(e),V(t),V(i);const a=r.length/3,o=m.generateTopUV(n,r,a-3,a-2,a-1);j(o[0]),j(o[1]),j(o[2])}function z(e,t,i,a){V(e),V(t),V(a),V(t),V(i),V(a);const o=r.length/3,s=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);j(s[0]),j(s[1]),j(s[3]),j(s[1]),j(s[2]),j(s[3])}function V(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function j(e){i.push(e.x),i.push(e.y)}O(),H()}this.setAttribute("position",new na(r,3)),this.setAttribute("uv",new na(i,2)),this.computeVertexNormals()}toJSON(){const e=pa.prototype.toJSON.call(this);return Lu(this.parameters.shapes,this.parameters.options,e)}}const Pu={generateTopUV:function(e,t,n,r,i){const a=t[3*n],o=t[3*n+1],s=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new or(a,o),new or(s,l),new or(c,u)]},generateSideWallUV:function(e,t,n,r,i,a){const o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-u)<.01?[new or(o,1-l),new or(c,1-h),new or(d,1-p),new or(m,1-v)]:[new or(s,1-l),new or(u,1-h),new or(f,1-p),new or(g,1-v)]}};function Lu(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}class Cu extends zc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class Iu extends pa{constructor(e,t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Bn(r,0,2*Math.PI);const i=[],a=[],o=[],s=1/t,l=new vr,c=new or;for(let i=0;i<=t;i++){const u=n+i*s*r,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*h,l.y=e[n].y,l.z=e[n].x*d,a.push(l.x,l.y,l.z),c.x=i/t,c.y=n/(e.length-1),o.push(c.x,c.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,a=r,o=r+e.length,s=r+e.length+1,l=r+1;i.push(a,o,l),i.push(o,s,l)}if(this.setIndex(i),this.setAttribute("position",new na(a,3)),this.setAttribute("uv",new na(o,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new vr,i=new vr,a=new vr,o=t*e.length*3;for(let t=0,s=0;t<e.length;t++,s+=3)r.x=n[s+0],r.y=n[s+1],r.z=n[s+2],i.x=n[o+s+0],i.y=n[o+s+1],i.z=n[o+s+2],a.addVectors(r,i).normalize(),n[s+0]=n[o+s+0]=a.x,n[s+1]=n[o+s+1]=a.y,n[s+2]=n[o+s+2]=a.z}}}class Nu extends zc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class Fu extends pa{constructor(e,t,n){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const r=[],i=[],a=[],o=[],s=1e-5,l=new vr,c=new vr,u=new vr,h=new vr,d=new vr;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const f=t+1;for(let r=0;r<=n;r++){const f=r/n;for(let n=0;n<=t;n++){const r=n/t;e(r,f,c),i.push(c.x,c.y,c.z),r-s>=0?(e(r-s,f,u),h.subVectors(c,u)):(e(r+s,f,u),h.subVectors(u,c)),f-s>=0?(e(r,f-s,u),d.subVectors(c,u)):(e(r,f+s,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),a.push(l.x,l.y,l.z),o.push(r,f)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*f+n,i=e*f+n+1,a=(e+1)*f+n+1,o=(e+1)*f+n;r.push(t,i,o),r.push(i,a,o)}this.setIndex(r),this.setAttribute("position",new na(i,3)),this.setAttribute("normal",new na(a,3)),this.setAttribute("uv",new na(o,2))}}class Ou extends pa{constructor(e=.5,t=1,n=8,r=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},n=Math.max(3,n);const o=[],s=[],l=[],c=[];let u=e;const h=(t-e)/(r=Math.max(1,r)),d=new vr,f=new or;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*a;d.x=u*Math.cos(r),d.y=u*Math.sin(r),s.push(d.x,d.y,d.z),l.push(0,0,1),f.x=(d.x/t+1)/2,f.y=(d.y/t+1)/2,c.push(f.x,f.y)}u+=h}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,a=r+n+1,s=r+n+2,l=r+1;o.push(i,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new na(s,3)),this.setAttribute("normal",new na(l,3)),this.setAttribute("uv",new na(c,2))}}class Hu extends pa{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],a=[];let o=0,s=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,s,t),o+=s,s=0;function l(e){const o=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Mu.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===Mu.isClockWise(t)&&(u[e]=t.reverse())}const h=Mu.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+o,i=t[1]+o,a=t[2]+o;n.push(r,i,a),s+=3}}this.setIndex(n),this.setAttribute("position",new na(r,3)),this.setAttribute("normal",new na(i,3)),this.setAttribute("uv",new na(a,2))}toJSON(){const e=pa.prototype.toJSON.call(this);return Du(this.parameters.shapes,e)}}function Du(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}class Uu extends pa{constructor(e=1,t=8,n=6,r=0,i=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new vr,h=new vr,d=[],f=[],p=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==a?y=.5/t:d==n&&s==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(r+s*i)*Math.sin(a+v*o),u.y=e*Math.cos(a+v*o),u.z=e*Math.sin(r+s*i)*Math.sin(a+v*o),f.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),m.push(s+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],o=c[e+1][r],l=c[e+1][r+1];(0!==e||a>0)&&d.push(t,i,l),(e!==n-1||s<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new na(f,3)),this.setAttribute("normal",new na(p,3)),this.setAttribute("uv",new na(m,2))}}class Bu extends zc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class zu extends ku{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new pa;const r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t),this.type="TextGeometry"}}class Vu extends pa{constructor(e=1,t=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const a=[],o=[],s=[],l=[],c=new vr,u=new vr,h=new vr;for(let a=0;a<=n;a++)for(let d=0;d<=r;d++){const f=d/r*i,p=a/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(f),u.y=(e+t*Math.cos(p))*Math.sin(f),u.z=t*Math.sin(p),o.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),s.push(h.x,h.y,h.z),l.push(d/r),l.push(a/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,o=(r+1)*(e-1)+t,s=(r+1)*e+t;a.push(n,i,s),a.push(i,o,s)}this.setIndex(a),this.setAttribute("position",new na(o,3)),this.setAttribute("normal",new na(s,3)),this.setAttribute("uv",new na(l,2))}}class ju extends pa{constructor(e=1,t=.4,n=64,r=8,i=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],l=[],c=[],u=new vr,h=new vr,d=new vr,f=new vr,p=new vr,m=new vr,g=new vr;for(let o=0;o<=n;++o){const y=o/n*i*Math.PI*2;v(y,i,a,e,d),v(y+.01,i,a,e,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,a=-t*Math.cos(i),f=t*Math.sin(i);u.x=d.x+(a*g.x+f*p.x),u.y=d.y+(a*g.y+f*p.y),u.z=d.z+(a*g.z+f*p.z),s.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(o/n),c.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,s=(r+1)*(e-1)+t;o.push(n,i,s),o.push(i,a,s)}function v(e,t,n,r,i){const a=Math.cos(e),o=Math.sin(e),s=n/t*e,l=Math.cos(s);i.x=r*(2+l)*.5*a,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(s)*.5}this.setIndex(o),this.setAttribute("position",new na(s,3)),this.setAttribute("normal",new na(l,3)),this.setAttribute("uv",new na(c,2))}}class Gu extends pa{constructor(e,t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new vr,s=new vr,l=new or;let c=new vr;const u=[],h=[],d=[],f=[];function p(){for(let e=0;e<t;e++)m(e);m(!1===i?t:0),v(),g()}function m(i){c=e.getPointAt(i/t,c);const l=a.normals[i],d=a.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),a=-Math.cos(t);s.x=a*l.x+i*d.x,s.y=a*l.y+i*d.y,s.z=a*l.z+i*d.z,s.normalize(),h.push(s.x,s.y,s.z),o.x=c.x+n*s.x,o.y=c.y+n*s.y,o.z=c.z+n*s.z,u.push(o.x,o.y,o.z)}}function g(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,o=(r+1)*(e-1)+t;f.push(n,i,o),f.push(i,a,o)}}function v(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}p(),this.setIndex(f),this.setAttribute("position",new na(u,3)),this.setAttribute("normal",new na(h,3)),this.setAttribute("uv",new na(d,2))}toJSON(){const e=pa.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}class Wu extends pa{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],n=[0,0],r={},i=new vr;if(null!==e.index){const a=e.attributes.position,o=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,t=s.length;e<t;++e){const t=s[e],i=t.start;for(let e=i,a=i+t.count;e<a;e+=3)for(let t=0;t<3;t++){const i=o.getX(e+t),a=o.getX(e+(t+1)%3);n[0]=Math.min(i,a),n[1]=Math.max(i,a);const s=n[0]+","+n[1];void 0===r[s]&&(r[s]={index1:n[0],index2:n[1]})}}for(const e in r){const n=r[e];i.fromBufferAttribute(a,n.index1),t.push(i.x,i.y,i.z),i.fromBufferAttribute(a,n.index2),t.push(i.x,i.y,i.z)}}else{const n=e.attributes.position;for(let e=0,r=n.count/3;e<r;e++)for(let r=0;r<3;r++){const a=3*e+r;i.fromBufferAttribute(n,a),t.push(i.x,i.y,i.z);const o=3*e+(r+1)%3;i.fromBufferAttribute(n,o),t.push(i.x,i.y,i.z)}}this.setAttribute("position",new na(t,3))}}var qu=Object.freeze({__proto__:null,BoxGeometry:Fa,BoxBufferGeometry:Fa,CircleGeometry:Dc,CircleBufferGeometry:Dc,ConeGeometry:Bc,ConeBufferGeometry:Bc,CylinderGeometry:Uc,CylinderBufferGeometry:Uc,DodecahedronGeometry:Vc,DodecahedronBufferGeometry:Vc,EdgesGeometry:Xc,ExtrudeGeometry:ku,ExtrudeBufferGeometry:ku,IcosahedronGeometry:Cu,IcosahedronBufferGeometry:Cu,LatheGeometry:Iu,LatheBufferGeometry:Iu,OctahedronGeometry:Nu,OctahedronBufferGeometry:Nu,ParametricGeometry:Fu,ParametricBufferGeometry:Fu,PlaneGeometry:to,PlaneBufferGeometry:to,PolyhedronGeometry:zc,PolyhedronBufferGeometry:zc,RingGeometry:Ou,RingBufferGeometry:Ou,ShapeGeometry:Hu,ShapeBufferGeometry:Hu,SphereGeometry:Uu,SphereBufferGeometry:Uu,TetrahedronGeometry:Bu,TetrahedronBufferGeometry:Bu,TextGeometry:zu,TextBufferGeometry:zu,TorusGeometry:Vu,TorusBufferGeometry:Vu,TorusKnotGeometry:ju,TorusKnotBufferGeometry:ju,TubeGeometry:Gu,TubeBufferGeometry:Gu,WireframeGeometry:Wu});class Xu extends Oi{constructor(e){super(),this.type="ShadowMaterial",this.color=new ji(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Xu.prototype.isShadowMaterial=!0;class Yu extends za{constructor(e){super(e),this.type="RawShaderMaterial"}}Yu.prototype.isRawShaderMaterial=!0;class Ku extends Oi{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ji(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ji(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}Ku.prototype.isMeshStandardMaterial=!0;class Zu extends Ku{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new or(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Bn(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new ji).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this}}Zu.prototype.isMeshPhysicalMaterial=!0;class Qu extends Oi{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new ji(16777215),this.specular=new ji(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ji(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}Qu.prototype.isMeshPhongMaterial=!0;class Ju extends Oi{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ji(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ji(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}Ju.prototype.isMeshToonMaterial=!0;class $u extends Oi{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}$u.prototype.isMeshNormalMaterial=!0;class eh extends Oi{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new ji(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ji(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}eh.prototype.isMeshLambertMaterial=!0;class th extends Oi{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ji(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}th.prototype.isMeshMatcapMaterial=!0;class nh extends gc{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}nh.prototype.isLineDashedMaterial=!0;var rh=Object.freeze({__proto__:null,ShadowMaterial:Xu,SpriteMaterial:Ol,RawShaderMaterial:Yu,ShaderMaterial:za,PointsMaterial:Sc,MeshPhysicalMaterial:Zu,MeshStandardMaterial:Ku,MeshPhongMaterial:Qu,MeshToonMaterial:Ju,MeshNormalMaterial:$u,MeshLambertMaterial:eh,MeshDepthMaterial:fl,MeshDistanceMaterial:pl,MeshBasicMaterial:Gi,MeshMatcapMaterial:th,LineDashedMaterial:nh,LineBasicMaterial:gc,Material:Oi});const ih={arraySlice:function(e,t,n){return ih.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,n){return e[t]-e[n]}const n=e.length,r=new Array(n);for(let e=0;e!==n;++e)r[e]=e;return r.sort(t),r},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let a=0,o=0;o!==r;++a){const r=n[a]*t;for(let n=0;n!==t;++n)i[o++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[i++];if(void 0===a)return;let o=a[r];if(void 0!==o)if(Array.isArray(o))do{o=a[r],void 0!==o&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[r],void 0!==o&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{o=a[r],void 0!==o&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)},subclip:function(e,t,n,r,i=30){const a=e.clone();a.name=t;const o=[];for(let e=0;e<a.tracks.length;++e){const t=a.tracks[e],s=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const a=t.times[e]*i;if(!(a<n||a>=r)){l.push(t.times[e]);for(let n=0;n<s;++n)c.push(t.values[e*s+n])}}0!==l.length&&(t.times=ih.convertArray(l,t.times.constructor),t.values=ih.convertArray(c,t.values.constructor),o.push(t))}a.tracks=o;let s=1/0;for(let e=0;e<a.tracks.length;++e)s>a.tracks[e].times[0]&&(s=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*s);return a.resetDuration(),a},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,a=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const o=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===o)continue;let s=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(a<=r.times[0]){const e=s,t=l-s;d=ih.arraySlice(r.values,e,t)}else if(a>=r.times[h]){const e=h*l+s,t=e+l-s;d=ih.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=s,n=l-s;e.evaluate(a),d=ih.arraySlice(e.resultBuffer,t,n)}"quaternion"===i&&(new gr).fromArray(d).normalize().conjugate().toArray(d);const f=o.times.length;for(let e=0;e<f;++e){const t=e*u+c;if("quaternion"===i)gr.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)o.values[t+n]-=d[n]}}}return e.blendMode=Gt,e}};class ah{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(e>=i)break e;{const o=t[1];e<o&&(n=2,i=o);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0}}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}ah.prototype.beforeStart_=ah.prototype.copySampleValue_,ah.prototype.afterEnd_=ah.prototype.copySampleValue_;class oh extends ah{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Bt,endingEnd:Bt}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case zt:i=e,o=2*t-n;break;case Vt:i=r.length-2,o=t+r[i]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case zt:a=e,s=2*n-t;break;case Vt:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=a*c}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,_=d*m-d*p;for(let e=0;e!==o;++e)i[e]=g*a[c+e]+v*a[l+e]+y*a[s+e]+_*a[u+e];return i}}class sh extends ah{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==o;++e)i[e]=a[l+e]*u+a[s+e]*c;return i}}class lh extends ah{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class ch{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ih.convertArray(t,this.TimeBufferType),this.values=ih.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:ih.convertArray(e.times,Array),values:ih.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new lh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new sh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new oh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ht:t=this.InterpolantFactoryMethodDiscrete;break;case Dt:t=this.InterpolantFactoryMethodLinear;break;case Ut:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ht;case this.InterpolantFactoryMethodLinear:return Dt;case this.InterpolantFactoryMethodSmooth:return Ut}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=ih.arraySlice(n,i,a),this.values=ih.arraySlice(this.values,i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==a&&a>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,a),e=!1;break}a=r}if(void 0!==r&&ih.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=ih.arraySlice(this.times),t=ih.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Ut,i=e.length-1;let a=1;for(let o=1;o<i;++o){let i=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(r)i=!0;else{const e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[r+o]||n!==t[a+o]){i=!0;break}}}if(i){if(o!==a){e[a]=e[o];const r=o*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,o=0;o!==n;++o)t[r+o]=t[e+o];++a}return a!==e.length?(this.times=ih.arraySlice(e,0,a),this.values=ih.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}clone(){const e=ih.arraySlice(this.times,0),t=ih.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}ch.prototype.TimeBufferType=Float32Array,ch.prototype.ValueBufferType=Float32Array,ch.prototype.DefaultInterpolation=Dt;class uh extends ch{}uh.prototype.ValueTypeName="bool",uh.prototype.ValueBufferType=Array,uh.prototype.DefaultInterpolation=Ht,uh.prototype.InterpolantFactoryMethodLinear=void 0,uh.prototype.InterpolantFactoryMethodSmooth=void 0;class hh extends ch{}hh.prototype.ValueTypeName="color";class dh extends ch{}dh.prototype.ValueTypeName="number";class fh extends ah{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t);let l=e*o;for(let e=l+o;l!==e;l+=4)gr.slerpFlat(i,0,a,l-o,a,l,s);return i}}class ph extends ch{InterpolantFactoryMethodLinear(e){return new fh(this.times,this.values,this.getValueSize(),e)}}ph.prototype.ValueTypeName="quaternion",ph.prototype.DefaultInterpolation=Dt,ph.prototype.InterpolantFactoryMethodSmooth=void 0;class mh extends ch{}mh.prototype.ValueTypeName="string",mh.prototype.ValueBufferType=Array,mh.prototype.DefaultInterpolation=Ht,mh.prototype.InterpolantFactoryMethodLinear=void 0,mh.prototype.InterpolantFactoryMethodSmooth=void 0;class gh extends ch{}gh.prototype.ValueTypeName="vector";class vh{constructor(e,t=-1,n,r=jt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Un(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(_h(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(ch.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,a=[];for(let e=0;e<i;e++){let o=[],s=[];o.push((e+i-1)%i,e,(e+1)%i),s.push(0,1,0);const l=ih.getKeyframeOrder(o);o=ih.sortedArray(o,1,l),s=ih.sortedArray(s,1,l),r||0!==o[0]||(o.push(i),s.push(s[0])),a.push(new dh(".morphTargetInfluences["+t[e].name+"]",o,s).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],a=n.name.match(i);if(a&&a.length>1){const e=a[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const a=[];for(const e in r)a.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const a=[],o=[];ih.flattenJSON(n,a,o,r),0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],a=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),a.push(r.morphTarget===n?1:0)}r.push(new dh(".morphTargetInfluence["+n+"]",e,a))}s=e.length*(a||1)}else{const a=".bones["+t[e].name+"]";n(gh,a+".position",i,"pos",r),n(ph,a+".quaternion",i,"rot",r),n(gh,a+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,s,r,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function yh(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dh;case"vector":case"vector2":case"vector3":case"vector4":return gh;case"color":return hh;case"quaternion":return ph;case"bool":case"boolean":return uh;case"string":return mh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function _h(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=yh(e.type);if(void 0===e.times){const t=[],n=[];ih.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const bh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Eh{constructor(e,t,n){const r=this;let i,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const wh=new Eh;class xh{constructor(e){this.manager=void 0!==e?e:wh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Th={};class Ah extends xh{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=bh.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0!==Th[e])return void Th[e].push({onLoad:t,onProgress:n,onError:r});const o=/^data:(.*?)(;base64)?,(.*)$/,s=e.match(o);let l;if(s){const n=s[1],a=!!s[2];let o=s[3];o=decodeURIComponent(o),a&&(o=atob(o));try{let r;const a=(this.responseType||"").toLowerCase();switch(a){case"arraybuffer":case"blob":const e=new Uint8Array(o.length);for(let t=0;t<o.length;t++)e[t]=o.charCodeAt(t);r="blob"===a?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;r=t.parseFromString(o,n);break;case"json":r=JSON.parse(o);break;default:r=o}setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{Th[e]=[],Th[e].push({onLoad:t,onProgress:n,onError:r}),l=new XMLHttpRequest,l.open("GET",e,!0),l.addEventListener("load",(function(t){const n=this.response,r=Th[e];if(delete Th[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),bh.add(e,n);for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onLoad&&t.onLoad(n)}i.manager.itemEnd(e)}else{for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),l.addEventListener("progress",(function(t){const n=Th[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onProgress&&r.onProgress(t)}}),!1),l.addEventListener("error",(function(t){const n=Th[e];delete Th[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),l.addEventListener("abort",(function(t){const n=Th[e];delete Th[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(l.responseType=this.responseType),void 0!==this.withCredentials&&(l.withCredentials=this.withCredentials),l.overrideMimeType&&l.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)l.setRequestHeader(e,this.requestHeader[e]);l.send(null)}return i.manager.itemStart(e),l}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Mh extends xh{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Ah(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=vh.parse(e[n]);t.push(r)}return t}}class Sh extends xh{constructor(e){super(e)}load(e,t,n,r){const i=this,a=[],o=new Fc,s=new Ah(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);let l=0;function c(c){s.load(e[c],(function(e){const n=i.parse(e,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=ve),o.image=a,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else s.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)a[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),a[t].format=n.format,a[t].width=n.width,a[t].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=ve),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}class Rh extends xh{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=bh.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),bh.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}class kh extends xh{constructor(e){super(e)}load(e,t,n,r){const i=new Xa,a=new Rh(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(n){a.load(e[n],(function(e){i.images[n]=e,o++,6===o&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)s(t);return i}}class Ph extends xh{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Ka,o=new Ah(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:ue,a.wrapT=void 0!==n.wrapT?n.wrapT:ue,a.magFilter=void 0!==n.magFilter?n.magFilter:ve,a.minFilter=void 0!==n.minFilter?n.minFilter:ve,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=be),1===n.mipmapCount&&(a.minFilter=ve),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n))}),n,r),a}}class Lh extends xh{constructor(e){super(e)}load(e,t,n,r){const i=new hr,a=new Rh(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(n){i.image=n;const r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?Fe:Oe,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class Ch{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let a;a=t||e*n[i-1];let o,s=0,l=i-1;for(;s<=l;)if(r=Math.floor(s+(l-s)/2),o=n[r]-a,o<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===a)return r/(i-1);const c=n[r];return(r+(a-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new or:new vr);return s.copy(o).sub(a).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new vr,r=[],i=[],a=[],o=new vr,s=new Yr;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new vr),r[t].normalize()}i[0]=new vr,a[0]=new vr;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),a[t]=a[t-1].clone(),o.crossVectors(r[t-1],r[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(Bn(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(s.makeRotationAxis(o,e))}a[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Bn(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],t*n)),a[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ih extends Ch{constructor(e=0,t=0,n=1,r=1,i=0,a=2*Math.PI,o=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t){const n=t||new or,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);const o=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=l-this.aY;s=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Ih.prototype.isEllipseCurve=!0;class Nh extends Ih{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.type="ArcCurve"}}function Fh(){let e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){let l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,c=(n-t)/o-(r-t)/(o+s)+(r-n)/s;l*=o,c*=o,i(t,n,l,c)},calc:function(i){const a=i*i;return e+t*i+n*a+r*(a*i)}}}Nh.prototype.isArcCurve=!0;const Oh=new vr,Hh=new Fh,Dh=new Fh,Uh=new Fh;class Bh extends Ch{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new vr){const n=t,r=this.points,i=r.length,a=(i-(this.closed?0:1))*e;let o,s,l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?o=r[(l-1)%i]:(Oh.subVectors(r[0],r[1]).add(r[0]),o=Oh);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?s=r[(l+2)%i]:(Oh.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=Oh),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Hh.initNonuniformCatmullRom(o.x,u.x,h.x,s.x,t,n,r),Dh.initNonuniformCatmullRom(o.y,u.y,h.y,s.y,t,n,r),Uh.initNonuniformCatmullRom(o.z,u.z,h.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(Hh.initCatmullRom(o.x,u.x,h.x,s.x,this.tension),Dh.initCatmullRom(o.y,u.y,h.y,s.y,this.tension),Uh.initCatmullRom(o.z,u.z,h.z,s.z,this.tension));return n.set(Hh.calc(c),Dh.calc(c),Uh.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new vr).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function zh(e,t,n,r,i){const a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Vh(e,t){const n=1-e;return n*n*t}function jh(e,t){return 2*(1-e)*e*t}function Gh(e,t){return e*e*t}function Wh(e,t,n,r){return Vh(e,t)+jh(e,n)+Gh(e,r)}function qh(e,t){const n=1-e;return n*n*n*t}function Xh(e,t){const n=1-e;return 3*n*n*e*t}function Yh(e,t){return 3*(1-e)*e*e*t}function Kh(e,t){return e*e*e*t}function Zh(e,t,n,r,i){return qh(e,t)+Xh(e,n)+Yh(e,r)+Kh(e,i)}Bh.prototype.isCatmullRomCurve3=!0;class Qh extends Ch{constructor(e=new or,t=new or,n=new or,r=new or){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new or){const n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Zh(e,r.x,i.x,a.x,o.x),Zh(e,r.y,i.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Qh.prototype.isCubicBezierCurve=!0;class Jh extends Ch{constructor(e=new vr,t=new vr,n=new vr,r=new vr){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new vr){const n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Zh(e,r.x,i.x,a.x,o.x),Zh(e,r.y,i.y,a.y,o.y),Zh(e,r.z,i.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Jh.prototype.isCubicBezierCurve3=!0;class $h extends Ch{constructor(e=new or,t=new or){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new or){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new or;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}$h.prototype.isLineCurve=!0;class ed extends Ch{constructor(e=new vr,t=new vr){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new vr){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class td extends Ch{constructor(e=new or,t=new or,n=new or){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new or){const n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Wh(e,r.x,i.x,a.x),Wh(e,r.y,i.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}td.prototype.isQuadraticBezierCurve=!0;class nd extends Ch{constructor(e=new vr,t=new vr,n=new vr){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new vr){const n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Wh(e,r.x,i.x,a.x),Wh(e,r.y,i.y,a.y),Wh(e,r.z,i.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}nd.prototype.isQuadraticBezierCurve3=!0;class rd extends Ch{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new or){const n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],l=r[a],c=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set(zh(o,s.x,l.x,c.x,u.x),zh(o,s.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new or).fromArray(n))}return this}}rd.prototype.isSplineCurve=!0;var id=Object.freeze({__proto__:null,ArcCurve:Nh,CatmullRomCurve3:Bh,CubicBezierCurve:Qh,CubicBezierCurve3:Jh,EllipseCurve:Ih,LineCurve:$h,LineCurve3:ed,QuadraticBezierCurve:td,QuadraticBezierCurve3:nd,SplineCurve:rd});class ad extends Ch{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new $h(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){const e=n[r]-t,i=this.curves[r],a=i.getLength(),o=0===a?0:1-e/a;return i.getPointAt(o)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const a=i[r],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o);for(let e=0;e<s.length;e++){const r=s[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new id[n.type]).fromJSON(n))}return this}}class od extends ad{constructor(e){super(),this.type="Path",this.currentPoint=new or,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new $h(this.currentPoint.clone(),new or(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new td(this.currentPoint.clone(),new or(e,t),new or(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,a){const o=new Qh(this.currentPoint.clone(),new or(e,t),new or(n,r),new or(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new rd(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this}absarc(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}ellipse(e,t,n,r,i,a,o,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,a,o,s),this}absellipse(e,t,n,r,i,a,o,s){const l=new Ih(e,t,n,r,i,a,o,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class sd extends od{constructor(e){super(e),this.uuid=Un(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new od).fromJSON(n))}return this}}class ld extends _i{constructor(e,t=1){super(),this.type="Light",this.color=new ji(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}ld.prototype.isLight=!0;class cd extends ld{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.groundColor=new ji(t)}copy(e){return ld.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}cd.prototype.isHemisphereLight=!0;const ud=new Yr,hd=new vr,dd=new vr;class fd{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new or(512,512),this.map=null,this.mapPass=null,this.matrix=new Yr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ja,this._frameExtents=new or(1,1),this._viewportCount=1,this._viewports=[new fr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;hd.setFromMatrixPosition(e.matrixWorld),t.position.copy(hd),dd.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(dd),t.updateMatrixWorld(),ud.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ud),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class pd extends fd{constructor(){super(new ja(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Dn*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}pd.prototype.isSpotLightShadow=!0;class md extends ld{constructor(e,t,n=0,r=Math.PI/3,i=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.target=new _i,this.distance=n,this.angle=r,this.penumbra=i,this.decay=a,this.shadow=new pd}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}md.prototype.isSpotLight=!0;const gd=new Yr,vd=new vr,yd=new vr;class _d extends fd{constructor(){super(new ja(90,1,.5,500)),this._frameExtents=new or(4,2),this._viewportCount=6,this._viewports=[new fr(2,1,1,1),new fr(0,1,1,1),new fr(3,1,1,1),new fr(1,1,1,1),new fr(3,0,1,1),new fr(1,0,1,1)],this._cubeDirections=[new vr(1,0,0),new vr(-1,0,0),new vr(0,0,1),new vr(0,0,-1),new vr(0,1,0),new vr(0,-1,0)],this._cubeUps=[new vr(0,1,0),new vr(0,1,0),new vr(0,1,0),new vr(0,1,0),new vr(0,0,1),new vr(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),vd.setFromMatrixPosition(e.matrixWorld),n.position.copy(vd),yd.copy(n.position),yd.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(yd),n.updateMatrixWorld(),r.makeTranslation(-vd.x,-vd.y,-vd.z),gd.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gd)}}_d.prototype.isPointLightShadow=!0;class bd extends ld{constructor(e,t,n=0,r=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new _d}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}bd.prototype.isPointLight=!0;class Ed extends Va{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Ed.prototype.isOrthographicCamera=!0;class wd extends fd{constructor(){super(new Ed(-5,5,5,-5,.5,500))}}wd.prototype.isDirectionalLightShadow=!0;class xd extends ld{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.target=new _i,this.shadow=new wd}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}xd.prototype.isDirectionalLight=!0;class Td extends ld{constructor(e,t){super(e,t),this.type="AmbientLight"}}Td.prototype.isAmbientLight=!0;class Ad extends ld{constructor(e,t,n=10,r=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=r}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Ad.prototype.isRectAreaLight=!0;class Md{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new vr)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}Md.prototype.isSphericalHarmonics3=!0;class Sd extends ld{constructor(e=new Md,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Sd.prototype.isLightProbe=!0;class Rd extends xh{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,a=new Ah(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=new rh[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new ji).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new ji).setHex(i.value);break;case"v2":r.uniforms[t].value=(new or).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new vr).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new fr).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new sr).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new Yr).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new or).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new or).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),r}setTextures(e){return this.textures=e,this}}class kd{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class Pd extends pa{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Pd.prototype.isInstancedBufferGeometry=!0;class Ld extends Xi{constructor(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=r||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Ld.prototype.isInstancedBufferAttribute=!0;class Cd extends xh{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Ah(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={};function r(e,n){if(void 0!==t[n])return t[n];const r=e.interleavedBuffers[n],a=i(e,r.buffer),o=oa(r.type,a),s=new Il(o,r.stride);return s.uuid=r.uuid,t[n]=s,s}function i(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}const a=e.isInstancedBufferGeometry?new Pd:new pa,o=e.data.index;if(void 0!==o){const e=oa(o.type,o.array);a.setIndex(new Xi(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let i;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);i=new Fl(t,n.itemSize,n.offset,n.normalized)}else{const e=oa(n.type,n.array);i=new(n.isInstancedBufferAttribute?Ld:Xi)(e,n.itemSize,n.normalized)}void 0!==n.name&&(i.name=n.name),void 0!==n.usage&&i.setUsage(n.usage),void 0!==n.updateRange&&(i.updateRange.offset=n.updateRange.offset,i.updateRange.count=n.updateRange.count),a.setAttribute(t,i)}const l=e.data.morphAttributes;if(l)for(const t in l){const n=l[t],i=[];for(let t=0,a=n.length;t<a;t++){const a=n[t];let o;if(a.isInterleavedBufferAttribute){const t=r(e.data,a.data);o=new Fl(t,a.itemSize,a.offset,a.normalized)}else{const e=oa(a.type,a.array);o=new Xi(e,a.itemSize,a.normalized)}void 0!==a.name&&(o.name=a.name),i.push(o)}a.morphAttributes[t]=i}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let e=0,t=c.length;e!==t;++e){const t=c[e];a.addGroup(t.start,t.count,t.materialIndex)}const u=e.data.boundingSphere;if(void 0!==u){const e=new vr;void 0!==u.center&&e.fromArray(u.center),a.boundingSphere=new Ur(e,u.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class Id extends xh{constructor(e){super(e)}load(e,t,n,r){const i=this,a=""===this.path?kd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Ah(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){let a=null;try{a=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in a)if(a[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new sd).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new uc).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};let r;if(void 0!==e){const i=new Cd;for(let a=0,o=e.length;a<o;a++){let o;const s=e[a];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new qu[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":o=new qu[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new qu[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new qu[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new qu[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new qu[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new qu[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new qu[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new qu[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new qu[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new qu[s.type]((new id[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new qu[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new qu[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":r=[];for(let e=0,n=s.shapes.length;e<n;e++){const n=t[s.shapes[e]];r.push(n)}o=new qu[s.type](r,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":r=[];for(let e=0,n=s.shapes.length;e<n;e++){const n=t[s.shapes[e]];r.push(n)}const e=s.options.extrudePath;void 0!==e&&(s.options.extrudePath=(new id[e.type]).fromJSON(e)),o=new qu[s.type](r,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new Rd;i.setTextures(t);for(let t=0,a=e.length;t<a;t++){const a=e[t];if("MultiMaterial"===a.type){const e=[];for(let t=0;t<a.materials.length;t++){const r=a.materials[t];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),e.push(n[r.uuid])}r[a.uuid]=e}else void 0===n[a.uuid]&&(n[a.uuid]=i.parse(a)),r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=vh.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function a(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}function o(e){if("string"==typeof e){const t=e;return a(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:oa(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Eh(t);i=new Rh(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let e=0,t=i.length;e<t;e++){const t=o(i[e]);null!==t&&(t instanceof HTMLImageElement?r[n.uuid].push(t):r[n.uuid].push(new Ka(t.data,t.width,t.height)))}}else{const e=o(n.url);null!==e&&(r[n.uuid]=e)}}}return r}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,a=e.length;i<a;i++){const a=e[i];let o;void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const s=t[a.image];Array.isArray(s)?(o=new Xa(s),6===s.length&&(o.needsUpdate=!0)):(o=s&&s.data?new Ka(s.data,s.width,s.height):new hr(s),s&&(o.needsUpdate=!0)),o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),void 0!==a.mapping&&(o.mapping=n(a.mapping,Nd)),void 0!==a.offset&&o.offset.fromArray(a.offset),void 0!==a.repeat&&o.repeat.fromArray(a.repeat),void 0!==a.center&&o.center.fromArray(a.center),void 0!==a.rotation&&(o.rotation=a.rotation),void 0!==a.wrap&&(o.wrapS=n(a.wrap[0],Fd),o.wrapT=n(a.wrap[1],Fd)),void 0!==a.format&&(o.format=a.format),void 0!==a.type&&(o.type=a.type),void 0!==a.encoding&&(o.encoding=a.encoding),void 0!==a.minFilter&&(o.minFilter=n(a.minFilter,Od)),void 0!==a.magFilter&&(o.magFilter=n(a.magFilter,Od)),void 0!==a.anisotropy&&(o.anisotropy=a.anisotropy),void 0!==a.flipY&&(o.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(o.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(o.unpackAlignment=a.unpackAlignment),r[a.uuid]=o}return r}parseObject(e,t,n,r){let i,a,o;function s(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":i=new Cl,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new ji(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new Ll(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new Pl(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new ja(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Ed(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Td(e.color,e.intensity);break;case"DirectionalLight":i=new xd(e.color,e.intensity);break;case"PointLight":i=new bd(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new Ad(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new md(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new cd(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new Sd).fromJSON(e);break;case"SkinnedMesh":a=s(e.geometry),o=l(e.material),i=new oc(a,o),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":a=s(e.geometry),o=l(e.material),i=new Ca(a,o);break;case"InstancedMesh":a=s(e.geometry),o=l(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;i=new mc(a,o,t),i.instanceMatrix=new Xi(new Float32Array(n.array),16),void 0!==r&&(i.instanceColor=new Xi(new Float32Array(r.array),r.itemSize));break;case"LOD":i=new ec;break;case"Line":i=new wc(s(e.geometry),l(e.material));break;case"LineLoop":i=new Mc(s(e.geometry),l(e.material));break;case"LineSegments":i=new Ac(s(e.geometry),l(e.material));break;case"PointCloud":case"Points":i=new Cc(s(e.geometry),l(e.material));break;case"Sprite":i=new Zl(l(e.material));break;case"Group":i=new wl;break;case"Bone":i=new sc;break;default:i=new _i}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)i.add(this.parseObject(a[e],t,n,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];i.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const Nd={UVMapping:ne,CubeReflectionMapping:re,CubeRefractionMapping:ie,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:oe,CubeUVReflectionMapping:se,CubeUVRefractionMapping:le},Fd={RepeatWrapping:ce,ClampToEdgeWrapping:ue,MirroredRepeatWrapping:he},Od={NearestFilter:de,NearestMipmapNearestFilter:fe,NearestMipmapLinearFilter:me,LinearFilter:ve,LinearMipmapNearestFilter:ye,LinearMipmapLinearFilter:be};class Hd extends xh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=bh.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){bh.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}Hd.prototype.isImageBitmapLoader=!0;class Dd{constructor(){this.type="ShapePath",this.color=new ji,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new od,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new sd;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,a=0;a<n;i=a++){let n=t[i],o=t[a],s=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[a],s=-s,o=t[i],l=-l),e.y<n.y||e.y>o.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(o.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=o.x)return!0}}return r}const i=Mu.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return n(a);let o,s,l;const c=[];if(1===a.length)return s=a[0],l=new sd,l.curves=s.curves,c.push(l),c;let u=!i(a[0].getPoints());u=e?!u:u;const h=[],d=[];let f,p,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=a.length;t<n;t++)s=a[t],f=s.getPoints(),o=i(f),o=e?!o:o,o?(!u&&d[g]&&g++,d[g]={s:new sd,p:f},d[g].s.curves=s.curves,u&&g++,m[g]=[]):m[g].push({h:s,p:f[0]});if(!d[0])return n(a);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let a=0;a<i.length;a++){const o=i[a];let s=!0;for(let i=0;i<d.length;i++)r(o.p,d[i].p)&&(n!==i&&t.push({froms:n,tos:i,hole:a}),s?(s=!1,h[i].push(o)):e=!0);s&&h[n].push(o)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),p=m[e];for(let e=0,t=p.length;e<t;e++)l.holes.push(p[e].h)}return c}}class Ud{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],r=Bd(e,t,this.data);for(let e=0,t=r.length;e<t;e++)Array.prototype.push.apply(n,r[e].toShapes());return n}}function Bd(e,t,n){const r=Array.from(e),i=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[];let s=0,l=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)s=0,l-=a;else{const e=zd(t,i,s,l,n);s+=e.offsetX,o.push(e.path)}}return o}function zd(e,t,n,r,i){const a=i.glyphs[e]||i.glyphs["?"];if(!a)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const o=new Dd;let s,l,c,u,h,d,f,p;if(a.o){const e=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let i=0,a=e.length;i<a;)switch(e[i++]){case"m":s=e[i++]*t+n,l=e[i++]*t+r,o.moveTo(s,l);break;case"l":s=e[i++]*t+n,l=e[i++]*t+r,o.lineTo(s,l);break;case"q":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,o.quadraticCurveTo(h,d,c,u);break;case"b":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,f=e[i++]*t+n,p=e[i++]*t+r,o.bezierCurveTo(h,d,f,p,c,u)}}return{offsetX:a.ha*t,path:o}}Ud.prototype.isFont=!0;class Vd extends xh{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Ah(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const r=i.parse(n);t&&t(r)}),n,r)}parse(e){return new Ud(e)}}let jd;const Gd={getContext:function(){return void 0===jd&&(jd=new(window.AudioContext||window.webkitAudioContext)),jd},setContext:function(e){jd=e}};class Wd extends xh{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Ah(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{const e=n.slice(0);Gd.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}class qd extends Sd{constructor(e,t,n=1){super(void 0,n);const r=(new ji).set(e),i=(new ji).set(t),a=new vr(r.r,r.g,r.b),o=new vr(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}}qd.prototype.isHemisphereLightProbe=!0;class Xd extends Sd{constructor(e,t=1){super(void 0,t);const n=(new ji).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Xd.prototype.isAmbientLightProbe=!0;const Yd=new Yr,Kd=new Yr;class Zd{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ja,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ja,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),r=t.eyeSep/2,i=r*t.near/t.focus,a=t.near*Math.tan(Hn*t.fov*.5)/t.zoom;let o,s;Kd.elements[12]=-r,Yd.elements[12]=r,o=-a*t.aspect+i,s=a*t.aspect+i,n.elements[0]=2*t.near/(s-o),n.elements[8]=(s+o)/(s-o),this.cameraL.projectionMatrix.copy(n),o=-a*t.aspect-i,s=a*t.aspect-i,n.elements[0]=2*t.near/(s-o),n.elements[8]=(s+o)/(s-o),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Kd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Yd)}}class Qd{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Jd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Jd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Jd(){return("undefined"==typeof performance?Date:performance).now()}const $d=new vr,ef=new gr,tf=new vr,nf=new vr;class rf extends _i{constructor(){super(),this.type="AudioListener",this.context=Gd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Qd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose($d,ef,tf),nf.set(0,0,-1).applyQuaternion(ef),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime($d.x,e),t.positionY.linearRampToValueAtTime($d.y,e),t.positionZ.linearRampToValueAtTime($d.z,e),t.forwardX.linearRampToValueAtTime(nf.x,e),t.forwardY.linearRampToValueAtTime(nf.y,e),t.forwardZ.linearRampToValueAtTime(nf.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition($d.x,$d.y,$d.z),t.setOrientation(nf.x,nf.y,nf.z,n.x,n.y,n.z)}}class af extends _i{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const of=new vr,sf=new gr,lf=new vr,cf=new vr;class uf extends af{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(of,sf,lf),cf.set(0,0,1).applyQuaternion(sf);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(of.x,e),t.positionY.linearRampToValueAtTime(of.y,e),t.positionZ.linearRampToValueAtTime(of.z,e),t.orientationX.linearRampToValueAtTime(cf.x,e),t.orientationY.linearRampToValueAtTime(cf.y,e),t.orientationZ.linearRampToValueAtTime(cf.z,e)}else t.setPosition(of.x,of.y,of.z),t.setOrientation(cf.x,cf.y,cf.z)}}class hf{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class df{constructor(e,t,n){let r,i,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)n[i+e]=n[e];a=t}else{a+=t;const e=t/a;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){o.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){gr.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const a=this._workIndex*i;gr.multiplyQuaternionsFlat(e,a,e,t,e,n),gr.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,n,r,i){const a=1-r;for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]*a+e[n+o]*r}}_lerpAdditive(e,t,n,r,i){for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]+e[n+a]*r}}}const ff="\\[\\]\\.:\\/",pf=new RegExp("["+ff+"]","g"),mf="[^"+ff+"]",gf="[^"+ff.replace("\\.","")+"]",vf=/((?:WC+[\/:])*)/.source.replace("WC",mf),yf=/(WCOD+)?/.source.replace("WCOD",gf),_f=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",mf),bf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",mf),Ef=new RegExp("^"+vf+yf+_f+bf+"$"),wf=["material","materials","bones"];class xf{constructor(e,t,n){const r=n||Tf.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Tf{constructor(e,t,n){this.path=t,this.parsedPath=n||Tf.parseTrackName(t),this.node=Tf.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Tf.Composite(e,t,n):new Tf(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(pf,"")}static parseTrackName(e){const t=Ef.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==wf.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=Tf.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Tf.Composite=xf,Tf.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Tf.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Tf.prototype.GetterByBindingType=[Tf.prototype._getValue_direct,Tf.prototype._getValue_array,Tf.prototype._getValue_arrayElement,Tf.prototype._getValue_toArray],Tf.prototype.SetterByBindingTypeAndVersioning=[[Tf.prototype._setValue_direct,Tf.prototype._setValue_direct_setNeedsUpdate,Tf.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Tf.prototype._setValue_array,Tf.prototype._setValue_array_setNeedsUpdate,Tf.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Tf.prototype._setValue_arrayElement,Tf.prototype._setValue_arrayElement_setNeedsUpdate,Tf.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Tf.prototype._setValue_fromArray,Tf.prototype._setValue_fromArray_setNeedsUpdate,Tf.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Af{constructor(){this.uuid=Un(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,a=i.length;let o,s=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=s++,t[h]=d,e.push(u);for(let e=0,t=a;e!==t;++e)i[e].push(new Tf(u,n[e],r[e]))}else if(d<l){o=e[d];const s=--l,c=e[s];t[c.uuid]=d,e[d]=c,t[h]=s,e[s]=u;for(let e=0,t=a;e!==t;++e){const t=i[e],a=t[s];let o=t[d];t[d]=a,void 0===o&&(o=new Tf(u,n[e],r[e])),t[s]=o}}else e[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a],s=o.uuid,l=t[s];if(void 0!==l&&l>=i){const a=i++,c=e[a];t[c.uuid]=l,e[l]=c,t[s]=a,e[a]=o;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[l];t[l]=r,t[a]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,a=e.length;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o].uuid,l=t[s];if(void 0!==l)if(delete t[s],l<i){const o=--i,s=e[o],c=--a,u=e[c];t[s.uuid]=l,e[l]=s,t[u.uuid]=o,e[o]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[c];t[l]=r,t[o]=i,t.pop()}}else{const i=--a,o=e[i];i>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,a.push(e),o.push(t),i.push(u);for(let n=c,r=s.length;n!==r;++n){const r=s[n];u[n]=new Tf(r,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}}Af.prototype.isAnimationObjectGroup=!0;class Mf{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,a=i.length,o=new Array(a),s={endingStart:Bt,endingEnd:Bt};for(let e=0;e!==a;++e){const t=i[e].createInterpolant(null);o[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ft,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,a=n/r;e.warp(1,i,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/a,l[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case Gt:for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(a),t[n].accumulateAdditive(o);break;case jt:default:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(a),t[n].accumulate(r,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const a=n===Ot;if(0===e)return-1===i?r:a&&1==(1&i)?t-r:r;if(n===Nt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=zt,r.endingEnd=zt):(r.endingStart=e?this.zeroSlopeAtStart?zt:Bt:Vt,r.endingEnd=t?this.zeroSlopeAtEnd?zt:Bt:Vt)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}class Sf extends Nn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l];if(void 0!==u)a[e]=u;else{if(u=a[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,s,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new df(Tf.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,s,l),a[e]=u}o[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{const t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new sh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let a="string"==typeof e?vh.findByName(r,e):e;const o=null!==a?a.uuid:e,s=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==a?a.blendMode:jt),void 0!==s){const e=s.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const c=new Mf(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?vh.findByName(n,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1;for(let o=0;o!==n;++o)t[o]._update(r,e,i,a);const o=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)o[e].apply(a);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,a=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,a._cacheIndex=i,t[i]=a,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Sf.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Rf{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Rf(void 0===this.value.clone?this.value:this.value.clone())}}class kf extends Il{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}kf.prototype.isInstancedInterleavedBuffer=!0;class Pf{constructor(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Pf.prototype.isGLBufferAttribute=!0;class Lf{constructor(e,t,n=0,r=1/0){this.ray=new Xr(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new ai,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,n=[]){return If(e,this,n,t),n.sort(Cf),n}intersectObjects(e,t=!1,n=[]){for(let r=0,i=e.length;r<i;r++)If(e[r],this,n,t);return n.sort(Cf),n}}function Cf(e,t){return e.distance-t.distance}function If(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)If(r[e],t,n,!0)}}class Nf{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Bn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Ff{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Of=new or;class Hf{constructor(e=new or(1/0,1/0),t=new or(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Of.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new or),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new or),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new or),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new or),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Of.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Hf.prototype.isBox2=!0;const Df=new vr,Uf=new vr;class Bf{constructor(e=new vr,t=new vr){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new vr),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new vr),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new vr),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Df.subVectors(e,this.start),Uf.subVectors(this.end,this.start);const n=Uf.dot(Uf);let r=Uf.dot(Df)/n;return t&&(r=Bn(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new vr),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class zf extends _i{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}zf.prototype.isImmediateRenderObject=!0;const Vf=new vr;class jf extends _i{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new pa,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,a=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(a),Math.sin(a),1)}n.setAttribute("position",new na(r,3));const i=new gc({fog:!1,toneMapped:!1});this.cone=new Ac(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Vf.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Vf),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Gf=new vr,Wf=new Yr,qf=new Yr;class Xf extends Ac{constructor(e){const t=Yf(e),n=new pa,r=[],i=[],a=new ji(0,0,1),o=new ji(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new na(r,3)),n.setAttribute("color",new na(i,3)),super(n,new gc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");qf.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(Wf.multiplyMatrices(qf,i.matrixWorld),Gf.setFromMatrixPosition(Wf),r.setXYZ(n,Gf.x,Gf.y,Gf.z),Wf.multiplyMatrices(qf,i.parent.matrixWorld),Gf.setFromMatrixPosition(Wf),r.setXYZ(n+1,Gf.x,Gf.y,Gf.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Yf(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Yf(e.children[n]));return t}class Kf extends Ca{constructor(e,t,n){super(new Uu(t,4,2),new Gi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Zf=new vr,Qf=new ji,Jf=new ji;class $f extends _i{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Nu(t);r.rotateY(.5*Math.PI),this.material=new Gi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),a=new Float32Array(3*i.count);r.setAttribute("color",new Xi(a,3)),this.add(new Ca(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Qf.copy(this.light.color),Jf.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Qf:Jf;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Zf.setFromMatrixPosition(this.light.matrixWorld).negate())}}class ep extends Ac{constructor(e=10,t=10,n=4473924,r=8947848){n=new ji(n),r=new ji(r);const i=t/2,a=e/t,o=e/2,s=[],l=[];for(let e=0,c=0,u=-o;e<=t;e++,u+=a){s.push(-o,0,u,o,0,u),s.push(u,0,-o,u,0,o);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new pa;c.setAttribute("position",new na(s,3)),c.setAttribute("color",new na(l,3)),super(c,new gc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class tp extends Ac{constructor(e=10,t=16,n=8,r=64,i=4473924,a=8947848){i=new ji(i),a=new ji(a);const o=[],s=[];for(let n=0;n<=t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;o.push(0,0,0),o.push(l,0,c);const u=1&n?i:a;s.push(u.r,u.g,u.b),s.push(u.r,u.g,u.b)}for(let t=0;t<=n;t++){const l=1&t?i:a,c=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c;o.push(n,0,i),s.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c,o.push(n,0,i),s.push(l.r,l.g,l.b)}}const l=new pa;l.setAttribute("position",new na(o,3)),l.setAttribute("color",new na(s,3)),super(l,new gc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const np=new vr,rp=new vr,ip=new vr;class ap extends _i{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new pa;r.setAttribute("position",new na([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new gc({fog:!1,toneMapped:!1});this.lightPlane=new wc(r,i),this.add(this.lightPlane),r=new pa,r.setAttribute("position",new na([0,0,0,0,0,1],3)),this.targetLine=new wc(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){np.setFromMatrixPosition(this.light.matrixWorld),rp.setFromMatrixPosition(this.light.target.matrixWorld),ip.subVectors(rp,np),this.lightPlane.lookAt(rp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(rp),this.targetLine.scale.z=ip.length()}}const op=new vr,sp=new Va;class lp extends Ac{constructor(e){const t=new pa,n=new gc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],a={},o=new ji(16755200),s=new ji(16711680),l=new ji(43775),c=new ji(16777215),u=new ji(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.setAttribute("position",new na(r,3)),t.setAttribute("color",new na(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;sp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),cp("c",t,e,sp,0,0,-1),cp("t",t,e,sp,0,0,1),cp("n1",t,e,sp,-n,-r,-1),cp("n2",t,e,sp,n,-r,-1),cp("n3",t,e,sp,-n,r,-1),cp("n4",t,e,sp,n,r,-1),cp("f1",t,e,sp,-n,-r,1),cp("f2",t,e,sp,n,-r,1),cp("f3",t,e,sp,-n,r,1),cp("f4",t,e,sp,n,r,1),cp("u1",t,e,sp,.7*n,1.1*r,-1),cp("u2",t,e,sp,.7*-n,1.1*r,-1),cp("u3",t,e,sp,0,2*r,-1),cp("cf1",t,e,sp,-n,0,1),cp("cf2",t,e,sp,n,0,1),cp("cf3",t,e,sp,0,-r,1),cp("cf4",t,e,sp,0,r,1),cp("cn1",t,e,sp,-n,0,-1),cp("cn2",t,e,sp,n,0,-1),cp("cn3",t,e,sp,0,-r,-1),cp("cn4",t,e,sp,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function cp(e,t,n,r,i,a,o){op.set(i,a,o).unproject(r);const s=t[e];if(void 0!==s){const e=n.getAttribute("position");for(let t=0,n=s.length;t<n;t++)e.setXYZ(s[t],op.x,op.y,op.z)}}const up=new br;class hp extends Ac{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new pa;i.setIndex(new Xi(n,1)),i.setAttribute("position",new Xi(r,3)),super(i,new gc({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&up.setFromObject(this.object),up.isEmpty())return;const t=up.min,n=up.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Ac.prototype.copy.call(this,e),this.object=e.object,this}}class dp extends Ac{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],i=new pa;i.setIndex(new Xi(n,1)),i.setAttribute("position",new na(r,3)),super(i,new gc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class fp extends wc{constructor(e,t=1,n=16776960){const r=n,i=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],a=new pa;a.setAttribute("position",new na(i,3)),a.computeBoundingSphere(),super(a,new gc({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],s=new pa;s.setAttribute("position",new na(o,3)),s.computeBoundingSphere(),this.add(new Ca(s,new Gi({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?f:d,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const pp=new vr;let mp,gp;class vp extends _i{constructor(e=new vr(0,0,1),t=new vr(0,0,0),n=1,r=16776960,i=.2*n,a=.2*i){super(),this.type="ArrowHelper",void 0===mp&&(mp=new pa,mp.setAttribute("position",new na([0,0,0,0,1,0],3)),gp=new Uc(0,.5,1,5,1),gp.translate(0,-.5,0)),this.position.copy(t),this.line=new wc(mp,new gc({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ca(gp,new Gi({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{pp.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(pp,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class yp extends Ac{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new pa;r.setAttribute("position",new na(t,3)),r.setAttribute("color",new na(n,3)),super(r,new gc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _p=new Float32Array(1),bp=new Int32Array(_p.buffer);class Ep{static toHalfFloat(e){_p[0]=e;const t=bp[0];let n=t>>16&32768,r=t>>12&2047;const i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}}const wp=4,xp=8,Tp=Math.pow(2,xp),Ap=[.125,.215,.35,.446,.526,.582],Mp=xp-wp+1+Ap.length,Sp=20,Rp={[Yt]:0,[Kt]:1,[Qt]:2,[$t]:3,[en]:4,[tn]:5,[Zt]:6},kp=new Gi({side:f,depthWrite:!1,depthTest:!1}),Pp=new Ca(new Fa,kp),Lp=new Ed,{_lodPlanes:Cp,_sizeLods:Ip,_sigmas:Np}=jp(),Fp=new ji;let Op=null;const Hp=(1+Math.sqrt(5))/2,Dp=1/Hp,Up=[new vr(1,1,1),new vr(-1,1,1),new vr(1,1,-1),new vr(-1,1,-1),new vr(0,Hp,Dp),new vr(0,Hp,-Dp),new vr(Dp,0,Hp),new vr(-Dp,0,Hp),new vr(Hp,Dp,0),new vr(-Hp,Dp,0)];function Bp(e){const t=Math.max(e.r,e.g,e.b),n=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);return e.multiplyScalar(Math.pow(2,-n)),(n+128)/255}class zp{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=qp(Sp),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){Op=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Yp(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Xp(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Cp.length;e++)Cp[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Op),e.scissorTest=!1,Wp(e,0,0,e.width,e.height)}_fromTexture(e){Op=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:de,minFilter:de,generateMipmaps:!1,type:we,format:Ue,encoding:Vp(e)?e.encoding:Qt,depthBuffer:!1},n=Gp(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Gp(t),n}_compileMaterial(e){const t=new Ca(Cp[0],e);this._renderer.compile(t,Lp)}_sceneToCubeUV(e,t,n,r){const i=new ja(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.outputEncoding,u=s.toneMapping;s.getClearColor(Fp),s.toneMapping=Z,s.outputEncoding=Yt,s.autoClear=!1;let h=!1;const d=e.background;if(d){if(d.isColor){kp.color.copy(d).convertSRGBToLinear(),e.background=null;const t=Bp(kp.color);kp.opacity=t,h=!0}}else{kp.color.copy(Fp).convertSRGBToLinear();const e=Bp(kp.color);kp.opacity=e,h=!0}for(let t=0;t<6;t++){const n=t%3;0==n?(i.up.set(0,a[t],0),i.lookAt(o[t],0,0)):1==n?(i.up.set(0,0,a[t]),i.lookAt(0,o[t],0)):(i.up.set(0,a[t],0),i.lookAt(0,0,o[t])),Wp(r,n*Tp,t>2?Tp:0,Tp,Tp),s.setRenderTarget(r),h&&s.render(Pp,i),s.render(e,i)}s.toneMapping=u,s.outputEncoding=c,s.autoClear=l}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Yp()):null==this._equirectShader&&(this._equirectShader=Xp());const r=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Ca(Cp[0],r),a=r.uniforms;a.envMap.value=e,e.isCubeTexture||a.texelSize.value.set(1/e.image.width,1/e.image.height),a.inputEncoding.value=Rp[e.encoding],a.outputEncoding.value=Rp[t.texture.encoding],Wp(t,0,0,3*Tp,2*Tp),n.setRenderTarget(t),n.render(i,Lp)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<Mp;t++){const n=Math.sqrt(Np[t]*Np[t]-Np[t-1]*Np[t-1]),r=Up[(t-1)%Up.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,u=new Ca(Cp[r],l),h=l.uniforms,d=Ip[n]-1,f=isFinite(i)?Math.PI/(2*d):2*Math.PI/(2*Sp-1),p=i/f,m=isFinite(i)?1+Math.floor(c*p):Sp;m>Sp&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Sp}`);const g=[];let v=0;for(let e=0;e<Sp;++e){const t=e/p,n=Math.exp(-t*t/2);g.push(n),0==e?v+=n:e<m&&(v+=2*n)}for(let e=0;e<g.length;e++)g[e]=g[e]/v;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=g,h.latitudinal.value="latitudinal"===a,o&&(h.poleAxis.value=o),h.dTheta.value=f,h.mipInt.value=xp-n,h.inputEncoding.value=Rp[e.texture.encoding],h.outputEncoding.value=Rp[e.texture.encoding];const y=Ip[r];Wp(t,3*Math.max(0,Tp-2*y),(0===r?0:2*Tp)+2*y*(r>xp-wp?r-xp+wp:0),3*y,2*y),s.setRenderTarget(t),s.render(u,Lp)}}function Vp(e){return void 0!==e&&e.type===we&&(e.encoding===Yt||e.encoding===Kt||e.encoding===Zt)}function jp(){const e=[],t=[],n=[];let r=xp;for(let i=0;i<Mp;i++){const a=Math.pow(2,r);t.push(a);let o=1/a;i>xp-wp?o=Ap[i-xp+wp-1]:0==i&&(o=0),n.push(o);const s=1/(a-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,f=3,p=2,m=1,g=new Float32Array(f*d*h),v=new Float32Array(p*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(r,f*d*e),v.set(u,p*d*e);const i=[e,e,e,e,e,e];y.set(i,m*d*e)}const _=new pa;_.setAttribute("position",new Xi(g,f)),_.setAttribute("uv",new Xi(v,p)),_.setAttribute("faceIndex",new Xi(y,m)),e.push(_),r>wp&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Gp(e){const t=new pr(3*Tp,3*Tp,e);return t.texture.mapping=se,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Wp(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function qp(e){const t=new Float32Array(e),n=new vr(0,1,0);return new Yu({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Rp[Yt]},outputEncoding:{value:Rp[Yt]}},vertexShader:Kp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${Zp()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:v,depthTest:!1,depthWrite:!1})}function Xp(){const e=new or(1,1);return new Yu({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Rp[Yt]},outputEncoding:{value:Rp[Yt]}},vertexShader:Kp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${Zp()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:v,depthTest:!1,depthWrite:!1})}function Yp(){return new Yu({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Rp[Yt]},outputEncoding:{value:Rp[Yt]}},vertexShader:Kp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${Zp()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:v,depthTest:!1,depthWrite:!1})}function Kp(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Zp(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}const Qp=0,Jp=1,$p=0,em=1,tm=2;function nm(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function rm(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function im(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Cc(e,t)}function am(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Zl(e)}function om(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Cc(e,t)}function sm(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Sc(e)}function lm(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Sc(e)}function cm(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Sc(e)}function um(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new vr(e,t,n)}function hm(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Xi(e,t).setUsage(Tn)}function dm(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Yi(e,t)}function fm(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ki(e,t)}function pm(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Zi(e,t)}function mm(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Qi(e,t)}function gm(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Ji(e,t)}function vm(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new $i(e,t)}function ym(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new ea(e,t)}function _m(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new na(e,t)}function bm(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new ra(e,t)}function Em(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new yp(e)}function wm(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new hp(e,t)}function xm(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ac(new Xc(e.geometry),new gc({color:void 0!==t?t:16777215}))}function Tm(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ac(new Wu(e.geometry),new gc({color:void 0!==t?t:16777215}))}function Am(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Ah(e)}function Mm(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Ph(e)}function Sm(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ya(e,n)}function Rm(){console.error("THREE.CanvasRenderer has been removed")}function km(){console.error("THREE.JSONLoader has been removed.")}Ch.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ch.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},od.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},ep.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Xf.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},xh.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),kd.extractUrlBase(e)},xh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Hf.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Hf.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Hf.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Hf.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},br.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},br.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},br.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},br.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},br.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Ur.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ja.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Bf.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},sr.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},sr.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},sr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},sr.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},sr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},sr.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Yr.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Yr.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Yr.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new vr).setFromMatrixColumn(this,3)},Yr.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Yr.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Yr.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Yr.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Yr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Yr.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Yr.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Yr.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Yr.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Yr.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Yr.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Yr.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Yr.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Yr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Yr.prototype.makeFrustum=function(e,t,n,r,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,a)},Yr.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},xi.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},gr.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},gr.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Xr.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Xr.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Xr.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Ni.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ni.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Ni.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Ni.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Ni.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Ni.barycoordFromPoint=function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ni.getBarycoord(e,t,n,r,i)},Ni.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ni.getNormal(e,t,n,r)},sd.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},sd.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ku(this,e)},sd.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Hu(this,e)},or.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},or.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},or.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},vr.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},vr.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},vr.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},vr.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},vr.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},vr.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},vr.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},vr.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},vr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},fr.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},fr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},_i.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},_i.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},_i.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},_i.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},_i.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(_i.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Ca.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Ca.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Wt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),oc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ja.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ld.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Xi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Tn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Tn)}}}),Xi.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tn:xn),this},Xi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Xi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},pa.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},pa.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Xi(arguments[1],arguments[2])))},pa.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},pa.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},pa.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},pa.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},pa.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(pa.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Il.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tn:xn),this},Il.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ku.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ku.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ku.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Cl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Rf.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Oi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ji}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===m}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(za.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Rl.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},Rl.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Rl.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Rl.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Rl.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Rl.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Rl.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Rl.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Rl.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Rl.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Rl.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Rl.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Rl.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Rl.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Rl.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Rl.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Rl.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Rl.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Rl.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Rl.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Rl.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Rl.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Rl.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Rl.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Rl.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Rl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Kt:Yt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(vl.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(pr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),af.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Wd).load(e,(function(e){t.setBuffer(e)})),this},hf.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},qa.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},qa.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},cr.crossOrigin=void 0,cr.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Lh;i.setCrossOrigin(this.crossOrigin);const a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},cr.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new kh;i.setCrossOrigin(this.crossOrigin);const a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},cr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},cr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Pm={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Lm(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t),e.ACESFilmicToneMapping=ee,e.AddEquation=x,e.AddOperation=K,e.AdditiveAnimationBlendMode=Gt,e.AdditiveBlending=_,e.AlphaFormat=Ne,e.AlwaysDepth=B,e.AlwaysStencilFunc=wn,e.AmbientLight=Td,e.AmbientLightProbe=Xd,e.AnimationClip=vh,e.AnimationLoader=Mh,e.AnimationMixer=Sf,e.AnimationObjectGroup=Af,e.AnimationUtils=ih,e.ArcCurve=Nh,e.ArrayCamera=El,e.ArrowHelper=vp,e.Audio=af,e.AudioAnalyser=hf,e.AudioContext=Gd,e.AudioListener=rf,e.AudioLoader=Wd,e.AxesHelper=yp,e.AxisHelper=Em,e.BackSide=f,e.BasicDepthPacking=nn,e.BasicShadowMap=l,e.BinaryTextureLoader=Mm,e.Bone=sc,e.BooleanKeyframeTrack=uh,e.BoundingBoxHelper=wm,e.Box2=Hf,e.Box3=br,e.Box3Helper=dp,e.BoxBufferGeometry=Fa,e.BoxGeometry=Fa,e.BoxHelper=hp,e.BufferAttribute=Xi,e.BufferGeometry=pa,e.BufferGeometryLoader=Cd,e.ByteType=xe,e.Cache=bh,e.Camera=Va,e.CameraHelper=lp,e.CanvasRenderer=Rm,e.CanvasTexture=Oc,e.CatmullRomCurve3=Bh,e.CineonToneMapping=$,e.CircleBufferGeometry=Dc,e.CircleGeometry=Dc,e.ClampToEdgeWrapping=ue,e.Clock=Qd,e.Color=ji,e.ColorKeyframeTrack=hh,e.CompressedTexture=Fc,e.CompressedTextureLoader=Sh,e.ConeBufferGeometry=Bc,e.ConeGeometry=Bc,e.CubeCamera=qa,e.CubeReflectionMapping=re,e.CubeRefractionMapping=ie,e.CubeTexture=Xa,e.CubeTextureLoader=kh,e.CubeUVReflectionMapping=se,e.CubeUVRefractionMapping=le,e.CubicBezierCurve=Qh,e.CubicBezierCurve3=Jh,e.CubicInterpolant=oh,e.CullFaceBack=a,e.CullFaceFront=o,e.CullFaceFrontBack=s,e.CullFaceNone=i,e.Curve=Ch,e.CurvePath=ad,e.CustomBlending=w,e.CustomToneMapping=te,e.CylinderBufferGeometry=Uc,e.CylinderGeometry=Uc,e.Cylindrical=Ff,e.DataTexture=Ka,e.DataTexture2DArray=bo,e.DataTexture3D=Eo,e.DataTextureLoader=Ph,e.DataUtils=Ep,e.DecrementStencilOp=hn,e.DecrementWrapStencilOp=fn,e.DefaultLoadingManager=wh,e.DepthFormat=Be,e.DepthStencilFormat=ze,e.DepthTexture=Hc,e.DirectionalLight=xd,e.DirectionalLightHelper=ap,e.DiscreteInterpolant=lh,e.DodecahedronBufferGeometry=Vc,e.DodecahedronGeometry=Vc,e.DoubleSide=p,e.DstAlphaFactor=N,e.DstColorFactor=O,e.DynamicBufferAttribute=hm,e.DynamicCopyUsage=Pn,e.DynamicDrawUsage=Tn,e.DynamicReadUsage=Sn,e.EdgesGeometry=Xc,e.EdgesHelper=xm,e.EllipseCurve=Ih,e.EqualDepth=j,e.EqualStencilFunc=vn,e.EquirectangularReflectionMapping=ae,e.EquirectangularRefractionMapping=oe,e.Euler=ii,e.EventDispatcher=Nn,e.ExtrudeBufferGeometry=ku,e.ExtrudeGeometry=ku,e.FaceColors=em,e.FileLoader=Ah,e.FlatShading=m,e.Float16BufferAttribute=ta,e.Float32Attribute=_m,e.Float32BufferAttribute=na,e.Float64Attribute=bm,e.Float64BufferAttribute=ra,e.FloatType=Re,e.Fog=Ll,e.FogExp2=Pl,e.Font=Ud,e.FontLoader=Vd,e.FrontSide=d,e.Frustum=Ja,e.GLBufferAttribute=Pf,e.GLSL1=Cn,e.GLSL3=In,e.GammaEncoding=Zt,e.GreaterDepth=W,e.GreaterEqualDepth=G,e.GreaterEqualStencilFunc=En,e.GreaterStencilFunc=_n,e.GridHelper=ep,e.Group=wl,e.HalfFloatType=ke,e.HemisphereLight=cd,e.HemisphereLightHelper=$f,e.HemisphereLightProbe=qd,e.IcosahedronBufferGeometry=Cu,e.IcosahedronGeometry=Cu,e.ImageBitmapLoader=Hd,e.ImageLoader=Rh,e.ImageUtils=cr,e.ImmediateRenderObject=zf,e.IncrementStencilOp=un,e.IncrementWrapStencilOp=dn,e.InstancedBufferAttribute=Ld,e.InstancedBufferGeometry=Pd,e.InstancedInterleavedBuffer=kf,e.InstancedMesh=mc,e.Int16Attribute=mm,e.Int16BufferAttribute=Qi,e.Int32Attribute=vm,e.Int32BufferAttribute=$i,e.Int8Attribute=dm,e.Int8BufferAttribute=Yi,e.IntType=Me,e.InterleavedBuffer=Il,e.InterleavedBufferAttribute=Fl,e.Interpolant=ah,e.InterpolateDiscrete=Ht,e.InterpolateLinear=Dt,e.InterpolateSmooth=Ut,e.InvertStencilOp=pn,e.JSONLoader=km,e.KeepStencilOp=ln,e.KeyframeTrack=ch,e.LOD=ec,e.LatheBufferGeometry=Iu,e.LatheGeometry=Iu,e.Layers=ai,e.LensFlare=Lm,e.LessDepth=z,e.LessEqualDepth=V,e.LessEqualStencilFunc=yn,e.LessStencilFunc=gn,e.Light=ld,e.LightProbe=Sd,e.Line=wc,e.Line3=Bf,e.LineBasicMaterial=gc,e.LineCurve=$h,e.LineCurve3=ed,e.LineDashedMaterial=nh,e.LineLoop=Mc,e.LinePieces=Jp,e.LineSegments=Ac,e.LineStrip=Qp,e.LinearEncoding=Yt,e.LinearFilter=ve,e.LinearInterpolant=sh,e.LinearMipMapLinearFilter=Ee,e.LinearMipMapNearestFilter=_e,e.LinearMipmapLinearFilter=be,e.LinearMipmapNearestFilter=ye,e.LinearToneMapping=Q,e.Loader=xh,e.LoaderUtils=kd,e.LoadingManager=Eh,e.LogLuvEncoding=Jt,e.LoopOnce=Nt,e.LoopPingPong=Ot,e.LoopRepeat=Ft,e.LuminanceAlphaFormat=De,e.LuminanceFormat=He,e.MOUSE=n,e.Material=Oi,e.MaterialLoader=Rd,e.Math=ar,e.MathUtils=ar,e.Matrix3=sr,e.Matrix4=Yr,e.MaxEquation=S,e.Mesh=Ca,e.MeshBasicMaterial=Gi,e.MeshDepthMaterial=fl,e.MeshDistanceMaterial=pl,e.MeshFaceMaterial=nm,e.MeshLambertMaterial=eh,e.MeshMatcapMaterial=th,e.MeshNormalMaterial=$u,e.MeshPhongMaterial=Qu,e.MeshPhysicalMaterial=Zu,e.MeshStandardMaterial=Ku,e.MeshToonMaterial=Ju,e.MinEquation=M,e.MirroredRepeatWrapping=he,e.MixOperation=Y,e.MultiMaterial=rm,e.MultiplyBlending=E,e.MultiplyOperation=X,e.NearestFilter=de,e.NearestMipMapLinearFilter=ge,e.NearestMipMapNearestFilter=pe,e.NearestMipmapLinearFilter=me,e.NearestMipmapNearestFilter=fe,e.NeverDepth=U,e.NeverStencilFunc=mn,e.NoBlending=v,e.NoColors=$p,e.NoToneMapping=Z,e.NormalAnimationBlendMode=jt,e.NormalBlending=y,e.NotEqualDepth=q,e.NotEqualStencilFunc=bn,e.NumberKeyframeTrack=dh,e.Object3D=_i,e.ObjectLoader=Id,e.ObjectSpaceNormalMap=on,e.OctahedronBufferGeometry=Nu,e.OctahedronGeometry=Nu,e.OneFactor=k,e.OneMinusDstAlphaFactor=F,e.OneMinusDstColorFactor=H,e.OneMinusSrcAlphaFactor=I,e.OneMinusSrcColorFactor=L,e.OrthographicCamera=Ed,e.PCFShadowMap=c,e.PCFSoftShadowMap=u,e.PMREMGenerator=zp,e.ParametricBufferGeometry=Fu,e.ParametricGeometry=Fu,e.Particle=am,e.ParticleBasicMaterial=lm,e.ParticleSystem=om,e.ParticleSystemMaterial=cm,e.Path=od,e.PerspectiveCamera=ja,e.Plane=xi,e.PlaneBufferGeometry=to,e.PlaneGeometry=to,e.PlaneHelper=fp,e.PointCloud=im,e.PointCloudMaterial=sm,e.PointLight=bd,e.PointLightHelper=Kf,e.Points=Cc,e.PointsMaterial=Sc,e.PolarGridHelper=tp,e.PolyhedronBufferGeometry=zc,e.PolyhedronGeometry=zc,e.PositionalAudio=uf,e.PropertyBinding=Tf,e.PropertyMixer=df,e.QuadraticBezierCurve=td,e.QuadraticBezierCurve3=nd,e.Quaternion=gr,e.QuaternionKeyframeTrack=ph,e.QuaternionLinearInterpolant=fh,e.REVISION=t,e.RGBADepthPacking=rn,e.RGBAFormat=Oe,e.RGBAIntegerFormat=Xe,e.RGBA_ASTC_10x10_Format=gt,e.RGBA_ASTC_10x5_Format=ft,e.RGBA_ASTC_10x6_Format=pt,e.RGBA_ASTC_10x8_Format=mt,e.RGBA_ASTC_12x10_Format=vt,e.RGBA_ASTC_12x12_Format=yt,e.RGBA_ASTC_4x4_Format=at,e.RGBA_ASTC_5x4_Format=ot,e.RGBA_ASTC_5x5_Format=st,e.RGBA_ASTC_6x5_Format=lt,e.RGBA_ASTC_6x6_Format=ct,e.RGBA_ASTC_8x5_Format=ut,e.RGBA_ASTC_8x6_Format=ht,e.RGBA_ASTC_8x8_Format=dt,e.RGBA_BPTC_Format=_t,e.RGBA_ETC2_EAC_Format=it,e.RGBA_PVRTC_2BPPV1_Format=tt,e.RGBA_PVRTC_4BPPV1_Format=et,e.RGBA_S3TC_DXT1_Format=Ke,e.RGBA_S3TC_DXT3_Format=Ze,e.RGBA_S3TC_DXT5_Format=Qe,e.RGBDEncoding=tn,e.RGBEEncoding=Qt,e.RGBEFormat=Ue,e.RGBFormat=Fe,e.RGBIntegerFormat=qe,e.RGBM16Encoding=en,e.RGBM7Encoding=$t,e.RGB_ETC1_Format=nt,e.RGB_ETC2_Format=rt,e.RGB_PVRTC_2BPPV1_Format=$e,e.RGB_PVRTC_4BPPV1_Format=Je,e.RGB_S3TC_DXT1_Format=Ye,e.RGFormat=Ge,e.RGIntegerFormat=We,e.RawShaderMaterial=Yu,e.Ray=Xr,e.Raycaster=Lf,e.RectAreaLight=Ad,e.RedFormat=Ve,e.RedIntegerFormat=je,e.ReinhardToneMapping=J,e.RepeatWrapping=ce,e.ReplaceStencilOp=cn,e.ReverseSubtractEquation=A,e.RingBufferGeometry=Ou,e.RingGeometry=Ou,e.SRGB8_ALPHA8_ASTC_10x10_Format=Lt,e.SRGB8_ALPHA8_ASTC_10x5_Format=Rt,e.SRGB8_ALPHA8_ASTC_10x6_Format=kt,e.SRGB8_ALPHA8_ASTC_10x8_Format=Pt,e.SRGB8_ALPHA8_ASTC_12x10_Format=Ct,e.SRGB8_ALPHA8_ASTC_12x12_Format=It,e.SRGB8_ALPHA8_ASTC_4x4_Format=bt,e.SRGB8_ALPHA8_ASTC_5x4_Format=Et,e.SRGB8_ALPHA8_ASTC_5x5_Format=wt,e.SRGB8_ALPHA8_ASTC_6x5_Format=xt,e.SRGB8_ALPHA8_ASTC_6x6_Format=Tt,e.SRGB8_ALPHA8_ASTC_8x5_Format=At,e.SRGB8_ALPHA8_ASTC_8x6_Format=Mt,e.SRGB8_ALPHA8_ASTC_8x8_Format=St,e.Scene=Cl,e.SceneUtils=Pm,e.ShaderChunk=no,e.ShaderLib=io,e.ShaderMaterial=za,e.ShadowMaterial=Xu,e.Shape=sd,e.ShapeBufferGeometry=Hu,e.ShapeGeometry=Hu,e.ShapePath=Dd,e.ShapeUtils=Mu,e.ShortType=Te,e.Skeleton=uc,e.SkeletonHelper=Xf,e.SkinnedMesh=oc,e.SmoothShading=g,e.Sphere=Ur,e.SphereBufferGeometry=Uu,e.SphereGeometry=Uu,e.Spherical=Nf,e.SphericalHarmonics3=Md,e.SplineCurve=rd,e.SpotLight=md,e.SpotLightHelper=jf,e.Sprite=Zl,e.SpriteMaterial=Ol,e.SrcAlphaFactor=C,e.SrcAlphaSaturateFactor=D,e.SrcColorFactor=P,e.StaticCopyUsage=kn,e.StaticDrawUsage=xn,e.StaticReadUsage=Mn,e.StereoCamera=Zd,e.StreamCopyUsage=Ln,e.StreamDrawUsage=An,e.StreamReadUsage=Rn,e.StringKeyframeTrack=mh,e.SubtractEquation=T,e.SubtractiveBlending=b,e.TOUCH=r,e.TangentSpaceNormalMap=an,e.TetrahedronBufferGeometry=Bu,e.TetrahedronGeometry=Bu,e.TextBufferGeometry=zu,e.TextGeometry=zu,e.Texture=hr,e.TextureLoader=Lh,e.TorusBufferGeometry=Vu,e.TorusGeometry=Vu,e.TorusKnotBufferGeometry=ju,e.TorusKnotGeometry=ju,e.Triangle=Ni,e.TriangleFanDrawMode=Xt,e.TriangleStripDrawMode=qt,e.TrianglesDrawMode=Wt,e.TubeBufferGeometry=Gu,e.TubeGeometry=Gu,e.UVMapping=ne,e.Uint16Attribute=gm,e.Uint16BufferAttribute=Ji,e.Uint32Attribute=ym,e.Uint32BufferAttribute=ea,e.Uint8Attribute=fm,e.Uint8BufferAttribute=Ki,e.Uint8ClampedAttribute=pm,e.Uint8ClampedBufferAttribute=Zi,e.Uniform=Rf,e.UniformsLib=ro,e.UniformsUtils=Da,e.UnsignedByteType=we,e.UnsignedInt248Type=Ie,e.UnsignedIntType=Se,e.UnsignedShort4444Type=Pe,e.UnsignedShort5551Type=Le,e.UnsignedShort565Type=Ce,e.UnsignedShortType=Ae,e.VSMShadowMap=h,e.Vector2=or,e.Vector3=vr,e.Vector4=fr,e.VectorKeyframeTrack=gh,e.Vertex=um,e.VertexColors=tm,e.VideoTexture=Nc,e.WebGL1Renderer=kl,e.WebGLCubeRenderTarget=Ya,e.WebGLMultisampleRenderTarget=mr,e.WebGLRenderTarget=pr,e.WebGLRenderTargetCube=Sm,e.WebGLRenderer=Rl,e.WebGLUtils=bl,e.WireframeGeometry=Wu,e.WireframeHelper=Tm,e.WrapAroundEnding=Vt,e.XHRLoader=Am,e.ZeroCurvatureEnding=Bt,e.ZeroFactor=R,e.ZeroSlopeEnding=zt,e.ZeroStencilOp=sn,e.sRGBEncoding=Kt,Object.defineProperty(e,"__esModule",{value:!0})}(t)},1629:(module,__unused_webpack_exports,__webpack_require__)=>{var __dirname="/",process=__webpack_require__(2530),OpenJPEG=function(Module){var Module;Module=Module||{},Module||(Module=(void 0!==OpenJPEG?OpenJPEG:null)||{});var moduleOverrides={};for(var key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER,ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print||(Module.print=function(e){process.stdout.write(e+"\n")}),Module.printErr||(Module.printErr=function(e){process.stderr.write(e+"\n")});var nodeFS=__webpack_require__(7829),nodePath=__webpack_require__(1195);Module.read=function(e,t){e=nodePath.normalize(e);var n=nodeFS.readFileSync(e);return n||e==nodePath.resolve(e)||(e=path.join(__dirname,"..","src",e),n=nodeFS.readFileSync(e)),n&&!t&&(n=n.toString()),n},Module.readBinary=function(e){var t=Module.read(e,!0);return t.buffer||(t=new Uint8Array(t)),assert(t.buffer),t},Module.load=function(e){globalEval(read(e))},Module.thisProgram||(process.argv.length>1?Module.thisProgram=process.argv[1].replace(/\\/g,"/"):Module.thisProgram="unknown-program"),Module.arguments=process.argv.slice(2),module.exports=Module,process.on("uncaughtException",(function(e){if(!(e instanceof ExitStatus))throw e})),Module.inspect=function(){return"[Emscripten Module object]"}}else if(ENVIRONMENT_IS_SHELL)Module.print||(Module.print=print),"undefined"!=typeof printErr&&(Module.printErr=printErr),"undefined"!=typeof read?Module.read=read:Module.read=function(){throw"no read() available (jsc?)"},Module.readBinary=function(e){if("function"==typeof readbuffer)return new Uint8Array(readbuffer(e));var t=read(e,"binary");return assert("object"==typeof t),t},"undefined"!=typeof scriptArgs?Module.arguments=scriptArgs:void 0!==arguments&&(Module.arguments=arguments);else{if(!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER)throw"Unknown runtime environment. Where are we?";if(Module.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},void 0!==arguments&&(Module.arguments=arguments),"undefined"!=typeof console)Module.print||(Module.print=function(e){console.log(e)}),Module.printErr||(Module.printErr=function(e){console.log(e)});else{var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&"undefined"!=typeof dump?function(e){dump(e)}:function(e){})}ENVIRONMENT_IS_WORKER&&(Module.load=importScripts),void 0===Module.setWindowTitle&&(Module.setWindowTitle=function(e){document.title=e})}function globalEval(e){eval.call(null,e)}for(var key in!Module.load&&Module.read&&(Module.load=function(e){globalEval(Module.read(e))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.thisProgram||(Module.thisProgram="./this.program"),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun=[],Module.postRun=[],moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);var Runtime={setTempRet0:function(e){tempRet0=e},getTempRet0:function(){return tempRet0},stackSave:function(){return STACKTOP},stackRestore:function(e){STACKTOP=e},getNativeTypeSize:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return Runtime.QUANTUM_SIZE;if("i"===e[0]){var t=parseInt(e.substr(1));return assert(t%8==0),t/8}return 0}},getNativeFieldSize:function(e){return Math.max(Runtime.getNativeTypeSize(e),Runtime.QUANTUM_SIZE)},STACK_ALIGN:16,prepVararg:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},getAlignSize:function(e,t,n){return n||"i64"!=e&&"double"!=e?e?Math.min(t||(e?Runtime.getNativeFieldSize(e):0),Runtime.QUANTUM_SIZE):Math.min(t,8):8},dynCall:function(e,t,n){return n&&n.length?(n.splice||(n=Array.prototype.slice.call(n)),n.splice(0,0,t),Module["dynCall_"+e].apply(null,n)):Module["dynCall_"+e].call(null,t)},functionPointers:[],addFunction:function(e){for(var t=0;t<Runtime.functionPointers.length;t++)if(!Runtime.functionPointers[t])return Runtime.functionPointers[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},removeFunction:function(e){Runtime.functionPointers[(e-2)/2]=null},warnOnce:function(e){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[e]||(Runtime.warnOnce.shown[e]=1,Module.printErr(e))},funcWrappers:{},getFuncWrapper:function(e,t){assert(t),Runtime.funcWrappers[t]||(Runtime.funcWrappers[t]={});var n=Runtime.funcWrappers[t];return n[e]||(n[e]=function(){return Runtime.dynCall(t,e,arguments)}),n[e]},getCompilerSetting:function(e){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},stackAlloc:function(e){var t=STACKTOP;return STACKTOP=(STACKTOP=STACKTOP+e|0)+15&-16,t},staticAlloc:function(e){var t=STATICTOP;return STATICTOP=(STATICTOP=STATICTOP+e|0)+15&-16,t},dynamicAlloc:function(e){var t=DYNAMICTOP;if((DYNAMICTOP=(DYNAMICTOP=DYNAMICTOP+e|0)+15&-16)>=TOTAL_MEMORY&&!enlargeMemory())return DYNAMICTOP=t,0;return t},alignMemory:function(e,t){return e=Math.ceil(e/(t||16))*(t||16)},makeBigInt:function(e,t,n){return n?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module.Runtime=Runtime;var __THREW__=0,ABORT=!1,EXITSTATUS=0,undef=0,tempValue,tempInt,tempBigInt,tempInt2,tempBigInt2,tempPair,tempBigIntI,tempBigIntR,tempBigIntS,tempBigIntP,tempBigIntD,tempDouble,tempFloat,tempI64,tempI64b,tempRet0,tempRet1,tempRet2,tempRet3,tempRet4,tempRet5,tempRet6,tempRet7,tempRet8,tempRet9;function assert(e,t){e||abort("Assertion failed: "+t)}var globalScope=this,cwrap,ccall;function getCFunc(ident){var func=Module["_"+ident];if(!func)try{func=eval("_"+ident)}catch(e){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}function setValue(e,t,n,r){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":HEAP8[e>>0]=t;break;case"i16":HEAP16[e>>1]=t;break;case"i32":HEAP32[e>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,+Math_abs(tempDouble)>=1?tempDouble>0?(0|Math_min(+Math_floor(tempDouble/4294967296),4294967295))>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=t;break;case"double":HEAPF64[e>>3]=t;break;default:abort("invalid type for setValue: "+n)}}function getValue(e,t,n){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return HEAP8[e>>0];case"i16":return HEAP16[e>>1];case"i32":case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for setValue: "+t)}return null}(function(){var JSfuncs={stackSave:function(){Runtime.stackSave()},stackRestore:function(){Runtime.stackRestore()},arrayToC:function(e){var t=Runtime.stackAlloc(e.length);return writeArrayToMemory(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&writeStringToMemory(e,t=Runtime.stackAlloc(1+(e.length<<2))),t}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};ccall=function(e,t,n,r,i){var a=getCFunc(e),o=[],s=0;if(r)for(var l=0;l<r.length;l++){var c=toC[n[l]];c?(0===s&&(s=Runtime.stackSave()),o[l]=c(r[l])):o[l]=r[l]}var u=a.apply(null,o);if("string"===t&&(u=Pointer_stringify(u)),0!==s){if(i&&i.async)return void EmterpreterAsync.asyncFinalizers.push((function(){Runtime.stackRestore(s)}));Runtime.stackRestore(s)}return u};var sourceRegex=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/;function parseJSFunc(e){var t=e.toString().match(sourceRegex).slice(1);return{arguments:t[0],body:t[1],returnValue:t[2]}}var JSsource={};for(var fun in JSfuncs)JSfuncs.hasOwnProperty(fun)&&(JSsource[fun]=parseJSFunc(JSfuncs[fun]));cwrap=function cwrap(ident,returnType,argTypes){argTypes=argTypes||[];var cfunc=getCFunc(ident),numericArgs=argTypes.every((function(e){return"number"===e})),numericRet="string"!==returnType;if(numericRet&&numericArgs)return cfunc;var argNames=argTypes.map((function(e,t){return"$"+t})),funcstr="(function("+argNames.join(",")+") {",nargs=argTypes.length;if(!numericArgs){funcstr+="var stack = "+JSsource.stackSave.body+";";for(var i=0;i<nargs;i++){var arg=argNames[i],type=argTypes[i];if("number"!==type){var convertCode=JSsource[type+"ToC"];funcstr+="var "+convertCode.arguments+" = "+arg+";",funcstr+=convertCode.body+";",funcstr+=arg+"="+convertCode.returnValue+";"}}}var cfuncname=parseJSFunc((function(){return cfunc})).returnValue;if(funcstr+="var ret = "+cfuncname+"("+argNames.join(",")+");",!numericRet){var strgfy=parseJSFunc((function(){return Pointer_stringify})).returnValue;funcstr+="ret = "+strgfy+"(ret);"}return numericArgs||(funcstr+=JSsource.stackRestore.body.replace("()","(stack)")+";"),funcstr+="return ret})",eval(funcstr)}})(),Module.ccall=ccall,Module.cwrap=cwrap,Module.setValue=setValue,Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;function allocate(e,t,n,r){var i,a;"number"==typeof e?(i=!0,a=e):(i=!1,a=e.length);var o,s="string"==typeof t?t:null;if(o=n==ALLOC_NONE?r:[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][void 0===n?ALLOC_STATIC:n](Math.max(a,s?1:t.length)),i){var l;r=o;for(assert(0==(3&o)),l=o+(-4&a);r<l;r+=4)HEAP32[r>>2]=0;for(l=o+a;r<l;)HEAP8[r++>>0]=0;return o}if("i8"===s)return e.subarray||e.slice?HEAPU8.set(e,o):HEAPU8.set(new Uint8Array(e),o),o;for(var c,u,h,d=0;d<a;){var f=e[d];"function"==typeof f&&(f=Runtime.getFunctionIndex(f)),0!==(c=s||t[d])?("i64"==c&&(c="i32"),setValue(o+d,f,c),h!==c&&(u=Runtime.getNativeTypeSize(c),h=c),d+=u):d++}return o}function getMemory(e){return staticSealed?void 0!==_sbrk&&!_sbrk.called||!runtimeInitialized?Runtime.dynamicAlloc(e):_malloc(e):Runtime.staticAlloc(e)}function Pointer_stringify(e,t){if(0===t||!e)return"";for(var n,r=0,i=0;r|=n=HEAPU8[e+i>>0],(0!=n||t)&&(i++,!t||i!=t););t||(t=i);var a="";if(r<128){for(var o,s=1024;t>0;)o=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(t,s))),a=a?a+o:o,e+=s,t-=s;return a}return Module.UTF8ToString(e)}function AsciiToString(e){for(var t="";;){var n=HEAP8[e++>>0];if(!n)return t;t+=String.fromCharCode(n)}}function stringToAscii(e,t){return writeAsciiToMemory(e,t,!1)}function UTF8ArrayToString(e,t){for(var n,r,i,a,o,s="";;){if(!(n=e[t++]))return s;if(128&n)if(r=63&e[t++],192!=(224&n))if(i=63&e[t++],224==(240&n)?n=(15&n)<<12|r<<6|i:(a=63&e[t++],240==(248&n)?n=(7&n)<<18|r<<12|i<<6|a:(o=63&e[t++],n=248==(252&n)?(3&n)<<24|r<<18|i<<12|a<<6|o:(1&n)<<30|r<<24|i<<18|a<<12|o<<6|63&e[t++])),n<65536)s+=String.fromCharCode(n);else{var l=n-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}else s+=String.fromCharCode((31&n)<<6|r);else s+=String.fromCharCode(n)}}function UTF8ToString(e){return UTF8ArrayToString(HEAPU8,e)}function stringToUTF8Array(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else if(s<=2097151){if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}else if(s<=67108863){if(n+4>=a)break;t[n++]=248|s>>24,t[n++]=128|s>>18&63,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+5>=a)break;t[n++]=252|s>>30,t[n++]=128|s>>24&63,t[n++]=128|s>>18&63,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function stringToUTF8(e,t,n){return stringToUTF8Array(e,HEAPU8,t,n)}function lengthBytesUTF8(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:r<=2097151?4:r<=67108863?5:6}return t}function UTF16ToString(e){for(var t=0,n="";;){var r=HEAP16[e+2*t>>1];if(0==r)return n;++t,n+=String.fromCharCode(r)}}function stringToUTF16(e,t,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var r=t,i=(n-=2)<2*e.length?n/2:e.length,a=0;a<i;++a){var o=e.charCodeAt(a);HEAP16[t>>1]=o,t+=2}return HEAP16[t>>1]=0,t-r}function lengthBytesUTF16(e){return 2*e.length}function UTF32ToString(e){for(var t=0,n="";;){var r=HEAP32[e+4*t>>2];if(0==r)return n;if(++t,r>=65536){var i=r-65536;n+=String.fromCharCode(55296|i>>10,56320|1023&i)}else n+=String.fromCharCode(r)}}function stringToUTF32(e,t,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var r=t,i=r+n-4,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a);if(HEAP32[t>>2]=o,(t+=4)+4>i)break}return HEAP32[t>>2]=0,t-r}function lengthBytesUTF32(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&++n,t+=4}return t}function demangle(e){var t=!!Module.___cxa_demangle;if(t)try{var n=_malloc(e.length);writeStringToMemory(e.substr(1),n);var r=_malloc(4),i=Module.___cxa_demangle(n,0,0,r);if(0===getValue(r,"i32")&&i)return Pointer_stringify(i)}catch(e){}finally{n&&_free(n),r&&_free(r),i&&_free(i)}var a=3,o={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},s=[],l=!0;var c=e;try{if("Object._main"==e||"_main"==e)return"main()";if("number"==typeof e&&(e=Pointer_stringify(e)),"_"!==e[0])return e;if("_"!==e[1])return e;if("Z"!==e[2])return e;switch(e[3]){case"n":return"operator new()";case"d":return"operator delete()"}c=function t(n,r,i){r=r||1/0;var c,u="",h=[];if("N"===e[a]){if(c=function(){a++,"K"===e[a]&&a++;for(var t=[];"E"!==e[a];)if("S"!==e[a])if("C"!==e[a]){var n=parseInt(e.substr(a)),r=n.toString().length;if(!n||!r){a--;break}var i=e.substr(a+r,n);t.push(i),s.push(i),a+=r+n}else t.push(t[t.length-1]),a+=2;else{a++;var o=e.indexOf("_",a),l=e.substring(a,o)||0;t.push(s[l]||"?"),a=o+1}return a++,t}().join("::"),0==--r)return n?[c]:c}else if(("K"===e[a]||l&&"L"===e[a])&&a++,m=parseInt(e.substr(a))){var d=m.toString().length;c=e.substr(a+d,m),a+=d+m}if(l=!1,"I"===e[a]){a++;var f=t(!0);u+=t(!0,1,!0)[0]+" "+c+"<"+f.join(", ")+">"}else u=c;e:for(;a<e.length&&r-- >0;){var p=e[a++];if(p in o)h.push(o[p]);else switch(p){case"P":h.push(t(!0,1,!0)[0]+"*");break;case"R":h.push(t(!0,1,!0)[0]+"&");break;case"L":a++;var m=e.indexOf("E",a)-a;h.push(e.substr(a,m)),a+=m+2;break;case"A":if(m=parseInt(e.substr(a)),a+=m.toString().length,"_"!==e[a])throw"?";a++,h.push(t(!0,1,!0)[0]+" ["+m+"]");break;case"E":break e;default:u+="?"+p;break e}}return i||1!==h.length||"void"!==h[0]||(h=[]),n?(u&&h.push(u+"?"),h):u+"("+h.join(", ")+")"}()}catch(e){c+="?"}return c.indexOf("?")>=0&&!t&&Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),c}function demangleAll(e){return e.replace(/__Z[\w\d_]+/g,(function(e){var t=demangle(e);return e===t?e:e+" ["+t+"]"}))}function jsStackTrace(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE,Module.allocate=allocate,Module.getMemory=getMemory,Module.Pointer_stringify=Pointer_stringify,Module.AsciiToString=AsciiToString,Module.stringToAscii=stringToAscii,Module.UTF8ArrayToString=UTF8ArrayToString,Module.UTF8ToString=UTF8ToString,Module.stringToUTF8Array=stringToUTF8Array,Module.stringToUTF8=stringToUTF8,Module.lengthBytesUTF8=lengthBytesUTF8,Module.UTF16ToString=UTF16ToString,Module.stringToUTF16=stringToUTF16,Module.lengthBytesUTF16=lengthBytesUTF16,Module.UTF32ToString=UTF32ToString,Module.stringToUTF32=stringToUTF32,Module.lengthBytesUTF32=lengthBytesUTF32,Module.stackTrace=stackTrace;var PAGE_SIZE=4096,HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function alignMemoryPage(e){return e%4096>0&&(e+=4096-e%4096),e}var STATIC_BASE=0,STATICTOP=0,staticSealed=!1,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0,byteLength;function enlargeMemory(){var e=Math.pow(2,31);if(DYNAMICTOP>=e)return!1;for(;TOTAL_MEMORY<=DYNAMICTOP;)if(TOTAL_MEMORY<e/2)TOTAL_MEMORY=alignMemoryPage(2*TOTAL_MEMORY);else{var t=TOTAL_MEMORY;if((TOTAL_MEMORY=alignMemoryPage((3*TOTAL_MEMORY+e)/4))<=t)return!1}if((TOTAL_MEMORY=Math.max(TOTAL_MEMORY,16777216))>=e)return!1;try{if(ArrayBuffer.transfer)buffer=ArrayBuffer.transfer(buffer,TOTAL_MEMORY);else{var n=HEAP8;buffer=new ArrayBuffer(TOTAL_MEMORY)}}catch(e){return!1}return!!_emscripten_replace_memory(buffer)&&(Module.buffer=buffer,Module.HEAP8=HEAP8=new Int8Array(buffer),Module.HEAP16=HEAP16=new Int16Array(buffer),Module.HEAP32=HEAP32=new Int32Array(buffer),Module.HEAPU8=HEAPU8=new Uint8Array(buffer),Module.HEAPU16=HEAPU16=new Uint16Array(buffer),Module.HEAPU32=HEAPU32=new Uint32Array(buffer),Module.HEAPF32=HEAPF32=new Float32Array(buffer),Module.HEAPF64=HEAPF64=new Float64Array(buffer),ArrayBuffer.transfer||HEAP8.set(n),!0)}try{byteLength=Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get),byteLength(new ArrayBuffer(4))}catch(e){byteLength=function(e){return e.byteLength}}for(var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216,totalMemory=65536,buffer;totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK;)totalMemory<16777216?totalMemory*=2:totalMemory+=16777216;function callRuntimeCallbacks(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?Runtime.dynCall("v",n):Runtime.dynCall("vi",n,[t.arg]):n(void 0===t.arg?null:t.arg)}else t()}}totalMemory=Math.max(totalMemory,16777216),totalMemory!==TOTAL_MEMORY&&(TOTAL_MEMORY=totalMemory),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(TOTAL_MEMORY),HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(255===HEAPU8[0]&&0===HEAPU8[3],"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.buffer=buffer,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1;function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__),runtimeExited=!0}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPreMain(e){__ATMAIN__.unshift(e)}function addOnExit(e){__ATEXIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}function intArrayFromString(e,t,n){var r=n>0?n:lengthBytesUTF8(e)+1,i=new Array(r),a=stringToUTF8Array(e,i,0,i.length);return t&&(i.length=a),i}function intArrayToString(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];r>255&&(r&=255),t.push(String.fromCharCode(r))}return t.join("")}function writeStringToMemory(e,t,n){for(var r=intArrayFromString(e,n),i=0;i<r.length;){var a=r[i];HEAP8[t+i>>0]=a,i+=1}}function writeArrayToMemory(e,t){for(var n=0;n<e.length;n++)HEAP8[t++>>0]=e[n]}function writeAsciiToMemory(e,t,n){for(var r=0;r<e.length;++r)HEAP8[t++>>0]=e.charCodeAt(r);n||(HEAP8[t>>0]=0)}function unSign(e,t,n){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function reSign(e,t,n){if(e<=0)return e;var r=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=r&&(t<=32||e>r)&&(e=-2*r+e),e}Module.addOnPreRun=addOnPreRun,Module.addOnInit=addOnInit,Module.addOnPreMain=addOnPreMain,Module.addOnExit=addOnExit,Module.addOnPostRun=addOnPostRun,Module.intArrayFromString=intArrayFromString,Module.intArrayToString=intArrayToString,Module.writeStringToMemory=writeStringToMemory,Module.writeArrayToMemory=writeArrayToMemory,Module.writeAsciiToMemory=writeAsciiToMemory,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16)*r+n*(t>>>16)<<16)|0}),Math.imul=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;t<32;t++)if(e&1<<31-t)return t;return 32}),Math.clz32=Math.clz32;var Math_abs=Math.abs,Math_cos=Math.cos,Math_sin=Math.sin,Math_tan=Math.tan,Math_acos=Math.acos,Math_asin=Math.asin,Math_atan=Math.atan,Math_atan2=Math.atan2,Math_exp=Math.exp,Math_log=Math.log,Math_sqrt=Math.sqrt,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_imul=Math.imul,Math_fround=Math.fround,Math_min=Math.min,Math_clz32=Math.clz32,runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}Module.addRunDependency=addRunDependency,Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={};var memoryInitializer=null,ASM_CONSTS=[];STATIC_BASE=8,STATICTOP=STATIC_BASE+25664,__ATINIT__.push(),allocate([131,192,202,161,69,182,251,63,127,251,58,112,206,136,234,63,127,251,58,112,206,136,234,63,131,192,202,161,69,182,251,63,225,122,20,174,71,225,252,63,94,186,73,12,2,43,249,63,0,0,0,0,0,0,240,63,0,0,0,0,0,0,248,63,0,0,0,0,0,0,6,64,0,0,0,0,0,128,21,64,92,143,194,245,40,92,37,64,215,163,112,61,10,87,53,64,246,40,92,143,194,85,69,64,133,235,81,184,30,85,85,64,102,102,102,102,102,86,101,64,205,204,204,204,204,84,117,64,207,247,83,227,165,155,240,63,70,182,243,253,212,120,249,63,39,49,8,172,28,90,7,64,29,90,100,59,223,207,22,64,41,92,143,194,245,168,38,64,164,112,61,10,215,163,54,64,0,0,0,0,0,160,70,64,31,133,235,81,184,158,86,64,205,204,204,204,204,156,102,64,0,0,0,0,0,0,0,0,207,247,83,227,165,155,240,63,70,182,243,253,212,120,249,63,39,49,8,172,28,90,7,64,29,90,100,59,223,207,22,64,41,92,143,194,245,168,38,64,164,112,61,10,215,163,54,64,0,0,0,0,0,160,70,64,31,133,235,81,184,158,86,64,205,204,204,204,204,156,102,64,0,0,0,0,0,0,0,0,173,250,92,109,197,254,230,63,86,125,174,182,98,127,237,63,199,75,55,137,65,96,249,63,242,210,77,98,16,88,8,64,250,126,106,188,116,19,24,64,133,235,81,184,30,5,40,64,0,0,0,0,0,0,56,64,92,143,194,245,40,252,71,64,236,81,184,30,133,251,87,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240,63,113,61,10,215,163,112,255,63,104,145,237,124,63,181,16,64,117,147,24,4,86,206,32,64,102,102,102,102,102,230,48,64,236,81,184,30,133,235,64,64,92,143,194,245,40,236,80,64,154,153,153,153,153,233,96,64,154,153,153,153,153,233,112,64,51,51,51,51,51,231,128,64,147,24,4,86,14,45,0,64,182,243,253,212,120,233,15,64,246,40,92,143,194,181,32,64,10,215,163,112,61,10,49,64,195,245,40,92,143,34,65,64,184,30,133,235,81,40,81,64,154,153,153,153,153,41,97,64,154,153,153,153,153,41,113,64,0,0,0,0,0,40,129,64,0,0,0,0,0,0,0,0,147,24,4,86,14,45,0,64,182,243,253,212,120,233,15,64,246,40,92,143,194,181,32,64,10,215,163,112,61,10,49,64,195,245,40,92,143,34,65,64,184,30,133,235,81,40,81,64,154,153,153,153,153,41,97,64,154,153,153,153,153,41,113,64,0,0,0,0,0,40,129,64,0,0,0,0,0,0,0,0,164,112,61,10,215,163,0,64,236,81,184,30,133,235,14,64,119,190,159,26,47,157,32,64,174,71,225,122,20,46,49,64,123,20,174,71,225,90,65,64,246,40,92,143,194,101,81,64,154,153,153,153,153,105,97,64,154,153,153,153,153,105,113,64,154,153,153,153,153,105,129,64,0,0,0,0,0,0,0,0,4,0,0,0,67,80,82,76,0,0,0,0,0,0,0,0,76,82,67,80,0,0,0,0,3,0,0,0,80,67,82,76,0,0,0,0,1,0,0,0,82,76,67,80,0,0,0,0,2,0,0,0,82,80,67,76,0,0,0,0,255,255,255,255,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,3,0,0,0,4,0,0,0,144,255,0,0,12,0,0,0,1,0,0,0,82,255,0,0,20,0,0,0,2,0,0,0,83,255,0,0,20,0,0,0,3,0,0,0,94,255,0,0,20,0,0,0,4,0,0,0,92,255,0,0,20,0,0,0,5,0,0,0,93,255,0,0,20,0,0,0,6,0,0,0,95,255,0,0,20,0,0,0,7,0,0,0,81,255,0,0,2,0,0,0,8,0,0,0,85,255,0,0,4,0,0,0,9,0,0,0,87,255,0,0,4,0,0,0,10,0,0,0,88,255,0,0,16,0,0,0,11,0,0,0,96,255,0,0,4,0,0,0,12,0,0,0,97,255,0,0,16,0,0,0,13,0,0,0,145,255,0,0,0,0,0,0,0,0,0,0,99,255,0,0,4,0,0,0,14,0,0,0,100,255,0,0,20,0,0,0,15,0,0,0,116,255,0,0,20,0,0,0,16,0,0,0,120,255,0,0,4,0,0,0,17,0,0,0,117,255,0,0,20,0,0,0,18,0,0,0,119,255,0,0,20,0,0,0,19,0,0,0,0,0,0,0,20,0,0,0,0,0,0,0,2,0,0,0,4,0,0,0,4,0,0,0,8,0,0,0,5,0,0,0,6,0,0,0,7,0,0,0,8,0,0,0,9,0,0,0,10,0,0,0,11,0,0,0,12,0,0,0,32,32,80,106,20,0,0,0,112,121,116,102,21,0,0,0,104,50,112,106,22,0,0,0,114,100,104,105,23,0,0,0,114,108,111,99,24,0,0,0,99,99,112,98,25,0,0,0,114,108,99,112,26,0,0,0,112,97,109,99,27,0,0,0,102,101,100,99,28,0,0,0,1,86,0,0,0,0,0,0,164,4,0,0,180,4,0,0,1,86,0,0,1,0,0,0,180,4,0,0,164,4,0,0,1,52,0,0,0,0,0,0,196,4,0,0,68,5,0,0,1,52,0,0,1,0,0,0,212,4,0,0,84,5,0,0,1,24,0,0,0,0,0,0,228,4,0,0,164,5,0,0,1,24,0,0,1,0,0,0,244,4,0,0,180,5,0,0,193,10,0,0,0,0,0,0,4,5,0,0,4,6,0,0,193,10,0,0,1,0,0,0,20,5,0,0,20,6,0,0,33,5,0,0,0,0,0,0,36,5,0,0,36,8,0,0,33,5,0,0,1,0,0,0,52,5,0,0,52,8,0,0,33,2,0,0,0,0,0,0,68,9,0,0,164,8,0,0,33,2,0,0,1,0,0,0,84,9,0,0,180,8,0,0,1,86,0,0,0,0,0,0,100,5,0,0,84,5,0,0,1,86,0,0,1,0,0,0,116,5,0,0,68,5,0,0,1,84,0,0,0,0,0,0,132,5,0,0,68,6,0,0,1,84,0,0,1,0,0,0,148,5,0,0,84,6,0,0,1,72,0,0,0,0,0,0,164,5,0,0,68,6,0,0,1,72,0,0,1,0,0,0,180,5,0,0,84,6,0,0,1,56,0,0,0,0,0,0,196,5,0,0,68,6,0,0,1,56,0,0,1,0,0,0,212,5,0,0,84,6,0,0,1,48,0,0,0,0,0,0,228,5,0,0,164,6,0,0,1,48,0,0,1,0,0,0,244,5,0,0,180,6,0,0,1,36,0,0,0,0,0,0,4,6,0,0,196,6,0,0,1,36,0,0,1,0,0,0,20,6,0,0,212,6,0,0,1,28,0,0,0,0,0,0,36,6,0,0,4,7,0,0,1,28,0,0,1,0,0,0,52,6,0,0,20,7,0,0,1,22,0,0,0,0,0,0,36,8,0,0,36,7,0,0,1,22,0,0,1,0,0,0,52,8,0,0,52,7,0,0,1,86,0,0,0,0,0,0,100,6,0,0,84,6,0,0,1,86,0,0,1,0,0,0,116,6,0,0,68,6,0,0,1,84,0,0,0,0,0,0,132,6,0,0,68,6,0,0,1,84,0,0,1,0,0,0,148,6,0,0,84,6,0,0,1,81,0,0,0,0,0,0,164,6,0,0,100,6,0,0,1,81,0,0,1,0,0,0,180,6,0,0,116,6,0,0,1,72,0,0,0,0,0,0,196,6,0,0,132,6,0,0,1,72,0,0,1,0,0,0,212,6,0,0,148,6,0,0,1,56,0,0,0,0,0,0,228,6,0,0,164,6,0,0,1,56,0,0,1,0,0,0,244,6,0,0,180,6,0,0,1,52,0,0,0,0,0,0,4,7,0,0,196,6,0,0,1,52,0,0,1,0,0,0,20,7,0,0,212,6,0,0,1,48,0,0,0,0,0,0,36,7,0,0,228,6,0,0,1,48,0,0,1,0,0,0,52,7,0,0,244,6,0,0,1,40,0,0,0,0,0,0,68,7,0,0,228,6,0,0,1,40,0,0,1,0,0,0,84,7,0,0,244,6,0,0,1,36,0,0,0,0,0,0,100,7,0,0,4,7,0,0,1,36,0,0,1,0,0,0,116,7,0,0,20,7,0,0,1,34,0,0,0,0,0,0,132,7,0,0,36,7,0,0,1,34,0,0,1,0,0,0,148,7,0,0,52,7,0,0,1,28,0,0,0,0,0,0,164,7,0,0,68,7,0,0,1,28,0,0,1,0,0,0,180,7,0,0,84,7,0,0,1,24,0,0,0,0,0,0,196,7,0,0,100,7,0,0,1,24,0,0,1,0,0,0,212,7,0,0,116,7,0,0,1,22,0,0,0,0,0,0,228,7,0,0,132,7,0,0,1,22,0,0,1,0,0,0,244,7,0,0,148,7,0,0,1,20,0,0,0,0,0,0,4,8,0,0,164,7,0,0,1,20,0,0,1,0,0,0,20,8,0,0,180,7,0,0,1,18,0,0,0,0,0,0,36,8,0,0,196,7,0,0,1,18,0,0,1,0,0,0,52,8,0,0,212,7,0,0,1,17,0,0,0,0,0,0,68,8,0,0,228,7,0,0,1,17,0,0,1,0,0,0,84,8,0,0,244,7,0,0,193,10,0,0,0,0,0,0,100,8,0,0,4,8,0,0,193,10,0,0,1,0,0,0,116,8,0,0,20,8,0,0,193,9,0,0,0,0,0,0,132,8,0,0,36,8,0,0,193,9,0,0,1,0,0,0,148,8,0,0,52,8,0,0,161,8,0,0,0,0,0,0,164,8,0,0,68,8,0,0,161,8,0,0,1,0,0,0,180,8,0,0,84,8,0,0,33,5,0,0,0,0,0,0,196,8,0,0,100,8,0,0,33,5,0,0,1,0,0,0,212,8,0,0,116,8,0,0,65,4,0,0,0,0,0,0,228,8,0,0,132,8,0,0,65,4,0,0,1,0,0,0,244,8,0,0,148,8,0,0,161,2,0,0,0,0,0,0,4,9,0,0,164,8,0,0,161,2,0,0,1,0,0,0,20,9,0,0,180,8,0,0,33,2,0,0,0,0,0,0,36,9,0,0,196,8,0,0,33,2,0,0,1,0,0,0,52,9,0,0,212,8,0,0,65,1,0,0,0,0,0,0,68,9,0,0,228,8,0,0,65,1,0,0,1,0,0,0,84,9,0,0,244,8,0,0,17,1,0,0,0,0,0,0,100,9,0,0,4,9,0,0,17,1,0,0,1,0,0,0,116,9,0,0,20,9,0,0,133,0,0,0,0,0,0,0,132,9,0,0,36,9,0,0,133,0,0,0,1,0,0,0,148,9,0,0,52,9,0,0,73,0,0,0,0,0,0,0,164,9,0,0,68,9,0,0,73,0,0,0,1,0,0,0,180,9,0,0,84,9,0,0,37,0,0,0,0,0,0,0,196,9,0,0,100,9,0,0,37,0,0,0,1,0,0,0,212,9,0,0,116,9,0,0,21,0,0,0,0,0,0,0,228,9,0,0,132,9,0,0,21,0,0,0,1,0,0,0,244,9,0,0,148,9,0,0,9,0,0,0,0,0,0,0,4,10,0,0,164,9,0,0,9,0,0,0,1,0,0,0,20,10,0,0,180,9,0,0,5,0,0,0,0,0,0,0,36,10,0,0,196,9,0,0,5,0,0,0,1,0,0,0,52,10,0,0,212,9,0,0,1,0,0,0,0,0,0,0,36,10,0,0,228,9,0,0,1,0,0,0,1,0,0,0,52,10,0,0,244,9,0,0,1,86,0,0,0,0,0,0,68,10,0,0,68,10,0,0,1,86,0,0,1,0,0,0,84,10,0,0,84,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,11,0,0,12,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,3,0,0,0,38,94,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,64,4,32,0,32,2,128,0,128,8,16,0,16,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,3,128,4,0,6,128,7,0,9,128,10,0,12,128,13,0,15,128,16,0,18,128,19,0,21,128,22,0,24,128,25,0,27,128,28,0,30,128,31,0,33,128,34,0,36,128,37,0,39,128,40,0,42,128,43,0,45,128,46,0,48,128,49,0,51,128,52,0,54,128,55,0,57,128,58,0,60,128,61,0,63,128,64,0,66,128,67,0,69,128,70,0,72,128,73,0,75,128,76,0,78,128,79,0,81,128,82,0,84,128,85,0,87,128,88,0,90,128,91,0,93,128,94,0,96,128,97,0,99,128,100,0,102,128,103,0,105,128,106,0,108,128,109,0,111,128,112,0,114,128,115,0,117,128,118,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,128,0,128,0,0,1,0,1,0,1,128,1,128,1,0,2,0,2,128,2,128,2,0,3,0,3,128,3,0,4,0,4,128,4,0,5,128,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,128,11,0,12,128,12,0,13,0,14,128,14,0,15,0,16,128,16,128,17,0,18,0,19,128,19,128,20,0,21,0,22,0,23,128,23,128,24,128,25,128,26,0,27,0,28,0,29,0,30,0,31,0,32,0,33,0,34,0,35,0,36,0,37,128,38,128,39,128,40,128,41,0,43,0,44,0,45,128,46,128,47,0,49,0,50,128,51,128,52,0,54,0,55,128,56,0,58,0,59,128,60,0,62,128,63,128,64,0,66,128,67,0,69,128,70,0,72,128,73,0,75,128,76,0,78,128,79,128,81,0,83,128,84,0,86,0,88,128,89,0,91,0,93,128,94,128,96,0,98,0,100,128,101,128,103,0,105,0,107,0,109,128,110,128,112,128,114,128,116,0,118,0,120,0,122,0,124,0,126,0,24,128,23,0,23,128,22,0,22,128,21,0,21,128,20,0,20,128,19,0,19,128,18,0,18,128,17,0,17,128,16,0,16,128,15,0,15,128,14,0,14,128,13,0,13,128,12,0,12,128,11,0,11,128,10,0,10,128,9,0,9,128,8,0,8,128,7,0,7,128,6,0,6,128,5,0,5,128,4,0,4,128,3,0,3,128,2,0,2,128,1,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,1,128,1,0,2,128,2,0,3,128,3,0,4,128,4,0,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,0,11,128,11,0,12,128,12,0,13,128,13,0,14,128,14,0,15,128,15,0,16,128,16,0,17,128,17,0,18,128,18,0,19,128,19,0,20,128,20,0,21,128,21,0,22,128,22,0,23,128,23,0,32,0,31,0,30,0,29,0,28,0,27,128,26,128,25,128,24,128,23,0,23,0,22,0,21,128,20,128,19,0,19,0,18,128,17,128,16,0,16,0,15,128,14,0,14,0,13,128,12,0,12,128,11,128,10,0,10,128,9,0,9,128,8,0,8,128,7,0,7,128,6,0,6,128,5,128,5,0,5,128,4,0,4,0,4,128,3,0,3,0,3,128,2,128,2,0,2,0,2,128,1,128,1,0,1,0,1,0,1,128,0,128,0,128,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,128,0,128,0,0,1,0,1,0,1,128,1,128,1,0,2,0,2,128,2,128,2,0,3,0,3,128,3,0,4,0,4,128,4,0,5,128,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,128,11,0,12,128,12,0,13,0,14,128,14,0,15,0,16,128,16,128,17,0,18,0,19,128,19,128,20,0,21,0,22,0,23,128,23,128,24,128,25,128,26,0,27,0,28,0,29,0,30,0,31,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,115,101,116,117,112,32,116,104,101,32,100,101,99,111,100,101,114,0,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,114,101,97,100,32,116,104,101,32,104,101,97,100,101,114,0,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,33,0,91,69,82,82,79,82,93,32,37,115,0,83,116,114,101,97,109,32,114,101,97,99,104,101,100,32,105,116,115,32,101,110,100,32,33,10,0,69,114,114,111,114,32,111,110,32,119,114,105,116,105,110,103,32,115,116,114,101,97,109,33,10,0,83,116,114,101,97,109,32,101,114,114,111,114,33,10,0,50,46,49,46,48,0,67,111,100,101,99,32,112,114,111,118,105,100,101,100,32,116,111,32,116,104,101,32,111,112,106,95,115,101,116,117,112,95,100,101,99,111,100,101,114,32,102,117,110,99,116,105,111,110,32,105,115,32,110,111,116,32,97,32,100,101,99,111,109,112,114,101,115,115,111,114,32,104,97,110,100,108,101,114,46,10,0,67,111,100,101,99,32,112,114,111,118,105,100,101,100,32,116,111,32,116,104,101,32,111,112,106,95,114,101,97,100,95,104,101,97,100,101,114,32,102,117,110,99,116,105,111,110,32,105,115,32,110,111,116,32,97,32,100,101,99,111,109,112,114,101,115,115,111,114,32,104,97,110,100,108,101,114,46,10,0,119,98,0,114,98,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,58,32,37,100,32,110,111,116,32,105,110,32,114,97,110,103,101,32,91,49,44,37,100,93,10,0,68,101,112,114,101,99,97,116,101,100,32,102,105,101,108,100,115,32,99,112,95,99,105,110,101,109,97,32,111,114,32,99,112,95,114,115,105,122,32,97,114,101,32,117,115,101,100,10,80,108,101,97,115,101,32,99,111,110,115,105,100,101,114,32,117,115,105,110,103,32,111,110,108,121,32,116,104,101,32,114,115,105,122,32,102,105,101,108,100,10,83,101,101,32,111,112,101,110,106,112,101,103,46,104,32,100,111,99,117,109,101,110,116,97,116,105,111,110,32,102,111,114,32,109,111,114,101,32,100,101,116,97,105,108,115,10,0,84,104,101,32,100,101,115,105,114,101,100,32,109,97,120,105,109,117,109,32,99,111,100,101,115,116,114,101,97,109,32,115,105,122,101,32,104,97,115,32,108,105,109,105,116,101,100,10,97,116,32,108,101,97,115,116,32,111,110,101,32,111,102,32,116,104,101,32,100,101,115,105,114,101,100,32,113,117,97,108,105,116,121,32,108,97,121,101,114,115,10,0,74,80,69,71,32,50,48,48,48,32,83,99,97,108,97,98,108,101,32,68,105,103,105,116,97,108,32,67,105,110,101,109,97,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,49,32,115,105,110,103,108,101,32,113,117,97,108,105,116,121,32,108,97,121,101,114,45,62,32,78,117,109,98,101,114,32,111,102,32,108,97,121,101,114,115,32,102,111,114,99,101,100,32,116,111,32,49,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,45,62,32,82,97,116,101,32,111,102,32,116,104,101,32,108,97,115,116,32,108,97,121,101,114,32,40,37,51,46,49,102,41,32,119,105,108,108,32,98,101,32,117,115,101,100,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,60,61,32,53,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,53,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,62,61,32,49,32,38,38,32,60,61,32,54,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,49,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,62,61,32,49,32,38,38,32,60,61,32,54,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,54,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,51,48,50,48,56,51,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,65,115,32,110,111,32,114,97,116,101,32,104,97,115,32,98,101,101,110,32,103,105,118,101,110,44,32,116,104,105,115,32,108,105,109,105,116,32,119,105,108,108,32,98,101,32,117,115,101,100,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,51,48,50,48,56,51,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,45,62,32,83,112,101,99,105,102,105,101,100,32,114,97,116,101,32,101,120,99,101,101,100,115,32,116,104,105,115,32,108,105,109,105,116,46,32,82,97,116,101,32,119,105,108,108,32,98,101,32,102,111,114,99,101,100,32,116,111,32,49,51,48,50,48,56,51,32,98,121,116,101,115,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,48,52,49,54,54,54,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,65,115,32,110,111,32,114,97,116,101,32,104,97,115,32,98,101,101,110,32,103,105,118,101,110,44,32,116,104,105,115,32,108,105,109,105,116,32,119,105,108,108,32,98,101,32,117,115,101,100,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,48,52,49,54,54,54,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,45,62,32,83,112,101,99,105,102,105,101,100,32,114,97,116,101,32,101,120,99,101,101,100,115,32,116,104,105,115,32,108,105,109,105,116,46,32,82,97,116,101,32,119,105,108,108,32,98,101,32,102,111,114,99,101,100,32,116,111,32,49,48,52,49,54,54,54,32,98,121,116,101,115,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,51,32,99,111,109,112,111,110,101,110,116,115,45,62,32,78,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,111,102,32,105,110,112,117,116,32,105,109,97,103,101,32,40,37,100,41,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,115,105,103,110,101,100,0,117,110,115,105,103,110,101,100,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,80,114,101,99,105,115,105,111,110,32,111,102,32,101,97,99,104,32,99,111,109,112,111,110,101,110,116,32,115,104,97,108,108,32,98,101,32,49,50,32,98,105,116,115,32,117,110,115,105,103,110,101,100,45,62,32,65,116,32,108,101,97,115,116,32,99,111,109,112,111,110,101,110,116,32,37,100,32,111,102,32,105,110,112,117,116,32,105,109,97,103,101,32,40,37,100,32,98,105,116,115,44,32,37,115,41,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,119,105,100,116,104,32,60,61,32,50,48,52,56,32,97,110,100,32,104,101,105,103,104,116,32,60,61,32,49,48,56,48,10,45,62,32,73,110,112,117,116,32,105,109,97,103,101,32,115,105,122,101,32,37,100,32,120,32,37,100,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,119,105,100,116,104,32,60,61,32,52,48,57,54,32,97,110,100,32,104,101,105,103,104,116,32,60,61,32,50,49,54,48,10,45,62,32,73,109,97,103,101,32,115,105,122,101,32,37,100,32,120,32,37,100,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,52,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,76,111,110,103,32,84,101,114,109,32,83,116,111,114,97,103,101,32,112,114,111,102,105,108,101,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,66,114,111,97,100,99,97,115,116,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,73,77,70,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,97,114,116,45,50,32,112,114,111,102,105,108,101,32,100,101,102,105,110,101,100,10,98,117,116,32,110,111,32,80,97,114,116,45,50,32,101,120,116,101,110,115,105,111,110,32,101,110,97,98,108,101,100,46,10,80,114,111,102,105,108,101,32,115,101,116,32,116,111,32,78,79,78,69,46,10,0,85,110,115,117,112,112,111,114,116,101,100,32,80,97,114,116,45,50,32,101,120,116,101,110,115,105,111,110,32,101,110,97,98,108,101,100,10,80,114,111,102,105,108,101,32,115,101,116,32,116,111,32,78,79,78,69,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,112,121,32,111,102,32,117,115,101,114,32,101,110,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,112,121,32,111,102,32,99,111,109,109,101,110,116,32,115,116,114,105,110,103,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,109,109,101,110,116,32,115,116,114,105,110,103,10,0,37,115,37,115,0,67,114,101,97,116,101,100,32,98,121,32,79,112,101,110,74,80,69,71,32,118,101,114,115,105,111,110,32,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,105,108,101,32,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,99,104,101,99,107,105,110,103,32,116,104,101,32,112,111,99,32,118,97,108,117,101,115,46,10,0,77,105,115,115,105,110,103,32,112,97,99,107,101,116,115,32,112,111,115,115,105,98,108,101,32,108,111,115,115,32,111,102,32,100,97,116,97,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,105,108,101,32,99,111,109,112,111,110,101,110,116,32,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,101,109,112,32,98,117,102,102,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,100,101,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,70,97,105,108,101,100,32,116,111,32,105,110,118,101,114,115,101,32,101,110,99,111,100,101,114,32,77,67,84,32,100,101,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,110,111,114,109,115,32,10,0,70,97,105,108,101,100,32,116,111,32,115,101,116,117,112,32,106,50,107,32,109,99,116,32,101,110,99,111,100,105,110,103,10,0,67,97,110,110,111,116,32,112,101,114,102,111,114,109,32,77,67,84,32,111,110,32,99,111,109,112,111,110,101,110,116,115,32,119,105,116,104,32,100,105,102,102,101,114,101,110,116,32,115,105,122,101,115,46,32,68,105,115,97,98,108,105,110,103,32,77,67,84,46,10,0,83,116,114,101,97,109,32,116,111,111,32,115,104,111,114,116,10,0,73,110,99,111,110,115,105,115,116,101,110,116,32,109,97,114,107,101,114,32,115,105,122,101,10,0,77,97,114,107,101,114,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,32,119,105,116,104,32,105,116,115,32,112,111,115,105,116,105,111,110,10,0,77,97,114,107,101,114,32,115,105,122,101,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,115,116,114,101,97,109,32,108,101,110,103,116,104,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,104,101,97,100,101,114,10,0,78,111,116,32,115,117,114,101,32,104,111,119,32,116,104,97,116,32,104,97,112,112,101,110,101,100,46,10,0,70,97,105,108,32,116,111,32,114,101,97,100,32,116,104,101,32,99,117,114,114,101,110,116,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,32,40,37,35,120,41,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,116,108,32,109,97,114,107,101,114,10,0,84,105,108,101,32,112,97,114,116,32,108,101,110,103,116,104,32,115,105,122,101,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,115,116,114,101,97,109,32,108,101,110,103,116,104,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,79,84,32,109,97,114,107,101,114,10,0,111,112,106,95,106,50,107,95,97,112,112,108,121,95,110,98,95,116,105,108,101,95,112,97,114,116,115,95,99,111,114,114,101,99,116,105,111,110,32,101,114,114,111,114,10,0,78,111,110,32,99,111,110,102,111,114,109,97,110,116,32,99,111,100,101,115,116,114,101,97,109,32,84,80,115,111,116,61,61,84,78,115,111,116,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,80,80,84,32,109,97,114,107,101,114,10,0,70,97,105,108,101,100,32,116,111,32,109,101,114,103,101,32,80,80,84,32,100,97,116,97,10,0,67,97,110,110,111,116,32,100,101,99,111,100,101,32,116,105,108,101,44,32,109,101,109,111,114,121,32,101,114,114,111,114,10,0,72,101,97,100,101,114,32,111,102,32,116,105,108,101,32,37,100,32,47,32,37,100,32,104,97,115,32,98,101,101,110,32,114,101,97,100,46,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,46,10,0,78,111,32,69,79,67,32,109,97,114,107,101,114,46,32,80,111,115,115,105,98,108,121,32,97,32,116,114,117,110,99,97,116,101,100,32,115,116,114,101,97,109,10,0,83,116,114,101,97,109,32,100,111,101,115,32,110,111,116,32,101,110,100,32,119,105,116,104,32,69,79,67,10,0,83,116,114,101,97,109,32,116,111,111,32,115,104,111,114,116,44,32,101,120,112,101,99,116,101,100,32,83,79,84,10,0,78,101,101,100,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,109,97,105,110,32,104,101,97,100,101,114,32,98,101,102,111,114,101,32,98,101,103,105,110,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,114,101,109,97,105,110,105,110,103,32,99,111,100,101,115,116,114,101,97,109,0,78,111,32,100,101,99,111,100,101,100,32,97,114,101,97,32,112,97,114,97,109,101,116,101,114,115,44,32,115,101,116,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,116,111,32,116,104,101,32,119,104,111,108,101,32,105,109,97,103,101,10,0,76,101,102,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,115,105,122,61,37,100,41,46,10,0,76,101,102,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,79,115,105,122,61,37,100,41,46,10,0,85,112,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,115,105,122,61,37,100,41,46,10,0,85,112,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,79,115,105,122,61,37,100,41,46,10,0,82,105,103,104,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,79,115,105,122,61,37,100,41,46,10,0,82,105,103,104,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,115,105,122,61,37,100,41,46,10,0,66,111,116,116,111,109,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,79,115,105,122,61,37,100,41,46,10,0,66,111,116,116,111,109,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,115,105,122,61,37,100,41,46,10,0,83,105,122,101,32,120,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,99,111,109,112,111,110,101,110,116,32,105,109,97,103,101,32,105,115,32,105,110,99,111,114,114,101,99,116,32,40,99,111,109,112,91,37,100,93,46,119,61,37,100,41,46,10,0,83,105,122,101,32,121,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,99,111,109,112,111,110,101,110,116,32,105,109,97,103,101,32,105,115,32,105,110,99,111,114,114,101,99,116,32,40,99,111,109,112,91,37,100,93,46,104,61,37,100,41,46,10,0,83,101,116,116,105,110,103,32,100,101,99,111,100,105,110,103,32,97,114,101,97,32,116,111,32,37,100,44,37,100,44,37,100,44,37,100,10,0,87,114,111,110,103,32,102,108,97,103,10,0,67,111,100,101,115,116,114,101,97,109,32,105,110,102,111,32,102,114,111,109,32,109,97,105,110,32,104,101,97,100,101,114,58,32,123,10,0,9,32,116,120,48,61,37,100,44,32,116,121,48,61,37,100,10,0,9,32,116,100,120,61,37,100,44,32,116,100,121,61,37,100,10,0,9,32,116,119,61,37,100,44,32,116,104,61,37,100,10,0,125,10,0,67,111,100,101,115,116,114,101,97,109,32,105,110,100,101,120,32,102,114,111,109,32,109,97,105,110,32,104,101,97,100,101,114,58,32,123,10,0,9,32,77,97,105,110,32,104,101,97,100,101,114,32,115,116,97,114,116,32,112,111,115,105,116,105,111,110,61,37,108,108,105,10,9,32,77,97,105,110,32,104,101],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE),allocate([97,100,101,114,32,101,110,100,32,112,111,115,105,116,105,111,110,61,37,108,108,105,10,0,9,32,77,97,114,107,101,114,32,108,105,115,116,58,32,123,10,0,9,9,32,116,121,112,101,61,37,35,120,44,32,112,111,115,61,37,108,108,105,44,32,108,101,110,61,37,100,10,0,9,32,125,10,0,9,32,84,105,108,101,32,105,110,100,101,120,58,32,123,10,0,9,9,32,110,98,32,111,102,32,116,105,108,101,45,112,97,114,116,32,105,110,32,116,105,108,101,32,91,37,100,93,61,37,100,10,0,9,9,9,32,116,105,108,101,45,112,97,114,116,91,37,100,93,58,32,115,116,97,114,95,112,111,115,61,37,108,108,105,44,32,101,110,100,95,104,101,97,100,101,114,61,37,108,108,105,44,32,101,110,100,95,112,111,115,61,37,108,108,105,46,10,0,91,68,69,86,93,32,68,117,109,112,32,97,110,32,105,109,97,103,101,95,104,101,97,100,101,114,32,115,116,114,117,99,116,32,123,10,0,73,109,97,103,101,32,105,110,102,111,32,123,10,0,37,115,32,120,48,61,37,100,44,32,121,48,61,37,100,10,0,37,115,32,120,49,61,37,100,44,32,121,49,61,37,100,10,0,37,115,32,110,117,109,99,111,109,112,115,61,37,100,10,0,37,115,9,32,99,111,109,112,111,110,101,110,116,32,37,100,32,123,10,0,37,115,125,10,0,91,68,69,86,93,32,68,117,109,112,32,97,110,32,105,109,97,103,101,95,99,111,109,112,95,104,101,97,100,101,114,32,115,116,114,117,99,116,32,123,10,0,37,115,32,100,120,61,37,100,44,32,100,121,61,37,100,10,0,37,115,32,112,114,101,99,61,37,100,10,0,37,115,32,115,103,110,100,61,37,100,10,0,87,101,32,110,101,101,100,32,97,110,32,105,109,97,103,101,32,112,114,101,118,105,111,117,115,108,121,32,99,114,101,97,116,101,100,46,10,0,84,105,108,101,32,105,110,100,101,120,32,112,114,111,118,105,100,101,100,32,98,121,32,116,104,101,32,117,115,101,114,32,105,115,32,105,110,99,111,114,114,101,99,116,32,37,100,32,40,109,97,120,32,61,32,37,100,41,32,10,0,82,101,115,111,108,117,116,105,111,110,32,102,97,99,116,111,114,32,105,115,32,103,114,101,97,116,101,114,32,116,104,97,110,32,116,104,101,32,109,97,120,105,109,117,109,32,114,101,115,111,108,117,116,105,111,110,32,105,110,32,116,104,101,32,99,111,109,112,111,110,101,110,116,46,10,0,84,104,101,32,103,105,118,101,110,32,116,105,108,101,32,105,110,100,101,120,32,100,111,101,115,32,110,111,116,32,109,97,116,99,104,46,0,116,105,108,101,32,110,117,109,98,101,114,32,37,100,32,47,32,37,100,10,0,69,114,114,111,114,32,97,108,108,111,99,97,116,105,110,103,32,116,105,108,101,32,99,111,109,112,111,110,101,110,116,32,100,97,116,97,46,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,101,110,99,111,100,101,32,97,108,108,32,116,105,108,101,115,10,0,83,105,122,101,32,109,105,115,109,97,116,99,104,32,98,101,116,119,101,101,110,32,116,105,108,101,32,100,97,116,97,32,97,110,100,32,115,101,110,116,32,100,97,116,97,46,0,70,97,105,108,101,100,32,116,111,32,97,108,108,111,99,97,116,101,32,105,109,97,103,101,32,104,101,97,100,101,114,46,0,69,114,114,111,114,32,119,104,105,108,101,32,111,112,106,95,106,50,107,95,112,114,101,95,119,114,105,116,101,95,116,105,108,101,32,119,105,116,104,32,116,105,108,101,32,105,110,100,101,120,32,61,32,37,100,10,0,69,114,114,111,114,32,119,104,105,108,101,32,111,112,106,95,106,50,107,95,112,111,115,116,95,119,114,105,116,101,95,116,105,108,101,32,119,105,116,104,32,116,105,108,101,32,105,110,100,101,120,32,61,32,37,100,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,105,108,101,32,67,111,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,66,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,84,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,67,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,79,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,116,104,101,32,67,79,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,80,79,67,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,84,76,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,81,67,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,83,81,99,100,32,83,81,99,99,32,101,108,101,109,101,110,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,79,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,81,67,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,81,67,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,79,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,67,79,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,104,101,32,83,73,90,32,109,97,114,107,101,114,10,0,78,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,105,115,32,116,111,111,32,104,105,103,104,32,105,110,32,99,111,109,112,97,114,105,115,111,110,32,116,111,32,116,104,101,32,115,105,122,101,32,111,102,32,116,105,108,101,115,10,0,67,97,110,110,111,116,32,101,110,99,111,100,101,32,116,105,108,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,111,110,101,32,116,105,108,101,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,115,101,101,107,32,102,117,110,99,116,105,111,110,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,32,37,100,47,37,100,10,0,84,105,108,101,32,37,100,47,37,100,32,104,97,115,32,98,101,101,110,32,100,101,99,111,100,101,100,46,10,0,73,109,97,103,101,32,100,97,116,97,32,104,97,115,32,98,101,101,110,32,117,112,100,97,116,101,100,32,119,105,116,104,32,116,105,108,101,32,37,100,46,10,10,0,84,105,108,101,32,114,101,97,100,44,32,100,101,99,111,100,101,100,32,97,110,100,32,117,112,100,97,116,101,100,32,105,115,32,110,111,116,32,116,104,101,32,100,101,115,105,114,101,100,32,111,110,101,32,40,37,100,32,118,115,32,37,100,41,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,115,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,32,37,100,47,37,100,10,0,9,32,100,101,102,97,117,108,116,32,116,105,108,101,32,123,10,0,9,9,32,99,115,116,121,61,37,35,120,10,0,9,9,32,112,114,103,61,37,35,120,10,0,9,9,32,110,117,109,108,97,121,101,114,115,61,37,100,10,0,9,9,32,109,99,116,61,37,120,10,0,9,9,32,99,111,109,112,32,37,100,32,123,10,0,9,9,9,32,99,115,116,121,61,37,35,120,10,0,9,9,9,32,110,117,109,114,101,115,111,108,117,116,105,111,110,115,61,37,100,10,0,9,9,9,32,99,98,108,107,119,61,50,94,37,100,10,0,9,9,9,32,99,98,108,107,104,61,50,94,37,100,10,0,9,9,9,32,99,98,108,107,115,116,121,61,37,35,120,10,0,9,9,9,32,113,109,102,98,105,100,61,37,100,10,0,9,9,9,32,112,114,101,99,99,105,110,116,115,105,122,101,32,40,119,44,104,41,61,0,40,37,100,44,37,100,41,32,0,9,9,9,32,113,110,116,115,116,121,61,37,100,10,0,9,9,9,32,110,117,109,103,98,105,116,115,61,37,100,10,0,9,9,9,32,115,116,101,112,115,105,122,101,115,32,40,109,44,101,41,61,0,9,9,9,32,114,111,105,115,104,105,102,116,61,37,100,10,0,9,9,32,125,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,79,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,116,114,97,110,115,102,111,114,109,97,116,105,111,110,32,115,116,97,103,101,115,46,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,67,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,100,97,116,97,32,115,112,97,110,110,105,110,103,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,77,67,67,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,99,111,108,108,101,99,116,105,111,110,115,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,111,116,104,101,114,32,116,104,97,110,32,97,114,114,97,121,32,100,101,99,111,114,114,101,108,97,116,105,111,110,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,119,105,116,104,32,105,110,100,105,120,32,115,104,117,102,102,108,101,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,119,105,116,104,111,117,116,32,115,97,109,101,32,110,117,109,98,101,114,32,111,102,32,105,110,100,105,120,101,115,10,0,67,114,114,111,114,32,114,101,97,100,105,110,103,32,67,66,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,84,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,99,116,32,100,97,116,97,32,119,105,116,104,105,110,32,109,117,108,116,105,112,108,101,32,77,67,84,32,114,101,99,111,114,100,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,77,67,84,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,77,67,84,32,109,97,114,107,101,114,115,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,82,71,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,84,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,84,32,109,97,114,107,101,114,58,32,112,97,99,107,101,116,32,104,101,97,100,101,114,32,104,97,118,101,32,98,101,101,110,32,112,114,101,118,105,111,117,115,108,121,32,102,111,117,110,100,32,105,110,32,116,104,101,32,109,97,105,110,32,104,101,97,100,101,114,32,40,80,80,77,32,109,97,114,107,101,114,41,46,10,0,90,112,112,116,32,37,117,32,97,108,114,101,97,100,121,32,114,101,97,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,80,80,77,32,109,97,114,107,101,114,10,0,90,112,112,109,32,37,117,32,97,108,114,101,97,100,121,32,114,101,97,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,76,84,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,76,77,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,84,76,77,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,32,115,105,122,101,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,32,105,115,32,105,108,108,101,103,97,108,32,45,62,32,37,100,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,32,105,115,32,110,111,116,32,99,111,109,112,97,116,105,98,108,101,32,119,105,116,104,32,116,104,101,32,114,101,109,97,105,110,105,110,103,32,110,117,109,98,101,114,32,111,102,32,112,97,114,97,109,101,116,101,114,115,32,40,32,37,100,32,118,115,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,101,103,97,116,105,118,101,32,111,114,32,122,101,114,111,32,105,109,97,103,101,32,115,105,122,101,32,40,37,100,32,120,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,105,110,118,97,108,105,100,32,116,105,108,101,32,115,105,122,101,32,40,116,100,120,58,32,37,100,44,32,116,100,121,58,32,37,100,41,10,0,80,114,101,118,101,110,116,32,98,117,102,102,101,114,32,111,118,101,114,102,108,111,119,32,40,120,49,58,32,37,100,44,32,121,49,58,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,105,108,108,101,103,97,108,32,116,105,108,101,32,111,102,102,115,101,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,83,73,90,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,118,97,108,117,101,115,32,102,111,114,32,99,111,109,112,32,61,32,37,100,32,58,32,100,120,61,37,117,32,100,121,61,37,117,10,32,40,115,104,111,117,108,100,32,98,101,32,98,101,116,119,101,101,110,32,49,32,97,110,100,32,50,53,53,32,97,99,99,111,114,100,105,110,103,32,116,104,101,32,74,80,69,71,50,48,48,48,32,110,111,114,109,41,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,115,32,58,32,37,117,32,120,32,37,117,32,40,109,97,120,105,109,117,109,32,102,105,120,101,100,32,98,121,32,106,112,101,103,50,48,48,48,32,110,111,114,109,32,105,115,32,54,53,53,51,53,32,116,105,108,101,115,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,79,67,32,109,97,114,107,101,114,10,0,84,111,111,32,109,97,110,121,32,80,79,67,115,32,37,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,81,67,67,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,32,110,117,109,98,101,114,58,32,37,100,44,32,114,101,103,97,114,100,105,110,103,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,37,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,81,99,100,32,111,114,32,83,81,99,99,32,101,108,101,109,101,110,116,10,0,87,104,105,108,101,32,114,101,97,100,105,110,103,32,67,67,80,95,81,78,84,83,84,89,32,101,108,101,109,101,110,116,32,105,110,115,105,100,101,32,81,67,68,32,111,114,32,81,67,67,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,44,32,110,117,109,98,101,114,32,111,102,32,115,117,98,98,97,110,100,115,32,40,37,100,41,32,105,115,32,103,114,101,97,116,101,114,32,116,111,32,79,80,74,95,74,50,75,95,77,65,88,66,65,78,68,83,32,40,37,100,41,46,32,83,111,32,119,101,32,108,105,109,105,116,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,101,108,101,109,101,110,116,115,32,115,116,111,114,101,100,32,116,111,32,79,80,74,95,74,50,75,95,77,65,88,66,65,78,68,83,32,40,37,100,41,32,97,110,100,32,115,107,105,112,32,116,104,101,32,114,101,115,116,46,32,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,81,67,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,82,71,78,32,109,97,114,107,101,114,10,0,98,97,100,32,99,111,109,112,111,110,101,110,116,32,110,117,109,98,101,114,32,105,110,32,82,71,78,32,40,37,100,32,119,104,101,110,32,116,104,101,114,101,32,97,114,101,32,111,110,108,121,32,37,100,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,67,32,109,97,114,107,101,114,32,40,98,97,100,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,10,0,73,110,118,97,108,105,100,32,118,97,108,117,101,32,102,111,114,32,110,117,109,114,101,115,111,108,117,116,105,111,110,115,32,58,32,37,100,44,32,109,97,120,32,118,97,108,117,101,32,105,115,32,115,101,116,32,105,110,32,111,112,101,110,106,112,101,103,46,104,32,97,116,32,37,100,10,0,69,114,114,111,114,32,100,101,99,111,100,105,110,103,32,99,111,109,112,111,110,101,110,116,32,37,100,46,10,84,104,101,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,116,111,32,114,101,109,111,118,101,32,105,115,32,104,105,103,104,101,114,32,116,104,97,110,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,111,102,32,116,104,105,115,32,99,111,109,112,111,110,101,110,116,10,77,111,100,105,102,121,32,116,104,101,32,99,112,95,114,101,100,117,99,101,32,112,97,114,97,109,101,116,101,114,46,10,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,44,32,73,110,118,97,108,105,100,32,99,98,108,107,119,47,99,98,108,107,104,32,99,111,109,98,105,110,97,116,105,111,110,10,0,73,110,118,97,108,105,100,32,112,114,101,99,105,110,99,116,32,115,105,122,101,10,0,67,79,68,32,109,97,114,107,101,114,32,97,108,114,101,97,100,121,32,114,101,97,100,46,32,78,111,32,109,111,114,101,32,116,104,97,110,32,111,110,101,32,67,79,68,32,109,97,114,107,101,114,32,112,101,114,32,116,105,108,101,46,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,68,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,110,32,83,99,111,100,32,118,97,108,117,101,32,105,110,32,67,79,68,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,110,32,112,114,111,103,114,101,115,115,105,111,110,32,111,114,100,101,114,32,105,110,32,67,79,68,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,108,97,121,101,114,115,32,105,110,32,67,79,68,32,109,97,114,107,101,114,32,58,32,37,100,32,110,111,116,32,105,110,32,114,97,110,103,101,32,91,49,45,54,53,53,51,53,93,10,0,73,110,118,97,108,105,100,32,116,105,108,101,32,110,117,109,98,101,114,32,37,100,10,0,69,109,112,116,121,32,83,79,84,32,109,97,114,107,101,114,32,100,101,116,101,99,116,101,100,58,32,80,115,111,116,61,37,100,46,10,0,80,115,111,116,32,118,97,108,117,101,32,105,115,32,110,111,116,32,99,111,114,114,101,99,116,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,74,80,69,71,50,48,48,48,32,110,111,114,109,58,32,37,100,46,10,0,80,115,111,116,32,118,97,108,117,101,32,111,102,32,116,104,101,32,99,117,114,114,101,110,116,32,116,105,108,101,45,112,97,114,116,32,105,115,32,101,113,117,97,108,32,116,111,32,122,101,114,111,44,32,119,101,32,97,115,115,117,109,105,110,103,32,105,116,32,105,115,32,116,104,101,32,108,97,115,116,32,116,105,108,101,45,112,97,114,116,32,111,102,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,46,10,0,73,110,32,83,79,84,32,109,97,114,107,101,114,44,32,84,80,83,111,116,32,40,37,100,41,32,105,115,32,110,111,116,32,118,97,108,105,100,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,99,117,114,114,101,110,116,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,45,112,97,114,116,32,40,37,100,41,44,32,103,105,118,105,110,103,32,117,112,10,0,73,110,32,83,79,84,32,109,97,114,107,101,114,44,32,84,80,83,111,116,32,40,37,100,41,32,105,115,32,110,111,116,32,118,97,108,105,100,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,99,117,114,114,101,110,116,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,45,112,97,114,116,32,40,104,101,97,100,101,114,41,32,40,37,100,41,44,32,103,105,118,105,110,103,32,117,112,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,83,79,84,32,109,97,114,107,101,114,46,32,84,105,108,101,32,105,110,100,101,120,32,97,108,108,111,99,97,116,105,111,110,32,102,97,105,108,101,100,10,0,83,116,97,114,116,32,116,111,32,114,101,97,100,32,106,50,107,32,109,97,105,110,32,104,101,97,100,101,114,32,40,37,100,41,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,109,104,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,97,32,83,79,67,32,109,97,114,107,101,114,32,10,0,65,32,109,97,114,107,101,114,32,73,68,32,119,97,115,32,101,120,112,101,99,116,101,100,32,40,48,120,102,102,45,45,41,32,105,110,115,116,101,97,100,32,111,102,32,37,46,56,120,10,0,85,110,107,110,111,119,110,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,32,109,97,114,107,101,114,32,104,97,118,101,32,98,101,101,110,32,100,101,116,101,99,116,101,100,32,97,110,100,32,103,101,110,101,114,97,116,101,100,32,101,114,114,111,114,46,10,0,77,97,114,107,101,114,32,104,97,110,100,108,101,114,32,102,117,110,99,116,105,111,110,32,102,97,105,108,101,100,32,116,111,32,114,101,97,100,32,116,104,101,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,10,0,114,101,113,117,105,114,101,100,32,83,73,90,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,114,101,113,117,105,114,101,100,32,67,79,68,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,114,101,113,117,105,114,101,100,32,81,67,68,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,98,121,116,101,115,32,116,111,32,114,101,97,100,32,78,112,112,109,10,0,67,111,114,114,117,112,116,101,100,32,80,80,77,32,109,97,114,107,101,114,115,10,0,70,97,105,108,101,100,32,116,111,32,109,101,114,103,101,32,80,80,77,32,100,97,116,97,10,0,77,97,105,110,32,104,101,97,100,101,114,32,104,97,115,32,98,101,101,110,32,99,111,114,114,101,99,116,108,121,32,100,101,99,111,100,101,100,46,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,32,105,110,32,116,104,101,32,74,80,50,32,102,105,108,101,10,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,115,112,101,99,105,102,105,101,100,32,119,104,105,108,101,32,115,101,116,116,105,110,103,32,117,112,32,74,80,50,32,101,110,99,111,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,119,104,101,110,32,115,101,116,117,112,32,116,104,101,32,74,80,50,32,101,110,99,111,100,101,114,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,115,112,101,99,105,102,105,101,100,32,98,117,116,32,117,110,107,110,111,119,110,32,101,110,117,109,99,115,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,115,112,101,99,105,102,105,101,100,32,98,117,116,32,110,111,116,32,101,110,111,117,103,104,32,105,109,97,103,101,32,99,111,109,112,111,110,101,110,116,115,32,102,111,114,32,97,110,32,97,117,116,111,109,97,116,105,99,32,99,100,101,102,32,98,111,120,32,99,114,101,97,116,105,111,110,46,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,112,111,115,105,116,105,111,110,32,99,111,110,102,108,105,99,116,115,32,119,105,116,104,32,99,111,108,111,114,32,99,104,97,110,110,101,108,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,77,117,108,116,105,112,108,101,32,97,108,112,104,97,32,99,104,97,110,110,101,108,115,32,115,112,101,99,105,102,105,101,100,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,115,101,116,117,112,32,116,104,101,32,74,80,50,32,101,110,99,111,100,101,114,10,0,74,80,50,32,98,111,120,32,119,104,105,99,104,32,97,114,101,32,97,102,116,101,114,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,110,111,116,32,98,101,32,114,101,97,100,32,98,121,32,116,104,105,115,32,102,117,110,99,116,105,111,110,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,111,108,100,32,74,80,50,32,72,101,97,100,101,114,32,100,97,116,97,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,119,114,105,116,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,102,116,121,112,32,100,97,116,97,10,0,69,114,114,111,114,32,119,104,105,108,101,32,119,114,105,116,105,110,103,32,102,116,121,112,32,100,97,116,97,32,116,111,32,115,116,114,101,97,109,10,0,70,97,105,108,101,100,32,116,111,32,115,101,101,107,32,105,110,32,116,104,101,32,115,116,114,101,97,109,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,106,112,101,103,50,48,48,48,32,102,105,108,101,32,104,101,97,100,101,114,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,115,105,122,101,115,32,104,105,103,104,101,114,32,116,104,97,110,32,50,94,51,50,10,0,98,97,100,32,112,108,97,99,101,100,32,106,112,101,103,32,99,111,100,101,115,116,114,101,97,109,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,111,102,32,117,110,100,101,102,105,110,101,100,32,115,105,122,101,115,10,0,105,110,118,97,108,105,100,32,98,111,120,32,115,105,122,101,32,37,100,32,40,37,120,41,10,0,70,111,117,110,100,32,97,32,109,105,115,112,108,97,99,101,100,32,39,37,99,37,99,37,99,37,99,39,32,98,111,120,32,111,117,116,115,105,100,101,32,106,112,50,104,32,98,111,120,10,0,74,80,69,71,50,48,48,48,32,72,101,97,100,101,114,32,98,111,120,32,110,111,116,32,114,101,97,100,32,121,101,116,44,32,39,37,99,37,99,37,99,37,99,39,32,98,111,120,32,119,105,108,108,32,98,101,32,105,103,110,111,114,101,100,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,115,107,105,112,112,105,110,103,32,74,80,69,71,50,48,48,48,32,98,111,120,44,32,115,116,114,101,97,109,32,101,114,114,111,114,10,0,73,110,118,97,108,105,100,32,98,111,120,32,115,105,122,101,32,37,100,32,102,111,114,32,98,111,120,32,39,37,99,37,99,37,99,37,99,39,46,32,78,101,101,100,32,37,100,32,98,121,116,101,115,44,32,37,100,32,98,121,116,101,115,32,114,101,109,97,105,110,105,110,103,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,106,112,101,103,50,48,48,48,32,98,111,120,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,114,101,97,100,105,110,103,32,74,80,69,71,50,48,48,48,32,98,111,120,44,32,115,116,114,101,97,109,32,101,114,114,111,114,10,0,77,97,108,102,111,114,109,101,100,32,74,80,50,32,102,105,108,101,32,102,111,114,109,97,116,58,32,102,105,114,115,116,32,98,111,120,32,109,117,115,116,32,98,101,32,74,80,69,71,32,50,48,48,48,32,115,105,103,110,97,116,117,114,101,32,98,111,120,10,0,77,97,108,102,111,114,109,101,100,32,74,80,50,32,102,105,108,101,32,102,111,114,109,97,116,58,32,115,101,99,111,110,100,32,98,111,120,32,109,117,115,116,32,98,101,32,102,105,108,101,32,116,121,112,101,32,98,111,120,10,0,73,110,115,117,102,102,105,99,105,101,110,116,32,100,97,116,97,32,102,111,114,32,67,68,69,70,32,98,111,120,46,10,0,78,117,109,98,101,114,32,111,102,32,99,104,97,110,110,101,108,32,100,101,115,99,114,105,112,116,105,111,110,32,105,115,32,101,113,117,97,108,32,116,111,32,122,101,114,111,32,105,110,32,67,68,69,70,32,98,111,120,46,10,0,78,101,101,100,32,116,111,32,114,101,97,100,32,97,32,80,67,76,82,32,98,111,120,32,98,101,102,111,114,101,32,116,104,101,32,67,77,65,80,32,98,111,120,46,10,0,79,110,108,121,32,111,110,101,32,67,77,65,80,32,98,111,120,32,105,115,32,97,108,108,111,119,101,100,46,10,0,73,110,115,117,102,102,105,99,105,101,110,116,32,100,97,116,97,32,102,111,114,32,67,77,65,80,32,98,111,120,46,10,0,73,110,118,97,108,105,100,32,80,67,76,82,32,98,111,120,46,32,82,101,112,111,114,116,115,32,37,100,32,101,110,116,114,105,101,115,10,0,73,110,118,97,108,105,100,32,80,67,76,82,32,98,111,120,46,32,82,101,112,111,114,116,115,32,48,32,112,97,108,101,116,116,101,32,99,111,108,117,109,110,115,10,0,65,32,66,80,67,67,32,104,101,97,100,101,114,32,98,111,120,32,105,115,32,97,118,97,105,108,97,98,108,101,32,97,108,116,104,111,117,103,104,32,66,80,67,32,103,105,118,101,110,32,98,121,32,116,104,101,32,73,72,68,82,32,98,111,120,32,40,37,100,41,32,105,110,100,105,99,97,116,101,32,99,111,109,112,111,110,101,110,116,115,32,98,105,116,32,100,101,112,116,104,32,105,115,32,99,111,110,115,116,97,110,116,10,0,66,97,100,32,66,80,67,67,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,65,32,99,111,110,102,111,114,109,105,110,103,32,74,80,50,32,114,101,97,100,101,114,32,115,104,97,108,108,32,105,103,110,111,114,101,32,97,108,108,32,67,111,108,111,117,114,32,83,112,101,99,105,102,105,99,97,116,105,111,110,32,98,111,120,101,115,32,97,102,116,101,114,32,116,104,101,32,102,105,114,115,116,44,32,115,111,32,119,101,32,105,103,110,111,114,101,32,116,104,105,115,32,111,110,101,46,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,58,32,37,100,41,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,67,73,69,76,97,98,44,32,98,97,100,32,115,105,122,101,58,32,37,100,41,10,0,67,79,76,82,32,66,79,88,32,109,101,116,104,32,118,97,108,117,101,32,105,115,32,110,111,116,32,97,32,114,101,103,117,108,97,114,32,118,97,108,117,101,32,40,37,100,41,44,32,115,111,32,119,101,32,119,105,108,108,32,105,103,110,111,114,101,32,116,104,101,32,101,110,116,105,114,101,32,67,111,108,111,117,114,32,83,112,101,99,105,102,105,99,97,116,105,111,110,32,98,111,120,46,32,10,0,66,97,100,32,105,109,97,103,101,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,105,109,97,103,101,32,104,101,97,100,101,114,32,40,105,104,100,114,41,10,0,74,80,50,32,73,72,68,82,32,98,111,120,58,32,99,111,109,112,114,101,115,115,105,111,110,32,116,121,112,101,32,105,110,100,105,99,97,116,101,32,116,104,97,116,32,116,104,101,32,102,105,108,101,32,105,115,32,110,111,116,32,97,32,99,111,110,102,111,114,109,105,110,103,32,74,80,50,32,102,105,108,101,32,40,37,100,41,32,10,0,84,104,101,32,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,102,105,114,115,116,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,111,102,32,108,101,115,115,32,116,104,97,110,32,56,32,98,121,116,101,115,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,88,76,32,98,111,120,32,111,102,32,108,101,115,115,32,116,104,97,110,32,49,54,32,98,121,116,101,115,10,0,66,111,120,32,108,101,110,103,116,104,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,46,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,58,32,98,111,120,32,108,101,110,103,116,104,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,46,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,58,32,110,111,32,39,105,104,100,114,39,32,98,111,120,46,10,0,84,104,101,32,102,116,121,112,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,115,101,99,111,110,100,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,69,114,114,111,114,32,119,105,116,104,32,70,84,89,80,32,115,105,103,110,97,116,117,114,101,32,66,111,120,32,115,105,122,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,119,105,116,104,32,70,84,89,80,32,66,111,120,10,0,84,104,101,32,115,105,103,110,97,116,117,114,101,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,102,105,114,115,116,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,69,114,114,111,114,32,119,105,116,104,32,74,80,32,115,105,103,110,97,116,117,114,101,32,66,111,120,32,115,105,122,101,10,0,69,114,114,111,114,32,119,105,116,104,32,74,80,32,83,105,103,110,97,116,117,114,101,32,58,32,98,97,100,32,109,97,103,105,99,32,110,117,109,98,101,114,10,0,111,112,106,95,106,112,50,95,97,112,112,108,121,95,99,100,101,102,58,32,99,110,61,37,100,44,32,110,117,109,99,111,109,112,115,61,37,100,10,0,111,112,106,95,106,112,50,95,97,112,112,108,121,95,99,100,101,102,58,32,97,99,110,61,37,100,44,32,110,117,109,99,111,109,112,115,61,37,100,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,32,105,110,100,101,120,32,37,100,32,40,62,61,32,37,100,41,46,10,0,73,110,99,111,109,112,108,101,116,101,32,99,104,97,110,110,101,108,32,100,101,102,105,110,105,116,105,111,110,115,46,10,0,85,110,101,120,112,101,99,116,101,100,32,79,79,77,46,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,47,112,97,108,101,116,116,101,32,105,110,100,101,120,32,102,111,114,32,100,105,114,101,99,116,32,109,97,112,112,105,110,103,32,37,100,46,10,0,67,111,109,112,111,110,101,110,116,32,37,100,32,105,115,32,109,97,112,112,101,100,32,116,119,105,99,101,46,10,0,68,105,114,101,99,116,32,117,115,101,32,97,116,32,35,37,100,32,104,111,119,101,118,101,114,32,112,99,111,108,61,37,100,46,10,0,67,111,109,112,111,110,101,110,116,32,37,100,32,100,111,101,115,110,39,116,32,104,97,118,101,32,97,32,109,97,112,112,105,110,103,46,10,0,67,111,109,112,111,110,101,110,116,32,109,97,112,112,105,110,103,32,115,101,101,109,115,32,119,114,111,110,103,46,32,84,114,121,105,110,103,32,116,111,32,99,111,114,114,101,99,116,46,10,0,84,105,108,101,115,32,100,111,110,39,116,32,97,108,108,32,104,97,118,101,32,116,104,101,32,115,97,109,101,32,100,105,109,101,110,115,105,111,110,46,32,83,107,105,112,32,116,104,101,32,77,67,84,32,115,116,101,112,46,10,0,78,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,40,37,100,41,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,97,32,77,67,84,46,32,83,107,105,112,32,116,104,101,32,77,67,84,32,115,116,101,112,46,10,0,116,105,108,101,115,32,114,101,113,117,105,114,101,32,97,116,32,108,101,97,115,116,32,111,110,101,32,114,101,115,111,108,117,116,105,111,110,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,105,108,101,32,100,97,116,97,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,105,108,101,32,114,101,115,111,108,117,116,105,111,110,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,98,97,110,100,32,112,114,101,99,105,110,116,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,99,117,114,114,101,110,116,32,112,114,101,99,105,110,99,116,32,99,111,100,101,98,108,111,99,107,32,101,108,101,109,101,110,116,10,0,78,111,32,105,110,99,108,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,32,105,109,115,98,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,97,103,45,116,114,101,101,10,0,116,103,116,95,99,114,101,97,116,101,32,116,114,101,101,45,62,110,117,109,110,111,100,101,115,32,61,61,32,48,44,32,110,111,32,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,97,103,45,116,114,101,101,32,110,111,100,101,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,105,110,105,116,105,97,108,105,122,101,32,116,104,101,32,116,97,103,32,116,114,101,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,97,32,110,101,119,32,118,97,108,105,100,97,116,105,111,110,32,112,114,111,99,101,100,117,114,101,10,0,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+10240),allocate([7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,3,3,6,3,6,6,8,3,6,6,8,6,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,9,10,12,13,10,10,13,13,12,13,12,13,13,13,13,13,9,10,12,11,10,9,13,12,12,11,12,11,13,12,13,12,9,10,12,11,10,10,11,11,12,13,9,10,13,13,10,10,9,10,12,13,10,9,11,12,12,11,9,10,13,12,10,9,9,10,12,13,10,9,11,12,12,13,12,13,11,12,11,12,9,10,12,11,10,10,11,11,12,11,12,11,11,11,11,11,9,10,12,11,10,9,13,12,12,13,9,10,11,12,10,9,9,10,12,13,10,10,13,13,12,11,9,10,11,11,10,10,9,10,12,13,10,10,13,13,12,11,9,10,11,11,10,10,9,10,12,11,10,9,13,12,12,13,9,10,11,12,10,9,9,10,12,11,10,10,11,11,12,11,12,11,11,11,11,11,9,10,12,13,10,9,11,12,12,13,12,13,11,12,11,12,9,10,12,13,10,9,11,12,12,11,9,10,13,12,10,9,9,10,12,11,10,10,11,11,12,13,9,10,13,13,10,10,9,10,12,11,10,9,13,12,12,11,12,11,13,12,13,12,9,10,12,13,10,10,13,13,12,13,12,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,1,0,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,1,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,1,1,0,1,1,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,114,101,97,100,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,109,97,120,32,40,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,114,101,97,100,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,99,117,114,114,101,110,116,32,115,105,122,101,32,40,37,100,32,62,32,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,115,107,105,112,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,109,97,120,32,40,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,78,111,116,32,101,110,111,117,103,104,32,115,112,97,99,101,32,102,111,114,32,101,120,112,101,99,116,101,100,32,83,79,80,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,83,79,80,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,115,112,97,99,101,32,102,111,114,32,101,120,112,101,99,116,101,100,32,69,80,72,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,69,80,72,32,109,97,114,107,101,114,10,0,84,33,34,25,13,1,2,3,17,75,28,12,16,4,11,29,18,30,39,104,110,111,112,113,98,32,5,6,15,19,20,21,26,8,22,7,40,36,23,24,9,10,14,27,31,37,35,131,130,125,38,42,43,60,61,62,63,67,71,74,77,88,89,90,91,92,93,94,95,96,97,99,100,101,102,103,105,106,107,108,114,115,116,121,122,123,124,0,73,108,108,101,103,97,108,32,98,121,116,101,32,115,101,113,117,101,110,99,101,0,68,111,109,97,105,110,32,101,114,114,111,114,0,82,101,115,117,108,116,32,110,111,116,32,114,101,112,114,101,115,101,110,116,97,98,108,101,0,78,111,116,32,97,32,116,116,121,0,80,101,114,109,105,115,115,105,111,110,32,100,101,110,105,101,100,0,79,112,101,114,97,116,105,111,110,32,110,111,116,32,112,101,114,109,105,116,116,101,100,0,78,111,32,115,117,99,104,32,102,105,108,101,32,111,114,32,100,105,114,101,99,116,111,114,121,0,78,111,32,115,117,99,104,32,112,114,111,99,101,115,115,0,70,105,108,101,32,101,120,105,115,116,115,0,86,97,108,117,101,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,100,97,116,97,32,116,121,112,101,0,78,111,32,115,112,97,99,101,32,108,101,102,116,32,111,110,32,100,101,118,105,99,101,0,79,117,116,32,111,102,32,109,101,109,111,114,121,0,82,101,115,111,117,114,99,101,32,98,117,115,121,0,73,110,116,101,114,114,117,112,116,101,100,32,115,121,115,116,101,109,32,99,97,108,108,0,82,101,115,111,117,114,99,101,32,116,101,109,112,111,114,97,114,105,108,121,32,117,110,97,118,97,105,108,97,98,108,101,0,73,110,118,97,108,105,100,32,115,101,101,107,0,67,114,111,115,115,45,100,101,118,105,99,101,32,108,105,110,107,0,82,101,97,100,45,111,110,108,121,32,102,105,108,101,32,115,121,115,116,101,109,0,68,105,114,101,99,116,111,114,121,32,110,111,116,32,101,109,112,116,121,0,67,111,110,110,101,99,116,105,111,110,32,114,101,115,101,116,32,98,121,32,112,101,101,114,0,79,112,101,114,97,116,105,111,110,32,116,105,109,101,100,32,111,117,116,0,67,111,110,110,101,99,116,105,111,110,32,114,101,102,117,115,101,100,0,72,111,115,116,32,105,115,32,100,111,119,110,0,72,111,115,116,32,105,115,32,117,110,114,101,97,99,104,97,98,108,101,0,65,100,100,114,101,115,115,32,105,110,32,117,115,101,0,66,114,111,107,101,110,32,112,105,112,101,0,73,47,79,32,101,114,114,111,114,0,78,111,32,115,117,99,104,32,100,101,118,105,99,101,32,111,114,32,97,100,100,114,101,115,115,0,66,108,111,99,107,32,100,101,118,105,99,101,32,114,101,113,117,105,114,101,100,0,78,111,32,115,117,99,104,32,100,101,118,105,99,101,0,78,111,116,32,97,32,100,105,114,101,99,116,111,114,121,0,73,115,32,97,32,100,105,114,101,99,116,111,114,121,0,84,101,120,116,32,102,105,108,101,32,98,117,115,121,0,69,120,101,99,32,102,111,114,109,97,116,32,101,114,114,111,114,0,73,110,118,97,108,105,100,32,97,114,103,117,109,101,110,116,0,65,114,103,117,109,101,110,116,32,108,105,115,116,32,116,111,111,32,108,111,110,103,0,83,121,109,98,111,108,105,99,32,108,105,110,107,32,108,111,111,112,0,70,105,108,101,110,97,109,101,32,116,111,111,32,108,111,110,103,0,84,111,111,32,109,97,110,121,32,111,112,101,110,32,102,105,108,101,115,32,105,110,32,115,121,115,116,101,109,0,78,111,32,102,105,108,101,32,100,101,115,99,114,105,112,116,111,114,115,32,97,118,97,105,108,97,98,108,101,0,66,97,100,32,102,105,108,101,32,100,101,115,99,114,105,112,116,111,114,0,78,111,32,99,104,105,108,100,32,112,114,111,99,101,115,115,0,66,97,100,32,97,100,100,114,101,115,115,0,70,105,108,101,32,116,111,111,32,108,97,114,103,101,0,84,111,111,32,109,97,110,121,32,108,105,110,107,115,0,78,111,32,108,111,99,107,115,32,97,118,97,105,108,97,98,108,101,0,82,101,115,111,117,114,99,101,32,100,101,97,100,108,111,99,107,32,119,111,117,108,100,32,111,99,99,117,114,0,83,116,97,116,101,32,110,111,116,32,114,101,99,111,118,101,114,97,98,108,101,0,80,114,101,118,105,111,117,115,32,111,119,110,101,114,32,100,105,101,100,0,79,112,101,114,97,116,105,111,110,32,99,97,110,99,101,108,101,100,0,70,117,110,99,116,105,111,110,32,110,111,116,32,105,109,112,108,101,109,101,110,116,101,100,0,78,111,32,109,101,115,115,97,103,101,32,111,102,32,100,101,115,105,114,101,100,32,116,121,112,101,0,73,100,101,110,116,105,102,105,101,114,32,114,101,109,111,118,101,100,0,68,101,118,105,99,101,32,110,111,116,32,97,32,115,116,114,101,97,109,0,78,111,32,100,97,116,97,32,97,118,97,105,108,97,98,108,101,0,68,101,118,105,99,101,32,116,105,109,101,111,117,116,0,79,117,116,32,111,102,32,115,116,114,101,97,109,115,32,114,101,115,111,117,114,99,101,115,0,76,105,110,107,32,104,97,115,32,98,101,101,110,32,115,101,118,101,114,101,100,0,80,114,111,116,111,99,111,108,32,101,114,114,111,114,0,66,97,100,32,109,101,115,115,97,103,101,0,70,105,108,101,32,100,101,115,99,114,105,112,116,111,114,32,105,110,32,98,97,100,32,115,116,97,116,101,0,78,111,116,32,97,32,115,111,99,107,101,116,0,68,101,115,116,105,110,97,116,105,111,110,32,97,100,100,114,101,115,115,32,114,101,113,117,105,114,101,100,0,77,101,115,115,97,103,101,32,116,111,111,32,108,97,114,103,101,0,80,114,111,116,111,99,111,108,32,119,114,111,110,103,32,116,121,112,101,32,102,111,114,32,115,111,99,107,101,116,0,80,114,111,116,111,99,111,108,32,110,111,116,32,97,118,97,105,108,97,98,108,101,0,80,114,111,116,111,99,111,108,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,83,111,99,107,101,116,32,116,121,112,101,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,78,111,116,32,115,117,112,112,111,114,116,101,100,0,80,114,111,116,111,99,111,108,32,102,97,109,105,108,121,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,65,100,100,114,101,115,115,32,102,97,109,105,108,121,32,110,111,116,32,115,117,112,112,111,114,116,101,100,32,98,121,32,112,114,111,116,111,99,111,108,0,65,100,100,114,101,115,115,32,110,111,116,32,97,118,97,105,108,97,98,108,101,0,78,101,116,119,111,114,107,32,105,115,32,100,111,119,110,0,78,101,116,119,111,114,107,32,117,110,114,101,97,99,104,97,98,108,101,0,67,111,110,110,101,99,116,105,111,110,32,114,101,115,101,116,32,98,121,32,110,101,116,119,111,114,107,0,67,111,110,110,101,99,116,105,111,110,32,97,98,111,114,116,101,100,0,78,111,32,98,117,102,102,101,114,32,115,112,97,99,101,32,97,118,97,105,108,97,98,108,101,0,83,111,99,107,101,116,32,105,115,32,99,111,110,110,101,99,116,101,100,0,83,111,99,107,101,116,32,110,111,116,32,99,111,110,110,101,99,116,101,100,0,67,97,110,110,111,116,32,115,101,110,100,32,97,102,116,101,114,32,115,111,99,107,101,116,32,115,104,117,116,100,111,119,110,0,79,112,101,114,97,116,105,111,110,32,97,108,114,101,97,100,121,32,105,110,32,112,114,111,103,114,101,115,115,0,79,112,101,114,97,116,105,111,110,32,105,110,32,112,114,111,103,114,101,115,115,0,83,116,97,108,101,32,102,105,108,101,32,104,97,110,100,108,101,0,82,101,109,111,116,101,32,73,47,79,32,101,114,114,111,114,0,81,117,111,116,97,32,101,120,99,101,101,100,101,100,0,78,111,32,109,101,100,105,117,109,32,102,111,117,110,100,0,87,114,111,110,103,32,109,101,100,105,117,109,32,116,121,112,101,0,78,111,32,101,114,114,111,114,32,105,110,102,111,114,109,97,116,105,111,110,0,0,114,119,97],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+20480),allocate([17,0,10,0,17,17,17,0,0,0,0,5,0,0,0,0,0,0,9,0,0,0,0,11,0,0,0,0,0,0,0,0,17,0,15,10,17,17,17,3,10,7,0,1,19,9,11,11,0,0,9,6,11,0,0,11,0,6,17,0,0,0,17,17,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,0,17,0,10,10,17,17,17,0,10,0,0,2,0,9,11,0,0,0,9,0,11,0,0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,12,0,0,0,0,9,12,0,0,0,0,0,12,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,13,0,0,0,4,13,0,0,0,0,9,14,0,0,0,0,0,14,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,15,0,0,0,0,15,0,0,0,0,9,16,0,0,0,0,0,16,0,0,16,0,0,18,0,0,0,18,18,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,18,18,18,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,10,0,0,0,0,9,11,0,0,0,0,0,11,0,0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,12,0,0,0,0,9,12,0,0,0,0,0,12,0,0,12,0,0,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,45,43,32,32,32,48,88,48,120,0,40,110,117,108,108,41,0,45,48,88,43,48,88,32,48,88,45,48,120,43,48,120,32,48,120,0,105,110,102,0,73,78,70,0,110,97,110,0,78,65,78,0,46,0],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+25118);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}assert(tempDoublePtr%8==0),Module._i64Subtract=_i64Subtract;var _floorf=Math_floor;Module._bitshift64Ashr=_bitshift64Ashr;var _SItoF=!0;Module._memset=_memset;var _BDtoILow=!0,_ceilf=Math_ceil;function _abort(){Module.abort()}function ___lock(){}function ___unlock(){}Module._bitshift64Shl=_bitshift64Shl,Module._i64Add=_i64Add;var _floor=Math_floor,_sqrt=Math_sqrt,PATH=void 0;function _emscripten_set_main_loop_timing(e,t){if(Browser.mainLoop.timingMode=e,Browser.mainLoop.timingValue=t,!Browser.mainLoop.func)return 1;if(0==e)Browser.mainLoop.scheduler=function(){setTimeout(Browser.mainLoop.runner,t)},Browser.mainLoop.method="timeout";else if(1==e)Browser.mainLoop.scheduler=function(){Browser.requestAnimationFrame(Browser.mainLoop.runner)},Browser.mainLoop.method="rAF";else if(2==e){if(!window.setImmediate){var n=[],r="__emcc";window.addEventListener("message",(function(e){e.source===window&&e.data===r&&(e.stopPropagation(),n.shift()())}),!0),window.setImmediate=function(e){n.push(e),window.postMessage(r,"*")}}Browser.mainLoop.scheduler=function(){window.setImmediate(Browser.mainLoop.runner)},Browser.mainLoop.method="immediate"}return 0}function _emscripten_set_main_loop(e,t,n,r,i){Module.noExitRuntime=!0,assert(!Browser.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),Browser.mainLoop.func=e,Browser.mainLoop.arg=r;var a=Browser.mainLoop.currentlyRunningMainloop;if(Browser.mainLoop.runner=function(){if(!ABORT){if(Browser.mainLoop.queue.length>0){var t=Date.now(),n=Browser.mainLoop.queue.shift();if(n.func(n.arg),Browser.mainLoop.remainingBlockers){var i=Browser.mainLoop.remainingBlockers,o=i%1==0?i-1:Math.floor(i);n.counted?Browser.mainLoop.remainingBlockers=o:(o+=.5,Browser.mainLoop.remainingBlockers=(8*i+o)/9)}return console.log('main loop blocker "'+n.name+'" took '+(Date.now()-t)+" ms"),Browser.mainLoop.updateStatus(),void setTimeout(Browser.mainLoop.runner,0)}a<Browser.mainLoop.currentlyRunningMainloop||(Browser.mainLoop.currentFrameNumber=Browser.mainLoop.currentFrameNumber+1|0,1==Browser.mainLoop.timingMode&&Browser.mainLoop.timingValue>1&&Browser.mainLoop.currentFrameNumber%Browser.mainLoop.timingValue!=0?Browser.mainLoop.scheduler():("timeout"===Browser.mainLoop.method&&Module.ctx&&(Module.printErr("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),Browser.mainLoop.method=""),Browser.mainLoop.runIter((function(){void 0!==r?Runtime.dynCall("vi",e,[r]):Runtime.dynCall("v",e)})),a<Browser.mainLoop.currentlyRunningMainloop||("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),Browser.mainLoop.scheduler())))}},i||(t&&t>0?_emscripten_set_main_loop_timing(0,1e3/t):_emscripten_set_main_loop_timing(1,1),Browser.mainLoop.scheduler()),n)throw"SimulateInfiniteLoop"}var Browser={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Browser.mainLoop.scheduler=null,Browser.mainLoop.currentlyRunningMainloop++},resume:function(){Browser.mainLoop.currentlyRunningMainloop++;var e=Browser.mainLoop.timingMode,t=Browser.mainLoop.timingValue,n=Browser.mainLoop.func;Browser.mainLoop.func=null,_emscripten_set_main_loop(n,0,!1,Browser.mainLoop.arg,!0),_emscripten_set_main_loop_timing(e,t),Browser.mainLoop.scheduler()},updateStatus:function(){if(Module.setStatus){var e=Module.statusMessage||"Please wait...",t=Browser.mainLoop.remainingBlockers,n=Browser.mainLoop.expectedBlockers;t?t<n?Module.setStatus(e+" ("+(n-t)+"/"+n+")"):Module.setStatus(e):Module.setStatus("")}},runIter:function(e){if(!ABORT){if(Module.preMainLoop)if(!1===Module.preMainLoop())return;try{e()}catch(e){if(e instanceof ExitStatus)return;throw e&&"object"==typeof e&&e.stack&&Module.printErr("exception thrown: "+[e,e.stack]),e}Module.postMainLoop&&Module.postMainLoop()}}},isFullScreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(Module.preloadPlugins||(Module.preloadPlugins=[]),!Browser.initted){Browser.initted=!0;try{new Blob,Browser.hasBlobConstructor=!0}catch(e){Browser.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Browser.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),Browser.URLObject="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,Module.noImageDecoding||void 0!==Browser.URLObject||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),Module.noImageDecoding=!0);var e={canHandle:function(e){return!Module.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,n,r){var i=null;if(Browser.hasBlobConstructor)try{(i=new Blob([e],{type:Browser.getMimetype(t)})).size!==e.length&&(i=new Blob([new Uint8Array(e).buffer],{type:Browser.getMimetype(t)}))}catch(e){Runtime.warnOnce("Blob constructor present but fails: "+e+"; falling back to blob builder")}if(!i){var a=new Browser.BlobBuilder;a.append(new Uint8Array(e).buffer),i=a.getBlob()}var o=Browser.URLObject.createObjectURL(i),s=new Image;s.onload=function(){assert(s.complete,"Image "+t+" could not be decoded");var r=document.createElement("canvas");r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0),Module.preloadedImages[t]=r,Browser.URLObject.revokeObjectURL(o),n&&n(e)},s.onerror=function(e){console.log("Image "+o+" could not be decoded"),r&&r()},s.src=o}};Module.preloadPlugins.push(e);var t={canHandle:function(e){return!Module.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,n,r){var i=!1;function a(r){i||(i=!0,Module.preloadedAudios[t]=r,n&&n(e))}function o(){i||(i=!0,Module.preloadedAudios[t]=new Audio,r&&r())}if(!Browser.hasBlobConstructor)return o();try{var s=new Blob([e],{type:Browser.getMimetype(t)})}catch(e){return o()}var l=Browser.URLObject.createObjectURL(s),c=new Audio;c.addEventListener("canplaythrough",(function(){a(c)}),!1),c.onerror=function(n){i||(console.log("warning: browser could not fully decode audio "+t+", trying slower base64 approach"),c.src="data:audio/x-"+t.substr(-3)+";base64,"+function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=0,i=0,a=0;a<e.length;a++)for(r=r<<8|e[a],i+=8;i>=6;){var o=r>>i-6&63;i-=6,n+=t[o]}return 2==i?(n+=t[(3&r)<<4],n+="=="):4==i&&(n+=t[(15&r)<<2],n+="="),n}(e),a(c))},c.src=l,Browser.safeSetTimeout((function(){a(c)}),1e4)}};Module.preloadPlugins.push(t);var n=Module.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||function(){},n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",r,!1),document.addEventListener("mozpointerlockchange",r,!1),document.addEventListener("webkitpointerlockchange",r,!1),document.addEventListener("mspointerlockchange",r,!1),Module.elementPointerLock&&n.addEventListener("click",(function(e){!Browser.pointerLock&&n.requestPointerLock&&(n.requestPointerLock(),e.preventDefault())}),!1))}function r(){Browser.pointerLock=document.pointerLockElement===n||document.mozPointerLockElement===n||document.webkitPointerLockElement===n||document.msPointerLockElement===n}},createContext:function(e,t,n,r){if(t&&Module.ctx&&e==Module.canvas)return Module.ctx;var i,a;if(t){var o={antialias:!1,alpha:!1};if(r)for(var s in r)o[s]=r[s];(a=GL.createContext(e,o))&&(i=GL.getContext(a).GLctx),e.style.backgroundColor="black"}else i=e.getContext("2d");return i?(n&&(t||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),Module.ctx=i,t&&GL.makeContextCurrent(a),Module.useWebGL=t,Browser.moduleContextCreatedCallbacks.forEach((function(e){e()})),Browser.init()),i):null},destroyContext:function(e,t,n){},fullScreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullScreen:function(e,t,n){Browser.lockPointer=e,Browser.resizeCanvas=t,Browser.vrDevice=n,void 0===Browser.lockPointer&&(Browser.lockPointer=!0),void 0===Browser.resizeCanvas&&(Browser.resizeCanvas=!1),void 0===Browser.vrDevice&&(Browser.vrDevice=null);var r=Module.canvas;function i(){Browser.isFullScreen=!1;var e=r.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===e?(r.cancelFullScreen=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},r.cancelFullScreen=r.cancelFullScreen.bind(document),Browser.lockPointer&&r.requestPointerLock(),Browser.isFullScreen=!0,Browser.resizeCanvas&&Browser.setFullScreenCanvasSize()):(e.parentNode.insertBefore(r,e),e.parentNode.removeChild(e),Browser.resizeCanvas&&Browser.setWindowedCanvasSize()),Module.onFullScreen&&Module.onFullScreen(Browser.isFullScreen),Browser.updateCanvasDimensions(r)}Browser.fullScreenHandlersInstalled||(Browser.fullScreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var a=document.createElement("div");r.parentNode.insertBefore(a,r),a.appendChild(r),a.requestFullScreen=a.requestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullScreen?function(){a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),n?a.requestFullScreen({vrDisplay:n}):a.requestFullScreen()},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===Browser.nextRAF)Browser.nextRAF=t+1e3/60;else for(;t+2>=Browser.nextRAF;)Browser.nextRAF+=1e3/60;var n=Math.max(Browser.nextRAF-t,0);setTimeout(e,n)},requestAnimationFrame:function(e){"undefined"==typeof window?Browser.fakeRequestAnimationFrame(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Browser.fakeRequestAnimationFrame),window.requestAnimationFrame(e))},safeCallback:function(e){return function(){if(!ABORT)return e.apply(null,arguments)}},allowAsyncCallbacks:!0,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){Browser.allowAsyncCallbacks=!1},resumeAsyncCallbacks:function(){if(Browser.allowAsyncCallbacks=!0,Browser.queuedAsyncCallbacks.length>0){var e=Browser.queuedAsyncCallbacks;Browser.queuedAsyncCallbacks=[],e.forEach((function(e){e()}))}},safeRequestAnimationFrame:function(e){return Browser.requestAnimationFrame((function(){ABORT||(Browser.allowAsyncCallbacks?e():Browser.queuedAsyncCallbacks.push(e))}))},safeSetTimeout:function(e,t){return Module.noExitRuntime=!0,setTimeout((function(){ABORT||(Browser.allowAsyncCallbacks?e():Browser.queuedAsyncCallbacks.push(e))}),t)},safeSetInterval:function(e,t){return Module.noExitRuntime=!0,setInterval((function(){ABORT||Browser.allowAsyncCallbacks&&e()}),t)},getMimetype:function(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail;break;case"mousewheel":t=e.wheelDelta;break;case"wheel":t=e.deltaY;break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(e){if(Browser.pointerLock)"mousemove"!=e.type&&"mozMovementX"in e?Browser.mouseMovementX=Browser.mouseMovementY=0:(Browser.mouseMovementX=Browser.getMovementX(e),Browser.mouseMovementY=Browser.getMovementY(e)),"undefined"!=typeof SDL?(Browser.mouseX=SDL.mouseX+Browser.mouseMovementX,Browser.mouseY=SDL.mouseY+Browser.mouseMovementY):(Browser.mouseX+=Browser.mouseMovementX,Browser.mouseY+=Browser.mouseMovementY);else{var t=Module.canvas.getBoundingClientRect(),n=Module.canvas.width,r=Module.canvas.height,i=void 0!==window.scrollX?window.scrollX:window.pageXOffset,a=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type){var o=e.touch;if(void 0===o)return;var s=o.pageX-(i+t.left),l=o.pageY-(a+t.top),c={x:s*=n/t.width,y:l*=r/t.height};if("touchstart"===e.type)Browser.lastTouches[o.identifier]=c,Browser.touches[o.identifier]=c;else if("touchend"===e.type||"touchmove"===e.type){var u=Browser.touches[o.identifier];u||(u=c),Browser.lastTouches[o.identifier]=u,Browser.touches[o.identifier]=c}return}var h=e.pageX-(i+t.left),d=e.pageY-(a+t.top);h*=n/t.width,d*=r/t.height,Browser.mouseMovementX=h-Browser.mouseX,Browser.mouseMovementY=d-Browser.mouseY,Browser.mouseX=h,Browser.mouseY=d}},xhrLoad:function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},asyncLoad:function(e,t,n,r){Browser.xhrLoad(e,(function(n){assert(n,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(n)),r||removeRunDependency("al "+e)}),(function(t){if(!n)throw'Loading data file "'+e+'" failed.';n()})),r||addRunDependency("al "+e)},resizeListeners:[],updateResizeListeners:function(){var e=Module.canvas;Browser.resizeListeners.forEach((function(t){t(e.width,e.height)}))},setCanvasSize:function(e,t,n){var r=Module.canvas;Browser.updateCanvasDimensions(r,e,t),n||Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullScreenCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2];e|=8388608,HEAP32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2]=e}Browser.updateResizeListeners()},setWindowedCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2];e&=-8388609,HEAP32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2]=e}Browser.updateResizeListeners()},updateCanvasDimensions:function(e,t,n){t&&n?(e.widthNative=t,e.heightNative=n):(t=e.widthNative,n=e.heightNative);var r=t,i=n;if(Module.forcedAspectRatio&&Module.forcedAspectRatio>0&&(r/i<Module.forcedAspectRatio?r=Math.round(i*Module.forcedAspectRatio):i=Math.round(r/Module.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var a=Math.min(screen.width/r,screen.height/i);r=Math.round(r*a),i=Math.round(i*a)}Browser.resizeCanvas?(e.width!=r&&(e.width=r),e.height!=i&&(e.height=i),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=t&&(e.width=t),e.height!=n&&(e.height=n),void 0!==e.style&&(r!=t||i!=n?(e.style.setProperty("width",r+"px","important"),e.style.setProperty("height",i+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var e=Browser.nextWgetRequestHandle;return Browser.nextWgetRequestHandle++,e}},SYSCALLS={varargs:0,get:function(e){return SYSCALLS.varargs+=4,HEAP32[SYSCALLS.varargs-4>>2]},getStr:function(){return Pointer_stringify(SYSCALLS.get())},get64:function(){var e=SYSCALLS.get(),t=SYSCALLS.get();return assert(e>=0?0===t:-1===t),e},getZero:function(){assert(0===SYSCALLS.get())}};function ___syscall54(e,t){SYSCALLS.varargs=t;try{return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___setErrNo(e){return Module.___errno_location&&(HEAP32[Module.___errno_location()>>2]=e),e}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(e){switch(e){case 30:return PAGE_SIZE;case 85:return totalMemory/PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ___setErrNo(ERRNO_CODES.EINVAL),-1}Module._bitshift64Lshr=_bitshift64Lshr;var _BDtoIHigh=!0;function _pthread_cleanup_push(e,t){__ATEXIT__.push((function(){Runtime.dynCall("vi",e,[t])})),_pthread_cleanup_push.level=__ATEXIT__.length}function _pthread_cleanup_pop(){assert(_pthread_cleanup_push.level==__ATEXIT__.length,"cannot pop if something else added meanwhile!"),__ATEXIT__.pop(),_pthread_cleanup_push.level=__ATEXIT__.length}function ___syscall5(e,t){SYSCALLS.varargs=t;try{var n=SYSCALLS.getStr(),r=SYSCALLS.get(),i=SYSCALLS.get();return FS.open(n,r,i).fd}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function _emscripten_memcpy_big(e,t,n){return HEAPU8.set(HEAPU8.subarray(t,t+n),e),e}function ___syscall6(e,t){SYSCALLS.varargs=t;try{var n=SYSCALLS.getStreamFromFD();return FS.close(n),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}Module._memcpy=_memcpy;var _llvm_pow_f64=Math_pow;function _sbrk(e){var t=_sbrk;t.called||(DYNAMICTOP=alignMemoryPage(DYNAMICTOP),t.called=!0,assert(Runtime.dynamicAlloc),t.alloc=Runtime.dynamicAlloc,Runtime.dynamicAlloc=function(){abort("cannot dynamically allocate, sbrk now has control")});var n=DYNAMICTOP;if(0!=e&&!t.alloc(e))return-1>>>0;return n}var _BItoD=!0;function _time(e){var t=Date.now()/1e3|0;return e&&(HEAP32[e>>2]=t),t}function _pthread_self(){return 0}function ___syscall140(e,t){SYSCALLS.varargs=t;try{var n=SYSCALLS.getStreamFromFD(),r=SYSCALLS.get(),i=SYSCALLS.get(),a=SYSCALLS.get(),o=SYSCALLS.get(),s=i;return assert(0===r),FS.llseek(n,s,o),HEAP32[a>>2]=n.position,n.getdents&&0===s&&0===o&&(n.getdents=null),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall146(e,t){SYSCALLS.varargs=t;try{SYSCALLS.get();var n=SYSCALLS.get(),r=SYSCALLS.get(),i=0;___syscall146.buffer||(___syscall146.buffer=[]);for(var a=___syscall146.buffer,o=0;o<r;o++){for(var s=HEAP32[n+8*o>>2],l=HEAP32[n+(8*o+4)>>2],c=0;c<l;c++){var u=HEAPU8[s+c];0===u||10===u?(Module.print(UTF8ArrayToString(a,0)),a.length=0):a.push(u)}i+=l}return i}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall221(e,t){SYSCALLS.varargs=t;try{var n=SYSCALLS.getStreamFromFD();switch(SYSCALLS.get()){case 0:return(r=SYSCALLS.get())<0?-ERRNO_CODES.EINVAL:FS.open(n.path,n.flags,0,r).fd;case 1:case 2:return 0;case 3:return n.flags;case 4:var r=SYSCALLS.get();return n.flags|=r,0;case 12:case 12:r=SYSCALLS.get();return HEAP16[r+0>>1]=2,0;case 13:case 14:case 13:case 14:return 0;case 16:case 8:return-ERRNO_CODES.EINVAL;case 9:return ___setErrNo(ERRNO_CODES.EINVAL),-1;default:return-ERRNO_CODES.EINVAL}}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall145(e,t){SYSCALLS.varargs=t;try{var n=SYSCALLS.getStreamFromFD(),r=SYSCALLS.get(),i=SYSCALLS.get();return SYSCALLS.doReadv(n,r,i)}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}Module.requestFullScreen=function(e,t,n){Browser.requestFullScreen(e,t,n)},Module.requestAnimationFrame=function(e){Browser.requestAnimationFrame(e)},Module.setCanvasSize=function(e,t,n){Browser.setCanvasSize(e,t,n)},Module.pauseMainLoop=function(){Browser.mainLoop.pause()},Module.resumeMainLoop=function(){Browser.mainLoop.resume()},Module.getUserMedia=function(){Browser.getUserMedia()},Module.createContext=function(e,t,n,r){return Browser.createContext(e,t,n,r)},STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),staticSealed=!0,STACK_MAX=STACK_BASE+TOTAL_STACK,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);function invoke_iiiiiiii(e,t,n,r,i,a,o,s){try{return Module.dynCall_iiiiiiii(e,t,n,r,i,a,o,s)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiii(e,t,n,r){try{return Module.dynCall_iiii(e,t,n,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_di(e,t){try{return Module.dynCall_di(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_vi(e,t){try{Module.dynCall_vi(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_vii(e,t,n){try{Module.dynCall_vii(e,t,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiiii(e,t,n,r,i,a,o){try{return Module.dynCall_iiiiiii(e,t,n,r,i,a,o)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_ii(e,t){try{return Module.dynCall_ii(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_viii(e,t,n,r){try{Module.dynCall_viii(e,t,n,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiiiiiiiii(e,t,n,r,i,a,o,s,l,c,u,h){try{return Module.dynCall_iiiiiiiiiiii(e,t,n,r,i,a,o,s,l,c,u,h)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiii(e,t,n,r,i){try{return Module.dynCall_iiiii(e,t,n,r,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iii(e,t,n){try{return Module.dynCall_iii(e,t,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiii(e,t,n,r,i,a){try{return Module.dynCall_iiiiii(e,t,n,r,i,a)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_viiii(e,t,n,r,i){try{Module.dynCall_viiii(e,t,n,r,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}Module.asmGlobalArg={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array,NaN:NaN,Infinity:1/0,byteLength},Module.asmLibraryArg={abort,assert,invoke_iiiiiiii,invoke_iiii,invoke_di,invoke_vi,invoke_vii,invoke_iiiiiii,invoke_ii,invoke_viii,invoke_iiiiiiiiiiii,invoke_iiiii,invoke_iii,invoke_iiiiii,invoke_viiii,_pthread_cleanup_pop,___syscall221,_llvm_pow_f64,_abort,_pthread_cleanup_push,_ceilf,_emscripten_set_main_loop_timing,_sbrk,_emscripten_memcpy_big,_sysconf,___setErrNo,_floor,_pthread_self,_sqrt,_floorf,___syscall54,___unlock,_emscripten_set_main_loop,___lock,___syscall6,___syscall5,_time,___syscall140,___syscall145,___syscall146,STACKTOP,STACK_MAX,tempDoublePtr,ABORT,cttz_i8};var asm=function(e,t,n){"use asm";var r=e.Int8Array;var i=e.Int16Array;var a=e.Int32Array;var o=e.Uint8Array;var s=e.Uint16Array;var l=e.Uint32Array;var c=e.Float32Array;var u=e.Float64Array;var h=new r(n);var d=new i(n);var f=new a(n);var p=new o(n);var m=new s(n);var g=new l(n);var v=new c(n);var y=new u(n);var _=e.byteLength;var b=t.STACKTOP|0;var E=t.STACK_MAX|0;var w=t.tempDoublePtr|0;var x=t.ABORT|0;var T=t.cttz_i8|0;var A=0;var M=0;var S=0;var R=0;var k=e.NaN,P=e.Infinity;var L=0,C=0,I=0,N=0,F=0.0,O=0,H=0,D=0,U=0.0;var B=0;var z=0;var V=0;var j=0;var G=0;var W=0;var q=0;var X=0;var Y=0;var K=0;var Z=e.Math.floor;var Q=e.Math.abs;var J=e.Math.sqrt;var $=e.Math.pow;var ee=e.Math.cos;var te=e.Math.sin;var ne=e.Math.tan;var re=e.Math.acos;var ie=e.Math.asin;var ae=e.Math.atan;var oe=e.Math.atan2;var se=e.Math.exp;var le=e.Math.log;var ce=e.Math.ceil;var ue=e.Math.imul;var he=e.Math.min;var de=e.Math.clz32;var fe=t.abort;var pe=t.assert;var me=t.invoke_iiiiiiii;var ge=t.invoke_iiii;var ve=t.invoke_di;var ye=t.invoke_vi;var _e=t.invoke_vii;var be=t.invoke_iiiiiii;var Ee=t.invoke_ii;var we=t.invoke_viii;var xe=t.invoke_iiiiiiiiiiii;var Te=t.invoke_iiiii;var Ae=t.invoke_iii;var Me=t.invoke_iiiiii;var Se=t.invoke_viiii;var Re=t._pthread_cleanup_pop;var ke=t.___syscall221;var Pe=t._llvm_pow_f64;var Le=t._abort;var Ce=t._pthread_cleanup_push;var Ie=t._ceilf;var Ne=t._emscripten_set_main_loop_timing;var Fe=t._sbrk;var Oe=t._emscripten_memcpy_big;var He=t._sysconf;var De=t.___setErrNo;var Ue=t._floor;var Be=t._pthread_self;var ze=t._sqrt;var Ve=t._floorf;var je=t.___syscall54;var Ge=t.___unlock;var We=t._emscripten_set_main_loop;var qe=t.___lock;var Xe=t.___syscall6;var Ye=t.___syscall5;var Ke=t._time;var Ze=t.___syscall140;var Qe=t.___syscall145;var Je=t.___syscall146;var $e=0.0;function et(e){if(_(e)&16777215||_(e)<=16777215||_(e)>2147483648)return false;h=new r(e);d=new i(e);f=new a(e);p=new o(e);m=new s(e);g=new l(e);v=new c(e);y=new u(e);n=e;return true}function tt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0;u=b;b=b+48|0;i=u+32|0;c=u+28|0;f[i>>2]=n;if((f[e+8>>2]|0)==16)l=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else l=f[e+12>>2]|0;a=(f[e+80>>2]|0)+16|0;o=(f[a>>2]|0)>>>0<257?1:2;s=o+1|0;if(s>>>0>n>>>0){Jr(r,1,14585,u)|0;r=0;b=u;return r|0}f[i>>2]=n-s;wr(t,c,o);n=f[c>>2]|0;if(n>>>0>=(f[a>>2]|0)>>>0){Jr(r,1,14611,u+8|0)|0;r=0;b=u;return r|0}wr(t+o|0,(f[l+5584>>2]|0)+(n*1080|0)|0,1);if(!(St(e,f[c>>2]|0,t+s|0,i,r)|0)){Jr(r,1,14585,u+16|0)|0;r=0;b=u;return r|0}if(!(f[i>>2]|0)){r=1;b=u;return r|0}Jr(r,1,14585,u+24|0)|0;r=0;b=u;return r|0}function nt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+32|0;s=l+8|0;i=l+20|0;o=f[(f[e+80>>2]|0)+16>>2]|0;a=o>>>0<257?1:2;if((a+2|0)!=(n|0)){Jr(r,1,14502,l)|0;s=0;b=l;return s|0}if((f[e+8>>2]|0)==16)e=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else e=f[e+12>>2]|0;wr(t,i,a);wr(t+a|0,l+16|0,1);n=f[i>>2]|0;if(n>>>0<o>>>0){wr(t+(a+1)|0,(f[e+5584>>2]|0)+(n*1080|0)+808|0,1);s=1;b=l;return s|0}else{f[s>>2]=n;f[s+4>>2]=o;Jr(r,1,14528,s)|0;s=0;b=l;return s|0}return 0}function rt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0;o=b;b=b+16|0;i=o+12|0;f[i>>2]=n;if(!(Mt(e,0,t,i,r)|0)){Jr(r,1,14476,o)|0;a=0;b=o;return a|0}if(f[i>>2]|0){Jr(r,1,14476,o+8|0)|0;a=0;b=o;return a|0}if((f[e+8>>2]|0)==16)i=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else i=f[e+12>>2]|0;i=f[i+5584>>2]|0;n=e+80|0;if((f[(f[n>>2]|0)+16>>2]|0)>>>0<=1){a=1;b=o;return a|0}r=i+24|0;e=i+804|0;a=i+28|0;t=1;while(1){f[i+1104>>2]=f[r>>2];f[i+1884>>2]=f[e>>2];Xl(i+1108|0,a|0,776)|0;t=t+1|0;if(t>>>0>=(f[(f[n>>2]|0)+16>>2]|0)>>>0){i=1;break}else i=i+1080|0}b=o;return i|0}function it(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0;d=b;b=b+48|0;h=d+32|0;u=d+24|0;c=d+16|0;a=d+8|0;i=d;l=d+40|0;o=d+36|0;f[l>>2]=n;s=e+80|0;do{if((f[(f[s>>2]|0)+16>>2]|0)>>>0<257){if(n){wr(t,o,1);a=t+1|0;t=n+-1|0;break}Jr(r,1,14129,i)|0;h=0;b=d;return h|0}else{if(n>>>0>=2){wr(t,o,2);a=t+2|0;t=n+-2|0;break}Jr(r,1,14129,a)|0;h=0;b=d;return h|0}}while(0);f[l>>2]=t;i=f[o>>2]|0;t=f[(f[s>>2]|0)+16>>2]|0;if(i>>>0>=t>>>0){f[c>>2]=i;f[c+4>>2]=t;Jr(r,1,14155,c)|0;h=0;b=d;return h|0}if(!(Mt(e,i,a,l,r)|0)){Jr(r,1,14129,u)|0;h=0;b=d;return h|0}if(!(f[l>>2]|0)){h=1;b=d;return h|0}Jr(r,1,14129,h)|0;h=0;b=d;return h|0}function at(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;y=b;b=b+16|0;a=y+8|0;v=y+12|0;g=f[(f[e+80>>2]|0)+16>>2]|0;m=g>>>0<257?1:2;p=(m<<1)+5|0;i=(n>>>0)/(p>>>0)|0;if((i|0)==0|((n>>>0)%(p>>>0)|0|0)!=0){Jr(r,1,14085,y)|0;v=0;b=y;return v|0}if((f[e+8>>2]|0)==16)p=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else p=f[e+12>>2]|0;n=p+5636|0;e=h[n>>0]|0;if(!(e&4))d=0;else d=(f[p+420>>2]|0)+1|0;u=d+i|0;if(u>>>0>31){f[a>>2]=u;Jr(r,1,14111,a)|0;v=0;b=y;return v|0}h[n>>0]=e|4;if(d>>>0<u>>>0){r=m+1|0;c=p+8|0;a=m+3|0;o=m|4;s=o+m|0;l=s+1|0;e=t;i=d;n=p+424+(d*148|0)|0;while(1){wr(e,n,1);wr(e+1|0,n+4|0,m);t=n+8|0;wr(e+r|0,t,2);_=f[t>>2]|0;d=f[c>>2]|0;f[t>>2]=_>>>0<d>>>0?_:d;wr(e+a|0,n+12|0,1);t=n+16|0;wr(e+o|0,t,m);wr(e+s|0,v,1);f[n+36>>2]=f[v>>2];d=f[t>>2]|0;f[t>>2]=d>>>0<g>>>0?d:g;i=i+1|0;if(i>>>0>=u>>>0)break;else{e=e+l|0;n=n+148|0}}}f[p+420>>2]=u+-1;_=1;b=y;return _|0}function ot(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0;H=b;b=b+144|0;O=H+128|0;C=H+120|0;L=H+112|0;P=H+104|0;k=H+96|0;R=H+88|0;M=H+72|0;y=H+64|0;g=H+56|0;m=H+48|0;p=H+40|0;v=H+32|0;s=H+24|0;a=H+16|0;i=H+136|0;w=H+132|0;N=f[e+80>>2]|0;F=e+88|0;if(n>>>0<36){Jr(r,1,13440,H)|0;r=0;b=H;return r|0}I=n+-36|0;u=(I>>>0)/3|0;if((I>>>0)%3|0){Jr(r,1,13440,H+8|0)|0;r=0;b=H;return r|0}wr(t,i,2);d[F>>1]=f[i>>2];x=N+8|0;wr(t+2|0,x,4);S=N+12|0;wr(t+6|0,S,4);wr(t+10|0,N,4);c=N+4|0;wr(t+14|0,c,4);E=e+100|0;wr(t+18|0,E,4);A=e+104|0;wr(t+22|0,A,4);_=e+92|0;wr(t+26|0,_,4);T=e+96|0;wr(t+30|0,T,4);wr(t+34|0,i,2);o=t+36|0;n=f[i>>2]|0;if(n>>>0>=16385){f[a>>2]=n;Jr(r,1,13468,a)|0;r=0;b=H;return r|0}n=n&65535;I=N+16|0;f[I>>2]=n;if((n|0)!=(u|0)){f[s>>2]=n;f[s+4>>2]=u;Jr(r,1,13529,s)|0;r=0;b=H;return r|0}s=f[N>>2]|0;l=f[x>>2]|0;if(l>>>0>s>>>0){n=f[c>>2]|0;t=f[S>>2]|0;if(n>>>0<t>>>0){i=f[E>>2]|0;a=f[A>>2]|0;if(!(ue(a,i)|0)){f[p>>2]=i;f[p+4>>2]=a;Jr(r,1,13705,p)|0;r=0;b=H;return r|0}v=Jl(t|0,0,l|0,0)|0;if(!((v|0)==(ue(t,l)|0)&(B|0)==0)){f[m>>2]=l;f[m+4>>2]=t;Jr(r,1,13766,m)|0;r=0;b=H;return r|0}l=f[_>>2]|0;p=Wl(l|0,0,i|0,0)|0;m=B;c=f[T>>2]|0;v=Wl(c|0,0,a|0,0)|0;if(l>>>0<=s>>>0?c>>>0<=n>>>0&(p|0-m)>>>0>s>>>0&(v|0-B)>>>0>n>>>0:0){t=Yi(u,52)|0;u=N+24|0;f[u>>2]=t;if(!t){f[I>>2]=0;Jr(r,1,13852,y)|0;r=0;b=H;return r|0}e:do{if(f[I>>2]|0){s=e+168|0;n=0;a=t;while(1){wr(o,w,1);f[a+24>>2]=(f[w>>2]&127)+1;f[a+32>>2]=(f[w>>2]|0)>>>7;wr(o+1|0,w,1);f[a>>2]=f[w>>2];wr(o+2|0,w,1);i=f[w>>2]|0;f[a+4>>2]=i;t=f[a>>2]|0;if((i+-1|0)>>>0>254|(t+-1|0)>>>0>254)break;f[a+36>>2]=0;f[a+40>>2]=f[s>>2];n=n+1|0;if(n>>>0>=(f[I>>2]|0)>>>0)break e;else{o=o+3|0;a=a+52|0}}f[M>>2]=n;f[M+4>>2]=t;f[M+8>>2]=i;Jr(r,1,13900,M)|0;r=0;b=H;return r|0}}while(0);l=f[_>>2]|0;s=f[E>>2]|0;o=((f[x>>2]|0)+-1-l+s|0)/(s|0)|0;f[e+112>>2]=o;a=f[T>>2]|0;i=f[A>>2]|0;t=((f[S>>2]|0)+-1-a+i|0)/(i|0)|0;f[e+116>>2]=t;if(!((t|0)==0|(o|0)==0)?o>>>0<=(65535/(t>>>0)|0)>>>0:0){c=ue(o,t)|0;n=e+28|0;if(!(h[e+76>>0]&2)){f[n>>2]=0;f[e+32>>2]=0;f[e+36>>2]=o;f[e+40>>2]=t}else{f[n>>2]=(((f[n>>2]|0)-l|0)>>>0)/(s>>>0)|0;R=e+32|0;f[R>>2]=(((f[R>>2]|0)-a|0)>>>0)/(i>>>0)|0;R=e+36|0;f[R>>2]=((f[R>>2]|0)+-1-l+s|0)/(s|0)|0;R=e+40|0;f[R>>2]=((f[R>>2]|0)+-1-a+i|0)/(i|0)|0}R=Yi(c,5640)|0;o=e+164|0;f[o>>2]=R;if(!R){Jr(r,1,13852,k)|0;r=0;b=H;return r|0}k=Yi(f[I>>2]|0,1080)|0;t=e+12|0;f[(f[t>>2]|0)+5584>>2]=k;if(!k){Jr(r,1,13852,P)|0;r=0;b=H;return r|0}P=Yi(10,20)|0;n=f[t>>2]|0;f[n+5612>>2]=P;if(!P){Jr(r,1,13852,L)|0;r=0;b=H;return r|0}f[n+5620>>2]=10;L=Yi(10,20)|0;n=f[t>>2]|0;f[n+5624>>2]=L;if(!L){Jr(r,1,13852,C)|0;r=0;b=H;return r|0}f[n+5632>>2]=10;a=f[I>>2]|0;if(a){i=f[u>>2]|0;n=n+5584|0;t=0;do{if(!(f[i+(t*52|0)+32>>2]|0))f[(f[n>>2]|0)+(t*1080|0)+1076>>2]=1<<(f[i+(t*52|0)+24>>2]|0)+-1;t=t+1|0}while(t>>>0<a>>>0)}e:do{if(c){n=f[o>>2]|0;C=Yi(a,1080)|0;f[n+5584>>2]=C;if(C){t=0;while(1){t=t+1|0;if(t>>>0>=c>>>0)break e;C=Yi(f[I>>2]|0,1080)|0;f[n+11224>>2]=C;if(!C)break;else n=n+5640|0}}Jr(r,1,13852,O)|0;r=0;b=H;return r|0}}while(0);f[e+8>>2]=4;ii(N,F);r=1;b=H;return r|0}f[R>>2]=o;f[R+4>>2]=t;Jr(r,1,14002,R)|0;r=0;b=H;return r|0}Jr(r,1,13808,g)|0;r=0;b=H;return r|0}}else{t=f[S>>2]|0;n=f[c>>2]|0}f[v>>2]=l-s;f[v+4>>2]=t-n;Jr(r,1,13643,v)|0;r=0;b=H;return r|0}function st(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;i=b;b=b+32|0;e=i+12|0;if(n>>>0<2){Jr(r,1,13414,i)|0;r=0;b=i;return r|0}wr(t,i+16|0,1);wr(t+1|0,e,1);t=f[e>>2]|0;if(!(((n+-2|0)>>>0)%(((t>>>5&2)+2+(t>>>4&3)|0)>>>0)|0)){r=1;b=i;return r|0}Jr(r,1,13414,i+8|0)|0;r=0;b=i;return r|0}function lt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;e=b;b=b+16|0;if(!n){Jr(r,1,13388,e)|0;t=0}else t=1;b=e;return t|0}function ct(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+32|0;s=l+8|0;o=l+12|0;if(!n){Jr(r,1,13362,l)|0;r=0;b=l;return r|0}wr(t,l+16|0,1);i=n+-1|0;if(!i){r=1;b=l;return r|0}else{a=0;e=0}do{t=t+1|0;wr(t,o,1);n=f[o>>2]|0;if(!(n&128))e=0;else e=(n&127|e)<<7;a=a+1|0}while((a|0)!=(i|0));if(!e){r=1;b=l;return r|0}Jr(r,1,13362,s)|0;r=0;b=l;return r|0}function ut(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0;p=b;b=b+48|0;d=p+32|0;l=p+24|0;a=p+16|0;i=p+8|0;u=p+36|0;if(n>>>0<2){Jr(r,1,13276,p)|0;d=0;b=p;return d|0}c=e+184|0;h[c>>0]=h[c>>0]|1;wr(t,u,1);c=t+1|0;s=n+-1|0;o=e+124|0;n=f[o>>2]|0;do{if(n){i=e+120|0;t=f[u>>2]|0;if((f[i>>2]|0)>>>0<=t>>>0){e=t+1|0;t=Qi(n,e<<3)|0;if(t){f[o>>2]=t;n=f[i>>2]|0;jl(t+(n<<3)|0,0,e-n<<3|0)|0;f[i>>2]=e;n=f[o>>2]|0;break}Jr(r,1,13302,a)|0;d=0;b=p;return d|0}}else{t=(f[u>>2]|0)+1|0;n=Yi(t,8)|0;f[o>>2]=n;if(n){f[e+120>>2]=t;break}Jr(r,1,13302,i)|0;d=0;b=p;return d|0}}while(0);t=f[u>>2]|0;if(f[n+(t<<3)>>2]|0){f[l>>2]=t;Jr(r,1,13340,l)|0;d=0;b=p;return d|0}l=Xi(s)|0;n=f[u>>2]|0;t=f[o>>2]|0;f[t+(n<<3)>>2]=l;if(!l){Jr(r,1,13302,d)|0;d=0;b=p;return d|0}else{f[t+(n<<3)+4>>2]=s;Xl(f[t+(f[u>>2]<<3)>>2]|0,c|0,s|0)|0;d=1;b=p;return d|0}return 0}function ht(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0;g=b;b=b+48|0;m=g+40|0;d=g+32|0;s=g+24|0;o=g+16|0;p=g+44|0;if(n>>>0<2){Jr(r,1,13127,g)|0;m=0;b=g;return m|0}if(h[e+184>>0]&1){Jr(r,1,13153,g+8|0)|0;m=0;b=g;return m|0}a=f[e+200>>2]|0;i=f[e+164>>2]|0;u=i+(a*5640|0)+5636|0;h[u>>0]=h[u>>0]|2;wr(t,p,1);u=t+1|0;c=n+-1|0;l=i+(a*5640|0)+5164|0;t=f[l>>2]|0;do{if(t){i=i+(a*5640|0)+5160|0;e=f[p>>2]|0;if((f[i>>2]|0)>>>0<=e>>>0){n=e+1|0;e=Qi(t,n<<3)|0;if(e){f[l>>2]=e;t=f[i>>2]|0;jl(e+(t<<3)|0,0,n-t<<3|0)|0;f[i>>2]=n;t=f[l>>2]|0;break}Jr(r,1,8775,s)|0;m=0;b=g;return m|0}}else{e=(f[p>>2]|0)+1|0;t=Yi(e,8)|0;f[l>>2]=t;if(t){f[i+(a*5640|0)+5160>>2]=e;break}Jr(r,1,8775,o)|0;m=0;b=g;return m|0}}while(0);e=f[p>>2]|0;if(f[t+(e<<3)>>2]|0){f[d>>2]=e;Jr(r,1,13254,d)|0;m=0;b=g;return m|0}d=Xi(c)|0;t=f[p>>2]|0;e=f[l>>2]|0;f[e+(t<<3)>>2]=d;if(!d){Jr(r,1,8775,m)|0;m=0;b=g;return m|0}else{f[e+(t<<3)+4>>2]=c;Xl(f[e+(f[p>>2]<<3)>>2]|0,u|0,c|0)|0;m=1;b=g;return m|0}return 0}function dt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;t=b;b=b+16|0;if((f[(f[e+80>>2]|0)+16>>2]<<2|0)==(n|0)){r=1;b=t;return r|0}Jr(r,1,13101,t)|0;r=0;b=t;return r|0}function ft(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;return 1}function pt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+48|0;g=v+40|0;m=v+32|0;c=v+24|0;p=v+44|0;if((f[e+8>>2]|0)==16)s=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else s=f[e+12>>2]|0;if(n>>>0<2){Jr(r,1,12933,v)|0;g=0;b=v;return g|0}wr(t,p,2);if(f[p>>2]|0){Jr(r,2,12959,v+8|0)|0;g=1;b=v;return g|0}if(n>>>0<7){Jr(r,1,12933,v+16|0)|0;g=0;b=v;return g|0}wr(t+2|0,p,2);h=t+4|0;d=f[p>>2]&255;l=s+5612|0;i=f[l>>2]|0;u=s+5616|0;e=f[u>>2]|0;e:do{if(!e){a=0;o=i}else{a=0;o=i;do{if((f[o+8>>2]|0)==(d|0))break e;o=o+20|0;a=a+1|0}while(a>>>0<e>>>0)}}while(0);if((a|0)==(e|0)){a=s+5620|0;do{if((e|0)==(f[a>>2]|0)){e=e+10|0;f[a>>2]=e;e=Qi(i,e*20|0)|0;if(e){f[l>>2]=e;i=f[u>>2]|0;jl(e+(i*20|0)|0,0,((f[a>>2]|0)-i|0)*20|0)|0;i=f[l>>2]|0;e=f[u>>2]|0;break}Ji(f[l>>2]|0);f[l>>2]=0;f[a>>2]=0;f[u>>2]=0;Jr(r,1,13019,c)|0;g=0;b=v;return g|0}}while(0);f[u>>2]=e+1;o=i+(e*20|0)|0}a=o+12|0;e=f[a>>2]|0;if(e){Ji(e);f[a>>2]=0}f[o+8>>2]=d;d=f[p>>2]|0;f[o+4>>2]=d>>>8&3;f[o>>2]=d>>>10&3;wr(h,p,2);if(f[p>>2]|0){Jr(r,2,13057,m)|0;g=1;b=v;return g|0}e=n+-6|0;i=Xi(e)|0;f[a>>2]=i;if(!i){Jr(r,1,12933,g)|0;g=0;b=v;return g|0}else{Xl(i|0,t+6|0,e|0)|0;f[o+16>>2]=e;g=1;b=v;return g|0}return 0}function mt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;i=s+16|0;o=s+12|0;e=e+80|0;a=f[(f[e>>2]|0)+16>>2]|0;if((a+2|0)!=(n|0)){Jr(r,1,12907,s)|0;o=0;b=s;return o|0}wr(t,i,2);if((f[i>>2]|0)!=(a|0)){Jr(r,1,12907,s+8|0)|0;o=0;b=s;return o|0}if(!a){o=1;b=s;return o|0}i=t+2|0;t=0;e=f[(f[e>>2]|0)+24>>2]|0;while(1){wr(i,o,1);f[e+32>>2]=(f[o>>2]|0)>>>7&1;f[e+24>>2]=(f[o>>2]&127)+1;t=t+1|0;if((t|0)==(a|0)){e=1;break}else{i=i+1|0;e=e+52|0}}b=s;return e|0}function gt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0;F=b;b=b+144|0;N=F+120|0;I=F+112|0;C=F+104|0;L=F+96|0;P=F+88|0;k=F+80|0;R=F+72|0;S=F+64|0;M=F+56|0;A=F+48|0;p=F+40|0;d=F+32|0;c=F+24|0;x=F+136|0;_=F+132|0;E=F+128|0;w=F+124|0;if((f[e+8>>2]|0)==16)m=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else m=f[e+12>>2]|0;if(n>>>0<2){Jr(r,1,12567,F)|0;N=0;b=F;return N|0}wr(t,x,2);if(f[x>>2]|0){Jr(r,2,12593,F+8|0)|0;N=1;b=F;return N|0}if(n>>>0<7){Jr(r,1,12567,F+16|0)|0;N=0;b=F;return N|0}wr(t+2|0,_,1);u=t+3|0;l=m+5624|0;i=f[l>>2]|0;T=m+5628|0;e=f[T>>2]|0;e:do{if(!e){o=0;a=i}else{s=f[_>>2]|0;o=0;a=i;do{if((f[a>>2]|0)==(s|0))break e;a=a+20|0;o=o+1|0}while(o>>>0<e>>>0)}}while(0);if((o|0)==(e|0)){a=m+5632|0;do{if((e|0)==(f[a>>2]|0)){e=e+10|0;f[a>>2]=e;e=Qi(i,e*20|0)|0;if(e){f[l>>2]=e;i=f[T>>2]|0;jl(e+(i*20|0)|0,0,((f[a>>2]|0)-i|0)*20|0)|0;i=f[l>>2]|0;e=f[T>>2]|0;break}Ji(f[l>>2]|0);f[l>>2]=0;f[a>>2]=0;f[T>>2]=0;Jr(r,1,12639,c)|0;N=0;b=F;return N|0}}while(0);a=i+(e*20|0)|0}f[a>>2]=f[_>>2];wr(u,x,2);if(f[x>>2]|0){Jr(r,2,12593,d)|0;N=1;b=F;return N|0}wr(t+5|0,E,2);i=f[E>>2]|0;if(i>>>0>1){Jr(r,2,12677,p)|0;N=1;b=F;return N|0}e=n+-7|0;e:do{if(i){g=a+4|0;v=a+16|0;y=a+8|0;n=a+12|0;p=m+5612|0;d=m+5616|0;c=t+7|0;u=0;t:while(1){if(e>>>0<3){i=27;break}wr(c,x,1);if((f[x>>2]|0)!=1){i=29;break}wr(c+1|0,w,2);i=e+-3|0;o=f[w>>2]|0;s=(o>>>15)+1|0;o=o&32767;f[g>>2]=o;a=(ue(s,o)|0)+2|0;if(i>>>0<a>>>0){i=31;break}e=c+3|0;l=i-a|0;if(o){i=0;do{wr(e,x,s);if((f[x>>2]|0)!=(i|0)){i=34;break t}e=e+s|0;i=i+1|0}while(i>>>0<(f[g>>2]|0)>>>0)}wr(e,w,2);i=e+2|0;a=f[w>>2]|0;o=(a>>>15)+1|0;a=a&32767;f[w>>2]=a;if((a|0)!=(f[g>>2]|0)){i=37;break}e=(ue(o,a)|0)+3|0;if(l>>>0<e>>>0){i=39;break}e=l-e|0;if(a){a=0;do{wr(i,x,o);if((f[x>>2]|0)!=(a|0)){i=42;break t}i=i+o|0;a=a+1|0}while(a>>>0<(f[g>>2]|0)>>>0)}wr(i,x,3);c=i+3|0;h[v>>0]=((f[x>>2]|0)>>>16^1)&1|h[v>>0]&-2;f[y>>2]=0;f[n>>2]=0;l=f[x>>2]|0;a=l&255;f[_>>2]=a;if(a){o=f[d>>2]|0;if(!o){i=50;break}s=0;i=f[p>>2]|0;while(1){if((f[i+8>>2]|0)==(a|0))break;s=s+1|0;if(s>>>0>=o>>>0){i=50;break t}else i=i+20|0}f[y>>2]=i}a=l>>>8&255;f[_>>2]=a;if(a){o=f[d>>2]|0;if(!o){i=57;break}s=0;i=f[p>>2]|0;while(1){if((f[i+8>>2]|0)==(a|0))break;s=s+1|0;if(s>>>0>=o>>>0){i=57;break t}else i=i+20|0}f[n>>2]=i}u=u+1|0;if(u>>>0>=(f[E>>2]|0)>>>0)break e}if((i|0)==27){Jr(r,1,12567,A)|0;N=0;b=F;return N|0}else if((i|0)==29){Jr(r,2,12721,M)|0;N=1;b=F;return N|0}else if((i|0)==31){Jr(r,1,12567,S)|0;N=0;b=F;return N|0}else if((i|0)==34){Jr(r,2,12787,R)|0;N=1;b=F;return N|0}else if((i|0)==37){Jr(r,2,12841,k)|0;N=1;b=F;return N|0}else if((i|0)==39){Jr(r,1,12567,P)|0;N=0;b=F;return N|0}else if((i|0)==42){Jr(r,2,12787,L)|0;N=1;b=F;return N|0}else if((i|0)==50){Jr(r,1,12567,C)|0;N=0;b=F;return N|0}else if((i|0)==57){Jr(r,1,12567,I)|0;N=0;b=F;return N|0}}}while(0);if(!e){f[T>>2]=(f[T>>2]|0)+1;N=1;b=F;return N|0}else{Jr(r,1,12567,N)|0;N=0;b=F;return N|0}return 0}function vt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+32|0;g=v+24|0;m=v+20|0;h=e+80|0;i=f[h>>2]|0;if((f[e+8>>2]|0)==16)a=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else a=f[e+12>>2]|0;if(!n){Jr(r,1,12486,v)|0;g=0;b=v;return g|0}wr(t,m,1);e=f[m>>2]|0;if(e>>>0>1){Jr(r,2,12512,v+8|0)|0;g=1;b=v;return g|0}if((e+1|0)!=(n|0)){Jr(r,2,12486,v+16|0)|0;g=0;b=v;return g|0}u=a+5584|0;e=f[i+16>>2]|0;if(e){n=0;r=f[u>>2]|0;while(1){f[r+1076>>2]=0;n=n+1|0;if(n>>>0>=e>>>0)break;else r=r+1080|0}}c=a+5604|0;e=f[c>>2]|0;if(e){Ji(e);f[c>>2]=0}if(!(f[m>>2]|0)){g=1;b=v;return g|0}l=a+5624|0;o=a+5628|0;s=0;while(1){t=t+1|0;wr(t,g,1);e=f[h>>2]|0;i=f[l>>2]|0;a=f[o>>2]|0;if(((a|0)!=0?!((a|0)==0?1:(f[i>>2]|0)!=(f[g>>2]|0)):0)?(d=f[i+4>>2]|0,p=e+16|0,(d|0)==(f[p>>2]|0)):0){e=f[i+8>>2]|0;if(e){n=ue(d,d)|0;a=ue(f[1036+(f[e>>2]<<2)>>2]|0,n)|0;if((f[e+16>>2]|0)!=(a|0)){e=0;n=32;break}r=Xi(n<<2)|0;f[c>>2]=r;if(!r){e=0;n=32;break}Fc[f[1052+(f[e>>2]<<2)>>2]&15](f[e+12>>2]|0,r,n)}e=f[i+12>>2]|0;if(e){n=f[p>>2]|0;a=ue(n,f[1036+(f[e>>2]<<2)>>2]|0)|0;if((f[e+16>>2]|0)!=(a|0)){e=0;n=32;break}a=Xi(n<<2)|0;if(!a){e=0;n=32;break}Fc[f[1068+(f[e>>2]<<2)>>2]&15](f[e+12>>2]|0,a,n);e=f[p>>2]|0;if(e){n=0;r=a;i=f[u>>2]|0;while(1){f[i+1076>>2]=f[r>>2];n=n+1|0;if((n|0)==(e|0))break;else{r=r+4|0;i=i+1080|0}}}Ji(a)}}s=s+1|0;if(s>>>0>=(f[m>>2]|0)>>>0){e=1;n=32;break}}if((n|0)==32){b=v;return e|0}return 0}function yt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){wr(e,i,2);f[t>>2]=f[i>>2];r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+2|0}}b=a;return}function _t(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){wr(e,i,4);f[t>>2]=f[i>>2];r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function bt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){Mr(e,i);f[t>>2]=~~+v[i>>2];r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function Et(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){Tr(e,i);f[t>>2]=~~+y[i>>3];r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+8|0}}b=a;return}function wt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){wr(e,i,2);v[t>>2]=+((f[i>>2]|0)>>>0);r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+2|0}}b=a;return}function xt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){wr(e,i,4);v[t>>2]=+((f[i>>2]|0)>>>0);r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function Tt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){Mr(e,i);f[t>>2]=f[i>>2];r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function At(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!n){b=a;return}r=0;while(1){Tr(e,i);v[t>>2]=+y[i>>3];r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+8|0}}b=a;return}function Mt(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0,u=0,h=0;h=b;b=b+32|0;o=h+8|0;l=h+20|0;if((f[e+8>>2]|0)==16)e=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else e=f[e+12>>2]|0;u=f[e+5584>>2]|0;e=f[r>>2]|0;if(!e){Jr(i,1,14224,h)|0;t=0;b=h;return t|0}f[r>>2]=e+-1;wr(n,l,1);n=n+1|0;a=f[l>>2]&31;s=u+(t*1080|0)+24|0;f[s>>2]=a;f[u+(t*1080|0)+804>>2]=(f[l>>2]|0)>>>5;do{if((a|0)==1){e=1;c=8}else{e=(f[r>>2]|0)>>>((a|0)!=0&1);if(e>>>0>97){f[o>>2]=e;f[o+4>>2]=97;f[o+8>>2]=97;Jr(i,2,14260,o)|0;a=f[s>>2]|0}i=(e|0)==0;if(a)if(i){e=0;c=20;break}else{c=8;break}if(!i){a=0;while(1){wr(n,l,1);if(a>>>0<97){f[u+(t*1080|0)+28+(a<<3)>>2]=(f[l>>2]|0)>>>3;f[u+(t*1080|0)+28+(a<<3)+4>>2]=0}a=a+1|0;if((a|0)==(e|0))break;else n=n+1|0}}e=(f[r>>2]|0)-e|0}}while(0);if((c|0)==8){a=0;while(1){wr(n,l,2);if(a>>>0<97){f[u+(t*1080|0)+28+(a<<3)>>2]=(f[l>>2]|0)>>>11;f[u+(t*1080|0)+28+(a<<3)+4>>2]=f[l>>2]&2047}a=a+1|0;if((a|0)==(e|0)){c=20;break}else n=n+2|0}}if((c|0)==20)e=(f[r>>2]|0)-(e<<1)|0;f[r>>2]=e;if((f[s>>2]|0)!=1){t=1;b=h;return t|0}e=u+(t*1080|0)+28|0;n=u+(t*1080|0)+32|0;a=1;do{r=(f[e>>2]|0)-(((a+-1|0)>>>0)/3|0)|0;f[u+(t*1080|0)+28+(a<<3)>>2]=(r|0)>0?r:0;f[u+(t*1080|0)+28+(a<<3)+4>>2]=f[n>>2];a=a+1|0}while((a|0)!=97);e=1;b=h;return e|0}function St(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0;g=b;b=b+48|0;p=g+40|0;c=g+32|0;l=g+16|0;s=g+8|0;d=g+44|0;o=e+8|0;if((f[o>>2]|0)==16)a=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else a=f[e+12>>2]|0;u=f[a+5584>>2]|0;if((f[r>>2]|0)>>>0<5){Jr(i,1,14664,g)|0;r=0;b=g;return r|0}h=u+(t*1080|0)+4|0;wr(n,h,1);a=(f[h>>2]|0)+1|0;f[h>>2]=a;if(a>>>0>33){f[s>>2]=a;f[s+4>>2]=33;Jr(i,1,14699,s)|0;r=0;b=g;return r|0}if((f[e+168>>2]|0)>>>0>=a>>>0){f[l>>2]=t;Jr(i,1,14776,l)|0;f[o>>2]=f[o>>2]|32768;r=0;b=g;return r|0}s=u+(t*1080|0)+8|0;wr(n+1|0,s,1);f[s>>2]=(f[s>>2]|0)+2;e=u+(t*1080|0)+12|0;wr(n+2|0,e,1);l=(f[e>>2]|0)+2|0;f[e>>2]=l;s=f[s>>2]|0;if(s>>>0>10|l>>>0>10|(s+l|0)>>>0>12){Jr(i,1,14934,g+24|0)|0;r=0;b=g;return r|0}wr(n+3|0,u+(t*1080|0)+16|0,1);wr(n+4|0,u+(t*1080|0)+20|0,1);o=(f[r>>2]|0)+-5|0;f[r>>2]=o;a=f[h>>2]|0;if(!(f[u+(t*1080|0)>>2]&1)){if(!a){r=1;b=g;return r|0}else a=0;do{f[u+(t*1080|0)+812+(a<<2)>>2]=15;f[u+(t*1080|0)+944+(a<<2)>>2]=15;a=a+1|0}while(a>>>0<(f[h>>2]|0)>>>0);a=1;b=g;return a|0}if(o>>>0<a>>>0){Jr(i,1,14664,c)|0;r=0;b=g;return r|0}do{if(!a)a=0;else{e=0;o=n+5|0;while(1){wr(o,d,1);o=o+1|0;a=f[d>>2]|0;if((e|0)!=0?a>>>0<16|(a&15|0)==0:0)break;f[u+(t*1080|0)+812+(e<<2)>>2]=a&15;f[u+(t*1080|0)+944+(e<<2)>>2]=(f[d>>2]|0)>>>4;e=e+1|0;a=f[h>>2]|0;if(e>>>0>=a>>>0){m=22;break}}if((m|0)==22){o=f[r>>2]|0;break}Jr(i,1,15002,p)|0;r=0;b=g;return r|0}}while(0);f[r>>2]=o-a;r=1;b=g;return r|0}function Rt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if(!n)return;r=0;while(1){Er(t,~~+v[e>>2]>>>0,2);r=r+1|0;if((r|0)==(n|0))break;else{t=t+2|0;e=e+4|0}}return}function kt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if(!n)return;r=0;while(1){Er(t,~~+v[e>>2]>>>0,4);r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+4|0}}return}function Pt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if(!n)return;r=0;while(1){Ar(t,+v[e>>2]);r=r+1|0;if((r|0)==(n|0))break;else{t=t+4|0;e=e+4|0}}return}function Lt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if(!n)return;r=0;while(1){xr(t,+v[e>>2]);r=r+1|0;if((r|0)==(n|0))break;else{t=t+8|0;e=e+4|0}}return}function Ct(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0;s=b;b=b+16|0;if(!n){n=0;b=s;return n|0}if(!(va(f[e>>2]|0,t,n,r)|0)){Jr(r,1,16303,s)|0;n=0;b=s;return n|0}if(f[e+128>>2]|0){n=1;b=s;return n|0}o=e+108|0;if(!(Qt(n,o,r)|0)){n=0;b=s;return n|0}t=f[e+48>>2]|0;e:do{switch(t|0){case 16:{f[n+20>>2]=1;break}case 17:{f[n+20>>2]=2;break}case 18:{f[n+20>>2]=3;break}case 24:{f[n+20>>2]=4;break}default:{i=n+20|0;if((t|0)==12){f[i>>2]=5;break e}else{f[i>>2]=-1;break e}}}}while(0);a=e+120|0;t=f[a>>2]|0;do{if(t){if(f[t+12>>2]|0){Jt(n,o);break}Ji(f[t+4>>2]|0);Ji(f[(f[a>>2]|0)+8>>2]|0);Ji(f[f[a>>2]>>2]|0);t=f[a>>2]|0;i=f[t+12>>2]|0;if(i){Ji(i);t=f[a>>2]|0}Ji(t);f[a>>2]=0}}while(0);if(f[e+116>>2]|0)$t(n,o,r);t=f[o>>2]|0;if(!t){n=1;b=s;return n|0}f[n+28>>2]=t;f[n+32>>2]=f[e+112>>2];f[o>>2]=0;n=1;b=s;return n|0}function It(e,t){e=e|0;t=t|0;ea(f[e>>2]|0,t);h[e+124>>0]=0;f[e+128>>2]=f[t+8248>>2]&1;return}function Nt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0;w=b;b=b+80|0;E=w+64|0;v=w+56|0;h=w+48|0;g=w+40|0;m=w+32|0;p=w+24|0;if(!((e|0)!=0&(t|0)!=0&(n|0)!=0)){t=0;b=w;return t|0}y=n+16|0;if(((f[y>>2]|0)+-1|0)>>>0>16383){Jr(r,1,16352,w)|0;t=0;b=w;return t|0}if(!(ra(f[e>>2]|0,t,n,r)|0)){t=0;b=w;return t|0}f[e+56>>2]=1785737760;f[e+60>>2]=0;f[e+64>>2]=1;i=Xi(4)|0;a=e+68|0;f[a>>2]=i;if(!i){f[a>>2]=0;Jr(r,1,16421,w+8|0)|0;t=0;b=w;return t|0}f[i>>2]=1785737760;l=f[y>>2]|0;f[e+20>>2]=l;l=Xi(l*12|0)|0;i=e+72|0;f[i>>2]=l;if(!l){f[i>>2]=0;Jr(r,1,16421,w+16|0)|0;t=0;b=w;return t|0}f[e+16>>2]=(f[n+12>>2]|0)-(f[n+4>>2]|0);f[e+12>>2]=(f[n+8>>2]|0)-(f[n>>2]|0);_=n+24|0;c=f[_>>2]|0;o=f[c+24>>2]|0;s=f[c+32>>2]|0;i=e+24|0;f[i>>2]=o+-1+(s<<7);u=f[y>>2]|0;if(u>>>0>1){a=1;do{if((o|0)!=(f[c+(a*52|0)+24>>2]|0))f[i>>2]=255;a=a+1|0}while(a>>>0<u>>>0)}f[e+28>>2]=7;f[e+32>>2]=0;f[e+36>>2]=0;a=(u|0)==0;if(!a?(f[l+8>>2]=o+-1+(s<<7),u>>>0>1):0){i=1;do{f[l+(i*12|0)+8>>2]=(f[c+(i*52|0)+24>>2]|0)+-1+(f[c+(i*52|0)+32>>2]<<7);i=i+1|0}while(i>>>0<u>>>0)}i=e+40|0;e:do{if(!(f[n+32>>2]|0)){f[i>>2]=1;switch(f[n+20>>2]|0){case 1:{f[e+48>>2]=16;break e}case 2:{f[e+48>>2]=17;break e}case 3:{f[e+48>>2]=18;break e}default:break e}}else{f[i>>2]=2;f[e+48>>2]=0}}while(0);e:do{if(!a){a=0;i=0;o=0;do{n=(d[c+(o*52|0)+48>>1]|0)==0;i=(n&1^1)+i|0;a=n?a:o;o=o+1|0}while(o>>>0<u>>>0);o=a;if((i|0)!=1){if(i>>>0<=1)break;Jr(r,2,16717,h)|0;break}switch(f[e+48>>2]|0){case 18:case 16:{a=3;break}case 17:{a=1;break}default:{Jr(r,2,16467,p)|0;break e}}if(u>>>0<(a+1|0)>>>0){Jr(r,2,16541,m)|0;break}if(o>>>0<a>>>0){Jr(r,2,16634,g)|0;break}g=Xi(8)|0;i=e+116|0;f[i>>2]=g;if(!g){Jr(r,1,16782,v)|0;t=0;b=w;return t|0}v=Xi((f[y>>2]|0)*6|0)|0;n=f[i>>2]|0;f[n>>2]=v;if(!v){Jr(r,1,16782,E)|0;t=0;b=w;return t|0}l=f[y>>2]|0;d[n+4>>1]=l;s=f[n>>2]|0;i=0;do{d[s+(i*6|0)>>1]=i;d[s+(i*6|0)+2>>1]=0;E=i;i=i+1|0;d[s+(E*6|0)+4>>1]=i}while((i|0)!=(a|0));if(a>>>0<l>>>0){o=f[_>>2]|0;do{E=(d[o+(a*52|0)+48>>1]|0)==0;d[s+(a*6|0)>>1]=a;i=s+(a*6|0)+2|0;if(E){d[i>>1]=-1;d[s+(a*6|0)+4>>1]=-1}else{d[i>>1]=1;d[(f[n>>2]|0)+(a*6|0)+4>>1]=0}a=a+1|0}while(a>>>0<l>>>0)}}}while(0);f[e+52>>2]=0;f[e+44>>2]=0;f[e+96>>2]=f[t+18692>>2];t=1;b=w;return t|0}function Ft(e,t,n){e=e|0;t=t|0;n=n|0;return ba(f[e>>2]|0,t,n)|0}function Ot(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;r=e+8|0;if(!(_o(f[r>>2]|0,52,n)|0)){n=0;return n|0}a=f[r>>2]|0;o=bo(a)|0;r=Eo(a)|0;if(o){s=0;i=1;while(1){if(!i)i=0;else i=(kc[f[r>>2]&63](e,t,n)|0)!=0;s=s+1|0;if((s|0)==(o|0))break;else{r=r+4|0;i=i&1}}wo(a);if(!i){n=0;return n|0}}else wo(a);n=aa(f[e>>2]|0,t,n)|0;return n|0}function Ht(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;r=e+8|0;if(!(_o(f[r>>2]|0,53,n)|0)){n=0;return n|0}if(!(Ea(f[e>>2]|0,t,n)|0)){n=0;return n|0}s=f[r>>2]|0;a=bo(s)|0;r=Eo(s)|0;if(!a)r=1;else{o=0;i=r;r=1;while(1){if(!r)r=0;else r=(kc[f[i>>2]&63](e,t,n)|0)!=0;r=r&1;o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}wo(s);n=r;return n|0}function Dt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0;i=e+4|0;if(!(_o(f[i>>2]|0,54,r)|0)){t=0;return t|0}o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(kc[f[i>>2]&63](e,t,r)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){t=0;return t|0}}else wo(o);i=e+8|0;if(!(_o(f[i>>2]|0,55,r)|0)){t=0;return t|0}if(!(_o(f[i>>2]|0,56,r)|0)){t=0;return t|0}if(!(_o(f[i>>2]|0,57,r)|0)){t=0;return t|0}if((f[e+96>>2]|0)!=0?(_o(f[i>>2]|0,58,r)|0)==0:0){t=0;return t|0}if(!(_o(f[i>>2]|0,59,r)|0)){t=0;return t|0}o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(kc[f[i>>2]&63](e,t,r)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){t=0;return t|0}}else wo(o);t=wa(f[e>>2]|0,t,n,r)|0;return t|0}function Ut(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;c=t+8|0;if(!(_o(f[c>>2]|0,52,r)|0)){e=0;return e|0}o=f[t+4>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(kc[f[i>>2]&63](t,e,r)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){e=0;return e|0}}else wo(o);o=f[c>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(kc[f[i>>2]&63](t,e,r)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){e=0;return e|0}}else wo(o);e=oa(e,f[t>>2]|0,n,r)|0;return e|0}function Bt(e,t,n,r,i,a,o,s,l,c,u){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;c=c|0;u=u|0;return la(f[e>>2]|0,t,n,r,i,a,o,s,l,c,u)|0}function zt(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;return xa(f[e>>2]|0,t,n,r,i,a)|0}function Vt(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;return ca(f[e>>2]|0,t,n,r,i,a)|0}function jt(e){e=e|0;var t=0,n=0,r=0;if(!e)return;na(f[e>>2]|0);f[e>>2]=0;t=e+72|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+68|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+108|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}r=e+116|0;t=f[r>>2]|0;if(t){n=f[t>>2]|0;if(n){Ji(n);t=f[r>>2]|0;f[t>>2]=0}Ji(t);f[r>>2]=0}r=e+120|0;t=f[r>>2]|0;if(t){n=f[t+12>>2]|0;if(n){Ji(n);t=f[r>>2]|0;f[t+12>>2]=0}n=f[t+4>>2]|0;if(n){Ji(n);t=f[r>>2]|0;f[t+4>>2]=0}n=f[t+8>>2]|0;if(n){Ji(n);t=f[r>>2]|0;f[t+8>>2]=0}n=f[t>>2]|0;if(n){Ji(n);t=f[r>>2]|0;f[t>>2]=0}Ji(t);f[r>>2]=0}t=e+4|0;n=f[t>>2]|0;if(n){yo(n);f[t>>2]=0}t=e+8|0;n=f[t>>2]|0;if(n){yo(n);f[t>>2]=0}Ji(e);return}function Gt(e,t,n,r,i,a,o){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;return ua(f[e>>2]|0,t,n,r,i,a,o)|0}function Wt(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+16|0;if(!n){e=0;b=s;return e|0}Jr(r,2,16826,s)|0;if(!(ya(f[e>>2]|0,t,n,r,i)|0)){Jr(r,1,16303,s+8|0)|0;e=0;b=s;return e|0}o=e+108|0;if(!(Qt(n,o,r)|0)){e=0;b=s;return e|0}i=f[e+48>>2]|0;e:do{switch(i|0){case 16:{f[n+20>>2]=1;break}case 17:{f[n+20>>2]=2;break}case 18:{f[n+20>>2]=3;break}case 24:{f[n+20>>2]=4;break}default:{t=n+20|0;if((i|0)==12){f[t>>2]=5;break e}else{f[t>>2]=-1;break e}}}}while(0);a=e+120|0;t=f[a>>2]|0;do{if(t){if(f[t+12>>2]|0){Jt(n,o);break}Ji(f[t+4>>2]|0);Ji(f[(f[a>>2]|0)+8>>2]|0);Ji(f[f[a>>2]>>2]|0);t=f[a>>2]|0;i=f[t+12>>2]|0;if(i){Ji(i);t=f[a>>2]|0}Ji(t);f[a>>2]=0}}while(0);if(f[e+116>>2]|0)$t(n,o,r);t=f[o>>2]|0;if(!t){e=1;b=s;return e|0}f[n+28>>2]=t;f[n+32>>2]=f[e+112>>2];f[o>>2]=0;e=1;b=s;return e|0}function qt(e){e=e|0;var t=0;t=Yi(1,136)|0;if(!t)return t|0;if(!e){e=ta()|0;f[t>>2]=e}else{e=ha()|0;f[t>>2]=e}if(!e){jt(t);t=0;return t|0}e=t+108|0;f[e>>2]=0;f[e+4>>2]=0;f[e+8>>2]=0;f[e+12>>2]=0;h[e+16>>0]=0;e=vo()|0;f[t+4>>2]=e;if(!e){jt(t);t=0;return t|0}e=vo()|0;f[t+8>>2]=e;if(e)return t|0;jt(t);t=0;return t|0}function Xt(e,t,n){e=e|0;t=t|0;n=n|0;da(f[e>>2]|0,t,n);return}function Yt(e){e=e|0;return ga(f[e>>2]|0)|0}function Kt(e){e=e|0;return ma(f[e>>2]|0)|0}function Zt(e,t,n){e=e|0;t=t|0;n=n|0;return _a(f[e>>2]|0,t,n)|0}function Qt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0;S=b;b=b+80|0;M=S+72|0;A=S+64|0;T=S+56|0;x=S+48|0;w=S+40|0;E=S+32|0;_=S+24|0;v=S+16|0;l=S+8|0;s=S;r=f[t+8>>2]|0;e:do{if(r){g=f[r>>2]|0;u=d[r+4>>1]|0;r=f[e+16>>2]|0;c=f[t+12>>2]|0;if((c|0)!=0?(f[c+12>>2]|0)!=0:0)t=p[c+18>>0]|0;else t=r;o=u<<16>>16==0;t:do{if(!o){a=0;n:while(1){i=a&65535;r=m[g+(i*6|0)>>1]|0;if(r>>>0>=t>>>0){i=15;break}r=d[g+(i*6|0)+4>>1]|0;switch(r<<16>>16){case 0:case-1:break;default:{r=(r&65535)+-1|0;if(r>>>0>=t>>>0){i=18;break n}}}a=a+1<<16>>16;if((a&65535)>=(u&65535))break t}if((i|0)==15){f[s>>2]=r;f[s+4>>2]=t;Jr(n,1,19343,s)|0;n=0;b=S;return n|0}else if((i|0)==18){f[l>>2]=r;f[l+4>>2]=t;Jr(n,1,19343,l)|0;n=0;b=S;return n|0}}}while(0);if(!t)r=c;else{t:do{if(!o)while(1){t=t+-1|0;r=0;do{if((m[g+((r&65535)*6|0)>>1]|0)==(t|0))break;r=r+1<<16>>16}while((r&65535)<(u&65535));if(r<<16>>16==u<<16>>16)break t;if(!t){r=c;break e}}}while(0);Jr(n,1,19380,v)|0;n=0;b=S;return n|0}}else r=f[t+12>>2]|0}while(0);if(!r){n=1;b=S;return n|0}y=f[r+12>>2]|0;if(!y){n=1;b=S;return n|0}c=h[r+18>>0]|0;v=c&255;g=c<<24>>24==0;if(g)r=1;else{a=e+16|0;t=0;o=0;r=1;do{t=m[y+(t<<2)>>1]|0;i=f[a>>2]|0;if(t>>>0>=i>>>0){f[_>>2]=t;f[_+4>>2]=i;Jr(n,1,19343,_)|0;r=0}o=o+1<<16>>16;t=o&65535}while(t>>>0<v>>>0)}u=Yi(v,4)|0;if(!u){Jr(n,1,19413,E)|0;n=0;b=S;return n|0}if(!g){s=0;l=0;do{i=h[y+(s<<2)+3>>0]|0;a=i&255;do{if((i&255)<(c&255)){o=u+(a<<2)|0;t=h[y+(s<<2)+2>>0]|0;if((f[o>>2]|0)!=0&t<<24>>24==1){f[x>>2]=a;Jr(n,1,19486,x)|0;r=0;break}if(t<<24>>24!=0|i<<24>>24==0){f[o>>2]=1;break}else{f[T>>2]=s;f[T+4>>2]=a;Jr(n,1,19517,T)|0;r=0;break}}else{f[w>>2]=a;Jr(n,1,19430,w)|0;r=0}}while(0);l=l+1<<16>>16;s=l&65535}while(s>>>0<v>>>0);if(!g){t=0;i=0;do{if((f[u+(t<<2)>>2]|0)==0?(h[y+(t<<2)+2>>0]|0)!=0:0){f[A>>2]=t;Jr(n,1,19553,A)|0;r=0}i=i+1<<16>>16;t=i&65535}while(t>>>0<v>>>0)}}if(!r){Ji(u);n=0;b=S;return n|0}e:do{if(!((f[e+16>>2]|0)!=1|g)){r=0;t=0;while(1){t=t+1<<16>>16;if(!(f[u+(r<<2)>>2]|0))break;r=t&65535;if(r>>>0>=v>>>0)break e}f[M>>2]=r;Jr(n,2,19591,M)|0;if(!g){r=0;t=0;do{h[y+(r<<2)+2>>0]=1;h[y+(r<<2)+3>>0]=t;t=t+1<<16>>16;r=t&65535}while(r>>>0<v>>>0)}}}while(0);Ji(u);n=1;b=S;return n|0}function Jt(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0;w=t+12|0;t=f[w>>2]|0;s=f[t+8>>2]|0;c=f[t+4>>2]|0;g=f[t>>2]|0;v=f[t+12>>2]|0;t=h[t+18>>0]|0;y=e+24|0;_=f[y>>2]|0;b=t&255;E=Xi(b*52|0)|0;if(!E)return;l=t<<24>>24==0;if(!l){a=0;o=0;do{t=d[v+(a<<2)>>1]|0;if(!(h[v+(a<<2)+2>>0]|0)){t=t&65535;n=E+(a*52|0)|0;r=_+(t*52|0)|0;i=n+52|0;do{f[n>>2]=f[r>>2];n=n+4|0;r=r+4|0}while((n|0)<(i|0))}else{t=t&65535;n=E+((p[v+(a<<2)+3>>0]|0)*52|0)|0;r=_+(t*52|0)|0;i=n+52|0;do{f[n>>2]=f[r>>2];n=n+4|0;r=r+4|0}while((n|0)<(i|0))}i=Xi(ue(f[_+(t*52|0)+8>>2]<<2,f[_+(t*52|0)+12>>2]|0)|0)|0;f[E+(a*52|0)+44>>2]=i;if(!i){u=7;break}f[E+(a*52|0)+24>>2]=p[s+a>>0];f[E+(a*52|0)+32>>2]=p[c+a>>0];o=o+1<<16>>16;a=o&65535}while(a>>>0<b>>>0);if((u|0)==7){Ji(E);return}s=(m[(f[w>>2]|0)+16>>1]|0)+-1|0;if(!l){t=0;o=0;do{i=f[_+((m[v+(t<<2)>>1]|0)*52|0)+44>>2]|0;r=p[v+(t<<2)+3>>0]|0;a=ue(f[E+(r*52|0)+12>>2]|0,f[E+(r*52|0)+8>>2]|0)|0;if(!(h[v+(t<<2)+2>>0]|0)){t=f[E+(t*52|0)+44>>2]|0;if(a){n=0;do{f[t+(n<<2)>>2]=f[i+(n<<2)>>2];n=n+1|0}while((n|0)!=(a|0))}}else{t=f[E+(r*52|0)+44>>2]|0;if(a){n=0;do{u=f[i+(n<<2)>>2]|0;u=g+((ue((u|0)<0?0:(u|0)>(s|0)?s:u,b)|0)+r<<2)|0;f[t+(n<<2)>>2]=f[u>>2];n=n+1|0}while((n|0)!=(a|0))}}o=o+1<<16>>16;t=o&65535}while(t>>>0<b>>>0)}}n=e+16|0;r=f[n>>2]|0;if(r){t=0;i=0;do{t=f[_+(t*52|0)+44>>2]|0;if(t)Ji(t);i=i+1<<16>>16;t=i&65535}while(t>>>0<r>>>0)}Ji(_);f[y>>2]=E;f[n>>2]=b;Ji(f[(f[w>>2]|0)+4>>2]|0);Ji(f[(f[w>>2]|0)+8>>2]|0);Ji(f[f[w>>2]>>2]|0);t=f[w>>2]|0;n=f[t+12>>2]|0;if(n){Ji(n);t=f[w>>2]|0}Ji(t);f[w>>2]=0;return}function $t(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0;T=b;b=b+80|0;w=T+8|0;E=T;_=T+16|0;x=t+8|0;r=f[x>>2]|0;t=f[r>>2]|0;y=d[r+4>>1]|0;if(y<<16>>16){v=e+16|0;h=e+24|0;m=1;g=0;while(1){p=d[t+(g*6|0)>>1]|0;u=p&65535;e=f[v>>2]|0;e:do{if(u>>>0<e>>>0){r=d[t+(g*6|0)+4>>1]|0;switch(r<<16>>16){case-1:case 0:{d[(f[h>>2]|0)+(u*52|0)+48>>1]=d[t+(g*6|0)+2>>1]|0;break e}default:{}}s=(r&65535)+65535|0;c=s&65535;s=s&65535;if(s>>>0>=e>>>0){f[w>>2]=s;f[w+4>>2]=e;Jr(n,2,19302,w)|0;break}l=t+(g*6|0)+2|0;if((u|0)!=(s|0)?(d[l>>1]|0)==0:0){r=f[h>>2]|0;e=r+(u*52|0)|0;i=_;a=e;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));i=e;a=r+(s*52|0)|0;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));i=(f[h>>2]|0)+(s*52|0)|0;a=_;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));if((g+1&65535)<(y&65535)){i=m;do{r=t+(i*6|0)|0;e=d[r>>1]|0;if(e<<16>>16!=p<<16>>16){if(e<<16>>16==c<<16>>16)d[r>>1]=p}else d[r>>1]=c;i=i+1|0}while((i&65535)<<16>>16!=y<<16>>16)}}d[(f[h>>2]|0)+(u*52|0)+48>>1]=d[l>>1]|0}else{f[E>>2]=u;f[E+4>>2]=e;Jr(n,2,19262,E)|0}}while(0);g=g+1|0;if((g&65535)<<16>>16==y<<16>>16)break;else m=m+1|0}t=f[x>>2]|0;r=t;t=f[t>>2]|0}if(!t){w=r;Ji(w);f[x>>2]=0;b=T;return}else{Ji(t);w=f[x>>2]|0;Ji(w);f[x>>2]=0;b=T;return}}function en(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0;I=b;b=b+192|0;T=I+152|0;x=I+144|0;w=I+136|0;E=I+128|0;_=I+120|0;k=I+88|0;v=I+80|0;m=I+64|0;p=I+48|0;L=I+40|0;A=I+32|0;P=I+24|0;y=I+16|0;g=I+8|0;h=I+176|0;d=I+168|0;R=I+156|0;r=Yi(1,1024)|0;if(!r){Jr(n,1,17098,I)|0;C=0;b=I;return C|0}u=h+4|0;M=R+4|0;S=e+100|0;c=1024;e:while(1){if((Gr(t,h,8,n)|0)!=8)break;while(1){wr(h,R,4);wr(u,M,4);switch(f[R>>2]|0){case 0:{i=Yr(t)|0;l=B;if((l|0)>0|(l|0)==0&i>>>0>4294967287){C=6;break e}f[R>>2]=i+8;s=8;break}case 1:{if((Gr(t,h,8,n)|0)!=8)break e;wr(h,d,4);if(f[d>>2]|0){C=10;break e}wr(u,R,4);s=16;break}default:s=8}a=f[M>>2]|0;if((a|0)==1785737827){C=13;break e}i=f[R>>2]|0;if(!i){C=17;break e}if(i>>>0<s>>>0){C=19;break e}if((a|0)==1783636e3){o=1084;a=s;C=22;break}if((a|0)==1718909296){o=1092;a=s;C=22;break}l=(a|0)==1785737832;t:do{if((a|0)!=1768449138)if((a|0)!=1668246642)if((a|0)!=1651532643)if((a|0)!=1885564018)if((a|0)!=1668112752){o=(a|0)==1667523942?1148:0;i=i-s|0;if((a|0)<1785737832)switch(a|0){case 1667523942:{C=30;break t}default:{}}else switch(a|0){case 1785737832:{C=30;break t}default:{}}a=f[S>>2]|0;if(!(a&1)){C=45;break e}if(!(a&2)){C=47;break e}f[S>>2]=a|2147483647;l=Kr(t,i,0,n)|0;if(!((l|0)==(i|0)&(B|0)==0)){C=50;break e}}else{o=1140;C=28}else{o=1132;C=28}else{o=1124;C=28}else{o=1116;C=28}else{o=1108;C=28}}while(0);if((C|0)==28){i=i-s|0;C=30}if((C|0)==30){C=0;if(l){o=1100;break}f[p>>2]=a>>>24;f[p+4>>2]=a>>>16&255;f[p+8>>2]=a>>>8&255;f[p+12>>2]=a&255;Jr(n,2,17282,p)|0;if(f[S>>2]&4)break;l=f[M>>2]|0;f[m>>2]=l>>>24;f[m+4>>2]=l>>>16&255;f[m+8>>2]=l>>>8&255;f[m+12>>2]=l&255;Jr(n,2,17333,m)|0;f[S>>2]=f[S>>2]|2147483647;l=Kr(t,i,0,n)|0;if(!((l|0)==(i|0)&(B|0)==0)){C=33;break e}}if((Gr(t,h,8,n)|0)!=8)break e}if((C|0)==22){C=0;i=i-a|0}l=Yr(t)|0;s=B;if(0>(s|0)|0==(s|0)&i>>>0>l>>>0){C=35;break}if(i>>>0>c>>>0){a=Qi(r,i)|0;if(!a){C=38;break}else{r=a;a=i}}else a=c;if((Gr(t,r,i,n)|0)!=(i|0)){C=40;break}if(!(Hc[f[o+4>>2]&63](e,r,i,n)|0)){C=43;break}else c=a}switch(C|0){case 6:{Jr(n,1,17148,g)|0;break}case 10:{Jr(n,1,17148,y)|0;break}case 13:{i=f[S>>2]|0;if(!(i&4)){Jr(n,1,17190,P)|0;Ji(r);C=0;b=I;return C|0}else{f[S>>2]=i|8;Ji(r);C=1;b=I;return C|0}}case 17:{Jr(n,1,17218,A)|0;Ji(r);C=0;b=I;return C|0}case 19:{f[L>>2]=i;f[L+4>>2]=a;Jr(n,1,17256,L)|0;Ji(r);C=0;b=I;return C|0}case 33:{Jr(n,1,17399,v)|0;Ji(r);C=0;b=I;return C|0}case 35:{P=f[R>>2]|0;L=f[M>>2]|0;C=Yr(t)|0;f[k>>2]=P;f[k+4>>2]=L>>>24;f[k+8>>2]=L>>>16&255;f[k+12>>2]=L>>>8&255;f[k+16>>2]=L&255;f[k+20>>2]=i;f[k+24>>2]=C;Jr(n,1,17449,k)|0;Ji(r);C=0;b=I;return C|0}case 38:{Ji(r);Jr(n,1,17525,_)|0;C=0;b=I;return C|0}case 40:{Jr(n,1,17567,E)|0;Ji(r);C=0;b=I;return C|0}case 43:{Ji(r);C=0;b=I;return C|0}case 45:{Jr(n,1,17616,w)|0;Ji(r);C=0;b=I;return C|0}case 47:{Jr(n,1,17686,x)|0;Ji(r);C=0;b=I;return C|0}case 50:{Jr(n,1,17399,T)|0;Ji(r);C=0;b=I;return C|0}}Ji(r);C=1;b=I;return C|0}function tn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;o=b;b=b+32|0;a=o+24|0;r=Xr(t)|0;i=B;e=e+80|0;s=e;s=zl(r|0,i|0,f[s>>2]|0,f[s+4>>2]|0)|0;Er(a,s,4);Er(a+4|0,1785737827,4);if(!(Zr(t,f[e>>2]|0,f[e+4>>2]|0,n)|0)){Jr(n,1,17067,o)|0;s=0;b=o;return s|0}if((Wr(t,a,8,n)|0)!=8){Jr(n,1,17067,o+8|0)|0;s=0;b=o;return s|0}if(Zr(t,r,i,n)|0){s=1;b=o;return s|0}Jr(n,1,17067,o+16|0)|0;s=0;b=o;return s|0}function nn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;n=((f[e>>2]|0)!=0?(f[e+104>>2]|f[e+100>>2]|0)==0:0)&(f[e+8>>2]|0)!=0&(f[e+4>>2]|0)!=0&(f[e+64>>2]|0)!=0&(f[e+16>>2]|0)!=0&(f[e+12>>2]|0)!=0&1;r=f[e+20>>2]|0;if(!r){a=n;e=e+40|0;e=f[e>>2]|0;e=e+-1|0;e=e>>>0<2;e=e&1;t=Qr(t)|0;t=t&a;e=t&e;return e|0}i=f[e+72>>2]|0;a=0;do{n=(f[i+(a*12|0)+8>>2]&126)>>>0<38&n;a=a+1|0}while(a>>>0<r>>>0);e=e+40|0;e=f[e>>2]|0;e=e+-1|0;e=e>>>0<2;e=e&1;t=Qr(t)|0;t=t&n;e=t&e;return e|0}function rn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;e=b;b=b+16|0;r=e;Er(r,12,4);Er(r+4|0,1783636e3,4);Er(r+8|0,218793738,4);n=(Wr(t,r,12,n)|0)==12&1;b=e;return n|0}function an(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;c=b;b=b+16|0;l=c+8|0;i=e+64|0;o=(f[i>>2]<<2)+16|0;s=Yi(1,o)|0;if(!s){Jr(n,1,16987,c)|0;l=0;b=c;return l|0}Er(s,o,4);Er(s+4|0,1718909296,4);Er(s+8|0,f[e+56>>2]|0,4);Er(s+12|0,f[e+60>>2]|0,4);a=s+16|0;if(f[i>>2]|0){e=e+68|0;r=0;do{Er(a,f[(f[e>>2]|0)+(r<<2)>>2]|0,4);r=r+1|0}while(r>>>0<(f[i>>2]|0)>>>0)}e=(Wr(t,s,o,n)|0)==(o|0);if(!e)Jr(n,1,17026,l)|0;Ji(s);l=e&1;b=c;return l|0}function on(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0;m=b;b=b+80|0;d=m+16|0;u=m+8|0;l=m;i=m+24|0;c=m+72|0;r=i;a=r+48|0;do{f[r>>2]=0;r=r+4|0}while((r|0)<(a|0));p=(f[e+24>>2]|0)==255;f[i>>2]=2;r=i+12|0;if(p){f[r>>2]=3;f[i+24>>2]=4;r=3}else{f[r>>2]=4;r=2}if(!(f[e+116>>2]|0))p=r;else{f[i+(r*12|0)>>2]=5;p=r+1|0}Er(c+4|0,1785737832,4);o=0;s=i;r=8;while(1){a=s+8|0;g=Dc[f[s>>2]&7](e,a)|0;f[s+4>>2]=g;if(!g){h=8;break}r=(f[a>>2]|0)+r|0;o=o+1|0;if((o|0)>=(p|0))break;else s=s+12|0}if((h|0)==8){Jr(n,1,16901,l)|0;a=0;while(1){r=f[i+4>>2]|0;if(r)Ji(r);a=a+1|0;if((a|0)>=(p|0)){r=0;break}else i=i+12|0}b=m;return r|0}Er(c,r,4);e:do{if((Wr(t,c,8,n)|0)==8){r=0;a=i;while(1){g=a+8|0;h=Wr(t,f[a+4>>2]|0,f[g>>2]|0,n)|0;if((h|0)!=(f[g>>2]|0))break;r=r+1|0;if((r|0)>=(p|0)){r=1;break e}else a=a+12|0}Jr(n,1,16944,d)|0;r=0}else{Jr(n,1,16944,u)|0;r=0}}while(0);o=0;while(1){a=f[i+4>>2]|0;if(a)Ji(a);o=o+1|0;if((o|0)>=(p|0))break;else i=i+12|0}b=m;return r|0}function sn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;r=Xr(t)|0;e=e+88|0;f[e>>2]=r;f[e+4>>2]=B;t=Kr(t,24,0,n)|0;return(t|0)==24&(B|0)==0&1|0}function ln(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;r=Xr(t)|0;e=e+80|0;f[e>>2]=r;f[e+4>>2]=B;t=Kr(t,8,0,n)|0;return(t|0)==8&(B|0)==0&1|0}function cn(e,t){e=e|0;t=t|0;var n=0;n=Yi(1,22)|0;if(!n){t=0;return t|0}Er(n,22,4);Er(n+4|0,1768449138,4);Er(n+8|0,f[e+16>>2]|0,4);Er(n+12|0,f[e+12>>2]|0,4);Er(n+16|0,f[e+20>>2]|0,2);Er(n+18|0,f[e+24>>2]|0,1);Er(n+19|0,f[e+28>>2]|0,1);Er(n+20|0,f[e+32>>2]|0,1);Er(n+21|0,f[e+36>>2]|0,1);f[t>>2]=22;t=n;return t|0}function un(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;i=e+20|0;a=(f[i>>2]|0)+8|0;o=Yi(1,a)|0;if(!o){t=0;return t|0}Er(o,a,4);Er(o+4|0,1651532643,4);if(f[i>>2]|0){e=e+72|0;n=0;r=o+8|0;while(1){Er(r,f[(f[e>>2]|0)+(n*12|0)+8>>2]|0,1);n=n+1|0;if(n>>>0>=(f[i>>2]|0)>>>0)break;else r=r+1|0}}f[t>>2]=a;t=o;return t|0}function hn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0;n=e+40|0;switch(f[n>>2]|0){case 1:{s=15;break}case 2:{s=(f[e+112>>2]|0)+11|0;break}default:{t=0;return t|0}}o=Yi(1,s)|0;if(!o){t=0;return t|0}Er(o,s,4);Er(o+4|0,1668246642,4);Er(o+8|0,f[n>>2]|0,1);Er(o+9|0,f[e+52>>2]|0,1);Er(o+10|0,f[e+44>>2]|0,1);i=o+11|0;switch(f[n>>2]|0){case 1:{Er(i,f[e+48>>2]|0,4);break}case 2:{a=e+112|0;if(f[a>>2]|0){e=e+108|0;r=0;n=i;while(1){Er(n,p[(f[e>>2]|0)+r>>0]|0,1);r=r+1|0;if(r>>>0>=(f[a>>2]|0)>>>0)break;else n=n+1|0}}break}default:{}}f[t>>2]=s;t=o;return t|0}function dn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0;a=e+116|0;o=((m[(f[a>>2]|0)+4>>1]|0)*6|0)+10|0;s=Xi(o)|0;if(!s){t=0;return t|0}Er(s,o,4);Er(s+4|0,1667523942,4);Er(s+8|0,m[(f[a>>2]|0)+4>>1]|0,2);e=f[a>>2]|0;if(d[e+4>>1]|0){r=0;n=0;i=s+10|0;while(1){Er(i,m[(f[e>>2]|0)+(r*6|0)>>1]|0,2);Er(i+2|0,m[(f[f[a>>2]>>2]|0)+(r*6|0)+2>>1]|0,2);Er(i+4|0,m[(f[f[a>>2]>>2]|0)+(r*6|0)+4>>1]|0,2);n=n+1<<16>>16;e=f[a>>2]|0;if((n&65535)>=(m[e+4>>1]|0))break;else{r=n&65535;i=i+6|0}}}f[t>>2]=o;t=s;return t|0}function fn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;a=b;b=b+32|0;i=a+16|0;if((n|0)!=14){Jr(r,1,18507,a)|0;i=0;b=a;return i|0}wr(t,e+16|0,4);wr(t+4|0,e+12|0,4);n=e+20|0;wr(t+8|0,n,2);n=Yi(f[n>>2]|0,12)|0;f[e+72>>2]=n;if(!n){Jr(r,1,18540,a+8|0)|0;i=0;b=a;return i|0}wr(t+10|0,e+24|0,1);n=e+28|0;wr(t+11|0,n,1);n=f[n>>2]|0;if((n|0)!=7){f[i>>2]=n;Jr(r,4,18589,i)|0}wr(t+12|0,e+32|0,1);wr(t+13|0,e+36|0,1);i=1;b=a;return i|0}function pn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0;x=b;b=b+80|0;o=x+40|0;y=x+32|0;l=x+24|0;s=x+16|0;_=x+72|0;v=x+68|0;p=x+64|0;m=x+60|0;u=x+56|0;g=x+52|0;d=x+48|0;c=x+44|0;if(n>>>0<3){Jr(r,1,18180,x)|0;w=0;b=x;return w|0}E=e+108|0;w=e+124|0;if(h[w>>0]|0){Jr(r,4,18212,x+8|0)|0;w=1;b=x;return w|0}a=e+40|0;wr(t,a,1);wr(t+1|0,e+52|0,1);wr(t+2|0,e+44|0,1);i=t+3|0;a=f[a>>2]|0;switch(a|0){case 1:{if(n>>>0<7){f[s>>2]=n;Jr(r,1,18321,s)|0;w=0;b=x;return w|0}a=e+48|0;if(n>>>0>7?(f[a>>2]|0)!=14:0){f[l>>2]=n;Jr(r,2,18321,l)|0}wr(i,a,4);if((f[a>>2]|0)==14){i=Xi(36)|0;f[i>>2]=14;f[d>>2]=0;f[u>>2]=0;f[p>>2]=0;f[g>>2]=0;f[m>>2]=0;f[v>>2]=0;f[c>>2]=4470064;a=i+4|0;f[a>>2]=1145390592;switch(n|0){case 35:{wr(t+7|0,v,4);wr(t+11|0,p,4);wr(t+15|0,m,4);wr(t+19|0,u,4);wr(t+23|0,g,4);wr(t+27|0,d,4);wr(t+31|0,c,4);f[a>>2]=0;break}case 7:break;default:{f[y>>2]=n;Jr(r,2,18357,y)|0}}f[i+8>>2]=f[v>>2];f[i+16>>2]=f[m>>2];f[i+24>>2]=f[g>>2];f[i+12>>2]=f[p>>2];f[i+20>>2]=f[u>>2];f[i+28>>2]=f[d>>2];f[i+32>>2]=f[c>>2];f[E>>2]=i;f[e+112>>2]=0}h[w>>0]=1;w=1;b=x;return w|0}case 2:{o=n+-3|0;a=e+112|0;f[a>>2]=o;e=Yi(1,o)|0;f[E>>2]=e;if(!e){f[a>>2]=0;w=0;b=x;return w|0}if((n|0)>3){a=0;while(1){wr(i,_,1);h[(f[E>>2]|0)+a>>0]=f[_>>2];a=a+1|0;if((a|0)==(o|0))break;else i=i+1|0}}h[w>>0]=1;w=1;b=x;return w|0}default:{if(a>>>0<=2){w=1;b=x;return w|0}f[o>>2]=a;Jr(r,4,18401,o)|0;w=1;b=x;return w|0}}return 0}function mn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0;s=b;b=b+16|0;a=s;i=f[e+24>>2]|0;if((i|0)!=255){f[a>>2]=i;Jr(r,2,18034,a)|0}o=e+20|0;if((f[o>>2]|0)!=(n|0)){Jr(r,1,18148,s+8|0)|0;o=0;b=s;return o|0}if(!n){o=1;b=s;return o|0}a=e+72|0;i=0;while(1){wr(t,(f[a>>2]|0)+(i*12|0)+8|0,1);i=i+1|0;if(i>>>0>=(f[o>>2]|0)>>>0){t=1;break}else t=t+1|0}b=s;return t|0}function gn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,m=0,g=0;g=b;b=b+16|0;i=g;m=g+12|0;a=e+120|0;if(n>>>0<3|(f[a>>2]|0)!=0){n=0;b=g;return n|0}wr(t,m,2);o=f[m>>2]|0;u=o&65535;if((u+-1|0)>>>0>1023){f[i>>2]=u;Jr(r,1,17951,i)|0;n=0;b=g;return n|0}wr(t+2|0,m,1);c=f[m>>2]&65535;if(!c){Jr(r,1,17989,g+8|0)|0;n=0;b=g;return n|0}if((c+3|0)>>>0>n>>>0){n=0;b=g;return n|0}i=Xi(ue(u<<2,c)|0)|0;if(!i){n=0;b=g;return n|0}l=Xi(c)|0;if(!l){Ji(i);n=0;b=g;return n|0}s=Xi(c)|0;if(!s){Ji(i);Ji(l);n=0;b=g;return n|0}e=Xi(20)|0;if(!e){Ji(i);Ji(l);Ji(s);n=0;b=g;return n|0}f[e+4>>2]=s;f[e+8>>2]=l;f[e>>2]=i;d[e+16>>1]=o;h[e+18>>0]=f[m>>2];f[e+12>>2]=0;f[a>>2]=e;e=t+3|0;r=0;a=0;do{wr(e,m,1);e=e+1|0;h[l+r>>0]=(f[m>>2]&127)+1;h[s+r>>0]=(f[m>>2]|0)>>>7&1;a=a+1<<16>>16;r=a&65535}while(r>>>0<c>>>0);if(!u){n=1;b=g;return n|0}r=0;e:while(1){o=0;a=i;s=0;while(1){i=((p[l+o>>0]|0)+7|0)>>>3;i=i>>>0>4?4:i;if((e-t+i|0)>(n|0)){e=0;i=22;break e}wr(e,m,i);e=e+i|0;f[a>>2]=f[m>>2];i=a+4|0;s=s+1<<16>>16;o=s&65535;if(o>>>0>=c>>>0)break;else a=i}r=r+1<<16>>16;if((r&65535)>>>0>=u>>>0){e=1;i=22;break}}if((i|0)==22){b=g;return e|0}return 0}function vn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;o=s+20|0;a=e+120|0;e=f[a>>2]|0;if(!e){Jr(r,1,17841,s)|0;o=0;b=s;return o|0}if(f[e+12>>2]|0){Jr(r,1,17887,s+8|0)|0;o=0;b=s;return o|0}i=h[e+18>>0]|0;e=(i&255)<<2;if(e>>>0>n>>>0){Jr(r,1,17918,s+16|0)|0;o=0;b=s;return o|0}r=Xi(e)|0;if(!r){o=0;b=s;return o|0}if(i<<24>>24){e=t;n=0;while(1){wr(e,o,2);d[r+(n<<2)>>1]=f[o>>2];wr(e+2|0,o,1);h[r+(n<<2)+2>>0]=f[o>>2];wr(e+3|0,o,1);h[r+(n<<2)+3>>0]=f[o>>2];n=n+1|0;if((n&255)<<24>>24==i<<24>>24)break;else e=e+4|0}}f[(f[a>>2]|0)+12>>2]=r;o=1;b=s;return o|0}function yn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;o=s+20|0;a=e+116|0;if(f[a>>2]|0){o=0;b=s;return o|0}if(n>>>0<2){Jr(r,1,17747,s)|0;o=0;b=s;return o|0}wr(t,o,2);e=f[o>>2]|0;i=e&65535;if(!i){Jr(r,1,17780,s+8|0)|0;o=0;b=s;return o|0}if(((i*6|0)+2|0)>>>0>n>>>0){Jr(r,1,17747,s+16|0)|0;o=0;b=s;return o|0}n=Xi(e*6|0)|0;if(!n){o=0;b=s;return o|0}e=Xi(8)|0;f[a>>2]=e;if(!e){Ji(n);o=0;b=s;return o|0}f[e>>2]=n;r=f[o>>2]&65535;d[e+4>>1]=r;if(!(r<<16>>16)){o=1;b=s;return o|0}else{i=0;e=t}do{t=i&65535;wr(e+2|0,o,2);d[n+(t*6|0)>>1]=f[o>>2];wr(e+4|0,o,2);e=e+6|0;d[n+(t*6|0)+2>>1]=f[o>>2];wr(e,o,2);d[n+(t*6|0)+4>>1]=f[o>>2];i=i+1<<16>>16}while((i&65535)<(m[(f[a>>2]|0)+4>>1]|0));e=1;b=s;return e|0}function _n(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;a=b;b=b+32|0;i=a+20|0;e=e+100|0;if(f[e>>2]|0){Jr(r,1,19130,a)|0;r=0;b=a;return r|0}if((n|0)!=4){Jr(r,1,19184,a+8|0)|0;r=0;b=a;return r|0}wr(t,i,4);if((f[i>>2]|0)==218793738){f[e>>2]=f[e>>2]|1;r=1;b=a;return r|0}else{Jr(r,1,19218,a+16|0)|0;r=0;b=a;return r|0}return 0}function bn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;a=s+24|0;o=e+100|0;if((f[o>>2]|0)!=1){Jr(r,1,19011,s)|0;o=0;b=s;return o|0}if(n>>>0<8){Jr(r,1,19061,s+8|0)|0;o=0;b=s;return o|0}wr(t,e+56|0,4);wr(t+4|0,e+60|0,4);t=t+8|0;n=n+-8|0;if(n&3){Jr(r,1,19061,s+16|0)|0;o=0;b=s;return o|0}n=n>>>2;i=e+64|0;f[i>>2]=n;if(n){n=Yi(n,4)|0;f[e+68>>2]=n;if(!n){Jr(r,1,19097,a)|0;o=0;b=s;return o|0}if(f[i>>2]|0){e=e+68|0;n=0;while(1){wr(t,(f[e>>2]|0)+(n<<2)|0,4);n=n+1|0;if(n>>>0>=(f[i>>2]|0)>>>0)break;else t=t+4|0}}}f[o>>2]=f[o>>2]|2;o=1;b=s;return o|0}function En(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0;M=b;b=b+96|0;T=M+72|0;v=M+64|0;g=M+56|0;m=M+48|0;w=M+40|0;E=M+32|0;_=M+24|0;y=M+16|0;p=M+8|0;h=M+80|0;d=M+76|0;x=e+100|0;if(!(f[x>>2]&2)){Jr(r,1,18679,M)|0;A=0;b=M;return A|0}u=e+104|0;f[u>>2]=0;do{if(n){l=t;t=0;e:while(1){if(n>>>0<8){A=6;break}wr(l,h,4);i=f[h>>2]|0;wr(l+4|0,h,4);s=f[h>>2]|0;switch(i|0){case 0:{A=14;break e}case 1:{if(n>>>0<16){A=9;break e}wr(l+8|0,d,4);if(f[d>>2]|0){A=11;break e}wr(l+12|0,h,4);i=f[h>>2]|0;if(!i){A=13;break e}else a=16;break}default:a=8}if(i>>>0<a>>>0){A=16;break}if(n>>>0<i>>>0){A=19;break}o=(s|0)==1768449138;if(!o)if((s|0)!=1668246642)if((s|0)!=1651532643)if((s|0)!=1885564018)if((s|0)!=1668112752)if((s|0)==1667523942){c=1148;A=26}else f[u>>2]=f[u>>2]|2147483647;else{c=1140;A=26}else{c=1132;A=26}else{c=1124;A=26}else{c=1116;A=26}else{c=1108;A=26}if((A|0)==26?(A=0,(Hc[f[c+4>>2]&63](e,l+a|0,i-a|0,r)|0)==0):0){t=0;A=32;break}t=o?1:t;if((n|0)==(i|0)){A=29;break}else{l=l+i|0;n=n-i|0}}if((A|0)==6)Jr(r,1,18724,p)|0;else if((A|0)==9)Jr(r,1,18764,y)|0;else if((A|0)==11)Jr(r,1,17148,_)|0;else if((A|0)==13)Jr(r,1,17218,E)|0;else if((A|0)==14)Jr(r,1,17218,w)|0;else if((A|0)==16)Jr(r,1,18808,m)|0;else if((A|0)==19){Jr(r,1,18880,v)|0;A=0;b=M;return A|0}else if((A|0)==29){if(!t)break;f[x>>2]=f[x>>2]|4;A=1;b=M;return A|0}else if((A|0)==32){b=M;return t|0}Jr(r,1,18837,g)|0;A=0;b=M;return A|0}}while(0);Jr(r,1,18952,T)|0;A=0;b=M;return A|0}function wn(){return 8}function xn(){return 32}function Tn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0;if(!r)return;else i=0;do{u=e+(i<<2)|0;s=f[u>>2]|0;l=t+(i<<2)|0;o=f[l>>2]|0;a=n+(i<<2)|0;c=f[a>>2]|0;f[u>>2]=(o<<1)+s+c>>2;f[l>>2]=c-o;f[a>>2]=s-o;i=i+1|0}while((i|0)!=(r|0));return}function An(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0;if(!r)return;else i=0;do{c=e+(i<<2)|0;l=t+(i<<2)|0;o=f[l>>2]|0;a=n+(i<<2)|0;u=f[a>>2]|0;s=(f[c>>2]|0)-(u+o>>2)|0;f[c>>2]=s+u;f[l>>2]=s;f[a>>2]=s+o;i=i+1|0}while((i|0)!=(r|0));return}function Mn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0;if(!r)return;else i=0;do{p=e+(i<<2)|0;b=f[p>>2]|0;c=t+(i<<2)|0;_=f[c>>2]|0;a=n+(i<<2)|0;y=f[a>>2]|0;l=((b|0)<0)<<31>>31;g=Jl(b|0,l|0,2449,0)|0;g=Wl(g|0,B|0,4096,0)|0;g=ql(g|0,B|0,13)|0;s=((_|0)<0)<<31>>31;v=Jl(_|0,s|0,4809,0)|0;v=Wl(v|0,B|0,4096,0)|0;v=ql(v|0,B|0,13)|0;o=((y|0)<0)<<31>>31;m=Jl(y|0,o|0,934,0)|0;m=Wl(m|0,B|0,4096,0)|0;m=ql(m|0,B|0,13)|0;u=Jl(b|0,l|0,1382,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=ql(u|0,B|0,13)|0;h=Jl(_|0,s|0,2714,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=ql(h|0,B|0,13)|0;d=Gl(y|0,o|0,12)|0;d=Wl(d|0,B|0,4096,0)|0;d=ql(d|0,B|0,13)|0;l=Gl(b|0,l|0,12)|0;l=Wl(l|0,B|0,4096,0)|0;l=ql(l|0,B|0,13)|0;s=Jl(_|0,s|0,3430,0)|0;s=Wl(s|0,B|0,4096,0)|0;s=ql(s|0,B|0,13)|0;o=Jl(y|0,o|0,666,0)|0;o=Wl(o|0,B|0,4096,0)|0;o=ql(o|0,B|0,13)|0;f[p>>2]=v+g+m;f[c>>2]=d-(h+u);f[a>>2]=l-s-o;i=i+1|0}while((i|0)!=(r|0));return}function Sn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0.0,s=0.0,l=0,c=0.0,u=0;if(!r)return;else i=0;do{u=e+(i<<2)|0;s=+v[u>>2];l=t+(i<<2)|0;o=+v[l>>2];a=n+(i<<2)|0;c=+v[a>>2];v[u>>2]=s+c*1.4019999504089355;v[l>>2]=s-o*.3441300094127655-c*.714139997959137;v[a>>2]=s+o*1.7719999551773071;i=i+1|0}while((i|0)!=(r|0));return}function Rn(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0;a=ue(r,r)|0;d=Xi(a+r<<2)|0;if(!d){r=0;return r|0}if(a){o=0;i=e;while(1){f[d+(o+r<<2)>>2]=~~(+v[i>>2]*8192.0);o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}if(t){u=(r|0)==0;h=0;do{if(!u){i=0;do{f[d+(i<<2)>>2]=f[f[n+(i<<2)>>2]>>2];i=i+1|0}while((i|0)!=(r|0));if(!u){e=0;l=d;do{l=l+(r<<2)|0;a=n+(e<<2)|0;i=f[a>>2]|0;f[i>>2]=0;o=0;s=0;c=l;while(1){p=f[c>>2]|0;m=f[d+(s<<2)>>2]|0;p=Jl(m|0,((m|0)<0)<<31>>31|0,p|0,((p|0)<0)<<31>>31|0)|0;p=Wl(p|0,B|0,4096,0)|0;p=ql(p|0,B|0,13)|0;o=p+o|0;f[i>>2]=o;s=s+1|0;if((s|0)==(r|0))break;else c=c+4|0}f[a>>2]=i+4;e=e+1|0}while((e|0)!=(r|0))}}h=h+1|0}while((h|0)!=(t|0))}Ji(d);m=1;return m|0}function kn(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0.0,o=0,s=0,l=0,c=0,u=0,h=0,d=0;u=Xi(r<<3)|0;if(!u){r=0;return r|0}if(t){h=(r|0)==0;d=0;do{if(!h){i=0;do{f[u+(i<<2)>>2]=f[f[n+(i<<2)>>2]>>2];i=i+1|0}while((i|0)!=(r|0));if(!h){l=0;c=e;while(1){i=u+(l+r<<2)|0;v[i>>2]=0.0;a=0.0;o=0;s=c;while(1){a=a+ +v[s>>2]*+v[u+(o<<2)>>2];v[i>>2]=a;o=o+1|0;if((o|0)==(r|0))break;else s=s+4|0}o=n+(l<<2)|0;s=f[o>>2]|0;f[o>>2]=s+4;v[s>>2]=a;l=l+1|0;if((l|0)==(r|0))break;else c=c+(r<<2)|0}}}d=d+1|0}while((d|0)!=(t|0))}Ji(u);r=1;return r|0}function Pn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0.0,i=0,a=0,o=0,s=0,l=0.0;if(!t)return;else s=0;do{o=e+(s<<3)|0;y[o>>3]=0.0;r=0.0;i=0;a=s;while(1){l=+v[n+(a<<2)>>2];r=r+l*l;i=i+1|0;if((i|0)==(t|0))break;else a=a+t|0}l=+J(+r);y[o>>3]=l;s=s+1|0}while((s|0)!=(t|0));return}function Ln(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0;L=b;b=b+32|0;S=L+28|0;w=L+24|0;x=L+20|0;T=L+16|0;A=L+12|0;M=L+8|0;s=L+4|0;l=L;r=t+76|0;k=f[r>>2]|0;R=k+(n*5640|0)+420|0;P=(f[R>>2]|0)+1|0;c=e+16|0;E=Xi((f[c>>2]|0)*528|0)|0;if(!E){P=0;b=L;return P|0}_=Xi(f[c>>2]<<2)|0;if(!_){Ji(E);P=0;b=L;return P|0}r=Hn(e,f[r>>2]|0,n)|0;if(!r){Ji(E);Ji(_);P=0;b=L;return P|0}i=f[c>>2]|0;if(i){a=0;o=E;while(1){f[_+(a<<2)>>2]=o;a=a+1|0;if(a>>>0>=i>>>0)break;else o=o+528|0}}Dn(e,t,n,x,T,A,M,s,l,w,S,_);v=f[w>>2]|0;m=ue(f[c>>2]|0,v)|0;g=ue(f[S>>2]|0,m)|0;y=k+(n*5640|0)+8|0;p=Yi(ue((f[y>>2]|0)+1|0,g)|0,2)|0;a=r+4|0;f[a>>2]=p;if(!p){Ji(E);Ji(_);i=f[a>>2]|0;if(i){Ji(i);f[a>>2]=0}if(P){e=r;u=0;while(1){c=e+196|0;i=f[c>>2]|0;if(i){t=e+192|0;a=f[t>>2]|0;if(a){l=0;while(1){o=i+12|0;s=f[o>>2]|0;if(s){Ji(s);f[o>>2]=0;a=f[t>>2]|0}l=l+1|0;if(l>>>0>=a>>>0)break;else i=i+16|0}i=f[c>>2]|0}Ji(i);f[c>>2]=0}u=u+1|0;if((u|0)==(P|0))break;else e=e+232|0}}Ji(r);P=0;b=L;return P|0}i=f[r+196>>2]|0;p=f[e+24>>2]|0;f[r+200>>2]=f[x>>2];f[r+204>>2]=f[A>>2];f[r+208>>2]=f[T>>2];f[r+212>>2]=f[M>>2];f[r+20>>2]=1;f[r+16>>2]=v;f[r+12>>2]=m;f[r+8>>2]=g;c=f[r+192>>2]|0;if(c){e=0;t=p;while(1){o=f[i+12>>2]|0;a=f[_+(e<<2)>>2]|0;f[i>>2]=f[t>>2];f[i+4>>2]=f[t+4>>2];l=f[i+8>>2]|0;if(l){s=0;while(1){f[o>>2]=f[a>>2];f[o+4>>2]=f[a+4>>2];f[o+8>>2]=f[a+8>>2];f[o+12>>2]=f[a+12>>2];s=s+1|0;if(s>>>0>=l>>>0)break;else{a=a+16|0;o=o+16|0}}}e=e+1|0;if(e>>>0>=c>>>0)break;else{i=i+16|0;t=t+52|0}}}if(P>>>0>1){c=r;d=1;do{i=f[c+428>>2]|0;f[c+432>>2]=f[x>>2];f[c+436>>2]=f[A>>2];f[c+440>>2]=f[T>>2];f[c+444>>2]=f[M>>2];f[c+252>>2]=1;f[c+248>>2]=v;f[c+244>>2]=m;f[c+240>>2]=g;e=f[c+424>>2]|0;if(e){u=0;t=p;while(1){o=f[i+12>>2]|0;a=f[_+(u<<2)>>2]|0;f[i>>2]=f[t>>2];f[i+4>>2]=f[t+4>>2];l=f[i+8>>2]|0;if(l){s=0;while(1){f[o>>2]=f[a>>2];f[o+4>>2]=f[a+4>>2];f[o+8>>2]=f[a+8>>2];f[o+12>>2]=f[a+12>>2];s=s+1|0;if(s>>>0>=l>>>0)break;else{a=a+16|0;o=o+16|0}}}u=u+1|0;if(u>>>0>=e>>>0)break;else{i=i+16|0;t=t+52|0}}}f[c+236>>2]=f[c+4>>2];c=c+232|0;d=d+1|0}while((d|0)!=(P|0))}Ji(E);Ji(_);c=f[w>>2]|0;if(!(h[k+(n*5640|0)+5636>>0]&4)){t=f[S>>2]|0;l=(f[R>>2]|0)+1|0;if(!l){P=r;b=L;return P|0}s=f[k+(n*5640|0)+4>>2]|0;i=f[y>>2]|0;a=r;o=0;while(1){f[a+80>>2]=s;f[a+40>>2]=1;f[a+44>>2]=0;f[a+48>>2]=0;f[a+64>>2]=0;f[a+68>>2]=0;f[a+56>>2]=t;f[a+60>>2]=f[a+192>>2];f[a+52>>2]=i;f[a+72>>2]=c;o=o+1|0;if((o|0)==(l|0))break;else a=a+232|0}b=L;return r|0}else{o=(f[R>>2]|0)+1|0;if(!o){P=r;b=L;return P|0}s=r;i=k+(n*5640|0)+424|0;a=0;while(1){f[s+80>>2]=f[i+36>>2];f[s+40>>2]=1;f[s+44>>2]=f[i>>2];f[s+48>>2]=f[i+4>>2];f[s+64>>2]=0;f[s+68>>2]=0;f[s+56>>2]=f[i+12>>2];f[s+60>>2]=f[i+16>>2];f[s+52>>2]=f[i+8>>2];f[s+72>>2]=c;a=a+1|0;if((a|0)==(o|0))break;else{s=s+232|0;i=i+148|0}}b=L;return r|0}return 0}function Cn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0;if(!e)return;n=e+4|0;r=f[n>>2]|0;if(r){Ji(r);f[n>>2]=0}if(t){c=e;u=0;while(1){l=c+196|0;n=f[l>>2]|0;if(n){s=c+192|0;r=f[s>>2]|0;if(r){o=0;while(1){i=n+12|0;a=f[i>>2]|0;if(a){Ji(a);f[i>>2]=0;r=f[s>>2]|0}o=o+1|0;if(o>>>0>=r>>>0)break;else n=n+16|0}n=f[l>>2]|0}Ji(n);f[l>>2]=0}u=u+1|0;if((u|0)==(t|0))break;else c=c+232|0}}Ji(e);return}function In(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0;H=b;b=b+32|0;C=H+28|0;L=H+24|0;S=H+20|0;R=H+16|0;k=H+12|0;P=H+8|0;I=H+4|0;N=H;F=t+76|0;x=f[F>>2]|0;O=(f[x+(n*5640|0)+420>>2]|0)+1|0;M=e+16|0;A=Xi((f[M>>2]|0)*528|0)|0;if(!A){n=0;b=H;return n|0}T=Xi(f[M>>2]<<2)|0;if(!T){Ji(A);n=0;b=H;return n|0}i=Hn(e,f[F>>2]|0,n)|0;if(!i){Ji(A);Ji(T);n=0;b=H;return n|0}a=f[M>>2]|0;if(a){o=0;s=A;while(1){f[T+(o<<2)>>2]=s;o=o+1|0;if(o>>>0>=a>>>0)break;else s=s+528|0}}Dn(e,t,n,S,R,k,P,I,N,L,C,T);_=f[L>>2]|0;E=ue(f[M>>2]|0,_)|0;w=ue(f[C>>2]|0,E)|0;h[i>>0]=(p[t+93>>0]|0)>>>3&1;y=Yi(ue(f[x+(n*5640|0)+8>>2]|0,w)|0,2)|0;o=i+4|0;f[o>>2]=y;if(!y){Ji(A);Ji(T);a=f[o>>2]|0;if(a){Ji(a);f[o>>2]=0}if(O){m=i;g=0;while(1){u=m+196|0;a=f[u>>2]|0;if(a){c=m+192|0;o=f[c>>2]|0;if(o){l=0;while(1){s=a+12|0;e=f[s>>2]|0;if(e){Ji(e);f[s>>2]=0;o=f[c>>2]|0}l=l+1|0;if(l>>>0>=o>>>0)break;else a=a+16|0}a=f[u>>2]|0}Ji(a);f[u>>2]=0}g=g+1|0;if((g|0)==(O|0))break;else m=m+232|0}}Ji(i);n=0;b=H;return n|0}a=f[i+196>>2]|0;y=f[e+24>>2]|0;f[i+200>>2]=f[S>>2];f[i+204>>2]=f[k>>2];f[i+208>>2]=f[R>>2];f[i+212>>2]=f[P>>2];f[i+224>>2]=f[I>>2];f[i+228>>2]=f[N>>2];f[i+20>>2]=1;f[i+16>>2]=_;f[i+12>>2]=E;f[i+8>>2]=w;u=f[i+192>>2]|0;if(u){m=0;c=y;while(1){s=f[a+12>>2]|0;o=f[T+(m<<2)>>2]|0;f[a>>2]=f[c>>2];f[a+4>>2]=f[c+4>>2];l=f[a+8>>2]|0;if(l){e=0;while(1){f[s>>2]=f[o>>2];f[s+4>>2]=f[o+4>>2];f[s+8>>2]=f[o+8>>2];f[s+12>>2]=f[o+12>>2];e=e+1|0;if(e>>>0>=l>>>0)break;else{o=o+16|0;s=s+16|0}}}m=m+1|0;if(m>>>0>=u>>>0)break;else{a=a+16|0;c=c+52|0}}}if(O>>>0>1){u=i;v=1;do{a=f[u+428>>2]|0;f[u+432>>2]=f[S>>2];f[u+436>>2]=f[k>>2];f[u+440>>2]=f[R>>2];f[u+444>>2]=f[P>>2];f[u+456>>2]=f[I>>2];f[u+460>>2]=f[N>>2];f[u+252>>2]=1;f[u+248>>2]=_;f[u+244>>2]=E;f[u+240>>2]=w;m=f[u+424>>2]|0;if(m){g=0;c=y;while(1){s=f[a+12>>2]|0;o=f[T+(g<<2)>>2]|0;f[a>>2]=f[c>>2];f[a+4>>2]=f[c+4>>2];l=f[a+8>>2]|0;if(l){e=0;while(1){f[s>>2]=f[o>>2];f[s+4>>2]=f[o+4>>2];f[s+8>>2]=f[o+8>>2];f[s+12>>2]=f[o+12>>2];e=e+1|0;if(e>>>0>=l>>>0)break;else{o=o+16|0;s=s+16|0}}}g=g+1|0;if(g>>>0>=m>>>0)break;else{a=a+16|0;c=c+52|0}}}f[u+236>>2]=f[u+4>>2];u=u+232|0;v=v+1|0}while((v|0)!=(O|0))}Ji(A);Ji(T);do{if(h[x+(n*5640|0)+5636>>0]&4){a=d[t>>1]|0;if((a&65535)>2){if(!((r|0)==1|(a&65535)<7))break}else if((r|0)!=1)break;Un(f[F>>2]|0,n,f[S>>2]|0,f[R>>2]|0,f[k>>2]|0,f[P>>2]|0,f[L>>2]|0,f[I>>2]|0,f[N>>2]|0);n=i;b=H;return n|0}}while(0);w=f[M>>2]|0;E=f[S>>2]|0;_=f[R>>2]|0;y=f[k>>2]|0;v=f[P>>2]|0;g=f[L>>2]|0;m=f[C>>2]|0;u=f[I>>2]|0;c=f[N>>2]|0;a=f[F>>2]|0;s=(f[a+(n*5640|0)+420>>2]|0)+1|0;if(!s){n=i;b=H;return n|0}e=f[a+(n*5640|0)+8>>2]|0;l=f[a+(n*5640|0)+4>>2]|0;a=a+(n*5640|0)+424|0;o=0;while(1){f[a+76>>2]=0;f[a+92>>2]=w;f[a+72>>2]=0;f[a+88>>2]=m;f[a+68>>2]=0;f[a+84>>2]=e;f[a+36>>2]=l;f[a+80>>2]=0;f[a+96>>2]=g;f[a+100>>2]=E;f[a+104>>2]=_;f[a+108>>2]=y;f[a+112>>2]=v;f[a+116>>2]=u;f[a+120>>2]=c;o=o+1|0;if((o|0)==(s|0))break;else a=a+148|0}b=H;return i|0}function Nn(e,t,n,r,i,a,o){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,c=0,u=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0;V=f[t+76>>2]|0;j=V+(n*5640|0)+424+(r*148|0)+36|0;G=$i(f[j>>2]|0)|0;f[e+(r*232|0)+40>>2]=1;W=e+(r*232|0)+44|0;f[e+(r*232|0)+80>>2]=f[j>>2];do{if(h[t+93>>0]&8){s=d[t>>1]|0;if((s&65535)>2){if(!((o|0)==1&(s&65535)>6|(s+-3&65535)<4))break}else if(!((o|0)==1|(s+-3&65535)<4))break;s=a+1|0;e:do{if((s|0)<4){o=V+(n*5640|0)+424+(r*148|0)+72|0;l=V+(n*5640|0)+424+(r*148|0)+88|0;c=e+(r*232|0)+56|0;u=V+(n*5640|0)+424+(r*148|0)+76|0;p=e+(r*232|0)+48|0;m=V+(n*5640|0)+424+(r*148|0)+92|0;g=e+(r*232|0)+60|0;v=V+(n*5640|0)+424+(r*148|0)+68|0;y=e+(r*232|0)+64|0;_=V+(n*5640|0)+424+(r*148|0)+84|0;b=e+(r*232|0)+52|0;E=V+(n*5640|0)+424+(r*148|0)+80|0;w=e+(r*232|0)+68|0;x=V+(n*5640|0)+424+(r*148|0)+96|0;T=e+(r*232|0)+72|0;A=V+(n*5640|0)+424+(r*148|0)+100|0;M=e+(r*232|0)+96|0;S=V+(n*5640|0)+424+(r*148|0)+108|0;R=e+(r*232|0)+104|0;k=V+(n*5640|0)+424+(r*148|0)+104|0;P=e+(r*232|0)+100|0;L=V+(n*5640|0)+424+(r*148|0)+112|0;C=e+(r*232|0)+108|0;while(1){t:do{switch(h[G+s>>0]|0){case 82:{f[W>>2]=f[o>>2];f[c>>2]=f[l>>2];break}case 67:{f[p>>2]=f[u>>2];f[g>>2]=f[m>>2];break}case 76:{f[y>>2]=f[v>>2];f[b>>2]=f[_>>2];break}case 80:if((f[j>>2]|0)>>>0<2){f[w>>2]=f[E>>2];f[T>>2]=f[x>>2];break t}else{f[M>>2]=f[A>>2];f[R>>2]=f[S>>2];f[P>>2]=f[k>>2];f[C>>2]=f[L>>2];break t}default:{}}}while(0);s=s+1|0;if((s|0)==4)break e}}}while(0);s=(a|0)>-1;if(!i){if(!s)return;c=V+(n*5640|0)+424+(r*148|0)+76|0;u=V+(n*5640|0)+424+(r*148|0)+132|0;p=e+(r*232|0)+48|0;m=e+(r*232|0)+60|0;g=V+(n*5640|0)+424+(r*148|0)+72|0;v=V+(n*5640|0)+424+(r*148|0)+128|0;y=e+(r*232|0)+56|0;_=V+(n*5640|0)+424+(r*148|0)+68|0;b=V+(n*5640|0)+424+(r*148|0)+124|0;E=e+(r*232|0)+64|0;w=e+(r*232|0)+52|0;x=V+(n*5640|0)+424+(r*148|0)+80|0;T=V+(n*5640|0)+424+(r*148|0)+136|0;A=e+(r*232|0)+68|0;M=e+(r*232|0)+72|0;S=V+(n*5640|0)+424+(r*148|0)+100|0;R=V+(n*5640|0)+424+(r*148|0)+140|0;k=V+(n*5640|0)+424+(r*148|0)+108|0;P=V+(n*5640|0)+424+(r*148|0)+144|0;L=e+(r*232|0)+96|0;C=V+(n*5640|0)+424+(r*148|0)+116|0;i=e+(r*232|0)+100|0;I=e+(r*232|0)+104|0;l=V+(n*5640|0)+424+(r*148|0)+120|0;o=e+(r*232|0)+108|0;s=a;while(1){e:do{switch(h[G+s>>0]|0){case 67:{r=f[c>>2]|0;f[p>>2]=r;r=r+1|0;f[m>>2]=r;f[u>>2]=r;break}case 82:{r=f[g>>2]|0;f[W>>2]=r;r=r+1|0;f[y>>2]=r;f[v>>2]=r;break}case 76:{r=f[_>>2]|0;f[E>>2]=r;r=r+1|0;f[w>>2]=r;f[b>>2]=r;break}case 80:if((f[j>>2]|0)>>>0<2){r=f[x>>2]|0;f[A>>2]=r;r=r+1|0;f[M>>2]=r;f[T>>2]=r;break e}else{r=f[S>>2]|0;a=f[k>>2]|0;f[L>>2]=r;n=f[C>>2]|0;n=n+r-((r>>>0)%(n>>>0)|0)|0;f[i>>2]=n;f[I>>2]=a;r=f[l>>2]|0;r=r+a-((a>>>0)%(r>>>0)|0)|0;f[o>>2]=r;f[R>>2]=n;f[P>>2]=r;break e}default:{}}}while(0);if((s|0)>0)s=s+-1|0;else break}return}if(!s)return;H=V+(n*5640|0)+424+(r*148|0)+128|0;D=V+(n*5640|0)+424+(r*148|0)+88|0;U=V+(n*5640|0)+424+(r*148|0)+72|0;B=e+(r*232|0)+56|0;z=V+(n*5640|0)+424+(r*148|0)+132|0;m=V+(n*5640|0)+424+(r*148|0)+92|0;g=V+(n*5640|0)+424+(r*148|0)+76|0;v=e+(r*232|0)+48|0;y=e+(r*232|0)+60|0;_=V+(n*5640|0)+424+(r*148|0)+124|0;b=V+(n*5640|0)+424+(r*148|0)+84|0;E=V+(n*5640|0)+424+(r*148|0)+68|0;w=e+(r*232|0)+64|0;x=e+(r*232|0)+52|0;T=V+(n*5640|0)+424+(r*148|0)+136|0;A=V+(n*5640|0)+424+(r*148|0)+96|0;M=V+(n*5640|0)+424+(r*148|0)+80|0;S=e+(r*232|0)+68|0;R=e+(r*232|0)+72|0;k=V+(n*5640|0)+424+(r*148|0)+140|0;P=V+(n*5640|0)+424+(r*148|0)+104|0;L=e+(r*232|0)+96|0;C=V+(n*5640|0)+424+(r*148|0)+116|0;i=e+(r*232|0)+100|0;I=V+(n*5640|0)+424+(r*148|0)+144|0;N=V+(n*5640|0)+424+(r*148|0)+112|0;F=e+(r*232|0)+104|0;O=V+(n*5640|0)+424+(r*148|0)+120|0;u=e+(r*232|0)+108|0;p=V+(n*5640|0)+424+(r*148|0)+100|0;c=V+(n*5640|0)+424+(r*148|0)+108|0;l=a;s=1;while(1){o=G+l|0;e:do{switch(h[o>>0]|0){case 67:{a=f[z>>2]|0;f[v>>2]=a+-1;f[y>>2]=a;break}case 82:{a=f[H>>2]|0;f[W>>2]=a+-1;f[B>>2]=a;break}case 76:{a=f[_>>2]|0;f[w>>2]=a+-1;f[x>>2]=a;break}case 80:if((f[j>>2]|0)>>>0<2){a=f[T>>2]|0;f[S>>2]=a+-1;f[R>>2]=a;break e}else{a=f[k>>2]|0;V=f[C>>2]|0;f[L>>2]=a-V-((a>>>0)%(V>>>0)|0);f[i>>2]=a;a=f[I>>2]|0;V=f[O>>2]|0;f[F>>2]=a-V-((a>>>0)%(V>>>0)|0);f[u>>2]=a;break e}default:{}}}while(0);e:do{if((s|0)==1)switch(h[o>>0]|0){case 82:{s=f[H>>2]|0;if((s|0)!=(f[D>>2]|0)){f[W>>2]=s;s=s+1|0;f[B>>2]=s;f[H>>2]=s;s=0;break e}if(!(Bn(l+-1|0,t,n,r,G)|0)){s=0;break e}s=f[U>>2]|0;f[W>>2]=s;s=s+1|0;f[B>>2]=s;f[H>>2]=s;s=1;break e}case 67:{s=f[z>>2]|0;if((s|0)!=(f[m>>2]|0)){f[v>>2]=s;s=s+1|0;f[y>>2]=s;f[z>>2]=s;s=0;break e}if(!(Bn(l+-1|0,t,n,r,G)|0)){s=0;break e}s=f[g>>2]|0;f[v>>2]=s;s=s+1|0;f[y>>2]=s;f[z>>2]=s;s=1;break e}case 76:{s=f[_>>2]|0;if((s|0)!=(f[b>>2]|0)){f[w>>2]=s;s=s+1|0;f[x>>2]=s;f[_>>2]=s;s=0;break e}if(!(Bn(l+-1|0,t,n,r,G)|0)){s=0;break e}s=f[E>>2]|0;f[w>>2]=s;s=s+1|0;f[x>>2]=s;f[_>>2]=s;s=1;break e}case 80:{if((f[j>>2]|0)>>>0<2){s=f[T>>2]|0;if((s|0)!=(f[A>>2]|0)){f[S>>2]=s;s=s+1|0;f[R>>2]=s;f[T>>2]=s;s=0;break e}if(!(Bn(l+-1|0,t,n,r,G)|0)){s=0;break e}s=f[M>>2]|0;f[S>>2]=s;s=s+1|0;f[R>>2]=s;f[T>>2]=s;s=1;break e}s=f[k>>2]|0;if(s>>>0<(f[P>>2]|0)>>>0){f[L>>2]=s;a=f[C>>2]|0;s=a+s-((s>>>0)%(a>>>0)|0)|0;f[i>>2]=s;f[k>>2]=s;s=0;break e}o=f[I>>2]|0;if(o>>>0<(f[N>>2]|0)>>>0){f[F>>2]=o;a=f[O>>2]|0;s=0;o=a+o-((o>>>0)%(a>>>0)|0)|0}else{if(!(Bn(l+-1|0,t,n,r,G)|0)){s=0;break e}a=f[c>>2]|0;f[I>>2]=a;f[F>>2]=a;o=f[O>>2]|0;s=1;o=o+a-((a>>>0)%(o>>>0)|0)|0}f[u>>2]=o;f[I>>2]=o;V=f[p>>2]|0;f[L>>2]=V;a=f[C>>2]|0;a=a+V-((V>>>0)%(a>>>0)|0)|0;f[i>>2]=a;f[k>>2]=a;break e}default:{s=1;break e}}}while(0);if((l|0)>0)l=l+-1|0;else break}return}}while(0);f[W>>2]=f[V+(n*5640|0)+424+(r*148|0)+72>>2];f[e+(r*232|0)+56>>2]=f[V+(n*5640|0)+424+(r*148|0)+88>>2];f[e+(r*232|0)+48>>2]=f[V+(n*5640|0)+424+(r*148|0)+76>>2];f[e+(r*232|0)+60>>2]=f[V+(n*5640|0)+424+(r*148|0)+92>>2];f[e+(r*232|0)+64>>2]=f[V+(n*5640|0)+424+(r*148|0)+68>>2];f[e+(r*232|0)+52>>2]=f[V+(n*5640|0)+424+(r*148|0)+84>>2];f[e+(r*232|0)+68>>2]=f[V+(n*5640|0)+424+(r*148|0)+80>>2];f[e+(r*232|0)+72>>2]=f[V+(n*5640|0)+424+(r*148|0)+96>>2];f[e+(r*232|0)+96>>2]=f[V+(n*5640|0)+424+(r*148|0)+100>>2];f[e+(r*232|0)+104>>2]=f[V+(n*5640|0)+424+(r*148|0)+108>>2];f[e+(r*232|0)+100>>2]=f[V+(n*5640|0)+424+(r*148|0)+104>>2];f[e+(r*232|0)+108>>2]=f[V+(n*5640|0)+424+(r*148|0)+112>>2];return}function Fn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0;I=f[t+76>>2]|0;F=f[t+24>>2]|0;D=(n>>>0)%(F>>>0)|0;F=(n>>>0)/(F>>>0)|0;O=f[t+4>>2]|0;C=f[t+12>>2]|0;L=(ue(C,D)|0)+O|0;H=f[e>>2]|0;H=(L|0)>(H|0)?L:H;O=(ue(C,D+1|0)|0)+O|0;D=f[e+8>>2]|0;D=(O|0)<(D|0)?O:D;O=f[t+8>>2]|0;C=f[t+16>>2]|0;L=(ue(C,F)|0)+O|0;N=f[e+4>>2]|0;N=(L|0)>(N|0)?L:N;O=(ue(C,F+1|0)|0)+O|0;F=f[e+12>>2]|0;F=(O|0)<(F|0)?O:F;O=f[e+16>>2]|0;if(!O){c=0;l=2147483647;s=2147483647;o=0}else{R=F+-1|0;k=D+-1|0;P=N+-1|0;L=H+-1|0;c=0;l=2147483647;s=2147483647;o=0;C=0;M=f[e+24>>2]|0;S=f[I+(n*5640|0)+5584>>2]|0;while(1){x=f[M>>2]|0;T=f[M+4>>2]|0;A=f[S+4>>2]|0;o=A>>>0>o>>>0?A:o;if(A){E=(R+T|0)/(T|0)|0;_=(k+x|0)/(x|0)|0;v=(P+T|0)/(T|0)|0;m=(L+x|0)/(x|0)|0;m=Wl(m|0,((m|0)<0)<<31>>31|0,-1,-1)|0;g=B;v=Wl(v|0,((v|0)<0)<<31>>31|0,-1,-1)|0;y=B;_=Wl(_|0,((_|0)<0)<<31>>31|0,-1,-1)|0;b=B;E=Wl(E|0,((E|0)<0)<<31>>31|0,-1,-1)|0;w=B;t=0;p=0;while(1){u=f[S+812+(p<<2)>>2]|0;d=f[S+944+(p<<2)>>2]|0;i=t+-1+A|0;a=x<<i+u;U=T<<d+i;l=l>>>0<a>>>0?l:a;s=s>>>0<U>>>0?s:U;U=Gl(1,0,i|0)|0;a=B;t=Wl(m|0,g|0,U|0,a|0)|0;t=Vl(t|0,B|0,i|0)|0;r=Wl(v|0,y|0,U|0,a|0)|0;r=Vl(r|0,B|0,i|0)|0;e=Wl(_|0,b|0,U|0,a|0)|0;e=Vl(e|0,B|0,i|0)|0;a=Wl(E|0,w|0,U|0,a|0)|0;i=Vl(a|0,B|0,i|0)|0;a=Gl(1,0,d|0)|0;a=Wl(a|0,B|0,-1,-1)|0;a=Wl(a|0,B|0,i|0,((i|0)<0)<<31>>31|0)|0;a=Vl(a|0,B|0,d|0)|0;if((t|0)==(e|0))t=0;else{U=Gl(1,0,u|0)|0;U=Wl(U|0,B|0,-1,-1)|0;U=Wl(U|0,B|0,e|0,((e|0)<0)<<31>>31|0)|0;U=Vl(U|0,B|0,u|0)|0;t=(U<<u)-(t>>u<<u)>>u}e=ue(t,(r|0)==(i|0)?0:(a<<d)-(r>>d<<d)>>d)|0;c=e>>>0>c>>>0?e:c;e=p+1|0;if(e>>>0<A>>>0){t=~p;p=e}else break}}C=C+1|0;if(C>>>0>=O>>>0)break;else{M=M+52|0;S=S+1080|0}}}if(h[I+(n*5640|0)+5636>>0]&4){Un(I,n,H,D,N,F,c,l,s);return}r=(f[I+(n*5640|0)+420>>2]|0)+1|0;if(!r)return;i=f[I+(n*5640|0)+8>>2]|0;a=f[I+(n*5640|0)+4>>2]|0;t=I+(n*5640|0)+424|0;e=0;while(1){f[t+76>>2]=0;f[t+92>>2]=O;f[t+72>>2]=0;f[t+88>>2]=o;f[t+68>>2]=0;f[t+84>>2]=i;f[t+36>>2]=a;f[t+80>>2]=0;f[t+96>>2]=c;f[t+100>>2]=H;f[t+104>>2]=D;f[t+108>>2]=N;f[t+112>>2]=F;f[t+116>>2]=l;f[t+120>>2]=s;e=e+1|0;if((e|0)==(r|0))break;else t=t+148|0}return}function On(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Z=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Ae=0,Me=0,Se=0,Re=0,ke=0,Pe=0,Le=0,Ce=0,Ie=0,Ne=0,Fe=0,Oe=0,He=0,De=0,Ue=0,Be=0,ze=0,Ve=0,je=0,Ge=0,We=0,qe=0,Xe=0,Ye=0,Ke=0,Ze=0,Qe=0,Je=0,$e=0,et=0,tt=0,nt=0,rt=0,it=0,at=0,ot=0,st=0,lt=0,ct=0,ut=0,ht=0,dt=0,ft=0;switch(f[e+80>>2]|0){case 0:{t=e+40|0;if(!(f[t>>2]|0)){P=e+32|0;l=P;P=f[P>>2]|0;n=18}else{f[t>>2]=0;_=f[e+64>>2]|0;f[e+36>>2]=_;n=5}while(1){if((n|0)==5){if(_>>>0>=(f[e+52>>2]|0)>>>0){ft=0;n=153;break}A=f[e+44>>2]|0;f[e+28>>2]=A;n=7}else if((n|0)==18){o=P+1|0;f[l>>2]=o;i=l;n=14}while(1){if((n|0)==7){n=0;if(A>>>0>=(f[e+56>>2]|0)>>>0){n=21;break}M=f[e+48>>2]|0;m=e+24|0;f[m>>2]=M}else if((n|0)==14){if(o>>>0<(f[e+72>>2]|0)>>>0){n=16;break}L=e+24|0;u=L;L=f[L>>2]|0;n=19}while(1){if((n|0)==19){n=0;M=L+1|0;f[u>>2]=M;m=u}if(M>>>0>=(f[e+60>>2]|0)>>>0){n=20;break}S=f[e+196>>2]|0;R=f[e+28>>2]|0;if(R>>>0<(f[S+(M<<4)+8>>2]|0)>>>0)break;else{u=m;L=M;n=19}}if((n|0)==20){n=e+28|0;A=(f[n>>2]|0)+1|0;f[n>>2]=A;n=7;continue}t=f[S+(M<<4)+12>>2]|0;if(!(h[e>>0]|0)){dt=ue(f[t+(R<<4)+12>>2]|0,f[t+(R<<4)+8>>2]|0)|0;f[e+72>>2]=dt}o=f[e+68>>2]|0;i=e+32|0;f[i>>2]=o;n=14}if((n|0)==16){n=0;k=ue(f[e+8>>2]|0,f[e+36>>2]|0)|0;k=(ue(f[e+12>>2]|0,f[e+28>>2]|0)|0)+k|0;k=k+(ue(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;k=k+(ue(f[e+20>>2]|0,o)|0)|0;k=(f[e+4>>2]|0)+(k<<1)|0;if(!(d[k>>1]|0))break;else{l=i;P=o;n=18;continue}}else if((n|0)==21){n=e+36|0;_=(f[n>>2]|0)+1|0;f[n>>2]=_;n=5;continue}}if((n|0)==153)return ft|0;d[k>>1]=1;e=1;return e|0}case 1:{t=e+40|0;if(!(f[t>>2]|0)){x=e+32|0;s=x;x=f[x>>2]|0;n=38}else{f[t>>2]=0;C=f[e+44>>2]|0;f[e+28>>2]=C;n=25}while(1){if((n|0)==25){if(C>>>0>=(f[e+56>>2]|0)>>>0){ft=0;n=153;break}v=f[e+64>>2]|0;f[e+36>>2]=v;n=27}else if((n|0)==38){a=x+1|0;f[s>>2]=a;r=s;n=34}while(1){if((n|0)==27){n=0;if(v>>>0>=(f[e+52>>2]|0)>>>0){n=41;break}y=f[e+48>>2]|0;p=e+24|0;f[p>>2]=y}else if((n|0)==34){if(a>>>0<(f[e+72>>2]|0)>>>0){n=36;break}T=e+24|0;c=T;T=f[T>>2]|0;n=39}while(1){if((n|0)==39){n=0;y=T+1|0;f[c>>2]=y;p=c}if(y>>>0>=(f[e+60>>2]|0)>>>0){n=40;break}b=f[e+196>>2]|0;E=f[e+28>>2]|0;if(E>>>0<(f[b+(y<<4)+8>>2]|0)>>>0)break;else{c=p;T=y;n=39}}if((n|0)==40){n=e+36|0;v=(f[n>>2]|0)+1|0;f[n>>2]=v;n=27;continue}t=f[b+(y<<4)+12>>2]|0;if(!(h[e>>0]|0)){dt=ue(f[t+(E<<4)+12>>2]|0,f[t+(E<<4)+8>>2]|0)|0;f[e+72>>2]=dt}a=f[e+68>>2]|0;r=e+32|0;f[r>>2]=a;n=34}if((n|0)==36){n=0;w=ue(f[e+8>>2]|0,f[e+36>>2]|0)|0;w=(ue(f[e+12>>2]|0,f[e+28>>2]|0)|0)+w|0;w=w+(ue(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;w=w+(ue(f[e+20>>2]|0,a)|0)|0;w=(f[e+4>>2]|0)+(w<<1)|0;if(!(d[w>>1]|0))break;else{s=r;x=a;n=38;continue}}else if((n|0)==41){n=e+28|0;C=(f[n>>2]|0)+1|0;f[n>>2]=C;n=25;continue}}if((n|0)==153)return ft|0;d[w>>1]=1;e=1;return e|0}case 2:{t=e+40|0;if(!(f[t>>2]|0)){ht=e+36|0;We=ht;ht=f[ht>>2]|0;n=75}else{f[t>>2]=0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;g=f[e+192>>2]|0;if(g){v=f[e+196>>2]|0;t=0;n=0;y=0;do{o=f[v+(y<<4)+8>>2]|0;if(o){s=f[v+(y<<4)+12>>2]|0;l=f[v+(y<<4)>>2]|0;c=f[v+(y<<4)+4>>2]|0;u=o+-1|0;r=0;a=0;while(1){i=u+r|0;Ge=l<<i+(f[s+(a<<4)>>2]|0);i=c<<(f[s+(a<<4)+4>>2]|0)+i;t=(t|0)==0?Ge:t>>>0<Ge>>>0?t:Ge;n=(n|0)==0?i:n>>>0<i>>>0?n:i;i=a+1|0;if((i|0)==(o|0))break;else{r=~a;a=i}}f[p>>2]=t;f[m>>2]=n}y=y+1|0}while((y|0)!=(g|0))}if(!(h[e>>0]|0)){f[e+104>>2]=f[e+204>>2];f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}F=f[e+44>>2]|0;f[e+28>>2]=F;n=54}while(1){if((n|0)==54){if(F>>>0>=(f[e+56>>2]|0)>>>0){ft=0;n=153;break}Ke=f[e+104>>2]|0;f[e+220>>2]=Ke;n=56}else if((n|0)==75){ct=ht+1|0;f[We>>2]=ct;qe=We;n=71}while(1){if((n|0)==56){if((Ke|0)>=(f[e+108>>2]|0)){n=79;break}Ze=f[e+96>>2]|0;f[e+216>>2]=Ze;n=58}else if((n|0)==71){if(ct>>>0<(f[e+52>>2]|0)>>>0){n=73;break}dt=e+24|0;Xe=dt;dt=f[dt>>2]|0;n=76}while(1){if((n|0)==58){if((Ze|0)>=(f[e+100>>2]|0)){n=78;break}Qe=f[e+48>>2]|0;Ye=e+24|0;f[Ye>>2]=Qe}else if((n|0)==76){Qe=dt+1|0;f[Xe>>2]=Qe;Ye=Xe}if(Qe>>>0>=(f[e+60>>2]|0)>>>0){Ze=f[e+224>>2]|0;n=e+216|0;Ge=f[n>>2]|0;Ze=Ge+Ze-((Ge|0)%(Ze|0)|0)|0;f[n>>2]=Ze;n=58;continue}n=f[e+196>>2]|0;c=f[e+28>>2]|0;t=f[n+(Qe<<4)+8>>2]|0;if(c>>>0>=t>>>0){Xe=Ye;dt=Qe;n=76;continue}u=f[n+(Qe<<4)+12>>2]|0;a=t+~c|0;o=f[e+200>>2]|0;s=f[n+(Qe<<4)>>2]|0;Je=s<<a;$e=(o+-1+Je|0)/(Je|0)|0;l=f[e+204>>2]|0;Ge=f[n+(Qe<<4)+4>>2]|0;et=Ge<<a;tt=(l+-1+et|0)/(et|0)|0;nt=Je+-1|0;t=(nt+(f[e+208>>2]|0)|0)/(Je|0)|0;rt=et+-1|0;n=(rt+(f[e+212>>2]|0)|0)/(et|0)|0;it=f[u+(c<<4)>>2]|0;r=it+a|0;at=f[u+(c<<4)+4>>2]|0;i=at+a|0;ot=f[e+220>>2]|0;if((ot|0)%(Ge<<i|0)|0){if((ot|0)!=(l|0)){Xe=Ye;dt=Qe;n=76;continue}if(!((tt<<a|0)%(1<<i|0)|0)){Xe=Ye;dt=Qe;n=76;continue}}st=f[e+216>>2]|0;if((st|0)%(s<<r|0)|0){if((st|0)!=(o|0)){Xe=Ye;dt=Qe;n=76;continue}if(!(($e<<a|0)%(1<<r|0)|0)){Xe=Ye;dt=Qe;n=76;continue}}lt=f[u+(c<<4)+8>>2]|0;if(!lt){Xe=Ye;dt=Qe;n=76;continue}if((tt|0)==(n|0)|(($e|0)==(t|0)?1:(f[u+(c<<4)+12>>2]|0)==0)){Xe=Ye;dt=Qe;n=76}else{n=70;break}}if((n|0)==70){ct=(((nt+st|0)/(Je|0)|0)>>it)-($e>>it)+(ue((((rt+ot|0)/(et|0)|0)>>at)-(tt>>at)|0,lt)|0)|0;f[e+32>>2]=ct;ct=f[e+64>>2]|0;qe=e+36|0;f[qe>>2]=ct;n=71;continue}else if((n|0)==78){Ke=f[e+228>>2]|0;n=e+220|0;Ge=f[n>>2]|0;Ke=Ge+Ke-((Ge|0)%(Ke|0)|0)|0;f[n>>2]=Ke;n=56;continue}}if((n|0)==73){n=0;ut=ue(f[e+8>>2]|0,ct)|0;ut=(ue(f[e+12>>2]|0,f[e+28>>2]|0)|0)+ut|0;ut=ut+(ue(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;ut=ut+(ue(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;ut=(f[e+4>>2]|0)+(ut<<1)|0;if(!(d[ut>>1]|0))break;else{We=qe;ht=ct;n=75;continue}}else if((n|0)==79){n=e+28|0;F=(f[n>>2]|0)+1|0;f[n>>2]=F;n=54;continue}}if((n|0)==153)return ft|0;d[ut>>1]=1;e=1;return e|0}case 3:{n=e+40|0;if(!(f[n>>2]|0)){je=f[e+24>>2]|0;Oe=e+36|0;me=Oe;Oe=f[Oe>>2]|0;Ue=je;je=(f[e+196>>2]|0)+(je<<4)|0;n=113}else{f[n>>2]=0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;g=f[e+192>>2]|0;if(g){v=f[e+196>>2]|0;t=0;n=0;y=0;do{o=f[v+(y<<4)+8>>2]|0;if(o){s=f[v+(y<<4)+12>>2]|0;l=f[v+(y<<4)>>2]|0;c=f[v+(y<<4)+4>>2]|0;u=o+-1|0;r=0;a=0;while(1){i=u+r|0;dt=l<<i+(f[s+(a<<4)>>2]|0);i=c<<(f[s+(a<<4)+4>>2]|0)+i;t=(t|0)==0?dt:t>>>0<dt>>>0?t:dt;n=(n|0)==0?i:n>>>0<i>>>0?n:i;i=a+1|0;if((i|0)==(o|0))break;else{r=~a;a=i}}f[p>>2]=t;f[m>>2]=n}y=y+1|0}while((y|0)!=(g|0))}if(!(h[e>>0]|0)){t=f[e+204>>2]|0;f[e+104>>2]=t;f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}else t=f[e+104>>2]|0;f[e+220>>2]=t;n=93}while(1){if((n|0)==93){if((t|0)>=(f[e+108>>2]|0)){ft=0;n=153;break}_e=f[e+96>>2]|0;f[e+216>>2]=_e;n=95}else if((n|0)==113){Ie=Oe+1|0;f[me>>2]=Ie;ge=me;Ne=Ue;Ve=je;n=109}while(1){if((n|0)==95){if((_e|0)>=(f[e+100>>2]|0)){n=117;break}be=f[e+48>>2]|0;f[e+24>>2]=be;n=97}else if((n|0)==109){if(Ie>>>0<(f[e+52>>2]|0)>>>0){n=111;break}He=e+28|0;ve=He;He=f[He>>2]|0;Be=Ne;Ge=Ve;n=114}while(1){if((n|0)==97){if(be>>>0>=(f[e+60>>2]|0)>>>0){n=116;break}ze=(f[e+196>>2]|0)+(be<<4)|0;Ee=f[e+44>>2]|0;ye=e+28|0;f[ye>>2]=Ee;De=be}else if((n|0)==114){Ee=He+1|0;f[ve>>2]=Ee;ye=ve;De=Be;ze=Ge}dt=f[e+56>>2]|0;n=f[ze+8>>2]|0;if(Ee>>>0>=(dt>>>0<n>>>0?dt:n)>>>0){be=De+1|0;f[e+24>>2]=be;n=97;continue}u=f[ze+12>>2]|0;n=n+~Ee|0;r=f[e+200>>2]|0;i=f[ze>>2]|0;we=i<<n;xe=(r+-1+we|0)/(we|0)|0;a=f[e+204>>2]|0;dt=f[ze+4>>2]|0;Te=dt<<n;Ae=(a+-1+Te|0)/(Te|0)|0;Me=we+-1|0;o=(Me+(f[e+208>>2]|0)|0)/(we|0)|0;Se=Te+-1|0;s=(Se+(f[e+212>>2]|0)|0)/(Te|0)|0;Re=f[u+(Ee<<4)>>2]|0;l=Re+n|0;ke=f[u+(Ee<<4)+4>>2]|0;c=ke+n|0;Pe=f[e+220>>2]|0;if((Pe|0)%(dt<<c|0)|0){if((Pe|0)!=(a|0)){ve=ye;He=Ee;Be=De;Ge=ze;n=114;continue}if(!((Ae<<n|0)%(1<<c|0)|0)){ve=ye;He=Ee;Be=De;Ge=ze;n=114;continue}}Le=f[e+216>>2]|0;if((Le|0)%(i<<l|0)|0){if((Le|0)!=(r|0)){ve=ye;He=Ee;Be=De;Ge=ze;n=114;continue}if(!((xe<<n|0)%(1<<l|0)|0)){ve=ye;He=Ee;Be=De;Ge=ze;n=114;continue}}Ce=f[u+(Ee<<4)+8>>2]|0;if(!Ce){ve=ye;He=Ee;Be=De;Ge=ze;n=114;continue}if((Ae|0)==(s|0)|((xe|0)==(o|0)?1:(f[u+(Ee<<4)+12>>2]|0)==0)){ve=ye;He=Ee;Be=De;Ge=ze;n=114}else{n=108;break}}if((n|0)==108){Ie=(((Me+Le|0)/(we|0)|0)>>Re)-(xe>>Re)+(ue((((Se+Pe|0)/(Te|0)|0)>>ke)-(Ae>>ke)|0,Ce)|0)|0;f[e+32>>2]=Ie;Ie=f[e+64>>2]|0;ge=e+36|0;f[ge>>2]=Ie;Ne=De;Ve=ze;n=109;continue}else if((n|0)==116){_e=f[e+224>>2]|0;n=e+216|0;dt=f[n>>2]|0;_e=dt+_e-((dt|0)%(_e|0)|0)|0;f[n>>2]=_e;n=95;continue}}if((n|0)==111){n=0;Fe=ue(f[e+8>>2]|0,Ie)|0;Fe=(ue(f[e+12>>2]|0,f[e+28>>2]|0)|0)+Fe|0;Fe=Fe+(ue(f[e+16>>2]|0,Ne)|0)|0;Fe=Fe+(ue(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;Fe=(f[e+4>>2]|0)+(Fe<<1)|0;if(!(d[Fe>>1]|0))break;else{me=ge;Oe=Ie;Ue=Ne;je=Ve;n=113;continue}}else if((n|0)==117){t=f[e+228>>2]|0;n=e+220|0;dt=f[n>>2]|0;t=dt+t-((dt|0)%(t|0)|0)|0;f[n>>2]=t;n=93;continue}}if((n|0)==153)return ft|0;d[Fe>>1]=1;e=1;return e|0}case 4:{t=e+40|0;if(!(f[t>>2]|0)){fe=f[e+24>>2]|0;re=e+36|0;O=re;re=f[re>>2]|0;ae=fe;fe=(f[e+196>>2]|0)+(fe<<4)|0;n=148}else{f[t>>2]=0;B=f[e+48>>2]|0;f[e+24>>2]=B;n=121}while(1){if((n|0)==121){if(B>>>0>=(f[e+60>>2]|0)>>>0){ft=0;n=153;break}t=f[e+196>>2]|0;g=t+(B<<4)|0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;l=f[t+(B<<4)+8>>2]|0;if(l){c=f[t+(B<<4)+12>>2]|0;u=f[g>>2]|0;i=f[t+(B<<4)+4>>2]|0;a=l+-1|0;n=0;t=0;r=0;s=0;while(1){o=a+r|0;dt=u<<o+(f[c+(s<<4)>>2]|0);o=i<<(f[c+(s<<4)+4>>2]|0)+o;n=(n|0)==0?dt:n>>>0<dt>>>0?n:dt;t=(t|0)==0?o:t>>>0<o>>>0?t:o;o=s+1|0;if((o|0)==(l|0))break;else{r=~s;s=o}}f[p>>2]=n;f[m>>2]=t}if(!(h[e>>0]|0)){t=f[e+204>>2]|0;f[e+104>>2]=t;f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}else t=f[e+104>>2]|0;f[e+220>>2]=t;I=t;N=B;n=130}else if((n|0)==148){ee=re+1|0;f[O>>2]=ee;H=O;te=ae;de=fe;n=144}while(1){if((n|0)==130){if((I|0)>=(f[e+108>>2]|0)){n=152;break}z=f[e+96>>2]|0;f[e+216>>2]=z;oe=N;ce=g;n=132}else if((n|0)==144){if(ee>>>0<(f[e+52>>2]|0)>>>0){n=146;break}ie=e+28|0;D=ie;ie=f[ie>>2]|0;le=te;pe=de;n=149}while(1){if((n|0)==132){if((z|0)>=(f[e+100>>2]|0)){n=151;break}V=f[e+44>>2]|0;U=e+28|0;f[U>>2]=V;se=oe;he=ce}else if((n|0)==149){V=ie+1|0;f[D>>2]=V;U=D;se=le;he=pe}dt=f[e+56>>2]|0;t=f[he+8>>2]|0;if(V>>>0>=(dt>>>0<t>>>0?dt:t)>>>0){z=f[e+224>>2]|0;oe=e+216|0;ce=f[oe>>2]|0;z=ce+z-((ce|0)%(z|0)|0)|0;f[oe>>2]=z;oe=se;ce=he;n=132;continue}c=f[he+12>>2]|0;t=t+~V|0;n=f[e+200>>2]|0;r=f[he>>2]|0;j=r<<t;G=(n+-1+j|0)/(j|0)|0;i=f[e+204>>2]|0;dt=f[he+4>>2]|0;W=dt<<t;q=(i+-1+W|0)/(W|0)|0;X=j+-1|0;a=(X+(f[e+208>>2]|0)|0)/(j|0)|0;Y=W+-1|0;o=(Y+(f[e+212>>2]|0)|0)/(W|0)|0;K=f[c+(V<<4)>>2]|0;s=K+t|0;Z=f[c+(V<<4)+4>>2]|0;l=Z+t|0;Q=f[e+220>>2]|0;if((Q|0)%(dt<<l|0)|0){if((Q|0)!=(i|0)){D=U;ie=V;le=se;pe=he;n=149;continue}if(!((q<<t|0)%(1<<l|0)|0)){D=U;ie=V;le=se;pe=he;n=149;continue}}J=f[e+216>>2]|0;if((J|0)%(r<<s|0)|0){if((J|0)!=(n|0)){D=U;ie=V;le=se;pe=he;n=149;continue}if(!((G<<t|0)%(1<<s|0)|0)){D=U;ie=V;le=se;pe=he;n=149;continue}}$=f[c+(V<<4)+8>>2]|0;if(!$){D=U;ie=V;le=se;pe=he;n=149;continue}if((q|0)==(o|0)|((G|0)==(a|0)?1:(f[c+(V<<4)+12>>2]|0)==0)){D=U;ie=V;le=se;pe=he;n=149}else{n=143;break}}if((n|0)==143){ee=(((X+J|0)/(j|0)|0)>>K)-(G>>K)+(ue((((Y+Q|0)/(W|0)|0)>>Z)-(q>>Z)|0,$)|0)|0;f[e+32>>2]=ee;ee=f[e+64>>2]|0;H=e+36|0;f[H>>2]=ee;te=se;de=he;n=144;continue}else if((n|0)==151){I=f[e+228>>2]|0;N=e+220|0;g=f[N>>2]|0;I=g+I-((g|0)%(I|0)|0)|0;f[N>>2]=I;N=oe;g=ce;n=130;continue}}if((n|0)==146){n=0;ne=ue(f[e+8>>2]|0,ee)|0;ne=(ue(f[e+12>>2]|0,f[e+28>>2]|0)|0)+ne|0;ne=ne+(ue(f[e+16>>2]|0,te)|0)|0;ne=ne+(ue(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;ne=(f[e+4>>2]|0)+(ne<<1)|0;if(!(d[ne>>1]|0))break;else{O=H;re=ee;ae=te;fe=de;n=148;continue}}else if((n|0)==152){B=N+1|0;f[e+24>>2]=B;n=121;continue}}if((n|0)==153)return ft|0;d[ne>>1]=1;e=1;return e|0}default:{e=0;return e|0}}return 0}function Hn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0;u=(f[t+(n*5640|0)+420>>2]|0)+1|0;r=Yi(u,232)|0;if(!r){u=0;return u|0}if(!u){u=r;return u|0}l=e+16|0;a=t+(n*5640|0)+5584|0;e=f[l>>2]|0;o=r;s=0;e:while(1){t=Yi(e,16)|0;i=o+196|0;f[i>>2]=t;if(!t){e=5;break}c=f[l>>2]|0;f[o+192>>2]=c;t:do{if(!c)e=0;else{e=(f[a>>2]|0)+4|0;c=Yi(f[e>>2]|0,16)|0;f[t+12>>2]=c;if(!c){e=18;break e}else n=0;while(1){f[t+(n<<4)+8>>2]=f[e>>2];n=n+1|0;e=f[l>>2]|0;if(n>>>0>=e>>>0)break t;t=f[i>>2]|0;e=(f[a>>2]|0)+(n*1080|0)+4|0;c=Yi(f[e>>2]|0,16)|0;f[t+(n<<4)+12>>2]=c;if(!c){e=18;break e}}}}while(0);s=s+1|0;if(s>>>0>=u>>>0){e=32;break}else o=o+232|0}if((e|0)==5){e=r+4|0;t=f[e>>2]|0;if(!t){l=r;c=0}else{Ji(t);f[e>>2]=0;l=r;c=0}while(1){s=l+196|0;e=f[s>>2]|0;if(e){o=l+192|0;t=f[o>>2]|0;if(t){a=0;while(1){n=e+12|0;i=f[n>>2]|0;if(i){Ji(i);f[n>>2]=0;t=f[o>>2]|0}a=a+1|0;if(a>>>0>=t>>>0)break;else e=e+16|0}e=f[s>>2]|0}Ji(e);f[s>>2]=0}c=c+1|0;if((c|0)==(u|0))break;else l=l+232|0}Ji(r);u=0;return u|0}else if((e|0)==18){e=r+4|0;t=f[e>>2]|0;if(!t){l=r;c=0}else{Ji(t);f[e>>2]=0;l=r;c=0}while(1){s=l+196|0;e=f[s>>2]|0;if(e){o=l+192|0;t=f[o>>2]|0;if(t){a=0;while(1){n=e+12|0;i=f[n>>2]|0;if(i){Ji(i);f[n>>2]=0;t=f[o>>2]|0}a=a+1|0;if(a>>>0>=t>>>0)break;else e=e+16|0}e=f[s>>2]|0}Ji(e);f[s>>2]=0}c=c+1|0;if((c|0)==(u|0))break;else l=l+232|0}Ji(r);u=0;return u|0}else if((e|0)==32)return r|0;return 0}function Dn(e,t,n,r,i,a,o,s,l,c,u,h){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;c=c|0;u=u|0;h=h|0;var d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0;p=f[(f[t+76>>2]|0)+(n*5640|0)+5584>>2]|0;d=f[e+24>>2]|0;I=f[t+24>>2]|0;C=t+12|0;L=(ue(f[C>>2]|0,(n>>>0)%(I>>>0)|0)|0)+(f[t+4>>2]|0)|0;P=f[e>>2]|0;f[r>>2]=L>>>0>P>>>0?L:P;L=Wl(f[C>>2]|0,0,L|0,0)|0;L=L|0-B;C=f[e+8>>2]|0;f[i>>2]=L>>>0<C>>>0?L:C;C=t+16|0;I=(ue(f[C>>2]|0,(n>>>0)/(I>>>0)|0)|0)+(f[t+8>>2]|0)|0;L=f[e+4>>2]|0;f[a>>2]=I>>>0>L>>>0?I:L;I=Wl(f[C>>2]|0,0,I|0,0)|0;I=I|0-B;C=f[e+12>>2]|0;f[o>>2]=I>>>0<C>>>0?I:C;f[c>>2]=0;f[u>>2]=0;f[s>>2]=2147483647;f[l>>2]=2147483647;C=e+16|0;if(!(f[C>>2]|0))return;else I=0;while(1){v=f[h+(I<<2)>>2]|0;m=f[d>>2]|0;e=((f[r>>2]|0)+-1+m|0)/(m|0)|0;P=d+4|0;g=f[P>>2]|0;n=((f[a>>2]|0)+-1+g|0)/(g|0)|0;m=(m+-1+(f[i>>2]|0)|0)/(m|0)|0;g=(g+-1+(f[o>>2]|0)|0)/(g|0)|0;L=p+4|0;t=f[L>>2]|0;if(t>>>0>(f[u>>2]|0)>>>0){f[u>>2]=t;t=f[L>>2]|0}if(t){R=Wl(e|0,((e|0)<0)<<31>>31|0,-1,-1)|0;k=B;M=Wl(n|0,((n|0)<0)<<31>>31|0,-1,-1)|0;S=B;T=Wl(m|0,((m|0)<0)<<31>>31|0,-1,-1)|0;A=B;w=Wl(g|0,((g|0)<0)<<31>>31|0,-1,-1)|0;x=B;E=0;while(1){t=t+-1|0;m=f[p+812+(E<<2)>>2]|0;b=f[p+944+(E<<2)>>2]|0;f[v>>2]=m;f[v+4>>2]=b;y=f[d>>2]<<m+t;N=f[P>>2]<<b+t;e=f[s>>2]|0;f[s>>2]=(e|0)<(y|0)?e:y;y=f[l>>2]|0;f[l>>2]=(y|0)<(N|0)?y:N;N=Gl(1,0,t|0)|0;y=B;e=Wl(R|0,k|0,N|0,y|0)|0;e=Vl(e|0,B|0,t|0)|0;g=Wl(M|0,S|0,N|0,y|0)|0;g=Vl(g|0,B|0,t|0)|0;n=Wl(T|0,A|0,N|0,y|0)|0;n=Vl(n|0,B|0,t|0)|0;y=Wl(w|0,x|0,N|0,y|0)|0;y=Vl(y|0,B|0,t|0)|0;N=Gl(1,0,b|0)|0;_=B;F=Wl(y|0,((y|0)<0)<<31>>31|0,-1,-1)|0;_=Wl(F|0,B|0,N|0,_|0)|0;_=Vl(_|0,B|0,b|0)|0;if((e|0)==(n|0))e=0;else{n=Wl(n|0,((n|0)<0)<<31>>31|0,-1,-1)|0;N=B;F=Gl(1,0,m|0)|0;F=Wl(n|0,N|0,F|0,B|0)|0;F=Vl(F|0,B|0,m|0)|0;e=(F<<m)-(e>>m<<m)>>m}F=(g|0)==(y|0)?0:(_<<b)-(g>>b<<b)>>b;f[v+8>>2]=e;f[v+12>>2]=F;e=ue(e,F)|0;if(e>>>0>(f[c>>2]|0)>>>0)f[c>>2]=e;E=E+1|0;if(E>>>0>=(f[L>>2]|0)>>>0)break;else v=v+16|0}}I=I+1|0;if(I>>>0>=(f[C>>2]|0)>>>0)break;else{d=d+52|0;p=p+1080|0}}return}function Un(e,t,n,r,i,a,o,s,l){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;var c=0,u=0;c=(f[e+(t*5640|0)+420>>2]|0)+1|0;f[e+(t*5640|0)+500>>2]=f[e+(t*5640|0)+428>>2];f[e+(t*5640|0)+516>>2]=f[e+(t*5640|0)+440>>2];f[e+(t*5640|0)+496>>2]=f[e+(t*5640|0)+424>>2];f[e+(t*5640|0)+512>>2]=f[e+(t*5640|0)+436>>2];f[e+(t*5640|0)+508>>2]=f[e+(t*5640|0)+432>>2];f[e+(t*5640|0)+492>>2]=0;f[e+(t*5640|0)+460>>2]=f[e+(t*5640|0)+456>>2];f[e+(t*5640|0)+504>>2]=0;f[e+(t*5640|0)+520>>2]=o;f[e+(t*5640|0)+524>>2]=n;f[e+(t*5640|0)+528>>2]=r;f[e+(t*5640|0)+532>>2]=i;f[e+(t*5640|0)+536>>2]=a;f[e+(t*5640|0)+540>>2]=s;f[e+(t*5640|0)+544>>2]=l;if(c>>>0<=1)return;e=e+(t*5640|0)+572|0;t=1;while(1){f[e+76>>2]=f[e+4>>2];f[e+92>>2]=f[e+16>>2];f[e+72>>2]=f[e>>2];f[e+88>>2]=f[e+12>>2];u=f[e+8>>2]|0;f[e+84>>2]=u;f[e+36>>2]=f[e+32>>2];f[e+80>>2]=0;f[e+68>>2]=u>>>0>(f[e+-64>>2]|0)>>>0?u:0;f[e+96>>2]=o;f[e+100>>2]=n;f[e+104>>2]=r;f[e+108>>2]=i;f[e+112>>2]=a;f[e+116>>2]=s;f[e+120>>2]=l;t=t+1|0;if((t|0)==(c|0))break;else e=e+148|0}return}function Bn(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0;s=f[t+76>>2]|0;if((e|0)>-1)a=e;else{n=0;return n|0}e:while(1){switch(h[i+a>>0]|0){case 82:{o=3;break e}case 67:{o=5;break e}case 76:{o=7;break e}case 80:{o=9;break e}default:{}}a=a+-1|0}if((o|0)==3)if((f[s+(n*5640|0)+424+(r*148|0)+128>>2]|0)==(f[s+(n*5640|0)+424+(r*148|0)+88>>2]|0))return(Bn(e+-1|0,t,n,r,i)|0)!=0|0;else{n=1;return n|0}else if((o|0)==5)if((f[s+(n*5640|0)+424+(r*148|0)+132>>2]|0)==(f[s+(n*5640|0)+424+(r*148|0)+92>>2]|0))return(Bn(e+-1|0,t,n,r,i)|0)!=0|0;else{n=1;return n|0}else if((o|0)==7)if((f[s+(n*5640|0)+424+(r*148|0)+124>>2]|0)==(f[s+(n*5640|0)+424+(r*148|0)+84>>2]|0))return(Bn(e+-1|0,t,n,r,i)|0)!=0|0;else{n=1;return n|0}else if((o|0)==9){if((f[s+(n*5640|0)+424+(r*148|0)+36>>2]|0)>>>0<2)if((f[s+(n*5640|0)+424+(r*148|0)+136>>2]|0)==(f[s+(n*5640|0)+424+(r*148|0)+96>>2]|0))return(Bn(a+-1|0,t,n,r,i)|0)!=0|0;else{n=1;return n|0}if((f[s+(n*5640|0)+424+(r*148|0)+140>>2]|0)!=(f[s+(n*5640|0)+424+(r*148|0)+104>>2]|0)){n=1;return n|0}if((f[s+(n*5640|0)+424+(r*148|0)+144>>2]|0)==(f[s+(n*5640|0)+424+(r*148|0)+112>>2]|0))return(Bn(a+-1|0,t,n,r,i)|0)!=0|0;else{n=1;return n|0}}return 0}function zn(e){e=e|0;var t=0,n=0;t=Yi(1,44)|0;if(!t){e=0;return e|0}n=t+40|0;h[n>>0]=h[n>>0]&-2|(e|0)!=0;e=Yi(1,4)|0;f[t+20>>2]=e;if(e){n=t;return n|0}Ji(t);n=0;return n|0}function Vn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0.0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0;B=b;b=b+1200|0;U=B;r=f[f[e+20>>2]>>2]|0;D=r+16|0;i=f[D>>2]|0;if(!i){b=B;return}F=r+20|0;O=(f[e+32>>2]|0)+8|0;H=(f[e+28>>2]|0)+88|0;I=e+24|0;N=(t|0)==0;L=(n|0)==0;C=t+-1|0;r=i;P=0;do{s=f[F>>2]|0;l=f[O>>2]|0;R=f[s+(P*52|0)+16>>2]|0;if(l){if(R){e=f[H>>2]|0;a=+((f[(f[(f[I>>2]|0)+24>>2]|0)+(P*52|0)+24>>2]|0)>>>0)*.0625;i=0;do{n=ue(R,i)|0;o=0;do{k=(n+o|0)*3|0;f[U+(i*120|0)+(o*12|0)>>2]=~~(+(f[e+(k<<2)>>2]|0)*a);f[U+(i*120|0)+(o*12|0)+4>>2]=~~(+(f[e+(k+1<<2)>>2]|0)*a);f[U+(i*120|0)+(o*12|0)+8>>2]=~~(+(f[e+(k+2<<2)>>2]|0)*a);o=o+1|0}while(o>>>0<R>>>0);i=i+1|0}while(i>>>0<l>>>0);k=9}}else k=9;if((k|0)==9){k=0;if(R){w=s+(P*52|0)+24|0;S=0;do{x=f[w>>2]|0;T=x+(S*136|0)+24|0;r=f[T>>2]|0;if(r){A=x+(S*136|0)+16|0;M=x+(S*136|0)+20|0;e=f[M>>2]|0;n=f[A>>2]|0;E=0;do{if(ue(e,n)|0){v=x+(S*136|0)+28+(E*36|0)+20|0;y=U+(t*120|0)+(S*12|0)+(E<<2)|0;_=U+(C*120|0)+(S*12|0)+(E<<2)|0;g=0;do{r=f[v>>2]|0;m=ue(f[r+(g*40|0)+20>>2]|0,f[r+(g*40|0)+16>>2]|0)|0;if(m){u=r+(g*40|0)+24|0;h=f[y>>2]|0;p=0;do{l=f[u>>2]|0;c=l+(p*52|0)|0;d=f[l+(p*52|0)+4>>2]|0;r=(f[(f[(f[I>>2]|0)+24>>2]|0)+(P*52|0)+24>>2]|0)-(f[l+(p*52|0)+28>>2]|0)|0;if(!N){e=f[_>>2]|0;n=h-e|0;if((e|0)<=(r|0)){n=n+(e-r)|0;n=(n|0)<0?0:n}}else{f[l+(p*52|0)+44>>2]=0;n=(h|0)>(r|0)?h-r|0:0}s=l+(p*52|0)+44|0;i=f[s>>2]|0;o=(i|0)==0;if(o)if(!n)n=0;else n=(n*3|0)+-2|0;else n=(n*3|0)+i|0;f[d+(t*24|0)>>2]=n-i;do{if((n|0)!=(i|0)){e=f[l+(p*52|0)+8>>2]|0;r=f[e+((n+-1|0)*24|0)>>2]|0;if(o)f[d+(t*24|0)+16>>2]=f[c>>2];else{l=f[e+((i+-1|0)*24|0)>>2]|0;f[d+(t*24|0)+16>>2]=(f[c>>2]|0)+l;r=r-l|0}f[d+(t*24|0)+4>>2]=r;if(L)break;f[s>>2]=n}}while(0);p=p+1|0}while(p>>>0<m>>>0);e=f[M>>2]|0;n=f[A>>2]|0}g=g+1|0}while(g>>>0<(ue(e,n)|0)>>>0);r=f[T>>2]|0}E=E+1|0}while(E>>>0<r>>>0)}S=S+1|0}while(S>>>0<R>>>0);r=f[D>>2]|0}}P=P+1|0}while(P>>>0<r>>>0);b=B;return}function jn(e,t,n,r){e=e|0;t=t|0;n=+n;r=r|0;var i=0,a=0.0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0;e=f[f[e+20>>2]>>2]|0;C=e+40+(t<<3)|0;y[C>>3]=0.0;I=e+16|0;i=f[I>>2]|0;if(!i)return;P=e+20|0;L=(t|0)==0;k=(r|0)==0;e=i;R=0;do{i=f[P>>2]|0;S=f[i+(R*52|0)+16>>2]|0;if(S){E=i+(R*52|0)+24|0;M=0;do{w=f[E>>2]|0;x=w+(M*136|0)+24|0;e=f[x>>2]|0;if(e){T=w+(M*136|0)+16|0;A=w+(M*136|0)+20|0;i=f[A>>2]|0;r=f[T>>2]|0;b=0;do{if(ue(i,r)|0){_=w+(M*136|0)+28+(b*36|0)+20|0;v=0;do{e=f[_>>2]|0;g=ue(f[e+(v*40|0)+20>>2]|0,f[e+(v*40|0)+16>>2]|0)|0;if(g){h=e+(v*40|0)+24|0;m=0;do{l=f[h>>2]|0;c=l+(m*52|0)|0;d=f[l+(m*52|0)+4>>2]|0;p=l+(m*52|0)+44|0;if(L){f[p>>2]=0;u=0}else u=f[p>>2]|0;r=f[l+(m*52|0)+48>>2]|0;if(u>>>0<r>>>0){o=f[l+(m*52|0)+8>>2]|0;e=u;s=u;do{i=f[o+(s*24|0)>>2]|0;a=+y[o+(s*24|0)+8>>3];if(e){F=e+-1|0;a=a-+y[o+(F*24|0)+8>>3];i=i-(f[o+(F*24|0)>>2]|0)|0}do{if(!i){if(!(a!=0.0))break;e=s+1|0}else{if(!(n-a/+(i>>>0)<2.220446049250313e-16))break;e=s+1|0}}while(0);s=s+1|0}while(s>>>0<r>>>0);o=e;f[d+(t*24|0)>>2]=o-u;if((o|0)!=(u|0)){r=o+-1|0;i=f[l+(m*52|0)+8>>2]|0;e=f[i+(r*24|0)>>2]|0;if(!u){f[d+(t*24|0)+16>>2]=f[c>>2];a=+y[i+(r*24|0)+8>>3]}else{u=u+-1|0;F=f[i+(u*24|0)>>2]|0;f[d+(t*24|0)+16>>2]=(f[c>>2]|0)+F;a=+y[i+(r*24|0)+8>>3]-+y[i+(u*24|0)+8>>3];e=e-F|0}f[d+(t*24|0)+4>>2]=e;y[d+(t*24|0)+8>>3]=a;y[C>>3]=a+ +y[C>>3];if(!k)f[p>>2]=o}else N=26}else{f[d+(t*24|0)>>2]=0;N=26}if((N|0)==26){N=0;y[d+(t*24|0)+8>>3]=0.0}m=m+1|0}while(m>>>0<g>>>0);i=f[A>>2]|0;r=f[T>>2]|0}v=v+1|0}while(v>>>0<(ue(i,r)|0)>>>0);e=f[x>>2]|0}b=b+1|0}while(b>>>0<e>>>0)}M=M+1|0}while(M>>>0<S>>>0);e=f[I>>2]|0}R=R+1|0}while(R>>>0<e>>>0);return}function Gn(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0.0,l=0.0,c=0.0,u=0.0,p=0.0,m=0.0,g=0,_=0,E=0,w=0,x=0.0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0.0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0;X=b;b=b+800|0;q=X;j=f[e+28>>2]|0;G=f[f[e+20>>2]>>2]|0;W=f[e+32>>2]|0;B=G+24|0;f[B>>2]=0;z=f[G+16>>2]|0;if(!z){a=0;F=0.0;s=0.0;c=1797693134862315708145274.0e284}else{D=f[G+20>>2]|0;U=f[(f[e+24>>2]|0)+24>>2]|0;a=0;V=0;l=0.0;s=0.0;c=1797693134862315708145274.0e284;do{N=D+(V*52|0)+48|0;f[N>>2]=0;O=f[D+(V*52|0)+16>>2]|0;if(!O)o=0;else{H=f[D+(V*52|0)+24>>2]|0;o=0;I=0;do{P=f[H+(I*136|0)+24>>2]|0;if(P){L=ue(f[H+(I*136|0)+20>>2]|0,f[H+(I*136|0)+16>>2]|0)|0;C=(L|0)==0;k=0;do{if(!C){R=f[H+(I*136|0)+28+(k*36|0)+20>>2]|0;S=0;do{A=ue(f[R+(S*40|0)+20>>2]|0,f[R+(S*40|0)+16>>2]|0)|0;if(A){M=f[R+(S*40|0)+24>>2]|0;T=0;do{E=f[M+(T*52|0)+48>>2]|0;if(E){w=f[M+(T*52|0)+8>>2]|0;_=0;do{g=f[w+(_*24|0)>>2]|0;u=+y[w+(_*24|0)+8>>3];if(_){Y=_+-1|0;u=u-+y[w+(Y*24|0)+8>>3];g=g-(f[w+(Y*24|0)>>2]|0)|0}do{if(g){u=u/+(g|0);c=u<c?u:c;if(!(u>l))break;l=u}}while(0);_=_+1|0}while(_>>>0<E>>>0)}Y=ue((f[M+(T*52|0)+24>>2]|0)-(f[M+(T*52|0)+16>>2]|0)|0,(f[M+(T*52|0)+20>>2]|0)-(f[M+(T*52|0)+12>>2]|0)|0)|0;a=Y+a|0;o=Y+o|0;T=T+1|0}while(T>>>0<A>>>0);f[B>>2]=a;f[N>>2]=o}S=S+1|0}while(S>>>0<L>>>0)}k=k+1|0}while(k>>>0<P>>>0)}I=I+1|0}while(I>>>0<O>>>0)}F=+(1<<f[U+(V*52|0)+24>>2]|0)+-1.0;s=s+ +(o|0)*(F*F);V=V+1|0}while(V>>>0<z>>>0);F=l}N=(i|0)!=0;if(N){V=f[e+36>>2]|0;z=f[i+88>>2]|0;f[z+(V*592|0)+552>>2]=a;y[z+(V*592|0)+560>>3]=+y[G+32>>3];a=W+8|0;Y=Xi(f[a>>2]<<3)|0;f[z+(V*592|0)>>2]=Y;if(!Y){Y=0;b=X;return Y|0}}else a=W+8|0;if(!(f[a>>2]|0)){Y=1;b=X;return Y|0}A=G+32|0;M=j+93|0;S=e+36|0;R=i+88|0;k=G+40|0;P=e+24|0;L=e+8|0;C=e+16|0;I=0;while(1){l=+v[W+20+(I<<2)>>2];if(l!=0.0){w=~~+ce(+l)>>>0;w=w>>>0<r>>>0?w:r}else w=r;m=+v[W+5184+(I<<2)>>2];x=+y[A>>3]-s/+$(10.0,+(m/10.0));Y=h[M>>0]|0;if(!((Y&1)!=0&l>0.0)?!((Y&4)!=0&m>0.0):0)l=c;else{T=is(f[P>>2]|0,j)|0;if(!T){a=0;o=57;break}E=I+1|0;o=q+(I+-1<<3)|0;g=G+40+(I<<3)|0;if(!I){p=F;o=0;m=c;u=0.0;do{l=(m+p)*.5;jn(e,0,l,0);do{if(h[M>>0]&4){if(((d[j>>1]|0)+-3&65535)>=4){Y=+y[k>>3]<x;p=Y?l:p;m=Y?m:l;u=Y?l:u;break}if(!(ns(T,f[S>>2]|0,G,E,t,n,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0))m=l;else{Y=+y[k>>3]<x;p=Y?l:p;m=Y?m:l;u=Y?l:u}}else{Y=(ns(T,f[S>>2]|0,G,E,t,n,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0)==0;p=Y?p:l;m=Y?l:m;u=Y?u:l}}while(0);o=o+1|0}while((o|0)!=128)}else{p=F;_=0;m=c;u=0.0;do{l=(m+p)*.5;jn(e,I,l,0);do{if(h[M>>0]&4){if(((d[j>>1]|0)+-3&65535)>=4){Y=+y[o>>3]+ +y[g>>3]<x;p=Y?l:p;m=Y?m:l;u=Y?l:u;break}if(!(ns(T,f[S>>2]|0,G,E,t,n,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0))m=l;else{Y=+y[o>>3]+ +y[g>>3]<x;p=Y?l:p;m=Y?m:l;u=Y?l:u}}else{Y=(ns(T,f[S>>2]|0,G,E,t,n,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0)==0;p=Y?p:l;m=Y?l:m;u=Y?u:l}}while(0);_=_+1|0}while((_|0)!=128)}as(T);l=u==0.0?l:u}if(N)y[(f[(f[R>>2]|0)+((f[S>>2]|0)*592|0)>>2]|0)+(I<<3)>>3]=l;jn(e,I,l,1);if(!I)l=+y[k>>3];else l=+y[q+(I+-1<<3)>>3]+ +y[G+40+(I<<3)>>3];y[q+(I<<3)>>3]=l;I=I+1|0;if(I>>>0>=(f[a>>2]|0)>>>0){a=1;o=57;break}}if((o|0)==57){b=X;return a|0}return 0}function Wn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;f[e+24>>2]=t;f[e+28>>2]=n;i=Yi(1,848)|0;r=e+20|0;f[f[r>>2]>>2]=i;if(!i){e=0;return e|0}i=t+16|0;a=Yi(f[i>>2]|0,52)|0;t=f[f[r>>2]>>2]|0;f[t+20>>2]=a;if(!a){a=0;return a|0}f[t+16>>2]=f[i>>2];f[e>>2]=f[n+84>>2];a=1;return a|0}function qn(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;if(!e)return;y=e+20|0;t=f[y>>2]|0;do{if(t){v=(h[e+40>>0]&1)==0?3:4;n=f[t>>2]|0;if(n){p=n+20|0;l=n+16|0;if(f[l>>2]|0){u=0;d=f[p>>2]|0;while(1){c=d+24|0;t=f[c>>2]|0;if(t){o=f[d+28>>2]|0;s=(o>>>0)/136|0;if(o>>>0>135){o=0;while(1){a=t+48|0;n=f[a>>2]|0;if(n){r=f[t+52>>2]|0;i=(r>>>0)/40|0;if(r>>>0>39){r=0;while(1){_=n+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=n+36|0;fo(f[_>>2]|0);f[_>>2]=0;Lc[v&7](n);r=r+1|0;if(r>>>0>=i>>>0)break;else n=n+40|0}n=f[a>>2]|0}Ji(n);f[a>>2]=0}a=t+84|0;n=f[a>>2]|0;if(n){_=f[t+88>>2]|0;i=(_>>>0)/40|0;if(_>>>0>39){r=0;while(1){_=n+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=n+36|0;fo(f[_>>2]|0);f[_>>2]=0;Lc[v&7](n);r=r+1|0;if(r>>>0>=i>>>0)break;else n=n+40|0}n=f[a>>2]|0}Ji(n);f[a>>2]=0}a=t+120|0;n=f[a>>2]|0;if(n){_=f[t+124>>2]|0;i=(_>>>0)/40|0;if(_>>>0>39){r=0;while(1){_=n+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=n+36|0;fo(f[_>>2]|0);f[_>>2]=0;Lc[v&7](n);r=r+1|0;if(r>>>0>=i>>>0)break;else n=n+40|0}n=f[a>>2]|0}Ji(n);f[a>>2]=0}o=o+1|0;if(o>>>0>=s>>>0)break;else t=t+136|0}t=f[c>>2]|0}Ji(t);f[c>>2]=0}if((f[d+36>>2]|0)!=0?(m=d+32|0,g=f[m>>2]|0,(g|0)!=0):0){Zi(g);f[m>>2]=0;f[m+4>>2]=0;f[m+8>>2]=0;f[m+12>>2]=0}u=u+1|0;if(u>>>0>=(f[l>>2]|0)>>>0)break;else d=d+52|0}}Ji(f[p>>2]|0);f[p>>2]=0;Ji(f[f[y>>2]>>2]|0);t=f[y>>2]|0;f[t>>2]=0;if(!t)break}Ji(t);f[y>>2]=0}}while(0);Ji(e);return}function Xn(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;r=e+32|0;i=f[r>>2]|0;t=e+40|0;n=f[t>>2]|0;if(i){a=e+44|0;if(n>>>0<=(f[a>>2]|0)>>>0){e=1;return e|0}if(f[e+36>>2]|0){Zi(i);i=Ki(f[t>>2]|0)|0;f[r>>2]=i;if(!i){f[a>>2]=0;f[t>>2]=0;f[e+36>>2]=0;e=0;return e|0}else{f[a>>2]=f[t>>2];f[e+36>>2]=1;e=1;return e|0}}}a=Ki(n)|0;f[r>>2]=a;if(!a){e=0;return e|0}f[e+44>>2]=f[t>>2];f[e+36>>2]=1;e=1;return e|0}function Yn(e,t,n){e=e|0;t=t|0;n=n|0;return ir(e,t,1,1.0,52,n)|0}function Kn(e,t,n){e=e|0;t=t|0;n=n|0;return ir(e,t,0,.5,56,n)|0}function Zn(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0;n=f[e+24>>2]|0;i=f[n+16>>2]|0;if(!i){a=0;return a|0}a=0;t=0;r=f[n+24>>2]|0;n=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){s=f[r+24>>2]|0;s=((s&7|0)!=0&1)+(s>>>3)|0;o=f[n+24>>2]|0;e=(f[n+20>>2]|0)+-1|0;t=(ue(ue((s|0)==3?4:s,(f[o+(e*136|0)+8>>2]|0)-(f[o+(e*136|0)>>2]|0)|0)|0,(f[o+(e*136|0)+12>>2]|0)-(f[o+(e*136|0)+4>>2]|0)|0)|0)+t|0;a=a+1|0;if(a>>>0>=i>>>0)break;else{r=r+52|0;n=n+52|0}}return t|0}function Qn(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;var o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0;T=b;b=b+16|0;w=T;if(!(f[e+8>>2]|0)){f[e+36>>2]=t;_=e+28|0;o=f[(f[_>>2]|0)+76>>2]|0;x=e+32|0;f[x>>2]=o+(t*5640|0);E=(a|0)==0;y=e+20|0;if(!E){s=f[(f[f[y>>2]>>2]|0)+20>>2]|0;d=f[o+(t*5640|0)+5584>>2]|0;p=s+16|0;if(!(f[p>>2]|0)){s=a+88|0;o=0}else{l=f[s+24>>2]|0;s=a+88|0;c=f[s>>2]|0;u=0;o=0;do{v=l+(u*136|0)+16|0;f[c+(t*592|0)+20+(u<<2)>>2]=f[v>>2];g=l+(u*136|0)+20|0;f[c+(t*592|0)+152+(u<<2)>>2]=f[g>>2];o=(ue(f[g>>2]|0,f[v>>2]|0)|0)+o|0;f[c+(t*592|0)+284+(u<<2)>>2]=f[d+812+(u<<2)>>2];f[c+(t*592|0)+416+(u<<2)>>2]=f[d+944+(u<<2)>>2];u=u+1|0}while(u>>>0<(f[p>>2]|0)>>>0)}v=Yi(ue(ue(f[a+52>>2]|0,o)|0,f[a+56>>2]|0)|0,32)|0;f[(f[s>>2]|0)+(t*592|0)+548>>2]=v;if(!v){e=0;b=T;return e|0}}o=f[f[y>>2]>>2]|0;v=o+16|0;if(!(f[v>>2]|0)){u=f[x>>2]|0;l=0;s=f[o+20>>2]|0}else{u=f[x>>2]|0;s=f[o+20>>2]|0;t=0;m=f[u+5584>>2]|0;g=s;while(1){d=f[g+32>>2]|0;p=ue((f[g+12>>2]|0)-(f[g+4>>2]|0)|0,(f[g+8>>2]|0)-(f[g>>2]|0)|0)|0;o=(p|0)==0;if((f[m+20>>2]|0)==1){if(!o){l=m+1076|0;c=0;o=d;while(1){f[o>>2]=(f[o>>2]|0)-(f[l>>2]|0);c=c+1|0;if((c|0)==(p|0))break;else o=o+4|0}}}else if(!o){l=m+1076|0;c=0;o=d;while(1){f[o>>2]=(f[o>>2]|0)-(f[l>>2]|0)<<11;c=c+1|0;if((c|0)==(p|0))break;else o=o+4|0}}t=t+1|0;l=f[v>>2]|0;if(t>>>0>=l>>>0)break;else{m=m+1080|0;g=g+52|0}}}d=ue((f[s+12>>2]|0)-(f[s+4>>2]|0)|0,(f[s+8>>2]|0)-(f[s>>2]|0)|0)|0;e:do{switch(f[u+16>>2]|0){case 0:break;case 2:{if(f[u+5608>>2]|0){c=Xi(l<<2)|0;if(!c){e=0;b=T;return e|0}o=f[v>>2]|0;if(!o)o=0;else{l=0;while(1){f[c+(l<<2)>>2]=f[s+32>>2];l=l+1|0;if((l|0)==(o|0))break;else s=s+52|0}}v=(Rn(f[(f[x>>2]|0)+5608>>2]|0,d,c,o,f[(f[(f[e+24>>2]|0)+24>>2]|0)+32>>2]|0)|0)==0;Ji(c);if(v){e=0;b=T;return e|0}}break}default:{l=f[s+32>>2]|0;c=f[s+84>>2]|0;o=f[s+136>>2]|0;if(!(f[(f[u+5584>>2]|0)+20>>2]|0)){Mn(l,c,o,d);break e}else{Tn(l,c,o,d);break e}}}}while(0);o=f[f[y>>2]>>2]|0;s=o+16|0;e:do{if(f[s>>2]|0){l=0;c=f[(f[x>>2]|0)+5584>>2]|0;o=f[o+20>>2]|0;t:while(1){switch(f[c+20>>2]|0){case 1:{if(!(Co(o)|0)){o=0;s=54;break t}break}case 0:{if(!(Oo(o)|0)){o=0;s=54;break t}break}default:{}}l=l+1|0;if(l>>>0>=(f[s>>2]|0)>>>0)break e;else{c=c+1080|0;o=o+52|0}}if((s|0)==54){b=T;return o|0}}}while(0);o=f[x>>2]|0;s=Ko(1)|0;if(!s){e=0;b=T;return e|0}do{if((f[o+16>>2]|0)==1)if(!(f[(f[o+5584>>2]|0)+20>>2]|0)){l=xn()|0;c=3;break}else{l=wn()|0;c=3;break}else{l=f[o+5600>>2]|0;c=f[(f[e+24>>2]|0)+16>>2]|0}}while(0);y=Jo(s,f[f[y>>2]>>2]|0,o,l,c)|0;Zo(s);if(!y){e=0;b=T;return e|0}o=f[_>>2]|0;f[w>>2]=0;if(!E)f[a+12>>2]=0;if(!(h[o+93>>0]&5)){if(f[(f[x>>2]|0)+8>>2]|0){o=0;do{Vn(e,o,1);o=o+1|0}while(o>>>0<(f[(f[x>>2]|0)+8>>2]|0)>>>0)}}else if(!(Gn(e,n,w,i,a)|0)){e=0;b=T;return e|0}}if(a)f[a+12>>2]=1;o=is(f[e+24>>2]|0,f[e+28>>2]|0)|0;if(!o)o=1;else{e=ns(o,f[e+36>>2]|0,f[f[e+20>>2]>>2]|0,f[(f[e+32>>2]|0)+8>>2]|0,n,r,i,a,f[e+4>>2]|0,f[e>>2]|0,f[e+16>>2]|0,1)|0;as(o);o=(e|0)==0}e=o&1^1;b=T;return e|0}function Jn(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;var o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,y=0,_=0;_=b;b=b+16|0;c=_+8|0;l=_;s=_+12|0;o=e+36|0;f[o>>2]=r;y=f[e+28>>2]|0;d=e+32|0;f[d>>2]=(f[y+76>>2]|0)+(r*5640|0);f[s>>2]=0;h=e+24|0;r=is(f[h>>2]|0,y)|0;if(!r){y=0;b=_;return y|0}u=e+20|0;y=rs(r,f[o>>2]|0,f[f[u>>2]>>2]|0,t,s,n,i,a)|0;as(r);if(!y){y=0;b=_;return y|0}r=f[f[u>>2]>>2]|0;e=f[(f[d>>2]|0)+5584>>2]|0;o=f[r+20>>2]|0;n=Ko(0)|0;if(!n){y=0;b=_;return y|0}s=r+16|0;e:do{if(f[s>>2]|0){i=0;r=o;while(1){if(!(Qo(n,r,e)|0))break;i=i+1|0;if(i>>>0>=(f[s>>2]|0)>>>0)break e;else{e=e+1080|0;r=r+52|0}}Zo(n);y=0;b=_;return y|0}}while(0);Zo(n);r=f[f[u>>2]>>2]|0;o=r+16|0;do{if(f[o>>2]|0){s=0;i=f[(f[h>>2]|0)+24>>2]|0;n=f[(f[d>>2]|0)+5584>>2]|0;e=f[r+20>>2]|0;while(1){r=(f[i+36>>2]|0)+1|0;if((f[n+20>>2]|0)==1){if(!(Io(e,r)|0)){r=0;e=49;break}}else if(!(Bo(e,r)|0)){r=0;e=49;break}s=s+1|0;if(s>>>0>=(f[o>>2]|0)>>>0){e=14;break}else{i=i+52|0;n=n+1080|0;e=e+52|0}}if((e|0)==14){r=f[f[u>>2]>>2]|0;break}else if((e|0)==49){b=_;return r|0}}}while(0);s=f[d>>2]|0;e=f[r+20>>2]|0;o=f[s+16>>2]|0;do{if(o){t=ue((f[e+12>>2]|0)-(f[e+4>>2]|0)|0,(f[e+8>>2]|0)-(f[e>>2]|0)|0)|0;n=r+16|0;r=f[n>>2]|0;if(r>>>0<=2){f[c>>2]=r;Jr(a,1,19703,c)|0;break}if((ue((f[e+64>>2]|0)-(f[e+56>>2]|0)|0,(f[e+60>>2]|0)-(f[e+52>>2]|0)|0)|0)>=(t|0)?(ue((f[e+116>>2]|0)-(f[e+108>>2]|0)|0,(f[e+112>>2]|0)-(f[e+104>>2]|0)|0)|0)>=(t|0):0){if((o|0)!=2){r=f[e+32>>2]|0;if((f[(f[s+5584>>2]|0)+20>>2]|0)==1){An(r,f[e+84>>2]|0,f[e+136>>2]|0,t);break}else{Sn(r,f[e+84>>2]|0,f[e+136>>2]|0,t);break}}i=s+5604|0;if(!(f[i>>2]|0))break;s=Xi(r<<2)|0;if(!s){y=0;b=_;return y|0}r=f[n>>2]|0;if(!r)r=0;else{o=0;while(1){f[s+(o<<2)>>2]=f[e+32>>2];o=o+1|0;if((o|0)==(r|0))break;else e=e+52|0}}y=(kn(f[i>>2]|0,t,s,r,f[(f[(f[h>>2]|0)+24>>2]|0)+32>>2]|0)|0)==0;Ji(s);if(y)r=0;else break;b=_;return r|0}Jr(a,1,19642,l)|0;y=0;b=_;return y|0}}while(0);r=f[f[u>>2]>>2]|0;g=r+16|0;if(!(f[g>>2]|0)){y=1;b=_;return y|0}y=0;m=f[(f[h>>2]|0)+24>>2]|0;p=f[(f[d>>2]|0)+5584>>2]|0;d=f[r+20>>2]|0;while(1){h=f[d+24>>2]|0;a=f[m+36>>2]|0;o=f[h+(a*136|0)+8>>2]|0;s=f[h+(a*136|0)>>2]|0;u=o-s|0;i=f[h+(a*136|0)+12>>2]|0;a=f[h+(a*136|0)+4>>2]|0;h=(f[d+8>>2]|0)-(f[d>>2]|0)-u|0;r=f[m+24>>2]|0;if(!(f[m+32>>2]|0)){r=1<<r;c=0}else{c=1<<r+-1;r=c;c=0-c|0}l=r+-1|0;r=f[d+32>>2]|0;e=(i|0)==(a|0);if((f[p+20>>2]|0)==1){if(!e){n=(o|0)==(s|0);t=p+1076|0;s=i-a|0;i=0;while(1){if(!n){e=0;o=r;while(1){a=(f[t>>2]|0)+(f[o>>2]|0)|0;f[o>>2]=(a|0)<(c|0)?c:(a|0)>(l|0)?l:a;e=e+1|0;if((e|0)==(u|0))break;else o=o+4|0}r=r+(u<<2)|0}i=i+1|0;if((i|0)==(s|0))break;else r=r+(h<<2)|0}}}else if(!e){n=(o|0)==(s|0);t=p+1076|0;s=i-a|0;i=0;while(1){if(!n){e=0;o=r;while(1){a=Ns(+v[o>>2])|0;a=(f[t>>2]|0)+a|0;f[o>>2]=(a|0)<(c|0)?c:(a|0)>(l|0)?l:a;e=e+1|0;if((e|0)==(u|0))break;else o=o+4|0}r=r+(u<<2)|0}i=i+1|0;if((i|0)==(s|0))break;else r=r+(h<<2)|0}}y=y+1|0;if(y>>>0>=(f[g>>2]|0)>>>0){r=1;break}else{m=m+52|0;p=p+1080|0;d=d+52|0}}b=_;return r|0}function $n(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,p=0,m=0,g=0;g=e+24|0;c=f[g>>2]|0;i=f[c+16>>2]|0;l=(i|0)==0;if(l){g=1;return g|0}a=0;r=0;o=f[c+24>>2]|0;s=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){u=f[o+24>>2]|0;u=((u&7|0)!=0&1)+(u>>>3)|0;p=f[s+24>>2]|0;m=(f[s+20>>2]|0)+-1|0;r=(ue(ue((u|0)==3?4:u,(f[p+(m*136|0)+8>>2]|0)-(f[p+(m*136|0)>>2]|0)|0)|0,(f[p+(m*136|0)+12>>2]|0)-(f[p+(m*136|0)+4>>2]|0)|0)|0)+r|0;a=a+1|0;if((a|0)==(i|0))break;else{o=o+52|0;s=s+52|0}}r=r>>>0>n>>>0;if(r|l){g=r&1^1;return g|0}m=0;p=f[c+24>>2]|0;u=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){l=f[p+24>>2]|0;e=f[u+24>>2]|0;n=f[p+36>>2]|0;a=f[e+(n*136|0)+8>>2]|0;o=f[e+(n*136|0)>>2]|0;c=a-o|0;s=f[e+(n*136|0)+12>>2]|0;n=f[e+(n*136|0)+4>>2]|0;e=(f[u+8>>2]|0)-(f[u>>2]|0)-c|0;l=((l&7|0)!=0&1)+(l>>>3)|0;e:do{switch(((l|0)==3?4:l)|0){case 1:{r=f[u+32>>2]|0;i=(s|0)==(n|0);if(!(f[p+32>>2]|0)){if(i)break e;l=(a|0)==(o|0);s=s-n|0;n=0;while(1){if(!l){o=t+c|0;a=0;i=r;while(1){h[t>>0]=f[i>>2];a=a+1|0;if((a|0)==(c|0))break;else{t=t+1|0;i=i+4|0}}t=o;r=r+(c<<2)|0}n=n+1|0;if((n|0)==(s|0))break;else r=r+(e<<2)|0}}else{if(i)break e;l=(a|0)==(o|0);s=s-n|0;n=0;while(1){if(!l){o=t+c|0;a=0;i=r;while(1){h[t>>0]=f[i>>2];a=a+1|0;if((a|0)==(c|0))break;else{t=t+1|0;i=i+4|0}}t=o;r=r+(c<<2)|0}n=n+1|0;if((n|0)==(s|0))break;else r=r+(e<<2)|0}}break}case 2:{r=f[u+32>>2]|0;i=(s|0)==(n|0);if(!(f[p+32>>2]|0)){if(!i){l=(a|0)==(o|0);s=s-n|0;n=0;while(1){if(!l){o=t+(c<<1)|0;a=0;i=r;while(1){d[t>>1]=f[i>>2];a=a+1|0;if((a|0)==(c|0))break;else{t=t+2|0;i=i+4|0}}t=o;r=r+(c<<2)|0}n=n+1|0;if((n|0)==(s|0))break;else r=r+(e<<2)|0}}}else if(!i){l=(a|0)==(o|0);s=s-n|0;n=0;while(1){if(!l){o=t+(c<<1)|0;a=0;i=r;while(1){d[t>>1]=f[i>>2];a=a+1|0;if((a|0)==(c|0))break;else{t=t+2|0;i=i+4|0}}t=o;r=r+(c<<2)|0}n=n+1|0;if((n|0)==(s|0))break;else r=r+(e<<2)|0}}break}case 4:{if((s|0)!=(n|0)){l=(a|0)==(o|0);s=s-n|0;n=0;r=f[u+32>>2]|0;while(1){if(!l){o=t+(c<<2)|0;a=0;i=r;while(1){f[t>>2]=f[i>>2];a=a+1|0;if((a|0)==(c|0))break;else{t=t+4|0;i=i+4|0}}t=o;r=r+(c<<2)|0}n=n+1|0;if((n|0)==(s|0))break;else r=r+(e<<2)|0}}break}default:{}}}while(0);m=m+1|0;if(m>>>0>=(f[(f[g>>2]|0)+16>>2]|0)>>>0){t=1;break}else{p=p+52|0;u=u+52|0}}return t|0}function er(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;n=f[e+24>>2]|0;i=f[n+16>>2]|0;if(!i){a=0;return a|0}a=0;t=0;r=f[n+24>>2]|0;n=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){e=f[r+24>>2]|0;e=((e&7|0)!=0&1)+(e>>>3)|0;t=(ue(ue((f[n+12>>2]|0)-(f[n+4>>2]|0)|0,(f[n+8>>2]|0)-(f[n>>2]|0)|0)|0,(e|0)==3?4:e)|0)+t|0;a=a+1|0;if(a>>>0>=i>>>0)break;else{r=r+52|0;n=n+52|0}}return t|0}function tr(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,g=0;c=f[e+24>>2]|0;g=c+16|0;i=f[g>>2]|0;l=(i|0)==0;if(l)r=0;else{a=0;r=0;o=f[c+24>>2]|0;s=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){u=f[o+24>>2]|0;u=((u&7|0)!=0&1)+(u>>>3)|0;r=(ue(ue((f[s+12>>2]|0)-(f[s+4>>2]|0)|0,(f[s+8>>2]|0)-(f[s>>2]|0)|0)|0,(u|0)==3?4:u)|0)+r|0;a=a+1|0;if((a|0)==(i|0))break;else{o=o+52|0;s=s+52|0}}}r=(r|0)!=(n|0);if(r|l){g=r&1^1;return g|0}u=0;l=f[c+24>>2]|0;n=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){e=f[l+24>>2]|0;r=(f[n+8>>2]|0)-(f[n>>2]|0)|0;i=(f[n+12>>2]|0)-(f[n+4>>2]|0)|0;s=ue(i,r)|0;e=((e&7|0)!=0&1)+(e>>>3)|0;e:do{switch(((e|0)==3?4:e)|0){case 1:{i=f[n+32>>2]|0;r=(s|0)==0;if(!(f[l+32>>2]|0)){if(r)break e;else{a=0;r=i;i=t}while(1){f[r>>2]=p[i>>0];a=a+1|0;if((a|0)==(s|0))break;else{r=r+4|0;i=i+1|0}}t=t+s|0;break e}else{if(r)break e;else{a=0;r=i;i=t}while(1){f[r>>2]=h[i>>0];a=a+1|0;if((a|0)==(s|0))break;else{r=r+4|0;i=i+1|0}}t=t+s|0;break e}}case 2:{o=f[n+32>>2]|0;a=(s|0)==0;if(!(f[l+32>>2]|0)){if(!a){a=t+(ue(i<<1,r)|0)|0;i=0;r=o;while(1){f[r>>2]=m[t>>1];i=i+1|0;if((i|0)==(s|0))break;else{r=r+4|0;t=t+2|0}}t=a}}else if(!a){a=t+(ue(i<<1,r)|0)|0;i=0;r=o;while(1){f[r>>2]=d[t>>1];i=i+1|0;if((i|0)==(s|0))break;else{r=r+4|0;t=t+2|0}}t=a}break}case 4:{if(s){a=t+(ue(i<<2,r)|0)|0;r=0;i=f[n+32>>2]|0;while(1){f[i>>2]=f[t>>2];r=r+1|0;if((r|0)==(s|0))break;else{i=i+4|0;t=t+4|0}}t=a}break}default:{}}}while(0);u=u+1|0;if(u>>>0>=(f[g>>2]|0)>>>0){t=1;break}else{l=l+52|0;n=n+52|0}}return t|0}function nr(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;a=e+24|0;t=f[a>>2]|0;if(!t)return;i=f[e+28>>2]|0;r=(i>>>0)/52|0;if(i>>>0>51){i=0;while(1){e=f[t>>2]|0;if(e){Ji(e+-1|0);f[t>>2]=0}e=t+4|0;n=f[e>>2]|0;if(n){Ji(n);f[e>>2]=0}e=t+8|0;n=f[e>>2]|0;if(n){Ji(n);f[e>>2]=0}i=i+1|0;if(i>>>0>=r>>>0)break;else t=t+52|0}t=f[a>>2]|0}Ji(t);f[a>>2]=0;return}function rr(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;a=e+24|0;t=f[a>>2]|0;if(!t)return;i=f[e+28>>2]|0;r=(i>>>0)/56|0;if(i>>>0>55){i=0;while(1){e=f[t>>2]|0;if(e){Ji(e);f[t>>2]=0}n=t+4|0;e=f[n>>2]|0;if(e){Ji(e);f[n>>2]=0}i=i+1|0;if(i>>>0>=r>>>0)break;else t=t+56|0}t=f[a>>2]|0}Ji(t);f[a>>2]=0;return}function ir(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=+r;i=i|0;a=a|0;var o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Z=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Ae=0,Me=0,Se=0,Re=0,ke=0,Pe=0,Le=0,Ce=0,Ie=0,Ne=0,Fe=0,Oe=0,He=0,De=0,Ue=0,Be=0,ze=0,Ve=0,je=0,Ge=0,We=0.0;Ge=b;b=b+80|0;He=Ge+64|0;Oe=Ge+56|0;Ue=Ge+48|0;ze=Ge+40|0;Be=Ge+32|0;Ve=Ge+24|0;De=Ge+16|0;Fe=Ge+8|0;o=f[e+28>>2]|0;Ne=f[f[e+20>>2]>>2]|0;d=f[(f[o+76>>2]|0)+(t*5640|0)+5584>>2]|0;p=f[Ne+20>>2]|0;c=f[e+24>>2]|0;u=f[c+24>>2]|0;Le=f[o+24>>2]|0;l=f[o+12>>2]|0;Ie=(ue(l,(t>>>0)%(Le>>>0)|0)|0)+(f[o+4>>2]|0)|0;s=f[c>>2]|0;s=Ie>>>0>s>>>0?Ie:s;f[Ne>>2]=s;Ie=Wl(l|0,0,Ie|0,0)|0;Ie=Ie|0-B;l=f[c+8>>2]|0;l=Ie>>>0<l>>>0?Ie:l;Ie=Ne+8|0;f[Ie>>2]=l;Ce=f[o+16>>2]|0;Le=(ue(Ce,(t>>>0)/(Le>>>0)|0)|0)+(f[o+8>>2]|0)|0;t=f[c+4>>2]|0;t=Le>>>0>t>>>0?Le:t;Pe=Ne+4|0;f[Pe>>2]=t;Le=Wl(Ce|0,0,Le|0,0)|0;Le=Le|0-B;c=f[c+12>>2]|0;c=Le>>>0<c>>>0?Le:c;Le=Ne+12|0;f[Le>>2]=c;if(!(f[d+4>>2]|0)){Jr(a,1,19777,Ge)|0;je=0;b=Ge;return je|0}Ce=Ne+16|0;if(!(f[Ce>>2]|0)){je=1;b=Ge;return je|0}ke=o+80|0;Re=e+40|0;Se=(n|0)==0;o=t;Me=0;e:while(1){f[u+36>>2]=0;Ee=f[u>>2]|0;t=(s+-1+Ee|0)/(Ee|0)|0;f[p>>2]=t;we=f[u+4>>2]|0;o=(o+-1+we|0)/(we|0)|0;Ae=p+4|0;f[Ae>>2]=o;Ee=(l+-1+Ee|0)/(Ee|0)|0;Te=p+8|0;f[Te>>2]=Ee;we=(c+-1+we|0)/(we|0)|0;xe=p+12|0;f[xe>>2]=we;t=Ee-t|0;o=we-o|0;if((4294967295/(t>>>0)|0)>>>0<o>>>0){je=6;break}t=ue(o,t)|0;if(t>>>0>1073741823){je=8;break}l=t<<2;Ee=f[d+4>>2]|0;we=p+16|0;f[we>>2]=Ee;e=f[ke>>2]|0;f[p+20>>2]=Ee>>>0<e>>>0?1:Ee-e|0;e=p+40|0;f[e>>2]=l;do{if(h[Re>>0]&1){n=p+32|0;s=f[n>>2]|0;if(s){o=p+44|0;if(l>>>0<=(f[o>>2]|0)>>>0)break;t=p+36|0;if(f[t>>2]|0){Zi(s);Ee=Ki(f[e>>2]|0)|0;f[n>>2]=Ee;if(!Ee){je=16;break e}f[o>>2]=f[e>>2];f[t>>2]=1;break}}Ee=Ki(l)|0;f[n>>2]=Ee;if(!Ee)break e;f[p+44>>2]=f[e>>2];f[p+36>>2]=1}}while(0);n=(f[we>>2]|0)*136|0;o=p+24|0;e=f[o>>2]|0;if(e){t=p+28|0;if(n>>>0>(f[t>>2]|0)>>>0){e=Qi(e,n)|0;if(!e){je=24;break}f[o>>2]=e;Ee=f[t>>2]|0;jl(e+Ee|0,0,n-Ee|0)|0;f[t>>2]=n}}else{t=Xi(n)|0;f[o>>2]=t;if(!t){t=0;je=87;break}f[p+28>>2]=n;jl(t|0,0,n|0)|0}t=f[we>>2]|0;Ee=(f[d+20>>2]|0)==0?7:8;if(t){ve=d+8|0;ye=d+12|0;_e=u+24|0;be=d+804|0;ge=f[o>>2]|0;o=d+28|0;e=0;while(1){pe=t;me=t+-1|0;he=f[p>>2]|0;de=Gl(1,0,me|0)|0;de=Wl(de|0,B|0,-1,-1)|0;fe=B;he=Wl(de|0,fe|0,he|0,((he|0)<0)<<31>>31|0)|0;he=Vl(he|0,B|0,me|0)|0;f[ge>>2]=he;n=f[Ae>>2]|0;n=Wl(de|0,fe|0,n|0,((n|0)<0)<<31>>31|0)|0;n=Vl(n|0,B|0,me|0)|0;f[ge+4>>2]=n;t=f[Te>>2]|0;t=Wl(de|0,fe|0,t|0,((t|0)<0)<<31>>31|0)|0;t=Vl(t|0,B|0,me|0)|0;f[ge+8>>2]=t;s=f[xe>>2]|0;s=Wl(de|0,fe|0,s|0,((s|0)<0)<<31>>31|0)|0;s=Vl(s|0,B|0,me|0)|0;f[ge+12>>2]=s;m=f[d+812+(e<<2)>>2]|0;c=f[d+944+(e<<2)>>2]|0;g=he>>m<<m;y=n>>c<<c;l=Gl(1,0,c|0)|0;l=Wl(l|0,B|0,-1,-1)|0;l=Wl(l|0,B|0,s|0,((s|0)<0)<<31>>31|0)|0;l=Vl(l|0,B|0,c|0)|0;if((he|0)==(t|0))t=0;else{he=Gl(1,0,m|0)|0;he=Wl(he|0,B|0,-1,-1)|0;t=Wl(he|0,B|0,t|0,((t|0)<0)<<31>>31|0)|0;t=Vl(t|0,B|0,m|0)|0;t=(t<<m)-g>>m}he=ge+16|0;f[he>>2]=t;se=(n|0)==(s|0)?0:(l<<c)-y>>c;f[ge+20>>2]=se;se=ue(se,t)|0;le=se*40|0;ce=(e|0)==0;if(ce)t=1;else{g=Wl(g|0,((g|0)<0)<<31>>31|0,1,0)|0;g=ql(g|0,B|0,1)|0;y=Wl(y|0,((y|0)<0)<<31>>31|0,1,0)|0;y=ql(y|0,B|0,1)|0;t=3;c=c+-1|0;m=m+-1|0}oe=ge+24|0;f[oe>>2]=t;G=f[ve>>2]|0;G=G>>>0<m>>>0?G:m;W=f[ye>>2]|0;W=W>>>0<c>>>0?W:c;q=(se|0)!=0;X=(se|0)==0;Y=1<<m;K=1<<c;Z=Gl(1,0,G|0)|0;Z=Wl(Z|0,B|0,-1,-1)|0;Q=B;J=Gl(1,0,W|0)|0;J=Wl(J|0,B|0,-1,-1)|0;$=B;ee=1<<G;te=1<<W;ne=Gl(1,0,pe|0)|0;ne=Wl(ne|0,B|0,-1,-1)|0;re=B;ie=0;ae=ge+28|0;j=o;while(1){if(ce){t=f[p>>2]|0;t=Wl(de|0,fe|0,t|0,((t|0)<0)<<31>>31|0)|0;t=Vl(t|0,B|0,me|0)|0;o=f[Ae>>2]|0;o=Wl(de|0,fe|0,o|0,((o|0)<0)<<31>>31|0)|0;o=Vl(o|0,B|0,me|0)|0;n=f[Te>>2]|0;n=Wl(de|0,fe|0,n|0,((n|0)<0)<<31>>31|0)|0;n=Vl(n|0,B|0,me|0)|0;l=f[xe>>2]|0;l=Wl(de|0,fe|0,l|0,((l|0)<0)<<31>>31|0)|0;l=Vl(l|0,B|0,me|0)|0;s=0}else{s=ie+1|0;t=f[p>>2]|0;U=Gl(s&1|0,0,me|0)|0;U=zl(ne|0,re|0,U|0,B|0)|0;l=B;t=Wl(U|0,l|0,t|0,((t|0)<0)<<31>>31|0)|0;t=Vl(t|0,B|0,pe|0)|0;o=f[Ae>>2]|0;z=Gl(s>>>1|0,0,me|0)|0;z=zl(ne|0,re|0,z|0,B|0)|0;V=B;o=Wl(z|0,V|0,o|0,((o|0)<0)<<31>>31|0)|0;o=Vl(o|0,B|0,pe|0)|0;n=f[Te>>2]|0;n=Wl(U|0,l|0,n|0,((n|0)<0)<<31>>31|0)|0;n=Vl(n|0,B|0,pe|0)|0;l=f[xe>>2]|0;l=Wl(z|0,V|0,l|0,((l|0)<0)<<31>>31|0)|0;l=Vl(l|0,B|0,pe|0)|0}f[ae+16>>2]=s;f[ae>>2]=t;V=ae+4|0;f[V>>2]=o;z=ae+8|0;f[z>>2]=n;U=ae+12|0;f[U>>2]=l;o=Nc[Ee&15](s)|0;We=+(f[j+4>>2]|0)*.00048828125+1.0;We=+Is(1.0,(f[_e>>2]|0)+o-(f[j>>2]|0)|0)*We*r;v[ae+32>>2]=We;f[ae+28>>2]=(f[j>>2]|0)+-1+(f[be>>2]|0);o=ae+20|0;n=f[o>>2]|0;if(!(q&(n|0)==0)){t=ae+24|0;if((f[t>>2]|0)>>>0<le>>>0){n=Qi(n,le)|0;if(!n){je=41;break e}f[o>>2]=n;D=f[t>>2]|0;jl(n+D|0,0,le-D|0)|0;f[t>>2]=le}}else{t=Xi(le)|0;f[o>>2]=t;if(!t){t=0;je=87;break e}jl(t|0,0,le|0)|0;f[ae+24>>2]=le}if(!X){H=f[o>>2]|0;D=0;while(1){P=f[he>>2]|0;N=(((D>>>0)%(P>>>0)|0)<<m)+g|0;P=(((D>>>0)/(P>>>0)|0)<<c)+y|0;L=N+Y|0;C=P+K|0;I=f[ae>>2]|0;I=(N|0)>(I|0)?N:I;f[H>>2]=I;N=f[V>>2]|0;N=(P|0)>(N|0)?P:N;P=H+4|0;f[P>>2]=N;O=f[z>>2]|0;O=(L|0)<(O|0)?L:O;L=H+8|0;f[L>>2]=O;s=f[U>>2]|0;s=(C|0)<(s|0)?C:s;C=H+12|0;f[C>>2]=s;I=I>>G<<G;N=N>>W<<W;O=Wl(Z|0,Q|0,O|0,((O|0)<0)<<31>>31|0)|0;O=Vl(O|0,B|0,G|0)|0;s=Wl(J|0,$|0,s|0,((s|0)<0)<<31>>31|0)|0;s=Vl(s|0,B|0,W|0)|0;O=(O<<G)-I>>G;F=H+16|0;f[F>>2]=O;s=(s<<W)-N>>W;_=H+20|0;f[_>>2]=s;O=ue(s,O)|0;s=ue(O,i)|0;o=H+24|0;n=f[o>>2]|0;do{if((n|0)==0&(O|0)!=0){t=Xi(s)|0;f[o>>2]=t;if(!t){t=0;je=87;break e}jl(t|0,0,s|0)|0;f[H+28>>2]=s}else{t=H+28|0;if(s>>>0<=(f[t>>2]|0)>>>0)break;n=Qi(n,s)|0;if(!n){je=50;break e}f[o>>2]=n;k=f[t>>2]|0;jl(n+k|0,0,s-k|0)|0;f[t>>2]=s}}while(0);l=H+32|0;t=f[l>>2]|0;n=f[F>>2]|0;s=f[_>>2]|0;if(!t)t=ar(n,s,a)|0;else t=ho(t,n,s,a)|0;f[l>>2]=t;if(!t)Jr(a,2,19990,Oe)|0;l=H+36|0;n=f[l>>2]|0;s=f[F>>2]|0;t=f[_>>2]|0;if(!n)t=ar(s,t,a)|0;else t=ho(n,s,t,a)|0;f[l>>2]=t;if(!t)Jr(a,2,20012,He)|0;if(O){k=0;do{M=f[F>>2]|0;A=(((k>>>0)%(M>>>0)|0)<<G)+I|0;M=(((k>>>0)/(M>>>0)|0)<<W)+N|0;S=A+ee|0;R=M+te|0;do{if(Se){t=f[o>>2]|0;n=t+(k*56|0)|0;s=f[n>>2]|0;if(!s){T=Xi(8192)|0;f[n>>2]=T;if(!T){t=0;je=87;break e}f[t+(k*56|0)+32>>2]=8192;T=Yi(10,32)|0;f[t+(k*56|0)+4>>2]=T;if(!T){t=0;je=87;break e}f[t+(k*56|0)+52>>2]=10}else{l=t+(k*56|0)+32|0;_=f[l>>2]|0;E=t+(k*56|0)+4|0;w=f[E>>2]|0;x=n;T=x+52|0;do{f[x>>2]=0;x=x+4|0}while((x|0)<(T|0));f[n>>2]=s;f[l>>2]=_;f[E>>2]=w}T=f[H>>2]|0;f[t+(k*56|0)+8>>2]=(A|0)>(T|0)?A:T;A=f[P>>2]|0;f[t+(k*56|0)+12>>2]=(M|0)>(A|0)?M:A;M=f[L>>2]|0;f[t+(k*56|0)+16>>2]=(S|0)<(M|0)?S:M;S=f[C>>2]|0;f[t+(k*56|0)+20>>2]=(R|0)<(S|0)?R:S}else{n=f[o>>2]|0;t=n+(k*52|0)+4|0;if((f[t>>2]|0)==0?(T=Yi(100,24)|0,f[t>>2]=T,(T|0)==0):0){t=0;je=87;break e}t=n+(k*52|0)+8|0;if((f[t>>2]|0)==0?(T=Yi(100,24)|0,f[t>>2]=T,(T|0)==0):0){t=0;je=87;break e}l=f[H>>2]|0;l=(A|0)>(l|0)?A:l;f[n+(k*52|0)+12>>2]=l;t=f[P>>2]|0;M=(M|0)>(t|0)?M:t;f[n+(k*52|0)+16>>2]=M;t=f[L>>2]|0;t=(S|0)<(t|0)?S:t;f[n+(k*52|0)+20>>2]=t;S=f[C>>2]|0;R=(R|0)<(S|0)?R:S;f[n+(k*52|0)+24>>2]=R;l=ue(R-M|0,t-l<<2)|0;t=n+(k*52|0)+36|0;if(l>>>0<=(f[t>>2]|0)>>>0)break;s=n+(k*52|0)|0;n=f[s>>2]|0;if(n)Ji(n+-1|0);n=Xi(l|1)|0;f[s>>2]=n;if(!n){je=74;break e}f[t>>2]=l;h[n>>0]=0;f[s>>2]=(f[s>>2]|0)+1}}while(0);k=k+1|0}while(k>>>0<O>>>0)}D=D+1|0;if(D>>>0>=se>>>0)break;else H=H+40|0}}o=j+8|0;ie=ie+1|0;if(ie>>>0>=(f[oe>>2]|0)>>>0)break;else{ae=ae+36|0;j=o}}e=e+1|0;if(e>>>0<(f[we>>2]|0)>>>0){t=me;ge=ge+136|0}else break}}t=Me+1|0;if(t>>>0>=(f[Ce>>2]|0)>>>0){t=1;je=87;break}s=f[Ne>>2]|0;o=f[Pe>>2]|0;l=f[Ie>>2]|0;c=f[Le>>2]|0;Me=t;u=u+52|0;d=d+1080|0;p=p+52|0}if((je|0)==6){Jr(a,1,19816,Fe)|0;je=0;b=Ge;return je|0}else if((je|0)==8){Jr(a,1,19816,De)|0;je=0;b=Ge;return je|0}else if((je|0)==16){f[o>>2]=0;f[e>>2]=0;f[t>>2]=0}else if((je|0)==24){Jr(a,1,19849,Be)|0;Ji(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;je=0;b=Ge;return je|0}else if((je|0)==41){Jr(a,1,19889,ze)|0;Ji(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;je=0;b=Ge;return je|0}else if((je|0)==50){Ji(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;Jr(a,1,19932,Ue)|0;je=0;b=Ge;return je|0}else if((je|0)==74){f[t>>2]=0;je=0;b=Ge;return je|0}else if((je|0)==87){b=Ge;return t|0}Jr(a,1,19816,Ve)|0;je=0;b=Ge;return je|0}function ar(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0;E=b;b=b+288|0;c=E+16|0;s=E+8|0;y=E+152|0;_=E+24|0;r=Yi(1,20)|0;if(!r){Jr(n,1,20034,E)|0;_=0;b=E;return _|0}f[r>>2]=e;u=r+4|0;f[u>>2]=t;f[y>>2]=e;f[_>>2]=t;l=r+8|0;f[l>>2]=0;i=0;o=0;while(1){v=ue(t,e)|0;e=(e+1|0)/2|0;a=o+1|0;f[y+(a<<2)>>2]=e;t=(t+1|0)/2|0;f[_+(a<<2)>>2]=t;i=i+v|0;if(v>>>0<=1)break;else o=a}f[l>>2]=i;if(!i){Ji(r);Jr(n,2,20072,s)|0;_=0;b=E;return _|0}i=Yi(i,16)|0;f[r+12>>2]=i;if(!i){Jr(n,1,20122,c)|0;Ji(r);_=0;b=E;return _|0}v=f[l>>2]|0;f[r+16>>2]=v<<4;t=i+((ue(f[u>>2]|0,f[r>>2]|0)|0)<<4)|0;if(!o)t=i;else{g=0;a=t;e=t;t=i;do{p=f[_+(g<<2)>>2]|0;e:do{if((p|0)>0){m=f[y+(g<<2)>>2]|0;if((m|0)<=0){l=p+-1|0;n=0;while(1){d=(n&1|0)!=0|(n|0)==(l|0);s=d?a:e;e=d?a:e+(m<<4)|0;n=n+1|0;if((n|0)>=(p|0)){a=s;break e}else a=s}}d=((m+2+((m|0)<2?~m:-3)|0)>>>1)+1|0;u=p+-1|0;h=0;do{n=m;c=a;while(1){f[t>>2]=c;s=t+16|0;l=n;n=n+-2|0;if((n|0)>-1){f[s>>2]=c;t=t+32|0}else t=s;if((l|0)<=2)break;else c=c+16|0}c=a+(d<<4)|0;n=(h&1|0)!=0|(h|0)==(u|0);a=n?c:e;e=n?c:e+(m<<4)|0;h=h+1|0}while((h|0)<(p|0))}}while(0);g=g+1|0}while((g|0)!=(o|0))}f[t>>2]=0;if(!v){_=r;b=E;return _|0}else t=0;while(1){f[i+4>>2]=999;f[i+8>>2]=0;f[i+12>>2]=0;t=t+1|0;if((t|0)==(v|0))break;else i=i+16|0}b=E;return r|0}function or(e){e=e|0;var t=0,n=0;if(!e)return;t=f[e+8>>2]|0;if(!t)return;n=0;e=f[e+12>>2]|0;while(1){f[e+4>>2]=999;f[e+8>>2]=0;f[e+12>>2]=0;n=n+1|0;if(n>>>0>=t>>>0)break;else e=e+16|0}return}function sr(e){e=e|0;var t=0;t=b;b=b+e|0;b=b+15&-16;return t|0}function lr(){return b|0}function cr(e){e=e|0;b=e}function ur(e,t){e=e|0;t=t|0;b=e;E=t}function hr(e,t){e=e|0;t=t|0;if(!A){A=e;M=t}}function dr(e){e=e|0;h[w>>0]=h[e>>0];h[w+1>>0]=h[e+1>>0];h[w+2>>0]=h[e+2>>0];h[w+3>>0]=h[e+3>>0]}function fr(e){e=e|0;h[w>>0]=h[e>>0];h[w+1>>0]=h[e+1>>0];h[w+2>>0]=h[e+2>>0];h[w+3>>0]=h[e+3>>0];h[w+4>>0]=h[e+4>>0];h[w+5>>0]=h[e+5>>0];h[w+6>>0]=h[e+6>>0];h[w+7>>0]=h[e+7>>0]}function pr(e){e=e|0;B=e}function mr(){return B|0}function gr(e,t,n,r,i,a,o){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,c=0,u=0,h=0,d=0;d=b;b=b+8272|0;l=d+16|0;u=d+12|0;s=d;f[u>>2]=0;if((f[e>>2]|0)==1375686655)h=di(0)|0;else h=di(2)|0;si(h,1,0)|0;li(h,2,0)|0;ci(h,3,0)|0;fi(l);f[s>>2]=e;f[s+4>>2]=e;f[s+8>>2]=t;c=ui(s,1)|0;if(!(pi(h,l)|0)){fl(4476)|0;Hr(c);Li(h);a=1;b=d;return a|0}if(!(mi(c,h,u)|0)){fl(4528)|0;Hr(c);Li(h);ri(f[u>>2]|0);a=1;b=d;return a|0}if(!(bi(h,c,f[u>>2]|0,f[l+8228>>2]|0)|0)){fl(4578)|0;Li(h);Hr(c);ri(f[u>>2]|0);a=1;b=d;return a|0}s=f[u>>2]|0;f[i>>2]=f[s+8>>2];f[a>>2]=f[s+12>>2];e=f[s+16>>2]|0;f[o>>2]=e;e=ue(ue(e<<2,f[i>>2]|0)|0,f[a>>2]|0)|0;f[r>>2]=e;r=Cl(e)|0;f[n>>2]=r;switch(f[o>>2]|0){case 1:{Xl(r|0,f[(f[s+24>>2]|0)+44>>2]|0,e|0)|0;break}case 3:{if((ue(f[a>>2]|0,f[i>>2]|0)|0)>0){t=f[s+24>>2]|0;s=f[t+44>>2]|0;e=f[t+96>>2]|0;t=f[t+148>>2]|0;l=0;do{o=l*3|0;f[r+(o<<2)>>2]=f[s+(l<<2)>>2];f[r+(o+1<<2)>>2]=f[e+(l<<2)>>2];f[r+(o+2<<2)>>2]=f[t+(l<<2)>>2];l=l+1|0}while((l|0)<(ue(f[a>>2]|0,f[i>>2]|0)|0))}break}default:{}}Hr(c);Li(h);ri(f[u>>2]|0);a=0;b=d;return a|0}function vr(){return hi()|0}function yr(e,t){e=e|0;t=t|0;return}function _r(e,t){e=e|0;t=t|0;return}function br(e,t){e=e|0;t=t|0;var n=0;t=b;b=b+16|0;n=t;f[n>>2]=e;dl(4625,n)|0;b=t;return}function Er(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=b;b=b+16|0;i=a;f[i>>2]=t;if(!n){b=a;return}t=e;r=0;e=i+(n+-1)|0;while(1){h[t>>0]=h[e>>0]|0;r=r+1|0;if((r|0)==(n|0))break;else{t=t+1|0;e=e+-1|0}}b=a;return}function wr(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;f[t>>2]=0;if(!n)return;r=0;t=t+(n+-1)|0;while(1){h[t>>0]=h[e>>0]|0;r=r+1|0;if((r|0)==(n|0))break;else{e=e+1|0;t=t+-1|0}}return}function xr(e,t){e=e|0;t=+t;var n=0,r=0,i=0,a=0,o=0;n=b;b=b+16|0;a=n;y[a>>3]=t;a=a+8|0;y[w>>3]=t;r=f[w>>2]|0;i=f[w+4>>2]|0;o=ql(r|0,i|0,56)|0;h[e>>0]=o;o=ql(r|0,i|0,48)|0;h[e+1>>0]=o;o=ql(r|0,i|0,40)|0;h[e+2>>0]=o;h[e+3>>0]=i;h[e+4>>0]=h[a+-5>>0]|0;h[e+5>>0]=h[a+-6>>0]|0;i=ql(r|0,i|0,8)|0;h[e+6>>0]=i;h[e+7>>0]=r;b=n;return}function Tr(e,t){e=e|0;t=t|0;var n=0;n=t+8|0;h[n+-1>>0]=h[e>>0]|0;h[n+-2>>0]=h[e+1>>0]|0;h[n+-3>>0]=h[e+2>>0]|0;h[n+-4>>0]=h[e+3>>0]|0;h[n+-5>>0]=h[e+4>>0]|0;h[n+-6>>0]=h[e+5>>0]|0;h[n+-7>>0]=h[e+6>>0]|0;h[t>>0]=h[e+7>>0]|0;return}function Ar(e,t){e=e|0;t=+t;var n=0;n=(v[w>>2]=t,f[w>>2]|0);h[e>>0]=n>>>24;h[e+1>>0]=n>>>16;h[e+2>>0]=n>>>8;h[e+3>>0]=n;return}function Mr(e,t){e=e|0;t=t|0;var n=0;n=t+4|0;h[n+-1>>0]=h[e>>0]|0;h[n+-2>>0]=h[e+1>>0]|0;h[n+-3>>0]=h[e+2>>0]|0;h[t>>0]=h[e+3>>0]|0;return}function Sr(e,t){e=e|0;t=t|0;var n=0,r=0;r=Yi(1,72)|0;if(!r){t=0;return t|0}f[r+64>>2]=e;e=Xi(e)|0;f[r+32>>2]=e;if(!e){Ji(r);t=0;return t|0}f[r+36>>2]=e;e=r+68|0;n=f[e>>2]|0;if(!t){f[e>>2]=n|1;f[r+40>>2]=31;f[r+44>>2]=32}else{f[e>>2]=n|2;f[r+40>>2]=29;f[r+44>>2]=30}f[r+16>>2]=4;f[r+20>>2]=5;f[r+24>>2]=6;f[r+28>>2]=7;t=r;return t|0}function Rr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0;h=b;b=b+16|0;u=h;i=e+48|0;a=f[i>>2]|0;if(a>>>0>=t>>>0){u=e+36|0;f[u>>2]=(f[u>>2]|0)+t;f[i>>2]=a-t;u=e+56|0;e=u;e=Wl(f[e>>2]|0,f[e+4>>2]|0,t|0,n|0)|0;f[u>>2]=e;f[u+4>>2]=B;u=n;e=t;B=u;b=h;return e|0}c=e+68|0;if(f[c>>2]&4){u=e+36|0;f[u>>2]=(f[u>>2]|0)+a;f[i>>2]=0;e=e+56|0;u=e;u=Wl(f[u>>2]|0,f[u+4>>2]|0,a|0,0)|0;f[e>>2]=u;f[e+4>>2]=B;e=(a|0)!=0;u=e?0:-1;e=e?a:-1;B=u;b=h;return e|0}if(!a){a=0;i=0}else{f[e+36>>2]=f[e+32>>2];t=zl(t|0,n|0,a|0,0)|0;f[i>>2]=0;i=0;n=B}e:do{if((n|0)>0|(n|0)==0&t>>>0>0){l=e+24|0;while(1){o=kc[f[l>>2]&63](t,n,f[e>>2]|0)|0;s=B;if((o|0)==-1&(s|0)==-1)break;t=zl(t|0,n|0,o|0,s|0)|0;n=B;a=Wl(o|0,s|0,a|0,i|0)|0;i=B;if(!((n|0)>0|(n|0)==0&t>>>0>0))break e}Jr(r,4,4636,u)|0;f[c>>2]=f[c>>2]|4;e=e+56|0;u=e;u=Wl(f[u>>2]|0,f[u+4>>2]|0,a|0,i|0)|0;f[e>>2]=u;f[e+4>>2]=B;e=(a|0)!=0|(i|0)!=0;u=e?i:-1;e=e?a:-1;B=u;b=h;return e|0}}while(0);u=e+56|0;e=u;e=Wl(f[e>>2]|0,f[e+4>>2]|0,a|0,i|0)|0;f[u>>2]=e;f[u+4>>2]=B;u=i;e=a;B=u;b=h;return e|0}function kr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;f[e+36>>2]=f[e+32>>2];f[e+48>>2]=0;a=(kc[f[e+28>>2]&63](t,n,f[e>>2]|0)|0)==0;r=e+68|0;i=f[r>>2]|0;if(a){f[r>>2]=i|4;a=0;return a|0}else{f[r>>2]=i&-5;a=e+56|0;f[a>>2]=t;f[a+4>>2]=n;a=1;return a|0}return 0}function Pr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0;g=b;b=b+16|0;m=g+8|0;u=g;p=e+68|0;if(f[p>>2]&8){m=-1;e=-1;B=m;b=g;return e|0}l=e+32|0;i=f[l>>2]|0;d=e+36|0;f[d>>2]=i;c=e+48|0;a=f[c>>2]|0;do{if(a){s=e+20|0;while(1){o=kc[f[s>>2]&63](i,a,f[e>>2]|0)|0;if((o|0)==-1)break;i=(f[d>>2]|0)+o|0;f[d>>2]=i;v=f[c>>2]|0;a=v-o|0;f[c>>2]=a;if((v|0)==(o|0)){h=6;break}}if((h|0)==6){i=f[l>>2]|0;break}f[p>>2]=f[p>>2]|8;Jr(r,4,4662,u)|0;f[p>>2]=f[p>>2]|8;f[c>>2]=0;e=-1;v=-1;B=e;b=g;return v|0}}while(0);f[d>>2]=i;e:do{if((n|0)>0|(n|0)==0&t>>>0>0){l=e+24|0;a=0;i=0;while(1){o=kc[f[l>>2]&63](t,n,f[e>>2]|0)|0;s=B;if((o|0)==-1&(s|0)==-1)break;t=zl(t|0,n|0,o|0,s|0)|0;n=B;a=Wl(o|0,s|0,a|0,i|0)|0;i=B;if(!((n|0)>0|(n|0)==0&t>>>0>0))break e}Jr(r,4,4688,m)|0;f[p>>2]=f[p>>2]|8;v=e+56|0;e=v;e=Wl(f[e>>2]|0,f[e+4>>2]|0,a|0,i|0)|0;f[v>>2]=e;f[v+4>>2]=B;v=(a|0)!=0|(i|0)!=0;e=v?i:-1;v=v?a:-1;B=e;b=g;return v|0}else{a=0;i=0}}while(0);e=e+56|0;v=e;v=Wl(f[v>>2]|0,f[v+4>>2]|0,a|0,i|0)|0;f[e>>2]=v;f[e+4>>2]=B;e=i;v=a;B=e;b=g;return v|0}function Lr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0;p=b;b=b+16|0;l=p;u=e+32|0;i=f[u>>2]|0;h=e+36|0;f[h>>2]=i;d=e+48|0;a=f[d>>2]|0;do{if(!a)a=e;else{s=e+20|0;while(1){o=kc[f[s>>2]&63](i,a,f[e>>2]|0)|0;if((o|0)==-1)break;i=(f[h>>2]|0)+o|0;f[h>>2]=i;m=f[d>>2]|0;a=m-o|0;f[d>>2]=a;if((m|0)==(o|0)){c=6;break}}if((c|0)==6){a=e;i=f[u>>2]|0;break}m=e+68|0;f[m>>2]=f[m>>2]|8;Jr(r,4,4662,l)|0;f[m>>2]=f[m>>2]|8;m=0;b=p;return m|0}}while(0);f[h>>2]=i;f[d>>2]=0;if(!(kc[f[e+28>>2]&63](t,n,f[a>>2]|0)|0)){m=e+68|0;f[m>>2]=f[m>>2]|8;m=0;b=p;return m|0}else{m=e+56|0;f[m>>2]=t;f[m+4>>2]=n;m=1;b=p;return m|0}return 0}function Cr(e,t,n){e=e|0;t=t|0;n=n|0;return-1}function Ir(e,t,n){e=e|0;t=t|0;n=n|0;return-1}function Nr(e,t,n){e=e|0;t=t|0;n=n|0;B=-1;return-1}function Fr(e,t,n){e=e|0;t=t|0;n=n|0;return 0}function Or(e){e=e|0;var t=0,n=0,r=0;r=Yi(1,72)|0;if(!r){e=0;return e|0}f[r+64>>2]=1048576;t=Xi(1048576)|0;f[r+32>>2]=t;if(!t){Ji(r);e=0;return e|0}f[r+36>>2]=t;t=r+68|0;n=f[t>>2]|0;if(!e){f[t>>2]=n|1;f[r+40>>2]=31;f[r+44>>2]=32}else{f[t>>2]=n|2;f[r+40>>2]=29;f[r+44>>2]=30}f[r+16>>2]=4;f[r+20>>2]=5;f[r+24>>2]=6;f[r+28>>2]=7;e=r;return e|0}function Hr(e){e=e|0;var t=0;if(!e)return;t=f[e+4>>2]|0;if(t)Lc[t&7](f[e>>2]|0);t=e+32|0;Ji(f[t>>2]|0);f[t>>2]=0;Ji(e);return}function Dr(e,t){e=e|0;t=t|0;if(!e)return;if(!(f[e+68>>2]&2))return;f[e+16>>2]=t;return}function Ur(e,t){e=e|0;t=t|0;if(!e)return;f[e+28>>2]=t;return}function Br(e,t){e=e|0;t=t|0;if(!e)return;if(!(f[e+68>>2]&1))return;f[e+20>>2]=t;return}function zr(e,t){e=e|0;t=t|0;if(!e)return;f[e+24>>2]=t;return}function Vr(e,t,n){e=e|0;t=t|0;n=n|0;if(!e)return;f[e>>2]=t;f[e+4>>2]=n;return}function jr(e,t,n){e=e|0;t=t|0;n=n|0;if(!e)return;e=e+8|0;f[e>>2]=t;f[e+4>>2]=n;return}function Gr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0;w=b;b=b+16|0;v=w+8|0;g=w;E=e+48|0;i=f[E>>2]|0;if(i>>>0>=n>>>0){_=e+36|0;Xl(t|0,f[_>>2]|0,n|0)|0;f[_>>2]=(f[_>>2]|0)+n;f[E>>2]=(f[E>>2]|0)-n;E=e+56|0;_=E;_=Wl(f[_>>2]|0,f[_+4>>2]|0,n|0,0)|0;f[E>>2]=_;f[E+4>>2]=B;E=n;b=w;return E|0}y=e+68|0;if(f[y>>2]&4){_=e+36|0;Xl(t|0,f[_>>2]|0,i|0)|0;r=f[E>>2]|0;f[_>>2]=(f[_>>2]|0)+r;_=e+56|0;y=_;r=Wl(f[y>>2]|0,f[y+4>>2]|0,r|0,0)|0;f[_>>2]=r;f[_+4>>2]=B;f[E>>2]=0;E=(i|0)!=0?i:-1;b=w;return E|0}if(!i){d=e+32|0;a=f[d>>2]|0;p=e+36|0;f[p>>2]=a;m=p;_=e+56|0;i=0}else{p=e+36|0;Xl(t|0,f[p>>2]|0,i|0)|0;d=e+32|0;a=f[d>>2]|0;f[p>>2]=a;m=f[E>>2]|0;_=e+56|0;u=_;u=Wl(f[u>>2]|0,f[u+4>>2]|0,m|0,0)|0;h=_;f[h>>2]=u;f[h+4>>2]=B;f[E>>2]=0;n=n-m|0;t=t+m|0;m=p}u=e+64|0;h=e+16|0;c=t;o=a;while(1){t=f[u>>2]|0;a=f[h>>2]|0;if(n>>>0<t>>>0){a=kc[a&63](o,t,f[e>>2]|0)|0;f[E>>2]=a;if((a|0)==-1){a=11;break}if(a>>>0>=n>>>0){t=c;a=14;break}Xl(c|0,f[m>>2]|0,a|0)|0;o=f[d>>2]|0;f[p>>2]=o;t=f[E>>2]|0;s=_;s=Wl(f[s>>2]|0,f[s+4>>2]|0,t|0,0)|0;l=B;i=a+i|0}else{t=kc[a&63](c,n,f[e>>2]|0)|0;f[E>>2]=t;if((t|0)==-1){a=16;break}i=t+i|0;if(t>>>0>=n>>>0){a=20;break}o=f[d>>2]|0;f[p>>2]=o;s=_;s=Wl(f[s>>2]|0,f[s+4>>2]|0,t|0,0)|0;l=B}a=_;f[a>>2]=s;f[a+4>>2]=l;f[E>>2]=0;n=n-t|0;c=c+t|0}if((a|0)==11){Jr(r,4,4636,g)|0;f[E>>2]=0;f[y>>2]=f[y>>2]|4;E=(i|0)!=0?i:-1;b=w;return E|0}else if((a|0)==14){Xl(t|0,f[m>>2]|0,n|0)|0;f[m>>2]=(f[m>>2]|0)+n;f[E>>2]=(f[E>>2]|0)-n;r=_;r=Wl(f[r>>2]|0,f[r+4>>2]|0,n|0,0)|0;E=_;f[E>>2]=r;f[E+4>>2]=B;E=i+n|0;b=w;return E|0}else if((a|0)==16){Jr(r,4,4636,v)|0;f[E>>2]=0;f[y>>2]=f[y>>2]|4;E=(i|0)!=0?i:-1;b=w;return E|0}else if((a|0)==20){r=_;r=Wl(f[r>>2]|0,f[r+4>>2]|0,t|0,0)|0;f[_>>2]=r;f[_+4>>2]=B;f[p>>2]=f[d>>2];f[E>>2]=0;E=i;b=w;return E|0}return 0}function Wr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0;_=b;b=b+16|0;g=_;h=e+68|0;if(f[h>>2]&8){y=-1;b=_;return y|0}m=e+64|0;i=f[m>>2]|0;y=e+48|0;l=f[y>>2]|0;a=i-l|0;do{if(a>>>0<n>>>0){d=e+32|0;o=e+36|0;p=e+20|0;s=e+56|0;c=i;u=a;i=0;e:while(1){if((c|0)==(l|0))a=f[d>>2]|0;else{Xl(f[o>>2]|0,t|0,u|0)|0;a=f[d>>2]|0;f[o>>2]=a;l=(f[y>>2]|0)+u|0;f[y>>2]=l;E=s;E=Wl(f[E>>2]|0,f[E+4>>2]|0,u|0,0)|0;c=s;f[c>>2]=E;f[c+4>>2]=B;n=n-u|0;t=t+u|0;i=u+i|0}f[o>>2]=a;if(!l)l=0;else{do{c=kc[f[p>>2]&63](a,l,f[e>>2]|0)|0;if((c|0)==-1)break e;a=(f[o>>2]|0)+c|0;f[o>>2]=a;E=f[y>>2]|0;l=E-c|0;f[y>>2]=l}while((E|0)!=(c|0));a=f[d>>2]|0}f[o>>2]=a;c=f[m>>2]|0;u=c-l|0;if(n>>>0<=u>>>0){v=5;break}}if((v|0)==5)break;f[h>>2]=f[h>>2]|8;Jr(r,4,4662,g)|0;E=-1;b=_;return E|0}else{a=e+36|0;s=e+56|0;o=a;a=f[a>>2]|0;i=0}}while(0);Xl(a|0,t|0,n|0)|0;f[o>>2]=(f[o>>2]|0)+n;f[y>>2]=(f[y>>2]|0)+n;y=s;y=Wl(f[y>>2]|0,f[y+4>>2]|0,n|0,0)|0;E=s;f[E>>2]=y;f[E+4>>2]=B;E=i+n|0;b=_;return E|0}function qr(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0;h=b;b=b+16|0;l=h;a=e+32|0;n=f[a>>2]|0;u=e+36|0;f[u>>2]=n;o=e+48|0;r=f[o>>2]|0;do{if(r){s=e+20|0;while(1){i=kc[f[s>>2]&63](n,r,f[e>>2]|0)|0;if((i|0)==-1)break;n=(f[u>>2]|0)+i|0;f[u>>2]=n;d=f[o>>2]|0;r=d-i|0;f[o>>2]=r;if((d|0)==(i|0)){c=6;break}}if((c|0)==6){n=f[a>>2]|0;break}d=e+68|0;f[d>>2]=f[d>>2]|8;Jr(t,4,4662,l)|0;d=0;b=h;return d|0}}while(0);f[u>>2]=n;d=1;b=h;return d|0}function Xr(e){e=e|0;e=e+56|0;B=f[e+4>>2]|0;return f[e>>2]|0}function Yr(e){e=e|0;var t=0,n=0;n=e+8|0;t=f[n>>2]|0;n=f[n+4>>2]|0;if((t|0)==0&(n|0)==0){n=0;e=0;B=n;return e|0}e=e+56|0;e=zl(t|0,n|0,f[e>>2]|0,f[e+4>>2]|0)|0;n=B;B=n;return e|0}function Kr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;e=Hc[f[e+40>>2]&63](e,t,n,r)|0;return e|0}function Zr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;return Hc[f[e+44>>2]&63](e,t,n,r)|0}function Qr(e){e=e|0;return(f[e+28>>2]|0)!=7|0}function Jr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0;s=b;b=b+528|0;a=s;o=s+16|0;e:do{if(e){switch(t|0){case 1:{t=e;i=e+12|0;break}case 2:{t=e+4|0;i=e+16|0;break}case 4:{t=e+8|0;i=e+20|0;break}default:{t=0;break e}}e=f[t>>2]|0;t=f[i>>2]|0;if(t)if(!n)t=1;else{jl(o|0,0,512)|0;f[a>>2]=r;gl(o,512,n,a)|0;Cc[t&7](o,e);t=1}else t=0}else t=0}while(0);b=s;return t|0}function $r(e){e=e|0;f[e>>2]=0;f[e+4>>2]=0;f[e+8>>2]=0;f[e+12>>2]=4;f[e+20>>2]=4;f[e+16>>2]=4;return}function ei(e,t){e=e|0;t=t|0;return}function ti(){return Yi(1,36)|0}function ni(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;r=Yi(1,36)|0;if(!r){s=r;return s|0}f[r+20>>2]=n;o=r+16|0;f[o>>2]=e;n=Yi(1,e*52|0)|0;s=r+24|0;f[s>>2]=n;if(!n){n=f[r+28>>2]|0;if(n)Ji(n);Ji(r);s=0;return s|0}if(!e){s=r;return s|0}i=0;while(1){f[n+(i*52|0)>>2]=f[t+(i*36|0)>>2];f[n+(i*52|0)+4>>2]=f[t+(i*36|0)+4>>2];l=f[t+(i*36|0)+8>>2]|0;f[n+(i*52|0)+8>>2]=l;c=f[t+(i*36|0)+12>>2]|0;f[n+(i*52|0)+12>>2]=c;f[n+(i*52|0)+16>>2]=f[t+(i*36|0)+16>>2];f[n+(i*52|0)+20>>2]=f[t+(i*36|0)+20>>2];f[n+(i*52|0)+24>>2]=f[t+(i*36|0)+24>>2];f[n+(i*52|0)+28>>2]=f[t+(i*36|0)+28>>2];f[n+(i*52|0)+32>>2]=f[t+(i*36|0)+32>>2];l=Yi(ue(c,l)|0,4)|0;f[n+(i*52|0)+44>>2]=l;i=i+1|0;if(!l)break;if(i>>>0>=e>>>0){a=22;break}n=f[s>>2]|0}if((a|0)==22)return r|0;n=f[s>>2]|0;if(n){i=f[o>>2]|0;if(i){t=0;while(1){n=f[n+(t*52|0)+44>>2]|0;if(n){Ji(n);i=f[o>>2]|0}t=t+1|0;if(t>>>0>=i>>>0)break;n=f[s>>2]|0}n=f[s>>2]|0}Ji(n)}n=f[r+28>>2]|0;if(n)Ji(n);Ji(r);c=0;return c|0}function ri(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;if(!e)return;i=e+24|0;t=f[i>>2]|0;if(t){a=e+16|0;n=f[a>>2]|0;if(n){r=0;while(1){t=f[t+(r*52|0)+44>>2]|0;if(t){Ji(t);n=f[a>>2]|0}r=r+1|0;if(r>>>0>=n>>>0)break;t=f[i>>2]|0}t=f[i>>2]|0}Ji(t)}t=f[e+28>>2]|0;if(t)Ji(t);Ji(e);return}function ii(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0;n=f[t+4>>2]|0;r=f[e>>2]|0;a=f[t+8>>2]|0;o=f[e+4>>2]|0;i=f[t+12>>2]|0;u=(ue((f[t+24>>2]|0)+-1|0,i)|0)+n|0;s=f[t+16>>2]|0;l=(ue((f[t+28>>2]|0)+-1|0,s)|0)+a|0;t=Wl(u|0,0,i|0,0)|0;t=t|0-B;i=f[e+8>>2]|0;s=Wl(l|0,0,s|0,0)|0;s=s|0-B;l=f[e+12>>2]|0;u=f[e+16>>2]|0;if(!u)return;c=(n>>>0>r>>>0?n:r)+-1|0;a=(a>>>0>o>>>0?a:o)+-1|0;i=(t>>>0<i>>>0?t:i)+-1|0;n=(s>>>0<l>>>0?s:l)+-1|0;r=0;t=f[e+24>>2]|0;while(1){o=f[t>>2]|0;l=((c+o|0)>>>0)/(o>>>0)|0;p=f[t+4>>2]|0;e=((a+p|0)>>>0)/(p>>>0)|0;s=f[t+40>>2]|0;d=Gl(1,0,s|0)|0;h=B;o=Wl((((i+o|0)>>>0)/(o>>>0)|0)-l|0,0,-1,-1)|0;o=Wl(o|0,B|0,d|0,h|0)|0;o=ql(o|0,B|0,s|0)|0;p=Wl((((n+p|0)>>>0)/(p>>>0)|0)-e|0,0,-1,-1)|0;h=Wl(p|0,B|0,d|0,h|0)|0;s=ql(h|0,B|0,s|0)|0;f[t+8>>2]=o;f[t+12>>2]=s;f[t+16>>2]=l;f[t+20>>2]=e;r=r+1|0;if(r>>>0>=u>>>0)break;else t=t+52|0}return}function ai(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0;f[t>>2]=f[e>>2];f[t+4>>2]=f[e+4>>2];f[t+8>>2]=f[e+8>>2];f[t+12>>2]=f[e+12>>2];l=t+24|0;r=f[l>>2]|0;s=t+16|0;if(!r)n=l;else{n=f[s>>2]|0;if(!n)n=l;else{i=0;while(1){r=f[r+(i*52|0)+44>>2]|0;if(r){Ji(r);n=f[s>>2]|0}i=i+1|0;if(i>>>0>=n>>>0)break;r=f[l>>2]|0}n=l;r=f[l>>2]|0}Ji(r);f[l>>2]=0}r=f[e+16>>2]|0;f[s>>2]=r;r=Xi(r*52|0)|0;f[n>>2]=r;if(!r){f[l>>2]=0;f[s>>2]=0;return}if(f[s>>2]|0){o=e+24|0;a=0;do{n=r+(a*52|0)|0;r=(f[o>>2]|0)+(a*52|0)|0;i=n+52|0;do{f[n>>2]=f[r>>2];n=n+4|0;r=r+4|0}while((n|0)<(i|0));r=f[l>>2]|0;f[r+(a*52|0)+44>>2]=0;a=a+1|0}while(a>>>0<(f[s>>2]|0)>>>0)}f[t+20>>2]=f[e+20>>2];i=e+32|0;n=f[i>>2]|0;a=t+32|0;f[a>>2]=n;if(!n){f[t+28>>2]=0;return}r=Xi(n)|0;n=t+28|0;f[n>>2]=r;if(!r){f[n>>2]=0;f[a>>2]=0;return}else{Xl(r|0,f[e+28>>2]|0,f[i>>2]|0)|0;return}}function oi(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;r=Yi(1,36)|0;if(!r){e=r;return e|0}f[r+20>>2]=n;f[r+16>>2]=e;n=Yi(e,52)|0;f[r+24>>2]=n;if(!n){n=f[r+28>>2]|0;if(n)Ji(n);Ji(r);e=0;return e|0}else{if(!e){e=r;return e|0}else i=0;do{f[n+(i*52|0)>>2]=f[t+(i*36|0)>>2];f[n+(i*52|0)+4>>2]=f[t+(i*36|0)+4>>2];f[n+(i*52|0)+8>>2]=f[t+(i*36|0)+8>>2];f[n+(i*52|0)+12>>2]=f[t+(i*36|0)+12>>2];f[n+(i*52|0)+16>>2]=f[t+(i*36|0)+16>>2];f[n+(i*52|0)+20>>2]=f[t+(i*36|0)+20>>2];f[n+(i*52|0)+24>>2]=f[t+(i*36|0)+24>>2];f[n+(i*52|0)+32>>2]=f[t+(i*36|0)+32>>2];f[n+(i*52|0)+44>>2]=0;i=i+1|0}while((i|0)!=(e|0));return r|0}return 0}function si(e,t,n){e=e|0;t=t|0;n=n|0;if(!e){n=0;return n|0}f[e+64>>2]=t;f[e+52>>2]=n;n=1;return n|0}function li(e,t,n){e=e|0;t=t|0;n=n|0;if(!e){n=0;return n|0}f[e+60>>2]=t;f[e+48>>2]=n;n=1;return n|0}function ci(e,t,n){e=e|0;t=t|0;n=n|0;if(!e){n=0;return n|0}f[e+56>>2]=t;f[e+44>>2]=n;n=1;return n|0}function ui(e,t){e=e|0;t=t|0;var n=0;if(!e){e=0;return e|0}n=Or(t)|0;if(!n){e=0;return e|0}Vr(n,e,0);jr(n,f[e+8>>2]|0,0);if(!t)Br(n,9);else Dr(n,8);zr(n,1);Ur(n,10);e=n;return e|0}function hi(){return 4703}function di(e){e=e|0;var t=0;t=Yi(1,84)|0;if(!t){e=0;return e|0}f[t+68>>2]=1;switch(e|0){case 0:{f[t+72>>2]=13;f[t+76>>2]=2;f[t+80>>2]=3;f[t+4>>2]=33;f[t+16>>2]=11;f[t>>2]=34;f[t+20>>2]=1;f[t+24>>2]=5;f[t+8>>2]=1;f[t+12>>2]=1;f[t+28>>2]=1;f[t+32>>2]=1;f[t+36>>2]=12;e=ha()|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}case 2:{f[t+72>>2]=14;f[t+76>>2]=4;f[t+80>>2]=5;f[t+4>>2]=35;f[t+16>>2]=13;f[t>>2]=36;f[t+8>>2]=2;f[t+12>>2]=2;f[t+20>>2]=2;f[t+24>>2]=6;f[t+28>>2]=2;f[t+32>>2]=2;f[t+36>>2]=14;e=qt(1)|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}default:{Ji(t);e=0;return e|0}}$r(t+44|0);e=t;return e|0}function fi(e){e=e|0;if(!e)return;jl(e|0,0,8248)|0;f[e+8200>>2]=-1;f[e+8204>>2]=-1;f[e+8248>>2]=0;return}function pi(e,t){e=e|0;t=t|0;var n=0;n=b;b=b+16|0;if(!((e|0)!=0&(t|0)!=0)){t=0;b=n;return t|0}if(!(f[e+68>>2]|0)){Jr(e+44|0,1,4709,n)|0;t=0;b=n;return t|0}else{Cc[f[e+24>>2]&7](f[e+40>>2]|0,t);t=1;b=n;return t|0}return 0}function mi(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;r=b;b=b+16|0;if(!((e|0)!=0&(t|0)!=0)){e=0;b=r;return e|0}if(!(f[t+68>>2]|0)){Jr(t+44|0,1,4790,r)|0;e=0;b=r;return e|0}else{e=Hc[f[t>>2]&63](e,f[t+40>>2]|0,n,t+44|0)|0;b=r;return e|0}return 0}function gi(e,t,n){e=e|0;t=t|0;n=n|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=Hc[f[e+4>>2]&63](f[e+40>>2]|0,t,n,e+44|0)|0;return t|0}function vi(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;if(!e){r=0;return r|0}if(!(f[e+68>>2]|0)){r=0;return r|0}r=Rc[f[e+28>>2]&3](f[e+40>>2]|0,t,n,r,i,a,e+44|0)|0;return r|0}function yi(e,t,n,r,i,a,o,s,l,c){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;c=c|0;if(!((n|0)!=0&((e|0)!=0&(t|0)!=0&(r|0)!=0))){s=0;return s|0}if(!(f[e+68>>2]|0)){s=0;return s|0}s=Oc[f[e+8>>2]&3](f[e+40>>2]|0,n,r,i,a,o,s,l,c,t,e+44|0)|0;return s|0}function _i(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;if(!((e|0)!=0&(n|0)!=0&(i|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=Ic[f[e+12>>2]&7](f[e+40>>2]|0,t,n,r,i,e+44|0)|0;return t|0}function bi(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;if(!((e|0)!=0&(t|0)!=0)){r=0;return r|0}if(!(f[e+68>>2]|0)){r=0;return r|0}r=Uc[f[e+32>>2]&3](f[e+40>>2]|0,t,n,e+44|0,r)|0;return r|0}function Ei(e,t){e=e|0;t=t|0;if(!e){t=0;return t|0}t=kc[f[e+36>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function wi(e){e=e|0;var t=0;t=Yi(1,84)|0;if(!t){e=0;return e|0}f[t+68>>2]=0;switch(e|0){case 0:{f[t+4>>2]=15;f[t+12>>2]=16;f[t>>2]=37;f[t+8>>2]=3;f[t+16>>2]=1;f[t+20>>2]=38;e=ta()|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}case 2:{f[t+4>>2]=17;f[t+12>>2]=18;f[t>>2]=39;f[t+8>>2]=4;f[t+16>>2]=2;f[t+20>>2]=40;e=qt(0)|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}default:{Ji(t);e=0;return e|0}}$r(t+44|0);e=t;return e|0}function xi(e){e=e|0;if(!e)return;jl(e|0,0,18708)|0;f[e+5592>>2]=6;f[e+18684>>2]=0;f[e+5596>>2]=64;f[e+5600>>2]=64;f[e+44>>2]=0;f[e+5612>>2]=-1;f[e+18188>>2]=1;f[e+18192>>2]=1;h[e+18688>>0]=0;f[e+18196>>2]=-1;f[e+18200>>2]=-1;v[e+4792>>2]=0.0;f[e+4788>>2]=0;f[e+20>>2]=0;f[e+24>>2]=0;f[e+28>>2]=0;f[e+18692>>2]=0;return}function Ti(e,t,n){e=e|0;t=t|0;n=n|0;if(!((e|0)!=0&(t|0)!=0&(n|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=Hc[f[e+20>>2]&63](f[e+40>>2]|0,t,n,e+44|0)|0;return t|0}function Ai(e,t,n){e=e|0;t=t|0;n=n|0;if(!((e|0)!=0&(n|0)!=0)){n=0;return n|0}if(f[e+68>>2]|0){n=0;return n|0}n=Hc[f[e>>2]&63](f[e+40>>2]|0,n,t,e+44|0)|0;return n|0}function Mi(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=kc[f[e+4>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function Si(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=kc[f[e+12>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function Ri(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=kc[f[e+16>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function ki(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0;o=r<<2;i=ue(o,r)|0;a=e+18704|0;r=m[a>>1]|0;d[a>>1]=(r&32768|0)==0?-32512:(r|256)&65535;f[e+5608>>2]=1;h[e+18690>>0]=2;a=Xi(i+o|0)|0;r=e+18696|0;f[r>>2]=a;if(!a){n=0;return n|0}Xl(a|0,t|0,i|0)|0;Xl((f[r>>2]|0)+i|0,n|0,o|0)|0;n=1;return n|0}function Pi(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;if(!((n|0)!=0&((e|0)!=0&(i|0)!=0))){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=Ic[f[e+8>>2]&7](f[e+40>>2]|0,t,n,r,i,e+44|0)|0;return t|0}function Li(e){e=e|0;var t=0,n=0;if(!e)return;t=e+40|0;n=f[t>>2]|0;if(!(f[e+68>>2]|0))Lc[f[e+16>>2]&7](n);else Lc[f[e+20>>2]&7](n);f[t>>2]=0;Ji(e);return}function Ci(e,t,n){e=e|0;t=t|0;n=n|0;if(!e)return;Fc[f[e+72>>2]&15](f[e+40>>2]|0,t,n);return}function Ii(e){e=e|0;if(!e){e=0;return e|0}e=Nc[f[e+76>>2]&15](f[e+40>>2]|0)|0;return e|0}function Ni(e){e=e|0;var t=0,n=0;if(!e)return;t=f[e>>2]|0;n=f[t+48>>2]|0;if(n){Ji(n);t=f[e>>2]|0}Ji(t);f[e>>2]=0;return}function Fi(e){e=e|0;if(!e){e=0;return e|0}e=Nc[f[e+80>>2]&15](f[e+40>>2]|0)|0;return e|0}function Oi(e){e=e|0;var t=0;t=f[e>>2]|0;if(!t)return;sa(t);f[e>>2]=0;return}function Hi(e,t){e=e|0;t=t|0;return Di(e,1048576,t)|0}function Di(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if(!e){t=0;return t|0}r=$s(e,(n|0)==0?4869:4872)|0;if(!r){t=0;return t|0}e=Sr(t,n)|0;if(!e){Qs(r)|0;t=0;return t|0}else{Vr(e,r,6);ol(r,0,2)|0;t=cl(r)|0;ol(r,0,0)|0;jr(e,t,((t|0)<0)<<31>>31);Dr(e,19);Br(e,20);zr(e,21);Ur(e,22);t=e;return t|0}return 0}function Ui(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;a=(f[n>>2]|0)+(f[n+8>>2]|0)|0;n=n+4|0;r=f[n>>2]|0;i=a-r|0;if((a|0)==(r|0)){a=-1;return a|0}a=i>>>0>t>>>0?t:i;Xl(e|0,r|0,a|0)|0;f[n>>2]=(f[n>>2]|0)+a;return a|0}function Bi(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;c=n+4|0;r=f[c>>2]|0;s=n+8|0;a=f[s>>2]|0;l=r-(f[n>>2]|0)|0;i=(a|0)==0?1:a;while(1)if((i-l|0)>>>0<t>>>0)i=i<<1;else{o=i;break}if((o|0)!=(a|0)){r=Xi(o)|0;if(!r){t=-1;return t|0}i=f[n>>2]|0;if(i){Xl(r|0,i|0,l|0)|0;Ji(f[n>>2]|0)}f[n>>2]=r;r=r+l|0;f[c>>2]=r;f[s>>2]=o}Xl(r|0,e|0,t|0)|0;f[c>>2]=(f[c>>2]|0)+t;return t|0}function zi(e,t){e=e|0;t=t|0;var n=0,r=0,i=0;i=(f[t>>2]|0)+(f[t+8>>2]|0)|0;t=t+4|0;n=f[t>>2]|0;r=i-n|0;if((i|0)==(n|0)){i=-1;return i|0}f[t>>2]=n+e;i=r>>>0>e>>>0?e:r;return i|0}function Vi(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;r=f[n+8>>2]|0;f[n+4>>2]=(f[n>>2]|0)+(0>(t|0)|0==(t|0)&r>>>0>e>>>0?e:r);return 1}function ji(e,t,n){e=e|0;t=t|0;n=n|0;t=rl(e,1,t,n)|0;return((t|0)!=0?t:-1)|0}function Gi(e,t,n){e=e|0;t=t|0;n=n|0;return hl(e,1,t,n)|0}function Wi(e,t,n){e=e|0;t=t|0;n=n|0;n=(ol(n,e,1)|0)==0;B=n?t:-1;return(n?e:-1)|0}function qi(e,t,n){e=e|0;t=t|0;n=n|0;return(ol(n,e,0)|0)==0|0}function Xi(e){e=e|0;if(!e)e=0;else e=Cl(e)|0;return e|0}function Yi(e,t){e=e|0;t=t|0;if(!t)e=0;else e=Nl(e,t)|0;return e|0}function Ki(e){e=e|0;var t=0,n=0;n=b;b=b+16|0;t=n;do{if(e)if(!(Ol(t,16,e)|0)){t=f[t>>2]|0;break}else{f[t>>2]=0;t=0;break}else t=0}while(0);b=n;return t|0}function Zi(e){e=e|0;Il(e);return}function Qi(e,t){e=e|0;t=t|0;if(!t)t=0;else t=Fl(e,t)|0;return t|0}function Ji(e){e=e|0;Il(e);return}function $i(e){e=e|0;var t=0,n=0;t=696;while(1){n=f[t>>2]|0;if((n|0)==-1|(n|0)==(e|0))break;else t=t+12|0}return t+4|0}function ea(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0))return;f[e+172>>2]=f[t+4>>2];f[e+168>>2]=f[t>>2];return}function ta(){var e=0,t=0;e=Yi(1,208)|0;if(!e){e=0;return e|0}f[e>>2]=0;t=e+184|0;h[t>>0]=h[t>>0]&-3;t=Xi(1e3)|0;f[e+44>>2]=t;if(!t){na(e);t=0;return t|0}f[e+48>>2]=1e3;t=vo()|0;f[e+192>>2]=t;if(!t){na(e);t=0;return t|0}t=vo()|0;f[e+188>>2]=t;if(t){t=e;return t|0}na(e);t=0;return t|0}function na(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0;if(!e)return;if(!(f[e>>2]|0)){t=e+36|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+24|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0;f[e+28>>2]=0}t=e+44|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0;f[e+48>>2]=0}}else{t=e+12|0;n=f[t>>2]|0;if(n){Ta(n);Ji(f[t>>2]|0);f[t>>2]=0}t=e+16|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0;f[e+20>>2]=0}}qn(f[e+204>>2]|0);t=e+88|0;a=e+164|0;n=f[a>>2]|0;if(n){r=ue(f[e+112>>2]|0,f[e+116>>2]|0)|0;if(r){i=0;while(1){Ta(n);i=i+1|0;if((i|0)==(r|0))break;else n=n+5640|0}n=f[a>>2]|0}Ji(n);f[a>>2]=0}a=e+124|0;n=f[a>>2]|0;if(n){o=e+120|0;r=f[o>>2]|0;if(r){i=0;while(1){n=f[n+(i<<3)>>2]|0;if(n){Ji(n);r=f[o>>2]|0}i=i+1|0;if(i>>>0>=r>>>0)break;n=f[a>>2]|0}n=f[a>>2]|0}f[o>>2]=0;Ji(n);f[a>>2]=0}o=e+144|0;Ji(f[o>>2]|0);f[o>>2]=0;f[e+128>>2]=0;o=e+108|0;Ji(f[o>>2]|0);f[o>>2]=0;if(!(h[e+184>>0]&2)){o=e+176|0;Ji(f[o>>2]|0);f[o>>2]=0}n=t+100|0;do{f[t>>2]=0;t=t+4|0}while((t|0)<(n|0));o=e+188|0;yo(f[o>>2]|0);f[o>>2]=0;yo(f[e+192>>2]|0);f[o>>2]=0;o=e+196|0;sa(f[o>>2]|0);f[o>>2]=0;o=e+80|0;ri(f[o>>2]|0);f[o>>2]=0;o=e+84|0;ri(f[o>>2]|0);f[o>>2]=0;Ji(e);return}function ra(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,p=0.0,m=0,g=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,he=0.0;ce=b;b=b+320|0;ie=ce+296|0;re=ce+288|0;le=ce+280|0;se=ce+272|0;oe=ce+264|0;ae=ce+256|0;ne=ce+248|0;te=ce+240|0;X=ce+232|0;W=ce+224|0;G=ce+216|0;j=ce+208|0;V=ce+200|0;z=ce+192|0;B=ce+184|0;E=ce+176|0;_=ce+168|0;g=ce+160|0;m=ce+152|0;u=ce+144|0;N=ce+136|0;I=ce+128|0;D=ce+112|0;C=ce+104|0;L=ce+96|0;P=ce+88|0;R=ce+80|0;S=ce+72|0;M=ce+64|0;A=ce+56|0;T=ce+48|0;x=ce+32|0;w=ce+24|0;c=ce+16|0;o=ce+8|0;a=ce;O=ce+309|0;H=ce+300|0;if(!((e|0)!=0&(t|0)!=0&(n|0)!=0)){r=0;b=ce;return r|0}ee=t+5592|0;i=f[ee>>2]|0;if((i+-1|0)>>>0>32){f[a>>2]=i;f[a+4>>2]=33;Jr(r,1,4875,a)|0;r=0;b=ce;return r|0}J=e+112|0;f[J>>2]=1;$=e+116|0;f[$>>2]=1;F=t+18704|0;do{if(!(d[F>>1]|0)){switch(f[t+18676>>2]|0){case 1:{d[F>>1]=3;f[t+18700>>2]=1302083;f[t+18680>>2]=1041666;a=1;break}case 2:{d[F>>1]=3;f[t+18700>>2]=651041;f[t+18680>>2]=520833;a=1;break}case 3:{d[F>>1]=4;f[t+18700>>2]=1302083;f[t+18680>>2]=1041666;a=1;break}default:a=0}i=f[t+18684>>2]|0;e:do{if((i|0)>=4)if((i|0)<33024){switch(i|0){case 4:break;default:{Q=13;break e}}d[F>>1]=4;break}else{switch(i|0){case 33024:break;default:{Q=13;break e}}d[F>>1]=-32512;break}else{switch(i|0){case 3:break;default:{Q=13;break e}}d[F>>1]=3}}while(0);if((Q|0)==13?(a|0)==0:0)break;Jr(r,2,4931,o)|0}}while(0);k=t+18700|0;i=f[k>>2]|0;do{if((i|0)<1){p=+v[t+4792+((f[t+4788>>2]|0)+-1<<2)>>2];if(p>0.0){Y=f[n+24>>2]|0;c=ue(f[Y+8>>2]|0,f[n+16>>2]|0)|0;c=ue(c,f[Y+12>>2]|0)|0;he=+((ue(c,f[Y+24>>2]|0)|0)>>>0);Y=~~+Z(+(he/(p*8.0*+((f[Y>>2]|0)>>>0)*+((f[Y+4>>2]|0)>>>0))));f[k>>2]=Y;break}else{f[k>>2]=0;break}}else{l=f[n+24>>2]|0;Y=ue(f[l+8>>2]|0,f[n+16>>2]|0)|0;Y=ue(Y,f[l+12>>2]|0)|0;p=+((ue(Y,f[l+24>>2]|0)|0)>>>0);i=ue(i<<3,f[l>>2]|0)|0;p=p/+((ue(i,f[l+4>>2]|0)|0)>>>0);l=t+4788|0;i=f[l>>2]|0;if(i){o=i;i=0;s=0;while(1){a=t+4792+(s<<2)|0;if(+v[a>>2]<p){v[a>>2]=p;a=f[l>>2]|0;i=1}else a=o;s=s+1|0;if(s>>>0>=a>>>0)break;else o=a}if(i)Jr(r,2,5068,c)|0}}}while(0);i=d[F>>1]|0;e:do{if((i+-3&65535)>=4){if(i<<16>>16==7){Jr(r,2,7228,u)|0;d[F>>1]=0;i=0;break}if((i+-256&65535)<524){Jr(r,2,7283,m)|0;d[F>>1]=0;i=0;break}if((i+-1024&65535)<1180){Jr(r,2,7331,g)|0;d[F>>1]=0;i=0;break}if(i<<16>>16<=-1)switch(i<<16>>16){case-32512:{i=-32512;break e}case-32768:{Jr(r,2,7373,_)|0;d[F>>1]=0;i=0;break e}default:{Jr(r,2,7461,E)|0;d[F>>1]=0;i=0;break e}}}else{if((i+-5&65535)<2){Jr(r,2,5160,w)|0;d[F>>1]=0;i=0;break}f[t>>2]=0;f[t+12>>2]=1;f[t+16>>2]=1;h[t+18689>>0]=67;h[t+18688>>0]=1;f[t+4>>2]=0;f[t+8>>2]=0;f[t+18180>>2]=0;f[t+18184>>2]=0;f[t+5596>>2]=32;f[t+5600>>2]=32;f[t+5604>>2]=0;f[t+5612>>2]=-1;f[t+18188>>2]=1;f[t+18192>>2]=1;f[t+5608>>2]=1;a=t+4788|0;o=f[a>>2]|0;if((o|0)>1){he=+v[t+4792+(o+-1<<2)>>2];f[x>>2]=o;y[x+8>>3]=he;Jr(r,2,5222,x)|0;f[t+4792>>2]=f[t+4792+((f[a>>2]|0)+-1<<2)>>2];f[a>>2]=1;i=d[F>>1]|0}t:do{switch(i&65535|0){case 3:{i=f[ee>>2]|0;if((i|0)>6){f[T>>2]=i+1;Jr(r,2,5395,T)|0;f[ee>>2]=6;i=6}break}case 4:{i=f[ee>>2]|0;if((i|0)<2){f[A>>2]=i+1;Jr(r,2,5541,A)|0;f[ee>>2]=1;i=1;break t}if((i|0)>7){f[M>>2]=i+1;Jr(r,2,5695,M)|0;f[ee>>2]=7;i=7}break}default:i=f[ee>>2]|0}}while(0);a=t+40|0;f[a>>2]=f[a>>2]|1;a=t+5620|0;f[a>>2]=i+-1;if((i|0)>1){i=0;do{f[t+5624+(i<<2)>>2]=256;f[t+5756+(i<<2)>>2]=256;i=i+1|0}while((i|0)<(f[a>>2]|0))}f[t+44>>2]=4;if((d[F>>1]|0)==4){i=f[ee>>2]|0;f[t+96>>2]=1;f[t+48>>2]=0;f[t+52>>2]=0;f[t+56>>2]=1;Y=i+-1|0;f[t+60>>2]=Y;f[t+64>>2]=3;f[t+80>>2]=4;f[t+244>>2]=1;f[t+196>>2]=Y;f[t+200>>2]=0;f[t+204>>2]=1;f[t+208>>2]=i;f[t+212>>2]=3;f[t+228>>2]=4;i=2}else i=0;f[t+4784>>2]=i;f[t+20>>2]=1;i=f[k>>2]|0;if((i|0)>=1){if((i|0)>1302083){Jr(r,2,5998,R)|0;f[k>>2]=1302083}}else{f[k>>2]=1302083;Jr(r,2,5849,S)|0}i=t+18680|0;a=f[i>>2]|0;if((a|0)>=1){if((a|0)>1041666){Jr(r,2,6320,L)|0;f[i>>2]=1041666}}else{f[i>>2]=1041666;Jr(r,2,6171,P)|0}a=f[n+16>>2]|0;s=f[n+24>>2]|0;l=f[s+8>>2]|0;i=ue(l,a)|0;c=f[s+12>>2]|0;i=ue(i,c)|0;he=+((ue(i,f[s+24>>2]|0)|0)>>>0);i=ue(f[k>>2]<<3,f[s>>2]|0)|0;he=he/+((ue(i,f[s+4>>2]|0)|0)>>>0);v[t+4792>>2]=he;i=d[F>>1]|0;t:do{if((a|0)==3){a=s+28|0;o=s+32|0;if(!((f[a>>2]|0)!=12|f[o>>2])){a=s+80|0;o=s+84|0;if(!((f[a>>2]|0)!=12|f[o>>2])){a=s+132|0;o=s+136|0;if(!((f[a>>2]|0)!=12|f[o>>2])){switch(i&65535|0){case 3:{if(c>>>0>1080|l>>>0>2048){f[I>>2]=l;f[I+4>>2]=c;Jr(r,2,6892,I)|0;break t}break}case 4:{if(c>>>0>2160|l>>>0>4096){f[N>>2]=l;f[N+4>>2]=c;Jr(r,2,7063,N)|0;break t}break}default:{}}break e}else{c=a;i=o;a=2}}else{c=a;i=o;a=1}}else{c=a;i=o;a=0}h[O>>0]=h[6659]|0;h[O+1>>0]=h[6660]|0;h[O+2>>0]=h[6661]|0;h[O+3>>0]=h[6662]|0;h[O+4>>0]=h[6663]|0;h[O+5>>0]=h[6664]|0;h[O+6>>0]=h[6665]|0;o=H;s=6666;l=o+9|0;do{h[o>>0]=h[s>>0]|0;o=o+1|0;s=s+1|0}while((o|0)<(l|0));Y=(f[i>>2]|0)!=0?O:H;H=f[c>>2]|0;f[D>>2]=a;f[D+4>>2]=H;f[D+8>>2]=Y;Jr(r,2,6675,D)|0}else{f[C>>2]=a;Jr(r,2,6493,C)|0}}while(0);d[F>>1]=0;i=0}}while(0);f[e+168>>2]=f[t+18680>>2];Y=e+88|0;d[Y>>1]=i;D=e+181|0;O=h[D>>0]&-2|f[t+20>>2]&1;h[D>>0]=O;H=t+24|0;O=(f[H>>2]&255)<<1&2|O&-3;h[D>>0]=O;h[D>>0]=O&-5|(f[t+28>>2]&255)<<2&4;do{if((f[H>>2]|0)!=0?(U=t+32|0,(f[U>>2]|0)!=0):0){i=ue((f[t+4788>>2]|0)*12|0,f[ee>>2]|0)|0;a=Xi(i)|0;f[e+176>>2]=a;if(a){Xl(a|0,f[U>>2]|0,i|0)|0;break}Jr(r,1,7520,B)|0;r=0;b=ce;return r|0}}while(0);s=e+100|0;f[s>>2]=f[t+12>>2];l=e+104|0;f[l>>2]=f[t+16>>2];o=e+92|0;f[o>>2]=f[t+4>>2];c=e+96|0;f[c>>2]=f[t+8>>2];a=t+36|0;i=f[a>>2]|0;do{if(!i){i=hi()|0;a=Xi((xl(i)|0)+29|0)|0;f[e+108>>2]=a;if(a){f[j>>2]=7697;f[j+4>>2]=i;pl(a,7692,j)|0;break}Jr(r,1,7646,V)|0;r=0;b=ce;return r|0}else{i=Xi((xl(i)|0)+1|0)|0;f[e+108>>2]=i;if(i){wl(i,f[a>>2]|0)|0;break}Jr(r,1,7592,z)|0;r=0;b=ce;return r|0}}while(0);i=(f[n+8>>2]|0)-(f[o>>2]|0)|0;a=f[n+12>>2]|0;if(!(f[t>>2]|0)){f[s>>2]=i;f[l>>2]=a-(f[c>>2]|0)}else{j=f[s>>2]|0;f[J>>2]=(i+-1+j|0)/(j|0)|0;j=f[l>>2]|0;f[$>>2]=(a+-1-(f[c>>2]|0)+j|0)/(j|0)|0}if(h[t+18688>>0]|0){h[e+180>>0]=h[t+18689>>0]|0;h[D>>0]=h[D>>0]|8}j=Yi(ue(f[$>>2]|0,f[J>>2]|0)|0,5640)|0;H=e+164|0;f[H>>2]=j;if(!j){Jr(r,1,7726,G)|0;r=0;b=ce;return r|0}O=t+4784|0;M=f[O>>2]|0;do{if(M){w=t+48|0;S=f[ee>>2]|0;R=f[n+16>>2]|0;k=f[t+4788>>2]|0;P=ue(R,S)|0;L=Yi(ue(P,k)|0,4)|0;if(!L){Jr(r,1,7780,W)|0;break}o=f[w>>2]|0;m=t+60|0;i=f[m>>2]|0;if(o>>>0<i>>>0){u=ue(o,R)|0;g=t+52|0;_=t+64|0;E=t+56|0;a=f[_>>2]|0;while(1){s=f[g>>2]|0;if(s>>>0<a>>>0){i=f[E>>2]|0;c=s;l=s+u|0;while(1){if(!i)i=0;else{a=l;s=0;while(1){f[L+(a<<2)>>2]=1;s=s+1|0;i=f[E>>2]|0;if(s>>>0>=i>>>0)break;else a=a+P|0}a=f[_>>2]|0}c=c+1|0;if(c>>>0>=a>>>0)break;else l=l+1|0}i=f[m>>2]|0}o=o+1|0;if(o>>>0>=i>>>0)break;else u=u+R|0}}if(M>>>0>1){A=1;do{i=w;w=w+148|0;E=f[i+8>>2]|0;_=i+156|0;s=f[_>>2]|0;E=s>>>0>E>>>0?E:0;l=f[w>>2]|0;x=i+160|0;a=f[x>>2]|0;if(l>>>0<a>>>0){u=ue(l,R)|0;T=i+152|0;m=i+164|0;g=ue(E,P)|0;o=f[m>>2]|0;i=s;while(1){s=f[T>>2]|0;if(s>>>0<o>>>0){c=s;s=s+u|0;while(1){if(E>>>0<i>>>0){a=s+g|0;o=E;while(1){f[L+(a<<2)>>2]=1;o=o+1|0;i=f[_>>2]|0;if(o>>>0>=i>>>0)break;else a=a+P|0}o=f[m>>2]|0}c=c+1|0;if(c>>>0>=o>>>0)break;else s=s+1|0}a=f[x>>2]|0}l=l+1|0;if(l>>>0>=a>>>0)break;else u=u+R|0}}A=A+1|0}while((A|0)!=(M|0))}if((k|0)!=0?(q=(R|0)==0,(S|0)!=0):0){a=0;u=0;i=0;do{if(!q){c=a;l=0;while(1){o=0;s=c;while(1){i=(f[L+(s<<2)>>2]|0)!=1|i;o=o+1|0;if((o|0)==(R|0))break;else s=s+1|0}l=l+1|0;if((l|0)==(S|0))break;else c=c+R|0}a=P+a|0}u=u+1|0}while((u|0)!=(k|0));if(i)Jr(r,1,7828,X)|0}Ji(L)}}while(0);e:do{if(ue(f[$>>2]|0,f[J>>2]|0)|0){w=t+4788|0;x=t+40|0;T=t+44|0;A=t+18690|0;M=n+16|0;a=t+18696|0;S=n+24|0;R=t+5596|0;k=t+5600|0;P=t+5604|0;L=t+5608|0;C=t+5612|0;I=t+5616|0;N=t+5620|0;F=0;t:while(1){u=f[H>>2]|0;m=u+(F*5640|0)|0;X=f[w>>2]|0;i=u+(F*5640|0)+8|0;f[i>>2]=X;if(X){o=((d[Y>>1]|0)+-3&65535)<4;l=0;do{s=(h[D>>0]&4)==0;do{if(!o)if(s){f[u+(F*5640|0)+20+(l<<2)>>2]=f[t+4792+(l<<2)>>2];break}else{f[u+(F*5640|0)+5184+(l<<2)>>2]=f[t+5192+(l<<2)>>2];break}else{if(!s)f[u+(F*5640|0)+5184+(l<<2)>>2]=f[t+5192+(l<<2)>>2];f[u+(F*5640|0)+20+(l<<2)>>2]=f[t+4792+(l<<2)>>2]}}while(0);l=l+1|0}while(l>>>0<(f[i>>2]|0)>>>0)}f[m>>2]=f[x>>2];f[u+(F*5640|0)+4>>2]=f[T>>2];c=u+(F*5640|0)+16|0;f[c>>2]=h[A>>0];i=u+(F*5640|0)+5636|0;o=h[i>>0]|0;h[i>>0]=o&-5;if(!(f[O>>2]|0))f[u+(F*5640|0)+420>>2]=0;else{h[i>>0]=o|4;o=f[O>>2]|0;if(!o)i=0;else{s=F+1|0;l=0;i=0;do{if((s|0)==(f[t+48+(l*148|0)+48>>2]|0)){f[u+(F*5640|0)+424+(i*148|0)>>2]=f[t+48+(i*148|0)>>2];f[u+(F*5640|0)+424+(i*148|0)+4>>2]=f[t+48+(i*148|0)+4>>2];f[u+(F*5640|0)+424+(i*148|0)+8>>2]=f[t+48+(i*148|0)+8>>2];f[u+(F*5640|0)+424+(i*148|0)+12>>2]=f[t+48+(i*148|0)+12>>2];f[u+(F*5640|0)+424+(i*148|0)+16>>2]=f[t+48+(i*148|0)+16>>2];f[u+(F*5640|0)+424+(i*148|0)+32>>2]=f[t+48+(i*148|0)+32>>2];f[u+(F*5640|0)+424+(i*148|0)+48>>2]=f[t+48+(i*148|0)+48>>2];i=i+1|0}l=l+1|0}while(l>>>0<o>>>0)}f[u+(F*5640|0)+420>>2]=i+-1}X=Yi(f[M>>2]|0,1080)|0;E=u+(F*5640|0)+5584|0;f[E>>2]=X;if(!X){Q=149;break}do{if(!(f[a>>2]|0)){n:do{if((f[c>>2]|0)==1){i=f[M>>2]|0;if(i>>>0<=2){s=i;break}o=f[S>>2]|0;i=f[o>>2]|0;do{if((i|0)==(f[o+52>>2]|0)){if((i|0)!=(f[o+104>>2]|0))break;i=f[o+4>>2]|0;if((i|0)!=(f[o+56>>2]|0))break;if((i|0)==(f[o+108>>2]|0)){Q=175;break n}}}while(0);Jr(r,2,8224,ie)|0;f[c>>2]=0;Q=175}else Q=175}while(0);if((Q|0)==175){Q=0;s=f[M>>2]|0}if(!s)break;i=f[S>>2]|0;o=0;do{if(!(f[i+(o*52|0)+32>>2]|0))f[(f[E>>2]|0)+(o*1080|0)+1076>>2]=1<<(f[i+(o*52|0)+24>>2]|0)+-1;o=o+1|0}while(o>>>0<s>>>0);K=s;Q=166}else{s=f[M>>2]|0;s=ue(s<<2,s)|0;i=Xi(s)|0;l=(f[a>>2]|0)+s|0;if(!i){Q=152;break t}f[c>>2]=2;o=Xi(s)|0;f[u+(F*5640|0)+5608>>2]=o;if(!o){Q=154;break t}Xl(o|0,f[a>>2]|0,s|0)|0;Xl(i|0,f[a>>2]|0,s|0)|0;o=Xi(s)|0;s=u+(F*5640|0)+5604|0;f[s>>2]=o;if(!o){Q=156;break t}if(!(Yo(i,o,f[M>>2]|0)|0)){Q=158;break t}o=Xi(f[M>>2]<<3)|0;f[u+(F*5640|0)+5600>>2]=o;if(!o){Q=160;break t}Pn(o,f[M>>2]|0,f[s>>2]|0);Ji(i);i=f[M>>2]|0;if(i){o=f[E>>2]|0;s=0;do{f[o+(s*1080|0)+1076>>2]=f[l+(s<<2)>>2];s=s+1|0}while(s>>>0<i>>>0)}if(!(ia(m,n)|0)){Q=167;break t}K=f[M>>2]|0;Q=166}}while(0);if((Q|0)==166?(Q=0,(K|0)!=0):0){_=0;do{m=f[E>>2]|0;g=m+(_*1080|0)|0;f[g>>2]=f[x>>2]&1;s=f[ee>>2]|0;l=m+(_*1080|0)+4|0;f[l>>2]=s;i=f[R>>2]|0;if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+8>>2]=i;i=f[k>>2]|0;if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+12>>2]=i;f[m+(_*1080|0)+16>>2]=f[P>>2];X=f[L>>2]|0;f[m+(_*1080|0)+20>>2]=(X|0)==0&1;f[m+(_*1080|0)+24>>2]=(X|0)!=0?2:0;f[m+(_*1080|0)+804>>2]=2;if((_|0)==(f[C>>2]|0))i=f[I>>2]|0;else i=0;f[m+(_*1080|0)+808>>2]=i;do{if(!(f[x>>2]&1)){if(!s)break;else i=0;do{f[m+(_*1080|0)+812+(i<<2)>>2]=15;f[m+(_*1080|0)+944+(i<<2)>>2]=15;i=i+1|0}while(i>>>0<(f[l>>2]|0)>>>0)}else{if((s|0)>0){l=s;u=0}else break;while(1){c=l;l=l+-1|0;i=f[N>>2]|0;do{if((u|0)<(i|0)){i=f[t+5624+(u<<2)>>2]|0;if((i|0)<1)f[m+(_*1080|0)+812+(l<<2)>>2]=1;else{if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+812+(l<<2)>>2]=i}i=f[t+5756+(u<<2)>>2]|0;if((i|0)<1){f[m+(_*1080|0)+944+(l<<2)>>2]=1;break}if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+944+(l<<2)>>2]=i}else{X=i+-1|0;o=u-X|0;i=f[t+5624+(X<<2)>>2]>>o;o=f[t+5756+(X<<2)>>2]>>o;if((i|0)<1)f[m+(_*1080|0)+812+(l<<2)>>2]=1;else{if((i|0)>1){s=0;do{i=i>>1;s=s+1|0}while((i|0)>1);i=s}else i=0;f[m+(_*1080|0)+812+(l<<2)>>2]=i}if((o|0)<1){f[m+(_*1080|0)+944+(l<<2)>>2]=1;break}if((o|0)>1){i=0;do{o=o>>1;i=i+1|0}while((o|0)>1)}else i=0;f[m+(_*1080|0)+944+(l<<2)>>2]=i}}while(0);if((c|0)<=1)break;else u=u+1|0}}}while(0);Uo(g,f[(f[S>>2]|0)+(_*52|0)+24>>2]|0);_=_+1|0}while(_>>>0<(f[M>>2]|0)>>>0)}F=F+1|0;if(F>>>0>=(ue(f[$>>2]|0,f[J>>2]|0)|0)>>>0)break e}if((Q|0)==149){Jr(r,1,7867,te)|0;r=0;b=ce;return r|0}else if((Q|0)==152){Jr(r,1,7931,ne)|0;r=0;b=ce;return r|0}else if((Q|0)==154){Ji(i);Jr(r,1,7974,ae)|0;r=0;b=ce;return r|0}else if((Q|0)==156){Ji(i);Jr(r,1,8032,oe)|0;r=0;b=ce;return r|0}else if((Q|0)==158){Ji(i);Jr(r,1,8092,se)|0;r=0;b=ce;return r|0}else if((Q|0)==160){Ji(i);Jr(r,1,8140,le)|0;r=0;b=ce;return r|0}else if((Q|0)==167){Jr(r,1,8190,re)|0;r=0;b=ce;return r|0}}else a=t+18696|0}while(0);i=f[a>>2]|0;if(!i){r=1;b=ce;return r|0}Ji(i);f[a>>2]=0;r=1;b=ce;return r|0}function ia(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0;if((f[e+16>>2]|0)!=2){e=1;return e|0}c=e+5604|0;g=e+5616|0;n=f[g>>2]|0;u=e+5620|0;do{if(f[c>>2]|0){do{if((n|0)==(f[u>>2]|0)){n=n+10|0;f[u>>2]=n;r=e+5612|0;n=Qi(f[r>>2]|0,n*20|0)|0;if(n){f[r>>2]=n;m=f[g>>2]|0;jl(n+(m*20|0)|0,0,((f[u>>2]|0)-m|0)*20|0)|0;n=f[g>>2]|0;break}Ji(f[r>>2]|0);f[r>>2]=0;f[u>>2]=0;f[g>>2]=0;e=0;return e|0}else r=e+5612|0}while(0);s=f[r>>2]|0;a=s+(n*20|0)|0;l=s+(n*20|0)+12|0;r=f[l>>2]|0;if(r){Ji(r);f[l>>2]=0}f[s+(n*20|0)+8>>2]=1;f[s+(n*20|0)+4>>2]=1;f[a>>2]=2;r=f[t+16>>2]|0;r=ue(r,r)|0;i=r<<2;o=Xi(i)|0;f[l>>2]=o;if(!o){e=0;return e|0}else{Fc[f[768+(f[a>>2]<<2)>>2]&15](f[c>>2]|0,o,r);f[s+(n*20|0)+16>>2]=i;n=(f[g>>2]|0)+1|0;f[g>>2]=n;o=2;break}}else{o=1;a=0}}while(0);do{if((n|0)==(f[u>>2]|0)){r=n+10|0;f[u>>2]=r;n=e+5612|0;r=Qi(f[n>>2]|0,r*20|0)|0;if(!r){Ji(f[n>>2]|0);f[n>>2]=0;f[u>>2]=0;f[g>>2]=0;e=0;return e|0}else{f[n>>2]=r;i=f[g>>2]|0;jl(r+(i*20|0)|0,0,((f[u>>2]|0)-i|0)*20|0)|0;if(!a){a=0;break}a=r+((i+-1|0)*20|0)|0;break}}else n=e+5612|0}while(0);c=f[n>>2]|0;u=f[g>>2]|0;m=c+(u*20|0)|0;d=c+(u*20|0)+12|0;n=f[d>>2]|0;if(n){Ji(n);f[d>>2]=0}p=o+1|0;f[c+(u*20|0)+8>>2]=o;f[c+(u*20|0)+4>>2]=2;f[m>>2]=2;t=t+16|0;n=f[t>>2]|0;r=n<<2;l=Xi(r)|0;f[d>>2]=l;if(!l){e=0;return e|0}i=Xi(r)|0;if(!i){Ji(f[d>>2]|0);f[d>>2]=0;e=0;return e|0}if(n){o=0;s=i;l=f[e+5584>>2]|0;while(1){v[s>>2]=+(f[l+1076>>2]|0);o=o+1|0;if((o|0)==(n|0))break;else{s=s+4|0;l=l+1080|0}}}Fc[f[768+(f[m>>2]<<2)>>2]&15](i,f[d>>2]|0,n);Ji(i);f[c+(u*20|0)+16>>2]=r;f[g>>2]=(f[g>>2]|0)+1;o=e+5628|0;n=f[o>>2]|0;i=e+5632|0;do{if((n|0)==(f[i>>2]|0)){n=n+10|0;f[i>>2]=n;r=e+5624|0;n=Qi(f[r>>2]|0,n*20|0)|0;if(n){f[r>>2]=n;e=f[o>>2]|0;jl(n+(e*20|0)|0,0,((f[i>>2]|0)-e|0)*20|0)|0;n=f[o>>2]|0;break}Ji(f[r>>2]|0);f[r>>2]=0;f[i>>2]=0;f[o>>2]=0;e=0;return e|0}else r=e+5624|0}while(0);e=f[r>>2]|0;f[e+(n*20|0)+8>>2]=a;g=e+(n*20|0)+16|0;h[g>>0]=h[g>>0]|1;f[e+(n*20|0)+4>>2]=f[t>>2];f[e+(n*20|0)>>2]=p;f[e+(n*20|0)+12>>2]=m;f[o>>2]=(f[o>>2]|0)+1;e=1;return e|0}function aa(e,t,n){e=e|0;t=t|0;n=n|0;return 1}function oa(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;l=ti()|0;c=t+80|0;f[c>>2]=l;if(!l){c=0;return c|0}i=t+192|0;if((_o(f[i>>2]|0,23,r)|0)!=0?(_o(f[i>>2]|0,24,r)|0)!=0:0){o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(kc[f[i>>2]&63](t,e,r)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){ri(f[c>>2]|0);f[c>>2]=0;c=0;return c|0}}else wo(o);i=t+188|0;if((_o(f[i>>2]|0,25,r)|0)!=0?(_o(f[i>>2]|0,26,r)|0)!=0:0){o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(kc[f[i>>2]&63](t,e,r)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){ri(f[c>>2]|0);f[c>>2]=0;c=0;return c|0}}else wo(o);i=ti()|0;f[n>>2]=i;if(!i){c=0;return c|0}ai(f[c>>2]|0,i);i=ue(f[t+116>>2]|0,f[t+112>>2]|0)|0;s=t+196|0;f[(f[s>>2]|0)+36>>2]=i;i=Yi(i,40)|0;a=f[s>>2]|0;f[a+40>>2]=i;if(!i){c=0;return c|0}if(!(f[a+36>>2]|0)){c=1;return c|0}o=0;while(1){f[i+(o*40|0)+28>>2]=100;f[i+(o*40|0)+20>>2]=0;c=Yi(100,24)|0;a=f[s>>2]|0;i=f[a+40>>2]|0;f[i+(o*40|0)+24>>2]=c;o=o+1|0;if(!c){i=0;a=30;break}if(o>>>0>=(f[a+36>>2]|0)>>>0){i=1;a=30;break}}if((a|0)==30)return i|0}ri(f[c>>2]|0);f[c>>2]=0;c=0;return c|0}ri(f[c>>2]|0);f[c>>2]=0;c=0;return c|0}function sa(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0;if(!e)return;t=e+28|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}o=e+40|0;t=f[o>>2]|0;if(t){a=e+36|0;if(f[a>>2]|0){n=t;i=0;do{r=f[n+(i*40|0)+36>>2]|0;if(r){Ji(r);t=f[o>>2]|0;f[t+(i*40|0)+36>>2]=0;n=t}r=f[n+(i*40|0)+16>>2]|0;if(r){Ji(r);t=f[o>>2]|0;f[t+(i*40|0)+16>>2]=0;n=t}r=f[n+(i*40|0)+24>>2]|0;if(r){Ji(r);n=f[o>>2]|0;f[n+(i*40|0)+24>>2]=0;t=n}i=i+1|0}while(i>>>0<(f[a>>2]|0)>>>0)}Ji(t);f[o>>2]=0}Ji(e);return}function la(e,t,n,r,i,a,o,s,l,c,u){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;c=c|0;u=u|0;var p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Z=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Ae=0,Me=0,Se=0,Re=0,ke=0;ke=b;b=b+256|0;Re=ke+200|0;Se=ke+192|0;Ae=ke+184|0;Te=ke+176|0;me=ke+168|0;pe=ke+160|0;fe=ke+152|0;de=ke+144|0;he=ke+136|0;ce=ke+128|0;se=ke+120|0;oe=ke+112|0;we=ke+104|0;be=ke+96|0;ae=ke+88|0;ie=ke+80|0;re=ke+72|0;Ee=ke+64|0;ne=ke+56|0;te=ke+48|0;ye=ke+40|0;ve=ke+32|0;ge=ke+24|0;le=ke+16|0;ee=ke+8|0;$=ke;X=ke+240|0;W=ke+236|0;K=ke+232|0;Q=ke+228|0;J=ke+224|0;q=ke+220|0;Z=ke+216|0;G=ke+212|0;Y=ke+208|0;f[G>>2]=65424;Me=e+8|0;e:do{switch(f[Me>>2]|0){case 256:{f[G>>2]=65497;p=e+76|0;xe=117;break}case 8:{_e=e+76|0;if(!(h[_e>>0]&1)){U=e+200|0;z=e+164|0;V=e+72|0;j=e+24|0;S=e+196|0;R=e+112|0;k=e+116|0;L=X+2|0;C=X+6|0;I=X+7|0;N=e+16|0;F=e+20|0;O=e+64|0;p=65424;t:while(1){n:do{if((p|0)!=65427){while(1){M=Yr(c)|0;if((M|0)==0&(B|0)==0){xe=7;break}if((Gr(c,f[N>>2]|0,2,u)|0)!=2){xe=9;break t}wr(f[N>>2]|0,Y,2);if((f[Y>>2]|0)>>>0<2){xe=11;break t}if((f[G>>2]|0)==32896?(M=Yr(c)|0,(M|0)==0&(B|0)==0):0){xe=14;break}v=f[Me>>2]|0;p=f[Y>>2]|0;if(v&16)f[j>>2]=-2-p+(f[j>>2]|0);m=p+-2|0;f[Y>>2]=m;p=f[G>>2]|0;g=784;while(1){M=f[g>>2]|0;if((M|0)==0|(M|0)==(p|0)){T=g;break}else g=g+12|0}if(!(f[g+4>>2]&v)){xe=20;break t}if(m>>>0>(f[F>>2]|0)>>>0){M=Yr(c)|0;A=B;if(0>(A|0)|0==(A|0)&m>>>0>M>>>0){xe=24;break t}p=Qi(f[N>>2]|0,f[Y>>2]|0)|0;if(!p){xe=26;break t}f[N>>2]=p;m=f[Y>>2]|0;f[F>>2]=m}else p=f[N>>2]|0;m=Gr(c,p,m,u)|0;if((m|0)!=(f[Y>>2]|0)){xe=29;break t}p=f[g+8>>2]|0;if(!p){xe=31;break t}if(!(Hc[p&63](e,f[N>>2]|0,m,u)|0)){xe=33;break t}g=f[U>>2]|0;m=f[S>>2]|0;E=f[T>>2]|0;w=Xr(c)|0;x=f[Y>>2]|0;w=w-x+-4|0;x=x+4|0;m=m+40|0;_=f[m>>2]|0;p=f[_+(g*40|0)+20>>2]|0;v=_+(g*40|0)+28|0;y=f[v>>2]|0;if((p+1|0)>>>0>y>>>0){y=~~(+(y>>>0)+100.0)>>>0;f[v>>2]=y;v=Qi(f[_+(g*40|0)+24>>2]|0,y*24|0)|0;y=f[m>>2]|0;p=y+(g*40|0)+24|0;if(!v){xe=41;break t}f[p>>2]=v;m=y;p=f[y+(g*40|0)+20>>2]|0}else{m=_;v=f[_+(g*40|0)+24>>2]|0}d[v+(p*24|0)>>1]=E;M=v+(p*24|0)+8|0;f[M>>2]=w;f[M+4>>2]=((w|0)<0)<<31>>31;f[v+(p*24|0)+16>>2]=x;f[m+(g*40|0)+20>>2]=p+1;if((E|0)==65424?(P=f[m+(g*40|0)+16>>2]|0,(P|0)!=0):0){M=P+((f[m+(g*40|0)+12>>2]|0)*24|0)|0;f[M>>2]=w;f[M+4>>2]=0}do{if((f[T>>2]|0)==65424){p=Xr(c)|0;p=-4-(f[Y>>2]|0)+p|0;M=O;A=f[M+4>>2]|0;if(!(0>(A|0)|(0==(A|0)?p>>>0>(f[M>>2]|0)>>>0:0)))break;M=O;f[M>>2]=p;f[M+4>>2]=0}}while(0);if(h[_e>>0]&4){xe=46;break}if((Gr(c,f[N>>2]|0,2,u)|0)!=2){xe=50;break t}wr(f[N>>2]|0,G,2);if((f[G>>2]|0)==65427)break n}if((xe|0)==7){xe=0;f[Me>>2]=64;break}else if((xe|0)==14){xe=0;f[Me>>2]=64;break}else if((xe|0)==46){xe=0;M=Kr(c,f[j>>2]|0,0,u)|0;if(!((B|0)==0?(M|0)==(f[j>>2]|0):0)){xe=47;break t}f[G>>2]=65427;break}}}while(0);M=Yr(c)|0;if((M|0)==0&(B|0)==0?(f[Me>>2]|0)==64:0){xe=115;break}p=h[_e>>0]|0;if(!(p&4)){m=f[U>>2]|0;g=f[z>>2]|0;if(!(f[V>>2]|0)){p=f[j>>2]|0;if(p>>>0>1){v=p+-2|0;f[j>>2]=v}else v=p}else{v=Yr(c)|0;v=Wl(v|0,B|0,-2,0)|0;f[j>>2]=v}p=g+(m*5640|0)+5592|0;M=g+(m*5640|0)+5596|0;do{if(!v)A=1;else{A=Yr(c)|0;T=B;if(0>(T|0)|0==(T|0)&v>>>0>A>>>0)Jr(u,2,8573,ae)|0;m=f[p>>2]|0;if(!m){A=Xi(f[j>>2]|0)|0;f[p>>2]=A;if(!A)break t;else{A=0;break}}m=Qi(m,(f[j>>2]|0)+(f[M>>2]|0)|0)|0;if(!m){xe=65;break t}f[p>>2]=m;A=0}}while(0);m=f[S>>2]|0;if(m){w=Xr(c)|0;v=B;T=Wl(w|0,v|0,-2,-1)|0;g=f[U>>2]|0;m=m+40|0;_=f[m>>2]|0;E=f[_+(g*40|0)+12>>2]|0;y=f[_+(g*40|0)+16>>2]|0;x=y+(E*24|0)+8|0;f[x>>2]=T;f[x+4>>2]=B;x=f[j>>2]|0;v=Wl(x|0,0,w|0,v|0)|0;E=y+(E*24|0)+16|0;f[E>>2]=v;f[E+4>>2]=B;x=x+2|0;E=f[_+(g*40|0)+20>>2]|0;v=_+(g*40|0)+28|0;y=f[v>>2]|0;if((E+1|0)>>>0>y>>>0){y=~~(+(y>>>0)+100.0)>>>0;f[v>>2]=y;v=Qi(f[_+(g*40|0)+24>>2]|0,y*24|0)|0;y=f[m>>2]|0;_=y+(g*40|0)+24|0;if(!v){p=_;xe=74;break}f[_>>2]=v;w=y;m=f[y+(g*40|0)+20>>2]|0}else{w=_;v=f[_+(g*40|0)+24>>2]|0;m=E}d[v+(m*24|0)>>1]=-109;E=Vl(0,T|0,32)|0;T=v+(m*24|0)+8|0;f[T>>2]=E;f[T+4>>2]=B;f[v+(m*24|0)+16>>2]=x;f[w+(g*40|0)+20>>2]=m+1}if(!A)p=Gr(c,(f[p>>2]|0)+(f[M>>2]|0)|0,f[j>>2]|0,u)|0;else p=0;f[Me>>2]=(p|0)==(f[j>>2]|0)?8:64;f[M>>2]=(f[M>>2]|0)+p;p=h[_e>>0]|0;if((p&9)==1){h[_e>>0]=p|8;m=f[U>>2]|0;do{if((Qr(c)|0)!=0?(H=Xr(c)|0,D=B,!((H|0)==-1&(D|0)==-1)):0){while(1){if((Gr(c,X,2,u)|0)!=2){xe=81;break}wr(X,W,2);if((f[W>>2]|0)!=65424){xe=83;break}if((Gr(c,X,2,u)|0)!=2){xe=85;break}wr(X,K,2);if((f[K>>2]|0)!=10){xe=87;break}f[K>>2]=8;p=Gr(c,X,8,u)|0;if((p|0)!=(f[K>>2]|0)){xe=89;break}if((p|0)!=8){xe=91;break}wr(X,Q,2);wr(L,J,4);wr(C,q,1);wr(I,Z,1);if((f[Q>>2]|0)==(m|0)){xe=97;break}p=f[J>>2]|0;if(p>>>0<14){xe=94;break}xe=p+-12|0;f[J>>2]=xe;xe=Kr(c,xe,0,u)|0;if(!((B|0)==0?(xe|0)==(f[J>>2]|0):0)){xe=96;break}}if((xe|0)==81){xe=0;p=(Zr(c,H,D,u)|0)!=0&1;m=0;break}else if((xe|0)==83){xe=0;p=(Zr(c,H,D,u)|0)!=0&1;m=0;break}else if((xe|0)==85){xe=0;Jr(u,1,8295,oe)|0;p=0;m=0;break}else if((xe|0)==87){xe=0;Jr(u,1,8313,se)|0;p=0;m=0;break}else if((xe|0)==89){xe=0;Jr(u,1,8295,ce)|0;p=0;m=0;break}else if((xe|0)==91){xe=0;Jr(u,1,8662,he)|0;p=0;m=0;break}else if((xe|0)==94){xe=0;p=(Zr(c,H,D,u)|0)!=0&1;m=0;break}else if((xe|0)==96){xe=0;p=(Zr(c,H,D,u)|0)!=0&1;m=0;break}else if((xe|0)==97){xe=0;m=(f[q>>2]|0)==(f[Z>>2]|0)&1;p=(Zr(c,H,D,u)|0)!=0&1;break}}else{p=1;m=0}}while(0);if(!p){xe=99;break}if(m){p=ue(f[k>>2]|0,f[R>>2]|0)|0;h[_e>>0]=h[_e>>0]&-18|16;if(p){m=f[z>>2]|0;y=0;do{g=m+(y*5640|0)+5588|0;v=f[g>>2]|0;if(v)f[g>>2]=v+1;y=y+1|0}while((y|0)!=(p|0))}Jr(u,2,8734,fe)|0}}if(!(h[_e>>0]&1)){if((Gr(c,f[N>>2]|0,2,u)|0)!=2){xe=109;break}wr(f[N>>2]|0,G,2)}}else{h[_e>>0]=p&-6;f[Me>>2]=8;if((Gr(c,f[N>>2]|0,2,u)|0)!=2){xe=113;break}wr(f[N>>2]|0,G,2)}p=f[G>>2]|0;if(!((p|0)!=65497&(h[_e>>0]&1)==0)){xe=116;break}}switch(xe|0){case 9:{Jr(u,1,8295,$)|0;u=0;b=ke;return u|0}case 11:{Jr(u,1,8313,ee)|0;u=0;b=ke;return u|0}case 20:{Jr(u,1,8339,le)|0;u=0;b=ke;return u|0}case 24:{Jr(u,1,8382,ge)|0;u=0;b=ke;return u|0}case 26:{Ji(f[N>>2]|0);f[N>>2]=0;f[F>>2]=0;Jr(u,1,8427,ve)|0;u=0;b=ke;return u|0}case 29:{Jr(u,1,8295,ye)|0;u=0;b=ke;return u|0}case 31:{Jr(u,1,8461,te)|0;u=0;b=ke;return u|0}case 33:{f[ne>>2]=f[G>>2];Jr(u,1,8490,ne)|0;u=0;b=ke;return u|0}case 41:{Ji(f[p>>2]|0);Re=f[m>>2]|0;f[Re+(g*40|0)+24>>2]=0;f[Re+(g*40|0)+28>>2]=0;f[Re+(g*40|0)+20>>2]=0;Jr(u,1,8537,Ee)|0;u=0;b=ke;return u|0}case 47:{Jr(u,1,8295,re)|0;u=0;b=ke;return u|0}case 50:{Jr(u,1,8295,ie)|0;u=0;b=ke;return u|0}case 65:{Ji(f[p>>2]|0);f[p>>2]=0;break}case 74:{Ji(f[p>>2]|0);Re=f[m>>2]|0;f[Re+(g*40|0)+24>>2]=0;f[Re+(g*40|0)+28>>2]=0;f[Re+(g*40|0)+20>>2]=0;Jr(u,1,8537,we)|0;u=0;b=ke;return u|0}case 99:{Jr(u,1,8688,de)|0;u=0;b=ke;return u|0}case 109:{Jr(u,1,8295,pe)|0;u=0;b=ke;return u|0}case 113:{Jr(u,1,8295,me)|0;u=0;b=ke;return u|0}case 115:{p=f[G>>2]|0;xe=116;break}}if((xe|0)==116)if((p|0)==65497){p=_e;xe=117;break e}else{p=_e;break e}Jr(u,1,8628,be)|0;u=0;b=ke;return u|0}else p=_e;break}default:{u=0;b=ke;return u|0}}}while(0);if((xe|0)==117)if((f[Me>>2]|0)!=256){f[e+200>>2]=0;f[Me>>2]=256}if(!(h[p>>0]&1)){v=ue(f[e+112>>2]|0,f[e+116>>2]|0)|0;y=e+200|0;m=f[y>>2]|0;e:do{if(m>>>0<v>>>0){p=m;g=(f[e+164>>2]|0)+(m*5640|0)|0;while(1){if(f[g+5592>>2]|0){m=p;break e}m=p+1|0;f[y>>2]=m;if(m>>>0<v>>>0){p=m;g=g+5640|0}else break}}}while(0);if((m|0)==(v|0)){f[l>>2]=0;u=1;b=ke;return u|0}}else{m=e+200|0;y=m;m=f[m>>2]|0}M=f[e+164>>2]|0;if(h[M+(m*5640|0)+5636>>0]&2){S=M+(m*5640|0)+5160|0;g=f[S>>2]|0;if(!g)p=0;else{v=f[M+(m*5640|0)+5164>>2]|0;_=0;p=0;do{p=(f[v+(_<<3)+4>>2]|0)+p|0;_=_+1|0}while((_|0)!=(g|0))}xe=Xi(p)|0;A=M+(m*5640|0)+5172|0;f[A>>2]=xe;if(!xe){Jr(u,1,8775,Te)|0;Jr(u,1,8813,Ae)|0;u=0;b=ke;return u|0}T=M+(m*5640|0)+5180|0;f[T>>2]=p;g=f[S>>2]|0;x=M+(m*5640|0)+5164|0;if(!g)p=f[x>>2]|0;else{p=f[x>>2]|0;E=p;w=0;_=0;while(1){v=f[E+(w<<3)>>2]|0;if(!v)v=E;else{Xl((f[A>>2]|0)+_|0,v|0,f[E+(w<<3)+4>>2]|0)|0;v=f[x>>2]|0;_=(f[v+(w<<3)+4>>2]|0)+_|0;Ji(f[v+(w<<3)>>2]|0);v=f[x>>2]|0;f[v+(w<<3)>>2]=0;f[v+(w<<3)+4>>2]=0;g=f[S>>2]|0;p=v}w=w+1|0;if(w>>>0>=g>>>0)break;else E=v}}f[S>>2]=0;Ji(p);f[x>>2]=0;f[M+(m*5640|0)+5168>>2]=f[A>>2];f[M+(m*5640|0)+5176>>2]=f[T>>2];m=f[y>>2]|0}p=e+204|0;if(!(Kn(f[p>>2]|0,m,u)|0)){Jr(u,1,8839,Se)|0;u=0;b=ke;return u|0}else{Se=ue(f[e+112>>2]|0,f[e+116>>2]|0)|0;f[Re>>2]=(f[y>>2]|0)+1;f[Re+4>>2]=Se;Jr(u,4,8873,Re)|0;f[t>>2]=f[y>>2];f[l>>2]=1;u=Zn(f[p>>2]|0)|0;f[n>>2]=u;u=f[f[(f[p>>2]|0)+20>>2]>>2]|0;f[r>>2]=f[u>>2];f[i>>2]=f[u+4>>2];f[a>>2]=f[u+8>>2];f[o>>2]=f[u+12>>2];f[s>>2]=f[u+16>>2];f[Me>>2]=f[Me>>2]|128;u=1;b=ke;return u|0}return 0}function ca(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;var o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0;y=b;b=b+48|0;g=y+28|0;v=y+32|0;d=e+8|0;if(!(f[d>>2]&128)){i=0;b=y;return i|0}m=e+200|0;if((f[m>>2]|0)!=(t|0)){i=0;b=y;return i|0}o=f[e+164>>2]|0;u=o+(t*5640|0)|0;p=o+(t*5640|0)+5592|0;s=f[p>>2]|0;if(!s){Ta(u);i=0;b=y;return i|0}l=e+204|0;c=o+(t*5640|0)+5596|0;if(!(Jn(f[l>>2]|0,s,f[c>>2]|0,t,f[e+196>>2]|0,a)|0)){Ta(u);f[d>>2]=f[d>>2]|32768;Jr(a,1,8912,y)|0;i=0;b=y;return i|0}if(!($n(f[l>>2]|0,n,r)|0)){i=0;b=y;return i|0}o=f[p>>2]|0;if(o){Ji(o);f[p>>2]=0;f[c>>2]=0}p=e+76|0;h[p>>0]=h[p>>0]&-2;f[d>>2]=f[d>>2]&-129;p=Yr(i)|0;e=f[d>>2]|0;if((e|0)==256|(p|0)==0&(B|0)==0&(e|0)==64){i=1;b=y;return i|0}if((Gr(i,v,2,a)|0)!=2){Jr(a,2,8931,y+8|0)|0;i=1;b=y;return i|0}wr(v,g,2);switch(f[g>>2]|0){case 65497:{f[m>>2]=0;f[d>>2]=256;i=1;b=y;return i|0}case 65424:{i=1;b=y;return i|0}default:if((Yr(i)|0)==0&(B|0)==0){f[d>>2]=64;Jr(a,2,8975,y+16|0)|0;i=1;b=y;return i|0}else{Jr(a,1,9005,y+24|0)|0;i=0;b=y;return i|0}}return 0}function ua(e,t,n,r,i,a,o){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0;A=b;b=b+112|0;T=A+96|0;x=A+88|0;w=A+80|0;E=A+72|0;_=A+64|0;v=A+56|0;g=A+48|0;d=A+40|0;u=A+32|0;c=A+24|0;l=A+16|0;p=f[e+80>>2]|0;if((f[e+8>>2]|0)!=8){Jr(o,1,9037,A)|0;o=0;b=A;return o|0}if(!(r|n|i|a)){Jr(o,4,9116,A+8|0)|0;f[e+28>>2]=0;f[e+32>>2]=0;f[e+36>>2]=f[e+112>>2];f[e+40>>2]=f[e+116>>2];o=1;b=A;return o|0}y=p+8|0;s=f[y>>2]|0;if(s>>>0<n>>>0){f[l>>2]=n;f[l+4>>2]=s;Jr(o,1,9185,l)|0;o=0;b=A;return o|0}s=f[p>>2]|0;if(s>>>0>n>>>0){f[c>>2]=n;f[c+4>>2]=s;Jr(o,2,9272,c)|0;s=0;n=f[p>>2]|0}else s=((n-(f[e+92>>2]|0)|0)>>>0)/((f[e+100>>2]|0)>>>0)|0;f[e+28>>2]=s;f[t>>2]=n;m=p+12|0;n=f[m>>2]|0;if(n>>>0<r>>>0){f[u>>2]=r;f[u+4>>2]=n;Jr(o,1,9360,u)|0;o=0;b=A;return o|0}l=p+4|0;n=f[l>>2]|0;if(n>>>0>r>>>0){f[d>>2]=r;f[d+4>>2]=n;Jr(o,2,9445,d)|0;n=0;r=f[l>>2]|0}else n=((r-(f[e+96>>2]|0)|0)>>>0)/((f[e+104>>2]|0)>>>0)|0;f[e+32>>2]=n;c=t+4|0;f[c>>2]=r;n=f[p>>2]|0;if(n>>>0>i>>>0){f[g>>2]=i;f[g+4>>2]=n;Jr(o,1,9531,g)|0;o=0;b=A;return o|0}n=f[y>>2]|0;if(n>>>0<i>>>0){f[v>>2]=i;f[v+4>>2]=n;Jr(o,2,9620,v)|0;n=f[e+112>>2]|0;i=f[y>>2]|0}else{n=f[e+100>>2]|0;n=(i+-1-(f[e+92>>2]|0)+n|0)/(n|0)|0}f[e+36>>2]=n;s=t+8|0;f[s>>2]=i;i=f[l>>2]|0;if(i>>>0>a>>>0){f[_>>2]=a;f[_+4>>2]=i;Jr(o,1,9708,_)|0;o=0;b=A;return o|0}i=f[m>>2]|0;if(i>>>0<a>>>0){f[E>>2]=a;f[E+4>>2]=i;Jr(o,2,9798,E)|0;n=f[m>>2]|0;i=f[e+116>>2]|0}else{i=f[e+104>>2]|0;n=a;i=(a+-1-(f[e+96>>2]|0)+i|0)/(i|0)|0}f[e+40>>2]=i;a=t+12|0;f[a>>2]=n;E=e+76|0;h[E>>0]=h[E>>0]|2;E=f[t+16>>2]|0;e=f[t>>2]|0;e:do{if(E){r=f[c>>2]|0;y=r+-1|0;_=f[s>>2]|0;m=_+-1|0;g=e+-1|0;i=0;p=f[t+24>>2]|0;while(1){t=f[p>>2]|0;n=(g+t|0)/(t|0)|0;f[p+16>>2]=n;d=f[p+4>>2]|0;s=(y+d|0)/(d|0)|0;f[p+20>>2]=s;t=(m+t|0)/(t|0)|0;l=f[p+40>>2]|0;c=Gl(1,0,l|0)|0;u=B;t=Wl(t|0,((t|0)<0)<<31>>31|0,-1,-1)|0;t=Wl(t|0,B|0,c|0,u|0)|0;t=Vl(t|0,B|0,l|0)|0;n=Wl(n|0,((n|0)<0)<<31>>31|0,-1,-1)|0;n=Wl(n|0,B|0,c|0,u|0)|0;n=Vl(n|0,B|0,l|0)|0;n=t-n|0;if((n|0)<0){s=29;break}v=f[a>>2]|0;t=(d+-1+v|0)/(d|0)|0;f[p+8>>2]=n;t=Wl(t|0,((t|0)<0)<<31>>31|0,-1,-1)|0;t=Wl(t|0,B|0,c|0,u|0)|0;t=Vl(t|0,B|0,l|0)|0;n=Wl(s|0,((s|0)<0)<<31>>31|0,-1,-1)|0;n=Wl(n|0,B|0,c|0,u|0)|0;n=Vl(n|0,B|0,l|0)|0;n=t-n|0;if((n|0)<0){s=31;break}f[p+12>>2]=n;i=i+1|0;if(i>>>0>=E>>>0){n=_;i=v;break e}else p=p+52|0}if((s|0)==29){f[w>>2]=i;f[w+4>>2]=n;Jr(o,1,9887,w)|0;o=0;b=A;return o|0}else if((s|0)==31){f[x>>2]=i;f[x+4>>2]=n;Jr(o,1,9956,x)|0;o=0;b=A;return o|0}}else{r=f[c>>2]|0;n=f[s>>2]|0;i=f[a>>2]|0}}while(0);f[T>>2]=e;f[T+4>>2]=r;f[T+8>>2]=n;f[T+12>>2]=i;Jr(o,4,10025,T)|0;o=1;b=A;return o|0}function ha(){var e=0,t=0,n=0;e=Yi(1,208)|0;if(!e){t=0;return t|0}f[e>>2]=1;t=e+184|0;h[t>>0]=h[t>>0]|2;t=Yi(1,5640)|0;f[e+12>>2]=t;if(!t){na(e);t=0;return t|0}t=Yi(1,1e3)|0;f[e+16>>2]=t;if(!t){na(e);t=0;return t|0}f[e+20>>2]=1e3;f[e+60>>2]=-1;t=e+64|0;f[t>>2]=0;f[t+4>>2]=0;t=Yi(1,48)|0;do{if(t){f[t+32>>2]=100;f[t+24>>2]=0;n=Yi(100,24)|0;f[t+28>>2]=n;if(!n){Ji(t);break}f[t+40>>2]=0;f[e+196>>2]=t;n=vo()|0;f[e+192>>2]=n;if(!n){na(e);n=0;return n|0}n=vo()|0;f[e+188>>2]=n;if(n){n=e;return n|0}na(e);n=0;return n|0}}while(0);f[e+196>>2]=0;na(e);n=0;return n|0}function da(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,g=0,v=0,y=0,_=0;y=b;b=b+128|0;v=y+104|0;g=y+72|0;p=y+64|0;u=y+40|0;l=y+24|0;o=y+16|0;a=y+8|0;i=y;if(t&384){hl(10063,11,1,n)|0;b=y;return}if((t&1|0)!=0?(r=f[e+80>>2]|0,(r|0)!=0):0)fa(r,0,n);if(t&2){hl(10075,36,1,n)|0;r=f[e+96>>2]|0;f[i>>2]=f[e+92>>2];f[i+4>>2]=r;el(n,10112,i)|0;i=f[e+104>>2]|0;f[a>>2]=f[e+100>>2];f[a+4>>2]=i;el(n,10130,a)|0;a=f[e+116>>2]|0;f[o>>2]=f[e+112>>2];f[o+4>>2]=a;el(n,10148,o)|0;ka(f[e+12>>2]|0,f[(f[e+80>>2]|0)+16>>2]|0,n);hl(10164,2,1,n)|0}if((t&8|0)!=0?(s=ue(f[e+112>>2]|0,f[e+116>>2]|0)|0,(s|0)!=0):0){r=e+80|0;i=0;a=f[e+164>>2]|0;while(1){ka(a,f[(f[r>>2]|0)+16>>2]|0,n);i=i+1|0;if((i|0)==(s|0))break;else a=a+5640|0}}if(!(t&16)){b=y;return}o=f[e+196>>2]|0;hl(10167,37,1,n)|0;s=o;t=f[s+4>>2]|0;r=o+8|0;e=f[r>>2]|0;r=f[r+4>>2]|0;a=l;f[a>>2]=f[s>>2];f[a+4>>2]=t;a=l+8|0;f[a>>2]=e;f[a+4>>2]=r;el(n,10205,l)|0;hl(10272,17,1,n)|0;a=o+28|0;r=f[a>>2]|0;e:do{if((r|0)!=0?(c=o+24|0,(f[c>>2]|0)!=0):0){i=0;while(1){t=r+(i*24|0)+8|0;s=f[t>>2]|0;t=f[t+4>>2]|0;l=f[r+(i*24|0)+16>>2]|0;f[u>>2]=m[r+(i*24|0)>>1];e=u+8|0;f[e>>2]=s;f[e+4>>2]=t;f[u+16>>2]=l;el(n,10290,u)|0;i=i+1|0;if(i>>>0>=(f[c>>2]|0)>>>0)break e;r=f[a>>2]|0}}}while(0);hl(10321,4,1,n)|0;t=o+40|0;a=f[t>>2]|0;if((a|0)!=0?(d=o+36|0,h=f[d>>2]|0,(h|0)!=0):0){i=0;r=0;do{r=(f[a+(i*40|0)+4>>2]|0)+r|0;i=i+1|0}while((i|0)!=(h|0));if(r){hl(10326,16,1,n)|0;if(f[d>>2]|0){r=f[t>>2]|0;s=0;do{o=f[r+(s*40|0)+4>>2]|0;f[p>>2]=s;f[p+4>>2]=o;el(n,10343,p)|0;r=f[t>>2]|0;i=f[r+(s*40|0)+16>>2]|0;e:do{if(!((o|0)==0|(i|0)==0)){r=0;while(1){e=i+(r*24|0)|0;_=f[e>>2]|0;e=f[e+4>>2]|0;c=i+(r*24|0)+8|0;l=f[c>>2]|0;c=f[c+4>>2]|0;h=i+(r*24|0)+16|0;u=f[h>>2]|0;h=f[h+4>>2]|0;f[g>>2]=r;a=g+8|0;f[a>>2]=_;f[a+4>>2]=e;a=g+16|0;f[a>>2]=l;f[a+4>>2]=c;a=g+24|0;f[a>>2]=u;f[a+4>>2]=h;el(n,10379,g)|0;a=r+1|0;r=f[t>>2]|0;if((a|0)==(o|0))break e;i=f[r+(s*40|0)+16>>2]|0;r=a}}}while(0);i=f[r+(s*40|0)+24>>2]|0;e:do{if((i|0)!=0?(f[r+(s*40|0)+20>>2]|0)!=0:0){r=0;while(1){h=i+(r*24|0)+8|0;u=f[h>>2]|0;h=f[h+4>>2]|0;a=f[i+(r*24|0)+16>>2]|0;f[v>>2]=m[i+(r*24|0)>>1];_=v+8|0;f[_>>2]=u;f[_+4>>2]=h;f[v+16>>2]=a;el(n,10290,v)|0;a=r+1|0;r=f[t>>2]|0;if(a>>>0>=(f[r+(s*40|0)+20>>2]|0)>>>0)break e;i=f[r+(s*40|0)+24>>2]|0;r=a}}}while(0);s=s+1|0}while(s>>>0<(f[d>>2]|0)>>>0)}hl(10321,4,1,n)|0}}hl(10164,2,1,n)|0;b=y;return}function fa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0;u=b;b=b+64|0;c=u+48|0;l=u+40|0;o=u+32|0;a=u+16|0;i=u;s=u+52|0;if(!t){hl(10482,13,1,n)|0;h[s+1>>0]=0;r=9}else{hl(10445,36,1,f[676]|0)|0;r=0}h[s>>0]=r;d=f[e>>2]|0;r=f[e+4>>2]|0;f[i>>2]=s;f[i+4>>2]=d;f[i+8>>2]=r;el(n,10496,i)|0;i=f[e+8>>2]|0;r=f[e+12>>2]|0;f[a>>2]=s;f[a+4>>2]=i;f[a+8>>2]=r;el(n,10513,a)|0;a=e+16|0;r=f[a>>2]|0;f[o>>2]=s;f[o+4>>2]=r;el(n,10530,o)|0;r=e+24|0;if(!(f[r>>2]|0)){hl(10164,2,1,n)|0;b=u;return}if(!(f[a>>2]|0)){hl(10164,2,1,n)|0;b=u;return}else i=0;do{f[l>>2]=s;f[l+4>>2]=i;el(n,10546,l)|0;pa((f[r>>2]|0)+(i*52|0)|0,t,n);f[c>>2]=s;el(n,10566,c)|0;i=i+1|0}while(i>>>0<(f[a>>2]|0)>>>0);hl(10164,2,1,n)|0;b=u;return}function pa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;l=b;b=b+48|0;s=l+24|0;o=l+16|0;a=l;i=l+32|0;r=(t|0)!=0;if(r){hl(10571,41,1,f[676]|0)|0;t=0}else{h[i+1>>0]=9;h[i+2>>0]=0;t=9}h[i>>0]=t;c=f[e>>2]|0;t=f[e+4>>2]|0;f[a>>2]=i;f[a+4>>2]=c;f[a+8>>2]=t;el(n,10613,a)|0;a=f[e+24>>2]|0;f[o>>2]=i;f[o+4>>2]=a;el(n,10630,o)|0;o=f[e+32>>2]|0;f[s>>2]=i;f[s+4>>2]=o;el(n,10642,s)|0;if(!r){b=l;return}hl(10164,2,1,n)|0;b=l;return}function ma(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0;u=b;b=b+16|0;r=u;t=e+80|0;l=f[(f[t>>2]|0)+16>>2]|0;n=Yi(1,56)|0;f[r>>2]=n;if(!n){c=0;b=u;return c|0}f[n+24>>2]=f[(f[t>>2]|0)+16>>2];f[n>>2]=f[e+92>>2];f[n+4>>2]=f[e+96>>2];f[n+8>>2]=f[e+100>>2];f[n+12>>2]=f[e+104>>2];f[n+16>>2]=f[e+112>>2];f[n+20>>2]=f[e+116>>2];f[n+52>>2]=0;n=f[e+12>>2]|0;t=f[r>>2]|0;f[t+32>>2]=f[n>>2];f[t+36>>2]=f[n+4>>2];f[t+40>>2]=f[n+8>>2];f[t+44>>2]=f[n+16>>2];s=Yi(f[t+24>>2]|0,1080)|0;f[t+48>>2]=s;t=f[r>>2]|0;s=t+48|0;e=f[s>>2]|0;if(!e){Ni(r);c=0;b=u;return c|0}if(!l){c=t;b=u;return c|0}o=n+5584|0;n=0;while(1){a=f[o>>2]|0;f[e+(n*1080|0)+4>>2]=f[a+(n*1080|0)>>2];r=a+(n*1080|0)+4|0;i=f[r>>2]|0;f[e+(n*1080|0)+8>>2]=i;f[e+(n*1080|0)+12>>2]=f[a+(n*1080|0)+8>>2];f[e+(n*1080|0)+16>>2]=f[a+(n*1080|0)+12>>2];f[e+(n*1080|0)+20>>2]=f[a+(n*1080|0)+16>>2];f[e+(n*1080|0)+24>>2]=f[a+(n*1080|0)+20>>2];if(i>>>0<33){Xl(e+(n*1080|0)+948|0,a+(n*1080|0)+944|0,i|0)|0;Xl(e+(n*1080|0)+816|0,a+(n*1080|0)+812|0,f[r>>2]|0)|0}i=f[a+(n*1080|0)+24>>2]|0;f[e+(n*1080|0)+28>>2]=i;f[e+(n*1080|0)+808>>2]=f[a+(n*1080|0)+804>>2];if((i|0)!=1){i=(f[r>>2]|0)*3|0;r=i+-2|0;if((r|0)<97&(i|0)>2)c=10}else{r=1;c=10}if((c|0)==10){c=0;i=0;do{f[e+(n*1080|0)+32+(i<<2)>>2]=f[a+(n*1080|0)+28+(i<<3)+4>>2];f[e+(n*1080|0)+420+(i<<2)>>2]=f[a+(n*1080|0)+28+(i<<3)>>2];i=i+1|0}while((i|0)!=(r|0))}f[e+(n*1080|0)+812>>2]=f[a+(n*1080|0)+808>>2];n=n+1|0;if((n|0)==(l|0))break;e=f[s>>2]|0}b=u;return t|0}function ga(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0;t=Yi(1,48)|0;if(!t){c=0;return c|0}o=e+196|0;n=f[o>>2]|0;s=n;c=f[s+4>>2]|0;e=t;f[e>>2]=f[s>>2];f[e+4>>2]=c;e=n+8|0;c=f[e+4>>2]|0;s=t+8|0;f[s>>2]=f[e>>2];f[s+4>>2]=c;s=n+16|0;c=f[s+4>>2]|0;e=t+16|0;f[e>>2]=f[s>>2];f[e+4>>2]=c;n=f[n+24>>2]|0;e=t+24|0;f[e>>2]=n;n=Xi(n*24|0)|0;c=t+28|0;f[c>>2]=n;if(!n){Ji(t);c=0;return c|0}r=f[(f[o>>2]|0)+28>>2]|0;if(!r){Ji(n);f[c>>2]=0}else Xl(n|0,r|0,(f[e>>2]|0)*24|0)|0;e=f[(f[o>>2]|0)+36>>2]|0;a=t+36|0;f[a>>2]=e;e=Yi(e,40)|0;s=t+40|0;f[s>>2]=e;if(!e){Ji(f[c>>2]|0);Ji(t);c=0;return c|0}n=f[(f[o>>2]|0)+40>>2]|0;if(!n){Ji(e);f[s>>2]=0;c=t;return c|0}if(!(f[a>>2]|0)){c=t;return c|0}n=f[n+20>>2]|0;f[e+20>>2]=n;n=Xi(n*24|0)|0;e=f[s>>2]|0;f[e+24>>2]=n;e:do{if(!n)n=0;else{i=n;n=0;while(1){r=f[(f[(f[o>>2]|0)+40>>2]|0)+(n*40|0)+24>>2]|0;if(!r){Ji(i);e=f[s>>2]|0;f[e+(n*40|0)+24>>2]=0}else{Xl(i|0,r|0,(f[e+(n*40|0)+20>>2]|0)*24|0)|0;e=f[s>>2]|0}r=f[(f[(f[o>>2]|0)+40>>2]|0)+(n*40|0)+4>>2]|0;f[e+(n*40|0)+4>>2]=r;r=Xi(r*24|0)|0;e=f[s>>2]|0;f[e+(n*40|0)+16>>2]=r;if(!r)break;i=f[(f[(f[o>>2]|0)+40>>2]|0)+(n*40|0)+16>>2]|0;if(!i){Ji(r);e=f[s>>2]|0;f[e+(n*40|0)+16>>2]=0}else{Xl(r|0,i|0,(f[e+(n*40|0)+4>>2]|0)*24|0)|0;e=f[s>>2]|0}f[e+(n*40|0)+32>>2]=0;f[e+(n*40|0)+36>>2]=0;n=n+1|0;if(n>>>0>=(f[a>>2]|0)>>>0){l=32;break}i=f[(f[(f[o>>2]|0)+40>>2]|0)+(n*40|0)+20>>2]|0;f[e+(n*40|0)+20>>2]=i;i=Xi(i*24|0)|0;e=f[s>>2]|0;f[e+(n*40|0)+24>>2]=i;if(!i)break e}if((l|0)==32)return t|0;if(n){Ji(f[e+24>>2]|0);Ji(f[(f[s>>2]|0)+16>>2]|0);if((n|0)!=1){e=1;do{Ji(f[(f[s>>2]|0)+(e*40|0)+24>>2]|0);Ji(f[(f[s>>2]|0)+(e*40|0)+16>>2]|0);e=e+1|0}while((e|0)!=(n|0))}e=f[s>>2]|0}Ji(e);Ji(f[c>>2]|0);Ji(t);c=0;return c|0}}while(0);if(n){Ji(f[e+24>>2]|0);if((n|0)!=1){e=1;do{Ji(f[(f[s>>2]|0)+(e*40|0)+24>>2]|0);e=e+1|0}while((e|0)!=(n|0))}e=f[s>>2]|0}Ji(e);Ji(f[c>>2]|0);Ji(t);c=0;return c|0}function va(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;if(!n){n=0;return n|0}i=ti()|0;c=e+84|0;f[c>>2]=i;if(!i){n=0;return n|0}ai(n,i);o=e+188|0;_o(f[o>>2]|0,27,r)|0;o=f[o>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(kc[f[i>>2]&63](e,t,r)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){n=e+80|0;ri(f[n>>2]|0);f[n>>2]=0;n=0;return n|0}}else wo(o);s=f[n+16>>2]|0;if(!s){n=1;return n|0}o=f[(f[c>>2]|0)+24>>2]|0;i=f[n+24>>2]|0;a=0;do{f[i+(a*52|0)+36>>2]=f[o+(a*52|0)+36>>2];n=o+(a*52|0)+44|0;f[i+(a*52|0)+44>>2]=f[n>>2];f[n>>2]=0;a=a+1|0}while(a>>>0<s>>>0);i=1;return i|0}function ya(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0;y=b;b=b+16|0;s=y+8|0;if(!n){Jr(r,1,10654,y)|0;v=0;b=y;return v|0}a=f[e+112>>2]|0;o=ue(f[e+116>>2]|0,a)|0;if(o>>>0<=i>>>0){f[s>>2]=i;f[s+4>>2]=o+-1;Jr(r,1,10692,s)|0;v=0;b=y;return v|0}v=(i>>>0)%(a>>>0)|0;g=(i>>>0)/(a>>>0)|0;s=f[e+100>>2]|0;o=ue(s,v)|0;l=f[e+92>>2]|0;o=o+l|0;f[n>>2]=o;m=e+80|0;a=f[m>>2]|0;c=f[a>>2]|0;o=o>>>0<c>>>0?c:o;f[n>>2]=o;l=(ue(s,v+1|0)|0)+l|0;v=n+8|0;f[v>>2]=l;s=f[a+8>>2]|0;l=l>>>0>s>>>0?s:l;f[v>>2]=l;v=f[e+104>>2]|0;s=ue(v,g)|0;c=f[e+96>>2]|0;s=s+c|0;p=n+4|0;f[p>>2]=s;d=f[a+4>>2]|0;s=s>>>0<d>>>0?d:s;f[p>>2]=s;c=(ue(v,g+1|0)|0)+c|0;g=n+12|0;f[g>>2]=c;v=f[a+12>>2]|0;c=c>>>0>v>>>0?v:c;f[g>>2]=c;g=n+24|0;v=n+16|0;p=f[v>>2]|0;if(p){d=f[a+24>>2]|0;h=o+-1|0;u=s+-1|0;l=l+-1|0;a=c+-1|0;o=0;s=f[g>>2]|0;while(1){c=f[d+(o*52|0)+40>>2]|0;f[s+40>>2]=c;A=f[s>>2]|0;T=(h+A|0)/(A|0)|0;f[s+16>>2]=T;_=f[s+4>>2]|0;x=(u+_|0)/(_|0)|0;f[s+20>>2]=x;A=(l+A|0)/(A|0)|0;_=(a+_|0)/(_|0)|0;w=Gl(1,0,c|0)|0;E=B;A=Wl(A|0,((A|0)<0)<<31>>31|0,-1,-1)|0;A=Wl(A|0,B|0,w|0,E|0)|0;A=Vl(A|0,B|0,c|0)|0;T=Wl(T|0,((T|0)<0)<<31>>31|0,-1,-1)|0;T=Wl(T|0,B|0,w|0,E|0)|0;T=Vl(T|0,B|0,c|0)|0;f[s+8>>2]=A-T;_=Wl(_|0,((_|0)<0)<<31>>31|0,-1,-1)|0;_=Wl(_|0,B|0,w|0,E|0)|0;_=Vl(_|0,B|0,c|0)|0;x=Wl(x|0,((x|0)<0)<<31>>31|0,-1,-1)|0;E=Wl(x|0,B|0,w|0,E|0)|0;c=Vl(E|0,B|0,c|0)|0;f[s+12>>2]=_-c;o=o+1|0;if(o>>>0>=p>>>0)break;else s=s+52|0}}u=e+84|0;a=f[u>>2]|0;if(a)ri(a);a=ti()|0;f[u>>2]=a;if(!a){A=0;b=y;return A|0}ai(n,a);f[e+60>>2]=i;s=e+188|0;_o(f[s>>2]|0,28,r)|0;s=f[s>>2]|0;l=bo(s)|0;a=Eo(s)|0;if(l){c=0;o=1;while(1){if(!o)o=0;else o=(kc[f[a>>2]&63](e,t,r)|0)!=0;c=c+1|0;if((c|0)==(l|0))break;else{a=a+4|0;o=o&1}}wo(s);if(!o){ri(f[m>>2]|0);f[m>>2]=0;A=0;b=y;return A|0}}else wo(s);a=f[v>>2]|0;if(!a){A=1;b=y;return A|0}l=f[(f[u>>2]|0)+24>>2]|0;s=f[g>>2]|0;c=0;while(1){f[s+(c*52|0)+36>>2]=f[l+(c*52|0)+36>>2];o=f[s+(c*52|0)+44>>2]|0;if(!o)o=l;else{Ji(o);o=f[(f[u>>2]|0)+24>>2]|0;s=f[g>>2]|0;a=f[v>>2]|0}A=o+(c*52|0)+44|0;f[s+(c*52|0)+44>>2]=f[A>>2];f[A>>2]=0;c=c+1|0;if(c>>>0>=a>>>0){a=1;break}else l=o}b=y;return a|0}function _a(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0;l=b;b=b+16|0;s=l;f[e+168>>2]=t;r=f[e+80>>2]|0;e:do{if((((r|0)!=0?(o=f[r+24>>2]|0,(o|0)!=0):0)?(i=f[e+12>>2]|0,(i|0)!=0):0)?(a=f[i+5584>>2]|0,(a|0)!=0):0){r=f[r+16>>2]|0;if(!r)r=1;else{i=0;while(1){if((f[a+(i*1080|0)+4>>2]|0)>>>0<=t>>>0)break;f[o+(i*52|0)+40>>2]=t;i=i+1|0;if(i>>>0>=r>>>0){r=1;break e}}Jr(n,1,10753,s)|0;r=0}}else r=0}while(0);b=l;return r|0}function ba(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0;V=b;b=b+48|0;B=V+32|0;U=V+24|0;D=V+16|0;O=V+8|0;H=V;M=e+204|0;r=f[M>>2]|0;L=e+116|0;C=e+112|0;I=ue(f[C>>2]|0,f[L>>2]|0)|0;N=(I|0)==1;if(!I){z=1;b=V;return z|0}F=e+200|0;S=e+12|0;R=e+164|0;k=e+8|0;P=r+20|0;T=r+24|0;A=0;r=0;s=0;e:while(1){if((f[F>>2]|0)!=(A|0)){z=5;break}w=A;A=A+1|0;x=ue(f[L>>2]|0,f[C>>2]|0)|0;f[O>>2]=A;f[O+4>>2]=x;Jr(n,4,10866,O)|0;f[S>>2]=0;x=f[M>>2]|0;f[x+12>>2]=f[(f[R>>2]|0)+(w*5640|0)+5588>>2];f[k>>2]=0;if(!(Yn(x,f[F>>2]|0,n)|0))break;i=f[M>>2]|0;if(f[(f[i+24>>2]|0)+16>>2]|0){o=0;do{a=f[(f[f[P>>2]>>2]|0)+20>>2]|0;if(N){f[a+(o*52|0)+32>>2]=f[(f[(f[T>>2]|0)+24>>2]|0)+(o*52|0)+44>>2];f[a+(o*52|0)+36>>2]=0}else{if(!(Xn(a+(o*52|0)|0)|0)){z=14;break e}i=f[M>>2]|0}o=o+1|0}while(o>>>0<(f[(f[i+24>>2]|0)+16>>2]|0)>>>0)}x=er(i)|0;if(!N){if(x>>>0>s>>>0){i=Qi(r,x)|0;if(!i){z=20;break}else{r=i;i=x}}else i=s;a=f[M>>2]|0;w=a+24|0;o=f[w>>2]|0;if(f[o+16>>2]|0){E=a+20|0;a=r;_=0;do{g=f[(f[f[E>>2]>>2]|0)+20>>2]|0;l=f[o+24>>2]|0;m=f[l+(_*52|0)+24>>2]|0;m=((m&7|0)!=0&1)+(m>>>3)|0;c=f[g+(_*52|0)+8>>2]|0;u=f[g+(_*52|0)>>2]|0;y=c-u|0;p=f[g+(_*52|0)+12>>2]|0;g=f[g+(_*52|0)+4>>2]|0;W=f[o>>2]|0;G=f[l+(_*52|0)>>2]|0;s=f[l+(_*52|0)+4>>2]|0;j=(G+~W+(f[o+8>>2]|0)|0)/(G|0)|0;v=j-y|0;o=u-((W+-1+G|0)/(G|0)|0)+(ue(j,g-(((f[o+4>>2]|0)+-1+s|0)/(s|0)|0)|0)|0)|0;o=(f[l+(_*52|0)+44>>2]|0)+(o<<2)|0;t:do{switch(((m|0)==3?4:m)|0){case 1:{s=(p|0)==(g|0);if(!(f[l+(_*52|0)+32>>2]|0)){if(s)break t;m=(c|0)==(u|0);u=p-g|0;p=0;while(1){if(!m){s=0;l=a;c=o;while(1){h[l>>0]=f[c>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+1|0;c=c+4|0}}a=a+y|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(u|0))break;else o=o+(v<<2)|0}}else{if(s)break t;m=(c|0)==(u|0);u=p-g|0;p=0;while(1){if(!m){s=0;l=a;c=o;while(1){h[l>>0]=f[c>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+1|0;c=c+4|0}}a=a+y|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(u|0))break;else o=o+(v<<2)|0}}break}case 2:{s=(p|0)==(g|0);if(!(f[l+(_*52|0)+32>>2]|0)){if(!s){m=(c|0)==(u|0);u=p-g|0;p=0;while(1){if(!m){s=0;l=a;c=o;while(1){d[l>>1]=f[c>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+2|0;c=c+4|0}}a=a+(y<<1)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(u|0))break;else o=o+(v<<2)|0}}}else if(!s){m=(c|0)==(u|0);u=p-g|0;p=0;while(1){if(!m){s=0;l=a;c=o;while(1){d[l>>1]=f[c>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+2|0;c=c+4|0}}a=a+(y<<1)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(u|0))break;else o=o+(v<<2)|0}}break}case 4:{if((p|0)!=(g|0)){m=(c|0)==(u|0);u=p-g|0;p=0;while(1){if(!m){s=0;l=a;c=o;while(1){f[l>>2]=f[c>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+4|0;c=c+4|0}}a=a+(y<<2)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(u|0))break;else o=o+(v<<2)|0}}break}default:{}}}while(0);_=_+1|0;o=f[w>>2]|0}while(_>>>0<(f[o+16>>2]|0)>>>0);a=f[M>>2]|0}if(!(tr(a,r,x)|0)){z=63;break}}else i=s;if(!(Ca(e,t,n)|0)){z=65;break}if(A>>>0>=I>>>0){z=67;break}else s=i}if((z|0)==5)Jr(n,1,10829,H)|0;else if((z|0)==14){Jr(n,1,10887,D)|0;if(!r){W=0;b=V;return W|0}Ji(r);W=0;b=V;return W|0}else if((z|0)==20){if(r)Ji(r);Jr(n,1,10925,U)|0;W=0;b=V;return W|0}else if((z|0)==63){Jr(n,1,10964,B)|0;Ji(r);W=0;b=V;return W|0}else if((z|0)==65){if(!r){W=0;b=V;return W|0}Ji(r);W=0;b=V;return W|0}else if((z|0)==67){if(!r){W=1;b=V;return W|0}Ji(r);W=1;b=V;return W|0}if(!r){W=0;b=V;return W|0}Ji(r);W=0;b=V;return W|0}function Ea(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;r=e+188|0;if(!(_o(f[r>>2]|0,29,n)|0)){t=0;return t|0}if(((d[e+88>>1]|0)+-3&65535)<4?(_o(f[r>>2]|0,30,n)|0)==0:0){t=0;return t|0}if(!(_o(f[r>>2]|0,31,n)|0)){t=0;return t|0}if(!(_o(f[r>>2]|0,32,n)|0)){t=0;return t|0}if(!(_o(f[r>>2]|0,33,n)|0)){t=0;return t|0}s=f[r>>2]|0;a=bo(s)|0;r=Eo(s)|0;if(!a)r=1;else{o=0;i=r;r=1;while(1){if(!r)r=0;else r=(kc[f[i>>2]&63](e,t,n)|0)!=0;r=r&1;o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}wo(s);t=r;return t|0}function wa(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;c=b;b=b+16|0;i=ti()|0;s=e+80|0;f[s>>2]=i;if(!i){Jr(r,1,11011,c)|0;t=0;b=c;return t|0}ai(n,i);o=f[n+24>>2]|0;if((o|0)!=0?(l=f[n+16>>2]|0,(l|0)!=0):0){a=0;do{n=o+(a*52|0)+44|0;i=f[n>>2]|0;if(i){f[(f[(f[s>>2]|0)+24>>2]|0)+(a*52|0)+44>>2]=i;f[n>>2]=0}a=a+1|0}while(a>>>0<l>>>0)}i=e+192|0;if(!(_o(f[i>>2]|0,34,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,35,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,36,r)|0)){t=0;b=c;return t|0}a=f[i>>2]|0;o=bo(a)|0;i=Eo(a)|0;if(o){s=0;n=1;while(1){if(!n)n=0;else n=(kc[f[i>>2]&63](e,t,r)|0)!=0;s=s+1|0;if((s|0)==(o|0))break;else{i=i+4|0;n=n&1}}wo(a);if(!n){t=0;b=c;return t|0}}else wo(a);i=e+188|0;if(!(_o(f[i>>2]|0,37,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,38,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,39,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,40,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,41,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,42,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,43,r)|0)){t=0;b=c;return t|0}n=e+88|0;if(((d[n>>1]|0)+-3&65535)<4){if(!(_o(f[i>>2]|0,44,r)|0)){t=0;b=c;return t|0}if((d[n>>1]|0)==4?(_o(f[i>>2]|0,45,r)|0)==0:0){t=0;b=c;return t|0}}if(!(_o(f[i>>2]|0,46,r)|0)){t=0;b=c;return t|0}if((f[e+108>>2]|0)!=0?(_o(f[i>>2]|0,47,r)|0)==0:0){t=0;b=c;return t|0}if((d[n>>1]&256)!=0?(_o(f[i>>2]|0,48,r)|0)==0:0){t=0;b=c;return t|0}if((f[e+196>>2]|0)!=0?(_o(f[i>>2]|0,49,r)|0)==0:0){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,50,r)|0)){t=0;b=c;return t|0}if(!(_o(f[i>>2]|0,51,r)|0)){t=0;b=c;return t|0}s=f[i>>2]|0;a=bo(s)|0;i=Eo(s)|0;if(!a)i=1;else{o=0;n=i;i=1;while(1){if(!i)i=0;else i=(kc[f[n>>2]&63](e,t,r)|0)!=0;i=i&1;o=o+1|0;if((o|0)==(a|0))break;else n=n+4|0}}wo(s);t=i;b=c;return t|0}function xa(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;var o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0;m=b;b=b+48|0;d=m+40|0;p=m+32|0;h=m+24|0;c=m+16|0;s=m+8|0;o=m;l=e+200|0;if((f[l>>2]|0)==(t|0)){u=ue(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[s>>2]=t+1;f[s+4>>2]=u;Jr(a,4,10866,s)|0;f[e+12>>2]=0;u=e+204|0;s=f[u>>2]|0;f[s+12>>2]=f[(f[e+164>>2]|0)+(t*5640|0)+5588>>2];f[e+8>>2]=0;if(Yn(s,f[l>>2]|0,a)|0){o=f[u>>2]|0;e:do{if(f[(f[o+24>>2]|0)+16>>2]|0){s=0;while(1){if(!(Xn((f[(f[f[o+20>>2]>>2]|0)+20>>2]|0)+(s*52|0)|0)|0))break;s=s+1|0;o=f[u>>2]|0;if(s>>>0>=(f[(f[o+24>>2]|0)+16>>2]|0)>>>0)break e}Jr(a,1,10887,h)|0;p=0;b=m;return p|0}}while(0);if(!(tr(o,n,r)|0)){Jr(a,1,10964,p)|0;p=0;b=m;return p|0}if(Ca(e,i,a)|0){p=1;b=m;return p|0}f[d>>2]=t;Jr(a,1,11101,d)|0;p=0;b=m;return p|0}}else Jr(a,1,10829,o)|0;f[c>>2]=t;Jr(a,1,11044,c)|0;p=0;b=m;return p|0}function Ta(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0;if(!e)return;i=e+5164|0;t=f[i>>2]|0;if(t){a=e+5160|0;n=f[a>>2]|0;if(n){r=0;while(1){t=f[t+(r<<3)>>2]|0;if(t){Ji(t);n=f[a>>2]|0}r=r+1|0;if(r>>>0>=n>>>0)break;t=f[i>>2]|0}t=f[i>>2]|0}f[a>>2]=0;Ji(t);f[i>>2]=0}t=e+5172|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+5584|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+5608|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+5604|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+5624|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0;f[e+5632>>2]=0;f[e+5628>>2]=0}s=e+5612|0;t=f[s>>2]|0;if(t){o=e+5616|0;n=f[o>>2]|0;if(n){a=0;while(1){r=t+12|0;i=f[r>>2]|0;if(i){Ji(i);f[r>>2]=0;n=f[o>>2]|0}a=a+1|0;if(a>>>0>=n>>>0)break;else t=t+20|0}t=f[s>>2]|0}Ji(t);f[s>>2]=0}t=e+5600|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}t=e+5592|0;n=f[t>>2]|0;if(!n)return;Ji(n);f[t>>2]=0;f[e+5596>>2]=0;return}function Aa(e,t,n){e=e|0;t=t|0;n=n|0;return 1}function Ma(e,t,n){e=e|0;t=t|0;n=n|0;return(f[e+8>>2]|0)==0&(f[e+188>>2]|0)!=0&(f[e+192>>2]|0)!=0&1|0}function Sa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Z=0;Z=b;b=b+224|0;K=Z+200|0;q=Z+192|0;W=Z+184|0;V=Z+176|0;z=Z+168|0;U=Z+160|0;H=Z+152|0;O=Z+144|0;F=Z+136|0;k=Z+128|0;N=Z+120|0;R=Z+112|0;S=Z+104|0;M=Z+96|0;A=Z+88|0;T=Z+80|0;I=Z+72|0;C=Z+64|0;x=Z+56|0;w=Z+48|0;E=Z+40|0;P=Z+32|0;p=Z+24|0;l=Z+16|0;s=Z+8|0;D=Z;G=Z+216|0;r=Z+204|0;L=Z+212|0;_=Z+208|0;Y=e+8|0;f[Y>>2]=1;e:do{if((Gr(t,G,2,n)|0)==2?(wr(G,r,2),(f[r>>2]|0)==65359):0){f[Y>>2]=2;u=Xr(t)|0;u=Wl(u|0,B|0,-2,-1)|0;c=B;X=e+196|0;i=f[X>>2]|0;f[i>>2]=u;f[i+4>>2]=c;i=D;f[i>>2]=u;f[i+4>>2]=c;Jr(n,4,15766,D)|0;i=f[X>>2]|0;c=f[i>>2]|0;u=i+24|0;r=f[u>>2]|0;o=i+32|0;a=f[o>>2]|0;do{if((r+1|0)>>>0>a>>>0){y=~~(+(a>>>0)+100.0)>>>0;f[o>>2]=y;r=i+28|0;i=Qi(f[r>>2]|0,y*24|0)|0;if(!i){Ji(f[r>>2]|0);f[r>>2]=0;f[o>>2]=0;f[u>>2]=0;Jr(n,1,15803,s)|0;break e}else{f[r>>2]=i;r=f[u>>2]|0;break}}else i=f[i+28>>2]|0}while(0);d[i+(r*24|0)>>1]=-177;v=Vl(0,c|0,32)|0;y=i+(r*24|0)+8|0;f[y>>2]=v;f[y+4>>2]=B;f[i+(r*24|0)+16>>2]=2;f[u>>2]=r+1;y=e+16|0;if((Gr(t,f[y>>2]|0,2,n)|0)!=2){Jr(n,1,8295,p)|0;n=0;b=Z;return n|0}wr(f[y>>2]|0,L,2);r=f[L>>2]|0;if((r|0)!=65424){v=e+20|0;m=0;a=0;g=0;t:while(1){if(r>>>0<65280){j=14;break}else s=784;while(1){i=f[s>>2]|0;o=(i|0)==0;if(o|(i|0)==(r|0))break;else s=s+12|0}if(o){Jr(n,2,15914,E)|0;l=2;n:while(1){do{if((Gr(t,f[y>>2]|0,2,n)|0)!=2){j=20;break t}wr(f[y>>2]|0,D,2);r=f[D>>2]|0}while(r>>>0<65280);s=784;while(1){i=f[s>>2]|0;if((i|0)==0|(i|0)==(r|0)){o=s;r=s;break}else s=s+12|0}if(!(f[r+4>>2]&f[Y>>2])){j=25;break t}if((i|0)>=65424){j=100;break}switch(i|0){case 0:break;default:{p=o;u=l;break n}}l=l+2|0}if((j|0)==100){j=0;switch(i|0){case 65424:{i=m;r=g;j=27;break t}default:{p=o;u=l}}}s=f[X>>2]|0;c=Xr(t)|0;c=c-u|0;o=s+24|0;r=f[o>>2]|0;i=s+32|0;l=f[i>>2]|0;if((r+1|0)>>>0>l>>>0){r=~~(+(l>>>0)+100.0)>>>0;f[i>>2]=r;s=s+28|0;r=Qi(f[s>>2]|0,r*24|0)|0;if(!r){a=s;r=s;j=32;break}f[s>>2]=r;i=r;r=f[o>>2]|0}else i=f[s+28>>2]|0;d[i+(r*24|0)>>1]=0;l=i+(r*24|0)+8|0;f[l>>2]=c;f[l+4>>2]=((c|0)<0)<<31>>31;f[i+(r*24|0)+16>>2]=u;f[o>>2]=r+1;r=f[p>>2]|0;f[L>>2]=r;if((r|0)==65424){i=m;r=g;break}else o=784;while(1){i=f[o>>2]|0;if((i|0)==0|(i|0)==(r|0))break;else o=o+12|0}}else o=s;g=(i|0)==65361?1:g;m=(i|0)==65362?1:m;a=(i|0)==65372?1:a;if(!(f[o+4>>2]&f[Y>>2])){j=38;break}if((Gr(t,f[y>>2]|0,2,n)|0)!=2){j=40;break}wr(f[y>>2]|0,_,2);i=(f[_>>2]|0)+-2|0;f[_>>2]=i;r=f[y>>2]|0;if(i>>>0>(f[v>>2]|0)>>>0){r=Qi(r,i)|0;if(!r){j=43;break}f[y>>2]=r;i=f[_>>2]|0;f[v>>2]=i}r=Gr(t,r,i,n)|0;if((r|0)!=(f[_>>2]|0)){j=46;break}if(!(Hc[f[o+8>>2]&63](e,f[y>>2]|0,r,n)|0)){j=48;break}l=f[X>>2]|0;c=f[o>>2]|0;u=Xr(t)|0;p=f[_>>2]|0;u=-4-p+u|0;p=p+4|0;o=l+24|0;r=f[o>>2]|0;i=l+32|0;s=f[i>>2]|0;if((r+1|0)>>>0>s>>>0){r=~~(+(s>>>0)+100.0)>>>0;f[i>>2]=r;s=l+28|0;r=Qi(f[s>>2]|0,r*24|0)|0;if(!r){a=s;r=s;j=53;break}f[s>>2]=r;i=r;r=f[o>>2]|0}else i=f[l+28>>2]|0;d[i+(r*24|0)>>1]=c;c=i+(r*24|0)+8|0;f[c>>2]=u;f[c+4>>2]=((u|0)<0)<<31>>31;f[i+(r*24|0)+16>>2]=p;f[o>>2]=r+1;if((Gr(t,f[y>>2]|0,2,n)|0)!=2){j=55;break}wr(f[y>>2]|0,L,2);r=f[L>>2]|0;if((r|0)==65424){i=m;r=g;break}}switch(j|0){case 14:{f[P>>2]=r;Jr(n,1,15863,P)|0;n=0;b=Z;return n|0}case 20:{Jr(n,1,8295,w)|0;j=34;break}case 25:{Jr(n,1,8339,x)|0;j=34;break}case 27:{f[L>>2]=65424;break}case 32:{Ji(f[r>>2]|0);f[a>>2]=0;f[i>>2]=0;f[o>>2]=0;Jr(n,1,15803,C)|0;j=34;break}case 38:{Jr(n,1,8339,T)|0;n=0;b=Z;return n|0}case 40:{Jr(n,1,8295,A)|0;n=0;b=Z;return n|0}case 43:{Ji(f[y>>2]|0);f[y>>2]=0;f[v>>2]=0;Jr(n,1,8427,M)|0;n=0;b=Z;return n|0}case 46:{Jr(n,1,8295,S)|0;n=0;b=Z;return n|0}case 48:{Jr(n,1,15985,R)|0;n=0;b=Z;return n|0}case 53:{Ji(f[r>>2]|0);f[a>>2]=0;f[i>>2]=0;f[o>>2]=0;Jr(n,1,15803,N)|0;n=0;b=Z;return n|0}case 55:{Jr(n,1,8295,k)|0;n=0;b=Z;return n|0}}if((j|0)==34){Jr(n,1,15930,I)|0;n=0;b=Z;return n|0}if(r){if(!i){Jr(n,1,16090,O)|0;n=0;b=Z;return n|0}if(!a){Jr(n,1,16136,H)|0;n=0;b=Z;return n|0}t:do{if(h[e+184>>0]&1){v=e+120|0;do{if(f[v>>2]|0){c=e+124|0;u=0;r=0;i=0;n:do{a=f[c>>2]|0;o=f[a+(u<<3)>>2]|0;r:do{if(o){s=f[a+(u<<3)+4>>2]|0;a=r>>>0<s>>>0;l=a?0:r-s|0;if((s|0)==(r|0)|a^1)r=l;else{o=a?o+r|0:o;r=s-r|0;while(1){if(r>>>0<4){j=70;break n}wr(o,D,4);a=r+-4|0;r=f[D>>2]|0;i=r+i|0;if(a>>>0<r>>>0)break;if((a|0)==(r|0)){r=l;break r}else{o=o+(r+4)|0;r=a-r|0}}r=r-a|0}}}while(0);u=u+1|0}while(u>>>0<(f[v>>2]|0)>>>0);if((j|0)==70){Jr(n,1,16182,U)|0;break}if(!r)j=77;else Jr(n,1,16213,z)|0}else{i=0;j=77}}while(0);n:do{if((j|0)==77){a=Xi(i)|0;p=e+144|0;f[p>>2]=a;if(!a){Jr(n,1,13302,V)|0;break}m=e+132|0;f[m>>2]=i;o=f[v>>2]|0;g=e+124|0;do{if(o){r=f[g>>2]|0;a=r;u=0;c=0;i=0;r:while(1){s=f[a+(u<<3)>>2]|0;if(!s)s=c;else{a=f[a+(u<<3)+4>>2]|0;r=(f[p>>2]|0)+i|0;i:do{if(c>>>0<a>>>0){Xl(r|0,s|0,c|0)|0;i=i+c|0;if((a|0)==(c|0)){s=0;break}l=s+c|0;r=a-c|0;while(1){if(r>>>0<4){j=88;break r}wr(l,G,4);s=l+4|0;o=r+-4|0;a=f[G>>2]|0;r=(f[p>>2]|0)+i|0;if(o>>>0<a>>>0){a=s;break}Xl(r|0,s|0,a|0)|0;r=f[G>>2]|0;i=r+i|0;if((o|0)==(r|0)){s=0;break i}else{l=l+(r+4)|0;r=o-r|0}}Xl(r|0,a|0,o|0)|0;s=(f[G>>2]|0)-o|0;i=o+i|0}else{Xl(r|0,s|0,a|0)|0;s=c-a|0;i=a+i|0}}while(0);Ji(f[(f[g>>2]|0)+(u<<3)>>2]|0);a=f[g>>2]|0;f[a+(u<<3)>>2]=0;f[a+(u<<3)+4>>2]=0;o=f[v>>2]|0;r=a}u=u+1|0;if(u>>>0>=o>>>0){j=94;break}else c=s}if((j|0)==88){Jr(n,1,16182,W)|0;break n}else if((j|0)==94){a=f[p>>2]|0;i=f[m>>2]|0;break}}else r=f[g>>2]|0}while(0);f[e+128>>2]=a;f[e+152>>2]=i;f[v>>2]=0;Ji(r);f[g>>2]=0;break t}}while(0);Jr(n,1,16236,q)|0;n=0;b=Z;return n|0}}while(0);Jr(n,4,16262,K)|0;K=Xr(t)|0;n=(f[X>>2]|0)+8|0;f[n>>2]=K+-2;f[n+4>>2]=0;f[Y>>2]=8;n=1;b=Z;return n|0}}Jr(n,1,16044,F)|0;n=0;b=Z;return n|0}}while(0);Jr(n,1,15839,l)|0;n=0;b=Z;return n|0}function Ra(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0;C=b;b=b+16|0;L=C;k=f[e+80>>2]|0;P=e+88|0;M=ue(f[e+112>>2]|0,f[e+116>>2]|0)|0;m=f[k+16>>2]|0;d=m*1080|0;p=f[e+12>>2]|0;m=ue(m<<2,m)|0;e:do{if(M){g=p+5604|0;v=p+5620|0;y=p+5612|0;_=p+5616|0;E=p+5632|0;w=p+5624|0;x=p+5584|0;S=0;R=f[e+164>>2]|0;t:while(1){s=R+5584|0;T=f[s>>2]|0;Xl(R|0,p|0,5640)|0;t=R+5636|0;h[t>>0]=h[t>>0]&-4;f[R+5168>>2]=0;t=R+5604|0;f[t>>2]=0;l=R+5620|0;f[l>>2]=0;A=R+5612|0;f[A>>2]=0;c=R+5632|0;f[c>>2]=0;u=R+5624|0;f[u>>2]=0;f[s>>2]=T;if(f[g>>2]|0){r=Xi(m)|0;f[t>>2]=r;if(!r){t=0;r=25;break}Xl(r|0,f[g>>2]|0,m|0)|0}t=(f[v>>2]|0)*20|0;r=Xi(t)|0;f[A>>2]=r;if(!r){t=0;r=25;break}Xl(r|0,f[y>>2]|0,t|0)|0;t=f[_>>2]|0;if(t){a=0;o=f[A>>2]|0;s=f[y>>2]|0;while(1){i=s+12|0;if(f[i>>2]|0){t=s+16|0;r=Xi(f[t>>2]|0)|0;f[o+12>>2]=r;if(!r){t=0;r=25;break t}Xl(r|0,f[i>>2]|0,f[t>>2]|0)|0;t=f[_>>2]|0}f[l>>2]=(f[l>>2]|0)+1;a=a+1|0;if(a>>>0>=t>>>0)break;else{o=o+20|0;s=s+20|0}}}t=(f[E>>2]|0)*20|0;r=Xi(t)|0;f[u>>2]=r;if(!r){t=0;r=25;break}Xl(r|0,f[w>>2]|0,t|0)|0;f[c>>2]=f[E>>2];a=f[E>>2]|0;if(a){o=0;r=f[u>>2]|0;i=f[w>>2]|0;while(1){t=f[i+8>>2]|0;if(t)f[r+8>>2]=(f[A>>2]|0)+(((t-(f[y>>2]|0)|0)/20|0)*20|0);t=f[i+12>>2]|0;if(t)f[r+12>>2]=(f[A>>2]|0)+(((t-(f[y>>2]|0)|0)/20|0)*20|0);o=o+1|0;if(o>>>0>=a>>>0)break;else{r=r+20|0;i=i+20|0}}}Xl(T|0,f[x>>2]|0,d|0)|0;S=S+1|0;if(S>>>0>=M>>>0)break e;else R=R+5640|0}if((r|0)==25){b=C;return t|0}}}while(0);r=zn(1)|0;t=e+204|0;f[t>>2]=r;if(!r){n=0;b=C;return n|0}if(Wn(r,k,P)|0){n=1;b=C;return n|0}qn(f[t>>2]|0);f[t>>2]=0;Jr(n,1,8839,L)|0;n=0;b=C;return n|0}function ka(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0;w=b;b=b+128|0;_=w+120|0;y=w+112|0;v=w+104|0;g=w+96|0;m=w+88|0;p=w+80|0;d=w+72|0;h=w+64|0;u=w+56|0;c=w+48|0;l=w+40|0;s=w+32|0;o=w+24|0;a=w+16|0;i=w+8|0;r=w;if(!e){b=w;return}hl(12191,17,1,n)|0;f[r>>2]=f[e>>2];el(n,12209,r)|0;f[i>>2]=f[e+4>>2];el(n,12222,i)|0;f[a>>2]=f[e+8>>2];el(n,12234,a)|0;f[o>>2]=f[e+16>>2];el(n,12251,o)|0;if((t|0)>0){a=e+5584|0;o=0;do{i=f[a>>2]|0;f[s>>2]=o;el(n,12262,s)|0;f[l>>2]=f[i+(o*1080|0)>>2];el(n,12276,l)|0;e=i+(o*1080|0)+4|0;f[c>>2]=f[e>>2];el(n,12290,c)|0;f[u>>2]=f[i+(o*1080|0)+8>>2];el(n,12313,u)|0;f[h>>2]=f[i+(o*1080|0)+12>>2];el(n,12329,h)|0;f[d>>2]=f[i+(o*1080|0)+16>>2];el(n,12345,d)|0;f[p>>2]=f[i+(o*1080|0)+20>>2];el(n,12362,p)|0;hl(12377,23,1,n)|0;if(f[e>>2]|0){r=0;do{x=f[i+(o*1080|0)+944+(r<<2)>>2]|0;f[m>>2]=f[i+(o*1080|0)+812+(r<<2)>>2];f[m+4>>2]=x;el(n,12401,m)|0;r=r+1|0}while(r>>>0<(f[e>>2]|0)>>>0)}tl(10,n)|0;x=i+(o*1080|0)+24|0;f[g>>2]=f[x>>2];el(n,12410,g)|0;f[v>>2]=f[i+(o*1080|0)+804>>2];el(n,12425,v)|0;hl(12442,20,1,n)|0;if((f[x>>2]|0)!=1){e=(f[e>>2]|0)*3|0;if((e|0)>2){e=e+-2|0;E=8}}else{e=1;E=8}if((E|0)==8){E=0;r=0;do{x=f[i+(o*1080|0)+28+(r<<3)>>2]|0;f[y>>2]=f[i+(o*1080|0)+28+(r<<3)+4>>2];f[y+4>>2]=x;el(n,12401,y)|0;r=r+1|0}while((r|0)!=(e|0))}tl(10,n)|0;f[_>>2]=f[i+(o*1080|0)+808>>2];el(n,12463,_)|0;hl(12480,5,1,n)|0;o=o+1|0}while((o|0)!=(t|0))}hl(10321,4,1,n)|0;b=w;return}function Pa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0;S=b;b=b+80|0;_=S+32|0;E=S+24|0;T=S+16|0;x=S+8|0;d=S+64|0;w=S+60|0;h=S+56|0;m=S+52|0;v=S+48|0;g=S+44|0;y=S+40|0;p=S+36|0;f[d>>2]=1;r=Xi(1e3)|0;if(!r){Jr(n,1,12127,S)|0;n=0;b=S;return n|0}A=e+116|0;M=e+112|0;l=e+204|0;c=e+84|0;u=e+8|0;i=1e3;s=0;while(1){if(!(la(e,w,h,m,v,g,y,p,d,t,n)|0)){a=5;break}if(!(f[d>>2]|0)){a=17;break}o=f[h>>2]|0;if(o>>>0>i>>>0){i=Qi(r,o)|0;if(!i){a=9;break}else{r=i;a=o}}else a=i;i=f[w>>2]|0;if(!(ca(e,i,r,o,t,n)|0)){a=11;break}i=i+1|0;o=ue(f[M>>2]|0,f[A>>2]|0)|0;f[E>>2]=i;f[E+4>>2]=o;Jr(n,4,11986,E)|0;o=f[l>>2]|0;if(!(lo(f[(f[f[o+20>>2]>>2]|0)+20>>2]|0,f[o+24>>2]|0,r,f[(f[c>>2]|0)+24>>2]|0)|0)){a=13;break}f[_>>2]=i;Jr(n,4,12016,_)|0;o=Yr(t)|0;if((o|0)==0&(B|0)==0?(f[u>>2]|0)==64:0){a=17;break}s=s+1|0;if((s|0)==(ue(f[M>>2]|0,f[A>>2]|0)|0)){a=17;break}else i=a}if((a|0)==5){Ji(r);n=0;b=S;return n|0}else if((a|0)==9){Ji(r);M=ue(f[M>>2]|0,f[A>>2]|0)|0;f[x>>2]=(f[w>>2]|0)+1;f[x+4>>2]=M;Jr(n,1,11946,x)|0;n=0;b=S;return n|0}else if((a|0)==11){Ji(r);M=ue(f[M>>2]|0,f[A>>2]|0)|0;f[T>>2]=i+1;f[T+4>>2]=M;Jr(n,1,12162,T)|0;n=0;b=S;return n|0}else if((a|0)==13){Ji(r);n=0;b=S;return n|0}else if((a|0)==17){Ji(r);n=1;b=S;return n|0}return 0}function La(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0;L=b;b=b+96|0;T=L+56|0;R=L+48|0;x=L+40|0;A=L+32|0;k=L+24|0;l=L+16|0;s=L+8|0;g=L+92|0;S=L+88|0;m=L+84|0;y=L+80|0;E=L+76|0;_=L+72|0;w=L+68|0;v=L+64|0;f[g>>2]=1;r=Xi(1e3)|0;if(!r){Jr(n,1,11880,L)|0;P=0;b=L;return P|0}M=e+196|0;a=f[M>>2]|0;i=f[a+40>>2]|0;e:do{if(!i){i=ue(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[a+36>>2]=i;i=Yi(i,40)|0;a=f[M>>2]|0;f[a+40>>2]=i;t:do{if(i){if(f[a+36>>2]|0){o=0;do{f[i+(o*40|0)+28>>2]=100;f[i+(o*40|0)+20>>2]=0;p=Yi(100,24)|0;a=f[M>>2]|0;i=f[a+40>>2]|0;f[i+(o*40|0)+24>>2]=p;o=o+1|0;if(!p)break t}while(o>>>0<(f[a+36>>2]|0)>>>0)}a=f[e+60>>2]|0;if(!i)break e;else{P=12;break e}}}while(0);Ji(r);P=0;b=L;return P|0}else{a=f[e+60>>2]|0;P=12}}while(0);if((P|0)==12)if(f[i+16>>2]|0){if(!(f[i+(a*40|0)+4>>2]|0)){p=e+64|0;p=Wl(f[p>>2]|0,f[p+4>>2]|0,2,0)|0;if(!(kr(t,p,B,n)|0)){Jr(n,1,11918,s)|0;Ji(r);P=0;b=L;return P|0}}else{p=f[i+(a*40|0)+16>>2]|0;p=Wl(f[p>>2]|0,f[p+4>>2]|0,2,0)|0;if(!(kr(t,p,B,n)|0)){Jr(n,1,11918,l)|0;Ji(r);P=0;b=L;return P|0}}i=e+8|0;if((f[i>>2]|0)==256)f[i>>2]=8}e:do{if(la(e,S,m,y,E,_,w,v,g,t,n)|0){d=e+116|0;p=e+112|0;c=e+204|0;u=e+84|0;h=a+1|0;i=1e3;while(1){if(!(f[g>>2]|0))break;l=f[m>>2]|0;if(l>>>0>i>>>0){i=Qi(r,l)|0;if(!i){P=26;break}else{r=i;s=l}}else s=i;o=f[S>>2]|0;if(!(ca(e,o,r,l,t,n)|0)){P=28;break}i=o+1|0;l=ue(f[p>>2]|0,f[d>>2]|0)|0;f[A>>2]=i;f[A+4>>2]=l;Jr(n,4,11986,A)|0;l=f[c>>2]|0;if(!(lo(f[(f[f[l+20>>2]>>2]|0)+20>>2]|0,f[l+24>>2]|0,r,f[(f[u>>2]|0)+24>>2]|0)|0)){P=30;break}f[x>>2]=i;Jr(n,4,12016,x)|0;if((o|0)==(a|0)){P=32;break}f[T>>2]=i;f[T+4>>2]=h;Jr(n,2,12060,T)|0;if(!(la(e,S,m,y,E,_,w,v,g,t,n)|0))break e;else i=s}if((P|0)==26){Ji(r);P=ue(f[p>>2]|0,f[d>>2]|0)|0;f[k>>2]=(f[S>>2]|0)+1;f[k+4>>2]=P;Jr(n,1,11946,k)|0;P=0;b=L;return P|0}else if((P|0)==28){Ji(r);P=0;b=L;return P|0}else if((P|0)==30){Ji(r);P=0;b=L;return P|0}else if((P|0)==32){P=(f[M>>2]|0)+8|0;P=Wl(f[P>>2]|0,f[P+4>>2]|0,2,0)|0;if(!(kr(t,P,B,n)|0)){Jr(n,1,11918,R)|0;Ji(r);P=0;b=L;return P|0}}Ji(r);P=1;b=L;return P|0}}while(0);Ji(r);P=0;b=L;return P|0}function Ca(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0;I=b;b=b+32|0;k=I+16|0;y=I+8|0;l=I;R=I+20|0;P=f[e+40>>2]|0;C=e+36|0;u=f[C>>2]|0;h=e+204|0;s=f[h>>2]|0;f[s+16>>2]=0;S=e+8|0;f[S>>2]=0;f[R>>2]=0;Er(u,65424,2);Er(u+2|0,10,2);L=e+200|0;Er(u+4|0,f[L>>2]|0,2);A=e+12|0;Er(u+10|0,f[A>>2]|0,1);M=e+164|0;Er(u+11|0,f[(f[M>>2]|0)+((f[L>>2]|0)*5640|0)+5588>>2]|0,1);f[R>>2]=12;a=u+12|0;r=P+-12|0;c=e+88|0;if(((d[c>>1]|0)+-3&65535)>=4?(i=f[L>>2]|0,o=f[M>>2]|0,(f[o+(i*5640|0)+420>>2]|0)!=0):0){f[R>>2]=0;io(f[(f[e+80>>2]|0)+16>>2]|0,o,i,a,R);T=f[R>>2]|0;i=T+12|0;a=u+i|0;r=r-T|0}else i=12;f[R>>2]=0;Er(a,65427,2);f[s+4>>2]=f[S>>2];T=f[A>>2]|0;f[s+8>>2]=T;if(!T)f[(f[f[s+20>>2]>>2]|0)+840>>2]=0;f[R>>2]=0;if(!(Qn(s,f[L>>2]|0,a+2|0,R,r+-4|0,0)|0)){Jr(n,1,11860,l)|0;t=0;b=I;return t|0}r=(f[R>>2]|0)+2|0;f[R>>2]=r;r=r+i|0;Er(u+6|0,r,4);if(((d[c>>1]|0)+-3&65535)<4){T=e+28|0;Er(f[T>>2]|0,f[L>>2]|0,1);x=(f[T>>2]|0)+1|0;f[T>>2]=x;Er(x,r,4);f[T>>2]=(f[T>>2]|0)+4}i=u+r|0;T=P-r|0;E=f[h>>2]|0;w=e+88|0;g=f[M>>2]|0;v=f[L>>2]|0;c=so(w,0,v)|0;x=e+8|0;f[A>>2]=(f[A>>2]|0)+1;e:do{if(c>>>0>1){u=E+4|0;h=E+8|0;p=E+20|0;m=e+28|0;o=i;i=T;r=0;l=1;while(1){f[x>>2]=l;f[R>>2]=0;Er(o,65424,2);Er(o+2|0,10,2);Er(o+4|0,f[L>>2]|0,2);Er(o+10|0,f[A>>2]|0,1);Er(o+11|0,f[(f[M>>2]|0)+((f[L>>2]|0)*5640|0)+5588>>2]|0,1);f[R>>2]=0;Er(o+12|0,65427,2);f[u>>2]=f[S>>2];s=f[A>>2]|0;f[h>>2]=s;if(!s)f[(f[f[p>>2]>>2]|0)+840>>2]=0;f[R>>2]=0;if(!(Qn(E,f[L>>2]|0,o+14|0,R,i+-16|0,0)|0))break;N=f[R>>2]|0;F=N+2|0;f[R>>2]=F;s=N+14|0;a=o+s|0;r=r+12+F|0;i=i+-12+(-2-N)|0;Er(o+6|0,s,4);if(((d[w>>1]|0)+-3&65535)<4){Er(f[m>>2]|0,f[L>>2]|0,1);F=(f[m>>2]|0)+1|0;f[m>>2]=F;Er(F,s,4);f[m>>2]=(f[m>>2]|0)+4}f[A>>2]=(f[A>>2]|0)+1;l=l+1|0;if(l>>>0>=c>>>0){_=12;break e}else o=a}Jr(n,1,11860,y)|0}else{a=i;i=T;r=0;_=12}}while(0);e:do{if((_|0)==12){p=g+(v*5640|0)+420|0;t:do{if(f[p>>2]|0){m=E+16|0;g=E+4|0;v=E+8|0;y=E+20|0;h=e+28|0;u=1;n:while(1){f[m>>2]=u;c=so(w,u,f[L>>2]|0)|0;if(c){l=0;while(1){f[x>>2]=l;f[R>>2]=0;Er(a,65424,2);Er(a+2|0,10,2);Er(a+4|0,f[L>>2]|0,2);Er(a+10|0,f[A>>2]|0,1);Er(a+11|0,f[(f[M>>2]|0)+((f[L>>2]|0)*5640|0)+5588>>2]|0,1);f[R>>2]=0;Er(a+12|0,65427,2);f[g>>2]=f[S>>2];F=f[A>>2]|0;f[v>>2]=F;if(!F)f[(f[f[y>>2]>>2]|0)+840>>2]=0;f[R>>2]=0;if(!(Qn(E,f[L>>2]|0,a+14|0,R,i+-16|0,0)|0))break n;F=f[R>>2]|0;o=F+2|0;f[R>>2]=o;r=r+12+o|0;o=F+14|0;s=a+o|0;i=i+-12+(-2-F)|0;Er(a+6|0,o,4);if(((d[w>>1]|0)+-3&65535)<4){Er(f[h>>2]|0,f[L>>2]|0,1);F=(f[h>>2]|0)+1|0;f[h>>2]=F;Er(F,o,4);f[h>>2]=(f[h>>2]|0)+4}f[A>>2]=(f[A>>2]|0)+1;l=l+1|0;if(l>>>0>=c>>>0){a=s;break}else a=s}}u=u+1|0;if(u>>>0>(f[p>>2]|0)>>>0)break t}Jr(n,1,11860,k)|0;break e}}while(0);F=r-T+P|0;if((Wr(t,f[C>>2]|0,F,n)|0)!=(F|0)){F=0;b=I;return F|0}f[L>>2]=(f[L>>2]|0)+1;F=1;b=I;return F|0}}while(0);F=0;b=I;return F|0}function Ia(e,t,n){e=e|0;t=t|0;n=n|0;e=e+44|0;Er(f[e>>2]|0,65497,2);if((Wr(t,f[e>>2]|0,2,n)|0)!=2){t=0;return t|0}t=(qr(t,n)|0)!=0&1;return t|0}function Na(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;a=(f[e+32>>2]|0)*5|0;s=e+16|0;s=Wl(f[s>>2]|0,f[s+4>>2]|0,6,0)|0;o=B;r=Xr(t)|0;i=B;if(!(Zr(t,s,o,n)|0)){s=0;return s|0}if((Wr(t,f[e+24>>2]|0,a,n)|0)!=(a|0)){s=0;return s|0}s=(Zr(t,r,i,n)|0)!=0&1;return s|0}function Fa(e,t,n){e=e|0;t=t|0;n=n|0;e=f[e+196>>2]|0;if(!e)return 1;t=Xr(t)|0;n=e;n=zl(t|0,B|0,f[n>>2]|0,f[n+4>>2]|0)|0;t=e+16|0;f[t>>2]=n;f[t+4>>2]=B;return 1}function Oa(e,t,n){e=e|0;t=t|0;n=n|0;n=e+204|0;qn(f[n>>2]|0);f[n>>2]=0;n=e+24|0;t=f[n>>2]|0;if(t){Ji(t);f[n>>2]=0;f[e+28>>2]=0}n=e+36|0;t=f[n>>2]|0;if(!t){e=e+40|0;f[e>>2]=0;return 1}Ji(t);f[n>>2]=0;e=e+40|0;f[e>>2]=0;return 1}function Ha(e,t,n){e=e|0;t=t|0;n=n|0;n=e+44|0;t=f[n>>2]|0;if(t){Ji(t);f[n>>2]=0}f[e+48>>2]=0;return 1}function Da(e,t,n){e=e|0;t=t|0;n=n|0;return 1}function Ua(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=b;b=b+32|0;r=(f[e+8>>2]|0)==0&(f[e+188>>2]|0)!=0&(f[e+192>>2]|0)!=0&1;t=(f[(f[(f[e+164>>2]|0)+5584>>2]|0)+4>>2]|0)+-1|0;if(t>>>0>31){Jr(n,1,11790,i)|0;n=0;b=i;return n|0}t=1<<t;if((f[e+100>>2]|0)>>>0<t>>>0){Jr(n,1,11790,i+8|0)|0;n=0;b=i;return n|0}if((f[e+104>>2]|0)>>>0>=t>>>0){n=r;b=i;return n|0}Jr(n,1,11790,i+16|0)|0;n=0;b=i;return n|0}function Ba(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;if((d[e+88>>1]&-32256)<<16>>16!=-32256){s=1;return s|0}o=ue(f[e+112>>2]|0,f[e+116>>2]|0)|0;if(!o){s=1;return s|0}a=e+80|0;s=0;n=1;i=f[e+164>>2]|0;while(1){if((f[i+16>>2]|0)==2){n=(f[i+5608>>2]|0)!=0&n;e=f[(f[a>>2]|0)+16>>2]|0;if(e){r=0;t=f[i+5584>>2]|0;while(1){n=(f[t+20>>2]&1^1)&n;r=r+1|0;if(r>>>0>=e>>>0)break;else t=t+1080|0}}}s=s+1|0;if((s|0)==(o|0))break;else i=i+5640|0}return n|0}function za(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;a=e+88|0;o=e+32|0;s=f[e+80>>2]|0;l=ue(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[o>>2]=0;if(!l)return 1;r=f[e+164>>2]|0;i=0;while(1){Fn(s,a,i);t=r+420|0;n=0;e=0;do{c=so(a,e,i)|0;f[o>>2]=(f[o>>2]|0)+c;n=c+n|0;e=e+1|0}while(e>>>0<=(f[t>>2]|0)>>>0);f[r+5588>>2]=n;i=i+1|0;if((i|0)==(l|0))break;else r=r+5640|0}return 1}function Va(e,t,n){e=e|0;t=t|0;n=n|0;e=f[e+44>>2]|0;Er(e,65359,2);return(Wr(t,e,2,n)|0)==2|0}function ja(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0;d=b;b=b+16|0;o=d;s=f[e+80>>2]|0;u=s+16|0;l=(f[u>>2]|0)*3|0;h=l+40|0;r=f[s+24>>2]|0;a=e+48|0;c=e+44|0;i=f[c>>2]|0;do{if(h>>>0>(f[a>>2]|0)>>>0){i=Qi(i,h)|0;if(i){f[c>>2]=i;f[a>>2]=h;break}Ji(f[c>>2]|0);f[c>>2]=0;f[a>>2]=0;Jr(n,1,11752,o)|0;t=0;b=d;return t|0}}while(0);Er(i,65361,2);Er(i+2|0,l+38|0,2);Er(i+4|0,m[e+88>>1]|0,2);Er(i+6|0,f[s+8>>2]|0,4);Er(i+10|0,f[s+12>>2]|0,4);Er(i+14|0,f[s>>2]|0,4);Er(i+18|0,f[s+4>>2]|0,4);Er(i+22|0,f[e+100>>2]|0,4);Er(i+26|0,f[e+104>>2]|0,4);Er(i+30|0,f[e+92>>2]|0,4);Er(i+34|0,f[e+96>>2]|0,4);Er(i+38|0,f[u>>2]|0,2);if(f[u>>2]|0){a=0;i=i+40|0;while(1){Er(i,(f[r+24>>2]|0)+-1+(f[r+32>>2]<<7)|0,1);Er(i+1|0,f[r>>2]|0,1);Er(i+2|0,f[r+4>>2]|0,1);a=a+1|0;if(a>>>0>=(f[u>>2]|0)>>>0)break;else{i=i+3|0;r=r+52|0}}}t=(Wr(t,f[c>>2]|0,h,n)|0)==(h|0)&1;b=d;return t|0}function Ga(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0;g=b;b=b+32|0;m=g+16|0;p=g+8|0;s=g;d=g+20|0;l=e+200|0;c=f[l>>2]|0;u=e+164|0;h=f[u>>2]|0;r=f[h+(c*5640|0)+5584>>2]|0;if(!(f[r>>2]&1))a=5;else a=(f[r+4>>2]|0)+5|0;o=a+9|0;f[d>>2]=o;i=e+48|0;e=e+44|0;r=f[e>>2]|0;do{if(o>>>0>(f[i>>2]|0)>>>0){r=Qi(r,o)|0;if(r){f[e>>2]=r;f[i>>2]=o;break}Ji(f[e>>2]|0);f[e>>2]=0;f[i>>2]=0;Jr(n,1,11687,s)|0;m=0;b=g;return m|0}}while(0);Er(r,65362,2);Er(r+2|0,a+7|0,2);Er(r+4|0,f[h+(c*5640|0)>>2]|0,1);Er(r+5|0,f[h+(c*5640|0)+4>>2]|0,1);Er(r+6|0,f[h+(c*5640|0)+8>>2]|0,2);Er(r+8|0,f[h+(c*5640|0)+16>>2]|0,1);f[d>>2]=a;if(!(oo(f[u>>2]|0,f[l>>2]|0,r+9|0,d,n)|0)){Jr(n,1,11726,p)|0;m=0;b=g;return m|0}if(!(f[d>>2]|0)){m=(Wr(t,f[e>>2]|0,o,n)|0)==(o|0)&1;b=g;return m|0}else{Jr(n,1,11726,m)|0;m=0;b=g;return m|0}return 0}function Wa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0;p=b;b=b+32|0;d=p+16|0;h=p+8|0;s=p;c=p+20|0;l=e+200|0;u=e+164|0;r=f[(f[u>>2]|0)+((f[l>>2]|0)*5640|0)+5584>>2]|0;i=f[r+24>>2]|0;if((i|0)==1)r=1;else r=((f[r+4>>2]|0)*3|0)+-2|0;a=(i|0)==0?r+1|0:r<<1|1;o=a+4|0;f[c>>2]=o;i=e+48|0;e=e+44|0;r=f[e>>2]|0;do{if(o>>>0>(f[i>>2]|0)>>>0){r=Qi(r,o)|0;if(r){f[e>>2]=r;f[i>>2]=o;break}Ji(f[e>>2]|0);f[e>>2]=0;f[i>>2]=0;Jr(n,1,11622,s)|0;d=0;b=p;return d|0}}while(0);Er(r,65372,2);Er(r+2|0,a+2|0,2);f[c>>2]=a;if(!(ao(f[u>>2]|0,f[l>>2]|0,0,r+4|0,c,n)|0)){Jr(n,1,11661,h)|0;d=0;b=p;return d|0}if(!(f[c>>2]|0)){d=(Wr(t,f[e>>2]|0,o,n)|0)==(o|0)&1;b=p;return d|0}else{Jr(n,1,11661,d)|0;d=0;b=p;return d|0}return 0}function qa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0;w=b;b=b+16|0;_=w;g=w+4|0;d=e+80|0;r=f[(f[d>>2]|0)+16>>2]|0;if(r>>>0<=1){E=1;b=w;return E|0}v=e+164|0;y=e+200|0;m=e+48|0;h=e+44|0;u=1;while(1){o=f[v>>2]|0;l=f[y>>2]|0;a=f[o+(l*5640|0)+5584>>2]|0;s=f[a+(u*1080|0)>>2]|0;e:do{if((((((f[a>>2]|0)==(s|0)?(p=f[a+4>>2]|0,(p|0)==(f[a+(u*1080|0)+4>>2]|0)):0)?(f[a+8>>2]|0)==(f[a+(u*1080|0)+8>>2]|0):0)?(f[a+12>>2]|0)==(f[a+(u*1080|0)+12>>2]|0):0)?(f[a+16>>2]|0)==(f[a+(u*1080|0)+16>>2]|0):0)?(f[a+20>>2]|0)==(f[a+(u*1080|0)+20>>2]|0):0){if(p){e=0;do{if((f[a+812+(e<<2)>>2]|0)!=(f[a+(u*1080|0)+812+(e<<2)>>2]|0)){E=13;break e}if((f[a+944+(e<<2)>>2]|0)!=(f[a+(u*1080|0)+944+(e<<2)>>2]|0)){E=13;break e}e=e+1|0}while(e>>>0<p>>>0)}}else E=13}while(0);if((E|0)==13){E=0;if(!(s&1))e=5;else e=(f[a+(u*1080|0)+4>>2]|0)+5|0;c=e+(r>>>0<257?6:7)|0;i=f[h>>2]|0;if(c>>>0>(f[m>>2]|0)>>>0){e=Qi(i,c)|0;if(!e){E=17;break}f[h>>2]=e;f[m>>2]=c;l=f[y>>2]|0;o=f[v>>2]|0;a=f[o+(l*5640|0)+5584>>2]|0;r=f[(f[d>>2]|0)+16>>2]|0;s=f[a+(u*1080|0)>>2]|0;i=e}r=r>>>0<257?1:2;if(!(s&1))e=5;else e=(f[a+(u*1080|0)+4>>2]|0)+5|0;Er(i,65363,2);Er(i+2|0,r+3+e|0,2);Er(i+4|0,u,r);s=r|4;Er(i+s|0,f[(f[o+(l*5640|0)+5584>>2]|0)+(u*1080|0)>>2]|0,1);f[g>>2]=e;oo(f[v>>2]|0,f[y>>2]|0,i+(s+1)|0,g,n)|0;if((Wr(t,f[h>>2]|0,c,n)|0)!=(c|0)){e=0;E=24;break}r=f[(f[d>>2]|0)+16>>2]|0}u=u+1|0;if(u>>>0>=r>>>0){e=1;E=24;break}}if((E|0)==17){Ji(f[h>>2]|0);f[h>>2]=0;f[m>>2]=0;Jr(n,1,11548,_)|0;E=0;b=w;return E|0}else if((E|0)==24){b=w;return e|0}return 0}function Xa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0;y=b;b=b+16|0;g=y;d=y+4|0;u=e+80|0;r=f[(f[u>>2]|0)+16>>2]|0;if(r>>>0<=1){v=1;b=y;return v|0}p=e+164|0;m=e+200|0;h=e+48|0;c=e+44|0;l=1;while(1){s=f[(f[p>>2]|0)+((f[m>>2]|0)*5640|0)+5584>>2]|0;a=f[s+24>>2]|0;o=f[s+(l*1080|0)+24>>2]|0;e:do{if((a|0)==(o|0)?(f[s+804>>2]|0)==(f[s+(l*1080|0)+804>>2]|0):0){if((a|0)!=1){i=(f[s+4>>2]|0)*3|0;e=i+-2|0;if((i|0)!=((f[s+(l*1080|0)+4>>2]|0)*3|0)){v=14;break}if(!e)break}else e=1;i=0;do{if((f[s+28+(i<<3)>>2]|0)!=(f[s+(l*1080|0)+28+(i<<3)>>2]|0)){v=14;break e}i=i+1|0}while(i>>>0<e>>>0);if(a){i=0;do{if((f[s+28+(i<<3)+4>>2]|0)!=(f[s+(l*1080|0)+28+(i<<3)+4>>2]|0)){v=14;break e}i=i+1|0}while(i>>>0<e>>>0)}}else v=14}while(0);if((v|0)==14){v=0;if((o|0)==1)e=1;else e=((f[s+(l*1080|0)+4>>2]|0)*3|0)+-2|0;a=((o|0)==0?e+1|0:e<<1|1)+5+(r>>>0>256&1)|0;e=f[c>>2]|0;if(a>>>0>(f[h>>2]|0)>>>0){e=Qi(e,a)|0;if(!e){v=18;break}f[c>>2]=e;f[h>>2]=a;r=f[(f[p>>2]|0)+((f[m>>2]|0)*5640|0)+5584>>2]|0;i=f[r+(l*1080|0)+24>>2]|0}else{i=o;r=s}if((i|0)==1)r=1;else r=((f[r+(l*1080|0)+4>>2]|0)*3|0)+-2|0;i=(i|0)==0?r+1|0:r<<1|1;f[d>>2]=i+6;Er(e,65373,2);r=e+2|0;if((f[(f[u>>2]|0)+16>>2]|0)>>>0<257){Er(r,i+3|0,2);Er(e+4|0,l,1);e=e+5|0}else{Er(r,i+4|0,2);Er(e+4|0,l,2);e=e+6|0}f[d>>2]=i;ao(f[p>>2]|0,f[m>>2]|0,l,e,d,n)|0;if((Wr(t,f[c>>2]|0,a,n)|0)!=(a|0)){e=0;v=28;break}r=f[(f[u>>2]|0)+16>>2]|0}l=l+1|0;if(l>>>0>=r>>>0){e=1;v=28;break}}if((v|0)==18){Ji(f[c>>2]|0);f[c>>2]=0;f[h>>2]=0;Jr(n,1,11476,g)|0;v=0;b=y;return v|0}else if((v|0)==28){b=y;return e|0}return 0}function Ya(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;c=b;b=b+16|0;a=c;o=(f[e+32>>2]|0)*5|0;s=o+6|0;i=e+48|0;l=e+44|0;r=f[l>>2]|0;do{if(s>>>0>(f[i>>2]|0)>>>0){r=Qi(r,s)|0;if(r){f[l>>2]=r;f[i>>2]=s;break}Ji(f[l>>2]|0);f[l>>2]=0;f[i>>2]=0;Jr(n,1,11437,a)|0;t=0;b=c;return t|0}}while(0);a=Xr(t)|0;e=e+16|0;f[e>>2]=a;f[e+4>>2]=B;Er(r,65365,2);Er(r+2|0,o+4|0,2);Er(r+4|0,0,1);Er(r+5|0,80,1);t=(Wr(t,f[l>>2]|0,s,n)|0)==(s|0)&1;b=c;return t|0}function Ka(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0;m=b;b=b+16|0;s=m;p=m+4|0;f[p>>2]=0;u=e+200|0;r=f[u>>2]|0;c=e+164|0;i=f[c>>2]|0;l=e+80|0;o=f[(f[l>>2]|0)+16>>2]|0;d=(ue(o>>>0<257?7:9,(f[i+(r*5640|0)+420>>2]|0)+1|0)|0)+4|0;a=e+48|0;h=e+44|0;e=f[h>>2]|0;do{if(d>>>0>(f[a>>2]|0)>>>0){r=Qi(e,d)|0;if(r){f[h>>2]=r;f[a>>2]=d;a=r;e=f[(f[l>>2]|0)+16>>2]|0;i=f[c>>2]|0;r=f[u>>2]|0;break}Ji(f[h>>2]|0);f[h>>2]=0;f[a>>2]=0;Jr(n,1,11398,s)|0;t=0;b=m;return t|0}else{a=e;e=o}}while(0);io(e,i,r,a,p);t=(Wr(t,f[h>>2]|0,d,n)|0)==(d|0)&1;b=m;return t|0}function Za(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0;s=e+164|0;l=e+80|0;i=f[l>>2]|0;r=f[i+16>>2]|0;if(!r){t=1;return t|0}o=e+44|0;e=0;a=f[(f[s>>2]|0)+5584>>2]|0;while(1){if(f[a+808>>2]|0){c=f[(f[s>>2]|0)+5584>>2]|0;h=r>>>0<257?1:2;i=h+6|0;u=f[o>>2]|0;Er(u,65374,2);r=h|4;Er(u+2|0,r,2);Er(u+4|0,e,h);Er(u+r|0,0,1);Er(u+(r+1)|0,f[c+(e*1080|0)+808>>2]|0,1);if((Wr(t,f[o>>2]|0,i,n)|0)!=(i|0)){e=0;r=7;break}i=f[l>>2]|0}e=e+1|0;r=f[i+16>>2]|0;if(e>>>0>=r>>>0){e=1;r=7;break}else a=a+1080|0}if((r|0)==7)return e|0;return 0}function Qa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;c=b;b=b+16|0;a=c;o=f[e+108>>2]|0;s=xl(o)|0;l=s+6|0;r=e+48|0;i=e+44|0;e=f[i>>2]|0;do{if(l>>>0>(f[r>>2]|0)>>>0){e=Qi(e,l)|0;if(e){f[i>>2]=e;f[r>>2]=l;break}Ji(f[i>>2]|0);f[i>>2]=0;f[r>>2]=0;Jr(n,1,11355,a)|0;t=0;b=c;return t|0}}while(0);Er(e,65380,2);Er(e+2|0,s+4|0,2);Er(e+4|0,1,2);Xl(e+6|0,o|0,s|0)|0;t=(Wr(t,f[i>>2]|0,l,n)|0)==(l|0)&1;b=c;return t|0}function Ja(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0;M=b;b=b+32|0;w=M+24|0;y=M+16|0;d=M+8|0;i=M;o=f[e+80>>2]|0;s=o+16|0;a=f[s>>2]|0;l=a+6|0;E=e+48|0;A=e+44|0;r=f[A>>2]|0;do{if(l>>>0>(f[E>>2]|0)>>>0){r=Qi(r,l)|0;if(r){f[A>>2]=r;f[E>>2]=l;break}Ji(f[A>>2]|0);f[A>>2]=0;f[E>>2]=0;Jr(n,1,11199,i)|0;t=0;b=M;return t|0}}while(0);Er(r,65400,2);Er(r+2|0,a+4|0,2);Er(r+4|0,f[s>>2]|0,2);if(f[s>>2]|0){a=0;i=f[o+24>>2]|0;r=r+6|0;while(1){Er(r,(f[i+24>>2]|0)+-1|f[i+32>>2]<<7,1);a=a+1|0;if(a>>>0>=(f[s>>2]|0)>>>0)break;else{i=i+52|0;r=r+1|0}}}if((Wr(t,f[A>>2]|0,l,n)|0)!=(l|0)){t=0;b=M;return t|0}m=e+200|0;u=f[m>>2]|0;g=e+164|0;c=f[g>>2]|0;i=c+(u*5640|0)+5616|0;e:do{if(f[i>>2]|0){l=0;e=f[c+(u*5640|0)+5612>>2]|0;while(1){a=e+16|0;o=f[a>>2]|0;s=o+10|0;r=f[A>>2]|0;if(s>>>0>(f[E>>2]|0)>>>0){r=Qi(r,s)|0;if(!r)break;f[A>>2]=r;f[E>>2]=s}Er(r,65396,2);Er(r+2|0,o+8|0,2);Er(r+4|0,0,2);Er(r+6|0,f[e+4>>2]<<8|f[e+8>>2]&255|f[e>>2]<<10,2);Er(r+8|0,0,2);Xl(r+10|0,f[e+12>>2]|0,f[a>>2]|0)|0;if((Wr(t,f[A>>2]|0,s,n)|0)!=(s|0)){v=0;x=42;break}l=l+1|0;if(l>>>0>=(f[i>>2]|0)>>>0)break e;else e=e+20|0}if((x|0)==42){b=M;return v|0}Ji(f[A>>2]|0);f[A>>2]=0;f[E>>2]=0;Jr(n,1,11238,d)|0;t=0;b=M;return t|0}}while(0);d=c+(u*5640|0)+5628|0;e:do{if(f[d>>2]|0){p=0;c=f[c+(u*5640|0)+5624>>2]|0;while(1){l=c+4|0;i=f[l>>2]|0;o=i>>>0>255;s=o?2:1;o=o?32768:0;i=ue(s,i<<1)|0;e=i+19|0;r=f[A>>2]|0;if(e>>>0>(f[E>>2]|0)>>>0){r=Qi(r,e)|0;if(!r)break;f[A>>2]=r;f[E>>2]=e}Er(r,65397,2);Er(r+2|0,i+17|0,2);Er(r+4|0,0,2);Er(r+6|0,f[c>>2]|0,1);Er(r+7|0,0,2);Er(r+9|0,1,2);Er(r+11|0,1,1);Er(r+12|0,f[l>>2]|o,2);r=r+14|0;if(!(f[l>>2]|0))i=0;else{a=0;do{Er(r,a,s);r=r+s|0;a=a+1|0;i=f[l>>2]|0}while(a>>>0<i>>>0)}Er(r,i|o,2);r=r+2|0;if(!(f[l>>2]|0))a=r;else{i=0;do{Er(r,i,s);r=r+s|0;i=i+1|0}while(i>>>0<(f[l>>2]|0)>>>0);a=r}r=((h[c+16>>0]^1)&255)<<16&65536;i=f[c+8>>2]|0;if(i)r=f[i+8>>2]|r;i=f[c+12>>2]|0;if(i)r=f[i+8>>2]<<8|r;Er(a,r,3);if((Wr(t,f[A>>2]|0,e,n)|0)!=(e|0)){v=0;x=42;break}p=p+1|0;if(p>>>0>=(f[d>>2]|0)>>>0)break e;else c=c+20|0}if((x|0)==42){b=M;return v|0}Ji(f[A>>2]|0);f[A>>2]=0;f[E>>2]=0;Jr(n,1,11277,y)|0;t=0;b=M;return t|0}}while(0);s=f[m>>2]|0;o=f[g>>2]|0;l=o+(s*5640|0)+5628|0;i=f[l>>2]|0;e=i+5|0;r=f[A>>2]|0;do{if(e>>>0>(f[E>>2]|0)>>>0){r=Qi(r,e)|0;if(!r){Ji(f[A>>2]|0);f[A>>2]=0;f[E>>2]=0;Jr(n,1,11316,w)|0;_=1;break}else{f[A>>2]=r;f[E>>2]=e;T=r;x=37;break}}else{T=r;x=37}}while(0);if((x|0)==37){Er(T,65399,2);Er(T+2|0,i+3|0,2);Er(T+4|0,f[l>>2]|0,1);if(f[l>>2]|0){a=0;i=T+5|0;r=f[o+(s*5640|0)+5624>>2]|0;while(1){Er(i,f[r>>2]|0,1);a=a+1|0;if(a>>>0>=(f[l>>2]|0)>>>0)break;else{i=i+1|0;r=r+20|0}}}_=(Wr(t,f[A>>2]|0,e,n)|0)!=(e|0)}t=_&1^1;b=M;return t|0}function $a(e,t,n){e=e|0;t=t|0;n=n|0;n=Xr(t)|0;t=(f[e+196>>2]|0)+8|0;f[t>>2]=n;f[t+4>>2]=B;return 1}function eo(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=b;b=b+16|0;t=zn(0)|0;r=e+204|0;f[r>>2]=t;if(!t){Jr(n,1,11159,i)|0;n=0;b=i;return n|0}if(Wn(t,f[e+80>>2]|0,e+88|0)|0){n=1;b=i;return n|0}qn(f[r>>2]|0);f[r>>2]=0;n=0;b=i;return n|0}function to(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0.0,u=0,p=0,m=0,g=0,y=0,_=0.0,b=0,E=0,w=0.0,x=0.0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0.0,C=0.0,I=0.0,N=0.0,F=0,O=0,H=0,D=0,U=0,z=0,V=0,j=0;U=e+80|0;k=f[U>>2]|0;z=e+164|0;i=f[z>>2]|0;D=k+24|0;P=f[D>>2]|0;n=f[P>>2]|0;r=f[P+4>>2]|0;H=k+16|0;P=ue(f[P+24>>2]|0,f[H>>2]|0)|0;R=Xr(t)|0;m=e+116|0;s=f[m>>2]|0;g=e+112|0;t=f[g>>2]|0;L=(+(R>>>0)+4294967296.0*+(B|0))/+((ue(t,s)|0)>>>0);R=(h[e+181>>0]&8)==0?1:2;if(s){y=e+92|0;b=e+100|0;E=e+96|0;T=e+104|0;A=k+4|0;M=k+8|0;S=k+12|0;x=+((ue(n<<3,r)|0)>>>0);l=t;n=t;p=0;t=i;do{u=p;p=p+1|0;if(!n)n=0;else{l=0;do{w=+Pc[R&3](t);s=f[t+8>>2]|0;w=w/+(s>>>0);V=f[y>>2]|0;i=f[b>>2]|0;o=(ue(i,l)|0)+V|0;n=f[k>>2]|0;n=(o|0)>(n|0)?o:n;o=f[E>>2]|0;a=f[T>>2]|0;j=(ue(a,u)|0)+o|0;r=f[A>>2]|0;r=(j|0)>(r|0)?j:r;l=l+1|0;V=(ue(i,l)|0)+V|0;i=f[M>>2]|0;i=(V|0)<(i|0)?V:i;o=(ue(a,p)|0)+o|0;a=f[S>>2]|0;a=(o|0)<(a|0)?o:a;o=t+20|0;c=+v[o>>2];if(c!=0.0){_=+((ue(ue(i-n|0,P)|0,a-r|0)|0)>>>0)/(x*c)-w;v[o>>2]=_}if(s>>>0>1){c=+((ue(ue(i-n|0,P)|0,a-r|0)|0)>>>0);n=1;r=t+24|0;while(1){_=+v[r>>2];if(_!=0.0)v[r>>2]=c/(x*_)-w;n=n+1|0;if(n>>>0>=s>>>0)break;else r=r+4|0}}t=t+5640|0;n=f[g>>2]|0}while(l>>>0<n>>>0);s=f[m>>2]|0;l=n}}while(p>>>0<s>>>0);if(!s)s=0;else{y=(l|0)==0;_=L+2.0;E=l>>>0>1?l:1;b=0;n=f[z>>2]|0;do{if(!y){p=n+16|0;m=0;g=n;while(1){t=g+20|0;c=+v[t>>2];if(c!=0.0?(x=c-L,v[t>>2]=x,x<30.0):0)v[t>>2]=30.0;a=g+24|0;t=f[g+8>>2]|0;u=t+-1|0;c=+v[a>>2];r=c!=0.0;if(u>>>0>1){o=p+(t<<2)|0;i=1;t=a;do{if(r?(x=c-L,v[t>>2]=x,I=+v[t+-4>>2],x<I+10.0):0)v[t>>2]=I+20.0;t=t+4|0;i=i+1|0;c=+v[t>>2];r=c!=0.0}while((i|0)!=(u|0));if(r){C=c;F=o;O=29}}else if(r){C=c;F=a;O=29}if((O|0)==29?(O=0,x=C-_,v[F>>2]=x,N=+v[F+-4>>2],x<N+10.0):0)v[F>>2]=N+20.0;m=m+1|0;if(m>>>0>=l>>>0)break;else{p=p+5640|0;g=g+5640|0}}n=n+(E*5640|0)|0}b=b+1|0}while(b>>>0<s>>>0)}}else{l=t;s=0}r=f[H>>2]|0;if(!r)b=0;else{i=(f[e+100>>2]|0)+-1|0;a=(f[e+104>>2]|0)+-1|0;o=0;t=f[D>>2]|0;n=0;while(1){j=f[t>>2]|0;V=f[t+4>>2]|0;j=ue(((a+V|0)>>>0)/(V>>>0)|0,((i+j|0)>>>0)/(j>>>0)|0)|0;n=(ue(j,f[t+24>>2]|0)|0)+n|0;o=o+1|0;if(o>>>0>=r>>>0)break;else t=t+52|0}b=~~(+(n>>>0)*.1625)>>>0}u=f[(f[U>>2]|0)+16>>2]|0;m=u+-1|0;y=ue(s,l)|0;p=(y|0)==0;if(p)i=0;else{t=0;n=0;r=f[z>>2]|0;while(1){j=f[r+5588>>2]|0;n=n>>>0>j>>>0?n:j;t=t+1|0;if((t|0)==(y|0))break;else r=r+5640|0}i=n*12|0}g=e+88|0;if(((d[g>>1]|0)+-3&65535)>=4){if(p){t=0;n=0}else{l=(u|0)==0;o=0;n=0;do{if(!l){r=f[(f[z>>2]|0)+(o*5640|0)+5584>>2]|0;a=0;do{if(!(f[r+(a*1080|0)>>2]&1))t=5;else t=(f[r+(a*1080|0)+4>>2]|0)+5|0;n=n>>>0>t>>>0?n:t;a=a+1|0}while((a|0)!=(u|0))}o=o+1|0}while((o|0)!=(y|0));s=0;t=0;do{if(!l){a=f[(f[z>>2]|0)+(s*5640|0)+5584>>2]|0;o=0;do{if(!(f[a+(o*1080|0)>>2]&1))r=5;else r=(f[a+(o*1080|0)+4>>2]|0)+5|0;t=t>>>0>r>>>0?t:r;o=o+1|0}while((o|0)!=(u|0))}s=s+1|0}while((s|0)!=(y|0))}i=(ue(n+12+t|0,m)|0)+i|0}if(p)n=13;else{r=0;n=0;t=f[z>>2]|0;while(1){j=f[t+420>>2]|0;n=n>>>0>j>>>0?n:j;r=r+1|0;if((r|0)==(y|0))break;else t=t+5640|0}n=(n*9|0)+13|0}j=i+b+n|0;f[e+40>>2]=j;j=Xi(j)|0;f[e+36>>2]=j;if(!j){j=0;return j|0}if(((d[g>>1]|0)+-3&65535)>=4){j=1;return j|0}n=Xi((f[e+32>>2]|0)*5|0)|0;f[e+24>>2]=n;if(!n){j=0;return j|0}f[e+28>>2]=n;j=1;return j|0}function no(e){e=e|0;return 0.0}function ro(e){e=e|0;return+ +((((f[e+5588>>2]|0)*14|0)+-14|0)>>>0)}function io(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0;a=f[t+(n*5640|0)+5584>>2]|0;g=(f[t+(n*5640|0)+420>>2]|0)+1|0;l=e>>>0<257?1:2;m=ue(g,(l<<1)+5|0)|0;v=m+4|0;Er(r,65375,2);Er(r+2|0,m+2|0,2);if(!g){f[i>>2]=v;return}c=l+1|0;u=l+3|0;h=l|4;d=h+l|0;p=d+1|0;m=t+(n*5640|0)+8|0;o=a+4|0;s=0;r=r+4|0;a=t+(n*5640|0)+424|0;while(1){Er(r,f[a>>2]|0,1);Er(r+1|0,f[a+4>>2]|0,l);_=a+8|0;Er(r+c|0,f[_>>2]|0,2);t=a+12|0;Er(r+u|0,f[t>>2]|0,1);n=a+16|0;Er(r+h|0,f[n>>2]|0,l);Er(r+d|0,f[a+36>>2]|0,1);b=f[_>>2]|0;y=f[m>>2]|0;f[_>>2]=(b|0)<(y|0)?b:y;_=f[t>>2]|0;y=f[o>>2]|0;f[t>>2]=(_|0)<(y|0)?_:y;t=f[n>>2]|0;f[n>>2]=(t|0)<(e|0)?t:e;s=s+1|0;if((s|0)==(g|0))break;else{r=r+p|0;a=a+148|0}}f[i>>2]=v;return}function ao(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;var o=0,s=0,l=0,c=0,u=0,h=0;h=b;b=b+16|0;l=h+8|0;s=h;c=f[e+(t*5640|0)+5584>>2]|0;t=f[c+(n*1080|0)+24>>2]|0;do{if((t|0)!=1){e=(f[c+(n*1080|0)+4>>2]|0)*3|0;o=e+-2|0;if(!t){e=e+-1|0;if((f[i>>2]|0)>>>0<e>>>0){Jr(a,1,11515,s)|0;i=0;b=h;return i|0}else{Er(r,f[c+(n*1080|0)+804>>2]<<5,1);if(!o)break;else t=0;do{r=r+1|0;Er(r,f[c+(n*1080|0)+28+(t<<3)>>2]<<3,1);t=t+1|0}while((t|0)!=(o|0))}}else u=7}else{o=1;t=1;u=7}}while(0);if((u|0)==7){e=o<<1|1;if((f[i>>2]|0)>>>0<e>>>0){Jr(a,1,11515,l)|0;i=0;b=h;return i|0}Er(r,(f[c+(n*1080|0)+804>>2]<<5)+t|0,1);if(o){r=r+1|0;t=0;while(1){Er(r,(f[c+(n*1080|0)+28+(t<<3)>>2]<<11)+(f[c+(n*1080|0)+28+(t<<3)+4>>2]|0)|0,2);t=t+1|0;if((t|0)==(o|0))break;else r=r+2|0}}}f[i>>2]=(f[i>>2]|0)-e;i=1;b=h;return i|0}function oo(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+16|0;a=f[e+(t*5640|0)+5584>>2]|0;if((f[r>>2]|0)>>>0<5){Jr(i,1,11587,s)|0;r=0;b=s;return r|0}o=a+4|0;Er(n,(f[o>>2]|0)+-1|0,1);Er(n+1|0,(f[a+8>>2]|0)+-2|0,1);Er(n+2|0,(f[a+12>>2]|0)+-2|0,1);Er(n+3|0,f[a+16>>2]|0,1);Er(n+4|0,f[a+20>>2]|0,1);t=(f[r>>2]|0)+-5|0;f[r>>2]=t;if(!(f[a>>2]&1)){r=1;b=s;return r|0}e=f[o>>2]|0;if(t>>>0<e>>>0){Jr(i,1,11587,s+8|0)|0;r=0;b=s;return r|0}if(!e)e=0;else{t=n+5|0;n=0;while(1){Er(t,(f[a+944+(n<<2)>>2]<<4)+(f[a+812+(n<<2)>>2]|0)|0,1);n=n+1|0;e=f[o>>2]|0;if(n>>>0>=e>>>0)break;else t=t+1|0}t=f[r>>2]|0}f[r>>2]=t-e;r=1;b=s;return r|0}function so(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0;a=f[e+76>>2]|0;r=f[a+(n*5640|0)+4>>2]|0;i=696;while(1){c=f[i>>2]|0;if((c|0)==-1|(c|0)==(r|0))break;else i=i+12|0}if(!(h[e+93>>0]&8)){e=1;return e|0}c=p[e+92>>0]|0;o=a+(n*5640|0)+424+(t*148|0)+92|0;s=a+(n*5640|0)+424+(t*148|0)+88|0;l=a+(n*5640|0)+424+(t*148|0)+96|0;t=a+(n*5640|0)+424+(t*148|0)+84|0;a=h[i+4>>0]|0;switch(a|0){case 67:{r=f[o>>2]|0;break}case 82:{r=f[s>>2]|0;break}case 80:{r=f[l>>2]|0;break}case 76:{r=f[t>>2]|0;break}default:r=1}if((c|0)!=(a|0)){a=h[i+5>>0]|0;switch(a|0){case 67:{r=ue(f[o>>2]|0,r)|0;break}case 82:{r=ue(f[s>>2]|0,r)|0;break}case 80:{r=ue(f[l>>2]|0,r)|0;break}case 76:{r=ue(f[t>>2]|0,r)|0;break}default:{}}if((c|0)!=(a|0)){a=h[i+6>>0]|0;switch(a|0){case 67:{r=ue(f[o>>2]|0,r)|0;break}case 82:{r=ue(f[s>>2]|0,r)|0;break}case 80:{r=ue(f[l>>2]|0,r)|0;break}case 76:{r=ue(f[t>>2]|0,r)|0;break}default:{}}if((c|0)!=(a|0)){i=h[i+7>>0]|0;switch(i|0){case 67:{r=ue(f[o>>2]|0,r)|0;break}case 82:{r=ue(f[s>>2]|0,r)|0;break}case 80:{r=ue(f[l>>2]|0,r)|0;break}case 76:{r=ue(f[t>>2]|0,r)|0;break}default:{}}if((c|0)==(i|0))i=3;else{e=r;return e|0}}else i=2}else i=1}else i=0;f[e+84>>2]=i;e=r;return e|0}function lo(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0;S=t+16|0;if(!(f[S>>2]|0)){S=1;return S|0}M=0;A=f[t+24>>2]|0;while(1){a=r+44|0;i=f[a>>2]|0;o=r+8|0;if(!i){t=r+12|0;i=Yi(ue(f[t>>2]|0,f[o>>2]|0)|0,4)|0;f[a>>2]=i;if(!i){n=0;r=61;break}}else t=r+12|0;g=A+36|0;f[r+36>>2]=f[g>>2];x=f[A+24>>2]|0;_=f[e+24>>2]|0;g=f[g>>2]|0;x=((x&7|0)!=0&1)+(x>>>3)|0;x=(x|0)==3?4:x;l=f[_+(g*136|0)+8>>2]|0;s=f[_+(g*136|0)>>2]|0;E=l-s|0;y=f[_+(g*136|0)+12>>2]|0;g=f[_+(g*136|0)+4>>2]|0;_=y-g|0;a=f[r+16>>2]|0;u=f[r+40>>2]|0;c=Gl(1,0,u|0)|0;w=B;a=Wl(a|0,0,-1,-1)|0;a=Wl(a|0,B|0,c|0,w|0)|0;a=ql(a|0,B|0,u|0)|0;v=Wl(f[r+20>>2]|0,0,-1,-1)|0;w=Wl(v|0,B|0,c|0,w|0)|0;u=ql(w|0,B|0,u|0)|0;w=f[o>>2]|0;o=a+w|0;c=f[t>>2]|0;v=u+c|0;do{if(a>>>0<s>>>0){t=s-a|0;if(l>>>0>o>>>0){T=o-s|0;b=0;s=E-T|0;l=t}else{b=0;s=0;l=t;T=E}}else{t=a-s|0;if(l>>>0>o>>>0){b=t;s=l-o|0;l=0;T=w;break}else{b=t;s=0;l=0;T=E-t|0;break}}}while(0);do{if(u>>>0<g>>>0){o=g-u|0;if(y>>>0>v>>>0){a=v-g|0;c=a;t=0;a=_-a|0}else{c=_;t=0;a=0}}else{t=u-g|0;if(y>>>0>v>>>0){a=y-v|0;o=0;break}else{c=_-t|0;a=0;o=0;break}}}while(0);if((b|s|T|a|t|c|0)<0){n=0;r=61;break}t=(ue(t,E)|0)+b|0;g=b+s|0;v=(ue(a,E)|0)-b|0;u=w-T|0;i=i+((ue(w,o)|0)+l<<2)|0;switch(x|0){case 1:{n=n+t|0;t=(c|0)==0;if(!(f[A+32>>2]|0)){if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=n;while(1){f[t>>2]=p[i>>0];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+1|0}}t=o;n=n+T|0}n=n+g|0;l=l+1|0;if((l|0)==(c|0))break;else t=t+(u<<2)|0}}}else if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=n;while(1){f[t>>2]=h[i>>0];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+1|0}}t=o;n=n+T|0}n=n+g|0;l=l+1|0;if((l|0)==(c|0))break;else t=t+(u<<2)|0}}n=n+v|0;break}case 2:{n=n+(t<<1)|0;t=(c|0)==0;if(!(f[A+32>>2]|0)){if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=n;while(1){f[t>>2]=m[i>>1];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+2|0}}t=o;n=n+(T<<1)|0}n=n+(g<<1)|0;l=l+1|0;if((l|0)==(c|0))break;else t=t+(u<<2)|0}}}else if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=n;while(1){f[t>>2]=d[i>>1];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+2|0}}t=o;n=n+(T<<1)|0}n=n+(g<<1)|0;l=l+1|0;if((l|0)==(c|0))break;else t=t+(u<<2)|0}}n=n+(v<<1)|0;break}case 4:{n=n+(t<<2)|0;if(c){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=n;while(1){f[t>>2]=f[i>>2];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+4|0}}t=o;n=n+(T<<2)|0}n=n+(g<<2)|0;l=l+1|0;if((l|0)==(c|0))break;else t=t+(u<<2)|0}}n=n+(v<<2)|0;break}default:{}}M=M+1|0;if(M>>>0>=(f[S>>2]|0)>>>0){n=1;r=61;break}else{r=r+52|0;A=A+52|0;e=e+52|0}}if((r|0)==61)return n|0;return 0}function co(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0;A=b;b=b+112|0;x=A+88|0;_=A+80|0;E=A+72|0;y=A+64|0;m=A+56|0;d=A+48|0;l=A+40|0;o=A+32|0;a=A+24|0;i=A+16|0;g=A+100|0;v=A+96|0;w=A+92|0;f[v>>2]=0;T=e+200|0;if((n|0)!=8){Jr(r,1,8662,A)|0;Jr(r,1,8662,A+8|0)|0;r=0;b=A;return r|0}wr(t,T,2);wr(t+2|0,g,4);wr(t+6|0,w,1);wr(t+7|0,v,1);s=f[T>>2]|0;t=f[e+112>>2]|0;if(s>>>0>=(ue(f[e+116>>2]|0,t)|0)>>>0){f[i>>2]=s;Jr(r,1,15258,i)|0;r=0;b=A;return r|0}n=f[e+164>>2]|0;u=(s>>>0)%(t>>>0)|0;c=(s>>>0)/(t>>>0)|0;t=f[g>>2]|0;do{if((t+-1|0)>>>0<13){if((t|0)==12){f[a>>2]=12;Jr(r,2,15282,a)|0;t=f[g>>2]|0;break}f[o>>2]=t;Jr(r,1,15319,o)|0;r=0;b=A;return r|0}}while(0);if(!t){Jr(r,4,15380,l)|0;f[e+72>>2]=1}t=f[v>>2]|0;do{if(!t)t=f[n+(s*5640|0)+5588>>2]|0;else{t=((p[e+76>>0]|0)>>>4&1)+t|0;f[v>>2]=t;i=n+(s*5640|0)+5588|0;a=f[i>>2]|0;n=f[w>>2]|0;if((a+-1|0)>>>0<n>>>0){f[d>>2]=n;f[d+4>>2]=a;Jr(r,1,15491,d)|0;f[e+72>>2]=1;r=0;b=A;return r|0}if(n>>>0<t>>>0){f[i>>2]=t;break}f[m>>2]=n;f[m+4>>2]=t;Jr(r,1,15590,m)|0;f[e+72>>2]=1;r=0;b=A;return r|0}}while(0);if((t|0)!=0?(t|0)==((f[w>>2]|0)+1|0):0){m=e+76|0;h[m>>0]=h[m>>0]|1}f[e+24>>2]=(f[e+72>>2]|0)==0?(f[g>>2]|0)+-12|0:0;f[e+8>>2]=16;t=f[e+60>>2]|0;if((t|0)==-1){if((u>>>0>=(f[e+28>>2]|0)>>>0?u>>>0<(f[e+36>>2]|0)>>>0:0)?c>>>0>=(f[e+32>>2]|0)>>>0:0)t=(c>>>0>=(f[e+40>>2]|0)>>>0&1)<<2&255;else t=4;g=e+76|0;h[g>>0]=h[g>>0]&-5|t}else{g=e+76|0;h[g>>0]=((f[T>>2]|0)!=(t|0)&1)<<2&255|h[g>>0]&-5}o=e+196|0;t=f[o>>2]|0;if(!t){r=1;b=A;return r|0}a=f[T>>2]|0;t=f[t+40>>2]|0;f[t+(a*40|0)>>2]=a;f[t+(a*40|0)+12>>2]=f[w>>2];n=f[v>>2]|0;if(n){f[t+(a*40|0)+4>>2]=n;f[t+(a*40|0)+8>>2]=f[v>>2];t=f[t+(a*40|0)+16>>2]|0;if(!t){x=Yi(f[v>>2]|0,24)|0;f[(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16>>2]=x;if(x){r=1;b=A;return r|0}Jr(r,1,15698,y)|0;r=0;b=A;return r|0}t=Qi(t,(f[v>>2]|0)*24|0)|0;n=(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16|0;if(!t){Ji(f[n>>2]|0);f[(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16>>2]=0;Jr(r,1,15698,E)|0;r=0;b=A;return r|0}else{f[n>>2]=t;r=1;b=A;return r|0}}if(!(f[t+(a*40|0)+16>>2]|0)){f[t+(a*40|0)+8>>2]=10;E=Yi(10,24)|0;n=f[T>>2]|0;t=f[(f[o>>2]|0)+40>>2]|0;f[t+(n*40|0)+16>>2]=E;if(!E){f[t+(n*40|0)+8>>2]=0;Jr(r,1,15698,_)|0;r=0;b=A;return r|0}else a=n}n=f[w>>2]|0;i=t+(a*40|0)+8|0;if(n>>>0<(f[i>>2]|0)>>>0){r=1;b=A;return r|0}n=n+1|0;f[i>>2]=n;t=Qi(f[t+(a*40|0)+16>>2]|0,n*24|0)|0;n=(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16|0;if(!t){Ji(f[n>>2]|0);T=f[T>>2]|0;w=f[(f[o>>2]|0)+40>>2]|0;f[w+(T*40|0)+16>>2]=0;f[w+(T*40|0)+8>>2]=0;Jr(r,1,15698,x)|0;r=0;b=A;return r|0}else{f[n>>2]=t;r=1;b=A;return r|0}return 0}function uo(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+64|0;p=v+48|0;m=v+40|0;s=v+32|0;u=v+56|0;o=v+52|0;f[u>>2]=n;g=e+80|0;l=f[g>>2]|0;d=e+8|0;if((f[d>>2]|0)==16)c=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else c=f[e+12>>2]|0;i=c+5636|0;a=h[i>>0]|0;if(a&1){Jr(r,1,15025,v)|0;g=0;b=v;return g|0}h[i>>0]=a|1;if(n>>>0<5){Jr(r,1,15089,v+8|0)|0;g=0;b=v;return g|0}wr(t,c,1);if((f[c>>2]|0)>>>0>7){Jr(r,1,15115,v+16|0)|0;g=0;b=v;return g|0}wr(t+1|0,o,1);o=f[o>>2]|0;i=c+4|0;f[i>>2]=o;if((o|0)>4){Jr(r,1,15149,v+24|0)|0;f[i>>2]=-1}i=c+8|0;wr(t+2|0,i,2);i=f[i>>2]|0;if((i+-1|0)>>>0>65534){f[s>>2]=i;Jr(r,1,15190,s)|0;g=0;b=v;return g|0}s=f[e+172>>2]|0;f[c+12>>2]=(s|0)==0?i:s;wr(t+4|0,c+16|0,1);s=t+5|0;f[u>>2]=n+-5;o=f[l+16>>2]|0;if(o){t=f[c>>2]&1;i=f[c+5584>>2]|0;a=0;do{f[i+(a*1080|0)>>2]=t;a=a+1|0}while(a>>>0<o>>>0)}if(!(St(e,0,s,u,r)|0)){Jr(r,1,15089,m)|0;g=0;b=v;return g|0}if(f[u>>2]|0){Jr(r,1,15089,p)|0;g=0;b=v;return g|0}if((f[d>>2]|0)==16)i=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else i=f[e+12>>2]|0;i=f[i+5584>>2]|0;n=i+4|0;a=f[n>>2]|0;c=a<<2;if((f[(f[g>>2]|0)+16>>2]|0)>>>0<=1){g=1;b=v;return g|0}u=i+8|0;d=i+12|0;e=i+16|0;r=i+20|0;p=i+812|0;m=i+944|0;f[i+1084>>2]=a;o=f[u>>2]|0;f[i+1088>>2]=o;t=f[d>>2]|0;f[i+1092>>2]=t;s=f[e>>2]|0;f[i+1096>>2]=s;l=f[r>>2]|0;f[i+1100>>2]=l;Xl(i+1892|0,p|0,c|0)|0;Xl(i+2024|0,m|0,c|0)|0;if((f[(f[g>>2]|0)+16>>2]|0)>>>0<=2){g=1;b=v;return g|0}f[i+2164>>2]=a;f[i+2168>>2]=o;f[i+2172>>2]=t;f[i+2176>>2]=s;f[i+2180>>2]=l;Xl(i+2972|0,p|0,c|0)|0;Xl(i+3104|0,m|0,c|0)|0;if((f[(f[g>>2]|0)+16>>2]|0)>>>0>3)a=3;else{g=1;b=v;return g|0}while(1){o=f[u>>2]|0;t=f[d>>2]|0;s=f[e>>2]|0;l=f[r>>2]|0;f[i+3244>>2]=f[n>>2];f[i+3248>>2]=o;f[i+3252>>2]=t;f[i+3256>>2]=s;f[i+3260>>2]=l;Xl(i+4052|0,p|0,c|0)|0;Xl(i+4184|0,m|0,c|0)|0;a=a+1|0;if(a>>>0>=(f[(f[g>>2]|0)+16>>2]|0)>>>0){i=1;break}else i=i+1080|0}b=v;return i|0}function ho(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;_=b;b=b+272|0;h=_;v=_+136|0;y=_+8|0;if(!e){y=0;b=_;return y|0}u=e+4|0;if((f[e>>2]|0)==(t|0)?(f[u>>2]|0)==(n|0):0)i=e+8|0;else{f[e>>2]=t;f[u>>2]=n;f[v>>2]=t;f[y>>2]=n;i=e+8|0;f[i>>2]=0;a=0;s=n;l=t;c=0;while(1){g=ue(s,l)|0;l=(l+1|0)/2|0;o=c+1|0;f[v+(o<<2)>>2]=l;s=(s+1|0)/2|0;f[y+(o<<2)>>2]=s;a=a+g|0;if(g>>>0<=1)break;else c=o}f[i>>2]=a;if(!a){i=e+12|0;a=f[i>>2]|0;if(a){Ji(a);f[i>>2]=0}Ji(e);y=0;b=_;return y|0}o=a<<4;s=e+16|0;l=e+12|0;do{if(o>>>0>(f[s>>2]|0)>>>0){a=Qi(f[l>>2]|0,o)|0;if(a){f[l>>2]=a;n=f[s>>2]|0;jl(a+n|0,0,o-n|0)|0;f[s>>2]=o;n=f[u>>2]|0;t=f[e>>2]|0;break}Jr(r,1,20166,h)|0;i=f[l>>2]|0;if(i){Ji(i);f[l>>2]=0}Ji(e);y=0;b=_;return y|0}}while(0);a=f[l>>2]|0;t=a+((ue(n,t)|0)<<4)|0;if(c){g=0;n=t;do{p=f[y+(g<<2)>>2]|0;e:do{if((p|0)>0){m=f[v+(g<<2)>>2]|0;if((m|0)<=0){o=p+-1|0;s=0;while(1){d=(s&1|0)!=0|(s|0)==(o|0);l=d?n:t+(m<<4)|0;n=d?n:t;s=s+1|0;if((s|0)>=(p|0)){t=l;break e}else t=l}}d=((m+2+((m|0)<2?~m:-3)|0)>>>1)+1|0;r=p+-1|0;h=0;while(1){u=m;l=n;while(1){f[a>>2]=l;o=a+16|0;s=u;u=u+-2|0;if((u|0)>-1){f[o>>2]=l;a=a+32|0}else a=o;if((s|0)<=2)break;else l=l+16|0}n=n+(d<<4)|0;u=(h&1|0)!=0|(h|0)==(r|0);o=u?n:t+(m<<4)|0;n=u?n:t;h=h+1|0;if((h|0)>=(p|0)){t=o;break}else t=o}}}while(0);g=g+1|0}while((g|0)!=(c|0))}f[a>>2]=0}i=f[i>>2]|0;if(!i){y=e;b=_;return y|0}a=0;t=f[e+12>>2]|0;while(1){f[t+4>>2]=999;f[t+8>>2]=0;f[t+12>>2]=0;a=a+1|0;if((a|0)==(i|0))break;else t=t+16|0}b=_;return e|0}function fo(e){e=e|0;var t=0,n=0;if(!e)return;t=e+12|0;n=f[t>>2]|0;if(n){Ji(n);f[t>>2]=0}Ji(e);return}function po(e,t,n){e=e|0;t=t|0;n=n|0;t=(f[e+12>>2]|0)+(t<<4)|0;if(!t)return;while(1){e=t+4|0;if((f[e>>2]|0)<=(n|0)){t=4;break}f[e>>2]=n;t=f[t>>2]|0;if(!t){t=4;break}}if((t|0)==4)return}function mo(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+128|0;s=l;n=(f[t+12>>2]|0)+(n<<4)|0;if(!(f[n>>2]|0)){i=0;a=s}else{i=n;t=s;while(1){a=t+4|0;f[t>>2]=n;n=f[i>>2]|0;if(!(f[n>>2]|0)){i=0;break}else{i=n;t=a}}}while(1){o=n+8|0;t=f[o>>2]|0;if((i|0)>(t|0)){f[o>>2]=i;t=i}e:do{if((t|0)<(r|0)){i=n+4|0;while(1){if((t|0)>=(f[i>>2]|0))break;Ro(e,0,1);t=t+1|0;if((t|0)>=(r|0)){n=t;break e}}n=n+12|0;if(!(f[n>>2]|0)){Ro(e,1,1);f[n>>2]=1;n=t}else n=t}else n=t}while(0);f[o>>2]=n;if((a|0)==(s|0))break;o=a+-4|0;i=n;n=f[o>>2]|0;a=o}b=l;return}function go(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+128|0;s=l;n=(f[t+12>>2]|0)+(n<<4)|0;if(!(f[n>>2]|0)){t=0;a=s}else{i=n;t=s;while(1){a=t+4|0;f[t>>2]=n;n=f[i>>2]|0;if(!(f[n>>2]|0)){t=0;break}else{i=n;t=a}}}while(1){o=n+8|0;i=f[o>>2]|0;if((t|0)>(i|0))f[o>>2]=t;else t=i;n=n+4|0;e:do{if((t|0)<(r|0)){while(1){if((t|0)>=(f[n>>2]|0))break e;if(ko(e,1)|0)break;t=t+1|0;if((t|0)>=(r|0))break e}f[n>>2]=t}}while(0);f[o>>2]=t;if((a|0)==(s|0))break;o=a+-4|0;n=f[o>>2]|0;a=o}b=l;return(f[n>>2]|0)<(r|0)|0}function vo(){var e=0,t=0;e=Yi(1,12)|0;if(!e){e=0;return e|0}f[e+4>>2]=10;t=Yi(10,4)|0;f[e+8>>2]=t;if(t){t=e;return t|0}Ji(e);t=0;return t|0}function yo(e){e=e|0;var t=0;if(!e)return;t=f[e+8>>2]|0;if(t)Ji(t);Ji(e);return}function _o(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;s=b;b=b+16|0;o=s;a=e+4|0;i=f[a>>2]|0;r=f[e>>2]|0;do{if((i|0)==(r|0)){i=i+10|0;f[a>>2]=i;r=e+8|0;i=Qi(f[r>>2]|0,i<<2)|0;if(i){f[r>>2]=i;r=f[e>>2]|0;break}Ji(f[r>>2]|0);f[a>>2]=0;f[e>>2]=0;Jr(n,1,20214,o)|0;e=0;b=s;return e|0}else i=f[e+8>>2]|0}while(0);f[i+(r<<2)>>2]=t;f[e>>2]=r+1;e=1;b=s;return e|0}function bo(e){e=e|0;return f[e>>2]|0}function Eo(e){e=e|0;return f[e+8>>2]|0}function wo(e){e=e|0;f[e>>2]=0;return}function xo(){return Xi(20)|0}function To(e){e=e|0;if(!e)return;Ji(e);return}function Ao(e){e=e|0;return(f[e+8>>2]|0)-(f[e>>2]|0)|0}function Mo(e,t,n){e=e|0;t=t|0;n=n|0;f[e>>2]=t;f[e+4>>2]=t+n;f[e+8>>2]=t;f[e+12>>2]=0;f[e+16>>2]=8;return}function So(e,t,n){e=e|0;t=t|0;n=n|0;f[e>>2]=t;f[e+4>>2]=t+n;f[e+8>>2]=t;f[e+12>>2]=0;f[e+16>>2]=0;return}function Ro(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0;if(!n)return;l=e+16|0;c=e+12|0;u=e+8|0;a=e+4|0;e=f[l>>2]|0;s=n+-1|0;do{o=t>>>s&1;if(!e){i=f[c>>2]|0;e=i<<8&65280;f[c>>2]=e;e=(e|0)==65280?7:8;f[l>>2]=e;r=f[u>>2]|0;if(r>>>0<(f[a>>2]|0)>>>0){f[u>>2]=r+1;h[r>>0]=i;e=f[l>>2]|0}}e=e+-1|0;f[l>>2]=e;f[c>>2]=o<<e|f[c>>2];s=s+-1|0}while(s>>>0<n>>>0);return}function ko(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0;if(!t){t=0;return t|0}s=e+16|0;l=e+12|0;c=e+8|0;a=e+4|0;n=f[s>>2]|0;r=f[l>>2]|0;o=t+-1|0;e=0;do{if(!n){i=r<<8&65280;f[l>>2]=i;n=(i|0)==65280?7:8;f[s>>2]=n;r=f[c>>2]|0;if(r>>>0<(f[a>>2]|0)>>>0){f[c>>2]=r+1;r=p[r>>0]|0|i;f[l>>2]=r}else r=i}n=n+-1|0;f[s>>2]=n;e=((r>>>n&1)<<o)+e|0;o=o+-1|0}while(o>>>0<t>>>0);return e|0}function Po(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0;r=e+12|0;t=f[r>>2]|0;o=t<<8&65280;f[r>>2]=o;i=e+16|0;f[i>>2]=(o|0)==65280?7:8;o=e+8|0;n=f[o>>2]|0;a=e+4|0;if(n>>>0>=(f[a>>2]|0)>>>0){o=0;return o|0}f[o>>2]=n+1;h[n>>0]=t;if((f[i>>2]|0)!=7){o=1;return o|0}t=f[r>>2]|0;e=t<<8&65280;f[r>>2]=e;f[i>>2]=(e|0)==65280?7:8;e=f[o>>2]|0;if(e>>>0>=(f[a>>2]|0)>>>0){o=0;return o|0}f[o>>2]=e+1;h[e>>0]=t;o=1;return o|0}function Lo(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;a=e+12|0;t=f[a>>2]|0;do{if((t&255|0)==255){r=t<<8&65280;f[a>>2]=r;t=e+16|0;f[t>>2]=(r|0)==65280?7:8;i=e+8|0;n=f[i>>2]|0;if(n>>>0<(f[e+4>>2]|0)>>>0){f[i>>2]=n+1;f[a>>2]=p[n>>0]|0|r;break}else{e=0;return e|0}}else t=e+16|0}while(0);f[t>>2]=0;e=1;return e|0}function Co(e){e=e|0;return Vo(e,1)|0}function Io(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0;k=b;b=b+32|0;S=k+16|0;R=k;l=f[e+24>>2]|0;s=(f[l+8>>2]|0)-(f[l>>2]|0)|0;o=(f[l+12>>2]|0)-(f[l+4>>2]|0)|0;M=(f[e+8>>2]|0)-(f[e>>2]|0)|0;if((t|0)==1){R=1;b=k;return R|0}a=t+-1|0;i=(a|0)==0;if(i)t=0;else{n=l;r=a;t=0;do{A=n;n=n+136|0;T=(f[A+144>>2]|0)-(f[n>>2]|0)|0;t=t>>>0<T>>>0?T:t;A=(f[A+148>>2]|0)-(f[A+140>>2]|0)|0;t=t>>>0<A>>>0?A:t;r=r+-1|0}while((r|0)!=0);t=t<<2}A=Ki(t)|0;f[S>>2]=A;if(!A){R=0;b=k;return R|0}f[R>>2]=A;if(!i){v=e+32|0;y=S+8|0;_=R+8|0;E=S+4|0;w=S+12|0;x=R+4|0;T=R+12|0;do{m=f[v>>2]|0;h=l;l=l+136|0;f[y>>2]=s;f[_>>2]=o;d=f[h+144>>2]|0;p=f[l>>2]|0;r=s;s=d-p|0;t=f[h+148>>2]|0;h=h+140|0;g=f[h>>2]|0;n=o;o=t-g|0;f[E>>2]=s-r;f[w>>2]=(p|0)%2|0;g=(t|0)==(g|0);if(!g){u=s<<2;t=0;while(1){e=ue(t,M)|0;c=m+(e<<2)|0;if(r){n=c;i=A+(f[w>>2]<<2)|0;while(1){r=r+-1|0;f[i>>2]=f[n>>2];if(!r)break;else{n=n+4|0;i=i+8|0}}}n=f[E>>2]|0;if(n){r=m+((f[y>>2]|0)+e<<2)|0;i=A+(1-(f[w>>2]|0)<<2)|0;while(1){n=n+-1|0;f[i>>2]=f[r>>2];if(!n)break;else{r=r+4|0;i=i+8|0}}}jo(S);Xl(c|0,A|0,u|0)|0;t=t+1|0;if((t|0)==(o|0))break;r=f[y>>2]|0}n=f[_>>2]|0;t=f[h>>2]|0}f[x>>2]=o-n;f[T>>2]=(t|0)%2|0;e:do{if((d|0)!=(p|0)){t=0;while(1){if(n){r=m+(t<<2)|0;i=A+(f[T>>2]<<2)|0;while(1){n=n+-1|0;f[i>>2]=f[r>>2];if(!n)break;else{r=r+(M<<2)|0;i=i+8|0}}}n=f[x>>2]|0;if(n){r=m+((ue(f[_>>2]|0,M)|0)+t<<2)|0;i=A+(1-(f[T>>2]|0)<<2)|0;while(1){n=n+-1|0;f[i>>2]=f[r>>2];if(!n)break;else{r=r+(M<<2)|0;i=i+8|0}}}jo(R);if(!g){n=0;do{p=m+((ue(n,M)|0)+t<<2)|0;f[p>>2]=f[A+(n<<2)>>2];n=n+1|0}while((n|0)!=(o|0))}t=t+1|0;if((t|0)==(s|0))break e;n=f[_>>2]|0}}}while(0);a=a+-1|0}while((a|0)!=0)}Zi(A);R=1;b=k;return R|0}function No(e){e=e|0;if(!e){e=0;return e|0}e=(e+-1|0)>>>0<2?1:2;return e|0}function Fo(e,t){e=e|0;t=t|0;return+ +y[56+(t*80|0)+(e<<3)>>3]}function Oo(e){e=e|0;return Vo(e,2)|0}function Ho(e){e=e|0;return 0}function Do(e,t){e=e|0;t=t|0;return+ +y[376+(t*80|0)+(e<<3)>>3]}function Uo(e,t){e=e|0;t=t|0;var n=0.0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0;l=e+4|0;c=((f[l>>2]|0)*3|0)+-2|0;if(!c)return;u=e+20|0;h=e+24|0;d=0;do{if(!d){r=0;i=0}else{i=d+-1|0;r=((i>>>0)/3|0)+1|0;i=((i>>>0)%3|0)+1|0}if((i|0)==0|(f[u>>2]|0)==0)a=0;else a=(i+-1|0)>>>0<2?1:2;if(!(f[h>>2]|0))n=1.0;else n=+(1<<a|0)/+y[376+(i*80|0)+((f[l>>2]|0)+~r<<3)>>3];s=~~+Z(+(n*8192.0));o=a+t|0;if((s|0)>1){r=s;i=0;while(1){r=r>>1;if((r|0)<=1)break;else i=i+1|0}a=s;r=0;do{a=a>>1;r=r+1|0}while((a|0)>1);i=i+-12|0}else{i=-13;r=0}a=11-r|0;f[e+28+(d<<3)+4>>2]=((a|0)<0?s>>0-a:s<<a)&2047;f[e+28+(d<<3)>>2]=o-i;d=d+1|0}while((d|0)!=(c|0));return}function Bo(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0;W=b;b=b+32|0;V=W+16|0;j=W;u=f[e+24>>2]|0;h=f[u+8>>2]|0;d=f[u>>2]|0;l=f[u+12>>2]|0;c=f[u+4>>2]|0;z=e+8|0;o=f[z>>2]|0;s=f[e>>2]|0;B=o-s|0;a=t+-1|0;i=(a|0)==0;if(i)t=80;else{n=u;r=a;t=0;do{U=n;n=n+136|0;D=(f[U+144>>2]|0)-(f[n>>2]|0)|0;t=t>>>0<D>>>0?D:t;U=(f[U+148>>2]|0)-(f[U+140>>2]|0)|0;t=t>>>0<U>>>0?U:t;r=r+-1|0}while((r|0)!=0);t=(t<<4)+80|0}U=Ki(t)|0;f[V>>2]=U;if(!U){G=0;b=W;return G|0}f[j>>2]=U;e:do{if(!i){T=e+32|0;A=e+12|0;M=e+4|0;S=V+8|0;R=j+8|0;k=V+4|0;P=V+12|0;L=j+4|0;C=j+12|0;I=B<<1;N=B<<2;F=B*3|0;H=s<<2;D=o<<2;O=H-D|0;H=D-H|0;D=o-s<<2;t=a;n=U;a=o;r=s;g=l-c|0;i=u;o=h-d|0;while(1){v=f[T>>2]|0;r=ue((f[A>>2]|0)-(f[M>>2]|0)|0,a-r|0)|0;f[S>>2]=o;f[R>>2]=g;w=i+136|0;p=f[i+144>>2]|0;m=f[w>>2]|0;x=p-m|0;_=f[i+148>>2]|0;h=i+140|0;y=f[h>>2]|0;E=_-y|0;f[k>>2]=x-o;f[P>>2]=(m|0)%2|0;if((E|0)>3){a=(x|0)>0;o=(_+-4-y|0)>>>2;u=ue(O,o)|0;o=v+(H+(ue(D,o)|0)<<2)|0;s=v;l=r;c=E;while(1){Wo(V,s,B,l);qo(V);if(a){i=x;do{d=i;i=i+-1|0;f[s+(i<<2)>>2]=f[U+(i<<4)>>2];f[s+(i+B<<2)>>2]=f[U+(i<<4)+4>>2];f[s+(i+I<<2)>>2]=f[U+(i<<4)+8>>2];f[s+(i+F<<2)>>2]=f[U+(i<<4)+12>>2]}while((d|0)>1)}c=c+-4|0;if((c|0)<=3)break;else{s=s+(N<<2)|0;l=l-N|0}}r=O+r+u|0}else o=v;a=E&3;t:do{if(!a)G=21;else{Wo(V,o,B,r);qo(V);if((x|0)>0)r=x;else{l=E-g|0;f[L>>2]=l;a=(f[h>>2]|0)%2|0;f[C>>2]=a;c=g;s=v;break}while(1){i=r;r=r+-1|0;switch(a|0){case 3:{f[o+(r+I<<2)>>2]=f[U+(r<<4)+8>>2];G=18;break}case 2:{G=18;break}case 1:{G=19;break}default:{}}if((G|0)==18){f[o+(r+B<<2)>>2]=f[U+(r<<4)+4>>2];G=19}if((G|0)==19){G=0;f[o+(r<<2)>>2]=f[U+(r<<4)>>2]}if((i|0)<=1){G=21;break t}}}}while(0);if((G|0)==21){G=0;l=E-g|0;f[L>>2]=l;a=(f[h>>2]|0)%2|0;f[C>>2]=a;if((x|0)>3){d=(_|0)==(y|0);p=p+-4-m|0;h=f[R>>2]|0;c=(h|0)>0;s=1-a|0;u=(l|0)>0;i=v;o=x;while(1){if(c){r=0;do{g=n+((r<<1)+a<<4)|0;m=i+((ue(r,B)|0)<<2)|0;f[g>>2]=f[m>>2];f[g+4>>2]=f[m+4>>2];f[g+8>>2]=f[m+8>>2];f[g+12>>2]=f[m+12>>2];r=r+1|0}while((r|0)!=(h|0))}if(u){r=0;do{g=n+(s+(r<<1)<<4)|0;m=i+((ue(r+h|0,B)|0)<<2)|0;f[g>>2]=f[m>>2];f[g+4>>2]=f[m+4>>2];f[g+8>>2]=f[m+8>>2];f[g+12>>2]=f[m+12>>2];r=r+1|0}while((r|0)!=(l|0))}qo(j);if(!d){n=f[j>>2]|0;r=0;do{g=i+((ue(r,B)|0)<<2)|0;m=n+(r<<4)|0;f[g>>2]=f[m>>2];f[g+4>>2]=f[m+4>>2];f[g+8>>2]=f[m+8>>2];f[g+12>>2]=f[m+12>>2];r=r+1|0}while((r|0)!=(E|0))}o=o+-4|0;if((o|0)<=3)break;else i=i+16|0}c=h;s=v+((p+4&-4)<<2)|0}else{c=g;s=v}}o=x&3;if(o){n=f[j>>2]|0;if((c|0)>0){r=o<<2;i=0;do{Xl(n+((i<<1)+a<<4)|0,s+((ue(i,B)|0)<<2)|0,r|0)|0;i=i+1|0}while((i|0)!=(c|0))}r=1-a|0;if((l|0)>0){i=o<<2;a=0;do{Xl(n+(r+(a<<1)<<4)|0,s+((ue(a+c|0,B)|0)<<2)|0,i|0)|0;a=a+1|0}while((a|0)!=(l|0))}qo(j);if((_|0)!=(y|0)){r=o<<2;i=0;do{Xl(s+((ue(i,B)|0)<<2)|0,n+(i<<4)|0,r|0)|0;i=i+1|0}while((i|0)!=(E|0))}}t=t+-1|0;if(!t)break e;a=f[z>>2]|0;r=f[e>>2]|0;g=E;i=w;o=x}}}while(0);Zi(U);G=1;b=W;return G|0}function zo(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;if(!r){r=(t|0)>0;if(!(r|(n|0)>1))return;if(r){r=e+((n<<1)+-2<<2)|0;i=0;do{l=i;i=i+1|0;c=e+((l<<1|1)<<2)|0;f[c>>2]=(f[c>>2]|0)-((f[((i|0)<(n|0)?e+(i<<1<<2)|0:r)>>2]|0)+(f[((l|0)<(n|0)?e+(l<<1<<2)|0:r)>>2]|0)>>1)}while((i|0)!=(t|0))}if((n|0)<=0)return;i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)r=i;else r=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;c=e+(o<<1<<2)|0;f[c>>2]=((f[r>>2]|0)+2+(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)>>2)+(f[c>>2]|0);o=o+1|0}while((o|0)!=(n|0));return}if((t|0)==1&(n|0)==0){f[e>>2]=f[e>>2]<<1;return}if((t|0)>0){i=e+4|0;a=(n<<1)+-1|0;o=e+(a<<2)|0;c=0;do{s=c<<1;l=f[e+(((c|0)<(n|0)?s|1:a)<<2)>>2]|0;if((c|0)>=1)if((c|0)>(n|0))r=o;else r=e+(s+-1<<2)|0;else r=i;s=e+(s<<2)|0;f[s>>2]=(f[s>>2]|0)-((f[r>>2]|0)+l>>1);c=c+1|0}while((c|0)!=(t|0))}if((n|0)<=0)return;r=e+((t<<1)+-2<<2)|0;i=0;do{l=i;i=i+1|0;c=e+((l<<1|1)<<2)|0;f[c>>2]=((f[((l|0)<(t|0)?e+(l<<1<<2)|0:r)>>2]|0)+2+(f[((i|0)<(t|0)?e+(i<<1<<2)|0:r)>>2]|0)>>2)+(f[c>>2]|0)}while((i|0)!=(n|0));return}function Vo(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0;w=(f[e+8>>2]|0)-(f[e>>2]|0)|0;a=f[e+16>>2]|0;s=a+-1|0;x=f[e+32>>2]|0;o=f[e+24>>2]|0;i=(s|0)==0;if(i)e=0;else{n=o;r=s;e=0;do{E=n;n=n+136|0;b=(f[E+144>>2]|0)-(f[n>>2]|0)|0;e=e>>>0<b>>>0?b:e;E=(f[E+148>>2]|0)-(f[E+140>>2]|0)|0;e=e>>>0<E>>>0?E:e;r=r+-1|0}while((r|0)!=0);e=e<<2}E=Xi(e)|0;if(!((e|0)==0|(E|0)!=0)){t=0;return t|0}if(!i){_=a+-2|0;b=_;e=o+(s*136|0)|0;_=o+(_*136|0)|0;while(1){g=f[e>>2]|0;y=(f[e+8>>2]|0)-g|0;h=f[e+4>>2]|0;p=(f[e+12>>2]|0)-h|0;m=(f[_+8>>2]|0)-(f[_>>2]|0)|0;e=f[_+12>>2]|0;n=f[_+4>>2]|0;u=e-n|0;g=g&1;h=h&1;d=p-u|0;v=(y|0)>0;e:do{if(v){i=(e|0)==(n|0);s=(p|0)==(u|0);l=E+((h^1)<<2)|0;c=ue(u,w)|0;o=E+(h<<2)|0;if((p|0)>0){a=0;while(1){n=x+(a<<2)|0;e=0;do{r=x+((ue(e,w)|0)+a<<2)|0;f[E+(e<<2)>>2]=f[r>>2];e=e+1|0}while((e|0)!=(p|0));Bc[t&3](E,d,u,h);if(!i){r=u;e=o;while(1){r=r+-1|0;f[n>>2]=f[e>>2];if(!r)break;else{n=n+(w<<2)|0;e=e+8|0}}}if(!s){e=d;n=x+(a+c<<2)|0;r=l;while(1){e=e+-1|0;f[n>>2]=f[r>>2];if(!e)break;else{n=n+(w<<2)|0;r=r+8|0}}}a=a+1|0;if((a|0)==(y|0))break e}}if(i){n=0;while(1){Bc[t&3](E,d,u,h);if(!s){e=d;r=x+(n+c<<2)|0;i=l;while(1){e=e+-1|0;f[r>>2]=f[i>>2];if(!e)break;else{r=r+(w<<2)|0;i=i+8|0}}}n=n+1|0;if((n|0)==(y|0))break e}}else i=0;do{Bc[t&3](E,d,u,h);e=u;n=x+(i<<2)|0;r=o;while(1){e=e+-1|0;f[n>>2]=f[r>>2];if(!e)break;else{n=n+(w<<2)|0;r=r+8|0}}if(!s){e=d;n=x+(i+c<<2)|0;r=l;while(1){e=e+-1|0;f[n>>2]=f[r>>2];if(!e)break;else{n=n+(w<<2)|0;r=r+8|0}}}i=i+1|0}while((i|0)!=(y|0))}}while(0);a=y-m|0;if((p|0)>0){o=(m|0)>0;s=E+(g<<2)|0;l=(a|0)>0;c=E+((g^1)<<2)|0;u=0;do{i=ue(u,w)|0;n=x+(i<<2)|0;if(v){e=0;do{f[E+(e<<2)>>2]=f[x+(e+i<<2)>>2];e=e+1|0}while((e|0)!=(y|0))}Bc[t&3](E,a,m,g);if(o){r=0;e=s;while(1){f[n>>2]=f[e>>2];r=r+1|0;if((r|0)==(m|0))break;else{n=n+4|0;e=e+8|0}}}if(l){r=0;e=x+(i+m<<2)|0;n=c;while(1){f[e>>2]=f[n>>2];r=r+1|0;if((r|0)==(a|0))break;else{e=e+4|0;n=n+8|0}}}u=u+1|0}while((u|0)!=(p|0))}if(!b)break;else{e=_;b=b+-1|0;_=_+-136|0}}}Ji(E);t=1;return t|0}function jo(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0;s=f[e>>2]|0;l=f[e+4>>2]|0;c=f[e+8>>2]|0;if(!(f[e+12>>2]|0)){r=(l|0)>0;if(!(r|(c|0)>1))return;if((c|0)>0){t=s+4|0;n=(l<<1)+-1|0;i=0;do{if((i|0)<1)e=t;else e=s+((((i|0)>(l|0)?l:i)<<1)+-1<<2)|0;a=i<<1;o=s+(a<<2)|0;f[o>>2]=(f[o>>2]|0)-((f[e>>2]|0)+2+(f[s+(((i|0)<(l|0)?a|1:n)<<2)>>2]|0)>>2);i=i+1|0}while((i|0)!=(c|0))}if(!r)return;e=s+((c<<1)+-2<<2)|0;t=0;do{a=t<<1;i=t;t=t+1|0;o=s+((a|1)<<2)|0;f[o>>2]=((f[((t|0)<(c|0)?s+(t<<1<<2)|0:e)>>2]|0)+(f[((i|0)<(c|0)?s+(a<<2)|0:e)>>2]|0)>>1)+(f[o>>2]|0)}while((t|0)!=(l|0));return}if((l|0)==1&(c|0)==0){f[s>>2]=(f[s>>2]|0)/2|0;return}if((c|0)>0){e=s+((l<<1)+-2<<2)|0;t=0;do{a=t<<1;i=t;t=t+1|0;o=s+((a|1)<<2)|0;f[o>>2]=(f[o>>2]|0)-((f[((i|0)<(l|0)?s+(a<<2)|0:e)>>2]|0)+2+(f[((t|0)<(l|0)?s+(t<<1<<2)|0:e)>>2]|0)>>2)}while((t|0)!=(c|0))}if((l|0)<=0)return;t=s+4|0;n=(c<<1)+-1|0;r=s+(n<<2)|0;o=0;do{i=o<<1;a=f[s+(((o|0)<(c|0)?i|1:n)<<2)>>2]|0;if((o|0)>=1)if((o|0)>(c|0))e=r;else e=s+(i+-1<<2)|0;else e=t;i=s+(i<<2)|0;f[i>>2]=((f[e>>2]|0)+a>>1)+(f[i>>2]|0);o=o+1|0}while((o|0)!=(l|0));return}function Go(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0;if(!r){l=(t|0)>0;if(!(l|(n|0)>1))return;if(l){r=e+((n<<1)+-2<<2)|0;i=0;do{h=i;i=i+1|0;u=(f[((i|0)<(n|0)?e+(i<<1<<2)|0:r)>>2]|0)+(f[((h|0)<(n|0)?e+(h<<1<<2)|0:r)>>2]|0)|0;u=Jl(u|0,((u|0)<0)<<31>>31|0,12993,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=ql(u|0,B|0,13)|0;h=e+((h<<1|1)<<2)|0;f[h>>2]=(f[h>>2]|0)-u}while((i|0)!=(t|0))}s=(n|0)>0;if(s){i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)r=i;else r=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;u=(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)+(f[r>>2]|0)|0;u=Jl(u|0,((u|0)<0)<<31>>31|0,434,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=ql(u|0,B|0,13)|0;h=e+(o<<1<<2)|0;f[h>>2]=(f[h>>2]|0)-u;o=o+1|0}while((o|0)!=(n|0))}if(l){r=e+((n<<1)+-2<<2)|0;i=0;do{h=i;i=i+1|0;u=(f[((i|0)<(n|0)?e+(i<<1<<2)|0:r)>>2]|0)+(f[((h|0)<(n|0)?e+(h<<1<<2)|0:r)>>2]|0)|0;u=Jl(u|0,((u|0)<0)<<31>>31|0,7233,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=ql(u|0,B|0,13)|0;h=e+((h<<1|1)<<2)|0;f[h>>2]=u+(f[h>>2]|0)}while((i|0)!=(t|0))}if(s){i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)r=i;else r=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;u=(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)+(f[r>>2]|0)|0;u=Jl(u|0,((u|0)<0)<<31>>31|0,3633,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=ql(u|0,B|0,13)|0;h=e+(o<<1<<2)|0;f[h>>2]=u+(f[h>>2]|0);o=o+1|0}while((o|0)!=(n|0))}if(l){r=0;do{h=e+((r<<1|1)<<2)|0;u=f[h>>2]|0;u=Jl(u|0,((u|0)<0)<<31>>31|0,5038,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=ql(u|0,B|0,13)|0;f[h>>2]=u;r=r+1|0}while((r|0)!=(t|0))}if(s)r=0;else return;do{t=e+(r<<1<<2)|0;h=f[t>>2]|0;h=Jl(h|0,((h|0)<0)<<31>>31|0,6659,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=ql(h|0,B|0,13)|0;f[t>>2]=h;r=r+1|0}while((r|0)!=(n|0));return}h=(n|0)>0;if(!((t|0)>1|h))return;u=(t|0)>0;if(u){i=e+4|0;a=(n<<1)+-1|0;o=e+(a<<2)|0;c=0;do{s=c<<1;l=f[e+(((c|0)<(n|0)?s|1:a)<<2)>>2]|0;if((c|0)>=1)if((c|0)>(n|0))r=o;else r=e+(s+-1<<2)|0;else r=i;r=(f[r>>2]|0)+l|0;r=Jl(r|0,((r|0)<0)<<31>>31|0,12993,0)|0;r=Wl(r|0,B|0,4096,0)|0;r=ql(r|0,B|0,13)|0;l=e+(s<<2)|0;f[l>>2]=(f[l>>2]|0)-r;c=c+1|0}while((c|0)!=(t|0))}if(h){r=e+((t<<1)+-2<<2)|0;i=0;do{c=i;i=i+1|0;l=(f[((i|0)<(t|0)?e+(i<<1<<2)|0:r)>>2]|0)+(f[((c|0)<(t|0)?e+(c<<1<<2)|0:r)>>2]|0)|0;l=Jl(l|0,((l|0)<0)<<31>>31|0,434,0)|0;l=Wl(l|0,B|0,4096,0)|0;l=ql(l|0,B|0,13)|0;c=e+((c<<1|1)<<2)|0;f[c>>2]=(f[c>>2]|0)-l}while((i|0)!=(n|0))}if(u){i=e+4|0;a=(n<<1)+-1|0;o=e+(a<<2)|0;c=0;do{s=c<<1;l=f[e+(((c|0)<(n|0)?s|1:a)<<2)>>2]|0;if((c|0)>=1)if((c|0)>(n|0))r=o;else r=e+(s+-1<<2)|0;else r=i;r=(f[r>>2]|0)+l|0;r=Jl(r|0,((r|0)<0)<<31>>31|0,7233,0)|0;r=Wl(r|0,B|0,4096,0)|0;r=ql(r|0,B|0,13)|0;l=e+(s<<2)|0;f[l>>2]=r+(f[l>>2]|0);c=c+1|0}while((c|0)!=(t|0))}if(h){r=e+((t<<1)+-2<<2)|0;i=0;do{c=i;i=i+1|0;l=(f[((i|0)<(t|0)?e+(i<<1<<2)|0:r)>>2]|0)+(f[((c|0)<(t|0)?e+(c<<1<<2)|0:r)>>2]|0)|0;l=Jl(l|0,((l|0)<0)<<31>>31|0,3633,0)|0;l=Wl(l|0,B|0,4096,0)|0;l=ql(l|0,B|0,13)|0;c=e+((c<<1|1)<<2)|0;f[c>>2]=l+(f[c>>2]|0)}while((i|0)!=(n|0))}if(u){r=0;do{u=e+(r<<1<<2)|0;c=f[u>>2]|0;c=Jl(c|0,((c|0)<0)<<31>>31|0,5038,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=ql(c|0,B|0,13)|0;f[u>>2]=c;r=r+1|0}while((r|0)!=(t|0))}if(h)r=0;else return;do{t=e+((r<<1|1)<<2)|0;h=f[t>>2]|0;h=Jl(h|0,((h|0)<0)<<31>>31|0,6659,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=ql(h|0,B|0,13)|0;f[t>>2]=h;r=r+1|0}while((r|0)!=(n|0));return}function Wo(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0;h=f[e>>2]|0;s=f[e+12>>2]|0;g=f[e+8>>2]|0;d=n*3|0;u=1-s|0;c=e+4|0;l=g;e=0;while(1){o=h+(s<<4)|0;if(((l+d|0)<(r|0)?(t&15|0)==0:0)?((o|n)&15|0)==0:0){if((l|0)>0){i=0;do{o=i<<3;f[h+(s<<4)+(o<<2)>>2]=f[t+(i<<2)>>2];a=i+n|0;f[h+(s<<4)+((o|1)<<2)>>2]=f[t+(a<<2)>>2];a=a+n|0;f[h+(s<<4)+((o|2)<<2)>>2]=f[t+(a<<2)>>2];f[h+(s<<4)+((o|3)<<2)>>2]=f[t+(a+n<<2)>>2];i=i+1|0}while((i|0)!=(l|0))}}else v=3;if((v|0)==3?(v=0,(l|0)>0):0){o=0;do{i=o<<3;f[h+(s<<4)+(i<<2)>>2]=f[t+(o<<2)>>2];a=o+n|0;if(((a|0)<(r|0)?(f[h+(s<<4)+((i|1)<<2)>>2]=f[t+(a<<2)>>2],p=a+n|0,(p|0)<(r|0)):0)?(f[h+(s<<4)+((i|2)<<2)>>2]=f[t+(p<<2)>>2],m=p+n|0,(m|0)<(r|0)):0)f[h+(s<<4)+((i|3)<<2)>>2]=f[t+(m<<2)>>2];o=o+1|0}while((o|0)!=(l|0))}e=e+1|0;if((e|0)==2)break;else{t=t+(g<<2)|0;r=r-g|0;s=u;l=f[c>>2]|0}}return}function qo(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0.0,c=0.0,u=0,h=0.0,d=0,p=0;do{if(!(f[e+12>>2]|0)){n=f[e+8>>2]|0;if((f[e+4>>2]|0)>0){t=f[e>>2]|0;if((n|0)>0){o=0;i=1;s=9;break}else{o=0;a=1;break}}if((n|0)>1){r=0;i=1;s=7}else return}else{n=f[e+8>>2]|0;if((n|0)<=0)if((f[e+4>>2]|0)>1){t=f[e>>2]|0;o=1;a=0;break}else return;else{r=1;i=0;s=7}}}while(0);if((s|0)==7){t=f[e>>2]|0;o=r;s=9}if((s|0)==9){r=0;do{s=r<<3;d=t+(o<<4)+(s<<2)|0;u=t+(o<<4)+((s|1)<<2)|0;h=+v[u>>2];a=t+(o<<4)+((s|2)<<2)|0;c=+v[a>>2];s=t+(o<<4)+((s|3)<<2)|0;l=+v[s>>2];v[d>>2]=+v[d>>2]*1.2301740646362305;v[u>>2]=h*1.2301740646362305;v[a>>2]=c*1.2301740646362305;v[s>>2]=l*1.2301740646362305;r=r+1|0}while((r|0)!=(n|0));a=i}r=f[e+4>>2]|0;if((r|0)>0){i=0;do{d=i<<3;s=t+(a<<4)+(d<<2)|0;e=t+(a<<4)+((d|1)<<2)|0;l=+v[e>>2];u=t+(a<<4)+((d|2)<<2)|0;c=+v[u>>2];d=t+(a<<4)+((d|3)<<2)|0;h=+v[d>>2];v[s>>2]=+v[s>>2]*1.625732421875;v[e>>2]=l*1.625732421875;v[u>>2]=c*1.625732421875;v[d>>2]=h*1.625732421875;i=i+1|0}while((i|0)!=(r|0))}p=t+(a<<4)|0;i=t+(o+1<<4)|0;s=r-o|0;s=(n|0)<(s|0)?n:s;Xo(p,i,n,s,-.4435068666934967);e=t+(o<<4)|0;u=t+(a+1<<4)|0;d=n-a|0;d=(r|0)<(d|0)?r:d;Xo(e,u,r,d,-.8829110860824585);Xo(p,i,n,s,.05298011749982834);Xo(e,u,r,d,1.5861343145370483);return}function Xo(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=+i;var a=0.0,o=0.0,s=0.0,l=0.0,c=0,u=0,h=0,d=0,f=0.0,p=0.0,m=0,g=0.0,y=0.0,_=0,b=0.0,E=0.0,w=0,x=0.0;if((r|0)>0){h=r<<1;u=h+-2|0;o=+v[e>>2];s=+v[e+4>>2];l=+v[e+8>>2];a=+v[e+12>>2];e=t;c=0;while(1){w=e+-16|0;_=e+-12|0;E=+v[_>>2];m=e+-8|0;y=+v[m>>2];d=e+-4|0;p=+v[d>>2];x=o;o=+v[e>>2];b=s;s=+v[e+4>>2];g=l;l=+v[e+8>>2];f=a;a=+v[e+12>>2];v[w>>2]=+v[w>>2]+(x+o)*i;v[_>>2]=E+(b+s)*i;v[m>>2]=y+(g+l)*i;v[d>>2]=p+(f+a)*i;c=c+1|0;if((c|0)==(r|0))break;else e=e+32|0}e=t+(u<<4)|0;t=t+(h<<4)|0}if((r|0)>=(n|0))return;a=i+i;o=a*+v[e>>2];s=a*+v[e+4>>2];l=a*+v[e+8>>2];a=a*+v[e+12>>2];while(1){d=t+-16|0;m=t+-12|0;b=+v[m>>2];_=t+-8|0;E=+v[_>>2];w=t+-4|0;x=+v[w>>2];v[d>>2]=o+ +v[d>>2];v[m>>2]=s+b;v[_>>2]=l+E;v[w>>2]=a+x;r=r+1|0;if((r|0)==(n|0))break;else t=t+32|0}return}function Yo(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0.0,o=0,s=0,l=0,c=0,u=0,h=0,d=0.0,p=0,m=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0;x=n<<2;T=Xi(n<<4)|0;if(!T){e=0;return e|0}A=T+x|0;jl(T|0,0,x|0)|0;E=n+-1|0;b=(n|0)==0;if(!b){r=0;i=T;while(1){f[i>>2]=r;r=r+1|0;if((r|0)==(n|0))break;else i=i+4|0}}e:do{if(E){m=E;s=0;r=0;g=e;y=1;_=T;while(1){l=g+(s<<2)|0;if(s>>>0<n>>>0){o=s;i=l;a=0.0}else break;while(1){d=+v[i>>2];d=d>0.0?d:-d;w=d>a;r=w?o:r;a=w?d:a;o=o+1|0;if((o|0)==(n|0))break;else i=i+(n<<2)|0}if(a==0.0)break;if((r|0)!=(s|0)){w=r-s|0;p=_+(w<<2)|0;h=f[_>>2]|0;f[_>>2]=f[p>>2];f[p>>2]=h;w=g+((ue(w,n)|0)<<2)|0;Xl(A|0,w|0,x|0)|0;Xl(w|0,g|0,x|0)|0;Xl(g|0,A|0,x|0)|0}i=s;p=s+1|0;d=+v[l>>2];if(y>>>0<n>>>0){c=g+(p<<2)|0;h=p+m|0;u=y;o=g+(i+n<<2)|0;while(1){a=+v[o>>2]/d;v[o>>2]=a;i=y;s=o;l=c;while(1){s=s+4|0;v[s>>2]=+v[s>>2]-a*+v[l>>2];i=i+1|0;if((i|0)==(n|0))break;else l=l+4|0}u=u+1|0;if((u|0)==(n|0))break;else o=o+(h<<2)|0}}if(p>>>0<E>>>0){m=m+-1|0;s=p;g=g+(n<<2)|0;y=y+1|0;_=_+4|0}else break e}Ji(T);e=0;return e|0}}while(0);r=n<<1;w=A+(r<<2)|0;if(!b){b=A+(E+n<<2)|0;m=A+(r+E<<2)|0;g=e+((ue(n,n)|0)+-1<<2)|0;y=~n;_=0;p=t;while(1){jl(A|0,0,x|0)|0;v[A+(_<<2)>>2]=1.0;s=0;l=1;c=T;u=w;h=e;while(1){if(!s)a=0.0;else{r=1;i=w;o=h;a=0.0;while(1){a=a+ +v[o>>2]*+v[i>>2];r=r+1|0;if((r|0)==(l|0))break;else{i=i+4|0;o=o+4|0}}}v[u>>2]=+v[A+(f[c>>2]<<2)>>2]-a;s=s+1|0;if((s|0)==(n|0)){s=n;l=b;c=w;u=m;h=g;break}else{l=l+1|0;c=c+4|0;u=u+4|0;h=h+(n<<2)|0}}while(1){r=s;s=s+-1|0;d=+v[h>>2];if(r>>>0<n>>>0){i=c;o=h;a=0.0;while(1){o=o+4|0;a=a+ +v[o>>2]*+v[i>>2];r=r+1|0;if((r|0)==(n|0))break;else i=i+4|0}}else a=0.0;c=c+-4|0;v[l>>2]=(+v[u>>2]-a)/d;if(!s){r=0;i=p;break}else{l=l+-4|0;u=u+-4|0;h=h+(y<<2)|0}}while(1){f[i>>2]=f[A+(r+n<<2)>>2];r=r+1|0;if((r|0)==(n|0))break;else i=i+(n<<2)|0}_=_+1|0;if((_|0)==(n|0))break;else p=p+4|0}}Ji(T);e=1;return e|0}function Ko(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0;a=Yi(1,44)|0;if(!a){a=0;return a|0}o=ls()|0;f[a>>2]=o;if(!o){cs(0);f[a>>2]=0;o=a+4|0;As(f[o>>2]|0);f[o>>2]=0;if((f[a+40>>2]|0)==0?(n=a+8|0,t=f[n>>2]|0,(t|0)!=0):0){Zi(t);f[n>>2]=0}t=a+12|0;n=f[t>>2]|0;if(n){Zi(n);f[t>>2]=0}Ji(a);o=0;return o|0}o=Ts()|0;t=a+4|0;f[t>>2]=o;if(o){f[a+40>>2]=e;o=a;return o|0}cs(f[a>>2]|0);f[a>>2]=0;As(f[t>>2]|0);f[t>>2]=0;if((f[a+40>>2]|0)==0?(r=a+8|0,i=f[r>>2]|0,(i|0)!=0):0){Zi(i);f[r>>2]=0}t=a+12|0;n=f[t>>2]|0;if(n){Zi(n);f[t>>2]=0}Ji(a);o=0;return o|0}function Zo(e){e=e|0;var t=0,n=0,r=0;if(!e)return;cs(f[e>>2]|0);f[e>>2]=0;r=e+4|0;As(f[r>>2]|0);f[r>>2]=0;if((f[e+40>>2]|0)==0?(t=e+8|0,n=f[t>>2]|0,(n|0)!=0):0){Zi(n);f[t>>2]=0}t=e+12|0;n=f[t>>2]|0;if(n){Zi(n);f[t>>2]=0}Ji(e);return}function Qo(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Z=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Ae=0,Me=0,Se=0,Re=0,ke=0;Te=(f[t+8>>2]|0)-(f[t>>2]|0)|0;Ae=t+20|0;r=f[Ae>>2]|0;if(!r){e=1;return e|0}Me=t+24|0;Se=n+808|0;Re=n+16|0;_e=e+4|0;Ee=e+8|0;we=e+16|0;xe=e+20|0;ye=n+20|0;me=t+32|0;ge=e+32|0;ve=e+12|0;n=r;pe=0;e:while(1){de=f[Me>>2]|0;fe=de+(pe*136|0)+24|0;t=f[fe>>2]|0;if(t){le=de+(pe*136|0)+16|0;ce=de+(pe*136|0)+20|0;he=pe+-1|0;n=f[ce>>2]|0;r=f[le>>2]|0;se=0;do{if(ue(n,r)|0){ne=de+(pe*136|0)+28+(se*36|0)+20|0;re=de+(pe*136|0)+28+(se*36|0)+16|0;ie=de+(pe*136|0)+28+(se*36|0)|0;ae=de+(pe*136|0)+28+(se*36|0)+4|0;oe=de+(pe*136|0)+28+(se*36|0)+32|0;te=0;do{t=f[ne>>2]|0;$=t+(te*40|0)+16|0;ee=t+(te*40|0)+20|0;if(ue(f[ee>>2]|0,f[$>>2]|0)|0){Q=t+(te*40|0)+24|0;J=0;do{n=f[Q>>2]|0;G=f[re>>2]|0;i=f[Se>>2]|0;t=f[Re>>2]|0;W=f[_e>>2]|0;q=f[e>>2]|0;X=n+(J*56|0)+8|0;Z=n+(J*56|0)+12|0;if(!($o(e,(f[n+(J*56|0)+16>>2]|0)-(f[X>>2]|0)|0,(f[n+(J*56|0)+20>>2]|0)-(f[Z>>2]|0)|0)|0)){n=0;C=201;break e}Y=n+(J*56|0)+24|0;a=f[Y>>2]|0;vs(q);ys(q,18,0,46);ys(q,17,0,3);ys(q,0,0,4);K=n+(J*56|0)+48|0;r=f[K>>2]|0;if(r){U=n+(J*56|0)+4|0;B=(t&1|0)!=0;z=(t&2|0)==0;V=(t&8|0)==0;j=G<<8;D=(t&32|0)==0;t=a+i|0;n=2;H=0;do{a=f[U>>2]|0;O=B&(n>>>0<2?(t|0)<=((f[Y>>2]|0)+-4|0):0);i=f[a+(H<<5)>>2]|0;if(i){r=(f[i>>2]|0)+(f[a+(H<<5)+4>>2]|0)|0;i=f[a+(H<<5)+16>>2]|0;if(!O){if(!(ws(q,r,i)|0)){n=0;C=201;break e}}else Ms(W,r,i);N=a+(H<<5)+12|0;t:do{if(f[N>>2]|0){F=z|O;I=0;while(1){n:do{switch(n|0){case 0:{if(O){w=1<<t;w=w>>1|w;i=f[xe>>2]|0;if(!i)break n;E=0-w|0;r=f[we>>2]|0;b=0;while(1){_=b;b=b+4|0;if(!r)r=0;else{h=(_|0)==-4;g=_|3;y=0;do{r:do{if(!h)if(V){c=_;do{if(c>>>0>=(f[xe>>2]|0)>>>0)break r;s=c;c=c+1|0;r=(ue(f[ge>>2]|0,c)|0)+y|0;i=r+1|0;a=f[ve>>2]|0;o=a+(i<<1)|0;s=(ue(f[we>>2]|0,s)|0)+y|0;s=(f[Ee>>2]|0)+(s<<2)|0;l=f[_e>>2]|0;C=d[o>>1]|0;if((C&255|0)!=0&(C&20480|0)==0){if(Ss(l)|0){k=Ss(l)|0;f[s>>2]=(k|0)!=0?E:w;L=f[ge>>2]|0;C=a+(i-L<<1)|0;P=a+(L+i<<1)|0;R=a+(i+~L<<1)|0;d[R>>1]=m[R>>1]|2;d[C>>1]=d[C>>1]|d[3436+(k<<1)>>1];C=r+2|0;R=a+(C-L<<1)|0;d[R>>1]=m[R>>1]|4;R=a+(r<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+2<<1)>>1];d[o>>1]=m[o>>1]|4096;R=a+(C<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+4<<1)>>1];R=a+(L+r<<1)|0;d[R>>1]=m[R>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];C=a+(L+C<<1)|0;d[C>>1]=m[C>>1]|8}d[o>>1]=m[o>>1]|16384}}while(c>>>0<b>>>0)}else{u=_;do{r=f[xe>>2]|0;if(u>>>0>=r>>>0)break r;L=u;u=u+1|0;i=(ue(f[ge>>2]|0,u)|0)+y|0;a=i+1|0;o=f[ve>>2]|0;s=o+(a<<1)|0;l=(ue(f[we>>2]|0,L)|0)+y|0;l=(f[Ee>>2]|0)+(l<<2)|0;c=f[_e>>2]|0;C=d[s>>1]|0;C=(L|0)==(g|0)|(L|0)==(r+-1|0)?C&-1095:C;if((C&255|0)!=0&(C&20480|0)==0){if(Ss(c)|0){k=Ss(c)|0;f[l>>2]=(k|0)!=0?E:w;L=f[ge>>2]|0;C=o+(a-L<<1)|0;P=o+(L+a<<1)|0;R=o+(a+~L<<1)|0;d[R>>1]=m[R>>1]|2;d[C>>1]=d[C>>1]|d[3436+(k<<1)>>1];C=i+2|0;R=o+(C-L<<1)|0;d[R>>1]=m[R>>1]|4;R=o+(i<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+2<<1)>>1];d[s>>1]=m[s>>1]|4096;R=o+(C<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+4<<1)>>1];R=o+(L+i<<1)|0;d[R>>1]=m[R>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];C=o+(L+C<<1)|0;d[C>>1]=m[C>>1]|8}d[s>>1]=m[s>>1]|16384}}while(u>>>0<b>>>0)}}while(0);y=y+1|0;r=f[we>>2]|0}while(y>>>0<r>>>0);i=f[xe>>2]|0}if(b>>>0>=i>>>0){C=163;break n}}}if(V){a=f[Ee>>2]|0;o=(f[ve>>2]|0)+2|0;g=1<<t;g=g>>1|g;r=f[xe>>2]|0;i=f[we>>2]|0;if(r>>>0>3){c=i;l=0;while(1){if(!i){i=c;s=0}else{i=0;do{C=(f[ge>>2]|0)+i|0;es(e,o+(C<<1)|0,a+(i<<2)|0,G,g);r=(f[we>>2]|0)+i|0;C=(f[ge>>2]|0)+C|0;es(e,o+(C<<1)|0,a+(r<<2)|0,G,g);r=(f[we>>2]|0)+r|0;C=(f[ge>>2]|0)+C|0;es(e,o+(C<<1)|0,a+(r<<2)|0,G,g);es(e,o+((f[ge>>2]|0)+C<<1)|0,a+((f[we>>2]|0)+r<<2)|0,G,g);i=i+1|0;r=f[we>>2]|0}while(i>>>0<r>>>0);i=r;s=r;r=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=o+(f[ge>>2]<<2<<1)|0;l=l+4|0;if(l>>>0<(r&-4)>>>0){c=i;i=s}else{h=o;u=l;break}}}else{h=o;u=0}if(!i){C=163;break n}else c=0;while(1){if(u>>>0<r>>>0){o=a+(c<<2)|0;s=h+(c<<1)|0;l=u;while(1){s=s+(f[ge>>2]<<1)|0;es(e,s,o,G,g);i=f[we>>2]|0;l=l+1|0;r=f[xe>>2]|0;if(l>>>0>=r>>>0)break;else o=o+(i<<2)|0}}c=c+1|0;if(c>>>0>=i>>>0){C=163;break n}}}w=1<<t;w=w>>1|w;r=f[xe>>2]|0;if(!r){C=163;break n}x=0-w|0;i=f[we>>2]|0;o=i;E=0;while(1){b=E;E=E+4|0;do{if(!i){a=o;i=0}else{_=b|3;if((b|0)==-4){a=o;i=o;break}else y=0;do{g=b;do{r=f[xe>>2]|0;if(g>>>0>=r>>>0)break;C=g;g=g+1|0;o=(ue(f[ge>>2]|0,g)|0)+y|0;s=o+1|0;l=f[ve>>2]|0;c=l+(s<<1)|0;u=(ue(f[we>>2]|0,C)|0)+y|0;u=(f[Ee>>2]|0)+(u<<2)|0;h=f[e>>2]|0;i=d[c>>1]|0;r=(C|0)==(_|0)|(C|0)==(r+-1|0)?i&-1095:i;i=r&255;if((i|0)!=0&(r&20480|0)==0){a=h+100|0;f[a>>2]=h+24+(p[20267+(i|j)>>0]<<2);if(xs(h)|0){L=r>>>4&255;f[a>>2]=h+24+(p[21291+L>>0]<<2);C=xs(h)|0;L=p[21547+L>>0]|0;k=L^C;f[u>>2]=(C|0)!=(L|0)?x:w;L=f[ge>>2]|0;C=l+(s-L<<1)|0;P=l+(L+s<<1)|0;R=l+(s+~L<<1)|0;d[R>>1]=m[R>>1]|2;d[C>>1]=d[C>>1]|d[3436+(k<<1)>>1];C=o+2|0;R=l+(C-L<<1)|0;d[R>>1]=m[R>>1]|4;R=l+(o<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+2<<1)>>1];d[c>>1]=m[c>>1]|4096;R=l+(C<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+4<<1)>>1];R=l+(L+o<<1)|0;d[R>>1]=m[R>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];C=l+(L+C<<1)|0;d[C>>1]=m[C>>1]|8}d[c>>1]=m[c>>1]|16384}}while(g>>>0<E>>>0);y=y+1|0;r=f[we>>2]|0}while(y>>>0<r>>>0);a=r;i=r;r=f[xe>>2]|0}}while(0);if(E>>>0>=r>>>0){C=163;break}else o=a}break}case 1:{if(O){h=1<<t>>1;g=(t|0)>0?0-h|0:-1;i=f[xe>>2]|0;if(!i)break n;a=f[we>>2]|0;r=a;u=0;while(1){c=u;u=u+4|0;if(!a){o=r;a=0}else{l=(c|0)==-4;s=0;do{o=s;s=s+1|0;if(!l){a=c;do{if(a>>>0>=(f[xe>>2]|0)>>>0)break;i=a;a=a+1|0;r=(ue(f[ge>>2]|0,a)|0)+s|0;r=(f[ve>>2]|0)+(r<<1)|0;i=(ue(f[we>>2]|0,i)|0)+o|0;i=(f[Ee>>2]|0)+(i<<2)|0;if((d[r>>1]&20480)==4096){L=(Ss(f[_e>>2]|0)|0)!=0;L=L?h:g;C=f[i>>2]|0;f[i>>2]=((C|0)<0?0-L|0:L)+C;d[r>>1]=m[r>>1]|8192}}while(a>>>0<u>>>0);r=f[we>>2]|0}}while(s>>>0<r>>>0);o=r;a=r;i=f[xe>>2]|0}if(u>>>0>=i>>>0){C=163;break n}else r=o}}if(!V){_=1<<t>>1;b=(t|0)>0?0-_|0:-1;r=f[xe>>2]|0;if(!r){C=163;break n}i=f[we>>2]|0;a=i;y=0;while(1){g=y;y=y+4|0;if(!i)i=0;else{u=(g|0)==-4;h=g|3;r=a;c=0;do{l=c;c=c+1|0;if(!u){o=g;do{r=f[xe>>2]|0;if(o>>>0>=r>>>0)break;L=o;o=o+1|0;i=(ue(f[ge>>2]|0,o)|0)+c|0;i=(f[ve>>2]|0)+(i<<1)|0;a=(ue(f[we>>2]|0,L)|0)+l|0;a=(f[Ee>>2]|0)+(a<<2)|0;s=f[e>>2]|0;C=d[i>>1]|0;r=(L|0)==(h|0)|(L|0)==(r+-1|0)?C&-1095:C;if((r&20480|0)==4096){f[s+100>>2]=s+24+(((r&8192|0)!=0?16:(r&255|0)!=0?15:14)<<2);L=(xs(s)|0)!=0;L=L?_:b;C=f[a>>2]|0;f[a>>2]=((C|0)<0?0-L|0:L)+C;d[i>>1]=m[i>>1]|8192}}while(o>>>0<y>>>0);r=f[we>>2]|0}}while(c>>>0<r>>>0);a=r;i=r;r=f[xe>>2]|0}if(y>>>0>=r>>>0){C=163;break n}}}a=f[Ee>>2]|0;o=(f[ve>>2]|0)+2|0;E=1<<t>>1;w=(t|0)>0?0-E|0:-1;r=f[xe>>2]|0;i=f[we>>2]|0;if(r>>>0>3){l=i;_=o;b=0;while(1){if(!i){i=l;s=0}else{r=l;y=0;do{i=a+(y<<2)|0;l=f[ge>>2]|0;u=l+y|0;o=_+(u<<1)|0;c=f[e>>2]|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[c+100>>2]=c+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);l=(xs(c)|0)!=0;l=l?E:w;r=f[i>>2]|0;f[i>>2]=((r|0)<0?0-l|0:l)+r;d[o>>1]=m[o>>1]|8192;r=f[we>>2]|0;i=f[ge>>2]|0;l=f[e>>2]|0}else{i=l;l=c}h=r+y|0;c=a+(h<<2)|0;g=i+u|0;o=_+(g<<1)|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);i=(xs(l)|0)!=0;i=i?E:w;r=f[c>>2]|0;f[c>>2]=((r|0)<0?0-i|0:i)+r;d[o>>1]=m[o>>1]|8192;r=f[we>>2]|0;i=f[ge>>2]|0;l=f[e>>2]|0}u=r+h|0;c=a+(u<<2)|0;h=i+g|0;o=_+(h<<1)|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);i=(xs(l)|0)!=0;i=i?E:w;r=f[c>>2]|0;f[c>>2]=((r|0)<0?0-i|0:i)+r;d[o>>1]=m[o>>1]|8192;r=f[we>>2]|0;i=f[ge>>2]|0;l=f[e>>2]|0}s=a+(r+u<<2)|0;i=_+(i+h<<1)|0;o=d[i>>1]|0;if((o&20480|0)==4096){f[l+100>>2]=l+24+(((o&8192|0)!=0?16:(o&255|0)!=0?15:14)<<2);C=(xs(l)|0)!=0;C=C?E:w;r=f[s>>2]|0;f[s>>2]=((r|0)<0?0-C|0:C)+r;d[i>>1]=m[i>>1]|8192;r=f[we>>2]|0}y=y+1|0}while(y>>>0<r>>>0);i=r;s=r;r=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=_+(f[ge>>2]<<2<<1)|0;c=b+4|0;if(c>>>0<(r&-4)>>>0){l=i;i=s;_=o;b=c}else{y=c;break}}}else y=0;if(!i){C=163;break n}else g=0;do{if(y>>>0<r>>>0){c=a+(g<<2)|0;u=o+(g<<1)|0;h=y;while(1){u=u+(f[ge>>2]<<1)|0;l=f[e>>2]|0;s=d[u>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);r=(xs(l)|0)!=0;r=r?E:w;s=f[c>>2]|0;f[c>>2]=((s|0)<0?0-r|0:r)+s;d[u>>1]=m[u>>1]|8192;s=f[we>>2]|0;r=f[xe>>2]|0}else s=i;h=h+1|0;if(h>>>0>=r>>>0){i=s;break}else{i=s;c=c+(s<<2)|0}}}g=g+1|0}while(g>>>0<i>>>0);C=163;break}case 2:{P=f[e>>2]|0;L=1<<t;L=L>>1|L;do{if(V){a=f[Ee>>2]|0;o=(f[ve>>2]|0)+2|0;i=f[xe>>2]|0;if(i>>>0>3){w=P+92|0;x=P+100|0;T=P+96|0;A=0-L|0;s=f[we>>2]|0;r=s;c=0;while(1){if(!s)s=0;else{g=c|1;y=g+1|0;_=c|3;b=g+3|0;E=0;do{r=f[ge>>2]|0;i=E;E=E+1|0;R=(ue(r,g)|0)+E|0;S=f[ve>>2]|0;M=S+((ue(r,y)|0)+E<<1)|0;k=S+((ue(r,_)|0)+E<<1)|0;C=S+((ue(r,b)|0)+E<<1)|0;r:do{if(!((d[M>>1]|d[S+(R<<1)>>1]|d[k>>1]|d[C>>1])&20735)){f[x>>2]=w;if(!(xs(P)|0))break;f[x>>2]=T;u=(xs(P)|0)<<1;u=u|(xs(P)|0);if(u>>>0>=4)break;h=a+((ue(f[we>>2]|0,u)|0)+i<<2)|0;i=o+((ue(f[ge>>2]|0,u)|0)+i<<1)|0;l=u;while(1){if(l>>>0>=(f[xe>>2]|0)>>>0)break r;r=f[ge>>2]|0;s=i;i=i+(r<<1)|0;if((l|0)==(u|0)){C=f[e>>2]|0;k=(m[i>>1]|0)>>>4&255;f[C+100>>2]=C+24+(p[21291+k>>0]<<2);C=xs(C)|0;k=p[21547+k>>0]|0;S=k^C;f[h>>2]=(C|0)!=(k|0)?A:L;k=f[ge>>2]|0;C=s+(r-k<<1)|0;R=s+(k+r<<1)|0;M=s+(r+~k<<1)|0;d[M>>1]=m[M>>1]|2;d[C>>1]=d[C>>1]|d[3436+(S<<1)>>1];C=r+1|0;M=s+(C-k<<1)|0;d[M>>1]=m[M>>1]|4;M=r+-1|0;r=s+(M<<1)|0;d[r>>1]=d[r>>1]|d[3436+(S+2<<1)>>1];d[i>>1]=m[i>>1]|4096;r=s+(C<<1)|0;d[r>>1]=d[r>>1]|d[3436+(S+4<<1)>>1];M=s+(k+M<<1)|0;d[M>>1]=m[M>>1]|1;d[R>>1]=d[R>>1]|d[3436+(S+6<<1)>>1];C=s+(k+C<<1)|0;d[C>>1]=m[C>>1]|8;d[i>>1]=m[i>>1]&49151}else ts(e,i,h,G,L);l=l+1|0;if(l>>>0>=4)break;else h=h+(f[we>>2]<<2)|0}}else{k=r+i|0;ts(e,o+(k<<1)|0,a+(i<<2)|0,G,L);C=(f[we>>2]|0)+i|0;k=(f[ge>>2]|0)+k|0;ts(e,o+(k<<1)|0,a+(C<<2)|0,G,L);C=(f[we>>2]|0)+C|0;k=(f[ge>>2]|0)+k|0;ts(e,o+(k<<1)|0,a+(C<<2)|0,G,L);ts(e,o+((f[ge>>2]|0)+k<<1)|0,a+((f[we>>2]|0)+C<<2)|0,G,L)}}while(0);r=f[we>>2]|0}while(E>>>0<r>>>0);s=r;i=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=o+(f[ge>>2]<<2<<1)|0;c=c+4|0;if(c>>>0>=(i&-4)>>>0){h=a;u=o;break}}}else{r=f[we>>2]|0;h=a;u=o;c=0}if(!r)break;else l=0;do{if(c>>>0<i>>>0){a=h+(l<<2)|0;o=u+(l<<1)|0;s=c;while(1){o=o+(f[ge>>2]<<1)|0;ts(e,o,a,G,L);r=f[we>>2]|0;s=s+1|0;i=f[xe>>2]|0;if(s>>>0>=i>>>0)break;else a=a+(r<<2)|0}}l=l+1|0}while(l>>>0<r>>>0)}else{r=f[xe>>2]|0;if(!r)break;M=P+92|0;S=P+100|0;R=P+96|0;k=0-L|0;i=f[we>>2]|0;A=0;while(1){if(!i){a=A+4|0;i=0}else{E=A|3;w=A|1;x=w+1|0;T=w+3|0;a=A+4|0;b=0;while(1){do{if(E>>>0<r>>>0){r=f[ge>>2]|0;o=b+1|0;_=(ue(r,w)|0)+o|0;i=f[ve>>2]|0;if(d[i+(_<<1)>>1]&20735){_=0;r=0;C=127;break}_=i+((ue(r,x)|0)+o<<1)|0;if(d[_>>1]&20735){_=0;r=0;C=127;break}_=i+((ue(r,E)|0)+o<<1)|0;if(d[_>>1]&20735){_=0;r=0;C=127;break}_=i+((ue(r,T)|0)+o<<1)|0;if(d[_>>1]&20665){_=0;r=0;C=127;break}f[S>>2]=M;if(!(xs(P)|0))break;f[S>>2]=R;r=(xs(P)|0)<<1;_=1;r=r|(xs(P)|0);C=127}else{_=0;r=0;C=127}}while(0);if((C|0)==127){C=0;o=r+A|0;r:do{if(o>>>0<a>>>0){y=o;do{r=f[xe>>2]|0;if(y>>>0>=r>>>0)break r;ke=y;y=y+1|0;s=(ue(f[ge>>2]|0,y)|0)+b|0;l=s+1|0;c=f[ve>>2]|0;u=c+(l<<1)|0;h=(ue(f[we>>2]|0,ke)|0)+b|0;h=(f[Ee>>2]|0)+(h<<2)|0;g=f[e>>2]|0;i=d[u>>1]|0;i=(ke|0)==(E|0)|(ke|0)==(r+-1|0)?i&-1095:i;do{if(!(_&(ke|0)==(o|0))){if(i&20480)break;r=g+100|0;f[r>>2]=g+24+(p[20267+(i&255|j)>>0]<<2);if(xs(g)|0)C=133}else{r=g+100|0;C=133}}while(0);if((C|0)==133){C=0;i=i>>>4&255;f[r>>2]=g+24+(p[21291+i>>0]<<2);ke=xs(g)|0;g=p[21547+i>>0]|0;i=g^ke;f[h>>2]=(ke|0)!=(g|0)?k:L;g=f[ge>>2]|0;ke=c+(l-g<<1)|0;h=c+(g+l<<1)|0;l=c+(l+~g<<1)|0;d[l>>1]=m[l>>1]|2;d[ke>>1]=d[ke>>1]|d[3436+(i<<1)>>1];ke=s+2|0;l=c+(ke-g<<1)|0;d[l>>1]=m[l>>1]|4;l=c+(s<<1)|0;d[l>>1]=d[l>>1]|d[3436+(i+2<<1)>>1];d[u>>1]=m[u>>1]|4096;l=c+(ke<<1)|0;d[l>>1]=d[l>>1]|d[3436+(i+4<<1)>>1];l=c+(g+s<<1)|0;d[l>>1]=m[l>>1]|1;d[h>>1]=d[h>>1]|d[3436+(i+6<<1)>>1];ke=c+(g+ke<<1)|0;d[ke>>1]=m[ke>>1]|8}d[u>>1]=m[u>>1]&49151}while(y>>>0<a>>>0)}}while(0);o=b+1|0}i=f[we>>2]|0;r=f[xe>>2]|0;if(o>>>0<i>>>0)b=o;else break}}if(a>>>0<r>>>0)A=a;else break}}}while(0);if(D){C=163;break n}f[P+100>>2]=P+96;xs(P)|0;xs(P)|0;xs(P)|0;xs(P)|0;C=163;break}default:C=163}}while(0);do{if((C|0)==163){C=0;if(F)break;vs(q);ys(q,18,0,46);ys(q,17,0,3);ys(q,0,0,4)}}while(0);n=n+1|0;ke=(n|0)==3;t=(ke<<31>>31)+t|0;n=ke?0:n;I=I+1|0;if(I>>>0>=(f[N>>2]|0)>>>0)break t}}}while(0);r=f[K>>2]|0}H=H+1|0}while(H>>>0<r>>>0)}n=(f[X>>2]|0)-(f[ie>>2]|0)|0;t=(f[Z>>2]|0)-(f[ae>>2]|0)|0;r=f[re>>2]|0;if(r&1){ke=f[Me>>2]|0;n=(f[ke+(he*136|0)+8>>2]|0)+n-(f[ke+(he*136|0)>>2]|0)|0}if(r&2){ke=f[Me>>2]|0;t=(f[ke+(he*136|0)+12>>2]|0)+t-(f[ke+(he*136|0)+4>>2]|0)|0}u=f[Ee>>2]|0;h=f[we>>2]|0;g=f[xe>>2]|0;r=f[Se>>2]|0;if((r|0)!=0?(be=1<<r,(g|0)!=0):0){r=(h|0)==0;c=0;do{if(!r){i=ue(c,h)|0;l=0;do{a=u+(l+i<<2)|0;o=f[a>>2]|0;s=(o|0)>-1?o:0-o|0;if((s|0)>=(be|0)){ke=s>>f[Se>>2];f[a>>2]=(o|0)<0?0-ke|0:ke}l=l+1|0}while((l|0)!=(h|0))}c=c+1|0}while((c|0)!=(g|0))}l=(ue(t,Te)|0)+n|0;c=f[me>>2]|0;n=(g|0)==0;if((f[ye>>2]|0)==1){if(!n){n=(h|0)==0;a=0;do{if(!n){t=ue(a,h)|0;r=(ue(a,Te)|0)+l|0;i=0;do{f[c+(r+i<<2)>>2]=(f[u+(i+t<<2)>>2]|0)/2|0;i=i+1|0}while((i|0)!=(h|0))}a=a+1|0}while((a|0)!=(g|0))}}else if(!n){s=(h|0)==0;n=u;o=0;a=c+(l<<2)|0;while(1){if(!s){t=n;r=0;i=a;while(1){v[i>>2]=+(f[t>>2]|0)*+v[oe>>2];r=r+1|0;if((r|0)==(h|0))break;else{t=t+4|0;i=i+4|0}}n=n+(h<<2)|0}o=o+1|0;if((o|0)==(g|0))break;else a=a+(Te<<2)|0}}J=J+1|0}while(J>>>0<(ue(f[ee>>2]|0,f[$>>2]|0)|0)>>>0);n=f[ce>>2]|0;r=f[le>>2]|0}te=te+1|0}while(te>>>0<(ue(n,r)|0)>>>0);t=f[fe>>2]|0}se=se+1|0}while(se>>>0<t>>>0);n=f[Ae>>2]|0}pe=pe+1|0;if(pe>>>0>=n>>>0){n=1;C=201;break}}if((C|0)==201)return n|0;return 0}function Jo(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0,u=0,g=0.0,_=0.0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,z=0,V=0,j=0,G=0,W=0.0,q=0,X=0,Y=0,K=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0.0,le=0,ce=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Ae=0,Me=0,Se=0,Re=0,ke=0,Pe=0,Le=0,Ce=0,Ie=0,Ne=0,Fe=0,Oe=0,He=0,De=0,Ue=0,Be=0,ze=0,Ve=0,je=0,Ge=0,We=0,qe=0,Xe=0,Ye=0,Ke=0,Ze=0,Qe=0,Je=0,$e=0;Ze=t+32|0;y[Ze>>3]=0.0;Qe=t+16|0;a=f[Qe>>2]|0;if(!a){Je=1;return Je|0}Ke=t+20|0;Ge=n+5584|0;We=e+16|0;qe=e+20|0;Xe=e+8|0;Ye=e+36|0;ze=(r|0)!=0;Ve=e+32|0;je=e+12|0;t=a;Be=0;e:while(1){n=f[Ke>>2]|0;a=f[Ge>>2]|0;De=(f[n+(Be*52|0)+8>>2]|0)-(f[n+(Be*52|0)>>2]|0)|0;Ue=n+(Be*52|0)+16|0;o=f[Ue>>2]|0;if(o){He=n+(Be*52|0)+24|0;Fe=n+(Be*52|0)+32|0;Oe=a+(Be*1080|0)+20|0;Ce=a+(Be*1080|0)+16|0;Ne=ze&Be>>>0<i>>>0;Ie=r+(Be<<3)|0;t=o;Le=0;do{ke=f[He>>2]|0;Pe=ke+(Le*136|0)+24|0;n=f[Pe>>2]|0;if(n){Ae=ke+(Le*136|0)+16|0;Me=ke+(Le*136|0)+20|0;Se=~Le;Re=Le+-1|0;t=f[Me>>2]|0;a=f[Ae>>2]|0;Te=0;do{xe=ke+(Le*136|0)+28+(Te*36|0)+32|0;if(ue(t,a)|0){ve=67108864/(~~+Z(+(+v[xe>>2]*8192.0))|0)|0;ye=ke+(Le*136|0)+28+(Te*36|0)+20|0;_e=ke+(Le*136|0)+28+(Te*36|0)|0;be=ke+(Le*136|0)+28+(Te*36|0)+4|0;Ee=ke+(Le*136|0)+28+(Te*36|0)+16|0;we=((ve|0)<0)<<31>>31;ge=0;do{n=f[ye>>2]|0;pe=n+(ge*40|0)+16|0;me=n+(ge*40|0)+20|0;if(ue(f[me>>2]|0,f[pe>>2]|0)|0){de=n+(ge*40|0)+24|0;fe=0;do{he=f[de>>2]|0;o=f[he+(fe*52|0)+12>>2]|0;t=o-(f[_e>>2]|0)|0;s=f[he+(fe*52|0)+16>>2]|0;n=s-(f[be>>2]|0)|0;a=f[Ee>>2]|0;if(a&1){ce=f[He>>2]|0;t=(f[ce+(Re*136|0)+8>>2]|0)+t-(f[ce+(Re*136|0)>>2]|0)|0}if(a&2){ce=f[He>>2]|0;n=(f[ce+(Re*136|0)+12>>2]|0)+n-(f[ce+(Re*136|0)+4>>2]|0)|0}if(!($o(e,(f[he+(fe*52|0)+20>>2]|0)-o|0,(f[he+(fe*52|0)+24>>2]|0)-s|0)|0)){t=0;Je=173;break e}l=f[We>>2]|0;c=f[qe>>2]|0;u=De-l|0;b=(ue(n,De)|0)+t|0;E=f[Fe>>2]|0;f[Xe>>2]=E+(b<<2);f[Ye>>2]=De;t=(c|0)==0;if((f[Oe>>2]|0)==1){if(!t){o=(l|0)==0;s=0;t=0;while(1){if(!o){n=0;a=t;while(1){ce=E+(a+b<<2)|0;f[ce>>2]=f[ce>>2]<<6;n=n+1|0;if((n|0)==(l|0))break;else a=a+1|0}t=l+t|0}s=s+1|0;if((s|0)==(c|0))break;else t=t+u|0}}}else if(!t){o=(l|0)==0;s=0;t=0;while(1){if(!o){n=0;a=t;while(1){ce=E+(a+b<<2)|0;le=f[ce>>2]|0;le=Jl(le|0,((le|0)<0)<<31>>31|0,ve|0,we|0)|0;le=Wl(le|0,B|0,4096,0)|0;le=ql(le|0,B|0,18)|0;f[ce>>2]=le;n=n+1|0;if((n|0)==(l|0))break;else a=a+1|0}t=l+t|0}s=s+1|0;if((s|0)==(c|0))break;else t=t+u|0}}ae=f[Ee>>2]|0;oe=(f[Ue>>2]|0)+Se|0;u=f[Oe>>2]|0;se=+v[xe>>2];le=f[Ce>>2]|0;ce=f[e>>2]|0;o=f[We>>2]|0;do{if(!o)t=0;else{s=f[qe>>2]|0;l=(s|0)==0;c=0;t=0;do{if(!l){n=f[Ye>>2]|0;a=0;do{ie=E+(b+((ue(a,n)|0)+c)<<2)|0;ie=f[ie>>2]|0;ie=(ie|0)>-1?ie:0-ie|0;t=(t|0)>(ie|0)?t:ie;a=a+1|0}while((a|0)!=(s|0))}c=c+1|0}while((c|0)!=(o|0));if(!t){t=0;break}if((t|0)>1){n=t;t=0}else{t=-5;break}while(1){n=n>>1;if((n|0)<=1)break;else t=t+1|0}t=t+-4|0}}while(0);re=he+(fe*52|0)+28|0;f[re>>2]=t;t=t+-1|0;vs(ce);ys(ce,18,0,46);ys(ce,17,0,3);ys(ce,0,0,4);ie=he+(fe*52|0)|0;hs(ce,f[ie>>2]|0);t:do{if((t|0)>-1){te=he+(fe*52|0)+8|0;X=le&1;ne=(X|0)!=0;Y=(u|0)==1;K=(le&4|0)==0;X=(X|0)==0;Q=(le&2|0)==0;J=(le&8|0)==0;$=ae<<8;ee=(le&32|0)==0;n=0;G=t;W=0.0;t=0;q=2;while(1){j=f[te>>2]|0;I=ne&(q>>>0<2?(G|0)<((f[re>>2]|0)+-4|0):0);n:do{switch(q|0){case 0:{L=1<<G+6;n=f[qe>>2]|0;if(!n){o=0;break n}C=(G|0)==0;s=f[We>>2]|0;a=s;o=0;P=0;do{k=P;P=P+4|0;if(!a)a=0;else{S=(k|0)==-4;R=k|3;a=s;M=0;do{if(!S){A=k;do{n=f[qe>>2]|0;if(A>>>0>=n>>>0)break;do{if(J)n=0;else{if((A|0)==(R|0)){n=1;break}n=(A|0)==(n+-1|0)}}while(0);l=A;A=A+1|0;b=(ue(f[Ve>>2]|0,A)|0)+M|0;E=b+1|0;w=f[je>>2]|0;T=w+(E<<1)|0;l=(ue(f[Ye>>2]|0,l)|0)+M|0;l=(f[Xe>>2]|0)+(l<<2)|0;x=f[e>>2]|0;c=d[T>>1]|0;c=n?c&-1095:c;n=c&255;if((n|0)!=0&(c&20480|0)==0){a=f[l>>2]|0;a=(((a|0)<0?0-a|0:a)&L|0)!=0;s=a&1;u=x+100|0;f[u>>2]=x+24+(p[20267+(n|$)>>0]<<2);if(I)ms(x,s);else ds(x,s);if(a){n=f[l>>2]|0;a=n>>>31;n=(n|0)<0?0-n|0:n;if(C)n=3708+((n&127)<<1)|0;else n=3452+((n>>>G&127)<<1)|0;o=(d[n>>1]|0)+o|0;n=c>>>4&255;f[u>>2]=x+24+(p[21291+n>>0]<<2);if(I)ms(x,a);else ds(x,p[21547+n>>0]^a);z=f[Ve>>2]|0;V=w+(E-z<<1)|0;U=w+(z+E<<1)|0;D=w+(E+~z<<1)|0;d[D>>1]=m[D>>1]|2;d[V>>1]=d[V>>1]|d[3436+(a<<1)>>1];V=b+2|0;D=w+(V-z<<1)|0;d[D>>1]=m[D>>1]|4;D=w+(b<<1)|0;d[D>>1]=d[D>>1]|d[3436+((a|2)<<1)>>1];d[T>>1]=m[T>>1]|4096;D=w+(V<<1)|0;d[D>>1]=d[D>>1]|d[3436+((a|4)<<1)>>1];D=w+(z+b<<1)|0;d[D>>1]=m[D>>1]|1;d[U>>1]=d[U>>1]|d[3436+((a|6)<<1)>>1];V=w+(z+V<<1)|0;d[V>>1]=m[V>>1]|8}d[T>>1]=m[T>>1]|16384}}while(A>>>0<P>>>0);a=f[We>>2]|0}M=M+1|0}while(M>>>0<a>>>0);n=f[qe>>2]|0;s=a}}while(P>>>0<n>>>0);break}case 1:{M=1<<G+6;n=f[qe>>2]|0;if(!n){o=0;break n}S=(G|0)==0;s=f[We>>2]|0;a=s;o=0;A=0;do{T=A;A=A+4|0;if(!a)a=0;else{w=(T|0)==-4;x=T|3;a=s;E=0;do{b=E;E=E+1|0;if(!w){u=T;do{n=f[qe>>2]|0;if(u>>>0>=n>>>0)break;do{if(J)n=0;else{if((u|0)==(x|0)){n=1;break}n=(u|0)==(n+-1|0)}}while(0);a=u;u=u+1|0;l=(ue(f[Ve>>2]|0,u)|0)+E|0;l=(f[je>>2]|0)+(l<<1)|0;c=f[e>>2]|0;s=d[l>>1]|0;s=n?s&-1095:s;if((s&20480|0)==4096){a=(f[Xe>>2]|0)+((ue(f[Ye>>2]|0,a)|0)+b<<2)|0;a=f[a>>2]|0;a=(a|0)<0?0-a|0:a;if(S)n=4220+((a&127)<<1)|0;else n=3964+((a>>>G&127)<<1)|0;o=(d[n>>1]|0)+o|0;n=(a&M|0)!=0&1;f[c+100>>2]=c+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);if(I)ms(c,n);else ds(c,n);d[l>>1]=m[l>>1]|8192}}while(u>>>0<A>>>0);a=f[We>>2]|0}}while(E>>>0<a>>>0);n=f[qe>>2]|0;s=a}}while(A>>>0<n>>>0);break}case 2:{O=f[e>>2]|0;H=1<<G+6;a=f[qe>>2]|0;if(!a)n=0;else{D=O+92|0;U=O+100|0;z=O+96|0;V=(G|0)==0;o=f[We>>2]|0;n=0;F=0;while(1){if(!o){s=F+4|0;o=0}else{R=F|3;k=F|1;P=k+1|0;L=k+3|0;s=F+4|0;C=F+1|0;I=F+2|0;N=F+3|0;S=0;while(1){do{if(R>>>0<a>>>0){a=f[Ve>>2]|0;c=S+1|0;l=(ue(a,k)|0)+c|0;o=f[je>>2]|0;l=d[o+(l<<1)>>1]|0;if(J){A=o+((ue(a,P)|0)+c<<1)|0;M=o+((ue(a,R)|0)+c<<1)|0;a=o+((ue(a,L)|0)+c<<1)|0;a=((d[A>>1]|l|d[M>>1]|d[a>>1])&20735)==0&1}else{do{if(!(l&20735)){M=o+((ue(a,P)|0)+c<<1)|0;if(d[M>>1]&20735){a=1;break}M=o+((ue(a,R)|0)+c<<1)|0;if(d[M>>1]&20735){a=1;break}a=o+((ue(a,L)|0)+c<<1)|0;a=(d[a>>1]&20665)!=0}else a=1}while(0);a=a&1^1}if(!a){M=0;a=0;Je=109;break}a=f[Ye>>2]|0;o=f[Xe>>2]|0;M=o+((ue(a,F)|0)+S<<2)|0;M=f[M>>2]|0;do{if(!(((M|0)<0?0-M|0:M)&H)){M=o+((ue(a,C)|0)+S<<2)|0;M=f[M>>2]|0;if(((M|0)<0?0-M|0:M)&H){a=1;break}M=o+((ue(a,I)|0)+S<<2)|0;M=f[M>>2]|0;if(((M|0)<0?0-M|0:M)&H){a=2;break}a=o+((ue(a,N)|0)+S<<2)|0;a=f[a>>2]|0;a=(((a|0)<0?0-a|0:a)&H|0)==0?4:3}else a=0}while(0);f[U>>2]=D;ds(O,(a|0)!=4&1);if((a|0)==4){l=c;break}f[U>>2]=z;ds(O,a>>>1);ds(O,a&1);M=1;Je=109}else{M=0;a=0;Je=109}}while(0);if((Je|0)==109){Je=0;A=a+F|0;r:do{if(A>>>0<s>>>0){T=A;do{a=f[qe>>2]|0;if(T>>>0>=a>>>0)break r;do{if(J)a=0;else{if((T|0)==(R|0)){a=1;break}a=(T|0)==(a+-1|0)}}while(0);$e=T;T=T+1|0;u=(ue(f[Ve>>2]|0,T)|0)+S|0;b=u+1|0;E=f[je>>2]|0;x=E+(b<<1)|0;o=(ue(f[Ye>>2]|0,$e)|0)+S|0;o=(f[Xe>>2]|0)+(o<<2)|0;w=f[e>>2]|0;l=d[x>>1]|0;c=a?l&-1095:l;do{if(!(M&($e|0)==(A|0))){if(l&20480)break;f[w+100>>2]=w+24+(p[20267+(c&255|$)>>0]<<2);$e=f[o>>2]|0;$e=((($e|0)<0?0-$e|0:$e)&H|0)!=0;ds(w,$e&1);if($e)Je=117}else Je=117}while(0);if((Je|0)==117){Je=0;o=f[o>>2]|0;a=(o|0)<0?0-o|0:o;if(V)a=3708+((a&127)<<1)|0;else a=3452+((a>>>G&127)<<1)|0;n=(d[a>>1]|0)+n|0;$e=c>>>4&255;f[w+100>>2]=w+24+(p[21291+$e>>0]<<2);l=o>>>31;ds(w,p[21547+$e>>0]^l);w=f[Ve>>2]|0;$e=E+(b-w<<1)|0;c=E+(w+b<<1)|0;b=E+(b+~w<<1)|0;d[b>>1]=m[b>>1]|2;d[$e>>1]=d[$e>>1]|d[3436+(l<<1)>>1];$e=u+2|0;b=E+($e-w<<1)|0;d[b>>1]=m[b>>1]|4;b=E+(u<<1)|0;d[b>>1]=d[b>>1]|d[3436+((l|2)<<1)>>1];d[x>>1]=m[x>>1]|4096;b=E+($e<<1)|0;d[b>>1]=d[b>>1]|d[3436+((l|4)<<1)>>1];b=E+(w+u<<1)|0;d[b>>1]=m[b>>1]|1;d[c>>1]=d[c>>1]|d[3436+((l|6)<<1)>>1];$e=E+(w+$e<<1)|0;d[$e>>1]=m[$e>>1]|8}d[x>>1]=m[x>>1]&49151}while(T>>>0<s>>>0)}}while(0);l=S+1|0}o=f[We>>2]|0;a=f[qe>>2]|0;if(l>>>0<o>>>0)S=l;else break}}if(s>>>0<a>>>0)F=s;else break}}if(ee){o=n;break n}Es(ce);o=n;break}default:o=n}}while(0);if(Ne)g=+y[Ie>>3];else g=1.0;if(Y)_=+Fo(oe,ae);else _=+Do(oe,ae);_=+(1<<G|0)*(se*(g*_));_=_*(+(o|0)*_*.0001220703125);W=W+_;y[Ze>>3]=+y[Ze>>3]+_;do{if(K)Je=137;else{if((G|0)<1&(q|0)==2){Je=137;break}fs(ce);a=j+(t*24|0)+20|0;n=h[a>>0]|1;h[a>>0]=n;a=1}}while(0);do{if((Je|0)==137){n=(f[re>>2]|0)+-4|0;if((q|0)!=0&(G|0)<(n|0))if(X)Je=141;else Je=140;else if(X|((q|0)!=2|(G|0)!=(n|0)))Je=141;else Je=140;if((Je|0)==140){Je=0;fs(ce);a=j+(t*24|0)+20|0;n=h[a>>0]|1;h[a>>0]=n;a=1;break}else if((Je|0)==141){Je=0;a=j+(t*24|0)+20|0;n=h[a>>0]&-2;h[a>>0]=n;a=3;break}}}while(0);V=q+1|0;$e=(V|0)==3;q=$e?0:V;G=($e<<31>>31)+G|0;do{if((G|0)>0&(n&1)!=0)if(ne&(q>>>0<2?(G|0)<((f[re>>2]|0)+-4|0):0)){ps(ce);break}else{_s(ce);break}}while(0);y[j+(t*24|0)+8>>3]=W;$e=(us(ce)|0)+a|0;f[j+(t*24|0)>>2]=$e;if(!Q)gs(ce);t=t+1|0;if((G|0)<=-1)break t;else n=o}}else t=0}while(0);do{if(!(le&16)){if(le&1)break;fs(ce)}else bs(ce)}while(0);c=he+(fe*52|0)+48|0;f[c>>2]=t;if(t){o=he+(fe*52|0)+8|0;l=0;do{s=f[o>>2]|0;n=s+(l*24|0)|0;$e=f[n>>2]|0;if($e>>>0>(us(ce)|0)>>>0){t=us(ce)|0;f[n>>2]=t}else t=f[n>>2]|0;do{if(t>>>0>1){a=t+-1|0;if((h[(f[ie>>2]|0)+a>>0]|0)!=-1)break;f[n>>2]=a;t=a}}while(0);if(!l)n=0;else n=f[(f[o>>2]|0)+((l+-1|0)*24|0)>>2]|0;f[s+(l*24|0)+16>>2]=t-n;l=l+1|0}while(l>>>0<(f[c>>2]|0)>>>0)}fe=fe+1|0}while(fe>>>0<(ue(f[me>>2]|0,f[pe>>2]|0)|0)>>>0);t=f[Me>>2]|0;a=f[Ae>>2]|0}ge=ge+1|0}while(ge>>>0<(ue(t,a)|0)>>>0);n=f[Pe>>2]|0}Te=Te+1|0}while(Te>>>0<n>>>0);t=f[Ue>>2]|0}Le=Le+1|0}while(Le>>>0<t>>>0);t=f[Qe>>2]|0}Be=Be+1|0;if(Be>>>0>=t>>>0){t=1;Je=173;break}}if((Je|0)==173)return t|0;return 0}function $o(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0;a=ue(n,t)|0;if(!(f[e+40>>2]|0)){o=e+24|0;s=e+8|0;r=f[s>>2]|0;do{if(a>>>0>(f[o>>2]|0)>>>0){Zi(r);i=a<<2;r=Ki(i)|0;f[s>>2]=r;if(!r){t=0;return t|0}else{f[o>>2]=a;break}}else i=a<<2}while(0);jl(r|0,0,i|0)|0}a=t+2|0;f[e+32>>2]=a;a=ue(n+2|0,a)|0;o=e+28|0;s=e+12|0;r=f[s>>2]|0;do{if(a>>>0>(f[o>>2]|0)>>>0){Zi(r);i=a<<1;r=Ki(i)|0;f[s>>2]=r;if(!r){t=0;return t|0}else{f[o>>2]=a;break}}else i=a<<1}while(0);jl(r|0,0,i|0)|0;f[e+16>>2]=t;f[e+20>>2]=n;t=1;return t|0}function es(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0;a=f[e>>2]|0;s=d[t>>1]|0;l=s&255;if(!((l|0)!=0&(s&20480|0)==0))return;o=a+100|0;f[o>>2]=a+24+(p[20267+(l|r<<8)>>0]<<2);if(xs(a)|0){r=s>>>4&255;f[o>>2]=a+24+(p[21291+r>>0]<<2);s=xs(a)|0;r=p[21547+r>>0]|0;l=r^s;f[n>>2]=(s|0)!=(r|0)?0-i|0:i;e=f[e+32>>2]|0;i=t+(0-e<<1)|0;r=t+(e<<1)|0;n=t+(~e<<1)|0;d[n>>1]=m[n>>1]|2;d[i>>1]=d[i>>1]|d[3436+(l<<1)>>1];i=t+(1-e<<1)|0;d[i>>1]=m[i>>1]|4;i=t+-2|0;d[i>>1]=d[i>>1]|d[3436+(l+2<<1)>>1];d[t>>1]=m[t>>1]|4096;i=t+2|0;d[i>>1]=d[i>>1]|d[3436+(l+4<<1)>>1];i=t+(e+-1<<1)|0;d[i>>1]=m[i>>1]|1;d[r>>1]=d[r>>1]|d[3436+(l+6<<1)>>1];e=t+(e+1<<1)|0;d[e>>1]=m[e>>1]|8}d[t>>1]=m[t>>1]|16384;return}function ts(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0;a=f[e>>2]|0;s=d[t>>1]|0;if(s&20480){e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}o=a+100|0;f[o>>2]=a+24+(p[20267+(s&255|r<<8)>>0]<<2);if(!(xs(a)|0)){e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}r=s>>>4&255;f[o>>2]=a+24+(p[21291+r>>0]<<2);o=xs(a)|0;r=p[21547+r>>0]|0;s=r^o;f[n>>2]=(o|0)!=(r|0)?0-i|0:i;e=f[e+32>>2]|0;i=t+(0-e<<1)|0;r=t+(e<<1)|0;n=t+(~e<<1)|0;d[n>>1]=m[n>>1]|2;d[i>>1]=d[i>>1]|d[3436+(s<<1)>>1];i=t+(1-e<<1)|0;d[i>>1]=m[i>>1]|4;i=t+-2|0;d[i>>1]=d[i>>1]|d[3436+(s+2<<1)>>1];d[t>>1]=m[t>>1]|4096;i=t+2|0;d[i>>1]=d[i>>1]|d[3436+(s+4<<1)>>1];i=t+(e+-1<<1)|0;d[i>>1]=m[i>>1]|1;d[r>>1]=d[r>>1]|d[3436+(s+6<<1)>>1];e=t+(e+1<<1)|0;d[e>>1]=m[e>>1]|8;e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}function ns(e,t,n,r,i,a,o,s,l,c,u,h){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;c=c|0;u=u|0;h=h|0;var m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0;I=b;b=b+16|0;C=I;f[C>>2]=0;m=f[e>>2]|0;R=f[e+4>>2]|0;e=f[R+76>>2]|0;P=e+(t*5640|0)|0;v=(d[R>>1]|0)==4?2:1;y=R+80|0;if(!(f[y>>2]|0))g=1;else g=f[m+16>>2]|0;L=(f[e+(t*5640|0)+420>>2]|0)+1|0;k=In(m,R,t,h)|0;if(!k){t=0;b=I;return t|0}f[a>>2]=0;e:do{if(!h){if(g){e=0;t:while(1){h=0;u=k;m=0;while(1){Nn(k,R,t,m,e,c,0);if((f[u+80>>2]|0)==-1){e=9;break t}l=u+36|0;n:while(1){do{if(!(On(u)|0))break n}while((f[l>>2]|0)>>>0>=r>>>0);f[C>>2]=0;if(!(os(t,n,P,u,i,C,o,s)|0)){e=13;break t}S=f[C>>2]|0;f[a>>2]=(f[a>>2]|0)+S;o=o-S|0;h=S+h|0;i=i+S|0}S=f[y>>2]|0;if((S|0)!=0&h>>>0>S>>>0){e=17;break t}m=m+1|0;if(m>>>0<v>>>0)u=u+232|0;else break}e=e+1|0;if(e>>>0>=g>>>0)break e}if((e|0)==9){Cn(k,L);t=0;b=I;return t|0}else if((e|0)==13){Cn(k,L);t=0;b=I;return t|0}else if((e|0)==17){Cn(k,L);t=0;b=I;return t|0}}}else{Nn(k,R,t,u,l,c,h);A=k+(u*232|0)|0;if((f[k+(u*232|0)+80>>2]|0)==-1){Cn(k,L);t=0;b=I;return t|0}c=k+(u*232|0)+36|0;_=(s|0)==0;E=n+840|0;w=s+12|0;x=s+8|0;T=s+88|0;y=R+93|0;v=e+(t*5640|0)+5636|0;while(1){do{if(!(On(A)|0))break e}while((f[c>>2]|0)>>>0>=r>>>0);f[C>>2]=0;if(!(os(t,n,P,A,i,C,o,s)|0))break;g=f[C>>2]|0;i=i+g|0;o=o-g|0;f[a>>2]=(f[a>>2]|0)+g;if(!_){if(!(f[w>>2]|0))e=f[x>>2]|0;else{m=f[T>>2]|0;e=f[x>>2]|0;u=f[m+(t*592|0)+548>>2]|0;h=u+(e<<5)|0;if(!e){l=(f[m+(t*592|0)+12>>2]|0)+1|0;m=((l|0)<0)<<31>>31;R=h;f[R>>2]=l;f[R+4>>2]=m}else{if((((p[v>>0]|0)>>>2|(p[y>>0]|0)>>>3)&1)!=0?(S=h,M=f[S>>2]|0,S=f[S+4>>2]|0,!((M|0)==0&(S|0)==0)):0){l=M;m=S}else{l=u+(e+-1<<5)+16|0;l=Wl(f[l>>2]|0,f[l+4>>2]|0,1,0)|0;m=B}R=h;f[R>>2]=l;f[R+4>>2]=m}h=Wl(l|0,m|0,-1,-1)|0;l=B;g=Wl(h|0,l|0,g|0,0)|0;R=u+(e<<5)+16|0;f[R>>2]=g;f[R+4>>2]=B;R=u+(e<<5)+8|0;g=R;g=Wl(h|0,l|0,f[g>>2]|0,f[g+4>>2]|0)|0;f[R>>2]=g;f[R+4>>2]=B}f[x>>2]=e+1}f[E>>2]=(f[E>>2]|0)+1}Cn(k,L);t=0;b=I;return t|0}}while(0);Cn(k,L);t=1;b=I;return t|0}function rs(e,t,n,r,i,a,o,s){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;var l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,B=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Z=0,Q=0,J=0,$=0;J=b;b=b+112|0;Y=J+64|0;K=J+32|0;G=J;j=J+96|0;V=J+92|0;l=f[e>>2]|0;D=e+4|0;Q=f[D>>2]|0;o=f[Q+76>>2]|0;B=o+(t*5640|0)|0;z=o+(t*5640|0)+420|0;Z=(f[z>>2]|0)+1|0;Q=Ln(l,Q,t)|0;if(!Q){$=0;b=J;return $|0}U=l+16|0;H=o+(t*5640|0)+12|0;O=n+20|0;F=l+24|0;t=a;e=r;I=Q;N=0;e:while(1){if((f[I+80>>2]|0)==-1){$=4;break}o=Xi(f[U>>2]<<2)|0;if(!o){$=6;break}jl(o|0,1,f[U>>2]<<2|0)|0;if(On(I)|0){a=I+24|0;n=I+28|0;C=I+36|0;l=I+32|0;L=t;P=e;while(1){if((f[H>>2]|0)>>>0>(f[C>>2]|0)>>>0){t=f[a>>2]|0;e=f[O>>2]|0;if((f[n>>2]|0)>>>0<(f[e+(t*52|0)+20>>2]|0)>>>0){f[o+(t<<2)>>2]=0;k=f[D>>2]|0;f[V>>2]=0;if(!(ss(k,e,B,I,j,P,V,L,s)|0)){$=45;break e}R=f[V>>2]|0;if(!(f[j>>2]|0))e=R;else{S=L-R|0;A=P+R|0;f[V>>2]=0;t=f[n>>2]|0;c=f[(f[O>>2]|0)+((f[a>>2]|0)*52|0)+24>>2]|0;x=c+(t*136|0)+24|0;e=f[x>>2]|0;t:do{if(!e){e=A;$=43}else{T=P+L|0;u=e;k=0;w=c+(t*136|0)+28|0;c=A;n:while(1){e=f[l>>2]|0;t=f[w+20>>2]|0;if(((f[w+8>>2]|0)!=(f[w>>2]|0)?(f[w+12>>2]|0)!=(f[w+4>>2]|0):0)?(X=ue(f[t+(e*40|0)+20>>2]|0,f[t+(e*40|0)+16>>2]|0)|0,(X|0)!=0):0){M=0;e=f[t+(e*40|0)+24>>2]|0;p=c;while(1){_=e+40|0;if(!(f[_>>2]|0))t=p;else{E=e+44|0;t=f[E>>2]|0;do{if(!t){d=f[e+4>>2]|0;f[E>>2]=1;f[e+36>>2]=0}else{c=t+-1|0;u=f[e+4>>2]|0;if((f[u+(c<<5)+8>>2]|0)!=(f[u+(c<<5)+20>>2]|0)){d=u+(c<<5)|0;break}f[E>>2]=t+1;d=u+(t<<5)|0}}while(0);y=e+36|0;t=e+32|0;v=p;h=d+28|0;c=f[h>>2]|0;if((c+v|0)>>>0<v>>>0|(p+c|0)>>>0>T>>>0){t=k;e=M;break n}u=f[y>>2]|0;v=p;g=d;while(1){d=c+u|0;if(d>>>0<u>>>0){t=k;e=M;$=29;break e}p=f[e>>2]|0;if(d>>>0>(f[t>>2]|0)>>>0){c=Qi(p,d)|0;if(!c){$=32;break e}u=f[y>>2]|0;m=f[h>>2]|0;f[t>>2]=m+u;f[e>>2]=c;p=c;c=m}Xl(p+u|0,v|0,c|0)|0;c=g+8|0;u=f[c>>2]|0;if(!u){f[g>>2]=e;d=f[y>>2]|0;f[g+4>>2]=d}else d=f[y>>2]|0;p=f[h>>2]|0;m=v;v=v+p|0;h=f[g+24>>2]|0;u=h+u|0;f[c>>2]=u;c=f[_>>2]|0;f[_>>2]=c-h;f[g+12>>2]=u;u=p+d|0;f[y>>2]=u;d=g+16|0;f[d>>2]=(f[d>>2]|0)+p;if((c|0)==(h|0)){t=v;break}f[E>>2]=(f[E>>2]|0)+1;d=v;h=g+60|0;c=f[h>>2]|0;if((c+d|0)>>>0<d>>>0?1:(m+(c+p)|0)>>>0>T>>>0){t=k;e=M;break n}else g=g+32|0}f[e+48>>2]=f[E>>2]}M=M+1|0;if(M>>>0>=X>>>0){e=t;break}else{e=e+56|0;p=t}}t=f[x>>2]|0}else{t=u;e=c}k=k+1|0;if(k>>>0>=t>>>0){$=43;break t}else{u=t;w=w+36|0;c=e}}A=f[l>>2]|0;M=f[n>>2]|0;k=f[a>>2]|0;f[G>>2]=c;f[G+4>>2]=S;f[G+8>>2]=e;f[G+12>>2]=A;f[G+16>>2]=t;f[G+20>>2]=M;f[G+24>>2]=k;Jr(s,2,21803,G)|0;e=f[V>>2]|0}}while(0);if(($|0)==43){$=0;e=e-A|0;f[V>>2]=e}e=e+R|0}c=f[a>>2]|0;R=f[n>>2]|0;t=(f[F>>2]|0)+(c*52|0)+36|0;k=f[t>>2]|0;f[t>>2]=R>>>0>k>>>0?R:k;t=e}else $=47}else{e=f[O>>2]|0;$=47}if(($|0)==47){$=0;k=f[D>>2]|0;f[V>>2]=0;if(!(ss(k,e,B,I,j,P,V,L,s)|0)){$=69;break e}_=f[V>>2]|0;if(!(f[j>>2]|0))e=_;else{c=L-_|0;w=f[n>>2]|0;x=f[a>>2]|0;e=f[(f[O>>2]|0)+(x*52|0)+24>>2]|0;f[V>>2]=0;y=f[e+(w*136|0)+24>>2]|0;if(!y)e=0;else{E=f[l>>2]|0;t=0;v=e+(w*136|0)+28|0;while(1){u=f[v+20>>2]|0;if(((f[v+8>>2]|0)!=(f[v>>2]|0)?(f[v+12>>2]|0)!=(f[v+4>>2]|0):0)?(W=ue(f[u+(E*40|0)+20>>2]|0,f[u+(E*40|0)+16>>2]|0)|0,(W|0)!=0):0){e=0;g=f[u+(E*40|0)+24>>2]|0;while(1){p=g+40|0;t:do{if(f[p>>2]|0){m=g+44|0;u=f[m>>2]|0;do{if(!u){d=f[g+4>>2]|0;f[m>>2]=1;f[g+36>>2]=0}else{h=u+-1|0;d=f[g+4>>2]|0;if((f[d+(h<<5)+8>>2]|0)!=(f[d+(h<<5)+20>>2]|0)){d=d+(h<<5)|0;break}f[m>>2]=u+1;d=d+(u<<5)|0}}while(0);k=f[V>>2]|0;u=f[d+28>>2]|0;h=u+k|0;if(h>>>0<k>>>0|h>>>0>c>>>0){a=E;n=w;l=x;$=65;break e}while(1){f[V>>2]=h;k=f[d+24>>2]|0;R=d+8|0;f[R>>2]=(f[R>>2]|0)+k;R=f[p>>2]|0;f[p>>2]=R-k;if((R|0)==(k|0))break t;f[m>>2]=(f[m>>2]|0)+1;k=f[V>>2]|0;u=f[d+60>>2]|0;h=u+k|0;if(h>>>0<k>>>0|h>>>0>c>>>0){a=E;n=w;l=x;$=65;break e}else d=d+32|0}}}while(0);e=e+1|0;if(e>>>0>=W>>>0)break;else g=g+56|0}}t=t+1|0;if(t>>>0>=y>>>0)break;else v=v+36|0}e=f[V>>2]|0}e=e+_|0}c=f[a>>2]|0;t=e}if((f[o+(c<<2)>>2]|0)!=0?(q=(f[F>>2]|0)+(c*52|0)+36|0,(f[q>>2]|0)==0):0)f[q>>2]=(f[(f[O>>2]|0)+(c*52|0)+20>>2]|0)+-1;e=P+t|0;t=L-t|0;if(!(On(I)|0))break;else{L=t;P=e}}}Ji(o);N=N+1|0;if(N>>>0>(f[z>>2]|0)>>>0){o=e;$=75;break}else I=I+232|0}if(($|0)==4){Cn(Q,Z);$=0;b=J;return $|0}else if(($|0)==6){Cn(Q,Z);$=0;b=J;return $|0}else if(($|0)==29){i=f[l>>2]|0;r=f[n>>2]|0;Y=f[a>>2]|0;f[K>>2]=c;f[K+4>>2]=u;f[K+8>>2]=~c;f[K+12>>2]=e;f[K+16>>2]=i;f[K+20>>2]=t;f[K+24>>2]=r;f[K+28>>2]=Y;Jr(s,1,21888,K)|0;$=45}else if(($|0)==32){Ji(f[e>>2]|0);f[e>>2]=0;f[t>>2]=0;$=45}else if(($|0)==65){f[Y>>2]=u;f[Y+4>>2]=c;f[Y+8>>2]=e;f[Y+12>>2]=a;f[Y+16>>2]=t;f[Y+20>>2]=n;f[Y+24>>2]=l;Jr(s,1,21987,Y)|0;$=69}else if(($|0)==75){Cn(Q,Z);f[i>>2]=o-r;$=1;b=J;return $|0}if(($|0)==45){Cn(Q,Z);Ji(o);$=0;b=J;return $|0}else if(($|0)==69){Cn(Q,Z);Ji(o);$=0;b=J;return $|0}return 0}function is(e,t){e=e|0;t=t|0;var n=0;n=Yi(1,8)|0;if(!n){e=0;return e|0}f[n>>2]=e;f[n+4>>2]=t;e=n;return e|0}function as(e){e=e|0;if(!e)return;Ji(e);return}function os(e,t,n,r,i,a,o,s){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;var l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0.0,F=0,O=0;v=f[r+28>>2]|0;F=f[r+32>>2]|0;O=f[r+36>>2]|0;g=f[(f[t+20>>2]|0)+((f[r+24>>2]|0)*52|0)+24>>2]|0;if(!(f[n>>2]&2))C=i;else{h[i>>0]=-1;h[i+1>>0]=-111;h[i+2>>0]=0;h[i+3>>0]=4;C=t+840|0;h[i+4>>0]=(f[C>>2]|0)>>>8;h[i+5>>0]=f[C>>2];o=o+-6|0;C=i+6|0}if((O|0)==0?(m=g+(v*136|0)+24|0,(f[m>>2]|0)!=0):0){d=g+(v*136|0)+28|0;p=0;while(1){r=f[d+20>>2]|0;or(f[r+(F*40|0)+32>>2]|0);c=r+(F*40|0)+36|0;or(f[c>>2]|0);u=ue(f[r+(F*40|0)+20>>2]|0,f[r+(F*40|0)+16>>2]|0)|0;if(u){r=r+(F*40|0)+24|0;t=d+28|0;l=0;do{I=f[r>>2]|0;f[I+(l*52|0)+40>>2]=0;po(f[c>>2]|0,l,(f[t>>2]|0)-(f[I+(l*52|0)+28>>2]|0)|0);l=l+1|0}while((l|0)!=(u|0))}p=p+1|0;if(p>>>0>=(f[m>>2]|0)>>>0)break;else d=d+36|0}}P=xo()|0;if(!P){a=0;return a|0}Mo(P,C,o);Ro(P,1,1);L=g+(v*136|0)+28|0;I=g+(v*136|0)+24|0;if(f[I>>2]|0){M=O+1|0;R=L;k=0;while(1){u=f[R+20>>2]|0;S=ue(f[u+(F*40|0)+20>>2]|0,f[u+(F*40|0)+16>>2]|0)|0;d=u+(F*40|0)+24|0;r=(S|0)==0;if(!r){t=u+(F*40|0)+32|0;l=f[d>>2]|0;c=0;while(1){if((f[l+40>>2]|0)==0?(f[(f[l+4>>2]|0)+(O*24|0)>>2]|0)!=0:0)po(f[t>>2]|0,c,O);c=c+1|0;if((c|0)==(S|0))break;else l=l+52|0}if(!r){A=u+(F*40|0)+32|0;T=u+(F*40|0)+36|0;w=f[d>>2]|0;x=0;while(1){r=(f[w+4>>2]|0)+(O*24|0)|0;E=w+40|0;if(!(f[E>>2]|0))mo(P,f[A>>2]|0,x,M);else Ro(P,(f[r>>2]|0)!=0&1,1);t=f[r>>2]|0;if(t){if(!(f[E>>2]|0)){f[w+32>>2]=3;mo(P,f[T>>2]|0,x,999);t=f[r>>2]|0}e:do{switch(t|0){case 1:{Ro(P,0,1);break}case 2:{Ro(P,2,2);break}default:{if(t>>>0<6){Ro(P,t+-3|12,4);break e}if(t>>>0<37){Ro(P,t+-6|480,9);break e}if(t>>>0<165)Ro(P,t+-37|65408,16)}}}while(0);d=f[E>>2]|0;t=f[r>>2]|0;b=t+d|0;_=w+8|0;if(d>>>0<b>>>0){v=w+32|0;m=d+-1+t|0;c=0;u=0;l=0;g=(f[_>>2]|0)+(d*24|0)|0;while(1){l=l+1|0;u=(f[g+16>>2]|0)+u|0;if((h[g+20>>0]&1)!=0|(d|0)==(m|0)){if((u|0)>1){t=0;do{u=u>>1;t=t+1|0}while((u|0)>1)}else t=0;p=f[v>>2]|0;if((l|0)>1){u=0;do{l=l>>1;u=u+1|0}while((l|0)>1);l=u}else l=0;u=t+1-p-l|0;c=(c|0)>(u|0)?c:u;u=0;l=0}d=d+1|0;if((d|0)==(b|0))break;else g=g+24|0}if((c|0)>0){t=c;while(1){Ro(P,1,1);if((t|0)>1)t=t+-1|0;else{t=u;break}}}else t=u}else{c=0;t=0;l=0}Ro(P,0,1);m=w+32|0;f[m>>2]=(f[m>>2]|0)+c;c=f[E>>2]|0;if(c>>>0<b>>>0){p=(f[_>>2]|0)+(c*24|0)|0;while(1){l=l+1|0;u=(f[p+16>>2]|0)+t|0;if((h[p+20>>0]&1)==0?(c|0)!=((f[E>>2]|0)+-1+(f[r>>2]|0)|0):0)t=u;else{d=f[m>>2]|0;if((l|0)>1){t=0;do{l=l>>1;t=t+1|0}while((l|0)>1)}else t=0;Ro(P,u,t+d|0);t=0;l=0}c=c+1|0;if((c|0)==(b|0))break;else p=p+24|0}}}x=x+1|0;if((x|0)==(S|0))break;else w=w+52|0}}}k=k+1|0;if(k>>>0>=(f[I>>2]|0)>>>0)break;else R=R+36|0}}if(!(Po(P)|0)){To(P);a=0;return a|0}t=Ao(P)|0;r=C+t|0;o=o-t|0;To(P);if(f[n>>2]&4){h[r>>0]=-1;h[C+(t+1)>>0]=-110;o=o+-2|0;r=C+(t+2)|0}_=(s|0)!=0;if(_?(f[s+12>>2]|0)!=0:0){C=r-i|0;n=(f[(f[s+88>>2]|0)+(e*592|0)+548>>2]|0)+(f[s+8>>2]<<5)+8|0;f[n>>2]=C;f[n+4>>2]=((C|0)<0)<<31>>31}t=f[I>>2]|0;e:do{if(t){b=s+12|0;E=s+8|0;w=s+88|0;g=L;v=0;t:while(1){l=f[g+20>>2]|0;m=ue(f[l+(F*40|0)+20>>2]|0,f[l+(F*40|0)+16>>2]|0)|0;l=f[l+(F*40|0)+24>>2]|0;if(m){if(_){p=0;while(1){d=f[l+4>>2]|0;t=d+(O*24|0)|0;if(f[t>>2]|0){c=d+(O*24|0)+4|0;u=f[c>>2]|0;if(u>>>0>o>>>0){r=0;o=81;break t}Xl(r|0,f[d+(O*24|0)+16>>2]|0,u|0)|0;n=l+40|0;f[n>>2]=(f[n>>2]|0)+(f[t>>2]|0);n=f[c>>2]|0;r=r+n|0;o=o-n|0;if((f[b>>2]|0)!=0?(n=(f[(f[w>>2]|0)+(e*592|0)+548>>2]|0)+(f[E>>2]<<5)+24|0,N=+y[d+(O*24|0)+8>>3]+ +y[n>>3],y[n>>3]=N,+y[s>>3]<N):0)y[s>>3]=N}p=p+1|0;if(p>>>0>=m>>>0)break;else l=l+52|0}}else{p=0;while(1){t=f[l+4>>2]|0;c=t+(O*24|0)|0;if(f[c>>2]|0){u=t+(O*24|0)+4|0;d=f[u>>2]|0;if(d>>>0>o>>>0){r=0;o=81;break t}Xl(r|0,f[t+(O*24|0)+16>>2]|0,d|0)|0;n=l+40|0;f[n>>2]=(f[n>>2]|0)+(f[c>>2]|0);n=f[u>>2]|0;o=o-n|0;r=r+n|0}p=p+1|0;if(p>>>0>=m>>>0)break;else l=l+52|0}}t=f[I>>2]|0}v=v+1|0;if(v>>>0>=t>>>0)break e;else g=g+36|0}if((o|0)==81)return r|0}}while(0);f[a>>2]=r-i+(f[a>>2]|0);a=1;return a|0}function ss(e,t,n,r,i,a,o,s,l){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;var c=0,u=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0;U=b;b=b+64|0;H=U+40|0;O=U+32|0;x=U+24|0;w=U+16|0;_=U+8|0;y=U;E=U+48|0;D=U+44|0;f[D>>2]=a;A=f[r+28>>2]|0;F=r+24|0;T=f[t+((f[F>>2]|0)*52|0)+24>>2]|0;I=r+36|0;if((f[I>>2]|0)==0?(v=T+(A*136|0)+24|0,c=f[v>>2]|0,(c|0)!=0):0){g=r+32|0;p=0;m=T+(A*136|0)+28|0;while(1){t=f[g>>2]|0;u=f[m+20>>2]|0;if((f[m+8>>2]|0)!=(f[m>>2]|0)?(f[m+12>>2]|0)!=(f[m+4>>2]|0):0){or(f[u+(t*40|0)+32>>2]|0);or(f[u+(t*40|0)+36>>2]|0);c=ue(f[u+(t*40|0)+20>>2]|0,f[u+(t*40|0)+16>>2]|0)|0;if(c){d=0;t=f[u+(t*40|0)+24>>2]|0;while(1){f[t+44>>2]=0;f[t+48>>2]=0;d=d+1|0;if((d|0)==(c|0))break;else t=t+56|0}}c=f[v>>2]|0}p=p+1|0;if(p>>>0>=c>>>0)break;else m=m+36|0}}do{if(f[n>>2]&2){if(s>>>0<6){Jr(l,2,22072,y)|0;break}t=f[D>>2]|0;if((h[t>>0]|0)==-1?(h[t+1>>0]|0)==-111:0){f[D>>2]=t+6;break}Jr(l,2,22114,_)|0}}while(0);C=xo()|0;if(!C){a=0;b=U;return a|0}do{if(!(h[e+96>>0]&1))if(!(h[n+5636>>0]&2)){P=f[D>>2]|0;f[E>>2]=a+s-P;L=D;break}else{L=n+5168|0;P=f[L>>2]|0;E=n+5180|0;break}else{L=e+40|0;P=f[L>>2]|0;E=e+44|0}}while(0);So(C,P,f[E>>2]|0);if(!(ko(C,1)|0)){Lo(C)|0;c=Ao(C)|0;t=P+c|0;To(C);do{if(f[n>>2]&4){if(((f[E>>2]|0)-t+(f[L>>2]|0)|0)>>>0<2){Jr(l,2,22135,w)|0;break}if((h[t>>0]|0)==-1?(h[P+(c+1)>>0]|0)==-110:0){t=P+(c+2)|0;break}Jr(l,2,22177,x)|0}}while(0);f[E>>2]=(f[E>>2]|0)+((f[L>>2]|0)-t);f[L>>2]=t;f[i>>2]=0;f[o>>2]=(f[D>>2]|0)-a;a=1;b=U;return a|0}k=T+(A*136|0)+24|0;t=f[k>>2]|0;e:do{if(t){S=r+32|0;R=n+5584|0;M=0;T=T+(A*136|0)+28|0;t:while(1){c=f[S>>2]|0;u=f[T+20>>2]|0;if(((f[T+8>>2]|0)!=(f[T>>2]|0)?(f[T+12>>2]|0)!=(f[T+4>>2]|0):0)?(N=ue(f[u+(c*40|0)+20>>2]|0,f[u+(c*40|0)+16>>2]|0)|0,(N|0)!=0):0){e=u+(c*40|0)+32|0;r=u+(c*40|0)+36|0;w=T+28|0;x=0;s=f[u+(c*40|0)+24>>2]|0;while(1){c=s+44|0;if(!(f[c>>2]|0))t=go(C,f[e>>2]|0,x,(f[I>>2]|0)+1|0)|0;else t=ko(C,1)|0;n:do{if(!t)f[s+40>>2]=0;else{if(!(f[c>>2]|0)){t=0;while(1)if(!(go(C,f[r>>2]|0,x,t)|0))t=t+1|0;else break;f[s+24>>2]=1-t+(f[w>>2]|0);f[s+28>>2]=3}do{if(ko(C,1)|0)if(ko(C,1)|0){t=ko(C,2)|0;if((t|0)!=3){t=t+3|0;break}t=ko(C,5)|0;if((t|0)==31){t=(ko(C,7)|0)+37|0;break}else{t=t+6|0;break}}else t=2;else t=1}while(0);y=s+40|0;f[y>>2]=t;t=0;while(1)if(!(ko(C,1)|0))break;else t=t+1|0;_=s+28|0;f[_>>2]=(f[_>>2]|0)+t;c=f[c>>2]|0;do{if(!c){u=f[(f[R>>2]|0)+((f[F>>2]|0)*1080|0)+16>>2]|0;t=s+52|0;if(!(f[t>>2]|0)){f[t>>2]=10;d=s+4|0;c=Qi(f[d>>2]|0,320)|0;if(!c){c=t;u=d;t=d;d=66;break t}f[d>>2]=c}else c=f[s+4>>2]|0;f[c>>2]=0;f[c+4>>2]=0;f[c+8>>2]=0;f[c+12>>2]=0;f[c+16>>2]=0;f[c+20>>2]=0;f[c+24>>2]=0;f[c+28>>2]=0;if(u&4){f[c+20>>2]=1;c=0;break}c=c+20|0;if(!(u&1)){f[c>>2]=109;c=0;break}else{f[c>>2]=10;c=0;break}}else{m=c+-1|0;g=s+4|0;u=f[g>>2]|0;if((f[u+(m<<5)+8>>2]|0)!=(f[u+(m<<5)+20>>2]|0)){t=s+52|0;c=m;break}p=f[(f[R>>2]|0)+((f[F>>2]|0)*1080|0)+16>>2]|0;t=s+52|0;d=f[t>>2]|0;if((c+1|0)>>>0>d>>>0){A=d+10|0;f[t>>2]=A;u=Qi(u,A<<5)|0;if(!u){u=g;c=t;t=g;d=77;break t}f[g>>2]=u}A=u+(c<<5)|0;f[A>>2]=0;f[A+4>>2]=0;f[A+8>>2]=0;f[A+12>>2]=0;f[A+16>>2]=0;f[A+20>>2]=0;f[A+24>>2]=0;f[A+28>>2]=0;if(p&4){f[u+(c<<5)+20>>2]=1;break}if(!(p&1)){f[u+(c<<5)+20>>2]=109;break}else{A=f[u+(m<<5)+20>>2]|0;f[u+(c<<5)+20>>2]=(A|0)==1|(A|0)==10?2:1;break}}}while(0);v=s+4|0;m=f[y>>2]|0;while(1){p=f[v>>2]|0;u=(f[p+(c<<5)+20>>2]|0)-(f[p+(c<<5)+8>>2]|0)|0;u=(u|0)<(m|0)?u:m;f[p+(c<<5)+24>>2]=u;p=f[_>>2]|0;if(u>>>0>1){d=0;while(1){d=d+1|0;if(u>>>0>3)u=u>>>1;else{u=d;break}}}else u=0;p=ko(C,u+p|0)|0;u=f[v>>2]|0;f[u+(c<<5)+28>>2]=p;p=m-(f[u+(c<<5)+24>>2]|0)|0;if((p|0)<=0)break n;m=c+1|0;g=f[(f[R>>2]|0)+((f[F>>2]|0)*1080|0)+16>>2]|0;d=f[t>>2]|0;if((c+2|0)>>>0>d>>>0){A=d+10|0;f[t>>2]=A;u=Qi(u,A<<5)|0;if(!u){u=v;c=v;d=90;break t}f[v>>2]=u}A=u+(m<<5)|0;f[A>>2]=0;f[A+4>>2]=0;f[A+8>>2]=0;f[A+12>>2]=0;f[A+16>>2]=0;f[A+20>>2]=0;f[A+24>>2]=0;f[A+28>>2]=0;if(g&4){f[u+(m<<5)+20>>2]=1;c=m;m=p;continue}if(!(g&1)){f[u+(m<<5)+20>>2]=109;c=m;m=p;continue}else{A=f[u+(c<<5)+20>>2]|0;f[u+(m<<5)+20>>2]=(A|0)==1|(A|0)==10?2:1;c=m;m=p;continue}}}}while(0);x=x+1|0;if(x>>>0>=N>>>0)break;else s=s+56|0}t=f[k>>2]|0}M=M+1|0;if(M>>>0>=t>>>0)break e;else T=T+36|0}if((d|0)==66){Ji(f[t>>2]|0);f[u>>2]=0;f[c>>2]=0;To(C);a=0;b=U;return a|0}else if((d|0)==77){Ji(f[t>>2]|0);f[u>>2]=0;f[c>>2]=0;To(C);a=0;b=U;return a|0}else if((d|0)==90){Ji(f[c>>2]|0);f[u>>2]=0;f[t>>2]=0;To(C);a=0;b=U;return a|0}}}while(0);if(!(Lo(C)|0)){To(C);a=0;b=U;return a|0}c=Ao(C)|0;t=P+c|0;To(C);do{if(f[n>>2]&4){if(((f[E>>2]|0)-t+(f[L>>2]|0)|0)>>>0<2){Jr(l,2,22135,O)|0;break}if((h[t>>0]|0)==-1?(h[P+(c+1)>>0]|0)==-110:0){t=P+(c+2)|0;break}Jr(l,2,22177,H)|0}}while(0);f[E>>2]=(f[E>>2]|0)+((f[L>>2]|0)-t);f[L>>2]=t;f[i>>2]=1;f[o>>2]=(f[D>>2]|0)-a;a=1;b=U;return a|0}function ls(){return Xi(104)|0}function cs(e){e=e|0;if(!e)return;Ji(e);return}function us(e){e=e|0;return(f[e+12>>2]|0)-(f[e+16>>2]|0)|0}function hs(e,t){e=e|0;t=t|0;var n=0,r=0;f[e+100>>2]=e+24;f[e+4>>2]=32768;f[e>>2]=0;r=t+-1|0;f[e+12>>2]=r;n=e+8|0;f[n>>2]=12;f[n>>2]=(h[r>>0]|0)==-1?13:12;f[e+16>>2]=t;return}function ds(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0;i=f[e+100>>2]|0;a=f[i>>2]|0;s=(f[a+4>>2]|0)==(t|0);r=f[a>>2]|0;l=e+4|0;t=(f[l>>2]|0)-r|0;f[l>>2]=t;if(!s){if(t>>>0<r>>>0){s=(f[e>>2]|0)+r|0;f[e>>2]=s;r=t;t=s;s=e}else{f[l>>2]=r;t=f[e>>2]|0;s=e}f[i>>2]=f[a+12>>2];o=e+8|0;a=e+12|0;i=t;t=f[o>>2]|0;while(1){r=r<<1;f[l>>2]=r;n=i<<1;f[s>>2]=n;t=t+-1|0;f[o>>2]=t;if(!t){t=f[a>>2]|0;r=h[t>>0]|0;do{if(r<<24>>24!=-1){if(!(n&134217728)){n=t+1|0;f[a>>2]=n;h[n>>0]=i>>>18;n=f[s>>2]&524287;f[s>>2]=n;f[o>>2]=8;t=8;break}h[t>>0]=r+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){e=f[s>>2]&134217727;f[s>>2]=e;n=t+1|0;f[a>>2]=n;h[n>>0]=e>>>20;n=f[s>>2]&1048575;f[s>>2]=n;f[o>>2]=7;t=7;break}else{n=t+1|0;f[a>>2]=n;h[n>>0]=(f[s>>2]|0)>>>19;n=f[s>>2]&524287;f[s>>2]=n;f[o>>2]=8;t=8;break}}else{n=t+1|0;f[a>>2]=n;h[n>>0]=i>>>19;n=f[s>>2]&1048575;f[s>>2]=n;f[o>>2]=7;t=7}}while(0);r=f[l>>2]|0}if(!(r&32768))i=n;else break}return}if(t&32768){f[e>>2]=(f[e>>2]|0)+r;return}if(t>>>0<r>>>0){f[l>>2]=r;n=f[e>>2]|0;s=e}else{n=(f[e>>2]|0)+r|0;f[e>>2]=n;r=t;s=e}f[i>>2]=f[a+8>>2];o=e+8|0;a=e+12|0;i=n;t=f[o>>2]|0;while(1){r=r<<1;f[l>>2]=r;n=i<<1;f[s>>2]=n;t=t+-1|0;f[o>>2]=t;if(!t){t=f[a>>2]|0;r=h[t>>0]|0;do{if(r<<24>>24!=-1){if(!(n&134217728)){n=t+1|0;f[a>>2]=n;h[n>>0]=i>>>18;n=f[s>>2]&524287;f[s>>2]=n;f[o>>2]=8;t=8;break}h[t>>0]=r+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){e=f[s>>2]&134217727;f[s>>2]=e;n=t+1|0;f[a>>2]=n;h[n>>0]=e>>>20;n=f[s>>2]&1048575;f[s>>2]=n;f[o>>2]=7;t=7;break}else{n=t+1|0;f[a>>2]=n;h[n>>0]=(f[s>>2]|0)>>>19;n=f[s>>2]&524287;f[s>>2]=n;f[o>>2]=8;t=8;break}}else{n=t+1|0;f[a>>2]=n;h[n>>0]=i>>>19;n=f[s>>2]&1048575;f[s>>2]=n;f[o>>2]=7;t=7}}while(0);r=f[l>>2]|0}if(!(r&32768))i=n;else break}return}function fs(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;a=f[e>>2]|0;r=a|65535;i=e+8|0;r=(r>>>0<((f[e+4>>2]|0)+a|0)>>>0?r:r+-32768|0)<<f[i>>2];f[e>>2]=r;a=e+12|0;t=f[a>>2]|0;n=h[t>>0]|0;do{if(n<<24>>24!=-1){if(!(r&134217728)){t=t+1|0;f[a>>2]=t;h[t>>0]=r>>>19;t=f[e>>2]&524287;f[e>>2]=t;f[i>>2]=8;n=8;break}h[t>>0]=n+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){n=f[e>>2]&134217727;f[e>>2]=n;t=t+1|0;f[a>>2]=t;h[t>>0]=n>>>20;t=f[e>>2]&1048575;f[e>>2]=t;f[i>>2]=7;n=7;break}else{t=t+1|0;f[a>>2]=t;h[t>>0]=(f[e>>2]|0)>>>19;t=f[e>>2]&524287;f[e>>2]=t;f[i>>2]=8;n=8;break}}else{t=t+1|0;f[a>>2]=t;h[t>>0]=r>>>20;t=f[e>>2]&1048575;f[e>>2]=t;f[i>>2]=7;n=7}}while(0);t=t<<n;f[e>>2]=t;n=f[a>>2]|0;r=h[n>>0]|0;do{if(r<<24>>24!=-1){if(!(t&134217728)){r=n+1|0;f[a>>2]=r;h[r>>0]=t>>>19;f[e>>2]=f[e>>2]&524287;f[i>>2]=8;break}h[n>>0]=r+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){n=f[e>>2]&134217727;f[e>>2]=n;r=t+1|0;f[a>>2]=r;h[r>>0]=n>>>20;f[e>>2]=f[e>>2]&1048575;f[i>>2]=7;break}else{r=t+1|0;f[a>>2]=r;h[r>>0]=(f[e>>2]|0)>>>19;f[e>>2]=f[e>>2]&524287;f[i>>2]=8;break}}else{r=n+1|0;f[a>>2]=r;h[r>>0]=t>>>20;f[e>>2]=f[e>>2]&1048575;f[i>>2]=7}}while(0);t=f[a>>2]|0;if((h[t>>0]|0)==-1)return;f[a>>2]=t+1;return}function ps(e){e=e|0;f[e>>2]=0;f[e+8>>2]=8;return}function ms(e,t){e=e|0;t=t|0;var n=0,r=0,i=0;n=e+8|0;r=(f[n>>2]|0)+-1|0;f[n>>2]=r;t=(t<<r)+(f[e>>2]|0)|0;f[e>>2]=t;if(r)return;r=e+12|0;i=(f[r>>2]|0)+1|0;f[r>>2]=i;h[i>>0]=t;f[n>>2]=8;f[n>>2]=(h[f[r>>2]>>0]|0)==-1?7:8;f[e>>2]=0;return}function gs(e){e=e|0;f[e+28>>2]=1156;f[e+32>>2]=1156;f[e+36>>2]=1156;f[e+40>>2]=1156;f[e+44>>2]=1156;f[e+48>>2]=1156;f[e+52>>2]=1156;f[e+56>>2]=1156;f[e+60>>2]=1156;f[e+64>>2]=1156;f[e+68>>2]=1156;f[e+72>>2]=1156;f[e+76>>2]=1156;f[e+80>>2]=1156;f[e+84>>2]=1156;f[e+88>>2]=1156;f[e+96>>2]=2628;f[e+92>>2]=1252;f[e+24>>2]=1284;return}function vs(e){e=e|0;f[e+24>>2]=1156;f[e+28>>2]=1156;f[e+32>>2]=1156;f[e+36>>2]=1156;f[e+40>>2]=1156;f[e+44>>2]=1156;f[e+48>>2]=1156;f[e+52>>2]=1156;f[e+56>>2]=1156;f[e+60>>2]=1156;f[e+64>>2]=1156;f[e+68>>2]=1156;f[e+72>>2]=1156;f[e+76>>2]=1156;f[e+80>>2]=1156;f[e+84>>2]=1156;f[e+88>>2]=1156;f[e+92>>2]=1156;f[e+96>>2]=1156;return}function ys(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;f[e+24+(t<<2)>>2]=1156+((r<<1)+n<<4);return}function _s(e){e=e|0;var t=0,n=0;f[e+100>>2]=e+24;f[e+4>>2]=32768;f[e>>2]=0;t=e+8|0;f[t>>2]=12;n=e+12|0;e=(f[n>>2]|0)+-1|0;f[n>>2]=e;if((h[e>>0]|0)!=-1)return;f[t>>2]=13;return}function bs(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0;o=e+8|0;t=f[o>>2]|0;r=12-t|0;if((r|0)>0){i=e+12|0;n=f[e>>2]|0;do{t=n<<t;f[e>>2]=t;f[o>>2]=0;n=f[i>>2]|0;a=h[n>>0]|0;do{if(a<<24>>24!=-1){if(!(t&134217728)){n=n+1|0;f[i>>2]=n;h[n>>0]=t>>>19;n=f[e>>2]&524287;f[e>>2]=n;f[o>>2]=8;t=8;break}h[n>>0]=a+1<<24>>24;t=f[i>>2]|0;if((h[t>>0]|0)==-1){a=f[e>>2]&134217727;f[e>>2]=a;n=t+1|0;f[i>>2]=n;h[n>>0]=a>>>20;n=f[e>>2]&1048575;f[e>>2]=n;f[o>>2]=7;t=7;break}else{n=t+1|0;f[i>>2]=n;h[n>>0]=(f[e>>2]|0)>>>19;n=f[e>>2]&524287;f[e>>2]=n;f[o>>2]=8;t=8;break}}else{n=n+1|0;f[i>>2]=n;h[n>>0]=t>>>20;n=f[e>>2]&1048575;f[e>>2]=n;f[o>>2]=7;t=7}}while(0);r=r-t|0}while((r|0)>0)}else i=e+12|0;t=f[i>>2]|0;n=h[t>>0]|0;if(n<<24>>24==-1)return;r=f[e>>2]|0;if(!(r&134217728)){a=t+1|0;f[i>>2]=a;h[a>>0]=r>>>19;f[e>>2]=f[e>>2]&524287;f[o>>2]=8;return}h[t>>0]=n+1<<24>>24;t=f[i>>2]|0;if((h[t>>0]|0)==-1){r=f[e>>2]&134217727;f[e>>2]=r;a=t+1|0;f[i>>2]=a;h[a>>0]=r>>>20;f[e>>2]=f[e>>2]&1048575;f[o>>2]=7;return}else{a=t+1|0;f[i>>2]=a;h[a>>0]=(f[e>>2]|0)>>>19;f[e>>2]=f[e>>2]&524287;f[o>>2]=8;return}}function Es(e){e=e|0;f[e+100>>2]=e+96;ds(e,1);ds(e,0);ds(e,1);ds(e,0);return}function ws(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;f[e+100>>2]=e+24;f[e+16>>2]=t;f[e+20>>2]=t+n;i=e+12|0;f[i>>2]=t;do{if(n){a=p[t>>0]<<16;f[e>>2]=a;r=t+1|0;if((n|0)==1)n=255;else n=p[r>>0]|0;if((h[t>>0]|0)!=-1){f[i>>2]=r;r=a|n<<8;f[e>>2]=r;n=e+8|0;f[n>>2]=8;i=e;a=1;break}if(n>>>0>143){r=a|65280;f[e>>2]=r;n=e+8|0;f[n>>2]=8;i=e;a=1;break}else{f[i>>2]=r;r=a+(n<<9)|0;f[e>>2]=r;n=e+8|0;f[n>>2]=7;i=e;a=0;break}}else{f[e>>2]=16776960;n=e+8|0;f[n>>2]=8;r=16776960;i=e;a=1}}while(0);f[i>>2]=r<<7;f[n>>2]=a;f[e+4>>2]=32768;return 1}function xs(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0;n=f[e+100>>2]|0;r=f[n>>2]|0;o=f[r>>2]|0;u=e+4|0;a=(f[u>>2]|0)-o|0;f[u>>2]=a;i=f[e>>2]|0;if(i>>>16>>>0<o>>>0){f[u>>2]=o;t=f[r+4>>2]|0;if(a>>>0<o>>>0)f[n>>2]=f[r+8>>2];else{f[n>>2]=f[r+12>>2];t=1-t|0}s=e+8|0;l=e+12|0;c=e+20|0;r=f[s>>2]|0;n=i;do{do{if(!r){i=f[l>>2]|0;r=f[c>>2]|0;if((i|0)==(r|0)){n=n+65280|0;f[e>>2]=n;f[s>>2]=8;r=8;break}a=i+1|0;if((a|0)==(r|0))r=255;else r=p[a>>0]|0;if((h[i>>0]|0)!=-1){f[l>>2]=a;n=n+(r<<8)|0;f[e>>2]=n;f[s>>2]=8;r=8;break}if(r>>>0>143){n=n+65280|0;f[e>>2]=n;f[s>>2]=8;r=8;break}else{f[l>>2]=a;n=n+(r<<9)|0;f[e>>2]=n;f[s>>2]=7;r=7;break}}}while(0);o=o<<1;f[u>>2]=o;n=n<<1;f[e>>2]=n;r=r+-1|0;f[s>>2]=r}while(o>>>0<32768);return t|0}i=i-(o<<16)|0;f[e>>2]=i;if(a&32768){e=f[r+4>>2]|0;return e|0}t=f[r+4>>2]|0;if(o>>>0>a>>>0){f[n>>2]=f[r+12>>2];t=1-t|0}else f[n>>2]=f[r+8>>2];s=e+8|0;l=e+12|0;c=e+20|0;r=f[s>>2]|0;n=i;o=a;do{do{if(!r){i=f[l>>2]|0;r=f[c>>2]|0;if((i|0)==(r|0)){n=n+65280|0;f[e>>2]=n;f[s>>2]=8;r=8;break}a=i+1|0;if((a|0)==(r|0))r=255;else r=p[a>>0]|0;if((h[i>>0]|0)!=-1){f[l>>2]=a;n=n+(r<<8)|0;f[e>>2]=n;f[s>>2]=8;r=8;break}if(r>>>0>143){n=n+65280|0;f[e>>2]=n;f[s>>2]=8;r=8;break}else{f[l>>2]=a;n=n+(r<<9)|0;f[e>>2]=n;f[s>>2]=7;r=7;break}}}while(0);o=o<<1;f[u>>2]=o;n=n<<1;f[e>>2]=n;r=r+-1|0;f[s>>2]=r}while(o>>>0<32768);return t|0}function Ts(){return Xi(28)|0}function As(e){e=e|0;if(!e)return;Ji(e);return}function Ms(e,t,n){e=e|0;t=t|0;n=n|0;f[e+20>>2]=t;f[e+8>>2]=n;f[e+12>>2]=0;h[e>>0]=0;f[e+4>>2]=0;return}function Ss(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;i=e+4|0;t=f[i>>2]|0;do{if(!t){f[i>>2]=8;n=e+12|0;r=f[n>>2]|0;if((r|0)==(f[e+8>>2]|0)){h[e>>0]=-1;t=8;n=-1;break}if((h[e>>0]|0)==-1){f[i>>2]=7;t=7}else t=8;a=h[(f[e+20>>2]|0)+r>>0]|0;h[e>>0]=a;f[n>>2]=r+1;n=a}else n=h[e>>0]|0}while(0);a=t+-1|0;f[i>>2]=a;return(n&255)>>>a&1|0}function Rs(){var e=0;if(!(f[665]|0))e=2712;else{e=(Be()|0)+60|0;e=f[e>>2]|0}return e|0}function ks(e){e=e|0;var t=0,n=0;t=0;while(1){if((p[22198+t>>0]|0)==(e|0)){n=2;break}t=t+1|0;if((t|0)==87){t=87;e=22286;n=5;break}}if((n|0)==2)if(!t)e=22286;else{e=22286;n=5}if((n|0)==5)while(1){n=e;while(1){e=n+1|0;if(!(h[n>>0]|0))break;else n=e}t=t+-1|0;if(!t)break;else n=5}return e|0}function Ps(e){e=e|0;var t=0;if(e>>>0>4294963200){t=Rs()|0;f[t>>2]=0-e;e=-1}return e|0}function Ls(e,t){e=+e;t=t|0;var n=0,r=0,i=0;y[w>>3]=e;n=f[w>>2]|0;r=f[w+4>>2]|0;i=ql(n|0,r|0,52)|0;i=i&2047;switch(i|0){case 0:{if(e!=0.0){e=+Ls(e*18446744073709551616.0,t);n=(f[t>>2]|0)+-64|0}else n=0;f[t>>2]=n;break}case 2047:break;default:{f[t>>2]=i+-1022;f[w>>2]=n;f[w+4>>2]=r&-2146435073|1071644672;e=+y[w>>3]}}return+e}function Cs(e,t){e=+e;t=t|0;return+ +Ls(e,t)}function Is(e,t){e=+e;t=t|0;return+ +Os(e,t)}function Ns(e){e=+e;return~~+Fs(e)|0}function Fs(e){e=+e;var t=0;t=(v[w>>2]=e,f[w>>2]|0);if((t&2130706432)>>>0<=1249902592){t=(t|0)<0;e=t?e+-8388608.0+8388608.0:e+8388608.0+-8388608.0;if(e==0.0)e=t?-0.0:0.0}return+e}function Os(e,t){e=+e;t=t|0;var n=0;if((t|0)>1023){e=e*8988465674311579538646525.0e283;n=t+-1023|0;if((n|0)>1023){n=t+-2046|0;n=(n|0)>1023?1023:n;e=e*8988465674311579538646525.0e283}}else if((t|0)<-1022){e=e*2.2250738585072014e-308;n=t+1022|0;if((n|0)<-1022){n=t+2044|0;n=(n|0)<-1022?-1022:n;e=e*2.2250738585072014e-308}}else n=t;n=Gl(n+1023|0,0,52)|0;t=B;f[w>>2]=n;f[w+4>>2]=t;return+(e*+y[w>>3])}function Hs(e,t,n){e=e|0;t=t|0;n=n|0;do{if(e){if(t>>>0<128){h[e>>0]=t;e=1;break}if(t>>>0<2048){h[e>>0]=t>>>6|192;h[e+1>>0]=t&63|128;e=2;break}if(t>>>0<55296|(t&-8192|0)==57344){h[e>>0]=t>>>12|224;h[e+1>>0]=t>>>6&63|128;h[e+2>>0]=t&63|128;e=3;break}if((t+-65536|0)>>>0<1048576){h[e>>0]=t>>>18|240;h[e+1>>0]=t>>>12&63|128;h[e+2>>0]=t>>>6&63|128;h[e+3>>0]=t&63|128;e=4;break}else{e=Rs()|0;f[e>>2]=84;e=-1;break}}else e=1}while(0);return e|0}function Ds(e,t){e=e|0;t=t|0;if(!e)e=0;else e=Hs(e,t,0)|0;return e|0}function Us(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0;d=b;b=b+112|0;u=d+40|0;l=d+24|0;s=d+16|0;i=d;c=d+52|0;r=h[t>>0]|0;if(yl(24090,r<<24>>24,4)|0){n=Cl(1144)|0;if(!n)n=0;else{a=n;o=a+112|0;do{f[a>>2]=0;a=a+4|0}while((a|0)<(o|0));if(!(bl(t,43)|0))f[n>>2]=r<<24>>24==114?8:4;if(bl(t,101)|0){f[i>>2]=e;f[i+4>>2]=2;f[i+8>>2]=1;ke(221,i|0)|0;r=h[t>>0]|0}if(r<<24>>24==97){f[s>>2]=e;f[s+4>>2]=3;r=ke(221,s|0)|0;if(!(r&1024)){f[l>>2]=e;f[l+4>>2]=4;f[l+8>>2]=r|1024;ke(221,l|0)|0}t=f[n>>2]|128;f[n>>2]=t}else t=f[n>>2]|0;f[n+60>>2]=e;f[n+44>>2]=n+120;f[n+48>>2]=1024;r=n+75|0;h[r>>0]=-1;if((t&8|0)==0?(f[u>>2]=e,f[u+4>>2]=21505,f[u+8>>2]=c,(je(54,u|0)|0)==0):0)h[r>>0]=10;f[n+32>>2]=60;f[n+36>>2]=61;f[n+40>>2]=3;f[n+12>>2]=1;if(!(f[666]|0))f[n+76>>2]=-1;qe(2688);r=f[671]|0;f[n+56>>2]=r;if(r)f[r+52>>2]=n;f[671]=n;Ge(2688)}}else{n=Rs()|0;f[n>>2]=22;n=0}b=d;return n|0}function Bs(e){e=e|0;var t=0,n=0,r=0;n=(bl(e,43)|0)==0;t=h[e>>0]|0;n=n?t<<24>>24!=114&1:2;r=(bl(e,120)|0)==0;n=r?n:n|128;e=(bl(e,101)|0)==0;e=e?n:n|524288;e=t<<24>>24==114?e:e|64;e=t<<24>>24==119?e|512:e;return(t<<24>>24==97?e|1024:e)|0}function zs(e){e=e|0;return 0}function Vs(e){e=e|0;return}function js(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0;l=b;b=b+16|0;s=l;o=t&255;h[s>>0]=o;r=e+16|0;i=f[r>>2]|0;if(!i)if(!(Zs(e)|0)){i=f[r>>2]|0;a=4}else n=-1;else a=4;do{if((a|0)==4){r=e+20|0;a=f[r>>2]|0;if(a>>>0<i>>>0?(n=t&255,(n|0)!=(h[e+75>>0]|0)):0){f[r>>2]=a+1;h[a>>0]=o;break}if((kc[f[e+36>>2]&63](e,s,1)|0)==1)n=p[s>>0]|0;else n=-1}}while(0);b=l;return n|0}function Gs(e){e=e|0;var t=0,n=0;t=b;b=b+16|0;n=t;f[n>>2]=f[e+60>>2];e=Ps(Xe(6,n|0)|0)|0;b=t;return e|0}function Ws(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0;c=b;b=b+48|0;a=c+16|0;i=c;r=c+32|0;f[r>>2]=t;o=r+4|0;l=e+48|0;u=f[l>>2]|0;f[o>>2]=n-((u|0)!=0&1);s=e+44|0;f[r+8>>2]=f[s>>2];f[r+12>>2]=u;if(!(f[665]|0)){f[a>>2]=f[e+60>>2];f[a+4>>2]=r;f[a+8>>2]=2;r=Ps(Qe(145,a|0)|0)|0}else{Ce(5,e|0);f[i>>2]=f[e+60>>2];f[i+4>>2]=r;f[i+8>>2]=2;r=Ps(Qe(145,i|0)|0)|0;Re(0)}if((r|0)>=1){o=f[o>>2]|0;if(r>>>0>o>>>0){a=f[s>>2]|0;i=e+4|0;f[i>>2]=a;f[e+8>>2]=a+(r-o);if(!(f[l>>2]|0))r=n;else{f[i>>2]=a+1;h[t+(n+-1)>>0]=h[a>>0]|0;r=n}}}else{f[e>>2]=f[e>>2]|r&48^16;f[e+8>>2]=0;f[e+4>>2]=0}b=c;return r|0}function qs(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;i=b;b=b+32|0;a=i;r=i+20|0;f[a>>2]=f[e+60>>2];f[a+4>>2]=0;f[a+8>>2]=t;f[a+12>>2]=r;f[a+16>>2]=n;if((Ps(Ze(140,a|0)|0)|0)<0){f[r>>2]=-1;e=-1}else e=f[r>>2]|0;b=i;return e|0}function Xs(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0;m=b;b=b+48|0;h=m+16|0;u=m;r=m+32|0;d=e+28|0;i=f[d>>2]|0;f[r>>2]=i;p=e+20|0;i=(f[p>>2]|0)-i|0;f[r+4>>2]=i;f[r+8>>2]=t;f[r+12>>2]=n;l=e+60|0;c=e+44|0;t=2;i=i+n|0;while(1){if(!(f[665]|0)){f[h>>2]=f[l>>2];f[h+4>>2]=r;f[h+8>>2]=t;o=Ps(Je(146,h|0)|0)|0}else{Ce(6,e|0);f[u>>2]=f[l>>2];f[u+4>>2]=r;f[u+8>>2]=t;o=Ps(Je(146,u|0)|0)|0;Re(0)}if((i|0)==(o|0)){i=6;break}if((o|0)<0){i=8;break}i=i-o|0;a=f[r+4>>2]|0;if(o>>>0<=a>>>0)if((t|0)==2){f[d>>2]=(f[d>>2]|0)+o;s=a;t=2}else s=a;else{s=f[c>>2]|0;f[d>>2]=s;f[p>>2]=s;s=f[r+12>>2]|0;o=o-a|0;r=r+8|0;t=t+-1|0}f[r>>2]=(f[r>>2]|0)+o;f[r+4>>2]=s-o}if((i|0)==6){h=f[c>>2]|0;f[e+16>>2]=h+(f[e+48>>2]|0);e=h;f[d>>2]=e;f[p>>2]=e}else if((i|0)==8){f[e+16>>2]=0;f[d>>2]=0;f[p>>2]=0;f[e>>2]=f[e>>2]|32;if((t|0)==2)n=0;else n=n-(f[r+4>>2]|0)|0}b=m;return n|0}function Ys(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=b;b=b+80|0;r=i;f[e+36>>2]=61;if((f[e>>2]&64|0)==0?(f[r>>2]=f[e+60>>2],f[r+4>>2]=21505,f[r+8>>2]=i+12,(je(54,r|0)|0)!=0):0)h[e+75>>0]=-1;r=Xs(e,t,n)|0;b=i;return r|0}function Ks(e){e=e|0;var t=0,n=0;t=e+74|0;n=h[t>>0]|0;h[t>>0]=n+255|n;t=e+20|0;n=e+44|0;if((f[t>>2]|0)>>>0>(f[n>>2]|0)>>>0)kc[f[e+36>>2]&63](e,0,0)|0;f[e+16>>2]=0;f[e+28>>2]=0;f[t>>2]=0;t=f[e>>2]|0;if(t&20)if(!(t&4))t=-1;else{f[e>>2]=t|32;t=-1}else{t=f[n>>2]|0;f[e+8>>2]=t;f[e+4>>2]=t;t=0}return t|0}function Zs(e){e=e|0;var t=0,n=0;t=e+74|0;n=h[t>>0]|0;h[t>>0]=n+255|n;t=f[e>>2]|0;if(!(t&8)){f[e+8>>2]=0;f[e+4>>2]=0;t=f[e+44>>2]|0;f[e+28>>2]=t;f[e+20>>2]=t;f[e+16>>2]=t+(f[e+48>>2]|0);t=0}else{f[e>>2]=t|32;t=-1}return t|0}function Qs(e){e=e|0;var t=0,n=0,r=0;r=(f[e>>2]&1|0)!=0;if(!r){qe(2688);n=f[e+52>>2]|0;t=e+56|0;if(n)f[n+56>>2]=f[t>>2];t=f[t>>2]|0;if(t)f[t+52>>2]=n;if((f[671]|0)==(e|0))f[671]=t;Ge(2688)}t=Js(e)|0;t=Nc[f[e+12>>2]&15](e)|0|t;n=f[e+92>>2]|0;if(n)Il(n);if(!r)Il(e);return t|0}function Js(e){e=e|0;var t=0,n=0;do{if(e){if((f[e+76>>2]|0)<=-1){t=Ml(e)|0;break}n=(zs(e)|0)==0;t=Ml(e)|0;if(!n)Vs(e)}else{if(!(f[677]|0))t=0;else t=Js(f[677]|0)|0;qe(2688);e=f[671]|0;if(e)do{if((f[e+76>>2]|0)>-1)n=zs(e)|0;else n=0;if((f[e+20>>2]|0)>>>0>(f[e+28>>2]|0)>>>0)t=Ml(e)|0|t;if(n)Vs(e);e=f[e+56>>2]|0}while((e|0)!=0);Ge(2688)}}while(0);return t|0}function $s(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;i=b;b=b+32|0;r=i+16|0;n=i;if(yl(24090,h[t>>0]|0,4)|0){a=Bs(t)|0|32768;f[n>>2]=e;f[n+4>>2]=a;f[n+8>>2]=438;n=Ps(Ye(5,n|0)|0)|0;if((n|0)>=0){e=Us(n,t)|0;if(!e){f[r>>2]=n;Xe(6,r|0)|0;e=0}}else e=0}else{e=Rs()|0;f[e>>2]=22;e=0}b=i;return e|0}function el(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;r=b;b=b+16|0;i=r;f[i>>2]=n;n=ml(e,t,i)|0;b=r;return n|0}function tl(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;if((f[t+76>>2]|0)>=0?(zs(t)|0)!=0:0){if((h[t+75>>0]|0)!=(e|0)?(r=t+20|0,i=f[r>>2]|0,i>>>0<(f[t+16>>2]|0)>>>0):0){f[r>>2]=i+1;h[i>>0]=e;n=e&255}else n=js(t,e)|0;Vs(t)}else o=3;do{if((o|0)==3){if((h[t+75>>0]|0)!=(e|0)?(a=t+20|0,n=f[a>>2]|0,n>>>0<(f[t+16>>2]|0)>>>0):0){f[a>>2]=n+1;h[n>>0]=e;n=e&255;break}n=js(t,e)|0}}while(0);return n|0}function nl(e,t){e=e|0;t=t|0;return(hl(e,xl(e)|0,1,t)|0)+-1|0}function rl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;s=ue(n,t)|0;if((f[r+76>>2]|0)>-1)l=zs(r)|0;else l=0;i=r+74|0;a=h[i>>0]|0;h[i>>0]=a+255|a;i=r+4|0;a=f[i>>2]|0;o=(f[r+8>>2]|0)-a|0;if((o|0)>0){o=o>>>0<s>>>0?o:s;Xl(e|0,a|0,o|0)|0;f[i>>2]=a+o;e=e+o|0;i=s-o|0}else i=s;e:do{if(!i)c=13;else{o=r+32|0;a=i;while(1){if(Ks(r)|0){n=a;break}i=kc[f[o>>2]&63](r,e,a)|0;if((i+1|0)>>>0<2){n=a;break}if((a|0)==(i|0)){c=13;break e}else{e=e+i|0;a=a-i|0}}if(l)Vs(r);n=((s-n|0)>>>0)/(t>>>0)|0}}while(0);if((c|0)==13)if(l)Vs(r);return n|0}function il(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;if((n|0)==1)t=t-(f[e+8>>2]|0)+(f[e+4>>2]|0)|0;i=e+20|0;r=e+28|0;if((f[i>>2]|0)>>>0>(f[r>>2]|0)>>>0?(kc[f[e+36>>2]&63](e,0,0)|0,(f[i>>2]|0)==0):0)t=-1;else{f[e+16>>2]=0;f[r>>2]=0;f[i>>2]=0;if((kc[f[e+40>>2]&63](e,t,n)|0)<0)t=-1;else{f[e+8>>2]=0;f[e+4>>2]=0;f[e>>2]=f[e>>2]&-17;t=0}}return t|0}function al(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if((f[e+76>>2]|0)>-1){r=(zs(e)|0)==0;t=il(e,t,n)|0;if(!r)Vs(e)}else t=il(e,t,n)|0;return t|0}function ol(e,t,n){e=e|0;t=t|0;n=n|0;return al(e,t,n)|0}function sl(e){e=e|0;var t=0;if(!(f[e>>2]&128))t=1;else t=(f[e+20>>2]|0)>>>0>(f[e+28>>2]|0)>>>0?2:1;t=kc[f[e+40>>2]&63](e,0,t)|0;if((t|0)>=0)t=t-(f[e+8>>2]|0)+(f[e+4>>2]|0)+(f[e+20>>2]|0)-(f[e+28>>2]|0)|0;return t|0}function ll(e){e=e|0;var t=0;if((f[e+76>>2]|0)>-1){t=(zs(e)|0)==0;e=sl(e)|0}else e=sl(e)|0;return e|0}function cl(e){e=e|0;return ll(e)|0}function ul(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;r=n+16|0;i=f[r>>2]|0;if(!i)if(!(Zs(n)|0)){i=f[r>>2]|0;a=4}else r=0;else a=4;e:do{if((a|0)==4){o=n+20|0;a=f[o>>2]|0;if((i-a|0)>>>0<t>>>0){r=kc[f[n+36>>2]&63](n,e,t)|0;break}t:do{if((h[n+75>>0]|0)>-1){r=t;while(1){if(!r){i=a;r=0;break t}i=r+-1|0;if((h[e+i>>0]|0)==10)break;else r=i}if((kc[f[n+36>>2]&63](n,e,r)|0)>>>0<r>>>0)break e;t=t-r|0;e=e+r|0;i=f[o>>2]|0}else{i=a;r=0}}while(0);Xl(i|0,e|0,t|0)|0;f[o>>2]=(f[o>>2]|0)+t;r=r+t|0}}while(0);return r|0}function hl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;i=ue(n,t)|0;if((f[r+76>>2]|0)>-1){a=(zs(r)|0)==0;e=ul(e,i,r)|0;if(!a)Vs(r)}else e=ul(e,i,r)|0;if((e|0)!=(i|0))n=(e>>>0)/(t>>>0)|0;return n|0}function dl(e,t){e=e|0;t=t|0;var n=0,r=0;n=b;b=b+16|0;r=n;f[r>>2]=t;t=ml(f[676]|0,e,r)|0;b=n;return t|0}function fl(e){e=e|0;var t=0,n=0,r=0,i=0;r=f[676]|0;if((f[r+76>>2]|0)>-1)i=zs(r)|0;else i=0;do{if((nl(e,r)|0)<0)t=1;else{if((h[r+75>>0]|0)!=10?(t=r+20|0,n=f[t>>2]|0,n>>>0<(f[r+16>>2]|0)>>>0):0){f[t>>2]=n+1;h[n>>0]=10;t=0;break}t=(js(r,10)|0)<0}}while(0);if(i)Vs(r);return t<<31>>31|0}function pl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;r=b;b=b+16|0;i=r;f[i>>2]=n;n=vl(e,t,i)|0;b=r;return n|0}function ml(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+224|0;d=v+80|0;g=v+96|0;m=v;p=v+136|0;r=g;i=r+40|0;do{f[r>>2]=0;r=r+4|0}while((r|0)<(i|0));f[d>>2]=f[n>>2];if((Sl(0,t,d,m,g)|0)<0)n=-1;else{if((f[e+76>>2]|0)>-1)c=zs(e)|0;else c=0;n=f[e>>2]|0;u=n&32;if((h[e+74>>0]|0)<1)f[e>>2]=n&-33;n=e+48|0;if(!(f[n>>2]|0)){i=e+44|0;a=f[i>>2]|0;f[i>>2]=p;o=e+28|0;f[o>>2]=p;s=e+20|0;f[s>>2]=p;f[n>>2]=80;l=e+16|0;f[l>>2]=p+80;r=Sl(e,t,d,m,g)|0;if(a){kc[f[e+36>>2]&63](e,0,0)|0;r=(f[s>>2]|0)==0?-1:r;f[i>>2]=a;f[n>>2]=0;f[l>>2]=0;f[o>>2]=0;f[s>>2]=0}}else r=Sl(e,t,d,m,g)|0;n=f[e>>2]|0;f[e>>2]=n|u;if(c)Vs(e);n=(n&32|0)==0?r:-1}b=v;return n|0}function gl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0,u=0;u=b;b=b+128|0;i=u+112|0;c=u;a=c;o=2716;s=a+112|0;do{f[a>>2]=f[o>>2];a=a+4|0;o=o+4|0}while((a|0)<(s|0));if((t+-1|0)>>>0>2147483646)if(!t){t=1;l=4}else{t=Rs()|0;f[t>>2]=75;t=-1}else{i=e;l=4}if((l|0)==4){l=-2-i|0;l=t>>>0>l>>>0?l:t;f[c+48>>2]=l;e=c+20|0;f[e>>2]=i;f[c+44>>2]=i;t=i+l|0;i=c+16|0;f[i>>2]=t;f[c+28>>2]=t;t=ml(c,n,r)|0;if(l){n=f[e>>2]|0;h[n+(((n|0)==(f[i>>2]|0))<<31>>31)>>0]=0}}b=u;return t|0}function vl(e,t,n){e=e|0;t=t|0;n=n|0;return gl(e,2147483647,t,n)|0}function yl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;a=t&255;r=(n|0)!=0;e:do{if(r&(e&3|0)!=0){i=t&255;while(1){if((h[e>>0]|0)==i<<24>>24){o=6;break e}e=e+1|0;n=n+-1|0;r=(n|0)!=0;if(!(r&(e&3|0)!=0)){o=5;break}}}else o=5}while(0);if((o|0)==5)if(r)o=6;else n=0;e:do{if((o|0)==6){i=t&255;if((h[e>>0]|0)!=i<<24>>24){r=ue(a,16843009)|0;t:do{if(n>>>0>3)while(1){a=f[e>>2]^r;if((a&-2139062144^-2139062144)&a+-16843009)break;e=e+4|0;n=n+-4|0;if(n>>>0<=3){o=11;break t}}else o=11}while(0);if((o|0)==11)if(!n){n=0;break}while(1){if((h[e>>0]|0)==i<<24>>24)break e;e=e+1|0;n=n+-1|0;if(!n){n=0;break}}}}}while(0);return((n|0)!=0?e:0)|0}function _l(e,t){e=e|0;t=t|0;var n=0,r=0;n=t;e:do{if(!((n^e)&3)){if(n&3)do{n=h[t>>0]|0;h[e>>0]=n;if(!(n<<24>>24))break e;t=t+1|0;e=e+1|0}while((t&3|0)!=0);n=f[t>>2]|0;if(!((n&-2139062144^-2139062144)&n+-16843009)){r=e;while(1){t=t+4|0;e=r+4|0;f[r>>2]=n;n=f[t>>2]|0;if((n&-2139062144^-2139062144)&n+-16843009)break;else r=e}}r=8}else r=8}while(0);if((r|0)==8){r=h[t>>0]|0;h[e>>0]=r;if(r<<24>>24)do{t=t+1|0;e=e+1|0;r=h[t>>0]|0;h[e>>0]=r}while(r<<24>>24!=0)}return e|0}function bl(e,t){e=e|0;t=t|0;e=El(e,t)|0;return((h[e>>0]|0)==(t&255)<<24>>24?e:0)|0}function El(e,t){e=e|0;t=t|0;var n=0,r=0,i=0;r=t&255;e:do{if(!r)e=e+(xl(e)|0)|0;else{if(e&3){n=t&255;do{i=h[e>>0]|0;if(i<<24>>24==0?1:i<<24>>24==n<<24>>24)break e;e=e+1|0}while((e&3|0)!=0)}r=ue(r,16843009)|0;n=f[e>>2]|0;t:do{if(!((n&-2139062144^-2139062144)&n+-16843009))do{i=n^r;if((i&-2139062144^-2139062144)&i+-16843009)break t;e=e+4|0;n=f[e>>2]|0}while(((n&-2139062144^-2139062144)&n+-16843009|0)==0)}while(0);n=t&255;while(1){i=h[e>>0]|0;if(i<<24>>24==0?1:i<<24>>24==n<<24>>24)break;else e=e+1|0}}}while(0);return e|0}function wl(e,t){e=e|0;t=t|0;_l(e,t)|0;return e|0}function xl(e){e=e|0;var t=0,n=0,r=0;r=e;e:do{if(!(r&3))n=4;else{t=e;e=r;while(1){if(!(h[t>>0]|0))break e;t=t+1|0;e=t;if(!(e&3)){e=t;n=4;break}}}}while(0);if((n|0)==4){while(1){t=f[e>>2]|0;if(!((t&-2139062144^-2139062144)&t+-16843009))e=e+4|0;else break}if((t&255)<<24>>24)do{e=e+1|0}while((h[e>>0]|0)!=0)}return e-r|0}function Tl(e){e=e|0;if(!(f[e+68>>2]|0))Vs(e);return}function Al(e){e=e|0;if(!(f[e+68>>2]|0))Vs(e);return}function Ml(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0;t=e+20|0;a=e+28|0;if((f[t>>2]|0)>>>0>(f[a>>2]|0)>>>0?(kc[f[e+36>>2]&63](e,0,0)|0,(f[t>>2]|0)==0):0)t=-1;else{o=e+4|0;n=f[o>>2]|0;r=e+8|0;i=f[r>>2]|0;if(n>>>0<i>>>0)kc[f[e+40>>2]&63](e,n-i|0,1)|0;f[e+16>>2]=0;f[a>>2]=0;f[t>>2]=0;f[r>>2]=0;f[o>>2]=0;t=0}return t|0}function Sl(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0.0,u=0,m=0,g=0,v=0,_=0.0,E=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0,U=0,z=0,V=0,j=0,G=0,W=0,q=0,X=0,Y=0,K=0,Z=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0;oe=b;b=b+624|0;te=oe+24|0;re=oe+16|0;ne=oe+588|0;Z=oe+576|0;ee=oe;X=oe+536|0;ae=oe+8|0;ie=oe+528|0;H=(e|0)!=0;D=X+40|0;q=D;X=X+39|0;Y=ae+4|0;K=Z+12|0;Z=Z+11|0;Q=ne;J=K;$=J-Q|0;U=-2-Q|0;z=J+2|0;V=te+288|0;j=ne+9|0;G=j;W=ne+8|0;a=0;E=t;o=0;t=0;e:while(1){do{if((a|0)>-1)if((o|0)>(2147483647-a|0)){a=Rs()|0;f[a>>2]=75;a=-1;break}else{a=o+a|0;break}}while(0);o=h[E>>0]|0;if(!(o<<24>>24)){O=245;break}else s=E;t:while(1){switch(o<<24>>24){case 37:{o=s;O=9;break t}case 0:{o=s;break t}default:{}}F=s+1|0;o=h[F>>0]|0;s=F}t:do{if((O|0)==9)while(1){O=0;if((h[o+1>>0]|0)!=37)break t;s=s+1|0;o=o+2|0;if((h[o>>0]|0)==37)O=9;else break}}while(0);T=s-E|0;if(H?(f[e>>2]&32|0)==0:0)ul(E,T,e)|0;if((s|0)!=(E|0)){E=o;o=T;continue}u=o+1|0;s=h[u>>0]|0;l=(s<<24>>24)+-48|0;if(l>>>0<10){F=(h[o+2>>0]|0)==36;u=F?o+3|0:u;s=h[u>>0]|0;v=F?l:-1;t=F?1:t}else v=-1;o=s<<24>>24;t:do{if((o&-32|0)==32){l=0;while(1){if(!(1<<o+-32&75913)){m=l;o=u;break t}l=1<<(s<<24>>24)+-32|l;u=u+1|0;s=h[u>>0]|0;o=s<<24>>24;if((o&-32|0)!=32){m=l;o=u;break}}}else{m=0;o=u}}while(0);do{if(s<<24>>24==42){l=o+1|0;s=(h[l>>0]|0)+-48|0;if(s>>>0<10?(h[o+2>>0]|0)==36:0){f[i+(s<<2)>>2]=10;t=1;o=o+3|0;s=f[r+((h[l>>0]|0)+-48<<3)>>2]|0}else{if(t){a=-1;break e}if(!H){x=m;o=l;t=0;F=0;break}t=(f[n>>2]|0)+(4-1)&~(4-1);s=f[t>>2]|0;f[n>>2]=t+4;t=0;o=l}if((s|0)<0){x=m|8192;F=0-s|0}else{x=m;F=s}}else{l=(s<<24>>24)+-48|0;if(l>>>0<10){s=0;do{s=(s*10|0)+l|0;o=o+1|0;l=(h[o>>0]|0)+-48|0}while(l>>>0<10);if((s|0)<0){a=-1;break e}else{x=m;F=s}}else{x=m;F=0}}}while(0);t:do{if((h[o>>0]|0)==46){l=o+1|0;s=h[l>>0]|0;if(s<<24>>24!=42){u=(s<<24>>24)+-48|0;if(u>>>0<10){o=l;s=0}else{o=l;u=0;break}while(1){s=(s*10|0)+u|0;o=o+1|0;u=(h[o>>0]|0)+-48|0;if(u>>>0>=10){u=s;break t}}}l=o+2|0;s=(h[l>>0]|0)+-48|0;if(s>>>0<10?(h[o+3>>0]|0)==36:0){f[i+(s<<2)>>2]=10;o=o+4|0;u=f[r+((h[l>>0]|0)+-48<<3)>>2]|0;break}if(t){a=-1;break e}if(H){o=(f[n>>2]|0)+(4-1)&~(4-1);u=f[o>>2]|0;f[n>>2]=o+4;o=l}else{o=l;u=0}}else u=-1}while(0);g=0;while(1){s=(h[o>>0]|0)+-65|0;if(s>>>0>57){a=-1;break e}l=o+1|0;s=h[25126+(g*58|0)+s>>0]|0;m=s&255;if((m+-1|0)>>>0<8){o=l;g=m}else{N=l;break}}if(!(s<<24>>24)){a=-1;break}l=(v|0)>-1;do{if(s<<24>>24==19)if(l){a=-1;break e}else O=52;else{if(l){f[i+(v<<2)>>2]=m;C=r+(v<<3)|0;I=f[C+4>>2]|0;O=ee;f[O>>2]=f[C>>2];f[O+4>>2]=I;O=52;break}if(!H){a=0;break e}kl(ee,m,n)}}while(0);if((O|0)==52?(O=0,!H):0){E=N;o=T;continue}v=h[o>>0]|0;v=(g|0)!=0&(v&15|0)==3?v&-33:v;l=x&-65537;I=(x&8192|0)==0?x:l;t:do{switch(v|0){case 110:switch(g|0){case 0:{f[f[ee>>2]>>2]=a;E=N;o=T;continue e}case 1:{f[f[ee>>2]>>2]=a;E=N;o=T;continue e}case 2:{E=f[ee>>2]|0;f[E>>2]=a;f[E+4>>2]=((a|0)<0)<<31>>31;E=N;o=T;continue e}case 3:{d[f[ee>>2]>>1]=a;E=N;o=T;continue e}case 4:{h[f[ee>>2]>>0]=a;E=N;o=T;continue e}case 6:{f[f[ee>>2]>>2]=a;E=N;o=T;continue e}case 7:{E=f[ee>>2]|0;f[E>>2]=a;f[E+4>>2]=((a|0)<0)<<31>>31;E=N;o=T;continue e}default:{E=N;o=T;continue e}}case 112:{g=I|8;u=u>>>0>8?u:8;v=120;O=64;break}case 88:case 120:{g=I;O=64;break}case 111:{l=ee;s=f[l>>2]|0;l=f[l+4>>2]|0;if((s|0)==0&(l|0)==0)o=D;else{o=D;do{o=o+-1|0;h[o>>0]=s&7|48;s=ql(s|0,l|0,3)|0;l=B}while(!((s|0)==0&(l|0)==0))}if(!(I&8)){s=I;g=0;m=25606;O=77}else{g=q-o+1|0;s=I;u=(u|0)<(g|0)?g:u;g=0;m=25606;O=77}break}case 105:case 100:{s=ee;o=f[s>>2]|0;s=f[s+4>>2]|0;if((s|0)<0){o=zl(0,0,o|0,s|0)|0;s=B;l=ee;f[l>>2]=o;f[l+4>>2]=s;l=1;m=25606;O=76;break t}if(!(I&2048)){m=I&1;l=m;m=(m|0)==0?25606:25608;O=76}else{l=1;m=25607;O=76}break}case 117:{s=ee;o=f[s>>2]|0;s=f[s+4>>2]|0;l=0;m=25606;O=76;break}case 99:{h[X>>0]=f[ee>>2];E=X;s=1;g=0;v=25606;o=D;break}case 109:{o=Rs()|0;o=ks(f[o>>2]|0)|0;O=82;break}case 115:{o=f[ee>>2]|0;o=(o|0)!=0?o:25616;O=82;break}case 67:{f[ae>>2]=f[ee>>2];f[Y>>2]=0;f[ee>>2]=ae;u=-1;O=86;break}case 83:{if(!u){Ll(e,32,F,0,I);o=0;O=98}else O=86;break}case 65:case 71:case 70:case 69:case 97:case 103:case 102:case 101:{c=+y[ee>>3];f[re>>2]=0;y[w>>3]=c;if((f[w+4>>2]|0)>=0)if(!(I&2048)){C=I&1;L=C;C=(C|0)==0?25624:25629}else{L=1;C=25626}else{c=-c;L=1;C=25623}y[w>>3]=c;P=f[w+4>>2]&2146435072;do{if(P>>>0<2146435072|(P|0)==2146435072&0<0){_=+Cs(c,re)*2.0;s=_!=0.0;if(s)f[re>>2]=(f[re>>2]|0)+-1;R=v|32;if((R|0)==97){E=v&32;T=(E|0)==0?C:C+9|0;x=L|2;o=12-u|0;do{if(!(u>>>0>11|(o|0)==0)){c=8.0;do{o=o+-1|0;c=c*16.0}while((o|0)!=0);if((h[T>>0]|0)==45){c=-(c+(-_-c));break}else{c=_+c-c;break}}else c=_}while(0);s=f[re>>2]|0;o=(s|0)<0?0-s|0:s;o=Pl(o,((o|0)<0)<<31>>31,K)|0;if((o|0)==(K|0)){h[Z>>0]=48;o=Z}h[o+-1>>0]=(s>>31&2)+43;g=o+-2|0;h[g>>0]=v+15;m=(u|0)<1;l=(I&8|0)==0;s=ne;while(1){C=~~c;o=s+1|0;h[s>>0]=p[25590+C>>0]|E;c=(c-+(C|0))*16.0;do{if((o-Q|0)==1){if(l&(m&c==0.0))break;h[o>>0]=46;o=s+2|0}}while(0);if(!(c!=0.0))break;else s=o}u=(u|0)!=0&(U+o|0)<(u|0)?z+u-g|0:$-g+o|0;l=u+x|0;Ll(e,32,F,l,I);if(!(f[e>>2]&32))ul(T,x,e)|0;Ll(e,48,F,l,I^65536);o=o-Q|0;if(!(f[e>>2]&32))ul(ne,o,e)|0;s=J-g|0;Ll(e,48,u-(o+s)|0,0,0);if(!(f[e>>2]&32))ul(g,s,e)|0;Ll(e,32,F,l,I^8192);o=(l|0)<(F|0)?F:l;break}o=(u|0)<0?6:u;if(s){s=(f[re>>2]|0)+-28|0;f[re>>2]=s;c=_*268435456.0}else{c=_;s=f[re>>2]|0}P=(s|0)<0?te:V;k=P;s=P;do{S=~~c>>>0;f[s>>2]=S;s=s+4|0;c=(c-+(S>>>0))*1.0e9}while(c!=0.0);l=s;s=f[re>>2]|0;if((s|0)>0){m=P;while(1){g=(s|0)>29?29:s;u=l+-4|0;do{if(u>>>0<m>>>0)u=m;else{s=0;do{S=Gl(f[u>>2]|0,0,g|0)|0;S=Wl(S|0,B|0,s|0,0)|0;s=B;M=ec(S|0,s|0,1e9,0)|0;f[u>>2]=M;s=$l(S|0,s|0,1e9,0)|0;u=u+-4|0}while(u>>>0>=m>>>0);if(!s){u=m;break}u=m+-4|0;f[u>>2]=s}}while(0);while(1){if(l>>>0<=u>>>0)break;s=l+-4|0;if(!(f[s>>2]|0))l=s;else break}s=(f[re>>2]|0)-g|0;f[re>>2]=s;if((s|0)>0)m=u;else break}}else u=P;if((s|0)<0){T=((o+25|0)/9|0)+1|0;A=(R|0)==102;E=u;while(1){x=0-s|0;x=(x|0)>9?9:x;do{if(E>>>0<l>>>0){s=(1<<x)+-1|0;m=1e9>>>x;u=0;g=E;do{S=f[g>>2]|0;f[g>>2]=(S>>>x)+u;u=ue(S&s,m)|0;g=g+4|0}while(g>>>0<l>>>0);s=(f[E>>2]|0)==0?E+4|0:E;if(!u){u=s;break}f[l>>2]=u;u=s;l=l+4|0}else u=(f[E>>2]|0)==0?E+4|0:E}while(0);s=A?P:u;l=(l-s>>2|0)>(T|0)?s+(T<<2)|0:l;s=(f[re>>2]|0)+x|0;f[re>>2]=s;if((s|0)>=0){E=u;break}else E=u}}else E=u;do{if(E>>>0<l>>>0){s=(k-E>>2)*9|0;m=f[E>>2]|0;if(m>>>0<10)break;else u=10;do{u=u*10|0;s=s+1|0}while(m>>>0>=u>>>0)}else s=0}while(0);M=(R|0)==103;S=(o|0)!=0;u=o-((R|0)!=102?s:0)+((S&M)<<31>>31)|0;if((u|0)<(((l-k>>2)*9|0)+-9|0)){g=u+9216|0;A=(g|0)/9|0;u=P+(A+-1023<<2)|0;g=((g|0)%9|0)+1|0;if((g|0)<9){m=10;do{m=m*10|0;g=g+1|0}while((g|0)!=9)}else m=10;x=f[u>>2]|0;T=(x>>>0)%(m>>>0)|0;if((T|0)==0?(P+(A+-1022<<2)|0)==(l|0):0)m=E;else O=163;do{if((O|0)==163){O=0;_=(((x>>>0)/(m>>>0)|0)&1|0)==0?9007199254740992.0:9007199254740994.0;g=(m|0)/2|0;do{if(T>>>0<g>>>0)c=.5;else{if((T|0)==(g|0)?(P+(A+-1022<<2)|0)==(l|0):0){c=1.0;break}c=1.5}}while(0);do{if(L){if((h[C>>0]|0)!=45)break;_=-_;c=-c}}while(0);g=x-T|0;f[u>>2]=g;if(!(_+c!=_)){m=E;break}R=g+m|0;f[u>>2]=R;if(R>>>0>999999999){s=E;while(1){m=u+-4|0;f[u>>2]=0;if(m>>>0<s>>>0){s=s+-4|0;f[s>>2]=0}R=(f[m>>2]|0)+1|0;f[m>>2]=R;if(R>>>0>999999999)u=m;else{E=s;u=m;break}}}s=(k-E>>2)*9|0;g=f[E>>2]|0;if(g>>>0<10){m=E;break}else m=10;do{m=m*10|0;s=s+1|0}while(g>>>0>=m>>>0);m=E}}while(0);R=u+4|0;E=m;l=l>>>0>R>>>0?R:l}T=0-s|0;while(1){if(l>>>0<=E>>>0){A=0;R=l;break}u=l+-4|0;if(!(f[u>>2]|0))l=u;else{A=1;R=l;break}}do{if(M){o=(S&1^1)+o|0;if((o|0)>(s|0)&(s|0)>-5){v=v+-1|0;o=o+-1-s|0}else{v=v+-2|0;o=o+-1|0}l=I&8;if(l)break;do{if(A){l=f[R+-4>>2]|0;if(!l){u=9;break}if(!((l>>>0)%10|0)){m=10;u=0}else{u=0;break}do{m=m*10|0;u=u+1|0}while(((l>>>0)%(m>>>0)|0|0)==0)}else u=9}while(0);l=((R-k>>2)*9|0)+-9|0;if((v|32|0)==102){l=l-u|0;l=(l|0)<0?0:l;o=(o|0)<(l|0)?o:l;l=0;break}else{l=l+s-u|0;l=(l|0)<0?0:l;o=(o|0)<(l|0)?o:l;l=0;break}}else l=I&8}while(0);x=o|l;m=(x|0)!=0&1;g=(v|32|0)==102;if(g){s=(s|0)>0?s:0;v=0}else{u=(s|0)<0?T:s;u=Pl(u,((u|0)<0)<<31>>31,K)|0;if((J-u|0)<2)do{u=u+-1|0;h[u>>0]=48}while((J-u|0)<2);h[u+-1>>0]=(s>>31&2)+43;k=u+-2|0;h[k>>0]=v;s=J-k|0;v=k}T=L+1+o+m+s|0;Ll(e,32,F,T,I);if(!(f[e>>2]&32))ul(C,L,e)|0;Ll(e,48,F,T,I^65536);do{if(g){u=E>>>0>P>>>0?P:E;s=u;do{l=Pl(f[s>>2]|0,0,j)|0;do{if((s|0)==(u|0)){if((l|0)!=(j|0))break;h[W>>0]=48;l=W}else{if(l>>>0<=ne>>>0)break;do{l=l+-1|0;h[l>>0]=48}while(l>>>0>ne>>>0)}}while(0);if(!(f[e>>2]&32))ul(l,G-l|0,e)|0;s=s+4|0}while(s>>>0<=P>>>0);do{if(x){if(f[e>>2]&32)break;ul(25658,1,e)|0}}while(0);if((o|0)>0&s>>>0<R>>>0){l=s;while(1){s=Pl(f[l>>2]|0,0,j)|0;if(s>>>0>ne>>>0)do{s=s+-1|0;h[s>>0]=48}while(s>>>0>ne>>>0);if(!(f[e>>2]&32))ul(s,(o|0)>9?9:o,e)|0;l=l+4|0;s=o+-9|0;if(!((o|0)>9&l>>>0<R>>>0)){o=s;break}else o=s}}Ll(e,48,o+9|0,9,0)}else{g=A?R:E+4|0;if((o|0)>-1){m=(l|0)==0;u=E;do{s=Pl(f[u>>2]|0,0,j)|0;if((s|0)==(j|0)){h[W>>0]=48;s=W}do{if((u|0)==(E|0)){l=s+1|0;if(!(f[e>>2]&32))ul(s,1,e)|0;if(m&(o|0)<1){s=l;break}if(f[e>>2]&32){s=l;break}ul(25658,1,e)|0;s=l}else{if(s>>>0<=ne>>>0)break;do{s=s+-1|0;h[s>>0]=48}while(s>>>0>ne>>>0)}}while(0);l=G-s|0;if(!(f[e>>2]&32))ul(s,(o|0)>(l|0)?l:o,e)|0;o=o-l|0;u=u+4|0}while(u>>>0<g>>>0&(o|0)>-1)}Ll(e,48,o+18|0,18,0);if(f[e>>2]&32)break;ul(v,J-v|0,e)|0}}while(0);Ll(e,32,F,T,I^8192);o=(T|0)<(F|0)?F:T}else{g=(v&32|0)!=0;m=c!=c|0.0!=0.0;s=m?0:L;u=s+3|0;Ll(e,32,F,u,l);o=f[e>>2]|0;if(!(o&32)){ul(C,s,e)|0;o=f[e>>2]|0}if(!(o&32))ul(m?g?25650:25654:g?25642:25646,3,e)|0;Ll(e,32,F,u,I^8192);o=(u|0)<(F|0)?F:u}}while(0);E=N;continue e}default:{l=I;s=u;g=0;v=25606;o=D}}}while(0);t:do{if((O|0)==64){l=ee;s=f[l>>2]|0;l=f[l+4>>2]|0;m=v&32;if(!((s|0)==0&(l|0)==0)){o=D;do{o=o+-1|0;h[o>>0]=p[25590+(s&15)>>0]|m;s=ql(s|0,l|0,4)|0;l=B}while(!((s|0)==0&(l|0)==0));O=ee;if((g&8|0)==0|(f[O>>2]|0)==0&(f[O+4>>2]|0)==0){s=g;g=0;m=25606;O=77}else{s=g;g=2;m=25606+(v>>4)|0;O=77}}else{o=D;s=g;g=0;m=25606;O=77}}else if((O|0)==76){o=Pl(o,s,D)|0;s=I;g=l;O=77}else if((O|0)==82){O=0;I=yl(o,0,u)|0;C=(I|0)==0;E=o;s=C?u:I-o|0;g=0;v=25606;o=C?o+u|0:I}else if((O|0)==86){O=0;s=0;o=0;m=f[ee>>2]|0;while(1){l=f[m>>2]|0;if(!l)break;o=Ds(ie,l)|0;if((o|0)<0|o>>>0>(u-s|0)>>>0)break;s=o+s|0;if(u>>>0>s>>>0)m=m+4|0;else break}if((o|0)<0){a=-1;break e}Ll(e,32,F,s,I);if(!s){o=0;O=98}else{l=0;u=f[ee>>2]|0;while(1){o=f[u>>2]|0;if(!o){o=s;O=98;break t}o=Ds(ie,o)|0;l=o+l|0;if((l|0)>(s|0)){o=s;O=98;break t}if(!(f[e>>2]&32))ul(ie,o,e)|0;if(l>>>0>=s>>>0){o=s;O=98;break}else u=u+4|0}}}}while(0);if((O|0)==98){O=0;Ll(e,32,F,o,I^8192);E=N;o=(F|0)>(o|0)?F:o;continue}if((O|0)==77){O=0;l=(u|0)>-1?s&-65537:s;s=ee;s=(f[s>>2]|0)!=0|(f[s+4>>2]|0)!=0;if((u|0)!=0|s){s=(s&1^1)+(q-o)|0;E=o;s=(u|0)>(s|0)?u:s;v=m;o=D}else{E=D;s=0;v=m;o=D}}m=o-E|0;s=(s|0)<(m|0)?m:s;u=g+s|0;o=(F|0)<(u|0)?u:F;Ll(e,32,o,u,l);if(!(f[e>>2]&32))ul(v,g,e)|0;Ll(e,48,o,u,l^65536);Ll(e,48,s,m,0);if(!(f[e>>2]&32))ul(E,m,e)|0;Ll(e,32,o,u,l^8192);E=N}e:do{if((O|0)==245)if(!e)if(t){a=1;while(1){t=f[i+(a<<2)>>2]|0;if(!t)break;kl(r+(a<<3)|0,t,n);a=a+1|0;if((a|0)>=10){a=1;break e}}if((a|0)<10)while(1){if(f[i+(a<<2)>>2]|0){a=-1;break e}a=a+1|0;if((a|0)>=10){a=1;break}}else a=1}else a=0}while(0);b=oe;return a|0}function Rl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;r=e+20|0;i=f[r>>2]|0;e=(f[e+16>>2]|0)-i|0;e=e>>>0>n>>>0?n:e;Xl(i|0,t|0,e|0)|0;f[r>>2]=(f[r>>2]|0)+e;return n|0}function kl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0.0;e:do{if(t>>>0<=20)do{switch(t|0){case 9:{r=(f[n>>2]|0)+(4-1)&~(4-1);t=f[r>>2]|0;f[n>>2]=r+4;f[e>>2]=t;break e}case 10:{r=(f[n>>2]|0)+(4-1)&~(4-1);t=f[r>>2]|0;f[n>>2]=r+4;r=e;f[r>>2]=t;f[r+4>>2]=((t|0)<0)<<31>>31;break e}case 11:{r=(f[n>>2]|0)+(4-1)&~(4-1);t=f[r>>2]|0;f[n>>2]=r+4;r=e;f[r>>2]=t;f[r+4>>2]=0;break e}case 12:{r=(f[n>>2]|0)+(8-1)&~(8-1);t=r;i=f[t>>2]|0;t=f[t+4>>2]|0;f[n>>2]=r+8;r=e;f[r>>2]=i;f[r+4>>2]=t;break e}case 13:{i=(f[n>>2]|0)+(4-1)&~(4-1);r=f[i>>2]|0;f[n>>2]=i+4;r=(r&65535)<<16>>16;i=e;f[i>>2]=r;f[i+4>>2]=((r|0)<0)<<31>>31;break e}case 14:{i=(f[n>>2]|0)+(4-1)&~(4-1);r=f[i>>2]|0;f[n>>2]=i+4;i=e;f[i>>2]=r&65535;f[i+4>>2]=0;break e}case 15:{i=(f[n>>2]|0)+(4-1)&~(4-1);r=f[i>>2]|0;f[n>>2]=i+4;r=(r&255)<<24>>24;i=e;f[i>>2]=r;f[i+4>>2]=((r|0)<0)<<31>>31;break e}case 16:{i=(f[n>>2]|0)+(4-1)&~(4-1);r=f[i>>2]|0;f[n>>2]=i+4;i=e;f[i>>2]=r&255;f[i+4>>2]=0;break e}case 17:{i=(f[n>>2]|0)+(8-1)&~(8-1);a=+y[i>>3];f[n>>2]=i+8;y[e>>3]=a;break e}case 18:{i=(f[n>>2]|0)+(8-1)&~(8-1);a=+y[i>>3];f[n>>2]=i+8;y[e>>3]=a;break e}default:break e}}while(0)}while(0);return}function Pl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if(t>>>0>0|(t|0)==0&e>>>0>4294967295)while(1){r=ec(e|0,t|0,10,0)|0;n=n+-1|0;h[n>>0]=r|48;r=$l(e|0,t|0,10,0)|0;if(t>>>0>9|(t|0)==9&e>>>0>4294967295){e=r;t=B}else{e=r;break}}if(e)while(1){n=n+-1|0;h[n>>0]=(e>>>0)%10|0|48;if(e>>>0<10)break;else e=(e>>>0)/10|0}return n|0}function Ll(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+256|0;o=s;do{if((n|0)>(r|0)&(i&73728|0)==0){i=n-r|0;jl(o|0,t|0,(i>>>0>256?256:i)|0)|0;t=f[e>>2]|0;a=(t&32|0)==0;if(i>>>0>255){r=n-r|0;do{if(a){ul(o,256,e)|0;t=f[e>>2]|0}i=i+-256|0;a=(t&32|0)==0}while(i>>>0>255);if(a)i=r&255;else break}else if(!a)break;ul(o,i,e)|0}}while(0);b=s;return}function Cl(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=0,F=0,O=0,H=0,D=0;do{if(e>>>0<245){p=e>>>0<11?16:e+11&-8;e=p>>>3;s=f[735]|0;n=s>>>e;if(n&3){e=(n&1^1)+e|0;r=e<<1;n=2980+(r<<2)|0;r=2980+(r+2<<2)|0;i=f[r>>2]|0;a=i+8|0;o=f[a>>2]|0;do{if((n|0)!=(o|0)){if(o>>>0<(f[739]|0)>>>0)Le();t=o+12|0;if((f[t>>2]|0)==(i|0)){f[t>>2]=n;f[r>>2]=o;break}else Le()}else f[735]=s&~(1<<e)}while(0);D=e<<3;f[i+4>>2]=D|3;D=i+(D|4)|0;f[D>>2]=f[D>>2]|1;D=a;return D|0}o=f[737]|0;if(p>>>0>o>>>0){if(n){r=2<<e;r=n<<e&(r|0-r);r=(r&0-r)+-1|0;l=r>>>12&16;r=r>>>l;i=r>>>5&8;r=r>>>i;a=r>>>2&4;r=r>>>a;n=r>>>1&2;r=r>>>n;e=r>>>1&1;e=(i|l|a|n|e)+(r>>>e)|0;r=e<<1;n=2980+(r<<2)|0;r=2980+(r+2<<2)|0;a=f[r>>2]|0;l=a+8|0;i=f[l>>2]|0;do{if((n|0)!=(i|0)){if(i>>>0<(f[739]|0)>>>0)Le();t=i+12|0;if((f[t>>2]|0)==(a|0)){f[t>>2]=n;f[r>>2]=i;c=f[737]|0;break}else Le()}else{f[735]=s&~(1<<e);c=o}}while(0);D=e<<3;o=D-p|0;f[a+4>>2]=p|3;s=a+p|0;f[a+(p|4)>>2]=o|1;f[a+D>>2]=o;if(c){i=f[740]|0;n=c>>>3;t=n<<1;r=2980+(t<<2)|0;e=f[735]|0;n=1<<n;if(e&n){e=2980+(t+2<<2)|0;t=f[e>>2]|0;if(t>>>0<(f[739]|0)>>>0)Le();else{u=e;h=t}}else{f[735]=e|n;u=2980+(t+2<<2)|0;h=r}f[u>>2]=i;f[h+12>>2]=i;f[i+8>>2]=h;f[i+12>>2]=r}f[737]=o;f[740]=s;D=l;return D|0}e=f[736]|0;if(e){n=(e&0-e)+-1|0;H=n>>>12&16;n=n>>>H;O=n>>>5&8;n=n>>>O;D=n>>>2&4;n=n>>>D;e=n>>>1&2;n=n>>>e;r=n>>>1&1;r=f[3244+((O|H|D|e|r)+(n>>>r)<<2)>>2]|0;n=(f[r+4>>2]&-8)-p|0;e=r;while(1){t=f[e+16>>2]|0;if(!t){t=f[e+20>>2]|0;if(!t){l=n;break}}e=(f[t+4>>2]&-8)-p|0;D=e>>>0<n>>>0;n=D?e:n;e=t;r=D?t:r}a=f[739]|0;if(r>>>0<a>>>0)Le();s=r+p|0;if(r>>>0>=s>>>0)Le();o=f[r+24>>2]|0;n=f[r+12>>2]|0;do{if((n|0)==(r|0)){e=r+20|0;t=f[e>>2]|0;if(!t){e=r+16|0;t=f[e>>2]|0;if(!t){d=0;break}}while(1){n=t+20|0;i=f[n>>2]|0;if(i){t=i;e=n;continue}n=t+16|0;i=f[n>>2]|0;if(!i)break;else{t=i;e=n}}if(e>>>0<a>>>0)Le();else{f[e>>2]=0;d=t;break}}else{i=f[r+8>>2]|0;if(i>>>0<a>>>0)Le();t=i+12|0;if((f[t>>2]|0)!=(r|0))Le();e=n+8|0;if((f[e>>2]|0)==(r|0)){f[t>>2]=n;f[e>>2]=i;d=n;break}else Le()}}while(0);do{if(o){t=f[r+28>>2]|0;e=3244+(t<<2)|0;if((r|0)==(f[e>>2]|0)){f[e>>2]=d;if(!d){f[736]=f[736]&~(1<<t);break}}else{if(o>>>0<(f[739]|0)>>>0)Le();t=o+16|0;if((f[t>>2]|0)==(r|0))f[t>>2]=d;else f[o+20>>2]=d;if(!d)break}e=f[739]|0;if(d>>>0<e>>>0)Le();f[d+24>>2]=o;t=f[r+16>>2]|0;do{if(t)if(t>>>0<e>>>0)Le();else{f[d+16>>2]=t;f[t+24>>2]=d;break}}while(0);t=f[r+20>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[d+20>>2]=t;f[t+24>>2]=d;break}}}while(0);if(l>>>0<16){D=l+p|0;f[r+4>>2]=D|3;D=r+(D+4)|0;f[D>>2]=f[D>>2]|1}else{f[r+4>>2]=p|3;f[r+(p|4)>>2]=l|1;f[r+(l+p)>>2]=l;t=f[737]|0;if(t){a=f[740]|0;n=t>>>3;t=n<<1;i=2980+(t<<2)|0;e=f[735]|0;n=1<<n;if(e&n){t=2980+(t+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Le();else{m=t;g=e}}else{f[735]=e|n;m=2980+(t+2<<2)|0;g=i}f[m>>2]=a;f[g+12>>2]=a;f[a+8>>2]=g;f[a+12>>2]=i}f[737]=l;f[740]=s}D=r+8|0;return D|0}else g=p}else g=p}else if(e>>>0<=4294967231){e=e+11|0;h=e&-8;u=f[736]|0;if(u){n=0-h|0;e=e>>>8;if(e)if(h>>>0>16777215)c=31;else{g=(e+1048320|0)>>>16&8;E=e<<g;m=(E+520192|0)>>>16&4;E=E<<m;c=(E+245760|0)>>>16&2;c=14-(m|g|c)+(E<<c>>>15)|0;c=h>>>(c+7|0)&1|c<<1}else c=0;e=f[3244+(c<<2)>>2]|0;e:do{if(!e){i=0;e=0;E=86}else{o=n;i=0;s=h<<((c|0)==31?0:25-(c>>>1)|0);l=e;e=0;while(1){a=f[l+4>>2]&-8;n=a-h|0;if(n>>>0<o>>>0)if((a|0)==(h|0)){a=l;e=l;E=90;break e}else e=l;else n=o;E=f[l+20>>2]|0;l=f[l+16+(s>>>31<<2)>>2]|0;i=(E|0)==0|(E|0)==(l|0)?i:E;if(!l){E=86;break}else{o=n;s=s<<1}}}}while(0);if((E|0)==86){if((i|0)==0&(e|0)==0){e=2<<c;e=u&(e|0-e);if(!e){g=h;break}e=(e&0-e)+-1|0;d=e>>>12&16;e=e>>>d;u=e>>>5&8;e=e>>>u;m=e>>>2&4;e=e>>>m;g=e>>>1&2;e=e>>>g;i=e>>>1&1;i=f[3244+((u|d|m|g|i)+(e>>>i)<<2)>>2]|0;e=0}if(!i){s=n;l=e}else{a=i;E=90}}if((E|0)==90)while(1){E=0;g=(f[a+4>>2]&-8)-h|0;i=g>>>0<n>>>0;n=i?g:n;e=i?a:e;i=f[a+16>>2]|0;if(i){a=i;E=90;continue}a=f[a+20>>2]|0;if(!a){s=n;l=e;break}else E=90}if((l|0)!=0?s>>>0<((f[737]|0)-h|0)>>>0:0){i=f[739]|0;if(l>>>0<i>>>0)Le();o=l+h|0;if(l>>>0>=o>>>0)Le();a=f[l+24>>2]|0;n=f[l+12>>2]|0;do{if((n|0)==(l|0)){e=l+20|0;t=f[e>>2]|0;if(!t){e=l+16|0;t=f[e>>2]|0;if(!t){p=0;break}}while(1){n=t+20|0;r=f[n>>2]|0;if(r){t=r;e=n;continue}n=t+16|0;r=f[n>>2]|0;if(!r)break;else{t=r;e=n}}if(e>>>0<i>>>0)Le();else{f[e>>2]=0;p=t;break}}else{r=f[l+8>>2]|0;if(r>>>0<i>>>0)Le();t=r+12|0;if((f[t>>2]|0)!=(l|0))Le();e=n+8|0;if((f[e>>2]|0)==(l|0)){f[t>>2]=n;f[e>>2]=r;p=n;break}else Le()}}while(0);do{if(a){t=f[l+28>>2]|0;e=3244+(t<<2)|0;if((l|0)==(f[e>>2]|0)){f[e>>2]=p;if(!p){f[736]=f[736]&~(1<<t);break}}else{if(a>>>0<(f[739]|0)>>>0)Le();t=a+16|0;if((f[t>>2]|0)==(l|0))f[t>>2]=p;else f[a+20>>2]=p;if(!p)break}e=f[739]|0;if(p>>>0<e>>>0)Le();f[p+24>>2]=a;t=f[l+16>>2]|0;do{if(t)if(t>>>0<e>>>0)Le();else{f[p+16>>2]=t;f[t+24>>2]=p;break}}while(0);t=f[l+20>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[p+20>>2]=t;f[t+24>>2]=p;break}}}while(0);e:do{if(s>>>0>=16){f[l+4>>2]=h|3;f[l+(h|4)>>2]=s|1;f[l+(s+h)>>2]=s;t=s>>>3;if(s>>>0<256){e=t<<1;r=2980+(e<<2)|0;n=f[735]|0;t=1<<t;if(n&t){t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Le();else{y=t;_=e}}else{f[735]=n|t;y=2980+(e+2<<2)|0;_=r}f[y>>2]=o;f[_+12>>2]=o;f[l+(h+8)>>2]=_;f[l+(h+12)>>2]=r;break}t=s>>>8;if(t)if(s>>>0>16777215)r=31;else{H=(t+1048320|0)>>>16&8;D=t<<H;O=(D+520192|0)>>>16&4;D=D<<O;r=(D+245760|0)>>>16&2;r=14-(O|H|r)+(D<<r>>>15)|0;r=s>>>(r+7|0)&1|r<<1}else r=0;t=3244+(r<<2)|0;f[l+(h+28)>>2]=r;f[l+(h+20)>>2]=0;f[l+(h+16)>>2]=0;e=f[736]|0;n=1<<r;if(!(e&n)){f[736]=e|n;f[t>>2]=o;f[l+(h+24)>>2]=t;f[l+(h+12)>>2]=o;f[l+(h+8)>>2]=o;break}t=f[t>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(s|0)){r=s<<((r|0)==31?0:25-(r>>>1)|0);while(1){e=t+16+(r>>>31<<2)|0;n=f[e>>2]|0;if(!n)break;if((f[n+4>>2]&-8|0)==(s|0)){T=n;break t}else{r=r<<1;t=n}}if(e>>>0<(f[739]|0)>>>0)Le();else{f[e>>2]=o;f[l+(h+24)>>2]=t;f[l+(h+12)>>2]=o;f[l+(h+8)>>2]=o;break e}}else T=t}while(0);t=T+8|0;e=f[t>>2]|0;D=f[739]|0;if(e>>>0>=D>>>0&T>>>0>=D>>>0){f[e+12>>2]=o;f[t>>2]=o;f[l+(h+8)>>2]=e;f[l+(h+12)>>2]=T;f[l+(h+24)>>2]=0;break}else Le()}else{D=s+h|0;f[l+4>>2]=D|3;D=l+(D+4)|0;f[D>>2]=f[D>>2]|1}}while(0);D=l+8|0;return D|0}else g=h}else g=h}else g=-1}while(0);n=f[737]|0;if(n>>>0>=g>>>0){t=n-g|0;e=f[740]|0;if(t>>>0>15){f[740]=e+g;f[737]=t;f[e+(g+4)>>2]=t|1;f[e+n>>2]=t;f[e+4>>2]=g|3}else{f[737]=0;f[740]=0;f[e+4>>2]=n|3;D=e+(n+4)|0;f[D>>2]=f[D>>2]|1}D=e+8|0;return D|0}e=f[738]|0;if(e>>>0>g>>>0){H=e-g|0;f[738]=H;D=f[741]|0;f[741]=D+g;f[D+(g+4)>>2]=H|1;f[D+4>>2]=g|3;D=D+8|0;return D|0}do{if(!(f[853]|0)){e=He(30)|0;if(!(e+-1&e)){f[855]=e;f[854]=e;f[856]=-1;f[857]=-1;f[858]=0;f[846]=0;T=(Ke(0)|0)&-16^1431655768;f[853]=T;break}else Le()}}while(0);l=g+48|0;s=f[855]|0;c=g+47|0;o=s+c|0;s=0-s|0;u=o&s;if(u>>>0<=g>>>0){D=0;return D|0}e=f[845]|0;if((e|0)!=0?(_=f[843]|0,T=_+u|0,T>>>0<=_>>>0|T>>>0>e>>>0):0){D=0;return D|0}e:do{if(!(f[846]&4)){e=f[741]|0;t:do{if(e){i=3388;while(1){n=f[i>>2]|0;if(n>>>0<=e>>>0?(v=i+4|0,(n+(f[v>>2]|0)|0)>>>0>e>>>0):0){a=i;e=v;break}i=f[i+8>>2]|0;if(!i){E=174;break t}}n=o-(f[738]|0)&s;if(n>>>0<2147483647){i=Fe(n|0)|0;T=(i|0)==((f[a>>2]|0)+(f[e>>2]|0)|0);e=T?n:0;if(T){if((i|0)!=(-1|0)){w=i;m=e;E=194;break e}}else E=184}else e=0}else E=174}while(0);do{if((E|0)==174){a=Fe(0)|0;if((a|0)!=(-1|0)){e=a;n=f[854]|0;i=n+-1|0;if(!(i&e))n=u;else n=u-e+(i+e&0-n)|0;e=f[843]|0;i=e+n|0;if(n>>>0>g>>>0&n>>>0<2147483647){T=f[845]|0;if((T|0)!=0?i>>>0<=e>>>0|i>>>0>T>>>0:0){e=0;break}i=Fe(n|0)|0;T=(i|0)==(a|0);e=T?n:0;if(T){w=a;m=e;E=194;break e}else E=184}else e=0}else e=0}}while(0);t:do{if((E|0)==184){a=0-n|0;do{if(l>>>0>n>>>0&(n>>>0<2147483647&(i|0)!=(-1|0))?(b=f[855]|0,b=c-n+b&0-b,b>>>0<2147483647):0)if((Fe(b|0)|0)==(-1|0)){Fe(a|0)|0;break t}else{n=b+n|0;break}}while(0);if((i|0)!=(-1|0)){w=i;m=n;E=194;break e}}}while(0);f[846]=f[846]|4;E=191}else{e=0;E=191}}while(0);if((((E|0)==191?u>>>0<2147483647:0)?(w=Fe(u|0)|0,x=Fe(0)|0,w>>>0<x>>>0&((w|0)!=(-1|0)&(x|0)!=(-1|0))):0)?(A=x-w|0,M=A>>>0>(g+40|0)>>>0,M):0){m=M?A:e;E=194}if((E|0)==194){e=(f[843]|0)+m|0;f[843]=e;if(e>>>0>(f[844]|0)>>>0)f[844]=e;o=f[741]|0;e:do{if(o){a=3388;do{e=f[a>>2]|0;n=a+4|0;i=f[n>>2]|0;if((w|0)==(e+i|0)){S=e;R=n;k=i;P=a;E=204;break}a=f[a+8>>2]|0}while((a|0)!=0);if(((E|0)==204?(f[P+12>>2]&8|0)==0:0)?o>>>0<w>>>0&o>>>0>=S>>>0:0){f[R>>2]=k+m;D=(f[738]|0)+m|0;H=o+8|0;H=(H&7|0)==0?0:0-H&7;O=D-H|0;f[741]=o+H;f[738]=O;f[o+(H+4)>>2]=O|1;f[o+(D+4)>>2]=40;f[742]=f[857];break}e=f[739]|0;if(w>>>0<e>>>0){f[739]=w;e=w}n=w+m|0;a=3388;while(1){if((f[a>>2]|0)==(n|0)){i=a;n=a;E=212;break}a=f[a+8>>2]|0;if(!a){n=3388;break}}if((E|0)==212)if(!(f[n+12>>2]&8)){f[i>>2]=w;d=n+4|0;f[d>>2]=(f[d>>2]|0)+m;d=w+8|0;d=(d&7|0)==0?0:0-d&7;c=w+(m+8)|0;c=(c&7|0)==0?0:0-c&7;t=w+(c+m)|0;h=d+g|0;p=w+h|0;u=t-(w+d)-g|0;f[w+(d+4)>>2]=g|3;t:do{if((t|0)!=(o|0)){if((t|0)==(f[740]|0)){D=(f[737]|0)+u|0;f[737]=D;f[740]=p;f[w+(h+4)>>2]=D|1;f[w+(D+h)>>2]=D;break}s=m+4|0;n=f[w+(s+c)>>2]|0;if((n&3|0)==1){l=n&-8;a=n>>>3;n:do{if(n>>>0>=256){o=f[w+((c|24)+m)>>2]|0;r=f[w+(m+12+c)>>2]|0;do{if((r|0)==(t|0)){i=c|16;r=w+(s+i)|0;n=f[r>>2]|0;if(!n){r=w+(i+m)|0;n=f[r>>2]|0;if(!n){F=0;break}}while(1){i=n+20|0;a=f[i>>2]|0;if(a){n=a;r=i;continue}i=n+16|0;a=f[i>>2]|0;if(!a)break;else{n=a;r=i}}if(r>>>0<e>>>0)Le();else{f[r>>2]=0;F=n;break}}else{i=f[w+((c|8)+m)>>2]|0;if(i>>>0<e>>>0)Le();e=i+12|0;if((f[e>>2]|0)!=(t|0))Le();n=r+8|0;if((f[n>>2]|0)==(t|0)){f[e>>2]=r;f[n>>2]=i;F=r;break}else Le()}}while(0);if(!o)break;e=f[w+(m+28+c)>>2]|0;n=3244+(e<<2)|0;do{if((t|0)!=(f[n>>2]|0)){if(o>>>0<(f[739]|0)>>>0)Le();e=o+16|0;if((f[e>>2]|0)==(t|0))f[e>>2]=F;else f[o+20>>2]=F;if(!F)break n}else{f[n>>2]=F;if(F)break;f[736]=f[736]&~(1<<e);break n}}while(0);n=f[739]|0;if(F>>>0<n>>>0)Le();f[F+24>>2]=o;t=c|16;e=f[w+(t+m)>>2]|0;do{if(e)if(e>>>0<n>>>0)Le();else{f[F+16>>2]=e;f[e+24>>2]=F;break}}while(0);t=f[w+(s+t)>>2]|0;if(!t)break;if(t>>>0<(f[739]|0)>>>0)Le();else{f[F+20>>2]=t;f[t+24>>2]=F;break}}else{r=f[w+((c|8)+m)>>2]|0;i=f[w+(m+12+c)>>2]|0;n=2980+(a<<1<<2)|0;do{if((r|0)!=(n|0)){if(r>>>0<e>>>0)Le();if((f[r+12>>2]|0)==(t|0))break;Le()}}while(0);if((i|0)==(r|0)){f[735]=f[735]&~(1<<a);break}do{if((i|0)==(n|0))L=i+8|0;else{if(i>>>0<e>>>0)Le();e=i+8|0;if((f[e>>2]|0)==(t|0)){L=e;break}Le()}}while(0);f[r+12>>2]=i;f[L>>2]=r}}while(0);t=w+((l|c)+m)|0;i=l+u|0}else i=u;t=t+4|0;f[t>>2]=f[t>>2]&-2;f[w+(h+4)>>2]=i|1;f[w+(i+h)>>2]=i;t=i>>>3;if(i>>>0<256){e=t<<1;r=2980+(e<<2)|0;n=f[735]|0;t=1<<t;do{if(!(n&t)){f[735]=n|t;O=2980+(e+2<<2)|0;H=r}else{t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0>=(f[739]|0)>>>0){O=t;H=e;break}Le()}}while(0);f[O>>2]=p;f[H+12>>2]=p;f[w+(h+8)>>2]=H;f[w+(h+12)>>2]=r;break}t=i>>>8;do{if(!t)r=0;else{if(i>>>0>16777215){r=31;break}O=(t+1048320|0)>>>16&8;H=t<<O;F=(H+520192|0)>>>16&4;H=H<<F;r=(H+245760|0)>>>16&2;r=14-(F|O|r)+(H<<r>>>15)|0;r=i>>>(r+7|0)&1|r<<1}}while(0);t=3244+(r<<2)|0;f[w+(h+28)>>2]=r;f[w+(h+20)>>2]=0;f[w+(h+16)>>2]=0;e=f[736]|0;n=1<<r;if(!(e&n)){f[736]=e|n;f[t>>2]=p;f[w+(h+24)>>2]=t;f[w+(h+12)>>2]=p;f[w+(h+8)>>2]=p;break}t=f[t>>2]|0;n:do{if((f[t+4>>2]&-8|0)!=(i|0)){r=i<<((r|0)==31?0:25-(r>>>1)|0);while(1){e=t+16+(r>>>31<<2)|0;n=f[e>>2]|0;if(!n)break;if((f[n+4>>2]&-8|0)==(i|0)){D=n;break n}else{r=r<<1;t=n}}if(e>>>0<(f[739]|0)>>>0)Le();else{f[e>>2]=p;f[w+(h+24)>>2]=t;f[w+(h+12)>>2]=p;f[w+(h+8)>>2]=p;break t}}else D=t}while(0);t=D+8|0;e=f[t>>2]|0;H=f[739]|0;if(e>>>0>=H>>>0&D>>>0>=H>>>0){f[e+12>>2]=p;f[t>>2]=p;f[w+(h+8)>>2]=e;f[w+(h+12)>>2]=D;f[w+(h+24)>>2]=0;break}else Le()}else{D=(f[738]|0)+u|0;f[738]=D;f[741]=p;f[w+(h+4)>>2]=D|1}}while(0);D=w+(d|8)|0;return D|0}else n=3388;while(1){e=f[n>>2]|0;if(e>>>0<=o>>>0?(t=f[n+4>>2]|0,r=e+t|0,r>>>0>o>>>0):0)break;n=f[n+8>>2]|0}i=e+(t+-39)|0;e=e+(t+-47+((i&7|0)==0?0:0-i&7))|0;i=o+16|0;e=e>>>0<i>>>0?o:e;t=e+8|0;n=w+8|0;n=(n&7|0)==0?0:0-n&7;D=m+-40-n|0;f[741]=w+n;f[738]=D;f[w+(n+4)>>2]=D|1;f[w+(m+-36)>>2]=40;f[742]=f[857];n=e+4|0;f[n>>2]=27;f[t>>2]=f[847];f[t+4>>2]=f[848];f[t+8>>2]=f[849];f[t+12>>2]=f[850];f[847]=w;f[848]=m;f[850]=0;f[849]=t;t=e+28|0;f[t>>2]=7;if((e+32|0)>>>0<r>>>0)do{D=t;t=t+4|0;f[t>>2]=7}while((D+8|0)>>>0<r>>>0);if((e|0)!=(o|0)){a=e-o|0;f[n>>2]=f[n>>2]&-2;f[o+4>>2]=a|1;f[e>>2]=a;t=a>>>3;if(a>>>0<256){e=t<<1;r=2980+(e<<2)|0;n=f[735]|0;t=1<<t;if(n&t){t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Le();else{C=t;I=e}}else{f[735]=n|t;C=2980+(e+2<<2)|0;I=r}f[C>>2]=o;f[I+12>>2]=o;f[o+8>>2]=I;f[o+12>>2]=r;break}t=a>>>8;if(t)if(a>>>0>16777215)r=31;else{H=(t+1048320|0)>>>16&8;D=t<<H;O=(D+520192|0)>>>16&4;D=D<<O;r=(D+245760|0)>>>16&2;r=14-(O|H|r)+(D<<r>>>15)|0;r=a>>>(r+7|0)&1|r<<1}else r=0;n=3244+(r<<2)|0;f[o+28>>2]=r;f[o+20>>2]=0;f[i>>2]=0;t=f[736]|0;e=1<<r;if(!(t&e)){f[736]=t|e;f[n>>2]=o;f[o+24>>2]=n;f[o+12>>2]=o;f[o+8>>2]=o;break}t=f[n>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(a|0)){r=a<<((r|0)==31?0:25-(r>>>1)|0);while(1){e=t+16+(r>>>31<<2)|0;n=f[e>>2]|0;if(!n)break;if((f[n+4>>2]&-8|0)==(a|0)){N=n;break t}else{r=r<<1;t=n}}if(e>>>0<(f[739]|0)>>>0)Le();else{f[e>>2]=o;f[o+24>>2]=t;f[o+12>>2]=o;f[o+8>>2]=o;break e}}else N=t}while(0);t=N+8|0;e=f[t>>2]|0;D=f[739]|0;if(e>>>0>=D>>>0&N>>>0>=D>>>0){f[e+12>>2]=o;f[t>>2]=o;f[o+8>>2]=e;f[o+12>>2]=N;f[o+24>>2]=0;break}else Le()}}else{D=f[739]|0;if((D|0)==0|w>>>0<D>>>0)f[739]=w;f[847]=w;f[848]=m;f[850]=0;f[744]=f[853];f[743]=-1;t=0;do{D=t<<1;H=2980+(D<<2)|0;f[2980+(D+3<<2)>>2]=H;f[2980+(D+2<<2)>>2]=H;t=t+1|0}while((t|0)!=32);D=w+8|0;D=(D&7|0)==0?0:0-D&7;H=m+-40-D|0;f[741]=w+D;f[738]=H;f[w+(D+4)>>2]=H|1;f[w+(m+-36)>>2]=40;f[742]=f[857]}}while(0);t=f[738]|0;if(t>>>0>g>>>0){H=t-g|0;f[738]=H;D=f[741]|0;f[741]=D+g;f[D+(g+4)>>2]=H|1;f[D+4>>2]=g|3;D=D+8|0;return D|0}}D=Rs()|0;f[D>>2]=12;D=0;return D|0}function Il(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0;if(!e)return;t=e+-8|0;s=f[739]|0;if(t>>>0<s>>>0)Le();n=f[e+-4>>2]|0;r=n&3;if((r|0)==1)Le();p=n&-8;g=e+(p+-8)|0;do{if(!(n&1)){t=f[t>>2]|0;if(!r)return;l=-8-t|0;u=e+l|0;h=t+p|0;if(u>>>0<s>>>0)Le();if((u|0)==(f[740]|0)){t=e+(p+-4)|0;n=f[t>>2]|0;if((n&3|0)!=3){b=u;a=h;break}f[737]=h;f[t>>2]=n&-2;f[e+(l+4)>>2]=h|1;f[g>>2]=h;return}i=t>>>3;if(t>>>0<256){r=f[e+(l+8)>>2]|0;n=f[e+(l+12)>>2]|0;t=2980+(i<<1<<2)|0;if((r|0)!=(t|0)){if(r>>>0<s>>>0)Le();if((f[r+12>>2]|0)!=(u|0))Le()}if((n|0)==(r|0)){f[735]=f[735]&~(1<<i);b=u;a=h;break}if((n|0)!=(t|0)){if(n>>>0<s>>>0)Le();t=n+8|0;if((f[t>>2]|0)==(u|0))o=t;else Le()}else o=n+8|0;f[r+12>>2]=n;f[o>>2]=r;b=u;a=h;break}o=f[e+(l+24)>>2]|0;r=f[e+(l+12)>>2]|0;do{if((r|0)==(u|0)){n=e+(l+20)|0;t=f[n>>2]|0;if(!t){n=e+(l+16)|0;t=f[n>>2]|0;if(!t){c=0;break}}while(1){r=t+20|0;i=f[r>>2]|0;if(i){t=i;n=r;continue}r=t+16|0;i=f[r>>2]|0;if(!i)break;else{t=i;n=r}}if(n>>>0<s>>>0)Le();else{f[n>>2]=0;c=t;break}}else{i=f[e+(l+8)>>2]|0;if(i>>>0<s>>>0)Le();t=i+12|0;if((f[t>>2]|0)!=(u|0))Le();n=r+8|0;if((f[n>>2]|0)==(u|0)){f[t>>2]=r;f[n>>2]=i;c=r;break}else Le()}}while(0);if(o){t=f[e+(l+28)>>2]|0;n=3244+(t<<2)|0;if((u|0)==(f[n>>2]|0)){f[n>>2]=c;if(!c){f[736]=f[736]&~(1<<t);b=u;a=h;break}}else{if(o>>>0<(f[739]|0)>>>0)Le();t=o+16|0;if((f[t>>2]|0)==(u|0))f[t>>2]=c;else f[o+20>>2]=c;if(!c){b=u;a=h;break}}n=f[739]|0;if(c>>>0<n>>>0)Le();f[c+24>>2]=o;t=f[e+(l+16)>>2]|0;do{if(t)if(t>>>0<n>>>0)Le();else{f[c+16>>2]=t;f[t+24>>2]=c;break}}while(0);t=f[e+(l+20)>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[c+20>>2]=t;f[t+24>>2]=c;b=u;a=h;break}else{b=u;a=h}}else{b=u;a=h}}else{b=t;a=p}}while(0);if(b>>>0>=g>>>0)Le();t=e+(p+-4)|0;n=f[t>>2]|0;if(!(n&1))Le();if(!(n&2)){if((g|0)==(f[741]|0)){_=(f[738]|0)+a|0;f[738]=_;f[741]=b;f[b+4>>2]=_|1;if((b|0)!=(f[740]|0))return;f[740]=0;f[737]=0;return}if((g|0)==(f[740]|0)){_=(f[737]|0)+a|0;f[737]=_;f[740]=b;f[b+4>>2]=_|1;f[b+_>>2]=_;return}a=(n&-8)+a|0;i=n>>>3;do{if(n>>>0>=256){o=f[e+(p+16)>>2]|0;t=f[e+(p|4)>>2]|0;do{if((t|0)==(g|0)){n=e+(p+12)|0;t=f[n>>2]|0;if(!t){n=e+(p+8)|0;t=f[n>>2]|0;if(!t){m=0;break}}while(1){r=t+20|0;i=f[r>>2]|0;if(i){t=i;n=r;continue}r=t+16|0;i=f[r>>2]|0;if(!i)break;else{t=i;n=r}}if(n>>>0<(f[739]|0)>>>0)Le();else{f[n>>2]=0;m=t;break}}else{n=f[e+p>>2]|0;if(n>>>0<(f[739]|0)>>>0)Le();r=n+12|0;if((f[r>>2]|0)!=(g|0))Le();i=t+8|0;if((f[i>>2]|0)==(g|0)){f[r>>2]=t;f[i>>2]=n;m=t;break}else Le()}}while(0);if(o){t=f[e+(p+20)>>2]|0;n=3244+(t<<2)|0;if((g|0)==(f[n>>2]|0)){f[n>>2]=m;if(!m){f[736]=f[736]&~(1<<t);break}}else{if(o>>>0<(f[739]|0)>>>0)Le();t=o+16|0;if((f[t>>2]|0)==(g|0))f[t>>2]=m;else f[o+20>>2]=m;if(!m)break}n=f[739]|0;if(m>>>0<n>>>0)Le();f[m+24>>2]=o;t=f[e+(p+8)>>2]|0;do{if(t)if(t>>>0<n>>>0)Le();else{f[m+16>>2]=t;f[t+24>>2]=m;break}}while(0);t=f[e+(p+12)>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[m+20>>2]=t;f[t+24>>2]=m;break}}}else{r=f[e+p>>2]|0;n=f[e+(p|4)>>2]|0;t=2980+(i<<1<<2)|0;if((r|0)!=(t|0)){if(r>>>0<(f[739]|0)>>>0)Le();if((f[r+12>>2]|0)!=(g|0))Le()}if((n|0)==(r|0)){f[735]=f[735]&~(1<<i);break}if((n|0)!=(t|0)){if(n>>>0<(f[739]|0)>>>0)Le();t=n+8|0;if((f[t>>2]|0)==(g|0))d=t;else Le()}else d=n+8|0;f[r+12>>2]=n;f[d>>2]=r}}while(0);f[b+4>>2]=a|1;f[b+a>>2]=a;if((b|0)==(f[740]|0)){f[737]=a;return}}else{f[t>>2]=n&-2;f[b+4>>2]=a|1;f[b+a>>2]=a}t=a>>>3;if(a>>>0<256){n=t<<1;i=2980+(n<<2)|0;r=f[735]|0;t=1<<t;if(r&t){t=2980+(n+2<<2)|0;n=f[t>>2]|0;if(n>>>0<(f[739]|0)>>>0)Le();else{v=t;y=n}}else{f[735]=r|t;v=2980+(n+2<<2)|0;y=i}f[v>>2]=b;f[y+12>>2]=b;f[b+8>>2]=y;f[b+12>>2]=i;return}t=a>>>8;if(t)if(a>>>0>16777215)i=31;else{v=(t+1048320|0)>>>16&8;y=t<<v;g=(y+520192|0)>>>16&4;y=y<<g;i=(y+245760|0)>>>16&2;i=14-(g|v|i)+(y<<i>>>15)|0;i=a>>>(i+7|0)&1|i<<1}else i=0;t=3244+(i<<2)|0;f[b+28>>2]=i;f[b+20>>2]=0;f[b+16>>2]=0;n=f[736]|0;r=1<<i;e:do{if(n&r){t=f[t>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(a|0)){i=a<<((i|0)==31?0:25-(i>>>1)|0);while(1){n=t+16+(i>>>31<<2)|0;r=f[n>>2]|0;if(!r)break;if((f[r+4>>2]&-8|0)==(a|0)){_=r;break t}else{i=i<<1;t=r}}if(n>>>0<(f[739]|0)>>>0)Le();else{f[n>>2]=b;f[b+24>>2]=t;f[b+12>>2]=b;f[b+8>>2]=b;break e}}else _=t}while(0);t=_+8|0;n=f[t>>2]|0;y=f[739]|0;if(n>>>0>=y>>>0&_>>>0>=y>>>0){f[n+12>>2]=b;f[t>>2]=b;f[b+8>>2]=n;f[b+12>>2]=_;f[b+24>>2]=0;break}else Le()}else{f[736]=n|r;f[t>>2]=b;f[b+24>>2]=t;f[b+12>>2]=b;f[b+8>>2]=b}}while(0);b=(f[743]|0)+-1|0;f[743]=b;if(!b)t=3396;else return;while(1){t=f[t>>2]|0;if(!t)break;else t=t+8|0}f[743]=-1;return}function Nl(e,t){e=e|0;t=t|0;var n=0;if(e){n=ue(t,e)|0;if((t|e)>>>0>65535)n=((n>>>0)/(e>>>0)|0|0)==(t|0)?n:-1}else n=0;t=Cl(n)|0;if(!t)return t|0;if(!(f[t+-4>>2]&3))return t|0;jl(t|0,0,n|0)|0;return t|0}function Fl(e,t){e=e|0;t=t|0;var n=0,r=0;if(!e){e=Cl(t)|0;return e|0}if(t>>>0>4294967231){e=Rs()|0;f[e>>2]=12;e=0;return e|0}n=Hl(e+-8|0,t>>>0<11?16:t+11&-8)|0;if(n){e=n+8|0;return e|0}n=Cl(t)|0;if(!n){e=0;return e|0}r=f[e+-4>>2]|0;r=(r&-8)-((r&3|0)==0?8:4)|0;Xl(n|0,e|0,(r>>>0<t>>>0?r:t)|0)|0;Il(e);e=n;return e|0}function Ol(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;do{if((t|0)!=8){r=t>>>2;if((t&3|0)!=0|(r|0)==0){e=22;return e|0}if(r+1073741823&r){e=22;return e|0}if((-64-t|0)>>>0<n>>>0){e=12;return e|0}else{r=Dl(t>>>0<16?16:t,n)|0;break}}else r=Cl(n)|0}while(0);if(!r){e=12;return e|0}f[e>>2]=r;e=0;return e|0}function Hl(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0;p=e+4|0;m=f[p>>2]|0;l=m&-8;u=e+l|0;s=f[739]|0;n=m&3;if(!((n|0)!=1&e>>>0>=s>>>0&e>>>0<u>>>0))Le();r=e+(l|4)|0;i=f[r>>2]|0;if(!(i&1))Le();if(!n){if(t>>>0<256){e=0;return e|0}if(l>>>0>=(t+4|0)>>>0?(l-t|0)>>>0<=f[855]<<1>>>0:0)return e|0;e=0;return e|0}if(l>>>0>=t>>>0){n=l-t|0;if(n>>>0<=15)return e|0;f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=n|3;f[r>>2]=f[r>>2]|1;Ul(e+t|0,n);return e|0}if((u|0)==(f[741]|0)){n=(f[738]|0)+l|0;if(n>>>0<=t>>>0){e=0;return e|0}d=n-t|0;f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=d|1;f[741]=e+t;f[738]=d;return e|0}if((u|0)==(f[740]|0)){r=(f[737]|0)+l|0;if(r>>>0<t>>>0){e=0;return e|0}n=r-t|0;if(n>>>0>15){f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=n|1;f[e+r>>2]=n;r=e+(r+4)|0;f[r>>2]=f[r>>2]&-2;r=e+t|0}else{f[p>>2]=m&1|r|2;r=e+(r+4)|0;f[r>>2]=f[r>>2]|1;r=0;n=0}f[737]=n;f[740]=r;return e|0}if(i&2){e=0;return e|0}h=(i&-8)+l|0;if(h>>>0<t>>>0){e=0;return e|0}d=h-t|0;a=i>>>3;do{if(i>>>0>=256){o=f[e+(l+24)>>2]|0;a=f[e+(l+12)>>2]|0;do{if((a|0)==(u|0)){r=e+(l+20)|0;n=f[r>>2]|0;if(!n){r=e+(l+16)|0;n=f[r>>2]|0;if(!n){c=0;break}}while(1){i=n+20|0;a=f[i>>2]|0;if(a){n=a;r=i;continue}i=n+16|0;a=f[i>>2]|0;if(!a)break;else{n=a;r=i}}if(r>>>0<s>>>0)Le();else{f[r>>2]=0;c=n;break}}else{i=f[e+(l+8)>>2]|0;if(i>>>0<s>>>0)Le();n=i+12|0;if((f[n>>2]|0)!=(u|0))Le();r=a+8|0;if((f[r>>2]|0)==(u|0)){f[n>>2]=a;f[r>>2]=i;c=a;break}else Le()}}while(0);if(o){n=f[e+(l+28)>>2]|0;r=3244+(n<<2)|0;if((u|0)==(f[r>>2]|0)){f[r>>2]=c;if(!c){f[736]=f[736]&~(1<<n);break}}else{if(o>>>0<(f[739]|0)>>>0)Le();n=o+16|0;if((f[n>>2]|0)==(u|0))f[n>>2]=c;else f[o+20>>2]=c;if(!c)break}r=f[739]|0;if(c>>>0<r>>>0)Le();f[c+24>>2]=o;n=f[e+(l+16)>>2]|0;do{if(n)if(n>>>0<r>>>0)Le();else{f[c+16>>2]=n;f[n+24>>2]=c;break}}while(0);n=f[e+(l+20)>>2]|0;if(n)if(n>>>0<(f[739]|0)>>>0)Le();else{f[c+20>>2]=n;f[n+24>>2]=c;break}}}else{i=f[e+(l+8)>>2]|0;r=f[e+(l+12)>>2]|0;n=2980+(a<<1<<2)|0;if((i|0)!=(n|0)){if(i>>>0<s>>>0)Le();if((f[i+12>>2]|0)!=(u|0))Le()}if((r|0)==(i|0)){f[735]=f[735]&~(1<<a);break}if((r|0)!=(n|0)){if(r>>>0<s>>>0)Le();n=r+8|0;if((f[n>>2]|0)==(u|0))o=n;else Le()}else o=r+8|0;f[i+12>>2]=r;f[o>>2]=i}}while(0);if(d>>>0<16){f[p>>2]=h|m&1|2;t=e+(h|4)|0;f[t>>2]=f[t>>2]|1;return e|0}else{f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=d|3;m=e+(h|4)|0;f[m>>2]=f[m>>2]|1;Ul(e+t|0,d);return e|0}return 0}function Dl(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0;e=e>>>0<16?16:e;if(e+-1&e){n=16;while(1)if(n>>>0<e>>>0)n=n<<1;else{e=n;break}}if((-64-e|0)>>>0<=t>>>0){s=Rs()|0;f[s>>2]=12;s=0;return s|0}o=t>>>0<11?16:t+11&-8;r=Cl(o+12+e|0)|0;if(!r){s=0;return s|0}t=r+-8|0;n=e+-1|0;do{if(r&n){i=r+n&0-e;n=i+-8|0;a=t;i=(n-a|0)>>>0>15?n:i+(e+-8)|0;a=i-a|0;e=r+-4|0;r=f[e>>2]|0;n=(r&-8)-a|0;if(!(r&3)){f[i>>2]=(f[t>>2]|0)+a;f[i+4>>2]=n;t=i;break}else{r=i+4|0;f[r>>2]=n|f[r>>2]&1|2;n=i+(n+4)|0;f[n>>2]=f[n>>2]|1;f[e>>2]=a|f[e>>2]&1|2;f[r>>2]=f[r>>2]|1;Ul(t,a);t=i;break}}}while(0);e=t+4|0;n=f[e>>2]|0;if((n&3|0)!=0?(s=n&-8,s>>>0>(o+16|0)>>>0):0){a=s-o|0;f[e>>2]=o|n&1|2;f[t+(o|4)>>2]=a|3;s=t+(s|4)|0;f[s>>2]=f[s>>2]|1;Ul(t+o|0,a)}s=t+8|0;return s|0}function Ul(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;g=e+t|0;n=f[e+4>>2]|0;do{if(!(n&1)){c=f[e>>2]|0;if(!(n&3))return;d=e+(0-c)|0;h=c+t|0;l=f[739]|0;if(d>>>0<l>>>0)Le();if((d|0)==(f[740]|0)){r=e+(t+4)|0;n=f[r>>2]|0;if((n&3|0)!=3){_=d;o=h;break}f[737]=h;f[r>>2]=n&-2;f[e+(4-c)>>2]=h|1;f[g>>2]=h;return}a=c>>>3;if(c>>>0<256){i=f[e+(8-c)>>2]|0;r=f[e+(12-c)>>2]|0;n=2980+(a<<1<<2)|0;if((i|0)!=(n|0)){if(i>>>0<l>>>0)Le();if((f[i+12>>2]|0)!=(d|0))Le()}if((r|0)==(i|0)){f[735]=f[735]&~(1<<a);_=d;o=h;break}if((r|0)!=(n|0)){if(r>>>0<l>>>0)Le();n=r+8|0;if((f[n>>2]|0)==(d|0))s=n;else Le()}else s=r+8|0;f[i+12>>2]=r;f[s>>2]=i;_=d;o=h;break}s=f[e+(24-c)>>2]|0;i=f[e+(12-c)>>2]|0;do{if((i|0)==(d|0)){i=16-c|0;r=e+(i+4)|0;n=f[r>>2]|0;if(!n){r=e+i|0;n=f[r>>2]|0;if(!n){u=0;break}}while(1){i=n+20|0;a=f[i>>2]|0;if(a){n=a;r=i;continue}i=n+16|0;a=f[i>>2]|0;if(!a)break;else{n=a;r=i}}if(r>>>0<l>>>0)Le();else{f[r>>2]=0;u=n;break}}else{a=f[e+(8-c)>>2]|0;if(a>>>0<l>>>0)Le();n=a+12|0;if((f[n>>2]|0)!=(d|0))Le();r=i+8|0;if((f[r>>2]|0)==(d|0)){f[n>>2]=i;f[r>>2]=a;u=i;break}else Le()}}while(0);if(s){n=f[e+(28-c)>>2]|0;r=3244+(n<<2)|0;if((d|0)==(f[r>>2]|0)){f[r>>2]=u;if(!u){f[736]=f[736]&~(1<<n);_=d;o=h;break}}else{if(s>>>0<(f[739]|0)>>>0)Le();n=s+16|0;if((f[n>>2]|0)==(d|0))f[n>>2]=u;else f[s+20>>2]=u;if(!u){_=d;o=h;break}}i=f[739]|0;if(u>>>0<i>>>0)Le();f[u+24>>2]=s;n=16-c|0;r=f[e+n>>2]|0;do{if(r)if(r>>>0<i>>>0)Le();else{f[u+16>>2]=r;f[r+24>>2]=u;break}}while(0);n=f[e+(n+4)>>2]|0;if(n)if(n>>>0<(f[739]|0)>>>0)Le();else{f[u+20>>2]=n;f[n+24>>2]=u;_=d;o=h;break}else{_=d;o=h}}else{_=d;o=h}}else{_=e;o=t}}while(0);l=f[739]|0;if(g>>>0<l>>>0)Le();n=e+(t+4)|0;r=f[n>>2]|0;if(!(r&2)){if((g|0)==(f[741]|0)){y=(f[738]|0)+o|0;f[738]=y;f[741]=_;f[_+4>>2]=y|1;if((_|0)!=(f[740]|0))return;f[740]=0;f[737]=0;return}if((g|0)==(f[740]|0)){y=(f[737]|0)+o|0;f[737]=y;f[740]=_;f[_+4>>2]=y|1;f[_+y>>2]=y;return}o=(r&-8)+o|0;a=r>>>3;do{if(r>>>0>=256){s=f[e+(t+24)>>2]|0;i=f[e+(t+12)>>2]|0;do{if((i|0)==(g|0)){r=e+(t+20)|0;n=f[r>>2]|0;if(!n){r=e+(t+16)|0;n=f[r>>2]|0;if(!n){m=0;break}}while(1){i=n+20|0;a=f[i>>2]|0;if(a){n=a;r=i;continue}i=n+16|0;a=f[i>>2]|0;if(!a)break;else{n=a;r=i}}if(r>>>0<l>>>0)Le();else{f[r>>2]=0;m=n;break}}else{a=f[e+(t+8)>>2]|0;if(a>>>0<l>>>0)Le();n=a+12|0;if((f[n>>2]|0)!=(g|0))Le();r=i+8|0;if((f[r>>2]|0)==(g|0)){f[n>>2]=i;f[r>>2]=a;m=i;break}else Le()}}while(0);if(s){n=f[e+(t+28)>>2]|0;r=3244+(n<<2)|0;if((g|0)==(f[r>>2]|0)){f[r>>2]=m;if(!m){f[736]=f[736]&~(1<<n);break}}else{if(s>>>0<(f[739]|0)>>>0)Le();n=s+16|0;if((f[n>>2]|0)==(g|0))f[n>>2]=m;else f[s+20>>2]=m;if(!m)break}r=f[739]|0;if(m>>>0<r>>>0)Le();f[m+24>>2]=s;n=f[e+(t+16)>>2]|0;do{if(n)if(n>>>0<r>>>0)Le();else{f[m+16>>2]=n;f[n+24>>2]=m;break}}while(0);n=f[e+(t+20)>>2]|0;if(n)if(n>>>0<(f[739]|0)>>>0)Le();else{f[m+20>>2]=n;f[n+24>>2]=m;break}}}else{i=f[e+(t+8)>>2]|0;r=f[e+(t+12)>>2]|0;n=2980+(a<<1<<2)|0;if((i|0)!=(n|0)){if(i>>>0<l>>>0)Le();if((f[i+12>>2]|0)!=(g|0))Le()}if((r|0)==(i|0)){f[735]=f[735]&~(1<<a);break}if((r|0)!=(n|0)){if(r>>>0<l>>>0)Le();n=r+8|0;if((f[n>>2]|0)==(g|0))p=n;else Le()}else p=r+8|0;f[i+12>>2]=r;f[p>>2]=i}}while(0);f[_+4>>2]=o|1;f[_+o>>2]=o;if((_|0)==(f[740]|0)){f[737]=o;return}}else{f[n>>2]=r&-2;f[_+4>>2]=o|1;f[_+o>>2]=o}n=o>>>3;if(o>>>0<256){r=n<<1;a=2980+(r<<2)|0;i=f[735]|0;n=1<<n;if(i&n){n=2980+(r+2<<2)|0;r=f[n>>2]|0;if(r>>>0<(f[739]|0)>>>0)Le();else{v=n;y=r}}else{f[735]=i|n;v=2980+(r+2<<2)|0;y=a}f[v>>2]=_;f[y+12>>2]=_;f[_+8>>2]=y;f[_+12>>2]=a;return}n=o>>>8;if(n)if(o>>>0>16777215)a=31;else{v=(n+1048320|0)>>>16&8;y=n<<v;g=(y+520192|0)>>>16&4;y=y<<g;a=(y+245760|0)>>>16&2;a=14-(g|v|a)+(y<<a>>>15)|0;a=o>>>(a+7|0)&1|a<<1}else a=0;n=3244+(a<<2)|0;f[_+28>>2]=a;f[_+20>>2]=0;f[_+16>>2]=0;r=f[736]|0;i=1<<a;if(!(r&i)){f[736]=r|i;f[n>>2]=_;f[_+24>>2]=n;f[_+12>>2]=_;f[_+8>>2]=_;return}n=f[n>>2]|0;e:do{if((f[n+4>>2]&-8|0)!=(o|0)){a=o<<((a|0)==31?0:25-(a>>>1)|0);while(1){r=n+16+(a>>>31<<2)|0;i=f[r>>2]|0;if(!i)break;if((f[i+4>>2]&-8|0)==(o|0)){n=i;break e}else{a=a<<1;n=i}}if(r>>>0<(f[739]|0)>>>0)Le();f[r>>2]=_;f[_+24>>2]=n;f[_+12>>2]=_;f[_+8>>2]=_;return}}while(0);r=n+8|0;i=f[r>>2]|0;y=f[739]|0;if(!(i>>>0>=y>>>0&n>>>0>=y>>>0))Le();f[i+12>>2]=_;f[r>>2]=_;f[_+8>>2]=i;f[_+12>>2]=n;f[_+24>>2]=0;return}function Bl(){}function zl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;r=t-r-(n>>>0>e>>>0|0)>>>0;return(B=r,e-n>>>0|0)|0}function Vl(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)<32){B=t>>n;return e>>>n|(t&(1<<n)-1)<<32-n}B=(t|0)<0?-1:0;return t>>n-32|0}function jl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;r=e+n|0;if((n|0)>=20){t=t&255;a=e&3;o=t|t<<8|t<<16|t<<24;i=r&~3;if(a){a=e+4-a|0;while((e|0)<(a|0)){h[e>>0]=t;e=e+1|0}}while((e|0)<(i|0)){f[e>>2]=o;e=e+4|0}}while((e|0)<(r|0)){h[e>>0]=t;e=e+1|0}return e-n|0}function Gl(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)<32){B=t<<n|(e&(1<<n)-1<<32-n)>>>32-n;return e<<n}B=e<<n-32;return 0}function Wl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;n=e+n>>>0;return(B=t+r+(n>>>0<e>>>0|0)>>>0,n|0)|0}function ql(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)<32){B=t>>>n;return e>>>n|(t&(1<<n)-1)<<32-n}B=0;return t>>>n-32|0}function Xl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;if((n|0)>=4096)return Oe(e|0,t|0,n|0)|0;r=e|0;if((e&3)==(t&3)){while(e&3){if(!n)return r|0;h[e>>0]=h[t>>0]|0;e=e+1|0;t=t+1|0;n=n-1|0}while((n|0)>=4){f[e>>2]=f[t>>2];e=e+4|0;t=t+4|0;n=n-4|0}}while((n|0)>0){h[e>>0]=h[t>>0]|0;e=e+1|0;t=t+1|0;n=n-1|0}return r|0}function Yl(e){e=e|0;var t=0;t=h[T+(e&255)>>0]|0;if((t|0)<8)return t|0;t=h[T+(e>>8&255)>>0]|0;if((t|0)<8)return t+8|0;t=h[T+(e>>16&255)>>0]|0;if((t|0)<8)return t+16|0;return(h[T+(e>>>24)>>0]|0)+24|0}function Kl(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;a=e&65535;i=t&65535;n=ue(i,a)|0;r=e>>>16;e=(n>>>16)+(ue(i,r)|0)|0;i=t>>>16;t=ue(i,a)|0;return(B=(e>>>16)+(ue(i,r)|0)+(((e&65535)+t|0)>>>16)|0,e+t<<16|n&65535|0)|0}function Zl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;c=t>>31|((t|0)<0?-1:0)<<1;l=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1;a=r>>31|((r|0)<0?-1:0)<<1;i=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1;s=zl(c^e,l^t,c,l)|0;o=B;e=a^c;t=i^l;return zl((tc(s,o,zl(a^n,i^r,a,i)|0,B,0)|0)^e,B^t,e,t)|0}function Ql(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,s=0,l=0,c=0;i=b;b=b+16|0;s=i|0;o=t>>31|((t|0)<0?-1:0)<<1;a=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1;c=r>>31|((r|0)<0?-1:0)<<1;l=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1;e=zl(o^e,a^t,o,a)|0;t=B;tc(e,t,zl(c^n,l^r,c,l)|0,B,s)|0;r=zl(f[s>>2]^o,f[s+4>>2]^a,o,a)|0;n=B;b=i;return(B=n,r)|0}function Jl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;i=e;a=n;n=Kl(i,a)|0;e=B;return(B=(ue(t,a)|0)+(ue(r,i)|0)+e|e&0,n|0|0)|0}function $l(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;return tc(e,t,n,r,0)|0}function ec(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;a=b;b=b+16|0;i=a|0;tc(e,t,n,r,i)|0;b=a;return(B=f[i+4>>2]|0,f[i>>2]|0)|0}function tc(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0;u=e;l=t;c=l;o=n;d=r;s=d;if(!c){a=(i|0)!=0;if(!s){if(a){f[i>>2]=(u>>>0)%(o>>>0);f[i+4>>2]=0}d=0;i=(u>>>0)/(o>>>0)>>>0;return(B=d,i)|0}else{if(!a){d=0;i=0;return(B=d,i)|0}f[i>>2]=e|0;f[i+4>>2]=t&0;d=0;i=0;return(B=d,i)|0}}a=(s|0)==0;do{if(o){if(!a){a=(de(s|0)|0)-(de(c|0)|0)|0;if(a>>>0<=31){h=a+1|0;s=31-a|0;t=a-31>>31;o=h;e=u>>>(h>>>0)&t|c<<s;t=c>>>(h>>>0)&t;a=0;s=u<<s;break}if(!i){d=0;i=0;return(B=d,i)|0}f[i>>2]=e|0;f[i+4>>2]=l|t&0;d=0;i=0;return(B=d,i)|0}a=o-1|0;if(a&o){s=(de(o|0)|0)+33-(de(c|0)|0)|0;m=64-s|0;h=32-s|0;l=h>>31;p=s-32|0;t=p>>31;o=s;e=h-1>>31&c>>>(p>>>0)|(c<<h|u>>>(s>>>0))&t;t=t&c>>>(s>>>0);a=u<<m&l;s=(c<<m|u>>>(p>>>0))&l|u<<h&s-33>>31;break}if(i){f[i>>2]=a&u;f[i+4>>2]=0}if((o|0)==1){p=l|t&0;m=e|0|0;return(B=p,m)|0}else{m=Yl(o|0)|0;p=c>>>(m>>>0)|0;m=c<<32-m|u>>>(m>>>0)|0;return(B=p,m)|0}}else{if(a){if(i){f[i>>2]=(c>>>0)%(o>>>0);f[i+4>>2]=0}p=0;m=(c>>>0)/(o>>>0)>>>0;return(B=p,m)|0}if(!u){if(i){f[i>>2]=0;f[i+4>>2]=(c>>>0)%(s>>>0)}p=0;m=(c>>>0)/(s>>>0)>>>0;return(B=p,m)|0}a=s-1|0;if(!(a&s)){if(i){f[i>>2]=e|0;f[i+4>>2]=a&c|t&0}p=0;m=c>>>((Yl(s|0)|0)>>>0);return(B=p,m)|0}a=(de(s|0)|0)-(de(c|0)|0)|0;if(a>>>0<=30){t=a+1|0;s=31-a|0;o=t;e=c<<s|u>>>(t>>>0);t=c>>>(t>>>0);a=0;s=u<<s;break}if(!i){p=0;m=0;return(B=p,m)|0}f[i>>2]=e|0;f[i+4>>2]=l|t&0;p=0;m=0;return(B=p,m)|0}}while(0);if(!o){c=s;l=0;s=0}else{h=n|0|0;u=d|r&0;c=Wl(h|0,u|0,-1,-1)|0;n=B;l=s;s=0;do{r=l;l=a>>>31|l<<1;a=s|a<<1;r=e<<1|r>>>31|0;d=e>>>31|t<<1|0;zl(c,n,r,d)|0;m=B;p=m>>31|((m|0)<0?-1:0)<<1;s=p&1;e=zl(r,d,p&h,(((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1)&u)|0;t=B;o=o-1|0}while((o|0)!=0);c=l;l=0}o=0;if(i){f[i>>2]=e;f[i+4>>2]=t}p=(a|0)>>>31|(c|o)<<1|(o<<1|a>>>31)&0|l;m=(a<<1|0>>>31)&-2|s;return(B=p,m)|0}function nc(e,t,n,r,i,a,o,s){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;return Rc[e&3](t|0,n|0,r|0,i|0,a|0,o|0,s|0)|0}function rc(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;return kc[e&63](t|0,n|0,r|0)|0}function ic(e,t){e=e|0;t=t|0;return+Pc[e&3](t|0)}function ac(e,t){e=e|0;t=t|0;Lc[e&7](t|0)}function oc(e,t,n){e=e|0;t=t|0;n=n|0;Cc[e&7](t|0,n|0)}function sc(e,t,n,r,i,a,o){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;return Ic[e&7](t|0,n|0,r|0,i|0,a|0,o|0)|0}function lc(e,t){e=e|0;t=t|0;return Nc[e&15](t|0)|0}function cc(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;Fc[e&15](t|0,n|0,r|0)}function uc(e,t,n,r,i,a,o,s,l,c,u,h){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;c=c|0;u=u|0;h=h|0;return Oc[e&3](t|0,n|0,r|0,i|0,a|0,o|0,s|0,l|0,c|0,u|0,h|0)|0}function hc(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;return Hc[e&63](t|0,n|0,r|0,i|0)|0}function dc(e,t,n){e=e|0;t=t|0;n=n|0;return Dc[e&7](t|0,n|0)|0}function fc(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;return Uc[e&3](t|0,n|0,r|0,i|0,a|0)|0}function pc(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;Bc[e&3](t|0,n|0,r|0,i|0)}function mc(e,t,n,r,i,a,o){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;fe(0);return 0}function gc(e,t,n){e=e|0;t=t|0;n=n|0;fe(1);return 0}function vc(e){e=e|0;fe(2);return 0.0}function yc(e){e=e|0;fe(3)}function _c(e,t){e=e|0;t=t|0;fe(4)}function bc(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;fe(5);return 0}function Ec(e){e=e|0;fe(6);return 0}function wc(e,t,n){e=e|0;t=t|0;n=n|0;fe(7)}function xc(e,t,n,r,i,a,o,s,l,c,u){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;c=c|0;u=u|0;fe(8);return 0}function Tc(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;fe(9);return 0}function Ac(e,t){e=e|0;t=t|0;fe(10);return 0}function Mc(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;fe(11);return 0}function Sc(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;fe(12)}var Rc=[mc,ua,Gt,mc];var kc=[gc,Rl,Ys,qs,Cr,Ir,Nr,Fr,Ui,Bi,Vi,aa,_a,Ot,Zt,ba,Ea,Ft,Ht,ji,Gi,Wi,qi,Aa,Ma,Sa,Ra,Pa,La,Ia,Na,Fa,Oa,Ha,Da,Ua,Ba,za,Va,ja,Ga,Wa,qa,Xa,Ya,Ka,Za,Qa,Ja,$a,eo,to,en,tn,nn,rn,an,on,sn,ln,Ws,Xs,gc,gc];var Pc=[vc,no,ro,vc];var Lc=[yc,na,jt,nr,rr,Tl,Al,yc];var Cc=[_c,yr,_r,br,ei,ea,It,_c];var Ic=[bc,ca,Vt,xa,zt,bc,bc,bc];var Nc=[Ec,Gs,ma,ga,Kt,Yt,Qs,Ho,No,Ec,Ec,Ec,Ec,Ec,Ec,Ec];var Fc=[wc,Rt,kt,Pt,Lt,wt,xt,Tt,At,yt,_t,bt,Et,da,Xt,wc];var Oc=[xc,la,Bt,xc];var Hc=[Tc,co,uo,tt,nt,rt,it,at,ot,st,lt,ct,ut,ht,dt,ft,pt,mt,gt,vt,_n,bn,En,fn,pn,mn,gn,vn,yn,Rr,kr,Pr,Lr,va,oa,Ct,Ut,wa,ra,Dt,Nt,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc,Tc];var Dc=[Ac,zi,cn,un,hn,dn,Ac,Ac];var Uc=[Mc,ya,Wt,Mc];var Bc=[Sc,zo,Go,Sc];return{_opj_stream_destroy:Hr,_opj_stream_set_read_function:Dr,_opj_read_tile_header:yi,_opj_set_warning_handler:li,_opj_destroy_cstr_info:Ni,_opj_image_create:ni,_opj_set_error_handler:ci,_opj_stream_set_user_data:Vr,_opj_end_decompress:Ri,_bitshift64Lshr:ql,_opj_stream_set_seek_function:Ur,_opj_decode:gi,_opj_set_decoded_resolution_factor:Ei,_i64Add:Wl,_opj_stream_create_default_file_stream:Hi,_opj_encode:Mi,_bitshift64Ashr:Vl,_opj_get_decoded_tile:bi,_memset:jl,_opj_version:hi,_memcpy:Xl,_opj_destroy_cstr_index:Oi,_opj_stream_set_user_data_length:jr,_opj_stream_set_skip_function:zr,_opj_image_destroy:ri,_opj_stream_create_file_stream:Di,_opj_setup_encoder:Ti,_opj_stream_default_create:Or,_bitshift64Shl:Gl,_opj_stream_create:Sr,_jp2_version:vr,_i64Subtract:zl,_opj_get_cstr_index:Fi,_opj_set_default_decoder_parameters:fi,_opj_read_header:mi,_opj_get_cstr_info:Ii,_opj_set_default_encoder_parameters:xi,_opj_set_decode_area:vi,_opj_stream_set_write_function:Br,_opj_dump_codec:Ci,_opj_create_decompress:di,_opj_decode_tile_data:_i,_free:Il,_opj_image_tile_create:oi,_opj_set_MCT:ki,_opj_set_info_handler:si,_opj_start_compress:Ai,_opj_write_tile:Pi,_opj_setup_decoder:pi,_malloc:Cl,_opj_end_compress:Si,_opj_destroy_codec:Li,_jp2_decode:gr,_opj_stream_create_buffer_stream:ui,_opj_create_compress:wi,runPostSets:Bl,_emscripten_replace_memory:et,stackAlloc:sr,stackSave:lr,stackRestore:cr,establishStackSpace:ur,setThrew:hr,setTempRet0:pr,getTempRet0:mr,dynCall_iiiiiiii:nc,dynCall_iiii:rc,dynCall_di:ic,dynCall_vi:ac,dynCall_vii:oc,dynCall_iiiiiii:sc,dynCall_ii:lc,dynCall_viii:cc,dynCall_iiiiiiiiiiii:uc,dynCall_iiiii:hc,dynCall_iii:dc,dynCall_iiiiii:fc,dynCall_viiii:pc}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer),_opj_stream_destroy=Module._opj_stream_destroy=asm._opj_stream_destroy,_opj_stream_set_read_function=Module._opj_stream_set_read_function=asm._opj_stream_set_read_function,_opj_read_tile_header=Module._opj_read_tile_header=asm._opj_read_tile_header,_opj_set_warning_handler=Module._opj_set_warning_handler=asm._opj_set_warning_handler,_opj_destroy_cstr_info=Module._opj_destroy_cstr_info=asm._opj_destroy_cstr_info,_opj_image_create=Module._opj_image_create=asm._opj_image_create,_opj_set_error_handler=Module._opj_set_error_handler=asm._opj_set_error_handler,_opj_image_tile_create=Module._opj_image_tile_create=asm._opj_image_tile_create,_opj_end_decompress=Module._opj_end_decompress=asm._opj_end_decompress,_bitshift64Lshr=Module._bitshift64Lshr=asm._bitshift64Lshr,_opj_stream_set_seek_function=Module._opj_stream_set_seek_function=asm._opj_stream_set_seek_function,_opj_decode=Module._opj_decode=asm._opj_decode,_opj_set_decoded_resolution_factor=Module._opj_set_decoded_resolution_factor=asm._opj_set_decoded_resolution_factor,_opj_stream_create_default_file_stream=Module._opj_stream_create_default_file_stream=asm._opj_stream_create_default_file_stream,_opj_set_default_decoder_parameters=Module._opj_set_default_decoder_parameters=asm._opj_set_default_decoder_parameters,_bitshift64Ashr=Module._bitshift64Ashr=asm._bitshift64Ashr,_opj_get_decoded_tile=Module._opj_get_decoded_tile=asm._opj_get_decoded_tile,_memset=Module._memset=asm._memset,_opj_version=Module._opj_version=asm._opj_version,_memcpy=Module._memcpy=asm._memcpy,_opj_destroy_cstr_index=Module._opj_destroy_cstr_index=asm._opj_destroy_cstr_index,_opj_stream_set_user_data_length=Module._opj_stream_set_user_data_length=asm._opj_stream_set_user_data_length,_opj_stream_set_skip_function=Module._opj_stream_set_skip_function=asm._opj_stream_set_skip_function,_opj_image_destroy=Module._opj_image_destroy=asm._opj_image_destroy,_opj_stream_create_file_stream=Module._opj_stream_create_file_stream=asm._opj_stream_create_file_stream,_opj_setup_encoder=Module._opj_setup_encoder=asm._opj_setup_encoder,_opj_stream_default_create=Module._opj_stream_default_create=asm._opj_stream_default_create,_bitshift64Shl=Module._bitshift64Shl=asm._bitshift64Shl,_opj_stream_create=Module._opj_stream_create=asm._opj_stream_create,_jp2_version=Module._jp2_version=asm._jp2_version,_i64Subtract=Module._i64Subtract=asm._i64Subtract,_opj_get_cstr_index=Module._opj_get_cstr_index=asm._opj_get_cstr_index,_opj_encode=Module._opj_encode=asm._opj_encode,_i64Add=Module._i64Add=asm._i64Add,_opj_get_cstr_info=Module._opj_get_cstr_info=asm._opj_get_cstr_info,_opj_set_default_encoder_parameters=Module._opj_set_default_encoder_parameters=asm._opj_set_default_encoder_parameters,_opj_set_decode_area=Module._opj_set_decode_area=asm._opj_set_decode_area,_opj_stream_set_write_function=Module._opj_stream_set_write_function=asm._opj_stream_set_write_function,_opj_dump_codec=Module._opj_dump_codec=asm._opj_dump_codec,_opj_read_header=Module._opj_read_header=asm._opj_read_header,_opj_create_decompress=Module._opj_create_decompress=asm._opj_create_decompress,_opj_decode_tile_data=Module._opj_decode_tile_data=asm._opj_decode_tile_data,_opj_set_info_handler=Module._opj_set_info_handler=asm._opj_set_info_handler,_opj_stream_set_user_data=Module._opj_stream_set_user_data=asm._opj_stream_set_user_data,_opj_set_MCT=Module._opj_set_MCT=asm._opj_set_MCT,_free=Module._free=asm._free,runPostSets=Module.runPostSets=asm.runPostSets,_opj_start_compress=Module._opj_start_compress=asm._opj_start_compress,_opj_write_tile=Module._opj_write_tile=asm._opj_write_tile,_opj_setup_decoder=Module._opj_setup_decoder=asm._opj_setup_decoder,_malloc=Module._malloc=asm._malloc,_opj_end_compress=Module._opj_end_compress=asm._opj_end_compress,_opj_destroy_codec=Module._opj_destroy_codec=asm._opj_destroy_codec,_emscripten_replace_memory=Module._emscripten_replace_memory=asm._emscripten_replace_memory,_jp2_decode=Module._jp2_decode=asm._jp2_decode,_opj_stream_create_buffer_stream=Module._opj_stream_create_buffer_stream=asm._opj_stream_create_buffer_stream,_opj_create_compress=Module._opj_create_compress=asm._opj_create_compress,dynCall_iiiiiiii=Module.dynCall_iiiiiiii=asm.dynCall_iiiiiiii,dynCall_iiii=Module.dynCall_iiii=asm.dynCall_iiii,dynCall_di=Module.dynCall_di=asm.dynCall_di,dynCall_vi=Module.dynCall_vi=asm.dynCall_vi,dynCall_vii=Module.dynCall_vii=asm.dynCall_vii,dynCall_iiiiiii=Module.dynCall_iiiiiii=asm.dynCall_iiiiiii,dynCall_ii=Module.dynCall_ii=asm.dynCall_ii,dynCall_viii=Module.dynCall_viii=asm.dynCall_viii,dynCall_iiiiiiiiiiii=Module.dynCall_iiiiiiiiiiii=asm.dynCall_iiiiiiiiiiii,dynCall_iiiii=Module.dynCall_iiiii=asm.dynCall_iiiii,dynCall_iii=Module.dynCall_iii=asm.dynCall_iii,dynCall_iiiiii=Module.dynCall_iiiiii=asm.dynCall_iiiiii,dynCall_viiii=Module.dynCall_viiii=asm.dynCall_viiii,initialStackTop;function ExitStatus(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}Runtime.stackAlloc=asm.stackAlloc,Runtime.stackSave=asm.stackSave,Runtime.stackRestore=asm.stackRestore,Runtime.establishStackSpace=asm.establishStackSpace,Runtime.setTempRet0=asm.setTempRet0,Runtime.getTempRet0=asm.getTempRet0,ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var preloadStartTime=null,calledMain=!1;function run(e){function t(){Module.calledRun||(Module.calledRun=!0,ABORT||(ensureInitRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),Module._main&&shouldRunNow&&Module.callMain(e),postRun()))}e=e||Module.arguments,null===preloadStartTime&&(preloadStartTime=Date.now()),runDependencies>0||(preRun(),runDependencies>0||Module.calledRun||(Module.setStatus?(Module.setStatus("Running..."),setTimeout((function(){setTimeout((function(){Module.setStatus("")}),1),t()}),1)):t()))}function exit(e,t){if(!t||!Module.noExitRuntime)throw Module.noExitRuntime||(ABORT=!0,EXITSTATUS=e,STACKTOP=initialStackTop,exitRuntime(),Module.onExit&&Module.onExit(e)),ENVIRONMENT_IS_NODE?(process.stdout.once("drain",(function(){process.exit(e)})),console.log(" "),setTimeout((function(){process.exit(e)}),500)):ENVIRONMENT_IS_SHELL&&"function"==typeof quit&&quit(e),new ExitStatus(e)}dependenciesFulfilled=function e(){Module.calledRun||run(),Module.calledRun||(dependenciesFulfilled=e)},Module.callMain=Module.callMain=function(e){assert(0==runDependencies,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==__ATPRERUN__.length,"cannot call main when preRun functions remain to be called"),e=e||[],ensureInitRuntime();var t=e.length+1;function n(){for(var e=0;e<3;e++)r.push(0)}var r=[allocate(intArrayFromString(Module.thisProgram),"i8",ALLOC_NORMAL)];n();for(var i=0;i<t-1;i+=1)r.push(allocate(intArrayFromString(e[i]),"i8",ALLOC_NORMAL)),n();r.push(0),r=allocate(r,"i32",ALLOC_NORMAL);try{exit(Module._main(t,r,0),!0)}catch(e){if(e instanceof ExitStatus)return;if("SimulateInfiniteLoop"==e)return void(Module.noExitRuntime=!0);throw e&&"object"==typeof e&&e.stack&&Module.printErr("exception thrown: "+[e,e.stack]),e}finally{calledMain=!0}},Module.run=Module.run=run,Module.exit=Module.exit=exit;var abortDecorators=[];function abort(e){void 0!==e?(Module.print(e),Module.printErr(e),e=JSON.stringify(e)):e="",ABORT=!0,EXITSTATUS=1;var t="abort("+e+") at "+stackTrace()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw abortDecorators&&abortDecorators.forEach((function(n){t=n(t,e)})),t}if(Module.abort=Module.abort=abort,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;return Module.noInitialRun&&(shouldRunNow=!1),run(),Module}},9854:e=>{e.exports=function(e,n,r){if(e.filter)return e.filter(n,r);if(null==e)throw new TypeError;if("function"!=typeof n)throw new TypeError;for(var i=[],a=0;a<e.length;a++)if(t.call(e,a)){var o=e[a];n.call(r,o,a,e)&&i.push(o)}return i};var t=Object.prototype.hasOwnProperty},6118:(e,t,n)=>{"use strict";var r=n(2530);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a,o,s=n(8619).codes,l=s.ERR_AMBIGUOUS_ARGUMENT,c=s.ERR_INVALID_ARG_TYPE,u=s.ERR_INVALID_ARG_VALUE,h=s.ERR_INVALID_RETURN_VALUE,d=s.ERR_MISSING_ARGS,f=n(6979),p=n(5663).inspect,m=n(5663).types,g=m.isPromise,v=m.isRegExp,y=Object.assign?Object.assign:n(1662).assign,_=Object.is?Object.is:n(7402);new Map;function b(){var e=n(1667);a=e.isDeepEqual,o=e.isDeepStrictEqual}var E=!1,w=e.exports=M,x={};function T(e){if(e.message instanceof Error)throw e.message;throw new f(e)}function A(e,t,n,r){if(!n){var i=!1;if(0===t)i=!0,r="No value argument passed to `assert.ok()`";else if(r instanceof Error)throw r;var a=new f({actual:n,expected:!0,message:r,operator:"==",stackStartFn:e});throw a.generatedMessage=i,a}}function M(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];A.apply(void 0,[M,t.length].concat(t))}w.fail=function e(t,n,i,a,o){var s,l=arguments.length;if(0===l)s="Failed";else if(1===l)i=t,t=void 0;else{if(!1===E){E=!0;var c=r.emitWarning?r.emitWarning:console.warn.bind(console);c("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}2===l&&(a="!=")}if(i instanceof Error)throw i;var u={actual:t,expected:n,operator:void 0===a?"fail":a,stackStartFn:o||e};void 0!==i&&(u.message=i);var h=new f(u);throw s&&(h.message=s,h.generatedMessage=!0),h},w.AssertionError=f,w.ok=M,w.equal=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");t!=n&&T({actual:t,expected:n,message:r,operator:"==",stackStartFn:e})},w.notEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");t==n&&T({actual:t,expected:n,message:r,operator:"!=",stackStartFn:e})},w.deepEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");void 0===a&&b(),a(t,n)||T({actual:t,expected:n,message:r,operator:"deepEqual",stackStartFn:e})},w.notDeepEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");void 0===a&&b(),a(t,n)&&T({actual:t,expected:n,message:r,operator:"notDeepEqual",stackStartFn:e})},w.deepStrictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");void 0===a&&b(),o(t,n)||T({actual:t,expected:n,message:r,operator:"deepStrictEqual",stackStartFn:e})},w.notDeepStrictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");void 0===a&&b();o(t,n)&&T({actual:t,expected:n,message:r,operator:"notDeepStrictEqual",stackStartFn:e})},w.strictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");_(t,n)||T({actual:t,expected:n,message:r,operator:"strictEqual",stackStartFn:e})},w.notStrictEqual=function e(t,n,r){if(arguments.length<2)throw new d("actual","expected");_(t,n)&&T({actual:t,expected:n,message:r,operator:"notStrictEqual",stackStartFn:e})};var S=function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.forEach((function(e){e in t&&(void 0!==r&&"string"==typeof r[e]&&v(t[e])&&t[e].test(r[e])?i[e]=r[e]:i[e]=t[e])}))};function R(e,t,n,r,i,a){if(!(n in e)||!o(e[n],t[n])){if(!r){var s=new S(e,i),l=new S(t,i,e),c=new f({actual:s,expected:l,operator:"deepStrictEqual",stackStartFn:a});throw c.actual=e,c.expected=t,c.operator=a.name,c}T({actual:e,expected:t,message:r,operator:a.name,stackStartFn:a})}}function k(e,t,n,r){if("function"!=typeof t){if(v(t))return t.test(e);if(2===arguments.length)throw new c("expected",["Function","RegExp"],t);if("object"!==i(e)||null===e){var o=new f({actual:e,expected:t,message:n,operator:"deepStrictEqual",stackStartFn:r});throw o.operator=r.name,o}var s=Object.keys(t);if(t instanceof Error)s.push("name","message");else if(0===s.length)throw new u("error",t,"may not be an empty object");return void 0===a&&b(),s.forEach((function(i){"string"==typeof e[i]&&v(t[i])&&t[i].test(e[i])||R(e,t,i,n,s,r)})),!0}return void 0!==t.prototype&&e instanceof t||!Error.isPrototypeOf(t)&&!0===t.call({},e)}function P(e){if("function"!=typeof e)throw new c("fn","Function",e);try{e()}catch(e){return e}return x}function L(e){return g(e)||null!==e&&"object"===i(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function C(e){return Promise.resolve().then((function(){var t;if("function"==typeof e){if(!L(t=e()))throw new h("instance of Promise","promiseFn",t)}else{if(!L(e))throw new c("promiseFn",["Function","Promise"],e);t=e}return Promise.resolve().then((function(){return t})).then((function(){return x})).catch((function(e){return e}))}))}function I(e,t,n,r){if("string"==typeof n){if(4===arguments.length)throw new c("error",["Object","Error","Function","RegExp"],n);if("object"===i(t)&&null!==t){if(t.message===n)throw new l("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===n)throw new l("error/message",'The error "'.concat(t,'" is identical to the message.'));r=n,n=void 0}else if(null!=n&&"object"!==i(n)&&"function"!=typeof n)throw new c("error",["Object","Error","Function","RegExp"],n);if(t===x){var a="";n&&n.name&&(a+=" (".concat(n.name,")")),a+=r?": ".concat(r):".";var o="rejects"===e.name?"rejection":"exception";T({actual:void 0,expected:n,operator:e.name,message:"Missing expected ".concat(o).concat(a),stackStartFn:e})}if(n&&!k(t,n,r,e))throw t}function N(e,t,n,r){if(t!==x){if("string"==typeof n&&(r=n,n=void 0),!n||k(t,n)){var i=r?": ".concat(r):".",a="doesNotReject"===e.name?"rejection":"exception";T({actual:t,expected:n,operator:e.name,message:"Got unwanted ".concat(a).concat(i,"\n")+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}function F(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];A.apply(void 0,[F,t.length].concat(t))}w.throws=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];I.apply(void 0,[e,P(t)].concat(r))},w.rejects=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return C(t).then((function(t){return I.apply(void 0,[e,t].concat(r))}))},w.doesNotThrow=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];N.apply(void 0,[e,P(t)].concat(r))},w.doesNotReject=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return C(t).then((function(t){return N.apply(void 0,[e,t].concat(r))}))},w.ifError=function e(t){if(null!=t){var n="ifError got unwanted exception: ";"object"===i(t)&&"string"==typeof t.message?0===t.message.length&&t.constructor?n+=t.constructor.name:n+=t.message:n+=p(t);var r=new f({actual:t,expected:null,operator:"ifError",message:n,stackStartFn:e}),a=t.stack;if("string"==typeof a){var o=a.split("\n");o.shift();for(var s=r.stack.split("\n"),l=0;l<o.length;l++){var c=s.indexOf(o[l]);if(-1!==c){s=s.slice(0,c);break}}r.stack="".concat(s.join("\n"),"\n").concat(o.join("\n"))}throw r}},w.strict=y(F,w,{equal:w.strictEqual,deepEqual:w.deepStrictEqual,notEqual:w.notStrictEqual,notDeepEqual:w.notDeepStrictEqual}),w.strict.strict=w.strict},6979:(e,t,n)=>{"use strict";var r=n(2530);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?s(e):t}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,d(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),h(r,e)})(e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return(u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&h(i,n.prototype),i}).apply(null,arguments)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p=n(5663).inspect,m=n(8619).codes.ERR_INVALID_ARG_TYPE;function g(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}var v="",y="",_="",b="",E={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"};function w(e){var t=Object.keys(e),n=Object.create(Object.getPrototypeOf(e));return t.forEach((function(t){n[t]=e[t]})),Object.defineProperty(n,"message",{value:e.message}),n}function x(e){return p(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function T(e,t,n){var i="",a="",o=0,s="",l=!1,c=x(e),u=c.split("\n"),h=x(t).split("\n"),d=0,p="";if("strictEqual"===n&&"object"===f(e)&&"object"===f(t)&&null!==e&&null!==t&&(n="strictEqualObject"),1===u.length&&1===h.length&&u[0]!==h[0]){var m=u[0].length+h[0].length;if(m<=10){if(!("object"===f(e)&&null!==e||"object"===f(t)&&null!==t||0===e&&0===t))return"".concat(E[n],"\n\n")+"".concat(u[0]," !== ").concat(h[0],"\n")}else if("strictEqualObject"!==n){if(m<(r.stderr&&r.stderr.isTTY?r.stderr.columns:80)){for(;u[0][d]===h[0][d];)d++;d>2&&(p="\n  ".concat(function(e,t){if(t=Math.floor(t),0==e.length||0==t)return"";var n=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+e.substring(0,n-e.length)}(" ",d),"^"),d=0)}}}for(var w=u[u.length-1],T=h[h.length-1];w===T&&(d++<2?s="\n  ".concat(w).concat(s):i=w,u.pop(),h.pop(),0!==u.length&&0!==h.length);)w=u[u.length-1],T=h[h.length-1];var A=Math.max(u.length,h.length);if(0===A){var M=c.split("\n");if(M.length>30)for(M[26]="".concat(v,"...").concat(b);M.length>27;)M.pop();return"".concat(E.notIdentical,"\n\n").concat(M.join("\n"),"\n")}d>3&&(s="\n".concat(v,"...").concat(b).concat(s),l=!0),""!==i&&(s="\n  ".concat(i).concat(s),i="");var S=0,R=E[n]+"\n".concat(y,"+ actual").concat(b," ").concat(_,"- expected").concat(b),k=" ".concat(v,"...").concat(b," Lines skipped");for(d=0;d<A;d++){var P=d-o;if(u.length<d+1)P>1&&d>2&&(P>4?(a+="\n".concat(v,"...").concat(b),l=!0):P>3&&(a+="\n  ".concat(h[d-2]),S++),a+="\n  ".concat(h[d-1]),S++),o=d,i+="\n".concat(_,"-").concat(b," ").concat(h[d]),S++;else if(h.length<d+1)P>1&&d>2&&(P>4?(a+="\n".concat(v,"...").concat(b),l=!0):P>3&&(a+="\n  ".concat(u[d-2]),S++),a+="\n  ".concat(u[d-1]),S++),o=d,a+="\n".concat(y,"+").concat(b," ").concat(u[d]),S++;else{var L=h[d],C=u[d],I=C!==L&&(!g(C,",")||C.slice(0,-1)!==L);I&&g(L,",")&&L.slice(0,-1)===C&&(I=!1,C+=","),I?(P>1&&d>2&&(P>4?(a+="\n".concat(v,"...").concat(b),l=!0):P>3&&(a+="\n  ".concat(u[d-2]),S++),a+="\n  ".concat(u[d-1]),S++),o=d,a+="\n".concat(y,"+").concat(b," ").concat(C),i+="\n".concat(_,"-").concat(b," ").concat(L),S+=2):(a+=i,i="",1!==P&&0!==d||(a+="\n  ".concat(C),S++))}if(S>20&&d<A-2)return"".concat(R).concat(k,"\n").concat(a,"\n").concat(v,"...").concat(b).concat(i,"\n")+"".concat(v,"...").concat(b)}return"".concat(R).concat(l?k:"","\n").concat(a).concat(i).concat(s).concat(p)}var A=function(e){function t(e){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==f(e)||null===e)throw new m("options","Object",e);var i=e.message,a=e.operator,l=e.stackStartFn,c=e.actual,u=e.expected,h=Error.stackTraceLimit;if(Error.stackTraceLimit=0,null!=i)n=o(this,d(t).call(this,String(i)));else if(r.stderr&&r.stderr.isTTY&&(r.stderr&&r.stderr.getColorDepth&&1!==r.stderr.getColorDepth()?(v="[34m",y="[32m",b="[39m",_="[31m"):(v="",y="",b="",_="")),"object"===f(c)&&null!==c&&"object"===f(u)&&null!==u&&"stack"in c&&c instanceof Error&&"stack"in u&&u instanceof Error&&(c=w(c),u=w(u)),"deepStrictEqual"===a||"strictEqual"===a)n=o(this,d(t).call(this,T(c,u,a)));else if("notDeepStrictEqual"===a||"notStrictEqual"===a){var p=E[a],g=x(c).split("\n");if("notStrictEqual"===a&&"object"===f(c)&&null!==c&&(p=E.notStrictEqualObject),g.length>30)for(g[26]="".concat(v,"...").concat(b);g.length>27;)g.pop();n=1===g.length?o(this,d(t).call(this,"".concat(p," ").concat(g[0]))):o(this,d(t).call(this,"".concat(p,"\n\n").concat(g.join("\n"),"\n")))}else{var A=x(c),M="",S=E[a];"notDeepEqual"===a||"notEqual"===a?(A="".concat(E[a],"\n\n").concat(A)).length>1024&&(A="".concat(A.slice(0,1021),"...")):(M="".concat(x(u)),A.length>512&&(A="".concat(A.slice(0,509),"...")),M.length>512&&(M="".concat(M.slice(0,509),"...")),"deepEqual"===a||"equal"===a?A="".concat(S,"\n\n").concat(A,"\n\nshould equal\n\n"):M=" ".concat(a," ").concat(M)),n=o(this,d(t).call(this,"".concat(A).concat(M)))}return Error.stackTraceLimit=h,n.generatedMessage=!i,Object.defineProperty(s(n),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),n.code="ERR_ASSERTION",n.actual=c,n.expected=u,n.operator=a,Error.captureStackTrace&&Error.captureStackTrace(s(n),l),n.stack,n.name="AssertionError",o(n)}var n,l,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,e),n=t,(l=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:p.custom,value:function(e,t){return p(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({},t,{customInspect:!1,depth:0}))}}])&&a(n.prototype,l),c&&a(n,c),t}(l(Error));e.exports=A},8619:(e,t,n)=>{"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s,l,c={};function u(e,t,n){n||(n=Error);var r=function(n){function r(n,o,s){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(l=i(this,a(r).call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,o,s)))).code=e,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(r,n),r}(n);c[e]=r}function h(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}u("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),u("ERR_INVALID_ARG_TYPE",(function(e,t,i){var a,o,l,c;if(void 0===s&&(s=n(6118)),s("string"==typeof e,"'name' must be a string"),"string"==typeof t&&(o="not ",t.substr(!l||l<0?0:+l,o.length)===o)?(a="must not be",t=t.replace(/^not /,"")):a="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))c="The ".concat(e," ").concat(a," ").concat(h(t,"type"));else{var u=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";c='The "'.concat(e,'" ').concat(u," ").concat(a," ").concat(h(t,"type"))}return c+=". Received type ".concat(r(i))}),TypeError),u("ERR_INVALID_ARG_VALUE",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid";void 0===l&&(l=n(5663));var i=l.inspect(t);return i.length>128&&(i="".concat(i.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(r,". Received ").concat(i)}),TypeError,RangeError),u("ERR_INVALID_RETURN_VALUE",(function(e,t,n){var i;return i=n&&n.constructor&&n.constructor.name?"instance of ".concat(n.constructor.name):"type ".concat(r(n)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(i,".")}),TypeError),u("ERR_MISSING_ARGS",(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];void 0===s&&(s=n(6118)),s(t.length>0,"At least one arg needs to be specified");var i="The ",a=t.length;switch(t=t.map((function(e){return'"'.concat(e,'"')})),a){case 1:i+="".concat(t[0]," argument");break;case 2:i+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:i+=t.slice(0,a-1).join(", "),i+=", and ".concat(t[a-1]," arguments")}return"".concat(i," must be specified")}),TypeError),e.exports.codes=c},1667:(e,t,n)=>{"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=void 0!==/a/g.flags,o=function(e){var t=[];return e.forEach((function(e){return t.push(e)})),t},s=function(e){var t=[];return e.forEach((function(e,n){return t.push([n,e])})),t},l=Object.is?Object.is:n(7402),c=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},u=Number.isNaN?Number.isNaN:n(8622);function h(e){return e.call.bind(e)}var d=h(Object.prototype.hasOwnProperty),f=h(Object.prototype.propertyIsEnumerable),p=h(Object.prototype.toString),m=n(5663).types,g=m.isAnyArrayBuffer,v=m.isArrayBufferView,y=m.isDate,_=m.isMap,b=m.isRegExp,E=m.isSet,w=m.isNativeError,x=m.isBoxedPrimitive,T=m.isNumberObject,A=m.isStringObject,M=m.isBooleanObject,S=m.isBigIntObject,R=m.isSymbolObject,k=m.isFloat32Array,P=m.isFloat64Array;function L(e){if(0===e.length||e.length>10)return!0;for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n<48||n>57)return!0}return 10===e.length&&e>=Math.pow(2,32)}function C(e){return Object.keys(e).filter(L).concat(c(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}function I(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function N(e,t,n,r){if(e===t)return 0!==e||(!n||l(e,t));if(n){if("object"!==i(e))return"number"==typeof e&&u(e)&&u(t);if("object"!==i(t)||null===e||null===t)return!1;if(Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{if(null===e||"object"!==i(e))return(null===t||"object"!==i(t))&&e==t;if(null===t||"object"!==i(t))return!1}var o,s,c,h,d=p(e);if(d!==p(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var f=C(e),m=C(t);return f.length===m.length&&O(e,t,n,r,1,f)}if("[object Object]"===d&&(!_(e)&&_(t)||!E(e)&&E(t)))return!1;if(y(e)){if(!y(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if(b(e)){if(!b(t)||(c=e,h=t,!(a?c.source===h.source&&c.flags===h.flags:RegExp.prototype.toString.call(c)===RegExp.prototype.toString.call(h))))return!1}else if(w(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else{if(v(e)){if(n||!k(e)&&!P(e)){if(!function(e,t){return e.byteLength===t.byteLength&&0===I(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}(e,t))return!1}else if(!function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}(e,t))return!1;var L=C(e),N=C(t);return L.length===N.length&&O(e,t,n,r,0,L)}if(E(e))return!(!E(t)||e.size!==t.size)&&O(e,t,n,r,2);if(_(e))return!(!_(t)||e.size!==t.size)&&O(e,t,n,r,3);if(g(e)){if(s=t,(o=e).byteLength!==s.byteLength||0!==I(new Uint8Array(o),new Uint8Array(s)))return!1}else if(x(e)&&!function(e,t){return T(e)?T(t)&&l(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):A(e)?A(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):M(e)?M(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):S(e)?S(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):R(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)}(e,t))return!1}return O(e,t,n,r,0)}function F(e,t){return t.filter((function(t){return f(e,t)}))}function O(e,t,n,r,i,a){if(5===arguments.length){a=Object.keys(e);var o=Object.keys(t);if(a.length!==o.length)return!1}for(var s=0;s<a.length;s++)if(!d(t,a[s]))return!1;if(n&&5===arguments.length){var l=c(e);if(0!==l.length){var u=0;for(s=0;s<l.length;s++){var h=l[s];if(f(e,h)){if(!f(t,h))return!1;a.push(h),u++}else if(f(t,h))return!1}var p=c(t);if(l.length!==p.length&&F(t,p).length!==u)return!1}else{var m=c(t);if(0!==m.length&&0!==F(t,m).length)return!1}}if(0===a.length&&(0===i||1===i&&0===e.length||0===e.size))return!0;if(void 0===r)r={val1:new Map,val2:new Map,position:0};else{var g=r.val1.get(e);if(void 0!==g){var v=r.val2.get(t);if(void 0!==v)return g===v}r.position++}r.val1.set(e,r.position),r.val2.set(t,r.position);var y=V(e,t,n,a,r,i);return r.val1.delete(e),r.val2.delete(t),y}function H(e,t,n,r){for(var i=o(e),a=0;a<i.length;a++){var s=i[a];if(N(t,s,n,r))return e.delete(s),!0}return!1}function D(e){switch(i(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(u(e))return!1}return!0}function U(e,t,n){var r=D(n);return null!=r?r:t.has(r)&&!e.has(r)}function B(e,t,n,r,i){var a=D(n);if(null!=a)return a;var o=t.get(a);return!(void 0===o&&!t.has(a)||!N(r,o,!1,i))&&(!e.has(a)&&N(r,o,!1,i))}function z(e,t,n,r,i,a){for(var s=o(e),l=0;l<s.length;l++){var c=s[l];if(N(n,c,i,a)&&N(r,t.get(c),i,a))return e.delete(c),!0}return!1}function V(e,t,n,a,l,c){var u=0;if(2===c){if(!function(e,t,n,r){for(var a=null,s=o(e),l=0;l<s.length;l++){var c=s[l];if("object"===i(c)&&null!==c)null===a&&(a=new Set),a.add(c);else if(!t.has(c)){if(n)return!1;if(!U(e,t,c))return!1;null===a&&(a=new Set),a.add(c)}}if(null!==a){for(var u=o(t),h=0;h<u.length;h++){var d=u[h];if("object"===i(d)&&null!==d){if(!H(a,d,n,r))return!1}else if(!n&&!e.has(d)&&!H(a,d,n,r))return!1}return 0===a.size}return!0}(e,t,n,l))return!1}else if(3===c){if(!function(e,t,n,a){for(var o=null,l=s(e),c=0;c<l.length;c++){var u=r(l[c],2),h=u[0],d=u[1];if("object"===i(h)&&null!==h)null===o&&(o=new Set),o.add(h);else{var f=t.get(h);if(void 0===f&&!t.has(h)||!N(d,f,n,a)){if(n)return!1;if(!B(e,t,h,d,a))return!1;null===o&&(o=new Set),o.add(h)}}}if(null!==o){for(var p=s(t),m=0;m<p.length;m++){var g=r(p[m],2),v=(h=g[0],g[1]);if("object"===i(h)&&null!==h){if(!z(o,e,h,v,n,a))return!1}else if(!(n||e.has(h)&&N(e.get(h),v,!1,a)||z(o,e,h,v,!1,a)))return!1}return 0===o.size}return!0}(e,t,n,l))return!1}else if(1===c)for(;u<e.length;u++){if(!d(e,u)){if(d(t,u))return!1;for(var h=Object.keys(e);u<h.length;u++){var f=h[u];if(!d(t,f)||!N(e[f],t[f],n,l))return!1}return h.length===Object.keys(t).length}if(!d(t,u)||!N(e[u],t[u],n,l))return!1}for(u=0;u<a.length;u++){var p=a[u];if(!N(e[p],t[p],n,l))return!1}return!0}e.exports={isDeepEqual:function(e,t){return N(e,t,false)},isDeepStrictEqual:function(e,t){return N(e,t,true)}}},8455:(e,t,n)=>{"use strict";var r=n(9854);e.exports=function(){return r(["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],(function(e){return"function"==typeof n.g[e]}))}},7615:(e,t,n)=>{"use strict";var r=n(1801),i=n(2550),a=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&a(e,".prototype.")>-1?i(n):n}},2550:(e,t,n)=>{"use strict";var r=n(1930),i=n(1801),a=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||r.call(o,a),l=i("%Object.defineProperty%",!0);if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(){return s(r,o,arguments)};var c=function(){return s(r,a,arguments)};l?l(e.exports,"apply",{value:c}):e.exports.apply=c},9170:(e,t,n)=>{"use strict";var r=n(806),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),a=Object.prototype.toString,o=Array.prototype.concat,s=Object.defineProperty,l=s&&function(){var e={};try{for(var t in s(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),c=function(e,t,n,r){var i;(!(t in e)||"function"==typeof(i=r)&&"[object Function]"===a.call(i)&&r())&&(l?s(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},u=function(e,t){var n=arguments.length>2?arguments[2]:{},a=r(t);i&&(a=o.call(a,Object.getOwnPropertySymbols(t)));for(var s=0;s<a.length;s+=1)c(e,a[s],t[a[s]],n[a[s]])};u.supportsDescriptors=!!l,e.exports=u},5952:function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=79)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){var r=n(73),i=n(72),a=n(39);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(u(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var a,o=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(c(e,a+d)!==c(t,d)){h=!1;break}if(h)return a}return-1}function y(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function _(e,t,n,r){return V(B(t,e.length-n),e,n,r)}function b(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return b(e,t,n,r)}function w(e,t,n,r){return V(z(t),e,n,r)}function x(e,t,n,r){return V(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,l,c=e[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=h}return function(e){var t=e.length;if(t<=M)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=M));return n}(r)}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return c(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,r){return u(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return S(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),u=e.slice(t,n),h=0;h<s;++h)if(c[h]!==u[h]){a=c[h],o=u[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var M=4096;function S(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=U(e[a]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function L(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,n,r,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function I(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function N(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function F(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,n,r,a){return a||F(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function H(e,t,n,r,a){return a||F(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;n=new l(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||C(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||C(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);C(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);C(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return H(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return H(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=l.isBuffer(e)?e:B(new l(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var D=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function z(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(0))},function(e,t,n){"use strict";var r=n(10),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=h;var a=n(6);a.inherits=n(5);var o=n(36),s=n(19);a.inherits(h,o);for(var l=i(s.prototype),c=0;c<l.length;c++){var u=l[c];h.prototype[u]||(h.prototype[u]=s.prototype[u])}function h(e){if(!(this instanceof h))return new h(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&f())}function f(){if(!u){var e=s(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*e.readUint16()*256+e.readUint16()).toString(16)).substr(-8)}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(14);function a(e,t){return void 0!==e.parser?e.parser:t}var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=r}return r(e,[{key:"uint16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint16(this.byteArray,n.dataOffset+2*t)}},{key:"int16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt16(this.byteArray,n.dataOffset+2*t)}},{key:"uint32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint32(this.byteArray,n.dataOffset+4*t)}},{key:"int32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt32(this.byteArray,n.dataOffset+4*t)}},{key:"float",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readFloat(this.byteArray,n.dataOffset+4*t)}},{key:"double",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readDouble(this.byteArray,n.dataOffset+8*t)}},{key:"numStringValues",value:function(e){var t=this.elements[e];if(t&&t.length>0){var n=(0,i.readFixedString)(this.byteArray,t.dataOffset,t.length).match(/\\/g);return null===n?1:n.length+1}}},{key:"string",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].trim():r.trim()}}},{key:"text",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].replace(/ +$/,""):r.replace(/ +$/,"")}}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return parseFloat(r)}}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return parseInt(r)}}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var n=a(t,this.byteArrayParser).readUint16,r=this.byteArray,i=t.dataOffset;return"x"+("00000000"+(256*n(r,i)*256+n(r,i+2)).toString(16)).substr(-8)}}}]),e}();t.default=o},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t,n){var r=n(1),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),a(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}}:e.exports=t}).call(this,n(3))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n,r){if(void 0!==e&&t instanceof e)return t.slice(n,n+r);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+n,r);throw"dicomParser.from: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(r=n(11))&&r.__esModule?r:{default:r},o=n(14),s=function(){function t(n,r,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(r instanceof Uint8Array==0&&r instanceof e==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=r.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=n,this.byteArray=r,this.position=i||0,this.warnings=[]}return i(t,[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=(0,a.default)(this.byteArray,this.position,e);return this.position+=e,new t(this.byteArrayParser,n)}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=(0,o.readFixedString)(this.byteArray,this.position,e);return this.position+=e,t}}]),t}();t.default=s}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:(0,i.default)(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return t};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFixedString=function(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r,i="",a=0;a<n;a++){if(0===(r=e[t+a]))return t+=n,i;i+=String.fromCharCode(r)}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var l={tag:(0,a.default)(e),vr:e.readFixedString(2)};return 2===c(l.vr)?(l.length=e.readUint16(),l.dataOffset=e.position):(e.seek(2),l.length=e.readUint32(),l.dataOffset=e.position),4294967295===l.length&&(l.hadUndefinedLength=!0),l.tag===n?l:"SQ"===l.vr?((0,s.default)(e,l,t),l):4294967295===l.length?"x7fe00010"===l.tag?((0,r.default)(e,l,t),l):"UN"===l.vr?((0,i.default)(e,l),l):((0,o.default)(e,l),l):(e.seek(l.length),l)};var r=l(n(42)),i=(l(n(41)),l(n(26))),a=l(n(4)),o=l(n(24)),s=l(n(40));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDicomDataSetExplicit=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?t.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var a=e.elements;t.position<n;){var o=(0,r.default)(t,e.warnings,i.untilTag);if(a[o.tag]=o,o.tag===i.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?e.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;t.position<n;){var o=(0,i.default)(t,r.untilTag,r.vrCallback);if(a[o.tag]=o,o.tag===r.untilTag)return}};var r=a(n(15)),i=a(n(25));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};t.isStringVr=function(e){return r[e]},t.isPrivateTag=function(e){return parseInt(e[4],10)%2==1},t.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,s,c){if(s=s||1,c=c||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===s)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(s<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+s>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var u=new i.default(e.byteArrayParser,e.byteArray,t.dataOffset),h=(0,a.default)(u);if("xfffee000"!==h.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";u.seek(h.length);var d=u.position;if(1===s)return(0,o.default)(u.byteArray,d+c[n].offset+8,c[n].length);for(var f=l(c,n,s),p=(0,r.default)(u.byteArray,f),m=0,g=n;g<n+s;g++)for(var v=d+c[g].offset+8,y=0;y<c[g].length;y++)p[m++]=u.byteArray[v++];return p};var r=s(n(23)),i=s(n(12)),a=s(n(13)),o=s(n(11));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n){for(var r=0,i=t;i<t+n;i++)r+=e[i].length;return r}},function(e,t,n){"use strict";(function(t,r,i){var a=n(10);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:a.nextTick;y.WritableState=v;var c=n(6);c.inherits=n(5);var u,h={deprecate:n(61)},d=n(35),f=n(9).Buffer,p=i.Uint8Array||function(){},m=n(34);function g(){}function v(e,t){s=s||n(2),e=e||{};var r=t instanceof s;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,c=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===e.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(a.nextTick(i,r),a.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),T(e,t))}(e,n,r,t,i);else{var o=w(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||E(e,n),r?l(b,e,n,o,i):b(e,n,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function y(e){if(s=s||n(2),!(u.call(y,this)||this instanceof s))return new y(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function _(e,t,n,r,i,a,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function b(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),T(e,t)}function E(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var s=0,l=!0;n;)i[s]=n,n.isBuf||(l=!1),n=n.next,s+=1;i.allBuffers=l,_(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,h=n.callback;if(_(e,t,!1,t.objectMode?1:c.length,c,u,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var n=w(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(x,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}c.inherits(y,d),v.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(v.prototype,"buffer",{get:h.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===y&&e&&e._writableState instanceof v}})):u=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var r,i=this._writableState,o=!1,s=!i.objectMode&&(r=e,f.isBuffer(r)||r instanceof p);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=g),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),a.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(r,o),i=!1),i}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,i,a){if(!n){var o=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n)),t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,s,r,i,a);return l}(this,i,s,e,t,n)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||E(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,T(e,t),n&&(t.finished?a.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(3),n(63).setImmediate,n(0))},function(e,t,n){(t=e.exports=n(36)).Stream=t,t.Readable=t,t.Writable=n(19),t.Duplex=n(2),t.Transform=n(32),t.PassThrough=n(60)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),o=(c=n.slice()).length,l=0;l<o;l++)c[l].apply(this,s);return!0},n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,a,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=s;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n){if(void 0!==e&&t instanceof e)return e.alloc(n);if(t instanceof Uint8Array)return new Uint8Array(n);throw"dicomParser.alloc: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var s={tag:(0,a.default)(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===s.length&&(s.hadUndefinedLength=!0),s.tag===t?s:l(s,e,n)&&!(0,o.isPrivateTag)(s.tag)?((0,i.default)(e,s),s):s.hadUndefinedLength?((0,r.default)(e,s),s):(e.seek(s.length),s)};var r=s(n(24)),i=s(n(26)),a=s(n(4)),o=n(17);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n){if(void 0!==n)return"SQ"===n(e.tag);if(t.position+4<=t.byteArray.length){var r=(0,a.default)(t);return t.seek(-4),"xfffee000"===r||"xfffee0dd"===r}return t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=c(e,n);t.items.push(i)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=c(e,n);t.items.push(i)}}(e,t,n)};var r=l(n(7)),i=l(n(25)),a=l(n(13)),o=l(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,void 0,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetImplicit(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,s){if(r=r||t.basicOffsetTable,s=s||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===r.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=r.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=r[n],c=a(s,l);if(void 0===c)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var u=o(n,r,s,c);return(0,i.default)(e,t,c,u,s)};var r,i=(r=n(18))&&r.__esModule?r:{default:r},a=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},o=function(e,t,n,r){if(e===t.length-1)return n.length-r;for(var i=t[e+1],a=r+1;a<n.length;a++)if(n[a].offset===i)return a-r;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){(function(e,r){var i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<a;l=r[++n])m(l)||!b(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(n,i){if(y(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var a=!1;return function(){if(!a){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),a=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function u(e,n,r){if(e.customInspect&&n&&x(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=u(e,i,r)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),w(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(n);if(0===o.length){if(x(n)){var l=n.name?": "+n.name:"";return e.stylize("[Function"+l+"]","special")}if(_(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return e.stylize(Date.prototype.toString.call(n),"date");if(w(n))return h(n)}var c,b="",T=!1,A=["{","}"];return f(n)&&(T=!0,A=["[","]"]),x(n)&&(b=" [Function"+(n.name?": "+n.name:"")+"]"),_(n)&&(b=" "+RegExp.prototype.toString.call(n)),E(n)&&(b=" "+Date.prototype.toUTCString.call(n)),w(n)&&(b=" "+h(n)),0!==o.length||T&&0!=n.length?r<0?_(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=T?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)S(t,String(o))?a.push(d(e,t,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(d(e,t,n,r,i,!0))})),a}(e,n,r,s,o):o.map((function(t){return d(e,n,r,s,t,T)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(c,b,A)):A[0]+b+A[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),S(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===T(e)}function b(e){return"object"==typeof e&&null!==e}function E(e){return b(e)&&"[object Date]"===T(e)}function w(e){return b(e)&&("[object Error]"===T(e)||e instanceof Error)}function x(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function A(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(a)&&(a=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var n=r.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=_,t.isObject=b,t.isDate=E,t.isError=w,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(54);var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(n=[A((e=new Date).getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":"),[e.getDate(),M[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(53),t._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,n(0),n(3))},function(e,t,n){"use strict";(function(t){function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=n(30),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l="foo"===function(){}.name;function c(e){return Object.prototype.toString.call(e)}function u(e){return!i(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var h=e.exports=v,d=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(a.isFunction(e)){if(l)return e.name;var t=e.toString().match(d);return t&&t[1]}}function p(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(l||!a.isFunction(e))return a.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,n,r,i){throw new h.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function v(e,t){e||g(e,!0,t,"==",h.ok)}function y(e,t,n,o){if(e===t)return!0;if(i(e)&&i(t))return 0===r(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(u(e)&&u(t)&&c(e)===c(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var l=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return-1!==l&&l===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=_(e),o=_(t);if(i&&!o||!i&&o)return!1;if(i)return y(e=s.call(e),t=s.call(t),n);var l,c,u=w(e),h=w(t);if(u.length!==h.length)return!1;for(u.sort(),h.sort(),c=u.length-1;c>=0;c--)if(u[c]!==h[c])return!1;for(c=u.length-1;c>=0;c--)if(!y(e[l=u[c]],t[l],n,r))return!1;return!0}(e,t,n,o))}return n?e===t:e==t}function _(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function b(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function E(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&g(i,n,"Missing expected exception"+r);var o="string"==typeof r,s=!e&&i&&!n;if((!e&&a.isError(i)&&o&&b(i,n)||s)&&g(i,n,"Got unwanted exception"+r),e&&i&&n&&!b(i,n)||!e&&i)throw i}h.AssertionError=function(e){var t;this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(m((t=this).actual),128)+" "+t.operator+" "+p(m(t.expected),128),this.generatedMessage=!0);var n=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,n);else{var r=new Error;if(r.stack){var i=r.stack,a=f(n),o=i.indexOf("\n"+a);if(o>=0){var s=i.indexOf("\n",o+1);i=i.substring(s+1)}this.stack=i}}},a.inherits(h.AssertionError,Error),h.fail=g,h.ok=v,h.equal=function(e,t,n){e!=t&&g(e,t,n,"==",h.equal)},h.notEqual=function(e,t,n){e==t&&g(e,t,n,"!=",h.notEqual)},h.deepEqual=function(e,t,n){y(e,t,!1)||g(e,t,n,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(e,t,n){y(e,t,!0)||g(e,t,n,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(e,t,n){y(e,t,!1)&&g(e,t,n,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function e(t,n,r){y(t,n,!0)&&g(t,n,r,"notDeepStrictEqual",e)},h.strictEqual=function(e,t,n){e!==t&&g(e,t,n,"===",h.strictEqual)},h.notStrictEqual=function(e,t,n){e===t&&g(e,t,n,"!==",h.notStrictEqual)},h.throws=function(e,t,n){E(!0,e,t,n)},h.doesNotThrow=function(e,t,n){E(!1,e,t,n)},h.ifError=function(e){if(e)throw e};var w=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}}).call(this,n(0))},function(e,t,n){"use strict";e.exports=a;var r=n(2),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){s(e,t,n)})):s(this,null,null)}function s(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(5),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";var r=n(9).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=h,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�".repeat(n);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�".repeat(n+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�".repeat(n+2)}}(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�".repeat(this.lastTotal-this.lastNeed):t},a.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";var r=n(10);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,a=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return a||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){e.exports=n(21).EventEmitter},function(e,t,n){"use strict";(function(t,r){var i=n(10);e.exports=_;var a,o=n(39);_.ReadableState=y,n(21).EventEmitter;var s=function(e,t){return e.listeners(t).length},l=n(35),c=n(9).Buffer,u=t.Uint8Array||function(){},h=n(6);h.inherits=n(5);var d=n(66),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,m=n(65),g=n(34);h.inherits(_,l);var v=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var r=t instanceof(a=a||n(2));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(33).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function _(e){if(a=a||n(2),!(this instanceof _))return new _(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function b(e,t,n,r,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,T(e)}}(e,o)):(i||(a=function(e,t){var n,r;return r=t,c.isBuffer(r)||r instanceof u||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):E(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?E(e,o,t,!1):M(e,o)):E(e,o,t,!1))):r||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function E(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&T(e)),M(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=g.destroy,_.prototype._undestroy=g.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),b(this,e,t,!1,n)},_.prototype.unshift=function(e){return b(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return p||(p=n(33).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var w=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=w?e=w:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(A,e):A(e))}function A(e){f("emit readable"),e.emit("readable"),P(e)}function M(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(S,e,t))}function S(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function R(e){f("readable nexttick read 0"),e.read(0)}function k(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),P(e),t.flowing&&!t.reading&&e.read(0)}function P(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(o===a.length?i+=a:i+=a.slice(0,e),0==(e-=o)){o===a.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=c.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,o),0==(e-=o)){o===a.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function C(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function N(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?C(this):T(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&C(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(n,t))),null===(r=e>0?L(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&C(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var l=t&&!1===t.end||e===r.stdout||e===r.stderr?_:u;function c(t,r){f("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,f("cleanup"),e.removeListener("close",v),e.removeListener("finish",y),e.removeListener("drain",h),e.removeListener("error",g),e.removeListener("unpipe",c),n.removeListener("end",u),n.removeListener("end",_),n.removeListener("data",m),d=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function u(){f("onend"),e.end()}a.endEmitted?i.nextTick(l):n.once("end",l),e.on("unpipe",c);var h=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,P(e))}}(n);e.on("drain",h);var d=!1,p=!1;function m(t){f("ondata"),p=!1,!1!==e.write(t)||p||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==N(a.pipes,e))&&!d&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function g(t){f("onerror",t),_(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function v(){e.removeListener("finish",y),_()}function y(){f("onfinish"),e.removeListener("close",v),_()}function _(){f("unpipe"),n.unpipe(e)}return n.on("data",m),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",v),e.once("finish",y),e.emit("pipe",n),a.flowing||(f("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var o=N(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},_.prototype.on=function(e,t){var n=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&T(this):i.nextTick(R,this))}return n},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(k,e,t))}(this,e)),this},_.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!=i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<v.length;a++)e.on(v[a],this.emit.bind(this,v[a]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},_._fromList=L}).call(this,n(0),n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=new r.default(a.default,e);return function(){!function(){if(n.seek(128),"DICM"!==n.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var e=[],t={};n.position<n.byteArray.length;){var r=n.position,s=(0,o.default)(n,e);if(s.tag>"x0002ffff"){n.position=r;break}s.parser=a.default,t[s.tag]=s}var l=new i.default(n.byteArrayParser,n.byteArray,t);return l.warnings=n.warnings,l.position=n.position,l}()};var r=s(n(12)),i=s(n(7)),a=s(n(22)),o=s(n(15));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=c(e,n);t.items.push(i)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=c(e,n);t.items.push(i)}}(e,t,n)};var r=l(n(7)),i=l(n(15)),a=l(n(13)),o=l(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetExplicit(n.dataSet,e,e.position+n.length)),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==(0,i.default)(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=e.readUint32()/4,a=0;a<r;a++){var o=e.readUint32();t.basicOffsetTable.push(o)}for(var s=e.position;e.position<e.byteArray.length;){var l=(0,i.default)(e),c=e.readUint32();if("xfffee0dd"===l)return e.seek(c),void(t.length=e.position-t.dataOffset);if("xfffee000"!==l)return n&&n.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),c>e.byteArray.length-e.position&&(c=e.byteArray.length-e.position),t.fragments.push({offset:e.position-s-8,position:e.position,length:c}),e.seek(c),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-s-8,position:e.position,length:c}),e.seek(c)}n&&n.push("pixel data element "+t.tag+" missing sequence delimiter tag xfffee0dd")};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,i=t.vr,a=t.tag;function o(t,n){for(var r="",i=0;i<t;i++)0!==i&&(r+="/"),r+=n.call(e,a,i).toString();return r}if(!0===r.isStringVr(i))n=e.string(a);else{if("AT"===i){var s=e.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"===i?n=o(t.length/2,e.uint16):"SS"===i?n=o(t.length/2,e.int16):"UL"===i?n=o(t.length/4,e.uint32):"SL"===i?n=o(t.length/4,e.int32):"FD"===i?n=o(t.length/8,e.double):"FL"===i&&(n=o(t.length/4,e.float))}return n};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(o||(o=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?(0,r.default)(e,t,n):(0,i.default)(e,t,0,t.fragments.length)};var r=a(n(27)),i=a(n(18));function a(e){return e&&e.__esModule?e:{default:e}}var o=!1},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var r=n(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,c,u,h,d){var f,p,m,g,v,y,_,b,E,w=d.bits,x=0,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=null,N=0,F=new r.Buf16(16),O=new r.Buf16(16),H=null,D=0;for(x=0;x<=15;x++)F[x]=0;for(T=0;T<l;T++)F[t[n+T]]++;for(S=w,M=15;M>=1&&0===F[M];M--);if(S>M&&(S=M),0===M)return c[u++]=20971520,c[u++]=20971520,d.bits=1,0;for(A=1;A<M&&0===F[A];A++);for(S<A&&(S=A),P=1,x=1;x<=15;x++)if(P<<=1,(P-=F[x])<0)return-1;if(P>0&&(0===e||1!==M))return-1;for(O[1]=0,x=1;x<15;x++)O[x+1]=O[x]+F[x];for(T=0;T<l;T++)0!==t[n+T]&&(h[O[t[n+T]]++]=T);if(0===e?(I=H=h,y=19):1===e?(I=i,N-=257,H=a,D-=257,y=256):(I=o,H=s,y=-1),C=0,T=0,x=A,v=u,R=S,k=0,m=-1,g=(L=1<<S)-1,1===e&&L>852||2===e&&L>592)return 1;for(;;){_=x-k,h[T]<y?(b=0,E=h[T]):h[T]>y?(b=H[D+h[T]],E=I[N+h[T]]):(b=96,E=0),f=1<<x-k,A=p=1<<R;do{c[v+(C>>k)+(p-=f)]=_<<24|b<<16|E|0}while(0!==p);for(f=1<<x-1;C&f;)f>>=1;if(0!==f?(C&=f-1,C+=f):C=0,T++,0==--F[x]){if(x===M)break;x=t[n+h[T]]}if(x>S&&(C&g)!==m){for(0===k&&(k=S),v+=A,P=1<<(R=x-k);R+k<M&&!((P-=F[R+k])<=0);)R++,P<<=1;if(L+=1<<R,1===e&&L>852||2===e&&L>592)return 1;c[m=C&g]=S<<24|R<<16|v-u|0}}return 0!==C&&(c[v+C]=x-k<<24|64<<16|0),d.bits=S,0}},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v,y,_,b,E,w,x,T,A,M;n=e.state,r=e.next_in,A=e.input,i=r+(e.avail_in-5),a=e.next_out,M=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=A[r++]<<p,p+=8,f+=A[r++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=b=_>>>24,p-=b,0==(b=_>>>16&255))M[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}E=65535&_,(b&=15)&&(p<b&&(f+=A[r++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=A[r++]<<p,p+=8,f+=A[r++]<<p,p+=8),_=g[f&y];n:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=A[r++]<<p,(p+=8)<b&&(f+=A[r++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(x=0,T=d,0===h){if(x+=c-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}else if(h<b){if(x+=c+h-b,(b-=h)<E){E-=b;do{M[a++]=d[x++]}while(--b);if(x=0,h<E){E-=b=h;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}}else if(x+=h-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}for(;E>2;)M[a++]=T[x++],M[a++]=T[x++],M[a++]=T[x++],E-=3;E&&(M[a++]=T[x++],E>1&&(M[a++]=T[x++]))}else{x=a-w;do{M[a++]=M[x++],M[a++]=M[x++],M[a++]=M[x++],E-=3}while(E>2);E&&(M[a++]=M[x++],E>1&&(M[a++]=M[x++]))}break}}break}}while(r<i&&a<s);r-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(8),i=n(29),a=n(28),o=n(47),s=n(46),l=0,c=1,u=2,h=4,d=5,f=6,p=0,m=1,g=2,v=-2,y=-3,_=-4,b=-5,E=8,w=1,x=2,T=3,A=4,M=5,S=6,R=7,k=8,P=9,L=10,C=11,I=12,N=13,F=14,O=15,H=16,D=17,U=18,B=19,z=20,V=21,j=22,G=23,W=24,q=25,X=26,Y=27,K=28,Z=29,Q=30,J=31,$=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,p):v}function ae(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ie(e)):v}function oe(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?v:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,ae(e))):v}function se(e,t){var n,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,(n=oe(e,t))!==p&&(e.state=null),n):v}var le,ce,ue=!0;function he(e){if(ue){var t;for(le=new r.Buf32(512),ce=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(c,e.lens,0,288,le,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,ce,0,e.work,{bits:5}),ue=!1}e.lencode=le,e.lenbits=9,e.distcode=ce,e.distbits=5}function de(e,t,n,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),r.arraySet(o.window,t,n-i,a,o.wnext),(i-=a)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=ae,t.inflateReset2=oe,t.inflateResetKeep=ie,t.inflateInit=function(e){return se(e,ne)},t.inflateInit2=se,t.inflate=function(e,t){var n,ee,te,ne,ie,ae,oe,se,le,ce,ue,fe,pe,me,ge,ve,ye,_e,be,Ee,we,xe,Te,Ae,Me=0,Se=new r.Buf8(4),Re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return v;(n=e.state).mode===I&&(n.mode=N),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,ae=e.avail_in,se=n.hold,le=n.bits,ce=ae,ue=oe,xe=p;e:for(;;)switch(n.mode){case w:if(0===n.wrap){n.mode=N;break}for(;le<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(2&n.wrap&&35615===se){n.check=0,Se[0]=255&se,Se[1]=se>>>8&255,n.check=a(n.check,Se,2,0),se=0,le=0,n.mode=x;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",n.mode=Q;break}if((15&se)!==E){e.msg="unknown compression method",n.mode=Q;break}if(le-=4,we=8+(15&(se>>>=4)),0===n.wbits)n.wbits=we;else if(we>n.wbits){e.msg="invalid window size",n.mode=Q;break}n.dmax=1<<we,e.adler=n.check=1,n.mode=512&se?L:I,se=0,le=0;break;case x:for(;le<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(n.flags=se,(255&n.flags)!==E){e.msg="unknown compression method",n.mode=Q;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Q;break}n.head&&(n.head.text=se>>8&1),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,n.check=a(n.check,Se,2,0)),se=0,le=0,n.mode=T;case T:for(;le<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}n.head&&(n.head.time=se),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,Se[2]=se>>>16&255,Se[3]=se>>>24&255,n.check=a(n.check,Se,4,0)),se=0,le=0,n.mode=A;case A:for(;le<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}n.head&&(n.head.xflags=255&se,n.head.os=se>>8),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,n.check=a(n.check,Se,2,0)),se=0,le=0,n.mode=M;case M:if(1024&n.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}n.length=se,n.head&&(n.head.extra_len=se),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,n.check=a(n.check,Se,2,0)),se=0,le=0}else n.head&&(n.head.extra=null);n.mode=S;case S:if(1024&n.flags&&((fe=n.length)>ae&&(fe=ae),fe&&(n.head&&(we=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,fe,we)),512&n.flags&&(n.check=a(n.check,ee,fe,ne)),ae-=fe,ne+=fe,n.length-=fe),n.length))break e;n.length=0,n.mode=R;case R:if(2048&n.flags){if(0===ae)break e;fe=0;do{we=ee[ne+fe++],n.head&&we&&n.length<65536&&(n.head.name+=String.fromCharCode(we))}while(we&&fe<ae);if(512&n.flags&&(n.check=a(n.check,ee,fe,ne)),ae-=fe,ne+=fe,we)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=k;case k:if(4096&n.flags){if(0===ae)break e;fe=0;do{we=ee[ne+fe++],n.head&&we&&n.length<65536&&(n.head.comment+=String.fromCharCode(we))}while(we&&fe<ae);if(512&n.flags&&(n.check=a(n.check,ee,fe,ne)),ae-=fe,ne+=fe,we)break e}else n.head&&(n.head.comment=null);n.mode=P;case P:if(512&n.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(se!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Q;break}se=0,le=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=I;break;case L:for(;le<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}e.adler=n.check=re(se),se=0,le=0,n.mode=C;case C:if(0===n.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=ae,n.hold=se,n.bits=le,g;e.adler=n.check=1,n.mode=I;case I:if(t===d||t===f)break e;case N:if(n.last){se>>>=7&le,le-=7&le,n.mode=Y;break}for(;le<3;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}switch(n.last=1&se,le-=1,3&(se>>>=1)){case 0:n.mode=F;break;case 1:if(he(n),n.mode=z,t===f){se>>>=2,le-=2;break e}break;case 2:n.mode=D;break;case 3:e.msg="invalid block type",n.mode=Q}se>>>=2,le-=2;break;case F:for(se>>>=7&le,le-=7&le;le<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Q;break}if(n.length=65535&se,se=0,le=0,n.mode=O,t===f)break e;case O:n.mode=H;case H:if(fe=n.length){if(fe>ae&&(fe=ae),fe>oe&&(fe=oe),0===fe)break e;r.arraySet(te,ee,ne,fe,ie),ae-=fe,ne+=fe,oe-=fe,ie+=fe,n.length-=fe;break}n.mode=I;break;case D:for(;le<14;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(n.nlen=257+(31&se),se>>>=5,le-=5,n.ndist=1+(31&se),se>>>=5,le-=5,n.ncode=4+(15&se),se>>>=4,le-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Q;break}n.have=0,n.mode=U;case U:for(;n.have<n.ncode;){for(;le<3;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}n.lens[Re[n.have++]]=7&se,se>>>=3,le-=3}for(;n.have<19;)n.lens[Re[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Te={bits:n.lenbits},xe=s(l,n.lens,0,19,n.lencode,0,n.work,Te),n.lenbits=Te.bits,xe){e.msg="invalid code lengths set",n.mode=Q;break}n.have=0,n.mode=B;case B:for(;n.have<n.nlen+n.ndist;){for(;ve=(Me=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Me,!((ge=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(ye<16)se>>>=ge,le-=ge,n.lens[n.have++]=ye;else{if(16===ye){for(Ae=ge+2;le<Ae;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(se>>>=ge,le-=ge,0===n.have){e.msg="invalid bit length repeat",n.mode=Q;break}we=n.lens[n.have-1],fe=3+(3&se),se>>>=2,le-=2}else if(17===ye){for(Ae=ge+3;le<Ae;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}le-=ge,we=0,fe=3+(7&(se>>>=ge)),se>>>=3,le-=3}else{for(Ae=ge+7;le<Ae;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}le-=ge,we=0,fe=11+(127&(se>>>=ge)),se>>>=7,le-=7}if(n.have+fe>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Q;break}for(;fe--;)n.lens[n.have++]=we}}if(n.mode===Q)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Q;break}if(n.lenbits=9,Te={bits:n.lenbits},xe=s(c,n.lens,0,n.nlen,n.lencode,0,n.work,Te),n.lenbits=Te.bits,xe){e.msg="invalid literal/lengths set",n.mode=Q;break}if(n.distbits=6,n.distcode=n.distdyn,Te={bits:n.distbits},xe=s(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Te),n.distbits=Te.bits,xe){e.msg="invalid distances set",n.mode=Q;break}if(n.mode=z,t===f)break e;case z:n.mode=V;case V:if(ae>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=ae,n.hold=se,n.bits=le,o(e,ue),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,ae=e.avail_in,se=n.hold,le=n.bits,n.mode===I&&(n.back=-1);break}for(n.back=0;ve=(Me=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Me,!((ge=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(ve&&0==(240&ve)){for(_e=ge,be=ve,Ee=ye;ve=(Me=n.lencode[Ee+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Me,!(_e+(ge=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}se>>>=_e,le-=_e,n.back+=_e}if(se>>>=ge,le-=ge,n.back+=ge,n.length=ye,0===ve){n.mode=X;break}if(32&ve){n.back=-1,n.mode=I;break}if(64&ve){e.msg="invalid literal/length code",n.mode=Q;break}n.extra=15&ve,n.mode=j;case j:if(n.extra){for(Ae=n.extra;le<Ae;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}n.length+=se&(1<<n.extra)-1,se>>>=n.extra,le-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=G;case G:for(;ve=(Me=n.distcode[se&(1<<n.distbits)-1])>>>16&255,ye=65535&Me,!((ge=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(0==(240&ve)){for(_e=ge,be=ve,Ee=ye;ve=(Me=n.distcode[Ee+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Me,!(_e+(ge=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}se>>>=_e,le-=_e,n.back+=_e}if(se>>>=ge,le-=ge,n.back+=ge,64&ve){e.msg="invalid distance code",n.mode=Q;break}n.offset=ye,n.extra=15&ve,n.mode=W;case W:if(n.extra){for(Ae=n.extra;le<Ae;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}n.offset+=se&(1<<n.extra)-1,se>>>=n.extra,le-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Q;break}n.mode=q;case q:if(0===oe)break e;if(fe=ue-oe,n.offset>fe){if((fe=n.offset-fe)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Q;break}fe>n.wnext?(fe-=n.wnext,pe=n.wsize-fe):pe=n.wnext-fe,fe>n.length&&(fe=n.length),me=n.window}else me=te,pe=ie-n.offset,fe=n.length;fe>oe&&(fe=oe),oe-=fe,n.length-=fe;do{te[ie++]=me[pe++]}while(--fe);0===n.length&&(n.mode=V);break;case X:if(0===oe)break e;te[ie++]=n.length,oe--,n.mode=V;break;case Y:if(n.wrap){for(;le<32;){if(0===ae)break e;ae--,se|=ee[ne++]<<le,le+=8}if(ue-=oe,e.total_out+=ue,n.total+=ue,ue&&(e.adler=n.check=n.flags?a(n.check,te,ue,ie-ue):i(n.check,te,ue,ie-ue)),ue=oe,(n.flags?se:re(se))!==n.check){e.msg="incorrect data check",n.mode=Q;break}se=0,le=0}n.mode=K;case K:if(n.wrap&&n.flags){for(;le<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<le,le+=8}if(se!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Q;break}se=0,le=0}n.mode=Z;case Z:xe=m;break e;case Q:xe=y;break e;case J:return _;case $:default:return v}return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=ae,n.hold=se,n.bits=le,(n.wsize||ue!==e.avail_out&&n.mode<Q&&(n.mode<Y||t!==h))&&de(e,e.output,e.next_out,ue-e.avail_out)?(n.mode=J,_):(ce-=e.avail_in,ue-=e.avail_out,e.total_in+=ce,e.total_out+=ue,n.total+=ue,n.wrap&&ue&&(e.adler=n.check=n.flags?a(n.check,te,ue,e.next_out-ue):i(n.check,te,ue,e.next_out-ue)),e.data_type=n.bits+(n.last?64:0)+(n.mode===I?128:0)+(n.mode===z||n.mode===O?256:0),(0===ce&&0===ue||t===h)&&xe===p&&(xe=b),xe)},t.inflateEnd=function(e){if(!e||!e.state)return v;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?v:(n.head=t,t.done=!1,p):v},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==C?v:n.mode===C&&i(1,t,r,0)!==n.check?y:de(e,t,r,r)?(n.mode=J,_):(n.havedict=1,p):v},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var r=n(8),i=4,a=0,o=1,s=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var c=0,u=1,h=2,d=29,f=256,p=f+1+d,m=30,g=19,v=2*p+1,y=15,_=16,b=7,E=256,w=16,x=17,T=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(p+2));l(k);var P=new Array(2*m);l(P);var L=new Array(512);l(L);var C=new Array(256);l(C);var I=new Array(d);l(I);var N,F,O,H=new Array(m);function D(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function U(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function B(e){return e<256?L[e]:L[256+(e>>>7)]}function z(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function V(e,t,n){e.bi_valid>_-n?(e.bi_buf|=t<<e.bi_valid&65535,z(e,e.bi_buf),e.bi_buf=t>>_-e.bi_valid,e.bi_valid+=n-_):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function j(e,t,n){V(e,n[2*t],n[2*t+1])}function G(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function W(e,t,n){var r,i,a=new Array(y+1),o=0;for(r=1;r<=y;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=G(a[s]++,s))}}function q(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<g;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*E]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function X(e){e.bi_valid>8?z(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Y(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function K(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&Y(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Y(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function Z(e,t,n){var r,i,a,o,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===r?j(e,i,t):(j(e,(a=C[i])+f+1,t),0!==(o=A[a])&&V(e,i-=I[a],o),j(e,a=B(--r),n),0!==(o=M[a])&&V(e,r-=H[a],o))}while(s<e.last_lit);j(e,E,t)}function Q(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=v,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)K(e,a,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,K(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=y;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<v;n++)(a=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,m++),l[2*r+1]=a,r>c||(e.bl_count[a]++,o=0,r>=f&&(o=d[r-f]),s=l[2*r],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(u[2*r+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>c||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),r--)}}(e,t),W(a,c,e.bl_count)}function J(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<l&&i===o||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*w]++):s<=10?e.bl_tree[2*x]++:e.bl_tree[2*T]++,s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))}function $(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<l&&i===o)){if(s<c)do{j(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(j(e,i,e.bl_tree),s--),j(e,w,e.bl_tree),V(e,s-3,2)):s<=10?(j(e,x,e.bl_tree),V(e,s-3,3)):(j(e,T,e.bl_tree),V(e,s-11,7));s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4)}}l(H);var ee=!1;function te(e,t,n,i){V(e,(c<<1)+(i?1:0),3),function(e,t,n,i){X(e),i&&(z(e,n),z(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,r,i,a=new Array(y+1);for(n=0,r=0;r<d-1;r++)for(I[r]=n,e=0;e<1<<A[r];e++)C[n++]=r;for(C[n-1]=r,i=0,r=0;r<16;r++)for(H[r]=i,e=0;e<1<<M[r];e++)L[i++]=r;for(i>>=7;r<m;r++)for(H[r]=i<<7,e=0;e<1<<M[r]-7;e++)L[256+i++]=r;for(t=0;t<=y;t++)a[t]=0;for(e=0;e<=143;)k[2*e+1]=8,e++,a[8]++;for(;e<=255;)k[2*e+1]=9,e++,a[9]++;for(;e<=279;)k[2*e+1]=7,e++,a[7]++;for(;e<=287;)k[2*e+1]=8,e++,a[8]++;for(W(k,p+1,a),e=0;e<m;e++)P[2*e+1]=5,P[2*e]=G(e,5);N=new D(k,A,f+1,p,y),F=new D(P,M,0,m,y),O=new D(new Array(0),S,0,g,b)}(),ee=!0),e.l_desc=new U(e.dyn_ltree,N),e.d_desc=new U(e.dyn_dtree,F),e.bl_desc=new U(e.bl_tree,O),e.bi_buf=0,e.bi_valid=0,q(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,r){var l,c,d=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return o;return a}(e)),Q(e,e.l_desc),Q(e,e.d_desc),d=function(e){var t;for(J(e,e.dyn_ltree,e.l_desc.max_code),J(e,e.dyn_dtree,e.d_desc.max_code),Q(e,e.bl_desc),t=g-1;t>=3&&0===e.bl_tree[2*R[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),l=e.opt_len+3+7>>>3,(c=e.static_len+3+7>>>3)<=l&&(l=c)):l=c=n+5,n+4<=l&&-1!==t?te(e,t,n,r):e.strategy===i||c===l?(V(e,(u<<1)+(r?1:0),3),Z(e,k,P)):(V(e,(h<<1)+(r?1:0),3),function(e,t,n,r){var i;for(V(e,t-257,5),V(e,n-1,5),V(e,r-4,4),i=0;i<r;i++)V(e,e.bl_tree[2*R[i]+1],3);$(e,e.dyn_ltree,t-1),$(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),Z(e,e.dyn_ltree,e.dyn_dtree)),q(e),r&&X(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(C[n]+f+1)]++,e.dyn_dtree[2*B(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){V(e,u<<1,3),j(e,E,k),function(e){16===e.bi_valid?(z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r,i=n(8),a=n(50),o=n(29),s=n(28),l=n(49),c=0,u=1,h=3,d=4,f=5,p=0,m=1,g=-2,v=-3,y=-5,_=-1,b=1,E=2,w=3,x=4,T=0,A=2,M=8,S=9,R=15,k=8,P=286,L=30,C=19,I=2*P+1,N=15,F=3,O=258,H=O+F+1,D=32,U=42,B=69,z=73,V=91,j=103,G=113,W=666,q=1,X=2,Y=3,K=4,Z=3;function Q(e,t){return e.msg=l[t],t}function J(e){return(e<<1)-(e>4?9:0)}function $(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-H?e.strstart-(e.w_size-H):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+O,f=c[a+o-1],p=c[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+o]===p&&c[n+o-1]===f&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<d);if(r=O-(d-a),a=d-O,r>o){if(e.match_start=t,o=r,r>=s)break;f=c[a+o-1],p=c[a+o]}}}while((t=h[t&u])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function ae(e){var t,n,r,a,l,c,u,h,d,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-H)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=p?r-p:0}while(--n);t=n=p;do{r=e.prev[--t],e.prev[t]=r>=p?r-p:0}while(--n);a+=p}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,h=e.strstart+e.lookahead,d=a,f=void 0,(f=c.avail_in)>d&&(f=d),n=0===f?0:(c.avail_in-=f,i.arraySet(u,c.input,c.next_in,f,h),1===c.state.wrap?c.adler=o(c.adler,u,f,h):2===c.state.wrap&&(c.adler=s(c.adler,u,f,h)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=F)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+F-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<F)););}while(e.lookahead<H&&0!==e.strm.avail_in)}function oe(e,t){for(var n,r;;){if(e.lookahead<H){if(ae(e),e.lookahead<H&&t===c)return q;if(0===e.lookahead)break}if(n=0,e.lookahead>=F&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-H&&(e.match_length=ie(e,n)),e.match_length>=F)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-F),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=F){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=e.strstart<F-1?e.strstart:F-1,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}function se(e,t){for(var n,r,i;;){if(e.lookahead<H){if(ae(e),e.lookahead<H&&t===c)return q;if(0===e.lookahead)break}if(n=0,e.lookahead>=F&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=F-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-H&&(e.match_length=ie(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===F&&e.strstart-e.match_start>4096)&&(e.match_length=F-1)),e.prev_length>=F&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-F,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-F),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=F-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return q}else if(e.match_available){if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return q}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<F-1?e.strstart:F-1,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}function le(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function ce(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=A,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?U:G,e.adler=2===t.wrap?0:1,t.last_flush=c,a._tr_init(t),p):Q(e,g)}function ue(e){var t,n=ce(e);return n===p&&((t=e.state).window_size=2*t.w_size,$(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=F-1,t.match_available=0,t.ins_h=0),n}function he(e,t,n,r,a,o){if(!e)return g;var s=1;if(t===_&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>S||n!==M||r<8||r>15||t<0||t>9||o<0||o>x)return Q(e,g);8===r&&(r=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*I),this.dyn_dtree=new i.Buf16(2*(2*L+1)),this.bl_tree=new i.Buf16(2*(2*C+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(N+1),this.heap=new i.Buf16(2*P+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*P+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+F-1)/F),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,ue(e)}r=[new le(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===c)return q;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return q;if(e.strstart-e.block_start>=e.w_size-H&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),q)})),new le(4,4,8,4,oe),new le(4,5,16,8,oe),new le(4,6,32,32,oe),new le(4,4,16,16,se),new le(8,16,32,32,se),new le(8,16,128,128,se),new le(8,32,128,256,se),new le(32,128,258,1024,se),new le(32,258,258,4096,se)],t.deflateInit=function(e,t){return he(e,t,M,R,k,T)},t.deflateInit2=he,t.deflateReset=ue,t.deflateResetKeep=ce,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?g:(e.state.gzhead=t,p):g},t.deflate=function(e,t){var n,i,o,l;if(!e||!e.state||t>f||t<0)return e?Q(e,g):g;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===W&&t!==d)return Q(e,0===e.avail_out?y:g);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===U)if(2===i.wrap)e.adler=0,ne(i,31),ne(i,139),ne(i,8),i.gzhead?(ne(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ne(i,255&i.gzhead.time),ne(i,i.gzhead.time>>8&255),ne(i,i.gzhead.time>>16&255),ne(i,i.gzhead.time>>24&255),ne(i,9===i.level?2:i.strategy>=E||i.level<2?4:0),ne(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ne(i,255&i.gzhead.extra.length),ne(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=B):(ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,9===i.level?2:i.strategy>=E||i.level<2?4:0),ne(i,Z),i.status=G);else{var v=M+(i.w_bits-8<<4)<<8;v|=(i.strategy>=E||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(v|=D),v+=31-v%31,i.status=G,re(i,v),0!==i.strstart&&(re(i,e.adler>>>16),re(i,65535&e.adler)),e.adler=1}if(i.status===B)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)ne(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=z)}else i.status=z;if(i.status===z)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ne(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=V)}else i.status=V;if(i.status===V)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ne(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=j)}else i.status=j;if(i.status===j&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(ne(i,255&e.adler),ne(i,e.adler>>8&255),e.adler=0,i.status=G)):i.status=G),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&J(t)<=J(n)&&t!==d)return Q(e,y);if(i.status===W&&0!==e.avail_in)return Q(e,y);if(0!==e.avail_in||0!==i.lookahead||t!==c&&i.status!==W){var _=i.strategy===E?function(e,t){for(var n;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===c)return q;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}(i,t):i.strategy===w?function(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=O){if(ae(e),e.lookahead<=O&&t===c)return q;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=F&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){o=e.strstart+O;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=O-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=F?(n=a._tr_tally(e,1,e.match_length-F),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:X}(i,t):r[i.level].func(i,t);if(_!==Y&&_!==K||(i.status=W),_===q||_===Y)return 0===e.avail_out&&(i.last_flush=-1),p;if(_===X&&(t===u?a._tr_align(i):t!==f&&(a._tr_stored_block(i,0,0,!1),t===h&&($(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,p}return t!==d?p:i.wrap<=0?m:(2===i.wrap?(ne(i,255&e.adler),ne(i,e.adler>>8&255),ne(i,e.adler>>16&255),ne(i,e.adler>>24&255),ne(i,255&e.total_in),ne(i,e.total_in>>8&255),ne(i,e.total_in>>16&255),ne(i,e.total_in>>24&255)):(re(i,e.adler>>>16),re(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:m)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==U&&t!==B&&t!==z&&t!==V&&t!==j&&t!==G&&t!==W?Q(e,g):(e.state=null,t===G?Q(e,v):p):g},t.deflateSetDictionary=function(e,t){var n,r,a,s,l,c,u,h,d=t.length;if(!e||!e.state)return g;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==U||n.lookahead)return g;for(1===s&&(e.adler=o(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===s&&($(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,d-n.w_size,n.w_size,0),t=h,d=n.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,ae(n);n.lookahead>=F;){r=n.strstart,a=n.lookahead-(F-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+F-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=F-1,ae(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=F-1,n.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,n.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){"use strict";(function(e,r){var i=n(31),a=n(52),o=n(51),s=n(48),l=n(45);for(var c in l)t[c]=l[c];function u(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,u.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},u.prototype.write=function(e,t,n,r,i,a,o){return this._write(!0,e,t,n,r,i,a,o)},u.prototype.writeSync=function(e,t,n,r,i,a,o){return this._write(!1,e,t,n,r,i,a,o)},u.prototype._write=function(n,a,o,s,l,c,u,h){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==t.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==t.Z_NO_FLUSH&&a!==t.Z_PARTIAL_FLUSH&&a!==t.Z_SYNC_FLUSH&&a!==t.Z_FULL_FLUSH&&a!==t.Z_FINISH&&a!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),l=0,s=0),this.strm.avail_in=l,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=h,this.strm.output=c,this.strm.next_out=u,this.flush=a,!n)return this._process(),this._checkError()?this._afterSync():void 0;var d=this;return r.nextTick((function(){d._process(),d._after()})),this},u.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},u.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},u.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},u.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},u.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},u.prototype.init=function(e,n,r,a,o){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(n>=-1&&n<=9,"invalid compression level"),i(r>=1&&r<=9,"invalid memlevel"),i(a===t.Z_FILTERED||a===t.Z_HUFFMAN_ONLY||a===t.Z_RLE||a===t.Z_FIXED||a===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(n,e,r,a,o),this._setDictionary()},u.prototype.params=function(){throw new Error("deflateParams Not supported")},u.prototype.reset=function(){this._reset(),this._setDictionary()},u.prototype._init=function(e,n,r,i,l){switch(this.level=e,this.windowBits=n,this.memLevel=r,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0},u.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},u.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=u}).call(this,n(1).Buffer,n(3))},function(e,t,n){e.exports=n(20).PassThrough},function(e,t,n){e.exports=n(20).Transform},function(e,t,n){e.exports=n(2)},function(e,t,n){e.exports=n(19)},function(e,t,n){"use strict";e.exports=a;var r=n(32),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}i.inherits=n(5),i.inherits(a,r),a.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,a,o,s,l=1,c={},u=!1,h=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){a.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,r=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)},d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[l]=i,r(l),l++},d.clearImmediate=f}function f(e){delete c[e]}function p(e){if(u)setTimeout(p,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{f(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(3))},function(e,t,n){(function(e){var r=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(62),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t){},function(e,t,n){"use strict";var r=n(9).Buffer,i=n(64);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i=r.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=i,n=o,a.data.copy(t,n),o+=a.data.length,a=a.next;return i},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){e.exports=i;var r=n(21).EventEmitter;function i(){r.call(this)}n(5)(i,r),i.Readable=n(20),i.Writable=n(59),i.Duplex=n(58),i.Transform=n(57),i.PassThrough=n(56),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===r.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",a),n.removeListener("end",s),n.removeListener("close",l),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},function(e,t,n){"use strict";(function(e){var r=n(1).Buffer,i=n(67).Transform,a=n(55),o=n(30),s=n(31).ok,l=n(1).kMaxLength,c="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var u=Object.keys(a),h=0;h<u.length;h++){var d=u[h];d.match(/^Z/)&&Object.defineProperty(t,d,{enumerable:!0,value:a[d],writable:!1})}for(var f={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=Object.keys(f),m=0;m<p.length;m++){var g=p[m];f[f[g]]=g}function v(e,t,n){var i=[],a=0;function o(){for(var t;null!==(t=e.read());)i.push(t),a+=t.length;e.once("readable",o)}function s(){var t,o=null;a>=l?o=new RangeError(c):t=r.concat(i,a),i=[],e.close(),n(o,t)}e.on("error",(function(t){e.removeListener("end",s),e.removeListener("readable",o),n(t)})),e.on("end",s),e.end(t),o()}function y(e,t){if("string"==typeof t&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Not a string or buffer");var n=e._finishFlushFlag;return e._processChunk(t,n)}function _(e){if(!(this instanceof _))return new _(e);S.call(this,e,a.DEFLATE)}function b(e){if(!(this instanceof b))return new b(e);S.call(this,e,a.INFLATE)}function E(e){if(!(this instanceof E))return new E(e);S.call(this,e,a.GZIP)}function w(e){if(!(this instanceof w))return new w(e);S.call(this,e,a.GUNZIP)}function x(e){if(!(this instanceof x))return new x(e);S.call(this,e,a.DEFLATERAW)}function T(e){if(!(this instanceof T))return new T(e);S.call(this,e,a.INFLATERAW)}function A(e){if(!(this instanceof A))return new A(e);S.call(this,e,a.UNZIP)}function M(e){return e===a.Z_NO_FLUSH||e===a.Z_PARTIAL_FLUSH||e===a.Z_SYNC_FLUSH||e===a.Z_FULL_FLUSH||e===a.Z_FINISH||e===a.Z_BLOCK}function S(e,n){var o=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!M(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!M(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:a.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!r.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(n);var s=this;this._hadError=!1,this._handle.onerror=function(e,n){R(s),s._hadError=!0;var r=new Error(e);r.errno=n,r.code=t.codes[n],s.emit("error",r)};var l=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(l=e.level);var c=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(c=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,l,e.memLevel||t.Z_DEFAULT_MEMLEVEL,c,e.dictionary),this._buffer=r.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=c,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!o._handle},configurable:!0,enumerable:!0})}function R(t,n){n&&e.nextTick(n),t._handle&&(t._handle.close(),t._handle=null)}function k(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(f),writable:!1}),t.Deflate=_,t.Inflate=b,t.Gzip=E,t.Gunzip=w,t.DeflateRaw=x,t.InflateRaw=T,t.Unzip=A,t.createDeflate=function(e){return new _(e)},t.createInflate=function(e){return new b(e)},t.createDeflateRaw=function(e){return new x(e)},t.createInflateRaw=function(e){return new T(e)},t.createGzip=function(e){return new E(e)},t.createGunzip=function(e){return new w(e)},t.createUnzip=function(e){return new A(e)},t.deflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new _(t),e,n)},t.deflateSync=function(e,t){return y(new _(t),e)},t.gzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new E(t),e,n)},t.gzipSync=function(e,t){return y(new E(t),e)},t.deflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new x(t),e,n)},t.deflateRawSync=function(e,t){return y(new x(t),e)},t.unzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new A(t),e,n)},t.unzipSync=function(e,t){return y(new A(t),e)},t.inflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new b(t),e,n)},t.inflateSync=function(e,t){return y(new b(t),e)},t.gunzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new w(t),e,n)},t.gunzipSync=function(e,t){return y(new w(t),e)},t.inflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new T(t),e,n)},t.inflateRawSync=function(e,t){return y(new T(t),e)},o.inherits(S,i),S.prototype.params=function(n,r,i){if(n<t.Z_MIN_LEVEL||n>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+n);if(r!=t.Z_FILTERED&&r!=t.Z_HUFFMAN_ONLY&&r!=t.Z_RLE&&r!=t.Z_FIXED&&r!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+r);if(this._level!==n||this._strategy!==r){var o=this;this.flush(a.Z_SYNC_FLUSH,(function(){s(o._handle,"zlib binding closed"),o._handle.params(n,r),o._hadError||(o._level=n,o._strategy=r,i&&i())}))}else e.nextTick(i)},S.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},S.prototype._flush=function(e){this._transform(r.alloc(0),"",e)},S.prototype.flush=function(t,n){var i=this,o=this._writableState;("function"==typeof t||void 0===t&&!n)&&(n=t,t=a.Z_FULL_FLUSH),o.ended?n&&e.nextTick(n):o.ending?n&&this.once("end",n):o.needDrain?n&&this.once("drain",(function(){return i.flush(t,n)})):(this._flushFlag=t,this.write(r.alloc(0),"",n))},S.prototype.close=function(t){R(this,t),e.nextTick(k,this)},S.prototype._transform=function(e,t,n){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);return null===e||r.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(e,i,n)):n(new Error("zlib binding closed")):n(new Error("invalid input"))},S.prototype._processChunk=function(e,t,n){var i=e&&e.length,a=this._chunkSize-this._offset,o=0,u=this,h="function"==typeof n;if(!h){var d,f=[],p=0;this.on("error",(function(e){d=e})),s(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,a)}while(!this._hadError&&y(m[0],m[1]));if(this._hadError)throw d;if(p>=l)throw R(this),new RangeError(c);var g=r.concat(f,p);return R(this),g}s(this._handle,"zlib binding closed");var v=this._handle.write(t,e,o,i,this._buffer,this._offset,a);function y(l,c){if(this&&(this.buffer=null,this.callback=null),!u._hadError){var d=a-c;if(s(d>=0,"have should not go down"),d>0){var m=u._buffer.slice(u._offset,u._offset+d);u._offset+=d,h?u.push(m):(f.push(m),p+=m.length)}if((0===c||u._offset>=u._chunkSize)&&(a=u._chunkSize,u._offset=0,u._buffer=r.allocUnsafe(u._chunkSize)),0===c){if(o+=i-l,i=l,!h)return!0;var g=u._handle.write(t,e,o,i,u._buffer,u._offset,u._chunkSize);return g.callback=y,void(g.buffer=e)}if(!h)return!1;n()}}v.buffer=e,v.callback=y},o.inherits(_,S),o.inherits(b,S),o.inherits(E,S),o.inherits(w,S),o.inherits(x,S),o.inherits(T,S),o.inherits(A,S)}).call(this,n(3))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,d){if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";function f(l){var f=function(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=e.elements.x00020010;return u.readFixedString(t,n.dataOffset,n.length)}(l),p=function(e){return"1.2.840.10008.1.2"!==e}(f),m=function(o,l){if("1.2.840.10008.1.2.1.99"===o){if(d&&d.inflater){var u=d.inflater(t,l);return new a.default(s.default,u,0)}if(void 0!==e&&this.module!==e){var h=n(68),f=(0,c.default)(t,l,t.length-l),p=h.inflateRawSync(f),m=(0,r.default)(t,p.length+l);return t.copy(m,0,0,l),p.copy(m,l),new a.default(s.default,m,0)}if("undefined"!=typeof pako){var g=t.slice(l),v=pako.inflateRaw(g),y=(0,r.default)(t,v.length+l);return y.set(t.slice(0,l),0),y.set(v,l),new a.default(s.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===o?new a.default(i.default,t,l):new a.default(s.default,t,l)}(f,l.position),g=new o.default(m.byteArrayParser,m.byteArray,{});g.warnings=m.warnings;try{p?h.parseDicomDataSetExplicit(g,m,m.byteArray.length,d):h.parseDicomDataSetImplicit(g,m,m.byteArray.length,d)}catch(e){throw{exception:e,dataSet:g}}return g}return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(p=(0,l.default)(t,d),f(p));var p};var r=f(n(23)),i=f(n(38)),a=f(n(12)),o=f(n(7)),s=f(n(22)),l=f(n(37)),c=f(n(11)),u=d(n(14)),h=d(n(16));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}}).call(this,n(69)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.8.5"},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=c}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+f]=255&o,f+=p,o/=256,c-=8);e[n+f-p]|=128*m}},function(e,t,n){"use strict";t.byteLength=function(e){return 3*e.length/4-c(e)},t.toByteArray=function(e){var t,n,r,o,s,l=e.length;o=c(e),s=new a(3*l/4-o),n=o>0?l-4:l;var u=0;for(t=0;t<n;t+=4)r=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[u++]=r>>16&255,s[u++]=r>>8&255,s[u++]=255&r;return 2===o?(r=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[u++]=255&r):1===o&&(r=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[u++]=r>>8&255,s[u++]=255&r),s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a="",o=[],s=0,l=n-i;s<l;s+=16383)o.push(u(e,s,s+16383>l?l:s+16383));return 1===i?(t=e[n-1],a+=r[t>>2],a+=r[t<<4&63],a+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],a+=r[t>>10],a+=r[t>>4&63],a+=r[t<<2&63],a+="="),o.push(a),o.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function u(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t,n){"use strict";function r(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function i(e,t,n){var i=t.fragments[n];return!(!r(e,i.position+i.length-2)&&!r(e,i.position+i.length-3))}function a(e,t,n){for(var r=n;r<t.fragments.length;r++)if(i(e,t,r))return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var r=[],i=0;;){r.push(t.fragments[i].offset);var o=a(e,t,i);if(void 0===o||o===t.fragments.length-1)return r;i=o+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var r={};for(var o in t.elements){var s=t.elements[o];if(!0!==n.omitPrivateAttibutes||!a.isPrivateTag(o))if(s.items){for(var l=[],c=0;c<s.items.length;c++)l.push(e(s.items[c].dataSet,n));r[o]=l}else{var u;u=void 0,s.length<n.maxElementLength&&(u=(0,i.default)(t,s)),r[o]=void 0!==u?u:{dataOffset:s.dataOffset,length:s.length}}}return r};var r,i=(r=n(43))&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),r=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);if(t&&!0!==function(e,t,n){return!isNaN(n)&&t>0&&t<=12&&e>0&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}(i,r,n))throw"invalid DA '"+e+"'";return{year:n,month:r,day:i}}if(t)throw"invalid DA '"+e+"'"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.length>=2){var n=parseInt(e.substring(0,2),10),r=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,a=e.length>=8?e.substring(7,13):void 0,o=a?parseInt(a,10)*Math.pow(10,6-a.length):void 0;if(t&&(isNaN(n)||void 0!==r&&isNaN(r)||void 0!==i&&isNaN(i)||void 0!==o&&isNaN(o)||n<0||n>23||r&&(r<0||r>59)||i&&(i<0||i>59)||o&&(o<0||o>999999)))throw"invalid TM '"+e+"'";return{hours:n,minutes:r,seconds:i,fractionalSeconds:o}}if(t)throw"invalid TM '"+e+"'"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(17),i=c(n(77)),a=c(n(76)),o=c(n(43)),s=c(n(75)),l=c(n(74));function c(e){return e&&e.__esModule?e:{default:e}}t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=i.default,t.parseDA=a.default,t.explicitElementToString=o.default,t.explicitDataSetToJS=s.default,t.createJPEGBasicOffsetTable=l.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readTag=t.readSequenceItem=t.readSequenceItemsImplicit=t.readSequenceItemsExplicit=t.readPart10Header=t.readEncapsulatedPixelDataFromFragments=t.readEncapsulatedPixelData=t.readEncapsulatedImageFrame=t.readDicomElementImplicit=t.readDicomElementExplicit=t.parseDicom=t.littleEndianByteArrayParser=t.findItemDelimitationItemAndSetElementLength=t.findEndOfEncapsulatedElement=t.findAndSetUNElementLength=t.DataSet=t.sharedCopy=t.ByteStream=t.bigEndianByteArrayParser=t.version=t.alloc=t.readFixedString=t.parseDicomDataSetImplicit=t.parseDicomDataSetExplicit=t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(78),i=n(16),a=n(14),o=S(n(23)),s=S(n(71)),l=S(n(38)),c=S(n(12)),u=S(n(11)),h=S(n(7)),d=S(n(41)),f=S(n(42)),p=S(n(24)),m=S(n(22)),g=S(n(70)),v=S(n(15)),y=S(n(25)),_=S(n(27)),b=S(n(44)),E=S(n(18)),w=S(n(37)),x=S(n(40)),T=S(n(26)),A=S(n(13)),M=S(n(4));function S(e){return e&&e.__esModule?e:{default:e}}var R={isStringVr:r.isStringVr,isPrivateTag:r.isPrivateTag,parsePN:r.parsePN,parseTM:r.parseTM,parseDA:r.parseDA,explicitElementToString:r.explicitElementToString,explicitDataSetToJS:r.explicitDataSetToJS,createJPEGBasicOffsetTable:r.createJPEGBasicOffsetTable,parseDicomDataSetExplicit:i.parseDicomDataSetExplicit,parseDicomDataSetImplicit:i.parseDicomDataSetImplicit,readFixedString:a.readFixedString,alloc:o.default,version:s.default,bigEndianByteArrayParser:l.default,ByteStream:c.default,sharedCopy:u.default,DataSet:h.default,findAndSetUNElementLength:d.default,findEndOfEncapsulatedElement:f.default,findItemDelimitationItemAndSetElementLength:p.default,littleEndianByteArrayParser:m.default,parseDicom:g.default,readDicomElementExplicit:v.default,readDicomElementImplicit:y.default,readEncapsulatedImageFrame:_.default,readEncapsulatedPixelData:b.default,readEncapsulatedPixelDataFromFragments:E.default,readPart10Header:w.default,readSequenceItemsExplicit:x.default,readSequenceItemsImplicit:T.default,readSequenceItem:A.default,readTag:M.default};t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=r.parseTM,t.parseDA=r.parseDA,t.explicitElementToString=r.explicitElementToString,t.explicitDataSetToJS=r.explicitDataSetToJS,t.createJPEGBasicOffsetTable=r.createJPEGBasicOffsetTable,t.parseDicomDataSetExplicit=i.parseDicomDataSetExplicit,t.parseDicomDataSetImplicit=i.parseDicomDataSetImplicit,t.readFixedString=a.readFixedString,t.alloc=o.default,t.version=s.default,t.bigEndianByteArrayParser=l.default,t.ByteStream=c.default,t.sharedCopy=u.default,t.DataSet=h.default,t.findAndSetUNElementLength=d.default,t.findEndOfEncapsulatedElement=f.default,t.findItemDelimitationItemAndSetElementLength=p.default,t.littleEndianByteArrayParser=m.default,t.parseDicom=g.default,t.readDicomElementExplicit=v.default,t.readDicomElementImplicit=y.default,t.readEncapsulatedImageFrame=_.default,t.readEncapsulatedPixelData=b.default,t.readEncapsulatedPixelDataFromFragments=E.default,t.readPart10Header=w.default,t.readSequenceItemsExplicit=x.default,t.readSequenceItemsImplicit=T.default,t.readSequenceItem=A.default,t.readTag=M.default,t.default=R}])},7124:(e,t,n)=>{"use strict";var r,i=SyntaxError,a=Function,o=TypeError,s=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},u=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,h=n(9905)(),d=Object.getPrototypeOf||function(e){return e.__proto__},f=s("async function* () {}"),p=f?f.prototype:r,m=p?p.prototype:r,g="undefined"==typeof Uint8Array?r:d(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h?d([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":s("async function () {}"),"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":m?d(m):r,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":a,"%GeneratorFunction%":s("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?d(d([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?d((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?d((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?d(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=n(1930),b=n(9284),E=_.call(Function.call,Array.prototype.concat),w=_.call(Function.apply,Array.prototype.splice),x=_.call(Function.call,String.prototype.replace),T=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,M=function(e){var t=[];return x(e,T,(function(e,n,r,i){t[t.length]=r?x(i,A,"$1"):n||e})),t},S=function(e,t){var n,r=e;if(b(y,r)&&(r="%"+(n=y[r])[0]+"%"),b(v,r)){var a=v[r];if(void 0===a&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:a}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var n=M(e),r=n.length>0?n[0]:"",i=S("%"+r+"%",t),a=i.name,s=i.value,c=!1,u=i.alias;u&&(r=u[0],w(n,E([0,1],u)));for(var h=1,d=!0;h<n.length;h+=1){var f=n[h];if("constructor"!==f&&d||(c=!0),b(v,a="%"+(r+="."+f)+"%"))s=v[a];else if(null!=s){if(l&&h+1>=n.length){var p=l(s,f);if(d=!!p,!t&&!(f in s))throw new o("base intrinsic for "+e+" exists, but the property is not available.");s=d&&"get"in p&&!("originalValue"in p.get)?p.get:s[f]}else d=b(s,f),s=s[f];d&&!c&&(v[a]=s)}}return s}},8711:(e,t,n)=>{"use strict";var r=n(7124)("%Object.getOwnPropertyDescriptor%");if(r)try{r([],"length")}catch(e){r=null}e.exports=r},1662:e=>{"use strict";function t(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var a=Object.keys(Object(i)),o=0,s=a.length;o<s;o++){var l=a[o],c=Object.getOwnPropertyDescriptor(i,l);void 0!==c&&c.enumerable&&(n[l]=i[l])}}return n}e.exports={assign:t,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:t})}}},5939:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(){void 0!==a&&e.removeListener("error",a),n([].slice.call(arguments))}var a;"error"!==t&&(a=function(n){e.removeListener(t,i),r(n)},e.once("error",a)),e.once(t,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,a,o,c;if(s(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=l(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=u.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,u=p(l,c);for(n=0;n<c;++n)r(u[n],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return s(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,a,o;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},743:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Deflate:()=>be,AsyncDeflate:()=>Ee,deflate:()=>we,deflateSync:()=>xe,Inflate:()=>Te,AsyncInflate:()=>Ae,inflate:()=>Me,inflateSync:()=>Se,Gzip:()=>Re,AsyncGzip:()=>ke,gzip:()=>Pe,gzipSync:()=>Le,Gunzip:()=>Ce,AsyncGunzip:()=>Ie,gunzip:()=>Ne,gunzipSync:()=>Fe,Zlib:()=>Oe,AsyncZlib:()=>He,zlib:()=>De,zlibSync:()=>Ue,Unzlib:()=>Be,AsyncUnzlib:()=>ze,unzlib:()=>Ve,unzlibSync:()=>je,compress:()=>Pe,AsyncCompress:()=>ke,compressSync:()=>Le,Compress:()=>Re,Decompress:()=>Ge,AsyncDecompress:()=>We,decompress:()=>qe,decompressSync:()=>Xe,DecodeUTF8:()=>$e,EncodeUTF8:()=>et,strToU8:()=>tt,strFromU8:()=>nt,ZipPassThrough:()=>ut,ZipDeflate:()=>ht,AsyncZipDeflate:()=>dt,Zip:()=>ft,zip:()=>pt,zipSync:()=>mt,UnzipPassThrough:()=>gt,UnzipInflate:()=>vt,AsyncUnzipInflate:()=>yt,Unzip:()=>_t,unzip:()=>bt,unzipSync:()=>Et});var r={},i=Uint8Array,a=Uint16Array,o=Uint32Array,s=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(e,t){for(var n=new a(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new o(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},h=u(s,2),d=h[0],f=h[1];d[28]=258,f[258]=28;for(var p=u(l,0),m=p[0],g=p[1],v=new a(32768),y=0;y<32768;++y){var _=(43690&y)>>>1|(21845&y)<<1;_=(61680&(_=(52428&_)>>>2|(13107&_)<<2))>>>4|(3855&_)<<4,v[y]=((65280&_)>>>8|(255&_)<<8)>>>1}var b=function(e,t,n){for(var r=e.length,i=0,o=new a(t);i<r;++i)++o[e[i]-1];var s,l=new a(t);for(i=0;i<t;++i)l[i]=l[i-1]+o[i-1]<<1;if(n){s=new a(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var u=i<<4|e[i],h=t-e[i],d=l[e[i]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)s[v[d]>>>c]=u}else for(s=new a(r),i=0;i<r;++i)e[i]&&(s[i]=v[l[e[i]-1]++]>>>15-e[i]);return s},E=new i(288);for(y=0;y<144;++y)E[y]=8;for(y=144;y<256;++y)E[y]=9;for(y=256;y<280;++y)E[y]=7;for(y=280;y<288;++y)E[y]=8;var w=new i(32);for(y=0;y<32;++y)w[y]=5;var x=b(E,9,0),T=b(E,9,1),A=b(w,5,0),M=b(w,5,1),S=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},R=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},k=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},P=function(e){return(e/8|0)+(7&e&&1)},L=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof a?a:e instanceof o?o:i)(n-t);return r.set(e.subarray(t,n)),r},C=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new i(0);var a=!t||n,o=!n||n.i;n||(n={}),t||(t=new i(3*r));var u=function(e){var n=t.length;if(e>n){var r=new i(Math.max(2*n,e));r.set(t),t=r}},h=n.f||0,f=n.p||0,p=n.b||0,g=n.l,v=n.d,y=n.m,_=n.n,E=8*r;do{if(!g){n.f=h=R(e,f,1);var w=R(e,f+1,3);if(f+=3,!w){var x=e[(z=P(f)+4)-4]|e[z-3]<<8,A=z+x;if(A>r){if(o)throw"unexpected EOF";break}a&&u(p+x),t.set(e.subarray(z,A),p),n.b=p+=x,n.p=f=8*A;continue}if(1==w)g=T,v=M,y=9,_=5;else{if(2!=w)throw"invalid block type";var C=R(e,f,31)+257,I=R(e,f+10,15)+4,N=C+R(e,f+5,31)+1;f+=14;for(var F=new i(N),O=new i(19),H=0;H<I;++H)O[c[H]]=R(e,f+3*H,7);f+=3*I;var D=S(O),U=(1<<D)-1,B=b(O,D,1);for(H=0;H<N;){var z,V=B[R(e,f,U)];if(f+=15&V,(z=V>>>4)<16)F[H++]=z;else{var j=0,G=0;for(16==z?(G=3+R(e,f,3),f+=2,j=F[H-1]):17==z?(G=3+R(e,f,7),f+=3):18==z&&(G=11+R(e,f,127),f+=7);G--;)F[H++]=j}}var W=F.subarray(0,C),q=F.subarray(C);y=S(W),_=S(q),g=b(W,y,1),v=b(q,_,1)}if(f>E){if(o)throw"unexpected EOF";break}}a&&u(p+131072);for(var X=(1<<y)-1,Y=(1<<_)-1,K=f;;K=f){var Z=(j=g[k(e,f)&X])>>>4;if((f+=15&j)>E){if(o)throw"unexpected EOF";break}if(!j)throw"invalid length/literal";if(Z<256)t[p++]=Z;else{if(256==Z){K=f,g=null;break}var Q=Z-254;if(Z>264){var J=s[H=Z-257];Q=R(e,f,(1<<J)-1)+d[H],f+=J}var $=v[k(e,f)&Y],ee=$>>>4;if(!$)throw"invalid distance";f+=15&$;q=m[ee];if(ee>3){J=l[ee];q+=k(e,f)&(1<<J)-1,f+=J}if(f>E){if(o)throw"unexpected EOF";break}a&&u(p+131072);for(var te=p+Q;p<te;p+=4)t[p]=t[p-q],t[p+1]=t[p+1-q],t[p+2]=t[p+2-q],t[p+3]=t[p+3-q];p=te}}n.l=g,n.p=K,n.b=p,g&&(h=1,n.m=y,n.d=v,n.n=_)}while(!h);return p==t.length?t:L(t,0,p)},I=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},N=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},F=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var o=n.length,s=n.slice();if(!o)return[V,0];if(1==o){var l=new i(n[0].s+1);return l[n[0].s]=1,[l,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var c=n[0],u=n[1],h=0,d=1,f=2;for(n[0]={s:-1,f:c.f+u.f,l:c,r:u};d!=o-1;)c=n[n[h].f<n[f].f?h++:f++],u=n[h!=d&&n[h].f<n[f].f?h++:f++],n[d++]={s:-1,f:c.f+u.f,l:c,r:u};var p=s[0].s;for(r=1;r<o;++r)s[r].s>p&&(p=s[r].s);var m=new a(p+1),g=O(n[d-1],m,0);if(g>t){r=0;var v=0,y=g-t,_=1<<y;for(s.sort((function(e,t){return m[t.s]-m[e.s]||e.f-t.f}));r<o;++r){var b=s[r].s;if(!(m[b]>t))break;v+=_-(1<<g-m[b]),m[b]=t}for(v>>>=y;v>0;){var E=s[r].s;m[E]<t?v-=1<<t-m[E]++-1:++r}for(;r>=0&&v;--r){var w=s[r].s;m[w]==t&&(--m[w],++v)}g=t}return[new i(m),g]},O=function(e,t,n){return-1==e.s?Math.max(O(e.l,t,n+1),O(e.r,t,n+1)):t[e.s]=n},H=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new a(++t),r=0,i=e[0],o=1,s=function(e){n[r++]=e},l=1;l<=t;++l)if(e[l]==i&&l!=t)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=e[l]}return[n.subarray(0,r),t]},D=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},U=function(e,t,n){var r=n.length,i=P(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var a=0;a<r;++a)e[i+a+4]=n[a];return 8*(i+4+r)},B=function(e,t,n,r,i,o,u,h,d,f,p){I(t,p++,n),++i[256];for(var m=F(i,15),g=m[0],v=m[1],y=F(o,15),_=y[0],T=y[1],M=H(g),S=M[0],R=M[1],k=H(_),P=k[0],L=k[1],C=new a(19),O=0;O<S.length;++O)C[31&S[O]]++;for(O=0;O<P.length;++O)C[31&P[O]]++;for(var B=F(C,7),z=B[0],V=B[1],j=19;j>4&&!z[c[j-1]];--j);var G,W,q,X,Y=f+5<<3,K=D(i,E)+D(o,w)+u,Z=D(i,g)+D(o,_)+u+14+3*j+D(C,z)+(2*C[16]+3*C[17]+7*C[18]);if(Y<=K&&Y<=Z)return U(t,p,e.subarray(d,d+f));if(I(t,p,1+(Z<K)),p+=2,Z<K){G=b(g,v,0),W=g,q=b(_,T,0),X=_;var Q=b(z,V,0);I(t,p,R-257),I(t,p+5,L-1),I(t,p+10,j-4),p+=14;for(O=0;O<j;++O)I(t,p+3*O,z[c[O]]);p+=3*j;for(var J=[S,P],$=0;$<2;++$){var ee=J[$];for(O=0;O<ee.length;++O){var te=31&ee[O];I(t,p,Q[te]),p+=z[te],te>15&&(I(t,p,ee[O]>>>5&127),p+=ee[O]>>>12)}}}else G=x,W=E,q=A,X=w;for(O=0;O<h;++O)if(r[O]>255){te=r[O]>>>18&31;N(t,p,G[te+257]),p+=W[te+257],te>7&&(I(t,p,r[O]>>>23&31),p+=s[te]);var ne=31&r[O];N(t,p,q[ne]),p+=X[ne],ne>3&&(N(t,p,r[O]>>>5&8191),p+=l[ne])}else N(t,p,G[r[O]]),p+=W[r[O]];return N(t,p,G[256]),p+W[256]},z=new o([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),V=new i(0),j=function(e,t,n,r,c,u){var h=e.length,d=new i(r+h+5*(1+Math.ceil(h/7e3))+c),p=d.subarray(r,d.length-c),m=0;if(!t||h<8)for(var v=0;v<=h;v+=65535){var y=v+65535;y<h?m=U(p,m,e.subarray(v,y)):(p[v]=u,m=U(p,m,e.subarray(v,h)))}else{for(var _=z[t-1],b=_>>>13,E=8191&_,w=(1<<n)-1,x=new a(32768),T=new a(w+1),A=Math.ceil(n/3),M=2*A,S=function(t){return(e[t]^e[t+1]<<A^e[t+2]<<M)&w},R=new o(25e3),k=new a(288),C=new a(32),I=0,N=0,F=(v=0,0),O=0,H=0;v<h;++v){var D=S(v),j=32767&v,G=T[D];if(x[j]=G,T[D]=j,O<=v){var W=h-v;if((I>7e3||F>24576)&&W>423){m=B(e,p,0,R,k,C,N,F,H,v-H,m),F=I=N=0,H=v;for(var q=0;q<286;++q)k[q]=0;for(q=0;q<30;++q)C[q]=0}var X=2,Y=0,K=E,Z=j-G&32767;if(W>2&&D==S(v-Z))for(var Q=Math.min(b,W)-1,J=Math.min(32767,v),$=Math.min(258,W);Z<=J&&--K&&j!=G;){if(e[v+X]==e[v+X-Z]){for(var ee=0;ee<$&&e[v+ee]==e[v+ee-Z];++ee);if(ee>X){if(X=ee,Y=Z,ee>Q)break;var te=Math.min(Z,ee-2),ne=0;for(q=0;q<te;++q){var re=v-Z+q+32768&32767,ie=re-x[re]+32768&32767;ie>ne&&(ne=ie,G=re)}}}Z+=(j=G)-(G=x[j])+32768&32767}if(Y){R[F++]=268435456|f[X]<<18|g[Y];var ae=31&f[X],oe=31&g[Y];N+=s[ae]+l[oe],++k[257+ae],++C[oe],O=v+X,++I}else R[F++]=e[v],++k[e[v]]}}m=B(e,p,u,R,k,C,N,F,H,v-H,m),!u&&7&m&&(m=U(p,m+1,V))}return L(d,0,r+P(m)+c)},G=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),W=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=G[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}},q=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,a=n.length,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)i+=r+=n[o];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},X=function(e,t,n,r,i){return j(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)},Y=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},K=function(e,t,n){for(var r=e(),i=e.toString(),a=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<r.length;++o){var s=r[o],l=a[o];if("function"==typeof s){t+=";"+l+"=";var c=s.toString();if(s.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else for(var h in t+=c,s.prototype)t+=";"+l+".prototype."+h+"="+s.prototype[h].toString();else t+=c}else n[l]=s}return[t,n]},Z=[],Q=function(e,t,n,s){var l;if(!Z[n]){for(var c="",u={},h=e.length-1,d=0;d<h;++d)c=(l=K(e[d],c,u))[0],u=l[1];Z[n]=K(e[h],c,u)}var f=Y({},Z[n][1]);return function(e,t,n,i,a){var o=new Worker(r[t]||(r[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))));return o.onerror=function(e){return a(e.error,null)},o.onmessage=function(e){return a(null,e.data)},o.postMessage(n,i),o}(Z[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,f,function(e){var t=[];for(var n in e)(e[n]instanceof i||e[n]instanceof a||e[n]instanceof o)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(f),s)},J=function(){return[i,a,o,s,l,c,d,m,T,M,v,b,S,R,k,P,L,C,Se,ie,ae]},$=function(){return[i,a,o,s,l,c,f,g,x,E,A,w,v,z,V,b,I,N,F,O,H,D,U,B,P,L,j,X,xe,ie]},ee=function(){return[fe,ge,de,W,G]},te=function(){return[pe,me]},ne=function(){return[ve,de,q]},re=function(){return[ye]},ie=function(e){return postMessage(e,[e.buffer])},ae=function(e){return e&&e.size&&new i(e.size)},oe=function(e,t,n,r,i,a){var o=Q(n,r,i,(function(e,t){o.terminate(),a(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},se=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},le=function(e,t,n,r,i){var a,o=Q(e,r,i,(function(e,n){e?(o.terminate(),t.ondata.call(t,e)):(n[1]&&o.terminate(),t.ondata.call(t,e,n[0],n[1]))}));o.postMessage(n),t.push=function(e,n){if(a)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,a=n],[e.buffer])},t.terminate=function(){o.terminate()}},ce=function(e,t){return e[t]|e[t+1]<<8},ue=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},he=function(e,t){return ue(e,t)+4294967296*ue(e,t+4)},de=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},fe=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&de(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},pe=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},me=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},ge=function(e){return 10+(e.filename&&e.filename.length+1||0)},ve=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},ye=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function _e(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var be=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(X(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Ee=function(){return function(e,t){le([$,function(){return[se,be]}],this,_e.call(this,e,t),(function(e){var t=new be(e.data);onmessage=se(t)}),6)}}();function we(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return oe(e,t,[$],(function(e){return ie(xe(e.data[0],e.data[1]))}),0,n)}function xe(e,t){return X(e,t||{},0,0)}var Te=function(){function e(e){this.s={},this.p=new i(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new i(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=C(this.p,this.o,this.s);this.ondata(L(n,t,this.s.b),this.d),this.o=L(n,this.s.b-32768),this.s.b=this.o.length,this.p=L(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Ae=function(){return function(e){this.ondata=e,le([J,function(){return[se,Te]}],this,0,(function(){var e=new Te;onmessage=se(e)}),7)}}();function Me(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return oe(e,t,[J],(function(e){return ie(Se(e.data[0],ae(e.data[1])))}),1,n)}function Se(e,t){return C(e,t)}var Re=function(){function e(e,t){this.c=W(),this.l=0,this.v=1,be.call(this,e,t)}return e.prototype.push=function(e,t){be.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=X(e,this.o,this.v&&ge(this.o),t&&8,!t);this.v&&(fe(n,this.o),this.v=0),t&&(de(n,n.length-8,this.c.d()),de(n,n.length-4,this.l)),this.ondata(n,t)},e}(),ke=function(){return function(e,t){le([$,ee,function(){return[se,be,Re]}],this,_e.call(this,e,t),(function(e){var t=new Re(e.data);onmessage=se(t)}),8)}}();function Pe(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return oe(e,t,[$,ee,function(){return[Le]}],(function(e){return ie(Le(e.data[0],e.data[1]))}),2,n)}function Le(e,t){t||(t={});var n=W(),r=e.length;n.p(e);var i=X(e,t,ge(t),8),a=i.length;return fe(i,t),de(i,a-8,n.d()),de(i,a-4,r),i}var Ce=function(){function e(e){this.v=1,Te.call(this,e)}return e.prototype.push=function(e,t){if(Te.prototype.e.call(this,e),this.v){var n=this.p.length>3?pe(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Te.prototype.c.call(this,t)},e}(),Ie=function(){return function(e){this.ondata=e,le([J,te,function(){return[se,Te,Ce]}],this,0,(function(){var e=new Ce;onmessage=se(e)}),9)}}();function Ne(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return oe(e,t,[J,te,function(){return[Fe]}],(function(e){return ie(Fe(e.data[0]))}),3,n)}function Fe(e,t){return C(e.subarray(pe(e),-8),t||new i(me(e)))}var Oe=function(){function e(e,t){this.c=q(),this.v=1,be.call(this,e,t)}return e.prototype.push=function(e,t){be.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=X(e,this.o,this.v&&2,t&&4,!t);this.v&&(ve(n,this.o),this.v=0),t&&de(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),He=function(){return function(e,t){le([$,ne,function(){return[se,be,Oe]}],this,_e.call(this,e,t),(function(e){var t=new Oe(e.data);onmessage=se(t)}),10)}}();function De(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return oe(e,t,[$,ne,function(){return[Ue]}],(function(e){return ie(Ue(e.data[0],e.data[1]))}),4,n)}function Ue(e,t){t||(t={});var n=q();n.p(e);var r=X(e,t,2,4);return ve(r,t),de(r,r.length-4,n.d()),r}var Be=function(){function e(e){this.v=1,Te.call(this,e)}return e.prototype.push=function(e,t){if(Te.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Te.prototype.c.call(this,t)},e}(),ze=function(){return function(e){this.ondata=e,le([J,re,function(){return[se,Te,Be]}],this,0,(function(){var e=new Be;onmessage=se(e)}),11)}}();function Ve(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return oe(e,t,[J,re,function(){return[je]}],(function(e){return ie(je(e.data[0],ae(e.data[1])))}),5,n)}function je(e,t){return C((ye(e),e.subarray(2,-4)),t)}var Ge=function(){function e(e){this.G=Ce,this.I=Te,this.Z=Be,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new i(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,a=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(a):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,t),this.p=null}}},e}(),We=function(){function e(e){this.G=Ie,this.I=Ae,this.Z=ze,this.ondata=e}return e.prototype.push=function(e,t){Ge.prototype.push.call(this,e,t)},e}();function qe(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Ne(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Me(e,t,n):Ve(e,t,n)}function Xe(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Fe(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Se(e,t):je(e,t)}var Ye=function(e,t,n,r){for(var a in e){var o=e[a],s=t+a;o instanceof i?n[s]=[o,r]:Array.isArray(o)?n[s]=[o[0],Y(r,o[1])]:Ye(o,s+"/",n,r)}},Ke="undefined"!=typeof TextEncoder&&new TextEncoder,Ze="undefined"!=typeof TextDecoder&&new TextDecoder,Qe=0;try{Ze.decode(V,{stream:!0}),Qe=1}catch(e){}var Je=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,L(e,n-1)];i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&i?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}},$e=function(){function e(e){this.ondata=e,Qe?this.t=new TextDecoder:this.p=V}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new i(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=Je(n),a=r[0],o=r[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(a,t)}},e}(),et=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(tt(e),this.d=t||!1)},e}();function tt(e,t){if(t){for(var n=new i(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(Ke)return Ke.encode(e);var a=e.length,o=new i(e.length+(e.length>>1)),s=0,l=function(e){o[s++]=e};for(r=0;r<a;++r){if(s+5>o.length){var c=new i(s+8+(a-r<<1));c.set(o),o=c}var u=e.charCodeAt(r);u<128||t?l(u):u<2048?(l(192|u>>6),l(128|63&u)):u>55295&&u<57344?(l(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++r))>>18),l(128|u>>12&63),l(128|u>>6&63),l(128|63&u)):(l(224|u>>12),l(128|u>>6&63),l(128|63&u))}return L(o,0,s)}function nt(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(Ze)return Ze.decode(e);var i=Je(e),a=i[0];if(i[1].length)throw"invalid utf-8 data";return a}var rt=function(e){return 1==e?3:e<6?2:9==e?1:0},it=function(e,t){return t+30+ce(e,t+26)+ce(e,t+28)},at=function(e,t,n){var r=ce(e,t+28),i=nt(e.subarray(t+46,t+46+r),!(2048&ce(e,t+8))),a=t+46+r,o=ue(e,t+20),s=n&&4294967295==o?ot(e,a):[o,ue(e,t+24),ue(e,t+42)],l=s[0],c=s[1],u=s[2];return[ce(e,t+10),l,c,i,a+ce(e,t+30)+ce(e,t+32),u]},ot=function(e,t){for(;1!=ce(e,t);t+=4+ce(e,t+2));return[he(e,t+12),he(e,t+4),he(e,t+20)]},st=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;if(r>65535)throw"extra field too long";t+=r+4}return t},lt=function(e,t,n,r,i,a,o,s){var l=r.length,c=n.extra,u=s&&s.length,h=st(c);de(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==a&&8),e[t++]=i&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),f=d.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(de(e,t,f<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,null!=a&&(de(e,t,n.crc),de(e,t+4,a),de(e,t+8,n.size)),de(e,t+12,l),de(e,t+14,h),t+=16,null!=o&&(de(e,t,u),de(e,t+6,n.attrs),de(e,t+10,o),t+=14),e.set(r,t),t+=l,h)for(var p in c){var m=c[p],g=m.length;de(e,t,+p),de(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(s,t),t+=u),t},ct=function(e,t,n,r,i){de(e,t,101010256),de(e,t+8,n),de(e,t+10,n),de(e,t+12,r),de(e,t+16,i)},ut=function(){function e(e){this.filename=e,this.c=W(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),ht=function(){function e(e,t){var n=this;t||(t={}),ut.call(this,e),this.d=new be(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=rt(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){ut.prototype.push.call(this,e,t)},e}(),dt=function(){function e(e,t){var n=this;t||(t={}),ut.call(this,e),this.d=new Ee(t,(function(e,t,r){n.ondata(e,t,r)})),this.compression=8,this.flag=rt(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){ut.prototype.push.call(this,e,t)},e}(),ft=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=tt(e.filename),r=n.length,a=e.comment,o=a&&tt(a),s=r!=e.filename.length||o&&a.length!=o.length,l=r+st(e.extra)+30;if(r>65535)throw"filename too long";var c=new i(l);lt(c,0,e,n,s);var u=[c],h=function(){for(var e=0,n=u;e<n.length;e++){var r=n[e];t.ondata(null,r,!1)}u=[]},d=this.d;this.d=0;var f=this.u.length,p=Y(e,{f:n,u:s,o,t:function(){e.terminate&&e.terminate()},r:function(){if(h(),d){var e=t.u[f+1];e?e.r():t.d=1}d=1}}),m=0;e.ondata=function(n,r,a){if(n)t.ondata(n,r,a),t.terminate();else if(m+=r.length,u.push(r),a){var o=new i(16);de(o,0,134695760),de(o,4,e.crc),de(o,8,m),de(o,12,e.size),u.push(o),p.c=m,p.b=l+m+16,p.crc=e.crc,p.size=e.size,d&&p.r(),d=1}else d&&h()},this.u.push(p)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,r=0,a=this.u;r<a.length;r++){n+=46+(c=a[r]).f.length+st(c.extra)+(c.o?c.o.length:0)}for(var o=new i(n+22),s=0,l=this.u;s<l.length;s++){var c=l[s];lt(o,e,c,c.f,c.u,c.c,t,c.o),e+=46+c.f.length+st(c.extra)+(c.o?c.o.length:0),t+=c.b}ct(o,e,this.u.length,n,t),this.ondata(null,o,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}();function pt(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var r={};Ye(e,"",r,t);var a=Object.keys(r),o=a.length,s=0,l=0,c=o,u=new Array(o),h=[],d=function(){for(var e=0;e<h.length;++e)h[e]()},f=function(){var e=new i(l+22),t=s,r=l-s;l=0;for(var a=0;a<c;++a){var o=u[a];try{var h=o.c.length;lt(e,l,o,o.f,o.u,h);var d=30+o.f.length+st(o.extra),f=l+d;e.set(o.c,f),lt(e,s,o,o.f,o.u,h,l,o.m),s+=16+d+(o.m?o.m.length:0),l=f+h}catch(e){return n(e,null)}}ct(e,s,u.length,r,t),n(null,e)};o||f();for(var p=function(e){var t=a[e],i=r[t],c=i[0],p=i[1],m=W(),g=c.length;m.p(c);var v=tt(t),y=v.length,_=p.comment,b=_&&tt(_),E=b&&b.length,w=st(p.extra),x=0==p.level?0:8,T=function(r,i){if(r)d(),n(r,null);else{var a=i.length;u[e]=Y(p,{size:g,crc:m.d(),c:i,f:v,m:b,u:y!=t.length||b&&_.length!=E,compression:x}),s+=30+y+w+a,l+=76+2*(y+w)+(E||0)+a,--o||f()}};if(y>65535&&T("filename too long",null),x)if(g<16e4)try{T(null,xe(c,p))}catch(e){T(e,null)}else h.push(we(c,p,T));else T(null,c)},m=0;m<c;++m)p(m);return d}function mt(e,t){t||(t={});var n={},r=[];Ye(e,"",n,t);var a=0,o=0;for(var s in n){var l=n[s],c=l[0],u=l[1],h=0==u.level?0:8,d=(T=tt(s)).length,f=u.comment,p=f&&tt(f),m=p&&p.length,g=st(u.extra);if(d>65535)throw"filename too long";var v=h?xe(c,u):c,y=v.length,_=W();_.p(c),r.push(Y(u,{size:c.length,crc:_.d(),c:v,f:T,m:p,u:d!=s.length||p&&f.length!=m,o:a,compression:h})),a+=30+d+g+y,o+=76+2*(d+g)+(m||0)+y}for(var b=new i(o+22),E=a,w=o-a,x=0;x<r.length;++x){var T=r[x];lt(b,T.o,T,T.f,T.u,T.c.length);var A=30+T.f.length+st(T.extra);b.set(T.c,T.o+A),lt(b,a,T,T.f,T.u,T.c.length,T.o,T.m),a+=16+A+(T.m?T.m.length:0)}return ct(b,a,r.length,w,E),b}var gt=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),vt=function(){function e(){var e=this;this.i=new Te((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}(),yt=function(){function e(e,t){var n=this;t<32e4?this.i=new Te((function(e,t){n.ondata(null,e,t)})):(this.i=new Ae((function(e,t,r){n.ondata(e,t,r)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=L(e,0)),this.i.push(e,t)},e.compression=8,e}(),_t=function(){function e(e){this.onfile=e,this.k=[],this.o={0:gt},this.p=V}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),a=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(a,!this.c):this.k[0].push(a),(e=e.subarray(r)).length)return this.push(e,t)}else{var o=0,s=0,l=void 0,c=void 0;this.p.length?e.length?((c=new i(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,h=this.c,d=h&&this.d,f=function(){var e,t=ue(c,s);if(67324752==t){o=1,l=s,p.d=null,p.c=0;var r=ce(c,s+6),i=ce(c,s+8),a=2048&r,d=8&r,f=ce(c,s+26),m=ce(c,s+28);if(u>s+30+f+m){var g=[];p.k.unshift(g),o=2;var v,y=ue(c,s+18),_=ue(c,s+22),b=nt(c.subarray(s+30,s+=30+f),!a);4294967295==y?(e=d?[-2]:ot(c,s),y=e[0],_=e[1]):d&&(y=-1),s+=m,p.c=y;var E={name:b,compression:i,start:function(){if(!E.ondata)throw"no callback";if(y){var e=n.o[i];if(!e)throw"unknown compression type "+i;(v=y<0?new e(b):new e(b,y,_)).ondata=function(e,t,n){E.ondata(e,t,n)};for(var t=0,r=g;t<r.length;t++){var a=r[t];v.push(a,!1)}n.k[0]==g&&n.c?n.d=v:v.push(V,!0)}else E.ondata(null,V,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(E.size=y,E.originalSize=_),p.onfile(E)}return"break"}if(h){if(134695760==t)return l=s+=12+(-2==h&&8),o=3,p.c=0,"break";if(33639248==t)return l=s-=4,o=3,p.c=0,"break"}},p=this;s<u-4;++s){if("break"===f())break}if(this.p=V,h<0){var m=o?c.subarray(0,l-12-(-2==h&&8)-(134695760==ue(c,l-16)&&4)):c.subarray(0,s);d?d.push(m,!!o):this.k[+(2==o)].push(m)}if(2&o)return this.push(c.subarray(s),t);this.p=c.subarray(s)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function bt(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],r=function(){for(var e=0;e<n.length;++e)n[e]()},a={},o=e.length-22;101010256!=ue(e,o);--o)if(!o||e.length-o>65558)return void t("invalid zip file",null);var s=ce(e,o+8);s||t(null,{});var l=s,c=ue(e,o+16),u=4294967295==c;if(u){if(o=ue(e,o-12),101075792!=ue(e,o))return void t("invalid zip file",null);l=s=ue(e,o+32),c=ue(e,o+48)}for(var h=function(o){var l=at(e,c,u),h=l[0],d=l[1],f=l[2],p=l[3],m=l[4],g=l[5],v=it(e,g);c=m;var y=function(e,n){e?(r(),t(e,null)):(a[p]=n,--s||t(null,a))};if(h)if(8==h){var _=e.subarray(v,v+d);if(d<32e4)try{y(null,Se(_,new i(f)))}catch(e){y(e,null)}else n.push(Me(_,{size:f},y))}else y("unknown compression type "+h,null);else y(null,L(e,v,v+d))},d=0;d<l;++d)h();return r}function Et(e){for(var t={},n=e.length-22;101010256!=ue(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=ce(e,n+8);if(!r)return{};var a=ue(e,n+16),o=4294967295==a;if(o){if(n=ue(e,n-12),101075792!=ue(e,n))throw"invalid zip file";r=ue(e,n+32),a=ue(e,n+48)}for(var s=0;s<r;++s){var l=at(e,a,o),c=l[0],u=l[1],h=l[2],d=l[3],f=l[4],p=l[5],m=it(e,p);if(a=f,c){if(8!=c)throw"unknown compression type "+c;t[d]=Se(e.subarray(m,m+u),new i(h))}else t[d]=L(e,m,m+u)}return t}},4175:e=>{var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString;e.exports=function(e,r,i){if("[object Function]"!==n.call(r))throw new TypeError("iterator must be a function");var a=e.length;if(a===+a)for(var o=0;o<a;o++)r.call(i,e[o],o,e);else for(var s in e)t.call(e,s)&&r.call(i,e[s],s,e)}},7829:()=>{console.log("I'm `fs` modules")},9930:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,r=Object.prototype.toString,i="[object Function]";e.exports=function(e){var a=this;if("function"!=typeof a||r.call(a)!==i)throw new TypeError(t+a);for(var o,s=n.call(arguments,1),l=function(){if(this instanceof o){var t=a.apply(this,s.concat(n.call(arguments)));return Object(t)===t?t:this}return a.apply(e,s.concat(n.call(arguments)))},c=Math.max(0,a.length-s.length),u=[],h=0;h<c;h++)u.push("$"+h);if(o=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(l),a.prototype){var d=function(){};d.prototype=a.prototype,o.prototype=new d,d.prototype=null}return o}},1930:(e,t,n)=>{"use strict";var r=n(9930);e.exports=Function.prototype.bind||r},1801:(e,t,n)=>{"use strict";var r,i=SyntaxError,a=Function,o=TypeError,s=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},u=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,h=n(9905)(),d=Object.getPrototypeOf||function(e){return e.__proto__},f=s("async function* () {}"),p=f?f.prototype:r,m=p?p.prototype:r,g="undefined"==typeof Uint8Array?r:d(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h?d([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":s("async function () {}"),"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":m?d(m):r,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":a,"%GeneratorFunction%":s("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?d(d([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?d((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?d((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?d(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=n(1930),b=n(9284),E=_.call(Function.call,Array.prototype.concat),w=_.call(Function.apply,Array.prototype.splice),x=_.call(Function.call,String.prototype.replace),T=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,M=function(e){var t=[];return x(e,T,(function(e,n,r,i){t[t.length]=r?x(i,A,"$1"):n||e})),t},S=function(e,t){var n,r=e;if(b(y,r)&&(r="%"+(n=y[r])[0]+"%"),b(v,r)){var a=v[r];if(void 0===a&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:a}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var n=M(e),r=n.length>0?n[0]:"",i=S("%"+r+"%",t),a=i.name,s=i.value,c=!1,u=i.alias;u&&(r=u[0],w(n,E([0,1],u)));for(var h=1,d=!0;h<n.length;h+=1){var f=n[h];if("constructor"!==f&&d||(c=!0),b(v,a="%"+(r+="."+f)+"%"))s=v[a];else if(null!=s){if(l&&h+1>=n.length){var p=l(s,f);if(d=!!p,!t&&!(f in s))throw new o("base intrinsic for "+e+" exists, but the property is not available.");s=d&&"get"in p&&!("originalValue"in p.get)?p.get:s[f]}else d=b(s,f),s=s[f];d&&!c&&(v[a]=s)}}return s}},9905:(e,t,n)=>{"use strict";var r=n.g.Symbol,i=n(5682);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},5682:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},9284:(e,t,n)=>{"use strict";var r=n(1930);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},8575:e=>{"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},7092:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,i=n(7615)("Object.prototype.toString"),a=function(e){return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===i(e)},o=function(e){return!!a(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==i(e)&&"[object Function]"===i(e.callee)},s=function(){return a(arguments)}();a.isLegacyArguments=o,e.exports=s?a:o},7427:e=>{"use strict";var t=Object.prototype.toString,n=Function.prototype.toString,r=/^\s*(?:function)?\*/,i="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,a=Object.getPrototypeOf,o=function(){if(!i)return!1;try{return Function("return function*() {}")()}catch(e){}}(),s=!(!a||!o)&&a(o);e.exports=function(e){return"function"==typeof e&&(!!r.test(n.call(e))||(i?a&&a(e)===s:"[object GeneratorFunction]"===t.call(e)))}},2100:e=>{"use strict";e.exports=function(e){return e!=e}},8622:(e,t,n)=>{"use strict";var r=n(9170),i=n(2100),a=n(4358),o=n(6232),s=a();r(s,{getPolyfill:a,implementation:i,shim:o}),e.exports=s},4358:(e,t,n)=>{"use strict";var r=n(2100);e.exports=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:r}},6232:(e,t,n)=>{"use strict";var r=n(9170),i=n(4358);e.exports=function(){var e=i();return r(Number,{isNaN:e},{isNaN:function(){return Number.isNaN!==e}}),e}},2527:(e,t,n)=>{"use strict";var r=n(4175),i=n(8455),a=n(7615),o=a("Object.prototype.toString"),s=n(9905)()&&"symbol"==typeof Symbol.toStringTag,l=i(),c=a("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},u=a("String.prototype.slice"),h={},d=n(8711),f=Object.getPrototypeOf;s&&d&&f&&r(l,(function(e){var t=new n.g[e];if(!(Symbol.toStringTag in t))throw new EvalError("this engine has support for Symbol.toStringTag, but "+e+" does not have the property! Please report this.");var r=f(t),i=d(r,Symbol.toStringTag);if(!i){var a=f(r);i=d(a,Symbol.toStringTag)}h[e]=i.get}));e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!s){var t=u(o(e),8,-1);return c(l,t)>-1}return!!d&&function(e){var t=!1;return r(h,(function(n,r){if(!t)try{t=n.call(e)===r}catch(e){}})),t}(e)}},6972:e=>{"use strict";var t=t||{};t.lossless=t.lossless||{},t.lossless.ComponentSpec=t.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0};e.exports&&(e.exports=t.lossless.ComponentSpec)},3147:e=>{"use strict";var t=t||{};t.lossless=t.lossless||{},t.lossless.DataStream=t.lossless.DataStream||function(e,t,n){this.buffer=void 0===t&&void 0===n?new Uint8Array(e):new Uint8Array(e,t,n),this.index=0},t.lossless.DataStream.prototype.get16=function(){var e=(this.buffer[this.index]<<8)+this.buffer[this.index+1];return this.index+=2,e},t.lossless.DataStream.prototype.get8=function(){var e=this.buffer[this.index];return this.index+=1,e};e.exports&&(e.exports=t.lossless.DataStream)},9668:(e,t,n)=>{"use strict";var r,i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||n(3147),i.lossless.HuffmanTable=i.lossless.HuffmanTable||n(9053),i.lossless.QuantizationTable=i.lossless.QuantizationTable||n(4041),i.lossless.ScanHeader=i.lossless.ScanHeader||n(6750),i.lossless.FrameHeader=i.lossless.FrameHeader||n(2346),i.lossless.Utils=i.lossless.Utils||n(8278),i.lossless.Decoder=i.lossless.Decoder||function(e,t){this.buffer=e,this.frame=new i.lossless.FrameHeader,this.huffTable=new i.lossless.HuffmanTable,this.quantTable=new i.lossless.QuantizationTable,this.scan=new i.lossless.ScanHeader,this.DU=i.lossless.Utils.createArray(10,4,64),this.HuffTab=i.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=i.lossless.Utils.createArray(10,1),this.dcTab=i.lossless.Utils.createArray(10,1),this.qTab=i.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,void 0!==t&&(this.numBytes=t)},i.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],i.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],i.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,i.lossless.Decoder.MSB=2147483648,i.lossless.Decoder.RESTART_MARKER_BEGIN=65488,i.lossless.Decoder.RESTART_MARKER_END=65495,i.lossless.Decoder.prototype.decompress=function(e,t,n){return this.decode(e,t,n).buffer},i.lossless.Decoder.prototype.decode=function(e,t,n,r){var a,o,s,l,c=0,u=[],h=[],d=[];if(void 0!==e&&(this.buffer=e),void 0!==r&&(this.numBytes=r),this.stream=new i.lossless.DataStream(this.buffer,t,n),this.buffer=null,this.xLoc=0,this.yLoc=0,65496!==(a=this.stream.get16()))throw new Error("Not a JPEG file");for(a=this.stream.get16();a>>4!=4092||65476===a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (decode)")}a=this.stream.get16()}if(a<65472||a>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),a=this.stream.get16();do{for(;65498!==a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}a=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,o=0;o<this.numComp;o+=1)s=this.scanComps[o].scanCompSel,this.qTab[o]=this.quantTables[this.components[s].quantTableSel],this.nBlock[o]=this.components[s].vSamp*this.components[s].hSamp,this.dcTab[o]=this.HuffTab[this.scanComps[o].dcTabSel][0],this.acTab[o]=this.HuffTab[this.scanComps[o].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,1==this.numBytes?this.outputData=new Uint8Array(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)):this.outputData=new Uint16Array(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),c+=1;;){for(h[0]=0,d[0]=0,o=0;o<10;o+=1)u[o]=1<<this.precision-1;if(0===this.restartInterval){for(a=this.decodeUnit(u,h,d);0===a&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(u),a=this.decodeUnit(u,h,d);break}for(l=0;l<this.restartInterval&&(this.restarting=0==l,a=this.decodeUnit(u,h,d),this.output(u),0===a);l+=1);if(0===a&&(0!==this.markerIndex?(a=65280|this.marker,this.markerIndex=0):a=this.stream.get16()),!(a>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&a<=i.lossless.Decoder.RESTART_MARKER_END))break}65500===a&&1===c&&(this.readNumber(),a=this.stream.get16())}while(65497!==a&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===c);return this.outputData},i.lossless.Decoder.prototype.decodeUnit=function(e,t,n){return 1==this.numComp?this.decodeSingle(e,t,n):3==this.numComp?this.decodeRGB(e,t,n):-1},i.lossless.Decoder.prototype.select1=function(e){return this.getPreviousX(e)},i.lossless.Decoder.prototype.select2=function(e){return this.getPreviousY(e)},i.lossless.Decoder.prototype.select3=function(e){return this.getPreviousXY(e)},i.lossless.Decoder.prototype.select4=function(e){return this.getPreviousX(e)+this.getPreviousY(e)-this.getPreviousXY(e)},i.lossless.Decoder.prototype.select5=function(e){return this.getPreviousX(e)+(this.getPreviousY(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select6=function(e){return this.getPreviousY(e)+(this.getPreviousX(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select7=function(e){return(this.getPreviousX(e)+this.getPreviousY(e))/2},i.lossless.Decoder.prototype.decodeRGB=function(e,t,n){var r,a,o,s,l,c,u,h;for(e[0]=this.selector(0),e[1]=this.selector(1),e[2]=this.selector(2),l=0;l<this.numComp;l+=1)for(s=this.qTab[l],a=this.acTab[l],o=this.dcTab[l],c=0;c<this.nBlock[l];c+=1){for(u=0;u<this.IDCT_Source.length;u+=1)this.IDCT_Source[u]=0;if((r=this.getHuffmanValue(o,t,n))>=65280)return r;for(e[l]=this.IDCT_Source[0]=e[l]+this.getn(n,r,t,n),this.IDCT_Source[0]*=s[0],h=1;h<64;h+=1){if((r=this.getHuffmanValue(a,t,n))>=65280)return r;if(h+=r>>4,0==(15&r)){if(r>>4==0)break}else this.IDCT_Source[i.lossless.Decoder.IDCT_P[h]]=this.getn(n,15&r,t,n)*s[h]}}return 0},i.lossless.Decoder.prototype.decodeSingle=function(e,t,n){var r,a,o,s;for(this.restarting?(this.restarting=!1,e[0]=1<<this.frame.precision-1):e[0]=this.selector(),a=0;a<this.nBlock[0];a+=1){if((r=this.getHuffmanValue(this.dcTab[0],t,n))>=65280)return r;if((s=(o=this.getn(e,r,t,n))>>8)>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&s<=i.lossless.Decoder.RESTART_MARKER_END)return s;e[0]+=o}return 0},i.lossless.Decoder.prototype.getHuffmanValue=function(e,t,n){var r,a;if(65535,n[0]<8?(t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a):n[0]-=8,0!=((r=e[t[0]>>n[0]])&i.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;t[0]&=65535>>16-n[0],t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a,r=e[256*(255&r)+(t[0]>>n[0])],n[0]+=8}if(n[0]+=8-(r>>8),n[0]<0)throw new Error("index="+n[0]+" temp="+t[0]+" code="+r+" in HuffmanValue()");return n[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(t[0]&=65535>>16-n[0],255&r)},i.lossless.Decoder.prototype.getn=function(e,t,n,r){var i,a;if(1,-1,65535,0===t)return 0;if(16===t)return e[0]>=0?-32768:32768;if(r[0]-=t,r[0]>=0){if(r[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;i=n[0]>>r[0],n[0]&=65535>>16-r[0]}else{if(n[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=a,r[0]+=8,r[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;n[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=a,r[0]+=8}if(r[0]<0)throw new Error("index="+r[0]+" in getn()");if(r[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;i=n[0]>>r[0],n[0]&=65535>>16-r[0]}return i<1<<t-1&&(i+=1+(-1<<t)),i},i.lossless.Decoder.prototype.getPreviousX=function(e){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,e):this.yLoc>0?this.getPreviousY(e):1<<this.frame.precision-1},i.lossless.Decoder.prototype.getPreviousXY=function(e){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,e):this.getPreviousY(e)},i.lossless.Decoder.prototype.getPreviousY=function(e){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,e):this.getPreviousX(e)},i.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},i.lossless.Decoder.prototype.outputSingle=function(e){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&e[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.outputRGB=function(e){var t=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(t,e[0],0),this.setter(t,e[1],1),this.setter(t,e[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.setValue8=function(e,t){this.outputData[e]=t},i.lossless.Decoder.prototype.getValue8=function(e){return this.outputData[e]},(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0])?(i.lossless.Decoder.prototype.setValue16=i.lossless.Decoder.prototype.setValue8,i.lossless.Decoder.prototype.getValue16=i.lossless.Decoder.prototype.getValue8):(i.lossless.Decoder.prototype.setValue16=function(e,t){this.outputData[e]=(255&t)<<8|t>>8&255},i.lossless.Decoder.prototype.getValue16=function(e){var t=this.outputData[e];return(255&t)<<8|t>>8&255}),i.lossless.Decoder.prototype.setValueRGB=function(e,t,n){this.outputData[3*e+n]=t},i.lossless.Decoder.prototype.getValueRGB=function(e,t){return this.outputData[3*e+t]},i.lossless.Decoder.prototype.readApp=function(){var e=0,t=this.stream.get16();for(e+=2;e<t;)this.stream.get8(),e+=1;return t},i.lossless.Decoder.prototype.readComment=function(){var e,t="",n=0;for(e=this.stream.get16(),n+=2;n<e;)t+=this.stream.get8(),n+=1;return t},i.lossless.Decoder.prototype.readNumber=function(){if(4!==this.stream.get16())throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()};e.exports&&(e.exports=i.lossless.Decoder)},2346:(e,t,n)=>{"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.ComponentSpec=r.lossless.ComponentSpec||n(6972),r.lossless.DataStream=r.lossless.DataStream||n(3147),r.lossless.FrameHeader=r.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},r.lossless.FrameHeader.prototype.read=function(e){var t,n,i,a,o=0;for(t=e.get16(),o+=2,this.precision=e.get8(),o+=1,this.dimY=e.get16(),o+=2,this.dimX=e.get16(),o+=2,this.numComp=e.get8(),o+=1,n=1;n<=this.numComp;n+=1){if(o>t)throw new Error("ERROR: frame format error");if(i=e.get8(),(o+=1)>=t)throw new Error("ERROR: frame format error [c>=Lf]");a=e.get8(),o+=1,this.components[i]||(this.components[i]=new r.lossless.ComponentSpec),this.components[i].hSamp=a>>4,this.components[i].vSamp=15&a,this.components[i].quantTableSel=e.get8(),o+=1}if(o!==t)throw new Error("ERROR: frame format error [Lf!=count]");return 1};e.exports&&(e.exports=r.lossless.FrameHeader)},9053:(e,t,n)=>{"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.DataStream=r.lossless.DataStream||n(3147),r.lossless.Utils=r.lossless.Utils||n(8278),r.lossless.HuffmanTable=r.lossless.HuffmanTable||function(){this.l=r.lossless.Utils.createArray(4,2,16),this.th=[],this.v=r.lossless.Utils.createArray(4,2,16,200),this.tc=r.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},r.lossless.HuffmanTable.MSB=2147483648,r.lossless.HuffmanTable.prototype.read=function(e,t){var n,r,i,a,o,s,l=0;for(n=e.get16(),l+=2;l<n;){if(l+=1,(i=15&(r=e.get8()))>3)throw new Error("ERROR: Huffman table ID > 3");if((a=r>>4)>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[i]=1,this.tc[i][a]=1,o=0;o<16;o+=1)this.l[i][a][o]=e.get8(),l+=1;for(o=0;o<16;o+=1)for(s=0;s<this.l[i][a][o];s+=1){if(l>n)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[i][a][o][s]=e.get8(),l+=1}}if(l!==n)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(o=0;o<4;o+=1)for(s=0;s<2;s+=1)0!==this.tc[o][s]&&this.buildHuffTable(t[o][s],this.l[o][s],this.v[o][s]);return 1},r.lossless.HuffmanTable.prototype.buildHuffTable=function(e,t,n){var i,a,o,s,l;for(256,a=0,o=0;o<8;o+=1)for(s=0;s<t[o];s+=1)for(l=0;l<256>>o+1;l+=1)e[a]=n[o][s]|o+1<<8,a+=1;for(o=1;a<256;o+=1,a+=1)e[a]=o|r.lossless.HuffmanTable.MSB;for(i=1,a=0,o=8;o<16;o+=1)for(s=0;s<t[o];s+=1){for(l=0;l<256>>o-7;l+=1)e[256*i+a]=n[o][s]|o+1<<8,a+=1;if(a>=256){if(a>256)throw new Error("ERROR: Huffman table error(1)!");a=0,i+=1}}};e.exports&&(e.exports=r.lossless.HuffmanTable)},9731:(e,t,n)=>{"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.ComponentSpec=r.lossless.ComponentSpec||n(6972),r.lossless.DataStream=r.lossless.DataStream||n(3147),r.lossless.Decoder=r.lossless.Decoder||n(9668),r.lossless.FrameHeader=r.lossless.FrameHeader||n(2346),r.lossless.HuffmanTable=r.lossless.HuffmanTable||n(9053),r.lossless.QuantizationTable=r.lossless.QuantizationTable||n(4041),r.lossless.ScanComponent=r.lossless.ScanComponent||n(2848),r.lossless.ScanHeader=r.lossless.ScanHeader||n(6750),r.lossless.Utils=r.lossless.Utils||n(8278);e.exports&&(e.exports=r)},4041:(e,t,n)=>{"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.DataStream=r.lossless.DataStream||n(3147),r.lossless.Utils=r.lossless.Utils||n(8278),r.lossless.QuantizationTable=r.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=r.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},r.lossless.QuantizationTable.enhanceQuantizationTable=function(e,t){var n;for(n=0;n<8;n+=1)e[t[0+n]]*=90,e[t[32+n]]*=90,e[t[16+n]]*=118,e[t[48+n]]*=49,e[t[40+n]]*=71,e[t[8+n]]*=126,e[t[56+n]]*=25,e[t[24+n]]*=106;for(n=0;n<8;n+=1)e[t[0+8*n]]*=90,e[t[4+8*n]]*=90,e[t[2+8*n]]*=118,e[t[6+8*n]]*=49,e[t[5+8*n]]*=71,e[t[1+8*n]]*=126,e[t[7+8*n]]*=25,e[t[3+8*n]]*=106;for(n=0;n<64;n+=1)e[n]>>=6},r.lossless.QuantizationTable.prototype.read=function(e,t){var n,i,a,o,s=0;for(n=e.get16(),s+=2;s<n;){if(s+=1,(a=15&(i=e.get8()))>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[a]=i>>4,0===this.precision[a])this.precision[a]=8;else{if(1!==this.precision[a])throw new Error("ERROR: Quantization table precision error");this.precision[a]=16}if(this.tq[a]=1,8===this.precision[a]){for(o=0;o<64;o+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[a][o]=e.get8(),s+=1}r.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}else{for(o=0;o<64;o+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[a][o]=e.get16(),s+=2}r.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}}if(s!==n)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1};e.exports&&(e.exports=r.lossless.QuantizationTable)},2848:e=>{"use strict";var t=t||{};t.lossless=t.lossless||{},t.lossless.ScanComponent=t.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0};e.exports&&(e.exports=t.lossless.ScanComponent)},6750:(e,t,n)=>{"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.DataStream=r.lossless.DataStream||n(3147),r.lossless.ScanComponent=r.lossless.ScanComponent||n(2848),r.lossless.ScanHeader=r.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},r.lossless.ScanHeader.prototype.read=function(e){var t,n,i,a=0;for(t=e.get16(),a+=2,this.numComp=e.get8(),a+=1,n=0;n<this.numComp;n+=1){if(this.components[n]=new r.lossless.ScanComponent,a>t)throw new Error("ERROR: scan header format error");this.components[n].scanCompSel=e.get8(),a+=1,i=e.get8(),a+=1,this.components[n].dcTabSel=i>>4,this.components[n].acTabSel=15&i}if(this.selection=e.get8(),a+=1,this.spectralEnd=e.get8(),a+=1,i=e.get8(),this.ah=i>>4,this.al=15&i,(a+=1)!==t)throw new Error("ERROR: scan header format error [count!=Ns]");return 1};e.exports&&(e.exports=r.lossless.ScanHeader)},8278:e=>{"use strict";var t=t||{};t.lossless=t.lossless||{},t.lossless.Utils=t.lossless.Utils||{},t.lossless.Utils.createArray=function(e){var n=new Array(e||0),r=e;if(arguments.length>1)for(var i=Array.prototype.slice.call(arguments,1);r--;)n[e-1-r]=t.lossless.Utils.createArray.apply(this,i);return n},t.lossless.Utils.makeCRCTable=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},t.lossless.Utils.crc32=function(e){for(var n=new Uint8Array(e.buffer),r=t.lossless.Utils.crcTable||(t.lossless.Utils.crcTable=t.lossless.Utils.makeCRCTable()),i=-1,a=0;a<n.length;a++)i=i>>>8^r[255&(i^n[a])];return(-1^i)>>>0};e.exports&&(e.exports=t.lossless.Utils)},9602:(e,t,n)=>{"use strict";var r=r||{};r.NIFTI1=r.NIFTI1||n(9643),r.NIFTI2=r.NIFTI2||n(2269),r.Utils=r.Utils||n(7002);var i=i||n(4316);r.isNIFTI1=function(e){var t,n,i,a;return!(e.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE)&&((t=new DataView(e))&&(n=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION)),i=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(n!==r.NIFTI1.MAGIC_NUMBER[0]||i!==r.NIFTI1.MAGIC_NUMBER[1]||a!==r.NIFTI1.MAGIC_NUMBER[2]))},r.isNIFTI2=function(e){var t,n,i,a;return!(e.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE)&&(n=(t=new DataView(e)).getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION),i=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(n!==r.NIFTI2.MAGIC_NUMBER[0]||i!==r.NIFTI2.MAGIC_NUMBER[1]||a!==r.NIFTI2.MAGIC_NUMBER[2]))},r.isNIFTI=function(e){return r.isNIFTI1(e)||r.isNIFTI2(e)},r.isCompressed=function(e){var t,n,i;if(e){if(n=(t=new DataView(e)).getUint8(0),i=t.getUint8(1),n===r.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(i===r.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},r.decompress=function(e){return i.inflate(e).buffer},r.readHeader=function(e){var t=null;return r.isCompressed(e)&&(e=r.decompress(e)),r.isNIFTI1(e)?t=new r.NIFTI1:r.isNIFTI2(e)&&(t=new r.NIFTI2),t?t.readHeader(e):console.error("That file does not appear to be NIFTI!"),t},r.hasExtension=function(e){return 0!=e.extensionFlag[0]},r.readImage=function(e,t){var n=e.vox_offset,r=1,i=1;e.dims[4]&&(r=e.dims[4]),e.dims[5]&&(i=e.dims[5]);var a=e.dims[1]*e.dims[2]*e.dims[3]*r*i*(e.numBitsPerVoxel/8);return t.slice(n,n+a)},r.readExtension=function(e,t){var n=e.getExtensionLocation(),r=e.extensionSize;return t.slice(n,n+r)},r.readExtensionData=function(e,t){var n=e.getExtensionLocation(),r=e.extensionSize;return t.slice(n+8,n+r-8)};e.exports&&(e.exports=r)},9643:(e,t,n)=>{"use strict";var r=r||{};r.Utils=r.Utils||n(7002),r.NIFTI1=r.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},r.NIFTI1.TYPE_NONE=0,r.NIFTI1.TYPE_BINARY=1,r.NIFTI1.TYPE_UINT8=2,r.NIFTI1.TYPE_INT16=4,r.NIFTI1.TYPE_INT32=8,r.NIFTI1.TYPE_FLOAT32=16,r.NIFTI1.TYPE_COMPLEX64=32,r.NIFTI1.TYPE_FLOAT64=64,r.NIFTI1.TYPE_RGB24=128,r.NIFTI1.TYPE_INT8=256,r.NIFTI1.TYPE_UINT16=512,r.NIFTI1.TYPE_UINT32=768,r.NIFTI1.TYPE_INT64=1024,r.NIFTI1.TYPE_UINT64=1280,r.NIFTI1.TYPE_FLOAT128=1536,r.NIFTI1.TYPE_COMPLEX128=1792,r.NIFTI1.TYPE_COMPLEX256=2048,r.NIFTI1.XFORM_UNKNOWN=0,r.NIFTI1.XFORM_SCANNER_ANAT=1,r.NIFTI1.XFORM_ALIGNED_ANAT=2,r.NIFTI1.XFORM_TALAIRACH=3,r.NIFTI1.XFORM_MNI_152=4,r.NIFTI1.SPATIAL_UNITS_MASK=7,r.NIFTI1.TEMPORAL_UNITS_MASK=56,r.NIFTI1.UNITS_UNKNOWN=0,r.NIFTI1.UNITS_METER=1,r.NIFTI1.UNITS_MM=2,r.NIFTI1.UNITS_MICRON=3,r.NIFTI1.UNITS_SEC=8,r.NIFTI1.UNITS_MSEC=16,r.NIFTI1.UNITS_USEC=24,r.NIFTI1.UNITS_HZ=32,r.NIFTI1.UNITS_PPM=40,r.NIFTI1.UNITS_RADS=48,r.NIFTI1.MAGIC_COOKIE=348,r.NIFTI1.STANDARD_HEADER_SIZE=348,r.NIFTI1.MAGIC_NUMBER_LOCATION=344,r.NIFTI1.MAGIC_NUMBER=[110,43,49],r.NIFTI1.MAGIC_NUMBER2=[110,105,49],r.NIFTI1.EXTENSION_HEADER_SIZE=8,r.NIFTI1.prototype.readHeader=function(e){var t,n,i,a,o=new DataView(e),s=r.Utils.getIntAt(o,0,this.littleEndian);if(s!==r.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,s=r.Utils.getIntAt(o,0,this.littleEndian)),s!==r.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=r.Utils.getByteAt(o,39),t=0;t<8;t+=1)a=40+2*t,this.dims[t]=r.Utils.getShortAt(o,a,this.littleEndian);for(this.intent_p1=r.Utils.getFloatAt(o,56,this.littleEndian),this.intent_p2=r.Utils.getFloatAt(o,60,this.littleEndian),this.intent_p3=r.Utils.getFloatAt(o,64,this.littleEndian),this.intent_code=r.Utils.getShortAt(o,68,this.littleEndian),this.datatypeCode=r.Utils.getShortAt(o,70,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(o,72,this.littleEndian),this.slice_start=r.Utils.getShortAt(o,74,this.littleEndian),t=0;t<8;t+=1)a=76+4*t,this.pixDims[t]=r.Utils.getFloatAt(o,a,this.littleEndian);for(this.vox_offset=r.Utils.getFloatAt(o,108,this.littleEndian),this.scl_slope=r.Utils.getFloatAt(o,112,this.littleEndian),this.scl_inter=r.Utils.getFloatAt(o,116,this.littleEndian),this.slice_end=r.Utils.getShortAt(o,120,this.littleEndian),this.slice_code=r.Utils.getByteAt(o,122),this.xyzt_units=r.Utils.getByteAt(o,123),this.cal_max=r.Utils.getFloatAt(o,124,this.littleEndian),this.cal_min=r.Utils.getFloatAt(o,128,this.littleEndian),this.slice_duration=r.Utils.getFloatAt(o,132,this.littleEndian),this.toffset=r.Utils.getFloatAt(o,136,this.littleEndian),this.description=r.Utils.getStringAt(o,148,228),this.aux_file=r.Utils.getStringAt(o,228,252),this.qform_code=r.Utils.getShortAt(o,252,this.littleEndian),this.sform_code=r.Utils.getShortAt(o,254,this.littleEndian),this.quatern_b=r.Utils.getFloatAt(o,256,this.littleEndian),this.quatern_c=r.Utils.getFloatAt(o,260,this.littleEndian),this.quatern_d=r.Utils.getFloatAt(o,264,this.littleEndian),this.qoffset_x=r.Utils.getFloatAt(o,268,this.littleEndian),this.qoffset_y=r.Utils.getFloatAt(o,272,this.littleEndian),this.qoffset_z=r.Utils.getFloatAt(o,276,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)a=280+4*(4*n+i),this.affine[n][i]=r.Utils.getFloatAt(o,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=r.Utils.getStringAt(o,328,344),this.magic=r.Utils.getStringAt(o,344,348),this.isHDR=this.magic===r.NIFTI1.MAGIC_NUMBER2,o.byteLength>r.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(o,348),this.extensionFlag[1]=r.Utils.getByteAt(o,349),this.extensionFlag[2]=r.Utils.getByteAt(o,350),this.extensionFlag[3]=r.Utils.getByteAt(o,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(o),this.extensionCode=this.getExtensionCode(o)))},r.NIFTI1.prototype.toFormattedString=function(){var e=r.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},r.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===r.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===r.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===r.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===r.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===r.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===r.NIFTI1.TYPE_RGB24?"RGB":e===r.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===r.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===r.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===r.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===r.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},r.NIFTI1.prototype.getTransformCodeString=function(e){return e===r.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===r.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===r.NIFTI1.XFORM_TALAIRACH?"Talairach":e===r.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},r.NIFTI1.prototype.getUnitsCodeString=function(e){return e===r.NIFTI1.UNITS_METER?"Meters":e===r.NIFTI1.UNITS_MM?"Millimeters":e===r.NIFTI1.UNITS_MICRON?"Microns":e===r.NIFTI1.UNITS_SEC?"Seconds":e===r.NIFTI1.UNITS_MSEC?"Milliseconds":e===r.NIFTI1.UNITS_USEC?"Microseconds":e===r.NIFTI1.UNITS_HZ?"Hz":e===r.NIFTI1.UNITS_PPM?"PPM":e===r.NIFTI1.UNITS_RADS?"Rads":"Unknown"},r.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,n,r,i,a,o,s,l,c){var u,h,d,f,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=e,g=t,v=n;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(u=1-(m*m+g*g+v*v))<1e-7?(m*=u=1/Math.sqrt(m*m+g*g+v*v),g*=u,v*=u,u=0):u=Math.sqrt(u),h=o>0?o:1,d=s>0?s:1,f=l>0?l:1,c<0&&(f=-f),p[0][0]=(u*u+m*m-g*g-v*v)*h,p[0][1]=2*(m*g-u*v)*d,p[0][2]=2*(m*v+u*g)*f,p[1][0]=2*(m*g+u*v)*h,p[1][1]=(u*u+g*g-m*m-v*v)*d,p[1][2]=2*(g*v-u*m)*f,p[2][0]=2*(m*v-u*g)*h,p[2][1]=2*(g*v+u*m)*d,p[2][2]=(u*u+v*v-g*g-m*m)*f,p[0][3]=r,p[1][3]=i,p[2][3]=a,p},r.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v,y,_,b,E,w,x,T,A,M,S,R,k,P,L,C,I;if(p=0,M=[[0,0,0],[0,0,0],[0,0,0]],S=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],n=e[0][1],r=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],c=e[2][2],0===(u=Math.sqrt(t*t+i*i+s*s)))return null;if(t/=u,i/=u,s/=u,0===(u=Math.sqrt(n*n+a*a+l*l)))return null;if(u=t*(n/=u)+i*(a/=u)+s*(l/=u),Math.abs(u)>1e-4){if(n-=u*t,a-=u*i,l-=u*s,0===(u=Math.sqrt(n*n+a*a+l*l)))return null;n/=u,a/=u,l/=u}if(0===(u=Math.sqrt(r*r+o*o+c*c))?(r=i*l-s*a,o=s*n-l*t,c=t*a-i*n):(r/=u,o/=u,c/=u),u=t*r+i*o+s*c,Math.abs(u)>1e-4){if(r-=u*t,o-=u*i,c-=u*s,0===(u=Math.sqrt(r*r+o*o+c*c)))return null;r/=u,o/=u,c/=u}if(u=n*r+a*o+l*c,Math.abs(u)>1e-4){if(r-=u*n,o-=u*a,c-=u*l,0===(u=Math.sqrt(r*r+o*o+c*c)))return null;r/=u,o/=u,c/=u}if(M[0][0]=t,M[0][1]=n,M[0][2]=r,M[1][0]=i,M[1][1]=a,M[1][2]=o,M[2][0]=s,M[2][1]=l,M[2][2]=c,0===(h=this.nifti_mat33_determ(M)))return null;for(A=-666,y=E=w=x=1,_=2,b=3,d=1;d<=3;d+=1)for(f=1;f<=3;f+=1)if(d!==f)for(p=1;p<=3;p+=1)if(d!==p&&f!==p)for(S[0][0]=S[0][1]=S[0][2]=S[1][0]=S[1][1]=S[1][2]=S[2][0]=S[2][1]=S[2][2]=0,m=-1;m<=1;m+=2)for(g=-1;g<=1;g+=2)for(v=-1;v<=1;v+=2)S[0][d-1]=m,S[1][f-1]=g,S[2][p-1]=v,this.nifti_mat33_determ(S)*h>0&&(u=(T=this.nifti_mat33_mul(S,M))[0][0]+T[1][1]+T[2][2])>A&&(A=u,y=d,_=f,b=p,E=m,w=g,x=v);switch(R=k=P=L=C=I=0,y*E){case 1:R="X",L="+";break;case-1:R="X",L="-";break;case 2:R="Y",L="+";break;case-2:R="Y",L="-";break;case 3:R="Z",L="+";break;case-3:R="Z",L="-"}switch(_*w){case 1:k="X",C="+";break;case-1:k="X",C="-";break;case 2:k="Y",C="+";break;case-2:k="Y",C="-";break;case 3:k="Z",C="+";break;case-3:k="Z",C="-"}switch(b*x){case 1:P="X",I="+";break;case-1:P="X",I="-";break;case 2:P="Y",I="+";break;case-2:P="Y",I="-";break;case 3:P="Z",I="+";break;case-3:P="Z",I="-"}return R+k+P+L+C+I},r.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var n,r,i=[[0,0,0],[0,0,0],[0,0,0]];for(n=0;n<3;n+=1)for(r=0;r<3;r+=1)i[n][r]=e[n][0]*t[0][r]+e[n][1]*t[1][r]+e[n][2]*t[2][r];return i},r.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,n,r,i,a,o,s,l,c;return t=e[0][0],n=e[0][1],r=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],t*a*(c=e[2][2])-t*l*o-i*n*c+i*l*r+s*n*o-s*a*r},r.NIFTI1.prototype.getExtensionLocation=function(){return r.NIFTI1.MAGIC_COOKIE+4},r.NIFTI1.prototype.getExtensionSize=function(e){return r.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},r.NIFTI1.prototype.getExtensionCode=function(e){return r.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)};e.exports&&(e.exports=r.NIFTI1)},2269:(e,t,n)=>{"use strict";var r=r||{};r.Utils=r.Utils||n(7002),r.NIFTI1=r.NIFTI1||n(9643),r.NIFTI2=r.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},r.NIFTI2.MAGIC_COOKIE=540,r.NIFTI2.MAGIC_NUMBER_LOCATION=4,r.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],r.NIFTI2.prototype.readHeader=function(e){var t,n,i,a,o=new DataView(e),s=r.Utils.getIntAt(o,0,this.littleEndian);if(s!==r.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,s=r.Utils.getIntAt(o,0,this.littleEndian)),s!==r.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=r.Utils.getShortAt(o,12,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(o,14,this.littleEndian),t=0;t<8;t+=1)a=16+8*t,this.dims[t]=r.Utils.getLongAt(o,a,this.littleEndian);for(this.intent_p1=r.Utils.getDoubleAt(o,80,this.littleEndian),this.intent_p2=r.Utils.getDoubleAt(o,88,this.littleEndian),this.intent_p3=r.Utils.getDoubleAt(o,96,this.littleEndian),t=0;t<8;t+=1)a=104+8*t,this.pixDims[t]=r.Utils.getDoubleAt(o,a,this.littleEndian);for(this.vox_offset=r.Utils.getLongAt(o,168,this.littleEndian),this.scl_slope=r.Utils.getDoubleAt(o,176,this.littleEndian),this.scl_inter=r.Utils.getDoubleAt(o,184,this.littleEndian),this.cal_max=r.Utils.getDoubleAt(o,192,this.littleEndian),this.cal_min=r.Utils.getDoubleAt(o,200,this.littleEndian),this.slice_duration=r.Utils.getDoubleAt(o,208,this.littleEndian),this.toffset=r.Utils.getDoubleAt(o,216,this.littleEndian),this.slice_start=r.Utils.getLongAt(o,224,this.littleEndian),this.slice_end=r.Utils.getLongAt(o,232,this.littleEndian),this.description=r.Utils.getStringAt(o,240,320),this.aux_file=r.Utils.getStringAt(o,320,344),this.qform_code=r.Utils.getIntAt(o,344,this.littleEndian),this.sform_code=r.Utils.getIntAt(o,348,this.littleEndian),this.quatern_b=r.Utils.getDoubleAt(o,352,this.littleEndian),this.quatern_c=r.Utils.getDoubleAt(o,360,this.littleEndian),this.quatern_d=r.Utils.getDoubleAt(o,368,this.littleEndian),this.qoffset_x=r.Utils.getDoubleAt(o,376,this.littleEndian),this.qoffset_y=r.Utils.getDoubleAt(o,384,this.littleEndian),this.qoffset_z=r.Utils.getDoubleAt(o,392,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)a=400+8*(4*n+i),this.affine[n][i]=r.Utils.getDoubleAt(o,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=r.Utils.getIntAt(o,496,this.littleEndian),this.xyzt_units=r.Utils.getIntAt(o,500,this.littleEndian),this.intent_code=r.Utils.getIntAt(o,504,this.littleEndian),this.intent_name=r.Utils.getStringAt(o,508,524),this.dim_info=r.Utils.getByteAt(o,524),o.byteLength>r.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(o,540),this.extensionFlag[1]=r.Utils.getByteAt(o,541),this.extensionFlag[2]=r.Utils.getByteAt(o,542),this.extensionFlag[3]=r.Utils.getByteAt(o,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(o),this.extensionCode=this.getExtensionCode(o)))},r.NIFTI2.prototype.toFormattedString=function(){var e=r.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",t+='Intent Name: "'+this.intent_name+'"\n',t+="Dim Info = "+this.dim_info+"\n"},r.NIFTI2.prototype.getExtensionLocation=function(){return r.NIFTI2.MAGIC_COOKIE+4},r.NIFTI2.prototype.getExtensionSize=r.NIFTI1.prototype.getExtensionSize,r.NIFTI2.prototype.getExtensionCode=r.NIFTI1.prototype.getExtensionCode,r.NIFTI2.prototype.getDatatypeCodeString=r.NIFTI1.prototype.getDatatypeCodeString,r.NIFTI2.prototype.getTransformCodeString=r.NIFTI1.prototype.getTransformCodeString,r.NIFTI2.prototype.getUnitsCodeString=r.NIFTI1.prototype.getUnitsCodeString,r.NIFTI2.prototype.getQformMat=r.NIFTI1.prototype.getQformMat,r.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,r.NIFTI2.prototype.convertNiftiSFormToNEMA=r.NIFTI1.prototype.convertNiftiSFormToNEMA,r.NIFTI2.prototype.nifti_mat33_mul=r.NIFTI1.prototype.nifti_mat33_mul,r.NIFTI2.prototype.nifti_mat33_determ=r.NIFTI1.prototype.nifti_mat33_determ;e.exports&&(e.exports=r.NIFTI2)},7002:e=>{"use strict";var t=t||{};t.Utils=t.Utils||{},t.Utils.crcTable=null,t.Utils.GUNZIP_MAGIC_COOKIE1=31,t.Utils.GUNZIP_MAGIC_COOKIE2=139,t.Utils.getStringAt=function(e,t,n){var r,i,a="";for(r=t;r<n;r+=1)0!==(i=e.getUint8(r))&&(a+=String.fromCharCode(i));return a},t.Utils.getByteAt=function(e,t){return e.getInt8(t)},t.Utils.getShortAt=function(e,t,n){return e.getInt16(t,n)},t.Utils.getIntAt=function(e,t,n){return e.getInt32(t,n)},t.Utils.getFloatAt=function(e,t,n){return e.getFloat32(t,n)},t.Utils.getDoubleAt=function(e,t,n){return e.getFloat64(t,n)},t.Utils.getLongAt=function(e,n,r){var i,a=[],o=0;for(i=0;i<8;i+=1)a[i]=t.Utils.getByteAt(e,n+i,r);for(i=a.length-1;i>=0;i--)o=256*o+a[i];return o},t.Utils.toArrayBuffer=function(e){var t,n,r;for(t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r+=1)n[r]=e[r];return t},t.Utils.isString=function(e){return"string"==typeof e||e instanceof String},t.Utils.formatNumber=function(e,n){var r=0;return r=t.Utils.isString(e)?Number(e):e,r=n?r.toPrecision(5):r.toPrecision(7),parseFloat(r)},t.Utils.makeCRCTable=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},t.Utils.crc32=function(e){for(var n=t.Utils.crcTable||(t.Utils.crcTable=t.Utils.makeCRCTable()),r=-1,i=0;i<e.byteLength;i++)r=r>>>8^n[255&(r^e.getUint8(i))];return(-1^r)>>>0};e.exports&&(e.exports=t.Utils)},9616:(e,t,n)=>{"use strict";var r=n(6118),i=/[ \f\t\v]*\r?\n/,a=/^NRRD\d{4}$/,o=/^([^:]*)(:[ =])(.*)$/,s=/^LIST(?: (\d+))?$/;function l(e,t,n,i){var a,o,s=(o=e)in h?h[o]:o;switch(e){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":a=s+": "+t;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":r("number"==typeof t||t instanceof Number,"Field "+e+" should at least contain a number!"),a=s+": "+t;break;case"min":case"max":case"oldMin":case"oldMax":r("number"==typeof t||t instanceof Number,"Field "+e+" should contain a number!"),a=s+": "+t;break;case"spaceOrigin":r(t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach((function(t){r("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")})),a=s+": ("+t.join(",")+")";break;case"labels":case"units":case"spaceUnits":r(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){r("string"==typeof t||t instanceof String,"Field "+e+" should be a list of numbers!")})),a=s+": "+t.map(v).join(" ");break;case"sizes":r(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){r("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")})),a=s+": "+t.join(" ");break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":r(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){r("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")})),a=s+": "+t.join(" ");break;case"spaceDirections":r(void 0!==t.length&&t.length===n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){r(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach((function(t){r("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")}))})),a=s+": "+t.map((function(e){return null===e?"none":"("+e.join(",")+")"})).join(" ");break;case"measurementFrame":r(void 0!==t.length&&t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach((function(t){r(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach((function(t){r("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")}))})),a=s+": "+t.map((function(e){return null===e?"none":"("+e.join(",")+")"})).join(" ");break;case"type":case"encoding":case"endian":r("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),a=s+": "+t;break;case"dataFile":t.length||t.files&&"subdim"in t||(a=s+": "+function(e){if("string"==typeof e||e instanceof String)return e;if("format"in e&&"min"in e&&"max"in e&&"step"in e)return"subdim"in e?e.format+" "+e.min+" "+e.max+" "+e.step+" "+e.subdim:e.format+" "+e.min+" "+e.max+" "+e.step;throw new Error("Unrecognized data file format!")}(t));break;case"centers":case"kinds":r(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),a=s+": "+t.map(S).join(" ");break;default:console.warn("Unrecognized NRRD field: "+e+", skipping.")}return a}function c(e,t){switch(e){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":t=f(t);break;case"min":case"max":case"oldMin":case"oldMax":t=p(t);break;case"spaceOrigin":t=m(t);break;case"labels":case"units":case"spaceUnits":t=_(t,g);break;case"sizes":t=_(t,f);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":t=_(t,p);break;case"spaceDirections":case"measurementFrame":t=_(t,m);break;case"type":t=b(t);break;case"encoding":t=E(t);break;case"endian":t=w(t);break;case"dataFile":n=t,t=(r=x.exec(n))?5==r.length&&r[4]?{format:n.substring(0,r.index),min:f(r[1]),max:f(r[2]),step:f(r[3]),subdim:f(r[4])}:{format:n.substring(0,r.index),min:f(r[1]),max:f(r[2]),step:f(r[3])}:n;break;case"centers":t=_(t,T);break;case"kinds":t=_(t,M);break;case"space":t=function(e){switch(e.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+e),e}}(t);break;default:console.warn("Unrecognized NRRD field: "+e)}var n,r;return t}e.exports.serialize=function(e){var t,n,r,i,a,o,s,c,u,h,d=1,f={},p=[];for(i in e)f[i]=e[i];if(void 0===f.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===f.dimension&&(f.dimension=f.sizes.length),f.data instanceof Int8Array?a="int8":f.data instanceof Uint8Array?a="uint8":f.data instanceof Int16Array?a="int16":f.data instanceof Uint16Array?a="uint16":f.data instanceof Int32Array?a="int32":f.data instanceof Uint32Array?a="uint32":f.data instanceof Float32Array?a="float":f.data instanceof Float64Array&&(a="double"),void 0===f.type&&void 0!==a)f.type=a;else{if(void 0===f.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof f.type||f.type instanceof String)&&(f.type=b(f.type))}void 0===f.encoding?f.encoding="raw":("string"==typeof f.encoding||f.encoding instanceof String)&&(f.encoding=E(f.encoding)),f.data&&"block"!=f.type&&"int8"!=f.type&&"uint8"!=f.type&&"ascii"!=f.encoding?f.endian=L:"block"==f.type||"int8"==f.type||"uint8"==f.type||"ascii"==f.encoding?f.endian=void 0:("string"==typeof f.endian||f.endian instanceof String)&&(f.endian=w(f.endian));var m=void 0;if(void 0!==f.spaceDimension)m=f.spaceDimension;else if(void 0!==f.space)switch(f.space){case"right-anterior-superior":case"RAS":m=3;break;case"left-anterior-superior":case"LAS":m=3;break;case"left-posterior-superior":case"LPS":m=3;break;case"right-anterior-superior-time":case"RAST":m=4;break;case"left-anterior-superior-time":case"LAST":m=4;break;case"left-posterior-superior-time":case"LPST":m=4;break;case"scanner-xyz":m=3;break;case"scanner-xyz-time":m=4;break;case"3D-right-handed":case"3D-left-handed":m=3;break;case"3D-right-handed-time":case"3D-left-handed-time":m=4;break;default:console.warn("Unrecognized space: "+f.space)}for(N(f),t=0;t<f.sizes.length;t++){if(f.sizes[t]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");d*=f.sizes[t]}if(f.data){if(f.data.length<d)throw new Error("Missing data to serialize!")}else if(f.buffer){if("raw"==f.encoding&&(o="block"==f.type&&void 0!==f.blockSize?f.blockSize:I(f.type),f.buffer.byteLength<d*o))throw new Error("Missing data to serialize!")}else if(!f.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(f.data)switch(f.encoding){case"raw":s=f.type==a&&f.endian==L?f.data.buffer.slice(f.data.byteOffset,f.data.byteOffset+f.data.byteLength):f.endian==L?(s=F(f.data,f.type)).buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):function(e,t,n){var r,i,a,o=I(t),s=new ArrayBuffer(e.length*o);switch(n){case"big":i=!1;break;case"little":i=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+n)}switch(a=new DataView(s),t){case"int8":for(r=0;r<e.length;r++)a.setInt8(r,e[r],i);return s;case"uint8":for(r=0;r<e.length;r++)a.setUint8(r,e[r],i);return s;case"int16":for(r=0;r<e.length;r++)a.setInt16(2*r,e[r],i);return s;case"uint16":for(r=0;r<e.length;r++)a.setUint16(2*r,e[r],i);return s;case"int32":for(r=0;r<e.length;r++)a.setInt32(4*r,e[r],i);return s;case"uint32":for(r=0;r<e.length;r++)a.setUint32(4*r,e[r],i);return s;case"float":for(r=0;r<e.length;r++)a.setFloat32(4*r,e[r],i);return s;case"double":for(r=0;r<e.length;r++)a.setFloat64(8*r,e[r],i);return s;default:return void console.warn("Cannot serialize NRRD type: "+t+".")}}(f.data,f.type,f.endian);break;case"ascii":s=f.type==a?O(f.data):O(F(f.data,f.type));break;default:throw new Error("Unsupported NRRD encoding: "+f.encoding)}else f.buffer&&(s=f.buffer);p.push("NRRD0005"),p.push("# Generated by nrrd-js");var g=["dimension","spaceDimension","space"];for(t=0;t<g.length;t++)void 0!==f[i=g[t]]&&void 0!==(u=l(i,f[i],f.dimension,m))&&p.push(u);for(i in f)void 0!==f[i]&&(g.indexOf(i)>=0||void 0!==(u=l(i,f[i],f.dimension,m))&&p.push(u));if(f.keys)for(i in f.keys){if(i.indexOf(":=")>=0)throw new Error("The combination ':=' is not allowed in an NRRD key!");p.push(i+":="+f[i].replace("\\","\\\\").replace("\n","\\n"))}if(f.dataFile&&f.dataFile.length?(p.push("data file: LIST"),Array.prototype.push.apply(p,f.dataFile)):f.dataFile&&f.dataFile.files&&"subdim"in f.dataFile&&(p.push("data file: LIST "+f.dataFile.subdim),Array.prototype.push.apply(p,f.dataFile.files)),s&&!("dataFile"in f)){for(p.push(""),p.push(""),h=p.join("\n"),n=new ArrayBuffer(h.length+s.byteLength),r=new Uint8Array(n),t=0;t<h.length;t++)r[t]=h.charCodeAt(t);c=new Uint8Array(s),r.set(c,h.length)}else for(p.push(""),h=p.join("\n"),n=new ArrayBuffer(h.length),r=new Uint8Array(n),t=0;t<h.length;t++)r[t]=h.charCodeAt(t);return n},e.exports.parse=function(e){var t,n,r,l,u,h,m={data:void 0,buffer:void 0,keys:{},version:void 0},g=new Uint8Array(e);for(g.buffer!==e&&(e=g.buffer),t=2;t<g.length;)if(10==g[t]){if(10==g[t-1]||13==g[t-1]&&10==g[t-2]){r=t+1;break}t++}else 13==g[t]?t++:t+=2;if(void 0===r?n=String.fromCharCode.apply(null,g):(n=String.fromCharCode.apply(null,g.subarray(0,r)),m.buffer=e.slice(r)),l=(l=n.split(i)).filter((function(e){return e.length>0&&"#"!=e[0]})),!a.test(l[0]))throw new Error("File is not an NRRD file!");for(m.version=parseInt(l[0].substring(4,8),10),m.version>5&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),t=1;t<l.length;t++)if(u=o.exec(l[t]))if(": "==u[2])u[1]=d(u[1]),"dataFile"==u[1]&&(h=s.exec(u[3]))?(2==h.length&&h[1]?m[u[1]]={files:l.slice(t+1),subdim:f(h[1])}:m[u[1]]=l.slice(t+1),l.length=t):m[u[1]]=c(u[1],u[3]);else{if(":="!=u[2])throw new Error("Logic error in NRRD parser.");m.keys[u[1]]=u[3].split("\\\\").map((function(e){return e.replace("\\n","\n")})).join("\\")}else console.warn("Unrecognized line in NRRD header: "+l[t]);if(N(m),"dataFile"in m)console.warn("No support for external data yet!");else switch(m.encoding){case"raw":m.data=function(e,t,n,r){var i,a,o,s=1;for(i=0;i<n.length;i++){if(n[i]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");s*=n[i]}if("block"==t)return e.slice(0,s*r.blockSize);if("int8"==t||"uint8"==t||r.endian==L)switch(t){case"int8":return l(1),new Int8Array(e.slice(0,s));case"uint8":return l(1),new Uint8Array(e.slice(0,s));case"int16":return l(2),new Int16Array(e.slice(0,2*s));case"uint16":return l(2),new Uint16Array(e.slice(0,2*s));case"int32":return l(4),new Int32Array(e.slice(0,4*s));case"uint32":return l(4),new Uint32Array(e.slice(0,4*s));case"float":return l(4),new Float32Array(e.slice(0,4*s));case"double":return l(8),new Float64Array(e.slice(0,8*s));default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}else{switch(r.endian){case"big":!1;break;case"little":!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+r.endian)}switch(o=new DataView(e),t){case"int8":for(a=new Int8Array(s),i=0;i<s;i++)a[i]=o.getInt8(i);return a;case"uint8":for(a=new Uint8Array(s),i=0;i<s;i++)a[i]=o.getUint8(i);return a;case"int16":for(a=new Int16Array(s),i=0;i<s;i++)a[i]=o.getInt16(2*i);return a;case"uint16":for(a=new Uint16Array(s),i=0;i<s;i++)a[i]=o.getUint16(2*i);return a;case"int32":for(a=new Int32Array(s),i=0;i<s;i++)a[i]=o.getInt32(4*i);return a;case"uint32":for(a=new Uint32Array(s),i=0;i<s;i++)a[i]=o.getUint32(4*i);return a;case"float":for(a=new Float32Array(s),i=0;i<s;i++)a[i]=o.getFloat32(4*i);return a;case"double":for(a=new Float64Array(s),i=0;i<s;i++)a[i]=o.getFloat64(8*i);return a;default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}}function l(t){if(e.byteLength<s*t)throw new Error("NRRD file does not contain enough data!")}}(m.buffer,m.type,m.sizes,{endian:m.endian,blockSize:m.blockSize});break;case"ascii":m.data=function(e,t,n){var r,i,a,o=1;for(r=0;r<n.length;r++){if(n[r]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");o*=n[r]}if(i=new Uint8Array(e),(a=String.fromCharCode.apply(null,i).split(C)).length<o)throw new Error("Not enough data in NRRD file!");a.length>o&&(""===a[0]&&(a=a.slice(1)),a=a.slice(0,o));switch(t){case"int8":return new Int8Array(a.map(f));case"uint8":return new Uint8Array(a.map(f));case"int16":return new Int16Array(a.map(f));case"uint16":return new Uint16Array(a.map(f));case"int32":return new Int32Array(a.map(f));case"uint32":return new Uint32Array(a.map(f));case"float":return new Float32Array(a.map(p));case"double":return new Float64Array(a.map(p));default:return void console.warn("Unsupported NRRD type: "+t+".")}}(m.buffer,m.type,m.sizes);break;default:console.warn("Unsupported NRRD encoding: "+m.encoding)}return m};var u={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},h=function(){var e,t={};for(e in u)t[u[e]]=e;return t}();function d(e){return(e=e.toLowerCase())in u?u[e]:e}function f(e){var t=parseInt(e,10);if(Number.isNaN(t))throw new Error("Malformed NRRD integer: "+e);return t}function p(e){if((e=e.toLowerCase()).indexOf("nan")>=0)return NaN;if(e.indexOf("-inf")>=0)return-1/0;if(e.indexOf("inf")>=0)return 1/0;var t=parseFloat(e);if(Number.isNaN(t))throw new Error("Malformed NRRD float: "+e);return t}function m(e){if("none"==e)return null;if(e.length<2||"("!==e[0]||")"!==e[e.length-1])throw new Error("Malformed NRRD vector: "+e);return e.slice(1,-1).split(",").map(p)}function g(e){if(length<2||'"'!=e[0]||'"'!=e[e.length-1])throw new Error("Invalid NRRD quoted string: "+e);return e.slice(1,-1).replace('\\"','"')}function v(e){return'"'+e.replace('"','\\"')+'"'}var y=/[ \t]+/;function _(e,t){return e.split(y).map(t)}function b(e){switch(e.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+e),e}}function E(e){switch(e.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+e),e}}function w(e){switch(e.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+e),e}}var x=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/;function T(e){switch(e.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+e),e}}var A={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null};function M(e){var t=e.toLowerCase();return t in A?A[t]:(console.warn("Unrecognized NRRD kind: "+e),e)}function S(e){return null===e?"???":e}var R,k,P,L=(R=new ArrayBuffer(4),k=new Uint32Array(R),P=new Uint8Array(R),k[0]=16909060,1==P[0]&&2==P[1]&&3==P[2]&&4==P[3]?"big":4==P[0]&&3==P[1]&&2==P[2]&&1==P[3]?"little":void console.warn("Unrecognized system endianness!"));var C=/[ \t\n\r\v\f]+/;function I(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":return 4;case"int64":case"uint64":return 8;case"float":return 4;case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+e)}}function N(e){if(void 0===e.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===e.type)throw new Error("Type missing from NRRD file!");if(void 0===e.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===e.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=e.type&&"int8"!=e.type&&"uint8"!=e.type&&"ascii"!=e.encoding&&void 0===e.endian)throw new Error("Endianness missing from NRRD file!");if("block"==e.type&&void 0===e.blockSize)throw new Error("Missing block size in NRRD file!");if(0===e.dimension)throw new Error("Zero-dimensional NRRD file?");if(e.dimension!=e.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(e.spacings&&e.dimension!=e.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(e.thicknesses&&e.dimension!=e.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(e.axisMins&&e.dimension!=e.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(e.axisMaxs&&e.dimension!=e.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");if(e.centers&&e.dimension!=e.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(e.labels&&e.dimension!=e.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(e.units&&e.dimension!=e.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(e.kinds&&e.dimension!=e.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if(!(void 0!==e.data&&0!==e.data.length||void 0!==e.buffer&&0!==e.buffer.byteLength||void 0!==e.dataFile))throw new Error("NRRD file has neither inline or external data!")}function F(e,t){switch(t){case"int8":return new Int8Array(e);case"uint8":return new Uint8Array(e);case"int16":return new Int16Array(e);case"uint16":return new Uint16Array(e);case"int32":return new Int32Array(e);case"uint32":return new Uint32Array(e);case"float":return new Float32Array(e);case"double":return new Float64Array(e);default:throw new Error("Cannot cast to NRRD type: "+t)}}function O(e){var t,n,r,i,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=""+e[t];for(n=a.join(" "),r=new ArrayBuffer(n.length),i=new Uint8Array(r),t=0;t<i.length;t++)i[t]=n.charCodeAt(t);return r}},8720:e=>{"use strict";var t=function(e){return e!=e};e.exports=function(e,n){return 0===e&&0===n?1/e==1/n:e===n||!(!t(e)||!t(n))}},7402:(e,t,n)=>{"use strict";var r=n(9170),i=n(2550),a=n(8720),o=n(5280),s=n(9129),l=i(o(),Object);r(l,{getPolyfill:o,implementation:a,shim:s}),e.exports=l},5280:(e,t,n)=>{"use strict";var r=n(8720);e.exports=function(){return"function"==typeof Object.is?Object.is:r}},9129:(e,t,n)=>{"use strict";var r=n(5280),i=n(9170);e.exports=function(){var e=r();return i(Object,{is:e},{is:function(){return Object.is!==e}}),e}},8383:(e,t,n)=>{"use strict";var r;if(!Object.keys){var i=Object.prototype.hasOwnProperty,a=Object.prototype.toString,o=n(4418),s=Object.prototype.propertyIsEnumerable,l=!s.call({toString:null},"toString"),c=s.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(e){var t=e.constructor;return t&&t.prototype===e},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!d["$"+e]&&i.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{h(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();r=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===a.call(e),r=o(e),s=t&&"[object String]"===a.call(e),d=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var p=c&&n;if(s&&e.length>0&&!i.call(e,0))for(var m=0;m<e.length;++m)d.push(String(m));if(r&&e.length>0)for(var g=0;g<e.length;++g)d.push(String(g));else for(var v in e)p&&"prototype"===v||!i.call(e,v)||d.push(String(v));if(l)for(var y=function(e){if("undefined"==typeof window||!f)return h(e);try{return h(e)}catch(e){return!1}}(e),_=0;_<u.length;++_)y&&"constructor"===u[_]||!i.call(e,u[_])||d.push(u[_]);return d}}e.exports=r},806:(e,t,n)=>{"use strict";var r=Array.prototype.slice,i=n(4418),a=Object.keys,o=a?function(e){return a(e)}:n(8383),s=Object.keys;o.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return i(e)?s(r.call(e)):s(e)}):Object.keys=o;return Object.keys||o},e.exports=o},4418:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var n=t.call(e),r="[object Arguments]"===n;return r||(r="[object Array]"!==n&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),r}},4316:(e,t,n)=>{"use strict";var r={};(0,n(9034).assign)(r,n(6778),n(5354),n(549)),e.exports=r},6778:(e,t,n)=>{"use strict";var r=n(4349),i=n(9034),a=n(2511),o=n(4594),s=n(8755),l=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(o[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var u;if(u="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,u)))throw new Error(o[n]);this._dict_set=!0}}function u(e,t){var n=new c(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}c.prototype.push=function(e,t){var n,o,s=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(c),s.next_out=0,s.avail_out=c),1!==(n=r.deflate(s,o))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==o||(this.onEnd(0),s.avail_out=0,!0)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=c,t.deflate=u,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,u(e,t)}},5354:(e,t,n)=>{"use strict";var r=n(3386),i=n(9034),a=n(2511),o=n(549),s=n(4594),l=n(8755),c=n(4673),u=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(s[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[n])}function d(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(e,t){var n,s,l,c,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=a.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===o.Z_BUF_ERROR&&!0===m&&(n=o.Z_OK,m=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==o.Z_STREAM_END&&(0!==d.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),c=d.next_out-l,h=a.buf2string(d.output,l),d.next_out=c,d.avail_out=f-c,c&&i.arraySet(d.output,d.output,l,c,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},9034:(e,t)=>{"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o}},a={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(n)},2511:(e,t,n)=>{"use strict";var r=n(9034),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new r.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,t.string2buf=function(e){var t,n,i,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,a,s=t||e.length,c=new Array(2*s);for(r=0,n=0;n<s;)if((i=e[n++])<128)c[r++]=i;else if((a=o[i])>4)c[r++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&n<s;)i=i<<6|63&e[n++],a--;a>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return l(c,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}},1475:e=>{"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},549:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},8621:e=>{"use strict";var t=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,n,r,i){var a=t,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^n[s])];return-1^e}},4349:(e,t,n)=>{"use strict";var r,i=n(9034),a=n(376),o=n(1475),s=n(8621),l=n(4594),c=-2,u=258,h=262,d=103,f=113,p=666;function m(e,t){return e.msg=l[t],t}function g(e){return(e<<1)-(e>4?9:0)}function v(e){for(var t=e.length;--t>=0;)e[t]=0}function y(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function _(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,y(e.strm)}function b(e,t){e.pending_buf[e.pending++]=t}function E(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function w(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-h?e.strstart-(e.w_size-h):0,c=e.window,d=e.w_mask,f=e.prev,p=e.strstart+u,m=c[a+o-1],g=c[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+o]===g&&c[n+o-1]===m&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<p);if(r=u-(p-a),a=p-u,r>o){if(e.match_start=t,o=r,r>=s)break;m=c[a+o-1],g=c[a+o]}}}while((t=f[t&d])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function x(e){var t,n,r,a,l,c,u,d,f,p,m=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-h)){i.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=m?r-m:0}while(--n);t=n=m;do{r=e.prev[--t],e.prev[t]=r>=m?r-m:0}while(--n);a+=m}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,d=e.strstart+e.lookahead,f=a,p=void 0,(p=c.avail_in)>f&&(p=f),n=0===p?0:(c.avail_in-=p,i.arraySet(u,c.input,c.next_in,p,d),1===c.state.wrap?c.adler=o(c.adler,u,p,d):2===c.state.wrap&&(c.adler=s(c.adler,u,p,d)),c.next_in+=p,c.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<h&&0!==e.strm.avail_in)}function T(e,t){for(var n,r;;){if(e.lookahead<h){if(x(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-h&&(e.match_length=w(e,n)),e.match_length>=3)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function A(e,t){for(var n,r,i;;){if(e.lookahead<h){if(x(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-h&&(e.match_length=w(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(_(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&_(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function M(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),v(this.dyn_ltree),v(this.dyn_dtree),v(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),v(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),v(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function R(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):m(e,c)}function k(e){var t,n=R(e);return 0===n&&((t=e.state).window_size=2*t.w_size,v(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function P(e,t,n,r,a,o){if(!e)return c;var s=1;if(-1===t&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>9||8!==n||r<8||r>15||t<0||t>9||o<0||o>4)return m(e,c);8===r&&(r=9);var l=new S;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,k(e)}r=[new M(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(x(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,_(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-h&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(_(e,!1),e.strm.avail_out),1)})),new M(4,4,8,4,T),new M(4,5,16,8,T),new M(4,6,32,32,T),new M(4,4,16,16,A),new M(8,16,32,32,A),new M(8,16,128,128,A),new M(8,32,128,256,A),new M(32,128,258,1024,A),new M(32,258,258,4096,A)],t.deflateInit=function(e,t){return P(e,t,8,15,8,0)},t.deflateInit2=P,t.deflateReset=k,t.deflateResetKeep=R,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?c:(e.state.gzhead=t,0):c},t.deflate=function(e,t){var n,i,o,l;if(!e||!e.state||t>5||t<0)return e?m(e,c):c;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===p&&4!==t)return m(e,0===e.avail_out?-5:c);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,b(i,31),b(i,139),b(i,8),i.gzhead?(b(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),b(i,255&i.gzhead.time),b(i,i.gzhead.time>>8&255),b(i,i.gzhead.time>>16&255),b(i,i.gzhead.time>>24&255),b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(b(i,255&i.gzhead.extra.length),b(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(b(i,0),b(i,0),b(i,0),b(i,0),b(i,0),b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,3),i.status=f);else{var h=8+(i.w_bits-8<<4)<<8;h|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(h|=32),h+=31-h%31,i.status=f,E(i,h),0!==i.strstart&&(E(i,e.adler>>>16),E(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending!==i.pending_buf_size));)b(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=d)}else i.status=d;if(i.status===d&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&y(e),i.pending+2<=i.pending_buf_size&&(b(i,255&e.adler),b(i,e.adler>>8&255),e.adler=0,i.status=f)):i.status=f),0!==i.pending){if(y(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&g(t)<=g(n)&&4!==t)return m(e,-5);if(i.status===p&&0!==e.avail_in)return m(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&i.status!==p){var w=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(x(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=u){if(x(e),e.lookahead<=u&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){o=e.strstart+u;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=u-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==w&&4!==w||(i.status=p),1===w||3===w)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===w&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(v(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),y(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(b(i,255&e.adler),b(i,e.adler>>8&255),b(i,e.adler>>16&255),b(i,e.adler>>24&255),b(i,255&e.total_in),b(i,e.total_in>>8&255),b(i,e.total_in>>16&255),b(i,e.total_in>>24&255)):(E(i,e.adler>>>16),E(i,65535&e.adler)),y(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==d&&t!==f&&t!==p?m(e,c):(e.state=null,t===f?m(e,-3):0):c},t.deflateSetDictionary=function(e,t){var n,r,a,s,l,u,h,d,f=t.length;if(!e||!e.state)return c;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return c;for(1===s&&(e.adler=o(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(v(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new i.Buf8(n.w_size),i.arraySet(d,t,f-n.w_size,n.w_size,0),t=d,f=n.w_size),l=e.avail_in,u=e.next_in,h=e.input,e.avail_in=f,e.next_in=0,e.input=t,x(n);n.lookahead>=3;){r=n.strstart,a=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=2,x(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=u,e.input=h,e.avail_in=l,n.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},4673:e=>{"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},3394:e=>{"use strict";e.exports=function(e,t){var n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v,y,_,b,E,w,x,T,A,M;n=e.state,r=e.next_in,A=e.input,i=r+(e.avail_in-5),a=e.next_out,M=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=A[r++]<<p,p+=8,f+=A[r++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))M[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}E=65535&_,(b&=15)&&(p<b&&(f+=A[r++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=A[r++]<<p,p+=8,f+=A[r++]<<p,p+=8),_=g[f&y];n:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=A[r++]<<p,(p+=8)<b&&(f+=A[r++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(x=0,T=d,0===h){if(x+=c-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}else if(h<b){if(x+=c+h-b,(b-=h)<E){E-=b;do{M[a++]=d[x++]}while(--b);if(x=0,h<E){E-=b=h;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}}else if(x+=h-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}for(;E>2;)M[a++]=T[x++],M[a++]=T[x++],M[a++]=T[x++],E-=3;E&&(M[a++]=T[x++],E>1&&(M[a++]=T[x++]))}else{x=a-w;do{M[a++]=M[x++],M[a++]=M[x++],M[a++]=M[x++],E-=3}while(E>2);E&&(M[a++]=M[x++],E>1&&(M[a++]=M[x++]))}break}}break}}while(r<i&&a<s);r-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},3386:(e,t,n)=>{"use strict";var r=n(9034),i=n(1475),a=n(8621),o=n(3394),s=n(598),l=-2,c=12,u=30;function h(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function d(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):l}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):l}function m(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,p(e))):l}function g(e,t){var n,r;return e?(r=new d,e.state=r,r.window=null,0!==(n=m(e,t))&&(e.state=null),n):l}var v,y,_=!0;function b(e){if(_){var t;for(v=new r.Buf32(512),y=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,v,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,y,0,e.work,{bits:5}),_=!1}e.lencode=v,e.lenbits=9,e.distcode=y,e.distbits=5}function E(e,t,n,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),r.arraySet(o.window,t,n-i,a,o.wnext),(i-=a)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=p,t.inflateReset2=m,t.inflateResetKeep=f,t.inflateInit=function(e){return g(e,15)},t.inflateInit2=g,t.inflate=function(e,t){var n,d,f,p,m,g,v,y,_,w,x,T,A,M,S,R,k,P,L,C,I,N,F,O,H=0,D=new r.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(n=e.state).mode===c&&(n.mode=13),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,d=e.input,g=e.avail_in,y=n.hold,_=n.bits,w=g,x=v,N=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;_<16;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(2&n.wrap&&35615===y){n.check=0,D[0]=255&y,D[1]=y>>>8&255,n.check=a(n.check,D,2,0),y=0,_=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=u;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=u;break}if(_-=4,I=8+(15&(y>>>=4)),0===n.wbits)n.wbits=I;else if(I>n.wbits){e.msg="invalid window size",n.mode=u;break}n.dmax=1<<I,e.adler=n.check=1,n.mode=512&y?10:c,y=0,_=0;break;case 2:for(;_<16;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=u;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=u;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&(D[0]=255&y,D[1]=y>>>8&255,n.check=a(n.check,D,2,0)),y=0,_=0,n.mode=3;case 3:for(;_<32;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}n.head&&(n.head.time=y),512&n.flags&&(D[0]=255&y,D[1]=y>>>8&255,D[2]=y>>>16&255,D[3]=y>>>24&255,n.check=a(n.check,D,4,0)),y=0,_=0,n.mode=4;case 4:for(;_<16;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&(D[0]=255&y,D[1]=y>>>8&255,n.check=a(n.check,D,2,0)),y=0,_=0,n.mode=5;case 5:if(1024&n.flags){for(;_<16;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&(D[0]=255&y,D[1]=y>>>8&255,n.check=a(n.check,D,2,0)),y=0,_=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((T=n.length)>g&&(T=g),T&&(n.head&&(I=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,d,p,T,I)),512&n.flags&&(n.check=a(n.check,d,T,p)),g-=T,p+=T,n.length-=T),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break e;T=0;do{I=d[p+T++],n.head&&I&&n.length<65536&&(n.head.name+=String.fromCharCode(I))}while(I&&T<g);if(512&n.flags&&(n.check=a(n.check,d,T,p)),g-=T,p+=T,I)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break e;T=0;do{I=d[p+T++],n.head&&I&&n.length<65536&&(n.head.comment+=String.fromCharCode(I))}while(I&&T<g);if(512&n.flags&&(n.check=a(n.check,d,T,p)),g-=T,p+=T,I)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;_<16;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=u;break}y=0,_=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=c;break;case 10:for(;_<32;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}e.adler=n.check=h(y),y=0,_=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=_,2;e.adler=n.check=1,n.mode=c;case c:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&_,_-=7&_,n.mode=27;break}for(;_<3;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}switch(n.last=1&y,_-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(b(n),n.mode=20,6===t){y>>>=2,_-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=u}y>>>=2,_-=2;break;case 14:for(y>>>=7&_,_-=7&_;_<32;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=u;break}if(n.length=65535&y,y=0,_=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(T=n.length){if(T>g&&(T=g),T>v&&(T=v),0===T)break e;r.arraySet(f,d,p,T,m),g-=T,p+=T,v-=T,m+=T,n.length-=T;break}n.mode=c;break;case 17:for(;_<14;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(n.nlen=257+(31&y),y>>>=5,_-=5,n.ndist=1+(31&y),y>>>=5,_-=5,n.ncode=4+(15&y),y>>>=4,_-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=u;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;_<3;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}n.lens[U[n.have++]]=7&y,y>>>=3,_-=3}for(;n.have<19;)n.lens[U[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,F={bits:n.lenbits},N=s(0,n.lens,0,19,n.lencode,0,n.work,F),n.lenbits=F.bits,N){e.msg="invalid code lengths set",n.mode=u;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;R=(H=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,k=65535&H,!((S=H>>>24)<=_);){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(k<16)y>>>=S,_-=S,n.lens[n.have++]=k;else{if(16===k){for(O=S+2;_<O;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(y>>>=S,_-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=u;break}I=n.lens[n.have-1],T=3+(3&y),y>>>=2,_-=2}else if(17===k){for(O=S+3;_<O;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}_-=S,I=0,T=3+(7&(y>>>=S)),y>>>=3,_-=3}else{for(O=S+7;_<O;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}_-=S,I=0,T=11+(127&(y>>>=S)),y>>>=7,_-=7}if(n.have+T>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=u;break}for(;T--;)n.lens[n.have++]=I}}if(n.mode===u)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=u;break}if(n.lenbits=9,F={bits:n.lenbits},N=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,F),n.lenbits=F.bits,N){e.msg="invalid literal/lengths set",n.mode=u;break}if(n.distbits=6,n.distcode=n.distdyn,F={bits:n.distbits},N=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,F),n.distbits=F.bits,N){e.msg="invalid distances set",n.mode=u;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(g>=6&&v>=258){e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=_,o(e,x),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,d=e.input,g=e.avail_in,y=n.hold,_=n.bits,n.mode===c&&(n.back=-1);break}for(n.back=0;R=(H=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,k=65535&H,!((S=H>>>24)<=_);){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(R&&0==(240&R)){for(P=S,L=R,C=k;R=(H=n.lencode[C+((y&(1<<P+L)-1)>>P)])>>>16&255,k=65535&H,!(P+(S=H>>>24)<=_);){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}y>>>=P,_-=P,n.back+=P}if(y>>>=S,_-=S,n.back+=S,n.length=k,0===R){n.mode=26;break}if(32&R){n.back=-1,n.mode=c;break}if(64&R){e.msg="invalid literal/length code",n.mode=u;break}n.extra=15&R,n.mode=22;case 22:if(n.extra){for(O=n.extra;_<O;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,_-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;R=(H=n.distcode[y&(1<<n.distbits)-1])>>>16&255,k=65535&H,!((S=H>>>24)<=_);){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(0==(240&R)){for(P=S,L=R,C=k;R=(H=n.distcode[C+((y&(1<<P+L)-1)>>P)])>>>16&255,k=65535&H,!(P+(S=H>>>24)<=_);){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}y>>>=P,_-=P,n.back+=P}if(y>>>=S,_-=S,n.back+=S,64&R){e.msg="invalid distance code",n.mode=u;break}n.offset=k,n.extra=15&R,n.mode=24;case 24:if(n.extra){for(O=n.extra;_<O;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,_-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=u;break}n.mode=25;case 25:if(0===v)break e;if(T=x-v,n.offset>T){if((T=n.offset-T)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=u;break}T>n.wnext?(T-=n.wnext,A=n.wsize-T):A=n.wnext-T,T>n.length&&(T=n.length),M=n.window}else M=f,A=m-n.offset,T=n.length;T>v&&(T=v),v-=T,n.length-=T;do{f[m++]=M[A++]}while(--T);0===n.length&&(n.mode=21);break;case 26:if(0===v)break e;f[m++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;_<32;){if(0===g)break e;g--,y|=d[p++]<<_,_+=8}if(x-=v,e.total_out+=x,n.total+=x,x&&(e.adler=n.check=n.flags?a(n.check,f,x,m-x):i(n.check,f,x,m-x)),x=v,(n.flags?y:h(y))!==n.check){e.msg="incorrect data check",n.mode=u;break}y=0,_=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;_<32;){if(0===g)break e;g--,y+=d[p++]<<_,_+=8}if(y!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=u;break}y=0,_=0}n.mode=29;case 29:N=1;break e;case u:N=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=_,(n.wsize||x!==e.avail_out&&n.mode<u&&(n.mode<27||4!==t))&&E(e,e.output,e.next_out,x-e.avail_out)?(n.mode=31,-4):(w-=e.avail_in,x-=e.avail_out,e.total_in+=w,e.total_out+=x,n.total+=x,n.wrap&&x&&(e.adler=n.check=n.flags?a(n.check,f,x,e.next_out-x):i(n.check,f,x,e.next_out-x)),e.data_type=n.bits+(n.last?64:0)+(n.mode===c?128:0)+(20===n.mode||15===n.mode?256:0),(0===w&&0===x||4===t)&&0===N&&(N=-5),N)},t.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?l:(n.head=t,t.done=!1,0):l},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?l:11===n.mode&&i(1,t,r,0)!==n.check?-3:E(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):l},t.inflateInfo="pako inflate (from Nodeca project)"},598:(e,t,n)=>{"use strict";var r=n(9034),i=15,a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,u,h,d,f){var p,m,g,v,y,_,b,E,w,x=f.bits,T=0,A=0,M=0,S=0,R=0,k=0,P=0,L=0,C=0,I=0,N=null,F=0,O=new r.Buf16(16),H=new r.Buf16(16),D=null,U=0;for(T=0;T<=i;T++)O[T]=0;for(A=0;A<c;A++)O[t[n+A]]++;for(R=x,S=i;S>=1&&0===O[S];S--);if(R>S&&(R=S),0===S)return u[h++]=20971520,u[h++]=20971520,f.bits=1,0;for(M=1;M<S&&0===O[M];M++);for(R<M&&(R=M),L=1,T=1;T<=i;T++)if(L<<=1,(L-=O[T])<0)return-1;if(L>0&&(0===e||1!==S))return-1;for(H[1]=0,T=1;T<i;T++)H[T+1]=H[T]+O[T];for(A=0;A<c;A++)0!==t[n+A]&&(d[H[t[n+A]]++]=A);if(0===e?(N=D=d,_=19):1===e?(N=a,F-=257,D=o,U-=257,_=256):(N=s,D=l,_=-1),I=0,A=0,T=M,y=h,k=R,P=0,g=-1,v=(C=1<<R)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){b=T-P,d[A]<_?(E=0,w=d[A]):d[A]>_?(E=D[U+d[A]],w=N[F+d[A]]):(E=96,w=0),p=1<<T-P,M=m=1<<k;do{u[y+(I>>P)+(m-=p)]=b<<24|E<<16|w|0}while(0!==m);for(p=1<<T-1;I&p;)p>>=1;if(0!==p?(I&=p-1,I+=p):I=0,A++,0==--O[T]){if(T===S)break;T=t[n+d[A]]}if(T>R&&(I&v)!==g){for(0===P&&(P=R),y+=M,L=1<<(k=T-P);k+P<S&&!((L-=O[k+P])<=0);)k++,L<<=1;if(C+=1<<k,1===e&&C>852||2===e&&C>592)return 1;u[g=I&v]=R<<24|k<<16|y-h|0}}return 0!==I&&(u[y+I]=T-P<<24|64<<16|0),f.bits=R,0}},4594:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},376:(e,t,n)=>{"use strict";var r=n(9034);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=256,o=286,s=30,l=15,c=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);i(f);var p=new Array(60);i(p);var m=new Array(512);i(m);var g=new Array(256);i(g);var v=new Array(29);i(v);var y,_,b,E=new Array(s);function w(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function x(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function T(e){return e<256?m[e]:m[256+(e>>>7)]}function A(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function M(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,A(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){M(e,n[2*t],n[2*t+1])}function R(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function k(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=l;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=R(a[s]++,s))}}function P(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function L(e){e.bi_valid>8?A(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function C(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function I(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&C(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!C(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function N(e,t,n){var r,i,o,s,l=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===r?S(e,i,t):(S(e,(o=g[i])+a+1,t),0!==(s=c[o])&&M(e,i-=v[o],s),S(e,o=T(--r),n),0!==(s=u[o])&&M(e,r-=E[o],s))}while(l<e.last_lit);S(e,256,t)}function F(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)I(e,a,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],I(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,I(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,c=t.dyn_tree,u=t.max_code,h=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,m=t.stat_desc.max_length,g=0;for(a=0;a<=l;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=c[2*c[2*(r=e.heap[n])+1]+1]+1)>m&&(a=m,g++),c[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=p&&(o=f[r-p]),s=c[2*r],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(h[2*r+1]+o)));if(0!==g){do{for(a=m-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[m]--,g-=2}while(g>0);for(a=m;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),r--)}}(e,t),k(a,u,e.bl_count)}function O(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<l&&i===o||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))}function H(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<l&&i===o)){if(s<c)do{S(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(S(e,i,e.bl_tree),s--),S(e,16,e.bl_tree),M(e,s-3,2)):s<=10?(S(e,17,e.bl_tree),M(e,s-3,3)):(S(e,18,e.bl_tree),M(e,s-11,7));s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4)}}i(E);var D=!1;function U(e,t,n,i){M(e,0+(i?1:0),3),function(e,t,n,i){L(e),i&&(A(e,n),A(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){D||(!function(){var e,t,n,r,i,a=new Array(16);for(n=0,r=0;r<28;r++)for(v[r]=n,e=0;e<1<<c[r];e++)g[n++]=r;for(g[n-1]=r,i=0,r=0;r<16;r++)for(E[r]=i,e=0;e<1<<u[r];e++)m[i++]=r;for(i>>=7;r<s;r++)for(E[r]=i<<7,e=0;e<1<<u[r]-7;e++)m[256+i++]=r;for(t=0;t<=l;t++)a[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,a[8]++;for(;e<=255;)f[2*e+1]=9,e++,a[9]++;for(;e<=279;)f[2*e+1]=7,e++,a[7]++;for(;e<=287;)f[2*e+1]=8,e++,a[8]++;for(k(f,287,a),e=0;e<s;e++)p[2*e+1]=5,p[2*e]=R(e,5);y=new w(f,c,257,o,l),_=new w(p,u,0,s,l),b=new w(new Array(0),h,0,19,7)}(),D=!0),e.l_desc=new x(e.dyn_ltree,y),e.d_desc=new x(e.dyn_dtree,_),e.bl_desc=new x(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,P(e)},t._tr_stored_block=U,t._tr_flush_block=function(e,t,n,r){var i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<a;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),F(e,e.l_desc),F(e,e.d_desc),s=function(e){var t;for(O(e,e.dyn_ltree,e.l_desc.max_code),O(e,e.dyn_dtree,e.d_desc.max_code),F(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*d[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?U(e,t,n,r):4===e.strategy||o===i?(M(e,2+(r?1:0),3),N(e,f,p)):(M(e,4+(r?1:0),3),function(e,t,n,r){var i;for(M(e,t-257,5),M(e,n-1,5),M(e,r-4,4),i=0;i<r;i++)M(e,e.bl_tree[2*d[i]+1],3);H(e,e.dyn_ltree,t-1),H(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),N(e,e.dyn_ltree,e.dyn_dtree)),P(e),r&&L(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(g[n]+a+1)]++,e.dyn_dtree[2*T(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){M(e,2,3),S(e,256,f),function(e){16===e.bi_valid?(A(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},8755:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},1195:(e,t,n)=>{var r=r||{};!function(){"use strict";var e="win32"===r.platform,i=n(5663);function a(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}if(e){var o=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,s=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,l=function(e){var t=o.exec(e),n=(t[1]||"")+(t[2]||""),r=t[3]||"",i=s.exec(r);return[n,i[1],i[2],i[3]]},c=function(e){return"\\\\"+e.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")};t.resolve=function(){for(var e="",n="",s=!1,l=arguments.length-1;l>=-1;l--){var u;if(l>=0?u=arguments[l]:e?(u=r.env["="+e])&&u.substr(0,3).toLowerCase()===e.toLowerCase()+"\\"||(u=e+"\\"):u=r.cwd(),!i.isString(u))throw new TypeError("Arguments to path.resolve must be strings");if(u){var h=o.exec(u),d=h[1]||"",f=d&&":"!==d.charAt(1),p=t.isAbsolute(u),m=h[3];if((!d||!e||d.toLowerCase()===e.toLowerCase())&&(e||(e=d),s||(n=m+"\\"+n,s=p),e&&s))break}}function g(e){return!!e}return f&&(e=c(e)),e+(s?"\\":"")+(n=a(n.split(/[\\\/]+/).filter(g),!s).join("\\"))||"."},t.normalize=function(e){var n=o.exec(e),r=n[1]||"",i=r&&":"!==r.charAt(1),s=t.isAbsolute(e),l=n[3],u=/[\\\/]$/.test(l);return r&&":"===r.charAt(1)&&(r=r[0].toLowerCase()+r.substr(1)),(l=a(l.split(/[\\\/]+/).filter((function(e){return!!e})),!s).join("\\"))||s||(l="."),l&&u&&(l+="\\"),i&&(r=c(r)),r+(s?"\\":"")+l},t.isAbsolute=function(e){var t=o.exec(e),n=t[1]||"",r=!!n&&":"!==n.charAt(1);return!!t[2]||r},t.join=function(){function e(e){if(!i.isString(e))throw new TypeError("Arguments to path.join must be strings");return e}var n=Array.prototype.filter.call(arguments,e),r=n.join("\\");return/^[\\\/]{2}[^\\\/]/.test(n[0])||(r=r.replace(/^[\\\/]{2,}/,"\\")),t.normalize(r)},t.relative=function(e,n){e=t.resolve(e),n=t.resolve(n);var r=e.toLowerCase(),i=n.toLowerCase();function a(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n+1)}for(var o=a(n.split("\\")),s=a(r.split("\\")),l=a(i.split("\\")),c=Math.min(s.length,l.length),u=c,h=0;h<c;h++)if(s[h]!==l[h]){u=h;break}if(0==u)return n;var d=[];for(h=u;h<s.length;h++)d.push("..");return(d=d.concat(o.slice(u))).join("\\")},t.sep="\\",t.delimiter=";"}else{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;l=function(e){return u.exec(e).slice(1)};t.resolve=function(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var o=n>=0?arguments[n]:r.cwd();if(!i.isString(o))throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,t="/"===o.charAt(0))}return(t?"/":"")+(e=a(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."},t.normalize=function(e){for(var n=t.isAbsolute(e),r="/"===e[e.length-1],i=e.split("/"),o=[],s=0;s<i.length;s++)i[s]&&o.push(i[s]);return(e=a(o,!n).join("/"))||n||(e="."),e&&r&&(e+="/"),(n?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){for(var e="",n=0;n<arguments.length;n++){var r=arguments[n];if(!i.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&(e+=e?"/"+r:r)}return t.normalize(e)},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),a=r(n.split("/")),o=Math.min(i.length,a.length),s=o,l=0;l<o;l++)if(i[l]!==a[l]){s=l;break}var c=[];for(l=s;l<i.length;l++)c.push("..");return(c=c.concat(a.slice(s))).join("/")},t.sep="/",t.delimiter=":"}t.dirname=function(e){var t=l(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},t.basename=function(e,t){var n=l(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){return l(e)[3]},t.exists=i.deprecate((function(e,t){n(7829).exists(e,t)}),"path.exists is now called `fs.exists`."),t.existsSync=i.deprecate((function(e){return n(7829).existsSync(e)}),"path.existsSync is now called `fs.existsSync`."),t._makeLong=e?function(e){if(!i.isString(e))return e;if(!e)return"";var n=t.resolve(e);return/^[a-zA-Z]\:\\/.test(n)?"\\\\?\\"+n:/^\\\\[^?.]/.test(n)?"\\\\?\\UNC\\"+n.substring(2):e}:function(e){return e}}()},2530:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,l=[],c=!1,u=-1;function h(){c&&s&&(c=!1,s.length?l=s.concat(l):u=-1,l.length&&d())}function d(){if(!c){var e=o(h);c=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||c||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},9397:e=>{e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},4489:(e,t,n)=>{"use strict";var r=n(7092),i=n(7427),a=n(4871),o=n(2527);function s(e){return e.call.bind(e)}var l="undefined"!=typeof BigInt,c="undefined"!=typeof Symbol,u=s(Object.prototype.toString),h=s(Number.prototype.valueOf),d=s(String.prototype.valueOf),f=s(Boolean.prototype.valueOf);if(l)var p=s(BigInt.prototype.valueOf);if(c)var m=s(Symbol.prototype.valueOf);function g(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function v(e){return"[object Map]"===u(e)}function y(e){return"[object Set]"===u(e)}function _(e){return"[object WeakMap]"===u(e)}function b(e){return"[object WeakSet]"===u(e)}function E(e){return"[object ArrayBuffer]"===u(e)}function w(e){return"undefined"!=typeof ArrayBuffer&&(E.working?E(e):e instanceof ArrayBuffer)}function x(e){return"[object DataView]"===u(e)}function T(e){return"undefined"!=typeof DataView&&(x.working?x(e):e instanceof DataView)}function A(e){return"[object SharedArrayBuffer]"===u(e)}function M(e){return"undefined"!=typeof SharedArrayBuffer&&(A.working?A(e):e instanceof SharedArrayBuffer)}function S(e){return g(e,h)}function R(e){return g(e,d)}function k(e){return g(e,f)}function P(e){return l&&g(e,p)}function L(e){return c&&g(e,m)}t.isArgumentsObject=r,t.isGeneratorFunction=i,t.isTypedArray=o,t.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},t.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):o(e)||T(e)},t.isUint8Array=function(e){return"Uint8Array"===a(e)},t.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===a(e)},t.isUint16Array=function(e){return"Uint16Array"===a(e)},t.isUint32Array=function(e){return"Uint32Array"===a(e)},t.isInt8Array=function(e){return"Int8Array"===a(e)},t.isInt16Array=function(e){return"Int16Array"===a(e)},t.isInt32Array=function(e){return"Int32Array"===a(e)},t.isFloat32Array=function(e){return"Float32Array"===a(e)},t.isFloat64Array=function(e){return"Float64Array"===a(e)},t.isBigInt64Array=function(e){return"BigInt64Array"===a(e)},t.isBigUint64Array=function(e){return"BigUint64Array"===a(e)},v.working="undefined"!=typeof Map&&v(new Map),t.isMap=function(e){return"undefined"!=typeof Map&&(v.working?v(e):e instanceof Map)},y.working="undefined"!=typeof Set&&y(new Set),t.isSet=function(e){return"undefined"!=typeof Set&&(y.working?y(e):e instanceof Set)},_.working="undefined"!=typeof WeakMap&&_(new WeakMap),t.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(_.working?_(e):e instanceof WeakMap)},b.working="undefined"!=typeof WeakSet&&b(new WeakSet),t.isWeakSet=function(e){return b(e)},E.working="undefined"!=typeof ArrayBuffer&&E(new ArrayBuffer),t.isArrayBuffer=w,x.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&x(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=T,A.working="undefined"!=typeof SharedArrayBuffer&&A(new SharedArrayBuffer),t.isSharedArrayBuffer=M,t.isAsyncFunction=function(e){return"[object AsyncFunction]"===u(e)},t.isMapIterator=function(e){return"[object Map Iterator]"===u(e)},t.isSetIterator=function(e){return"[object Set Iterator]"===u(e)},t.isGeneratorObject=function(e){return"[object Generator]"===u(e)},t.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===u(e)},t.isNumberObject=S,t.isStringObject=R,t.isBooleanObject=k,t.isBigIntObject=P,t.isSymbolObject=L,t.isBoxedPrimitive=function(e){return S(e)||R(e)||k(e)||P(e)||L(e)},t.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(w(e)||M(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw new Error(e+" is not supported in userland")}})}))},5663:(e,t,n)=>{var r=n(2530),i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},a=/%[sdj%]/g;t.format=function(e){if(!_(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(c(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),s=r[n];n<i;s=r[++n])v(s)||!w(s)?o+=" "+s:o+=" "+c(s);return o},t.deprecate=function(e,n){if(void 0!==r&&!0===r.noDeprecation)return e;if(void 0===r)return function(){return t.deprecate(e,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),i=!0}return e.apply(this,arguments)}};var o={},s=/^$/;if(r.env.NODE_DEBUG){var l=r.env.NODE_DEBUG;l=l.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+l+"$","i")}function c(e,n){var r={seen:[],stylize:h};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(n)?r.showHidden=n:n&&t._extend(r,n),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),d(r,e,r.depth)}function u(e,t){var n=c.styles[t];return n?"["+c.colors[n][0]+"m"+e+"["+c.colors[n][1]+"m":e}function h(e,t){return e}function d(e,n,r){if(e.customInspect&&n&&A(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return _(i)||(i=d(e,i,r)),i}var a=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(_(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(y(t))return e.stylize(""+t,"number");if(g(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),T(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return f(n);if(0===o.length){if(A(n)){var l=n.name?": "+n.name:"";return e.stylize("[Function"+l+"]","special")}if(E(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(x(n))return e.stylize(Date.prototype.toString.call(n),"date");if(T(n))return f(n)}var c,u="",h=!1,w=["{","}"];(m(n)&&(h=!0,w=["[","]"]),A(n))&&(u=" [Function"+(n.name?": "+n.name:"")+"]");return E(n)&&(u=" "+RegExp.prototype.toString.call(n)),x(n)&&(u=" "+Date.prototype.toUTCString.call(n)),T(n)&&(u=" "+f(n)),0!==o.length||h&&0!=n.length?r<0?E(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=h?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)P(t,String(o))?a.push(p(e,t,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(p(e,t,n,r,i,!0))})),a}(e,n,r,s,o):o.map((function(t){return p(e,n,r,s,t,h)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,u,w)):w[0]+u+w[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),P(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=v(n)?d(e,l.value,null):d(e,l.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),b(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function m(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function _(e){return"string"==typeof e}function b(e){return void 0===e}function E(e){return w(e)&&"[object RegExp]"===M(e)}function w(e){return"object"==typeof e&&null!==e}function x(e){return w(e)&&"[object Date]"===M(e)}function T(e){return w(e)&&("[object Error]"===M(e)||e instanceof Error)}function A(e){return"function"==typeof e}function M(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(e=e.toUpperCase(),!o[e])if(s.test(e)){var n=r.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.types=n(4489),t.isArray=m,t.isBoolean=g,t.isNull=v,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=_,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=E,t.types.isRegExp=E,t.isObject=w,t.isDate=x,t.types.isDate=x,t.isError=T,t.types.isNativeError=T,t.isFunction=A,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(9397);var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),R[e.getMonth()],t].join(" ")}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",k(),t.format.apply(t,arguments))},t.inherits=n(8575),t._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var L="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function C(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(L&&e[L]){var t;if("function"!=typeof(t=e[L]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,L,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),L&&Object.defineProperty(t,L,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=L,t.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var i=t.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};e.apply(this,t).then((function(e){r.nextTick(o.bind(null,null,e))}),(function(e){r.nextTick(C.bind(null,e,o))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,i(e)),t}},4871:(e,t,n)=>{"use strict";var r=n(4175),i=n(8455),a=n(7615),o=a("Object.prototype.toString"),s=n(9905)()&&"symbol"==typeof Symbol.toStringTag,l=i(),c=a("String.prototype.slice"),u={},h=n(8711),d=Object.getPrototypeOf;s&&h&&d&&r(l,(function(e){if("function"==typeof n.g[e]){var t=new n.g[e];if(!(Symbol.toStringTag in t))throw new EvalError("this engine has support for Symbol.toStringTag, but "+e+" does not have the property! Please report this.");var r=d(t),i=h(r,Symbol.toStringTag);if(!i){var a=d(r);i=h(a,Symbol.toStringTag)}u[e]=i.get}}));var f=n(2527);e.exports=function(e){return!!f(e)&&(s?function(e){var t=!1;return r(u,(function(n,r){if(!t)try{var i=n.call(e);i===r&&(t=i)}catch(e){}})),t}(e):c(o(e),8,-1))}},2176:e=>{"use strict";var t=Math.abs,n=Math.min;function r(e,i,a,o){var s=t(e-i);return null==a&&(a=r.DBL_EPSILON),null==o&&(o=a),s<=a||(s<=o*n(t(e),t(i))||e===i)}r.FLT_EPSILON=1.1920929e-7,r.DBL_EPSILON=2220446049250313e-31,e.exports=r},4750:(e,t,n)=>{"use strict";e.exports=function(e,t){return r(t).filter((function(n){for(var r=new Array(n.length),a=0;a<n.length;++a)r[a]=t[n[a]];return i(r)*e<1}))};var r=n(4124),i=n(7623)},1591:(e,t,n)=>{e.exports=function(e,t){return i(r(e,t))};var r=n(4750),i=n(8979)},19:(e,t)=>{"use strict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1||!e)},t.log2=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=n,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var r=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;e[t]=r<<i&255}}(r),t.reverse=function(e){return r[255&e]<<24|r[e>>>8&255]<<16|r[e>>>16&255]<<8|r[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},4966:e=>{"use strict";e.exports=function(e){var t,n,r,i=e.length,a=0;for(t=0;t<i;++t)a+=e[t].length;var o=new Array(a),s=0;for(t=0;t<i;++t){var l=e[t],c=l.length;for(n=0;n<c;++n){var u=o[s++]=new Array(c-1),h=0;for(r=0;r<c;++r)r!==n&&(u[h++]=l[r]);if(1&n){var d=u[1];u[1]=u[0],u[0]=d}}}return o}},5297:e=>{"use strict";e.exports=function(e){for(var t=1,n=1;n<e.length;++n)for(var r=0;r<n;++r)if(e[n]<e[r])t=-t;else if(e[r]===e[n])return 0;return t}},2174:(e,t,n)=>{"use strict";var r=n(6951),i=n(4857);function a(e,t){for(var n=0,r=e.length,i=0;i<r;++i)n+=e[i]*t[i];return n}function o(e){var t=e.length;if(0===t)return[];e[0].length;var n=r([e.length+1,e.length+1],1),o=r([e.length+1],1);n[t][t]=0;for(var s=0;s<t;++s){for(var l=0;l<=s;++l)n[l][s]=n[s][l]=2*a(e[s],e[l]);o[s]=a(e[s],e[s])}var c=i(n,o),u=0,h=c[t+1];for(s=0;s<h.length;++s)u+=h[s];var d=new Array(t);for(s=0;s<t;++s){h=c[s];var f=0;for(l=0;l<h.length;++l)f+=h[l];d[s]=f/u}return d}function s(e){if(0===e.length)return[];for(var t=e[0].length,n=r([t]),i=o(e),a=0;a<e.length;++a)for(var s=0;s<t;++s)n[s]+=e[a][s]*i[a];return n}s.barycenetric=o,e.exports=s},7623:(e,t,n)=>{e.exports=function(e){for(var t=r(e),n=0,i=0;i<e.length;++i)for(var a=e[i],o=0;o<t.length;++o)n+=Math.pow(a[o]-t[o],2);return Math.sqrt(n/e.length)};var r=n(2174)},8743:e=>{e.exports=function(e,r){var i=e.length,a=e.length-r.length;if(a)return a;switch(i){case 0:return 0;case 1:return e[0]-r[0];case 2:return e[0]+e[1]-r[0]-r[1]||t(e[0],e[1])-t(r[0],r[1]);case 3:var o=e[0]+e[1],s=r[0]+r[1];if(a=o+e[2]-(s+r[2]))return a;var l=t(e[0],e[1]),c=t(r[0],r[1]);return t(l,e[2])-t(c,r[2])||t(l+e[2],o)-t(c+r[2],s);case 4:var u=e[0],h=e[1],d=e[2],f=e[3],p=r[0],m=r[1],g=r[2],v=r[3];return u+h+d+f-(p+m+g+v)||t(u,h,d,f)-t(p,m,g,v,p)||t(u+h,u+d,u+f,h+d,h+f,d+f)-t(p+m,p+g,p+v,m+g,m+v,g+v)||t(u+h+d,u+h+f,u+d+f,h+d+f)-t(p+m+g,p+m+v,p+g+v,m+g+v);default:for(var y=e.slice().sort(n),_=r.slice().sort(n),b=0;b<i;++b)if(a=y[b]-_[b])return a;return 0}};var t=Math.min;function n(e,t){return e-t}},67:(e,t,n)=>{"use strict";var r=n(8743),i=n(5297);e.exports=function(e,t){return r(e,t)||i(e)-i(t)}},1690:(e,t,n)=>{"use strict";var r=n(639);e.exports=function(e){var t=e.length;if(0===t)return[];if(1===t)return[[0]];var n=e[0].length;return 0===n?[]:1===n?function(e){for(var t=0,n=0,r=1;r<e.length;++r)e[r][0]<e[t][0]&&(t=r),e[r][0]>e[n][0]&&(n=r);return t<n?[[t],[n]]:t>n?[[n],[t]]:[[t]]}(e):2===n?function(e){var t=r(e),n=t.length;if(n<=2)return[];for(var i=new Array(n),a=t[n-1],o=0;o<n;++o){var s=t[o];i[o]=[a,s],a=s}return i}(e):[]}},202:(e,t,n)=>{"use strict";var r=n(2176),i=n(6951);e.exports={fromList:c,fromDictionary:function(e,t,n){return c(Object.keys(e).map((function(t){var n=t.split(",");return[0|n[0],0|n[1],e[t]]})),t,n)},fromDense:function(e){var t=[],n=e.length;if(0===n)return c([],0,0);for(var r=e[0].length,i=0;i<n;++i)for(var o=e[i],s=0;s<r;++s){var l=o[s];Math.abs(l)>a&&t.push([i,s,l])}return c(t,n,r)},fromNDArray:function(e){var t=[],n=e.shape[0],r=e.shape[1];if(e.stride[1]>e.stride[0])for(var i=0;i<r;++i)for(var a=0;a<n;++a)t.push([a,i,e.get(a,i)]);else for(a=0;a<n;++a)for(i=0;i<r;++i)t.push([a,i,e.get(a,i)]);return c(t,n,r)}};var a=r.DBL_EPSILON;function o(e,t,n,r,i){this.rows=e,this.row_ptrs=t,this.columns=n,this.column_ptrs=r,this.data=i}var s=o.prototype;function l(e,t){return e[0]-t[0]||e[1]-t[1]}function c(e,t,n){e=function(e,t,n){var r=0,i=0;for(e.sort(l);r<e.length;){var o=e[r++];if(!(o[0]>=t||o[1]>=n)){for(;r<e.length&&0===l(e[r],o);)o[2]+=e[r++][2];Math.abs(o[2])>a&&(e[i++]=o)}}return e.length=i,e}(e,t||1/0,n||1/0);var r=[],i=[],s=[],c=[],u=new Float64Array(e.length);t=t||0,n=n||0;for(var h=0;h<e.length;++h){var d=e[h];0===h||d[0]!==e[h-1][0]?(r.push(d[0]),i.push(s.length),s.push(d[1]),c.push(h)):d[1]!==e[h-1][1]+1&&(s.push(d[1]),c.push(h)),t=Math.max(t,d[0]+1),n=Math.max(n,d[1]+1),u[h]=d[2]}return r.push(t),i.push(s.length),s.push(n),c.push(u.length),new o(new Uint32Array(r),new Uint32Array(i),new Uint32Array(s),new Uint32Array(c),u)}Object.defineProperty(s,"rowCount",{get:function(){return this.rows[this.rows.length-1]}}),Object.defineProperty(s,"columnCount",{get:function(){return this.columns[this.columns.length-1]}}),s.apply=function(e,t){return function(e,t,n,r,i,a,o){for(var s=0,l=0,c=0,u=0,h=e.length-1;u<h;++u){for(var d=e[u],f=t[u+1],p=0;++c<d;)o[c]=0;for(;s<f;)for(var m=n[s],g=r[++s];l<g;)p+=i[l++]*a[m++];o[d]=p}for(var v=o.length;++c<v;)o[c]=0}(this.rows,this.row_ptrs,this.columns,this.column_ptrs,this.data,e,t),t},s.transpose=function(){for(var e=this.toList(),t=0;t<e.length;++t){var n=e[t],r=n[0];n[0]=n[1],n[1]=r}return c(e,this.columnCount,this.rowCount)},s.toList=function(){for(var e=[],t=0,n=this.rows.length-1;t<n;++t)for(var r=this.rows[t],i=this.row_ptrs[t],a=this.row_ptrs[t+1];i<a;++i)for(var o=this.columns[i],s=this.column_ptrs[i],l=this.column_ptrs[i+1];s<l;++s){var c=this.data[s];e.push([r,o++,c])}return e},s.toDictionary=function(){for(var e={},t=0,n=this.rows.length-1;t<n;++t)for(var r=this.rows[t],i=this.row_ptrs[t],a=this.row_ptrs[t+1];i<a;++i)for(var o=this.columns[i],s=this.column_ptrs[i],l=this.column_ptrs[i+1];s<l;++s){var c=this.data[s];e[[r,o++]]=c}return e},s.toDense=function(){for(var e=i([this.rowCount,this.columnCount],0),t=0,n=this.rows.length-1;t<n;++t)for(var r=this.rows[t],a=this.row_ptrs[t],o=this.row_ptrs[t+1];a<o;++a)for(var s=this.columns[a],l=this.column_ptrs[a],c=this.column_ptrs[a+1];l<c;++l){var u=this.data[l];e[r][s++]=u}return e},o.prototype.toNDArray=function(e){for(var t=0,n=this.rows.length-1;t<n;++t)for(var r=this.rows[t],i=this.row_ptrs[t],a=this.row_ptrs[t+1];i<a;++i)for(var o=this.columns[i],s=this.column_ptrs[i],l=this.column_ptrs[i+1];s<l;++s){var c=this.data[s];e.set(r,o++,c)}return e}},9245:(e,t,n)=>{"use strict";var r=n(8506);function i(e,t,n){var r,i,a=e.length,o=t.arrayArgs.length,s=t.indexArgs.length>0,l=[],c=[],u=0,h=0;for(r=0;r<a;++r)c.push(["i",r,"=0"].join(""));for(i=0;i<o;++i)for(r=0;r<a;++r)h=u,u=e[r],0===r?c.push(["d",i,"s",r,"=t",i,"p",u].join("")):c.push(["d",i,"s",r,"=(t",i,"p",u,"-s",h,"*t",i,"p",h,")"].join(""));for(c.length>0&&l.push("var "+c.join(",")),r=a-1;r>=0;--r)u=e[r],l.push(["for(i",r,"=0;i",r,"<s",u,";++i",r,"){"].join(""));for(l.push(n),r=0;r<a;++r){for(h=u,u=e[r],i=0;i<o;++i)l.push(["p",i,"+=d",i,"s",r].join(""));s&&(r>0&&l.push(["index[",h,"]-=s",h].join("")),l.push(["++index[",u,"]"].join(""))),l.push("}")}return l.join("\n")}function a(e,t,n){for(var r=e.body,i=[],a=[],o=0;o<e.args.length;++o){var s=e.args[o];if(!(s.count<=0)){var l=new RegExp(s.name,"g"),c="",u=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var h=t.offsetArgIndex.indexOf(o);u=t.offsetArgs[h].array,c="+q"+h;case"array":c="p"+u+c;var d="l"+o,f="a"+u;if(0===t.arrayBlockIndices[u])1===s.count?"generic"===n[u]?s.lvalue?(i.push(["var ",d,"=",f,".get(",c,")"].join("")),r=r.replace(l,d),a.push([f,".set(",c,",",d,")"].join(""))):r=r.replace(l,[f,".get(",c,")"].join("")):r=r.replace(l,[f,"[",c,"]"].join("")):"generic"===n[u]?(i.push(["var ",d,"=",f,".get(",c,")"].join("")),r=r.replace(l,d),s.lvalue&&a.push([f,".set(",c,",",d,")"].join(""))):(i.push(["var ",d,"=",f,"[",c,"]"].join("")),r=r.replace(l,d),s.lvalue&&a.push([f,"[",c,"]=",d].join("")));else{for(var p=[s.name],m=[c],g=0;g<Math.abs(t.arrayBlockIndices[u]);g++)p.push("\\s*\\[([^\\]]+)\\]"),m.push("$"+(g+1)+"*t"+u+"b"+g);if(l=new RegExp(p.join(""),"g"),c=m.join("+"),"generic"===n[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(l,[f,"[",c,"]"].join(""))}break;case"scalar":r=r.replace(l,"Y"+t.scalarArgs.indexOf(o));break;case"index":r=r.replace(l,"index");break;case"shape":r=r.replace(l,"shape")}}}return[i.join("\n"),r,a.join("\n")].join("\n").trim()}function o(e){for(var t=new Array(e.length),n=!0,r=0;r<e.length;++r){var i=e[r],a=i.match(/\d+/);a=a?a[0]:"",0===i.charAt(0)?t[r]="u"+i.charAt(1)+a:t[r]=i.charAt(0)+a,r>0&&(n=n&&t[r]===t[r-1])}return n?t[0]:t.join("")}var s=function(e,t){for(var n=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,s=new Array(e.arrayArgs.length),l=new Array(e.arrayArgs.length),c=0;c<e.arrayArgs.length;++c)l[c]=t[2*c],s[c]=t[2*c+1];var u=[],h=[],d=[],f=[],p=[];for(c=0;c<e.arrayArgs.length;++c){e.arrayBlockIndices[c]<0?(d.push(0),f.push(n),u.push(n),h.push(n+e.arrayBlockIndices[c])):(d.push(e.arrayBlockIndices[c]),f.push(e.arrayBlockIndices[c]+n),u.push(0),h.push(e.arrayBlockIndices[c]));for(var m=[],g=0;g<s[c].length;g++)d[c]<=s[c][g]&&s[c][g]<f[c]&&m.push(s[c][g]-d[c]);p.push(m)}var v=["SS"],y=["'use strict'"],_=[];for(g=0;g<n;++g)_.push(["s",g,"=SS[",g,"]"].join(""));for(c=0;c<e.arrayArgs.length;++c){v.push("a"+c),v.push("t"+c),v.push("p"+c);for(g=0;g<n;++g)_.push(["t",c,"p",g,"=t",c,"[",d[c]+g,"]"].join(""));for(g=0;g<Math.abs(e.arrayBlockIndices[c]);++g)_.push(["t",c,"b",g,"=t",c,"[",u[c]+g,"]"].join(""))}for(c=0;c<e.scalarArgs.length;++c)v.push("Y"+c);if(e.shapeArgs.length>0&&_.push("shape=SS.slice(0)"),e.indexArgs.length>0){var b=new Array(n);for(c=0;c<n;++c)b[c]="0";_.push(["index=[",b.join(","),"]"].join(""))}for(c=0;c<e.offsetArgs.length;++c){var E=e.offsetArgs[c],w=[];for(g=0;g<E.offset.length;++g)0!==E.offset[g]&&(1===E.offset[g]?w.push(["t",E.array,"p",g].join("")):w.push([E.offset[g],"*t",E.array,"p",g].join("")));0===w.length?_.push("q"+c+"=0"):_.push(["q",c,"=",w.join("+")].join(""))}var x=r([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((_=_.concat(x)).length>0&&y.push("var "+_.join(",")),c=0;c<e.arrayArgs.length;++c)y.push("p"+c+"|=0");e.pre.body.length>3&&y.push(a(e.pre,e,l));var T=a(e.body,e,l),A=function(e){for(var t=0,n=e[0].length;t<n;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}(p);A<n?y.push(function(e,t,n,r){for(var a=t.length,o=n.arrayArgs.length,s=n.blockSize,l=n.indexArgs.length>0,c=[],u=0;u<o;++u)c.push(["var offset",u,"=p",u].join(""));for(u=e;u<a;++u)c.push(["for(var j"+u+"=SS[",t[u],"]|0;j",u,">0;){"].join("")),c.push(["if(j",u,"<",s,"){"].join("")),c.push(["s",t[u],"=j",u].join("")),c.push(["j",u,"=0"].join("")),c.push(["}else{s",t[u],"=",s].join("")),c.push(["j",u,"-=",s,"}"].join("")),l&&c.push(["index[",t[u],"]=j",u].join(""));for(u=0;u<o;++u){for(var h=["offset"+u],d=e;d<a;++d)h.push(["j",d,"*t",u,"p",t[d]].join(""));c.push(["p",u,"=(",h.join("+"),")"].join(""))}for(c.push(i(t,n,r)),u=e;u<a;++u)c.push("}");return c.join("\n")}(A,p[0],e,T)):y.push(i(p[0],e,T)),e.post.body.length>3&&y.push(a(e.post,e,l)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+y.join("\n")+"\n----------");var M=[e.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",A,o(l)].join("");return new Function(["function ",M,"(",v.join(","),"){",y.join("\n"),"} return ",M].join(""))()};function l(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}e.exports=function(e){var t=new l;t.pre=e.pre,t.body=e.body,t.post=e.post;var n=e.args.slice(0);t.argTypes=n;for(var r=0;r<n.length;++r){var i=n[r];if("array"===i||"object"==typeof i&&i.blockIndices){if(t.argTypes[r]="array",t.arrayArgs.push(r),t.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),t.shimArgs.push("array"+r),r<t.pre.args.length&&t.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array args");if(r<t.post.args.length&&t.post.args[r].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)t.scalarArgs.push(r),t.shimArgs.push("scalar"+r);else if("index"===i){if(t.indexArgs.push(r),r<t.pre.args.length&&t.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array index");if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array index");if(r<t.post.args.length&&t.post.args[r].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(t.shapeArgs.push(r),r<t.pre.args.length&&t.pre.args[r].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array shape");if(r<t.post.args.length&&t.post.args[r].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+n[r]);t.argTypes[r]="offset",t.offsetArgs.push({array:i.array,offset:i.offset}),t.offsetArgIndex.push(r)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,function(e){var t=["'use strict'","var CACHED={}"],n=[],r=e.funcName+"_cwise_thunk";t.push(["return function ",r,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],a=[],o=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],l=[],c=[],u=0;u<e.arrayArgs.length;++u){var h=e.arrayArgs[u];n.push(["t",h,"=array",h,".dtype,","r",h,"=array",h,".order"].join("")),i.push("t"+h),i.push("r"+h),a.push("t"+h),a.push("r"+h+".join()"),o.push("array"+h+".data"),o.push("array"+h+".stride"),o.push("array"+h+".offset|0"),u>0&&(l.push("array"+e.arrayArgs[0]+".shape.length===array"+h+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[u]))),c.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+h+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[u])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+c.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),u=0;u<e.scalarArgs.length;++u)o.push("scalar"+e.scalarArgs[u]);return n.push(["type=[",a.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),t.push("var "+n.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",o.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(s.bind(void 0,e))}(t)}},7065:(e,t,n)=>{var r,i,a,o,s,l=n(3794).angleNormals,c=null,u=null,h=null,d=null,f=!1,p=!1;function m(){if(!f)throw new Error("Must call initModule() before calling this function!")}function g(e){a=e;for(var t=new Int32Array(3*a.cells.length),n=0,o=0;o<a.cells.length;++o){var s=a.cells[o];t[n++]=s[0],t[n++]=s[1],t[n++]=s[2]}var l=t.length*t.BYTES_PER_ELEMENT;d=Module._malloc(l),(r=new Uint8Array(Module.HEAPU8.buffer,d,l)).set(new Uint8Array(t.buffer));var c=new Float64Array(3*a.positions.length);for(n=0,o=0;o<a.positions.length;++o){s=a.positions[o];c[n++]=s[0],c[n++]=s[1],c[n++]=s[2]}l=c.length*c.BYTES_PER_ELEMENT;h=Module._malloc(l),(i=new Uint8Array(Module.HEAPU8.buffer,h,l)).set(new Uint8Array(c.buffer)),f=!0}function v(e,t){m(),o=[];var n=0;for(const t of e)o[n++]=t;s=n;for(const e of t)o[n++]=e;var l=new Int32Array(o),u=l.length*l.BYTES_PER_ELEMENT;null!==c&&(Module._free(c),c=null),c=Module._malloc(u);var h=new Uint8Array(Module.HEAPU8.buffer,c,u);h.set(new Uint8Array(l.buffer)),prepareDeformWrap(r.byteOffset,3*a.cells.length,i.byteOffset,3*a.positions.length,h.byteOffset,o.length,s,!0),p=!0}function y(e){!function(){if(!p)throw new Error("Must call prepareDeform() before calling this function!")}();for(var t=s,n=new Float64Array(3*t),r=0,o=0;o<e.length;++o)n[r++]=e[o][0],n[r++]=e[o][1],n[r++]=e[o][2];var l=n.length*n.BYTES_PER_ELEMENT;null!==u&&(Module._free(u),u=null),u=Module._malloc(l);var c=new Uint8Array(Module.HEAPU8.buffer,u,l);c.set(new Uint8Array(n.buffer)),doDeformWrap(c.byteOffset,t,i.byteOffset);var h=new Float64Array(i.buffer,i.byteOffset,3*a.positions.length),d=[];for(o=0;o<a.positions.length;++o)d[o]=[h[3*o+0],h[3*o+1],h[3*o+2]];return d}function _(){m(),Module._free(h),Module._free(d),null!==c&&(Module._free(c),c=null),null!==u&&(Module._free(u),u=null),freeDeformWrap(),f=!1}e.exports={msh:null,adj:[],roi:{},_getOneRing:function(e){for(var t=[],n=0,r=e.positions.length;n<r;n++)t[n]=[];for(n=0,r=e.cells.length;n<r;n++)for(var i=e.cells[n],a=0;a<3;a++){var o=i[a+0],s=i[(a+1)%3];t[o].push(s)}return t},setMesh:function(e,t){if(this.msh===e&&f)t&&t();else{var n=this;n.dispose(),function(e){Module={},new Promise((t=>{fetch("./trimesh/laplacian_deformation.wasm").then((e=>e.arrayBuffer())).then((n=>{Module.wasmBinary=n;const r=document.createElement("script");r.src="./trimesh/laplacian_deformation.js",Module.onRuntimeInitialized=function(){prepareDeformWrap=Module.cwrap("prepareDeform",null,["number","number","number","number","number","number","number","number"]),doDeformWrap=Module.cwrap("doDeform",null,["number","number","number"]),freeDeformWrap=Module.cwrap("freeDeform",null,[]),e(g,v,y,_)},r.onload=()=>{t(Module)},document.body.appendChild(r)}))})).then((e=>{}))}((function(r,i,a,o){n._initModule=r,n._prepareDeform=i,n._doDeform=a,n._freeModule=o,n.msh=e,void 0===e.normals&&(e.normals=l(e.cells,e.positions)),n.adj=n._getOneRing(e),n._initModule(e),t&&t()}))}},setROI:function(e,t,n,r){var i=this.adj,a=this.roi;a.handles=[],a.unconstrained=[];for(var o=[e],s=[],l=0,c=this.msh.positions.length;l<c;l++)s[l]=!1;for(var u=0;u<t;u++){var h=[];for(l=0;l<o.length;l++){if(!s[p=o[l]]){a.handles.push(p),s[p]=!0;for(var d=i[p],f=0;f<d.length;f++)h.push(d[f])}}o=h}for(u=0;u<n;u++){for(h=[],l=0;l<o.length;l++){if(!s[p=o[l]]){a.unconstrained.push(p),s[p]=!0;for(d=i[p],f=0;f<d.length;f++)h.push(d[f])}}o=h}a.boundaryIndices=a.handles.length;for(l=0;l<o.length;l++){var p;s[p=o[l]]||(a.handles.push(p),s[p]=!0)}this._prepareDeform(a.handles,a.unconstrained),r&&r()},deform:function(e,t){var n=this.roi;if(n.handles&&0!==n.handles.length){for(var r=n.handles,i=n.boundaryIndices,a=[],o=this.msh.positions,s=0,l=r.length;s<l;s++)s>=i?a.push([o[r[s]][0],o[r[s]][1],o[r[s]][2]]):a.push([o[r[s]][0]+e[0],o[r[s]][1]+e[1],o[r[s]][2]+e[2]]);var c=this._doDeform(a);for(s=0,l=c.length;s<l;s++)o[s]=c[s];if(!t)return this.msh;t(this.msh)}},dispose:function(){this.msh=null,this.adj=[],this.roi={},f&&this._freeModule()},run:function(e,t,n,r,i,a){var o=this;o.setMesh(e,(function(){o.setROI(t,r,i,(function(){o.deform(n,(function(e){a&&a(e)}))}))}))}}},4124:(e,t,n)=>{"use strict";var r=n(3477),i=n(8506);function a(e,t){this.point=e,this.index=t}function o(e,t){for(var n=e.point,r=t.point,i=n.length,a=0;a<i;++a){var o=r[a]-n[a];if(o)return o}return 0}e.exports=function(e,t){var n=e.length;if(0===n)return[];var s=e[0].length;if(s<1)return[];if(1===s)return function(e,t,n){if(1===e)return n?[[-1,0]]:[];var r=t.map((function(e,t){return[e[0],t]}));r.sort((function(e,t){return e[0]-t[0]}));for(var i=new Array(e-1),a=1;a<e;++a){var o=r[a-1],s=r[a];i[a-1]=[o[1],s[1]]}n&&i.push([-1,i[0][1]],[i[e-1][1],-1]);return i}(n,e,t);for(var l=new Array(n),c=1,u=0;u<n;++u){for(var h=e[u],d=new Array(s+1),f=0,p=0;p<s;++p){var m=h[p];d[p]=m,f+=m*m}d[s]=f,l[u]=new a(d,u),c=Math.max(f,c)}i(l,o),n=l.length;var g=new Array(n+s+1),v=new Array(n+s+1),y=(s+1)*(s+1)*c,_=new Array(s+1);for(u=0;u<=s;++u)_[u]=0;_[s]=y,g[0]=_.slice(),v[0]=-1;for(u=0;u<=s;++u){(d=_.slice())[u]=1,g[u+1]=d,v[u+1]=-1}for(u=0;u<n;++u){var b=l[u];g[u+s+1]=b.point,v[u+s+1]=b.index}var E=r(g,!1);E=t?E.filter((function(e){for(var t=0,n=0;n<=s;++n){var r=v[e[n]];if(r<0&&++t>=2)return!1;e[n]=r}return!0})):E.filter((function(e){for(var t=0;t<=s;++t){var n=v[e[t]];if(n<0)return!1;e[t]=n}return!0}));if(1&s)for(u=0;u<E.length;++u){d=(b=E[u])[0];b[0]=b[1],b[1]=d}return E}},6951:e=>{"use strict";function t(e,n,r){var i=0|e[r];if(i<=0)return[];var a,o=new Array(i);if(r===e.length-1)for(a=0;a<i;++a)o[a]=n;else for(a=0;a<i;++a)o[a]=t(e,n,r+1);return o}e.exports=function(e,n){switch(void 0===n&&(n=0),typeof e){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,n);break;case"object":if("number"==typeof e.length)return t(e,n,0)}return[]}},579:(e,t)=>{function n(e){var t=1023&e;return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&(t|t<<16))|t<<8))|t<<4))|t<<2)}function r(e,t,r){return n(e)|n(t)<<1|n(r)<<2}function i(e,t){this.coeffs=e,this.children=t}function a(e,t,n,r){this.bounds=e,this.coeff=t,this.root=n,this.depth=r}function o(){return new i([0,0,0,0,0,0,0],[null,null,null,null,null,null,null,null])}var s={HaarNode:i,HaarTree:a,createEmptyNode:o,createEmptyTree:function(e,t){return new a(e,0,o(),t)}};function l(e,t,n,i,a){var o=30-a,s=this.x=t<<o,l=this.y=n<<o,c=this.z=i<<o;this.c0=r(s>>20,l>>20,c>>20),this.c1=r(s>>10,l>>10,c>>10),this.c2=r(s,l,c),this.w=e,this.l=a}var c=[];function u(e,t,n,r,i,a){if(e)for(var o=e.coeffs,s=o[0],h=o[1],d=o[2],f=o[3],p=o[4],m=o[5],g=o[6],v=e.children,y=n<<1,_=r<<1,b=i<<1,E=0,w=0;w<2;++w)for(var x=0;x<2;++x)for(var T=0;T<2;++T,++E){var A=1-2*T,M=1-2*x,S=1-2*w,R=A*s+M*h+A*M*d+S*f+A*S*p+M*S*m+A*M*S*g;u(v[E],t+R,y+T,_+x,b+w,a+1)}else c.push(new l(t,n,r,i,a))}function h(e){u(e.root,e.coeff,0,0,0,0);var t=c.slice();return c.length=0,t}var d=32;function f(e,t,n,r){this.c0=e,this.c1=t,this.c2=n,this.children=r}function p(e,t){this.root=e,this.cells=t}function m(e,t){return Math.floor((t-e)/33)}function g(e){return 0|Math.min(Math.max(e,0),(1<<30)-1)}var v={create:function(e){return new p(function t(n,r){if(r-n<=d)return null;for(var i=m(n,r),a=new Array(d),o=new Array(d),s=new Array(d),l=new Array(33),c=0;c<d;++c){var u=n+i*c,h=n+i*(c+1),p=e[h];a[c]=p.c0,o[c]=p.c1,s[c]=p.c2,l[c]=t(u,h)}return l[d]=t(n+i*d,r),new f(a,o,s,l)}(0,e.length),e)},search:function(e,t,n,i){for(var a=g(t),o=g(n),s=g(i),l=r(a>>20,o>>20,s>>20),c=r(a>>10,o>>10,s>>10),u=r(a,o,s),h=e.cells,f=0,p=h.length,v=e.root;v;){var y,_=m(f,p),b=v.c0,E=v.c1,w=v.c2,x=v.children;for(y=0;y<d;++y){if((b[y]-l||E[y]-c||w[y]-u)>0)break}y<d&&(p=f+(y+1)*_),f+=y*_,v=x[y]}for(var T=f+1;T<p;++T){var A=h[T],M=1<<30-A.l;if(A.x<=a&&a<A.x+M&&A.y<=o&&o<A.y+M&&A.z<=s&&s<A.z+M)return T}return f}};function y(e,t){var n,r=t||{};if(!e||!e.length)throw new Error("haar-rasterize: must specify positions");var i=(n="bounds"in r?function(e){var t=.5*Math.max(e[1][0]-e[0][0],e[1][1]-e[0][1],e[1][2]-e[0][2]),n=.5*(e[0][0]+e[1][0]),r=.5*(e[0][1]+e[1][1]),i=.5*(e[0][2]+e[1][2]);return[[n-t,r-t,i-t],[n+t,r+t,i+t]]}(r.bounds):function(e){var t,n=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(t=0;t<e.length;++t)for(var i=e[t],a=0;a<3;++a)n[a]=Math.min(i[a],n[a]),r[a]=Math.max(i[a],r[a]);var o=Math.max(r[0]-n[0],r[1]-n[1],r[2]-n[2]);for(t=0;t<3;++t){var s=.5*(n[t]+r[t]);n[t]=s-o,r[t]=s+o}return[n,r]}(e))[1][0]-n[0][0],a=0|r.depth;if(a||(a=r.resolution?Math.ceil(Math.log2(i/r.resolution)):8),!a)throw new Error("haar-rasterize: invalid depth");return s.createEmptyTree(n,a)}function _(e,t,n){this.tree=e,this.bounds=t,this.depth=n}var o=s.createEmptyNode,b=[];var E=[];function w(e,t,n){if(t<=e+6)return b.length;var r,i,a,o;E.length=0;for(var s=b.length,l=e,c=t-3;l<t;l+=3){var u=b[l+n],h=b[c+n];if(u<=.5!=h<=.5){for(((i=(.5-h)/(u-h))<0||i>1)&&(i=.5),a=1-i,r=0;r<3;++r)o=a*b[c+r]+i*b[l+r],b.push(o),E.push(o);b[b.length-3+n]=1,E[E.length-3+n]=0}if(u<.5){for(r=0;r<3;++r)b.push(b[l+r]);b[b.length-3+n]=2*u}else if(u>.5){for(r=0;r<3;++r)E.push(b[l+r]);E[E.length-3+n]=2*(u-.5)}else{for(r=0;r<3;++r)b.push(b[l+r]),E.push(b[l+r]);b[b.length-3+n]=1,E[E.length-3+n]=0}c=l}var d=b.length;if(s>=d+6&&(d=b.length=s),E.length>6)for(var f=0;f<E.length;++f)b.push(E[f]);return d}function x(e,t,n,r){if(n[0]=n[1]=n[2]=r[0]=r[1]=r[2]=0,!(e>=t)){for(var i=b[e],a=b[e+1],o=b[e+2],s=e+6;s<t;s+=3){var l=b[s-3],c=b[s-2],u=b[s-1],h=b[s],d=b[s+1],f=b[s+2],p=l-i,m=c-a,g=u-o,v=h-i,y=d-a,_=f-o,E=m*_-g*y,w=g*v-p*_,x=p*y-m*v,T=i+l+h,A=a+c+d,M=o+u+f;n[0]+=E,n[1]+=w,n[2]+=x,r[0]+=T*E,r[1]+=A*w,r[2]+=M*x}for(var S=0;S<3;++S)n[S]/=16,r[S]/=48}}var T=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],A=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];function M(e,t,n,r){var i=b.length,a=w(t,n,0),s=b.length,l=b.length,c=w(i,a,1),u=b.length,h=b.length,d=w(a,s,1),f=b.length,p=b.length,m=w(l,c,2),g=b.length,v=b.length,y=w(c,u,2),_=b.length,E=b.length,S=w(h,d,2),R=b.length,k=b.length,P=w(d,f,2),L=b.length;x(p,m,T[0],A[0]),x(E,S,T[1],A[1]),x(v,y,T[2],A[2]),x(k,P,T[3],A[3]),x(m,g,T[4],A[4]),x(S,R,T[5],A[5]),x(y,_,T[6],A[6]),x(P,L,T[7],A[7]);var C=T,I=A,N=e.coeffs;if(N[0]+=I[0][0]+C[1][0]-I[1][0]+I[2][0]+C[3][0]-I[3][0]+I[4][0]+C[5][0]-I[5][0]+I[6][0]+C[7][0]-I[7][0],N[1]+=I[0][1]+I[1][1]+C[2][1]-I[2][1]+C[3][1]-I[3][1]+I[4][1]+I[5][1]+C[6][1]-I[6][1]+C[7][1]-I[7][1],N[2]+=.5*(I[0][0]+I[0][1]+C[1][0]-I[1][0]-I[1][1]-I[2][0]+C[2][1]-I[2][1]+I[3][0]-C[3][0]+I[3][1]-C[3][1]+I[4][0]+I[4][1]+C[5][0]-I[5][0]-I[5][1]-I[6][0]+C[6][1]-I[6][1]+I[7][0]-C[7][0]+I[7][1]-C[7][1]),N[3]+=I[0][2]+I[1][2]+I[2][2]+I[3][2]+C[4][2]-I[4][2]+C[5][2]-I[5][2]+C[6][2]-I[6][2]+C[7][2]-I[7][2],N[4]+=.5*(I[0][0]+I[0][2]+C[1][0]-I[1][0]-I[1][2]+I[2][0]+I[2][2]+C[3][0]-I[3][0]-I[3][2]-I[4][0]+C[4][2]-I[4][2]+I[5][0]-C[5][0]+I[5][2]-C[5][2]-I[6][0]+C[6][2]-I[6][2]+I[7][0]-C[7][0]+I[7][2]-C[7][2]),N[5]+=.5*(I[0][1]+I[0][2]+I[1][1]+I[1][2]+C[2][1]-I[2][1]-I[2][2]+C[3][1]-I[3][1]-I[3][2]-I[4][1]+C[4][2]-I[4][2]-I[5][1]+C[5][2]-I[5][2]+I[6][1]-C[6][1]+I[6][2]-C[6][2]+I[7][1]-C[7][1]+I[7][2]-C[7][2]),N[6]+=1/3*(I[0][0]+I[0][1]+I[0][2]+C[1][0]-I[1][0]-I[1][1]-I[1][2]-I[2][0]+C[2][1]-I[2][1]-I[2][2]+I[3][0]-C[3][0]+I[3][1]-C[3][1]+I[3][2]+-I[4][0]-I[4][1]+C[4][2]-I[4][2]+I[5][0]-C[5][0]+I[5][1]+I[5][2]-C[5][2]+I[6][0]+I[6][1]-C[6][1]+I[6][2]-C[6][2]+C[7][0]-I[7][0]+C[7][1]-I[7][1]+C[7][2]-I[7][2]),r>1){var F=e.children;p<m&&M(F[0]||(F[0]=o()),p,m,r-1),E<S&&M(F[1]||(F[1]=o()),E,S,r-1),v<y&&M(F[2]||(F[2]=o()),v,y,r-1),k<P&&M(F[3]||(F[3]=o()),k,P,r-1),m<g&&M(F[4]||(F[4]=o()),m,g,r-1),S<R&&M(F[5]||(F[5]=o()),S,R,r-1),y<_&&M(F[6]||(F[6]=o()),y,_,r-1),P<L&&M(F[7]||(F[7]=o()),P,L,r-1)}b.length=i}t.rasterize=function(e,t,n){if(!e)throw new Error("haar-rasterize-cells: missing cells");var r=y(t,n);return function(e,t,n,r){var i,a,o,s,l,c,u,h,d,f,p,m,g=e.bounds,v=g[0],y=g[1][0]-v[0];for(i=0;i<t.length;++i){var _=t[i];if(3===_.length){for(b.length=0,a=0;a<3;++a){var E=n[_[a]];for(o=0;o<3;++o)b.push((E[o]-v[o])/y)}e.coeff+=(s=void 0,l=void 0,c=void 0,u=void 0,h=void 0,d=void 0,f=void 0,p=void 0,m=void 0,s=b[0],l=b[1],c=b[2],u=b[3],h=b[4],d=b[5],f=b[6],p=b[7],(s*(h*(m=b[8])-d*p)+l*(d*f-u*m)+c*(u*p-h*f))/6),M(e.root,0,9,r)}}}(r,e,t,r.depth),function(e){var t=h(e);return new _(v.create(t),e.bounds,e.depth)}(r)},t.sample=function(e,t,n,r){var i=e.bounds,a=i[0][0],o=i[0][1],s=i[0][2],l=i[1][0],c=i[1][1],u=i[1][2],h=0|Math.round((t-a)/(l-a)*(1<<30)),d=0|Math.round((n-o)/(c-o)*(1<<30)),f=0|Math.round((r-s)/(u-s)*(1<<30)),p=v.search(e.tree,h,d,f);return p?p.w:0};var S=v.search;function R(e,t){this.opp=e,this.idx=t}function k(e,t,n,r,i,a,o){for(var s=a.adj,l=0;l<s.length;++l)if(s[l].opp===o)return s[l].idx;var c=e.length;a.adj.push(new R(o,c)),o.adj.push(new R(a,c));var u=a.w,h=o.w,d=-h/(u-h),f=1-d;return e.push([(f*o.x+d*a.x)*t+n,(f*o.y+d*a.y)*t+r,(f*o.z+d*a.z)*t+i]),c}function P(e,t,n,r){this.x=e,this.y=t,this.z=n,this.w=0,this.l=r,this.adj=[],this.steiner=[]}function L(e,t,n,r){for(var i=0,a=e.length-1;i<a;){var o=i+a>>1,s=e[o],l=s.x-t||s.y-n||s.z-r;if(l>0)a=o-1;else{if(!(l<0))return s;i=o+1}}var c=e[i];return c.x===t&&c.y===n&&c.z===r?c:null}function C(e,t,n,r,i){for(var a=(t.x>>1)+(n.x>>1),o=(t.y>>1)+(n.y>>1),s=(t.z>>1)+(n.z>>1),l=t.steiner,c=0;c<l.length;++c){var u=l[c];if(u.x===a&&u.y===o&&u.z===s)return u}var h=new P(a,o,s,t.l);return h.w=O(e,a,o,s,i)-r,t.steiner.push(h),n.steiner.push(h),h}function I(e,t,n,r,i,a,o){for(var s=0|Math.floor(.25*(t.x+n.x+r.x+i.x)),l=0|Math.floor(.25*(t.y+n.y+r.y+i.y)),c=0|Math.floor(.25*(t.z+n.z+r.z+i.z)),u=t.steiner,h=0;h<u.length;++h){var d=u[h];if(d.x===s&&d.y===l&&d.z===c)return d}var f=new P(s,l,c,t.l);return f.w=.5*(a+o),t.steiner.push(f),n.steiner.push(f),r.steiner.push(f),i.steiner.push(f),f}function N(e,t,n,r,i,a,o,s,l,c){var u,h,d,f;switch(o.w<0|(s.w<0)<<1|(l.w<0)<<2|(c.w<0)<<3){case 0:break;case 1:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,o,l),d=k(e,n,r,i,a,o,c),t.push([u,h,d]);break;case 2:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,s,l),d=k(e,n,r,i,a,s,c),t.push([h,u,d]);break;case 3:u=k(e,n,r,i,a,o,l),h=k(e,n,r,i,a,o,c),d=k(e,n,r,i,a,s,l),f=k(e,n,r,i,a,s,c),t.push([d,u,h]),t.push([f,d,h]);break;case 4:u=k(e,n,r,i,a,o,l),h=k(e,n,r,i,a,s,l),d=k(e,n,r,i,a,l,c),t.push([u,h,d]);break;case 5:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,o,c),d=k(e,n,r,i,a,s,l),f=k(e,n,r,i,a,l,c),t.push([u,d,h]),t.push([d,f,h]);break;case 6:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,o,l),d=k(e,n,r,i,a,s,c),f=k(e,n,r,i,a,l,c),t.push([h,u,d]),t.push([f,h,d]);break;case 7:u=k(e,n,r,i,a,o,c),h=k(e,n,r,i,a,s,c),d=k(e,n,r,i,a,l,c),t.push([h,d,u]);break;case 8:u=k(e,n,r,i,a,o,c),h=k(e,n,r,i,a,s,c),d=k(e,n,r,i,a,l,c),t.push([h,u,d]);break;case 9:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,o,l),d=k(e,n,r,i,a,s,c),f=k(e,n,r,i,a,l,c),t.push([d,u,h]),t.push([f,d,h]);break;case 10:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,o,c),d=k(e,n,r,i,a,s,l),f=k(e,n,r,i,a,l,c),t.push([u,h,d]),t.push([h,f,d]);break;case 11:u=k(e,n,r,i,a,o,l),h=k(e,n,r,i,a,s,l),d=k(e,n,r,i,a,l,c),t.push([d,h,u]);break;case 12:u=k(e,n,r,i,a,o,l),h=k(e,n,r,i,a,o,c),d=k(e,n,r,i,a,s,l),f=k(e,n,r,i,a,s,c),t.push([h,u,d]),t.push([f,h,d]);break;case 13:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,s,l),d=k(e,n,r,i,a,s,c),t.push([h,d,u]);break;case 14:u=k(e,n,r,i,a,o,s),h=k(e,n,r,i,a,o,l),d=k(e,n,r,i,a,o,c),t.push([d,h,u])}}function F(e,t,n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v){for(var y=h;y!==d;){for(var _=1<<30-y.l,b=null;!b;)b=L(s,y.x+_*f,y.y+_*p,y.z+_*m),_<<=1;var E=C(e,b,y,g,v);N(t,n,r,i,a,o,u,l,b,E),N(t,n,r,i,a,o,u,l,E,y),N(t,n,r,i,a,o,u,c,y,E),N(t,n,r,i,a,o,u,c,E,b),y=b}}function O(e,t,n,r,i){return function(e,t,n,r){for(var i=0,a=0;a<2;++a)for(var o=0;o<2;++o)for(var s=0;s<2;++s)i+=e.cells[S(e,t-a,n-o,r-s)].w;return i/8}(e,t,n,r)}function H(e,t){return e.x-t.x||e.y-t.y||e.z-t.z}t.contour=function(e,t){var n,r="number"==typeof t?+t:-.5,i=e.tree,a=i.cells,o=(e.depth,0),s=new Array(8*a.length),l=new Array(a.length);for(n=0;n<a.length;++n){var c=a[n],u=c.x,h=c.y,d=c.z,f=c.l,p=1<<30-f;s[o++]=new P(u,h,d,f),s[o++]=new P(u+p,h,d,f),s[o++]=new P(u,h+p,d,f),s[o++]=new P(u+p,h+p,d,f),s[o++]=new P(u,h,d+p,f),s[o++]=new P(u+p,h,d+p,f),s[o++]=new P(u,h+p,d+p,f),s[o++]=new P(u+p,h+p,d+p,f);var m=new P(u+(p>>1),h+(p>>1),d+(p>>1),f);m.w=O(i,m.x,m.y,m.z)-r,l[n]=m}s.sort(H);var g=0;for(n=0;n<s.length;++n){for(var v=s[n].l;n+1<s.length&&0===H(s[n],s[n+1]);)v=Math.max(v,s[++n].l);var y=s[n];s[g++]=y,y.l=v,y.w=O(i,y.x,y.y,y.z)-r}return s.length=g,function(e,t,n,r){for(var i=e.tree,a=1<<30-e.depth,o=e.bounds,s=o[0],l=o[1],c=s[0],u=s[1],h=s[2],d=(l[0]-c)/(1<<30),f=[],p=[],m=i.cells,g=0;g<m.length;++g){var v,y,_,b=n[g],E=m[g],w=E.x,x=E.y,T=E.z,A=E.l,M=1<<30-A,R=null,k=null,P=null,C=null,N=null,O=null,H=null,D=null;m[v=S(i,w-1,x,T)].l<=A&&v!==g&&(R=R||L(t,w,x,T),P=P||L(t,w,x+M,T),N=N||L(t,w,x,T+M),H=H||L(t,w,x+M,T+M),F(i,f,p,d,c,u,h,t,b,y=n[v],_=I(0,R,P,N,H,y.w,b.w),R,P,0,1,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,P,H,0,0,1,r,a),F(i,f,p,d,c,u,h,t,b,y,_,H,N,0,-1,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,N,R,0,0,-1,r,a)),m[v=S(i,w+M,x,T)].l<A&&(k=k||L(t,w+M,x,T),O=O||L(t,w+M,x,T+M),C=C||L(t,w+M,x+M,T),D=D||L(t,w+M,x+M,T+M),F(i,f,p,d,c,u,h,t,b,y=n[v],_=I(0,k,O,C,D,y.w,b.w),k,O,0,0,1,r,a),F(i,f,p,d,c,u,h,t,b,y,_,O,D,0,1,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,D,C,0,0,-1,r,a),F(i,f,p,d,c,u,h,t,b,y,_,C,k,0,-1,0,r,a)),m[v=S(i,w,x-1,T)].l<=A&&v!==g&&(R=R||L(t,w,x,T),N=N||L(t,w,x,T+M),k=k||L(t,w+M,x,T),O=O||L(t,w+M,x,T+M),F(i,f,p,d,c,u,h,t,b,y=n[v],_=I(0,R,N,k,O,y.w,b.w),R,N,0,0,1,r,a),F(i,f,p,d,c,u,h,t,b,y,_,N,O,1,0,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,O,k,0,0,-1,r,a),F(i,f,p,d,c,u,h,t,b,y,_,k,R,-1,0,0,r,a)),m[v=S(i,w,x+M,T)].l<A&&(P=P||L(t,w,x+M,T),C=C||L(t,w+M,x+M,T),H=H||L(t,w,x+M,T+M),D=D||L(t,w+M,x+M,T+M),F(i,f,p,d,c,u,h,t,b,y=n[v],_=I(0,P,C,H,D,y.w,b.w),P,C,1,0,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,C,D,0,0,1,r,a),F(i,f,p,d,c,u,h,t,b,y,_,D,H,-1,0,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,H,P,0,0,-1,r,a)),m[v=S(i,w,x,T-1)].l<=A&&v!==g&&(R=R||L(t,w,x,T),k=k||L(t,w+M,x,T),P=P||L(t,w,x+M,T),C=C||L(t,w+M,x+M,T),F(i,f,p,d,c,u,h,t,b,y=n[v],_=I(0,R,k,P,C,y.w,b.w),R,k,1,0,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,k,C,0,1,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,C,P,-1,0,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,P,R,0,-1,0,r,a)),m[v=S(i,w,x,T+M)].l<A&&(N=N||L(t,w,x,T+M),H=H||L(t,w,x+M,T+M),O=O||L(t,w+M,x,T+M),D=D||L(t,w+M,x+M,T+M),F(i,f,p,d,c,u,h,t,b,y=n[v],_=I(0,N,H,O,D,y.w,b.w),N,H,0,1,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,H,D,1,0,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,D,O,0,-1,0,r,a),F(i,f,p,d,c,u,h,t,b,y,_,O,N,-1,0,0,r,a))}return{positions:f,cells:p}}(e,s,l,r)}},3930:function(e,t){var n,r,i;(function(){var a,o,s,l,c,u,h,d,f,p,m,g,v,y,_;s=Math.floor,p=Math.min,o=function(e,t){return e<t?-1:e>t?1:0},f=function(e,t,n,r,i){var a;if(null==n&&(n=0),null==i&&(i=o),n<0)throw new Error("lo must be non-negative");for(null==r&&(r=e.length);n<r;)i(t,e[a=s((n+r)/2)])<0?r=a:n=a+1;return[].splice.apply(e,[n,n-n].concat(t)),t},u=function(e,t,n){return null==n&&(n=o),e.push(t),y(e,0,e.length-1,n)},c=function(e,t){var n,r;return null==t&&(t=o),n=e.pop(),e.length?(r=e[0],e[0]=n,_(e,0,t)):r=n,r},d=function(e,t,n){var r;return null==n&&(n=o),r=e[0],e[0]=t,_(e,0,n),r},h=function(e,t,n){var r;return null==n&&(n=o),e.length&&n(e[0],t)<0&&(t=(r=[e[0],t])[0],e[0]=r[1],_(e,0,n)),t},l=function(e,t){var n,r,i,a,l,c;for(null==t&&(t=o),l=[],r=0,i=(a=function(){c=[];for(var t=0,n=s(e.length/2);0<=n?t<n:t>n;0<=n?t++:t--)c.push(t);return c}.apply(this).reverse()).length;r<i;r++)n=a[r],l.push(_(e,n,t));return l},v=function(e,t,n){var r;if(null==n&&(n=o),-1!==(r=e.indexOf(t)))return y(e,0,r,n),_(e,r,n)},m=function(e,t,n){var r,i,a,s,c;if(null==n&&(n=o),!(i=e.slice(0,t)).length)return i;for(l(i,n),a=0,s=(c=e.slice(t)).length;a<s;a++)r=c[a],h(i,r,n);return i.sort(n).reverse()},g=function(e,t,n){var r,i,a,s,u,h,d,m,g;if(null==n&&(n=o),10*t<=e.length){if(!(a=e.slice(0,t).sort(n)).length)return a;for(i=a[a.length-1],s=0,h=(d=e.slice(t)).length;s<h;s++)n(r=d[s],i)<0&&(f(a,r,0,null,n),a.pop(),i=a[a.length-1]);return a}for(l(e,n),g=[],u=0,m=p(t,e.length);0<=m?u<m:u>m;0<=m?++u:--u)g.push(c(e,n));return g},y=function(e,t,n,r){var i,a,s;for(null==r&&(r=o),i=e[n];n>t&&r(i,a=e[s=n-1>>1])<0;)e[n]=a,n=s;return e[n]=i},_=function(e,t,n){var r,i,a,s,l;for(null==n&&(n=o),i=e.length,l=t,a=e[t],r=2*t+1;r<i;)(s=r+1)<i&&!(n(e[r],e[s])<0)&&(r=s),e[t]=e[r],r=2*(t=r)+1;return e[t]=a,y(e,l,t,n)},a=function(){function e(e){this.cmp=null!=e?e:o,this.nodes=[]}return e.push=u,e.pop=c,e.replace=d,e.pushpop=h,e.heapify=l,e.updateItem=v,e.nlargest=m,e.nsmallest=g,e.prototype.push=function(e){return u(this.nodes,e,this.cmp)},e.prototype.pop=function(){return c(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return d(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return h(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return l(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return v(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),r=[],void 0===(i="function"==typeof(n=function(){return a})?n.apply(t,r):n)||(e.exports=i)}).call(this)},4787:e=>{e.exports=function(){function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return i(t[o][1][e]||e)}),c,c.exports,e,t,n,r)}return n[o].exports}for(var a=void 0,o=0;o<r.length;o++)i(r[o]);return i}return e}()({1:[function(e,t,n){function r(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function i(e){const t=[];for(let n=0;n<e.length;n++){for(;t.length>=2&&r(t[t.length-2],t[t.length-1],e[n])<=0;)t.pop();t.push(e[n])}return t.pop(),t}function a(e){const t=e.reverse(),n=[];for(let e=0;e<t.length;e++){for(;n.length>=2&&r(n[n.length-2],n[n.length-1],t[e])<=0;)n.pop();n.push(t[e])}return n.pop(),n}function o(e){const t=i(e),n=a(e).concat(t);return n.push(e[0]),n}t.exports=o},{}],2:[function(e,t,n){t.exports={toXy:function(e,t){return void 0===t?e.slice():e.map((function(e){return new Function("pt","return [pt"+t[0]+",pt"+t[1]+"];")(e)}))},fromXy:function(e,t){return void 0===t?e.slice():e.map((function(e){return new Function("pt","const o = {}; o"+t[0]+"= pt[0]; o"+t[1]+"= pt[1]; return o;")(e)}))}}},{}],3:[function(e,t,n){function r(e,t){this._cells=[],this._cellSize=t,this._reverseCellSize=1/t;for(let t=0;t<e.length;t++){const n=e[t],r=this.coordToCellNum(n[0]),i=this.coordToCellNum(n[1]);if(this._cells[r])this._cells[r][i]?this._cells[r][i].push(n):this._cells[r][i]=[n];else{const e=[];e[i]=[n],this._cells[r]=e}}}function i(e,t){return new r(e,t)}r.prototype={cellPoints:function(e,t){return void 0!==this._cells[e]&&void 0!==this._cells[e][t]?this._cells[e][t]:[]},rangePoints:function(e){const t=this.coordToCellNum(e[0]),n=this.coordToCellNum(e[1]),r=this.coordToCellNum(e[2]),i=this.coordToCellNum(e[3]),a=[];for(let e=t;e<=r;e++)for(let t=n;t<=i;t++)Array.prototype.push.apply(a,this.cellPoints(e,t));return a},removePoint:function(e){const t=this.coordToCellNum(e[0]),n=this.coordToCellNum(e[1]),r=this._cells[t][n];let i;for(let t=0;t<r.length;t++)if(r[t][0]===e[0]&&r[t][1]===e[1]){i=t;break}return r.splice(i,1),r},trunc:Math.trunc||function(e){return e-e%1},coordToCellNum:function(e){return this.trunc(e*this._reverseCellSize)},extendBbox:function(e,t){return[e[0]-t*this._cellSize,e[1]-t*this._cellSize,e[2]+t*this._cellSize,e[3]+t*this._cellSize]}},t.exports=i},{}],4:[function(e,t,n){"use strict";const r=e("./intersect.js"),i=e("./grid.js"),a=e("./format.js"),o=e("./convex.js");function s(e){const t=[e[0]];let n=e[0];for(let r=1;r<e.length;r++){const i=e[r];n[0]===i[0]&&n[1]===i[1]||t.push(i),n=i}return t}function l(e){return e.sort((function(e,t){return e[0]-t[0]||e[1]-t[1]}))}function c(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function u(e,t,n){const r=[t[0]-e[0],t[1]-e[1]],i=[n[0]-e[0],n[1]-e[1]],a=c(e,t),o=c(e,n);return(r[0]*i[0]+r[1]*i[1])/Math.sqrt(a*o)}function h(e,t){for(let n=0;n<t.length-1;n++){const i=[t[n],t[n+1]];if(!(e[0][0]===i[0][0]&&e[0][1]===i[0][1]||e[0][0]===i[1][0]&&e[0][1]===i[1][1])&&r(e,i))return!0}return!1}function d(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let a=e.length-1;a>=0;a--)e[a][0]<t&&(t=e[a][0]),e[a][1]<n&&(n=e[a][1]),e[a][0]>r&&(r=e[a][0]),e[a][1]>i&&(i=e[a][1]);return[r-t,i-n]}function f(e){return[Math.min(e[0][0],e[1][0]),Math.min(e[0][1],e[1][1]),Math.max(e[0][0],e[1][0]),Math.max(e[0][1],e[1][1])]}function p(e,t,n){let r,i,a=null,o=v,s=v;for(let l=0;l<t.length;l++)r=u(e[0],e[1],t[l]),i=u(e[1],e[0],t[l]),r>o&&i>s&&!h([e[0],t[l]],n)&&!h([e[1],t[l]],n)&&(o=r,s=i,a=t[l]);return a}function m(e,t,n,r,i){let a=!1;for(let o=0;o<e.length-1;o++){const s=[e[o],e[o+1]],l=s[0][0]+","+s[0][1]+","+s[1][0]+","+s[1][1];if(c(s[0],s[1])<t||i.has(l))continue;let u,h,d,m=0,g=f(s);do{g=r.extendBbox(g,m),u=g[2]-g[0],h=g[3]-g[1],d=p(s,r.rangePoints(g),e),m++}while(null===d&&(n[0]>u||n[1]>h));u>=n[0]&&h>=n[1]&&i.add(l),null!==d&&(e.splice(o+1,0,d),r.removePoint(d),a=!0)}return a?m(e,t,n,r,i):e}function g(e,t,n){let r=t||20;const c=s(l(a.toXy(e,n)));if(c.length<4)return c.concat([c[0]]);const u=d(c),h=[u[0]*y,u[1]*y],f=o(c),p=c.filter((function(e){return f.indexOf(e)<0})),g=Math.ceil(1/(c.length/(u[0]*u[1]))),v=m(f,Math.pow(r,2),h,i(p,g),new Set);return n?a.fromXy(v,n):v}const v=Math.cos(90/(180/Math.PI)),y=.6;t.exports=g},{"./convex.js":1,"./format.js":2,"./grid.js":3,"./intersect.js":5}],5:[function(e,t,n){function r(e,t,n,r,i,a){const o=(a-t)*(n-e)-(r-t)*(i-e);return o>0||!(o<0)}function i(e,t){const n=e[0][0],i=e[0][1],a=e[1][0],o=e[1][1],s=t[0][0],l=t[0][1],c=t[1][0],u=t[1][1];return r(n,i,s,l,c,u)!==r(a,o,s,l,c,u)&&r(n,i,a,o,s,l)!==r(n,i,a,o,c,u)}t.exports=i},{}]},{},[4])(4)},3477:(e,t,n)=>{"use strict";e.exports=function(e,t){var n=e.length;if(0===n)throw new Error("Must have at least d+1 points");var i=e[0].length;if(n<=i)throw new Error("Must input at least d+1 points");var o=e.slice(0,i+1),s=r.apply(void 0,o);if(0===s)throw new Error("Input not in general position");for(var l=new Array(i+1),u=0;u<=i;++u)l[u]=u;s<0&&(l[0]=1,l[1]=0);var h=new a(l,new Array(i+1),!1),d=h.adjacent,f=new Array(i+2);for(u=0;u<=i;++u){for(var p=l.slice(),m=0;m<=i;++m)m===u&&(p[m]=-1);var g=p[0];p[0]=p[1],p[1]=g;var v=new a(p,new Array(i+1),!0);d[u]=v,f[u]=v}f[i+1]=h;for(u=0;u<=i;++u){p=d[u].vertices;var y=d[u].adjacent;for(m=0;m<=i;++m){var _=p[m];if(_<0)y[m]=h;else for(var b=0;b<=i;++b)d[b].vertices.indexOf(_)<0&&(y[m]=d[b])}}var E=new c(i,o,f),w=!!t;for(u=i+1;u<n;++u)E.insert(e[u],w);return E.boundary()};var r=n(6651),i=n(8966).compareCells;function a(e,t,n){this.vertices=e,this.adjacent=t,this.boundary=n,this.lastVisited=-1}function o(e,t,n){this.vertices=e,this.cell=t,this.index=n}function s(e,t){return i(e.vertices,t.vertices)}a.prototype.flip=function(){var e=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=e;var t=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=t};var l=[];function c(e,t,n){this.dimension=e,this.vertices=t,this.simplices=n,this.interior=n.filter((function(e){return!e.boundary})),this.tuple=new Array(e+1);for(var i=0;i<=e;++i)this.tuple[i]=this.vertices[i];var a=l[e];a||(a=l[e]=function(e){for(var t=["function orient(){var tuple=this.tuple;return test("],n=0;n<=e;++n)n>0&&t.push(","),t.push("tuple[",n,"]");t.push(")}return orient");var i=new Function("test",t.join("")),a=r[e+1];return a||(a=r),i(a)}(e)),this.orient=a}var u=c.prototype;u.handleBoundaryDegeneracy=function(e,t){var n=this.dimension,r=this.vertices.length-1,i=this.tuple,a=this.vertices,o=[e];for(e.lastVisited=-r;o.length>0;){(e=o.pop()).vertices;for(var s=e.adjacent,l=0;l<=n;++l){var c=s[l];if(c.boundary&&!(c.lastVisited<=-r)){for(var u=c.vertices,h=0;h<=n;++h){var d=u[h];i[h]=d<0?t:a[d]}var f=this.orient();if(f>0)return c;c.lastVisited=-r,0===f&&o.push(c)}}}return null},u.walk=function(e,t){var n=this.vertices.length-1,r=this.dimension,i=this.vertices,a=this.tuple,o=t?this.interior.length*Math.random()|0:this.interior.length-1,s=this.interior[o];e:for(;!s.boundary;){for(var l=s.vertices,c=s.adjacent,u=0;u<=r;++u)a[u]=i[l[u]];s.lastVisited=n;for(u=0;u<=r;++u){var h=c[u];if(!(h.lastVisited>=n)){var d=a[u];a[u]=e;var f=this.orient();if(a[u]=d,f<0){s=h;continue e}h.boundary?h.lastVisited=-n:h.lastVisited=n}}return}return s},u.addPeaks=function(e,t){var n=this.vertices.length-1,r=this.dimension,i=this.vertices,l=this.tuple,c=this.interior,u=this.simplices,h=[t];t.lastVisited=n,t.vertices[t.vertices.indexOf(-1)]=n,t.boundary=!1,c.push(t);for(var d=[];h.length>0;){var f=(t=h.pop()).vertices,p=t.adjacent,m=f.indexOf(n);if(!(m<0))for(var g=0;g<=r;++g)if(g!==m){var v=p[g];if(v.boundary&&!(v.lastVisited>=n)){var y=v.vertices;if(v.lastVisited!==-n){for(var _=0,b=0;b<=r;++b)y[b]<0?(_=b,l[b]=e):l[b]=i[y[b]];if(this.orient()>0){y[_]=n,v.boundary=!1,c.push(v),h.push(v),v.lastVisited=n;continue}v.lastVisited=-n}var E=v.adjacent,w=f.slice(),x=p.slice(),T=new a(w,x,!0);u.push(T);var A=E.indexOf(t);if(!(A<0)){E[A]=T,x[m]=v,w[g]=-1,x[g]=t,p[g]=T,T.flip();for(b=0;b<=r;++b){var M=w[b];if(!(M<0||M===n)){for(var S=new Array(r-1),R=0,k=0;k<=r;++k){var P=w[k];P<0||k===b||(S[R++]=P)}d.push(new o(S,T,b))}}}}}}d.sort(s);for(g=0;g+1<d.length;g+=2){var L=d[g],C=d[g+1],I=L.index,N=C.index;I<0||N<0||(L.cell.adjacent[L.index]=C.cell,C.cell.adjacent[C.index]=L.cell)}},u.insert=function(e,t){var n=this.vertices;n.push(e);var r=this.walk(e,t);if(r){for(var i=this.dimension,a=this.tuple,o=0;o<=i;++o){var s=r.vertices[o];a[o]=s<0?e:n[s]}var l=this.orient(a);l<0||(0!==l||(r=this.handleBoundaryDegeneracy(r,e)))&&this.addPeaks(e,r)}},u.boundary=function(){for(var e=this.dimension,t=[],n=this.simplices,r=n.length,i=0;i<r;++i){var a=n[i];if(a.boundary){for(var o=new Array(e),s=a.vertices,l=0,c=0,u=0;u<=e;++u)s[u]>=0?o[l++]=s[u]:c=1&u;if(c===(1&e)){var h=o[0];o[0]=o[1],o[1]=h}t.push(o)}}return t}},1255:(e,t,n)=>{"use strict";e.exports=function(e,t){for(var n=function(e,t){return r.unique(r.normalize(r.skeleton(e,t)))}(e,1),l=r.incidence(n,e),c=r.dual(e,t.length),u=[],h=[],d=new Array(n.length),f=new Array(t.length),p=0;p<d.length;++p)d[p]=-1;for(p=0;p<f.length;++p)f[p]=-1;for(var m=0;m<e.length;++m){for(var g=e[m],v=0;v<3;++v){var y=g[v],_=g[(v+1)%3];s[0]=y,s[1]=_;var b=r.findCell(n,s),E=d[b];if(E>=0)a[v]=E;else{var w=l[b],x=t[_],T=t[y],A=new Array(3);if(2===w.length){var M=t[i(_,y,e[w[0]])],S=t[i(_,y,e[w[1]])];for(p=0;p<3;++p)A[p]=(3*(x[p]+T[p])+M[p]+S[p])/8}else for(p=0;p<3;++p)A[p]=.5*(x[p]+T[p]);d[b]=a[v]=u.length,u.push(A)}if(f[y]>=0)o[v]=f[y];else{var R=c[y],k=[y];for(p=0;p<R.length;++p)for(var P=e[R[p]],L=0;L<3;++L)-1!==k.indexOf(P[L])&&k.push(P[L]);var C=3===R.length?3/16:3/(8*R.length),I=1-R.length*C,N=t[y];for(A=[.1,.1,.1],p=0;p<3;++p)A[p]=I*N[p];for(p=1;p<k.length;++p){var F=t[k[p]];for(L=0;L<3;++L)A[L]+=C*F[L]}o[v]=f[y]=u.length,u.push(A)}}h.push([o[0],a[0],a[2]],[a[0],a[1],a[2]],[a[0],o[1],a[1]],[a[1],o[2],a[2]])}return{positions:u,cells:h}};var r=n(8966);function i(e,t,n){for(var r=0;r<3;++r)if(n[r]!==e&&n[r]!==t)return n[r];return 0}var a=[0,0,0],o=[0,0,0],s=[0,0]},9852:(e,t,n)=>{var r=n(579).rasterize,i=n(579).contour,a=n(3794).angleNormals,o=n(8670);function s(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],l=n[2];return e[0]=i*l-a*s,e[1]=a*o-r*l,e[2]=r*s-i*o,e}function l(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function c(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}var u=[0,0,0],h=[0,0,0],d=[0,0,0],f=[0,0,0],p=[0,0,0];function m(e,t,n,r,i){c(u,r,n),c(h,i,n),s(f,t,h);var a=l(u,f);if(Math.abs(a)<1e-4)return 1/0;c(d,e,n);var o=l(d,f);if(o<0||o>a)return 1/0;s(p,d,u);var m=l(t,p);return m<0||o+m>a?1/0:l(h,p)/a}e.exports=function(e,t,n){var s,l=n||{},c=2*(s="tolerance"in l?l.tolerance:function(e,t){for(var n=0,r=0;r<e.length;++r)for(var i=e[r],a=0;a<3;++a){var o=t[i[a]],s=t[i[(a+1)%3]];n+=Math.sqrt(Math.pow(o[0]-s[0],2)+Math.pow(o[1]-s[1],2)+Math.pow(o[2]-s[2],2))}return 2*n/(3*e.length)}(e,t)),u=i(r(e,t,{resolution:.5*s})),h=function(e,t,n){for(var r={},i=0;i<e.length;++i)for(var a=e[i],o=t[a[0]],s=t[a[1]],l=t[a[2]],c=Math.floor(Math.min(o[0],s[0],l[0])/n)-1,u=Math.floor(Math.min(o[1],s[1],l[1])/n)-1,h=Math.floor(Math.min(o[2],s[2],l[2])/n)-1,d=Math.ceil(Math.max(o[0],s[0],l[0])/n)+1,f=Math.ceil(Math.max(o[1],s[1],l[1])/n)+1,p=Math.ceil(Math.max(o[2],s[2],l[2])/n)+1,m=c;m<=d;++m)for(var g=u;g<=f;++g)for(var v=h;v<=p;++v){var y=m+","+g+","+v,_=r[y];_?_.push(a):r[y]=[a]}return r}(e,t,c);return u.normals=a(u.cells,u.positions),function(e,t,n,r,i){for(var a=0;a<n.length;++a){var o=n[a],s=o[0],l=o[1],c=o[1],u=e[Math.floor(s/i)+","+Math.floor(l/i)+","+Math.floor(c/i)];if(u){for(var h=r[a],d=1/0,f=0;f<u.length;++f){var p=u[f],g=m(o,h,t[p[0]],t[p[1]],t[p[2]]);Math.abs(g)<Math.abs(d)&&(d=g)}Math.abs(d)}}}(h,t,(u=o(u.cells,u.positions,u.normals,{edgeLength:.5*s})).positions,u.normals,c),u}},3190:(e,t,n)=>{var r=n(3930),i=n(8966);function a(e,t,n,r,i,a){for(var o=new Array(3),s=new Array(3),l=0,c=0;c<3;++c)o[c]=t[c]-e[c],l+=o[c]*o[c],s[c]=n[c]-e[c];if(l<1e-6)return 1e30;var u=Math.sqrt(l),h=1/u,d=0;for(c=0;c<3;++c)o[c]*=h,d+=o[c]*s[c];var f=0;for(c=0;c<3;++c)f+=Math.pow(s[c]-d*o[c],2);f=Math.sqrt(f);var p=r*r,m=(p-i*i+l)/(2*u),g=p-m*m;return g<0?1e30:(g=Math.sqrt(g),a<0&&(g*=-1),Math.sqrt(Math.pow(d-m,2)+Math.pow(f-g,2)))}function o(e,t){this.d=e,this.v=t}function s(e,t){return e.d-t.d}t.j=function(e,t,n,l,c,u){void 0===l&&(l=Number.POSITIVE_INFINITY),void 0===c&&(c=1e-4),"undefined"==typeof dual&&(u=i.dual(e,t.length));var h=function(e,t,n,i,a){var l=new r(s),c={};l.push(new o(0,e));for(var u=i[e],h=a*a;l.size()>0;){var d=l.pop();if(!(d.v in c)){var f=d.d,p=d.v;c[p]=f;for(var m=i[p],g=t[p],v=0;v<g.length;++v)for(var y=n[g[v]],_=0;_<y.length;++_){var b=y[_];if(b!==p&&!(b in c)){for(var E=i[b],w=0,x=0,T=0;T<3;++T)w+=Math.pow(m[T]-E[T],2),x+=Math.pow(u[T]-E[T],2);x<=h&&l.push(new o(Math.sqrt(w)+f,b))}}}}return c}(n,u,e,t,l);return function(e,t,n,r,i,o,s){function l(e,n){return t[e]-t[n]}for(var c=!1;!c;){c=!0;var u=[];for(var h in t)u.push(h);u.sort(l);for(var d=0;d<u.length&&(h=u[d],!(t[h]>o));++d)for(var f=r[h],p=0;p<f.length;++p){var m=i[f[p]].slice(0);if(m.sort(l),!(Math.abs(t[m[1]]-t[m[2]])<1e-6)){var g=a(n[m[0]],n[m[1]],n[m[2]],t[m[0]],t[m[1]],-1);if(!(g>o)){var v=t[m[2]];g<v&&Math.abs(g-v)>s&&(t[m[2]]=Math.min(v,g),c=!1)}}}}}(0,h,t,u,e,l,c),h}},4078:(e,t,n)=>{"use strict";var r=n(4964);function i(e,t){return e[0]-t[0]||e[1]-t[1]}e.exports=function(e,t){for(var n=t.length,a=e.length,o=r.mallocDouble(n),s=0;s<n;++s)o[s]=0;var l=[];for(s=0;s<a;++s){var c=e[s],u=c[0],h=c[1],d=c[2],f=t[u],p=t[h],m=t[d],g=f[0]-p[0],v=f[1]-p[1],y=f[2]-p[2],_=p[0]-m[0],b=p[1]-m[1],E=p[2]-m[2],w=m[0]-f[0],x=m[1]-f[1],T=m[2]-f[2],A=.5*(L=v*T-y*x,C=y*w-g*T,I=g*x-v*w,Math.sqrt(Math.pow(L,2)+Math.pow(C,2)+Math.pow(I,2)));if(!(A<1e-8)){var M=-.5/A,S=M*(g*w+v*x+y*T),R=M*(_*g+b*v+E*y),k=M*(w*_+x*b+T*E),P=A/3;o[u]+=P,o[h]+=P,o[d]+=P,l.push([h,d,S],[d,h,S],[d,u,R],[u,d,R],[u,h,k],[h,u,k])}}var L,C,I;var N=r.mallocDouble(n);for(s=0;s<n;++s)N[s]=0;l.sort(i);var F=0;for(s=0;s<l.length;){for(var O=l[s++];s<l.length&&l[s][0]===O[0]&&l[s][1]===O[1];)O[2]+=l[s++][2];O[2]/=o[O[0]],N[O[0]]+=O[2],l[F++]=O}l.length=F;for(s=0;s<n;++s)l.push([s,s,-N[s]]);return r.free(o),r.free(N),l}},8570:(e,t,n)=>{"use strict";e.exports=function(e,t){var n,a=i.fromList(r(e,t)),o=t.length,s=new Array(o),l=new Array(o),c=new Array(o),u=new Array(o);for(n=0;n<o;++n){var h=t[n];s[n]=h[0],l[n]=h[1],c[n]=h[2],u[n]=0}for(a.apply(s,u),n=0;n<o;++n)u[n]=Math.pow(u[n],2),s[n]=0;for(a.apply(l,s),n=0;n<o;++n)u[n]+=Math.pow(s[n],2),s[n]=0;for(a.apply(c,s),n=0;n<o;++n)u[n]+=Math.pow(s[n],2),s[n]=0;for(n=0;n<o;++n)u[n]=Math.sqrt(u[n]);return u};var r=n(4078),i=n(202)},4948:(e,t)=>{"use strict";t.compareCoord=new Function("ra","rb",["for(var i=2;i>=0;--i) {","var d=ra[i]-rb[i];","if(d){return d;}","}","return 0;"].join("\n")),t.saturateAbs=new Function("x",["if(x >= 0.0) {","if(x <= 1.0) {","return x;","}","} else if(x >= -1.0) {","return -x;","}","return 1.0;"].join("\n")),t.EPSILON=1e-6,t.POSITIVE_INFINITY=1<<30,t.NEGATIVE_INFINITY=-(1<<30)},639:(e,t,n)=>{"use strict";e.exports=function(e){var t=e.length;if(t<3){for(var n=new Array(t),i=0;i<t;++i)n[i]=i;return 2===t&&e[0][0]===e[1][0]&&e[0][1]===e[1][1]?[0]:n}var a=new Array(t);for(i=0;i<t;++i)a[i]=i;a.sort((function(t,n){var r=e[t][0]-e[n][0];return r||e[t][1]-e[n][1]}));var o=[a[0],a[1]],s=[a[0],a[1]];for(i=2;i<t;++i){for(var l=a[i],c=e[l],u=o.length;u>1&&r(e[o[u-2]],e[o[u-1]],c)<=0;)u-=1,o.pop();for(o.push(l),u=s.length;u>1&&r(e[s[u-2]],e[s[u-1]],c)>=0;)u-=1,s.pop();s.push(l)}n=new Array(s.length+o.length-2);for(var h=0,d=(i=0,o.length);i<d;++i)n[h++]=o[i];for(var f=s.length-2;f>0;--f)n[h++]=s[f];return n};var r=n(6651)[3]},5251:(e,t,n)=>{"use strict";var r=n(4948),i=r.POSITIVE_INFINITY,a=r.NEGATIVE_INFINITY,o=n(2552).StencilIterator,s=new Array(128);function l(e,t,n,r,i,a){this.volumes=e,this.stencil=t,this.ptrs=n,this.coord=r,this.stencil_len=i,this.frontier=a}!function(){for(var e=0;e<128;++e)s[e]=0}(),l.prototype.clone=function(){return new l(this.volumes,this.stencil,new Int32Array(this.ptrs),new Int32Array(this.coord),this.stencil_len)},l.prototype.hasNext=function(){return this.coord[0]<i},l.prototype.next=function(){for(var e=this.volumes,t=this.stencil,n=this.ptrs,r=this.coord,a=this.stencil_len,o=this.frontier,l=0,c=0,u=0;u<3;++u)r[u]=i;for(var h=0;h<e.length;++h){var d=e[h],f=d.coords,p=d.length();u=0;e:for(var m=0;u<a;++u,m+=3,c++){var g=n[c];if(!(g>=p-1)){g+=1;for(var v=2;v>=0;--v){var y=f[v][g]-t[m+v],_=r[v];if(y<_){for(r[v--]=y;v>=0;--v)r[v]=f[v][g]-t[m+v];l=0;break}if(y>_)continue e}s[l++]=c}}}for(u=0;u<o.length;++u)o[u]=0;for(u=0;u<l;++u){++n[c=s[u]],o[c]=1}},l.prototype.seek=function(e){for(var t=this.volumes,n=this.ptrs,r=this.stencil,i=new Int32Array(3),a=0,o=0;o<3;++o)this.coord[o]=e[o];for(var s=0;s<t.length;++s)for(var l=t[s],c=l.coords,u=l.length(),h=(o=0,0);o<stencil_len;++o,h+=3){for(var d=0;d<3;++d)i[d]=e[d]+r[h+d];n[a]=l.bisect(i,0,u-1),this[a]=c[0][n[a]]===i[0]&&c[1][n[a]]===i[1]&&c[2][n[a]]===i[2],++a}},l.prototype.getValues=function(e,t){for(var n=this.ptrs,r=this.frontier,i=0,a=0;a<this.volumes.length;++a)for(var o=this.volumes[a],s=o.phases,l=o.distances,c=0;c<this.stencil_len;++c){var u=n[i];e[i]=s[u],t[i]=r[i]?l[u]:1,++i}},l.prototype.subiterator=function(e){var t=this.stencil_len;return new o(this.volumes[e],this.stencil,new Int32Array(this.ptrs.subarray(3*t*e,3*t*(e+1))),new Int32Array(this.coord))},t.MultiIterator=l,t.beginMulti=function(e,t){var n=t.length/3|0;return s.length<n&&(s.length=n),new l(e,t,new Int32Array(e.length*n),new Int32Array([a,a,a]),n,new Uint8Array(e.length*n))}},3071:(e,t,n)=>{"use strict";var r=n(1641),i=n(2917),a=n(4964),o=n(19);function s(e,t,n,r,i,a,s){e|=0,t|=0,n|=0,i|=0,a|=0,o.isPow2(n)?c(e,t,n,r,i,a):function(e,t,n,r,i,a,s){e|=0,t|=0,n|=0,i|=0,a|=0,s|=0;var l,u,h,d,f,p,m,g,v,y=o.nextPow2(2*n+1),_=s,b=_+n,E=b+n,w=E+y,x=w+y,T=x+y,A=-e*Math.PI/n;for(v=0;v<n;++v)u=A*(v*v%(2*n)),d=Math.cos(u),f=Math.sin(u),r[x+(y-v)]=r[x+v]=r[_+v]=d,r[T+(y-v)]=r[T+v]=r[b+v]=f;for(v=n;v<=y-n;++v)r[x+v]=0;for(v=n;v<=y-n;++v)r[T+v]=0;c(1,1,y,r,x,T),A=e<0?1/n:1;for(l=0;l<t;++l){for(v=0;v<n;++v)u=r[i+v],h=r[a+v],p=(d=r[_+v])*(u+h),m=u*((f=-r[b+v])-d),g=h*(d+f),r[E+v]=p-g,r[w+v]=p+m;for(v=n;v<y;++v)r[E+v]=0;for(v=n;v<y;++v)r[w+v]=0;for(c(1,1,y,r,E,w),v=0;v<y;++v)u=r[E+v],h=r[w+v],p=(d=r[x+v])*(u+h),m=u*((f=r[T+v])-d),g=h*(d+f),r[E+v]=p-g,r[w+v]=p+m;for(c(-1,1,y,r,E,w),v=0;v<n;++v)u=r[E+v],h=r[w+v],p=(d=r[_+v])*(u+h),m=u*((f=-r[b+v])-d),g=h*(d+f),r[i+v]=A*(p-g),r[a+v]=A*(p+m);i+=n,a+=n}}(e,t,n,r,i,a,s)}function l(e){return o.isPow2(e)?0:2*e+4*o.nextPow2(2*e+1)}function c(e,t,n,r,i,a){var s,l,c,u,h,d,f,p,m,g,v,y,_,b,E,w,x,T,A,M,S,R,k,P;for(e|=0,t|=0,i|=0,a|=0,s=n|=0,l=o.log2(s),T=0;T<t;++T){for(f=s>>1,h=0,c=0;c<s-1;c++){for(c<h&&(_=r[i+c],r[i+c]=r[i+h],r[i+h]=_,_=r[a+c],r[a+c]=r[a+h],r[a+h]=_),d=f;d<=h;)h-=d,d>>=1;h+=d}for(v=-1,y=0,g=1,p=0;p<l;p++){for(m=g,g<<=1,w=1,x=0,h=0;h<m;h++){for(c=h;c<s;c+=g)A=r[i+(u=c+m)],M=r[a+u],S=r[i+c],R=r[a+c],b=(k=w*(A+M))-M*(w+x),E=k+(P=A*(x-w)),r[i+u]=S-b,r[a+u]=R-E,r[i+c]+=b,r[a+c]+=E;P=w*(y-v),w=(k=v*(w+x))-x*(v+y),x=k+P}y=Math.sqrt((1-v)/2),e<0&&(y=-y),v=Math.sqrt((1+v)/2)}if(e<0){var L=1/s;for(c=0;c<s;c++)r[i+c]*=L,r[a+c]*=L}i+=n,a+=n}}e.exports=function(e,t,n){var o,c,u=t.shape,h=u.length,d=1,f=new Array(h),p=0;for(o=h-1;o>=0;--o)if(f[o]=d,d*=u[o],p=Math.max(p,l(u[o])),t.shape[o]!==n.shape[o])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var m,g=4*d+p;m="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?a.mallocDouble(g):a.mallocFloat(g);var v,y,_,b,E=i(m,u.slice(0),f,0),w=i(m,u.slice(0),f.slice(0),d),x=i(m,u.slice(0),f.slice(0),2*d),T=i(m,u.slice(0),f.slice(0),3*d),A=4*d;for(r.assign(E,t),r.assign(w,n),o=h-1;o>=0&&(s(e,d/u[o],u[o],m,E.offset,w.offset,A),0!==o);--o){for(y=1,_=x.stride,b=T.stride,c=o-1;c<h;++c)b[c]=_[c]=y,y*=u[c];for(c=o-2;c>=0;--c)b[c]=_[c]=y,y*=u[c];r.assign(x,E),r.assign(T,w),v=E,E=x,x=v,v=w,w=T,T=v}r.assign(t,E),r.assign(n,w),a.free(m)}},6667:(e,t,n)=>{"use strict";e.exports=function(e,t,n){var c=new Array(e.dimension),u=1;Array.isArray(n)||(n=l(e.dimension,!!n));Array.isArray(t)||(t=l(e.dimension,t));for(var h=0;h<e.dimension;++h)n[h]?c[h]=e.shape[h]:c[h]=i(e.shape[h]+2*Math.ceil(3*t[h])),u*=c[h];var d=r(s.mallocFloat(u),c),f=d.hi.apply(d,e.shape.slice()),p=r(s.mallocFloat(u),c);return a.assigns(d,0),a.assign(f,e),a.assigns(p,0),o(1,d,p),function(e,t,n){for(var r=n.length,i=new Array(r),a=new Array(r),o=0;o<r;o++)i[o]=e.shape[o],a[o]=0;var s=new Array(r);for(o=0;o<r;++o)n[o]<1e-6?s[o]=0:s[o]=-2*Math.pow(Math.PI*n[o]/i[o],2);if(1===r)for(a[0]=0;a[0]<i[0];++a[0]){var l=0;for(o=0;o<r;++o){var c=.5*i[o]-Math.abs(.5*i[o]-a[o]);l+=s[o]*c*c}l=Math.exp(l),e.set(a[0],e.get(a[0])*l),t.set(a[0],t.get(a[0])*l)}else if(2===r)for(a[1]=0;a[1]<i[1];++a[1])for(a[0]=0;a[0]<i[0];++a[0]){for(l=0,o=0;o<r;++o){c=.5*i[o]-Math.abs(.5*i[o]-a[o]);l+=s[o]*c*c}l=Math.exp(l),e.set(a[0],a[1],e.get(a[0],a[1])*l),t.set(a[0],a[1],t.get(a[0],a[1])*l)}else if(3===r)for(a[2]=0;a[2]<i[2];++a[2])for(a[1]=0;a[1]<i[1];++a[1])for(a[0]=0;a[0]<i[0];++a[0]){for(l=0,o=0;o<r;++o){c=.5*i[o]-Math.abs(.5*i[o]-a[o]);l+=s[o]*c*c}l=Math.exp(l),e.set(a[0],a[1],a[2],e.get(a[0],a[1],a[2])*l),t.set(a[0],a[1],a[2],t.get(a[0],a[1],a[2])*l)}else console.warn("gaussBlur: higher dimension (> 3) not supported")}(d,p,t),o(-1,d,p),a.assign(e,f),s.freeFloat(d),s.freeFloat(p),e};var r=n(2917),i=n(8249),a=n(1641),o=n(3071),s=n(4964),l=n(6951)},1641:(e,t,n)=>{"use strict";var r=n(9245),i={body:"",args:[],thisVars:[],localVars:[]};function a(e){if(!e)return i;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function o(e){for(var t=[],n=0;n<e.args.length;++n)t.push("a"+n);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return r({args:e.args,pre:a(e.pre),body:a(e.body),post:a(e.proc),funcName:e.funcName})}(e))}var s={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in s){var n=s[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:e+"seq"})}}();var l={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in l){var n=l[e];t[e]=o({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:e}),t[e+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var c={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in c){var n=c[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<u.length;++e){var n=u[e];t[n]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),t[n+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var e=0;e<h.length;++e){var n=h[e];t[n]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),t[n+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),t[n+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),t[n+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var d=["atan2","pow"];!function(){for(var e=0;e<d.length;++e){var n=d[e];t[n+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),t[n+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),t[n+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),t[n+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),t.any=r({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=r({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=r({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=r({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=r({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=r({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=r({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},3397:(e,t,n)=>{"use strict";var r=n(4964),i=32;function a(e){switch(e){case"uint8":return[r.mallocUint8,r.freeUint8];case"uint16":return[r.mallocUint16,r.freeUint16];case"uint32":return[r.mallocUint32,r.freeUint32];case"int8":return[r.mallocInt8,r.freeInt8];case"int16":return[r.mallocInt16,r.freeInt16];case"int32":return[r.mallocInt32,r.freeInt32];case"float32":return[r.mallocFloat,r.freeFloat];case"float64":return[r.mallocDouble,r.freeDouble];default:return null}}function o(e){for(var t=[],n=0;n<e;++n)t.push("s"+n);for(n=0;n<e;++n)t.push("n"+n);for(n=1;n<e;++n)t.push("d"+n);for(n=1;n<e;++n)t.push("e"+n);for(n=1;n<e;++n)t.push("f"+n);return t}function s(e,t){var n=["'use strict'"],r=["ndarraySortWrapper",e.join("d"),t].join("");n.push(["function ",r,"(",["array"].join(","),"){"].join(""));for(var s=["data=array.data,offset=array.offset|0,shape=array.shape,stride=array.stride"],l=0;l<e.length;++l)s.push(["s",l,"=stride[",l,"]|0,n",l,"=shape[",l,"]|0"].join(""));var c=new Array(e.length),u=[];for(l=0;l<e.length;++l){0!==(f=e[l])&&(0===u.length?c[f]="1":c[f]=u.join("*"),u.push("n"+f))}var h=-1,d=-1;for(l=0;l<e.length;++l){var f,p=e[l];0!==p&&(h>0?s.push(["d",p,"=s",p,"-d",h,"*n",h].join("")):s.push(["d",p,"=s",p].join("")),h=p),0!==(f=e.length-1-l)&&(d>0?s.push(["e",f,"=s",f,"-e",d,"*n",d,",f",f,"=",c[f],"-f",d,"*n",d].join("")):s.push(["e",f,"=s",f,",f",f,"=",c[f]].join("")),d=f)}n.push("var "+s.join(","));var m=["0","n0-1","data","offset"].concat(o(e.length));n.push(["if(n0<=",i,"){","insertionSort(",m.join(","),")}else{","quickSort(",m.join(","),")}"].join("")),n.push("}return "+r);var g=new Function("insertionSort","quickSort",n.join("\n")),v=function(e,t){var n=["'use strict'"],r=["ndarrayInsertionSort",e.join("d"),t].join(""),i=["left","right","data","offset"].concat(o(e.length)),s=a(t),l=["i,j,cptr,ptr=left*s0+offset"];if(e.length>1){for(var c=[],u=1;u<e.length;++u)l.push("i"+u),c.push("n"+u);s?l.push("scratch=malloc("+c.join("*")+")"):l.push("scratch=new Array("+c.join("*")+")"),l.push("dptr","sptr","a","b")}else l.push("scratch");function h(e){return"generic"===t?["data.get(",e,")"].join(""):["data[",e,"]"].join("")}function d(e,n){return"generic"===t?["data.set(",e,",",n,")"].join(""):["data[",e,"]=",n].join("")}if(n.push(["function ",r,"(",i.join(","),"){var ",l.join(",")].join(""),"for(i=left+1;i<=right;++i){","j=i;ptr+=s0","cptr=ptr"),e.length>1){for(n.push("dptr=0;sptr=ptr"),u=e.length-1;u>=0;--u)0!==(f=e[u])&&n.push(["for(i",f,"=0;i",f,"<n",f,";++i",f,"){"].join(""));for(n.push("scratch[dptr++]=",h("sptr")),u=0;u<e.length;++u)0!==(f=e[u])&&n.push("sptr+=d"+f,"}");for(n.push("__g:while(j--\x3eleft){","dptr=0","sptr=cptr-s0"),u=1;u<e.length;++u)1===u&&n.push("__l:"),n.push(["for(i",u,"=0;i",u,"<n",u,";++i",u,"){"].join(""));for(n.push(["a=",h("sptr"),"\nb=scratch[dptr]\nif(a<b){break __g}\nif(a>b){break __l}"].join("")),u=e.length-1;u>=1;--u)n.push("sptr+=e"+u,"dptr+=f"+u,"}");for(n.push("dptr=cptr;sptr=cptr-s0"),u=e.length-1;u>=0;--u)0!==(f=e[u])&&n.push(["for(i",f,"=0;i",f,"<n",f,";++i",f,"){"].join(""));for(n.push(d("dptr",h("sptr"))),u=0;u<e.length;++u)0!==(f=e[u])&&n.push(["dptr+=d",f,";sptr+=d",f].join(""),"}");for(n.push("cptr-=s0\n}"),n.push("dptr=cptr;sptr=0"),u=e.length-1;u>=0;--u)0!==(f=e[u])&&n.push(["for(i",f,"=0;i",f,"<n",f,";++i",f,"){"].join(""));for(n.push(d("dptr","scratch[sptr++]")),u=0;u<e.length;++u){var f;0!==(f=e[u])&&n.push("dptr+=d"+f,"}")}}else n.push("scratch="+h("ptr"),"while((j--\x3eleft)&&("+h("cptr-s0")+">scratch)){",d("cptr",h("cptr-s0")),"cptr-=s0","}",d("cptr","scratch"));return n.push("}"),e.length>1&&s&&n.push("free(scratch)"),n.push("} return "+r),s?new Function("malloc","free",n.join("\n"))(s[0],s[1]):new Function(n.join("\n"))()}(e,t),y=function(e,t,n){var r=["'use strict'"],s=["ndarrayQuickSort",e.join("d"),t].join(""),l=["left","right","data","offset"].concat(o(e.length)),c=a(t),u=0;r.push(["function ",s,"(",l.join(","),"){"].join(""));var h=["sixth=((right-left+1)/6)|0","index1=left+sixth","index5=right-sixth","index3=(left+right)>>1","index2=index3-sixth","index4=index3+sixth","el1=index1","el2=index2","el3=index3","el4=index4","el5=index5","less=left+1","great=right-1","pivots_are_equal=true","tmp","tmp0","x","y","z","k","ptr0","ptr1","ptr2","comp_pivot1=0","comp_pivot2=0","comp=0"];if(e.length>1){for(var d=[],f=1;f<e.length;++f)d.push("n"+f),h.push("i"+f);for(f=0;f<8;++f)h.push("b_ptr"+f);h.push("ptr3","ptr4","ptr5","ptr6","ptr7","pivot_ptr","ptr_shift","elementSize="+d.join("*")),c?h.push("pivot1=malloc(elementSize)","pivot2=malloc(elementSize)"):h.push("pivot1=new Array(elementSize),pivot2=new Array(elementSize)")}else h.push("pivot1","pivot2");function p(e){return["(offset+",e,"*s0)"].join("")}function m(e){return"generic"===t?["data.get(",e,")"].join(""):["data[",e,"]"].join("")}function g(e,n){return"generic"===t?["data.set(",e,",",n,")"].join(""):["data[",e,"]=",n].join("")}function v(t,n,i){if(1===t.length)r.push("ptr0="+p(t[0]));else for(var a=0;a<t.length;++a)r.push(["b_ptr",a,"=s0*",t[a]].join(""));for(n&&r.push("pivot_ptr=0"),r.push("ptr_shift=offset"),a=e.length-1;a>=0;--a)0!==(o=e[a])&&r.push(["for(i",o,"=0;i",o,"<n",o,";++i",o,"){"].join(""));if(t.length>1)for(a=0;a<t.length;++a)r.push(["ptr",a,"=b_ptr",a,"+ptr_shift"].join(""));for(r.push(i),n&&r.push("++pivot_ptr"),a=0;a<e.length;++a){var o;0!==(o=e[a])&&(t.length>1?r.push("ptr_shift+=d"+o):r.push("ptr0+=d"+o),r.push("}"))}}function y(t,n,i,a){if(1===n.length)r.push("ptr0="+p(n[0]));else{for(var o=0;o<n.length;++o)r.push(["b_ptr",o,"=s0*",n[o]].join(""));r.push("ptr_shift=offset")}for(i&&r.push("pivot_ptr=0"),t&&r.push(t+":"),o=1;o<e.length;++o)r.push(["for(i",o,"=0;i",o,"<n",o,";++i",o,"){"].join(""));if(n.length>1)for(o=0;o<n.length;++o)r.push(["ptr",o,"=b_ptr",o,"+ptr_shift"].join(""));for(r.push(a),o=e.length-1;o>=1;--o)i&&r.push("pivot_ptr+=f"+o),n.length>1?r.push("ptr_shift+=e"+o):r.push("ptr0+=e"+o),r.push("}")}function _(){e.length>1&&c&&r.push("free(pivot1)","free(pivot2)")}function b(t,n){var i="el"+t,a="el"+n;if(e.length>1){var o="__l"+ ++u;y(o,[i,a],!1,["comp=",m("ptr0"),"-",m("ptr1"),"\n","if(comp>0){tmp0=",i,";",i,"=",a,";",a,"=tmp0;break ",o,"}\n","if(comp<0){break ",o,"}"].join(""))}else r.push(["if(",m(p(i)),">",m(p(a)),"){tmp0=",i,";",i,"=",a,";",a,"=tmp0}"].join(""))}function E(t,n){e.length>1?v([t,n],!1,g("ptr0",m("ptr1"))):r.push(g(p(t),m(p(n))))}function w(t,n,i){if(e.length>1){var a="__l"+ ++u;y(a,[n],!0,[t,"=",m("ptr0"),"-pivot",i,"[pivot_ptr]\n","if(",t,"!==0){break ",a,"}"].join(""))}else r.push([t,"=",m(p(n)),"-pivot",i].join(""))}function x(t,n){e.length>1?v([t,n],!1,["tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1","tmp")].join("")):r.push(["ptr0=",p(t),"\n","ptr1=",p(n),"\n","tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1","tmp")].join(""))}function T(t,n,i){e.length>1?(v([t,n,i],!1,["tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1",m("ptr2")),"\n",g("ptr2","tmp")].join("")),r.push("++"+n,"--"+i)):r.push(["ptr0=",p(t),"\n","ptr1=",p(n),"\n","ptr2=",p(i),"\n","++",n,"\n","--",i,"\n","tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1",m("ptr2")),"\n",g("ptr2","tmp")].join(""))}function A(e,t){x(e,t),r.push("--"+t)}function M(t,n,i){e.length>1?v([t,n],!0,[g("ptr0",m("ptr1")),"\n",g("ptr1",["pivot",i,"[pivot_ptr]"].join(""))].join("")):r.push(g(p(t),m(p(n))),g(p(n),"pivot"+i))}function S(t,n){r.push(["if((",n,"-",t,")<=",i,"){\n","insertionSort(",t,",",n,",data,offset,",o(e.length).join(","),")\n","}else{\n",s,"(",t,",",n,",data,offset,",o(e.length).join(","),")\n","}"].join(""))}function R(t,n,i){e.length>1?(r.push(["__l",++u,":while(true){"].join("")),v([t],!0,["if(",m("ptr0"),"!==pivot",n,"[pivot_ptr]){break __l",u,"}"].join("")),r.push(i,"}")):r.push(["while(",m(p(t)),"===pivot",n,"){",i,"}"].join(""))}return r.push("var "+h.join(",")),b(1,2),b(4,5),b(1,3),b(2,3),b(1,4),b(3,4),b(2,5),b(2,3),b(4,5),e.length>1?v(["el1","el2","el3","el4","el5","index1","index3","index5"],!0,["pivot1[pivot_ptr]=",m("ptr1"),"\n","pivot2[pivot_ptr]=",m("ptr3"),"\n","pivots_are_equal=pivots_are_equal&&(pivot1[pivot_ptr]===pivot2[pivot_ptr])\n","x=",m("ptr0"),"\n","y=",m("ptr2"),"\n","z=",m("ptr4"),"\n",g("ptr5","x"),"\n",g("ptr6","y"),"\n",g("ptr7","z")].join("")):r.push(["pivot1=",m(p("el2")),"\n","pivot2=",m(p("el4")),"\n","pivots_are_equal=pivot1===pivot2\n","x=",m(p("el1")),"\n","y=",m(p("el3")),"\n","z=",m(p("el5")),"\n",g(p("index1"),"x"),"\n",g(p("index3"),"y"),"\n",g(p("index5"),"z")].join("")),E("index2","left"),E("index4","right"),r.push("if(pivots_are_equal){"),r.push("for(k=less;k<=great;++k){"),w("comp","k",1),r.push("if(comp===0){continue}"),r.push("if(comp<0){"),r.push("if(k!==less){"),x("k","less"),r.push("}"),r.push("++less"),r.push("}else{"),r.push("while(true){"),w("comp","great",1),r.push("if(comp>0){"),r.push("great--"),r.push("}else if(comp<0){"),T("k","less","great"),r.push("break"),r.push("}else{"),A("k","great"),r.push("break"),r.push("}"),r.push("}"),r.push("}"),r.push("}"),r.push("}else{"),r.push("for(k=less;k<=great;++k){"),w("comp_pivot1","k",1),r.push("if(comp_pivot1<0){"),r.push("if(k!==less){"),x("k","less"),r.push("}"),r.push("++less"),r.push("}else{"),w("comp_pivot2","k",2),r.push("if(comp_pivot2>0){"),r.push("while(true){"),w("comp","great",2),r.push("if(comp>0){"),r.push("if(--great<k){break}"),r.push("continue"),r.push("}else{"),w("comp","great",1),r.push("if(comp<0){"),T("k","less","great"),r.push("}else{"),A("k","great"),r.push("}"),r.push("break"),r.push("}"),r.push("}"),r.push("}"),r.push("}"),r.push("}"),r.push("}"),M("left","(less-1)",1),M("right","(great+1)",2),S("left","(less-2)"),S("(great+2)","right"),r.push("if(pivots_are_equal){"),_(),r.push("return"),r.push("}"),r.push("if(less<index1&&great>index5){"),R("less",1,"++less"),R("great",2,"--great"),r.push("for(k=less;k<=great;++k){"),w("comp_pivot1","k",1),r.push("if(comp_pivot1===0){"),r.push("if(k!==less){"),x("k","less"),r.push("}"),r.push("++less"),r.push("}else{"),w("comp_pivot2","k",2),r.push("if(comp_pivot2===0){"),r.push("while(true){"),w("comp","great",2),r.push("if(comp===0){"),r.push("if(--great<k){break}"),r.push("continue"),r.push("}else{"),w("comp","great",1),r.push("if(comp<0){"),T("k","less","great"),r.push("}else{"),A("k","great"),r.push("}"),r.push("break"),r.push("}"),r.push("}"),r.push("}"),r.push("}"),r.push("}"),r.push("}"),_(),S("less","great"),r.push("}return "+s),e.length>1&&c?new Function("insertionSort","malloc","free",r.join("\n"))(n,c[0],c[1]):new Function("insertionSort",r.join("\n"))(n)}(e,t,v);return g(v,y)}var l={};e.exports=function(e){var t=e.order,n=e.dtype,r=[t,n].join(":"),i=l[r];return i||(l[r]=i=s(t,n)),i(e),e}},2917:e=>{var t="undefined"!=typeof Float64Array;function n(e,t){return e[0]-t[0]}function r(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(n);var i=new Array(r.length);for(e=0;e<i.length;++e)i[e]=r[e][1];return i}function i(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var i="generic"===e;if(-1===t){var o="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(o)()}if(0===t){o="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",o)(a[e][0])}o=["'use strict'"];var s=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}(t),l=s.map((function(e){return"i"+e})),c="this.offset+"+s.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),u=s.map((function(e){return"b"+e})).join(","),h=s.map((function(e){return"c"+e})).join(",");o.push("function "+n+"(a,"+u+","+h+",d){this.data=a","this.shape=["+u+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),o.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+s.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),t<4?(o.push("function "+n+"_order(){"),2===t?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+n+"_set("+l.join(",")+",v){"),i?o.push("return this.data.set("+c+",v)}"):o.push("return this.data["+c+"]=v}"),o.push("proto.get=function "+n+"_get("+l.join(",")+"){"),i?o.push("return this.data.get("+c+")}"):o.push("return this.data["+c+"]}"),o.push("proto.index=function "+n+"_index(",l.join(),"){return "+c+"}"),o.push("proto.hi=function "+n+"_hi("+l.join(",")+"){return new "+n+"(this.data,"+s.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+s.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=s.map((function(e){return"a"+e+"=this.shape["+e+"]"})),f=s.map((function(e){return"c"+e+"=this.stride["+e+"]"}));o.push("proto.lo=function "+n+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+f.join(","));for(var p=0;p<t;++p)o.push("if(typeof i"+p+"==='number'&&i"+p+">=0){d=i"+p+"|0;b+=c"+p+"*d;a"+p+"-=d}");o.push("return new "+n+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"c"+e})).join(",")+",b)}"),o.push("proto.step=function "+n+"_step("+l.join(",")+"){var "+s.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+s.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(p=0;p<t;++p)o.push("if(typeof i"+p+"==='number'){d=i"+p+"|0;if(d<0){c+=b"+p+"*(a"+p+"-1);a"+p+"=ceil(-a"+p+"/d)}else{a"+p+"=ceil(a"+p+"/d)}b"+p+"*=d}");o.push("return new "+n+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"b"+e})).join(",")+",c)}");var m=new Array(t),g=new Array(t);for(p=0;p<t;++p)m[p]="a[i"+p+"]",g[p]="b[i"+p+"]";o.push("proto.transpose=function "+n+"_transpose("+l+"){"+l.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+m.join(",")+","+g.join(",")+",this.offset)}"),o.push("proto.pick=function "+n+"_pick("+l+"){var a=[],b=[],c=this.offset");for(p=0;p<t;++p)o.push("if(typeof i"+p+"==='number'&&i"+p+">=0){c=(c+this.stride["+p+"]*i"+p+")|0}else{a.push(this.shape["+p+"]);b.push(this.stride["+p+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+s.map((function(e){return"shape["+e+"]"})).join(",")+","+s.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(a[e],r)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,n,r,o){if(void 0===e)return(0,a.array[0])([]);"number"==typeof e&&(e=[e]),void 0===n&&(n=[e.length]);var s=n.length;if(void 0===r){r=new Array(s);for(var l=s-1,c=1;l>=0;--l)r[l]=c,c*=n[l]}if(void 0===o){o=0;for(l=0;l<s;++l)r[l]<0&&(o-=(n[l]-1)*r[l])}for(var u=function(e){if(Buffer.isBuffer(e))return"buffer";if(t)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),h=a[u];h.length<=s+1;)h.push(i(u,h.length-1));return(0,h[s+1])(e,n,r,o)}},8249:e=>{e.exports=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}},3794:(e,t)=>{t.vertexNormals=function(e,t,n){for(var r=t.length,i=new Array(r),a=void 0===n?1e-6:n,o=0;o<r;++o)i[o]=[0,0,0];for(o=0;o<e.length;++o)for(var s=e[o],l=0,c=s[s.length-1],u=s[0],h=0;h<s.length;++h){l=c,c=u,u=s[(h+1)%s.length];for(var d=t[l],f=t[c],p=t[u],m=new Array(3),g=0,v=new Array(3),y=0,_=0;_<3;++_)m[_]=d[_]-f[_],g+=m[_]*m[_],v[_]=p[_]-f[_],y+=v[_]*v[_];if(g*y>a){var b=i[c],E=1/Math.sqrt(g*y);for(_=0;_<3;++_){var w=(_+1)%3,x=(_+2)%3;b[_]+=E*(v[w]*m[x]-v[x]*m[w])}}}for(o=0;o<r;++o){b=i[o];var T=0;for(_=0;_<3;++_)T+=b[_]*b[_];if(T>a)for(E=1/Math.sqrt(T),_=0;_<3;++_)b[_]*=E;else for(_=0;_<3;++_)b[_]=0}return i},t.faceNormals=function(e,t,n){for(var r=e.length,i=new Array(r),a=void 0===n?1e-6:n,o=0;o<r;++o){for(var s=e[o],l=new Array(3),c=0;c<3;++c)l[c]=t[s[c]];var u=new Array(3),h=new Array(3);for(c=0;c<3;++c)u[c]=l[1][c]-l[0][c],h[c]=l[2][c]-l[0][c];var d=new Array(3),f=0;for(c=0;c<3;++c){var p=(c+1)%3,m=(c+2)%3;d[c]=u[p]*h[m]-u[m]*h[p],f+=d[c]*d[c]}f=f>a?1/Math.sqrt(f):0;for(c=0;c<3;++c)d[c]*=f;i[o]=d}return i},t.angleNormals=function(e,t){function n(e,t,n){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2))}function r(e,t,n){return Math.atan2(t,e-n)}function i(e,t,n,r,i){e[0]+=t*n,e[1]+=t*r,e[2]+=t*i}for(var a=t.length,o=e.length,s=new Array(a),l=0;l<a;++l)s[l]=[0,0,0];for(l=0;l<o;++l){var c=e[l],u=t[c[0]],h=t[c[1]],d=t[c[2]],f=u[0]-h[0],p=u[1]-h[1],m=u[2]-h[2],g=n(f,p,m),v=h[0]-d[0],y=h[1]-d[1],_=h[2]-d[2],b=n(v,y,_),E=n(d[0]-u[0],d[1]-u[1],d[2]-u[2]);if(!(Math.min(g,b,E)<1e-6)){var w=.5*(g+b+E),x=Math.sqrt((w-g)*(w-b)*(w-E)/w),T=p*_-m*y,A=m*v-f*_,M=f*y-p*v,S=n(T,A,M);T/=S,A/=S,M/=S,i(s[c[0]],r(w,x,b),T,A,M),i(s[c[1]],r(w,x,E),T,A,M),i(s[c[2]],r(w,x,g),T,A,M)}}for(l=0;l<a;++l){var R=s[l],k=Math.sqrt(Math.pow(R[0],2)+Math.pow(R[1],2)+Math.pow(R[2],2));k<1e-8?(R[0]=1,R[1]=0,R[2]=0):(R[0]/=k,R[1]/=k,R[2]/=k)}return s}},6047:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var numeric=exports;void 0!==__webpack_require__.g&&(__webpack_require__.g.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var n,r,i;for(void 0===t&&(t=15),r=.5,n=new Date;;){for(i=r*=2;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;if(new Date-n>t)break}for(i=r;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;return 1e3*(3*r-1)/(new Date-n)},numeric._myIndexOf=function(e){var t,n=this.length;for(t=0;t<n;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),r=e/Math.pow(10,n),i=r.toPrecision(numeric.precision);return 10===parseFloat(i)&&(n++,i=(r=1).toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+n.toString()}return"Infinity"}var n=[];return function e(r){var i;if(void 0===r)return n.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof r)return n.push('"'+r+'"'),!1;if("boolean"==typeof r)return n.push(r.toString()),!1;if("number"==typeof r){var a=t(r),o=r.toPrecision(numeric.precision),s=parseFloat(r.toString()).toString(),l=[a,o,s,parseFloat(o).toString(),parseFloat(s).toString()];for(i=1;i<l.length;i++)l[i].length<a.length&&(a=l[i]);return n.push(Array(numeric.precision+8-a.length).join(" ")+a),!1}if(null===r)return n.push("null"),!1;if("function"==typeof r){n.push(r.toString());var c=!1;for(i in r)r.hasOwnProperty(i)&&(c?n.push(",\n"):n.push("\n{"),c=!0,n.push(i),n.push(": \n"),e(r[i]));return c&&n.push("}\n"),!0}if(r instanceof Array){if(r.length>numeric.largeArray)return n.push("...Large Array..."),!0;c=!1;for(n.push("["),i=0;i<r.length;i++)i>0&&(n.push(","),c&&n.push("\n ")),c=e(r[i]);return n.push("]"),!0}for(i in n.push("{"),c=!1,r)r.hasOwnProperty(i)&&(c&&n.push(",\n"),c=!0,n.push(i),n.push(": \n"),e(r[i]));return n.push("}"),!0}(e),n.join("")},numeric.parseDate=function(e){return function e(t){if("string"==typeof t)return Date.parse(t.replace(/-/g,"/"));if(!(t instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseFloat=function(e){return function e(t){if("string"==typeof t)return parseFloat(t);if(!(t instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseCSV=function(e){var t,n,r,i=e.split("\n"),a=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,s=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,l=0;for(n=0;n<i.length;n++){var c,u=(i[n]+",").match(o);if(u.length>0){for(a[l]=[],t=0;t<u.length;t++)c=(r=u[t]).substr(0,r.length-1),s.test(c)?a[l][t]=parseFloat(c):a[l][t]=c;l++}}return a},numeric.toCSV=function(e){var t,n,r,i,a,o=numeric.dim(e);for(r=o[0],o[1],a=[],t=0;t<r;t++){for(i=[],n=0;n<r;n++)i[n]=e[t][n].toString();a[t]=i.join(", ")}return a.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length);var r,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],a=-1;e.length;for(r=t;r<n;r++)a=a>>>8^i[255&(a^e[r])];return-1^a}var n,r,i,a,o,s,l,c,u,h,d=e[0].length,f=e[0][0].length,p=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,f>>24&255,f>>16&255,f>>8&255,255&f,d>>24&255,d>>16&255,d>>8&255,255&d,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(h=t(p,12,29),p[29]=h>>24&255,p[30]=h>>16&255,p[31]=h>>8&255,p[32]=255&h,n=1,r=0,l=0;l<d;l++){for(l<d-1?p.push(0):p.push(1),o=3*f+1+(0===l)&255,s=3*f+1+(0===l)>>8&255,p.push(o),p.push(s),p.push(255&~o),p.push(255&~s),0===l&&p.push(0),c=0;c<f;c++)for(i=0;i<3;i++)r=(r+(n=(n+(o=(o=e[i][l][c])>255?255:o<0?0:Math.round(o)))%65521))%65521,p.push(o);p.push(0)}return u=(r<<16)+n,p.push(u>>24&255),p.push(u>>16&255),p.push(u>>8&255),p.push(255&u),a=p.length-41,p[33]=a>>24&255,p[34]=a>>16&255,p[35]=a>>8&255,p[36]=255&a,h=t(p,37),p.push(h>>24&255),p.push(h>>16&255),p.push(h>>8&255),p.push(255&h),p.push(0),p.push(0),p.push(0),p.push(0),p.push(73),p.push(69),p.push(78),p.push(68),p.push(174),p.push(66),p.push(96),p.push(130),"data:image/png;base64,"+function(e){var t,n,r,i,a,o,s,l=e.length,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="";for(t=0;t<l;t+=3)a=((3&(n=e[t]))<<4)+((r=e[t+1])>>4),o=((15&r)<<2)+((i=e[t+2])>>6),s=63&i,t+1>=l?o=s=64:t+2>=l&&(s=64),u+=c.charAt(n>>2)+c.charAt(a)+c.charAt(o)+c.charAt(s);return u}(p)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t;return"object"==typeof e?"object"==typeof(t=e[0])?"object"==typeof t[0]?numeric._dim(e):[e.length,t.length]:[e.length]:[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,n){var r,i;if(!(t instanceof Array&&n instanceof Array))return!1;if((i=t.length)!==n.length)return!1;for(r=0;r<i;r++)if(t[r]!==n[r]){if("object"!=typeof t[r])return!1;if(!e(t[r],n[r]))return!1}return!0},numeric.rep=function(e,t,n){void 0===n&&(n=0);var r,i=e[n],a=Array(i);if(n===e.length-1){for(r=i-2;r>=0;r-=2)a[r+1]=t,a[r]=t;return-1===r&&(a[0]=t),a}for(r=i-1;r>=0;r--)a[r]=numeric.rep(e,t,n+1);return a},numeric.dotMMsmall=function(e,t){var n,r,i,a,o,s,l,c,u,h,d;for(a=e.length,o=t.length,s=t[0].length,l=Array(a),n=a-1;n>=0;n--){for(c=Array(s),u=e[n],i=s-1;i>=0;i--){for(h=u[o-1]*t[o-1][i],r=o-2;r>=1;r-=2)d=r-1,h+=u[r]*t[r][i]+u[d]*t[d][i];0===r&&(h+=u[0]*t[0][i]),c[i]=h}l[n]=c}return l},numeric._getCol=function(e,t,n){var r;for(r=e.length-1;r>0;--r)n[r]=e[r][t],n[--r]=e[r][t];0===r&&(n[0]=e[0][t])},numeric.dotMMbig=function(e,t){var n,r,i,a=numeric._getCol,o=t.length,s=Array(o),l=e.length,c=t[0].length,u=new Array(l),h=numeric.dotVV;for(--o,r=--l;-1!==r;--r)u[r]=Array(c);for(r=--c;-1!==r;--r)for(a(t,r,s),i=l;-1!==i;--i)0,n=e[i],u[i][r]=h(n,s);return u},numeric.dotMV=function(e,t){var n,r=e.length,i=(t.length,Array(r)),a=numeric.dotVV;for(n=r-1;n>=0;n--)i[n]=a(e[n],t);return i},numeric.dotVM=function(e,t){var n,r,i,a,o,s,l;for(i=e.length,a=t[0].length,o=Array(a),r=a-1;r>=0;r--){for(s=e[i-1]*t[i-1][r],n=i-2;n>=1;n-=2)l=n-1,s+=e[n]*t[n][r]+e[l]*t[l][r];0===n&&(s+=e[0]*t[0][r]),o[r]=s}return o},numeric.dotVV=function(e,t){var n,r,i=e.length,a=e[i-1]*t[i-1];for(n=i-2;n>=1;n-=2)r=n-1,a+=e[n]*t[n]+e[r]*t[r];return 0===n&&(a+=e[0]*t[0]),a},numeric.dot=function(e,t){var n=numeric.dim;switch(1e3*n(e).length+n(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,n,r,i,a=e.length,o=Array(a);for(t=a-1;t>=0;t--){for(i=Array(a),n=t+2,r=a-1;r>=n;r-=2)i[r]=0,i[r-1]=0;for(r>t&&(i[r]=0),i[t]=e[t],r=t-1;r>=1;r-=2)i[r]=0,i[r-1]=0;0===r&&(i[0]=0),o[t]=i}return o},numeric.getDiag=function(e){var t,n=Math.min(e.length,e[0].length),r=Array(n);for(t=n-1;t>=1;--t)r[t]=e[t][t],r[--t]=e[t][t];return 0===t&&(r[0]=e[0][0]),r},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,n){void 0===n&&(n="");var r,i,a=[],o=/\[i\]$/,s="",l=!1;for(r=0;r<e.length;r++)o.test(e[r])?s=i=e[r].substring(0,e[r].length-3):i=e[r],"ret"===i&&(l=!0),a.push(i);return a[e.length]="_s",a[e.length+1]="_k",a[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+s+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(l?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,a)},numeric.pointwise2=function(e,t,n){void 0===n&&(n="");var r,i,a=[],o=/\[i\]$/,s="",l=!1;for(r=0;r<e.length;r++)o.test(e[r])?s=i=e[r].substring(0,e[r].length-3):i=e[r],"ret"===i&&(l=!0),a.push(i);return a[e.length]="var _n = "+s+".length;\nvar i"+(l?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,a)},numeric._biforeach=function e(t,n,r,i,a){var o;if(i!==r.length-1)for(o=r[i]-1;o>=0;o--)e("object"==typeof t?t[o]:t,"object"==typeof n?n[o]:n,r,i+1,a);else a(t,n)},numeric._biforeach2=function e(t,n,r,i,a){if(i===r.length-1)return a(t,n);var o,s=r[i],l=Array(s);for(o=s-1;o>=0;--o)l[o]=e("object"==typeof t?t[o]:t,"object"==typeof n?n[o]:n,r,i+1,a);return l},numeric._foreach=function e(t,n,r,i){var a;if(r!==n.length-1)for(a=n[r]-1;a>=0;a--)e(t[a],n,r+1,i);else i(t)},numeric._foreach2=function e(t,n,r,i){if(r===n.length-1)return i(t);var a,o=n[r],s=Array(o);for(a=o-1;a>=0;a--)s[a]=e(t[a],n,r+1,i);return s},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var n,r,i="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(i="var "+t+" = Math."+t+";\n",n=function(e,n,r){return e+" = "+t+"("+n+","+r+")"},r=function(e,n){return e+" = "+t+"("+e+","+n+")"}):(n=function(e,n,r){return e+" = "+n+" "+t+" "+r},r=numeric.opseq.hasOwnProperty(e+"eq")?function(e,n){return e+" "+t+"= "+n}:function(e,n){return e+" = "+e+" "+t+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+r("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,n,r,i,a,o,s,l=numeric.dim(e),c=Math.abs,u=l[0],h=l[1],d=numeric.clone(e),f=numeric.identity(u);for(o=0;o<h;++o){var p=-1,m=-1;for(a=o;a!==u;++a)(s=c(d[a][o]))>m&&(p=a,m=s);for(n=d[p],d[p]=d[o],d[o]=n,i=f[p],f[p]=f[o],f[o]=i,e=n[o],s=o;s!==h;++s)n[s]/=e;for(s=h-1;-1!==s;--s)i[s]/=e;for(a=u-1;-1!==a;--a)if(a!==o){for(t=d[a],r=f[a],e=t[o],s=o+1;s!==h;++s)t[s]-=n[s]*e;for(s=h-1;s>0;--s)r[s]-=i[s]*e,r[--s]-=i[s]*e;0===s&&(r[0]-=i[0]*e)}}return f},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var n,r,i,a,o,s,l,c,u=t[0],h=1,d=numeric.clone(e);for(r=0;r<u-1;r++){for(i=r,n=r+1;n<u;n++)Math.abs(d[n][r])>Math.abs(d[i][r])&&(i=n);for(i!==r&&(l=d[i],d[i]=d[r],d[r]=l,h*=-1),a=d[r],n=r+1;n<u;n++){for(s=(o=d[n])[r]/a[r],i=r+1;i<u-1;i+=2)c=i+1,o[i]-=a[i]*s,o[c]-=a[c]*s;i!==u&&(o[i]-=a[i]*s)}if(0===a[r])return 0;h*=a[r]}return h*d[r][r]},numeric.transpose=function(e){var t,n,r,i,a,o=e.length,s=e[0].length,l=Array(s);for(n=0;n<s;n++)l[n]=Array(o);for(t=o-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=s-1;n>=1;--n)(a=l[n])[t]=i[n],a[t-1]=r[n],(a=l[--n])[t]=i[n],a[t-1]=r[n];0===n&&((a=l[0])[t]=i[0],a[t-1]=r[0])}if(0===t){for(r=e[0],n=s-1;n>=1;--n)l[n][0]=r[n],l[--n][0]=r[n];0===n&&(l[0][0]=r[0])}return l},numeric.negtranspose=function(e){var t,n,r,i,a,o=e.length,s=e[0].length,l=Array(s);for(n=0;n<s;n++)l[n]=Array(o);for(t=o-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=s-1;n>=1;--n)(a=l[n])[t]=-i[n],a[t-1]=-r[n],(a=l[--n])[t]=-i[n],a[t-1]=-r[n];0===n&&((a=l[0])[t]=-i[0],a[t-1]=-r[0])}if(0===t){for(r=e[0],n=s-1;n>=1;--n)l[n][0]=-r[n],l[--n][0]=-r[n];0===n&&(l[0][0]=-r[0])}return l},numeric._random=function e(t,n){var r,i,a=t[n],o=Array(a);if(n===t.length-1){for(i=Math.random,r=a-1;r>=1;r-=2)o[r]=i(),o[r-1]=i();return 0===r&&(o[0]=i()),o}for(r=a-1;r>=0;r--)o[r]=e(t,n+1);return o},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,n){if(void 0===n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var r,i=Array(n);for(r=--n;r>=0;r--)i[r]=(r*t+(n-r)*e)/n;return i},numeric.getBlock=function(e,t,n){var r=numeric.dim(e);return function e(i,a){var o,s=t[a],l=n[a]-s,c=Array(l);if(a===r.length-1){for(o=l;o>=0;o--)c[o]=i[o+s];return c}for(o=l;o>=0;o--)c[o]=e(i[o+s],a+1);return c}(e,0)},numeric.setBlock=function(e,t,n,r){var i=numeric.dim(e);return function e(r,a,o){var s,l=t[o],c=n[o]-l;if(o===i.length-1)for(s=c;s>=0;s--)r[s+l]=a[s];for(s=c;s>=0;s--)e(r[s+l],a[s],o+1)}(e,r,0),e},numeric.getRange=function(e,t,n){var r,i,a,o,s=t.length,l=n.length,c=Array(s);for(r=s-1;-1!==r;--r)for(c[r]=Array(l),a=c[r],o=e[t[r]],i=l-1;-1!==i;--i)a[i]=o[n[i]];return c},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var n,r,i,a,o,s=t[0],l=t[1];for(n=0,r=0,i=0;i<s;++i)n+=e[i][0].length;for(a=0;a<l;++a)r+=e[0][a][0].length;var c=Array(n);for(i=0;i<n;++i)c[i]=Array(r);var u,h,d,f,p,m=0;for(i=0;i<s;++i){for(u=r,a=l-1;-1!==a;--a)for(u-=(o=e[i][a])[0].length,d=o.length-1;-1!==d;--d)for(p=o[d],h=c[m+d],f=p.length-1;-1!==f;--f)h[u+f]=p[f];m+=e[i][0].length}return c},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var n=numeric.dim(e),r=numeric.dim(t);if(1!==n.length||1!==r.length)throw new Error("numeric: tensor product is only defined for vectors");var i,a,o,s,l=n[0],c=r[0],u=Array(l);for(a=l-1;a>=0;a--){for(i=Array(c),s=e[a],o=c-1;o>=3;--o)i[o]=s*t[o],i[--o]=s*t[o],i[--o]=s*t[o],i[--o]=s*t[o];for(;o>=0;)i[o]=s*t[o],--o;u[a]=i}return u},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,n,r,i){var a;numeric.indexOf;if("string"!=typeof i)for(a in i="",numeric)numeric.hasOwnProperty(a)&&(e.indexOf(a)>=0||t.indexOf(a)>=0||n.indexOf(a)>=0||r.indexOf(a)>=0)&&a.length>1&&(i+="var "+a+" = numeric."+a+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+r+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var n=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,n),t(numeric.neg(this.y),n))}return new T(t(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var t=numeric.div;return this.y?new numeric.T(t(this.x,e.x),t(this.y,e.x)):new numeric.T(t(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),e(n)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),numeric.negtranspose(n)):new numeric.T(e(t))},numeric.Tunop=function(e,t,n){return"string"!=typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if(void 0===e.y)return new numeric.T(numeric.inv(e.x));var t,n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v,y,_=e.x.length,b=numeric.identity(_),E=numeric.rep([_,_],0),w=numeric.clone(e.x),x=numeric.clone(e.y);for(c=0;c<_;c++){for(d=(p=w[c][c])*p+(m=x[c][c])*m,h=c,u=c+1;u<_;u++)(f=(p=w[u][c])*p+(m=x[u][c])*m)>d&&(h=u,d=f);for(h!==c&&(y=w[c],w[c]=w[h],w[h]=y,y=x[c],x[c]=x[h],x[h]=y,y=b[c],b[c]=b[h],b[h]=y,y=E[c],E[c]=E[h],E[h]=y),t=w[c],n=x[c],a=b[c],o=E[c],p=t[c],m=n[c],u=c+1;u<_;u++)g=t[u],v=n[u],t[u]=(g*p+v*m)/d,n[u]=(v*p-g*m)/d;for(u=0;u<_;u++)g=a[u],v=o[u],a[u]=(g*p+v*m)/d,o[u]=(v*p-g*m)/d;for(u=c+1;u<_;u++){for(r=w[u],i=x[u],s=b[u],l=E[u],p=r[c],m=i[c],h=c+1;h<_;h++)g=t[h],v=n[h],r[h]-=g*p-v*m,i[h]-=v*p+g*m;for(h=0;h<_;h++)g=a[h],v=o[h],s[h]-=g*p-v*m,l[h]-=v*p+g*m}}for(c=_-1;c>0;c--)for(a=b[c],o=E[c],u=c-1;u>=0;u--)for(s=b[u],l=E[u],p=w[u][c],m=x[u][c],h=_-1;h>=0;h--)g=a[h],v=o[h],s[h]-=p*g-m*v,l[h]-=p*v+m*g;return new numeric.T(b,E)},numeric.T.prototype.get=function(e){var t,n=this.x,r=this.y,i=0,a=e.length;if(r){for(;i<a;)n=n[t=e[i]],r=r[t],i++;return new numeric.T(n,r)}for(;i<a;)n=n[t=e[i]],i++;return new numeric.T(n)},numeric.T.prototype.set=function(e,t){var n,r=this.x,i=this.y,a=0,o=e.length,s=t.x,l=t.y;if(0===o)return l?this.y=l:i&&(this.y=void 0),this.x=r,this;if(l){for(i||(i=numeric.rep(numeric.dim(r),0),this.y=i);a<o-1;)r=r[n=e[a]],i=i[n],a++;return r[n=e[a]]=s,i[n]=l,this}if(i){for(;a<o-1;)r=r[n=e[a]],i=i[n],a++;return r[n=e[a]]=s,i[n]=s instanceof Array?numeric.rep(numeric.dim(s),0):0,this}for(;a<o-1;)r=r[n=e[a]],a++;return r[n=e[a]]=s,this},numeric.T.prototype.getRows=function(e,t){var n,r,i=t-e+1,a=Array(i),o=this.x,s=this.y;for(n=e;n<=t;n++)a[n-e]=o[n];if(s){for(r=Array(i),n=e;n<=t;n++)r[n-e]=s[n];return new numeric.T(a,r)}return new numeric.T(a)},numeric.T.prototype.setRows=function(e,t,n){var r,i=this.x,a=this.y,o=n.x,s=n.y;for(r=e;r<=t;r++)i[r]=o[r-e];if(s)for(a||(a=numeric.rep(numeric.dim(i),0),this.y=a),r=e;r<=t;r++)a[r]=s[r-e];else if(a)for(r=e;r<=t;r++)a[r]=numeric.rep([o[r-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,n=this.y;return n?new numeric.T(t[e],n[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var n=this.x,r=this.y,i=t.x,a=t.y;return n[e]=i,a?(r||(r=numeric.rep(numeric.dim(n),0),this.y=r),r[e]=a):r&&(r=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var n=this.x,r=this.y,i=numeric.getBlock;return r?new numeric.T(i(n,e,t),i(r,e,t)):new numeric.T(i(n,e,t))},numeric.T.prototype.setBlock=function(e,t,n){n instanceof numeric.T||(n=new numeric.T(n));var r=this.x,i=this.y,a=numeric.setBlock,o=n.x,s=n.y;if(s)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),a(r,e,t,o),a(i,e,t,s),this;a(r,e,t,o),i&&a(i,e,t,numeric.rep(numeric.dim(o),0))},numeric.T.rep=function(e,t){var n=numeric.T;t instanceof n||(t=new n(t));var r=t.x,i=t.y,a=numeric.rep;return i?new n(a(e,r),a(e,i)):new n(a(e,r))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,n=e.y,r=numeric.diag;return n?new numeric.T(r(t),r(n)):new numeric.T(r(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,n=this.y;return n?new e.T(e.getDiag(t),e.getDiag(n)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),n=(e[0]>=0?1:-1)*numeric.norm2(e);t[0]+=n;var r=numeric.norm2(t);if(0===r)throw new Error("eig: internal error");return numeric.div(t,r)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var n,r,i,a,o,s,l,c,u,h,d=t[0],f=numeric.clone(e),p=numeric.identity(d);for(r=0;r<d-2;r++){for(a=Array(d-r-1),n=r+1;n<d;n++)a[n-r-1]=f[n][r];if(numeric.norm2(a)>0){for(o=numeric.house(a),s=numeric.getBlock(f,[r+1,r],[d-1,d-1]),l=numeric.tensor(o,numeric.dot(o,s)),n=r+1;n<d;n++)for(c=f[n],u=l[n-r-1],i=r;i<d;i++)c[i]-=2*u[i-r];for(s=numeric.getBlock(f,[0,r+1],[d-1,d-1]),l=numeric.tensor(numeric.dot(s,o),o),n=0;n<d;n++)for(c=f[n],u=l[n],i=r+1;i<d;i++)c[i]-=2*u[i-r-1];for(s=Array(d-r-1),n=r+1;n<d;n++)s[n-r-1]=p[n];for(l=numeric.tensor(o,numeric.dot(o,s)),n=r+1;n<d;n++)for(h=p[n],u=l[n-r-1],i=0;i<d;i++)h[i]-=2*u[i]}}return{H:f,Q:p}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(e,t){void 0===t&&(t=1e4),e=numeric.clone(e);numeric.clone(e);var n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v,y,_,b=numeric.dim(e)[0],E=numeric.identity(b);if(b<3)return{Q:E,B:[[0,b-1]]};var w=numeric.epsilon;for(_=0;_<t;_++){for(v=0;v<b-1;v++)if(Math.abs(e[v+1][v])<w*(Math.abs(e[v][v])+Math.abs(e[v+1][v+1]))){var x=numeric.QRFrancis(numeric.getBlock(e,[0,0],[v,v]),t),T=numeric.QRFrancis(numeric.getBlock(e,[v+1,v+1],[b-1,b-1]),t);for(f=Array(v+1),g=0;g<=v;g++)f[g]=E[g];for(p=numeric.dot(x.Q,f),g=0;g<=v;g++)E[g]=p[g];for(f=Array(b-v-1),g=v+1;g<b;g++)f[g-v-1]=E[g];for(p=numeric.dot(T.Q,f),g=v+1;g<b;g++)E[g]=p[g-v-1];return{Q:E,B:x.B.concat(numeric.add(T.B,v+1))}}var A,M,S;if(i=e[b-2][b-2],a=e[b-2][b-1],o=e[b-1][b-2],c=i+(s=e[b-1][b-1]),l=i*s-a*o,u=numeric.getBlock(e,[0,0],[2,2]),c*c>=4*l)A=.5*(c+Math.sqrt(c*c-4*l)),M=.5*(c-Math.sqrt(c*c-4*l)),u=numeric.add(numeric.sub(numeric.dot(u,u),numeric.mul(u,A+M)),numeric.diag(numeric.rep([3],A*M)));else u=numeric.add(numeric.sub(numeric.dot(u,u),numeric.mul(u,c)),numeric.diag(numeric.rep([3],l)));for(n=[u[0][0],u[1][0],u[2][0]],r=numeric.house(n),f=[e[0],e[1],e[2]],p=numeric.tensor(r,numeric.dot(r,f)),g=0;g<3;g++)for(d=e[g],m=p[g],y=0;y<b;y++)d[y]-=2*m[y];for(f=numeric.getBlock(e,[0,0],[b-1,2]),p=numeric.tensor(numeric.dot(f,r),r),g=0;g<b;g++)for(d=e[g],m=p[g],y=0;y<3;y++)d[y]-=2*m[y];for(f=[E[0],E[1],E[2]],p=numeric.tensor(r,numeric.dot(r,f)),g=0;g<3;g++)for(h=E[g],m=p[g],y=0;y<b;y++)h[y]-=2*m[y];for(v=0;v<b-2;v++){for(y=v;y<=v+1;y++)if(Math.abs(e[y+1][y])<w*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){x=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),T=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[b-1,b-1]),t);for(f=Array(y+1),g=0;g<=y;g++)f[g]=E[g];for(p=numeric.dot(x.Q,f),g=0;g<=y;g++)E[g]=p[g];for(f=Array(b-y-1),g=y+1;g<b;g++)f[g-y-1]=E[g];for(p=numeric.dot(T.Q,f),g=y+1;g<b;g++)E[g]=p[g-y-1];return{Q:E,B:x.B.concat(numeric.add(T.B,y+1))}}for(S=Math.min(b-1,v+3),n=Array(S-v),g=v+1;g<=S;g++)n[g-v-1]=e[g][v];for(r=numeric.house(n),f=numeric.getBlock(e,[v+1,v],[S,b-1]),p=numeric.tensor(r,numeric.dot(r,f)),g=v+1;g<=S;g++)for(d=e[g],m=p[g-v-1],y=v;y<b;y++)d[y]-=2*m[y-v];for(f=numeric.getBlock(e,[0,v+1],[b-1,S]),p=numeric.tensor(numeric.dot(f,r),r),g=0;g<b;g++)for(d=e[g],m=p[g],y=v+1;y<=S;y++)d[y]-=2*m[y-v-1];for(f=Array(S-v),g=v+1;g<=S;g++)f[g-v-1]=E[g];for(p=numeric.tensor(r,numeric.dot(r,f)),g=v+1;g<=S;g++)for(h=E[g],m=p[g-v-1],y=0;y<b;y++)h[y]-=2*m[y]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v,y=numeric.toUpperHessenberg(e),_=numeric.QRFrancis(y.H,t),b=numeric.T,E=e.length,w=_.B,x=numeric.dot(_.Q,numeric.dot(y.H,numeric.transpose(_.Q))),T=new b(numeric.dot(_.Q,y.Q)),A=w.length,M=Math.sqrt;for(r=0;r<A;r++)if((n=w[r][0])===w[r][1]);else{if(a=n+1,o=x[n][n],s=x[n][a],l=x[a][n],c=x[a][a],0===s&&0===l)continue;(h=(u=-o-c)*u-4*(o*c-s*l))>=0?((g=(o-(d=u<0?-.5*(u-M(h)):-.5*(u+M(h))))*(o-d)+s*s)>(v=l*l+(c-d)*(c-d))?(p=(o-d)/(g=M(g)),m=s/g):(p=l/(v=M(v)),m=(c-d)/v),i=new b([[m,-p],[p,m]]),T.setRows(n,a,i.dot(T.getRows(n,a)))):(d=-.5*u,f=.5*M(-h),(g=(o-d)*(o-d)+s*s)>(v=l*l+(c-d)*(c-d))?(p=(o-d)/(g=M(g+f*f)),m=s/g,d=0,f/=g):(p=l/(v=M(v+f*f)),m=(c-d)/v,d=f/v,f=0),i=new b([[m,-p],[p,m]],[[d,f],[f,-d]]),T.setRows(n,a,i.dot(T.getRows(n,a))))}var S=T.dot(e).dot(T.transjugate()),R=(E=e.length,numeric.T.identity(E));for(a=0;a<E;a++)if(a>0)for(r=a-1;r>=0;r--){var k=S.get([r,r]),P=S.get([a,a]);numeric.neq(k.x,P.x)||numeric.neq(k.y,P.y)?(d=S.getRow(r).getBlock([r],[a-1]),f=R.getRow(a).getBlock([r],[a-1]),R.set([a,r],S.get([r,a]).neg().sub(d.dot(f)).div(k.sub(P)))):R.setRow(a,R.getRow(r))}for(a=0;a<E;a++)d=R.getRow(a),R.setRow(a,d.div(d.norm2()));return R=R.transpose(),R=T.transjugate().dot(R),{lambda:S.getDiag(),E:R}},numeric.ccsSparse=function(e){var t,n,r,i=e.length,a=[];for(n=i-1;-1!==n;--n)for(r in t=e[n]){for(r=parseInt(r);r>=a.length;)a[a.length]=0;0!==t[r]&&a[r]++}var o=a.length,s=Array(o+1);for(s[0]=0,n=0;n<o;++n)s[n+1]=s[n]+a[n];var l=Array(s[o]),c=Array(s[o]);for(n=i-1;-1!==n;--n)for(r in t=e[n])0!==t[r]&&(a[r]--,l[s[r]+a[r]]=n,c[s[r]+a[r]]=t[r]);return[s,l,c]},numeric.ccsFull=function(e){var t,n,r,i,a=e[0],o=e[1],s=e[2],l=numeric.ccsDim(e),c=l[0],u=l[1],h=numeric.rep([c,u],0);for(t=0;t<u;t++)for(r=a[t],i=a[t+1],n=r;n<i;++n)h[o[n]][t]=s[n];return h},numeric.ccsTSolve=function(e,t,n,r,i){var a,o,s,l,c,u,h,d=e[0],f=e[1],p=e[2],m=d.length-1,g=Math.max,v=0;function y(e){var t;if(0===n[e]){for(n[e]=1,t=d[e];t<d[e+1];++t)y(f[t]);i[v]=e,++v}}for(void 0===r&&(n=numeric.rep([m],0)),void 0===r&&(r=numeric.linspace(0,n.length-1)),void 0===i&&(i=[]),a=r.length-1;-1!==a;--a)y(r[a]);for(i.length=v,a=i.length-1;-1!==a;--a)n[i[a]]=0;for(a=r.length-1;-1!==a;--a)o=r[a],n[o]=t[o];for(a=i.length-1;-1!==a;--a){for(o=i[a],s=d[o],l=g(d[o+1],s),c=s;c!==l;++c)if(f[c]===o){n[o]/=p[c];break}for(h=n[o],c=s;c!==l;++c)(u=f[c])!==o&&(n[u]-=h*p[c])}return n},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,n,r,i,a){var o,s,l,c=0,u=i.length,h=this.k,d=this.k1,f=this.j;if(0===r[e])for(r[e]=1,f[0]=e,h[0]=s=t[e],d[0]=l=t[e+1];;)if(s>=l){if(i[u]=f[c],0===c)return;++u,s=h[--c],l=d[c]}else 0===r[o=a[n[s]]]?(r[o]=1,h[c]=s,f[++c]=o,s=t[o],d[c]=l=t[o+1]):++s},numeric.ccsLPSolve=function(e,t,n,r,i,a,o){var s,l,c,u,h,d,f,p,m,g=e[0],v=e[1],y=e[2],_=(g.length,t[0]),b=t[1],E=t[2];for(l=_[i],c=_[i+1],r.length=0,s=l;s<c;++s)o.dfs(a[b[s]],g,v,n,r,a);for(s=r.length-1;-1!==s;--s)n[r[s]]=0;for(s=l;s!==c;++s)n[u=a[b[s]]]=E[s];for(s=r.length-1;-1!==s;--s){for(h=g[u=r[s]],d=g[u+1],f=h;f<d;++f)if(a[v[f]]===u){n[u]/=y[f];break}for(m=n[u],f=h;f<d;++f)(p=a[v[f]])!==u&&(n[p]-=m*y[f])}return n},numeric.ccsLUP1=function(e,t){var n,r,i,a,o,s,l,c=e[0].length-1,u=[numeric.rep([c+1],0),[],[]],h=[numeric.rep([c+1],0),[],[]],d=u[0],f=u[1],p=u[2],m=h[0],g=h[1],v=h[2],y=numeric.rep([c],0),_=numeric.rep([c],0),b=numeric.ccsLPSolve,E=(Math.max,Math.abs),w=numeric.linspace(0,c-1),x=numeric.linspace(0,c-1),T=new numeric.ccsDFS(c);for(void 0===t&&(t=1),n=0;n<c;++n){for(b(u,e,y,_,n,x,T),a=-1,o=-1,r=_.length-1;-1!==r;--r)(i=_[r])<=n||(s=E(y[i]))>a&&(o=i,a=s);for(E(y[n])<t*a&&(r=w[n],a=w[o],w[n]=a,x[a]=n,w[o]=r,x[r]=o,a=y[n],y[n]=y[o],y[o]=a),a=d[n],o=m[n],l=y[n],f[a]=w[n],p[a]=1,++a,r=_.length-1;-1!==r;--r)s=y[i=_[r]],_[r]=0,y[i]=0,i<=n?(g[o]=i,v[o]=s,++o):(f[a]=w[i],p[a]=s/l,++a);d[n+1]=a,m[n+1]=o}for(r=f.length-1;-1!==r;--r)f[r]=x[f[r]];return{L:u,U:h,P:w,Pinv:x}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,n,r,i,a,o){var s,l,c,u=0,h=i.length,d=this.k,f=this.k1,p=this.j;if(0===r[e])for(r[e]=1,p[0]=e,d[0]=l=t[a[e]],f[0]=c=t[a[e]+1];;){if(isNaN(l))throw new Error("Ow!");if(l>=c){if(i[h]=a[p[u]],0===u)return;++h,l=d[--u],c=f[u]}else 0===r[s=n[l]]?(r[s]=1,d[u]=l,p[++u]=s,l=t[s=a[s]],f[u]=c=t[s+1]):++l}},numeric.ccsLPSolve0=function(e,t,n,r,i,a,o,s){var l,c,u,h,d,f,p,m,g,v=e[0],y=e[1],_=e[2],b=(v.length,t[0]),E=t[1],w=t[2];for(c=b[i],u=b[i+1],r.length=0,l=c;l<u;++l)s.dfs(E[l],v,y,n,r,a,o);for(l=r.length-1;-1!==l;--l)n[o[h=r[l]]]=0;for(l=c;l!==u;++l)n[h=E[l]]=w[l];for(l=r.length-1;-1!==l;--l){for(m=o[h=r[l]],d=v[h],f=v[h+1],p=d;p<f;++p)if(y[p]===m){n[m]/=_[p];break}for(g=n[m],p=d;p<f;++p)n[y[p]]-=g*_[p];n[m]=g}},numeric.ccsLUP0=function(e,t){var n,r,i,a,o,s,l,c=e[0].length-1,u=[numeric.rep([c+1],0),[],[]],h=[numeric.rep([c+1],0),[],[]],d=u[0],f=u[1],p=u[2],m=h[0],g=h[1],v=h[2],y=numeric.rep([c],0),_=numeric.rep([c],0),b=numeric.ccsLPSolve0,E=(Math.max,Math.abs),w=numeric.linspace(0,c-1),x=numeric.linspace(0,c-1),T=new numeric.ccsDFS0(c);for(void 0===t&&(t=1),n=0;n<c;++n){for(b(u,e,y,_,n,x,w,T),a=-1,o=-1,r=_.length-1;-1!==r;--r)(i=_[r])<=n||(s=E(y[w[i]]))>a&&(o=i,a=s);for(E(y[w[n]])<t*a&&(r=w[n],a=w[o],w[n]=a,x[a]=n,w[o]=r,x[r]=o),a=d[n],o=m[n],l=y[w[n]],f[a]=w[n],p[a]=1,++a,r=_.length-1;-1!==r;--r)s=y[w[i=_[r]]],_[r]=0,y[w[i]]=0,i<=n?(g[o]=i,v[o]=s,++o):(f[a]=w[i],p[a]=s/l,++a);d[n+1]=a,m[n+1]=o}for(r=f.length-1;-1!==r;--r)f[r]=x[f[r]];return{L:u,U:h,P:w,Pinv:x}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,n){var r=numeric.ccsDim(e),i=r[0],a=r[1];void 0===t?t=numeric.linspace(0,i-1):"number"==typeof t&&(t=[t]),void 0===n?n=numeric.linspace(0,a-1):"number"==typeof n&&(n=[n]);var o,s,l,c,u=t.length,h=n.length,d=numeric.rep([a],0),f=[],p=[],m=[d,f,p],g=e[0],v=e[1],y=e[2],_=numeric.rep([i],0),b=0,E=numeric.rep([i],0);for(s=0;s<h;++s){var w=g[c=n[s]],x=g[c+1];for(o=w;o<x;++o)E[l=v[o]]=1,_[l]=y[o];for(o=0;o<u;++o)E[t[o]]&&(f[b]=o,p[b]=_[t[o]],++b);for(o=w;o<x;++o)E[l=v[o]]=0;d[s+1]=b}return m},numeric.ccsDot=function(e,t){var n,r,i,a,o,s,l,c,u,h,d,f=e[0],p=e[1],m=e[2],g=t[0],v=t[1],y=t[2],_=numeric.ccsDim(e),b=numeric.ccsDim(t),E=_[0],w=(_[1],b[1]),x=numeric.rep([E],0),T=numeric.rep([E],0),A=Array(E),M=numeric.rep([w],0),S=[],R=[],k=[M,S,R];for(i=0;i!==w;++i){for(a=g[i],o=g[i+1],u=0,r=a;r<o;++r)for(h=v[r],d=y[r],s=f[h],l=f[h+1],n=s;n<l;++n)0===T[c=p[n]]&&(A[u]=c,T[c]=1,u+=1),x[c]=x[c]+m[n]*d;for(o=(a=M[i])+u,M[i+1]=o,r=u-1;-1!==r;--r)d=a+r,n=A[r],S[d]=n,R[d]=x[n],T[n]=0,x[n]=0;M[i+1]=M[i]+u}return k},numeric.ccsLUPSolve=function(e,t){var n=e.L,r=e.U,i=(e.P,t[0]),a=!1;"object"!=typeof i&&(i=(t=[[0,t.length],numeric.linspace(0,t.length-1),t])[0],a=!0);var o,s,l,c,u,h,d=t[1],f=t[2],p=n[0].length-1,m=i.length-1,g=numeric.rep([p],0),v=Array(p),y=numeric.rep([p],0),_=Array(p),b=numeric.rep([m+1],0),E=[],w=[],x=numeric.ccsTSolve,T=0;for(o=0;o<m;++o){for(u=0,l=i[o],c=i[o+1],s=l;s<c;++s)h=e.Pinv[d[s]],_[u]=h,y[h]=f[s],++u;for(_.length=u,x(n,y,g,_,v),s=_.length-1;-1!==s;--s)y[_[s]]=0;if(x(r,g,y,v,_),a)return y;for(s=v.length-1;-1!==s;--s)g[v[s]]=0;for(s=_.length-1;-1!==s;--s)h=_[s],E[T]=h,w[T]=y[h],y[h]=0,++T;b[o+1]=T}return[b,E,w]},numeric.ccsbinop=function(e,t){return void 0===t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,n=e[0],r=e[1],i=e[2],a=numeric.sup(r)+1,o=n.length,s=numeric.rep([a],0),l=Array(o),c=Array(o),u=numeric.rep([a],0);for(t=0;t<o;++t)u[r[t]]++;for(t=0;t<a;++t)s[t+1]=s[t]+u[t];var h,d,f=s.slice(0);for(t=0;t<o;++t)l[h=f[d=r[t]]]=n[t],c[h]=i[t],f[d]=f[d]+1;return[s,l,c]},numeric.ccsGather=function(e){var t,n,r,i,a,o=e[0],s=e[1],l=e[2],c=o.length-1,u=s.length,h=Array(u),d=Array(u),f=Array(u);for(a=0,t=0;t<c;++t)for(r=o[t],i=o[t+1],n=r;n!==i;++n)d[a]=t,h[a]=s[n],f[a]=l[n],++a;return[h,d,f]},numeric.sdim=function e(t,n,r){if(void 0===n&&(n=[]),"object"!=typeof t)return n;var i;for(i in void 0===r&&(r=0),r in n||(n[r]=0),t.length>n[r]&&(n[r]=t.length),t)t.hasOwnProperty(i)&&e(t[i],n,r+1);return n},numeric.sclone=function e(t,n,r){void 0===n&&(n=0),void 0===r&&(r=numeric.sdim(t).length);var i,a=Array(t.length);if(n===r-1){for(i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);return a}for(i in t)t.hasOwnProperty(i)&&(a[i]=e(t[i],n+1,r));return a},numeric.sdiag=function(e){var t,n,r=e.length,i=Array(r);for(t=r-1;t>=1;t-=2)n=t-1,i[t]=[],i[t][t]=e[t],i[n]=[],i[n][n]=e[n];return 0===t&&(i[0]=[],i[0][0]=e[t]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,n,r,i=[];e.length;for(t in e)if(e.hasOwnProperty(t))for(n in r=e[t])r.hasOwnProperty(n)&&("object"!=typeof i[n]&&(i[n]=[]),i[n][t]=r[n]);return i},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var n,r,i,a,o,s,l,c=e.length,u=(t.length,numeric.stranspose(t)),h=u.length,d=Array(c);for(i=c-1;i>=0;i--){for(l=[],n=e[i],o=h-1;o>=0;o--){for(a in s=0,r=u[o],n)n.hasOwnProperty(a)&&a in r&&(s+=n[a]*r[a]);s&&(l[o]=s)}d[i]=l}return d},numeric.sdotMV=function(e,t){var n,r,i,a,o=e.length,s=Array(o);for(r=o-1;r>=0;r--){for(i in a=0,n=e[r])n.hasOwnProperty(i)&&t[i]&&(a+=n[i]*t[i]);a&&(s[r]=a)}return s},numeric.sdotVM=function(e,t){var n,r,i,a,o=[];for(n in e)if(e.hasOwnProperty(n))for(r in i=t[n],a=e[n],i)i.hasOwnProperty(r)&&(o[r]||(o[r]=0),o[r]+=a*i[r]);return o},numeric.sdotVV=function(e,t){var n,r=0;for(n in e)e[n]&&t[n]&&(r+=e[n]*t[n]);return r},numeric.sdot=function(e,t){var n=numeric.sdim(e).length,r=numeric.sdim(t).length;switch(1e3*n+r){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+r)}},numeric.sscatter=function(e){var t,n,r,i,a=e[0].length,o=e.length,s=[];for(n=a-1;n>=0;--n)if(e[o-1][n]){for(i=s,r=0;r<o-2;r++)i[t=e[r][n]]||(i[t]=[]),i=i[t];i[e[r][n]]=e[r+1][n]}return s},numeric.sgather=function e(t,n,r){var i,a,o;for(a in void 0===n&&(n=[]),void 0===r&&(r=[]),i=r.length,t)if(t.hasOwnProperty(a))if(r[i]=parseInt(a),"number"==typeof(o=t[a])){if(o){if(0===n.length)for(a=i+1;a>=0;--a)n[a]=[];for(a=i;a>=0;--a)n[a].push(r[a]);n[i+1].push(o)}}else e(o,n,r);return r.length>i&&r.pop(),n},numeric.cLU=function(e){var t,n,r,i,a,o,s=e[0],l=e[1],c=e[2],u=s.length,h=0;for(t=0;t<u;t++)s[t]>h&&(h=s[t]);h++;var d,f=Array(h),p=Array(h),m=numeric.rep([h],1/0),g=numeric.rep([h],-1/0);for(r=0;r<u;r++)t=s[r],(n=l[r])<m[t]&&(m[t]=n),n>g[t]&&(g[t]=n);for(t=0;t<h-1;t++)g[t]>g[t+1]&&(g[t+1]=g[t]);for(t=h-1;t>=1;t--)m[t]<m[t-1]&&(m[t-1]=m[t]);for(t=0;t<h;t++)p[t]=numeric.rep([g[t]-m[t]+1],0),f[t]=numeric.rep([t-m[t]],0),t-m[t]+1,g[t]-t+1;for(r=0;r<u;r++)p[t=s[r]][l[r]-m[t]]=c[r];for(t=0;t<h-1;t++)for(i=t-m[t],_=p[t],n=t+1;m[n]<=t&&n<h;n++)if(a=t-m[n],o=g[t]-t,d=(b=p[n])[a]/_[i]){for(r=1;r<=o;r++)b[r+a]-=d*_[r+i];f[n][t-m[n]]=d}var v,y,_=[],b=[],E=[],w=[],x=[],T=[];for(u=0,v=0,t=0;t<h;t++){for(i=m[t],a=g[t],y=p[t],n=t;n<=a;n++)y[n-i]&&(_[u]=t,b[u]=n,E[u]=y[n-i],u++);for(y=f[t],n=i;n<t;n++)y[n-i]&&(w[v]=t,x[v]=n,T[v]=y[n-i],v++);w[v]=t,x[v]=t,T[v]=1,v++}return{U:[_,b,E],L:[w,x,T]}},numeric.cLUsolve=function(e,t){var n,r,i=e.L,a=e.U,o=numeric.clone(t),s=i[0],l=i[1],c=i[2],u=a[0],h=a[1],d=a[2],f=u.length,p=(s.length,o.length);for(r=0,n=0;n<p;n++){for(;l[r]<n;)o[n]-=c[r]*o[l[r]],r++;r++}for(r=f-1,n=p-1;n>=0;n--){for(;h[r]>n;)o[n]-=d[r]*o[h[r]],r--;o[n]/=d[r],r--}return o},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var n,r,i,a=numeric.rep(e,-1);if("function"!=typeof t)switch(t){case"L":t=function(t,n){return t>=e[0]/2||n<e[1]/2};break;default:t=function(e,t){return!0}}for(i=0,n=1;n<e[0]-1;n++)for(r=1;r<e[1]-1;r++)t(n,r)&&(a[n][r]=i,i++);return a},numeric.cdelsq=function(e){var t,n,r,i,a,o=[[-1,0],[0,-1],[0,1],[1,0]],s=numeric.dim(e),l=s[0],c=s[1],u=[],h=[],d=[];for(t=1;t<l-1;t++)for(n=1;n<c-1;n++)if(!(e[t][n]<0)){for(r=0;r<4;r++)i=t+o[r][0],a=n+o[r][1],e[i][a]<0||(u.push(e[t][n]),h.push(e[i][a]),d.push(-1));u.push(e[t][n]),h.push(e[t][n]),d.push(4)}return[u,h,d]},numeric.cdotMV=function(e,t){var n,r,i,a=e[0],o=e[1],s=e[2],l=a.length;for(i=0,r=0;r<l;r++)a[r]>i&&(i=a[r]);for(i++,n=numeric.rep([i],0),r=0;r<l;r++)n[a[r]]+=s[r]*t[o[r]];return n},numeric.Spline=function(e,t,n,r,i){this.x=e,this.yl=t,this.yr=n,this.kl=r,this.kr=i},numeric.Spline.prototype._at=function(e,t){var n,r,i,a=this.x,o=this.yl,s=this.yr,l=this.kl,c=this.kr,u=numeric.add,h=numeric.sub,d=numeric.mul;n=h(d(l[t],a[t+1]-a[t]),h(s[t+1],o[t])),r=u(d(c[t+1],a[t]-a[t+1]),h(s[t+1],o[t]));var f=(i=(e-a[t])/(a[t+1]-a[t]))*(1-i);return u(u(u(d(1-i,o[t]),d(i,s[t+1])),d(n,f*(1-i))),d(r,f*i))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,n,r,i=this.x,a=i.length,o=Math.floor;for(t=0,n=a-1;n-t>1;)i[r=o((t+n)/2)]<=e?t=r:n=r;return this._at(e,t)}a=e.length;var s,l=Array(a);for(s=a-1;-1!==s;--s)l[s]=this.at(e[s]);return l},numeric.Spline.prototype.diff=function(){var e,t,n,r=this.x,i=this.yl,a=this.yr,o=this.kl,s=this.kr,l=i.length,c=o,u=s,h=Array(l),d=Array(l),f=numeric.add,p=numeric.mul,m=numeric.div,g=numeric.sub;for(e=l-1;-1!==e;--e)t=r[e+1]-r[e],n=g(a[e+1],i[e]),h[e]=m(f(p(n,6),p(o[e],-4*t),p(s[e+1],-2*t)),t*t),d[e+1]=m(f(p(n,-6),p(o[e],2*t),p(s[e+1],4*t)),t*t);return new numeric.Spline(r,c,u,h,d)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],n=this.x,r=this.yl,i=this.yr,a=this.kl,o=this.kr;"number"==typeof r[0]&&(r=[r],i=[i],a=[a],o=[o]);var s,l,c,u,h,d,f,p,m,g,v,y,_,b,E,w,x,T,A,M,S,R,k,P=r.length,L=n.length-1,C=(t=Array(P),Math.sqrt);for(s=0;s!==P;++s){for(u=r[s],h=i[s],d=a[s],f=o[s],p=[],l=0;l!==L;l++){for(l>0&&h[l]*u[l]<0&&p.push(n[l]),w=n[l+1]-n[l],n[l],v=u[l],y=h[l+1],m=d[l]/w,_=(g=f[l+1]/w)+3*v+2*m-3*y,b=3*(g+m+2*(v-y)),(E=e(m-g+3*(v-y))+12*g*v)<=0?x=(T=_/b)>n[l]&&T<n[l+1]?[n[l],T,n[l+1]]:[n[l],n[l+1]]:(T=(_-C(E))/b,A=(_+C(E))/b,x=[n[l]],T>n[l]&&T<n[l+1]&&x.push(T),A>n[l]&&A<n[l+1]&&x.push(A),x.push(n[l+1])),S=x[0],T=this._at(S,l),c=0;c<x.length-1;c++)if(R=x[c+1],A=this._at(R,l),0!==T)if(0===A||T*A>0)S=R,T=A;else{for(var I=0;!((k=(T*R-A*S)/(T-A))<=S||k>=R);)if((M=this._at(k,l))*A>0)R=k,A=M,-1===I&&(T*=.5),I=-1;else{if(!(M*T>0))break;S=k,T=M,1===I&&(A*=.5),I=1}p.push(k),S=x[c+1],T=this._at(S,l)}else p.push(S),S=R,T=A;0===A&&p.push(R)}t[s]=p}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,n,r){var i,a=e.length,o=[],s=[],l=[],c=numeric.sub,u=numeric.mul,h=numeric.add;for(i=a-2;i>=0;i--)s[i]=e[i+1]-e[i],l[i]=c(t[i+1],t[i]);"string"!=typeof n&&"string"!=typeof r||(n=r="periodic");var d=[[],[],[]];switch(typeof n){case"undefined":o[0]=u(3/(s[0]*s[0]),l[0]),d[0].push(0,0),d[1].push(0,1),d[2].push(2/s[0],1/s[0]);break;case"string":o[0]=h(u(3/(s[a-2]*s[a-2]),l[a-2]),u(3/(s[0]*s[0]),l[0])),d[0].push(0,0,0),d[1].push(a-2,0,1),d[2].push(1/s[a-2],2/s[a-2]+2/s[0],1/s[0]);break;default:o[0]=n,d[0].push(0),d[1].push(0),d[2].push(1)}for(i=1;i<a-1;i++)o[i]=h(u(3/(s[i-1]*s[i-1]),l[i-1]),u(3/(s[i]*s[i]),l[i])),d[0].push(i,i,i),d[1].push(i-1,i,i+1),d[2].push(1/s[i-1],2/s[i-1]+2/s[i],1/s[i]);switch(typeof r){case"undefined":o[a-1]=u(3/(s[a-2]*s[a-2]),l[a-2]),d[0].push(a-1,a-1),d[1].push(a-2,a-1),d[2].push(1/s[a-2],2/s[a-2]);break;case"string":d[1][d[1].length-1]=0;break;default:o[a-1]=r,d[0].push(a-1),d[1].push(a-1),d[2].push(1)}o="number"!=typeof o[0]?numeric.transpose(o):[o];var f=Array(o.length);if("string"==typeof n)for(i=f.length-1;-1!==i;--i)f[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(d)),o[i]),f[i][a-1]=f[i][0];else for(i=f.length-1;-1!==i;--i)f[i]=numeric.cLUsolve(numeric.cLU(d),o[i]);return f="number"==typeof t[0]?f[0]:numeric.transpose(f),new numeric.Spline(e,t,t,f,f)},numeric.fftpow2=function e(t,n){var r=t.length;if(1!==r){var i,a,o=Math.cos,s=Math.sin,l=Array(r/2),c=Array(r/2),u=Array(r/2),h=Array(r/2);for(a=r/2,i=r-1;-1!==i;--i)u[--a]=t[i],h[a]=n[i],--i,l[a]=t[i],c[a]=n[i];e(l,c),e(u,h),a=r/2;var d,f,p,m=-6.283185307179586/r;for(i=r-1;-1!==i;--i)-1===--a&&(a=r/2-1),f=o(d=m*i),p=s(d),t[i]=l[a]+f*u[a]-p*h[a],n[i]=c[a]+f*h[a]+p*u[a]}},numeric._ifftpow2=function e(t,n){var r=t.length;if(1!==r){var i,a,o=Math.cos,s=Math.sin,l=Array(r/2),c=Array(r/2),u=Array(r/2),h=Array(r/2);for(a=r/2,i=r-1;-1!==i;--i)u[--a]=t[i],h[a]=n[i],--i,l[a]=t[i],c[a]=n[i];e(l,c),e(u,h),a=r/2;var d,f,p,m=6.283185307179586/r;for(i=r-1;-1!==i;--i)-1===--a&&(a=r/2-1),f=o(d=m*i),p=s(d),t[i]=l[a]+f*u[a]-p*h[a],n[i]=c[a]+f*h[a]+p*u[a]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,n,r){var i,a,o,s,l;for(numeric.fftpow2(e,t),numeric.fftpow2(n,r),i=e.length-1;-1!==i;--i)a=e[i],s=t[i],o=n[i],l=r[i],e[i]=a*o-s*l,t[i]=a*l+s*o;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,n=this.x,r=this.y,i=n.length,a=Math.log,o=a(2),s=Math.ceil(a(2*i-1)/o),l=Math.pow(2,s),c=numeric.rep([l],0),u=numeric.rep([l],0),h=Math.cos,d=Math.sin,f=-3.141592653589793/i,p=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(i/2);for(e=0;e<i;e++)p[e]=n[e];if(void 0!==r)for(e=0;e<i;e++)m[e]=r[e];for(c[0]=1,e=1;e<=l/2;e++)t=f*e*e,c[e]=h(t),u[e]=d(t),c[l-e]=h(t),u[l-e]=d(t);var g=new numeric.T(p,m),v=new numeric.T(c,u);return g=g.mul(v),numeric.convpow2(g.x,g.y,numeric.clone(v.x),numeric.neg(v.y)),(g=g.mul(v)).x.length=i,g.y.length=i,g},numeric.T.prototype.ifft=function(){var e,t,n=this.x,r=this.y,i=n.length,a=Math.log,o=a(2),s=Math.ceil(a(2*i-1)/o),l=Math.pow(2,s),c=numeric.rep([l],0),u=numeric.rep([l],0),h=Math.cos,d=Math.sin,f=3.141592653589793/i,p=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(i/2);for(e=0;e<i;e++)p[e]=n[e];if(void 0!==r)for(e=0;e<i;e++)m[e]=r[e];for(c[0]=1,e=1;e<=l/2;e++)t=f*e*e,c[e]=h(t),u[e]=d(t),c[l-e]=h(t),u[l-e]=d(t);var g=new numeric.T(p,m),v=new numeric.T(c,u);return g=g.mul(v),numeric.convpow2(g.x,g.y,numeric.clone(v.x),numeric.neg(v.y)),(g=g.mul(v)).x.length=i,g.y.length=i,g.div(i)},numeric.gradient=function(e,t){var n=t.length,r=e(t);if(isNaN(r))throw new Error("gradient: f(x) is a NaN!");var i,a,o,s,l,c,u,h,d,f=Math.max,p=numeric.clone(t),m=Array(n),g=(numeric.div,numeric.sub,f=Math.max,Math.abs),v=Math.min,y=0;for(i=0;i<n;i++)for(var _=f(1e-6*r,1e-8);;){if(++y>20)throw new Error("Numerical gradient fails");if(p[i]=t[i]+_,a=e(p),p[i]=t[i]-_,o=e(p),p[i]=t[i],isNaN(a)||isNaN(o))_/=16;else{if(m[i]=(a-o)/(2*_),s=t[i]-_,l=t[i],c=t[i]+_,u=(a-r)/_,h=(r-o)/_,d=f(g(m[i]),g(r),g(a),g(o),g(s),g(l),g(c),1e-8),!(v(f(g(u-m[i]),g(h-m[i]),g(u-h))/d,_/d)>.001))break;_/=16}}return m},numeric.uncmin=function(e,t,n,r,i,a,o){var s=numeric.gradient;void 0===o&&(o={}),void 0===n&&(n=1e-8),void 0===r&&(r=function(t){return s(e,t)}),void 0===i&&(i=1e3);var l,c,u=(t=numeric.clone(t)).length,h=e(t);if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var d=Math.max,f=numeric.norm2;n=d(n,numeric.epsilon);var p,m,g,v,y,_,b,E,w,x,T=o.Hinv||numeric.identity(u),A=numeric.dot,M=(numeric.inv,numeric.sub),S=numeric.add,R=numeric.tensor,k=numeric.div,P=numeric.mul,L=numeric.all,C=numeric.isFinite,I=numeric.neg,N=0,F="";for(m=r(t);N<i;){if("function"==typeof a&&a(N,t,h,m,T)){F="Callback returned true";break}if(!L(C(m))){F="Gradient has Infinity or NaN";break}if(!L(C(p=I(A(T,m))))){F="Search direction has Infinity or NaN";break}if((x=f(p))<n){F="Newton step smaller than tol";break}for(w=1,c=A(m,p),y=t;N<i&&!(w*x<n)&&(y=S(t,v=P(p,w)),(l=e(y))-h>=.1*w*c||isNaN(l));)w*=.5,++N;if(w*x<n){F="Line search step size smaller than tol";break}if(N===i){F="maxit reached during line search";break}E=A(_=M(g=r(y),m),v),b=A(T,_),T=M(S(T,P((E+A(_,b))/(E*E),R(v,v))),k(S(R(b,v),R(v,b)),E)),t=y,h=l,m=g,++N}return{solution:t,f:h,gradient:m,invHessian:T,iterations:N,message:F}},numeric.Dopri=function(e,t,n,r,i,a,o){this.x=e,this.y=t,this.f=n,this.ymid=r,this.iterations=i,this.events=o,this.message=a},numeric.Dopri.prototype._at=function(e,t){function n(e){return e*e}var r,i,a,o,s,l,c,u,h,d=this,f=d.x,p=d.y,m=d.f,g=d.ymid,v=(f.length,Math.floor,numeric.add),y=numeric.mul,_=numeric.sub;return r=f[t],i=f[t+1],o=p[t],s=p[t+1],a=r+.5*(i-r),l=g[t],c=_(m[t],y(o,1/(r-a)+2/(r-i))),u=_(m[t+1],y(s,1/(i-a)+2/(i-r))),v(v(v(v(y(o,(h=[n(e-i)*(e-a)/n(r-i)/(r-a),n(e-r)*n(e-i)/n(r-a)/n(i-a),n(e-r)*(e-a)/n(i-r)/(i-a),(e-r)*n(e-i)*(e-a)/n(r-i)/(r-a),(e-i)*n(e-r)*(e-a)/n(r-i)/(i-a)])[0]),y(l,h[1])),y(s,h[2])),y(c,h[3])),y(u,h[4]))},numeric.Dopri.prototype.at=function(e){var t,n,r,i=Math.floor;if("number"!=typeof e){var a=e.length,o=Array(a);for(t=a-1;-1!==t;--t)o[t]=this.at(e[t]);return o}var s=this.x;for(t=0,n=s.length-1;n-t>1;)s[r=i(.5*(t+n))]<=e?t=r:n=r;return this._at(e,t)},numeric.dopri=function(e,t,n,r,i,a,o){void 0===i&&(i=1e-6),void 0===a&&(a=1e3);var s,l,c,u,h,d,f,p,m,g,v,y,_,b=[e],E=[n],w=[r(e,n)],x=[],T=[3/40,9/40],A=[44/45,-56/15,32/9],M=[19372/6561,-25360/2187,64448/6561,-212/729],S=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],R=[35/384,0,500/1113,125/192,-2187/6784,11/84],k=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],P=[.2,.3,.8,8/9,1,1],L=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],C=0,I=(t-e)/10,N=0,F=numeric.add,O=numeric.mul,H=(Math.max,Math.min),D=Math.abs,U=numeric.norminf,B=Math.pow,z=numeric.any,V=numeric.lt,j=numeric.and,G=(numeric.sub,new numeric.Dopri(b,E,w,x,-1,""));for("function"==typeof o&&(v=o(e,n));e<t&&N<a;)if(++N,e+I>t&&(I=t-e),s=r(e+P[0]*I,F(n,O(.2*I,w[C]))),l=r(e+P[1]*I,F(F(n,O(T[0]*I,w[C])),O(T[1]*I,s))),c=r(e+P[2]*I,F(F(F(n,O(A[0]*I,w[C])),O(A[1]*I,s)),O(A[2]*I,l))),u=r(e+P[3]*I,F(F(F(F(n,O(M[0]*I,w[C])),O(M[1]*I,s)),O(M[2]*I,l)),O(M[3]*I,c))),h=r(e+P[4]*I,F(F(F(F(F(n,O(S[0]*I,w[C])),O(S[1]*I,s)),O(S[2]*I,l)),O(S[3]*I,c)),O(S[4]*I,u))),d=r(e+I,m=F(F(F(F(F(n,O(w[C],I*R[0])),O(l,I*R[2])),O(c,I*R[3])),O(u,I*R[4])),O(h,I*R[5]))),(g="number"==typeof(f=F(F(F(F(F(O(w[C],I*L[0]),O(l,I*L[2])),O(c,I*L[3])),O(u,I*L[4])),O(h,I*L[5])),O(d,I*L[6])))?D(f):U(f))>i){if(e+(I=.2*I*B(i/g,.25))===e){G.msg="Step size became too small";break}}else{if(x[C]=F(F(F(F(F(F(n,O(w[C],I*k[0])),O(l,I*k[2])),O(c,I*k[3])),O(u,I*k[4])),O(h,I*k[5])),O(d,I*k[6])),b[++C]=e+I,E[C]=m,w[C]=d,"function"==typeof o){var W,q,X=e,Y=e+.5*I;if(y=o(Y,x[C-1]),z(_=j(V(v,0),V(0,y)))||(X=Y,v=y,y=o(Y=e+I,m),_=j(V(v,0),V(0,y))),z(_)){for(var K,Z,Q=0,J=1,$=1;;){if("number"==typeof v)q=($*y*X-J*v*Y)/($*y-J*v);else for(q=Y,p=v.length-1;-1!==p;--p)v[p]<0&&y[p]>0&&(q=H(q,($*y[p]*X-J*v[p]*Y)/($*y[p]-J*v[p])));if(q<=X||q>=Y)break;Z=o(q,W=G._at(q,C-1)),z(K=j(V(v,0),V(0,Z)))?(Y=q,y=Z,_=K,$=1,-1===Q?J*=.5:J=1,Q=-1):(X=q,v=Z,J=1,1===Q?$*=.5:$=1,Q=1)}return m=G._at(.5*(e+q),C-1),G.f[C]=r(q,W),G.x[C]=q,G.y[C]=W,G.ymid[C-1]=m,G.events=_,G.iterations=N,G}}e+=I,n=m,v=y,I=H(.8*I*B(i/g,.25),4*I)}return G.iterations=N,G},numeric.LU=function(e,t){t=t||!1;var n,r,i,a,o,s,l,c,u,h=Math.abs,d=e.length,f=d-1,p=new Array(d);for(t||(e=numeric.clone(e)),i=0;i<d;++i){for(l=i,u=h((s=e[i])[i]),r=i+1;r<d;++r)u<(a=h(e[r][i]))&&(u=a,l=r);for(p[i]=l,l!=i&&(e[i]=e[l],e[l]=s,s=e[i]),o=s[i],n=i+1;n<d;++n)e[n][i]/=o;for(n=i+1;n<d;++n){for(c=e[n],r=i+1;r<f;++r)c[r]-=c[i]*s[r],c[++r]-=c[i]*s[r];r===f&&(c[r]-=c[i]*s[r])}}return{LU:e,P:p}},numeric.LUsolve=function(e,t){var n,r,i,a,o,s=e.LU,l=s.length,c=numeric.clone(t),u=e.P;for(n=l-1;-1!==n;--n)c[n]=t[n];for(n=0;n<l;++n)for(i=u[n],u[n]!==n&&(o=c[n],c[n]=c[i],c[i]=o),a=s[n],r=0;r<n;++r)c[n]-=c[r]*a[r];for(n=l-1;n>=0;--n){for(a=s[n],r=n+1;r<l;++r)c[n]-=c[r]*a[r];c[n]/=a[n]}return c},numeric.solve=function(e,t,n){return numeric.LUsolve(numeric.LU(e,n),t)},numeric.echelonize=function(e){var t,n,r,i,a,o,s,l,c=numeric.dim(e),u=c[0],h=c[1],d=numeric.identity(u),f=Array(u),p=Math.abs,m=numeric.diveq;for(e=numeric.clone(e),t=0;t<u;++t){for(r=0,a=e[t],o=d[t],n=1;n<h;++n)p(a[r])<p(a[n])&&(r=n);for(f[t]=r,m(o,a[r]),m(a,a[r]),n=0;n<u;++n)if(n!==t){for(l=(s=e[n])[r],i=h-1;-1!==i;--i)s[i]-=a[i]*l;for(s=d[n],i=u-1;-1!==i;--i)s[i]-=o[i]*l}}return{I:d,A:e,P:f}},numeric.__solveLP=function(e,t,n,r,i,a,o){var s,l,c,u,h=numeric.sum,d=(numeric.log,numeric.mul),f=numeric.sub,p=numeric.dot,m=numeric.div,g=numeric.add,v=e.length,y=n.length,_=!1,b=1,E=(numeric.transpose(t),numeric.svd,numeric.transpose),w=(numeric.leq,Math.sqrt),x=Math.abs,T=(numeric.muleq,numeric.norminf,numeric.any,Math.min),A=numeric.all,M=numeric.gt,S=Array(v),R=Array(y),k=(numeric.rep([y],1),numeric.solve),P=f(n,p(t,a)),L=p(e,e);for(c=0;c<i;++c){var C,I;for(C=y-1;-1!==C;--C)R[C]=m(t[C],P[C]);var N=E(R);for(C=v-1;-1!==C;--C)S[C]=h(N[C]);b=.25*x(L/p(e,S));var F=100*w(L/p(S,S));for((!isFinite(b)||b>F)&&(b=F),u=g(e,d(b,S)),l=p(N,R),C=v-1;-1!==C;--C)l[C][C]+=1;I=k(l,m(u,b),!0);var O=m(P,p(t,I)),H=1;for(C=y-1;-1!==C;--C)O[C]<0&&(H=T(H,-.999*O[C]));if(s=f(a,d(I,H)),!A(M(P=f(n,p(t,s)),0)))return{solution:a,message:"",iterations:c};if(a=s,b<r)return{solution:s,message:"",iterations:c};if(o){var D=p(e,u),U=p(t,u);for(_=!0,C=y-1;-1!==C;--C)if(D*U[C]<0){_=!1;break}}else _=!(a[v-1]>=0);if(_)return{solution:s,message:"Unbounded",iterations:c}}return{solution:a,message:"maximum iteration count exceeded",iterations:c}},numeric._solveLP=function(e,t,n,r,i){var a=e.length,o=n.length,s=(numeric.sum,numeric.log,numeric.mul,numeric.sub),l=numeric.dot,c=(numeric.div,numeric.add,numeric.rep([a],0).concat([1])),u=numeric.rep([o,1],-1),h=numeric.blockMatrix([[t,u]]),d=n,f=numeric.rep([a],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),p=numeric.__solveLP(c,h,d,r,i,f,!1),m=numeric.clone(p.solution);if(m.length=a,numeric.inf(s(n,l(t,m)))<0)return{solution:NaN,message:"Infeasible",iterations:p.iterations};var g=numeric.__solveLP(e,t,n,r,i-p.iterations,m,!0);return g.iterations+=p.iterations,g},numeric.solveLP=function(e,t,n,r,i,a,o){if(void 0===o&&(o=1e3),void 0===a&&(a=numeric.epsilon),void 0===r)return numeric._solveLP(e,t,n,a,o);var s,l=r.length,c=r[0].length,u=t.length,h=numeric.echelonize(r),d=numeric.rep([c],0),f=h.P,p=[];for(s=f.length-1;-1!==s;--s)d[f[s]]=1;for(s=c-1;-1!==s;--s)0===d[s]&&p.push(s);var m=numeric.getRange,g=numeric.linspace(0,l-1),v=numeric.linspace(0,u-1),y=m(r,g,p),_=m(t,v,f),b=m(t,v,p),E=numeric.dot,w=numeric.sub,x=E(_,h.I),T=w(b,E(x,y)),A=w(n,E(x,i)),M=Array(f.length),S=Array(p.length);for(s=f.length-1;-1!==s;--s)M[s]=e[f[s]];for(s=p.length-1;-1!==s;--s)S[s]=e[p[s]];var R=w(S,E(M,E(h.I,y))),k=numeric._solveLP(R,T,A,a,o),P=k.solution;if(P!=P)return k;var L=E(h.I,w(i,E(y,P))),C=Array(e.length);for(s=f.length-1;-1!==s;--s)C[f[s]]=L[s];for(s=p.length-1;-1!==s;--s)C[p[s]]=P[s];return{solution:C,message:k.message,iterations:k.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var t,n,r,i,a=0,o=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],s=e.length,l=0,c={},u=[],h=0,d={},f=0,p=[],m=[],g=[];function v(n){throw new Error("MPStoLP: "+n+"\nLine "+t+": "+e[t]+"\nCurrent state: "+o[a]+"\n")}for(t=0;t<s;++t){var y=(r=e[t]).match(/\S*/g),_=[];for(n=0;n<y.length;++n)""!==y[n]&&_.push(y[n]);if(0!==_.length){for(n=0;n<o.length&&r.substr(0,o[n].length)!==o[n];++n);if(n<o.length){if(a=n,1===n&&(i=_[1]),6===n)return{name:i,c:p,A:numeric.transpose(m),b:g,rows:c,vars:d}}else switch(a){case 0:case 1:v("Unexpected line");case 2:switch(_[0]){case"N":0===l?l=_[1]:v("Two or more N rows");break;case"L":c[_[1]]=h,u[h]=1,g[h]=0,++h;break;case"G":c[_[1]]=h,u[h]=-1,g[h]=0,++h;break;case"E":c[_[1]]=h,u[h]=0,g[h]=0,++h;break;default:v("Parse error "+numeric.prettyPrint(_))}break;case 3:d.hasOwnProperty(_[0])||(d[_[0]]=f,p[f]=0,m[f]=numeric.rep([h],0),++f);var b=d[_[0]];for(n=1;n<_.length;n+=2)if(_[n]!==l){var E=c[_[n]];m[b][E]=(u[E]<0?-1:1)*parseFloat(_[n+1])}else p[b]=parseFloat(_[n+1]);break;case 4:for(n=1;n<_.length;n+=2)g[c[_[n]]]=(u[c[_[n]]]<0?-1:1)*parseFloat(_[n+1]);break;case 5:break;case 6:v("Internal error")}}}v("Reached end of file without ENDATA")}},2624:e=>{"use strict";var t=new Float64Array(4),n=new Float64Array(4),r=new Float64Array(4);var i=new Float64Array(4);e.exports=function(e,a,o,s){switch(s||(i.length<o.length&&(i=new Float64Array(o.length)),s=i),e.length){case 0:for(var l=0;l<o.length;++l)s[l]=Number.NaN;return Number.NaN;case 1:return function(e,t,n){for(var r=0,i=0;i<t.length;++i){n[i]=e[i];var a=e[i]-t[i];r+=a*a}return r}(a[e[0]],o,s);case 2:return function(e,t,n,r){for(var i=0,a=0,o=0;o<n.length;++o){var s=e[o],l=t[o],c=s-l;a+=c*(n[o]-l),i+=c*c}var u=0;Math.abs(i)>1e-8&&((u=a/i)<0?u=0:u>1&&(u=1));var h=1-u,d=0;for(o=0;o<n.length;++o){var f=u*e[o]+h*t[o];r[o]=f;var p=n[o]-f;d+=p*p}return d}(a[e[0]],a[e[1]],o,s);case 3:return function(e,i,a,o,s){t.length<o.length&&(t=new Float64Array(o.length),n=new Float64Array(o.length),r=new Float64Array(o.length));for(var l=0;l<o.length;++l)t[l]=e[l]-o[l],n[l]=i[l]-e[l],r[l]=a[l]-e[l];var c=0,u=0,h=0,d=0,f=0,p=0;for(l=0;l<o.length;++l){var m=n[l],g=r[l],v=t[l];c+=m*m,u+=m*g,h+=g*g,d+=v*m,f+=v*g,p+=v*v}var y,_,b,E,w,x=Math.abs(c*h-u*u),T=u*f-h*d,A=u*d-c*f;if(T+A<=x)if(T<0)A<0&&d<0?(A=0,-d>=c?(T=1,y=c+2*d+p):y=d*(T=-d/c)+p):(T=0,f>=0?(A=0,y=p):-f>=h?(A=1,y=h+2*f+p):y=f*(A=-f/h)+p);else if(A<0)A=0,d>=0?(T=0,y=p):-d>=c?(T=1,y=c+2*d+p):y=d*(T=-d/c)+p;else{var M=1/x;y=(T*=M)*(c*T+u*(A*=M)+2*d)+A*(u*T+h*A+2*f)+p}else T<0?(b=h+f)>(_=u+d)?(E=b-_)>=(w=c-2*u+h)?(T=1,A=0,y=c+2*d+p):y=(T=E/w)*(c*T+u*(A=1-T)+2*d)+A*(u*T+h*A+2*f)+p:(T=0,b<=0?(A=1,y=h+2*f+p):f>=0?(A=0,y=p):y=f*(A=-f/h)+p):A<0?(b=c+d)>(_=u+f)?(E=b-_)>=(w=c-2*u+h)?(A=1,T=0,y=h+2*f+p):y=(T=1-(A=E/w))*(c*T+u*A+2*d)+A*(u*T+h*A+2*f)+p:(A=0,b<=0?(T=1,y=c+2*d+p):d>=0?(T=0,y=p):y=d*(T=-d/c)+p):(E=h+f-u-d)<=0?(T=0,A=1,y=h+2*f+p):E>=(w=c-2*u+h)?(T=1,A=0,y=c+2*d+p):y=(T=E/w)*(c*T+u*(A=1-T)+2*d)+A*(u*T+h*A+2*f)+p;var S=1-T-A;for(l=0;l<o.length;++l)s[l]=S*e[l]+T*i[l]+A*a[l];return y<0?0:y}(a[e[0]],a[e[1]],a[e[2]],o,s);default:return console.log("closestPoint: general case not supported..."),Number.NaN}}},4726:(e,t,n)=>{"use strict";var r=n(8743),i=n(67),a=n(5297);e.exports=function(e){e.sort(i);for(var t=e.length,n=0,o=0;o<t;++o){var s=e[o],l=a(s);if(0!==l){if(n>0){var c=e[n-1];if(0===r(s,c)&&a(c)!==l){n-=1;continue}}e[n++]=s}}return e.length=n,e}},8670:(e,t,n)=>{"use strict";e.exports=function(e,t,n,i){var a=function(e,t,n){return new l(e.length,function(e){for(var t=e.length,n=r.mallocInt32(o(3*t)),i=0,a=0;a<t;++a)for(var s=e[a],l=0;l<3;++l)n[i++]=s[l];return n}(e),t.length,h(t),h(n))}(e,t,n);w(a,i);var s=a.unpack();return a.dispose(),s},e.exports.packed=w;var r=n(4964),i=n(2917),a=n(3397),o=n(8249);function s(e,t,n,r,i,a){return Math.pow(e-r,2)+Math.pow(t-i,2)+Math.pow(n-a,2)}function l(e,t,n,r,i){this.numCells=e,this.cells=t,this.numVerts=n,this.verts=r,this.normals=i}var c=l.prototype;function u(e,t){for(var n=new Array(e),r=0;r<e;++r)n[r]=[t[3*r],t[3*r+1],t[3*r+2]];return n}function h(e){for(var t=e.length,n=r.mallocFloat32(o(3*t)),i=0,a=0;a<t;++a)for(var s=e[a],l=0;l<3;++l)n[i++]=s[l];return n}c.unpack=function(){return{cells:u(this.numCells,this.cells),positions:u(this.numVerts,this.verts),normals:u(this.numVerts,this.normals)}},c.dispose=function(){r.free(this.cells),r.free(this.verts),r.free(this.normals)};function d(e,t,n){if(e.length>=t)return e;t=o(t);for(var i=r.mallocFloat32(t),a=0;a<n;++a)i[a]=e[a];return r.free(e),i}function f(e,t,n,r){for(var i=0;i<3;++i){var a=e[3*t+i];if(a!==n&&a!==r)return i}return-1}var p=[-1,-1,-1,-1,-1];function m(e,t,n,l){for(var c=0;c<n;++c){for(var u=e.numCells,h=e.cells,m=e.numVerts,g=e.verts,v=e.normals,y=3*u,_=0,b=r.mallocInt32(3*y),E=0;E<u;++E){var w=h[3*E],x=h[3*E+1],T=h[3*E+2],A=g[3*w],M=g[3*w+1],S=g[3*w+2],R=g[3*x],k=g[3*x+1],P=g[3*x+2],L=g[3*T],C=g[3*T+1],I=g[3*T+2];s(A,M,S,R,k,P)>t&&(b[_++]=Math.min(w,x),b[_++]=Math.max(w,x),b[_++]=E),s(R,k,P,L,C,I)>t&&(b[_++]=Math.min(x,T),b[_++]=Math.max(x,T),b[_++]=E),s(L,C,I,A,M,S)>t&&(b[_++]=Math.min(T,w),b[_++]=Math.max(T,w),b[_++]=E)}if(_<3*l)return r.free(b),c>0;var N=_/3|0;a(i(b,[N,3],[3,1],0)),g=d(g,3*(N+m),3*m),v=d(v,3*(N+m),3*m);var F=0,O=-1,H=-1,D=-1;for(E=0;E<_;E+=3){w=b[E],x=b[E+1];var U=b[E+2];if(w===O&&x===H){var B=m++;g[3*B]=.5*(g[3*w]+g[3*x]),g[3*B+1]=.5*(g[3*w+1]+g[3*x+1]),g[3*B+2]=.5*(g[3*w+2]+g[3*x+2]);var z=v[3*w],V=v[3*w+1],j=v[3*w+2],G=.5*(z+v[3*x]),W=.5*(V+v[3*x+1]),q=.5*(j+v[3*x+2]),X=Math.pow(G,2)+Math.pow(W,2)+Math.pow(q,2);X>1e-6?(X=1/Math.sqrt(X),v[3*B]=G*X,v[3*B+1]=W*X,v[3*B+2]=q*X):(v[3*B]=z,v[3*B+1]=V,v[3*B+2]=j),b[F++]=4*U+f(h,U,w,x),b[F++]=B,b[F++]=4*D+f(h,D,w,x),b[F++]=B}O=w,H=x,D=U}var Y=F/2|0;if(Y<l)return r.free(b),c>0;a(i(b,[Y,2],[2,1],0));var K=0,Z=r.mallocInt32(o(3*(u+Y))),Q=0;for(E=0;E<u;++E)if(Q>=N||b[2*Q]>>2!==E)Z[K++]=h[3*E],Z[K++]=h[3*E+1],Z[K++]=h[3*E+2];else{p[0]=h[3*E+1],p[1]=-1,p[2]=h[3*E+2],p[3]=-1,p[4]=h[3*E],p[5]=-1;for(var J=0;Q<Y;){var $=b[2*Q];if($>>2!==E)break;p[J=1+2*(3&$)]=b[2*Q+1],Q+=1}for(var ee=-1,te=p[J],ne=1;ne<6;++ne){var re=p[(ne+J)%6];re<0||(ee>=0&&(Z[K++]=te,Z[K++]=ee,Z[K++]=re),ee=re)}}e.numVerts=m,e.verts=g,e.numCells=K/3|0,e.cells=Z,e.normals=v,r.free(h),r.free(b)}return c>0}function g(e,t,n,r,i,a){for(var o=0;o<n;++o)r[o]=0;for(var s=0;s<3*e;++s)r[t[s]]+=2;var l=0;for(o=0;o<n;++o)i[o]=l,l+=r[o];for(o=0;o<e;++o){var c=t[3*o],u=t[3*o+1],h=t[3*o+2],d=i[c];i[c]=d+2;var f=i[u];i[u]=f+2;var p=i[h];i[h]=p+2,a[d]=u,a[d+1]=h,a[f]=c,a[f+1]=h,a[p]=c,a[p+1]=u}var m=0,g=0;for(o=0;o<n;++o){var v=i[o],y=m;m=v,i[o]=g;for(s=y;s<v;++s){for(var _=a[s],b=s;b>y;--b){var E=a[b-1];if(E<=_)break;a[b]=E}a[b]=_}var w=-1,x=g;for(s=y;s<v;++s){(_=a[s])!==w&&(a[g++]=w=_)}r[o]=g-x}}function v(e,t,n,r,i,a,o,l,c){for(var u=0;u<a;++u){var h=l[i+u];if(c[h]>=0||s(t,n,r,o[3*h],o[3*h+1],o[3*h+2])>=e)return!0}return!1}function y(e,t,n,r,i,a,o,l,c,u,h,d,f,p,m,g,y,_,b,E,w,x){if(s(h,d,f,p,m,g)>o)return!1;for(var T=r[c],A=i[c],M=r[u],S=i[u],R=.5*(h+p),k=.5*(d+m),P=.5*(f+g),L=0,C=0,I=0;L<A&&C<S;){var N=a[L+T],F=a[C+M];if(N===F){if(++I>2)return!1;L+=1,C+=1}else N<F?L+=1:C+=1}if(v(l,R,k,P,T,A,e,a,n)||v(l,R,k,P,M,S,e,a,n))return!1;var O=.5*(y+E),H=.5*(_+w),D=.5*(b+x),U=Math.pow(O,2)+Math.pow(H,2)+Math.pow(D,2);if(U<.1)return!1;var B=0|Math.min(c,u);return n[c]=n[u]=B,e[3*B]=R,e[3*B+1]=k,e[3*B+2]=P,U=1/Math.sqrt(U),t[3*B]=O*U,t[3*B+1]=H*U,t[3*B+2]=D*U,!0}function _(e,t,n,i,a){for(var o=0|e.numCells,s=e.cells,l=0|e.numVerts,c=e.verts,u=e.normals,h=r.mallocInt32(l),d=r.mallocInt32(l),f=r.mallocInt32(6*o),p=0;p<i;++p){g(o,s,l,d,h,f);for(var m=r.mallocInt32(l),v=0;v<l;++v)m[v]=-1;var _=0;for(v=0;v<o;++v){var b=s[3*v],E=s[3*v+1],w=s[3*v+2],x=m[b],T=m[E],A=m[w];if(!(x>=0||T>=0||A>=0)){var M=c[3*b],S=c[3*b+1],R=c[3*b+2],k=c[3*E],P=c[3*E+1],L=c[3*E+2],C=c[3*w],I=c[3*w+1],N=c[3*w+2],F=u[3*b],O=u[3*b+1],H=u[3*b+2],D=u[3*E],U=u[3*E+1],B=u[3*E+2],z=u[3*w],V=u[3*w+1],j=u[3*w+2];(y(c,u,m,h,d,f,t,n,b,E,M,S,R,k,P,L,F,O,H,D,U,B)||y(c,u,m,h,d,f,t,n,E,w,k,P,L,C,I,N,D,U,B,z,V,j)||y(c,u,m,h,d,f,t,n,w,b,C,I,N,M,S,R,z,V,j,F,O,H))&&(_+=1)}}if(_<a)break;var G=0;for(v=0;v<l;++v){var W=m[v];W<0||W===v?d[v]>0&&(m[v]=G,c[3*G]=c[3*v],c[3*G+1]=c[3*v+1],c[3*G+2]=c[3*v+2],u[3*G]=u[3*v],u[3*G+1]=u[3*v+1],u[3*G+2]=u[3*v+2],G+=1):m[v]=m[W]}var q=0;for(v=0;v<o;++v){b=m[s[3*v]],E=m[s[3*v+1]],w=m[s[3*v+2]];b!==E&&E!==w&&w!==b&&(s[3*q]=b,s[3*q+1]=E,s[3*q+2]=w,q+=1)}e.numVerts=l=G,e.numCells=o=q}return r.free(m),r.free(d),r.free(h),r.free(f),p>0}function b(e,t,n){var o=e.numCells,s=e.cells,l=e.numVerts,c=r.mallocInt32(6*o),u=r.mallocInt32(2*l);!function(e,t,n,o,s){for(var l=0;l<o;++l)s[l]=0;for(l=0;l<3*e;++l)n[l]=-1;var c=3*e,u=r.mallocInt32(3*c),h=0;for(l=0;l<e;++l){var d=t[3*l],f=t[3*l+1],p=t[3*l+2];u[h++]=0|Math.min(d,f),u[h++]=0|Math.max(d,f),u[h++]=4*l+2,u[h++]=0|Math.min(f,p),u[h++]=0|Math.max(f,p),u[h++]=4*l,u[h++]=0|Math.min(p,d),u[h++]=0|Math.max(p,d),u[h++]=4*l+1}var m=h/3|0;a(i(u,[m,3],[3,1],0));var g=-1,v=-1,y=-1;for(l=0;l<m;++l){d=u[3*l],f=u[3*l+1];var _=u[3*l+2];if(d===g&&f===v){var b=y>>2,E=3&y;n[3*(_>>2)+(3&_)]=y,n[3*b+E]=_}else g>=0&&(s[g]+=1,s[v]+=1);g=d,v=f,y=_}g>=0&&(s[g]+=1,s[v]+=1),r.free(u)}(o,s,c,l,u);for(var h=0;h<t;++h){for(var d=0,f=0;f<o;++f){var p=s[3*f],m=s[3*f+1],g=s[3*f+2],v=c[3*f],y=c[3*f+1],_=c[3*f+2],b=u[p],E=u[m],w=u[g],x=6,T=6,A=6;v<0&&(T=A=4),y<0&&(A=x=4),_<0&&(T=x=4);var M=0|Math.abs(b-x+1),S=0|Math.abs(b-x),R=0|Math.abs(b-x-1),k=0|Math.abs(E-T+1),P=0|Math.abs(E-T),L=0|Math.abs(E-T-1),C=0|Math.abs(w-A+1),I=0|Math.abs(w-A),N=0|Math.abs(w-A-1);if(v>=0){var F=u[V=s[3*(B=v>>2)+(z=3&v)]],O=(s[j=3*B+(z+1)%3],c[j]),H=c[3*B+(z+2)%3];if(s[j]===m){var D=O;O=H,H=D}var U=6;if((H<0||O<0)&&(U=4),M+L+N+(0|Math.abs(F-U+1))<S+P+I+(0|Math.abs(F-U))){s[3*f]=p,s[3*f+1]=m,s[3*f+2]=V,c[3*f]=O,c[3*f+1]=4*B+2,c[3*f+2]=_,O>=0&&(c[3*(O>>2)+(3&O)]=4*f),_>=0&&(c[3*(_>>2)+(3&_)]=4*f+2),s[3*B]=p,s[3*B+1]=V,s[3*B+2]=g,c[3*B]=H,c[3*B+1]=y,c[3*B+2]=4*f+1,H>=0&&(c[3*(H>>2)+(3&H)]=4*B),y>=0&&(c[3*(y>>2)+(3&y)]=4*B+1),u[p]+=1,u[m]-=1,u[g]-=1,u[V]+=1,d+=1;continue}}if(y>=0){F=u[V=s[3*(B=y>>2)+(z=3&y)]],s[j=3*B+(z+1)%3],O=c[j],H=c[3*B+(z+2)%3];if(s[j]===g){D=O;O=H,H=D}U=6;if((O<0||H<0)&&(U=4),R+k+N+(0|Math.abs(F-U+1))<S+P+I+(0|Math.abs(F-U))){s[3*f]=m,s[3*f+1]=g,s[3*f+2]=V,c[3*f]=O,c[3*f+1]=4*B+2,c[3*f+2]=v,O>=0&&(c[3*(O>>2)+(3&O)]=4*f),v>=0&&(c[3*(v>>2)+(3&v)]=4*f+2),s[3*B]=m,s[3*B+1]=V,s[3*B+2]=p,c[3*B]=H,c[3*B+1]=_,c[3*B+2]=4*f+1,H>=0&&(c[3*(H>>2)+(3&H)]=4*B),_>=0&&(c[3*(_>>2)+(3&_)]=4*B+1),u[p]-=1,u[m]+=1,u[g]-=1,u[V]+=1,d+=1;continue}}if(_>=0){var B,z,V,j;F=u[V=s[3*(B=_>>2)+(z=3&_)]],s[j=3*B+(z+1)%3],O=c[j],H=c[3*B+(z+2)%3];if(s[j]===p){D=O;O=H,H=D}U=6;if((O<0||H<0)&&(U=4),R+L+C+(0|Math.abs(F-U+1))<S+P+I+(0|Math.abs(F-U))){s[3*f]=g,s[3*f+1]=p,s[3*f+2]=V,c[3*f]=O,c[3*f+1]=4*B+2,c[3*f+2]=y,O>=0&&(c[3*(O>>2)+(3&O)]=4*f),y>=0&&(c[3*(y>>2)+(3&y)]=4*f+2),s[3*B]=g,s[3*B+1]=V,s[3*B+2]=m,c[3*B]=H,c[3*B+1]=v,c[3*B+2]=4*f+1,H>=0&&(c[3*(H>>2)+(3&H)]=4*B),v>=0&&(c[3*(v>>2)+(3&v)]=4*B+1),u[p]-=1,u[m]-=1,u[g]+=1,u[V]+=1,d+=1;continue}}}if(d<n)break}return r.free(u),r.free(c),h>0}function E(e,t,n,i){for(var a=e.numCells,o=e.cells,s=e.numVerts,l=e.verts,c=e.normals,u=r.mallocFloat32(4*s),h=0;h<n;++h){for(var d=0;d<4*s;++d)u[d]=0;for(d=0;d<a;++d){var f=o[3*d],p=o[3*d+1],m=o[3*d+2],g=l[3*f],v=l[3*f+1],y=l[3*f+2],_=l[3*p],b=l[3*p+1],E=l[3*p+2],w=g+_+l[3*m],x=v+b+l[3*m+1],T=y+E+l[3*m+2];u[4*f]+=w,u[4*f+1]+=x,u[4*f+2]+=T,u[4*f+3]+=1,u[4*p]+=w,u[4*p+1]+=x,u[4*p+2]+=T,u[4*p+3]+=1,u[4*m]+=w,u[4*m+1]+=x,u[4*m+2]+=T,u[4*m+3]+=1}var A=0;for(d=0;d<s;++d){w=l[3*d],x=l[3*d+1],T=l[3*d+2];var M=u[4*d],S=u[4*d+1],R=u[4*d+2],k=u[4*d+3];M*=k=1/(3*k),S*=k,R*=k;var P=c[3*d],L=c[3*d+1],C=c[3*d+2],I=M-w,N=S-x,F=R-T,O=P*I+L*N+C*F,H=l[3*d]=w+t*(I-O*P),D=l[3*d+1]=x+t*(N-O*L),U=l[3*d+2]=T+t*(F-O*C);A=Math.max(A,Math.pow(H-w,2)+Math.pow(D-x,2)+Math.pow(U-T,2))}if(A<i)break}return r.free(u),h>0}function w(e,t){var n=(t=t||{}).edgeLength||function(e){for(var t=e.numCells,n=e.cells,o=e.verts,l=r.mallocFloat32(3*t),c=0;c<t;++c){var u=n[3*c],h=n[3*c+1],d=n[3*c+2],f=o[3*u],p=o[3*u+1],m=o[3*u+2],g=o[3*h],v=o[3*h+1],y=o[3*h+2],_=o[3*d],b=o[3*d+1],E=o[3*d+2];l[3*c]=s(f,p,m,g,v,y),l[3*c+1]=s(g,v,y,_,b,E),l[3*c+2]=s(_,b,E,f,p,m)}a(i(l));var w=l[l.length>>1];return r.free(l),Math.sqrt(w)}(e),o=t.smoothRate||.95;o=Math.max(Math.min(o,1),.001);for(var l=Math.pow(1.25*n,2),c=Math.pow(.75*n,2),u=t.maxIters||5,h=t.splitIters||10,d=t.collapseIters||10,f=t.flipIters||10,p=t.smoothIters||20,g=0|Math.max(t.minSplit||0,0),v=0|Math.max(t.minCollapse||0,0),y=0|Math.max(t.minFlip||0,0),w=Math.pow(Math.max(t.minSmooth||.05*n/o,0),2),x=!0,T=0;x&&T<u;++T)x=!1,x=m(e,l,h,g)||x,x=_(e,c,l,d,v)||x,x=b(e,f,y)||x,x=E(e,o,p,w)||x}},3859:(e,t,n)=>{"use strict";var r=n(4948);t.compareCoord=r.compareCoord,t.saturateAbs=r.saturateAbs,t.EPSILON=r.EPSILON,t.POSITIVE_INFINITY=r.POSITIVE_INFINITY,t.NEGATIVE_INFINITY=r.NEGATIVE_INFINITY;var i=n(1828);t.DynamicVolume=i.DynamicVolume,t.StaticVolume=i.StaticVolume;var a=n(2552);t.StencilIterator=a.StencilIterator,t.beginStencil=a.beginStencil;var o=n(5251);t.MultiIterator=o.MultiIterator,t.beginMulti=o.beginMulti},5518:(e,t,n)=>{"use strict";var r=n(3859),i=r.POSITIVE_INFINITY,a=r.NEGATIVE_INFINITY;function o(e){return!!e}e.exports=function(e,t){var n,r,s=[i,i,i],l=[a,a,a],c=e.length(),u=e.coords,h=e.phases;for(t||(t=o),n=0;n<c-1;++n)if(t(h[n]))for(r=0;r<3;++r)s[r]=Math.min(u[r][n],s[r]),l[r]=Math.max(u[r][n],l[r]);for(r=0;r<3;++r)--s[r],++l[r];return[s,l]}},8596:(e,t,n)=>{"use strict";var r=n(3859),i=n(3982),a=r.NEGATIVE_INFINITY,o=r.POSITIVE_INFINITY,s=r.EPSILON,l=i.CUBE_STENCIL,c=r.compareCoord,u=r.beginStencil,h=new Int32Array([6,5,3,0,0,0,1,1,2,2,4,4]),d=new Int32Array([7,7,7,1,2,4,3,5,3,6,5,6]),f=new Int32Array([0,1,2,0,1,2,1,2,0,2,0,1]),p=new Int16Array(256);!function(){for(var e=0;e<256;++e)for(var t=0,n=0;n<12;++n){!(e&1<<h[n])!=!(e&1<<d[n])&&(t|=1<<n),p[e]=t}}();var m=new Function("phase","return !!phase;");e.exports=function(e,t,n,r){var i,g;t?i instanceof Int32Array||(i=new Int32Array(t)):(i=new Int32Array(3))[0]=i[1]=i[2]=a,n?g instanceof Int32Array||(g=new Int32Array(n)):(g=new Int32Array(3))[0]=g[1]=g[2]=o,r||(r=m);var v=[],y=[],_=[],b=e.distances,E=e.phases,w=new Float64Array(8),x=new Int32Array(8),T=new Int32Array(8),A=u(e,l);A.seek(i);e:for(;A.hasNext();A.next()){var M=A.coord;if(c(g,M)<=0)break;for(var S=0;S<3;++S)if(M[S]<i[S]||M[S]>=g[S])continue e;var R=A.ptrs,k=0;for(S=0;S<8;++S){var P=R[S];w[S]=b[P];var L=E[P];x[S]=L,k|=r(E[R[S]])?0:1<<S}if(0!==k&&255!==k){var C=p[k],I=[0,0,0],N=0;for(S=0;S<12;++S)if(0!=(C&1<<S)){for(var F=h[S],O=d[S],H=f[S],D=w[F],U=w[O],B=0;B<3;++B)F&1<<B&&(I[B]-=1-s);I[H]-=Math.min(1-s,Math.max(s,D/(D+U))),++N}var z=1/N;for(S=0;S<3;++S)I[S]=M[S]+I[S]*z;v.push(I);t:for(S=0;S<8;++S)for(;;){if(T[S]>=v.length-1)continue t;var V=v[T[S]+1];for(B=2;B>=0;--B){var j=(0|Math.ceil(V[B]))-M[B]+(S&1<<B?1:0);if(j)break}if(j<=0&&++T[S],j>=0)break}for(S=0;S<3;++S)if(M[S]<=i[S])continue e;var G=x[7];for(S=0;S<3;++S)if(C&1<<S){var W=x[7^1<<S],q=1<<(S+1)%3,X=1<<(S+2)%3;128&k?(_.push([W,G]),_.push([W,G]),y.push([T[0],T[q],T[X]]),y.push([T[X],T[q],T[q+X]])):(_.push([G,W]),_.push([G,W]),y.push([T[0],T[X],T[q]]),y.push([T[q],T[X],T[q+X]]))}}}return{positions:v,cells:y,phases:_}}},2952:(e,t,n)=>{"use strict";var r=n(2917),i=n(3859),a=n(7898),o=n(5518);t.A=function(e,t){t||(t=o(e));var n,i,a=[0,0,0],s=e.length(),l=1,c=[0,0,0];for(n=0;n<3;++n)a[n]=t[1][n]-t[0][n]|0,c[n]=l,l*=a[n];var u,h,d,f,p,m,g=r(new Int32Array(l),a,c,0),v=r(new Float32Array(l),a,c,0),y=l,_=e.coords[0],b=e.coords[1],E=e.coords[2],w=e.phases,x=e.distances,T=0|t[0][0],A=0|t[0][1],M=0|t[0][2];for(n=s-1;n>=0;--n)if(m=y,u=_[n]-T|0,h=b[n]-A|0,!((d=E[n]-M|0)<0||d>=a[2]))for(h<0?u=h=0:h>=a[1]?(u=a[0]-1,h=a[1]-1):u<0?u=0:u>=a[0]&&(u=a[0]-1),y=u+a[0]*(h+a[1]*d),p=x[n],f=w[n],i=m-1;i>=y;--i)g.data[i]=f,v.data[i]=p;return{phase:g,distance:v}}},1844:(e,t,n)=>{"use strict";var r=n(6195),i=n(3794),a=n(3114),o=n(3859),s=n(7898),l=new Function("a","b",["for(var i=2; i>=0; --i) {","var d = a[i]-b[i];","if(d) return d;","}","return 0;"].join("\n"));e.exports=function(e,t,n){e.cells&&(n=e.faceNormals,t=e.positions,e=e.cells);var c=r(e,t,1),u=(n=n||i.faceNormals(c.cells,c.positions),[]);for(var h in c.grid){var d=c.grid[h].coord,f=a(c,n,d);isNaN(f)||Math.abs(f)>1||(f<0?u.push([d[0],d[1],d[2],1,-f]):u.push([d[0],d[1],d[2],0,f]))}u.sort(l);var p=new Array(u.length+1),m=new Array(u.length+1),g=new Array(u.length+1),v=new Array(u.length+1),y=new Array(u.length+1);p[0]=m[0]=g[0]=o.NEGATIVE_INFINITY,v[0]=0,y[0]=1;for(var _=0;_<u.length;++_){var b=u[_];p[_+1]=b[0],m[_+1]=b[1],g[_+1]=b[2],v[_+1]=b[3],y[_+1]=b[4]}return s.removeDuplicates(new o.DynamicVolume([p,m,g],y,v))}},7898:(e,t,n)=>{"use strict";var r=n(3859),i=n(3982).CROSS_STENCIL,a=r.beginStencil;function o(e,t){for(var n=t[0],r=0;r<t.length;++r)for(var i=t[r]+1,a=r<t.length-1?t[r+1]:e.length,o=i;o<a;++o)e[n++]=e[o];e.length=e.length-t.length}t.resort=function(e){for(var t=e.coords,n=e.phases,r=e.distances,i=(e.length(),new Array(e.length)),a=0;a<e.length();++a)i[a]=[t[0][a],t[1][a],t[2][a],r[a],n[a]];i.sort(rle.compareCoord);for(a=0;a<e.length;++a){var o=i[a];t[0][a]=o[0],t[1][a]=o[1],t[2][a]=o[2],r[a]=o[3],n[a]=o[4]}return e},t.resurface=function(e){return e},t.removeDuplicates=function(e){var t=[],n=e.coords,r=e.distances,s=e.phases,l=a(e,i),c=l.coord,u=l.ptrs;l.next();e:for(;l.hasNext();l.next()){for(var h=l.ptrs[0],d=0;d<3;++d)if(c[d]!==n[d][h])continue e;var f=s[h];for(d=1;d<7;++d)if(f!==s[u[d]])continue e;t.push(h)}if(t.length>0){for(d=0;d<3;++d)o(n[d],t);o(r,t),o(s,t)}return e},t.fullRepair=function(e){t.resort(e),t.resurface(e),t.removeDuplicates(e)}},1471:(e,t,n)=>{"use strict";var r=n(3859),i=new Function("return 1.0");function a(e,t,n,a){a||(a=i);var o=new r.DynamicVolume,s=new Int32Array(3),l=new Int32Array(3);for(s[2]=e[2];s[2]<t[2];++s[2])for(s[1]=e[1];s[1]<t[1];++s[1])for(s[0]=e[0];s[0]<t[0];++s[0]){var c=n(s);l[0]=s[0],l[1]=s[1],l[2]=s[2];e:for(var u=0;u<3;++u)for(var h=-1;h<=1;h+=2){if(l[u]+=h,c!==n(l)){o.push(s[0],s[1],s[2],r.saturateAbs(a(s)),c);break e}l[u]=s[u]}}return o}t.dense=a;var o=new Function("x","return x.join('|');");function s(e,t,n,a,s){s=s||i;var l={},c=[];e:for(var u=0;u<n.length;++u)for(var h=a(g=n[u]),d=0;d<3;++d)for(var f=-1;f<=2;f+=2){var p=g[d];g[d]+=f;var m=a(g);if(g[d]=p,m!==h){c.push([g[0],g[1],g[2],s(g),a(g)]),l[o(g)]=!0;continue e}}for(var g=[0,0,0],v=0;v<c.length;++v){var y=c[v];for(d=0;d<3;++d)e:for(f=-1;f<=1;f+=2){for(u=0;u<3;++u)g[u]=y[u];g[d]+=f;for(u=0;u<3;++u)if(g[u]<e[u]||g[u]>=t[u])continue e;var _=o(g);if(!l[_]){var b=a(g);t:for(var E=0;E<3;++E)for(p=-1;p<=1;++p){g[E]+=p;var w=a(g);if(g[E]-=p,w!==b){c.push([g[0],g[1],g[2],r.saturateAbs(s(g)),b]);break t}}l[_]=!0}}}c.sort(r.compareCoord);var x=new Array(c.length+1),T=new Array(c.length+1),A=new Array(c.length+1),M=new Array(c.length+1),S=new Array(c.length+1);x[0]=T[0]=A[0]=r.NEGATIVE_INFINITY,M[0]=1,S[0]=0;for(u=0;u<c.length;++u){var R=c[u];x[u+1]=R[0],T[u+1]=R[1],A[u+1]=R[2],M[u+1]=R[3],S[u+1]=R[4]}return new r.DynamicVolume([x,T,A],M,S)}function l(e,t,n,r,a){n instanceof Array||(n=[n,n,n]),a=a||i;var o=[],l=[0,0,0];for(l[0]=e[0]+n[0];l[0]<t[0];l[0]+=n[0])for(l[1]=e[1]+n[1];l[1]<t[1];l[1]+=n[1])for(l[2]=e[2]+n[2];l[2]<t[2];l[2]+=n[2])for(var c=r(l),u=0;u<3;++u){var h=l[u];l[u]-=n[u];var d=r(l[u]);if(c!==d){for(var f=l[u],p=l[u]+n[u];f<p;)l[u]=f+p>>1,r(l[u])===d?f=l[u]+1:p=l[u]-1;o.push(l.slice(0))}l[u]=h}return s(e,t,o,r,a)}t.marching=s,t.adaptive=l;var c=new Function("dist_func","x","return dist_func(x) <= 0 ? 1 : 0;");function u(e){return c.bind(null,e)}t.solid={dense:function(e,t,n){return a(e,t,u(n),n)},marching:function(e,t,n,r){return s(e,t,n,u(r),r)},adaptive:function(e,t,n,r){return l(e,t,n,u(r),r)}}},3982:(e,t)=>{function n(e){for(var t=[],n=Math.ceil(e),r=-n;r<=n;++r)for(var i=-n;i<=n;++i)for(var a=-n;a<=n;++a)t.push(r),t.push(i),t.push(a);return new Int32Array(t)}function r(e,t){if(e===Number.POSITIVE_INFINITY)return n(t);for(var r=[],i=0|Math.ceil(t),a=Math.pow(t,e),o=-i;o<=i;++o)for(var s=-i;s<=i;++s)for(var l=-i;l<=i;++l)Math.pow(Math.abs(o),e)+Math.pow(Math.abs(s),e)+Math.pow(Math.abs(l),e)<=a&&(r.push(o),r.push(s),r.push(l));return r}var i,a;!function(){for(var e=[],t=0;t<8;++t){for(var n=[0,0,0],r=0;r<3;++r)0!=(t&1<<r)&&(n[r]=-1);e.push(n[0]),e.push(n[1]),e.push(n[2])}i=new Int32Array(e)}(),function(){for(var e=[0,0,0],t=0;t<3;++t)for(var n=-1;n<=1;n+=2)e.push(0===t?n:0),e.push(1===t?n:0),e.push(2===t?n:0);a=new Int32Array(e)}(),t.lp=r,t.moore=n,t.vonNeumann=r.bind(null,1),t.ball=r.bind(null,2),t.CROSS_STENCIL=a,t.CUBE_STENCIL=i},1341:e=>{"use strict";e.exports=function(e){for(var t=e.length,n=e[e.length-1],r=t,i=t-2;i>=0;--i){var a=n,o=e[i];(l=o-((n=a+o)-a))&&(e[--r]=n,n=l)}var s=0;for(i=r;i<t;++i){var l;a=e[i];(l=(o=n)-((n=a+o)-a))&&(e[s++]=l)}return e[s++]=n,e.length=s,e}},5308:(e,t,n)=>{"use strict";var r=n(7258),i=n(92),a=n(9388),o=n(1341);function s(e,t){for(var n=new Array(e.length-1),r=1;r<e.length;++r)for(var i=n[r-1]=new Array(e.length-1),a=0,o=0;a<e.length;++a)a!==t&&(i[o++]=e[r][a]);return n}function l(e){for(var t=new Array(e),n=0;n<e;++n){t[n]=new Array(e);for(var r=0;r<e;++r)t[n][r]=["m[",n,"][",r,"]"].join("")}return t}function c(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var t=e.length>>1;return["sum(",c(e.slice(0,t)),",",c(e.slice(t)),")"].join("")}function u(e){if(2===e.length)return["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("");for(var t=[],n=0;n<e.length;++n)t.push(["scale(",u(s(e,n)),",",(r=n,1&r?"-":""),e[0][n],")"].join(""));return c(t);var r}function h(e){return new Function("sum","scale","prod","compress",["function robustDeterminant",e,"(m){return compress(",u(l(e)),")};return robustDeterminant",e].join(""))(i,a,r,o)}var d=[function(){return[0]},function(e){return[e[0][0]]}];!function(){for(;d.length<6;)d.push(h(d.length));for(var t=[],n=["function robustDeterminant(m){switch(m.length){"],r=0;r<6;++r)t.push("det"+r),n.push("case ",r,":return det",r,"(m);");n.push("}var det=CACHE[m.length];if(!det)det=CACHE[m.length]=gen(m.length);return det(m);}return robustDeterminant"),t.push("CACHE","gen",n.join(""));var i=Function.apply(void 0,t);for(e.exports=i.apply(void 0,d.concat([d,h])),r=0;r<d.length;++r)e.exports[r]=d[r]}()},4857:(e,t,n)=>{"use strict";var r=n(5308);function i(e){for(var t="robustLinearSolve"+e+"d",n=["function ",t,"(A,b){return ["],i=0;i<e;++i){n.push("det([");for(var a=0;a<e;++a){a>0&&n.push(","),n.push("[");for(var o=0;o<e;++o)o>0&&n.push(","),o===i?n.push("+b[",a,"]"):n.push("+A[",a,"][",o,"]");n.push("]")}n.push("]),")}n.push("det(A)]}return ",t);var s=new Function("det",n.join(""));return s(e<6?r[e]:r)}var a=[function(){return[[0]]},function(e,t){return[[t[0]],[e[0][0]]]}];!function(){for(;a.length<6;)a.push(i(a.length));for(var t=[],n=["function dispatchLinearSolve(A,b){switch(A.length){"],r=0;r<6;++r)t.push("s"+r),n.push("case ",r,":return s",r,"(A,b);");n.push("}var s=CACHE[A.length];if(!s)s=CACHE[A.length]=g(A.length);return s(A,b)}return dispatchLinearSolve"),t.push("CACHE","g",n.join(""));var o=Function.apply(void 0,t);for(e.exports=o.apply(void 0,a.concat([a,i])),r=0;r<6;++r)e.exports[r]=a[r]}()},6651:(e,t,n)=>{"use strict";var r=n(7258),i=n(92),a=n(9388),o=n(865);function s(e,t){for(var n=new Array(e.length-1),r=1;r<e.length;++r)for(var i=n[r-1]=new Array(e.length-1),a=0,o=0;a<e.length;++a)a!==t&&(i[o++]=e[r][a]);return n}function l(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var t=e.length>>1;return["sum(",l(e.slice(0,t)),",",l(e.slice(t)),")"].join("")}function c(e){if(2===e.length)return[["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("")];for(var t=[],n=0;n<e.length;++n)t.push(["scale(",l(c(s(e,n))),",",(r=n,1&r?"-":""),e[0][n],")"].join(""));return t;var r}function u(e){for(var t=[],n=[],u=function(e){for(var t=new Array(e),n=0;n<e;++n){t[n]=new Array(e);for(var r=0;r<e;++r)t[n][r]=["m",r,"[",e-n-1,"]"].join("")}return t}(e),h=[],d=0;d<e;++d)0==(1&d)?t.push.apply(t,c(s(u,d))):n.push.apply(n,c(s(u,d))),h.push("m"+d);var f=l(t),p=l(n),m="orientation"+e+"Exact",g=["function ",m,"(",h.join(),"){var p=",f,",n=",p,",d=sub(p,n);return d[d.length-1];};return ",m].join("");return new Function("sum","prod","scale","sub",g)(i,r,a,o)}var h=u(3),d=u(4),f=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,n){var r,i=(e[1]-n[1])*(t[0]-n[0]),a=(e[0]-n[0])*(t[1]-n[1]),o=i-a;if(i>0){if(a<=0)return o;r=i+a}else{if(!(i<0))return o;if(a>=0)return o;r=-(i+a)}var s=33306690738754716e-32*r;return o>=s||o<=-s?o:h(e,t,n)},function(e,t,n,r){var i=e[0]-r[0],a=t[0]-r[0],o=n[0]-r[0],s=e[1]-r[1],l=t[1]-r[1],c=n[1]-r[1],u=e[2]-r[2],h=t[2]-r[2],f=n[2]-r[2],p=a*c,m=o*l,g=o*s,v=i*c,y=i*l,_=a*s,b=u*(p-m)+h*(g-v)+f*(y-_),E=7771561172376103e-31*((Math.abs(p)+Math.abs(m))*Math.abs(u)+(Math.abs(g)+Math.abs(v))*Math.abs(h)+(Math.abs(y)+Math.abs(_))*Math.abs(f));return b>E||-b>E?b:d(e,t,n,r)}];function p(e){var t=f[e.length];return t||(t=f[e.length]=u(e.length)),t.apply(void 0,e)}!function(){for(;f.length<=5;)f.push(u(f.length));for(var t=[],n=["slow"],r=0;r<=5;++r)t.push("a"+r),n.push("o"+r);var i=["function getOrientation(",t.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(r=2;r<=5;++r)i.push("case ",r,":return o",r,"(",t.slice(0,r).join(),");");i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),n.push(i.join(""));var a=Function.apply(void 0,n);for(e.exports=a.apply(void 0,[p].concat(f)),r=0;r<=5;++r)e.exports[r]=f[r]}()},8371:(e,t,n)=>{e.exports=function(e,t){for(var n=t[0],i=t[1],a=e.length,o=1,s=a,l=0,c=a-1;l<s;c=l++){var u=e[l],h=e[c],d=u[1],f=h[1];if(f<d){if(f<i&&i<d){if(0===(g=r(u,h,t)))return 0;o^=0<g|0}else if(i===d){var p=(m=e[(l+1)%a])[1];if(d<p){if(0===(g=r(u,h,t)))return 0;o^=0<g|0}}}else if(d<f){if(d<i&&i<f){if(0===(g=r(u,h,t)))return 0;o^=g<0|0}else if(i===d){var m=e[(l+1)%a];if((p=m[1])<d){var g;if(0===(g=r(u,h,t)))return 0;o^=g<0|0}}}else if(i===d){var v=Math.min(u[0],h[0]),y=Math.max(u[0],h[0]);if(0===l){for(;c>0;){var _=(c+a-1)%a;if((w=e[_])[1]!==i)break;var b=w[0];v=Math.min(v,b),y=Math.max(y,b),c=_}if(0===c)return v<=n&&n<=y?0:1;s=c+1}for(var E=e[(c+a-1)%a][1];l+1<s;){var w;if((w=e[l+1])[1]!==i)break;b=w[0];v=Math.min(v,b),y=Math.max(y,b),l+=1}if(v<=n&&n<=y)return 0;var x=e[(l+1)%a][1];n<v&&E<i!=x<i&&(o^=1)}}return 2*o-1};var r=n(6651)},9388:(e,t,n)=>{"use strict";var r=n(7258),i=n(9553);e.exports=function(e,t){var n=e.length;if(1===n){var a=r(e[0],t);return a[0]?a:[a[1]]}var o=new Array(2*n),s=[.1,.1],l=[.1,.1],c=0;r(e[0],t,s),s[0]&&(o[c++]=s[0]);for(var u=1;u<n;++u){r(e[u],t,l);var h=s[1];i(h,l[0],s),s[0]&&(o[c++]=s[0]);var d=l[1],f=s[1],p=d+f,m=f-(p-d);s[1]=p,m&&(o[c++]=m)}s[1]&&(o[c++]=s[1]);0===c&&(o[c++]=0);return o.length=c,o}},865:e=>{"use strict";e.exports=function(e,t){var n=0|e.length,r=0|t.length;if(1===n&&1===r)return function(e,t){var n=e+t,r=n-e,i=e-(n-r)+(t-r);if(i)return[i,n];return[n]}(e[0],-t[0]);var i,a,o=new Array(n+r),s=0,l=0,c=0,u=Math.abs,h=e[l],d=u(h),f=-t[c],p=u(f);d<p?(a=h,(l+=1)<n&&(h=e[l],d=u(h))):(a=f,(c+=1)<r&&(f=-t[c],p=u(f)));l<n&&d<p||c>=r?(i=h,(l+=1)<n&&(h=e[l],d=u(h))):(i=f,(c+=1)<r&&(f=-t[c],p=u(f)));var m,g,v=i+a,y=v-i,_=a-y,b=_,E=v;for(;l<n&&c<r;)d<p?(i=h,(l+=1)<n&&(h=e[l],d=u(h))):(i=f,(c+=1)<r&&(f=-t[c],p=u(f))),(_=(a=b)-(y=(v=i+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m;for(;l<n;)(_=(a=b)-(y=(v=(i=h)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(l+=1)<n&&(h=e[l]);for(;c<r;)(_=(a=b)-(y=(v=(i=f)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(c+=1)<r&&(f=-t[c]);b&&(o[s++]=b);E&&(o[s++]=E);s||(o[s++]=0);return o.length=s,o}},92:e=>{"use strict";e.exports=function(e,t){var n=0|e.length,r=0|t.length;if(1===n&&1===r)return function(e,t){var n=e+t,r=n-e,i=e-(n-r)+(t-r);if(i)return[i,n];return[n]}(e[0],t[0]);var i,a,o=new Array(n+r),s=0,l=0,c=0,u=Math.abs,h=e[l],d=u(h),f=t[c],p=u(f);d<p?(a=h,(l+=1)<n&&(h=e[l],d=u(h))):(a=f,(c+=1)<r&&(f=t[c],p=u(f)));l<n&&d<p||c>=r?(i=h,(l+=1)<n&&(h=e[l],d=u(h))):(i=f,(c+=1)<r&&(f=t[c],p=u(f)));var m,g,v=i+a,y=v-i,_=a-y,b=_,E=v;for(;l<n&&c<r;)d<p?(i=h,(l+=1)<n&&(h=e[l],d=u(h))):(i=f,(c+=1)<r&&(f=t[c],p=u(f))),(_=(a=b)-(y=(v=i+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m;for(;l<n;)(_=(a=b)-(y=(v=(i=h)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(l+=1)<n&&(h=e[l]);for(;c<r;)(_=(a=b)-(y=(v=(i=f)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(c+=1)<r&&(f=t[c]);b&&(o[s++]=b);E&&(o[s++]=E);s||(o[s++]=0);return o.length=s,o}},3114:(e,t,n)=>{n(6047);e.exports=function(e,t,n){var r=e.closestCells(n);if(!r)return Number.NaN;if(r.distance<1e-6)return 0;for(var i=0,a=!1,o=r.cells,s=r.points,l=0;l<o.length;++l){for(var c=0,u=0,h=s[l],d=t[o[l]],f=0;f<n.length;++f){var p=h[f]-n[f];c+=p*p,u+=d[f]*p}(u/=Math.sqrt(c))<0?(u=-u)>i&&(i=u,a=!0):u>i&&(i=u,a=!1)}var m=Math.sqrt(r.distance);return a?m:-m}},8979:(e,t,n)=>{"use strict";e.exports=function(e){return i(r(e))};var r=n(4966),i=n(4726)},8966:(e,t,n)=>{"use strict";var r=n(19),i=n(4010);function a(e,t){var n=e.length,r=e.length-t.length,i=Math.min;if(r)return r;switch(n){case 0:return 0;case 1:return e[0]-t[0];case 2:return(s=e[0]+e[1]-t[0]-t[1])||i(e[0],e[1])-i(t[0],t[1]);case 3:var a=e[0]+e[1],o=t[0]+t[1];if(s=a+e[2]-(o+t[2]))return s;var s,l=i(e[0],e[1]),c=i(t[0],t[1]);return(s=i(l,e[2])-i(c,t[2]))||i(l+e[2],a)-i(c+t[2],o);default:var u=e.slice(0);u.sort();var h=t.slice(0);h.sort();for(var d=0;d<n;++d)if(r=u[d]-h[d])return r;return 0}}function o(e,t){return a(e[0],t[0])}function s(e,t){if(t){for(var n=e.length,r=new Array(n),i=0;i<n;++i)r[i]=[e[i],t[i]];r.sort(o);for(i=0;i<n;++i)e[i]=r[i][0],t[i]=r[i][1];return e}return e.sort(a),e}function l(e){if(0===e.length)return[];for(var t=1,n=e.length,r=1;r<n;++r){var i=e[r];if(a(i,e[r-1])){if(r===t){t++;continue}e[t++]=i}}return e.length=t,e}function c(e,t){for(var n=0,r=e.length-1,i=-1;n<=r;){var o=n+r>>1,s=a(e[o],t);s<=0?(0===s&&(i=o),n=o+1):s>0&&(r=o-1)}return i}function u(e,t){for(var n=new Array(e.length),i=0,o=n.length;i<o;++i)n[i]=[];for(var s=[],l=(i=0,t.length);i<l;++i)for(var u=t[i],h=u.length,d=1,f=1<<h;d<f;++d){s.length=r.popCount(d);for(var p=0,m=0;m<h;++m)d&1<<m&&(s[p++]=u[m]);var g=c(e,s);if(!(g<0))for(;n[g++].push(i),!(g>=e.length||0!==a(e[g],s)););}return n}function h(e,t){if(t<0)return[];for(var n=[],i=(1<<t+1)-1,a=0;a<e.length;++a)for(var o=e[a],l=i;l<1<<o.length;l=r.nextCombination(l)){for(var c=new Array(t+1),u=0,h=0;h<o.length;++h)l&1<<h&&(c[u++]=o[h]);n.push(c)}return s(n)}t.dimension=function(e){for(var t=0,n=Math.max,r=0,i=e.length;r<i;++r)t=n(t,e[r].length);return t-1},t.countVertices=function(e){for(var t=-1,n=Math.max,r=0,i=e.length;r<i;++r)for(var a=e[r],o=0,s=a.length;o<s;++o)t=n(t,a[o]);return t+1},t.cloneCells=function(e){for(var t=new Array(e.length),n=0,r=e.length;n<r;++n)t[n]=e[n].slice(0);return t},t.compareCells=a,t.normalize=s,t.unique=l,t.findCell=c,t.incidence=u,t.dual=function(e,t){if(!t)return u(l(h(e,0)),e);for(var n=new Array(t),r=0;r<t;++r)n[r]=[];r=0;for(var i=e.length;r<i;++r)for(var a=e[r],o=0,s=a.length;o<s;++o)n[a[o]].push(r);return n},t.explode=function(e){for(var t=[],n=0,r=e.length;n<r;++n)for(var i=e[n],a=0|i.length,o=1,l=1<<a;o<l;++o){for(var c=[],u=0;u<a;++u)o>>>u&1&&c.push(i[u]);t.push(c)}return s(t)},t.skeleton=h,t.boundary=function(e){for(var t=[],n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,o=i.length;a<o;++a){for(var l=new Array(i.length-1),c=0,u=0;c<o;++c)c!==a&&(l[u++]=i[c]);t.push(l)}return s(t)},t.connectedComponents=function(e,t){return t?function(e,t){for(var n=new i(t),r=0;r<e.length;++r)for(var a=e[r],o=0;o<a.length;++o)for(var s=o+1;s<a.length;++s)n.link(a[o],a[s]);var l=[],c=n.ranks;for(r=0;r<c.length;++r)c[r]=-1;for(r=0;r<e.length;++r){var u=n.find(e[r][0]);c[u]<0?(c[u]=l.length,l.push([e[r].slice(0)])):l[c[u]].push(e[r].slice(0))}return l}(e,t):function(e){for(var t=l(s(h(e,0))),n=new i(t.length),r=0;r<e.length;++r)for(var a=e[r],o=0;o<a.length;++o)for(var u=c(t,[a[o]]),d=o+1;d<a.length;++d)n.link(u,c(t,[a[d]]));var f=[],p=n.ranks;for(r=0;r<p.length;++r)p[r]=-1;for(r=0;r<e.length;++r){var m=n.find(c(t,[e[r][0]]));p[m]<0?(p[m]=f.length,f.push([e[r].slice(0)])):f[p[m]].push(e[r].slice(0))}return f}(e)}},7619:(e,t,n)=>{var r=n(4964);function i(e,t,n){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2))}function a(e,t,n){for(var r=0;r<3;++r)e[r]+=t[r]*n}function o(e){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]=e[n].slice();return t}function s(e,t,n,r,o){var s,l=t.length,c=e.length;for(s=0;s<l;++s){var u=n[s];u[0]=u[1]=u[2]=0}for(s=0;s<l;++s)r[s]=0;for(s=0;s<c;++s){var h=e[s],d=h[0],f=h[1],p=h[2],m=t[d],g=t[f],v=t[p],y=m[0]-g[0],_=m[1]-g[1],b=m[2]-g[2],E=g[0]-v[0],w=g[1]-v[1],x=g[2]-v[2],T=v[0]-m[0],A=v[1]-m[1],M=v[2]-m[2],S=.5*i(_*M-b*A,b*T-y*M,y*A-_*T);if(!(S<1e-8)){var R=-.5/S,k=R*(y*T+_*A+b*M),P=R*(E*y+w*_+x*b),L=R*(T*E+A*w+M*x);r[d]+=P+L,r[f]+=L+k,r[p]+=k+P;var C=n[d],I=n[f],N=n[p];a(I,v,k),a(N,g,k),a(N,m,P),a(C,v,P),a(C,g,L),a(I,m,L)}}for(s=0;s<l;++s)for(var F=n[s],O=t[s],H=r[s],D=0;D<3;++D){var U=O[D];F[D]=U+o*(F[D]/H-U)}}e.exports=function(e,t,n){for(var i=n||{},a=("passBand"in i?+i.passBand:.1),l=("iters"in i?0|i.iters:10),c=r.mallocDouble(t.length),u=o(t),h=o(t),d=a,f=Math.sqrt(d*d- -8),p=(-d+f)/-4,m=(-d-f)/-4,g=Math.max(p,m),v=Math.min(p,m),y=0;y<l;++y)s(e,u,h,c,g),s(e,h,u,c,v);return r.free(c),u}},6195:(e,t,n)=>{"use strict";var r=n(6047),i=n(19),a=n(2624);function o(e,t){this.coord=e,this.cells=t}function s(e,t,n,r){this.cells=e,this.positions=t,this.tolerance=n,this.grid=r}function l(e){switch(e.length){case 0:return 0;case 1:return e[0];case 2:return i.interleave2(e[0],e[1]);case 3:return i.interleave3(e[0],e[1],e[2]);default:return e.join("|")}}function c(e){return e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1)}function u(e){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2)}function h(e,t,n,i,s,c){if(s<0){var u=r.mul(e.tolerance,c),d=a(e.cells[i],e.positions,u);if(isNaN(d)||d>=t.length*e.tolerance*e.tolerance)return;var f=l(c),p=e.grid[f];p?p.cells.push(i):e.grid[f]=new o(c.slice(0),[i])}else for(c[s]=t[s];c[s]<=n[s];++c[s])h(e,t,n,i,s-1,c)}function d(e,t,n,r){var i=t.length;switch(i){case 0:break;case 1:!function(e,t,n,r){for(var i=t[0];i<=n[0];++i)e[i]?e[i].cells.push(r):e[i]=new o([i],[r])}(e,t,n,r);break;case 2:!function(e,t,n,r){for(var i=[0,0],s=2*e.tolerance*e.tolerance,l=t[1];l<=n[1];++l){var u=c(l)<<1;i[1]=l*e.tolerance;for(var h=t[0];h<=n[0];++h){i[0]=f*e.tolerance;var d=a(e.cells[r],e.positions,i);if(!(isNaN(d)||d>=s)){var f=u+c(h),p=e.grid[f];p?p.cells.push(r):e.grid[f]=new o([h,l],[r])}}}}(e,t,n,r);break;case 3:!function(e,t,n,r){for(var i=[0,0,0],s=3*e.tolerance*e.tolerance,l=t[2];l<=n[2];++l){var c=u(l)<<2;i[2]=e.tolerance*l;for(var h=t[1];h<=n[1];++h){var d=c+(u(h)<<1);i[1]=e.tolerance*h;for(var f=t[0];f<=n[0];++f){i[0]=e.tolerance*f;var p=a(e.cells[r],e.positions,i);if(!(isNaN(p)||p>=s)){var m=d+u(f),g=e.grid[m];g?g.cells.push(r):e.grid[m]=new o([f,h,l],[r])}}}}}(e,t,n,r);break;default:h(e,t,n,r,i-1,new Array(i))}}o.prototype.closestCells=function(e,t){for(var n=this.cells,r=Number.POSITIVE_INFINITY,i=[],o=[],s=new Array(t.length),l=0;l<n.length;++l){var c=n[l],u=a(e.cells[c],e.positions,t,s);Math.abs(u-r)<1e-6?(i.push(c),o.push(s.slice(0))):u<r&&(r=u,i.length=1,i[0]=c,o.length=1,o[0]=s.slice(0))}return{points:o,cells:i,distance:r}},o.prototype.neighborhood=function(e,t,n){for(var r=this.cells,i=[],o=n*n,s=0;s<r.length;++s){var l=r[s];a(e.cells[l],e.positions,t)<=o&&i.push(l)}return i},s.prototype.closestCells=function(e){for(var t=this.tolerance,n=new Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]/t);var i=this.grid[l(n)];return i?i.closestCells(this,e):null},s.prototype.neighborhood=function(e,t){for(var n=this.tolerance,r=new Array(e.length),i=0;i<e.length;++i)r[i]=Math.floor(e[i]/n);var a=this.grid[l(r)];return a?a.neighborhood(this,e,t):[]},e.exports=function(e,t,n){for(var r=new s(e,t,n,{}),i=t[0].length,a=new Array(i),o=new Array(i),l=new Array(i),c=new Array(i),u=0;u<e.length;++u){for(var h=e[u],f=0;f<i;++f)a[f]=Number.POSITIVE_INFINITY,l[f]=Number.NEGATIVE_INFINITY;for(var p=0;p<h.length;++p){var m=t[h[p]];for(f=0;f<i;++f)a[f]=Math.min(a[f],m[f]),l[f]=Math.max(l[f],m[f])}for(f=0;f<i;++f)o[f]=Math.floor(a[f]/n)-1,c[f]=Math.ceil(l[f]/n)+1;d(r,o,c,u)}return r}},2552:(e,t,n)=>{"use strict";var r=n(4948),i=r.POSITIVE_INFINITY,a=r.NEGATIVE_INFINITY,o=new Int32Array(128);function s(e,t,n,r,i){this.volume=e,this.stencil=t,this.ptrs=n,this.coord=r,this.frontier=i,3*o.length<t.length&&(o=new Int32Array(t.length/3))}!function(){for(var e=0;e<128;++e)o[e]=0}(),s.prototype.clone=function(){return new s(this.volume,this.stencil,new Int32Array(this.ptrs),new Int32Array(this.coord),new Uint8Array(this.frontier))},s.prototype.hasNext=function(){return this.coord[0]<i},s.prototype.next=function(){for(var e=this.volume.coords,t=this.volume.length(),n=this.frontier,r=this.stencil,a=this.ptrs,s=this.coord,l=0,c=0;c<3;++c)s[c]=i;c=0;e:for(var u=0;c<a.length;++c,u+=3){var h=a[c];if(!(h>=t-1)){h+=1;for(var d=2;d>=0;--d){var f=e[d][h]-r[u+d],p=s[d];if(f<p){for(s[d--]=f;d>=0;--d)s[d]=e[d][h]-r[u+d];l=0;break}if(f>p)continue e}o[l++]=c}}for(c=0;c<a.length;++c)n[c]=0;for(c=0;c<l;++c){var m=o[c];++a[m],n[m]=1}},s.prototype.seek=function(e){for(var t=this.volume,n=t.coords,r=t.length(),i=this.ptrs,a=this.stencil,o=this.frontier,s=new Int32Array(3),l=0;l<3;++l)this.coord[l]=e[l];l=0;for(var c=0;l<i.length;++l,c+=3){for(var u=0;u<3;++u)s[u]=e[u]+a[c+u];i[l]=t.bisect(s,0,r-1),o[l]=n[0][i[l]]===s[0]&&n[1][i[l]]===s[1]&&n[2][i[l]]===s[2]}},s.prototype.getValues=function(e,t){for(var n=this.ptrs,r=this.frontier,i=this.volume.phases,a=this.volume.distances,o=0;o<n.length;++o){var s=n[o];e[o]=i[s],t[o]=r[o]?a[s]:1}},t.StencilIterator=s,t.beginStencil=function(e,t){var n=new Int32Array(t.length/3),r=new Int32Array(3);return r[0]=r[1]=r[2]=a,new s(e,t,n,r,new Uint8Array(n.length))}},7258:e=>{"use strict";e.exports=function(e,n,r){var i=e*n,a=t*e,o=a-(a-e),s=e-o,l=t*n,c=l-(l-n),u=n-c,h=s*u-(i-o*c-s*c-o*u);if(r)return r[0]=h,r[1]=i,r;return[h,i]};var t=+(Math.pow(2,27)+1)},9553:e=>{"use strict";e.exports=function(e,t,n){var r=e+t,i=r-e,a=t-i,o=e-(r-i);if(n)return n[0]=o+a,n[1]=r,n;return[o+a,r]}},4964:(e,t,n)=>{"use strict";var r=n(19),i=n(6951);n.g.__TYPEDARRAY_POOL||(n.g.__TYPEDARRAY_POOL={UINT8:i([32,0]),UINT16:i([32,0]),UINT32:i([32,0]),BIGUINT64:i([32,0]),INT8:i([32,0]),INT16:i([32,0]),INT32:i([32,0]),BIGINT64:i([32,0]),FLOAT:i([32,0]),DOUBLE:i([32,0]),DATA:i([32,0]),UINT8C:i([32,0]),BUFFER:i([32,0])});var a="undefined"!=typeof Uint8ClampedArray,o="undefined"!=typeof BigUint64Array,s="undefined"!=typeof BigInt64Array,l=n.g.__TYPEDARRAY_POOL;l.UINT8C||(l.UINT8C=i([32,0])),l.BIGUINT64||(l.BIGUINT64=i([32,0])),l.BIGINT64||(l.BIGINT64=i([32,0])),l.BUFFER||(l.BUFFER=i([32,0]));var c=l.DATA,u=l.BUFFER;function h(e){if(e){var t=e.length||e.byteLength,n=r.log2(t);c[n].push(e)}}function d(e){e=r.nextPow2(e);var t=r.log2(e),n=c[t];return n.length>0?n.pop():new ArrayBuffer(e)}function f(e){return new Uint8Array(d(e),0,e)}function p(e){return new Uint16Array(d(2*e),0,e)}function m(e){return new Uint32Array(d(4*e),0,e)}function g(e){return new Int8Array(d(e),0,e)}function v(e){return new Int16Array(d(2*e),0,e)}function y(e){return new Int32Array(d(4*e),0,e)}function _(e){return new Float32Array(d(4*e),0,e)}function b(e){return new Float64Array(d(8*e),0,e)}function E(e){return a?new Uint8ClampedArray(d(e),0,e):f(e)}function w(e){return o?new BigUint64Array(d(8*e),0,e):null}function x(e){return s?new BigInt64Array(d(8*e),0,e):null}function T(e){return new DataView(d(e),0,e)}function A(e){e=r.nextPow2(e);var t=r.log2(e),n=u[t];return n.length>0?n.pop():new Buffer(e)}t.free=function(e){if(Buffer.isBuffer(e))u[r.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,n=0|r.log2(t);c[n].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeBigUint64=t.freeInt8=t.freeInt16=t.freeInt32=t.freeBigInt64=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){h(e.buffer)},t.freeArrayBuffer=h,t.freeBuffer=function(e){u[r.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return d(e);switch(t){case"uint8":return f(e);case"uint16":return p(e);case"uint32":return m(e);case"int8":return g(e);case"int16":return v(e);case"int32":return y(e);case"float":case"float32":return _(e);case"double":case"float64":return b(e);case"uint8_clamped":return E(e);case"bigint64":return x(e);case"biguint64":return w(e);case"buffer":return A(e);case"data":case"dataview":return T(e);default:return null}return null},t.mallocArrayBuffer=d,t.mallocUint8=f,t.mallocUint16=p,t.mallocUint32=m,t.mallocInt8=g,t.mallocInt16=v,t.mallocInt32=y,t.mallocFloat32=t.mallocFloat=_,t.mallocFloat64=t.mallocDouble=b,t.mallocUint8Clamped=E,t.mallocBigUint64=w,t.mallocBigInt64=x,t.mallocDataView=T,t.mallocBuffer=A,t.clearCache=function(){for(var e=0;e<32;++e)l.UINT8[e].length=0,l.UINT16[e].length=0,l.UINT32[e].length=0,l.INT8[e].length=0,l.INT16[e].length=0,l.INT32[e].length=0,l.FLOAT[e].length=0,l.DOUBLE[e].length=0,l.BIGUINT64[e].length=0,l.BIGINT64[e].length=0,l.UINT8C[e].length=0,c[e].length=0,u[e].length=0}},4010:e=>{"use strict";function t(e){this.roots=new Array(e),this.ranks=new Array(e);for(var t=0;t<e;++t)this.roots[t]=t,this.ranks[t]=0}e.exports=t;var n=t.prototype;Object.defineProperty(n,"length",{get:function(){return this.roots.length}}),n.makeSet=function(){var e=this.roots.length;return this.roots.push(e),this.ranks.push(0),e},n.find=function(e){for(var t=e,n=this.roots;n[e]!==e;)e=n[e];for(;n[t]!==e;){var r=n[t];n[t]=e,t=r}return e},n.link=function(e,t){var n=this.find(e),r=this.find(t);if(n!==r){var i=this.ranks,a=this.roots,o=i[n],s=i[r];o<s?a[n]=r:s<o?a[r]=n:(a[r]=n,++i[n])}}},8506:e=>{"use strict";e.exports=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,i=e[0],a=e[0],o=1;o<r;++o)if(a=i,t(i=e[o],a)){if(o===n){n++;continue}e[n++]=i}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],i=e[0],a=1;a<n;++a)if(i=r,(r=e[a])!==i){if(a===t){t++;continue}e[t++]=r}return e.length=t,e}(e))}},1828:(e,t,n)=>{"use strict";var r=n(4948).NEGATIVE_INFINITY;function i(e,t,n){var r=this.coords;e:for(;t<=n;){for(var i=t+n>>1,a=2;a>=0;--a){var o=r[a][i]-e[a];if(o<0){t=i+1;continue e}if(o>0){n=i-1;continue e}}return i}return Math.max(0,n)}function a(e,t,n){e?(this.coords=e,this.distances=t,this.phases=n):(this.coords=[[r],[r],[r]],this.distances=[1],this.phases=[0])}function o(e,t,n){e?(this.coords=e,this.distances=t,this.phases=n):(this.coords=[new Int32Array(1),new Int32Array(1),new Int32Array(1)],this.distances=new Float32Array(1),this.phases=new Int32Array(1),this.coords[0][0]=this.coords[1][0]=this.coords[2][0]=r,this.distances[0]=1)}a.prototype.clone=function(){return new a([this.coords[0].slice(0),this.coords[1].slice(0),this.coords[2].slice(0)],this.distances.slice(0),this.phases.slice(0))},a.prototype.length=function(){return this.phases.length},a.prototype.pop=function(){this.coords[0].pop(),this.coords[1].pop(),this.coords[2].pop(),this.distances.pop(),this.phases.pop()},a.prototype.push=function(e,t,n,r,i){var a=this.coords;a[0].push(e),a[1].push(t),a[2].push(n),this.distances.push(r),this.phases.push(i)},a.prototype.bisect=i,a.prototype.toStatic=function(){return new o([new Int32Array(this.coords[0]),new Int32Array(this.coords[1]),new Int32Array(this.coords[2])],new Float32Array(this.distances),new Int32Array(this.phases))},o.prototype.clone=function(){return new o([new Int32Array(this.coords[0]),new Int32Array(this.coords[1]),new Int32Array(this.coords[2])],new Float64Array(this.distances),new Int32Array(this.phases))},o.prototype.length=function(){return this.phases.length};var s=Array.prototype.slice;o.prototype.toDynamic=function(){return new a([s.call(this.coords[0],0),s.call(this.coords[1],0),s.call(this.coords[2],0)],s.call(this.distances,0),s.call(this.phases,0))},o.prototype.bisect=i,t.StaticVolume=o,t.DynamicVolume=a},2446:(e,t,n)=>{"use strict";var r=n(1844),i=n(2952).A;e.exports=function(e,t,n){var a,o,s,l=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0],u=t.length;for(a=0;a<u;++a)for(s=t[a],o=0;o<3;++o)l[o]=Math.min(l[o],s[o]),c[o]=Math.max(c[o],s[o]);var h=+n||1,d=1/h,f=[0,0,0];for(o=0;o<3;++o)f[o]=l[o]-h;var p=new Array(u);for(a=0;a<u;++a){for(s=t[a].slice(0),o=0;o<3;++o)s[o]=(s[o]-f[o])*d;p[a]=s}var m=r(e,p);return{voxels:i(m).phase,origin:f,resolution:n}}}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=__webpack_require__(5370);window.THREE=e,__webpack_require__(2700),__webpack_require__(303),__webpack_require__(7342),__webpack_require__(6288),__webpack_require__(822),__webpack_require__(9607),__webpack_require__(4419),__webpack_require__(5847),__webpack_require__(4271),__webpack_require__(6834),__webpack_require__(1617),__webpack_require__(3215),__webpack_require__(3202),__webpack_require__(8085),__webpack_require__(7181),__webpack_require__(1088),__webpack_require__(3138),__webpack_require__(5992),__webpack_require__(3861),__webpack_require__(3538),__webpack_require__(3818),__webpack_require__(5071),__webpack_require__(3572),__webpack_require__(2649),__webpack_require__(8694),__webpack_require__(2509),__webpack_require__(5640),__webpack_require__(5151),__webpack_require__(507),__webpack_require__(7862),__webpack_require__(356),__webpack_require__(3531),__webpack_require__(6889),__webpack_require__(7763),__webpack_require__(5470),__webpack_require__(7613),__webpack_require__(3230),__webpack_require__(8726),__webpack_require__(8695),__webpack_require__(8168),__webpack_require__(1553),__webpack_require__(2025),__webpack_require__(5),__webpack_require__(159),__webpack_require__(385),__webpack_require__(1790),__webpack_require__(900),__webpack_require__(5435),__webpack_require__(9929),__webpack_require__(235),__webpack_require__(6707),__webpack_require__(8233),__webpack_require__(6999),__webpack_require__(9681),__webpack_require__(9127),__webpack_require__(801),__webpack_require__(9211),__webpack_require__(9413),__webpack_require__(6716),__webpack_require__(3675),__webpack_require__(5144),__webpack_require__(8),__webpack_require__(1362),__webpack_require__(9174),__webpack_require__(841),__webpack_require__(3425),__webpack_require__(1517),__webpack_require__(6868),__webpack_require__(4559),__webpack_require__(1701),__webpack_require__(7879),__webpack_require__(864),__webpack_require__(8080),__webpack_require__(6136),__webpack_require__(3723),__webpack_require__(6842),__webpack_require__(2596),__webpack_require__(7542),__webpack_require__(8721),__webpack_require__(7684),__webpack_require__(6427),__webpack_require__(9443),__webpack_require__(8084),__webpack_require__(5100);var t={tabIndices:{ViewWorks:"1",GameWorks:"1",NatureWorks:"1",sketcher:"4"},zIndices:{ViewWorks:"0",NatureWorks:"0",sketcher:"2",colorSelector:"3",matcaps:"4"},appWorks:null,shaders:null,sunLight:null,TEXTURE_MAPS:["map","matcap","alphaMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","specularMap","envMap","lightMap","aoMap","emissiveMap","gradientMap"],WORLD_SIZE:1e3,GRID_SPACING:5,GROUND_HEIGHT:0,WATER_HEIGHT:0,WATER_COLOR:7695,OCEAN_COLOR:139053,FOG_COLOR:14014425,SUN_COLOR:16777215};t.Timer={unit:"sec",startTime:0,endTime:0,msg:"",start:function(e){this.msg=e,this.startTime=performance.now()},end:function(){this.endTime=performance.now();var e=this.endTime-this.startTime;"sec"===this.unit&&(e*=.001),console.log(">> time ("+this.msg+") = "+e.toFixed(2)+" ("+this.unit+")")},setUnit:function(e){this.unit=e}};var n,r,i,a,o,s,l,c,u,h,d,f,p,m,g,v=__webpack_require__(2865);t.clock=new THREE.Clock,t.getDeltaTime=function(){return t.clock.getDelta()},t.getCurrentTime=function(){return t.clock.getElapsedTime()},t.humanFileSize=function(e,t,n,r,i){return(t=Math,n=t.log,1e3,i=n(e)/n(1e3)|0,e/t.pow(1e3,i)).toFixed(2)+" "+(i?"KMGTPEZY"[--i]+"B":"Bytes")},t.isDeviceMobile=function(){var e=!1;return/Mobi|Android|webOS|Tablet|iPad|iPhone|iPod|Windows Phone|BlackBerry|BB10|Opera Mini/i.test(navigator.userAgent)&&(e=!0),e},t.isDeviceLandscape=function(){return 90===window.orientation||-90===window.orientation},t.isDeviceTouch=function(){return"ontouchend"in window},t.isDeviceWindowsOS=function(){return navigator.platform.toUpperCase().indexOf("WIN32")>=0},t.isDeviceMacOS=function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0},t.isDeviceiOS=function(){return/iPad|iPhone|iPod/g.test(navigator.userAgent)&&!window.MSStream},t.isWebGL1Available=function(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},t.isWebGL2Available=function(){var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))},t.isWebGL1=function(){var e=t.appWorks.renderer.getContext();return void 0!==e&&e instanceof window.WebGLRenderingContext},t.isWebGL2=function(){var e=t.appWorks.renderer.getContext();return void 0!==e&&e instanceof window.WebGL2RenderingContext},t.getWebGLInfo=function(){var e=[],n="WebGL1: "+(t.isWebGL1Available()?"available":"unavailable");e.push(n);var r="WebGL2: "+(t.isWebGL2Available()?"available":"unavailable");e.push(r);var i=t.appWorks.renderer.getContext().getSupportedExtensions();return e=e.concat(i)},t.isWebGLExtensionAvailable=function(e){return t.appWorks.renderer.getContext().getSupportedExtensions().indexOf(e)>=0},Number.prototype.format=function(){return this.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},String.prototype.trunc=function(e,t){if(this.length<=e)return(" "+this).slice(1);var n=this.substr(0,e);return(t?n.substr(0,n.lastIndexOf(" ")+1):n)+"..."},Array.prototype.clone=function(){return this.map((e=>Array.isArray(e)?e.clone():e))},Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,n)},Array.prototype.sum=function(){return this.reduce((function(e,t){return e+Number(t)}),0)},Array.prototype.average=function(){return this.sum()/(this.length||1)},Array.prototype.mean=function(){return this.sum()/(this.length||1)},Array.prototype.median=function(){var e=this.slice(0).sort(((e,t)=>e-t)),t=e.length/2;return t%1?e[t-.5]:(e[t-1]+e[t])/2},Array.prototype.variance=function(){var e=this.mean();return this.map((t=>Math.pow(t-e,2))).mean()},Array.prototype.std=function(){return Math.sqrt(this.variance())},Array.prototype.zscores=function(){var e=this.mean(),t=this.std();return this.map((n=>(n-e)/t))},Array.prototype.range=function(){return this.max()-this.min()},Array.prototype.zero=function(e){for(var t=0;t<e;t++)this[t]=0;return this},Array.prototype.scale=function(e){return this.map((t=>t*e))},Array.prototype.add=function(e){return this.map(((t,n)=>t+e[n]))},Array.prototype.sub=function(e){return this.map(((t,n)=>t-e[n]))},Array.prototype.mul=function(e){return this.map(((t,n)=>t*e[n]))},Array.prototype.div=function(e){return this.map(((t,n)=>t/e[n]))},Array.prototype.dot=function(e){return this.map(((t,n)=>t*e[n])).reduce(((e,t)=>e+t))},Array.prototype.norm2=function(){return Math.sqrt(this.map(((e,t)=>e*e)).reduce(((e,t)=>e+t)))},Array.prototype.transpose=function(){var e=this;return e[0].map((function(t,n){return e.map((function(e,t){return e[n]}))}))},Array.prototype.mmul=function(e){return this.map((function(t,n){return e.transpose().map((function(e,n){return t.dot(e)}))}))},Array.prototype.vmul=function(e){return this.map((function(t,n){return t.dot(e)}))},Array.prototype.sortNumbers=function(e){return"ascending"===(e=e||"ascending")?this.sort(((e,t)=>e-t)):"descending"===e&&this.sort(((e,t)=>t-e)),this},Array.prototype.minX=function(){return this.reduce(((e,t)=>t.x<e?t.x:e),this[0].x)},Array.prototype.maxX=function(){return this.reduce(((e,t)=>t.x>e?t.x:e),this[0].x)},Array.prototype.minY=function(){return this.reduce(((e,t)=>t.y<e?t.y:e),this[0].y)},Array.prototype.maxY=function(){return this.reduce(((e,t)=>t.y>e?t.y:e),this[0].y)},Array.prototype.minZ=function(){return this.reduce(((e,t)=>t.z<e?t.z:e),this[0].z)},Array.prototype.maxZ=function(){return this.reduce(((e,t)=>t.z>e?t.z:e),this[0].z)},Array.prototype.min=function(){return this.reduce(((e,t)=>t<e?t:e),this[0])},Array.prototype.max=function(){return this.reduce(((e,t)=>t>e?t:e),this[0])},Array.prototype.householder=function(){function e(e,t=(e=>e)){return Array.from(Array(e),((e,n)=>t(n)))}function t(e,t=(e=>e)){return e.reduce(((e,n,r)=>e+t(n,r)),0)}const n=Math.sqrt(this.length),r=Array.from(this);console.assert(Number.isInteger(n));const i=(e,t)=>t*n+e;for(let a=0;a<n-2;a++){if(Math.abs(r[i(a,a+1)])<Number.EPSILON)continue;const o=e(n,(e=>e<=a?0:r[i(a,e)])),s=Math.sign(o[a+1])*Math.hypot(...o);o[a+1]+=s;const l=Math.sqrt(2*s*o[a+1]),c=o.map((e=>e/l)),u=e(n,(e=>t(c,((t,n)=>t*r[i(n,e)])))),h=e(n,(e=>t(c,((t,n)=>t*r[i(e,n)])))),d=t(u,((e,t)=>e*c[t])),f=t(h,((e,t)=>e*c[t])),p=u.map(((e,t)=>2*(e-d*c[t]))),m=h.map(((e,t)=>2*(e-f*c[t])));for(let e=0;e<n;e++)for(let t=0;t<n;t++)r[i(t,e)]-=c[e]*m[t]+c[t]*p[e]}return r},Array.prototype.qr=function(){function e(e,t=(e=>e)){return e.reduce(((e,n,r)=>e+t(n,r)),0)}const t=Math.sqrt(this.length),n=Array.from(this);console.assert(Number.isInteger(t));const r=(e,n)=>n*t+e;let i=t;for(;i>=2;){if(Math.abs(n[r(i-2,i-1)])<Number.EPSILON){i--;continue}const t=n[r(i-1,i-1)],a=n[r(i-2,i-1)],o=n[r(i-1,i-2)],s=n[r(i-2,i-2)],l=t*s,c=t*s-a*o,u=Math.sqrt(l*l-4*c)||0,h=(l+u)/2,d=(l-u)/2,f=t-(Math.abs(h)<Math.abs(d)?h:d);for(let e=0;e<i;e++)n[r(e,e)]-=f;const p=(e,t)=>t*i+e,m=Array(i*i).fill(0);for(let e=0;e<i;e++)m[p(e,e)]=1;for(let e=0;e<i-1;e++){const t=n[r(e,e)],a=n[r(e,e+1)],o=Math.hypot(t,a),s=o<Number.EPSILON?0:t/o,l=o<Number.EPSILON?0:a/o;n[r(e,e)]=o,n[r(e,e+1)]=0;for(let t=e+1;t<i;t++){const i=n[r(t,e)],a=n[r(t,e+1)];n[r(t,e)]=i*s+a*l,n[r(t,e+1)]=a*s-i*l}for(let t=0;t<i;t++){const n=m[p(e,t)],r=m[p(e+1,t)];m[p(e,t)]=n*s+r*l,m[p(e+1,t)]=r*s-n*l}}for(let t=0;t<i;t++){const a=Array.from(Array(i-t),((e,i)=>n[r(t+i,t)]));for(let o=0;o<i;o++)n[r(o,t)]=e(a,((e,n)=>e*m[p(o,n+t)]))}for(let e=0;e<i;e++)n[r(e,e)]+=f}return n},Array.prototype.eigenvalues=function(){const e=this.householder().qr(),t=Math.sqrt(e.length);return function(e,t=(e=>e)){return Array.from(Array(e),((e,n)=>t(n)))}(t,(n=>e[n*t+n]))},t.concatTypedArrays=function(e,...t){const n=new e(t.reduce(((e,t)=>e+t.length),0));return t.reduce(((e,t)=>(n.set(t,e),e+t.length)),0),n},t.fromTypedArray=function(e){return[].slice.call(e)},t.fillArray=function(e,t){for(var n=[],r=t;r--;)n[r]=e;return n},t.flattenArray=function(e){return e.reduce((function(e,n){return e.concat(Array.isArray(n)?t.flattenArray(n):n)}),[])},t.flattenVector2s=function(e,t){void 0===t&&(t=[]);for(var n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y)}return t},t.flattenVector3s=function(e,t){void 0===t&&(t=[]);for(var n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z)}return t},t.flattenVector4s=function(e,t){void 0===t&&(t=[]);for(var n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z,i.w)}return t},t.mergeArray3=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var n,r={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],a.z=e[o][2],void 0===r[n=Math.round(a.x*t)+"_"+Math.round(a.y*t)+"_"+Math.round(a.z*t)]&&(r[n]=o,i.push([e[o][0],e[o][1],e[o][2]]));return i.slice(0)},t.mergeArray2=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var n,r={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],void 0===r[n=Math.round(a.x*t)+"_"+Math.round(a.y*t)]&&(r[n]=o,i.push([e[o][0],e[o][1]]));return i.slice(0)},t.mergeArray=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var n,r={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o],void 0===r[n=Math.round(a.x*t)]&&(r[n]=o,i.push(e[o]));return i.slice(0)},t.mergeVertices=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var n,r,i={},a=0,o=e.length;a<o;a++)n=e[a],void 0===i[r=Math.round(n.x*t)+"_"+Math.round(n.y*t)+"_"+Math.round(n.z*t)]&&(i[r]=a,this.push(e[a]));return e.length-this.length},t.toHexValue=function(e,n){return n?"0x"+t.toHexValue(e).toString(16):new THREE.Color(e).getHex()},t.toHexStyle=function(e){return"#"+new THREE.Color(e).getHexString()},t.clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},t.mix=function(e,t,n){return e*(1-n)+t*n},t.lerp=function(e,t,n){return e*(1-n)+t*n},t.smoothstep=function(e,t,n){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*(3-2*n)},t.randInt=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},t.randFloat=function(e,t){return e+Math.random()*(t-e)},t.randFloatSpread=function(e,t){return e+t*(Math.random()-.5)},t.linearRand=function(e,n){return t.randFloat(e,n)},t.gaussRand=function(e,n){var r,i,a;do{r=(i=t.randFloat(-1,1))*i+(a=t.randFloat(-1,1))*a}while(r>1);return a*n*n*Math.sqrt(-2*Math.log(r)/r)+e},t.diskRand=(n=new THREE.Vector2,function(e){var r;do{n.x=t.randFloat(-e,e),n.y=t.randFloat(-e,e),r=n.length()}while(r>e);return n}),t.ballRand=function(){var e=new THREE.Vector3;return function(n){var r;do{e.x=t.randFloat(-n,n),e.y=t.randFloat(-n,n),e.z=t.randFloat(-n,n),r=e.length()}while(r>n);return e}}(),t.circularRand=function(){var e=new THREE.Vector2;return function(n){var r=t.randFloat(0,6.283185307179586);return e.x=n*Math.cos(r),e.y=n*Math.sin(r),e}}(),t.sphericalRand=function(){var e=new THREE.Vector3;return function(n){var r=t.randFloat(-1,1),i=t.randFloat(0,6.283185307179586),a=Math.sqrt(1-r*r),o=a*Math.cos(i),s=a*Math.sin(i);return e.x=o*n,e.y=s*n,e.z=r*n,e}}(),t.createMathRandom=function(e){var t,n=function(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=Math.imul(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(e.toString());return t=n(),()=>((t=Math.imul(741103597,t))>>>0)/2**32},t.createRandFloat=function(e){var n=void 0!==e?t.createMathRandom(e):Math.random;return function(e,t){return e+n()*(t-e)}},t.createFbmNoise=function(e){var t=void 0!==(e=e||{}).octaves?e.octaves:4,n=void 0!==e.persistence?e.persistence:.5;switch(void 0!==e.noiseType?e.noiseType:"simplex3d"){case"perlin3d":var r=(new THREE.ImprovedNoise).noise;break;default:var i=new THREE.SimplexNoise;r=i.noise3d.bind(i)}for(var a=new Array(t),o=new Array(t),s=0,l=0;l<t;l++)a[l]=Math.pow(n,l),o[l]=Math.pow(2,l),s+=a[l];return s=1/s,function(e,n,i){for(var o=0,l=0;l<t;l++){var c=1<<l;o+=a[l]*r(e*c,n*c,i*c)}return o*s}},t.fileExist=function(e,t,n){n=void 0!==n&&n,fetch((!0===n?"https://cors-anywhere.herokuapp.com/":"")+e).then((e=>{t&&t("404"!=e.status)})).catch((e=>{t&&t(!1)}))},t.triggerWindowResize=function(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}},t.isCtrlKeyDown=function(e){return t.isDeviceMacOS()?e.metaKey:e.ctrlKey},t.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},t.createImageDropZone=function(e,t){return null==e&&((e=document.createElement("img")).style.width="50px",e.style.height="50px",e.style.border="1px solid white"),e.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"}),!1),e.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation();var n=new FileReader;n.addEventListener("load",(function(e){var n=new Image;n.onload=function(){t(n)},n.src=e.currentTarget.result}),!1),n.readAsDataURL(e.dataTransfer.files[0])}),!1),e},t.setDraggable=function(e){var t=0,n=0,r=0,i=0,a=e.children[0];function o(e){(e=e||window.event).preventDefault(),r=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(a){(a=a||window.event).preventDefault(),t=r-a.clientX,n=i-a.clientY,r=a.clientX,i=a.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null}a?a.onmousedown=o:e.onmousedown=o},t.removeHTMLElement=function(e){for("string"==typeof e&&(e=document.getElementById(e)),e.parentNode&&e.parentNode.removeChild(e);e.firstChild;)e.removeChild(e.firstChild)},t.createFlashtext=function(e,t){var n,r,i=(t=t||{}).fontSize||"10vw";if(n=document.getElementById("flash-text"))return(r=document.getElementById("flash-style")).innerHTML=r.innerHTML.replace(/font-size:\s\w+\;/,`font-size: ${i};`),n.innerHTML=`\n            <h1 class="flash" data-heading="${e}">${e}</h1>\n        `,void(n.style.display="");(n=document.createElement("div")).id="flash-text",n.innerHTML=`\n        <h1 class="flash" data-heading="${e}">${e}</h1>\n    `,document.body.appendChild(n),(r=document.createElement("style")).id="flash-style",r.innerHTML=`\n        .flash {\n            background: url("images/frozen.jpg");\n            -webkit-background-clip: text;\n            background-size: contain;\n            width: 100%;\n            text-align: center;\n            color: transparent;\n            font-weight: 900;\n\n            top: 50%;\n            left: 50%;\n            -webkit-transform: translate(-50%, -50%);\n                    transform: translate(-50%, -50%);\n            position: absolute;\n            font-size: ${i};\n            margin: 0;\n            font-family: 'frozen', serif;\n        }\n        .flash::before {\n            content: attr(data-heading);\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n            background: linear-gradient(45deg, rgba(255, 255, 255, 0) 45%, rgba(255, 255, 255, 0.8) 50%, rgba(255, 255, 255, 0) 55%, rgba(255, 255, 255, 0) 100%);\n            -webkit-background-clip: text;\n            color: transparent;\n            mix-blend-mode: screen;\n            -webkit-animation: shine 1s infinite;\n                    animation: shine 1s infinite;\n            background-size: 200%;\n            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2), -2px 2px 10px rgba(0, 0, 0, 0.2), -2px -2px 10px rgba(0, 0, 0, 0.2);\n        }\n        @-webkit-keyframes shine {\n            0% {\n                background-position: -100%;\n            }\n            100% {\n                background-position: 100%;\n            }\n        }\n        @keyframes shine {\n            0% {\n                background-position: -100%;\n            }\n            100% {\n                background-position: 100%;\n            }\n        }\n        @font-face {\n            font-family: 'frozen';\n            src: url("fonts/Ice kingdom - Bold - Por Kustren.woff");\n        }\n    `,document.head.appendChild(r)},t.showFlashtext=function(){var e=document.getElementById("flash-text");e&&(e.style.display="")},t.hideFlashtext=function(){var e=document.getElementById("flash-text");e&&(e.style.display="none")},t.removeFlashtext=function(){var e=document.getElementById("flash-text");e&&document.body.removeChild(e);var t=document.getElementById("flash-style");t&&document.head.removeChild(t)},t.createSpincircle=function(){if(e=document.getElementById("spin-circle"))e.style.display="";else{var e;(e=document.createElement("div")).id="spin-circle",e.innerHTML='\n        <div class="spin-wrapper">\n            <div class="spin-text">Computing...</div>\n            <div class="spin"></div>\n        </div>\n    ',document.body.appendChild(e);var t=document.createElement("style");t.id="spin-style",t.innerHTML='\n        .spin-wrapper {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            color: #888;\n        }\n        .spin-text {\n            position: absolute;\n            left: 50%;\n            top: 50%;\n            transform: translate(-50%, -50%);\n            color: #888;\n        }\n        .spin {\n            position: relative;\n            left: 50%;\n            top: 50%;\n            width: 150px;\n            height: 150px;\n            margin: -75px 0 0 -75px;\n            border-radius: 50%;\n            border: 3px solid transparent;\n            border-top-color: #3498db;\n            -webkit-animation: spin 2s linear infinite; /* Chrome, Opera 15+, Safari 5+ */\n            animation: spin 2s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */\n        }\n        .spin:before {\n            content: "";\n            position: absolute;\n            top: 5px;\n            left: 5px;\n            right: 5px;\n            bottom: 5px;\n            border-radius: 50%;\n            border: 3px solid transparent;\n            border-top-color: #e74c3c;\n            -webkit-animation: spin 3s linear infinite; /* Chrome, Opera 15+, Safari 5+ */\n            animation: spin 3s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */\n        }\n        .spin:after {\n            content: "";\n            position: absolute;\n            top: 15px;\n            left: 15px;\n            right: 15px;\n            bottom: 15px;\n            border-radius: 50%;\n            border: 3px solid transparent;\n            border-top-color: #f9c922;\n            -webkit-animation: spin 1.5s linear infinite; /* Chrome, Opera 15+, Safari 5+ */\n            animation: spin 1.5s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */\n        }\n        @-webkit-keyframes spin {\n            0%   {\n                -webkit-transform: rotate(0deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(0deg);  /* IE 9 */\n                transform: rotate(0deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n            100% {\n                -webkit-transform: rotate(360deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(360deg);  /* IE 9 */\n                transform: rotate(360deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n        }\n        @keyframes spin {\n            0%   {\n                -webkit-transform: rotate(0deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(0deg);  /* IE 9 */\n                transform: rotate(0deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n            100% {\n                -webkit-transform: rotate(360deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(360deg);  /* IE 9 */\n                transform: rotate(360deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n        }\n    ',document.head.appendChild(t)}},t.showSpincircle=function(){var e=document.getElementById("spin-circle");e&&(e.style.display="")},t.hideSpincircle=function(){var e=document.getElementById("spin-circle");e&&(e.style.display="none")},t.removeSpincircle=function(){var e=document.getElementById("spin-circle");void 0!==e&&document.body.removeChild(e);var t=document.getElementById("spin-style");void 0!==t&&document.head.removeChild(t)},t.createProgressbar=function(){var e;if(e=document.getElementById("progress-box"))return e.style.display="",void(t.getProgressbar().style.width="0%");(e=document.createElement("div")).id="progress-box",e.innerHTML='\n        <div>\n            <div style="color:#888;">Loading...</div>\n            <div class="progress">\n                <div id="progressbar"></div>\n            </div>\n        </div>\n    ',document.body.appendChild(e);var n=document.createElement("style");n.id="progress-style",n.innerHTML="\n        #progress-box {\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            font-size: x-large;\n            font-family: sans-serif;\n        }\n        #progress-box>div>div {\n            padding: 2px;\n        }\n        .progress {\n            width: 50vw;\n            border: 1px solid #888;\n        }\n        #progressbar {\n            width: 0;\n            transition: width ease-out .5s;\n            height: 1em;\n            background-color: #888;\n            background-image: linear-gradient(\n                -45deg, \n                rgba(255, 255, 255, .5) 25%, \n                transparent 25%, \n                transparent 50%, \n                rgba(255, 255, 255, .5) 50%, \n                rgba(255, 255, 255, .5) 75%, \n                transparent 75%, \n                transparent\n            );\n            background-size: 50px 50px;\n            animation: progressanim 2s linear infinite;\n        }\n    ",document.head.appendChild(n)},t.getProgressbar=function(){return document.getElementById("progressbar")},t.updateProgressbar=function(e,n,r){void 0===r&&(r=t.getProgressbar()),r.style.width=(e/n*100|0)+"%"},t.hideProgressbar=function(){var e=document.getElementById("progress-box");e&&(e.style.display="none")},t.showProgressbar=function(){var e=document.getElementById("progress-box");e&&(e.style.display="")},t.errorProgressbar=function(e){console.warn(e)},t.removeProgressbar=function(){var e=document.getElementById("progress-box");void 0!==e&&document.body.removeChild(e);var t=document.getElementById("progress-style");void 0!==t&&document.head.removeChild(t)},t.getDistancePerPixel=function(){var e=t.appWorks.camera;return e.position.length()*Math.tan(e.fov/2*THREE.Math.DEG2RAD)*2*e.aspect/t.appWorks.width},t.getMouseScreenCoords=(r=new THREE.Vector2,function(e){return e.changedTouches?(r.x=e.changedTouches[0].clientX,r.y=e.changedTouches[0].clientY):(r.x=e.clientX,r.y=e.clientY),r}),t.toggleLightHelpers=function(e){t.appWorks.sceneHelpers.children.forEach((function(t){(t instanceof THREE.PointLightHelper||t instanceof THREE.SpotLightHelper||t instanceof THREE.DirectionalLightHelper||t instanceof THREE.HemisphereLightHelper)&&(t.visible=void 0!==e?e:!t.visible)}))},t.createSpritesHUD=function(e,n,r,i,a){var o;o=e.isTexture?new THREE.SpriteMaterial({map:e,transparent:!0,depthTest:!1}):!0===e.isSpriteMaterial?e:new THREE.SpriteMaterial({color:16777215,transparent:!0,depthTest:!1});var s=new THREE.Sprite(o);s.center.set(.5,.5),s.scale.set(i,a,1),s.name="spritesHUD";var l=t.appWorks.cameraHUD;return s.position.x=l.left+i/2+n,s.position.y=l.bottom+a/2+r,s},t.createTextHUD=function(e,n,r,i,a,o){!1===Array.isArray(e)&&(e=[e]);n=n||0,r=r||0;var s,l=-1;e.forEach(((e,t)=>{e.length>l&&(l=e.length,s=t)}));var c=document.createElement("canvas"),u=c.getContext("2d");u.font="Normal 20px Arial",c.width=u.measureText(e[s]).width,u.font="Normal 20px Arial";var h=1.2*u.measureText("M").width;c.height=h*e.length*1.2;i=i||c.width,a=a||c.height;var d=new THREE.CanvasTexture(u.canvas),f=new THREE.MeshBasicMaterial({map:d,transparent:!0,depthTest:!1}),p=new THREE.PlaneBufferGeometry(i,a),m=new THREE.Mesh(p,f);m.name="textHUD";var g=t.appWorks.cameraHUD;m.position.x=g.left+i/2+n,m.position.y=g.bottom+a/2+r,!0===o&&(m.userData.context2D=u,m.userData.texts=e,m.userData.lineHeight=h),u.font="Normal 20px Arial",u.textAlign="left",u.fillStyle="rgba(255,255,255,1.0)",u.clear();r=h;return e.forEach((e=>{u.fillText(e,0,r),r+=h})),d.needsUpdate=!0,m},t.createRenderTargetHUD=function(e,n,r,i,a,o){n=n||0,r=r||0,i=i||t.appWorks.width,a=a||t.appWorks.height;var s=e.clone(),l=new THREE.Scene;l.add(s),l.add(t.createHemisphereLight()),l.background=t.appWorks.scene.background;var c=t.appWorks.camera.clone();t.fitCameraToObject(s,c);var u=new THREE.WebGLRenderTarget(t.appWorks.width,t.appWorks.height),h=t.appWorks.renderer;h.setRenderTarget(u),h.render(l,c);var d=new THREE.MeshBasicMaterial({map:u.texture}),f=new THREE.PlaneBufferGeometry(i,a),p=new THREE.Mesh(f,d);p.name="renderTargetHUD";var m=t.appWorks.cameraHUD;return p.position.x=m.left+i/2+n,p.position.y=m.bottom+a/2+r,!0===o&&(p.userData.renderTarget=u,p.userData.rtScene=l,p.userData.rtCamera=c),p},t.computeBoundingBox=function(e){return(new THREE.Box3).setFromObject(e)},t.computeBoundingSphere=function(){var e,t,n,r=new THREE.Vector3;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,n=o.length;t<n;t++)r.copy(o[t]),r.applyMatrix4(i.matrixWorld),e.push(r.clone())}else if(a.isBufferGeometry){var s;if(void 0!==(s=a.attributes.instancePosition?a.attributes.instancePosition:a.attributes.position))for(t=0,n=s.count;t<n;t++)r.fromBufferAttribute(s,t),r.applyMatrix4(i.matrixWorld),e.push(r.clone())}}return function(t){return e=[],t.updateMatrixWorld(!0),t.traverse(i),e.length>0?(new THREE.Sphere).setFromPoints(e):void 0}}(),t.getObjectName=function(e,t){t=void 0!==t?t:"";if(Array.isArray(e)){for(var n=[],r=0;r<e.length;r++)n.push(""===e[r].name?t:e[r].name);return n.join(", ").trunc(20)}return(void 0===e.name?t:e.name).trunc(20)},t.getObjectSize=(i=new THREE.Vector3,function(e){return t.computeBoundingBox(e).getSize(i),Math.max(i.x,i.y,i.z)}),t.resizeObject=function(e,n){if(n){var r=t.getObjectSize(e);e.scale.setScalar(n/r)}},t.transformObject=function(e,t,n,r){t&&e.position.set(t.x,t.y,t.z),n&&e.rotation.set(n.x,n.y,n.z),r&&e.scale.set(r.x,r.y,r.z),e.updateMatrix()},t.copyTransform=function(e,n){var r=n.position,i=n.rotation,a=n.scale;t.transformObject(e,r,i,a)},t.cloneObject=function(e){return void 0!==e.userData.type?new t[e.userData.type](e):e.clone()},t.traverseMaterials=function(e,t){e.traverse((e=>{if(!e.isMesh)return;(Array.isArray(e.material)?e.material:[e.material]).forEach(t)}))},t.updateMaterialMapEncoding=function(e,n){n=n||THREE.sRGBEncoding,t.traverseMaterials(e,(e=>{e.map&&(e.map.encoding=n),e.emissiveMap&&(e.emissiveMap.encoding=n),(e.map||e.emissiveMap)&&(e.needsUpdate=!0)}))},t.underWaterBackground=function(){void 0!==t.appWorks.underWaterPass&&(t.appWorks.underWaterPass.enabled=!0),t.appWorks.createSceneBackground("underWater"),t.appWorks.scene.fog||t.appWorks.createSceneFog({type:"exp2",color:594516,density:.004}),t.appWorks.renderer.toneMappingExposure=.7},t.filmGrainBackground=function(){var e=t.appWorks.width,n=t.appWorks.height,r={aspect:t.appWorks.camera.aspect,aspectCorrection:!0,grainScale:1.5/Math.min(e,n),color1:16777215,color2:3487029,noiseAlpha:.75};(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg",(function(e){t.imageProcessing(e,"FilmGrainShader",r,(function(e){t.appWorks.scene.background=e}))}))},t.redColors=(a=[16752762,16416882,15308410,15761536,13458524,14423100,11674146,16711680,9109504,8388608,16737095,16729344,14381203],function(e){return a[e%a.length]}),t.greenColors=(o=[8190976,8388352,3329330,65280,2263842,32768,25600,11403055,10145074,65407,64154,9498256,10025880,9419919,3978097,2142890,3050327,526336,5597999,7048739],function(e){return o[e%o.length]}),t.blueColors=(s=[4744096,2839678,2832470,1383252,128,1388926,1383309,160,8386,16834,2446535,1403335,2842846,2049532,2844140,3174143,1411583,6723839,3914239],function(e){return s[e%s.length]}),t.randomColors=function(e){if((e=e||{}).colors)return e.colors;var n,r,i,a=void 0!==e.numInstances?Math.floor(e.numInstances):1,o=void 0!==e.colorMode?e.colorMode:"none",s=new THREE.Color,l=[];if("0"===o)for(var c=0;c<a;c++)n=Math.random(),r=Math.random(),i=Math.random(),s.setHSL(n,r,i),l.push(s.r,s.g,s.b);else if("1"===o)for(c=0;c<a;c++)n=Math.random(),r=.5,i=.5,s.setHSL(n,r,i),l.push(s.r,s.g,s.b);else if("2"===o)for(c=0;c<a;c++)n=Math.random(),r=1,i=.5,s.setHSL(n,r,i),l.push(s.r,s.g,s.b);else if("reds"===o)for(c=0;c<a;c++)s.setHex(t.redColors(c)),l.push(s.r,s.g,s.b);else if("greens"===o)for(c=0;c<a;c++)s.setHex(t.greenColors(c)),l.push(s.r,s.g,s.b);else if("blues"===o)for(c=0;c<a;c++)s.setHex(t.blueColors(c)),l.push(s.r,s.g,s.b);return l},t.cameraAutoView=function(e){if((e=e||{}).isWorking)return"stop"!==l;if("circle"===(l=e.viewMode||"circle")){var n=e.radius||20,r=new THREE.CircleBufferGeometry(n,32),i=new THREE.Mesh(r);i.name="cameraPath",i.visible=!1,t.add(i),i.add(t.appWorks.camera),i.update=function(){this.rotation.y+=.003}}else if("stop"===l){var a=t.appWorks.camera.parent;a&&"cameraPath"===a.name&&(a.remove(t.appWorks.camera),t.appWorks.camera.parent=null)}},t.fitCameraToObject=function(e,n,r){if(e){n=void 0!==n?n:t.appWorks.camera,r=void 0===r||r;var i=new THREE.Vector3,a=new THREE.Vector3,o=t.computeBoundingBox(e);o.getSize(a);var s=e.position.clone();!0===r?(o.getCenter(i),s.sub(i),i.set(0,0,0)):i.copy(s);var l=n.fov*THREE.Math.DEG2RAD,c=Math.max(a.x,a.y,a.z),u=Math.abs(c/2/Math.tan(l/2));if(u*=1.25,n===t.appWorks.camera){var h=t.appWorks.controls;h instanceof THREE.OrbitControls?(h.reset(),h.maxDistance=100*u,h.saveState()):h instanceof THREE.TrackballControls&&(h.reset(),h.maxDistance=100*u)}var d=n.position.clone();d.normalize().multiplyScalar(u),n.lookAt(i);var f=u/100,p=100*u;if(t.appWorks.history&&n===t.appWorks.camera){var m=[];r&&m.push(new t.SetPositionCommand(e,s)),m.push(new t.SetPositionCommand(n,d)),m.push(new t.SetValueCommand(n,"near",f)),m.push(new t.SetValueCommand(n,"far",p)),t.appWorks.multiCmds(m)}else r&&e.position.copy(s),n.position.copy(d),n.near=f,n.far=p;n.updateProjectionMatrix()}},t.welcomeObject=function(e){if(e.traverse((function(e){e.isMesh&&(e.frustumCulled=!1,e.castShadow=!0,e.receiveShadow=!0)})),"NatureWorks"===t.appWorks.appName)t.fitCameraToObject(e);else if("ViewWorks"===t.appWorks.appName){t.resizeObject(e,1),t.fitCameraToObject(e),t.appWorks.selectObject=e;var n=t.appWorks.scene.getObjectByName("showroom");void 0===n&&(n=t.createShowroom(e),t.add(n))}},t.nextShowroom=function(e,n){if(n||(n=t.appWorks.scene.getObjectByName("showroom")),"background"===e){(i=n.getObjectByName("raymarch"))&&n.remove(i),a=((a=n.activeBackground)+1)%n.backgrounds.length,n.activeBackground=a;var r=n.backgrounds[a];r.isMesh?(t.appWorks.scene.background=null,n.add(r)):t.appWorks.scene.background=r}if("floor"===e){var i,a;(i=n.getObjectByName("floor"))&&n.remove(i),a=((a=n.activeFloor)+1)%n.floors.length,n.activeFloor=a;var o=n.floors[a];n.add(o)}},t.createShowroom=function(e){var n=new THREE.Object3D;n.name="showroom",n.activeBackground=-1,n.backgrounds=[];var r=["arctic","burlesque","denim","mercury","neo","origin","rouge","slate"];r.forEach((e=>{var r=(new THREE.TextureLoader).load("images/wallpaper/"+e+".jpg");r.encoding=THREE.sRGBEncoding,n.backgrounds.push(t.createBackground(r))})),(r=["blueSky","cloud","galaxy","lake","bridge","park"]).forEach((e=>{n.backgrounds.push(t.createBackground(e))})),(r=["cloudsFS","cellsFS","fogFS","sunsetFS"]).forEach((e=>{var r=t.createBackground(e);r.name="raymarch",n.backgrounds.push(r)})),n.backgrounds.push(t.createBackground(12632256)),n.activeFloor=-1,n.floors=[];var i=new THREE.TextureLoader,a=t.computeBoundingBox(e),o=a.min.y,s=a.getSize(new THREE.Vector3),l=4*(s=Math.max(s.x,s.y,s.z));function c(e,t){t=t||8;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}(f=t.createAcrylicCircle(l)).rotation.x=-Math.PI/2,f.position.y=o,f.name="floor",n.floors.push(f);var u=[];u.push({map:i.load("images/rock/crackRockDiffuse.jpg",c),normalMap:i.load("images/rock/crackRockNormal.jpg",c),aoMap:i.load("images/rock/crackRockAO.jpg",c)}),u.push({color:11184810,roughness:1,metalness:0,map:i.load("images/pbr/wallA.png",c),normalMap:i.load("images/pbr/wallN.png",c),aoMap:i.load("images/pbr/wallAO.png",c),roughnessMap:i.load("images/pbr/wallR.png",c)}),u.push({roughness:1,metalness:0,map:i.load("images/pbr/bathroomtileA.png",c),normalMap:i.load("images/pbr/bathroomtileN.png",c),aoMap:i.load("images/pbr/bathroomtileAO.png",c),roughnessMap:i.load("images/pbr/bathroomtileR.png",c)}),u.push({roughness:1,metalness:0,map:i.load("images/pbr/charcoalA.png",c),normalMap:i.load("images/pbr/charcoalN.png",c),roughnessMap:i.load("images/pbr/charcoalR.png",c)}),u.push({color:11184810,roughness:1,metalness:0,map:i.load("images/pbr/grassA.png",c),normalMap:i.load("images/pbr/grassN.png",c),aoMap:i.load("images/pbr/grassAO.png",c),roughnessMap:i.load("images/pbr/grassR.png",c)}),u.push({color:8947848,roughness:.5,metalness:.5,map:i.load("images/pbr/rustIronA.png",(e=>c(e,2))),normalMap:i.load("images/pbr/rustIronN.png",(e=>c(e,2))),aoMap:i.load("images/pbr/rustIronAO.png",(e=>c(e,2))),roughnessMap:i.load("images/pbr/rustIronR.png",(e=>c(e,2))),metalnessMap:i.load("images/pbr/rustIronM.png",(e=>c(e,2)))});for(var h=new THREE.CircleBufferGeometry(l,64),d=0;d<u.length;d++){var f,p=new THREE.MeshStandardMaterial(u[d]);(f=new THREE.Mesh(h,p)).receiveShadow=!0,f.rotation.x=-Math.PI/2,f.position.y=o,f.name="floor",n.floors.push(f)}t.nextShowroom("background",n),t.nextShowroom("floor",n),t.add(t.createHemisphereLight());var m=t.createDirectionalLight({shadowCameraSize:.5*l});return m.position.set(0,.75*l,.5*l),t.add(m),n},t.manhatten2D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},t.manhatten3D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)},t.createKdTree=function(e,n,r){var i=e[0];Array.isArray(i)?e=t.flattenArray(e):i instanceof THREE.Vector2?e=t.flattenVector2s(e):i instanceof THREE.Vector3?e=t.flattenVector3s(e):i instanceof THREE.Vector4&&(e=t.flattenVector4s(e)),e=new Float32Array(e);r=r||2===n?t.manhatten2D:t.manhatten3D;return new THREE.TypedArrayUtils.Kdtree(e,r,n)},t.getKdTreeNearest=function(e,t,n,r){for(var i=e.nearest(t,n,r),a=[],o=0,s=i.length;o<s;o++){var l=i[o],c={};c.position=l[0].obj,c.index=l[0].pos,c.distance=l[1],a.push(c)}return a},t.OctreeHelper=function(e,n){if(!e instanceof v.PointOctree)return null;var r=(n=n||{}).leaves||!1,i=n.color||16777215,a=[],o=[];if(r){o=t.getLeafOctants(e,!0)}else{var s=n.topLevel||0,l=n.bottomLevel||e.getDepth();o=t.getOctantsByLevels(e,s,l)}o.forEach((function(e){var t=new THREE.Box3(e.min,e.max),n=new THREE.Box3Helper(t);n.updateMatrixWorld(!0),n.geometry.applyMatrix4(n.matrixWorld),a.push(n.geometry)}));var c=THREE.BufferGeometryUtils.mergeBufferGeometries(a),u=new THREE.LineBasicMaterial({color:i});THREE.LineSegments.call(this,c,u),this.name="octreeHelper",a.forEach((function(e){e.dispose()}))},t.OctreeHelper.prototype=Object.create(THREE.LineSegments.prototype),t.OctreeHelper.prototype.constructor=t.OctreeHelper,t.getOctantsByLevels=function(e,t,n){for(var r=[];t<=n;){var i=e.findNodesByLevel(t)[Symbol.iterator]();if(i)for(var a=i.next();!a.done;)r.push(a.value),a=i.next();t++}return r},t.getLeafOctants=function(e,t){var n=[],r=e.leaves(),i=r.next();if(t=t||!0)for(;!i.done;)i.value.points&&n.push(i.value),i=r.next();else for(;!i.done;)n.push(i.value),i=r.next();return n},CanvasRenderingContext2D.prototype.clear=function(e){e&&(this.beginPath(),this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),e&&this.restore()},CanvasRenderingContext2D.prototype.circle=function(e,t,n){return this.beginPath(),this.moveTo(e+n,t),this.arc(e,t,n,0,2*Math.PI),this},CanvasRenderingContext2D.prototype.fillCircle=function(e,t,n,r){return r&&(this.fillStyle=r),this.circle(e,t,n).fill(),this},CanvasRenderingContext2D.prototype.strokeCircle=function(e,t,n,r){return r&&(this.strokeStyle=r),this.circle(e,t,n).stroke(),this},CanvasRenderingContext2D.prototype.roundRect=function(e,t,n,r,i){var a={tl:0,tr:0,bl:0,br:0};if("object"==typeof i)for(var o in i)a[o]=i[o];if("number"==typeof i)for(var o in a)a[o]=i;return this.beginPath(),this.moveTo(e+a.tl,t),this.lineTo(e+n-a.tr,t),this.quadraticCurveTo(e+n,t,e+n,t+a.tr),this.lineTo(e+n,t+r-a.br),this.quadraticCurveTo(e+n,t+r,e+n-a.br,t+r),this.lineTo(e+a.bl,t+r),this.quadraticCurveTo(e,t+r,e,t+r-a.bl),this.lineTo(e,t+a.tl),this.quadraticCurveTo(e,t,e+a.tl,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillRoundRect=function(e,t,n,r,i,a){return a&&(this.fillStyle=a),this.roundRect(e,t,n,r,i).fill(),this},CanvasRenderingContext2D.prototype.strokeRoundRect=function(e,t,n,r,i,a){return a&&(this.strokeStyle=a),this.roundRect(e,t,n,r,i).stroke(),this},CanvasRenderingContext2D.prototype.polygon=function(e,t){t>0&&(e=function(e,t){function n(e,t,n,r,i,a){var o=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),s=a?i/o:(o-i)/o;return[e+s*(n-e),t+s*(r-t)]}var r,i,a,o,s,l,c,u,h=e.length,d=new Array(h);for(i=0;i<h;i++)(r=i-1)<0&&(r=h-1),(a=i+1)==h&&(a=0),o=e[r],s=e[i],l=e[a],c=n(o[0],o[1],s[0],s[1],t,!1),u=n(s[0],s[1],l[0],l[1],t,!0),d[i]=[c[0],c[1],s[0],s[1],u[0],u[1]];return d}(e,t)),this.beginPath();for(var n=0,r=e.length;n<r;n++){var i=e[n];0==n?this.moveTo(i[0],i[1]):this.lineTo(i[0],i[1]),t>0&&this.quadraticCurveTo(i[2],i[3],i[4],i[5])}return this.closePath(),this},CanvasRenderingContext2D.prototype.fillPolygon=function(e,t,n){return n&&(this.fillStyle=n),this.polygon(e,t).fill(),this},CanvasRenderingContext2D.prototype.strokePolygon=function(e,t,n){return n&&(this.strokeStyle=n),this.polygon(e,t).stroke(),this},CanvasRenderingContext2D.prototype.speechBubble=function(e,t,n,r,i,a,o,s){e=e||0,n=n||1,r=r||1,i=i||.2*r,a=a||e+n/2,s=s||i;var l,c,u,h=e+n,d=(t=t||0)+r;return(o=o||t+r+i)<t||o>t+r?(l=Math.min(Math.max(e+i,a-s/2),h-i-s),c=Math.min(Math.max(e+i+s,a+s/2),h-i)):(l=Math.min(Math.max(t+i,o-s/2),d-i-s),c=Math.min(Math.max(t+i+s,o+s/2),d-i)),o<t&&(u=2),o>t&&(u=3),a<e&&o>=t&&o<=d&&(u=0),a>e&&o>=t&&o<=d&&(u=1),a>=e&&a<=h&&o>=t&&o<=d&&(u=-1),this.beginPath(),this.moveTo(e+i,t),2==u?(this.lineTo(l,t),this.lineTo(a,o),this.lineTo(c,t),this.lineTo(h-i,t)):this.lineTo(h-i,t),this.quadraticCurveTo(h,t,h,t+i),1==u?(this.lineTo(h,l),this.lineTo(a,o),this.lineTo(h,c),this.lineTo(h,d-i)):this.lineTo(h,d-i),this.quadraticCurveTo(h,d,h-i,d),3==u?(this.lineTo(c,d),this.lineTo(a,o),this.lineTo(l,d),this.lineTo(e+i,d)):this.lineTo(e+i,d),this.quadraticCurveTo(e,d,e,d-i),0==u?(this.lineTo(e,c),this.lineTo(a,o),this.lineTo(e,l),this.lineTo(e,t+i)):this.lineTo(e,t+i),this.quadraticCurveTo(e,t,e+i,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillSpeechBubble=function(e,t,n,r,i,a,o,s,l){return l&&(this.fillStyle=l),this.speechBubble(e,t,n,r,i,a,o,s).fill(),this},CanvasRenderingContext2D.prototype.strokeSpeechBubble=function(e,t,n,r,i,a,o,s,l){return l&&(this.strokeStyle=l),this.speechBubble(e,t,n,r,i,a,o,s).stroke(),this},t.createFaceVertexUVs=function(e){!e instanceof THREE.Geometry||(e.faceVertexUvs[0]=[],e.faces.forEach((function(t){var n=["x","y","z"].sort((function(e,n){return Math.abs(t.normal[e])>Math.abs(t.normal[n])})),r=e.vertices[t.a],i=e.vertices[t.b],a=e.vertices[t.c];e.faceVertexUvs[0].push([new THREE.Vector2(r[n[0]],r[n[1]]),new THREE.Vector2(i[n[0]],i[n[1]]),new THREE.Vector2(a[n[0]],a[n[1]])])})),e.uvsNeedUpdate=!0)},t.loadObject3D=function(e){const n=["position","rotation","quaternion","scale"];var r=Array.isArray(e)?e:[e];return r.forEach((e=>{void 0===e.object?e.object={type:"Mesh"}:void 0===e.object.type&&(e.object.type="Mesh")})),function(t){const r=[];return t.forEach((e=>{r.push(function(e){var t=e.object;if(e.url){const t=[i(e.url)];return Promise.all(t).then((t=>(t[0].name=e.url,t[0])))}if("Sprite"===t.type){const t=[o(e.material)];return Promise.all(t).then((e=>new THREE.Sprite(e[0])))}if("Points"===t.type||"Mesh"===t.type||"SkinnedMesh"===t.type||"Line"===t.type||"LineLoop"===t.type||"LineSegments"===t.type){const n=[a(e.geometry),o(e.material)];return Promise.all(n).then((e=>new THREE[t.type](e[0],e[1])))}return Promise.resolve(void 0)}(e))})),Promise.all(r).then((r=>(r.forEach(((e,r)=>{var i=t[r].object;Object.keys(i).map((t=>{"type"===t||(-1!==n.indexOf(t)?e[t].fromArray(i[t]):e[t]="userData"===t?JSON.parse(JSON.stringify(i[t])):"customDepthMaterial"===t||"customDistanceMaterial"===t?i[t].clone():i[t])}))})),Array.isArray(e)?Promise.resolve(r):Promise.resolve(r[0]))))}(r);function i(e){return e?new Promise((t=>{(new THREE.ObjectLoader).load(e,t)})):Promise.resolve(void 0)}function a(e){if(e){if(e instanceof THREE.BufferGeometry||e instanceof THREE.Geometry)return Promise.resolve(e);if(e.parameters)return new Promise((t=>{t(new THREE[e.type](...e.parameters))}));if(e.attributes){var t=new THREE.BufferGeometry;return Object.keys(e.attributes).map((n=>{t.setAttribute(n,new THREE.Float32BufferAttribute(e.attributes[n],3))})),e.index&&t.setIndex(e.index),Promise.resolve(t)}return Promise.resolve(void 0)}return Promise.resolve(void 0)}function o(e){if(e){var n;const r={},i=Object.keys(e).map((i=>{if("type"===i)n=e[i];else{if(-1!==t.TEXTURE_MAPS.indexOf(i))return function(e){if(!e)return Promise.resolve(null);return e.isTexture?Promise.resolve(e):"string"==typeof e?new Promise((t=>{(new THREE.TextureLoader).load(e,t)})):Promise.resolve(void 0)}(e[i]).then((e=>{r[i]=e}));r[i]=e[i]}}));return Promise.all(i).then((()=>new THREE[n](r)))}return Promise.resolve(void 0)}},t.loadTextures=function(e,t){var n=new THREE.TextureLoader,r=[];e.forEach((e=>{r.push(function(e,t){return new Promise((n=>{t.load(e,(e=>{n(e)}))}))}(e,n))})),Promise.all(r).then((e=>{t&&t(e)}))},THREE.Color.prototype.getHSV=function(e){void 0===e&&(console.warn("THREE.Color: .getHSV() target is now required"),e={h:0,s:0,v:0});var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),l=o,c=o-s;if(n=0===o?0:c/o,o===s)t=0;else{switch(o){case r:t=(i-a)/c+(i<a?6:0);break;case i:t=(a-r)/c+2;break;case a:t=(r-i)/c+4}t/=6}return e.h=t,e.s=n,e.v=l,e},THREE.Color.prototype.setHSV=function(e,t,n){var r,i,a,o=Math.floor(6*e),s=6*e-o,l=n*(1-t),c=n*(1-s*t),u=n*(1-(1-s)*t);switch(o%6){case 0:r=n,i=u,a=l;break;case 1:r=c,i=n,a=l;break;case 2:r=l,i=n,a=u;break;case 3:r=l,i=c,a=n;break;case 4:r=u,i=l,a=n;break;case 5:r=n,i=l,a=c}return this.r=r,this.g=i,this.b=a,this},THREE.Color.prototype.getHSI=function(e){void 0===e&&(console.warn("THREE.Color: .getHSI() target is now required"),e={h:0,s:0,i:0});var t,n,r=this.r,i=this.g,a=this.b,o=(r+i+a)/3;if(r===i&&i===a)t=0,n=0;else{var s=.5*(r-i+r-a)/Math.sqrt((r-i)*(r-i)+(r-a)*(i-a));if(s>1&&(s=1),s<-1&&(s=-1),(t=Math.acos(s))<0)return void console.warn("THREE.Color.getHSI(): hue < 0");a>i&&(t=2*Math.PI-t),t/=2*Math.PI,n=1-Math.min(r,i,a)/o}return e.h=t,e.s=n,e.i=o,e},THREE.Color.prototype.setHSI=function(e,t,n){if(t>1&&(t=1),n>1&&(n=1),0===t)this.r=this.g=this.b=n;else{var r,i,a,o=Math.PI/3;if((e*=2*Math.PI)>=0&&e<2*o)a=n*(1-t),i=3*n-((r=n*(1+t*Math.cos(e)/Math.cos(o-e)))+a);else if(e>=2*o&&e<4*o)e-=2*o,a=3*n-((r=n*(1-t))+(i=n*(1+t*Math.cos(e)/Math.cos(o-e))));else{if(!(e>=4*o&&e<6*o))return void console.warn("THREE.Color.setHSI: hue out of range");e-=4*o,i=n*(1-t),r=3*n-((a=n*(1+t*Math.cos(e)/Math.cos(o-e)))+i)}if(r<0||i<0||a<0)return void console.warn("THREE.Color.setHSI: r < 0, g < 0 or b < 0");this.r=Math.min(Math.max(r,0),1),this.g=Math.min(Math.max(i,0),1),this.b=Math.min(Math.max(a,0),1)}},THREE.Color.prototype.getLAB=function(e){void 0===e&&(console.warn("THREE.Color: .getLAB() target is now required"),e={l:0,a:0,b:0});var t,n,r,i=this.r,a=this.g,o=this.b;return n=(.2126*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.7152*(a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92)+.0722*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92))/1,r=(.0193*i+.1192*a+.9505*o)/1.08883,t=(t=(.4124*i+.3576*a+.1805*o)/.95047)>.008856?Math.pow(t,1/3):7.787*t+16/116,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,e.l=116*n-16,e.a=500*(t-n),e.b=200*(n-r),e.l=e.l/100,e.a=(e.a+128)/256,e.b=(e.b+128)/256,e},THREE.Color.prototype.setLAB=function(e,t,n){var r,i,a=((e*=100)+16)/116,o=(t=256*t-128)/500+a,s=a-(n=256*n-128)/200;i=-.9689*(o=.95047*(o*o*o>.008856?o*o*o:(o-16/116)/7.787))+1.8758*(a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787))+.0415*(s=1.08883*(s*s*s>.008856?s*s*s:(s-16/116)/7.787)),n=.0557*o+-.204*a+1.057*s,r=(r=3.2406*o+-1.5372*a+-.4986*s)>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,this.r=Math.max(0,Math.min(1,r)),this.g=Math.max(0,Math.min(1,i)),this.b=Math.max(0,Math.min(1,n))},THREE.PerspectiveCamera.prototype.getMousePosition=function(e,n,r,i){i=void 0!==i&&i;void 0===r&&(r=new THREE.Vector3);var a=Math.tan(.5*this.fov*THREE.Math.DEG2RAD)/this.zoom,o=t.lerp(this.near,this.far,n),s=o*a,l=this.aspect*s;return r.set(e.x*l,e.y*s,-o),!0===i&&this.localToWorld(r),r},THREE.Object3D.prototype.getColorDepthRT=(c=window.innerWidth,u=window.innerHeight,h=new THREE.WebGLRenderTarget(c,u,{stencilBuffer:!1,depthBuffer:!0,depthTexture:new THREE.DepthTexture}),d=new THREE.WebGLRenderTarget(c,u,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.FloatType}),f=new THREE.Scene,p=new THREE.OrthographicCamera(-1,1,1,-1,0,1),m=new THREE.ShaderMaterial({uniforms:{cameraNear:{value:null},cameraFar:{value:null},tDiffuse:{value:null},tDepth:{value:null}},vertexShader:"\n            varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n            }\n        ",fragmentShader:"\n            #include <packing>\n            varying vec2 vUv;\n            uniform sampler2D tDiffuse;\n            uniform sampler2D tDepth;\n            uniform float cameraNear;\n            uniform float cameraFar;\n            \n            float getOrthographicDepth( sampler2D depthTex, vec2 uv ) {\n            #ifdef RAYMARCH\n                return texture2D( depthTex, uv ).r;\n            #else\n                float fragCoordZ = texture2D( depthTex, uv ).r;\n                float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n                return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n            #endif\n            }\n            void main() {\n                gl_FragColor.rgb = texture2D( tDiffuse, vUv ).rgb;\n                gl_FragColor.a = getOrthographicDepth( tDepth, vUv );\n            }\n        "}),g=new THREE.PlaneBufferGeometry(2,2),f.add(new THREE.Mesh(g,m)),function(e){var n=t.appWorks,r=n.renderer;if(!r.extensions.get("WEBGL_depth_texture"))return console.warn("WEBGL_depth_texture: not supported on your computer..."),null;this.isRaymarch&&(m.defines={RAYMARCH:""});var i=n.scene;e=void 0!==e?e:n.camera,i.traverse((e=>{e.isLight||0!==e.children.length||(e.visible=!1)})),this.visible=!0,r.setRenderTarget(h),r.clear(),r.render(i,e);var a=m.uniforms;return a.cameraNear.value=e.near,a.cameraFar.value=e.far,a.tDiffuse.value=h.texture,a.tDepth.value=h.depthTexture,r.setRenderTarget(d),r.clear(),r.render(f,p),d}),THREE.Object3D.prototype.readColorDepthRTCube=function(){var e=new THREE.Vector3,n=[];n.push(new THREE.Vector3(-1,0,0)),n.push(new THREE.Vector3(1,0,0)),n.push(new THREE.Vector3(0,-1,0)),n.push(new THREE.Vector3(0,1,0)),n.push(new THREE.Vector3(0,0,-1)),n.push(new THREE.Vector3(0,0,1));var r=new THREE.PerspectiveCamera;return function(i,a){var o=t.appWorks.renderer;if(o.extensions.get("WEBGL_depth_texture")){r.copy(t.appWorks.camera),t.fitCameraToObject(this,r,!1);for(var s=Math.tan(.5*r.fov*THREE.Math.DEG2RAD)/r.zoom,l=.5*t.getObjectSize(this)/s*1.25,c={x:0,y:0},u=t.appWorks.dom.getBoundingClientRect(),h=new Float32Array(u.width*u.height*4),d=0;d<n.length;d++){r.position.subVectors(this.position,n[d].multiplyScalar(l)),r.lookAt(this.position);var f=this.getColorDepthRT(r);o.readRenderTargetPixels(f,0,0,u.width,u.height,h);for(var p=0,m=0;m<u.height;m++){c.y=2/(u.height-1)*m-1;for(var g=0;g<u.width;g++)c.x=2/(u.width-1)*g-1,h[p+3]<.99&&(r.getMousePosition(c,h[p+3],e,!0),i.push(e.x,e.y,e.z),a.push(h[p],h[p+1],h[p+2])),p+=4}}}else console.warn("WEBGL_depth_texture: not supported on your computer...")}}(),THREE.Object3D.prototype.readColorDepthRT=function(e,n){var r=t.appWorks.renderer,i=t.appWorks.camera;if(r.extensions.get("WEBGL_depth_texture")){var a={x:0,y:0},o=new THREE.Vector3,s=t.appWorks.dom.getBoundingClientRect(),l=new Float32Array(s.width*s.height*4),c=this.getColorDepthRT(i);r.readRenderTargetPixels(c,0,0,s.width,s.height,l);for(var u=0,h=0;h<s.height;h++){a.y=2/(s.height-1)*h-1;for(var d=0;d<s.width;d++)a.x=2/(s.width-1)*d-1,l[u+3]<.99&&(i.getMousePosition(a,l[u+3],o,!0),e.push(o.x,o.y,o.z),n.push(l[u],l[u+1],l[u+2])),u+=4}}else console.warn("WEBGL_depth_texture: not supported on your computer...")},THREE.Object3D.prototype.clonedToPoints=function(e,t){e=void 0!==e?e:.1;var n=[],r=[];(t=void 0===t||t)?this.readColorDepthRTCube(n,r):this.readColorDepthRT(n,r);var i=new THREE.BufferGeometry;i.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),i.setAttribute("color",new THREE.Float32BufferAttribute(r,3));var a=new THREE.PointsMaterial({size:e,vertexColors:THREE.VertexColors}),o=new THREE.Points(i,a);return o.name="clonedToPoints",o},THREE.Object3D.prototype.clonedToVoxels=function(e,n){e=void 0!==e?e:200;var r=[],i=[];(n=void 0===n||n)?this.readColorDepthRTCube(r,i):this.readColorDepthRT(r,i);var a,o,s,l,c,u,h,d,f,p=t.computeBoundingBox(this),m=p.getSize(new THREE.Vector3);l=c=u=Math.max(m.x,m.y,m.z)/e,a=p.min.x,o=p.min.y,s=p.min.z;for(var g,v={},y=[],_=[],b=0,E=r.length;b<E;b+=3)void 0===v[g=(h=~~((r[b]-a)/l))+"_"+(d=~~((r[b+1]-o)/c))+"_"+(f=~~((r[b+2]-s)/u))]&&(v[g]=!0,y.push(a+(h+.5)*l,o+(d+.5)*c,s+(f+.5)*u),_.push(i[b],i[b+1],i[b+2]));var w=t.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[l,c,u]},material:{type:"MeshLambertMaterial",map:(new THREE.TextureLoader).load("images/minecraft/grass.png"),wireframe:!0}}),x=t.createInstancedMeshes(w,{positions:y,colors:_});return x.name="clonedToVoxels",x},THREE.Object3D.prototype.rayIntersect=function(e,n){var r=t.appWorks,i=r.renderer,a=r.camera,o=r.raycaster;if(i.extensions.get("WEBGL_depth_texture")){e=void 0!==e?e:r.mouseUpPosition;var s=new THREE.Vector2,l=r.dom.getBoundingClientRect();s.x=(.5*e.x+.5)*l.width,s.y=(.5*e.y+.5)*l.height;var c=this.getColorDepthRT(),u=new Float32Array(4);i.readRenderTargetPixels(c,s.x,s.y,1,1,u);var h=new THREE.Vector3;a.getMousePosition(e,u[3],h);var d=h.length();o.ray.at(d,h),n.push({distance:d,point:h,object:this})}else console.warn("WEBGL_depth_texture: not supported on your computer...")},THREE.Object3D.prototype.getObjectsByProperty=function(e,t,n,r){void 0===r&&(r=[]);var i=this[e];void 0!==i&&i[t]===n&&r.push(this);for(var a=0,o=this.children.length;a<o;a++){this.children[a].getObjectsByProperty(e,t,n,r)}return r},THREE.Object3D.prototype.getObjectsByType=function(e,t){void 0===t&&(t=[]),this.type===e&&t.push(this);for(var n=0,r=this.children.length;n<r;n++){this.children[n].getObjectsByType(e,t)}return t},THREE.AmbientLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.PointLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.SpotLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.DirectionalLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.HemisphereLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.BufferGeometryUtils.mergeInstancedBufferAttribute=function(e){for(var t,n,r,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.InstancedBufferAttribute(s,n,r)};var y=function(){var e=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),t=[new Uint8Array([]),new Uint8Array([0,8,3]),new Uint8Array([0,1,9]),new Uint8Array([1,8,3,9,8,1]),new Uint8Array([1,2,10]),new Uint8Array([0,8,3,1,2,10]),new Uint8Array([9,2,10,0,2,9]),new Uint8Array([2,8,3,2,10,8,10,9,8]),new Uint8Array([3,11,2]),new Uint8Array([0,11,2,8,11,0]),new Uint8Array([1,9,0,2,3,11]),new Uint8Array([1,11,2,1,9,11,9,8,11]),new Uint8Array([3,10,1,11,10,3]),new Uint8Array([0,10,1,0,8,10,8,11,10]),new Uint8Array([3,9,0,3,11,9,11,10,9]),new Uint8Array([9,8,10,10,8,11]),new Uint8Array([4,7,8]),new Uint8Array([4,3,0,7,3,4]),new Uint8Array([0,1,9,8,4,7]),new Uint8Array([4,1,9,4,7,1,7,3,1]),new Uint8Array([1,2,10,8,4,7]),new Uint8Array([3,4,7,3,0,4,1,2,10]),new Uint8Array([9,2,10,9,0,2,8,4,7]),new Uint8Array([2,10,9,2,9,7,2,7,3,7,9,4]),new Uint8Array([8,4,7,3,11,2]),new Uint8Array([11,4,7,11,2,4,2,0,4]),new Uint8Array([9,0,1,8,4,7,2,3,11]),new Uint8Array([4,7,11,9,4,11,9,11,2,9,2,1]),new Uint8Array([3,10,1,3,11,10,7,8,4]),new Uint8Array([1,11,10,1,4,11,1,0,4,7,11,4]),new Uint8Array([4,7,8,9,0,11,9,11,10,11,0,3]),new Uint8Array([4,7,11,4,11,9,9,11,10]),new Uint8Array([9,5,4]),new Uint8Array([9,5,4,0,8,3]),new Uint8Array([0,5,4,1,5,0]),new Uint8Array([8,5,4,8,3,5,3,1,5]),new Uint8Array([1,2,10,9,5,4]),new Uint8Array([3,0,8,1,2,10,4,9,5]),new Uint8Array([5,2,10,5,4,2,4,0,2]),new Uint8Array([2,10,5,3,2,5,3,5,4,3,4,8]),new Uint8Array([9,5,4,2,3,11]),new Uint8Array([0,11,2,0,8,11,4,9,5]),new Uint8Array([0,5,4,0,1,5,2,3,11]),new Uint8Array([2,1,5,2,5,8,2,8,11,4,8,5]),new Uint8Array([10,3,11,10,1,3,9,5,4]),new Uint8Array([4,9,5,0,8,1,8,10,1,8,11,10]),new Uint8Array([5,4,0,5,0,11,5,11,10,11,0,3]),new Uint8Array([5,4,8,5,8,10,10,8,11]),new Uint8Array([9,7,8,5,7,9]),new Uint8Array([9,3,0,9,5,3,5,7,3]),new Uint8Array([0,7,8,0,1,7,1,5,7]),new Uint8Array([1,5,3,3,5,7]),new Uint8Array([9,7,8,9,5,7,10,1,2]),new Uint8Array([10,1,2,9,5,0,5,3,0,5,7,3]),new Uint8Array([8,0,2,8,2,5,8,5,7,10,5,2]),new Uint8Array([2,10,5,2,5,3,3,5,7]),new Uint8Array([7,9,5,7,8,9,3,11,2]),new Uint8Array([9,5,7,9,7,2,9,2,0,2,7,11]),new Uint8Array([2,3,11,0,1,8,1,7,8,1,5,7]),new Uint8Array([11,2,1,11,1,7,7,1,5]),new Uint8Array([9,5,8,8,5,7,10,1,3,10,3,11]),new Uint8Array([5,7,0,5,0,9,7,11,0,1,0,10,11,10,0]),new Uint8Array([11,10,0,11,0,3,10,5,0,8,0,7,5,7,0]),new Uint8Array([11,10,5,7,11,5]),new Uint8Array([10,6,5]),new Uint8Array([0,8,3,5,10,6]),new Uint8Array([9,0,1,5,10,6]),new Uint8Array([1,8,3,1,9,8,5,10,6]),new Uint8Array([1,6,5,2,6,1]),new Uint8Array([1,6,5,1,2,6,3,0,8]),new Uint8Array([9,6,5,9,0,6,0,2,6]),new Uint8Array([5,9,8,5,8,2,5,2,6,3,2,8]),new Uint8Array([2,3,11,10,6,5]),new Uint8Array([11,0,8,11,2,0,10,6,5]),new Uint8Array([0,1,9,2,3,11,5,10,6]),new Uint8Array([5,10,6,1,9,2,9,11,2,9,8,11]),new Uint8Array([6,3,11,6,5,3,5,1,3]),new Uint8Array([0,8,11,0,11,5,0,5,1,5,11,6]),new Uint8Array([3,11,6,0,3,6,0,6,5,0,5,9]),new Uint8Array([6,5,9,6,9,11,11,9,8]),new Uint8Array([5,10,6,4,7,8]),new Uint8Array([4,3,0,4,7,3,6,5,10]),new Uint8Array([1,9,0,5,10,6,8,4,7]),new Uint8Array([10,6,5,1,9,7,1,7,3,7,9,4]),new Uint8Array([6,1,2,6,5,1,4,7,8]),new Uint8Array([1,2,5,5,2,6,3,0,4,3,4,7]),new Uint8Array([8,4,7,9,0,5,0,6,5,0,2,6]),new Uint8Array([7,3,9,7,9,4,3,2,9,5,9,6,2,6,9]),new Uint8Array([3,11,2,7,8,4,10,6,5]),new Uint8Array([5,10,6,4,7,2,4,2,0,2,7,11]),new Uint8Array([0,1,9,4,7,8,2,3,11,5,10,6]),new Uint8Array([9,2,1,9,11,2,9,4,11,7,11,4,5,10,6]),new Uint8Array([8,4,7,3,11,5,3,5,1,5,11,6]),new Uint8Array([5,1,11,5,11,6,1,0,11,7,11,4,0,4,11]),new Uint8Array([0,5,9,0,6,5,0,3,6,11,6,3,8,4,7]),new Uint8Array([6,5,9,6,9,11,4,7,9,7,11,9]),new Uint8Array([10,4,9,6,4,10]),new Uint8Array([4,10,6,4,9,10,0,8,3]),new Uint8Array([10,0,1,10,6,0,6,4,0]),new Uint8Array([8,3,1,8,1,6,8,6,4,6,1,10]),new Uint8Array([1,4,9,1,2,4,2,6,4]),new Uint8Array([3,0,8,1,2,9,2,4,9,2,6,4]),new Uint8Array([0,2,4,4,2,6]),new Uint8Array([8,3,2,8,2,4,4,2,6]),new Uint8Array([10,4,9,10,6,4,11,2,3]),new Uint8Array([0,8,2,2,8,11,4,9,10,4,10,6]),new Uint8Array([3,11,2,0,1,6,0,6,4,6,1,10]),new Uint8Array([6,4,1,6,1,10,4,8,1,2,1,11,8,11,1]),new Uint8Array([9,6,4,9,3,6,9,1,3,11,6,3]),new Uint8Array([8,11,1,8,1,0,11,6,1,9,1,4,6,4,1]),new Uint8Array([3,11,6,3,6,0,0,6,4]),new Uint8Array([6,4,8,11,6,8]),new Uint8Array([7,10,6,7,8,10,8,9,10]),new Uint8Array([0,7,3,0,10,7,0,9,10,6,7,10]),new Uint8Array([10,6,7,1,10,7,1,7,8,1,8,0]),new Uint8Array([10,6,7,10,7,1,1,7,3]),new Uint8Array([1,2,6,1,6,8,1,8,9,8,6,7]),new Uint8Array([2,6,9,2,9,1,6,7,9,0,9,3,7,3,9]),new Uint8Array([7,8,0,7,0,6,6,0,2]),new Uint8Array([7,3,2,6,7,2]),new Uint8Array([2,3,11,10,6,8,10,8,9,8,6,7]),new Uint8Array([2,0,7,2,7,11,0,9,7,6,7,10,9,10,7]),new Uint8Array([1,8,0,1,7,8,1,10,7,6,7,10,2,3,11]),new Uint8Array([11,2,1,11,1,7,10,6,1,6,7,1]),new Uint8Array([8,9,6,8,6,7,9,1,6,11,6,3,1,3,6]),new Uint8Array([0,9,1,11,6,7]),new Uint8Array([7,8,0,7,0,6,3,11,0,11,6,0]),new Uint8Array([7,11,6]),new Uint8Array([7,6,11]),new Uint8Array([3,0,8,11,7,6]),new Uint8Array([0,1,9,11,7,6]),new Uint8Array([8,1,9,8,3,1,11,7,6]),new Uint8Array([10,1,2,6,11,7]),new Uint8Array([1,2,10,3,0,8,6,11,7]),new Uint8Array([2,9,0,2,10,9,6,11,7]),new Uint8Array([6,11,7,2,10,3,10,8,3,10,9,8]),new Uint8Array([7,2,3,6,2,7]),new Uint8Array([7,0,8,7,6,0,6,2,0]),new Uint8Array([2,7,6,2,3,7,0,1,9]),new Uint8Array([1,6,2,1,8,6,1,9,8,8,7,6]),new Uint8Array([10,7,6,10,1,7,1,3,7]),new Uint8Array([10,7,6,1,7,10,1,8,7,1,0,8]),new Uint8Array([0,3,7,0,7,10,0,10,9,6,10,7]),new Uint8Array([7,6,10,7,10,8,8,10,9]),new Uint8Array([6,8,4,11,8,6]),new Uint8Array([3,6,11,3,0,6,0,4,6]),new Uint8Array([8,6,11,8,4,6,9,0,1]),new Uint8Array([9,4,6,9,6,3,9,3,1,11,3,6]),new Uint8Array([6,8,4,6,11,8,2,10,1]),new Uint8Array([1,2,10,3,0,11,0,6,11,0,4,6]),new Uint8Array([4,11,8,4,6,11,0,2,9,2,10,9]),new Uint8Array([10,9,3,10,3,2,9,4,3,11,3,6,4,6,3]),new Uint8Array([8,2,3,8,4,2,4,6,2]),new Uint8Array([0,4,2,4,6,2]),new Uint8Array([1,9,0,2,3,4,2,4,6,4,3,8]),new Uint8Array([1,9,4,1,4,2,2,4,6]),new Uint8Array([8,1,3,8,6,1,8,4,6,6,10,1]),new Uint8Array([10,1,0,10,0,6,6,0,4]),new Uint8Array([4,6,3,4,3,8,6,10,3,0,3,9,10,9,3]),new Uint8Array([10,9,4,6,10,4]),new Uint8Array([4,9,5,7,6,11]),new Uint8Array([0,8,3,4,9,5,11,7,6]),new Uint8Array([5,0,1,5,4,0,7,6,11]),new Uint8Array([11,7,6,8,3,4,3,5,4,3,1,5]),new Uint8Array([9,5,4,10,1,2,7,6,11]),new Uint8Array([6,11,7,1,2,10,0,8,3,4,9,5]),new Uint8Array([7,6,11,5,4,10,4,2,10,4,0,2]),new Uint8Array([3,4,8,3,5,4,3,2,5,10,5,2,11,7,6]),new Uint8Array([7,2,3,7,6,2,5,4,9]),new Uint8Array([9,5,4,0,8,6,0,6,2,6,8,7]),new Uint8Array([3,6,2,3,7,6,1,5,0,5,4,0]),new Uint8Array([6,2,8,6,8,7,2,1,8,4,8,5,1,5,8]),new Uint8Array([9,5,4,10,1,6,1,7,6,1,3,7]),new Uint8Array([1,6,10,1,7,6,1,0,7,8,7,0,9,5,4]),new Uint8Array([4,0,10,4,10,5,0,3,10,6,10,7,3,7,10]),new Uint8Array([7,6,10,7,10,8,5,4,10,4,8,10]),new Uint8Array([6,9,5,6,11,9,11,8,9]),new Uint8Array([3,6,11,0,6,3,0,5,6,0,9,5]),new Uint8Array([0,11,8,0,5,11,0,1,5,5,6,11]),new Uint8Array([6,11,3,6,3,5,5,3,1]),new Uint8Array([1,2,10,9,5,11,9,11,8,11,5,6]),new Uint8Array([0,11,3,0,6,11,0,9,6,5,6,9,1,2,10]),new Uint8Array([11,8,5,11,5,6,8,0,5,10,5,2,0,2,5]),new Uint8Array([6,11,3,6,3,5,2,10,3,10,5,3]),new Uint8Array([5,8,9,5,2,8,5,6,2,3,8,2]),new Uint8Array([9,5,6,9,6,0,0,6,2]),new Uint8Array([1,5,8,1,8,0,5,6,8,3,8,2,6,2,8]),new Uint8Array([1,5,6,2,1,6]),new Uint8Array([1,3,6,1,6,10,3,8,6,5,6,9,8,9,6]),new Uint8Array([10,1,0,10,0,6,9,5,0,5,6,0]),new Uint8Array([0,3,8,5,6,10]),new Uint8Array([10,5,6]),new Uint8Array([11,5,10,7,5,11]),new Uint8Array([11,5,10,11,7,5,8,3,0]),new Uint8Array([5,11,7,5,10,11,1,9,0]),new Uint8Array([10,7,5,10,11,7,9,8,1,8,3,1]),new Uint8Array([11,1,2,11,7,1,7,5,1]),new Uint8Array([0,8,3,1,2,7,1,7,5,7,2,11]),new Uint8Array([9,7,5,9,2,7,9,0,2,2,11,7]),new Uint8Array([7,5,2,7,2,11,5,9,2,3,2,8,9,8,2]),new Uint8Array([2,5,10,2,3,5,3,7,5]),new Uint8Array([8,2,0,8,5,2,8,7,5,10,2,5]),new Uint8Array([9,0,1,5,10,3,5,3,7,3,10,2]),new Uint8Array([9,8,2,9,2,1,8,7,2,10,2,5,7,5,2]),new Uint8Array([1,3,5,3,7,5]),new Uint8Array([0,8,7,0,7,1,1,7,5]),new Uint8Array([9,0,3,9,3,5,5,3,7]),new Uint8Array([9,8,7,5,9,7]),new Uint8Array([5,8,4,5,10,8,10,11,8]),new Uint8Array([5,0,4,5,11,0,5,10,11,11,3,0]),new Uint8Array([0,1,9,8,4,10,8,10,11,10,4,5]),new Uint8Array([10,11,4,10,4,5,11,3,4,9,4,1,3,1,4]),new Uint8Array([2,5,1,2,8,5,2,11,8,4,5,8]),new Uint8Array([0,4,11,0,11,3,4,5,11,2,11,1,5,1,11]),new Uint8Array([0,2,5,0,5,9,2,11,5,4,5,8,11,8,5]),new Uint8Array([9,4,5,2,11,3]),new Uint8Array([2,5,10,3,5,2,3,4,5,3,8,4]),new Uint8Array([5,10,2,5,2,4,4,2,0]),new Uint8Array([3,10,2,3,5,10,3,8,5,4,5,8,0,1,9]),new Uint8Array([5,10,2,5,2,4,1,9,2,9,4,2]),new Uint8Array([8,4,5,8,5,3,3,5,1]),new Uint8Array([0,4,5,1,0,5]),new Uint8Array([8,4,5,8,5,3,9,0,5,0,3,5]),new Uint8Array([9,4,5]),new Uint8Array([4,11,7,4,9,11,9,10,11]),new Uint8Array([0,8,3,4,9,7,9,11,7,9,10,11]),new Uint8Array([1,10,11,1,11,4,1,4,0,7,4,11]),new Uint8Array([3,1,4,3,4,8,1,10,4,7,4,11,10,11,4]),new Uint8Array([4,11,7,9,11,4,9,2,11,9,1,2]),new Uint8Array([9,7,4,9,11,7,9,1,11,2,11,1,0,8,3]),new Uint8Array([11,7,4,11,4,2,2,4,0]),new Uint8Array([11,7,4,11,4,2,8,3,4,3,2,4]),new Uint8Array([2,9,10,2,7,9,2,3,7,7,4,9]),new Uint8Array([9,10,7,9,7,4,10,2,7,8,7,0,2,0,7]),new Uint8Array([3,7,10,3,10,2,7,4,10,1,10,0,4,0,10]),new Uint8Array([1,10,2,8,7,4]),new Uint8Array([4,9,1,4,1,7,7,1,3]),new Uint8Array([4,9,1,4,1,7,0,8,1,8,7,1]),new Uint8Array([4,0,3,7,4,3]),new Uint8Array([4,8,7]),new Uint8Array([9,10,8,10,11,8]),new Uint8Array([3,0,9,3,9,11,11,9,10]),new Uint8Array([0,1,10,0,10,8,8,10,11]),new Uint8Array([3,1,10,11,3,10]),new Uint8Array([1,2,11,1,11,9,9,11,8]),new Uint8Array([3,0,9,3,9,11,1,2,9,2,11,9]),new Uint8Array([0,2,11,8,0,11]),new Uint8Array([3,2,11]),new Uint8Array([2,3,8,2,8,10,10,8,9]),new Uint8Array([9,10,2,0,9,2]),new Uint8Array([2,3,8,2,8,10,0,1,8,1,10,8]),new Uint8Array([1,10,2]),new Uint8Array([1,3,8,9,1,8]),new Uint8Array([0,9,1]),new Uint8Array([0,3,8]),new Uint8Array([])],n=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],r=[new Uint8Array([0,1]),new Uint8Array([1,2]),new Uint8Array([2,3]),new Uint8Array([3,0]),new Uint8Array([4,5]),new Uint8Array([5,6]),new Uint8Array([6,7]),new Uint8Array([7,4]),new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7])],i=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],a=[new Uint8Array([0,2,3,7]),new Uint8Array([0,6,2,7]),new Uint8Array([0,4,6,7]),new Uint8Array([0,6,1,2]),new Uint8Array([0,1,6,4]),new Uint8Array([5,6,1,4])],o=new Int32Array(24),s=new Int32Array(256);!function(){for(var e=0,t=0;t<8;++t)for(var n=1;n<=4;n<<=1){var r=t^n;t<=r&&(o[e++]=t,o[e++]=r)}for(t=0;t<256;++t){var i=0;for(n=0;n<24;n+=2){i|=!!(t&1<<o[n])!==!!(t&1<<o[n+1])?1<<(n>>1):0}s[t]=i}}();var l=new Array(4096);!function(){for(var e=0;e<l.length;++e)l[e]=0}();var c=[],u=function(e,t,n){var r=0;return r+=e[0],r+=c[1]*e[1],n[r+=c[2]*e[2]]};return{marchingCubes:function(i,a,o,s){s=s||0,c=[1,i[0],i[0]*i[1]],o||(o=[[0,0,0],i]);for(var l=[0,0,0],h=[0,0,0],d=0;d<3;++d)l[d]=(o[1][d]-o[0][d])/i[d],h[d]=o[0][d];var f=[],p=[],m=0,g=new Array(8),v=new Array(12),y=[0,0,0];for(y[2]=0;y[2]<i[2]-1;++y[2],m+=i[0])for(y[1]=0;y[1]<i[1]-1;++y[1],++m)for(y[0]=0;y[0]<i[0]-1;++y[0],++m){var _=0;if("function"==typeof a)for(d=0;d<8;++d){var b=n[d],E=a(l[0]*(y[0]+b[0])+h[0],l[1]*(y[1]+b[1])+h[1],l[2]*(y[2]+b[2])+h[2])-s;g[d]=E,_|=E>0?1<<d:0}else for(d=0;d<8;++d){b=n[d],E=u([y[0]+b[0],y[1]+b[1],y[2]+b[2]],0,a)-s;g[d]=E,_|=E>0?1<<d:0}var w=e[_];if(0!==w){for(d=0;d<12;++d)if(0!=(w&1<<d)){v[d]=f.length;var x=[0,0,0],T=r[d],A=n[T[0]],M=n[T[1]],S=g[T[0]],R=S-g[T[1]],k=0;Math.abs(R)>1e-6&&(k=S/R);for(var P=0;P<3;++P)x[P]=l[P]*(y[P]+A[P]+k*(M[P]-A[P]))+h[P];f.push(x)}var L=t[_];for(d=0;d<L.length;d+=3)p.push([v[L[d]],v[L[d+1]],v[L[d+2]]])}}return{vertices:f,faces:p}},marchingTetrahedra:function(e,t,n,r){r=r||0,c=[1,e[0],e[0]*e[1]],n||(n=[[0,0,0],e]);for(var o=[0,0,0],s=[0,0,0],l=0;l<3;++l)o[l]=(n[1][l]-n[0][l])/e[l],s[l]=n[0][l];var h=[],d=[],f=0,p=new Float32Array(8),m=[0,0,0];function g(e,t){var n=p[e],r=p[t],a=i[e],l=i[t],c=[m[0],m[1],m[2]],u=n-r;Math.abs(u)>1e-6&&(u=n/u);for(var d=0;d<3;++d)c[d]=o[d]*(c[d]+a[d]+u*(l[d]-a[d]))+s[d];return h.push(c),h.length-1}for(m[2]=0;m[2]<e[2]-1;++m[2],f+=e[0])for(m[1]=0;m[1]<e[1]-1;++m[1],++f)for(m[0]=0;m[0]<e[0]-1;++m[0],++f){if("function"==typeof t)for(l=0;l<8;++l){var v=i[l];p[l]=t(o[0]*(m[0]+v[0])+s[0],o[1]*(m[1]+v[1])+s[1],o[2]*(m[2]+v[2])+s[2])-r}else for(l=0;l<8;++l){v=i[l];p[l]=u([m[0]+v[0],m[1]+v[1],m[2]+v[2]],0,t)-r}for(l=0;l<a.length;++l){var y=a[l],_=0;switch(p[y[0]]<0&&(_|=1),p[y[1]]<0&&(_|=2),p[y[2]]<0&&(_|=4),p[y[3]]<0&&(_|=8),_){case 0:case 15:break;case 14:d.push([g(y[0],y[1]),g(y[0],y[3]),g(y[0],y[2])]);break;case 1:d.push([g(y[0],y[1]),g(y[0],y[2]),g(y[0],y[3])]);break;case 13:d.push([g(y[1],y[0]),g(y[1],y[2]),g(y[1],y[3])]);break;case 2:d.push([g(y[1],y[0]),g(y[1],y[3]),g(y[1],y[2])]);break;case 12:d.push([g(y[1],y[2]),g(y[1],y[3]),g(y[0],y[3]),g(y[0],y[2])]);break;case 3:d.push([g(y[1],y[2]),g(y[0],y[2]),g(y[0],y[3]),g(y[1],y[3])]);break;case 4:d.push([g(y[2],y[0]),g(y[2],y[1]),g(y[2],y[3])]);break;case 11:d.push([g(y[2],y[0]),g(y[2],y[3]),g(y[2],y[1])]);break;case 5:d.push([g(y[0],y[1]),g(y[1],y[2]),g(y[2],y[3]),g(y[0],y[3])]);break;case 10:d.push([g(y[0],y[1]),g(y[0],y[3]),g(y[2],y[3]),g(y[1],y[2])]);break;case 6:d.push([g(y[2],y[3]),g(y[0],y[2]),g(y[0],y[1]),g(y[1],y[3])]);break;case 9:d.push([g(y[2],y[3]),g(y[1],y[3]),g(y[0],y[1]),g(y[0],y[2])]);break;case 7:d.push([g(y[3],y[0]),g(y[3],y[1]),g(y[3],y[2])]);break;case 8:d.push([g(y[3],y[0]),g(y[3],y[2]),g(y[3],y[1])])}}}return{vertices:h,faces:d}},surfaceNets:function(e,t,n,r){r=r||0,c=[1,e[0],e[0]*e[1]],n||(n=[[0,0,0],e]);for(var i=[0,0,0],a=[0,0,0],h=0;h<3;++h)i[h]=(n[1][h]-n[0][h])/e[h],a[h]=n[0][h];var d=[],f=[],p=[0,0,0],m=[1,e[0]+1,(e[0]+1)*(e[1]+1)],g=[0,0,0,0,0,0,0,0],v=1;if(2*m[2]>l.length){var y=l.length;for(l.length=2*m[2];y<l.length;)l[y++]=0}for(p[2]=0;p[2]<e[2]-1;++p[2],e[0],v^=1,m[2]=-m[2]){var _=1+(e[0]+1)*(1+v*(e[1]+1));for(p[1]=0;p[1]<e[1]-1;++p[1],_+=2)for(p[0]=0;p[0]<e[0]-1;++p[0],++_){var b=0,E=0;if("function"==typeof t)for(var w=0;w<2;++w)for(var x=0;x<2;++x)for(h=0;h<2;++h,++E){var T=t(i[0]*(p[0]+h)+a[0],i[1]*(p[1]+x)+a[1],i[2]*(p[2]+w)+a[2])-r;g[E]=T,b|=T<0?1<<E:0}else for(w=0;w<2;++w)for(x=0;x<2;++x)for(h=0;h<2;++h,++E){T=u([p[0]+h,p[1]+x,p[2]+w],0,t)-r;g[E]=T,b|=T<0?1<<E:0}if(0!==b&&255!==b){var A=s[b],M=[0,0,0],S=0;for(h=0;h<12;++h)if(A&1<<h){++S;var R=o[h<<1],k=o[1+(h<<1)],P=g[R],L=P-g[k];if(Math.abs(L)>1e-6){L=P/L;for(x=0,w=1;x<3;++x,w<<=1){var C=R&w,I=k&w;M[x]+=C!==I?C?1-L:L:C?1:0}}}var N=1/S;for(h=0;h<3;++h)M[h]=i[h]*(p[h]+N*M[h])+a[h];l[_]=d.length,d.push(M);for(h=0;h<3;++h)if(A&1<<h){var F=(h+1)%3,O=(h+2)%3;if(0!==p[F]&&0!==p[O]){var H=m[F],D=m[O];1&b?(f.push([l[_],l[_-H],l[_-D]]),f.push([l[_-D],l[_-H],l[_-H-D]])):(f.push([l[_],l[_-D],l[_-H]]),f.push([l[_-H],l[_-D],l[_-H-D]]))}}}}}return{vertices:d,faces:f}}}},_=__webpack_require__(6549),b=__webpack_require__.n(_),E=__webpack_require__(3108),w={};w.sample=__webpack_require__(1471),w.vol2Msh=__webpack_require__(8596),w.rasterize=__webpack_require__(1844),w.voxelize=__webpack_require__(2446),w.normals=__webpack_require__(3794),w.spatialGrid=__webpack_require__(6195),w.signedDistance=__webpack_require__(3114),w.convexHull=__webpack_require__(1690),w.pointInPolygon=__webpack_require__(8371),w.haarTree=__webpack_require__(579),w.refineMesh=__webpack_require__(8670),w.fixMesh=__webpack_require__(9852),w.smoothVertices=__webpack_require__(7619),w.deformLaplacian=__webpack_require__(7065),w.loopSubdivide=__webpack_require__(1255),w.meanCurvature=__webpack_require__(8570),w.alphaShape=__webpack_require__(1591),w.geodesicDistance=__webpack_require__(3190).j,w.hull2D=__webpack_require__(4787),w.fft=__webpack_require__(3071),w.gaussBlur=__webpack_require__(6667),w.pool=__webpack_require__(4964),w.ndarray=__webpack_require__(2917),w.ndarrayOps=__webpack_require__(1641);class x extends THREE.BufferGeometry{constructor(e,n,r,i,a){super();e=e||32,n=n||[[-1,-1,-1],[1,1,1]],a=a||"surfaceNets",i=i||0;var o=new THREE.Geometry;if("number"==typeof e){_=n[1][0]-n[0][0],b=n[1][1]-n[0][1],E=n[1][2]-n[0][2];var s=Math.max(_,b,E)/e;(e=[])[0]=Math.max(~~(_/s),4),e[1]=Math.max(~~(b/s),4),e[2]=Math.max(~~(E/s),4)}var l,c,u,h=new y;switch(a){case"surfaceNets":l=h.surfaceNets(e,r,n,i);break;case"marchingCubes":l=h.marchingCubes(e,r,n,i);break;case"marchingTetrahedra":l=h.marchingTetrahedra(e,r,n,i)}for(var d=0;d<l.vertices.length;++d)c=l.vertices[d],o.vertices.push(new THREE.Vector3(c[0],c[1],c[2]));for(d=0;d<l.faces.length;++d)3===(u=l.faces[d]).length?o.faces.push(new THREE.Face3(u[0],u[1],u[2])):4===u.length&&(o.faces.push(new THREE.Face3(u[0],u[1],u[2])),o.faces.push(new THREE.Face3(u[0],u[2],u[3])));if(o.mergeVertices(),"function"==typeof r){for(var f,p,m,g,v=.001,_=new THREE.Vector3(v,0,0),b=new THREE.Vector3(0,v,0),E=new THREE.Vector3(0,0,v),w=new THREE.Vector3,x=[],T=(d=0,o.vertices.length);d<T;d++)c=o.vertices[d],f=A(w.addVectors(c,_))-A(w.subVectors(c,_)),p=A(w.addVectors(c,b))-A(w.subVectors(c,b)),m=A(w.addVectors(c,E))-A(w.subVectors(c,E)),g=new THREE.Vector3(f,p,m).normalize(),x.push(g);for(d=0,T=o.faces.length;d<T;d++)(u=o.faces[d]).vertexNormals=[x[u.a],x[u.b],x[u.c]];function A(e){return r(e.x,e.y,e.z)}}else o.computeVertexNormals();t.createFaceVertexUVs(o),this.copy(o.toBufferGeometry())}}x.prototype.isIsosurfaceGeometry=!0,t.IsosurfaceGeometry=x;class T extends THREE.BufferGeometry{constructor(e,t){super();var n=null;"xz"===(t=(t||"xz").toLowerCase())?n=b().from(e.map((e=>[e.x,e.z]))):"xy"===t?n=b().from(e.map((e=>[e.x,e.y]))):"yz"===t&&(n=b().from(e.map((e=>[e.y,e.z]))));var r=new Uint16Array(n.triangles);this.setIndex(new THREE.BufferAttribute(r,1)),this.setFromPoints(e),this.computeVertexNormals()}}T.prototype.isUDelaunayGeometry=!0,t.UDelaunayGeometry=T;class A extends THREE.BufferGeometry{constructor(e,n,r){super();n=n||[],r=r||[];var i=0;e.forEach((e=>{e.id=i++}));var a=new E.SweepContext(e);n.length>0&&(n.forEach((e=>{e.forEach((e=>{e.id=i++}))})),a.addHoles(n)),r.length>0&&(r.forEach((e=>{e.id=i++})),a.addPoints(r)),a.triangulate();var o=a.getTriangles(),s=[];o.forEach((e=>{e.getPoints().forEach((e=>{s.push(e.id)}))})),this.setIndex(new THREE.Uint16BufferAttribute(s,1));var l=e.concat(n,r);l=t.flattenArray(l),this.setFromPoints(l),this.computeVertexNormals()}}A.prototype.isCDelaunayGeometry=!0,t.CDelaunayGeometry=A,t.simplifyGeometry=function(e,n){n=n||.5;if(!e.isGeometry&&!e.isBufferGeometry)return null;e=t.toGeometry(e);var r=Math.floor(e.vertices.length*n);return(e=(new THREE.SimplifyModifier).modify(e,r)).computeVertexNormals(),e},t.subdivideGeometry=function(e,t){t=t||1;return e.isGeometry||e.isBufferGeometry?e=new THREE.SubdivisionModifier(t).modify(e):null};class M extends THREE.BufferGeometry{constructor(e,t,n,r,i,a){super();var o=new THREE.Geometry;e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var s,l,c=[],u=e,h=(t-e)/(r=void 0!==r?Math.max(1,r):1);for(s=0;s<r+1;s++){for(l=0;l<n+1;l++){var d=new THREE.Vector3,f=i+l/n*a;d.x=u*Math.cos(f),d.z=u*Math.sin(f),o.vertices.push(d),c.push(new THREE.Vector2(l/n,s/r))}u+=h}var p=new THREE.Vector3(1,0,0);for(s=0;s<r;s++){var m=s*(n+1);for(l=0;l<n;l++){var g=f=l+m,v=f+n+1,y=f+n+2;o.faces.push(new THREE.Face3(g,v,y,[p.clone(),p.clone(),p.clone()])),o.faceVertexUvs[0].push([c[g].clone(),c[v].clone(),c[y].clone()]),g=f,v=f+n+2,y=f+1,o.faces.push(new THREE.Face3(g,v,y,[p.clone(),p.clone(),p.clone()])),o.faceVertexUvs[0].push([c[g].clone(),c[v].clone(),c[y].clone()])}}this.copy(o.toBufferGeometry())}}M.prototype.isRingGeometry=!0,t.RingGeometry=M,t.computeChildVertexFaceAmount=function(e){var t=0,n=0,r=0;return e.traverse((function(e){if(t++,e.isMesh){var i=1;!0===e.isInstancedMesh&&(i=e.count);var a=e.geometry;a.isGeometry?(n+=a.vertices.length,r+=a.faces.length):a.isBufferGeometry&&(n+=a.attributes.position.count*i,null!==a.index?r+=a.index.count/3*i:r+=a.attributes.position.count/3*i)}})),{objects:t,vertices:n,faces:r}},t.computeMassProperties=function(e){var t=0,n=0;return e.traverse((function(e){if(e.isMesh){var i=function(e){var t=0,n=0,i=new THREE.Triangle,a=e.geometry;if(a.isGeometry){if(a.faces.length<1)return{area:0,volume:0};var o=a.vertices;a.faces.forEach((function(e){t+=i.set(o[e.a],o[e.b],o[e.c]).getArea(),n+=r(o[e.a],o[e.b],o[e.c])}))}else if(a.isBufferGeometry){var s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;if(a.index){if(a.index.count<3)return{area:0,volume:0};for(var u,h,d,f=a.attributes.position.array,p=a.index.array,m=0,g=a.index.count;m<g;m+=3)u=p[m+0],h=p[m+1],d=p[m+2],s.set(f[3*u],f[3*u+1],f[3*u+2]),l.set(f[3*h],f[3*h+1],f[3*h+2]),c.set(f[3*d],f[3*d+1],f[3*d+2]),t+=i.set(s,l,c).getArea(),n+=r(s,l,c)}else{if(a.attributes.position.count<3)return{area:0,volume:0};f=a.attributes.position.array;var v=3*a.attributes.position.count;for(m=0;m<v;m+=9)s.set(f[m+0],f[m+1],f[m+2]),l.set(f[m+3],f[m+4],f[m+5]),c.set(f[m+6],f[m+7],f[m+8]),t+=i.set(s,l,c).getArea(),n+=r(s,l,c)}}if(!0===e.isInstancedMesh){var y=e.count;return{area:t*y,volume:n*y}}return{area:t,volume:n}}(e);t+=i.area,n+=i.volume}})),{area:t,volume:n};function r(e,t,n){return(-(n.x*t.y*e.z)+t.x*n.y*e.z+n.x*e.y*t.z-e.x*n.y*t.z-t.x*e.y*n.z+e.x*t.y*n.z)/6}},t.isEmptyGeometry=function(e){return!(e.isGeometry&&e.vertices.length>0)&&!(e.isBufferGeometry&&e.attributes.position.count>0)},t.translateGeometry=function(e,t){if(t.isVector3){var n=(new THREE.Matrix4).makeTranslation(t.x,t.y,t.z);e.applyMatrix(n)}},t.rotateGeometry=function(e,t,n){if(0!==n){var r=new THREE.Matrix4;switch(t.toLowerCase()){case"x":r.makeRotationX(n);break;case"y":r.makeRotationY(n);break;case"z":r.makeRotationZ(n);break;default:return}e.applyMatrix(r)}},t.computeVertexNormals=function(e){var t=!1;if(!0===e.isGeometry){var n=e.faces[0].vertexNormals;n&&3===n.length&&(t=!0)}else if(!0===e.isBufferGeometry){var r=e.attributes.normal;r&&r.count>0&&(t=!0)}!1===t&&e.computeVertexNormals()},t.toNonIndexedBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry?t=e.toBufferGeometry():e instanceof THREE.BufferGeometry&&null!==e.index&&(t=e.toNonIndexed()),t},t.toBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry&&(t=e.toBufferGeometry()),t},t.toGeometry=function(e){return e instanceof THREE.BufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)).mergeVertices(),e},t.rectangularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",n=void 0!==e.width?e.width:1,r=void 0!==e.height?e.height:1,i=void 0!==e.numWidth?Math.floor(e.numWidth):1,a=void 0!==e.numHeight?Math.floor(e.numHeight):1,o=[];function s(e,t,n,r,i,a,s){var l,c,u,h,d=a<=1?1:r/(a-1),f=s<=1?1:i/(s-1),p=a<=1?0:r/2,m=s<=1?0:i/2,g=new THREE.Vector3;for(c=0;c<s;c++)for(h=c*f-m,l=0;l<a;l++)u=l*d-p,g[e]=u,g[t]=h,g[n]=0,o.push(g.x,g.y,g.z)}return"x"===t?s("y","z",t,n,r,i,a):"y"===t?s("z","x",t,n,r,i,a):"z"===t&&s("x","y",t,n,r,i,a),o},t.circularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",n=void 0!==e.radiusStart?e.radiusStart:1,r=void 0!==e.radiusLength?e.radiusLength:n+1,i=void 0!==e.numRadius?Math.floor(e.numRadius):1,a=void 0!==e.angleStart?e.angleStart:0,o=void 0!==e.angleLength?e.angleLength:2*Math.PI,s=void 0!==e.numAngle?Math.floor(e.numAngle):4,l=[];function c(e,t,c){var u,h,d,f,p=i<=1?1:r/(i-1),m=s<=1?1:o/(s-1);o===2*Math.PI&&(m=o/s);var g=new THREE.Vector3;for(u=0;u<i;u++)for(d=u*p+n,h=0;h<s;h++)f=h*m+a,g[e]=d*Math.cos(f),g[t]=d*Math.sin(f),g[c]=0,l.push(g.x,g.y,g.z)}return"x"===t?c("y","z",t):"y"===t?c("z","x",t):"z"===t&&c("x","y",t),l},t.structuredPositions=function(e){return(e=e||{}).positions?e.positions:"rectangular"===e.pattern?t.rectangularPositions(e):"circular"===e.pattern?t.circularPositions(e):[]},t.scatteredPositions=function(e){if((e=e||{}).positions)return{positions:e.positions,rotations:e.rotations,scales:e.scales};for(var n,r,i,a=void 0!==e.seed?t.createRandFloat(e.seed):t.randFloat,o=.5*t.WORLD_SIZE,s=e.pmin||[-o,-o,-o],l=e.pmax||[o,o,o],c=e.rmin||[0,0,0],u=e.rmax||[0,0,0],h=e.smin||[1,1,1],d=e.smax||[1,1,1],f=void 0!==e.numInstances?Math.floor(e.numInstances):1,p=[],m=[],g=[],v=0;v<f;v++)n=a(s[0],l[0]),r=a(s[1],l[1]),i=a(s[2],l[2]),p.push(n,r,i),n=a(c[0],u[0]),r=a(c[1],u[1]),i=a(c[2],u[2]),m.push(n,r,i),n=a(h[0],d[0]),r=a(h[1],d[1]),i=a(h[2],d[2]),g.push(n,r,i);return{positions:p,rotations:m,scales:g}},t.createNoiseHeightGeometry=function(e,t,n,r,i){e=e||500,t=t||500;var a=(i=i||50)/88,o=function(e,t){for(var n=e*t,r=1,i=Math.random(),a=new Uint8Array(n),o=new THREE.ImprovedNoise,s=0;s<4;s++){for(var l=0;l<n;l++){var c=l%e,u=~~(l/e);a[l]+=Math.abs(o.noise(c/r,u/r,i)*r)}r*=5}return a}(n=n||256,r=r||256),s=new THREE.PlaneBufferGeometry(e,t,n-1,r-1);s.rotateX(-Math.PI/2);for(var l=s.attributes.position.array,c=0,u=0,h=l.length/3;c<h;c++,u+=3)l[u+1]=o[c]*a;return s.computeVertexNormals(),s};class S{constructor(e){this.convexPoints=new Array(3);var t=[];if(!0===e.isGeometry)for(var n=e.vertices,r=0,i=n.length;r<i;r++)t.push(n[r].toArray());else{if(!0!==e.isBufferGeometry)return void console.warn("warning: THREE.BufferGeometry or THREE.Geometry required in JAMIE.ConvexInOut()...");var a=e.attributes.position.array;for(r=0,i=a.length;r<i;r+=3)t.push([a[r],a[r+1],a[r+2]])}for(var o=0;o<3;o++){var s=(o+1)%3,l=(o+2)%3,c=t.map((e=>[e[s],e[l]]));this.convexPoints[o]=[];var u=w.convexHull(c);for(r=0,i=u.length;r<i;r++)this.convexPoints[o].push(c[u[r][0]])}}isPointOutside(e){for(var t=!0===e.isVector3?e.toArray():e,n=0;n<3;n++){var r=(n+2)%3,i=[t[(n+1)%3],t[r]];if(1===w.pointInPolygon(this.convexPoints[n],i))return!0}return!1}}S.prototype.isConvexInOut=!0,t.ConvexInOut=S,t.createIsosurfaceFromPoints=function(e,n,r,i){var a,o,s;i=i||0;"number"==typeof(r=r||64)?a=o=s=r:(a=r[0],o=r[1],s=r[2]);var l=Math.max(a,o,s),c=new THREE.Vector3,u=new THREE.Box3;u.setFromArray(e),u.getSize(c);var h,d,f,p,m,g,y=.1*Math.min(c.x,c.y,c.z);u.expandByScalar(y),h=u.min.x,d=u.max.x,f=u.min.y,p=u.max.y;var _=[[h,f,m=u.min.z],[d,p,g=u.max.z]],b=(d-h)/(a-1),E=(p-f)/(o-1),w=(g-m)/(s-1),x=Math.sqrt(b*b+E*E+w*w),T=2*x;t.Timer.start("octree");for(var A=new v.PointOctree(u.min,u.max,0,0,i),M=[],S=0,R=e.length;S<R;S+=3){var k={pi:S};(L=new THREE.Vector3).fromArray(e,S),A.insert(L,k),M.push(L)}t.Timer.end(),t.Timer.start("convex");var P,L,C,I,N,F,O=new THREE.ConvexBufferGeometry(M),H=new t.ConvexInOut(O);t.Timer.end();var D=[],U=new THREE.Vector3;t.Timer.start("volumeData");for(var B=0,z=m;B<s;B++,z+=w)for(var V=0,j=f;V<o;V++,j+=E){S=0;for(var G=h;S<a;S++,G+=b){if(U.set(G,j,z),null===(P=A.findNearestPoint(U,x))){if(H.isPointOutside(U)){D.push(T);continue}null===(P=A.findNearestPoint(U,x*l/4))&&(P=A.findNearestPoint(U))}L=P.point,C=n[k=P.data.pi],I=n[k+1],N=n[k+2],F=(U.x-L.x)*C+(U.y-L.y)*I+(U.z-L.z)*N,D.push(F)}}t.Timer.end(),t.Timer.start("isosurface");var W=new t.IsosurfaceGeometry([a,o,s],_,D);return t.Timer.end(),W},t.msh2Geometry=function(e,n){for(var r,i,a=new THREE.Geometry,o=a.vertices,s=a.faces,l=0,c=e.positions.length;l<c;l++)r=e.positions[l],o.push(new THREE.Vector3(r[0],r[1],r[2]));for(l=0,c=e.cells.length;l<c;l++)i=e.cells[l],s.push(new THREE.Face3(i[2],i[1],i[0]));a.mergeVertices();var u=(n=n||{}).uv,h=n.uv2,d=n.uvauto;if(void 0!==u||void 0!==h){var f=u&&u.isBufferAttribute,p=h&&h.isBufferAttribute;f||p?(a=t.toBufferGeometry(a),f&&a.setAttribute("uv",u),p&&a.setAttribute("uv2",h)):(Array.isArray(u)&&(a.faceVertexUvs[0]=u),Array.isArray(h)&&(a.faceVertexUvs[1]=h))}else!0===d&&t.createFaceVertexUVs(a);return a.computeVertexNormals(),a},t.geometry2Msh=function(e){for(var n,r,i=(e=t.toGeometry(e)).vertices,a=e.faces,o=new Array(i.length),s=0,l=i.length;s<l;s++)n=i[s],o[s]=[n.x,n.y,n.z];var c=new Array(a.length);for(s=0,l=a.length;s<l;s++)r=a[s],c[s]=[r.c,r.b,r.a];return{cells:c,positions:o}},t.updateVerticesFromMsh=function(e,n,r){var i,a=n.positions;if(!0===e.isGeometry){for(var o=e.vertices,s=0,l=a.length;s<l;s++)i=a[s],o[s].set(i[0],i[1],i[2]);e.verticesNeedUpdate=!0}else if(!0===e.isBufferGeometry){if(void 0===r){var c=t.toGeometry(e);r=t.geometryIndexMap(c,e)}var u,h=e.attributes.position;for(s=0,l=a.length;s<l;s++){i=a[s],u=r.vtx_to_pos[s];var d=0;for(l=posIndex.length;d<l;d++)h.setXYZ(u[d],i[0],i[1],i[2])}h.needsUpdate=!0}},t.geometryIndexMap=function(e,t,n){n=void 0!==n?n:4,n=Math.pow(10,n);for(var r,i,a=e.vertices,o=t.attributes.position.array,s=[],l={},c={},u=0,h=a.length;u<h;u++)i=a[u],r=Math.round(i.x*n)+"_"+Math.round(i.y*n)+"_"+Math.round(i.z*n),l[u]=r,c[r]=u;var d={},f={};for(u=0,h=o.length;u<h;u+=3){if(s[0]=o[u],s[1]=o[u+1],s[2]=o[u+2],void 0===c[r=Math.round(s[0]*n)+"_"+Math.round(s[1]*n)+"_"+Math.round(s[2]*n)])return console.warn("JAMIE.geometryIndexMap: index map not found due to different geometries"),{};d[u]=r,void 0===f[r]&&(f[r]=[]),f[r].push(u)}var p={},m={};for(u=0,h=a.length;u<h;u++)p[u]=f[l[u]];for(u=0,h=o.length;u<h;u+=3)m[u]=c[d[u]];return{vtx_to_pos:p,pos_to_vtx:m}},t.getTextureUV=function(e){return e.isGeometry?{uv:e.faceVertexUvs[0],uv2:e.faceVertexUvs[1]}:e.isBufferGeometry?{uv:e.getAttribute("uv"),uv2:e.getAttribute("uv")}:void 0},t.reconstructGeometry=function(e,n){var r=t.geometry2Msh(e),i=w.haarTree.rasterize(r.cells,r.positions,n);return r=w.haarTree.contour(i),t.msh2Geometry(r)},t.refineGeometry=function(e,n){if(!e.isGeometry&&!e.isBufferGeometry)return null;var r=t.geometry2Msh(e),i=w.normals.vertexNormals(r.cells,r.positions);return r=w.refineMesh(r.cells,r.positions,i,n),t.msh2Geometry(r)},t.fixGeometry=function(e,n){var r=t.geometry2Msh(e);return r=w.fixMesh(r.cells,r.positions,n),t.msh2Geometry(r)},t.smoothGeometry=function(e,n){var r=t.getTextureUV(e),i=t.geometry2Msh(e);return i.positions=w.smoothVertices(i.cells,i.positions,n),t.msh2Geometry(i,r)},t.deformGeometry=function(e,n,r){var i=t.getTextureUV(e),a=t.geometry2Msh(e),o=n.vertices.length;!function e(a,s){var l=[n.vertices[a],n.offsets[a],n.handles_rings[a],n.unconstrained_rings[a]];w.deformLaplacian.run(s,...l,(function(n){if(++a!=o)return e(a,n);var s=t.msh2Geometry(n,i);r&&r(s)}))}(0,a)},t.loopSubdivideGeometry=function(e){var n=t.geometry2Msh(e);return n=w.loopSubdivide(n.cells,n.positions),t.msh2Geometry(n)},t.addColorToGeometry=function(e,t,n){var r=void 0!==(n=n||{}).coloring?n.coloring:"vertex",i=void 0!==n.colorMap?n.colorMap:"rainbow",a=!0===Array.isArray(n.valueROI)?n.valueROI:[0,1],o=new THREE.Lut;o.setColorMap(i);var s,l,c=t.min(),u=t.max();if(o.setMin(c+(u-c)*a[0]),o.setMax(c+(u-c)*a[1]),!0===e.isGeometry){if("vertex"===r)for(var h=0,d=(s=e.faces).length;h<d;h++)(l=s[h]).vertexColors=[],l.vertexColors.push(o.getColor(t[l.a])),l.vertexColors.push(o.getColor(t[l.b])),l.vertexColors.push(o.getColor(t[l.c]));else if("face"===r)for(h=0,d=(s=e.faces).length;h<d;h++)p=(t[(l=s[h]).a]+t[l.b]+t[l.c])/3,l.color=o.getColor(p)}else if(!0===e.isBufferGeometry){var f,p,m,g=e.attributes.position.array,v=new Float32Array(g.length),y={},_=1e4,b=0;for(h=0,d=g.length;h<d;h+=3)void 0===y[f=Math.round(g[h]*_)+"_"+Math.round(g[h+1]*_)+"_"+Math.round(g[h+2]*_)]&&(y[f]=t[b++]);if("vertex"===r)for(h=0,d=g.length;h<d;h+=3)p=y[f=Math.round(g[h]*_)+"_"+Math.round(g[h+1]*_)+"_"+Math.round(g[h+2]*_)],m=o.getColor(p),v[h]=m.r,v[h+1]=m.g,v[h+2]=m.b;else if("face"===r)for(h=0,d=g.length;h<d;h+=9)p=(y[f=Math.round(g[h]*_)+"_"+Math.round(g[h+1]*_)+"_"+Math.round(g[h+2]*_)]+y[f=Math.round(g[h+3]*_)+"_"+Math.round(g[h+4]*_)+"_"+Math.round(g[h+5]*_)]+y[f=Math.round(g[h+6]*_)+"_"+Math.round(g[h+7]*_)+"_"+Math.round(g[h+8]*_)])/3,m=o.getColor(p),v[h]=v[h+3]=v[h+6]=m.r,v[h+1]=v[h+4]=v[h+7]=m.g,v[h+2]=v[h+5]=v[h+8]=m.b;e.setAttribute("color",new THREE.BufferAttribute(v,3))}},t.computeGeometryCurvature=function(e,n){var r=t.geometry2Msh(e),i=w.meanCurvature(r.cells,r.positions);return void 0!==n&&t.addColorToGeometry(e,i,n),i},t.alphaShapeGeometry=function(e,n){var r=w.alphaShape(e,n);if(0!==r.length){n=t.removeIsolatedPositions(r,n);return t.msh2Geometry({cells:r,positions:n})}console.warn("No cells produced...")},t.computeGeodesicDistance=function(e,n,r){var i=t.geometry2Msh(e);return w.geodesicDistance(i.cells,i.positions,n,r)},t.voxelizeGeometry=function(e,n){if(void 0===n){var r=new THREE.Vector3;e.computeBoundingBox(),e.boundingBox.getSize(r),n=Math.max(r.x,r.y,r.z)/100}for(var i=t.geometry2Msh(e),a=w.voxelize(i.cells,i.positions,n),o=a.voxels,s=o.shape,l=a.origin,c=(n=a.resolution,[]),u=2;u<s[2];u++)for(var h=0;h<s[1];h++)for(var d=0;d<s[0];d++)0===o.get(d,h,u)&&c.push(n*d,n*h,n*u);return{origin:[l[0],l[1],l[2]],size:n,positions:c}},t.removeIsolatedPositions=function(e,t){for(var n,r,i=0,a=[],o={},s=0,l=e.length;s<l;s++){r=e[s];for(var c=0;c<3;c++)void 0===o[n=r[c]]?(o[n]=i,a.push(t[n].slice(0)),r[c]=i,i++):r[c]=o[n]}return console.log("isolated vertices:",t.length-a.length),a},t.getOuterloop2D=function(e,t,n){var r,i;t=t||1.5,n=void 0!==n?n:4,n=Math.pow(10,n);for(var a=[],o=[],s={},l=0,c=e.length;l<c;l++)r=e[l],a.push([r.x,r.y]),s[i=Math.round(r.x*n)+"_"+Math.round(r.y*n)]=l;var u=w.hull2D(a,t);for(l=0,c=u.length;l<c;l++)r=u[l],i=Math.round(r[0]*n)+"_"+Math.round(r[1]*n),o.push(s[i]);return o},t.ShaderChunk=t.ShaderChunk||{},t.ShaderChunk.intersectBox="\nvoid intersectBox(vec3 rayOrigin, vec3 rayDirection, vec3 boxMin, vec3 boxMax, out float tNear, out float tFar, out bool intersect) {\n    vec3 invRay = vec3(1.0) / rayDirection;\n    vec3 tBot = invRay * (boxMin - rayOrigin);\n    vec3 tTop = invRay * (boxMax - rayOrigin);\n    vec3 tMin = min(tTop, tBot);\n    vec3 tMax = max(tTop, tBot);\n    tNear = max( tMin.x, max(tMin.y, tMin.z) );\n    tFar  = min( tMax.x, min(tMax.y, tMax.z) );\n    intersect = tFar > tNear;\n}",t.ShaderChunk.phongShading="\nvec3 phongShading(vec3 ka, vec3 kd, vec3 ks, float shininess, vec3 p, vec3 eye, vec3 lp, vec3 lc, vec3 n, float tDepth) {\n// lp: light position\n// lc: light color\n\n    // float len, eps = 0.001;\n    // vec3 l = lp - p;  len = length(l); l = len > 0.0 ? l / len : l;\n    // float dotLN = dot(l,n);\n    // if( dotLN < eps ) return ka;\n    // vec3 v = eye - p; len = length(v); v = len > 0.0 ? v / len : v;\n    // vec3 r = reflect(-l,n); len = length(r); r = len > 0.0 ? r / len : r;\n    // float dotRV = dot(r,v);\n    // if( dotRV < eps ) return ka + lc * (kd * dotLN);\n    // dotRV = pow( dotRV, shininess );\n    // return ka + lc * (kd * dotLN + ks * dotRV);\n\n    float len, eps = 0.001;\n    vec3 l = normalize( lp - p );\n    vec3 v = normalize( eye - p );\n    vec3 h = normalize( l + v );\n    float dotLN = dot( l, n ); dotLN = step( eps, dotLN );\n    float dotNH = dot( n, h ); dotNH = pow( step( eps, dotNH ), shininess );\n    return ka + lc * ( kd * dotLN + ks * dotNH );\n\n    // float k1 = 0.1, k2 = 1.0, eps = 0.001;\n    // vec3 l = normalize( lp - p );\n    // vec3 v = normalize( eye - p );\n    // vec3 h = normalize( l + v );\n    // float dotLN = dot( l, n ); dotLN = step( eps, dotLN );\n    // float dotNH = dot( n, h ); dotNH = pow( step( eps, dotNH ), shininess );\n    // return lc * ka + lc / (k1 + k2 * tDepth) * (kd * (dotLN + ks * dotNH));\n}",t.ShaderChunk.texture3d="\nvoid texture3d(in ivec3 dataCoordinates, out vec4 dataValue, out int offset) {\n    int i = uDataDimensions.x * uDataDimensions.y * dataCoordinates.z + uDataDimensions.x * dataCoordinates.y + dataCoordinates.x;\n    int t = i / uPackedPerPixel;\n    offset = i - uPackedPerPixel * t;\n\n    int tArea = uTextureSize * uTextureSize;\n    int zi = t / tArea;\n    float z = float(zi);\n\n    int xy = t - tArea * zi;\n    int yi = xy / uTextureSize;\n    float y = float( yi );\n    float x = float( xy - uTextureSize * yi );\n\n    float tsize = float( uTextureSize );\n    vec2 uv = vec2( (0.5 + x) / tsize, 1.0 - (0.5 + y) / tsize );\n\n//     dataValue = vec4(0.0);\n// #if MAX_TEX3D_IMAGES > 0\n//     #pragma unroll_loop_start\n//     for( int i = 0; i < MAX_TEX3D_IMAGES; i++ ) {\n//         dataValue += step( abs( textureIndexF - float(i) ), 0.0 ) * texture2D(uTextureContainer[i], uv);\n//     }\n//     #pragma unroll_loop_end\n// #endif\n\n    dataValue = vec4(0.0);\n    dataValue +=\n        step( abs( z - 0.0 ), 0.0 ) * texture2D(uTextureContainer[0], uv) +\n        step( abs( z - 1.0 ), 0.0 ) * texture2D(uTextureContainer[1], uv) +\n        step( abs( z - 2.0 ), 0.0 ) * texture2D(uTextureContainer[2], uv) +\n        step( abs( z - 3.0 ), 0.0 ) * texture2D(uTextureContainer[3], uv) +\n        step( abs( z - 4.0 ), 0.0 ) * texture2D(uTextureContainer[4], uv) +\n        step( abs( z - 5.0 ), 0.0 ) * texture2D(uTextureContainer[5], uv) +\n        step( abs( z - 6.0 ), 0.0 ) * texture2D(uTextureContainer[6], uv);\n    if( MAX_TEX3D_IMAGES == 14 )\n    {\n        dataValue +=\n        step( abs( z - 7.0 ), 0.0 ) * texture2D(uTextureContainer[7], uv) +\n        step( abs( z - 8.0 ), 0.0 ) * texture2D(uTextureContainer[8], uv) +\n        step( abs( z - 9.0 ), 0.0 ) * texture2D(uTextureContainer[9], uv) +\n        step( abs( z - 10.0 ), 0.0 ) * texture2D(uTextureContainer[10], uv) +\n        step( abs( z - 11.0 ), 0.0 ) * texture2D(uTextureContainer[11], uv) +\n        step( abs( z - 12.0 ), 0.0 ) * texture2D(uTextureContainer[12], uv) +\n        step( abs( z - 13.0 ), 0.0 ) * texture2D(uTextureContainer[13], uv);\n    }\n}",t.ShaderChunk.unpack="\nvoid uInt8(in float r, out float value) {\n    value = r * 255.0;\n}\nvoid uInt16(in float r, in float a, out float value) {\n    // value = r * 255.0 + a * 255.0 * 256.0;\n    float v;\n    v = r + a * 256.0;\n    value = v * 255.0;\n}\nvoid uInt32(in float r, in float g, in float b, in float a, out float value) {\n    // value = r * 255.0 + g * 255.0 * 256.0 + b * 255.0 * 256.0 * 256.0 + a * 255.0 * 256.0 * 256.0 * 256.0;\n    float v;\n    v = b + a * 256.0;\n    v = g + v * 256.0;\n    v = r + v * 256.0;\n    value = v * 255.0;\n}\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value) {\n    // 1) create arrays containing bits for rgba values (between 0 and 255)\n    value = r * 255.0;\n    int bytemeR[8];\n    bytemeR[0] = int(floor(value / 128.0)); value -= float(bytemeR[0] * 128);\n    bytemeR[1] = int(floor(value / 64.0)); value -= float(bytemeR[1] * 64);\n    bytemeR[2] = int(floor(value / 32.0)); value -= float(bytemeR[2] * 32);\n    bytemeR[3] = int(floor(value / 16.0)); value -= float(bytemeR[3] * 16);\n    bytemeR[4] = int(floor(value / 8.0)); value -= float(bytemeR[4] * 8);\n    bytemeR[5] = int(floor(value / 4.0)); value -= float(bytemeR[5] * 4);\n    bytemeR[6] = int(floor(value / 2.0)); value -= float(bytemeR[6] * 2);\n    bytemeR[7] = int(floor(value)); value = g * 255.0;\n    int bytemeG[8];\n    bytemeG[0] = int(floor(value / 128.0)); value -= float(bytemeG[0] * 128);\n    bytemeG[1] = int(floor(value / 64.0)); value -= float(bytemeG[1] * 64);\n    bytemeG[2] = int(floor(value / 32.0)); value -= float(bytemeG[2] * 32);\n    bytemeG[3] = int(floor(value / 16.0)); value -= float(bytemeG[3] * 16);\n    bytemeG[4] = int(floor(value / 8.0)); value -= float(bytemeG[4] * 8);\n    bytemeG[5] = int(floor(value / 4.0)); value -= float(bytemeG[5] * 4);\n    bytemeG[6] = int(floor(value / 2.0)); value -= float(bytemeG[6] * 2);\n    bytemeG[7] = int(floor(value)); value = b * 255.0;\n    int bytemeB[8];\n    bytemeB[0] = int(floor(value / 128.0)); value -= float(bytemeB[0] * 128);\n    bytemeB[1] = int(floor(value / 64.0)); value -= float(bytemeB[1] * 64);\n    bytemeB[2] = int(floor(value / 32.0)); value -= float(bytemeB[2] * 32);\n    bytemeB[3] = int(floor(value / 16.0)); value -= float(bytemeB[3] * 16);\n    bytemeB[4] = int(floor(value / 8.0)); value -= float(bytemeB[4] * 8);\n    bytemeB[5] = int(floor(value / 4.0)); value -= float(bytemeB[5] * 4);\n    bytemeB[6] = int(floor(value / 2.0)); value -= float(bytemeB[6] * 2);\n    bytemeB[7] = int(floor(value)); value = a * 255.0;\n    int bytemeA[8];\n    bytemeA[0] = int(floor(value / 128.0)); value -= float(bytemeA[0] * 128);\n    bytemeA[1] = int(floor(value / 64.0)); value -= float(bytemeA[1] * 64);\n    bytemeA[2] = int(floor(value / 32.0)); value -= float(bytemeA[2] * 32);\n    bytemeA[3] = int(floor(value / 16.0)); value -= float(bytemeA[3] * 16);\n    bytemeA[4] = int(floor(value / 8.0)); value -= float(bytemeA[4] * 8);\n    bytemeA[5] = int(floor(value / 4.0)); value -= float(bytemeA[5] * 4);\n    bytemeA[6] = int(floor(value / 2.0)); value -= float(bytemeA[6] * 2);\n    bytemeA[7] = int(floor(value));\n    // 2) compute float32 value from bit arrays\n    int issigned = 1 - 2 * bytemeR[0]; //issigned = int(pow(-1., float(bytemeR[0])));\n    int exponent = 0;\n    exponent += bytemeR[1] * int(pow(2.0, 7.0));\n    exponent += bytemeR[2] * int(pow(2.0, 6.0));\n    exponent += bytemeR[3] * int(pow(2.0, 5.0));\n    exponent += bytemeR[4] * int(pow(2.0, 4.0));\n    exponent += bytemeR[5] * int(pow(2.0, 3.0));\n    exponent += bytemeR[6] * int(pow(2.0, 2.0));\n    exponent += bytemeR[7] * int(pow(2.0, 1.0));\n    exponent += bytemeG[0];\n    float fraction = 0.0;\n    fraction  = float(bytemeG[1]) * pow(2.0, -1.0);\n    fraction += float(bytemeG[2]) * pow(2.0, -2.0);\n    fraction += float(bytemeG[3]) * pow(2.0, -3.0);\n    fraction += float(bytemeG[4]) * pow(2.0, -4.0);\n    fraction += float(bytemeG[5]) * pow(2.0, -5.0);\n    fraction += float(bytemeG[6]) * pow(2.0, -6.0);\n    fraction += float(bytemeG[7]) * pow(2.0, -7.0);//\n    fraction += float(bytemeB[0]) * pow(2.0, -8.0);\n    fraction += float(bytemeB[1]) * pow(2.0, -9.0);\n    fraction += float(bytemeB[2]) * pow(2.0, -10.0);\n    fraction += float(bytemeB[3]) * pow(2.0, -11.0);\n    fraction += float(bytemeB[4]) * pow(2.0, -12.0);\n    fraction += float(bytemeB[5]) * pow(2.0, -13.0);\n    fraction += float(bytemeB[6]) * pow(2.0, -14.0);\n    fraction += float(bytemeB[7]) * pow(2.0, -15.0);//\n    fraction += float(bytemeA[0]) * pow(2.0, -16.0);\n    fraction += float(bytemeA[1]) * pow(2.0, -17.0);\n    fraction += float(bytemeA[2]) * pow(2.0, -18.0);\n    fraction += float(bytemeA[3]) * pow(2.0, -19.0);\n    fraction += float(bytemeA[4]) * pow(2.0, -20.0);\n    fraction += float(bytemeA[5]) * pow(2.0, -21.0);\n    fraction += float(bytemeA[6]) * pow(2.0, -22.0);\n    fraction += float(bytemeA[7]) * pow(2.0, -23.0);//\n    value = float(issigned) * pow(2.0, float(exponent - 127)) * (1.0 + fraction);\n}\nvoid unpack(in vec4 packedData, in int offset, out vec4 unpackedData) {\n#if defined( BITS_ALLOCATED_8 )\n    float floatedOffset = float(offset);\n    float floatedOffsetSquared = floatedOffset * floatedOffset;\n    uInt8( step( floatedOffsetSquared, 0.0 ) * packedData.r +\n           step( floatedOffsetSquared - 2.0 * floatedOffset + 1.0, 0.0 ) * packedData.g +\n           step( floatedOffsetSquared - 2.0 * 2.0 * floatedOffset + 4.0, 0.0 ) * packedData.b +\n           step( floatedOffsetSquared - 2.0 * 3.0 * floatedOffset + 9.0, 0.0 ) * packedData.a, unpackedData.x );\n#elif defined( BITS_ALLOCATED_16 )\n    float floatedOffset = float(offset);\n    uInt16( packedData.r * (1.0 - floatedOffset) + packedData.b * floatedOffset, packedData.g * (1.0 - floatedOffset) + packedData.a * floatedOffset, unpackedData.x);\n#elif defined( BITS_ALLOCATED_32 )\n    uInt32( packedData.r, packedData.g, packedData.b, packedData.a, unpackedData.x );\n#elif defined( BITS_ALLOCATED_32F )\n    uFloat32( packedData.r, packedData.g, packedData.b, packedData.a, unpackedData.x );\n#else\n    unpackedData = packedData;\n#endif\n}",t.ShaderChunk.interpolation="\nvoid nearestInterpolation(in vec3 currentVoxel, out vec4 dataValue) {\n    vec3 temp = floor(currentVoxel + 0.5);\n    ivec3 nearestVoxel = ivec3(int(temp.x), int(temp.y), int(temp.z));\n    vec4 voxelValue = vec4(0.0);\n    int offset = 0;\n    texture3d(nearestVoxel, voxelValue, offset);\n    unpack(voxelValue, offset, dataValue);\n}\nvoid nearestInterpolation(in ivec3 currentVoxel, out vec4 dataValue) {\n    vec4 voxelValue;\n    int offset;\n    texture3d(currentVoxel, voxelValue, offset);\n    unpack(voxelValue, offset, dataValue);\n}\nvoid trilinearInterpolation(in vec3 p, out vec4 f, in vec4 v[8]) {\n    // p is on [0,1]\n    vec4 c00 = mix( v[0], v[1], p.x );\n    vec4 c01 = mix( v[2], v[3], p.x );\n    vec4 c10 = mix( v[4], v[5], p.x );\n    vec4 c11 = mix( v[6], v[7], p.x );\n    vec4 c0 = mix( c00, c10, p.y );\n    vec4 c1 = mix( c01, c11, p.y );\n    f = mix( c0, c1, p.z );\n}\nvoid trilinearInterpolation(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient) {\n    vec4 f, f0, f1, v[8];\n    vec3 d, p0, p1;\n\n    vec3 origin = floor(currentVoxel); origin = max(vec3(0.0), origin);\n    ivec3 lower = ivec3(int(origin.x), int(origin.y), int(origin.z));\n    ivec3 upper = lower + ivec3(1);\n    vec3 p = currentVoxel - origin; p = max(vec3(0.0), p);\n\n    // compute volume-values(v[8]) at cell vertices\n    nearestInterpolation(ivec3(lower.x, lower.y, lower.z), v[0]);\n    nearestInterpolation(ivec3(upper.x, lower.y, lower.z), v[1]);\n    nearestInterpolation(ivec3(lower.x, lower.y, upper.z), v[2]);\n    nearestInterpolation(ivec3(upper.x, lower.y, upper.z), v[3]);\n    nearestInterpolation(ivec3(lower.x, upper.y, lower.z), v[4]);\n    nearestInterpolation(ivec3(upper.x, upper.y, lower.z), v[5]);\n    nearestInterpolation(ivec3(lower.x, upper.y, upper.z), v[6]);\n    nearestInterpolation(ivec3(upper.x, upper.y, upper.z), v[7]);\n\n    // compute volume-value(f) at position(p)\n    trilinearInterpolation(p, f, v);\n    dataValue = f;\n\n    // compute gradient at position(p)\n    float eps = 0.005;\n\n    // x axis\n    d = vec3(eps, 0.0, 0.0);\n    p1 = p + d; p1.x = min(1.0, p1.x); trilinearInterpolation(p1, f1, v);\n    p0 = p - d; p0.x = max(0.0, p0.x); trilinearInterpolation(p0, f0, v);\n    gradient.x = (f1.x - f0.x);\n\n    // y axis\n    d = vec3(0.0, eps, 0.0);\n    p1 = p + d; p1.y = min(1.0, p1.y); trilinearInterpolation(p1, f1, v);\n    p0 = p - d; p0.y = max(0.0, p0.y); trilinearInterpolation(p0, f0, v);\n    gradient.y = (f1.x - f0.x);\n\n    // z axis\n    d = vec3(0.0, 0.0, eps);\n    p1 = p + d; p1.z = min(1.0, p1.z); trilinearInterpolation(p1, f1, v);\n    p0 = p - d; p0.z = max(0.0, p0.z); trilinearInterpolation(p0, f0, v);\n    gradient.z = (f1.x - f0.x);\n\n    // normalize gradient\n    float l = length(gradient);\n    gradient = (l == 0.0) ? vec3(0.0) : (-1.0 / l) * gradient;\n}\nvoid interpolation(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient) {\n    if( uInterpolation == 0 )\n        nearestInterpolation(currentVoxel, dataValue);\n    else\n        trilinearInterpolation(currentVoxel, dataValue, gradient);\n}",t.ShaderChunk.getIntensity="\nvoid getIntensity(in vec3 dataCoordinates, out float intensity, out vec3 gradient) {\n    vec4 dataValue;\n    interpolation(dataCoordinates, dataValue, gradient);\n    intensity = dataValue.r;\n    intensity = intensity * uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}",t.MedicalSliceShader={uniforms:{uTextureSize:{value:0},uTextureContainer:{value:[]},uDataDimensions:{value:[0,0,0]},uWorldToData:{value:null},uWindowCenterWidth:{value:[0,0]},uLowerUpperThreshold:{value:[0,0]},uRescaleSlopeIntercept:{value:[0,0]},uNumberOfChannels:{value:1},uBitsAllocated:{value:8},uInvert:{value:0},uLut:{value:0},uTextureLUT:{value:null},uLutSegmentation:{value:0},uTextureLUTSegmentation:{value:null},uPixelType:{value:0},uPackedPerPixel:{value:1},uInterpolation:{value:1},uCanvasWidth:{value:0},uCanvasHeight:{value:0},uBorderColor:{value:[1,0,.5]},uBorderWidth:{value:2},uBorderMargin:{value:2},uBorderDashLength:{value:10},uOpacity:{value:1},uSpacing:{value:0},uThickness:{value:0},uThicknessMethod:{value:0}},vertexShader:"\nvarying vec3 vPos;\nvarying vec3 vNormal;\nvoid main() {\n    vNormal = normal;\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vPos = worldPosition.xyz;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:`\nuniform int uTextureSize;\nuniform sampler2D uTextureContainer[14];\nuniform ivec3 uDataDimensions;\nuniform mat4 uWorldToData;\nuniform float uWindowCenterWidth[2];\nuniform float uLowerUpperThreshold[2];\nuniform float uRescaleSlopeIntercept[2];\nuniform int uNumberOfChannels;\nuniform int uBitsAllocated;\nuniform int uInvert;\nuniform int uLut;\nuniform sampler2D uTextureLUT;\nuniform int uLutSegmentation;\nuniform sampler2D uTextureLUTSegmentation;\nuniform int uPixelType;\nuniform int uPackedPerPixel;\nuniform int uInterpolation;\nuniform float uCanvasWidth;\nuniform float uCanvasHeight;\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform float uBorderMargin;\nuniform float uBorderDashLength;\nuniform float uOpacity;\nuniform float uSpacing;\nuniform float uThickness;\nuniform int uThicknessMethod;\nvarying vec3 vPos;\nvarying vec3 vNormal;\n${t.ShaderChunk.texture3d}\n${t.ShaderChunk.unpack}\n${t.ShaderChunk.interpolation}\nvoid main() {\n    // if( uCanvasWidth > 0.0 &&\n    // ((gl_FragCoord.x > uBorderMargin && (gl_FragCoord.x - uBorderMargin) < uBorderWidth) ||\n    // (gl_FragCoord.x < (uCanvasWidth - uBorderMargin) && (gl_FragCoord.x + uBorderMargin) > (uCanvasWidth - uBorderWidth) ))) {\n    //     float valueY = mod(gl_FragCoord.y, 2.0 * uBorderDashLength);\n    //     if( valueY < uBorderDashLength && gl_FragCoord.y > uBorderMargin && gl_FragCoord.y < (uCanvasHeight - uBorderMargin) ) {\n    //         gl_FragColor = vec4(uBorderColor, 1.0);\n    //         return;\n    //     }\n    // }\n    // if( uCanvasHeight > 0.0 &&\n    // ((gl_FragCoord.y > uBorderMargin && (gl_FragCoord.y - uBorderMargin) < uBorderWidth) ||\n    // (gl_FragCoord.y < (uCanvasHeight - uBorderMargin) && (gl_FragCoord.y + uBorderMargin) > (uCanvasHeight - uBorderWidth) ))) {\n    //     float valueX = mod(gl_FragCoord.x, 2.0 * uBorderDashLength);\n    //     if( valueX < uBorderDashLength && gl_FragCoord.x > uBorderMargin && gl_FragCoord.x < (uCanvasWidth - uBorderMargin) ) {\n    //         gl_FragColor = vec4(uBorderColor, 1.0);\n    //         return;\n    //     }\n    // }\n\n    // get texture coordinates of current pixel\n    vec4 dataValue = vec4(0.0);\n    vec3 gradient = vec3(1.0); // gradient calculations will be skipped if it is equal to vec3(1.0)\n    float steps = floor(uThickness / uSpacing + 0.5);\n\n    if( steps > 1.0 ) {\n        vec3 origin = vPos - uThickness * 0.5 * vNormal;\n        vec4 dataValueAcc = vec4(0.0);\n\n        for( float step = 0.0; step < 128.0; step++ ) {\n            if ( step >= steps ) break;\n\n            vec4 dataCoordinates = uWorldToData * vec4(origin + step * uSpacing * vNormal, 1.0);\n            interpolation(dataCoordinates.xyz, dataValueAcc, gradient);\n\n            if (step == 0.0) {\n                dataValue.r = dataValueAcc.r;\n                continue;\n            }\n            if (uThicknessMethod == 0) {\n                dataValue.r = max(dataValueAcc.r, dataValue.r);\n            }\n            else if (uThicknessMethod == 1) {\n                dataValue.r += dataValueAcc.r;\n            }\n            else if (uThicknessMethod == 2) {\n                dataValue.r = min(dataValueAcc.r, dataValue.r);\n            }\n        }\n        if (uThicknessMethod == 1) {\n            dataValue.r /= steps;\n        }\n    }\n    else {\n        vec4 dataCoordinates = uWorldToData * vec4(vPos, 1.0);\n        interpolation(dataCoordinates.xyz, dataValue, gradient);\n    }\n\n    if( uNumberOfChannels == 1 ) {\n        // rescale/slope\n        float realIntensity = dataValue.r * uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n        // threshold\n        if (realIntensity < uLowerUpperThreshold[0] || realIntensity > uLowerUpperThreshold[1]) {\n            discard;\n        }\n\n        // normalize\n        float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n        float normalizedIntensity = ( realIntensity - windowMin ) / uWindowCenterWidth[1];\n        dataValue.rgb = vec3( normalizedIntensity );\n        dataValue.a = 1.0;\n\n        // apply LUT\n        if( uLut == 1 ) {\n            dataValue.rgb = texture2D( uTextureLUT, vec2(normalizedIntensity, 1.0) ).rgb;\n            dataValue.a = 1.0;\n        }\n\n        // apply segmentation\n        if( uLutSegmentation == 1 ) {\n            float textureWidth = 256.0;\n            float textureHeight = 128.0;\n            // float min = 0.0;\n            int adjustedIntensity = int(floor(realIntensity + 0.5));\n\n            // get row and column in the texture\n            int colIndex = int(mod(float(adjustedIntensity), textureWidth));\n            int rowIndex = int(floor(float(adjustedIntensity)/textureWidth));\n\n            float texWidth = 1.0/textureWidth;\n            float texHeight = 1.0/textureHeight;\n\n            // map row and column to uv\n            vec2 uv = vec2(0.0);\n            uv.x = 0.5 * texWidth + (texWidth * float(colIndex));\n            uv.y = 1.0 - (0.5 * texHeight + float(rowIndex) * texHeight);\n            dataValue = texture2D( uTextureLUTSegmentation, uv );\n        }\n    }\n\n    if( uInvert == 1 ) {\n        dataValue.xyz = vec3(1.0) - dataValue.xyz;\n    }\n\n    dataValue.a = dataValue.a * uOpacity;\n    gl_FragColor = dataValue;\n}`},t.MedicalVolumeShader={uniforms:{uTextureSize:{value:0},uTextureContainer:{value:[]},uDataDimensions:{value:[0,0,0]},uWorldToData:{value:null},uDataToWorld:{value:null},uWindowCenterWidth:{value:[0,0]},uRescaleSlopeIntercept:{value:[0,0]},uNumberOfChannels:{value:1},uBitsAllocated:{value:8},uInvert:{value:0},uLut:{value:0},uTextureLUT:{value:null},uPixelType:{value:0},uPackedPerPixel:{value:1},uInterpolation:{value:1},uWorldBBox:{value:[0,0,0,0,0,0]},uSteps:{value:256},uAlphaCorrection:{value:.5},uFrequence:{value:0},uAmplitude:{value:0},uShading:{value:1},uAmbientIntensity:{value:.1},uAmbientColor:{value:[1,1,1]},uSampleColorToAmbient:{value:1},uSpecularIntensity:{value:.6},uSpecularColor:{value:[1,1,1]},uSampleColorToSpecular:{value:1},uDiffuseIntensity:{value:.3},uDiffuseColor:{value:[1,1,1]},uSampleColorToDiffuse:{value:1},uShininess:{value:5},uLightPosition:{value:[0,0,0]},uLightPositionInCamera:{value:1},uLightColor:{value:[.8,.8,.8]},uAlgorithm:{value:0},uCameraNear:{value:0},uCameraFar:{value:0}},vertexShader:"\nvarying vec3 vPos;\nvoid main() {\n    vPos = position;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:`\nuniform int uTextureSize;\nuniform sampler2D uTextureContainer[14];\nuniform ivec3 uDataDimensions;\nuniform mat4 uWorldToData;\nuniform mat4 uDataToWorld;\nuniform float uWindowCenterWidth[2];\nuniform float uRescaleSlopeIntercept[2];\nuniform int uNumberOfChannels;\nuniform int uBitsAllocated;\nuniform int uInvert;\nuniform int uLut;\nuniform sampler2D uTextureLUT;\nuniform int uPixelType;\nuniform int uPackedPerPixel;\nuniform int uInterpolation;\nuniform float uWorldBBox[6];\nuniform int uSteps;\nuniform float uAlphaCorrection;\nuniform float uFrequence;\nuniform float uAmplitude;\nuniform int uShading;\nuniform float uAmbientIntensity;\nuniform vec3 uAmbientColor;\nuniform int uSampleColorToAmbient;\nuniform float uSpecularIntensity;\nuniform vec3 uSpecularColor;\nuniform int uSampleColorToSpecular;\nuniform float uDiffuseIntensity;\nuniform vec3 uDiffuseColor;\nuniform int uSampleColorToDiffuse;\nuniform float uShininess;\nuniform vec3 uLightPosition;\nuniform int uLightPositionInCamera;\nuniform vec3 uLightColor;\nuniform int uAlgorithm;\nuniform float uCameraNear;\nuniform float uCameraFar;\nvarying vec3 vPos;\n${t.ShaderChunk.intersectBox}\n${t.ShaderChunk.phongShading}\n${t.ShaderChunk.texture3d}\n${t.ShaderChunk.unpack}\n${t.ShaderChunk.interpolation}\n${t.ShaderChunk.getIntensity}\nfloat getFragDepth( vec3 fragPosW ) {\n    vec4 fragPosV = viewMatrix * vec4(fragPosW, 1.0);\n    float fragDepth = uCameraFar * (uCameraNear + fragPosV.z) / ((uCameraFar - uCameraNear) * fragPosV.z);\n    return fragDepth;\n}\nvoid main() {\n    const int maxSteps = 1024;\n\n    vec3 ro = cameraPosition;\n    vec3 rd = normalize(vPos - ro);\n    vec3 lightPos = uLightPositionInCamera == 1 ? cameraPosition : uLightPosition;\n\n    vec3 AABBMin = vec3(uWorldBBox[0], uWorldBBox[2], uWorldBBox[4]);\n    vec3 AABBMax = vec3(uWorldBBox[1], uWorldBBox[3], uWorldBBox[5]);\n\n    float tNear, tFar;\n    bool intersect = false;\n    intersectBox(ro, rd, AABBMin, AABBMax, tNear, tFar, intersect);\n    if( intersect == false ) discard;\n    tNear = max( tNear, 0.0 );\n\n    vec3 aabb = AABBMax - AABBMin;\n    float dt = min( aabb.x, min( aabb.y, aabb.z ) );\n    dt /= float(uSteps);\n\n    float t = tNear;\n    vec3 p = ro + rd * t;\n    vec3 dp = rd * dt;\n\n    float alphaScale = dt * uAlphaCorrection;\n    float maxIntensity = 0.0;  // mip volume rendering\n    vec4 colorSum = vec4(0.0); // accumulated color\n    float alphaSum = 0.0;      // accumulated alpha\n\n    vec4 dataCoordinatesRaw, color;\n    float intensity, alpha, gradlength;\n    vec3 transformed, gradient, ka, kd, ks;\n\n    float fragNone = 1.0;\n\n    for( int i = 0; i < maxSteps; i++ )\n    {\n        transformed = p; // transformPoint(p, uAmplitude, uFrequence);\n\n        dataCoordinatesRaw = uWorldToData * vec4(transformed, 1.0);\n        intensity = 0.0;\n        gradient = vec3(0.0);\n        getIntensity( dataCoordinatesRaw.xyz, intensity, gradient );\n\n        // create fragment (added by jamie)\n        if( fragNone * intensity > 0.0 ) {\n            gl_FragDepth = getFragDepth( transformed );\n            fragNone = 0.0;\n        }\n\n        gradient = vec3( uDataToWorld * vec4(gradient, 0.0) );\n        gradlength = length( gradient );\n        gradient = gradlength > 0.0 ? gradient / gradlength : gradient;\n\n        if( uLut == 1 ) {\n            color = texture2D( uTextureLUT, vec2(intensity, 1.0) ); // 256 colors\n            alpha = color.a;\n        }\n        else {\n            color.rgb = vec3( intensity );\n            alpha = intensity;\n        }\n\n        if (uAlgorithm == 0 && uShading == 1 && uInterpolation != 0) {\n            ka = (uSampleColorToAmbient  == 1 ? color.rgb : uAmbientColor ) * uAmbientIntensity;\n            kd = (uSampleColorToDiffuse  == 1 ? color.rgb : uDiffuseColor ) * uDiffuseIntensity;\n            ks = (uSampleColorToSpecular == 1 ? color.rgb : uSpecularColor) * uSpecularIntensity;\n            color.rgb += phongShading( ka, kd, ks, uShininess, p, ro, lightPos, uLightColor, gradient, t/tFar );\n        }\n\n        // when using fewer slices, the opacity has to be scaled up\n        alpha = 1.0 - pow( (1.0 - alpha), alphaScale );\n\n        // front-to-back composition\n        alpha *= (1.0 - alphaSum);\n        colorSum += alpha * color;\n        alphaSum += alpha;\n\n        t += dt;\n        p += dp;\n\n        if( t > tFar || (uAlgorithm == 0 && alphaSum >= 0.95) ) break;\n\n        if( uAlgorithm == 1 && (intensity >= maxIntensity) ) {\n            maxIntensity = intensity;\n            colorSum = color;\n            alphaSum = 1.0;\n        }\n    }\n    gl_FragColor = vec4( colorSum.rgb, alphaSum );\n}`};class R extends THREE.Pass{constructor(e,n,r,i){super(),this.scene=e,this.camera=n,this.width=r||512,this.height=i||512;var a=n.far;this.sunPosition=new THREE.Vector3(0,.5*a,-a),this.screenSpacePosition=new THREE.Vector3,this.clipPosition=new THREE.Vector4,this.materialDepth=new THREE.MeshDepthMaterial,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(-.5,.5,.5,-.5,-a,a),this.camera2.position.z=a/100,this.scene2.add(this.camera2);var o={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureColors=new THREE.WebGLRenderTarget(r,i,o),this.rtTextureDepth=new THREE.WebGLRenderTarget(r,i,o),this.rtTextureDepthMask=new THREE.WebGLRenderTarget(r,i,o),this.rtResolutionMultiplier=.25;var s=r*this.rtResolutionMultiplier,l=i*this.rtResolutionMultiplier;this.rtTextureGodRays1=new THREE.WebGLRenderTarget(s,l,o),this.rtTextureGodRays2=new THREE.WebGLRenderTarget(s,l,o),void 0!==THREE.GodRaysDepthMaskShader&&void 0!==THREE.GodRaysGenerateShader&&void 0!==THREE.GodRaysCombineShader&&void 0!==THREE.GodRaysFakeSunShader||console.error("JAMIE.GodRaysPass: The pass relies on GodRaysShader.js.");var c=THREE.GodRaysDepthMaskShader;this.godrayMaskUniforms=THREE.UniformsUtils.clone(c.uniforms),this.materialGodraysDepthMask=new THREE.ShaderMaterial({uniforms:this.godrayMaskUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader});var u=THREE.GodRaysGenerateShader;this.godrayGenUniforms=THREE.UniformsUtils.clone(u.uniforms),this.materialGodraysGenerate=new THREE.ShaderMaterial({uniforms:this.godrayGenUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader});var h=THREE.GodRaysCombineShader;this.godrayCombineUniforms=THREE.UniformsUtils.clone(h.uniforms),this.materialGodraysCombine=new THREE.ShaderMaterial({uniforms:this.godrayCombineUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader});var d=THREE.GodRaysFakeSunShader;this.godraysFakeSunUniforms=THREE.UniformsUtils.clone(d.uniforms),this.materialGodraysFakeSun=new THREE.ShaderMaterial({uniforms:this.godraysFakeSunUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.godraysFakeSunUniforms.bgColor.value.setHex(0),this.godraysFakeSunUniforms.sunColor.value.setHex(t.SUN_COLOR),this.godrayCombineUniforms.fGodRayIntensity.value=.25;var f=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),this.materialGodraysGenerate);f.position.z=-.99*n.far,this.scene2.add(f)}dispose(){this.rtTextureColors.dispose(),this.rtTextureDepth.dispose(),this.rtTextureDepthMask.dispose(),this.rtTextureGodRays1.dispose(),this.rtTextureGodRays2.dispose(),this.materialGodraysDepthMask.dispose(),this.materialGodraysGenerate.dispose(),this.materialGodraysCombine.dispose(),this.materialGodraysFakeSun.dispose(),this.quad.geometry.dispose(),this.materialDepth.dispose()}setSize(e,t){this.rtTextureColors.setSize(e,t),this.rtTextureDepth.setSize(e,t),this.rtTextureDepthMask.setSize(e,t);var n=e*this.rtResolutionMultiplier,r=t*this.rtResolutionMultiplier;this.rtTextureGodRays1.setSize(n,r),this.rtTextureGodRays2.setSize(n,r)}render(e,t,n,r,i){if(this.enabled){var a=this.scene,o=this.camera,s=this.width,l=this.height,c=this.sunPosition,u=this.screenSpacePosition,h=this.clipPosition;h.x=c.x,h.y=c.y,h.z=c.z,h.w=1,h.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix),h.x/=h.w,h.y/=h.w,u.x=(h.x+1)/2,u.y=(h.y+1)/2,u.z=h.z,this.godrayGenUniforms.vSunPositionScreenSpace.value.copy(u),this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.copy(u),e.setRenderTarget(this.rtTextureColors),e.clear(!0,!0,!1);var d=.74*l,f=.74*l;u.x*=s,u.y*=l,e.setScissor(u.x-f/2,u.y-d/2,f,d),e.setScissorTest(!0),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.scene2.overrideMaterial=this.materialGodraysFakeSun,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureColors),e.setScissorTest(!1),a.overrideMaterial=null,this.rendererRender(e,a,o,this.rtTextureColors),a.overrideMaterial=this.materialDepth,this.rendererRender(e,a,o,this.rtTextureDepth,!0),this.godrayMaskUniforms.tInput.value=this.rtTextureDepth.texture,this.scene2.overrideMaterial=this.materialGodraysDepthMask,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureDepthMask);this.filterGodRays(e,this.rtTextureDepthMask.texture,this.rtTextureGodRays2,this.getStepSize(1,6,1)),this.filterGodRays(e,this.rtTextureGodRays2.texture,this.rtTextureGodRays1,this.getStepSize(1,6,2)),this.filterGodRays(e,this.rtTextureGodRays1.texture,this.rtTextureGodRays2,this.getStepSize(1,6,3)),this.godrayCombineUniforms.tColors.value=this.rtTextureColors.texture,this.godrayCombineUniforms.tGodRays.value=this.rtTextureGodRays2.texture,this.scene2.overrideMaterial=this.materialGodraysCombine,this.rendererRender(e,this.scene2,this.camera2,this.renderToScreen?null:t),this.scene2.overrideMaterial=null}else this.rendererRender(e,this.scene,this.camera,null,!0)}getStepSize(e,t,n){return e*Math.pow(t,-n)}filterGodRays(e,t,n,r){this.scene2.overrideMaterial=this.materialGodraysGenerate,this.godrayGenUniforms.fStepSize.value=r,this.godrayGenUniforms.tInput.value=t,this.rendererRender(e,this.scene2,this.camera2,n),this.scene2.overrideMaterial=null}rendererRender(e,t,n,r,i){e.setRenderTarget(r),i&&e.clear(),e.render(t,n)}}R.prototype.isGodRaysPass=!0,t.GodRaysPass=R;var k,P=__webpack_require__(2003);THREE.InstancedMesh.prototype.getTransformAt=(k=new THREE.Matrix4,function(e,t,n,r){this.getMatrixAt(e,k),k.decompose(t,n,r)}),THREE.InstancedMesh.prototype.setTransformAt=function(){var e=new THREE.Matrix4;return function(t,n,r,i){e.compose(n,r,i),this.setMatrixAt(t,e)}}(),THREE.InstancedMesh.prototype.getPositionAt=function(){var e=new THREE.Matrix4;return function(t,n){this.getMatrixAt(t,e);var r=e.elements;n.set(r[12],r[13],r[14])}}(),THREE.InstancedMesh.prototype.setPositionAt=function(){var e=new THREE.Matrix4;return function(t,n){this.getMatrixAt(t,e),e.setPosition(n),this.setMatrixAt(t,e)}}(),THREE.InstancedMesh.prototype.getColorAt=function(e,t){var n=this.geometry.attributes.instanceColor.array;e*=3,t.setRGB(n[e],n[e+1],n[e+2])},THREE.InstancedMesh.prototype.setColorAt=function(e,t){var n=this.geometry.attributes;void 0===n.instanceColor&&(this.addInstanceColorChunk(),this.geometry.setAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Float32Array(3*this.count),3))),n.instanceColor.setXYZ(e,t.r,t.g,t.b)},THREE.InstancedMesh.prototype.addInstanceColorChunk=function(){var e=["attribute vec3 instanceColor;","varying vec3 vInstanceColor;","#include <common>"].join("\n"),t=["#include <begin_vertex>","\tvInstanceColor = instanceColor;"].join("\n"),n=["varying vec3 vInstanceColor;","#include <common>"].join("\n"),r=["vec4 diffuseColor = vec4( diffuse * vInstanceColor, opacity );"].join("\n");this.material.onBeforeCompile=function(i){i.vertexShader=i.vertexShader.replace("#include <common>",e).replace("#include <begin_vertex>",t),i.fragmentShader=i.fragmentShader.replace("#include <common>",n).replace("vec4 diffuseColor = vec4( diffuse, opacity );",r)}},THREE.ShaderChunk.begin_vertex=["#ifndef INSTANCE_TRANSFORM","vec3 transformed = vec3( position );","#else","#ifndef INSTANCE_MATRIX","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","vec3 transformed = ( _instanceMatrix * vec4( position , 1. )).xyz;","#endif"].join("\n"),THREE.ShaderChunk.color_fragment=["#ifdef USE_COLOR","diffuseColor.rgb *= vColor;","#endif","#if defined(INSTANCE_COLOR)","diffuseColor.rgb *= vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_pars_fragment=["#ifdef USE_COLOR","varying vec3 vColor;","#endif","#if defined( INSTANCE_COLOR )","varying vec3 vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_vertex=["#ifdef USE_COLOR","vColor.xyz = color.xyz;","#endif","#if defined( INSTANCE_COLOR ) && defined( INSTANCE_TRANSFORM )","vInstanceColor = instanceColor;","#endif"].join("\n"),THREE.ShaderChunk.defaultnormal_vertex=["#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","#ifndef INSTANCE_TRANSFORM","vec3 transformedNormal = normalMatrix * objectNormal;","#else","#ifndef INSTANCE_MATRIX ","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","#ifndef INSTANCE_UNIFORM","vec3 transformedNormal =  transposeMat3( inversemat( mat3( modelViewMatrix * _instanceMatrix ) ) ) * objectNormal ;","#else","vec3 transformedNormal = ( modelViewMatrix * _instanceMatrix * vec4( objectNormal , 0.0 ) ).xyz;","#endif","#endif"].join("\n"),THREE.ShaderChunk.uv_pars_vertex=["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )","varying vec2 vUv;","uniform mat3 uvTransform;","#endif","#ifdef INSTANCE_TRANSFORM","mat3 inversemat(mat3 m) {","float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];","float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];","float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];","float b01 = a22 * a11 - a12 * a21;","float b11 = -a22 * a10 + a12 * a20;","float b21 = a21 * a10 - a11 * a20;","float det = a00 * b01 + a01 * b11 + a02 * b21;","return mat3(b01, (-a22 * a01 + a02 * a21), ( a12 * a01 - a02 * a11),","b11, ( a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),","b21, (-a21 * a00 + a01 * a20), ( a11 * a00 - a01 * a10)) / det;","}","attribute vec3 instancePosition;","attribute vec4 instanceQuaternion;","attribute vec3 instanceScale;","#if defined( INSTANCE_COLOR )","attribute vec3 instanceColor;","varying vec3 vInstanceColor;","#endif","mat4 getInstanceMatrix(){","vec4 q = instanceQuaternion;","vec3 s = instanceScale;","vec3 v = instancePosition;","vec3 q2 = q.xyz + q.xyz;","vec3 a = q.xxx * q2.xyz;","vec3 b = q.yyz * q2.yzz;","vec3 c = q.www * q2.xyz;","vec3 r0 = vec3( 1.0 - (b.x + b.z) , a.y + c.z , a.z - c.y ) * s.xxx;","vec3 r1 = vec3( a.y - c.z , 1.0 - (a.x + b.z) , b.y + c.x ) * s.yyy;","vec3 r2 = vec3( a.z + c.y , b.y - c.x , 1.0 - (a.x + b.x) ) * s.zzz;","return mat4(","r0 , 0.0,","r1 , 0.0,","r2 , 0.0,","v  , 1.0",");","}","#endif"].join("\n"),t.DEPTH_MATERIAL=new THREE.MeshDepthMaterial,t.DEPTH_MATERIAL.depthPacking=THREE.RGBADepthPacking,t.DEPTH_MATERIAL.clipping=!0,t.DEPTH_MATERIAL.defines={INSTANCE_TRANSFORM:""},t.DISTANCE_MATERIAL=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:"",INSTANCE_TRANSFORM:""},uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.distanceRGBA.uniforms),vertexShader:THREE.ShaderLib.distanceRGBA.vertexShader,fragmentShader:THREE.ShaderLib.distanceRGBA.fragmentShader,clipping:!0});class L extends THREE.Mesh{constructor(e,t,n,r,i,a){super(),void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,n,r,i,a),Object.defineProperties(this,{material:{set:function(e){(e=e.clone()).defines?(e.defines.INSTANCE_TRANSFORM="",this.uniformScale?e.defines.INSTANCE_UNIFORM="":delete e.defines.INSTANCE_UNIFORM,this.colors?e.defines.INSTANCE_COLOR="":delete e.defines.INSTANCE_COLOR):(e.defines={INSTANCE_TRANSFORM:""},this.uniformScale&&(e.defines.INSTANCE_UNIFORM=""),this.colors&&(e.defines.INSTANCE_COLOR="")),this._material=e},get:function(){return this._material}},numInstances:{set:function(e){this._numInstances=e},get:function(){return this._numInstances}},geometry:{set:function(e){this._geometry=e},get:function(){return this._geometry}}}),this.isJamieInstancedMesh=!0,this.userData.type="InstancedMesh"}create(e,n,r,i,a,o){this.numInstances=void 0!==r?r:1,this.dynamic=void 0!==i&&i,this.colors=void 0!==a&&a,this.uniformScale=void 0===o||o,this._setAttributes(),this.geometry=(new THREE.InstancedBufferGeometry).copy(e),this.material=n.clone(),this.customDepthMaterial=t.DEPTH_MATERIAL,this.customDistanceMaterial=t.DISTANCE_MATERIAL,this.frustumCulled=!1,this.name="instancedMesh";var s=this.userData;s.numInstances=this.numInstances,s.dynamic=this.dynamic,s.colors=this.colors,s.uniformScale=this.uniformScale}setPositionAt(e,t){this.geometry.attributes.instancePosition.setXYZ(e,t.x,t.y,t.z)}setQuaternionAt(e,t){this.geometry.attributes.instanceQuaternion.setXYZW(e,t.x,t.y,t.z,t.w)}setScaleAt(e,t){this.geometry.attributes.instanceScale.setXYZ(e,t.x,t.y,t.z)}setColorAt(e,t){this.colors?this.geometry.attributes.instanceColor.setXYZ(e,Math.floor(255*t.r),Math.floor(255*t.g),Math.floor(255*t.b)):console.warn("JAMIE.InstancedMesh: color not enabled")}getPositionAt(e,t){var n=this.geometry.attributes.instancePosition.array;return e*=3,t?t.set(n[e++],n[e++],n[e]):new THREE.Vector3(n[e++],n[e++],n[e])}getQuaternionAt(e,t){var n=this.geometry.attributes.instanceQuaternion.array;return e<<=2,t?t.set(n[e++],n[e++],n[e++],n[e]):new THREE.Quaternion(n[e++],n[e++],n[e++],n[e])}getScaleAt(e,t){var n=this.geometry.attributes.instanceScale.array;return e*=3,t?t.set(n[e++],n[e++],n[e]):new THREE.Vector3(n[e++],n[e++],n[e])}getColorAt(e,t){if(!this.colors)return console.warn("JAMIE.InstancedMesh: color not enabled"),!1;var n=1/255,r=this.geometry.attributes.instanceColor.array;return e*=3,t?t.setRGB(r[e++]*n,r[e++]*n,r[e]*n):new THREE.Vector3(r[e++],r[e++],r[e]).multiplyScalar(n)}needsUpdate(e){switch(e){case"position":this.geometry.attributes.instancePosition.needsUpdate=!0;break;case"quaternion":this.geometry.attributes.instanceQuaternion.needsUpdate=!0;break;case"scale":this.geometry.attributes.instanceScale.needsUpdate=!0;break;case"colors":this.geometry.attributes.instanceColor.needsUpdate=!0;break;default:this.geometry.attributes.instancePosition.needsUpdate=!0,this.geometry.attributes.instanceQuaternion.needsUpdate=!0,this.geometry.attributes.instanceScale.needsUpdate=!0,this.colors&&(this.geometry.attributes.instanceColor.needsUpdate=!0)}}_setAttributes(){this.geometry.setAttribute("instancePosition",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0)),this.geometry.setAttribute("instanceQuaternion",new THREE.InstancedBufferAttribute(new Float32Array(4*this.numInstances),4,!0)),this.geometry.setAttribute("instanceScale",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0));var e=!0===this.dynamic?THREE.DynamicDrawUsage:THREE.StaticDrawUsage;this.geometry.attributes.instancePosition.usage=e,this.geometry.attributes.instanceQuaternion.usage=e,this.geometry.attributes.instanceScale.usage=e,this.colors&&(this.geometry.setAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Uint8Array(3*this.numInstances),3,!0)),this.geometry.attributes.instanceColor.normalized=!0,this.geometry.attributes.instanceColor.usage=e)}fromObject(e){var t=e.geometry.clone();delete t.attributes.instanceColor,delete t.attributes.instancePosition,delete t.attributes.instanceQuaternion,delete t.attributes.instanceScale;var n=e.userData;this.create(t,e.material,n.numInstances,n.dynamic,n.colors,n.uniformScale);var r=this.geometry.attributes,i=e.geometry.attributes;r.instancePosition.copy(i.instancePosition),r.instanceQuaternion.copy(i.instanceQuaternion),r.instanceScale.copy(i.instanceScale),i.instanceColor&&r.instanceColor.copy(i.instanceColor)}toJSON(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)}clone(){var e=new t.InstancedMesh(this);return t.copyTransform(e,this),e}split(e){for(var t=[],n=new THREE.Vector3,r=new THREE.Quaternion,i=new THREE.Vector3,a=new THREE.Color,o=this.material,s=this.geometry.attributes,l=s.instancePosition,c=s.instanceQuaternion,u=s.instanceScale,h=s.instanceColor,d=l.count,f=0;f<d;f++){n.fromArray(l.array,3*f),r.fromArray(c.array,4*f),i.fromArray(u.array,3*f);var p=new THREE.BufferGeometry;for(var m in s){var g=s[m];!0!==g.isInstancedBufferAttribute&&p.setAttribute(m,g.clone())}var v=o;h&&(a.fromArray(h.array,3*f),a.multiplyScalar(1/255),(v=o.clone()).color.copy(a));var y=new THREE.Mesh(p,v);y.position.copy(n),y.quaternion.copy(r),y.scale.copy(i),t.push(y)}e&&e(t)}increaseInstances(e){!1===Array.isArray(e)&&(e=[e]);var t=this.geometry.attributes;for(var n in t){var r=t[n];if(!0===r.isInstancedBufferAttribute){var i=[];i.push(r),e.forEach((e=>{i.push(e.geometry.attributes[n])})),t[n]=THREE.BufferGeometryUtils.mergeInstancedBufferAttribute(i),t[n].needsUpdate=!0}}e.forEach((e=>{this.numInstances+=e.geometry.attributes.instancePosition.count})),this.userData.numInstances=this.numInstances}}L.prototype.isInstancedMesh=!0,t.InstancedMesh=L,t.createStructuredMesh=function(e,n){n=n||{};var r=t.toNonIndexedBufferGeometry(e.geometry),i=e.material,a=t.structuredPositions(n),o=a.length/3;if(0!==o){n.numInstances=o;var s=t.randomColors(n);s&&0!==s.length||(s=void 0);var l=new THREE.InstancedMesh(r,i,o);l.name="structuredMesh",l.frustumCulled=!1,t.copyTransform(l,e);for(var c=new THREE.Vector3,u=new THREE.Quaternion(0,0,0,1),h=new THREE.Vector3(1,1,1),d=0,f=0;d<o;d++,f+=3)c.fromArray(a,f),l.setTransformAt(d,c,u,h);return void 0!==s&&(l.addInstanceColorChunk(),l.geometry.setAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Float32Array(s),3))),l}},t.createScatteredMesh=function(e,n){n=n||{};var r=t.toNonIndexedBufferGeometry(e.geometry),i=e.material,a=t.scatteredPositions(n),o=a.positions,s=a.rotations,l=a.scales,c=o.length/3;if(0!==c){var u=t.randomColors(n);u&&0!==u.length||(u=void 0);var h=new THREE.InstancedMesh(r,i,c);h.name="scatteredMesh",h.frustumCulled=!1,t.copyTransform(h,e);for(var d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Euler,m=new THREE.Quaternion(0,0,0,1),g=new THREE.Vector3(1,1,1),v=0,y=0;v<c;v++,y+=3)d.fromArray(o,y),void 0!==s&&(f.fromArray(s,y),p.setFromVector3(f),m.setFromEuler(p)),void 0!==l&&g.fromArray(l,y),h.setTransformAt(v,d,m,g);return void 0!==u&&(h.addInstanceColorChunk(),h.geometry.setAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Float32Array(u),3))),h}},t.createInstancedMeshes=function(e,n){n=n||{};!1===Array.isArray(e)&&(e=[e]);for(var r,i=[],a=0,o=e.length;a<o;a++)r=void 0!==n.pattern?t.createStructuredMesh(e[a],n):t.createScatteredMesh(e[a],n),i.push(r);return 1===i.length?i[0]:i},t.createInstancedObject=function(e,n){if(void 0===n.seed&&(n.seed=e.id),!0===e.isMesh)return t.createInstancedMeshes(e,n);var r=new THREE.Object3D;r.name=e.name;for(var i=e.children,a=0,o=i.length;a<o;a++){var s=t.createInstancedObject(i[a],n);r.add(s)}return t.copyTransform(r,e),r},t.CSGBoolean=function(e,t,n){t=t||"union";var r=new ThreeBSP(e),i=new ThreeBSP(n);"union"===t||"+"===t?r=r.union(i):"intersect"===t||"*"===t?r=r.intersect(i):"subtract"!==t&&"-"!==t||(r=r.subtract(i));var a=null;return e instanceof THREE.Mesh?a=r.toMesh(null):e instanceof THREE.BufferGeometry?a=r.toNonIndexedBufferGeometry():e instanceof THREE.Geometry&&(a=r.toGeometry()),a},t.union=function(e,n){return t.CSGBoolean(e,"+",n)},t.intersect=function(e,n){return t.CSGBoolean(e,"*",n)},t.subtract=function(e,n){return t.CSGBoolean(e,"-",n)},t.createWireframe=function(e,t,n){var r;t=void 0!==t?t:0,n=void 0!==n&&n;(i=e.material).polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=1,i.needsUpdate=!0,r=n?new THREE.EdgesGeometry(e.geometry):new THREE.WireframeGeometry(e.geometry);var i=new THREE.LineBasicMaterial({color:t,linewidth:2});return new THREE.LineSegments(r,i)},t.createVertexPoints=function(e,n,r){var i=t.getObjectSize(e);n=n||i/100,r=r||16777215;return new THREE.Points(e.geometry,new THREE.PointsMaterial({map:(new THREE.TextureLoader).load("images/sprites/ball.png"),size:n,color:r,transparent:!0,alphaTest:.1}))};class C extends THREE.Sprite{constructor(e,n){n=n||{};var r={};r.string=e||"",r.height=n.textHeight||.5,r.widthScale=n.textWidthScale||1,r.color=n.textColor||"#ffffff",r.align=n.textAlign||"center",r.baseline=n.textBaseline||"middle";var i={};i.style=n.fontStyle||"normal",i.variant=n.fontVariant||"normal",i.weight=n.fontWeight||"normal",i.size=n.fontSize||"64px",i.family=n.fontFamily||"Karla, sans-serif";var a=document.createElement("canvas");a.height=parseInt(i.size),a.width=a.height*r.string.length;var o=a.getContext("2d");o.font=i.style+" "+i.variant+" "+i.weight+" "+i.size+" "+i.family,o.textAlign=r.align,o.textBaseline=r.baseline,o.fillStyle=t.toHexStyle(r.color),o.fillText(r.string,a.width/2,a.height/2);var s=new THREE.CanvasTexture(o.canvas);super(new THREE.SpriteMaterial({color:16777215,map:s})),this.type="TextSprite",this.text=r,this.font=i,this.ctx=o;var l=r.height*r.string.length*r.widthScale;this.scale.set(l,r.height,1)}copy(e){return THREE.Sprite.prototype.copy.call(this,e),this.text=JSON.parse(JSON.stringify(e.text)),this.font=JSON.parse(JSON.stringify(e.font)),this.ctx.drawImage(e.ctx.canvas,0,0),this}clone(){return new this.constructor(this.text.string).copy(this)}updateText(e){var n=this.ctx.canvas,r=this.ctx,i=this.text,a=this.font;i.string=e||"",n.height=parseInt(a.size),n.width=n.height*i.string.length,r.font=a.style+" "+a.variant+" "+a.weight+" "+a.size+" "+a.family,r.textAlign=i.align,r.textBaseline=i.baseline,r.fillStyle=t.toHexStyle(i.color),r.fillText(i.string,n.width/2,n.height/2);var o=i.height*i.string.length*i.widthScale;this.scale.set(o,i.height,1),this.material.map.needsUpdate=!0}}C.prototype.isTextSprite=!0,t.TextSprite=C,t.createTextSprite=function(e,n){return new t.TextSprite(e,n)},t.addTextMesh=function(e,n){e=e||"text",(n=n||{}).position=n.position||{x:0,y:0,z:0},n.color=n.color||16777215,n.height=n.height||1,n.thickRatio=n.thickRatio||.25,n.alignment=n.alignment||1,n.rotSpeed=n.rotSpeed||0,n.fontFile=n.fontFile||"fonts/gentilis_regular.typeface.json",(new THREE.FontLoader).load(n.fontFile,(function(r){var i=new THREE.MeshPhongMaterial({color:n.color,specular:n.color}),a=new THREE.TextBufferGeometry(e,{font:r,size:100,height:100*n.thickRatio,curveSegments:12,bevelEnabled:!0,bevelThickness:2,bevelSize:5,bevelSegments:3});a.computeBoundingBox();var o=(a.boundingBox.max.x-a.boundingBox.min.x)*n.alignment/2,s=(new THREE.Matrix4).makeTranslation(-o,0,0);a.applyMatrix(s);var l=new THREE.Mesh(a,i);l.scale.setScalar(n.height/100),l.position.set(n.position.x,n.position.y,n.position.z),l.castShadow=!0,l.receiveShadow=!0,l.name=e,0!==n.rotSpeed&&(l.update=function(e,t){this.rotation.y+=n.rotSpeed*e}),t.add(l)}))},t.createPrimitive=function(e){var t=new THREE[e.geometry.type](...e.geometry.parameters),n=e.material.type;delete e.material.type;var r=new THREE[n](e.material);e.material.type=r.type;var i=new THREE.Mesh(t,r),a=t.type.replace("Buffer","").replace("Geometry",""),o=r.type.replace("Mesh","").replace("Material","");return i.name=a+o,i.frustumCulled=!1,i.castShadow=!0,i.receiveShadow=!0,i},t.createCheckerboard=function(e,n){e=void 0!==e?e:100,n=void 0!==n?n:5;var r=(new THREE.TextureLoader).load("images/grid2x2.png",(t=>{t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(e/(2*n),e/(2*n))})),i=t.createPrimitive({geometry:{type:"PlaneBufferGeometry",parameters:[e,e]},material:{type:"MeshPhongMaterial",map:r}});return i.rotation.x=-Math.PI/2,i},t.tweenObject=function(e,t,n){var r=void 0!==(n=n||{}).duration?n.duration:1e3,i=new P.Tween(e).to(t,r);return void 0!==n.easing&&i.easing(n.easing),void 0!==n.interpolation&&i.interpolation(n.interpolation),void 0!==n.repeat&&i.repeat(n.repeat),void 0!==n.repeatDelay&&i.repeatDelay(n.repeatDelay),!0===n.yoyo&&i.yoyo(n.yoyo),void 0!==n.update&&i.onUpdate((e=>{n.update(e)})),void 0!==n.complete&&i.onComplete((e=>{n.complete(e)})),void 0!==n.start?i.start(n.start+(n.delay||0)):void 0!==n.delay&&i.delay(n.delay),i},t.tweenObjects=function(e,n,r){var i=new P.Group,a=r.delay,o=r.delay||0;return e.forEach(((e,a)=>{void 0!==r.objectDelay&&(r.delay=o+a*r.objectDelay),i.add(t.tweenObject(e,n[a],r))})),r.delay=a,i};class I extends THREE.Object3D{constructor(e){super(),this.previousLodResolution=0,this.create(e,!1),this.name="gridLOD",this.frustumCulled=!1}controlLODParameters(e,t){function n(e,t){return void 0!==e?e:t}void 0===e&&(e={}),(t=n(t,!1))?(this.lodResolution=n(e.resolution,this.lodResolution),this.lodLevels=n(e.levels,this.lodLevels),this.lodScale=n(e.scale,this.lodScale),this.lodMorphingLevels=n(e.morphingLevels,this.lodMorphingLevels),this.lodMaterial=n(e.material,this.lodMaterial)):(this.lodResolution=n(e.resolution,64),this.lodLevels=n(e.levels,8),this.lodScale=n(e.scale,1),this.lodMorphingLevels=n(e.morphingLevels,2),this.lodMaterial=n(e.material,void 0)),this.lodLevels=Math.max(1,Math.round(this.lodLevels)),this.lodScale=Math.max(1,this.lodScale),this.lodResolution=Math.max(1,this.lodResolution),this.lodResolution=Math.pow(2,Math.round(Math.log2(this.lodResolution))),this.lodMorphingLevels=Math.max(0,Math.min(2,Math.round(this.lodMorphingLevels))),this.previousLodResolution=this.lodResolution}createLODMaterial(){var e=t.GridLODShader,n=THREE.UniformsUtils.clone(e.uniforms);return n.u_resolution={value:this.lodResolution},n.u_level={value:this.lodLevels},n.u_scale={value:this.lodScale},n.u_morphingLevels={value:this.lodMorphingLevels},n.u_usePlaneParameters={value:0},n.u_planeUp={value:new THREE.Vector3(0,1,0)},n.u_planeAt={value:new THREE.Vector3(0,0,1)},n.u_planePoint={value:new THREE.Vector3(0,0,0)},n.u_planeDistance={value:0},new THREE.ShaderMaterial({uniforms:n,vertexShader:e.buildVertexShader("lod"),fragmentShader:e.fragmentShader,side:THREE.DoubleSide,wireframe:!1})}create(e,t){var n=this.previousLodResolution;if(this.controlLODParameters(e,t),!1===t&&(this.lodMaterial=this.createLODMaterial()),n!==this.lodResolution){for(this.gridGeometry=this.createLODGeometry(this.lodResolution),this.gridOutsideGeometry=this.createLODGeometry(this.lodResolution,!0);this.children.length>0;)this.remove(this.children[0]);this.lodMaterial.uniforms.u_resolution.value=this.lodResolution;for(var r=this.lodScale,i=0;i<this.lodLevels;i++){var a=0===i?this.gridGeometry:this.gridOutsideGeometry;this.add(this.createLODMesh(a,this.lodMaterial,r,i)),r*=2}}}createLODMesh(e,t,n,r){var i=t.clone();return i.uniforms.u_scale.value=n,i.uniforms.u_level.value=r,new THREE.Mesh(e,i)}createLODGeometry(e,t){function n(e,t){return void 0!==e?e:t}e=n(e,64),t=n(t,!1);var r=new THREE.BufferGeometry,i=Math.round(.5*e),a=(e+2)*(e+2)*2,o=new Float32Array(3*((e+3)*(e+3))),s=new(o.length/3>65535?Uint32Array:Uint16Array)(3*a);r.setIndex(new THREE.BufferAttribute(s,1)),r.setAttribute("position",new THREE.BufferAttribute(o,3));for(var l=0,c=-i-1;c<=i+1;c++)for(var u=-i-1;u<=i+1;u++)o[l]=c/e,o[l+1]=0,o[l+2]=u/e,l+=3;l=0;var h=e+3,d=e/4,f=3*d;for(c=0;c<=e+1;c++){var p=c,m=c+1,g=c>d&&c<=f;for(u=0;u<=e+1;u++){var v=u+1;if(!(t&&g&&(u>d&&u<=f))){var y=h*p+v,_=h*m+v,b=h*m+u,E=h*p+u;s[l]=y,s[l+1]=_,s[l+2]=E,s[l+3]=E,s[l+4]=_,s[l+5]=b,l+=6}}}return r}setLODScale(e){this.lodScale=e,this.controlLODParameters({},!0);var t=this.lodScale;this.children.forEach((e=>{e.material.uniforms.u_scale.value=t,t*=2}))}setMorphingLevels(e){this.lodMorphingLevels=e,this.controlLODParameters({},!0),e=this.lodMorphingLevels,this.children.forEach((t=>{t.material.uniforms.u_morphingLevels.value=e}))}setMaterialValue(e,t){this.lodMaterial[e]=t,this.children.forEach((n=>{n.material[e]=t}))}setUniformValue(e,t){this.lodMaterial.uniforms[e].value=t,this.children.forEach((n=>{n.material.uniforms[e].value=t}))}getUniformValue(e){return this.lodMaterial.uniforms[e].value}createParentCamera(){return this.parent instanceof THREE.PerspectiveCamera||(this.parent=t.appWorks.camera.clone(),this.parent.add(this)),this.parent}update(e,t){!0===this.getUniformValue("u_animate")&&this.setUniformValue("u_time",t)}}I.prototype.isGridLOD=!0,t.GridLOD=I,t.createGridLOD=function(e,n,r,i){return new t.GridLOD({resolution:e,levels:n,scale:r,morphingLevels:i})};class N extends THREE.Object3D{constructor(e,t,n,r,i){var a=void 0!==arguments[0]&&arguments[0].isObject3D?0:1;super(),a?this.create(e,t,n,r,i):this.fromObject(arguments[0]),this.userData.type="TerrainLOD"}create(e,n,r,i,a){this.name="terrainLOD",this.frustumCulled=!1;var o=0,s=1,l=2,c=4,u=8,h=new THREE.TextureLoader;this.diffuse1=h.load("images/terrain/rockyTerrainGrass.jpg"),this.diffuse2=h.load("images/terrain/rockyTerrainDirt.jpg"),this.diffuse1.wrapS=this.diffuse1.wrapT=THREE.RepeatWrapping,this.diffuse2.wrapS=this.diffuse2.wrapT=THREE.RepeatWrapping;var d=this.userData;d.landscape=void 0!==e?e:"GIANT",d.worldWidth=void 0!==n?n:1024,d.levels=void 0!==r?r:4,d.resolution=void 0!==i?i:64,d.maxHeight=void 0!==a?a:.1*t.WORLD_SIZE,d.globalOffset=new THREE.Vector3(0,0,0),this.heightMap=this.getHeightMap(d.worldWidth,d.landscape),this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,d.resolution,d.resolution),this.tileGeometry.translate(.5,.5,0);var f=d.worldWidth/Math.pow(2,d.levels);this.createTile(-f,-f,f,o),this.createTile(-f,0,f,o),this.createTile(0,0,f,o),this.createTile(0,-f,f,o);for(var p=f;p<d.worldWidth;p*=2)this.createTile(-2*p,-2*p,p,c|l),this.createTile(-2*p,-p,p,l),this.createTile(-2*p,0,p,l),this.createTile(-2*p,p,p,s|l),this.createTile(-p,-2*p,p,c),this.createTile(-p,p,p,s),this.createTile(0,-2*p,p,c),this.createTile(0,p,p,s),this.createTile(p,-2*p,p,c|u),this.createTile(p,-p,p,u),this.createTile(p,0,p,u),this.createTile(p,p,p,s|u)}createTile(e,t,n,r){var i=this.createTileMaterial(new THREE.Vector2(e,t),n,r),a=new THREE.Mesh(this.tileGeometry,i);a.rotation.x=-Math.PI/2,a.frustumCulled=!1,a.castShadow=!1,a.receiveShadow=!0,this.add(a)}createTileMaterial(e,n,r){var i=this.userData,a=t.TerrainLODShader,o=THREE.UniformsUtils.clone(a.uniforms);o.tDiffuse1.value=this.diffuse1,o.tDiffuse2.value=this.diffuse2,o.worldWidth.value=parseFloat(i.worldWidth),o.tileResolution.value=parseFloat(i.resolution),o.edgeMorph.value=r,o.globalOffset.value=i.globalOffset,o.tileOffset.value=e,o.heightMap.value=this.heightMap,o.tileScale.value=parseFloat(n),o.maxHeight.value=i.maxHeight,o.winterSnow.value=!1,o.summerGreen.value=!1;var s={};t.isWebGL2()&&(s.texture2DLod="textureLod");var l=new THREE.ShaderMaterial({defines:s,uniforms:o,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,lights:!0,fog:void 0!==t.appWorks.scene.fog});return l.extensions={derivatives:!0,shaderTextureLOD:!0},l}getHeightMap(e,n){var r,i,a,o,s,l,c=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),n=new THREE.Matrix3;n.elements=[.8,-.6,0,.6,.8,0,0,0,0];var r=new THREE.Vector3;return function(e){r.copy(e);for(var i=0,a=.5,o=0,s=0;s<5;s++){var l=Math.abs(t(r.x,r.y));i+=a*l/(1+(o+=l)*o*o),a*=.5,r.multiplyScalar(2).applyMatrix3(n)}return Math.pow(i,1)}}(),u=(r=new THREE.SimplexNoise,i=r.noise.bind(r),a=new THREE.Vector3(100,100,0),o=new THREE.Vector3,function(e){o.copy(e);for(var t=0,n=.5,r=0;r<5;r++)t+=n*Math.abs(i(o.x,o.y)),o.multiplyScalar(2).add(a),n*=.5;return Math.pow(.5*t+.5,2)}),h=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),n=new THREE.Vector3(100,100,0),r=new THREE.Vector3;return function(e){r.copy(e);for(var i=0,a=.5,o=0;o<2;o++)i+=a*Math.abs(t(r.x,r.y)),r.multiplyScalar(2).add(n),a*=.5;return Math.pow(i,1.5)}}(),d=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),n=new THREE.Vector3(100,100,0),r=new THREE.Vector3;return function(e){r.copy(e);for(var i=0,a=.5,o=0;o<5;o++){var s=1-Math.abs(t(r.x,r.y));i+=a*(s*s),r.multiplyScalar(2).add(n),a*=.5}return Math.pow(i,2)}}(),f=function(){var e=new THREE.Vector3;return function(n){var r=d(e.copy(n).multiplyScalar(9)),i=u(e.copy(n).multiplyScalar(2)),a=h(e.copy(n)),o=(a+=.25*a)/100;return t.mix(i,r,t.smoothstep(.45,.55,o))}}(),p=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),n=new THREE.Matrix3,r=new THREE.Matrix3;n.elements=[.8,-.6,0,.6,.8,0,0,0,0],r.elements=[1.3623,1.7531,0,-1.7131,1.4623,0,0,0,0];var i=new THREE.Vector3,a=new THREE.Vector3;function o(e){i.copy(e);var r=0;return r+=.5*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.02).applyMatrix3(n),r+=.25*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.03).applyMatrix3(n),r+=.125*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.01).applyMatrix3(n),(r+=.0625*Math.abs(t(i.x,i.y)))/.9375}return function(e){i.copy(e).multiplyScalar(5),a.copy(i).multiplyScalar(.25);var t=.75*o(a)+.25;t*=2*t;for(var n=0,s=0;s<5;s++)n+=t*o(i),t=.5*-t,i.applyMatrix3(r);a.copy(i).multiplyScalar(.002);var l=o(a);return n+=Math.pow(Math.abs(l),10),Math.pow(n,2)}}(),m=function(){function e(e){return Math.abs(function(e){return e-parseInt(e)}(e)-.5)}function t(t){return e(t.x+e(1.5*(t.y-.25)))+e(t.y-e(1.5*(t.x+.5)))}function n(e){return.25+.25*Math.cos(6.2831853*e)}function r(e){return n(e.x+n(1.5*(e.y-.25)))+n(e.y-n(1.5*(e.x+.5)))}var i=new THREE.Vector3,a=new THREE.Vector3;return function(e){i.copy(e).multiplyScalar(2);var n=.66*r(a.copy(i).divideScalar(2))+.34*r(a.copy(i));return.75*(n=.75*function(e){return(e=Math.max((e-.3)/.7,0))*e*(3-2*e)}(n)+.15*t(a.copy(i))+.1*t(a.copy(i).multiplyScalar(4)))}}(),g=(s=t.createFbmNoise({octaves:4,persistence:.5,noiseType:"simplex3d"}),function(e){return Math.abs(s(e.x,e.y,1))}),v=function(){var e=new THREE.ImprovedNoise,t=new THREE.Vector3;return function(n){t.copy(n);for(var r=0,i=.5,a=0;a<4;a++)r+=i*Math.abs(e.noise(t.x,t.y,0))*2.5,t.multiplyScalar(2),i*=.5;return Math.pow(r,2)}}();e=void 0!==e?e:1024;switch(n=void 0!==n?n:"GIANT"){case"BADLAND":l=c;break;case"MOUNTAIN":l=u;break;case"DOME":l=h;break;case"RIDGE":l=d;break;case"DESIGN":l=f;break;case"GIANT":l=p;break;case"TRIANGLE":l=m;break;case"GREAT":l=g;break;case"HUGE":l=v;break;default:l=p}var y=0,_=256,b=new THREE.Vector3,E=new Uint8Array(e*e);"GIANT"===n&&(_=512);for(var w=0;w<e;w++)for(var x=0;x<e;x++)b.x=x/_,b.y=w/_,E[y++]=256*l(b);var T=new THREE.DataTexture(E,e,e,THREE.AlphaFormat);return T.wrapS=THREE.MirroredRepeatWrapping,T.wrapT=THREE.MirroredRepeatWrapping,T.magFilter=THREE.NearestFilter,T.minFilter=THREE.NearestFilter,T.generateMipmaps=!0,T.needsUpdate=!0,T}fromObject(e){var t=e.userData;this.create(t.landscape,t.worldWidth,t.levels,t.resolution,t.maxHeight)}toJSON(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)}clone(){var e=new t.TerrainLOD(this);return t.copyTransform(e,this),e}updateVisible(e){t.appWorks.setValue(this,"visible",e)}updateResolution(e){this.userData.resolution=e,this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,e,e);var t=new THREE.Matrix4;t.makeTranslation(.5,.5,0),this.tileGeometry.applyMatrix(t),this.children.forEach((t=>{t.material.uniforms.tileResolution=parseFloat(e)}))}updateMaxHeight(e){this.userData.maxHeight=e,this.children.forEach((t=>{t.material.uniforms.maxHeight=e}))}}N.prototype.isTerrainLOD=!0,t.TerrainLOD=N,t.createTerrainLOD=function(e,n,r,i,a){return new t.TerrainLOD(e,n,r,i,a)},t.createHeightMapTerrain=function(e,n,r){var i=void 0!==n.highZoneFile?n.highZoneFile:"images/terrain/rockyTerrainGrass.jpg",a=void 0!==n.lowZoneFile?n.lowZoneFile:"images/terrain/rockyTerrainDirt.jpg",o=void 0!==n.worldWidth?n.worldWidth:1024,s=void 0!==n.resolution?n.resolution:1024,l=void 0!==n.tileOffset?n.tileOffset:new THREE.Vector2(0,0),c=void 0!==n.tileScale?n.tileScale:o,u=void 0!==n.maxHeight?n.maxHeight:.05*t.WORLD_SIZE,h=new THREE.PlaneBufferGeometry(1,1,s,s);h.translate(.5,.5,0);var d=[e,i,a];t.loadTextures(d,(e=>{var[n,i,a]=e;n.magFilter=THREE.LinearFilter,n.minFilter=THREE.LinearMipMapLinearFilter,n.generateMipmaps=!0,n.needsUpdate=!0;var d=t.TerrainLODShader,f=THREE.UniformsUtils.clone(d.uniforms);f.tDiffuse1.value=i,f.tDiffuse2.value=a,f.worldWidth.value=parseFloat(o),f.tileResolution.value=parseFloat(s),f.edgeMorph.value=0,f.globalOffset.value=new THREE.Vector3(0,0,0),f.tileOffset.value=l,f.heightMap.value=n,f.tileScale.value=parseFloat(c),f.maxHeight.value=u,f.winterSnow.value=!1,f.summerGreen.value=!0;var p={};t.isWebGL2()?p.texture2DLodEXT="textureLod":p.texture2DLodEXT="texture2DLod";var m=new THREE.ShaderMaterial({defines:p,uniforms:f,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,lights:!0,fog:void 0!==t.appWorks.scene.fog});m.extensions={derivatives:!0,shaderTextureLOD:!0};var g=new THREE.Mesh(h,m);g.rotation.x=-Math.PI/2,g.position.x-=o/2,g.position.z+=o/2,g.frustumCulled=!1,g.castShadow=!1,g.receiveShadow=!0,g.name="heightMapTerrain",r&&r(g)}))};var F=__webpack_require__(5744),O=__webpack_require__(9756),H=__webpack_require__(16);t.GraphicWorks=function(e){var n=this;e=e||{};this.appName=e.appName||"GraphicWorks",this.customer=e.customer||"NovaGraphix";var r,[i,a]=y();if(this.width=e.width||i,this.height=e.height||a,this.widthRatio=this.width/i,this.heightRatio=this.height/a,this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="GraphicWorks",this.dom.tabIndex=t.tabIndices[this.dom.id],this.dom.style.width=this.width+"px",this.dom.style.height=this.height+"px",this.signals=null,!0===e.signals){var o=F.Signal;this.signals={startPlayer:new o,stopPlayer:new o,appWorksCleared:new o,autoSaveStarted:new o,autoSaveFinished:new o,themeChanged:new o,transformModeChanged:new o,snapChanged:new o,spaceChanged:new o,sceneBackgroundChanged:new o,sceneFogChanged:new o,sceneGraphChanged:new o,cameraChanged:new o,geometryChanged:new o,objectSelected:new o,objectFocused:new o,objectsSelected:new o,objectAdded:new o,objectChanged:new o,objectRemoved:new o,helperAdded:new o,helperChanged:new o,helperRemoved:new o,materialChanged:new o,windowResize:new o,axesHelperChanged:new o,gridHelperChanged:new o,initSidebar:new o,historyChanged:new o},(r=n.signals).startPlayer.add((function(){n.history.historyDisabled=!0})),r.stopPlayer.add((function(){n.history.historyDisabled=!1})),r.themeChanged.add((function(){})),r.sceneBackgroundChanged.add((function(e){n.config.setSettings("background",e)})),r.sceneFogChanged.add((function(e){n.createSceneFog(e),v()})),r.gridHelperChanged.add((function(e,r,i){t.dispose(n.gridHelper),n.gridHelper=m(e,r,i),n.sceneHelpers.add(n.gridHelper),v()})),r.geometryChanged.add((function(e){})),r.materialChanged.add((function(e){})),r.objectAdded.add((function(e){var t=n.selectables;e.traverse((function(e){t.push(e)}))})),r.objectRemoved.add((function(e){n.transformControls&&n.transformControls.object===e&&n.transformControls.detach();var t=n.selectables;e.traverse((function(e){t.splice(t.indexOf(e),1)}))})),r.objectChanged.add((function(e){e instanceof THREE.PerspectiveCamera&&e.updateProjectionMatrix(),!e.helper||e.helper instanceof THREE.SkeletonHelper||(e.helper.update(),r.helperChanged.dispatch(e.helper)),v()})),r.objectsSelected.add((function(e){if(Array.isArray(e)){if(1===e.length){var t=e[0];if(null===t.parent)return;var r=n.transformControls.enabled;n.transformControls.detach(),n.transformControls.attach(t),n.transformControls.visible=r,n.transformControls.enabled=r}if(n.outlinePass.enabled){var i=n.outlinePass;i.selectedObjects=[],e.forEach((function(e){e.traverse((function(e){0===e.children.length&&i.selectedObjects.push(e)}))}))}}})),r.objectFocused.add((function(e){var r=new THREE.Vector3;e&&r.copy(e.position),n.controls instanceof THREE.OrbitControls||n.controls instanceof THREE.TrackballControls?(n.controls.target.copy(r),n.controls.update()):n.controls instanceof THREE.FirstPersonControls&&(n.controls.lookAt(r),n.controls.update(t.getDeltaTime()))})),r.helperAdded.add((function(e){var t=e.getObjectByName("picker");n.selectables.push(t)})),r.helperChanged.add((function(e){var t=e.light;t&&(e.visible=t.visible)})),r.helperRemoved.add((function(e){var t=n.selectables,r=e.getObjectByName("picker");t.splice(t.indexOf(r),1)})),r.cameraChanged.add((function(e){e&&(n.config.setSettings("cameraFov",e.fov),n.config.setSettings("cameraNear",e.near),n.config.setSettings("cameraFar",e.far)),v()})),r.historyChanged.add((function(){var e=n.history;e.undos.length,e.redos.length})),r.appWorksCleared.add((function(){n.select(null),n.focus(),v()})),r.autoSaveStarted.add((function(){})),r.autoSaveFinished.add((function(){})),r.transformModeChanged.add((function(e){n.transformControls.setMode(e)})),r.snapChanged.add((function(e){n.transformControls.setTranslationSnap(e)})),r.spaceChanged.add((function(e){n.transformControls.setSpace(e)})),r.windowResize.add((function(){_()}))}this.config=null,!0===e.config&&(this.config=new t.Config(this.appName),this.config.initDatabase((function(){var e;function t(){!1!==n.config.getSettings("autosave")&&(clearTimeout(e),e=setTimeout((function(){n.signals.autoSaveStarted.dispatch(),e=setTimeout((function(){n.config.setDatabase(n.toJSON()),n.signals.autoSaveFinished.dispatch()}),100)}),1e3))}n.config.getDatabase((function(e){void 0!==e&&n.fromJSON(e)}));var r=n.signals;r.geometryChanged.add(t),r.materialChanged.add(t),r.objectAdded.add(t),r.objectChanged.add(t),r.objectRemoved.add(t),r.sceneBackgroundChanged.add(t),r.sceneFogChanged.add(t),r.sceneGraphChanged.add(t),r.historyChanged.add(t)}))),this.history=null,!0===e.history&&(this.history=new t.History(this)),2===e.glVersion&&t.isWebGL2Available()?this.renderer=new THREE.WebGLRenderer({alpha:!0,powerPreference:"high-performance"}):this.renderer=new THREE.WebGL1Renderer({alpha:!0,powerPreference:"high-performance"}),this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.outputEncoding=THREE.sRGBEncoding,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName,this.createSceneFog=function(e){this.scene.fog=t.createFog(e)},this.createSceneFog(e.fog),this.createSceneBackground=function(e){e=void 0!==e?e:this.config?this.config.getSettings("background"):null;this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.background=t.createBackground(e)},this.createSceneBackground(e.background);var s,l,c,u,h=e.cameraFov||this.config?this.config.getSettings("cameraFov"):50,d=e.cameraNear||this.config?this.config.getSettings("cameraNear"):.01,f=e.cameraFar||this.config?this.config.getSettings("cameraFar"):1e4,p=e.cameraPosition||this.config?this.config.getSettings("cameraPosition"):[0,0,50];function m(e,r,i){e=e||n.config?n.config.getSettings("gridHelperSize"):500,r=r||n.config?n.config.getSettings("gridHelperSpacing"):5,i=i||n.config?n.config.getSettings("gridHelperColor"):4210752;e=~~(e/r),e*=r;var a=new THREE.GridHelper(e,e/r,16729156,i);a.position.y=0,a.name="gridHelper";for(var o=.05*r,s=e/2,l=[],c=-s;c<=s;c+=r)l.push(c.toFixed(2));return l.forEach((function(e){var n=t.createTextSprite(e,{textHeight:o,fontWeight:"bold"}),r=n.clone();n.position.set(parseFloat(e),o/2,0),r.position.set(0,o/2,parseFloat(e)),a.add(n),a.add(r)})),a}function g(){n.animateID=window.requestAnimationFrame(g),function(){var e=t.getDeltaTime(),r=t.getCurrentTime();n.stats&&n.stats.update();n.animator.update(e),n.scene.traverse((function(t){t.update&&t.update(e,r)})),n.sceneHUD&&n.sceneHUD.traverse((function(t){t.update&&t.update(e,r)}));var i=n.controls;i.enabled&&(i instanceof THREE.OrbitControls?!0!==i.autoRotate&&!0!==i.enableDamping||i.update():i instanceof THREE.TrackballControls?i.update():(i instanceof THREE.FirstPersonControls||!0===i.isTPSCameraControl)&&i.update(e))}(),v()}function v(){n.effect?(n.renderer.setRenderTarget(null),n.effect.render(n.scene,n.camera)):n.composer?n.composer.render(t.getDeltaTime()):"MedicalWorks"!==n.appName&&n.renderer.render(n.scene,n.camera)}function y(){return[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)]}function _(){var[e,t]=y();(n.width=n.widthRatio*e,n.height=n.heightRatio*t,n.dom.style.width=n.width+"px",n.dom.style.height=n.height+"px",n.camera.aspect=n.width/n.height,n.camera.updateProjectionMatrix(),function(){if(!n.sceneHUD||!n.cameraHUD)return;var e=n.cameraHUD,t=e.right,r=e.top,i=n.width/2,a=n.height/2;e.left=-i,e.right=i,e.top=a,e.bottom=-a,e.updateProjectionMatrix(),n.sceneHUD.children.forEach((e=>{var n=e.position;n.x*=1+(i-t)/Math.abs(n.x),n.y*=1+(a-r)/Math.abs(n.y)}))}(),n.FXAAShader.enabled&&n.FXAAShader.uniforms.resolution.value.set(1/n.width,1/n.height),n.renderer.setSize(n.width,n.height),n.composer&&n.composer.setSize(n.width,n.height),n.effect&&n.effect.setSize(n.width,n.height),n.controls.enabled&&(n.controls instanceof THREE.OrbitControls||n.controls.handleResize()),"NatureWorks"===n.appName)&&n.scene.getObjectsByType("FireParticles").forEach((function(e){e.setNearPlaneHeight()}))}function b(e){var r=n.dom.getBoundingClientRect(),i=t.getMouseScreenCoords(e);return i.x=(i.x-r.left)/r.width*2-1,i.y=-(i.y-r.top)/r.height*2+1,i}function E(e,t){return n.raycaster.setFromCamera(e,n.camera),n.raycaster.intersectObjects(t,!0)}function w(){var e=n.getIntersectObject(n.xinfo);e&&("picker"===e.name?n.select(e.userData.object):event.ctrlKey?n.select(e,"multiple"):event.altKey?n.select(e,"ancestor"):n.select(e),v())}function x(e){n.mouseUpPosition.copy(b(e)),w(),document.removeEventListener("mouseup",x,!1)}function T(e){e.preventDefault(),c&&(clearTimeout(c),u=!1),n.mouseUpPosition.copy(b(e)),w(),document.removeEventListener("touchend",T,!1)}function A(e){n.mouseUpPosition.copy(n.mouseDownPosition),M(e)}function M(e){n.guiContextMenu&&(n.getIntersectObject()&&n.guiContextMenu.toggle(e))}function S(e){switch(n.appName){case"ViewWorks":!function(e){switch(e.stopPropagation(),e.keyCode){case 8:e.preventDefault();case 27:n.controls.enabled=!0;break;case 49:t.nextShowroom("background");break;case 50:t.nextShowroom("floor");break;case 66:break;case 79:if(n.animator&&n.selectObject){var r=n.selectObject.activeAction;r.paused=!r.paused}break;case 80:n.animator&&n.selectObject&&n.playNextAction(n.selectObject)}}(e);break;case"GameWorks":!function(e){switch(e.keyCode){case 66:t.demoApplication();break;case 191:t.gamePlay()}}(e);break;case"NatureWorks":!function(e){122!==e.keyCode&&e.preventDefault();e.stopPropagation();var r=t.isCtrlKeyDown(e);if(r&&90===e.keyCode)return void n.undo();if(r&&89===e.keyCode)return void n.redo();switch(e.keyCode){case 8:e.preventDefault();case 46:var i=n.selectObject;i&&i.parent&&n.remove(i);break;case 18:break;case 27:n.controls.enabled=!0;break;case 49:t.filmGrainBackground();break;case 50:break;case 66:t.demoApplication();break;case 67:n.controls instanceof THREE.OrbitControls?n.controls=t.createCameraControls("FirstPersonControls"):n.controls instanceof THREE.FirstPersonControls&&(n.controls=t.createCameraControls("OrbitControls"));break;case 70:t.demoLoadFiles();break;case 72:t.add(t.createHemisphereLight());break;case 73:t.cameraAutoView({isWorking:!0})?t.cameraAutoView({viewMode:"stop"}):t.cameraAutoView({viewMode:"circle"});break;case 76:t.toggleLightHelpers();break;case 77:void 0!==n.sound&&(n.sound.playing()?n.sound.pause():n.sound.play());break;case 78:t.add(t.createSky()),t.add(t.createSunLight());break;case 79:if(n.animator&&n.selectObject){var a=n.selectObject.activeAction;a.paused=!a.paused}break;case 80:n.animator&&n.selectObject&&n.playNextAction(n.selectObject);break;case 86:t.demoRaymarchToPoints();break;case 112:n.appGUI&&n.appGUI.toggle(n.guiSceneGraph.dom);break;case 113:n.appGUI&&n.appGUI.toggle();break;case 114:n.dragControls.enabled=!n.dragControls.enabled;break;case 115:n.transformControls.visible=!n.transformControls.visible,n.transformControls.enabled=!n.transformControls.enabled;break;case 116:n.guiSidebar&&n.guiSidebar.select(n.guiStrings.getKey("menubar/edit/scene"),"inclusive");break;case 117:t.screenCapture();break;case 118:break;case 119:n.selectObject&&n.focus(n.selectObject);break;case 120:n.config.clearSettings(),console.log('>> clear the "window.localStorage"...');break;case 121:n.config.clearDatabase(),console.log('>> clear the "window.indexedDB"...');break;case 123:void 0!==n.dragVertexControls&&(n.dragVertexControls.enabled=!n.dragVertexControls.enabled,n.controls.enabled=!n.dragVertexControls.enabled);break;case 191:t.gamePlay();break;case 81:n.transformControls.setSpace("local"===n.transformControls.space?"world":"local");break;case 17:n.transformControls.setTranslationSnap(n.config.getSettings("translationSnap")),n.transformControls.setRotationSnap(THREE.Math.degToRad(n.config.getSettings("rotationSnap")));break;case 87:n.transformControls.setMode("translate");break;case 69:n.transformControls.setMode("rotate");break;case 82:n.transformControls.setMode("scale");break;case 187:case 107:n.transformControls.setSize(n.transformControls.size+.1);break;case 189:case 109:n.transformControls.setSize(Math.max(n.transformControls.size-.1,.1));break;case 88:n.transformControls.showX=!n.transformControls.showX;break;case 89:n.transformControls.showY=!n.transformControls.showY;break;case 90:n.transformControls.showZ=!n.transformControls.showZ;break;case 32:n.transformControls.visible=!n.transformControls.visible,n.transformControls.enabled=!n.transformControls.enabled}}(e);break;case"MedicalWorks":t.MedicalKeyboard(e)}}this.defaultCamera=new THREE.PerspectiveCamera(h,this.width/this.height,d,f),this.defaultCamera.position.set(p[0],p[1],p[2]),this.defaultCamera.lookAt(this.scene.position),this.defaultCamera.name="camera",this.camera=this.defaultCamera.clone(),this.controls=t.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animator=new t.Animator(this.scene),this.playAction=function(e,t,n){this.animator.playAction(e,t,n)},this.playNextAction=function(e){this.animator.playNextAction(e)},this.stopAction=function(e,t){this.animator.stopAction(e,t)},this.stats=null,!0!==e.stats||t.isDeviceMobile()||(this.stats=new O,this.stats.dom.style.cssText="position:absolute; bottom:0px; right:0px",this.dom.appendChild(this.stats.dom)),this.raycaster=new THREE.Raycaster,this.selectObject=null,this.selectObjects=[],this.selectables=[],this.mouseMovePosition=new THREE.Vector2,this.mouseDownPosition=new THREE.Vector2,this.mouseUpPosition=new THREE.Vector2,this.mouseDoubleClickPosition=new THREE.Vector2,this.playAudio=function(e){this.sound&&this.sound.unload(),this.sound=t.playAudio(e)},this.playAudio(e.audioFiles),this.sceneHelpers=new THREE.Scene,"NatureWorks"===this.appName&&(this.gridHelper=m(),this.gridHelper.visible=e.gridVisible||!1,this.sceneHelpers.add(this.gridHelper)),this.sceneHUD=null,this.cameraHUD=null,!0===e.hud&&(this.sceneHUD=new THREE.Scene,this.cameraHUD=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,100.1),this.cameraHUD.position.z=50.1),function(e){e=e||{};n.composer=new THREE.EffectComposer(n.renderer),n.composer.setSize(n.width,n.height),n.renderPass=new THREE.RenderPass(n.scene,n.camera),n.renderPass.clear=!0,n.renderPass.clearDepth=!1,n.composer.addPass(n.renderPass),n.sceneHelpers&&(n.renderPass2=new THREE.RenderPass(n.sceneHelpers,n.camera),n.renderPass2.clear=!1,n.renderPass2.clearDepth=!1,n.composer.addPass(n.renderPass2));n.sceneHUD&&(n.renderPass3=new THREE.RenderPass(n.sceneHUD,n.cameraHUD),n.renderPass3.clear=!1,n.renderPass3.clearDepth=!1,n.composer.addPass(n.renderPass3));void 0!==e.bleachEnabled&&(n.bleachShader=new THREE.ShaderPass(THREE.BleachBypassShader),n.bleachShader.enabled=e.bleachEnabled,n.composer.addPass(n.bleachShader));void 0!==e.bloomEnabled&&(n.bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(n.width,n.height),2.5,.45,.88),n.bloomPass.enabled=e.bloomEnabled,n.composer.addPass(n.bloomPass));void 0!==e.dotScreenEnabled&&(n.dotScreenShader=new THREE.ShaderPass(THREE.DotScreenShader),n.dotScreenShader.uniforms.scale.value=4,n.dotScreenShader.enabled=e.dotScreenEnabled,n.composer.addPass(n.dotScreenShader));void 0!==e.glitchEnabled&&(n.glitchPass=new THREE.GlitchPass(0),n.glitchPass.enabled=e.glitchEnabled,n.composer.addPass(n.glitchPass));void 0!==e.sepiaEnabled&&(n.sepiaShader=new THREE.ShaderPass(THREE.SepiaShader),n.sepiaShader.enabled=e.sepiaEnabled,n.composer.addPass(n.sepiaShader));if(void 0!==e.outlineEnabled){n.outlinePass=new THREE.OutlinePass(new THREE.Vector2(n.width,n.height),n.scene,n.camera),n.outlinePass.enabled=e.outlineEnabled,n.composer.addPass(n.outlinePass),(new THREE.TextureLoader).load("images/tri_pattern.jpg",(function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,n.outlinePass.patternTexture=e}))}e.FXAAEnabled=!0,void 0!==e.FXAAEnabled&&(n.FXAAShader=new THREE.ShaderPass(THREE.FXAAShader),n.FXAAShader.uniforms.resolution.value.set(1/n.width,1/n.height),n.FXAAShader.enabled=e.FXAAEnabled,n.composer.addPass(n.FXAAShader));void 0!==e.ssaoEnabled&&(n.ssaoPass=new THREE.SSAOPass(n.scene,n.camera,n.width,n.height),n.ssaoPass.enabled=e.ssaoEnabled,n.composer.addPass(n.ssaoPass));void 0!==e.godRaysEnabled&&(n.godRaysPass=new t.GodRaysPass(n.scene,n.camera,n.width,n.height),n.godRaysPass.enabled=e.godRaysEnabled,n.composer.addPass(n.godRaysPass));void 0!==e.bokehEnabled&&(n.bokehPass=new THREE.BokehPass(n.scene,n.camera,{width:n.width,height:n.height,vignetting:1}),n.bokehPass.enabled=e.bokehEnabled,n.composer.addPass(n.bokehPass));void 0!==e.vignetteEnabled&&(n.vignetteShader=new THREE.ShaderPass(THREE.VignetteShader),n.vignetteShader.enabled=e.vignetteEnabled,n.composer.addPass(n.vignetteShader));n.gammaCorrection=new THREE.ShaderPass(THREE.GammaCorrectionShader),n.composer.addPass(n.gammaCorrection)}(e),this.cameraEffect=function(e){this.effect=t.createCameraEffect(e,this.renderer),this.effect?this.effect.setSize(this.width,this.height):this.renderer.setSize(this.width,this.height)},this.cameraEffect(e.effectType),this.fileExplorer=null,!0===e.fileExplorer&&(this.fileExplorer=new t.FileExplorer(this)),this.dragControls=null,!0===e.dragControls&&(this.dragControls=function(e,t,r){var i=null,a=new THREE.DragControls(e,t,r.domElement);return a.enabled=!1,a.addEventListener("dragstart",(function(e){if(this.enabled){var t=e.object;i=t.position.clone(),n.controls.enabled=!1,n.select(t)}})),a.addEventListener("dragend",(function(e){if(this.enabled){var t=e.object;void 0!==t&&(i.equals(t.position)||n.setPosition(t,t.position,i)),n.controls.enabled=!0}})),a}(this.scene.children,this.camera,this.renderer)),this.transformControls=null,!0===e.transformControls&&(this.transformControls=function(e,t){var r=null,i=null,a=null,o=new THREE.TransformControls(e,t.domElement);return o.visible=!0,o.enabled=!0,o.addEventListener("change",(function(){var e=o.object;e&&e.helper&&!e.helper instanceof THREE.SkeletonHelper&&e.helper.update()})),o.addEventListener("mouseDown",(function(){var e=o.object;r=e.position.clone(),i=e.rotation.clone(),a=e.scale.clone(),n.controls.enabled=!1})),o.addEventListener("mouseUp",(function(){var e=o.object;if(void 0!==e)switch(o.getMode()){case"translate":r.equals(e.position)||n.setPosition(e,e.position,r);break;case"rotate":i.equals(e.rotation)||n.setRotation(e,e.rotation,i);break;case"scale":a.equals(e.scale)||n.setScale(e,e.scale,a)}n.controls.enabled=!0})),o}(this.camera,this.renderer),this.transformControls.setSize(.5),this.sceneHelpers.add(this.transformControls)),window.addEventListener("orientationchange",(function(){[n.widthRatio,n.heightRatio]=[n.heightRatio,n.widthRatio]}),!1),window.addEventListener("resize",_,!1),this.dom.addEventListener("click",(function(e){n.dom.focus()}),!1),this.dom.addEventListener("dblclick",(function(e){n.mouseDoubleClickPosition.copy(b(e));var t=n.getIntersectObject("mouseDoubleClick");t&&n.focus(t)}),!1),this.dom.addEventListener("mousemove",(function(e){n.mouseMovePosition.copy(b(e)),n.bokehPass&&n.bokehPass.enabled&&n.bokehPass.mouse.copy(n.mouseMovePosition)}),!1),this.dom.addEventListener("mousedown",(function(e){n.mouseDownPosition.copy(b(e)),document.addEventListener("mouseup",x,!1)}),!1),this.dom.addEventListener("touchmove",(function(e){e.preventDefault(),c&&clearTimeout(c);n.mouseMovePosition.copy(b(e)),n.bokehPass&&n.bokehPass.enabled&&n.bokehPass.mouse.copy(n.mouseMovePosition)}),!0),this.dom.addEventListener("touchstart",(function(e){n.guiContextMenu&&n.guiContextMenu.setDisplay("none");if(e.preventDefault(),u)return;c=setTimeout(A,500,e),u=!0,n.mouseDownPosition.copy(b(e)),document.addEventListener("touchend",T,!1)}),!1),this.dom.addEventListener("keydown",S,!1),this.dom.addEventListener("keyup",(function(e){switch(n.appName){case"NatureWorks":!function(e){switch(e.preventDefault(),e.stopPropagation(),e.keyCode){case 17:n.transformControls.setTranslationSnap(null),n.transformControls.setRotationSnap(null),n.controls.enabled=!0}}(e)}}),!1),this.dom.addEventListener("contextmenu",M,!1),this.renderScene=function(){g()},this.resize=function(e,t){var[n,r]=y();this.widthRatio=(e||n)/n,this.heightRatio=(t||r)/r,_()},this.onKeyDown=function(e){S(e)},this.getBoundingBox=function(){return t.computeBoundingBox(this.scene)},this.getMousePosition=function(e){return b(e)},this.getIntersectObject=function(e){if("string"==typeof e){var t;if("mouseDown"===e)t=this.mouseDownPosition;else if("mouseUp"===e)t=this.mouseUpPosition;else{if("mouseDoubleClick"!==e)return null;t=this.mouseDoubleClickPosition}return(n=E(t,this.selectables)).length>0?n[0].object:null}var n;return this.mouseDownPosition.equals(this.mouseUpPosition)&&(n=E(this.mouseUpPosition,this.selectables)).length>0?(void 0!==e&&(e.object=n[0].object,e.distance=n[0].distance,e.point=n[0].point,e.uv=n[0].uv),n[0].object):null},this.select=function(e,t){if(e){var r=e;if("ancestor"===t)e.traverseAncestors((function(e){e.parent===n.scene&&(r=e)})),this.selectObjects=[r];else if("multiple"===t){var i=this.selectObjects.indexOf(r);-1===i?this.selectObjects.push(r):this.selectObjects.splice(i,1)}else this.selectObjects=[r];this.selectObject=r,this.signals.objectSelected.dispatch(r),this.signals.objectsSelected.dispatch(this.selectObjects)}else this.selectObject=null,this.selectObjects=[],this.signals.objectSelected.dispatch(null),this.signals.objectsSelected.dispatch(this.selectObjects)},this.selectById=function(e,t){e!==this.camera.id?this.select(this.scene.getObjectById(e,!0),t):this.select(this.camera,t)},this.selectByUuid=function(e,t){this.scene.traverse((function(n){n.uuid===e&&this.select(n,t)}))},this.deselect=function(){this.selectObject=null},this.focus=function(e){this.signals&&this.signals.objectFocused.dispatch(e)},this.focusById=function(e){this.focus(this.scene.getObjectById(e,!0))},this.objectByUuid=function(e){return this.scene.getObjectByProperty("uuid",e)},this.addObject=function(e,t,r){e.traverse((function(e){n.addHelper(e)})),void 0===t?this.scene.add(e):(t.children.splice(r,0,e),e.parent=t),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},this.moveObject=function(e,t,n){if(void 0===t&&(t=this.scene),t.add(e),void 0!==n){var r=t.children.indexOf(n);t.children.splice(r,0,e),t.children.pop()}this.signals.sceneGraphChanged.dispatch()},this.removeObject=function(e){null!==e.parent&&(e.traverse((function(e){n.removeHelper(e)})),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch())},this.addHelper=(s=new THREE.SphereBufferGeometry(2,4,2),l=new THREE.MeshBasicMaterial({color:16711680,visible:!1}),function(e){if(!t.isDeviceMobile()){var n;if(e instanceof THREE.Camera)(n=new THREE.CameraHelper(e)).name="cameraHelper";else if(e instanceof THREE.PointLight)(n=new THREE.PointLightHelper(e,1)).name="pointLightHelper";else if(e instanceof THREE.DirectionalLight)(n=new THREE.DirectionalLightHelper(e,1)).name="directionalLightHelper","SunLight"===e.userData.type&&(n.visible=!1);else if(e instanceof THREE.SpotLight)(n=new THREE.SpotLightHelper(e)).name="spotLightHelper";else if(e instanceof THREE.HemisphereLight)(n=new THREE.HemisphereLightHelper(e,1)).name="hemisphereLightHelper";else{if(!(e instanceof THREE.SkinnedMesh))return;(n=new THREE.SkeletonHelper(e)).name="skeletonHelper"}var r=new THREE.Mesh(s,l);r.name="picker",r.userData.object=e,n.add(r),e.helper=n,this.sceneHelpers.add(n),this.signals.helperAdded.dispatch(n)}}),this.removeHelper=function(e){var t=e.helper;void 0!==t&&(t.parent.remove(t),this.signals.helperRemoved.dispatch(t))},this.getObjectMaterial=function(e,t){var n=void 0;return e&&(n=e.material,Array.isArray(n)&&void 0!==t&&(n=n[t])),n},this.setObjectMaterial=function(e,t,n){Array.isArray(e.material)&&void 0!==t?e.material[t]=n:e.material=n},this.clear=function(){this.history&&this.history.clear(),this.config&&this.config.clearDatabase(),this.camera.copy(this.defaultCamera);for(var e=this.scene.children;e.length>0;)this.removeObject(e[0]);this.deselect(),this.signals.appWorksCleared.dispatch(),this.signals.windowResize.dispatch()},this.fromJSON=function(e){var t=new THREE.ObjectLoader,r=t.parse(e.camera);this.camera.copy(r),this.camera.aspect=this.defaultCamera.aspect,this.camera.updateProjectionMatrix(),this.history&&this.history.fromJSON(e.history),t.parse(e.scene,(function(e){n.setScene(e)}))},this.toJSON=function(){return{metadata:{},camera:this.camera.toJSON(),scene:this.scene.toJSON(),history:this.history?this.history.toJSON():""}},this.execute=function(e,t){this.history&&this.history.execute(e,t)},this.undo=function(){this.history&&this.history.undo()},this.redo=function(){this.history&&this.history.redo()},this.add=function(e){this.execute(new t.AddObjectCommand(e))},this.remove=function(e){this.execute(new t.RemoveObjectCommand(e))},this.replace=function(e,n){var r=[];r.push(new t.RemoveObjectCommand(e)),r.push(new t.AddObjectCommand(n)),this.multiCmds(r)},this.move=function(e,n,r){e.parent?this.execute(new t.MoveObjectCommand(e,n,r)):Alert("The object cannot be moved to the new parent")},this.moveTo=function(e,t,n){this.add(e),this.move(e,t,n)},this.setPosition=function(e,n,r){this.execute(new t.SetPositionCommand(e,n,r))},this.setRotation=function(e,n,r){this.execute(new t.SetRotationCommand(e,n,r))},this.setScale=function(e,n,r){this.execute(new t.SetScaleCommand(e,n,r))},this.setGeometry=function(e,n){this.execute(new t.SetGeometryCommand(e,n))},this.setGeometryValue=function(e,n,r){this.execute(new t.SetGeometryValueCommand(e,n,r))},this.setMaterial=function(e,n,r){this.execute(new t.SetMaterialCommand(e,n,r))},this.setMaterialValue=function(e,n,r,i){this.execute(new t.SetMaterialValueCommand(e,n,r,i))},this.setMaterialVector=function(e,n,r,i){this.execute(new t.SetMaterialVectorCommand(e,n,r,i))},this.setMaterialColor=function(e,n,r,i){this.execute(new t.SetMaterialColorCommand(e,n,r,i))},this.setMaterialMap=function(e,n,r,i){this.execute(new t.SetMaterialMapCommand(e,n,r,i))},this.setUuid=function(e,n){this.execute(new t.SetUuidCommand(e,n))},this.setValue=function(e,n,r){this.execute(new t.SetValueCommand(e,n,r))},this.setColor=function(e,n,r){this.execute(new t.SetColorCommand(e,n,r))},this.setScene=function(e){this.execute(new t.SetSceneCommand(e))},this.multiCmds=function(e){this.execute(new t.MultiCmdsCommand(e))},t.appWorks=this,"NatureWorks"===this.appName||("ViewWorks"===this.appName?"wordpress.org"!==this.customer&&(t.viewWorksInfo(),t.createFlashtext("ViewWorks",{fontSize:"10vw"}),setTimeout((()=>{t.hideFlashtext()}),3e3)):"MedicalWorks"===this.appName&&(t.createFlashtext("MedicalWorks",{fontSize:"8vw"}),setTimeout((()=>{t.hideFlashtext();(new t.MedicalLoader).load(["models/nii/sample.nii.gz"],(e=>{t.createMedicalWorkspace(e,"quadWorkspace")}))}),3e3)))},t.viewWorksInfo=function(){var e=document.createElement("div");e.id="infoButton",e.innerHTML='        <img src="images/info.png" border="0" />\n    ',e.style.cssText="        position: absolute;\n        left: 0;\n        top: 0;\n        z-index: 2;\n        padding: 8px;\n        margin: 0 0 0 0;\n        text-align: left;\n        display: block;\n    ",e.addEventListener("click",(function(e){var t=document.getElementById("infoPanel").style;t.display="block"==t.display?"none":"block"})),document.getElementById("app-container").parentNode.appendChild(e);var t=document.createElement("div");t.id="infoPanel",t.innerHTML='        <b>ViewWorks - 3D model viewer</b>\n        <p>\n        To view your 3D models,<br>\n        <b>drag & drop the model file(s) onto the browser.</b><br><br>\n        Supported file formats<br>\n        JSON, OBJ(+MTL), STL, PLY, DAE(COLLADA),<br>\n        GLTF, GLB, AMF, 3MF, WRL(VRML), FBX,<br>\n        3DS, DRC, KMZ, MD2, SVG, VTK<br>\n        </p>\n        (C) <a href="https://www.nova-graphix.com/" target="_blank" style="color: #ffa500; text-decoration: none;">NovaGraphix, Co.</a>, 2018.\n    ',t.style.cssText="        position: absolute;\n        left: 0;\n        top: 0;\n        z-index: 1;\n        padding: 32px;\n        margin: 0.5em 0em 0em 0.4em;\n        background: #121212;\n        color: #fff;\n        opacity: 0.8;\n        border-radius: 20px;\n        text-align: left;\n        font-family: 'Karla', sans-serif;\n        font-size: 80%;\n        display: none;\n    ",document.getElementById("app-container").parentNode.appendChild(t)},t.createBackground=function(e){if(!e)return null;if(e.isTexture)return e.encoding=THREE.sRGBEncoding,e;if("number"==typeof e)return new THREE.Color(e);if("string"==typeof e)return"FS"===e.substr(-2,2)?function(e){var n=new THREE.Vector2;t.appWorks.renderer.getSize(n);var r=t.BackgroundShader;(l=THREE.UniformsUtils.clone(r.uniforms)).resolution.value=n;var i=r.vertexShader,a=r[e],o=t.isWebGL1()?{gl_FragDepth:"gl_FragDepthEXT"}:{},s=new THREE.ShaderMaterial({defines:o,uniforms:l,vertexShader:i,fragmentShader:a});if("cloudsFS"===e){var l=s.uniforms,c=(new THREE.TextureLoader).load("images/raymarch/rgbaNoise256.png",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping}));l.textureMaps.value.push(c)}s.extensions={derivatives:!0,fragDepth:!0,drawBuffers:!0,shaderTextureLOD:!0};var u=new THREE.PlaneBufferGeometry(2,2);return(e=new THREE.Mesh(u,s)).name="backgroundMesh",e.frustumCulled=!1,e.update=function(e,r){t.appWorks.renderer.getSize(n);var i=this.material.uniforms;i.time.value=r,i.resolution.value=n},e}(e):function(e){var t=".jpg",n="images/background/"+e+"/";switch(e){case"cloud":case"galaxy":case"redSky":case"smallLake":t=".png";break;default:t=".jpg"}var r=["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t],i=(new THREE.CubeTextureLoader).setPath(n).load(r);return i.format=THREE.RGBFormat,i.encoding=THREE.sRGBEncoding,i}(e)},t.createFog=function(e){var n=void 0!==(e=e||{}).color?e.color:t.FOG_COLOR;if("linear"===e.type){var r=void 0!==e.near?e.near:this.camera.near,i=void 0!==e.far?e.far:this.camera.far;return new THREE.Fog(n,r,i)}if("exp2"===e.type){var a=void 0!==e.density?e.density:.001;return new THREE.FogExp2(n,a)}return null},t.createCameraControls=function(e,n,r){var i;e=void 0!==e?e:"OrbitControls",n=void 0!==n?n:t.appWorks.camera,r=void 0!==r?r:t.appWorks.renderer.domElement;return t.appWorks&&t.appWorks.controls&&t.appWorks.controls.dispose(),"TrackballControls"===e?((i=new THREE.TrackballControls(n,r)).rotateSpeed=10,i.zoomSpeed=5,i.panSpeed=2,i.staticMoving=!1,i.dynamicDampingFactor=.2,i.enabled=!0):"FirstPersonControls"===e?((i=new THREE.FirstPersonControls(n,r)).movementSpeed=100,i.lookSpeed=.05,i.lookVertical=!0,i.activeLook=!0,i.constrainVertical=!0,i.verticalMin=1.1,i.verticalMax=2.2,i.enabled=!0):((i=new THREE.OrbitControls(n,r)).enablePan=!0,i.enableZoom=!0,i.enableDamping=!0,i.screenSpacePanning=!0,i.dampingFactor=.2,i.panSpeed=1,i.rotateSpeed=1,i.enabled=!0),i},t.playAudio=function(e,n){if(!(Array.isArray(e)&&e.length>0))return null;var r=new H.Howl({src:[e[0]],autoplay:!0,loop:!0,volume:.5,onend:function(){e.shift(),e.length>0&&t.playAudio(e)}});return r.play(),r},t.createCameraEffect=function(e,n){e=void 0!==e?e:"NoEffect",n=void 0!==n?n:t.appWorks.renderer;return"AnaglyphEffect"===e?new THREE.AnaglyphEffect(n):"StereoEffect"===e?new THREE.StereoEffect(n):"ParallaxBarrierEffect"===e?new THREE.ParallaxBarrierEffect(n):null},t.Animator=function(e){e=void 0!==e?e:t.appWorks.scene;this.mixer=new THREE.AnimationMixer(e),this.update=function(e){this.mixer.update(e)},this.addAnimation=function(e,t){t.length>0&&(e.animations=t)},this.createActions=function(e){var t={},n=e.animations;if(void 0!==n){for(var r of n)t[r.name]=this.mixer.clipAction(r,e),e.activeAction||(e.activeAction=t[r.name]);return t}},this.playAction=function(e,n,r){if(e.animations&&0!==e.animations.length){var i=(r=r||{}).duration||1,a=r.loopMode||THREE.LoopRepeat,o=r.repetitions||1/0,s=r.combine||"crossFade";e=void 0!==e?e:t.appWorks.selectObject,n=void 0!==n?n:e.animations[0];if("crossFade"==s){var l=e.activeAction,c=this.mixer.clipAction(n,e);return c?(c.enabled=!0,c.setLoop(a,o),l?(l.enabled=!0,l.crossFadeTo(c,i).play()):c.play(),e.activeAction=c,c):void 0}if("overlap"===s){var u=this.mixer.clipAction(n,e);return u.play(),e.activeAction=u,u}}},this.playNextAction=function(e){var n=(e=void 0!==e?e:t.appWorks.selectObject).animations;if(void 0!==n&&n.length>0){var r=-1;if(e.activeAction){var i=e.activeAction.getClip();r=n.indexOf(i)}var a=n[r=~~((r+1)%n.length)];e.activeAction=this.playAction(e,a),console.log('>> playAction: "'+a.name+'"')}},this.stopAction=function(e,t){if(e&&t)(n=this.mixer.clipAction(t,e)).enabled=!0,n.stop();else if(e&&!t){var n;(n=e.activeAction)&&(n.enabled=!0,n.stop())}},this.stopAllActions=function(){this.mixer.stopAllAction()}};var D=__webpack_require__(743);t.loadJSON=function(e){function n(n,r){var i,a=new THREE.LegacyJSONLoader(e.manager).parse(n,r),o=a.geometry;if(o instanceof THREE.Geometry&&(o.morphTargets.length>0||o.skinIndices.length>0)){o=t.toNonIndexedBufferGeometry(a.geometry);var s=a.geometry.animations;s&&(o.animations=s)}var l=a.materials;if(function(e,t){var n=THREE.NoColors;if(e instanceof THREE.Geometry){var r=!1,i=!1;e.faces[0].vertexColors.length>0&&(r=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),n=r?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(n=THREE.VertexColors);t.forEach((function(e){e.vertexColors=n}))}(o,l),o instanceof THREE.BufferGeometry&&o.attributes.skinIndex){i=new THREE.SkinnedMesh(o,l);for(var c=[],u=n.bones,h=0,d=u.length;h<d;h++){var f=(new THREE.Vector3).fromArray(u[h].pos),p=(new THREE.Quaternion).fromArray(u[h].rotq),m=new THREE.Bone;m.position.copy(f),m.quaternion.copy(p),m.name=u[h].name,c.push(m)}var g=new THREE.Skeleton(c);i.bind(g)}else i=new THREE.Mesh(o,l);return o.animations&&(l.forEach((function(e){e.morphTargets=!0})),o.animations.length>0&&(i.animations=o.animations)),i.castShadow=!0,i.receiveShadow=!0,i.name=e.url,i}function r(r,i){var a;switch(void 0===r.metadata&&(r.metadata={type:"Geometry"}),void 0===r.metadata.type&&(r.metadata.type="Geometry"),void 0!==r.metadata.formatVersion&&(r.metadata.version=r.metadata.formatVersion),r.metadata.type.toLowerCase()){case"buffergeometry":a=function(t){var n=new THREE.BufferGeometryLoader(e.manager).parse(t);return mesh=new THREE.Mesh(n),mesh.castShadow=!0,mesh.receiveShadow=!0,mesh.name=e.url,mesh}(r);break;case"geometry":a=n(r,i);break;case"object":a=function(n,r){var i=new THREE.ObjectLoader(e.manager);i.setPath(r),i.setResourcePath(r);var a=i.parse(n);if(a instanceof THREE.Scene)t.appWorks.setScene(a),a.name=e.url;else{if("natureObject"===a.name){var o=new THREE.Object3D;a.children.forEach((function(n){if(void 0!==e.resourcePath){var r=n.userData.options.textureFiles;void 0!==r&&r.forEach(((t,n)=>{r[n]=e.resourcePath+t}))}o.add(t.cloneObject(n))})),a=o}a.castShadow=!0,a.receiveShadow=!0,a.name=e.url}return a}(r,i)}e.callback&&e.callback(a)}var i=null!=e.basePath?e.basePath:"models/json/";new THREE.FileLoader(e.manager).load(e.url,(function(e){r(JSON.parse(e),i)}))},t.loadOBJ=function(e){var t=e.obj||null,n=e.mtl||null,r=e.basePath||"";function i(t,n,r){var i=new THREE.OBJLoader(e.manager);i.setPath(t),r&&i.setMaterials(r),i.load(n,(function(r){r.traverse((function(e){e instanceof THREE.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)})),r.name=t+n,e.callback&&e.callback(r)}),(function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}}),(function(e){console.log("OBJLoader: error happened")}))}if(n){var a=new THREE.MTLLoader(e.manager);a.setPath(r),a.load(n,(function(e){e.preload(),i(r,t,e)}))}else i(r,t)},t.loadSTL=function(e){new THREE.STLLoader(e.manager).load(e.url,(function(n){!function(n){var r;t.computeVertexNormals(n),r=n.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var i=new THREE.Mesh(n,r);i.castShadow=!0,i.receiveShadow=!0,i.name=e.url,e.callback&&e.callback(i)}(n)}))},t.loadPLY=function(e){new THREE.PLYLoader(e.manager).load(e.url,(function(n){!function(n){t.computeVertexNormals(n);var r=new THREE.Mesh(n,new THREE.MeshStandardMaterial);r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(n)}))},t.loadDAE=function(e){new THREE.ColladaLoader(e.manager).load(e.url,(function(t){!function(t){var n=t.scene;t.animations.length>0&&(n.animations=t.animations),n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,e.callback&&e.callback(n)}(t)}))},t.loadGLB=function(e){var n=new THREE.DRACOLoader(e.manager);n.setDecoderPath("js/draco/");var r=new THREE.GLTFLoader(e.manager);r.setDRACOLoader(n),r.load(e.url,(function(n){!function(n){var r=n.scene||n.scenes[0],i=n.animations||[],a=t.appWorks.scene.background;a&&a.isCubeTexture&&r.traverse((function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=a,t.needsUpdate=!0)})),i.length>0&&(r.animations=i),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(n)}),void 0,(function(e){console.error(e)}))},t.loadGLTF=function(e){var n=new THREE.DRACOLoader(e.manager);n.setDecoderPath("js/draco/");var r=new THREE.GLTFLoader(e.manager);r.setDRACOLoader(n),r.load(e.url,(function(n){!function(n){var r=n.scene||n.scenes[0],i=n.animations||[];r.traverse((function(e){if(e.isMesh){var t=e.geometry.attributes.color;if(t&&4===t.itemSize){var n=e.material;!0===n.vertexColors&&(n.vertexColors=!1,n.needsUpdate=!0)}}}));var a=t.appWorks.scene.background;a&&a.isCubeTexture&&r.traverse((function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=a,t.needsUpdate=!0)})),i.length>0&&(r.animations=i),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(n)}),void 0,(function(e){console.error(e)}))},t.loadAMF=function(e){new THREE.AMFLoader(e.manager).load(e.url,(function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)}))},t.load3MF=function(e){var t=new THREE.ThreeMFLoader(e.manager);t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),t.load(e.url,(function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)}))},t.loadWRL=function(e){new THREE.VRMLLoader(e.manager).load(e.url,(function(t){!function(t){t.traverse((function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))})),t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)}))},t.loadFBX=function(e){new THREE.FBXLoader(e.manager).load(e.url,(function(t){!function(t){var n=t;n.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,e.callback&&e.callback(n)}(t)}))},t.loadMedical=function(e){var n=new t.MedicalLoader,r=e.basePath||"";n.setPath(r),n.load(e.url,(function(n){!function(n){let r=new t.MedicalVolume(n);Array.isArray(e.url)&&e.url.length>0?r.name=e.url[0]:r.name="medicalVolume";let i=new t.LookupTables;i.lut="default",r.lutTexture=i.texture,r.lut=!0;let a=n.worldCenter();t.appWorks.camera.lookAt(a),t.appWorks.controls.target.copy(a),e.callback&&e.callback(r)}(n)}))},t.loadFiles=function(e){var n=e.url;if(void 0!==n){var r=n.split(".").pop().toLowerCase();switch(r){case"js":case"json":t.loadJSON(e);break;case"obj":var i=e.acrossDomain||!1,a=n.split("/").pop(),o=a.replace(r,"mtl"),s=n.replace(a,"");t.fileExist(s+o,(n=>{t.loadOBJ({obj:a,mtl:n?o:null,basePath:s,callback:e.callback})}),i);break;case"stl":t.loadSTL(e);break;case"ply":t.loadPLY(e);break;case"dae":t.loadDAE(e);break;case"glb":t.loadGLB(e);break;case"gltf":t.loadGLTF(e);break;case"amf":t.loadAMF(e);break;case"3mf":t.load3MF(e);break;case"wrl":t.loadWRL(e);break;case"fbx":t.loadFBX(e);break;default:e.callback&&e.callback(null)}}else alert("There is no url to the file.")},t.Loader=function(){var e=this;function n(e,t){t.length>0&&e.animations.push(...t)}function r(e){t.add(e),t.welcomeObject(e)}function i(e){t.appWorks.setScene(e)}function a(n){switch(void 0===n.metadata&&(n.metadata={type:"Geometry"}),void 0===n.metadata.type&&(n.metadata.type="Geometry"),void 0!==n.metadata.formatVersion&&(n.metadata.version=n.metadata.formatVersion),n.metadata.type.toLowerCase()){case"buffergeometry":var a=(o=new THREE.BufferGeometryLoader).parse(n);r(new THREE.Mesh(a));break;case"geometry":console.error('Loader: "Geometry" is no longer supported.');break;case"object":var o;(o=new THREE.ObjectLoader).setResourcePath(e.texturePath),o.parse(n,(function(e){e.isScene?i(e):"natureObject"===e.name?e.children.forEach((function(e){t.add(t.cloneObject(e))})):r(e)}));break;case"app":t.appWorks.fromJSON(n)}}this.texturePath="",this.loadItemList=function(n){t.LoaderUtils.getFilesFromItemList(n,(function(t,n){e.loadFiles(t,n)}))},this.loadFiles=function(n,r){if(n.length>0){r=r||t.LoaderUtils.createFilesMap(n);var i=new THREE.LoadingManager;i.onStart=()=>{t.createProgressbar()},i.onProgress=(e,n,r)=>{t.updateProgressbar(n,r)},i.onLoad=()=>{t.hideProgressbar()},i.onError=e=>{t.errorProgressbar("There was an error loading "+e)},i.setURLModifier((function(e){e=e.replace(/^(\.?\/)/,"");var t=r[e];return t?(console.log("Loading",e),URL.createObjectURL(t)):e})),i.addHandler(/\.tga$/i,new THREE.TGALoader);for(var a=0;a<n.length;a++)e.loadFile(n[a],i)}},this.loadFile=function(e,o){var s=e.name,l=s.split(".").pop().toLowerCase(),c=new FileReader;switch(c.addEventListener("progress",(function(e){var t="("+Math.floor(e.total/1e3).format()+" KB)",n=Math.floor(e.loaded/e.total*100)+"%";console.log("Loading",s,t,n)})),l){case"3ds":c.addEventListener("load",(function(e){var t=new THREE.TDSLoader(o).parse(e.target.result);t.name=s,r(t)}),!1),c.readAsArrayBuffer(e);break;case"3mf":c.addEventListener("load",(function(e){var t=new THREE.ThreeMFLoader;t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension);var n=t.parse(e.target.result);n.name=s,r(n)}),!1),c.readAsArrayBuffer(e);break;case"amf":c.addEventListener("load",(function(e){var t=(new THREE.AMFLoader).parse(e.target.result);t.name=s,r(t)}),!1),c.readAsArrayBuffer(e);break;case"dae":c.addEventListener("load",(function(e){var t=e.target.result,i=new THREE.ColladaLoader(o).parse(t);i.scene.name=s,n(i.scene,i.animations),r(i.scene)}),!1),c.readAsText(e);break;case"drc":c.addEventListener("load",(function(e){var n=e.target.result,i=new THREE.DRACOLoader;i.setDecoderPath("js/draco/"),i.decodeDracoFile(n,(function(e){var n;if(e.center(),t.computeVertexNormals(e),null!==e.index){var i=new THREE.MeshStandardMaterial;(n=new THREE.Mesh(e,i)).name=s}else{i=new THREE.PointsMaterial({size:.01});!0===e.hasAttribute("color")&&(i.vertexColors=!0),(n=new THREE.Points(e,i)).name=s}r(n)}))}),!1),c.readAsArrayBuffer(e);break;case"fbx":c.addEventListener("load",(function(e){var t=e.target.result,i=new THREE.FBXLoader(o).parse(t);i.name=s,n(i,i.animations),r(i)}),!1),c.readAsArrayBuffer(e);break;case"glb":c.addEventListener("load",(function(e){var t=e.target.result,i=new THREE.DRACOLoader;i.setDecoderPath("js/draco/");var a=new THREE.GLTFLoader(o);a.setDRACOLoader(i),a.parse(t,"",(function(e){var t=e.scene;t.name=s,n(t,e.animations),r(t)}))}),!1),c.readAsArrayBuffer(e);break;case"gltf":c.addEventListener("load",(function(e){var t=e.target.result;if(function(e){var t;if("string"==typeof e)t=e;else{if("glTF"===THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4)))return new DataView(e).getUint32(4,!0)<2;t=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var n=JSON.parse(t);return null!=n.asset&&n.asset.version[0]<2}(t))alert("Import of glTF asset not possible. Only versions >= 2.0 are supported. Please try to upgrade the file to glTF 2.0 using glTF-Pipeline.");else{var i,a=new THREE.DRACOLoader;a.setDecoderPath("js/draco/"),(i=new THREE.GLTFLoader(o)).setDRACOLoader(a)}i.parse(t,"",(function(e){var t=e.scene;t.name=s,t.traverse((function(e){if(e.isMesh){var t=e.geometry.attributes.color;if(t&&4===t.itemSize){var n=e.material;!0===n.vertexColors&&(n.vertexColors=!1,n.needsUpdate=!0)}}})),n(t,e.animations),r(t)}))}),!1),c.readAsArrayBuffer(e);break;case"js":case"json":c.addEventListener("load",(function(e){var t,n=e.target.result;if(-1!==n.indexOf("postMessage")){var r=new Blob([n],{type:"text/javascript"}),i=URL.createObjectURL(r),o=new Worker(i);return o.onmessage=function(e){e.data.metadata={version:2},a(e.data)},void o.postMessage(Date.now())}try{t=JSON.parse(n)}catch(e){return void alert(e)}a(t)}),!1),c.readAsText(e);break;case"kmz":c.addEventListener("load",(function(e){var t=(new THREE.KMZLoader).parse(e.target.result);t.scene.name=s,r(t.scene)}),!1),c.readAsArrayBuffer(e);break;case"md2":c.addEventListener("load",(function(e){var t=e.target.result,i=(new THREE.MD2Loader).parse(t),a=new THREE.MeshStandardMaterial({morphTargets:!0,morphNormals:!0}),o=new THREE.Mesh(i,a);o.mixer=new THREE.AnimationMixer(o),o.name=s,n(o,i.animations),r(o)}),!1),c.readAsArrayBuffer(e);break;case"obj":c.addEventListener("load",(function(e){var t=e.target.result,n=(new THREE.OBJLoader).parse(t);n.name=s,r(n)}),!1),c.readAsText(e);break;case"ply":c.addEventListener("load",(function(e){var n=e.target.result,i=(new THREE.PLYLoader).parse(n);t.computeVertexNormals(i);var a=new THREE.MeshStandardMaterial,o=new THREE.Mesh(i,a);o.name=s,r(o)}),!1),c.readAsArrayBuffer(e);break;case"stl":c.addEventListener("load",(function(e){var n,i=e.target.result,a=(new THREE.STLLoader).parse(i);t.computeVertexNormals(a),n=a.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var o=new THREE.Mesh(a,n);o.name=s,r(o)}),!1),void 0!==c.readAsBinaryString?c.readAsBinaryString(e):c.readAsArrayBuffer(e);break;case"svg":c.addEventListener("load",(function(e){var t=e.target.result,n=(new THREE.SVGLoader).parse(t).paths,i=new THREE.Group;i.scale.multiplyScalar(.1),i.scale.y*=-1;for(var a=0;a<n.length;a++)for(var o=n[a],l=new THREE.MeshBasicMaterial({color:o.color,depthWrite:!1}),c=THREE.SVGLoader.createShapes(o),u=0;u<c.length;u++){var h=c[u],d=new THREE.ShapeGeometry(h),f=new THREE.Mesh(d,l);i.add(f)}i.name=s,r(i)}),!1),c.readAsText(e);break;case"vtk":c.addEventListener("load",(function(e){var n=e.target.result,i=(new THREE.VTKLoader).parse(n);t.computeVertexNormals(i);var a=new THREE.MeshStandardMaterial,o=new THREE.Mesh(i,a);o.name=s,r(o)}),!1),c.readAsArrayBuffer(e);break;case"wrl":c.addEventListener("load",(function(e){var t=e.target.result,n=(new THREE.VRMLLoader).parse(t);n.name=s,i(n)}),!1),c.readAsText(e);break;case"zip":c.addEventListener("load",(function(e){!function(e){var i=(0,D.unzipSync)(new Uint8Array(e));if(i["model.obj"]&&i["materials.mtl"]){var a=(new MTLLoader).parse((0,D.strFromU8)(i["materials.mtl"]));r((new OBJLoader).setMaterials(a).parse((0,D.strFromU8)(i["model.obj"])))}for(var o in i){var s=i[o],l=new THREE.LoadingManager;switch(l.onStart=()=>{t.createProgressbar()},l.onProgress=(e,n,r)=>{t.updateProgressbar(n,r)},l.onLoad=()=>{t.hideProgressbar()},l.onError=e=>{t.errorProgressbar("There was an error loading "+e)},l.setURLModifier((function(e){var t=i[e];if(t){console.log("Loading",e);var n=new Blob([t.buffer],{type:"application/octet-stream"});return URL.createObjectURL(n)}return e})),o.split(".").pop().toLowerCase()){case"fbx":r((u=new THREE.FBXLoader(l)).parse(s.buffer));break;case"glb":(c=new DRACOLoader).setDecoderPath("js/draco/"),(u=new GLTFLoader).setDRACOLoader(c),u.parse(s.buffer,"",(function(e){var t=e.scene;n(t,e.animations),r(t)}));break;case"gltf":var c,u;(c=new DRACOLoader).setDecoderPath("js/draco/"),(u=new GLTFLoader(l)).setDRACOLoader(c),u.parse((0,D.strFromU8)(s),"",(function(e){var t=e.scene;n(t,e.animations),r(t)}))}}}(e.target.result)}),!1),c.readAsArrayBuffer(e)}}},t.LoaderUtils={createFilesMap:function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];t[r.name]=r}return t},getFilesFromItemList:function(e,t){var n=0,r=0,i=[],a={};function o(){++n===r&&t(i,a)}function s(e){if(e){if(e.isDirectory)e.createReader().readEntries((function(e){for(var t=0;t<e.length;t++)s(e[t]);o()}));else e.isFile&&e.file((function(t){i.push(t),a[e.fullPath.substr(1)]=t,o()}));r++}}for(var l=0;l<e.length;l++)s(e[l].webkitGetAsEntry())}},t.Loader2=function(){var e=this;this.fromFiles=function(e,t){if(e[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void this._loadMedicalFiles(t);const n=new Map;e.forEach((e=>n.set(e.name,e))),this.loadFiles(n)},this.fromEvent=function(t){if(t.dataTransfer.files[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void this._loadMedicalFiles(t);let n;if(t.dataTransfer.items)n=[].slice.call(t.dataTransfer.items).map((e=>e.webkitGetAsEntry()));else if(1===(t.dataTransfer.files||[]).length){const e=t.dataTransfer.files[0];return"application/zip"===e.type?void alert("zip file: not supported"):void this.loadFiles(new Map([[e.name,e]]))}n||alert("Required drag & drop is not supported in this browser."),1===n.length&&n[0].name.match(/\.zip$/)?alert("zip file: not supported"):function t(n,r){const i=r.pop();if(!i)return void e.loadFiles(n);if(i.isFile)i.file((e=>{n.set(i.fullPath,e),t(n,r)}),(()=>console.error("Could not load file: %s",i.fullPath)));else if(i.isDirectory){const e=i.createReader(),a=i=>{i.length?(r=r.concat(i),e.readEntries(a)):t(n,r)};e.readEntries(a)}else console.warn("Unknown asset type: "+i.fullPath),t(n,r)}(new Map,n)},this.loadFiles=function(n){for(var r of n.values())console.log("Loading:",r.name,"("+t.humanFileSize(r.size)+")");var i;let a,o;var s=[];Array.from(n).forEach((([e,t])=>{t.name.match(/\.(js|json|obj|stl|ply|dae|gltf|glb|amf|3mf|wrl|fbx|md2|vtk)$/i)?(a=t,o=e.replace(t.name,""),i=t.name.split(".").pop().toLowerCase()):t.name.match(/\.(png|jpg|gif)$/i)&&s.push(t)})),a||console.warn("No asset found.");const l="string"==typeof a?a:URL.createObjectURL(a),c=THREE.LoaderUtils.extractUrlBase(l);return new Promise(((r,u)=>{const h=[],d=new THREE.LoadingManager;switch(d.onStart=()=>{t.createProgressbar()},d.onProgress=(e,n,r)=>{t.updateProgressbar(n,r)},d.onLoad=()=>{t.hideProgressbar()},d.onError=e=>{t.errorProgressbar("There was an error loading "+e)},d.setURLModifier(((e,t)=>{const r=o+decodeURI(e).replace(c,"").replace(/^(\.?\/)/,"");if(n.has(r)){const e=n.get(r),t=URL.createObjectURL(e);return h.push(t),t}return(t||"")+e})),i){case"js":case"json":!function(n,i){function o(e,t){var n=THREE.NoColors;if(e instanceof THREE.Geometry){var r=!1,i=!1;e.faces[0].vertexColors.length>0&&(r=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),n=r?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(n=THREE.VertexColors);t.forEach((function(e){e.vertexColors=n}))}function s(e,t){var n=new THREE.BufferGeometryLoader(t).parse(e);return mesh=new THREE.Mesh(n),p(mesh),mesh}function l(e,n,r){var i,a=new THREE.LegacyJSONLoader(n).parse(e,r),s=a.geometry;if(s instanceof THREE.Geometry&&(s.morphTargets.length>0||s.skinIndices.length>0)){s=t.toNonIndexedBufferGeometry(a.geometry);var l=a.geometry.animations;l&&(s.animations=l)}var c=a.materials;if(o(s,c),s instanceof THREE.BufferGeometry&&s.attributes.skinIndex){i=new THREE.SkinnedMesh(s,c);for(var u=[],h=e.bones,d=0,f=h.length;d<f;d++){var m=(new THREE.Vector3).fromArray(h[d].pos),g=(new THREE.Quaternion).fromArray(h[d].rotq),v=new THREE.Bone;v.position.copy(m),v.quaternion.copy(g),v.name=h[d].name,u.push(v)}var y=new THREE.Skeleton(u);i.bind(y)}else i=new THREE.Mesh(s,c);return s.animations&&(c.forEach((function(e){e.morphTargets=!0})),s.animations.length>0&&(i.animations=s.animations)),p(i),i}function c(e,n,r){var i=new THREE.ObjectLoader(n);i.setPath(r),i.setResourcePath(r);var o=i.parse(e);return o instanceof THREE.Scene?(t.appWorks.setScene(o),o.name=a.name):"natureObject"===o.name?o.children.forEach((function(e){t.add(t.cloneObject(e))})):p(o),o}function d(e,t,n){switch(void 0===e.metadata&&(e.metadata={type:"Geometry"}),void 0===e.metadata.type&&(e.metadata.type="Geometry"),void 0!==e.metadata.formatVersion&&(e.metadata.version=e.metadata.formatVersion),e.metadata.type.toLowerCase()){case"buffergeometry":s(e,t);break;case"geometry":l(e,t,n);break;case"object":c(e,t,n)}}new THREE.FileLoader(i).load(n,(t=>{d(JSON.parse(t),i,e.basePath),h.forEach(URL.revokeObjectURL),r(t)}),f,u)}(l,d);break;case"obj":!function(e,t){var i;for(var a of n.values())if(a.name.match(/\.(mtl|MTL)$/)){i=a;break}function o(e){if(void 0!==e){const n=URL.createObjectURL(e);new THREE.MTLLoader(t).load(n,(e=>{e.preload(),s(e),r(e)}),f,u)}else s()}function s(n){var i=new THREE.OBJLoader(t);n&&i.setMaterials(n),i.load(e,(e=>{p(e),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}o(i)}(l,d);break;case"stl":!function(e,n){new THREE.STLLoader(n).load(e,(e=>{var n;t.computeVertexNormals(e),n=e.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial,p(new THREE.Mesh(e,n)),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"ply":!function(e,n){new THREE.PLYLoader(n).load(e,(e=>{t.computeVertexNormals(e),p(new THREE.Mesh(e,new THREE.MeshStandardMaterial)),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"dae":!function(e,t){new THREE.ColladaLoader(t).load(e,(e=>{var t=e.scene;e.animations.length>0&&(t.animations=e.animations),p(t),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"gltf":case"glb":!function(e,n){const i=new THREE.DRACOLoader(n);i.setDecoderPath("js/draco/");const a=new THREE.GLTFLoader(n);a.setDRACOLoader(i),a.load(e,(e=>{var n=e.scene||e.scenes[0],i=e.animations||[],a=t.appWorks.scene.background;a&&a.isCubeTexture&&n.traverse((function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=a,t.needsUpdate=!0)})),i.length>0&&(n.animations=i),p(n),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"amf":!function(e,t){new THREE.AMFLoader(t).load(e,(e=>{p(e),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"3mf":!function(e,t){var n=new THREE.ThreeMFLoader(t);n.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),n.load(e,(e=>{p(e),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"wrl":!function(e,t){new THREE.VRMLLoader(t).load(e,(e=>{e.traverse((function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))})),p(e),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"fbx":!function(e,t){new THREE.FBXLoader(t).load(e,(e=>{e.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),p(e),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"md2":!function(e,t){new THREE.MD2Loader(t).load(e,(e=>{var t=null;1===s.length&&(t=(new THREE.TextureLoader).load(URL.createObjectURL(s[0])));var n,i,a=new THREE.MeshStandardMaterial({map:t,morphTargets:!0,morphNormals:!0}),o=new THREE.Mesh(e,a);o.mixer=new THREE.AnimationMixer(o),n=o,(i=e.animations).length>0&&(n.animations=i),p(o),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;case"vtk":!function(e,n){new THREE.VTKLoader(n).load(e,(e=>{e.center(),t.computeVertexNormals(e);var n=new THREE.MeshStandardMaterial;p(new THREE.Mesh(e,n)),h.forEach(URL.revokeObjectURL),r(e)}),f,u)}(l,d);break;default:r(null)}function f(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}}function p(e){e.name=a.name,t.add(e),t.welcomeObject(e)}}))},this._loadMedicalFiles=function(e){t.MedicalLoadFiles(e,(e=>{t.removeMedicalWorkspace(),t.createMedicalWorkspace(e,"quadWorkspace")}))}},t.Saver=function(){var e=document.createElement("a");this.saveFile=function(n){var r,i=n.split(".").pop().toLowerCase();switch("NatureWorks"===appWorks.appName?((r=new THREE.Object3D).name="natureObject",appWorks.scene.children.forEach((function(e){r.add(t.cloneObject(e))}))):r=appWorks.scene,i){case"json":!function(e,t){t=t||"object.json";var n=e.toJSON();try{n=(n=JSON.stringify(n,a,"\t")).replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){n=JSON.stringify(n)}o(n,t)}(r,n);break;case"obj":!function(e,t){t=t||"model.obj";o((new THREE.OBJExporter).parse(e),t)}(r,n);break;case"dae":!function(e,t){t=t||"scene.dae";(new THREE.ColladaExporter).parse(e,(function(e){o(e.data,t)}))}(r,n);break;case"glb":!function(e,t){t=t||"scene.glb";(new THREE.GLTFExporter).parse(e,(function(e){s(e,t)}),{binary:!0,forceIndices:!0,forcePowerOfTwoTextures:!0})}(r,n);break;case"gltf":!function(e,t){t=t||"scene.gltf";(new THREE.GLTFExporter).parse(e,(function(e){o(JSON.stringify(e,null,2),t)}))}(r,n);break;case"stl":!function(e,t,n){t=t||"model.stl";var r=new THREE.STLExporter;!0===n?o(r.parse(e),t):s(r.parse(e,{binary:!0}),t)}(r,n);break;case"ply":!function(e,t){t=t||"model.ply";o((new THREE.PLYExporter).parse(e),t)}(r,n);break;default:alert('The file type "'+i+'" is not supported.')}function a(e,t){return"number"==typeof t?parseFloat(t.toFixed(6)):t}function o(e,t){l(new Blob([e],{type:"text/plain"}),t)}function s(e,t){l(new Blob([e],{type:"application/octet-stream"}),t)}function l(t,n){e.href=URL.createObjectURL(t),e.download=n||"data.json",e.dispatchEvent(new MouseEvent("click"))}}},t.FileExplorer=function(e){e=e||t.appWorks;var n=this;this.basePath="models/",this.openFile=function(){this.fileInput.click()},this.saveAsFile=function(e){this.fileOutput.fileExtension=e,this.fileOutput.click()},this.saver=new t.Saver,this.fileOutput=document.createElement("div"),this.fileOutput.addEventListener("click",(function(){var e=n.fileOutput.fileExtension;n.saver.saveFile("model."+e)})),this.loader=new t.Loader,this.loader2=new t.Loader2;var r=document.createElement("input");r.type="file",r.multiple=!0,r.style.display="none",this.fileInput=r,r.addEventListener("change",(function(e){for(var t,i=[].slice.call(r.files),a=0;a<i.length;a++)if((t=i[a].name).match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i)||t.match(/\.(json|js|obj|mtl|md2|vtk)$/i))return void n.loader2.fromFiles(i,e);n.loader.loadFiles(r.files)}));var i=e.dom;i.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),i.classList.add("dragover")})),i.addEventListener("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),i.classList.remove("dragover")})),i.addEventListener("drop",(function(e){if(e.preventDefault(),"text/plain"!==e.dataTransfer.types[0]){for(var t,r=e.dataTransfer.files,i=0;i<r.length;i++)if((t=r[i].name).match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i)||t.match(/\.(json|js|obj|mtl|md2|vtk)$/i))return void n.loader2.fromEvent(e);e.dataTransfer.items?n.loader.loadItemList(e.dataTransfer.items):n.loader.loadFiles(e.dataTransfer.files)}}),!1)},t.HGTLoader=function(){this.loadTile=function(e,n,r){var i=this,a=new THREE.TextureLoader;a.crossOrigin=!0;a.load("https://maps.googleapis.com/maps/api/staticmap?center="+e+","+n+"&zoom="+r+"&size=512x512&scale=2&maptype=satellite&key=AIzaSyA1qxvvl1sFBFLj5rx4cXHJ_1soxQ_GMpw",(function(a){var o=new THREE.PlaneBufferGeometry(20,20,128,128),s=new THREE.MeshPhongMaterial({map:a,shading:THREE.SmoothShading});i.heightMapping(o,e,n,r);var l=new THREE.Mesh(o,s);l.rotation.x=-Math.PI/2,l.frustumCulled=!1,l.castShadow=!1,l.receiveShadow=!0,l.name="SRTM.hgt",t.add(l)}))},this.heightMapping=function(e,t,n,r){var i=e.attributes.position,a=Math.sqrt(i.count),o=i.array,s=20/(Math.abs(40075160*Math.cos(t*(Math.PI/180)))/Math.pow(2,r-1)),l=360/Math.pow(2,r-1),c=Math.abs(360*Math.cos(t*(Math.PI/180))/Math.pow(2,r-1)),u=t-c/2,h=t+c/2;console.log(u);var d=n-l/2,f=n+l/2;console.log(l),console.log(c);var p=Math.abs(Math.floor(1201*l)),m=Math.abs(Math.floor(1201*c));console.log(p,m);var g=a/p,v=a/m;console.log(v,g);var y,_,b=1200-Math.abs(1200*(h-Math.floor(h))),E=Math.abs(1200*(d-Math.floor(d))),w=1200-Math.abs(1200*(u-Math.floor(u))),x=Math.abs(1200*(f-Math.floor(f)));console.log(b,E);for(var T=Math.floor(h);T>=Math.floor(u);T--)for(var A=Math.floor(d);A<=Math.floor(f);A++){y=T>0?"N"+Math.abs(Math.floor(T)):"S"+Math.abs(Math.floor(T)),_=A>0?A<100?"E0"+Math.abs(Math.floor(A)):"E"+Math.abs(Math.floor(A)):A>=-99?"W0"+Math.abs(Math.floor(A)):"W"+Math.abs(Math.floor(A));var M=0,S=0,R=1200,k=1200;T==Math.floor(u)&&(R=w),T==Math.floor(h)&&(M=b),A==Math.floor(d)&&(S=E),A==Math.floor(f)&&(k=x);var P=Math.floor(h)-T,L=A-Math.floor(d),C=0;P>0&&(C=1201-b+1201*(P-1));var I=0;L>0&&(I=1201-E+1201*(L-1));var N=new XMLHttpRequest;N.start_row=M,N.start_column=S,N.end_row=R,N.end_column=k,N.passed_rows=C,N.passed_columns=I;var F=Math.round(C/m*a),O=Math.round((C+R-M)/m*a);O=Math.min(O,500);var H=Math.round(I/p*a),D=Math.round((I+k-S)/p*a);D=Math.min(D,500),N.filename="models/hgt/"+y+_+".hgt",N.start_i=F,N.end_i=O,N.start_j=H,N.end_j=D,N.open("GET","models/hgt/"+y+_+".hgt",!0),N.responseType="arraybuffer",N.onload=function(t){var n=this.response;if(2884802==n.byteLength){new Int16Array(n);var r=new DataView(n),l=0,c=0;console.log(this.filename),console.log(this.start_row,this.start_column),console.log("Vertex rows:",this.start_i,this.end_i),console.log("Vertex columns:",this.start_j,this.end_j),console.log("Passed rows/columns:",this.passed_rows,this.passed_columns);for(var u=this.start_i;u<=this.end_i;u++){l=u/v;for(var h=this.start_j;h<=this.end_j;h++){c=h/g;var d=0,f=0;l>=this.passed_rows&&(d=(b+l)%1201),c>=this.passed_columns&&(f=(E+c)%1201),f=Math.min(1200,f),d=Math.min(1200,d);var p,m,y,_,w=f-Math.round(f),x=d-Math.round(d);d=Math.round(d),f=Math.round(f),u==this.start_i&&console.log("Start vertex row "+this.start_i+" at file row "+d),h==this.start_j&&console.log("Start vertex column "+this.start_j+" at file column "+f),u==this.end_i&&console.log("End vertex row "+this.end_i+" at file row "+d),h==this.end_j&&console.log("End vertex column "+this.end_j+" at file column "+f),p=Math.floor(1201*d+f),m=f<1200?Math.floor(1201*d+f+1):Math.floor(1201*d+f),y=d<1200?Math.floor(1201*(d+1)+f):Math.floor(1201*d+f),_=d<1200&&f<1200?Math.floor(1201*(d+1)+f+1):Math.floor(1201*d+f);var T=r.getInt16(2*p,!1),A=r.getInt16(2*m,!1),M=(1-w)*(1-x)*T+(1-w)*x*r.getInt16(2*y,!1)+w*(1-x)*A+w*x*r.getInt16(2*_,!1);o[3*(u*a+h)+2]=M*s}}i.needsUpdate=!0,e.computeVertexNormals()}},N.send(null)}}};var U=__webpack_require__(5939),B=__webpack_require__.n(U);class z extends(B()){constructor(e=null){super(),this._loaded=-1,this._totalLoaded=-1,this._parsed=-1,this._totalParsed=-1,this._data=[],this._container=e}dispose(){this._data.forEach((e=>{e.dispose()})),this._data=[],this._container=null}fetch(e,t){return new Promise(((n,r)=>{const i=new XMLHttpRequest;i.open("GET",e),i.crossOrigin=!0,i.responseType="arraybuffer",i.onloadstart=t=>{this.emit("fetch-start",{file:e,time:new Date})},i.onload=t=>{if(200===i.status||0===i.status){let r=i.response,a={url:e,buffer:r};this.emit("fetch-success",{file:e,time:new Date,totalLoaded:t.total}),n(a)}else r(i.statusText)},i.onerror=()=>{this.emit("fetch-error",{file:e,time:new Date}),r(i.statusText)},i.onabort=t=>{this.emit("fetch-abort",{file:e,time:new Date}),r(i.statusText||"Aborted")},i.ontimeout=()=>{this.emit("fetch-timeout",{file:e,time:new Date}),r(i.statusText)},i.onprogress=t=>{this.emit("fetch-progress",{file:e,total:t.total,loaded:t.loaded,time:new Date})},i.onloadend=t=>{this.emit("fetch-end",{file:e,time:new Date})},t instanceof Map&&t.set(e,i),i.send()}))}parse(e){return new Promise(((t,n)=>{t(e)}))}loadSequenceGroup(e,t){const n=[];return e.forEach((e=>{n.push(this.fetch(e,t))})),Promise.all(n).then((e=>this.parse(e))).then((e=>(this._data.push(e),e))).catch((function(e){"Aborted"!==e&&(window.console.log("oops... something went wrong..."),window.console.log(e))}))}loadSequence(e,t){return this.fetch(e,t).then((e=>this.parse(e))).then((e=>(this._data.push(e),e))).catch((function(e){"Aborted"!==e&&(window.console.log("oops... something went wrong..."),window.console.log(e))}))}load(e,t){Array.isArray(e)||(e=[e]),this.emit("load-start",{files:e,time:new Date});const n=[];return e.forEach((e=>{Array.isArray(e)?n.push(this.loadSequenceGroup(e,t)):n.push(this.loadSequence(e,t))})),Promise.all(n)}set data(e){this._data=e}get data(){return this._data}}class V{constructor(){this._id=-1}mergeModels(e,t){if(!this._validateModelArray(e)||!this._validateModelArray(t))return window.console.log("invalid inputs provided."),!1;for(let n=0,r=t.length;n<r;n++)for(let r=0,i=e.length;r<i&&!e[r].merge(t[n]);r++)r===e.length-1&&e.push(t[n]);return!0}merge(e){return!!this.validate(e)&&this._id===e._id}validate(e){return!(!e||null===e||"function"!=typeof e.merge)}_validateModelArray(e){if(null===e||Array!==e.constructor)return window.console.log("invalid model array provided."),!1;for(let t=0;t<e.length;t++)if(!e[t]||null===e[t]||"function"!=typeof e[t].validate||!e[t].validate(e[t]))return!1;return!0}}class j extends V{constructor(){super(),this._concatenationUID=-1,this._seriesInstanceUID=-1,this._transferSyntaxUID="",this._seriesNumber=-1,this._seriesDescription="",this._seriesDate="",this._studyDescription="",this._studyDate="",this._accessionNumber=-1,this._modality="Modality not set",this._dimensionIndexSequence=[],this._numberOfFrames=0,this._numberOfChannels=1,this._rawHeader=null,this._patientID="",this._patientName="",this._patientAge="",this._patientBirthdate="",this._patientSex="",this._segmentationType=null,this._segmentationSegments=[],this._stack=[]}validate(e){return!!(super.validate(e)&&"function"==typeof e.mergeSeries&&e.hasOwnProperty("_seriesInstanceUID")&&e.hasOwnProperty("_numberOfFrames")&&e.hasOwnProperty("_numberOfChannels")&&e.hasOwnProperty("_stack")&&void 0!==e._stack&&Array===e._stack.constructor)}merge(e){return!!this.validate(e)&&(this._seriesInstanceUID===e.seriesInstanceUID&&(e.stack[0]&&(0===this._stack[0]._numberOfFrames&&this._stack[0].computeNumberOfFrames(),this._stack[0].computeCosines(),0===e.stack[0]._numberOfFrames&&e.stack[0].computeNumberOfFrames(),e.stack[0].computeCosines()),this.mergeModels(this._stack,e.stack)))}mergeSeries(e){let t=[this];return this.mergeModels(t,e),t}dispose(){this._stack.forEach((e=>{})),this._stack=[]}set seriesInstanceUID(e){this._seriesInstanceUID=e}get seriesInstanceUID(){return this._seriesInstanceUID}set transferSyntaxUID(e){this._transferSyntaxUID=e}get transferSyntaxUID(){return this._transferSyntaxUID}get transferSyntaxUIDLabel(){switch(this._transferSyntaxUID){case"1.2.840.10008.1.2.4.90":return"JPEG 2000 Lossless";case"1.2.840.10008.1.2.4.91":return"JPEG 2000 Lossy";case"1.2.840.10008.1.2.4.57":return"JPEG Lossless, Nonhierarchical (Processes 14)";case"1.2.840.10008.1.2.4.70":return"JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])";case"1.2.840.10008.1.2.4.50":return"JPEG Baseline lossy process 1 (8 bit)";case"1.2.840.10008.1.2.4.51":return"JPEG Baseline lossy process 2 & 4 (12 bit)";case"1.2.840.10008.1.2":return"Implicit VR Little Endian";case"1.2.840.10008.1.2.1":return"Explicit VR Little Endian";case"1.2.840.10008.1.2.2":return"Explicit VR Big Endian";default:return`Unknown transfersyntax: ${this._transferSyntaxUID}`}}set studyDate(e){this._studyDate=e}get studyDate(){return this._studyDate}set studyDescription(e){this._studyDescription=e}get studyDescription(){return this._studyDescription}set seriesDate(e){this._seriesDate=e}get seriesDate(){return this._seriesDate}set seriesDescription(e){this._seriesDescription=e}get seriesDescription(){return this._seriesDescription}set rawHeader(e){this._rawHeader=e}get rawHeader(){return this._rawHeader}set patientID(e){this._patientID=e}get patientID(){return this._patientID}set patientName(e){this._patientName=e}get patientName(){return this._patientName}set patientAge(e){this._patientAge=e}get patientAge(){return this._patientAge}set patientBirthdate(e){this._patientBirthdate=e}get patientBirthdate(){return this._patientBirthdate}set patientSex(e){this._patientSex=e}get patientSex(){return this._patientSex}set numberOfFrames(e){this._numberOfFrames=e}get numberOfFrames(){return this._numberOfFrames}set numberOfChannels(e){this._numberOfChannels=e}get numberOfChannels(){return this._numberOfChannels}set stack(e){this._stack=e}get stack(){return this._stack}set modality(e){this._modality=e}get modality(){return this._modality}set segmentationType(e){this._segmentationType=e}get segmentationType(){return this._segmentationType}set segmentationSegments(e){this._segmentationSegments=e}get segmentationSegments(){return this._segmentationSegments}}const G=__webpack_require__(5623),W=__webpack_require__(4964);var q=new e.Vector3,X=new e.Vector3,Y=new e.Matrix4,K=new e.Matrix4;function Z(e=50,t=0,n=0){if(!(e>=0&&e<=100))return null;const[r,i,a]=this.cielab2XYZ(e,t,n);return this.xyz2RGB(r,i,a)}function Q(e=[]){let t=[65535,-32768],n=e.length;for(let r=0;r<n;r++){let n=e[r];t[0]=Math.min(t[0],n),t[1]=Math.max(t[1],n)}return t}function J(e,t,n){return e*t+n}class $ extends V{constructor(){super(),this._uid=null,this._stackID=-1,this._frame=[],this._numberOfFrames=0,this._rows=0,this._columns=0,this._numberOfChannels=1,this._bitsAllocated=8,this._pixelType=0,this._pixelRepresentation=0,this._rawData=[],this._textureSize=8192,this._textureType=0,this._textureUnits=7,this._textures=[],this._windowCenter=0,this._windowWidth=0,this._rescaleSlope=1,this._rescaleIntercept=0,this._minMax=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this._regMatrix=new e.Matrix4,this._ijk2LPS=new e.Matrix4,this._lps2IJK=new e.Matrix4,this._aabb2LPS=new e.Matrix4,this._lps2AABB=new e.Matrix4,this._dimensionsIJK=new e.Vector3,this._halfDimensionsIJK=new e.Vector3,this._spacing=new e.Vector3(1,1,1),this._spacingBetweenSlices=0,this._sliceThickness=0,this._origin=new e.Vector3,this._rightHanded=!0,this._xCosine=new e.Vector3(1,0,0),this._yCosine=new e.Vector3(0,1,0),this._zCosine=new e.Vector3(0,0,1),this._prepared=!1,this._packed=!1,this._packedPerPixel=1,this._modality="Modality not set",this._segmentationType=null,this._segmentationSegments=[],this._segmentationDefaultColor=[63,174,128],this._frameSegment=[],this._segmentationLUT=[],this._segmentationLUTO=[],this._invert=!1}prepareSegmentation(){this._frameSegment=this._frame;let e=[];this.computeCosines(),this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort);let t=-1;for(let n=0;n<this._frame.length;n++){if(e[t]&&e[t]._dist==this._frame[n]._dist)for(let r=0;r<e[t]._rows*e[t]._columns;r++)e[t]._pixelData[r]+=this._frame[n].pixelData[r]*this._frame[n]._referencedSegmentNumber;else{e.push(this._frame[n]),t++;for(let r=0;r<e[t]._rows*e[t]._columns;r++)e[t]._pixelData[r]*=this._frame[n]._referencedSegmentNumber}e[t].minMax=Q(e[t]._pixelData)}let n={},r=0,i=this._segmentationSegments;for(let e=0;e<i.length;e++){let t=i[e];r=Math.max(r,parseInt(t.segmentNumber,10));let a=t.recommendedDisplayCIELab;n[t.segmentNumber]=null===a?this._segmentationDefaultColor:Z(...a)}for(let e=0;e<=r;e++){let t=e/r,i=e?1:0,a=[0,0,0];n.hasOwnProperty(e.toString())&&(a=n[e.toString()]),a[0]/=255,a[1]/=255,a[2]/=255,this._segmentationLUT.push([t,...a]),this._segmentationLUTO.push([t,i])}this._frame=e}prepare(){"SEG"===this._modality&&this.prepareSegmentation(),this.computeNumberOfFrames(),this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK.set(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK.set(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this._numberOfFrames>1&&this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin.fromArray(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB();const e=Math.floor(this._frame.length/2),t=this._frame[e];this._rescaleSlope=t.rescaleSlope||1,this._rescaleIntercept=t.rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=J(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=J(this._minMax[1],this._rescaleSlope,this._rescaleIntercept),this._windowWidth=t.windowWidth||this._minMax[1]-this._minMax[0],this._windowCenter=t.windowCenter||this._minMax[0]+this._windowWidth/2,this._bitsAllocated=t.bitsAllocated,this._prepared=!0}packEchos(){let e=[];for(let t=0;t<this._frame.length;t+=4){let n=this._frame[t];for(let e=0;e<this._rows*this._columns;e++){for(let r=1;r<4;r++)n.pixelData[e]+=this._frame[t+r].pixelData[e];n.pixelData[e]/=4}e.push(n)}this._frame=e,this._numberOfFrames=this._frame.length,this._dimensionsIJK.set(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK.set(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)}computeNumberOfFrames(){if(!(this._frame&&this._frame.length>0))return window.console.warn("_frame doesn't contain anything...."),window.console.warn(this._frame),!1;this._numberOfFrames=this._frame.length}computeCosines(){if(this._frame&&this._frame[0]){let e=this._frame[0].cosines();this._xCosine.copy(e[0]),this._yCosine.copy(e[1]),this._zCosine.copy(e[2])}}orderFrames(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):this._frame[0].imagePosition?window.console.warn("warning: unexpected case found..."):window.console.warn("warning: You have null imagePosition...")}computeSpacing(){this.xySpacing(),this.zSpacing()}zSpacing(){this._numberOfFrames>1&&(this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame[1].dist!==this._frame[0].dist?(this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist):this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].sliceThickness&&(this._spacing.z=this._frame[0].sliceThickness))),0===this._spacing.z&&(this._spacing.z=1)}xySpacing(){if(this._frame&&this._frame[0]){let e=this._frame[0].spacingXY();this._spacing.x=e[0],this._spacing.y=e[1]}}computeMinMaxIntensities(){for(let e=0;e<this._frame.length;e++){let t=this._frame[e].minMax[0];Number.isNaN(t)||(this._minMax[0]=Math.min(this._minMax[0],t));let n=this._frame[e].minMax[1];Number.isNaN(n)||(this._minMax[1]=Math.max(this._minMax[1],n))}}computeIJK2LPS(){this._ijk2LPS.copy(function(t,n,r,i,a,o=new e.Matrix4){return Y.set(t.x*i.y,n.x*i.x,r.x*i.z,a.x,t.y*i.y,n.y*i.x,r.y*i.z,a.y,t.z*i.y,n.z*i.x,r.z*i.z,a.z,0,0,0,1),Y.premultiply(o),Y}(this._xCosine,this._yCosine,this._zCosine,this._spacing,this._origin,this._regMatrix)),this._lps2IJK.copy(this._ijk2LPS).invert()}computeLPS2AABB(){var e,t,n,r;this._aabb2LPS.copy((e=this._xCosine,t=this._yCosine,n=this._zCosine,r=this._origin,K.set(e.x,t.x,n.x,r.x,e.y,t.y,n.y,r.y,e.z,t.z,n.z,r.z,0,0,0,1),K)),this._lps2AABB.copy(this._aabb2LPS).invert()}merge(e){return!!(this._stackID===e.stackID&&1===this._numberOfFrames&&1===e._numberOfFrames&&this._frame[0].columns===e.frame[0].columns&&this._frame[0].rows===e.frame[0].rows&&this._xCosine.equals(e.xCosine)&&this._yCosine.equals(e.yCosine)&&this._zCosine.equals(e.zCosine))&&this.mergeModels(this._frame,e.frame)}pack(){const t=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;(8===this._bitsAllocated&&1===this._numberOfChannels||1===this._bitsAllocated)&&(this._packedPerPixel=4),16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);const n=this._textureSize*this._textureSize;let r=Math.ceil(t/(n*this._packedPerPixel)),i=0,a=this._packedPerPixel*n;a>t&&(a=t),this._textureUnits<r&&(console.warn("Insufficient number of supported textures. Some frames will not be packed."),r=this._textureUnits);for(var o=3===this._numberOfChannels?3:4,s=0;s<r;s++)this._rawData.push(W.mallocUint8(n*o));this._textureType=3===this._numberOfChannels?e.RGBFormat:e.RGBAFormat;for(let e=0;e<r;e++)this._packTo8Bits(this._numberOfChannels,this._frame,this._textureSize,i,a,e),i+=this._packedPerPixel*n,a+=this._packedPerPixel*n,a>t&&(a=t);this._packed=!0,this._prepareTexture()}_prepareTexture(){let e=window.THREE;this._textures=[];for(let t=0;t<this._rawData.length;t++){let n=new e.DataTexture(this._rawData[t],this._textureSize,this._textureSize,this._textureType,e.UnsignedByteType,e.UVMapping,e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.NearestFilter,e.NearestFilter);n.needsUpdate=!0,n.flipY=!0,this._textures.push(n)}}_packTo8Bits(e,t,n,r,i,a){var o=0,s=this._rawData[a];const l=t[0].bitsAllocated,c=t[0].pixelType;let u=0;this._minMax[0]<0&&(u-=this._minMax[0]);let h,d=0,f=0;const p=t[0].rows*t[0].columns;if(8===l&&1===e||1===l)for(let e=r;e<i;e++)d=~~(e/p),f=e%p,h=t[d].pixelData[f]+u,s[o++]=h;else if(16===l&&1===e)for(let e=r;e<i;e++)d=~~(e/p),f=e%p,h=t[d].pixelData[f]+u,s[o++]=255&h,s[o++]=h>>>8&255;else if(32===l&&1===e&&0===c)for(let e=r;e<i;e++)d=~~(e/p),f=e%p,h=t[d].pixelData[f]+u,s[o++]=255&h,s[o++]=h>>>8&255,s[o++]=h>>>16&255,s[o++]=h>>>24&255;else if(32===l&&1===e&&1===c)for(let e=r;e<i;e++){d=~~(e/p),f=e%p,h=t[d].pixelData[f]+u;let n=G(h).match(/.{1,8}/g);s[o++]=parseInt(n[0],2),s[o++]=parseInt(n[1],2),s[o++]=parseInt(n[2],2),s[o++]=parseInt(n[3],2)}else if(8===l&&3===e)for(let e=r;e<i;e++)d=~~(e/p),f=e%p,s[o++]=t[d].pixelData[3*f],s[o++]=t[d].pixelData[3*f+1],s[o++]=t[d].pixelData[3*f+2]}worldCenter(){return this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS)}worldBoundingBox(){let t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];const n=this._dimensionsIJK;var r=new e.Vector3;for(let e=0;e<=n.x;e+=n.x)for(let i=0;i<=n.y;i+=n.y)for(let a=0;a<=n.z;a+=n.z)r.set(e,i,a).applyMatrix4(this._ijk2LPS),t[0]=Math.min(t[0],r.x),t[1]=Math.max(t[1],r.x),t[2]=Math.min(t[2],r.y),t[3]=Math.max(t[3],r.y),t[4]=Math.min(t[4],r.z),t[5]=Math.max(t[5],r.z);return t}worldSliceOrientation(){function e(e){let t=Math.abs(e.x),n=Math.abs(e.y),r=t,i=0;return r<n&&(r=n,i=1),r<Math.abs(e.z)&&(i=2),i}return[e(this._xCosine),e(this._yCosine),e(this._zCosine)]}AABBox(){let t=q.set(0,0,0).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),n=X.copy(this._dimensionsIJK).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB);return new e.Vector3(Math.abs(t.x-n.x),Math.abs(t.y-n.y),Math.abs(t.z-n.z))}centerAABBox(){let e=this.worldCenter();return e.applyMatrix4(this._lps2AABB),e}static indexInDimensions(e,t){return e.x>=0&&e.y>=0&&e.z>=0&&e.x<t.x&&e.y<t.y&&e.z<t.z}_orderFrameOnDimensionIndicesArraySort(e,t){if("dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e.dimensionIndexValues)&&"dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues))for(let n=0;n<e.dimensionIndexValues.length;n++){if(parseInt(e.dimensionIndexValues[n],10)>parseInt(t.dimensionIndexValues[n],10))return 1;if(parseInt(e.dimensionIndexValues[n],10)<parseInt(t.dimensionIndexValues[n],10))return-1}else window.console.warn("One of the frames doesn't have a dimensionIndexValues array."),window.console.warn(e),window.console.warn(t);return 0}_computeDistanceArrayMap(e,t){return t.imagePosition&&(t.dist=t.imagePosition[0]*e.x+t.imagePosition[1]*e.y+t.imagePosition[2]*e.z),t}_sortDistanceArraySort(e,t){return e.dist-t.dist}_sortInstanceNumberArraySort(e,t){return e.instanceNumber-t.instanceNumber}_sortSopInstanceUIDArraySort(e,t){return e.sopInstanceUID-t.sopInstanceUID}dispose(){this._frame.forEach((e=>{e.dispose()})),this._frame=[],this._textures.forEach((e=>{e.dispose()})),this._textures=[];for(var e=0;e<this._rawData.length;e++)W.freeUint8(this._rawData[e]);this._rawData=[]}set numberOfChannels(e){this._numberOfChannels=e}get numberOfChannels(){return this._numberOfChannels}set frame(e){this._frame=e}get frame(){return this._frame}set prepared(e){this._prepared=e}get prepared(){return this._prepared}set packed(e){this._packed=e}get packed(){return this._packed}set packedPerPixel(e){this._packedPerPixel=e}get packedPerPixel(){return this._packedPerPixel}set dimensionsIJK(e){this._dimensionsIJK=e}get dimensionsIJK(){return this._dimensionsIJK}set halfDimensionsIJK(e){this._halfDimensionsIJK=e}get halfDimensionsIJK(){return this._halfDimensionsIJK}set regMatrix(e){this._regMatrix=e}get regMatrix(){return this._regMatrix}set ijk2LPS(e){this._ijk2LPS=e}get ijk2LPS(){return this._ijk2LPS}set lps2IJK(e){this._lps2IJK=e}get lps2IJK(){return this._lps2IJK}set lps2AABB(e){this._lps2AABB=e}get lps2AABB(){return this._lps2AABB}set textureSize(e){this._textureSize=e}get textureSize(){return this._textureSize}set textureUnits(e){this._textureUnits=e}get textureUnits(){return this._textureUnits}set textureType(e){this._textureType=e}get textureType(){return this._textureType}set bitsAllocated(e){this._bitsAllocated=e}get bitsAllocated(){return this._bitsAllocated}set rawData(e){this._rawData=e}get rawData(){return this._rawData}get windowWidth(){return this._windowWidth}set windowWidth(e){this._windowWidth=e}get windowCenter(){return this._windowCenter}set windowCenter(e){this._windowCenter=e}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(e){this._rescaleSlope=e}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(e){this._rescaleIntercept=e}get xCosine(){return this._xCosine}set xCosine(e){this._xCosine=e}get yCosine(){return this._yCosine}set yCosine(e){this._yCosine=e}get zCosine(){return this._zCosine}set zCosine(e){this._zCosine=e}get minMax(){return this._minMax}set minMax(e){this._minMax=e}get stackID(){return this._stackID}set stackID(e){this._stackID=e}get pixelType(){return this._pixelType}set pixelType(e){this._pixelType=e}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(e){this._pixelRepresentation=e}set invert(e){this._invert=e}get invert(){return this._invert}set modality(e){this._modality=e}get modality(){return this._modality}get rightHanded(){return this._rightHanded}set rightHanded(e){this._rightHanded=e}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(e){this._spacingBetweenSlices=e}set segmentationSegments(e){this._segmentationSegments=e}get segmentationSegments(){return this._segmentationSegments}set segmentationType(e){this._segmentationType=e}get segmentationType(){return this._segmentationType}set segmentationLUT(e){this._segmentationLUT=e}get segmentationLUT(){return this._segmentationLUT}set segmentationLUTO(e){this._segmentationLUTO=e}get segmentationLUTO(){return this._segmentationLUTO}}var ee=new Uint8Array(262144);class te extends V{constructor(){super(),this._sopInstanceUID=null,this._url=null,this._stackID=-1,this._invert=!1,this._frameTime=null,this._ultrasoundRegions=[],this._rows=0,this._columns=0,this._dimensionIndexValues=[],this._imagePosition=null,this._imageOrientation=null,this._rightHanded=!0,this._sliceThickness=1,this._spacingBetweenSlices=null,this._pixelPaddingValue=null,this._pixelRepresentation=0,this._pixelType=0,this._pixelSpacing=null,this._pixelAspectRatio=null,this._pixelData=null,this._instanceNumber=null,this._windowCenter=null,this._windowWidth=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._bitsAllocated=8,this._numberOfChannels=1,this._minMax=null,this._dist=null,this._index=-1,this._referencedSegmentNumber=-1}validate(e){return!!(super.validate(e)&&"function"==typeof e.cosines&&"function"==typeof e.spacingXY&&e.hasOwnProperty("_sopInstanceUID")&&e.hasOwnProperty("_dimensionIndexValues")&&e.hasOwnProperty("_imageOrientation")&&e.hasOwnProperty("_imagePosition"))}merge(e){return!!this.validate(e)&&!!(this._compareArrays(this._dimensionIndexValues,e.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,e.imageOrientation)&&this._compareArrays(this._imagePosition,e.imagePosition)&&this._instanceNumber===e.instanceNumber&&this._sopInstanceUID===e.sopInstanceUID)}cosines(){let t=[new e.Vector3(1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,0,1)];return this._imageOrientation&&6===this._imageOrientation.length?(t[0].set(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),t[1].set(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]),t[0].lengthSq()>0&&t[1].lengthSq()>0&&t[2].crossVectors(t[0],t[1]).normalize()):(console.log("No valid image orientation for frame"),console.log(this),console.log("Returning default orientation.")),this._rightHanded||t[2].negate(),t}spacingXY(){let e=[1,1];return this.pixelSpacing?(e[0]=this.pixelSpacing[0],e[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(e[0]=1,e[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),e}getPixelData(e,t){return e>=0&&e<this._columns&&t>=0&&t<this._rows?this.pixelData[e+this._columns*t]:null}setPixelData(e,t,n){this.pixelData[e+this._columns*t]=n}getImageDataUrl(){const e=document.createElement("canvas");e.width=this._columns,e.height=this._rows;const t=e.getContext("2d"),n=t.createImageData(e.width,e.height);return n.data.set(this._frameToCanvas()),t.putImageData(n,0,0),e.toDataURL()}_frameToCanvas(){const e=this._columns*this._rows,t={invert:this._invert,min:this._minMax[0],padding:this._pixelPaddingValue};let n=function(e){return e>262144&&alert("Warning: The number of elements per data buffer exceeds the maximum size."),ee}(4*e);if(null!==t.padding){t.min=this._minMax[1];for(let e=0,n=this._pixelData.length;e<n;e++)this._pixelData[e]!==t.padding&&(t.min=Math.min(t.min,this._pixelData[e]))}if(this._windowWidth&&null!==this._windowCenter){const e=this._rescaleIntercept||0,n=this._rescaleSlope||1;t.min=Math.max((this._windowCenter-this._windowWidth/2-e)/n,t.min),t.max=Math.min((this._windowCenter+this._windowWidth/2-e)/n,this._minMax[1])}else t.max=this._minMax[1];if(t.range=t.max-t.min||255,1===this._numberOfChannels)for(let r=0;r<e;r++){const e=this._pixelTo8Bit(this._pixelData[r],t);n[4*r]=e,n[4*r+1]=e,n[4*r+2]=e,n[4*r+3]=255}else if(3===this._numberOfChannels)for(let r=0;r<e;r++)n[4*r]=this._pixelTo8Bit(this._pixelData[3*r],t),n[4*r+1]=this._pixelTo8Bit(this._pixelData[3*r+1],t),n[4*r+2]=this._pixelTo8Bit(this._pixelData[3*r+2],t),n[4*r+3]=255;return n}_pixelTo8Bit(e,t){let n=e<=t.min||e===t.padding?0:255;return e>t.min&&e<t.max&&(n=Math.round(255*(e-t.min)/t.range)),Number.isNaN(n)?0:t.invert?255-n:n}_compareArrays(e,t){return e===t||!(!e||!t||e.join()!==t.join())}dispose(){this._pixelData=[]}get frameTime(){return this._frameTime}set frameTime(e){this._frameTime=e}get ultrasoundRegions(){return this._ultrasoundRegions}set ultrasoundRegions(e){this._ultrasoundRegions=e}get rows(){return this._rows}set rows(e){this._rows=e}get columns(){return this._columns}set columns(e){this._columns=e}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(e){this._spacingBetweenSlices=e}get sliceThickness(){return this._sliceThickness}set sliceThickness(e){this._sliceThickness=e}get imagePosition(){return this._imagePosition}set imagePosition(e){this._imagePosition=e}get imageOrientation(){return this._imageOrientation}set imageOrientation(e){this._imageOrientation=e}get windowWidth(){return this._windowWidth}set windowWidth(e){this._windowWidth=e}get windowCenter(){return this._windowCenter}set windowCenter(e){this._windowCenter=e}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(e){this._rescaleSlope=e}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(e){this._rescaleIntercept=e}get bitsAllocated(){return this._bitsAllocated}set bitsAllocated(e){this._bitsAllocated=e}get dist(){return this._dist}set dist(e){this._dist=e}get pixelSpacing(){return this._pixelSpacing}set pixelSpacing(e){this._pixelSpacing=e}get pixelAspectRatio(){return this._pixelAspectRatio}set pixelAspectRatio(e){this._pixelAspectRatio=e}get minMax(){return this._minMax}set minMax(e){this._minMax=e}get dimensionIndexValues(){return this._dimensionIndexValues}set dimensionIndexValues(e){this._dimensionIndexValues=e}get instanceNumber(){return this._instanceNumber}set instanceNumber(e){this._instanceNumber=e}get pixelData(){return this._pixelData}set pixelData(e){this._pixelData=e}set sopInstanceUID(e){this._sopInstanceUID=e}get sopInstanceUID(){return this._sopInstanceUID}get pixelPaddingValue(){return this._pixelPaddingValue}set pixelPaddingValue(e){this._pixelPaddingValue=e}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(e){this._pixelRepresentation=e}get pixelType(){return this._pixelType}set pixelType(e){this._pixelType=e}get url(){return this._url}set url(e){this._url=e}get referencedSegmentNumber(){return this._referencedSegmentNumber}set referencedSegmentNumber(e){this._referencedSegmentNumber=e}get rightHanded(){return this._rightHanded}set rightHanded(e){this._rightHanded=e}get index(){return this._index}set index(e){this._index=e}get invert(){return this._invert}set invert(e){this._invert=e}get numberOfChannels(){return this._numberOfChannels}set numberOfChannels(e){this._numberOfChannels=e}}class ne{constructor(){this._rightHanded=!0}pixelRepresentation(){return 0}pixelPaddingValue(e=0){return null}modality(){return"unknown"}segmentationType(){return"unknown"}segmentationSegments(){return[]}referencedSegmentNumber(e){return-1}rightHanded(){return this._rightHanded}spacingBetweenSlices(){return null}numberOfChannels(){return 1}sliceThickness(){return null}dimensionIndexValues(e=0){return null}instanceNumber(e=0){return e}windowCenter(e=0){return null}windowWidth(e=0){return null}rescaleSlope(e=0){return 1}rescaleIntercept(e=0){return 0}ultrasoundRegions(e=0){return[]}frameTime(e=0){return null}_decompressUncompressed(){}_swap16(e){return(255&e)<<8|e>>8&255}_swap32(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}invert(){return!1}transferSyntaxUID(){return"no value provided"}studyDate(){return"no value provided"}studyDescription(){return"no value provided"}seriesDate(){return"no value provided"}seriesDescription(){return"no value provided"}rawHeader(){return"no value provided"}patientID(){return"no value provided"}patientName(){return"no value provided"}patientAge(){return"no value provided"}patientBirthdate(){return"no value provided"}patientSex(){return"no value provided"}minMaxPixelData(e=[]){let t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],n=e.length;for(let r=0;r<n;r++){let n=e[r];t[0]=Math.min(t[0],n),t[1]=Math.max(t[1],n)}return t}}var re=__webpack_require__(1629);const ie=function(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){const n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let l=0;const c=a.getInt32(0,!0);for(let e=0;e<c;++e){l=e*r;let t=a.getInt32(4*(e+1),!0),i=a.getInt32(4*(e+2),!0);0===i&&(i=n.length);const u=r*c;for(;t<i;){const e=o[t++];if(e>=0&&e<=127)for(let n=0;n<e+1&&l<u;++n)s[l]=o[t++],l++;else if(e<=-1&&e>=-127){const n=o[t++];for(let t=0;t<1-e&&l<u;++t)s[l]=n,l++}}}return e.pixelData=new Uint8Array(i),e}(e,t):function(e,t){const n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let l=0;const c=a.getInt32(0,!0);for(let t=0;t<c;++t){l=t;let i=a.getInt32(4*(t+1),!0),u=a.getInt32(4*(t+2),!0);0===u&&(u=n.length);const h=r*c;for(;i<u;){const t=o[i++];if(t>=0&&t<=127)for(let n=0;n<t+1&&l<h;++n)s[l]=o[i++],l+=e.samplesPerPixel;else if(t<=-1&&t>=-127){const n=o[i++];for(let r=0;r<1-t&&l<h;++r)s[l]=n,l+=e.samplesPerPixel}}}return e.pixelData=new Uint8Array(i),e}(e,t);if(16===e.bitsAllocated)return function(e,t){const n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel*2),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),l=a.getInt32(0,!0);for(let e=0;e<l;++e){let t=0;const i=0===e?1:0;let l=a.getInt32(4*(e+1),!0),c=a.getInt32(4*(e+2),!0);for(0===c&&(c=n.length);l<c;){const e=o[l++];if(e>=0&&e<=127)for(let n=0;n<e+1&&t<r;++n)s[2*t+i]=o[l++],t++;else if(e<=-1&&e>=-127){const n=o[l++];for(let a=0;a<1-e&&t<r;++a)s[2*t+i]=n,t++}}}0===e.pixelRepresentation?e.pixelData=new Uint16Array(i):e.pixelData=new Int16Array(i);return e}(e,t);throw new Error("unsupported pixel format for RLE")};let ae,oe=__webpack_require__(5952),se=__webpack_require__(9731),le=__webpack_require__(2474),ce=__webpack_require__(3033);function ue(e){let t=Number(e);if(t!=t){const n=(e.match(/\./g)||[]).length;if(1===(e.match(/\,/g)||[]).length&&n<2){const r=0===n?".":"",i=e.replace(/,/g,r);t=Number(i)}t!=t&&(console.error(`String could not be converted to number (${e}). Setting value to "1.0".`),t=1)}return t}class he extends ne{constructor(e,t){super(),this._id=t,this._arrayBuffer=e.buffer;let n=new Uint8Array(this._arrayBuffer);this._dataSet=null;try{this._dataSet=oe.parseDicom(n)}catch(e){console.log(e);throw new Error("parsers.dicom could not parse the file")}}seriesInstanceUID(){return this._dataSet.string("x0020000e")}studyInstanceUID(){return this._dataSet.string("x0020000d")}modality(){return this._dataSet.string("x00080060")}segmentationType(){return this._dataSet.string("x00620001")}segmentationSegments(){let e=[],t=this._dataSet.elements.x00620002;if(!t)return e;for(let n=0;n<t.items.length;n++){let r=this._recommendedDisplayCIELab(t.items[n]),i=this._segmentationCode(t.items[n]),a=t.items[n].dataSet.uint16("x00620004"),o=t.items[n].dataSet.string("x00620005"),s=t.items[n].dataSet.string("x00620008");e.push({recommendedDisplayCIELab:r,segmentationCodeDesignator:i.segmentationCodeDesignator,segmentationCodeValue:i.segmentationCodeValue,segmentationCodeMeaning:i.segmentationCodeMeaning,segmentNumber:a,segmentLabel:o,segmentAlgorithmType:s})}return e}_segmentationCode(e){let t="unknown",n="unknown",r="unknown",i=e.dataSet.elements.x00082218;return i&&i.items&&i.items.length>0&&(t=i.items[0].dataSet.string("x00080102"),n=i.items[0].dataSet.string("x00080100"),r=i.items[0].dataSet.string("x00080104")),{segmentationCodeDesignator:t,segmentationCodeValue:n,segmentationCodeMeaning:r}}_recommendedDisplayCIELab(e){if(!e.dataSet.elements.x0062000d)return null;let t=e.dataSet.elements.x0062000d.dataOffset,n=e.dataSet.elements.x0062000d.length,r=e.dataSet.byteArray.slice(t,t+n),i=new Uint16Array(n/2);for(let e=0;e<n/2;e++)i[e]=(r[2*e+1]<<8)+r[2*e];return[i[0]/65535*100,i[1]/65535*255-128,i[2]/65535*255-128]}rawHeader(){return this._dataSet}sopInstanceUID(e=0){return this._findStringEverywhere("x2005140f","x00080018",e)}transferSyntaxUID(){return this._dataSet.string("x00020010")}studyDate(){return this._dataSet.string("x00080020")}studyDescription(){return this._dataSet.string("x00081030")}seriesDate(){return this._dataSet.string("x00080021")}seriesDescription(){return this._dataSet.string("x0008103e")}patientName(){return this._dataSet.string("x00100010")}patientID(){return this._dataSet.string("x00100020")}patientBirthdate(){return this._dataSet.string("x00100030")}patientSex(){return this._dataSet.string("x00100040")}patientAge(){return this._dataSet.string("x00101010")}photometricInterpretation(){return this._dataSet.string("x00280004")}planarConfiguration(){let e=this._dataSet.uint16("x00280006");return void 0===e&&(e=null),e}samplesPerPixel(){return this._dataSet.uint16("x00280002")}numberOfFrames(){let e=this._dataSet.intString("x00280008");return void 0===e&&(e=null),e}numberOfChannels(){let e=1,t=this.photometricInterpretation();return"RGB"!==t&&"PALETTE COLOR"!==t&&"YBR_FULL"!==t&&"YBR_FULL_422"!==t&&"YBR_PARTIAL_422"!==t&&"YBR_PARTIAL_420"!==t&&"YBR_RCT"!==t||(e=3),e}invert(){return"MONOCHROME1"===this.photometricInterpretation()}imageOrientation(e=0){let t=this._findStringEverywhere("x00209116","x00200037",e);return t&&(t=t.split("\\").map(ue)),t}referencedSegmentNumber(e=0){let t=-1,n=this._findInGroupSequence("x52009230","x0062000a",e);return null!==n&&(t=n.uint16("x0062000b")),t}pixelAspectRatio(){let e=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return void 0===e[0]&&(e=null),e}imagePosition(e=0){let t=this._findStringEverywhere("x00209113","x00200032",e);return t&&(t=t.split("\\").map(ue)),t}instanceNumber(e=0){let t=null,n=this._dataSet.elements.x52009230;if(void 0!==n)if(n.items[e].dataSet.elements.x2005140f){t=n.items[e].dataSet.elements.x2005140f.items[0].dataSet.intString("x00200013")}else t=this._dataSet.intString("x00200013"),void 0===t&&(t=null);else t=this._dataSet.intString("x00200013"),void 0===t&&(t=null);return t}pixelSpacing(e=0){let t=this._findStringEverywhere("x00289110","x00280030",e);if(null===t&&(t=this._dataSet.string("x00181164"),void 0===t&&(t=null)),t){const e=t.split("\\");2!==e.length?(console.error(`DICOM spacing format is not supported (could not split string on "\\"): ${t}`),t=null):t=e.map(ue)}return t}ultrasoundRegions(e=0){const t=this._dataSet.elements.x00186011;if(!t||!t.items)return[];const n=[];return t.items.forEach((e=>{n.push({x0:e.dataSet.uint32("x00186018"),y0:e.dataSet.uint32("x0018601a"),x1:e.dataSet.uint32("x0018601c"),y1:e.dataSet.uint32("x0018601e"),axisX:e.dataSet.int32("x00186020")||null,axisY:e.dataSet.int32("x00186022")||null,unitsX:this._getUnitsName(e.dataSet.uint16("x00186024")),unitsY:this._getUnitsName(e.dataSet.uint16("x00186026")),deltaX:e.dataSet.double("x0018602c"),deltaY:e.dataSet.double("x0018602e")})})),n}frameTime(e=0){let t,n=this._dataSet.uint16("x00280009",1),r=this._dataSet.intString("x00082144");return"number"==typeof n&&(n=n.toString(16),t=this._dataSet.floatString("x0018"+n)),void 0===t&&"number"==typeof r&&(t=1e3/r),void 0===t&&(t=null),t}rows(e=0){let t=this._dataSet.uint16("x00280010");return void 0===t&&(t=null),t}columns(e=0){let t=this._dataSet.uint16("x00280011");return void 0===t&&(t=null),t}pixelType(e=0){return 0}pixelRepresentation(e=0){return this._dataSet.uint16("x00280103")}pixelPaddingValue(e=0){let t=this._dataSet.int16("x00280120");return void 0===t&&(t=null),t}bitsAllocated(e=0){return this._dataSet.uint16("x00280100")}highBit(e=0){return this._dataSet.uint16("x00280102")}rescaleIntercept(e=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",e)}rescaleSlope(e=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",e)}windowCenter(e=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",e)}windowWidth(e=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",e)}sliceThickness(e=0){return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",e)}spacingBetweenSlices(e=0){let t=this._dataSet.floatString("x00180088");return void 0===t&&(t=null),t}dimensionIndexValues(e=0){let t=null,n=this._dataSet.elements.x52009230;if(void 0!==n){let r=n.items[e].dataSet.elements.x00209111;if(null!=r){r=r.items[0].dataSet;let e=r.elements.x00209157;if(null!=e){let n=e.length/4;t=[];for(let e=0;e<n;e++)t.push(r.uint32("x00209157",e))}}}return t}inStackPositionNumber(e=0){let t=null,n=this._dataSet.elements.x52009230;if(void 0!==n){t=n.items[e].dataSet.elements.x00209111.items[0].dataSet.uint32("x00209057")}else t=null;return t}stackID(e=0){let t=null,n=this._dataSet.elements.x52009230;if(void 0!==n){t=n.items[e].dataSet.elements.x00209111.items[0].dataSet.intString("x00209056")}else t=null;return t}extractPixelData(e=0){let t=this._decodePixelData(e);return this.numberOfChannels()>1?this._convertColorSpace(t):t}_findInGroupSequence(e,t,n){let r=this._dataSet.elements[e];if(void 0!==r){let e=r.items[n].dataSet.elements[t];if(void 0!==e)return e.items[0].dataSet}return null}_findStringInGroupSequence(e,t,n,r){let i=this._findInGroupSequence(e,t,r);return null!==i?i.string(n):null}_findStringInFrameGroupSequence(e,t,n){return this._findStringInGroupSequence("x52009229",e,t,0)||this._findStringInGroupSequence("x52009230",e,t,n)}_findStringEverywhere(e,t,n){let r=this._findStringInFrameGroupSequence(e,t,n);if(null===r){const e="x00540022";r=this._findStringInSequence(e,t)}return null===r&&(r=this._dataSet.string(t)),void 0===r&&(r=null),r}_findStringInSequence(e,t,n){const r=this._dataSet.elements[e];let i;return r&&(i=r.items[0].dataSet.string(t)),void 0===i&&(i=null),i}_findFloatStringInGroupSequence(e,t,n,r){let i=this._dataSet.floatString(n);return void 0===i&&(i=this._findInGroupSequence(e,t,r),null!==i)?i.floatString(n):i}_findFloatStringInFrameGroupSequence(e,t,n){return this._findFloatStringInGroupSequence("x52009229",e,t,0)||this._findFloatStringInGroupSequence("x52009230",e,t,n)}_decodePixelData(e=0){let t=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t)return this._decodeJ2K(e);if("1.2.840.10008.1.2.5"===t)return this._decodeRLE(e);if("1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t)return this._decodeJPEGLossless(e);if("1.2.840.10008.1.2.4.50"===t||"1.2.840.10008.1.2.4.51"===t)return this._decodeJPEGBaseline(e);if("1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t)return this._decodeUncompressed(e);if("1.2.840.10008.1.2.2"===t){let t=this._decodeUncompressed(e);return this._swapFrame(t)}throw{error:`no decoder for transfer syntax ${t}`}}framesAreFragmented(){return this._dataSet.intString("x00280008")!==this._dataSet.elements.x7fe00010.fragments.length}getEncapsulatedImageFrame(e){return this._dataSet.elements.x7fe00010&&this._dataSet.elements.x7fe00010.basicOffsetTable.length?oe.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,e):this.framesAreFragmented()?oe.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,e,oe.createJPEGBasicOffsetTable(this._dataSet,this._dataSet.elements.x7fe00010)):oe.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,e)}_decodeJpx(e=0){const t=new ce;if(t.parse(this.getEncapsulatedImageFrame(e)),1!==t.componentsCount)throw new Error("JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected");if(1!==t.tiles.length)throw new Error("JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected");return t.tiles[0].items}_decodeOpenJPEG(e=0){const t=this.getEncapsulatedImageFrame(e),n=this.bitsAllocated(e)<=8?1:2,r=1===this.pixelRepresentation(e),i=ae._malloc(t.length);ae.writeArrayToMemory(t,i);const a=ae._malloc(4),o=ae._malloc(4),s=ae._malloc(4),l=ae._malloc(4),c=ae._malloc(4),u=ae.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[i,t.length,a,o,s,l,c]),h=ae.getValue(a,"*");if(0!==u)return console.log("[opj_decode] decoding failed!"),ae._free(i),ae._free(h),ae._free(s),ae._free(l),ae._free(o),void ae._free(c);const d=ae.getValue(s,"i32")*ae.getValue(l,"i32")*ae.getValue(c,"i32"),f=new Int32Array(ae.HEAP32.buffer,h,d);let p;if(1===n)if(Uint8Array.from)p=Uint8Array.from(f);else{p=new Uint8Array(d);for(let e=0;e<d;e++)p[e]=f[e]}else if(r)if(Int16Array.from)p=Int16Array.from(f);else{p=new Int16Array(d);for(let e=0;e<d;e++)p[e]=f[e]}else if(Uint16Array.from)p=Uint16Array.from(f);else{p=new Uint16Array(d);for(let e=0;e<d;e++)p[e]=f[e]}return ae._free(i),ae._free(a),ae._free(h),ae._free(o),ae._free(s),ae._free(l),ae._free(c),p}_decodeJ2K(e=0){return void 0===re?this._decodeJpx(e):ae||(ae=re(),ae&&ae._jp2_decode)?this._decodeOpenJPEG(e):this._decodeJpx(e)}_decodeRLE(e=0){const t=this.bitsAllocated(e),n=this.planarConfiguration(),r=this.columns(),i=this.rows(),a=this.samplesPerPixel(e),o={pixelRepresentation:this.pixelRepresentation(e),bitsAllocated:t,planarConfiguration:n,columns:r,rows:i,samplesPerPixel:a},s=oe.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,e);return ie(o,s).pixelData}_decodeJPEGLossless(e=0){let t=this.getEncapsulatedImageFrame(e),n=this.pixelRepresentation(e),r=this.bitsAllocated(e)<=8?1:2,i=(new se.lossless.Decoder).decode(t.buffer,t.byteOffset,t.length,r);return 0===n?2===r?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)}_decodeJPEGBaseline(e=0){let t=this.getEncapsulatedImageFrame(e),n=this.rows(e),r=this.columns(e),i=this.bitsAllocated(e),a=new le;return a.parse(t),8===i?a.getData(r,n):16===i?a.getData16(r,n):void 0}_decodeUncompressed(e=0){let t=this.pixelRepresentation(e),n=this.bitsAllocated(e),r=this._dataSet.elements.x7fe00010.dataOffset,i=this.numberOfChannels(),a=this.rows(e)*this.columns(e)*i,o=0,s=this._dataSet.byteArray.buffer;if(0===t&&8===n)return o=r+e*a,new Uint8Array(s,o,a);if(0===t&&16===n)return o=r+e*a*2,new Uint16Array(s,o,a);if(1===t&&16===n)return o=r+e*a*2,new Int16Array(s,o,a);if(0===t&&32===n)return o=r+e*a*4,new Uint32Array(s,o,a);if(0===t&&1===n){let t=new ArrayBuffer(a),n=new Uint8Array(t);o=r+e*a;let i=0,l=e*a,c=e*a+a,u=Math.floor(l/8),h=l-8*u,d=Math.ceil(c/8),f=new Uint8Array(s,r);for(let e=u;e<=d;e++){for(;h<8;){switch(h){case 0:n[i]=1&f[e];break;case 1:n[i]=f[e]>>>1&1;break;case 2:n[i]=f[e]>>>2&1;break;case 3:n[i]=f[e]>>>3&1;break;case 4:n[i]=f[e]>>>4&1;break;case 5:n[i]=f[e]>>>5&1;break;case 6:n[i]=f[e]>>>6&1;break;case 7:n[i]=f[e]>>>7&1}if(h++,i++,i>=a)return n}h=0}}}_interpretAsRGB(e){return-1!==["RGB","YBR_RCT","YBR_ICT","YBR_FULL_422"].indexOf(e)}_convertColorSpace(e){let t=null,n=this.photometricInterpretation(),r=this.planarConfiguration();const i=this._interpretAsRGB(n);if(i&&0===r)t=e;else if(i&&1===r){if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array)){throw new Error(`unsuported typed array: ${e}`)}t=new Uint16Array(e.length)}let n=e.length/3,r=0,i=0,a=n,o=2*n;for(let s=0;s<n;s++)t[r++]=e[i++],t[r++]=e[a++],t[r++]=e[o++]}else{if("YBR_FULL"!==n){throw new Error(`photometric interpolation not supported: ${n}`)}{if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array)){throw new Error(`unsuported typed array: ${e}`)}t=new Uint16Array(e.length)}let n=e.length/3,r=0,i=0;for(let a=0;a<n;a++){let n=e[r++],a=e[r++],o=e[r++];t[i++]=n+1.402*(o-128),t[i++]=n-.34414*(a-128)-.71414*(o-128),t[i++]=n+1.772*(a-128)}}}return t}_swapFrame(e){let t=this.bitsAllocated();if(16===t)for(let t=0;t<e.length;t++)e[t]=this._swap16(e[t]);else if(32===t)for(let t=0;t<e.length;t++)e[t]=this._swap32(e[t]);return e}_getUnitsName(e){const t={0:"none",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm2",9:"cm2/sec",10:"cm3",11:"cm3/sec",12:"degrees"};return t.hasOwnProperty(e)?t[e]:"none"}}class de extends ne{constructor(e,t){super(),this._id=t,this._url=e.url,this._header={},this._buffer=null;try{(new TextDecoder).decode(e.mhdBuffer).split("\n").forEach((e=>{let t=e.split("=");2===t.length&&(this._header[t[0].trim()]=t[1].trim())})),this._header.DimSize=this._header.DimSize.split(" "),this._header.ElementSpacing=this._header.ElementSpacing.split(" "),this._header.TransformMatrix=this._header.TransformMatrix.split(" "),this._header.Offset=this._header.Offset.split(" "),this._buffer=e.rawBuffer}catch(e){window.console.log("ooops... :(")}}rightHanded(){let e=this._header.AnatomicalOrientation;return this._rightHanded="RAS"===e||"RPI"===e||"LPS"===e||"LAI"===e,this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return parseInt(this._header.DimSize[2],10)}sopInstanceUID(e=0){return e}rows(e=0){return parseInt(this._header.DimSize[1],10)}columns(e=0){return parseInt(this._header.DimSize[0],10)}pixelType(e=0){let t=0;return"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(t=1),t}bitsAllocated(e=0){let t=1;return"MET_UCHAR"===this._header.ElementType||"MET_CHAR"===this._header.ElementType?t=8:"MET_USHORT"===this._header.ElementType||"MET_SHORT"===this._header.ElementType?t=16:"MET_UINT"!==this._header.ElementType&&"MET_INT"!==this._header.ElementType&&"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(t=32),t}pixelSpacing(e=0){return[parseFloat(this._header.ElementSpacing[1],10),parseFloat(this._header.ElementSpacing[0],10),parseFloat(this._header.ElementSpacing[2],10)]}imageOrientation(t=0){let n=this._header.AnatomicalOrientation.match(/L/)?-1:1,r=this._header.AnatomicalOrientation.match(/P/)?-1:1,i=new e.Vector3(parseFloat(this._header.TransformMatrix[0])*n,parseFloat(this._header.TransformMatrix[1])*r,parseFloat(this._header.TransformMatrix[2]));i.normalize();let a=new e.Vector3(parseFloat(this._header.TransformMatrix[3])*n,parseFloat(this._header.TransformMatrix[4])*r,parseFloat(this._header.TransformMatrix[5]));return a.normalize(),[i.x,i.y,i.z,a.x,a.y,a.z]}imagePosition(e=0){return[parseFloat(this._header.Offset[0]),parseFloat(this._header.Offset[1]),parseFloat(this._header.Offset[2])]}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this._buffer,n=this.numberOfChannels(),r=this.rows(e)*this.columns(e)*n;this.rightHanded()||(e=this.numberOfFrames()-1-e);let i=e*r;return"MET_CHAR"===this._header.ElementType?new Int8Array(t,i,r):"MET_UCHAR"===this._header.ElementType?new Uint8Array(t,i,r):"MET_SHORT"===this._header.ElementType?(i*=2,new Int16Array(t,i,r)):"MET_USHORT"===this._header.ElementType?(i*=2,new Uint16Array(t,i,r)):"MET_INT"===this._header.ElementType?(i*=4,new Int32Array(t,i,r)):"MET_UINT"===this._header.ElementType?(i*=4,new Uint32Array(t,i,r)):"MET_FLOAT"===this._header.ElementType?(i*=4,new Float32Array(t,i,r)):void 0}}var fe=__webpack_require__(9602),pe=__webpack_require__.n(fe);class me extends ne{constructor(e,t){if(super(),this._id=t,this._arrayBuffer=e.buffer,this._url=e.url,this._dataSet=null,this._niftiHeader=null,this._niftiImage=null,this._ordered=!0,this._orderedData=null,this._qfac=1,!pe().isNIFTI(this._arrayBuffer)){throw new Error("parsers.nifti could not parse the file")}this._dataSet=pe().readHeader(this._arrayBuffer),this._niftiImage=pe().readImage(this._dataSet,this._arrayBuffer)}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.dims[3]}numberOfChannels(){let e=1;return this._dataSet.dims[0]>=5?(e=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?e=3:2304===this._dataSet.datatypeCode&&(e=4),e}sopInstanceUID(e=0){return e}rows(e=0){return this._dataSet.dims[2]}columns(e=0){return this._dataSet.dims[1]}pixelType(e=0){let t=0;return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(t=1),t}bitsAllocated(e=0){return this._dataSet.numBitsPerVoxel}pixelSpacing(e=0){return[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]}sliceThickness(){return null}imageOrientation(e=0){if(this._dataSet.qform_code>0){let e=0,t=this._dataSet.quatern_b,n=this._dataSet.quatern_c,r=this._dataSet.quatern_d;return e=1-(t*t+n*n+r*r),e<1e-7?(e=1/Math.sqrt(t*t+n*n+r*r),t*=e,n*=e,r*=e,e=0):e=Math.sqrt(e),this._dataSet.pixDims[0]<0&&(this._rightHanded=!1),[-(e*e+t*t-n*n-r*r),-2*(t*n+e*r),2*(t*r-e*n),-2*(t*n-e*r),-(e*e+n*n-t*t-r*r),2*(n*r+e*t)]}if(this._dataSet.sform_code>0){return[...[-this._dataSet.affine[0][0],-this._dataSet.affine[0][1],this._dataSet.affine[0][2]],...[-this._dataSet.affine[1][0],-this._dataSet.affine[1][1],this._dataSet.affine[0][2]]]}return this._dataSet.qform_code,[1,0,0,0,1,0]}imagePosition(e=0){return[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]}dimensionIndexValues(e=0){return null}instanceNumber(e=0){return e}windowCenter(e=0){return null}windowWidth(e=0){return null}rescaleSlope(e=0){return this._dataSet.scl_slope}rescaleIntercept(e=0){return this._dataSet.scl_inter}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this.numberOfChannels(),n=this.rows(e)*this.columns(e)*t,r=e*n,i=this._niftiImage;if(this._ordered||null!==this._orderedData||this._reorderData(),null!==this._orderedData)return this._orderedData.slice(r,r+n);if(2===this._dataSet.datatypeCode)return new Uint8Array(i,r,n);if(256===this._dataSet.datatypeCode)return new Int8Array(i,r,n);if(512===this._dataSet.datatypeCode)return r*=2,new Uint16Array(i,r,n);if(4===this._dataSet.datatypeCode)return r*=2,new Int16Array(i,r,n);if(8===this._dataSet.datatypeCode)return r*=4,new Int32Array(i,r,n);if(16===this._dataSet.datatypeCode){r*=4;const e=new Float32Array(i,r,n);for(let t=0;t<e.length;t++)e[t]!==1/0&&e[t]!==-1/0||(e[t]=0);return e}window.console.warn(`Unknown data type: datatypeCode : ${this._dataSet.datatypeCode}`)}_reorderData(){let e=this.numberOfChannels(),t=this.rows()*this.columns()*e,n=this._niftiImage,r=t*this.numberOfFrames(),i=null;this._orderedData=null,2===this._dataSet.datatypeCode?(i=new Uint8Array(n,0,r),this._orderedData=new Uint8Array(i.length)):256===this._dataSet.datatypeCode?(i=new Int8Array(n,0,r),this._orderedData=new Int8Array(i.length)):512===this._dataSet.datatypeCode?(i=new Uint16Array(n,0,r),this._orderedData=new Uint16Array(i.length)):4===this._dataSet.datatypeCode?(i=new Int16Array(n,0,r),this._orderedData=new Int16Array(i.length)):16===this._dataSet.datatypeCode&&(i=new Float32Array(n,0,r),this._orderedData=new Float32Array(i.length));let a=i.length/3,o=0,s=0,l=a,c=2*a;for(let e=0;e<a;e++)this._orderedData[o++]=i[s++],this._orderedData[o++]=i[l++],this._orderedData[o++]=i[c++];this._ordered=!0}}let ge=__webpack_require__(4316),ve=__webpack_require__(9616);class ye extends ne{constructor(e,t){super(),this._id=t,this._arrayBuffer=e.buffer,this._url=e.url,this._dataSet=null,this._unpackedData=null;try{this._dataSet=ve.parse(this._arrayBuffer)}catch(e){window.console.log("ooops... :(")}}rightHanded(){return this._dataSet.space&&(this._dataSet.space.match(/^right-anterior-superior/)||this._dataSet.space.match(/^left-posterior-superior/)?this._rightHanded=!0:this._rightHanded=!1),this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.sizes[2]}numberOfChannels(){return 1}sopInstanceUID(e=0){return e}rows(e=0){return this._dataSet.sizes[1]}columns(e=0){return this._dataSet.sizes[0]}pixelType(e=0){let t=0;return"float"===this._dataSet.type&&(t=1),t}bitsAllocated(e=0){let t=1;return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?t=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?t=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(t=32),t}pixelSpacing(t=0){if(this._dataSet.spaceDirections){const t=new e.Vector3(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2]),n=new e.Vector3(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),r=new e.Vector3(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[t.length(),n.length(),r.length()]}return[1,1,1]}imageOrientation(t=0){if(this._dataSet.space){let t=this._dataSet.space.match(/right/)?-1:1,n=this._dataSet.space.match(/anterior/)?-1:1,r=new e.Vector3(this._dataSet.spaceDirections[0][0]*t,this._dataSet.spaceDirections[0][1]*n,this._dataSet.spaceDirections[0][2]);r.normalize();let i=new e.Vector3(this._dataSet.spaceDirections[1][0]*t,this._dataSet.spaceDirections[1][1]*n,this._dataSet.spaceDirections[1][2]);return i.normalize(),[r.x,r.y,r.z,i.x,i.y,i.z]}return[1,0,0,0,1,0]}imagePosition(e=0){return this._dataSet.spaceOrigin?[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]:[0,0,0]}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this._dataSet.buffer;const n=this.numberOfChannels(),r=this.rows(e)*this.columns(e)*n;this.rightHanded()||(e=this.numberOfFrames()-1-e);let i=e*r;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){let e=ge.inflate(this._dataSet.buffer);this._unpackedData=e.buffer,t=this._unpackedData}else"gzip"===this._dataSet.encoding&&(t=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?new Int8Array(t,i,r):"uint8"===this._dataSet.type?new Uint8Array(t,i,r):"int16"===this._dataSet.type||"short"===this._dataSet.type?(i*=2,new Int16Array(t,i,r)):"uint16"===this._dataSet.type?(i*=2,new Uint16Array(t,i,r)):"int32"===this._dataSet.type?(i*=4,new Int32Array(t,i,r)):"uint32"===this._dataSet.type?(i*=4,new Uint32Array(t,i,r)):"float"===this._dataSet.type?(i*=4,new Float32Array(t,i,r)):void 0}}class _e extends ne{constructor(t,n){if(super(),this._id=n,this._url=t.url,this._buffer=null,this._bufferPos=0,this._dataPos=0,this._pixelData=null,this._version=1,this._width=0,this._height=0,this._depth=0,this._nframes=0,this._type=_e.MRI_UCHAR,this._dof=0,this._goodRASFlag=0,this._spacingXYZ=[1,1,1],this._Xras=[-1,0,0],this._Yras=[0,0,-1],this._Zras=[0,1,0],this._Cras=[0,0,0],this._tr=0,this._flipAngle=0,this._te=0,this._ti=0,this._fov=0,this._tags=[],this._origin=[0,0,0],this._imageOrient=[0,0,0,0,0,0],this._buffer=t.buffer,this._version=this._readInt(),this._swapEndian=!1,1==this._version);else{if(16777216!=this._version){throw new Error("MGH/MGZ parser: Unknown Endian.  Version reports: "+this._version)}this._swapEndian=!0,this._version=this._swap32(this._version)}this._width=this._readInt(),this._height=this._readInt(),this._depth=this._readInt(),this._nframes=this._readInt(),this._type=this._readInt(),this._dof=this._readInt(),this._goodRASFlag=this._readShort(),this._spacingXYZ=this._readFloat(3),this._Xras=this._readFloat(3),this._Yras=this._readFloat(3),this._Zras=this._readFloat(3),this._Cras=this._readFloat(3),this._bufferPos=284;let r=this._width*this._height*this._depth*this._nframes;this._width,this._height,this._depth;switch(this._type){case _e.MRI_UCHAR:this._pixelData=this._readUChar(r);break;case _e.MRI_INT:this._pixelData=this._readInt(r);break;case _e.MRI_FLOAT:this._pixelData=this._readFloat(r);break;case _e.MRI_SHORT:this._pixelData=this._readShort(r);break;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}this._tr=this._readFloat(1),this._flipAngle=this._readFloat(1),this._te=this._readFloat(1),this._ti=this._readFloat(1),this._fov=this._readFloat(1);let i=new TextDecoder,a=this._tagReadStart();for(;null!=a[0];){let e,t=a[0],n=a[1];switch(t){case _e.TAG_OLD_MGH_XFORM:case _e.TAG_MGH_XFORM:e=this._readChar(n);break;default:e=this._readChar(n)}e=i.decode(e),this._tags.push({tagType:t,tagValue:e}),a=this._tagReadStart()}const o=(new e.Vector3).fromArray(this._Xras),s=(new e.Vector3).fromArray(this._Yras),l=(new e.Vector3).crossVectors(o,s),c=(new e.Vector3).fromArray(this._Zras);l.angleTo(c)>Math.PI/2&&(this._rightHanded=!1),this._imageOrient=[-this._Xras[0],-this._Xras[1],this._Xras[2],-this._Yras[0],-this._Yras[1],this._Yras[2]];let u=this._width/2,h=this._height/2,d=this._depth/2;for(let e=0;e<3;++e)this._origin[e]=this._Cras[e]-(this._Xras[e]*this._spacingXYZ[0]*u+this._Yras[e]*this._spacingXYZ[1]*h+this._Zras[e]*this._spacingXYZ[2]*d);this._origin=[-this._origin[0],-this._origin[1],this._origin[2]]}seriesInstanceUID(){return this._url}numberOfFrames(){return this._depth}sopInstanceUID(e=0){return e}rows(e=0){return this._width}columns(e=0){return this._height}pixelType(e=0){switch(this._type){case _e.MRI_UCHAR:case _e.MRI_INT:case _e.MRI_SHORT:return 0;case _e.MRI_FLOAT:return 1;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}bitsAllocated(e=0){switch(this._type){case _e.MRI_UCHAR:return 8;case _e.MRI_SHORT:return 16;case _e.MRI_INT:case _e.MRI_FLOAT:return 32;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}pixelSpacing(e=0){return this._spacingXYZ}imageOrientation(e=0){return this._imageOrient}imagePosition(e=0){return this._origin}extractPixelData(e=0){let t=this._width*this._height;return this._pixelData.slice(e*t,(e+1)*t)}_readInt(e=1){let t,n=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*e));if(this._bufferPos+=4*e,1==e)t=n.getInt32(0,this._swapEndian);else{t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=n.getInt32(4*r,this._swapEndian)}return t}_readShort(e=1){let t,n=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+2*e));if(this._bufferPos+=2*e,1==e)t=n.getInt16(0,this._swapEndian);else{t=new Int16Array(e);for(let r=0;r<e;r++)t[r]=n.getInt16(2*r,this._swapEndian)}return t}_readLong(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+8*e));this._bufferPos+=8*e;let n=new Uint16Array(e);for(let r=0;r<e;r++){let e=0,i=0;this._swapendian?e=4:i=4;let a=t.getInt32(8*r+e,this._swapEndian),o=t.getInt32(8*r+i,this._swapEndian);0!=a&&(console.log("Unable to read Int64 with high word: "+a+"low word: "+o),o=void 0),n[r]=o}return 0==e?void 0:1==e?n[0]:n}_readChar(e=1){let t,n=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+e));if(this._bufferPos+=e,1==e)t=n.getInt8(0,this._swapEndian);else{t=new Int8Array(e);for(let r=0;r<e;r++)t[r]=n.getInt8(r,this._swapEndian)}return t}_readUChar(e=1){let t,n=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+e));if(this._bufferPos+=e,1==e)t=n.getUint8(0,this._swapEndian);else{t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=n.getUint8(r,this._swapEndian)}return t}_readFloat(e=1){let t,n=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*e));if(this._bufferPos+=4*e,1==e)t=n.getFloat32(0,this._swapEndian);else{t=new Float32Array(e);for(let r=0;r<e;r++)t[r]=n.getFloat32(4*r,this._swapEndian)}return t}_tagReadStart(){if(this._bufferPos>=this._buffer.byteLength)return[void 0,void 0];let e,t=this._readInt();switch(t){case _e.TAG_OLD_MGH_XFORM:e=this._readInt(),e-=1;break;case _e.TAG_OLD_SURF_GEOM:case _e.TAG_OLD_USEREALRAS:case _e.TAG_OLD_COLORTABLE:e=0;break;default:e=this._readLong()}return null==e&&(t=void 0),[t,e]}}_e.MRI_UCHAR=0,_e.MRI_INT=1,_e.MRI_LONG=2,_e.MRI_FLOAT=3,_e.MRI_SHORT=4,_e.MRI_BITMAP=5,_e.MRI_TENSOR=6,_e.MRI_FLOAT_COMPLEX=7,_e.MRI_DOUBLE_COMPLEX=8,_e.MRI_RGB=9,_e.TAG_OLD_COLORTABLE=1,_e.TAG_OLD_USEREALRAS=2,_e.TAG_CMDLINE=3,_e.TAG_USEREALRAS=4,_e.TAG_COLORTABLE=5,_e.TAG_GCAMORPH_GEOM=10,_e.TAG_GCAMORPH_TYPE=11,_e.TAG_GCAMORPH_LABELS=12,_e.TAG_OLD_SURF_GEOM=20,_e.TAG_SURF_GEOM=21,_e.TAG_OLD_MGH_XFORM=30,_e.TAG_MGH_XFORM=31,_e.TAG_GROUP_AVG_SURFACE_AREA=32,_e.TAG_AUTO_ALIGN=33,_e.TAG_SCALAR_DOUBLE=40,_e.TAG_PEDIR=41,_e.TAG_MRI_FRAME=42,_e.TAG_FIELDSTRENGTH=43;const be=__webpack_require__(4316);var Ee={};Ee.MedicalLoader=class extends z{parse(e){return this.emit("parse-start",{file:e.url,time:new Date}),new Promise(((t,n)=>{setTimeout((()=>{t(new Promise(((t,n)=>{let r=e;if(Array.isArray(r)||(r=[r]),r.forEach((e=>{this._preprocess(e)})),1===r.length)r=r[0];else{let e=r.filter(this._filterByExtension.bind(null,"MHD")),t=r.filter(this._filterByExtension.bind(null,"RAW"));2===r.length&&1===e.length&&1===t.length&&(r.url=e[0].url,r.extension=e[0].extension,r.mhdBuffer=e[0].buffer,r.rawBuffer=t[0].buffer)}let i=this._parser(r.extension);i||(this.emit("parse-error",{file:e.url,time:new Date,error:r.filename+"can not be parsed."}),n(r.filename+" can not be parsed."));let a=null;try{a=new i(r,0)}catch(t){console.warn(t),this.emit("parse-error",{file:e.url,time:new Date,error:t}),n(t)}let o=new j;o.rawHeader=a.rawHeader(),o.seriesInstanceUID=a.seriesInstanceUID(),o.transferSyntaxUID=a.transferSyntaxUID(),o.seriesDate=a.seriesDate(),o.seriesDescription=a.seriesDescription(),o.studyDate=a.studyDate(),o.studyDescription=a.studyDescription(),o.numberOfFrames=a.numberOfFrames(),o.numberOfFrames||(o.numberOfFrames=1),o.numberOfChannels=a.numberOfChannels(),o.modality=a.modality(),"SEG"===o.modality&&(o.segmentationType=a.segmentationType(),o.segmentationSegments=a.segmentationSegments()),o.patientID=a.patientID(),o.patientName=a.patientName(),o.patientAge=a.patientAge(),o.patientBirthdate=a.patientBirthdate(),o.patientSex=a.patientSex();let s=new $;s.numberOfChannels=a.numberOfChannels(),s.pixelRepresentation=a.pixelRepresentation(),s.pixelType=a.pixelType(),s.invert=a.invert(),s.spacingBetweenSlices=a.spacingBetweenSlices(),s.modality=o.modality,"SEG"===s.modality&&(s.segmentationType=o.segmentationType,s.segmentationSegments=o.segmentationSegments),o.stack.push(s),setTimeout(this.parseFrameClosure(o,s,e.url,0,a,t,n),0)})))}),10)}))}parseFrameClosure(e,t,n,r,i,a,o){return()=>{this.parseFrame(e,t,n,r,i,a,o)}}parseFrame(e,t,n,r,i,a,o){let s=new te;s.sopInstanceUID=i.sopInstanceUID(r),s.url=n,s.index=r,s.invert=t.invert,s.frameTime=i.frameTime(r),s.ultrasoundRegions=i.ultrasoundRegions(r),s.rows=i.rows(r),s.columns=i.columns(r),s.numberOfChannels=t.numberOfChannels,s.pixelPaddingValue=i.pixelPaddingValue(r),s.pixelRepresentation=t.pixelRepresentation,s.pixelType=t.pixelType,s.pixelData=i.extractPixelData(r),s.pixelSpacing=i.pixelSpacing(r),s.spacingBetweenSlices=i.spacingBetweenSlices(r),s.sliceThickness=i.sliceThickness(r),s.imageOrientation=i.imageOrientation(r),s.rightHanded=i.rightHanded(),t.rightHanded=s.rightHanded,null===s.imageOrientation&&(s.imageOrientation=[1,0,0,0,1,0]),s.imagePosition=i.imagePosition(r),s.dimensionIndexValues=i.dimensionIndexValues(r),s.bitsAllocated=i.bitsAllocated(r),s.instanceNumber=i.instanceNumber(r),s.windowCenter=i.windowCenter(r),s.windowWidth=i.windowWidth(r),s.rescaleSlope=i.rescaleSlope(r),s.rescaleIntercept=i.rescaleIntercept(r),s.minMax=i.minMaxPixelData(s.pixelData),"SEG"===e.modality&&(s.referencedSegmentNumber=i.referencedSegmentNumber(r)),t.frame.push(s),this._parsed=r+1,this._totalParsed=e.numberOfFrames,this.emit("parsing",{file:n,total:this._totalParsed,parsed:this._parsed,time:new Date}),this._parsed===this._totalParsed?(this.emit("parse-success",{file:n,total:this._totalParsed,parsed:this._parsed,time:new Date}),a(e)):setTimeout(this.parseFrameClosure(e,t,n,this._parsed,i,a,o),0)}_parser(e){let t=null;switch(e.toUpperCase()){case"NII":case"NII_":t=me;break;case"DCM":case"DIC":case"DICOM":case"IMA":case"":t=he;break;case"MHD":t=de;break;case"NRRD":t=ye;break;case"MGH":case"MGZ":t=_e;break;default:return console.warn("unsupported extension: "+e),!1}return t}_parseUrl(e){const t=new URL(e,"http://fix.me"),n={filename:t.searchParams.get("filename"),extension:"",pathname:t.pathname,query:t.search};n.filename||(n.filename=n.pathname.split("/").pop());const r=n.filename.split(".");n.extension=r.length>1?r.pop():"dicom";return(!isNaN(n.extension)||-1!==["asp","aspx","go","gs","hs","jsp","js","php","pl","py","rb","htm","html"].indexOf(n.extension)||n.query&&n.query.includes("contentType=application%2Fdicom"))&&(n.extension="dicom"),n}_preprocess(e){const t=this._parseUrl(e.url);if(e.filename=t.filename,e.extension=t.extension,e.pathname=t.pathname,e.query=t.query,"gz"===e.extension?(e.gzcompressed=!0,e.extension=e.filename.split(".gz").shift().split(".").pop()):"mgz"===e.extension?(e.gzcompressed=!0,e.extension="mgh"):"zraw"===e.extension?(e.gzcompressed=!0,e.extension="raw"):e.gzcompressed=!1,e.gzcompressed){let t=be.inflate(e.buffer);e.buffer=t.buffer}}_filterByExtension(e,t){return t.extension.toUpperCase()===e.toUpperCase()}},t.MedicalIntersects={aabbPlane:function(e,n){let r=[],i=new THREE.Matrix4;i.copy(e.toAABB).invert();let a=n.direction.clone().applyMatrix4(e.toAABB),o=new THREE.Vector3(0,0,0).applyMatrix4(e.toAABB),s=this.posdir(n.position.clone().applyMatrix4(e.toAABB),new THREE.Vector3(a.x-o.x,a.y-o.y,a.z-o.z).normalize()),l=t.MedicalUtils.bbox(e.center,e.halfDimensions),c={x:new THREE.Vector3(1,0,0),y:new THREE.Vector3(0,1,0),z:new THREE.Vector3(0,0,1)},u=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),c.x);this.rayPlaneInBBox(u,s,l,r),u.direction=c.y,this.rayPlaneInBBox(u,s,l,r),u.direction=c.z,this.rayPlaneInBBox(u,s,l,r);let h=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z+e.halfDimensions.z),c.x);this.rayPlaneInBBox(h,s,l,r),h.direction=c.y,this.rayPlaneInBBox(h,s,l,r),h.direction=c.z,this.rayPlaneInBBox(h,s,l,r);let d=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),c.y);this.rayPlaneInBBox(d,s,l,r),d.direction=c.z,this.rayPlaneInBBox(d,s,l,r);let f=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z-e.halfDimensions.z),c.x);this.rayPlaneInBBox(f,s,l,r),f.direction=c.z,this.rayPlaneInBBox(f,s,l,r);let p=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z+e.halfDimensions.z),c.x);return this.rayPlaneInBBox(p,s,l,r),p.direction=c.y,this.rayPlaneInBBox(p,s,l,r),r.map((function(e){return e.applyMatrix4(i)})),r},rayPlane:function(e,t){if(0!==e.direction.dot(t.direction)){let n=(t.direction.x*(t.position.x-e.position.x)+t.direction.y*(t.position.y-e.position.y)+t.direction.z*(t.position.z-e.position.z))/(t.direction.x*e.direction.x+t.direction.y*e.direction.y+t.direction.z*e.direction.z);return new THREE.Vector3(e.position.x+n*e.direction.x,e.position.y+n*e.direction.y,e.position.z+n*e.direction.z)}return null},rayPlaneInBBox:function(e,t,n,r){let i=this.rayPlane(e,t);i&&this.inBBox(i,n)&&(r.find(this.findIntersection(i))||r.push(i))},findIntersection:function(e){return function(t,n,r){return e.x===t.x&&e.y===t.y&&e.z===t.z}},inBBox:function(e,t){let n=1e-4;return!!(e&&e.x>=t.min.x-n&&e.y>=t.min.y-n&&e.z>=t.min.z-n&&e.x<=t.max.x+n&&e.y<=t.max.y+n&&e.z<=t.max.z+n)},posdir:function(e,t){return{position:e,direction:t}}},t.MedicalUtils={raycaster:new THREE.Raycaster,box3:new THREE.Box3,minPos:new THREE.Vector3,maxPos:new THREE.Vector3,bbox:function(e,t){if(!(t.x>=0&&t.y>=0&&t.z>=0))return window.console.log("halfDimensions must be >= 0."),window.console.log(t),!1;return{min:e.clone().sub(t),max:e.clone().add(t)}},parseUrl:function(e){const t=new URL(e,"http://fix.me"),n={filename:t.searchParams.get("filename"),extension:"",pathname:t.pathname,query:t.search};n.filename||(n.filename=n.pathname.split("/").pop());const r=n.filename.split(".");n.extension=r.length>1?r.pop():"dicom";return(!isNaN(n.extension)||-1!==["asp","aspx","go","gs","hs","jsp","js","php","pl","py","rb","htm","html"].indexOf(n.extension)||n.query&&n.query.includes("contentType=application%2Fdicom"))&&(n.extension="dicom"),n},worldToData:function(e,t){let n=(new THREE.Vector3).copy(t).applyMatrix4(e);return n.addScalar(.5).floor(),n},getPixelData:function(e,t){return t.z>=0&&t.z<e._frame.length?e._frame[t.z].getPixelData(t.x,t.y):null},setPixelData:function(e,t,n){return t.z>=0&&t.z<e._frame.length&&e._frame[t.z].setPixelData(t.x,t.y,n),null},rescaleSlopeIntercept:function(e,t,n){return e*t+n},centerOfMass:function(e){let t=new THREE.Vector3(0,0,0);for(let n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y,t.z+=e[n].z;return t.divideScalar(e.length),t},orderIntersections:function(e,t){let n,r,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=this.centerOfMass(e);a.subVectors(e[0],s).normalize(),o.crossVectors(a,t).normalize();let l=[];for(let t=0;t<e.length;t++){let c=e[t];i.subVectors(e[t],s),n=a.dot(i),r=o.dot(i),c.uv={u:n,v:r},c.angle=Math.atan2(r,n)*(180/Math.PI),l.push(c)}l.sort((function(e,t){return e.angle-t.angle}));let c=[l[0]];for(let e=1;e<l.length;e++)Math.abs(l[e-1].angle-l[e].angle)>1e-4&&c.push(l[e]);return c},getRoI:function(e,t,n){if(t.isCamera)return console.warn("warning: controls required instead of camera in getRoI()"),null;e.geometry.computeBoundingBox();const r=t.object,i=this.box3.setFromObject(e),a=this.minPos.copy(i.min).project(r),o=this.maxPos.copy(i.max).project(r),s=t.domElement.offsetWidth,l=t.domElement.offsetHeight,c=this.raycaster,u=[];a.x=Math.round((a.x+1)*s/2),a.y=Math.round((1-a.y)*l/2),o.x=Math.round((o.x+1)*s/2),o.y=Math.round((1-o.y)*l/2),[a.x,o.x]=[Math.min(a.x,o.x),Math.max(a.x,o.x)],[a.y,o.y]=[Math.min(a.y,o.y),Math.max(a.y,o.y)];let h=[],d=null,f={};for(let t=a.x;t<=o.x;t++)for(let i=a.y;i<=o.y;i++)f.x=t/s*2-1,f.y=-i/l*2+1,c.setFromCamera(f,r),h=c.intersectObject(e),0!==h.length&&(d=this.getPixelData(n,this.worldToData(n.lps2IJK,h[0].point)),null!==d&&1===n.numberOfChannels&&u.push(this.rescaleSlopeIntercept(d,n.rescaleSlope,n.rescaleIntercept)));if(0===u.length)return null;const p=u.reduce(((e,t)=>e+t))/u.length;return{min:u.reduce(((e,t)=>e<t?e:t)),max:u.reduce(((e,t)=>e>t?e:t)),mean:p,sd:Math.sqrt(u.reduce(((e,t)=>e+Math.pow(t-p,2)),0)/u.length)}},getGeometryArea:function(e){let t=0,n=new THREE.Triangle;if(e.isGeometry){if(e.faces.length<1)return 0;let r=e.vertices;e.faces.forEach((function(e){t+=n.set(r[e.a],r[e.b],r[e.c]).getArea()}))}else if(e.isBufferGeometry){let h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;if(e.index){if(e.index.count<3)return 0;for(var r,i,a,o=e.attributes.position.array,s=e.index.array,l=0,c=e.index.count;l<c;l+=3)r=s[l+0],i=s[l+1],a=s[l+2],h.set(o[3*r],o[3*r+1],o[3*r+2]),d.set(o[3*i],o[3*i+1],o[3*i+2]),f.set(o[3*a],o[3*a+1],o[3*a+2]),t+=n.set(h,d,f).getArea()}else{if(e.attributes.position.count<3)return 0;o=e.attributes.position.array;var u=3*e.attributes.position.count;for(l=0;l<u;l+=9)h.set(o[l+0],o[l+1],o[l+2]),d.set(o[l+3],o[l+4],o[l+5]),f.set(o[l+6],o[l+7],o[l+8]),t+=n.set(h,d,f).getArea()}}return t},sliceGeometry:function(e,n,r,i,a,o){void 0===a&&(a=new THREE.Matrix4);let s={halfDimensions:e,center:n,toAABB:a},l={position:r,direction:i},c=t.MedicalIntersects.aabbPlane(s,l);c.length<3&&console.log("warning: sliceGeometry has less than 3 intersections between AABB and Plane...");let u=this.orderIntersections(c,i),h=new THREE.Shape,d=[];h.moveTo(u[0].uv.u,u[0].uv.v),d.push(u[0].x,u[0].y,u[0].z);for(let e=1;e<u.length;e++)h.lineTo(u[e].uv.u,u[e].uv.v),d.push(u[e].x,u[e].y,u[e].z);h.lineTo(u[0].uv.u,u[0].uv.v);let f=new THREE.ShapeBufferGeometry(h,u.length);switch(f.attributes.position.set(d,0),o){case 0:f.attributes.uv.set([1,0,0,0,0,1,1,1],0);break;case 1:f.attributes.uv.set([0,1,0,0,1,0,1,1],0);break;case 2:default:f.attributes.uv.set([1,0,0,0,0,1,1,1],0)}return f}},t.MedicalVoxel=function(){this.id=-1,this.worldCoordinates=null,this.dataCoordinates=null,this.screenCoordinates=null,this.value=null};class we extends THREE.Mesh{constructor(e,t,n,r,i){t=t||0,n=n||new THREE.Vector3(0,0,0),r=r||new THREE.Vector3(0,0,1),i=i||"IJK",super(),this.name="sliceMesh",this._stack=e,this._halfDimensions=null,this._spacing=1,this._thickness=0,this._thicknessMethod=0,this._opacity=1,this._invert=this._stack.invert,this._lut=!1,this._interpolation=1,this._windowWidth=null,this._windowCenter=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._lowerThreshold=null,this._upperThreshold=null,this._lutTexture=null,this._intensityAuto=!0,this._index=t,this._planePosition=n,this._planeDirection=r,this._center=new THREE.Vector3,this._aabbSpace=i,this._canvasWidth=0,this._canvasHeight=0,this._uniforms=null,this._init(),this._create()}_init(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aabbSpace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center.set(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new THREE.Matrix4;else{let e=this._stack.AABBox();this._halfDimensions=e.clone().multiplyScalar(.5),this._center.copy(this._stack.centerAABBox()),this._toAABB=this._stack.lps2AABB}}_create(){this._stack&&this._stack.prepared&&this._stack.packed&&(this._createGeometry(),this._createMaterial(),this.getIntensityFactors(),this.updateIntensityFactorsUniforms(),"IJK"===this._aabbSpace&&(this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1),this.matrixAutoUpdate=!0,this.applyMatrix4(this._stack.ijk2LPS)))}_createGeometry(){this.geometry=t.MedicalUtils.sliceGeometry(this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB,this.parent?this.parent.orientation:null);let e=this.parent;e&&e._updateSliceBorder()}_createMaterial(){this.material.isShaderMaterial||(this._uniforms=THREE.UniformsUtils.clone(t.MedicalSliceShader.uniforms),this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uSpacing.value=this._spacing,this._uniforms.uThickness.value=this._thickness,this._uniforms.uThicknessMethod.value=this._thicknessMethod,this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._stack._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._createShaderMaterial({side:THREE.DoubleSide,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}))}_createShaderMaterial(e){let n=t.MedicalSliceShader,r={},i=this._uniforms.uTextureContainer.value.length;if(r.MAX_TEX3D_IMAGES=i>7?14:7,1===this._uniforms.uNumberOfChannels.value){let e=this._uniforms.uBitsAllocated.value.toString(),t=this._uniforms.uPixelType.value.toString();e="1"===e||"8"===e?"BITS_ALLOCATED_8":"16"===e?"BITS_ALLOCATED_16":"32"===e&&"0"===t?"BITS_ALLOCATED_32":"32"===e&&"0"!==t?"BITS_ALLOCATED_32F":"BITS_ALLOCATED_IDENTITY",r[e]=""}let a={defines:r,uniforms:this._uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader},o=Object.assign(e,a);this.material=new THREE.ShaderMaterial(o),this._uniforms=this.material.uniforms}getIntensityFactor(e){this["_"+e]=this._stack[e],this._intensityAuto&&this._stack.frame[this._index]&&this._stack.frame[this._index][e]&&(this["_"+e]=this._stack.frame[this._index][e])}getIntensityFactors(){this.getIntensityFactor("windowCenter"),this.getIntensityFactor("windowWidth"),this.getIntensityFactor("rescaleSlope"),this.getIntensityFactor("rescaleIntercept"),null===this._upperThreshold&&(this._upperThreshold=this._stack._minMax[1]),null===this._lowerThreshold&&(this._lowerThreshold=this._stack._minMax[0])}updateIntensityFactorsUniforms(){let e=Math.abs(this._stack._minMax[0]);this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[e+this._windowCenter,this._windowWidth],this._uniforms.uLowerUpperThreshold.value=[e+this._lowerThreshold,e+this._upperThreshold]}_update(){this.geometry.dispose(),this._create()}dispose(){var e;this.material.uniforms.uTextureContainer.value.forEach((e=>{e.dispose()})),(e=this.material.uniforms.uTextureLUT.value)&&(e.dispose(),this._lutTexture=null),(e=this.material.uniforms.uTextureLUTSegmentation.value)&&e.dispose(),this.geometry.dispose(),this.material.dispose(),this._uniforms=null,this._stack=null}cartesianEquation(){if(!this._geometry||!this._geometry.attributes||!this._geometry.attributes.position||this._geometry.attributes.position.count<3)return new THREE.Vector4;let e=this._geometry.attributes.position.array,t=this._stack.ijk2LPS,n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3;n.fromArray(e,0).applyMatrix4(t),r.fromArray(e,3).applyMatrix4(t),i.fromArray(e,6).applyMatrix4(t);let s=a.subVectors(i,r).cross(o.subVectors(n,r)).normalize();return new THREE.Vector4(s.x,s.y,s.z,-s.dot(n))}}we.prototype.isSliceMesh=!0,t.SliceMesh=we,Object.defineProperties(we.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},spacing:{get:function(){return this._spacing},set:function(e){this._spacing=e,this._uniforms.uSpacing.value=this._spacing}},thickness:{get:function(){return this._thickness},set:function(e){this._thickness=e,this._uniforms.uThickness.value=this._thickness}},thicknessMethod:{get:function(){return this._thicknessMethod},set:function(e){this._thicknessMethod=e,this._uniforms.uThicknessMethod.value=this._thicknessMethod}},opacity:{get:function(){return this._opacity},set:function(e){this._opacity=e,this._uniforms.uOpacity.value=this._opacity}},invert:{get:function(){return this._invert},set:function(e){this._invert=e,this._uniforms.uInvert.value=!0===this._invert?1:0}},lut:{get:function(){return this._lut},set:function(e){this._lut=e,!1===this._lut?this._uniforms.uLut.value=0:this._uniforms.uLut.value=1}},lutTexture:{get:function(){return this._lutTexture},set:function(e){this._uniforms.uTextureLUT.value&&this._uniforms.uTextureLUT.value.dispose(),this._lutTexture=e,this._uniforms.uTextureLUT.value=this._lutTexture}},interpolation:{get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation}},windowWidth:{get:function(){return this._windowWidth},set:function(e){this._windowWidth=e,this.updateIntensityFactorsUniforms()}},windowCenter:{get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this.updateIntensityFactorsUniforms()}},rescaleSlope:{get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e,this.updateIntensityFactorsUniforms()}},rescaleIntercept:{get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e,this.updateIntensityFactorsUniforms()}},upperThreshold:{get:function(){return this._upperThreshold},set:function(e){this._upperThreshold=e,this.updateIntensityFactorsUniforms()}},lowerThreshold:{get:function(){return this._lowerThreshold},set:function(e){this._lowerThreshold=e,this.updateIntensityFactorsUniforms()}},intensityAuto:{get:function(){return this._intensityAuto},set:function(e){this._intensityAuto=e,this.getIntensityFactors(),this.updateIntensityFactorsUniforms()}},index:{get:function(){return this._index},set:function(e){this._index!==e&&(this._index=e,this._update())}},planePosition:{get:function(){return this._planePosition},set:function(e){this._planePosition.equals(e)||(this._planePosition.copy(e),this._update())}},planeDirection:{get:function(){return this._planeDirection},set:function(e){this._planeDirection.equals(e)||(this._planeDirection.copy(e),this._update())}},center:{get:function(){return this._center},set:function(e){this._center=e}},aabbSpace:{get:function(){return this._aabbSpace},set:function(e){this._aabbSpace=e,this._init()}},canvasWidth:{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._uniforms.uCanvasWidth.value=this._canvasWidth}},canvasHeight:{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._uniforms.uCanvasHeight.value=this._canvasHeight}}});class xe extends THREE.Object3D{constructor(e){super(),this.name="medicalSlicer",this._stack=e,this._bBox=null,this._slice=null,this._border=null,this._orientation=2,this._index=0,this._autoWindowLevel=!1,this._outOfBounds=!1,this._orientationMaxIndex=0,this._orientationSpacing=0,this._canvasWidth=0,this._canvasHeight=0,this._create()}_create(){this._prepareStack(),this._createStackBBox(),this._createSliceMesh(),this._createSliceBorder(),this._computeOrientationMaxIndex(),this._computeOrientationSpacing()}_computeOrientationSpacing(){let e=this._stack._spacing;switch(this._orientation){case 0:this._orientationSpacing=e.y;break;case 1:this._orientationSpacing=e.x;break;case 2:this._orientationSpacing=e.z;break;default:this._orientationSpacing=0}}_computeOrientationMaxIndex(){let e=this._stack.dimensionsIJK;switch(this._orientation){case 0:this._orientationMaxIndex=e.x-1;break;case 1:this._orientationMaxIndex=e.y-1;break;case 2:this._orientationMaxIndex=e.z-1;break;default:this._orientationMaxIndex=0}}_computeIndexOutOfBounds(){this._computeOrientationMaxIndex(),this._outOfBounds=this._index>=this._orientationMaxIndex||this._index<0}_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}_createStackBBox(){this._bBox=function(e,t){var n=e.dimensionsIJK,r=e.halfDimensionsIJK,i=new THREE.Vector3(-.5,-.5,-.5),a=new THREE.BoxBufferGeometry(n.x,n.y,n.z);a.applyMatrix4((new THREE.Matrix4).makeTranslation(r.x+i.x,r.y+i.y,r.z+i.z));var o=new THREE.Mesh(a,null);o.applyMatrix4(e.ijk2LPS);var s=new THREE.BoxHelper(o,t||16777215);return s.update=function(e){void 0===e&&THREE.BoxHelper.prototype.update.call(this)},s}(this._stack),this.add(this._bBox)}_createSliceMesh(){this._index=this._getSliceIndex(.5);let e=this._getSlicePosition(),n=this._getSliceDirection();this._slice=new t.SliceMesh(this._stack,this._index,e,n),this.add(this._slice)}_getSlicePixels(){var e=this._stack,t=e._frame;let n,r,i=e.dimensionsIJK,a=i.x,o=i.y,s=i.z,l=e.bitsAllocated*e.numberOfChannels/8;switch(this._orientation){case 2:n=a,r=o;break;case 1:n=a,r=s;break;case 0:n=o,r=s}let c=0;return e._minMax[0]<0&&(c-=e._minMax[0]),{data:t[this._index].pixelData,offset:c,width:n,height:r,components:l}}_createSliceTexture(){let e,t=this._getSlicePixels();switch(t.components){case 1:e=THREE.LuminanceFormat;break;case 2:e=THREE.LuminanceAlphaFormat;break;case 3:e=THREE.RGBFormat;break;case 4:e=THREE.RGBAFormat}let n=new THREE.DataTexture(new Uint8Array(t.data),t.width,t.height,e,THREE.UnsignedByteType);return n.needsUpdate=!0,n}_createSliceBorder(){var e,t,n,r;this._border=(e=this._slice,n=new THREE.LineBasicMaterial({color:t||16711680,linewidth:1}),r=new THREE.Line(e.geometry,n),"IJK"===e.aabbSpace&&r.applyMatrix4(e.stack.ijk2LPS),r),this.add(this._border)}_updateSliceBorder(){if("IJK"===this._slice.aabbSpace){let e=this._border;e.geometry=this._slice.geometry,e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.matrixAutoUpdate=!0,e.applyMatrix4(this._slice.stack.ijk2LPS)}}dispose(){var e=this._bBox,t=this._border,n=this._slice;this.remove(e),this.remove(t),this.remove(n),e.geometry.dispose(),e.material.dispose(),e.object.geometry.dispose(),e.object.material=null,t.material.dispose(),t.geometry=null,n.dispose(),this._bBox=null,this._border=null,this._slice=null,this._stack=null}_getSliceIndex(e){e=void 0!==e?e:.5;let t=this._stack.dimensionsIJK,n=0;switch(this._orientation){case 0:n=Math.floor(t.x*e);break;case 1:n=Math.floor(t.y*e);break;case 2:n=Math.floor(t.z*e)}return n}_getSlicePosition(){let e=this._stack.halfDimensionsIJK,t=new THREE.Vector3(0,0,0);switch(this._orientation){case 0:t.set(this._index,Math.floor(e.y),Math.floor(e.z));break;case 1:t.set(Math.floor(e.x),this._index,Math.floor(e.z));break;case 2:t.set(Math.floor(e.x),Math.floor(e.y),this._index)}return t}_getSliceDirection(){let e=new THREE.Vector3(0,0,1);switch(this._orientation){case 0:e.set(1,0,0);break;case 1:e.set(0,1,0);break;case 2:e.set(0,0,1)}return e}}xe.prototype.isMedicalSlicer=!0,t.MedicalSlicer=xe,Object.defineProperties(xe.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},bbox:{get:function(){return this._bBox}},slice:{get:function(){return this._slice}},border:{get:function(){return this._border}},index:{get:function(){return this._index},set:function(e){this._index!==e&&(this._index=e,this._slice._index=e,this._slice.planePosition=this._getSlicePosition(),this._computeIndexOutOfBounds())}},orientation:{get:function(){return this._orientation},set:function(e){this._orientation!==e&&(this._orientation=e,this._index=this._getSliceIndex(.5),this._computeOrientationMaxIndex(),this._computeOrientationSpacing(),this._slice.spacing=Math.abs(this._orientationSpacing),this._slice.thickness=this._slice.spacing,this._slice.planeDirection=this._getSliceDirection())}},outOfBounds:{get:function(){return this._outOfBounds},set:function(e){this._outOfBounds=e}},orientationMaxIndex:{get:function(){return this._orientationMaxIndex},set:function(e){this._orientationMaxIndex=e}},orientationSpacing:{get:function(){return this._orientationSpacing},set:function(e){this._orientationSpacing=e}},canvasWidth:{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._slice.canvasWidth=this._canvasWidth}},canvasHeight:{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._slice.canvasHeight=this._canvasHeight}},bboxColor:{get:function(){return this._bBox.material.color},set:function(e){this._bBox.material.color=new THREE.Color(e)}},borderColor:{get:function(){return this._border.material.color},set:function(e){this._border.material.color=new THREE.Color(e)}}});class Te extends THREE.Mesh{constructor(e){super(),this.name="medicalVolume",this._stack=e,this._uniforms=null,this._algorithm=0,this._alphaCorrection=.5,this._interpolation=1,this._shading=1,this._shininess=10,this._steps=256,this._offset=0,this._windowCenter=0,this._windowWidth=1,this._create()}_create(){this._prepareStack(),this._createGeometry(),this._createMaterial()}_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack(),this._offset=Math.min(0,this._stack._minMax[0]),this._windowCenter=this._stack.windowCenter,this._windowWidth=.8*this._stack.windowWidth}_createGeometry(){let e=this._stack.worldBoundingBox(),t=this._stack.worldCenter();this.geometry=new THREE.BoxBufferGeometry(e[1]-e[0],e[3]-e[2],e[5]-e[4]).translate(t.x,t.y,t.z)}_createMaterial(){this.material.isShaderMaterial||(this._uniforms=THREE.UniformsUtils.clone(t.MedicalVolumeShader.uniforms),this._uniforms.uWorldBBox.value=this._stack.worldBoundingBox(),this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._stack._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uDataToWorld.value=(new THREE.Matrix4).copy(this._stack.lps2IJK).invert(),this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uWindowCenterWidth.value=[this._windowCenter-this._offset,this._windowWidth],this._uniforms.uRescaleSlopeIntercept.value=[this._stack.rescaleSlope,this._stack.rescaleIntercept],this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uAlphaCorrection.value=this._alphaCorrection,this._uniforms.uInterpolation.value=this._interpolation,this._uniforms.uShading.value=this._shading,this._uniforms.uShininess.value=this._shininess,this._uniforms.uSteps.value=this._steps,this._uniforms.uAlgorithm.value=this._algorithm,this._createShaderMaterial({side:THREE.BackSide,transparent:!0}))}_createShaderMaterial(e){let n=t.MedicalVolumeShader,r={};t.isWebGL1()&&(r.gl_FragDepth="gl_FragDepthEXT");let i=this._uniforms.uTextureContainer.value.length;if(r.MAX_TEX3D_IMAGES=i>7?14:7,1===this._uniforms.uNumberOfChannels.value){let e=this._uniforms.uBitsAllocated.value.toString(),t=this._uniforms.uPixelType.value.toString();e="1"===e||"8"===e?"BITS_ALLOCATED_8":"16"===e?"BITS_ALLOCATED_16":"32"===e&&"0"===t?"BITS_ALLOCATED_32":"32"===e&&"0"!==t?"BITS_ALLOCATED_32F":"BITS_ALLOCATED_IDENTITY",r[e]=""}let a={defines:r,uniforms:this._uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader},o=Object.assign(e,a);this.material=new THREE.ShaderMaterial(o),this.material.extensions={fragDepth:!0},this._uniforms=this.material.uniforms}_update(){this.geometry.dispose(),this._create()}_getVolumeVoxels(){var e=this._stack,t=e._frame;let n=e.dimensionsIJK,r=n.x,i=n.y,a=n.z,o=e.bitsAllocated*e.numberOfChannels/8,s=0;return e._minMax[0]<0&&(s-=e._minMax[0]),{data:t,offset:s,width:r,height:i,depth:a,components:o}}dispose(){this.material.uniforms.uTextureContainer.value.forEach((e=>{e.dispose()}));var e=this.material.uniforms.uTextureLUT.value;e&&(e.dispose(),this._lutTexture=null),this.geometry.dispose(),this.material.dispose(),this._uniforms=null,this._stack=null}}Te.prototype.isMedicalVolume=!0,t.MedicalVolume=Te,Object.defineProperties(Te.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},uniforms:{get:function(){return this._uniforms},set:function(e){this._uniforms=e}},windowWidth:{get:function(){return this._windowWidth},set:function(e){this._windowWidth=Math.max(1,e),this._uniforms.uWindowCenterWidth.value[1]=this._windowWidth}},windowCenter:{get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this._uniforms.uWindowCenterWidth.value[0]=this._windowCenter-this._offset}},rescaleSlope:{get:function(){return this._uniforms.uRescaleSlopeIntercept.value[0]},set:function(e){this._uniforms.uRescaleSlopeIntercept.value[0]=e}},rescaleIntercept:{get:function(){return this._uniforms.uRescaleSlopeIntercept.value[1]},set:function(e){this._uniforms.uRescaleSlopeIntercept.value[1]=e}},steps:{get:function(){return this._steps},set:function(e){this._steps=e,this._uniforms.uSteps.value=this._steps}},alphaCorrection:{get:function(){return this._alphaCorrection},set:function(e){this._alphaCorrection=e,this._uniforms.uAlphaCorrection.value=this._alphaCorrection}},interpolation:{get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation}},shading:{get:function(){return this._shading},set:function(e){this._shading=e,this._uniforms.uShading.value=this._shading}},shininess:{get:function(){return this._shininess},set:function(e){this._shininess=e,this._uniforms.uShininess.value=this._shininess}},algorithm:{get:function(){return this._algorithm},set:function(e){this._algorithm=e,this._uniforms.uAlgorithm.value=this._algorithm}},lut:{get:function(){return this._lut},set:function(e){this._uniforms.uLut.value=!1===e?0:1}},lutTexture:{get:function(){return this._uniforms.uTextureLUT.value},set:function(e){this._uniforms.uTextureLUT.value&&this._uniforms.uTextureLUT.value.dispose(),this._uniforms.uTextureLUT.value=e}}});class Ae extends THREE.Mesh{constructor(e,t,n,r){t=t||32,n=n||0,r=r||"IJK",super(),this.name="medicalIsosurface",this._stack=e,this._isoLevel=t,this._maxResolution=256,this._volumeData=[],this._smoothing=n,this._aabbSpace=r,this._create()}_create(){this._prepareStack(),this._createGeometry(),this._createMaterial(),"IJK"===this._aabbSpace&&(this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1),this.matrixAutoUpdate=!0,this.applyMatrix4(this._stack.ijk2LPS))}_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}_createGeometry(){var e=this,n=this._isoLevel,r=this._smoothing,i=this._stack.dimensionsIJK,a=i.x,o=i.y,s=i.z,l=Math.max(1,~~(Math.max(a,o,s)/this._maxResolution+.5)),c=1+~~((a-1)/l),u=1+~~((o-1)/l),h=1+~~((s-1)/l),d=[c,u,h],f=[[0,0,0],[a-(a-1)%l,o-(o-1)%l,s-(s-1)%l]];if(0===this._volumeData.length)for(var p=this._stack.frame,m=this._volumeData,g=0;g<s;g+=l)for(var v=0;v<o;v+=l)for(var y=a*v,_=0;_<a;_+=l)m.push(p[g].pixelData[y+_]);t.createSpincircle(),setTimeout((function(){if(0===r)var i=e._volumeData;else{var a=(0,w.ndarray)(e._volumeData.clone(),[c,u,h],[1,c,c*u]),o=5*r;i=w.gaussBlur(a,o).data}e.geometry=new t.IsosurfaceGeometry(d,f,i,n),t.hideSpincircle()}),500)}_createMaterial(){if(!this.material.isMeshMatcapMaterial){t.appWorks.renderer.localClippingEnabled=!0;let n=this._stack.worldCenter(),r=this._stack.worldBoundingBox(),i=[(r[1]-r[0])/2,(r[3]-r[2])/2,(r[5]-r[4])/2],a=[new THREE.Plane(new THREE.Vector3(1,0,0),i[0]).translate(n),new THREE.Plane(new THREE.Vector3(-1,0,0),i[0]).translate(n),new THREE.Plane(new THREE.Vector3(0,1,0),i[1]).translate(n),new THREE.Plane(new THREE.Vector3(0,-1,0),i[1]).translate(n),new THREE.Plane(new THREE.Vector3(0,0,1),i[2]).translate(n),new THREE.Plane(new THREE.Vector3(0,0,-1),i[2]).translate(n)];var e=new THREE.TextureLoader;this.material=new THREE.MeshMatcapMaterial({color:16777215,matcap:e.load("images/matcaps2/00086.png"),side:THREE.DoubleSide,opacity:.8,transparent:!0,clippingPlanes:a,clipIntersection:!1})}}updateClippingPlane(e,t){(e>=0||e<6)&&(this.material.clippingPlanes[e].constant=t)}_update(){this.geometry.dispose(),this._create()}dispose(){this.geometry.dispose(),this.material.dispose(),this._stack=null}}Ae.prototype.isMedicalIsosurface=!0,t.MedicalIsosurface=Ae,Object.defineProperties(Ae.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},isoLevel:{get:function(){return this._isoLevel},set:function(e){this._isoLevel!==e&&(this._isoLevel=e,this._update())}},smoothing:{get:function(){return this._smoothing},set:function(e){this._smoothing!==e&&(this._smoothing=e,this._update())}}});class Me extends THREE.Object3D{constructor(e,n,r,i,a,o){super(),this.name="lookupTable",this._dom=void 0===e?document.createElement("div"):"string"==typeof e?document.getElementById(e):e,this._lut=n||"grayscale",this._color=i||[[0,0,0,0],[1,1,1,1]],this._lutO=r||"linear",this._opacity=a||[[0,0],[1,1]],this._discrete=o||!1,this._presetLuts=t.LookupTable.presetLuts(),this._presetLutsO=t.LookupTable.presetLutsO(),this._canvasBg=null,this._canvas=null,this.initCanvas(),this.paintCanvas()}initCanvas(){let e=document.createElement("div");e.style.cssText="position: relative; height: 16px; width: 256px; border: 1px solid #f9f9f9;",this._canvas=this.createCanvas(),this._canvas.style.cssText="position: absolute;",e.appendChild(this._canvas),this._dom.appendChild(e)}createCanvas(){let e=document.createElement("canvas");return e.width=256,e.height=16,e.style.width="256px",e.style.height="16px",e}paintCanvas(){let e=this._canvas.getContext("2d");if(e.clearRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="source-over",this._discrete){e.lineWidth=2*this._canvas.height;for(let t=0;t<this._color.length;t++){let n=this._color[t][0],r=t<this._color.length-1?this._color[t+1][0]:1,i=t>0?this._color[t-1][0]:0,a=i+(n-i)/2,o=n+(r-n)/2,s=this._color[t],l=this._opacity[t]?this._opacity[t][1]:1;e.beginPath(),e.strokeStyle=`rgba( ${Math.round(255*s[1])}, ${Math.round(255*s[2])}, ${Math.round(255*s[3])}, ${l})`,e.moveTo(a*this._canvas.width,0),e.lineTo(o*this._canvas.width,0),e.stroke(),e.closePath()}}else{if(!this._color||!this._opacity)return;let t=e.createLinearGradient(0,0,this._canvas.width,0);for(let e=0;e<this._color.length;e++)t.addColorStop(this._color[e][0],`rgba( ${Math.round(255*this._color[e][1])}, ${Math.round(255*this._color[e][2])}, ${Math.round(255*this._color[e][3])}, 1)`);e.fillStyle=t,e.fillRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="destination-in";let n=e.createLinearGradient(0,0,this._canvas.width,0);for(let e=0;e<this._opacity.length;e++)n.addColorStop(this._opacity[e][0],"rgba(255, 255, 255, "+this._opacity[e][1]+")");e.fillStyle=n,e.fillRect(0,0,this._canvas.width,this._canvas.height)}}lutsAvailable(e){let t="color"===(e=e||"color")?this._presetLuts:this._presetLutsO;return Object.keys(t)}}Me.prototype.isLookupTables=!0,t.LookupTable=Me,Object.defineProperties(Me.prototype,{texture:{get:function(){let e=new THREE.CanvasTexture(this._canvas);return e.mapping=THREE.UVMapping,e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=e.minFilter=THREE.NearestFilter,e.premultiplyAlpha=!0,e.needsUpdate=!0,e}},lut:{get:function(){return this._lut},set:function(e){this._lut!==e&&(this._lut=e,this._color=this._presetLuts[e],this.paintCanvas())}},presetLuts:{get:function(){return this._presetLuts},set:function(e){this._presetLuts=e}},lutO:{get:function(){return this._lutO},set:function(e){this._lutO!==e&&(this._lutO=e,this._opacity=this._presetLutsO[e],this.paintCanvas())}},presetLutsO:{get:function(){return this._presetLutsO},set:function(e){this._presetLutsO=e}},discrete:{get:function(){return this._discrete},set:function(e){this._discrete!==e&&(this._discrete=e,this.paintCanvas())}}}),Me.presetLuts=function(){return{grayscale:[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]],red_to_green:[[0,1,0,0],[1,0,1,0]],blue_to_green:[[0,0,0,1],[1,0,1,0]],red_to_white:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]],green_to_white:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]],blue_to_white:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]],walking_dead:[[0,.1,1,1],[1,1,1,1]],random:[[0,0,0,0],[.27,.18,.18,.18],[.41,1,1,1],[.7,1,0,0],[1,1,1,1]],fire:[[0,0,0,0],[.06,0,0,.36],[.16,.29,0,.75],[.22,.48,0,.89],[.31,.68,0,.6],[.37,.76,0,.36],[.5,.94,.31,0],[.56,1,.45,0],[.81,1,.91,0],[.88,1,1,.38],[1,1,1,1]],muscle_bone:[[0,0,0,0],[.00392156862745098,.00784313725490196,0,0],[.00784313725490196,.0196078431372549,0,0],[.011764705882352941,.03137254901960784,0,0],[.01568627450980392,.0392156862745098,0,.00392156862745098],[.0196078431372549,.050980392156862744,.00392156862745098,.00392156862745098],[.023529411764705882,.06274509803921569,.00392156862745098,.00392156862745098],[.027450980392156862,.07058823529411765,.00392156862745098,.00784313725490196],[.03137254901960784,.08235294117647059,.00392156862745098,.00784313725490196],[.03529411764705882,.09411764705882353,.00784313725490196,.00784313725490196],[.0392156862745098,.10196078431372549,.00784313725490196,.00784313725490196],[.043137254901960784,.11372549019607843,.00784313725490196,.011764705882352941],[.047058823529411764,.12549019607843137,.00784313725490196,.011764705882352941],[.050980392156862744,.13333333333333333,.011764705882352941,.011764705882352941],[.054901960784313725,.1450980392156863,.011764705882352941,.01568627450980392],[.058823529411764705,.1568627450980392,.011764705882352941,.01568627450980392],[.06274509803921569,.16470588235294117,.011764705882352941,.01568627450980392],[.06666666666666667,.17647058823529413,.011764705882352941,.0196078431372549],[.07058823529411765,.18823529411764706,.01568627450980392,.0196078431372549],[.07450980392156863,.2,.01568627450980392,.0196078431372549],[.0784313725490196,.20784313725490197,.01568627450980392,.0196078431372549],[.08235294117647059,.2196078431372549,.01568627450980392,.023529411764705882],[.08627450980392157,.23137254901960785,.0196078431372549,.023529411764705882],[.09019607843137255,.23921568627450981,.0196078431372549,.023529411764705882],[.09411764705882353,.25098039215686274,.0196078431372549,.027450980392156862],[.09803921568627451,.2627450980392157,.0196078431372549,.027450980392156862],[.10196078431372549,.27058823529411763,.023529411764705882,.027450980392156862],[.10588235294117647,.2823529411764706,.023529411764705882,.027450980392156862],[.10980392156862745,.29411764705882354,.023529411764705882,.03137254901960784],[.11372549019607843,.30196078431372547,.023529411764705882,.03137254901960784],[.11764705882352941,.3137254901960784,.023529411764705882,.03137254901960784],[.12156862745098039,.3254901960784314,.027450980392156862,.03529411764705882],[.12549019607843137,.3333333333333333,.027450980392156862,.03529411764705882],[.12941176470588237,.34509803921568627,.027450980392156862,.03529411764705882],[.13333333333333333,.3568627450980392,.027450980392156862,.0392156862745098],[.13725490196078433,.36470588235294116,.03137254901960784,.0392156862745098],[.1411764705882353,.3764705882352941,.03137254901960784,.0392156862745098],[.1450980392156863,.38823529411764707,.03137254901960784,.0392156862745098],[.14901960784313725,.4,.03137254901960784,.043137254901960784],[.15294117647058825,.40784313725490196,.03529411764705882,.043137254901960784],[.1568627450980392,.4196078431372549,.03529411764705882,.043137254901960784],[.1607843137254902,.43137254901960786,.03529411764705882,.047058823529411764],[.16470588235294117,.4392156862745098,.03529411764705882,.047058823529411764],[.16862745098039217,.45098039215686275,.03529411764705882,.047058823529411764],[.17254901960784313,.4627450980392157,.0392156862745098,.047058823529411764],[.17647058823529413,.47058823529411764,.0392156862745098,.050980392156862744],[.1803921568627451,.4823529411764706,.0392156862745098,.050980392156862744],[.1843137254901961,.49411764705882355,.0392156862745098,.050980392156862744],[.18823529411764706,.5019607843137255,.043137254901960784,.054901960784313725],[.19215686274509805,.5137254901960784,.043137254901960784,.054901960784313725],[.19607843137254902,.5254901960784314,.043137254901960784,.054901960784313725],[.2,.5333333333333333,.043137254901960784,.058823529411764705],[.20392156862745098,.5450980392156862,.047058823529411764,.058823529411764705],[.20784313725490197,.5568627450980392,.047058823529411764,.058823529411764705],[.21176470588235294,.5647058823529412,.047058823529411764,.058823529411764705],[.21568627450980393,.5764705882352941,.047058823529411764,.06274509803921569],[.2196078431372549,.5882352941176471,.047058823529411764,.06274509803921569],[.2235294117647059,.6,.050980392156862744,.06274509803921569],[.22745098039215686,.6078431372549019,.050980392156862744,.06666666666666667],[.23137254901960785,.6196078431372549,.050980392156862744,.06666666666666667],[.23529411764705882,.6313725490196078,.050980392156862744,.06666666666666667],[.23921568627450981,.6392156862745098,.054901960784313725,.06666666666666667],[.24313725490196078,.6509803921568628,.054901960784313725,.07058823529411765],[.24705882352941178,.6627450980392157,.054901960784313725,.07058823529411765],[.25098039215686274,.6705882352941176,.054901960784313725,.07058823529411765],[.2549019607843137,.6823529411764706,.058823529411764705,.07450980392156863],[.25882352941176473,.6941176470588235,.058823529411764705,.07450980392156863],[.2627450980392157,.7019607843137254,.058823529411764705,.07450980392156863],[.26666666666666666,.7137254901960784,.058823529411764705,.0784313725490196],[.27058823529411763,.7254901960784313,.058823529411764705,.0784313725490196],[.27450980392156865,.7333333333333333,.06274509803921569,.0784313725490196],[.2784313725490196,.7450980392156863,.06274509803921569,.0784313725490196],[.2823529411764706,.7568627450980392,.06274509803921569,.08235294117647059],[.28627450980392155,.7647058823529411,.06274509803921569,.08235294117647059],[.2901960784313726,.7764705882352941,.06666666666666667,.08235294117647059],[.29411764705882354,.788235294117647,.06666666666666667,.08627450980392157],[.2980392156862745,.8,.06666666666666667,.08627450980392157],[.30196078431372547,.807843137254902,.06666666666666667,.08627450980392157],[.3058823529411765,.8196078431372549,.07058823529411765,.08627450980392157],[.30980392156862746,.8313725490196079,.07058823529411765,.09019607843137255],[.3137254901960784,.8392156862745098,.07058823529411765,.09019607843137255],[.3176470588235294,.8509803921568627,.07058823529411765,.09019607843137255],[.3215686274509804,.8627450980392157,.07058823529411765,.09411764705882353],[.3254901960784314,.8705882352941177,.07450980392156863,.09411764705882353],[.32941176470588235,.8823529411764706,.07450980392156863,.09411764705882353],[.3333333333333333,.8941176470588236,.07450980392156863,.09803921568627451],[.33725490196078434,.9019607843137255,.07450980392156863,.09803921568627451],[.3411764705882353,.9137254901960784,.0784313725490196,.09803921568627451],[.34509803921568627,.9254901960784314,.0784313725490196,.09803921568627451],[.34901960784313724,.9333333333333333,.0784313725490196,.10196078431372549],[.35294117647058826,.9450980392156862,.0784313725490196,.10196078431372549],[.3568627450980392,.9568627450980393,.08235294117647059,.10196078431372549],[.3607843137254902,.9647058823529412,.08235294117647059,.10588235294117647],[.36470588235294116,.9764705882352941,.08235294117647059,.10588235294117647],[.3686274509803922,.9882352941176471,.08235294117647059,.10588235294117647],[.37254901960784315,1,.08235294117647059,.10588235294117647],[.3764705882352941,1,.09411764705882353,.10588235294117647],[.3803921568627451,1,.10588235294117647,.10588235294117647],[.3843137254901961,1,.11764705882352941,.10196078431372549],[.38823529411764707,1,.12941176470588237,.10196078431372549],[.39215686274509803,1,.1411764705882353,.10196078431372549],[.396078431372549,1,.15294117647058825,.09803921568627451],[.4,1,.16470588235294117,.09803921568627451],[.403921568627451,1,.17647058823529413,.09803921568627451],[.40784313725490196,1,.18823529411764706,.09411764705882353],[.4117647058823529,1,.2,.09411764705882353],[.41568627450980394,1,.21176470588235294,.09411764705882353],[.4196078431372549,1,.2235294117647059,.09019607843137255],[.4235294117647059,1,.23529411764705882,.09019607843137255],[.42745098039215684,1,.24705882352941178,.08627450980392157],[.43137254901960786,1,.25882352941176473,.08627450980392157],[.43529411764705883,1,.27058823529411763,.08627450980392157],[.4392156862745098,1,.2823529411764706,.08235294117647059],[.44313725490196076,1,.29411764705882354,.08235294117647059],[.4470588235294118,1,.3058823529411765,.08235294117647059],[.45098039215686275,1,.3176470588235294,.0784313725490196],[.4549019607843137,1,.32941176470588235,.0784313725490196],[.4588235294117647,1,.3411764705882353,.0784313725490196],[.4627450980392157,1,.35294117647058826,.07450980392156863],[.4666666666666667,1,.36470588235294116,.07450980392156863],[.47058823529411764,1,.3764705882352941,.07450980392156863],[.4745098039215686,1,.38823529411764707,.07058823529411765],[.47843137254901963,1,.4,.07058823529411765],[.4823529411764706,1,.4117647058823529,.07058823529411765],[.48627450980392156,1,.4235294117647059,.06666666666666667],[.49019607843137253,1,.43529411764705883,.06666666666666667],[.49411764705882355,1,.4470588235294118,.06274509803921569],[.4980392156862745,1,.4588235294117647,.06274509803921569],[.5019607843137255,1,.47058823529411764,.06274509803921569],[.5058823529411764,1,.4823529411764706,.058823529411764705],[.5098039215686274,1,.49411764705882355,.058823529411764705],[.5137254901960784,1,.5058823529411764,.058823529411764705],[.5176470588235295,1,.5137254901960784,.054901960784313725],[.5215686274509804,1,.5254901960784314,.054901960784313725],[.5254901960784314,1,.5372549019607843,.054901960784313725],[.5294117647058824,1,.5490196078431373,.050980392156862744],[.5333333333333333,1,.5607843137254902,.050980392156862744],[.5372549019607843,1,.5725490196078431,.050980392156862744],[.5411764705882353,1,.5843137254901961,.047058823529411764],[.5450980392156862,1,.596078431372549,.047058823529411764],[.5490196078431373,1,.6078431372549019,.043137254901960784],[.5529411764705883,1,.6196078431372549,.043137254901960784],[.5568627450980392,1,.6313725490196078,.043137254901960784],[.5607843137254902,1,.6431372549019608,.0392156862745098],[.5647058823529412,1,.6549019607843137,.0392156862745098],[.5686274509803921,1,.6666666666666666,.0392156862745098],[.5725490196078431,1,.6784313725490196,.03529411764705882],[.5764705882352941,1,.6901960784313725,.03529411764705882],[.5803921568627451,1,.6941176470588235,.0392156862745098],[.5843137254901961,1,.7019607843137254,.0392156862745098],[.5882352941176471,1,.7058823529411765,.043137254901960784],[.592156862745098,1,.7098039215686275,.043137254901960784],[.596078431372549,1,.7137254901960784,.047058823529411764],[.6,1,.7176470588235294,.047058823529411764],[.6039215686274509,1,.7254901960784313,.050980392156862744],[.6078431372549019,1,.7294117647058823,.050980392156862744],[.611764705882353,1,.7333333333333333,.054901960784313725],[.615686274509804,1,.7372549019607844,.058823529411764705],[.6196078431372549,1,.7411764705882353,.058823529411764705],[.6235294117647059,1,.7490196078431373,.06274509803921569],[.6274509803921569,1,.7529411764705882,.06274509803921569],[.6313725490196078,1,.7568627450980392,.06666666666666667],[.6352941176470588,1,.7607843137254902,.06666666666666667],[.6392156862745098,1,.7647058823529411,.07058823529411765],[.6431372549019608,1,.7725490196078432,.07058823529411765],[.6470588235294118,1,.7764705882352941,.07450980392156863],[.6509803921568628,1,.7803921568627451,.07450980392156863],[.6549019607843137,1,.7843137254901961,.0784313725490196],[.6588235294117647,1,.788235294117647,.08235294117647059],[.6627450980392157,1,.796078431372549,.08235294117647059],[.6666666666666666,1,.8,.08627450980392157],[.6705882352941176,1,.803921568627451,.08627450980392157],[.6745098039215687,1,.807843137254902,.09019607843137255],[.6784313725490196,1,.8117647058823529,.09019607843137255],[.6823529411764706,1,.8196078431372549,.09411764705882353],[.6862745098039216,1,.8235294117647058,.09411764705882353],[.6901960784313725,1,.8274509803921568,.09803921568627451],[.6941176470588235,1,.8313725490196079,.10196078431372549],[.6980392156862745,1,.8352941176470589,.10196078431372549],[.7019607843137254,1,.8431372549019608,.10588235294117647],[.7058823529411765,1,.8470588235294118,.10588235294117647],[.7098039215686275,1,.8509803921568627,.10980392156862745],[.7137254901960784,1,.8549019607843137,.10980392156862745],[.7176470588235294,1,.8627450980392157,.11372549019607843],[.7215686274509804,1,.8666666666666667,.11372549019607843],[.7254901960784313,1,.8705882352941177,.11764705882352941],[.7294117647058823,1,.8745098039215686,.12156862745098039],[.7333333333333333,1,.8784313725490196,.12156862745098039],[.7372549019607844,1,.8862745098039215,.12549019607843137],[.7411764705882353,1,.8901960784313725,.12549019607843137],[.7450980392156863,1,.8941176470588236,.12941176470588237],[.7490196078431373,1,.8980392156862745,.12941176470588237],[.7529411764705882,1,.9019607843137255,.13333333333333333],[.7568627450980392,1,.9098039215686274,.13333333333333333],[.7607843137254902,1,.9137254901960784,.13725490196078433],[.7647058823529411,1,.9176470588235294,.1411764705882353],[.7686274509803922,1,.9215686274509803,.1411764705882353],[.7725490196078432,1,.9254901960784314,.1450980392156863],[.7764705882352941,1,.9333333333333333,.1450980392156863],[.7803921568627451,1,.9372549019607843,.14901960784313725],[.7843137254901961,1,.9411764705882353,.14901960784313725],[.788235294117647,1,.9450980392156862,.15294117647058825],[.792156862745098,1,.9450980392156862,.16862745098039217],[.796078431372549,1,.9490196078431372,.1843137254901961],[.8,1,.9490196078431372,.2],[.803921568627451,1,.9490196078431372,.21568627450980393],[.807843137254902,1,.9490196078431372,.22745098039215686],[.8117647058823529,1,.9529411764705882,.24313725490196078],[.8156862745098039,1,.9529411764705882,.25882352941176473],[.8196078431372549,1,.9529411764705882,.27450980392156865],[.8235294117647058,1,.9529411764705882,.2901960784313726],[.8274509803921568,1,.9568627450980393,.3058823529411765],[.8313725490196079,1,.9568627450980393,.3215686274509804],[.8352941176470589,1,.9568627450980393,.33725490196078434],[.8392156862745098,1,.9568627450980393,.35294117647058826],[.8431372549019608,1,.9607843137254902,.3686274509803922],[.8470588235294118,1,.9607843137254902,.3843137254901961],[.8509803921568627,1,.9607843137254902,.4],[.8549019607843137,1,.9607843137254902,.4117647058823529],[.8588235294117647,1,.9647058823529412,.42745098039215684],[.8627450980392157,1,.9647058823529412,.44313725490196076],[.8666666666666667,1,.9647058823529412,.4588235294117647],[.8705882352941177,1,.9647058823529412,.4745098039215686],[.8745098039215686,1,.9686274509803922,.49019607843137253],[.8784313725490196,1,.9686274509803922,.5058823529411764],[.8823529411764706,1,.9686274509803922,.5215686274509804],[.8862745098039215,1,.9686274509803922,.5372549019607843],[.8901960784313725,1,.9725490196078431,.5529411764705883],[.8941176470588236,1,.9725490196078431,.5686274509803921],[.8980392156862745,1,.9725490196078431,.5843137254901961],[.9019607843137255,1,.9725490196078431,.6],[.9058823529411765,1,.9725490196078431,.611764705882353],[.9098039215686274,1,.9764705882352941,.6274509803921569],[.9137254901960784,1,.9764705882352941,.6431372549019608],[.9176470588235294,1,.9764705882352941,.6588235294117647],[.9215686274509803,1,.9764705882352941,.6745098039215687],[.9254901960784314,1,.9803921568627451,.6901960784313725],[.9294117647058824,1,.9803921568627451,.7058823529411765],[.9333333333333333,1,.9803921568627451,.7215686274509804],[.9372549019607843,1,.9803921568627451,.7372549019607844],[.9411764705882353,1,.984313725490196,.7529411764705882],[.9450980392156862,1,.984313725490196,.7686274509803922],[.9490196078431372,1,.984313725490196,.7843137254901961],[.9529411764705882,1,.984313725490196,.8],[.9568627450980393,1,.9882352941176471,.8117647058823529],[.9607843137254902,1,.9882352941176471,.8274509803921568],[.9647058823529412,1,.9882352941176471,.8431372549019608],[.9686274509803922,1,.9882352941176471,.8588235294117647],[.9725490196078431,1,.9921568627450981,.8745098039215686],[.9764705882352941,1,.9921568627450981,.8901960784313725],[.9803921568627451,1,.9921568627450981,.9058823529411765],[.984313725490196,1,.9921568627450981,.9215686274509803],[.9882352941176471,1,.996078431372549,.9372549019607843],[.9921568627450981,1,.996078431372549,.9529411764705882],[.996078431372549,1,.996078431372549,.9686274509803922],[1,1,.996078431372549,.984313725490196]]}},Me.presetLutsO=function(){return{linear:[[0,0],[1,1]],lowpass:[[0,.8],[.2,.6],[.3,.1],[1,0]],bandpass:[[0,0],[.4,.8],[.6,.8],[1,0]],highpass:[[0,0],[.7,.1],[.8,.6],[1,.8]],flat:[[0,.7],[1,1]],random:[[0,0],[.38,0],[.55,1],[.72,1],[1,.05]],linear_full:[[0,0],[.00392156862745098,.00392156862745098],[.00784313725490196,.00784313725490196],[.011764705882352941,.011764705882352941],[.01568627450980392,.01568627450980392],[.0196078431372549,.0196078431372549],[.023529411764705882,.023529411764705882],[.027450980392156862,.027450980392156862],[.03137254901960784,.03137254901960784],[.03529411764705882,.03529411764705882],[.0392156862745098,.0392156862745098],[.043137254901960784,.043137254901960784],[.047058823529411764,.047058823529411764],[.050980392156862744,.050980392156862744],[.054901960784313725,.054901960784313725],[.058823529411764705,.058823529411764705],[.06274509803921569,.06274509803921569],[.06666666666666667,.06666666666666667],[.07058823529411765,.07058823529411765],[.07450980392156863,.07450980392156863],[.0784313725490196,.0784313725490196],[.08235294117647059,.08235294117647059],[.08627450980392157,.08627450980392157],[.09019607843137255,.09019607843137255],[.09411764705882353,.09411764705882353],[.09803921568627451,.09803921568627451],[.10196078431372549,.10196078431372549],[.10588235294117647,.10588235294117647],[.10980392156862745,.10980392156862745],[.11372549019607843,.11372549019607843],[.11764705882352941,.11764705882352941],[.12156862745098039,.12156862745098039],[.12549019607843137,.12549019607843137],[.12941176470588237,.12941176470588237],[.13333333333333333,.13333333333333333],[.13725490196078433,.13725490196078433],[.1411764705882353,.1411764705882353],[.1450980392156863,.1450980392156863],[.14901960784313725,.14901960784313725],[.15294117647058825,.15294117647058825],[.1568627450980392,.1568627450980392],[.1607843137254902,.1607843137254902],[.16470588235294117,.16470588235294117],[.16862745098039217,.16862745098039217],[.17254901960784313,.17254901960784313],[.17647058823529413,.17647058823529413],[.1803921568627451,.1803921568627451],[.1843137254901961,.1843137254901961],[.18823529411764706,.18823529411764706],[.19215686274509805,.19215686274509805],[.19607843137254902,.19607843137254902],[.2,.2],[.20392156862745098,.20392156862745098],[.20784313725490197,.20784313725490197],[.21176470588235294,.21176470588235294],[.21568627450980393,.21568627450980393],[.2196078431372549,.2196078431372549],[.2235294117647059,.2235294117647059],[.22745098039215686,.22745098039215686],[.23137254901960785,.23137254901960785],[.23529411764705882,.23529411764705882],[.23921568627450981,.23921568627450981],[.24313725490196078,.24313725490196078],[.24705882352941178,.24705882352941178],[.25098039215686274,.25098039215686274],[.2549019607843137,.2549019607843137],[.25882352941176473,.25882352941176473],[.2627450980392157,.2627450980392157],[.26666666666666666,.26666666666666666],[.27058823529411763,.27058823529411763],[.27450980392156865,.27450980392156865],[.2784313725490196,.2784313725490196],[.2823529411764706,.2823529411764706],[.28627450980392155,.28627450980392155],[.2901960784313726,.2901960784313726],[.29411764705882354,.29411764705882354],[.2980392156862745,.2980392156862745],[.30196078431372547,.30196078431372547],[.3058823529411765,.3058823529411765],[.30980392156862746,.30980392156862746],[.3137254901960784,.3137254901960784],[.3176470588235294,.3176470588235294],[.3215686274509804,.3215686274509804],[.3254901960784314,.3254901960784314],[.32941176470588235,.32941176470588235],[.3333333333333333,.3333333333333333],[.33725490196078434,.33725490196078434],[.3411764705882353,.3411764705882353],[.34509803921568627,.34509803921568627],[.34901960784313724,.34901960784313724],[.35294117647058826,.35294117647058826],[.3568627450980392,.3568627450980392],[.3607843137254902,.3607843137254902],[.36470588235294116,.36470588235294116],[.3686274509803922,.3686274509803922],[.37254901960784315,.37254901960784315],[.3764705882352941,.3764705882352941],[.3803921568627451,.3803921568627451],[.3843137254901961,.3843137254901961],[.38823529411764707,.38823529411764707],[.39215686274509803,.39215686274509803],[.396078431372549,.396078431372549],[.4,.4],[.403921568627451,.403921568627451],[.40784313725490196,.40784313725490196],[.4117647058823529,.4117647058823529],[.41568627450980394,.41568627450980394],[.4196078431372549,.4196078431372549],[.4235294117647059,.4235294117647059],[.42745098039215684,.42745098039215684],[.43137254901960786,.43137254901960786],[.43529411764705883,.43529411764705883],[.4392156862745098,.4392156862745098],[.44313725490196076,.44313725490196076],[.4470588235294118,.4470588235294118],[.45098039215686275,.45098039215686275],[.4549019607843137,.4549019607843137],[.4588235294117647,.4588235294117647],[.4627450980392157,.4627450980392157],[.4666666666666667,.4666666666666667],[.47058823529411764,.47058823529411764],[.4745098039215686,.4745098039215686],[.47843137254901963,.47843137254901963],[.4823529411764706,.4823529411764706],[.48627450980392156,.48627450980392156],[.49019607843137253,.49019607843137253],[.49411764705882355,.49411764705882355],[.4980392156862745,.4980392156862745],[.5019607843137255,.5019607843137255],[.5058823529411764,.5058823529411764],[.5098039215686274,.5098039215686274],[.5137254901960784,.5137254901960784],[.5176470588235295,.5176470588235295],[.5215686274509804,.5215686274509804],[.5254901960784314,.5254901960784314],[.5294117647058824,.5294117647058824],[.5333333333333333,.5333333333333333],[.5372549019607843,.5372549019607843],[.5411764705882353,.5411764705882353],[.5450980392156862,.5450980392156862],[.5490196078431373,.5490196078431373],[.5529411764705883,.5529411764705883],[.5568627450980392,.5568627450980392],[.5607843137254902,.5607843137254902],[.5647058823529412,.5647058823529412],[.5686274509803921,.5686274509803921],[.5725490196078431,.5725490196078431],[.5764705882352941,.5764705882352941],[.5803921568627451,.5803921568627451],[.5843137254901961,.5843137254901961],[.5882352941176471,.5882352941176471],[.592156862745098,.592156862745098],[.596078431372549,.596078431372549],[.6,.6],[.6039215686274509,.6039215686274509],[.6078431372549019,.6078431372549019],[.611764705882353,.611764705882353],[.615686274509804,.615686274509804],[.6196078431372549,.6196078431372549],[.6235294117647059,.6235294117647059],[.6274509803921569,.6274509803921569],[.6313725490196078,.6313725490196078],[.6352941176470588,.6352941176470588],[.6392156862745098,.6392156862745098],[.6431372549019608,.6431372549019608],[.6470588235294118,.6470588235294118],[.6509803921568628,.6509803921568628],[.6549019607843137,.6549019607843137],[.6588235294117647,.6588235294117647],[.6627450980392157,.6627450980392157],[.6666666666666666,.6666666666666666],[.6705882352941176,.6705882352941176],[.6745098039215687,.6745098039215687],[.6784313725490196,.6784313725490196],[.6823529411764706,.6823529411764706],[.6862745098039216,.6862745098039216],[.6901960784313725,.6901960784313725],[.6941176470588235,.6941176470588235],[.6980392156862745,.6980392156862745],[.7019607843137254,.7019607843137254],[.7058823529411765,.7058823529411765],[.7098039215686275,.7098039215686275],[.7137254901960784,.7137254901960784],[.7176470588235294,.7176470588235294],[.7215686274509804,.7215686274509804],[.7254901960784313,.7254901960784313],[.7294117647058823,.7294117647058823],[.7333333333333333,.7333333333333333],[.7372549019607844,.7372549019607844],[.7411764705882353,.7411764705882353],[.7450980392156863,.7450980392156863],[.7490196078431373,.7490196078431373],[.7529411764705882,.7529411764705882],[.7568627450980392,.7568627450980392],[.7607843137254902,.7607843137254902],[.7647058823529411,.7647058823529411],[.7686274509803922,.7686274509803922],[.7725490196078432,.7725490196078432],[.7764705882352941,.7764705882352941],[.7803921568627451,.7803921568627451],[.7843137254901961,.7843137254901961],[.788235294117647,.788235294117647],[.792156862745098,.792156862745098],[.796078431372549,.796078431372549],[.8,.8],[.803921568627451,.803921568627451],[.807843137254902,.807843137254902],[.8117647058823529,.8117647058823529],[.8156862745098039,.8156862745098039],[.8196078431372549,.8196078431372549],[.8235294117647058,.8235294117647058],[.8274509803921568,.8274509803921568],[.8313725490196079,.8313725490196079],[.8352941176470589,.8352941176470589],[.8392156862745098,.8392156862745098],[.8431372549019608,.8431372549019608],[.8470588235294118,.8470588235294118],[.8509803921568627,.8509803921568627],[.8549019607843137,.8549019607843137],[.8588235294117647,.8588235294117647],[.8627450980392157,.8627450980392157],[.8666666666666667,.8666666666666667],[.8705882352941177,.8705882352941177],[.8745098039215686,.8745098039215686],[.8784313725490196,.8784313725490196],[.8823529411764706,.8823529411764706],[.8862745098039215,.8862745098039215],[.8901960784313725,.8901960784313725],[.8941176470588236,.8941176470588236],[.8980392156862745,.8980392156862745],[.9019607843137255,.9019607843137255],[.9058823529411765,.9058823529411765],[.9098039215686274,.9098039215686274],[.9137254901960784,.9137254901960784],[.9176470588235294,.9176470588235294],[.9215686274509803,.9215686274509803],[.9254901960784314,.9254901960784314],[.9294117647058824,.9294117647058824],[.9333333333333333,.9333333333333333],[.9372549019607843,.9372549019607843],[.9411764705882353,.9411764705882353],[.9450980392156862,.9450980392156862],[.9490196078431372,.9490196078431372],[.9529411764705882,.9529411764705882],[.9568627450980393,.9568627450980393],[.9607843137254902,.9607843137254902],[.9647058823529412,.9647058823529412],[.9686274509803922,.9686274509803922],[.9725490196078431,.9725490196078431],[.9764705882352941,.9764705882352941],[.9803921568627451,.9803921568627451],[.984313725490196,.984313725490196],[.9882352941176471,.9882352941176471],[.9921568627450981,.9921568627450981],[.996078431372549,.996078431372549],[1,1]]}};class Se extends THREE.Object3D{constructor(e,t){super(),this.name="medicalHistogram",this._dom=void 0===t?document.createElement("div"):"string"==typeof t?document.getElementById(t):t,this.range={},this.bins=0,this.histogram=new Uint32Array(256),this.maxBin=0,this.maxBinValue=0,this._object=e,this.initCanvas(),this.computeHistogram(),this.drawHistogram()}_createCanvas(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=256,e.height=128,e.style.width="256px",e.style.height="128px",t.fillStyle="black",t.fillRect(0,0,e.width,e.height),e}initCanvas(){let e=document.createElement("div");e.style.cssText="position: relative; height: 128px; width: 256px; border: 1px solid #f9f9f9;",this._canvas=this._createCanvas(),this._canvas.style.cssText="position: absolute;",e.appendChild(this._canvas),this._dom.appendChild(e)}_statisticsPixels(e,n,r){if(!e)return this;let i=e.length-1;this.bins=Math.min(n||256,256),r=Math.min(r||1e3,1e3);let a=1/0,o=-1/0;for(let n=0;n<r;n++){let n=t.randInt(0,i);a=Math.min(a,e[n]),o=Math.max(o,e[n])}this.range={min:a,max:o};let s=this.histogram;s.fill(0);let l=this.bins/(o-a);for(let n=0;n<r;n++){let n=t.randInt(0,i);s[Math.floor((e[n]-a)*l)]+=1}this.maxBin=0,this.maxBinValue=0;for(let e=0;e<this.bins;e++)this.histogram[e]>this.maxBinValue&&(this.maxBin=e,this.maxBinValue=this.histogram[e])}_statisticsVoxels(e,n,r){if(!e)return this;this.bins=Math.min(n||256,256),r=Math.min(r||1e3,1e3);let i=e[0].pixelData.length-1,a=e.length-1,o=1/0,s=-1/0;for(let n=0;n<r;n++){let n=t.randInt(0,a),r=t.randInt(0,i),l=e[n].pixelData[r];o=Math.min(o,l),s=Math.max(s,l)}this.range={min:o,max:s};let l=this.histogram;l.fill(0);let c=this.bins/(s-o);for(let n=0;n<r;n++){let n=t.randInt(0,a),r=t.randInt(0,i),s=e[n].pixelData[r];l[Math.floor((s-o)*c)]+=1}this.maxBin=0,this.maxBinValue=0;for(let e=0;e<this.bins;e++)this.histogram[e]>this.maxBinValue&&(this.maxBin=e,this.maxBinValue=this.histogram[e])}computeHistogram(e){if(e&&(this._object=e),this._object&&!0===this._object.isMedicalSlicer){let e=this._object._getSlicePixels();this._statisticsPixels(e.data,256,5e3)}else if(this._object&&!0===this._object.isMedicalVolume){let e=this._object._getVolumeVoxels();this._statisticsVoxels(e.data,256,1e4)}else console.warn("warning: histograms are available for slice or volume...")}drawHistogram(){let e=this._canvas,t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,e.width,e.height),t.lineWidth=1,t.strokeStyle="rgb( 128, 128, 128 )",t.beginPath();let n,r,i=e.width/this.bins,a=.8*e.height/this.maxBinValue;for(let n=0;n<this.bins;n++)t.moveTo(i*n,e.height),t.lineTo(i*n,e.height-a*this.histogram[n]);t.stroke(),t.closePath(),this._object.isMedicalSlicer?(n=this._object.slice.windowWidth,r=this._object.slice.windowCenter):this._object.isMedicalVolume&&(n=this._object.windowWidth,r=this._object.windowCenter),t.fillStyle="rgba( 128, 128, 0, 0.25 )";let o=this.range,s=e.width/(o.max-o.min),l=s*(r-n/2-o.min),c=s*n;t.fillRect(l,0,c,e.height)}}Se.prototype.isMedicalHistogram=!0,t.MedicalHistogram=Se,Object.defineProperties(Se.prototype,{object:{get:function(){return this._object},set:function(e){this._object!==e&&this.computeHistogram(e),this.drawHistogram()}}});class Re{constructor(){}load(e,n){t.createProgressbar(),e=!0===Array.isArray(e)?e:[e],"string"==typeof this.path&&(e=e.map((e=>this.path+e)));let r=new Ee.MedicalLoader(t.appWorks.dom),i=[];var a,o,s;e.forEach((e=>{i.push(r.load(e))})),(a=i,o=a.length,s=0,Promise.all(a.map((function(e){return e.then((()=>{t.updateProgressbar(++s,o)})),e})))).then((()=>{let e=r.data[0].mergeSeries(r.data)[0].stack[0];r.dispose(),n(e),t.hideProgressbar()})).catch((e=>{console.log("Error: loading failed in JAMIE.MedicalLoader()..."),console.log(e)}))}setPath(e){return this.path=e,this}}Re.prototype.isMedicalLoader=!0,t.MedicalLoader=Re,t.MedicalLoadFiles=function(e,n){t.createProgressbar();let r=new Ee.MedicalLoader(t.appWorks.dom),i=[];function a(e,t){return t.extension.toUpperCase()===e.toUpperCase()}function o(e,t){return Promise.resolve().then((()=>new Promise(((n,r)=>{setTimeout((function(){let r=new FileReader;r.addEventListener("load",(e=>{n(e.target.result)})),r.readAsArrayBuffer(t[e])}),3e3*Math.random())})))).then((n=>r.parse({url:t[e].name,buffer:n}))).then((e=>{i.push(e)})).catch((e=>{console.log(e)}))}const s=[],l=[],c=[];var u,h,d,f=e.dataTransfer?e.dataTransfer.files:e.target.files;for(let e=0;e<f.length;e++){let n=t.MedicalUtils.parseUrl(f[e].name);"MHD"===n.extension.toUpperCase()||"RAW"===n.extension.toUpperCase()||"ZRAW"===n.extension.toUpperCase()?c.push({file:f[e],extension:n.extension.toUpperCase()}):l.push(f[e])}if(2===c.length){const e=c.filter(a.bind(null,"MHD")),t=c.filter(a.bind(null,"RAW")),n=c.filter(a.bind(null,"ZRAW"));1!==e.length||1!==t.length&&1!==n.length||s.push(function(e){const t=[];for(let n=0;n<e.length;n++)t.push(new Promise(((t,r)=>{setTimeout((function(){const r=new FileReader;r.addEventListener("load",(e=>{t(e.target.result)})),r.readAsArrayBuffer(e[n].file)}),3e3*Math.random())})).then((t=>({url:e[n].file.name,buffer:t}))));return Promise.all(t).then((e=>r.parse(e))).then((e=>{i.push(e)})).catch((e=>{console.log(e)}))}(c))}for(let e=0;e<l.length;e++)s.push(o(e,l));(u=s,h=u.length,d=0,Promise.all(u.map((function(e){return e.then((()=>{t.updateProgressbar(++d,h)})),e})))).then((()=>{let e=i[0].mergeSeries(i)[0].stack[0];r.dispose(),n(e),t.hideProgressbar()})).catch((e=>{console.log(e)}))},t.MedicalKeyboard=function(e){e.preventDefault(),e.stopPropagation();var n=t.appWorks,r=t.medicalWorker;if(113===e.keyCode){let e;return n.guiSidebar&&(e=n.guiSidebar.dom.style.display,n.guiSidebar.setDisplay(""===e?"none":""),n.widthRatio=""===e?1:(window.innerWidth-300)/window.innerWidth,n.signals.windowResize.dispatch(),r.onWindowResize()),void(n.guiIconbar&&(e=n.guiIconbar.dom.style.display,n.guiIconbar.setDisplay(""===e?"none":"")))}if("quadWorkspace"===r.workspace){if((i=r.objectEntered)&&i.isMedicalSlicer)switch(e.keyCode){case 38:!function(e){e.index<e.orientationMaxIndex&&(e.index+=1)}(i),a(i),s(i),l(i);break;case 40:!function(e){e.index>0&&(e.index-=1)}(i),a(i),s(i),l(i);break;case 46:o(i)}}else if("slicesWorkspace"===r.workspace){var i;if((i=r.objectEntered)&&i.isMedicalSlicer)switch(e.keyCode){case 46:o(i)}}function a(e){e.children.forEach((t=>{t.isSketchBase&&(t.targetMesh=e.slice)}))}function o(e){var n=t.medicalWorker.sketches;for(let r=0,i=e.children.length;r<i;r++){let i=e.children[r];if(i.hovered){t.remove(i);let e=n.indexOf(i);return n.splice(e,1),void i.free()}}}function s(e){n.guiSlicer.update(e)}function l(e){var t=n.guiHistogram;!(!t||""!==t.dom.style.display)&&t.update(e,!0)}},t.medicalWorker={stack:null,stackSize:0,workspace:"",medical:null,medicalDom:null,objectEntered:null,objectClicked:null,elementDblClicked:null,elements:[],raycaster:new THREE.Raycaster,sketchType:"Handle",sketches:[],getAppWorks:function(){var e=t.appWorks;return null!==e.composer&&(e.composer=null,e.renderer.setClearColor(1184274,1),e.renderer.setScissorTest(!0)),e},getMedicalSlicers:function(e){var[n,r,i]=e.worldSliceOrientation(),a=new t.MedicalSlicer(e);a.name="xSlicer",a.worldAxis=0,a.orientation=n,a.bbox.visible=!1,a.borderColor=16776960;var o=new t.MedicalSlicer(e);o.name="ySlicer",o.worldAxis=1,o.orientation=r,o.bbox.visible=!1,o.borderColor=65280;var s=new t.MedicalSlicer(e);return s.name="zSlicer",s.worldAxis=2,s.orientation=i,s.bbox.visible=!1,s.borderColor=16711680,[a,o,s]},getMedicalVolume:function(e){return new t.MedicalVolume(e)},getMedicalIsosurface:function(e,n,r){return new t.MedicalIsosurface(e,n,r)},onUpdateMedical:function(e,n){if(this.medical){var r=t.appWorks.renderer,i=r.domElement;this.medical.children.forEach((function(e,t){var n=e.userData.element.getBoundingClientRect();if(!(n.bottom<0||n.top>i.clientHeight||n.right<0||n.left>i.clientWidth)){var a=n.width,o=n.height,s=n.left,l=i.clientHeight-n.bottom;r.setViewport(s,l,a,o),r.setScissor(s,l,a,o);var c=e.userData.camera;e.userData.controls.update(),r.render(e,c)}}))}},prepareStack:function(e){return e.prepared||e.prepare(),e.packed||e.pack(),e},getStackCenter:function(e){return e.worldCenter()},getStackSizes:function(e){let t=e.worldBoundingBox();return[t[1]-t[0],t[3]-t[2],t[5]-t[4]]},getStackSize:function(e){return Math.max(...this.getStackSizes(e))},getElementSlicer:function(e){let t=parseInt(e.id);return this.medical.children[t].children[0]},getElementControls:function(e){let t=parseInt(e.id);return this.medical.children[t].userData.controls},getElementCamera:function(e){let t=parseInt(e.id);return this.medical.children[t].userData.camera},resizeCamera:function(e,t,n){if("quadWorkspace"===this.workspace)if(e.isPerspectiveCamera)e.aspect=t,e.updateProjectionMatrix();else{let n=this.stackSize,r=this.stackSize*t;e.left=-r/2,e.right=r/2,e.top=n/2,e.bottom=-n/2,e.updateProjectionMatrix()}if("slicesWorkspace"===this.workspace){let r=this.stackSize,i=this.stackSize*t;e.left=-i/2,e.right=i/2,e.top=r/2,e.bottom=-r/2,void 0!==n&&(e.zoom=n),e.updateProjectionMatrix()}},resizeElement:function(e,t,n,r){e.style.display="",e.style.width=t+"px",e.style.height=n+"px";let i=this.getElementCamera(e);this.resizeCamera(i,t/n,r)},onMouseEnter:function(e){let n=t.medicalWorker,r=n.getElementSlicer(this);n.objectEntered=r,"slicesWorkspace"===n.workspace&&(this.style.transform="scale(1.1, 1.1)")},onMouseLeave:function(e){let n=t.medicalWorker;n.objectEntered=null,"slicesWorkspace"===n.workspace&&(this.style.transform="scale(1.0, 1.0)")},onClick:function(e){let n=t.medicalWorker,r=n.getElementSlicer(this);n.objectClicked=r,t.appWorks.signals.objectSelected.dispatch(r)},onDoubleClick:function(e){let n=t.medicalWorker;if("quadWorkspace"===n.workspace){let e=t.appWorks.width,r=t.appWorks.height,i=~~(e/2),a=~~(r/2);n.elementDblClicked!==this?(n.elements.forEach((e=>{e.style.display="none"})),n.resizeElement(this,e,r),n.elementDblClicked=this):(n.elements.forEach((e=>{n.resizeElement(e,i,a)})),n.elementDblClicked=null),n.sketches.length>0&&t.triggerWindowResize()}if("slicesWorkspace"===n.workspace){let e=t.appWorks.width,r=t.appWorks.height,i=200,a=200;if(n.elementDblClicked!==this){n.elements.forEach((e=>{e.style.display="none"})),n.resizeElement(this,e,r),n.getElementControls(this).enabled=!0,n.elementDblClicked=this}else{n.elements.forEach((e=>{e.style.display=""})),n.resizeElement(this,i,a,1),n.getElementControls(this).enabled=!1,n.elementDblClicked=null}n.sketches.length>0&&t.triggerWindowResize()}},onWindowResize:function(e){let n=t.appWorks,r=t.medicalWorker;if("quadWorkspace"===r.workspace){let e=n.width,t=n.height,i=~~(e/2),a=~~(t/2),o=r.medicalDom.style;if(o.width=e+"px",o.height=t+"px",r.elementDblClicked){let n=r.elementDblClicked;r.resizeElement(n,e,t)}else r.elements.forEach((e=>{r.resizeElement(e,i,a)}))}if("slicesWorkspace"===r.workspace){let e=n.width,t=n.height,i=r.medicalDom.style;if(i.width=e+"px",i.height=t+"px",r.elementDblClicked){let n=r.elementDblClicked;r.resizeElement(n,e,t)}}},onMouseDown:function(e){if(!t.isCtrlKeyDown(e))return;let n=t.medicalWorker,r=n.medical,i=n.raycaster,a=n.sketches,o=n.sketchType,s=parseInt(this.id),l=r.children[s],c=l.children[0];if(!c.isMedicalSlicer)return;let u=l.userData.camera,h=l.userData.controls;for(let t=0,n=a.length;t<n;t++){let n=a[t];if(n.hovered)return void n.onStart(e)}this.style.cursor="default";let d=this.getBoundingClientRect(),f={x:(e.clientX-d.left)/d.width*2-1,y:-(e.clientY-d.top)/d.height*2+1};i.setFromCamera(f,u);let p=i.intersectObject(c.slice);if(0===p.length)return;if(a.length>0){let e=a[a.length-1];if(e._active||e._dragged)return}let m=c.stack,g=null;switch(o){default:case"Handle":g=new t.SketchHandle(c.slice,h,{worldPosition:p[0].point});break;case"VoxelProbe":g=new t.SketchVoxelProbe(c.slice,h,{stack:m,worldPosition:p[0].point});break;case"Ruler":g=new t.SketchRuler(c.slice,h,{lps2IJK:m.lps2IJK,pixelSpacing:m.frame[c.index].pixelSpacing,ultrasoundRegions:m.frame[c.index].ultrasoundRegions,worldPosition:p[0].point});break;case"BiRuler":g=new t.SketchBiRuler(c.slice,h,{lps2IJK:m.lps2IJK,pixelSpacing:m.frame[c.index].pixelSpacing,ultrasoundRegions:m.frame[c.index].ultrasoundRegions,worldPosition:p[0].point});break;case"Angle":g=new t.SketchAngle(c.slice,h,{worldPosition:p[0].point});break;case"Rectangle":g=new t.SketchRectangle(c.slice,h,{frameIndex:c.index,stack:m,worldPosition:p[0].point});break;case"Polygon":g=new t.SketchPolygon(c.slice,h,{frameIndex:c.index,stack:m,worldPosition:p[0].point});break;case"Freehand":g=new t.SketchFreehand(c.slice,h,{frameIndex:c.index,stack:m,worldPosition:p[0].point});break;case"Annotation":g=new t.SketchAnnotation(c.slice,h,{worldPosition:p[0].point})}a.push(g),c.add(g)},onMouseUp:function(e){if(!t.isCtrlKeyDown(e))return;let n=t.medicalWorker.sketches;if(2===e.button)for(let e=0,t=n.length;e<t;e++){let t=n[e];t.isSketchPolygon&&t._active&&this.dispatchEvent(new CustomEvent("rightclick"))}for(let t=0,r=n.length;t<r;t++){let r=n[t];if(r.active)return void r.onEnd(e)}},onMouseMove:function(e){if(!t.isCtrlKeyDown(e))return;let n=t.medicalWorker.sketches,r="default";for(let t=0,i=n.length;t<i;t++){let i=n[t];i.onMove(e),i.hovered&&(r="pointer")}this.style.cursor=r}},t.MedSketchCSS='\n.sketch-handle {\n    position: absolute;\n    border: 1px solid;\n    border-radius: 50%;\n    width: 10px;\n    height: 10px;\n    margin: -6px; /* border + width / 2 */\n    z-index: 1; /* 3 */\n}\n.sketch-line {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    margin-top: -0.5px; /* height / 2 */\n}\n.sketch-dashline {\n    position: absolute;\n    border-top: 1px dashed;\n    margin-top: -0.5px; /* border / 2 */\n}\n.sketch-line::before,\n.sketch-dashline::before { /* for dragging */\n    content: " ";\n    position: absolute;\n    height: 12px;\n    left: 0;\n    right: 0;\n    margin-top: -6px;\n}\n.sketch-rectangle {\n    position: absolute;\n    border: 1px solid;\n    margin: -1px; /* border */\n}\n// .sketch-rectangle-helper {\n//     position: absolute;\n//     border: 1px dashed;\n//     margin: -1px; /* border */\n// }\n// .sketch-ellipse {\n//     position: absolute;\n//     border: 1px solid;\n//     border-radius: 50%;\n//     margin: -1px; /* border */\n//     // z-index: 2;\n// }\n.sketch-label {\n    position: absolute;\n    border: 1px solid;\n    border-radius: 6px; /* jamie */\n    background-color: rgba(0, 0, 0, 0.7);\n    color: rgb(255, 255, 255);\n    padding: 4px;\n    z-index: 1; /* 3 */\n}\n::selection {\n    background: rgba(0,0,0,0);\n}';class ke extends THREE.Object3D{constructor(e,n,r){r=r||{},super(),this.name="sketchBase",this._sketchType="Base",this._params=r,!0===r.hideMesh&&(this.visible=!1);if(null===document.getElementById("medical-sketches")){const e=document.createElement("style");e.id="medical-sketches",e.innerHTML=t.MedSketchCSS,document.head.appendChild(e)}this._enabled=!0,this._selected=!1,this._hovered=!0,this._active=!0,this._colors={default:"#0000ff",active:"#ffff00",hover:"#ff0000",select:"#008000",text:"#ffffff",error:"#ff7f50"},this._color=this._colors.default,this._dragged=!1,this._displayed=!0,this._targetMesh=e,this._controls=n,this._camera=n.object,this._container=n.domElement,this._worldPosition=new THREE.Vector3,r.worldPosition?this._worldPosition.copy(r.worldPosition):null!==this._targetMesh&&this._worldPosition.setFromMatrixPosition(this._targetMesh.matrixWorld),this._xaxis=new THREE.Vector3(1,0,0),this._yaxis=new THREE.Vector3(0,1,0)}initOffsets(){const e=this._container.getBoundingClientRect(),t=document.body,n=document.documentElement,r=window.pageYOffset||n.scrollTop||t.scrollTop,i=window.pageXOffset||n.scrollLeft||t.scrollLeft,a=n.clientTop||t.clientTop||0,o=n.clientLeft||t.clientLeft||0;this._offsets={top:Math.round(e.top+r-a),left:Math.round(e.left+i-o)}}getMouseOffsets(e){return{x:(e.clientX-this._offsets.left)/this._container.offsetWidth*2-1,y:-(e.clientY-this._offsets.top)/this._container.offsetHeight*2+1,screenX:e.clientX-this._offsets.left,screenY:e.clientY-this._offsets.top}}getArea(e){let t=0,n=e.length-1;for(let r=0;r<e.length;r++)t+=(e[n].x+e[r].x)*(e[n].y-e[r].y),n=r;return Math.abs(t/2)}getRegionByXY(e,t){let n=null;return e.some(((e,r)=>{if(t.x>=e.x0&&t.x<=e.x1&&t.y>=e.y0&&t.y<=e.y1)return n=r,!0})),n}getPointInRegion(e,t){return e?new THREE.Vector2((t.x-e.x0-(e.axisX||0))*e.deltaX,(t.y-e.y0-(e.axisY||0))*e.deltaY):null}getUsPoint(e,t){return this.getPointInRegion(e[this.getRegionByXY(e,t)],t)}getUsDistance(e,t){const n=this._params.ultrasoundRegions||[];if(n.length<1)return null;const r=this.getRegionByXY(n,e),i=this.getRegionByXY(n,t);return null===r||null===i||r!==i||"cm"!==n[r].unitsX||"cm"!==n[r].unitsY?null:this.getPointInRegion(n[r],e).distanceTo(this.getPointInRegion(n[r],t))}getDistanceData(e,n,r){let i=null,a=null;if(r)i=e.distanceTo(n)*r;else if(this._params.ultrasoundRegions&&this._params.lps2IJK){const r=this.getUsDistance(t.MedicalUtils.worldToData(this._params.lps2IJK,e),t.MedicalUtils.worldToData(this._params.lps2IJK,n));null!==r?(i=10*r,a="mm"):(i=e.distanceTo(n),a=this._params.pixelSpacing?"mm":"units")}else i=e.distanceTo(n);return{distance:i,units:a}}getLineData(e,t){const n=t.clone().sub(e),r=t.clone().add(e).multiplyScalar(.5),i=n.length(),a=n.angleTo(this._xaxis);return{line:n,length:i,transformX:r.x-i/2,transformY:r.y,transformAngle:e.y<t.y?a:-a,center:r}}getRectData(e,t){const n=t.clone().sub(e),r=n.clone().projectOnVector(this._yaxis),i=e.clone().min(t);return{width:n.clone().projectOnVector(this._xaxis).length(),height:r.length(),transformX:i.x,transformY:i.y,paddingVector:r.clone().normalize()}}adjustLabelTransform(e,t,n){let r=Math.round(t.x-(n?0:e.offsetWidth/2)),i=Math.round(t.y-(n?0:e.offsetHeight/2));return new THREE.Vector2(r,i)}worldToScreen(e){const t=e.clone();return t.project(this._camera),t.x=Math.round((t.x+1)*this._container.offsetWidth/2),t.y=Math.round((1-t.y)*this._container.offsetHeight/2),t.z=0,t}update(){console.log("update() should be overloaded!")}updateColor(){this._active?this._color=this._colors.active:this._hovered?this._color=this._colors.hover:this._selected?this._color=this._colors.select:this._color=this._colors.default}setDefaultColor(e){this._colors.default=e,this._handles&&this._handles.forEach((t=>t._colors.default=e)),this.update()}show(){this.showDOM(),this.showMesh(),this.update(),this._displayed=!0}hide(){this.hideDOM(),this.hideMesh(),this._displayed=!1}hideDOM(){console.log("hideDOM() should be overloaded!")}showDOM(){console.log("showDOM() should be overloaded!")}hideMesh(){this.visible=!1}showMesh(){!0!==this._params.hideMesh&&(this.visible=!0)}free(){this._camera=null,this._container=null,this._controls=null,this._params=null,this._targetMesh=null}}ke.prototype.isSketchBase=!0,t.SketchBase=ke,Object.defineProperties(ke.prototype,{sketchType:{get:function(){return this._sketchType}},targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._worldPosition.copy(e),this.update()}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},selected:{get:function(){return this._selected},set:function(e){this._selected=e,this.update()}},hovered:{get:function(){return this._hovered},set:function(e){this._hovered=e,this.update()}},dragged:{get:function(){return this._dragged},set:function(e){this._dragged=e,this.update()}},displayed:{get:function(){return this._displayed},set:function(e){this._displayed=e,this.update()}},active:{get:function(){return this._active},set:function(e){this._active=e,this.update()}},color:{get:function(){return this._color},set:function(e){this._color=e,this.update()}}});class Pe extends ke{constructor(e,t,n){super(e,t,n=n||{}),this.name="sketchHandle",this._sketchType="Handle",this._plane={position:new THREE.Vector3,direction:new THREE.Vector3},this._offset=new THREE.Vector3,this._raycaster=new THREE.Raycaster,this._active=!1,this._hovered=!1,this._tracking=!1,this._mouse=new THREE.Vector2,this._initialized=!1,this._dom=null,this._domHovered=!1,this._screenPosition=this.worldToScreen(this._worldPosition),this.create(),this.initOffsets(),this.onResize=this.onResize.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){window.addEventListener("resize",this.onResize),this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)}removeEventListeners(){window.removeEventListener("resize",this.onResize),this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)}onResize(){this.initOffsets()}onHover(e){e&&this.hoverDom(e),this._hovered=this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onStart(e){const n=this.getMouseOffsets(e);if(this._mouse.set(n.x,n.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._hovered){if(this._active=!0,this._controls.enabled=!1,this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._offset.copy(e[0].point).sub(this._worldPosition)}else{this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()),this._raycaster.ray.position=this._raycaster.ray.origin;let e=t.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._offset.copy(e).sub(this._plane.position)}this.update()}}onMove(e,n){const r=this.getMouseOffsets(e);if(this._mouse.set(r.x,r.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._active||n)if(this._dragged=!0,null!==this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._worldPosition.copy(e[0].point.sub(this._offset))}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection())),this._raycaster.ray.position=this._raycaster.ray.origin;let e=t.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._worldPosition.copy(e.sub(this._offset))}else this.onHover(null);this.update()}onEnd(){!0!==this._tracking&&(!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected),this._initialized=!0,this._active=!1,this._dragged=!1,this._controls.enabled=!0,this.update())}create(){this.createDOM()}createDOM(){this._dom=document.createElement("div"),this._dom.className="sketch-handle",this._dom.style.transform=`translate3D(${this._screenPosition.x}px, ${this._screenPosition.y}px, 0)`,this.updateDOMColor(),this._container.appendChild(this._dom)}update(){this.updateColor(),this._screenPosition=this.worldToScreen(this._worldPosition),this.updateDOMColor(),this.updateDOMPosition()}updateWorldPosition(){let e=this._screenPosition,n=this._container.offsetWidth,r=this._container.offsetHeight,i={};if(i.x=2*e.x/n-1,i.y=-2*e.y/r+1,this._raycaster.setFromCamera(i,this._camera),this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._worldPosition.copy(e[0].point)}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection())),this._raycaster.ray.position=this._raycaster.ray.origin;let e=t.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._worldPosition.copy(e)}}updateDOMColor(){this._dom.style.backgroundColor=this._color}updateDOMPosition(){this._dom&&(this._dom.style.transform=`translate3D(${this._screenPosition.x}px, ${this._screenPosition.y}px, 0)`)}free(){this.removeEventListeners(),this._container.removeChild(this._dom)}hideDOM(){this._dom.style.display="none"}showDOM(){this._dom.style.display=""}}Pe.prototype.isSketchHandle=!0,t.SketchHandle=Pe,Object.defineProperties(Pe.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this.updateWorldPosition(),this.update()}},screenPosition:{get:function(){return this._screenPosition},set:function(e){this._screenPosition=e}},active:{get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}},tracking:{get:function(){return this._tracking},set:function(e){this._tracking=e,this.update()}}});class Le extends ke{constructor(e,n,r){super(e,n,r=r||{}),this.name="sketchVoxelProbe",this._sketchType="VoxelProbe",this._stack=r.stack,this._container.style.cursor="pointer",this._controls.enabled=!1,this._initialized=!1,this._active=!0,this._moving=!0,this._domHovered=!1,this._label=null,this._handle=new t.SketchHandle(e,n,r),this.add(this._handle),this._moveHandle=new t.SketchHandle(e,n,r),this.add(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)}removeEventListeners(){this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)}onStart(e){this._moveHandle.onMove(e,!0),this._handle.onStart(e),this._active=this._handle.active||this._domHovered,this._domHovered&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handle.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}else this.onHover(null);this._handle.onMove(e),this.update()}onEnd(){this._handle.onEnd(),!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handle.selected=this._selected),this._initialized=!0,this._active=this._handle.active,this._dragged=!1,this._moving=!1,this.update()}onHover(e){e&&this.hoverDom(e),this._hovered=this._handle.hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}create(){this.createVoxel(),this.createDOM()}createVoxel(){this._voxel=new t.MedicalVoxel,this._voxel.id=this.id}createDOM(){this._label=document.createElement("div"),this._label.className="sketch-label";let e=document.createElement("div"),t=document.createElement("div");t.className="lpsPosition",e.appendChild(t);let n=document.createElement("div");n.className="ijkPosition",e.appendChild(n);let r=document.createElement("div");r.className="value",e.appendChild(r),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handle.update(),this._worldPosition.copy(this._handle.worldPosition),this.updateVoxel(),this.updateDOM()}updateVoxel(){this._voxel.worldCoordinates=this._worldPosition,this._voxel.dataCoordinates=t.MedicalUtils.worldToData(this._stack.lps2IJK,this._worldPosition);let e=t.MedicalUtils.getPixelData(this._stack,this._voxel.dataCoordinates);this._voxel.value=e===this._stack.numberOfChannels>1?"NA":t.MedicalUtils.rescaleSlopeIntercept(e,this._stack.rescaleSlope,this._stack.rescaleIntercept).toFixed()}updateDOM(){const e=this._label.querySelector(".lpsPosition"),t=this._label.querySelector(".ijkPosition"),n=this._label.querySelector(".value");e.innerHTML=`LPS: \n            ${this._voxel.worldCoordinates.x.toFixed(2)}, \n            ${this._voxel.worldCoordinates.y.toFixed(2)}, \n            ${this._voxel.worldCoordinates.z.toFixed(2)}`,t.innerHTML=`IJK: \n            ${this._voxel.dataCoordinates.x}, \n            ${this._voxel.dataCoordinates.y}, \n            ${this._voxel.dataCoordinates.z}`,n.innerHTML=`Value: ${this._voxel.value}`,this.updateDOMColor();const r=this.adjustLabelTransform(this._label,this._handle.screenPosition,!0);this._label.style.transform=`translate3D(${r.x}px, ${r.y}px, 0)`}updateDOMColor(){this._label.style.borderColor=this._color}free(){this.removeEventListeners(),this.remove(this._handle),this._handle.free(),this.remove(this._moveHandle),this._moveHandle.free(),this._container.removeChild(this._label),this._stack=null,this._voxel=null}hideDOM(){this._label.style.display="none",this._handle.hideDOM()}showDOM(){this._label.style.display="",this._handle.showDOM()}}Le.prototype.isSketchVoxelProbe=!0,t.SketchVoxelProbe=Le,Object.defineProperties(Le.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handle.targetMesh=e,this._moveHandle.targetMesh=e,this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handle.worldPosition.copy(e),this._moveHandle.worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},active:{get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}}});class Ce extends ke{constructor(e,n,r){let i;super(e,n,r=r||{}),this.name="sketchRuler",this._sketchType="Ruler",this._calibrationFactor=r.calibrationFactor||null,this._distance=null,this._units=this._calibrationFactor||r.pixelSpacing?"mm":"units",this._moving=!1,this._domHovered=!1,this._line=null,this._label=null,this._handles=[];for(let a=0;a<2;a++)i=new t.SketchHandle(e,n,r),this.add(i),this._handles.push(i);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new t.SketchHandle(e,n,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach((e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}))}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.update())}create(){this.createDOM()}createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="sketch-label",this._container.appendChild(this._label),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._label.style.display="none",this._handles.forEach((e=>e.hideDOM()))}showDOM(){this._line.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update();const e=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor);this._distance=e.distance,e.units&&(this._units=e.units),this.updateDOM()}updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px","units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the distance in mm"),this._label.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${this._units}`;let t=Math.abs(e.transformAngle);t>Math.PI/2&&(t=Math.PI-t);const n=Math.tan(t)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(t)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-t)+15,r=e.line.normalize().multiplyScalar(n),i=e.length>2*n?this._handles[1].screenPosition.clone().sub(r):this._handles[1].screenPosition.clone().add(r),a=this.adjustLabelTransform(this._label,i);this._label.style.transform=`translate3D(${a.x}px, ${a.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color}free(){this.removeEventListeners(),this._handles.forEach((e=>{this.remove(e),e.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label)}getMeasurements(){return{distance:this._distance,units:this._units}}}Ce.prototype.isSketchRuler=!0,t.SketchRuler=Ce,Object.defineProperties(Ce.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach((t=>t.targetMesh=e)),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="mm",this.update()}}});class Ie extends ke{constructor(e,n,r){let i;super(e,n,r=r||{}),this.name="sketchBiRuler",this._sketchType="BiRuler",this._calibrationFactor=r.calibrationFactor||null,this._distance=null,this._distance2=null,this._units=this._calibrationFactor||r.pixelSpacing?"mm":"units",this._line=null,this._label=null,this._line2=null,this._label2=null,this._dashline=null,this._handles=[];for(let a=0;a<3;a++)i=new t.SketchHandle(e,n,r),this.add(i),this._handles.push(i);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0,this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover),this._line2.addEventListener("mouseenter",this.onHover),this._line2.addEventListener("mouseleave",this.onHover),this._label2.addEventListener("mouseenter",this.onHover),this._label2.addEventListener("mouseleave",this.onHover),this._dashline.addEventListener("mouseenter",this.onHover),this._dashline.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover),this._line2.removeEventListener("mouseenter",this.onHover),this._line2.removeEventListener("mouseleave",this.onHover),this._label2.removeEventListener("mouseenter",this.onHover),this._label2.removeEventListener("mouseleave",this.onHover),this._dashline.removeEventListener("mouseenter",this.onHover),this._dashline.removeEventListener("mouseleave",this.onHover)}onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onStart(e){this._handles.forEach((t=>t.onStart(e))),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this.update()}onMove(e){this._active?this._dragged=!0:(this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered,this._container.style.cursor=this._hovered?"pointer":"default"),this._handles.forEach((t=>t.onMove(e))),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=!1,this.update())}create(){this.createDOM()}createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="sketch-label",this._container.appendChild(this._label),this._line2=document.createElement("div"),this._line2.className="sketch-line",this._container.appendChild(this._line2),this._label2=document.createElement("div"),this._label2.className="sketch-label",this._container.appendChild(this._label2),this._dashline=document.createElement("div"),this._dashline.className="sketch-dashline",this._container.appendChild(this._dashline),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._label.style.display="none",this._line2.style.display="none",this._label2.style.display="none",this._dashline.style.display="none",this._handles.forEach((e=>e.hideDOM()))}showDOM(){this._line.style.display="",this._label.style.display="",this._line2.style.display="",this._label2.style.display="",this._dashline.style.display="",this._handles.forEach((e=>e.showDOM()))}update(){this.updateColor(),this._handles.forEach((e=>e.update())),this.updateDOM()}updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=this.getLineData(this._handles[0].screenPosition,this._handles[2].screenPosition);this._line2.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0) rotate(${t.transformAngle}rad)`,this._line2.style.width=t.length+"px";const n=this._handles[0].worldPosition.clone().add(this._handles[1].worldPosition).multiplyScalar(.5),r=this._handles[0].worldPosition.clone().add(this._handles[2].worldPosition).multiplyScalar(.5),i=this.getLineData(this.worldToScreen(n),this.worldToScreen(r));this._dashline.style.transform=`translate3D(${i.transformX}px, ${i.transformY}px, 0) rotate(${i.transformAngle}rad)`,this._dashline.style.width=i.length+"px";const a=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor),o=this.getDistanceData(this._handles[0].worldPosition,this._handles[2].worldPosition,this._calibrationFactor),s="Calibration is required to display the distance in mm";this._distance=a.distance,this._distance2=o.distance,a.units&&o.units&&a.units===o.units?this._units=a.units:(a.units||(a.units=this._units),o.units||(o.units=this._units)),"units"!==a.units||this._label.hasAttribute("title")?"units"!==a.units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",s),this._label.style.color=this._colors.error),"units"!==o.units||this._label2.hasAttribute("title")?"units"!==o.units&&this._label2.hasAttribute("title")&&(this._label2.removeAttribute("title"),this._label2.style.color=this._colors.text):(this._label2.setAttribute("title",s),this._label2.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${a.units}`,this._label2.innerHTML=`${this._distance2.toFixed(2)} ${o.units}`;let l=Math.abs(e.transformAngle);l>Math.PI/2&&(l=Math.PI-l);const c=Math.tan(l)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(l)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-l)+15,u=e.line.normalize().multiplyScalar(c),h=e.length>2*c?this._handles[1].screenPosition.clone().sub(u):this._handles[1].screenPosition.clone().add(u),d=this.adjustLabelTransform(this._label,h);this._label.style.transform=`translate3D(${d.x}px, ${d.y}px, 0)`;let f=Math.abs(t.transformAngle);f>Math.PI/2&&(f=Math.PI-f);const p=Math.tan(f)<this._label2.offsetHeight/this._label2.offsetWidth?this._label2.offsetWidth/2/Math.cos(f)+15:this._label2.offsetHeight/2/Math.cos(Math.PI/2-f)+15,m=t.line.normalize().multiplyScalar(p),g=t.length>2*p?this._handles[2].screenPosition.clone().sub(m):this._handles[2].screenPosition.clone().add(m),v=this.adjustLabelTransform(this._label2,g);this._label2.style.transform=`translate3D(${v.x}px, ${v.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color,this._line2.style.backgroundColor=this._color,this._label2.style.borderColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color}free(){this.removeEventListeners(),this._handles.forEach((e=>{this.remove(e),e.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label),this._container.removeChild(this._line2),this._container.removeChild(this._label2),this._container.removeChild(this._dashline)}getDistances(){return[this._distance,this._distance2]}}Ie.prototype.isSketchBiRuler=!0,t.SketchBiRuler=Ie,Object.defineProperties(Ie.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach((t=>t.targetMesh=e)),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach((t=>t.worldPosition.copy(e))),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="mm",this.update()}},shotestDistance:{get:function(){return this._distance<this._distance2?this._distance:this._distance2}},longestDistance:{get:function(){return this._distance>this._distance2?this._distance:this._distance2}}});class Ne extends ke{constructor(e,n,r){let i;super(e,n,r=r||{}),this.name="sketchAngle",this._sketchType="Angle",this._opangle=null,this._moving=!1,this._domHovered=!1,this._defaultAngle=!0,this._line=null,this._line2=null,this._label=null,this._handles=[];for(let a=0;a<3;a++)i=new t.SketchHandle(e,n,r),this.add(i),this._handles.push(i);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0,this._moveHandle=new t.SketchHandle(e,n,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._line2.addEventListener("mouseenter",this.onHover),this._line2.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._line2.removeEventListener("mouseenter",this.onHover),this._line2.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._handles[2].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._domHovered,!this._domHovered||this._handles[1].tracking||this._handles[2].tracking||(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach((e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}))}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this._handles[2].onMove(e),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||!this._handles[1].tracking&&this._handles[2].tracking&&this._handles[1].screenPosition.distanceTo(this._handles[2].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=this._handles[2].tracking,this._moving=!1,this.update())}create(){this.createDOM()}createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._line2=document.createElement("div"),this._line2.className="sketch-line",this._container.appendChild(this._line2),this._label=document.createElement("div"),this._label.className="sketch-label",this._container.appendChild(this._label),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._line2.style.display="none",this._label.style.display="none",this._handles.forEach((e=>e.hideDOM()))}showDOM(){this._line.style.display="",this._line2.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM(),this._handles[2].showDOM()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this._handles[2].update(),this._opangle=180*this._handles[1].worldPosition.clone().sub(this._handles[0].worldPosition).angleTo(this._handles[1].worldPosition.clone().sub(this._handles[2].worldPosition))/Math.PI||0,this._opangle=this._defaultAngle?this._opangle:360-this._opangle,this.updateDOM()}updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[1].screenPosition,this._handles[0].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=this.getLineData(this._handles[1].screenPosition,this._handles[2].screenPosition);this._line2.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0) rotate(${t.transformAngle}rad)`,this._line2.style.width=t.length+"px",this._label.innerHTML=`${this._opangle.toFixed(2)}&deg;`;let n=e.line.clone().add(t.line).normalize().negate(),r=n.angleTo(new THREE.Vector3(1,0,0));r>Math.PI/2&&(r=Math.PI-r);const i=Math.tan(r)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(r)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-r)+15,a=this._handles[1].screenPosition.clone().add(n.multiplyScalar(i)),o=this.adjustLabelTransform(this._label,a);this._label.style.transform=`translate3D(${o.x}px, ${o.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._line2.style.backgroundColor=this._color,this._label.style.borderColor=this._color}free(){this.removeEventListeners(),this._handles.forEach((e=>{this.remove(e),e.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._line2),this._container.removeChild(this._label)}toggleDefaultAngle(){this._defaultAngle=!this._defaultAngle}}Ne.prototype.isSketchAngle=!0,t.SketchAngle=Ne,Object.defineProperties(Ne.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach((t=>t.targetMesh=e)),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._handles[2].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},angle:{get:function(){return this._opangle}}});var Fe=new THREE.Vector3,Oe=new THREE.Vector3,He=new THREE.Vector3;class De extends ke{constructor(e,n,r){let i;super(e,n,r=r||{}),this.name="sketchRectangle",this._sketchType="Rectangle",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,r.stack.frame.length>r.frameIndex?this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units":this._units="units",this._moving=!1,this._domHovered=!1,this._mesh=null,this._rectangle=null,this._label=null,this._handles=[];for(let a=0;a<2;a++)i=new t.SketchHandle(e,n,r),this.add(i),this._handles.push(i);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new t.SketchHandle(e,n,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._rectangle.addEventListener("mouseenter",this.onHover),this._rectangle.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._rectangle.removeEventListener("mouseenter",this.onHover),this._rectangle.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach((e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})),this.updateRoI(!0)}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.updateRoI(),this.update())}hideDOM(){this._handles.forEach((e=>e.hideDOM())),this._rectangle.style.display="none",this._label.style.display="none"}showDOM(){this._handles[0].showDOM(),this._handles[1].showDOM(),this._rectangle.style.display="",this._label.style.display=""}create(){this.createMesh(),this.createDOM()}createMesh(){let e=new THREE.PlaneGeometry(1,1),t=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2});this._mesh=new THREE.Mesh(e,t),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)}createDOM(){this._rectangle=document.createElement("div"),this._rectangle.className="sketch-rectangle",this._container.appendChild(this._rectangle),this._label=document.createElement("div"),this._label.className="sketch-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let n=document.createElement("div");n.className="max-min",e.appendChild(n);let r=document.createElement("div");r.className="area",e.appendChild(r),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)}updateMeshPosition(){if(this._mesh){let n=this._mesh.geometry;const r=He.subVectors(this._handles[1].worldPosition,this._handles[0].worldPosition).projectOnVector(this._camera.up);var e=[];e.push(this._handles[0].worldPosition),e.push(Fe.addVectors(this._handles[0].worldPosition,r)),e.push(Oe.subVectors(this._handles[1].worldPosition,r)),e.push(this._handles[1].worldPosition);var t=n.attributes.position;for(let n=0;n<4;n++)t.setXYZ(n,e[n].x,e[n].y,e[n].z);n.computeBoundingSphere()}}updateRoI(e){const n=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min");if(e)return n.innerHTML="",void(r.innerHTML="");const i=t.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==i?(n.innerHTML=`Mean: ${i.mean.toFixed(1)} / SD: ${i.sd.toFixed(1)}`,r.innerHTML=`Max: ${i.max.toFixed()} / Min: ${i.min.toFixed()}`):(n.innerHTML="",r.innerHTML="")}updateDOMColor(){this._rectangle.style.borderColor=this._color,this._label.style.borderColor=this._color}updateDOM(){this.updateDOMColor();let e=[];if(this._stack.frame.length>this._params.frameIndex&&(e=this._stack.frame[this._params.frameIndex].ultrasoundRegions),this._area=t.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(e&&e.length>0&&this._stack.lps2IJK){const n=this.getRegionByXY(e,t.MedicalUtils.worldToData(this._stack.lps2IJK,this._handles[0].worldPosition)),r=this.getRegionByXY(e,t.MedicalUtils.worldToData(this._stack.lps2IJK,this._handles[1].worldPosition));null!==n&&null!==r&&n===r&&"cm"===e[n].unitsX&&"cm"===e[n].unitsY?(this._area*=Math.pow(e[n].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);"units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the area in cm²"),this._label.style.color=this._colors.error),this._label.querySelector(".area").innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`;const n=this.getRectData(this._handles[0].screenPosition,this._handles[1].screenPosition),r=this.adjustLabelTransform(this._label,this._handles[1].screenPosition.clone().add(n.paddingVector.multiplyScalar(15+this._label.offsetHeight/2)));this._rectangle.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0)`,this._rectangle.style.width=n.width+"px",this._rectangle.style.height=n.height+"px",this._label.style.transform="translate3D("+r.x+"px,"+r.y+"px, 0)"}free(){this.removeEventListeners(),this._handles.forEach((e=>{this.remove(e),e.free()})),this._handles=[],this._container.removeChild(this._rectangle),this._container.removeChild(this._label),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._stack=null}getMeasurements(){return{area:this._area,units:this._units}}}De.prototype.isSketchRectangle=!0,t.SketchRectangle=De,Object.defineProperties(De.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach((t=>t.targetMesh=e)),this.update(),this.updateRoI()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}});class Ue extends ke{constructor(e,n,r){super(e,n,r=r||{}),this.name="sketchPolygon",this._sketchType="Polygon",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._newHandleRequired=!0,this._moving=!1,this._domHovered=!1,this._material=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];let i=new t.SketchHandle(e,n,r);this.add(i),this._handles.push(i),this._moveHandle=new t.SketchHandle(e,n,r),this.add(this._moveHandle),this._moveHandle.hide(),this.onRightClick=this.onRightClick.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()}addEventListeners(){this._container.addEventListener("rightclick",this.onRightClick),this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("rightclick",this.onRightClick),this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(e){e&&this.hoverDom(e);let t=!1;this._handles.forEach((e=>t=t||e.hovered)),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onStart(e){let t=!1;this._handles.forEach((n=>{n.onStart(e),t=t||n.active})),this._initialized&&(this._moveHandle.onMove(e,!0),this._active=t||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update())}onMove(e){let n=!1;if(this.active)if(this._dragged=!0,this._newHandleRequired&&!this._initialized){this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let e=new t.SketchHandle(this._targetMesh,this._controls,this._params);e.hovered=!0,e.active=!0,e.tracking=!0,this.add(e),this._handles.push(e),this.createLine(),this._newHandleRequired=!1}else{const t=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(e,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach((e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}))}this._handles.forEach((t=>{t.onMove(e),n=n||t.hovered})),this._hovered=n||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.update()}onEnd(){let e=this._handles.length,t=!1;!this._initialized&&e>1&&this._handles[e-2].screenPosition.distanceTo(this._handles[e-1].screenPosition)<10||(this._handles.forEach((e=>{e.onEnd(),t=t||e.active})),this._initialized?(this._dragged&&(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach((e=>e.selected=this._selected))),this._active=t||this._handles[e-1].active,this._dragged=!1,this._moving=!1,this.update()):this._newHandleRequired=!0)}onRightClick(){let e=this._handles.length;e<3||this._initialized||e>1&&this._handles[e-2].screenPosition.distanceTo(this._handles[e-1].screenPosition)<10||(this._handles[e-1].tracking=!1,this._handles.forEach((e=>e.onEnd())),this._active=!1,this._dragged=!1,this._moving=!1,this._initialized=!0,this.updateMesh(),this.updateDOMContent(),this.update())}create(){this.createMaterial(),this.createDOM()}createMaterial(){this._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2})}createDOM(){this.createLine(),this._label=document.createElement("div"),this._label.className="sketch-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let n=document.createElement("div");n.className="max-min",e.appendChild(n);let r=document.createElement("div");r.className="area",e.appendChild(r),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()}createLine(){const e=document.createElement("div");e.className="sketch-line",e.addEventListener("mouseenter",this.onHover),e.addEventListener("mouseleave",this.onHover),this._lines.push(e),this._container.appendChild(e)}hideDOM(){this._handles.forEach((e=>e.hideDOM())),this._lines.forEach((e=>e.style.display="none")),this._label.style.display="none"}showDOM(){this._handles.forEach((e=>e.showDOM())),this._lines.forEach((e=>e.style.display="")),this._label.style.display=""}update(){this.updateColor(),this._handles.forEach((e=>e.update())),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()}updateMesh(){let e=[];this._handles.forEach((t=>e.push(t.worldPosition)));let n,r,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=t.MedicalUtils.centerOfMass(e);i.crossVectors(a.subVectors(e[0],s),o.subVectors(e[1],s)),a.subVectors(e[0],s).normalize(),o.crossVectors(a,i).normalize();let l=new THREE.Shape,c=new Float32Array(3*(e.length+1));i.subVectors(e[0],s),n=a.dot(i),r=o.dot(i),l.moveTo(n,r),c.set(e[0].toArray(),0);for(let t=1;t<e.length;t++)i.subVectors(e[t],s),n=a.dot(i),r=o.dot(i),l.lineTo(n,r),c.set(e[t].toArray(),3*t);i.subVectors(e[0],s),n=a.dot(i),r=o.dot(i),l.lineTo(n,r),c.set(e[0].toArray(),3*e.length);let u=new THREE.ShapeBufferGeometry(l,e.length);u.setAttribute("position",new THREE.BufferAttribute(c,3)),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose()),this._mesh=new THREE.Mesh(u,this._material),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)}updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)}updateMeshPosition(){}updateDOMColor(){this._lines.forEach((e=>e.style.backgroundColor=this._color)),this._label.style.borderColor=this._color}updateDOMContent(e){const n=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min"),i=this._label.querySelector(".area");if(e)return n.innerHTML="",r.innerHTML="",void(i.innerHTML="");const a=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=t.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(a&&a.length>0&&this._stack.lps2IJK){let e,n,r=!0;this._handles.forEach((i=>{e=this.getRegionByXY(a,t.MedicalUtils.worldToData(this._stack.lps2IJK,i.worldPosition)),(null===e||"cm"!==a[e].unitsX||void 0!==n&&n!==e)&&(r=!1),n=e})),r?(this._area*=Math.pow(a[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let o="units"===this._units?"Calibration is required to display the area in cm². ":"";""===o||this._label.hasAttribute("title")?""===o&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",o),this._label.style.color=this._colors.error);const s=t.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==s?(n.innerHTML=`Mean: ${s.mean.toFixed(1)} / SD: ${s.sd.toFixed(1)}`,r.innerHTML=`Max: ${s.max.toFixed()} / Min: ${s.min.toFixed()}`):(n.innerHTML="",r.innerHTML=""),i.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`}updateDOMPosition(){let e=null;this._lines.forEach(((t,n)=>{const r=this.getLineData(this._handles[n].screenPosition,this._handles[n+1===this._handles.length?0:n+1].screenPosition);t.style.transform=`translate3D(${r.transformX}px, ${r.transformY}px, 0) rotate(${r.transformAngle}rad)`,t.style.width=r.length+"px",(null===e||e.y<this._handles[n].screenPosition.y)&&(e=this._handles[n].screenPosition.clone())})),this._initialized&&(e.y+=15+this._label.offsetHeight/2,e=this.adjustLabelTransform(this._label,e),this._label.style.transform=`translate3D(${e.x}px, ${e.y}px, 0)`)}free(){this.removeEventListeners(),this._handles.forEach((e=>{this.remove(e),e.free()})),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach((e=>{e.removeEventListener("mouseenter",this.onHover),e.removeEventListener("mouseleave",this.onHover),this._container.removeChild(e)})),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null),this._stack=null}getMeasurements(){return{area:this._area,units:this._units}}}Ue.prototype.isSketchPolygon=!0,t.SketchPolygon=Ue,Object.defineProperties(Ue.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach((t=>t.targetMesh=e)),this._moveHandle.targetMesh=e,this.updateMesh(),this.updateDOMContent(),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach((t=>t.worldPosition.copy(e))),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}});class Be extends ke{constructor(e,n,r){super(e,n,r=r||{}),this.name="sketchFreehand",this._sketchType="Freehand",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._moving=!1,this._domHovered=!1,this._material=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];let i=new t.SketchHandle(e,n,r);this.add(i),this._handles.push(i),this._moveHandle=new t.SketchHandle(e,n,r),this.add(this._moveHandle),this._moveHandle.hide(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(e){e&&this.hoverDom(e);let t=!1;this._handles.forEach((e=>t=t||e.hovered)),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onStart(e){let t=!1;this._moveHandle.onMove(e,!0),this._handles.forEach((n=>{n.onStart(e),t=t||n.active})),this._active=t||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(e){let n=!1;if(this.active)if(this._dragged=!0,this._initialized){const t=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(e,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach((e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}))}else{this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let e=new t.SketchHandle(this._targetMesh,this._controls,this._params);e.hovered=!0,e.active=!0,e.tracking=!0,this.add(e),this._handles.push(e),this.createLine()}this._handles.forEach((t=>{t.onMove(e),n=n||t.hovered})),this._hovered=n||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.active&&this._handles.length>2&&this.pushPopHandle(),this.update()}onEnd(){if(this._handles.length<3)return;let e=!1;this._handles.slice(0,-1).forEach((t=>{t.onEnd(),e=e||t.active})),this._dragged||!this._handles[this._handles.length-1].tracking?(this._handles[this._handles.length-1].tracking=!1,this._handles[this._handles.length-1].onEnd()):this._handles[this._handles.length-1].tracking=!1,this._lines.length<this._handles.length&&this.createLine(),!this._dragged&&this._initialized||(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach((e=>e.selected=this._selected))),this._active=e||this._handles[this._handles.length-1].active,this._dragged=!1,this._moving=!1,this._initialized=!0,this.update()}create(){this.createMaterial(),this.createDOM()}createMaterial(){this._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2})}createDOM(){this._label=document.createElement("div"),this._label.className="sketch-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let n=document.createElement("div");n.className="max-min",e.appendChild(n);let r=document.createElement("div");r.className="area",e.appendChild(r),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()}createLine(){const e=document.createElement("div");e.className="sketch-line",e.addEventListener("mouseenter",this.onHover),e.addEventListener("mouseleave",this.onHover),this._lines.push(e),this._container.appendChild(e)}hideDOM(){this._handles.forEach((e=>e.hideDOM())),this._lines.forEach((e=>e.style.display="none")),this._label.style.display="none"}showDOM(){this._handles.forEach((e=>e.showDOM())),this._lines.forEach((e=>e.style.display="")),this._label.style.display=""}update(){this.updateColor(),this._handles.forEach((e=>e.update())),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()}updateMesh(){let e=[];this._handles.forEach((t=>e.push(t.worldPosition)));let n,r,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=t.MedicalUtils.centerOfMass(e);i.crossVectors(a.subVectors(e[0],s),o.subVectors(e[1],s)),a.subVectors(e[0],s).normalize(),o.crossVectors(a,i).normalize();let l=new THREE.Shape,c=new Float32Array(3*(e.length+1));i.subVectors(e[0],s),n=a.dot(i),r=o.dot(i),l.moveTo(n,r),c.set(e[0].toArray(),0);for(let t=1;t<e.length;t++)i.subVectors(e[t],s),n=a.dot(i),r=o.dot(i),l.lineTo(n,r),c.set(e[t].toArray(),3*t);i.subVectors(e[0],s),n=a.dot(i),r=o.dot(i),l.lineTo(n,r),c.set(e[0].toArray(),3*e.length);let u=new THREE.ShapeBufferGeometry(l,e.length);u.setAttribute("position",new THREE.BufferAttribute(c,3)),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose()),this._mesh=new THREE.Mesh(u,this._material),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)}updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)}updateMeshPosition(){}isPointOnLine(e,t,n){let r=new THREE.Vector3;return r.crossVectors(e.clone().sub(n),t.clone().sub(n)),!r.length()}pushPopHandle(){let e=this._handles[this._handles.length-3],t=this._handles[this._handles.length-2],n=this._handles[this._handles.length-1],r=this.isPointOnLine(e.worldPosition,t.worldPosition,n.worldPosition);return(r||e.screenPosition.distanceTo(n.screenPosition)<25)&&(this.remove(t),t.free(),this._handles[this._handles.length-2]=n,this._handles.pop(),this._container.removeChild(this._lines.pop())),r}updateDOMColor(){this._handles.length>=2&&this._lines.forEach((e=>e.style.backgroundColor=this._color)),this._label.style.borderColor=this._color}updateDOMContent(e){const n=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min"),i=this._label.querySelector(".area");if(e)return n.innerHTML="",r.innerHTML="",void(i.innerHTML="");const a=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=t.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(a&&a.length>0&&this._stack.lps2IJK){let e,n,r=!0;this._handles.forEach((i=>{e=this.getRegionByXY(a,t.MedicalUtils.worldToData(this._stack.lps2IJK,i.worldPosition)),(null===e||"cm"!==a[e].unitsX||void 0!==n&&n!==e)&&(r=!1),n=e})),r?(this._area*=Math.pow(a[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let o="units"===this._units?"Calibration is required to display the area in cm². ":"";""===o||this._label.hasAttribute("title")?""===o&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",o),this._label.style.color=this._colors.error);const s=t.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==s?(n.innerHTML=`Mean: ${s.mean.toFixed(1)} / SD: ${s.sd.toFixed(1)}`,r.innerHTML=`Max: ${s.max.toFixed()} / Min: ${s.min.toFixed()}`):(n.innerHTML="",r.innerHTML=""),i.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`}updateDOMPosition(){if(this._handles.length<2)return;let e=null;this._lines.forEach(((t,n)=>{const r=this.getLineData(this._handles[n].screenPosition,this._handles[n+1===this._handles.length?0:n+1].screenPosition);t.style.transform=`translate3D(${r.transformX}px, ${r.transformY}px, 0) rotate(${r.transformAngle}rad)`,t.style.width=r.length+"px",(null===e||e.y<this._handles[n].screenPosition.y)&&(e=this._handles[n].screenPosition.clone())})),this._initialized&&(e.y+=15+this._label.offsetHeight/2,e=this.adjustLabelTransform(this._label,e),this._label.style.transform=`translate3D(${e.x}px, ${e.y}px, 0)`)}free(){this.removeEventListeners(),this._handles.forEach((e=>{this.remove(e),e.free()})),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach((e=>{e.removeEventListener("mouseenter",this.onHover),e.removeEventListener("mouseleave",this.onHover),this._container.removeChild(e)})),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null),this._stack=null}getMeasurements(){return{area:this._area,units:this._units}}}Be.prototype.isSketchFreehand=!0,t.SketchFreehand=Be,Object.defineProperties(Be.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach((t=>t.targetMesh=e)),this._moveHandle.targetMesh=e,this.updateMesh(),this.updateDOMContent(),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach((t=>t._worldPosition.copy(e))),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}});class ze extends ke{constructor(e,n,r){let i;super(e,n,r=r||{}),this.name="sketchAnnotation",this._sketchType="Annotation",this._initialized=!1,this._movinglabel=null,this._labelmoved=!1,this._labelhovered=!1,this._manuallabeldisplay=!1,this._meshline=null,this._meshCone=null,this._line=null,this._dashline=null,this._label=null,this._labeltext=null,this._labelOffset=new THREE.Vector3,this._mouseLabelOffset=new THREE.Vector3,this._handles=[];for(let a=0;a<2;a++)i=new t.SketchHandle(e,n,r),this.add(i),this._handles.push(i);this._handles[1].active=!0,this.create(),this.initOffsets(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.onHoverlabel=this.onHoverlabel.bind(this),this.notonHoverlabel=this.notonHoverlabel.bind(this),this.changeLabelText=this.changeLabelText.bind(this),this.addEventListeners()}addEventListeners(){this._label.addEventListener("mouseenter",this.onHoverlabel),this._label.addEventListener("mouseleave",this.notonHoverlabel),this._label.addEventListener("dblclick",this.changeLabelText),this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._dashline.addEventListener("mouseenter",this.onHover),this._dashline.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._label.removeEventListener("mouseenter",this.onHoverlabel),this._label.removeEventListener("mouseleave",this.notonHoverlabel),this._label.removeEventListener("dblclick",this.changeLabelText),this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._dashline.removeEventListener("mouseenter",this.onHover),this._dashline.removeEventListener("mouseleave",this.onHover)}onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(e){this._domHovered="mouseenter"===e.type}onHoverlabel(){this._labelhovered=!0,this._container.style.cursor="pointer"}notonHoverlabel(){this._labelhovered=!1,this._container.style.cursor="default"}onStart(e){if(this._labelhovered){const t=this.getMouseOffsets(e,this._container),n=this._handles[1].screenPosition.clone().sub(this._labelOffset);this._mouseLabelOffset=new THREE.Vector3(t.screenX-n.x,t.screenY-n.y,0),this._movinglabel=!0,this._labelmoved=!0}this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._labelhovered,this.update()}onMove(e){if(this._movinglabel){const t=this.getMouseOffsets(e,this._container);this._labelOffset=new THREE.Vector3(this._handles[1].screenPosition.x-t.screenX+this._mouseLabelOffset.x,this._handles[1].screenPosition.y-t.screenY+this._mouseLabelOffset.y,0),this._controls.enabled=!1}this._active&&(this._dragged=!0),this._handles[0].onMove(e),this._handles[1].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._labelhovered,this.update()}onEnd(){this._handles[0].onEnd(),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handles[0].selected=this._selected,this._handles[1].selected=this._selected),this._initialized||(this._labelOffset=this._handles[1].screenPosition.clone().sub(this._handles[0].screenPosition).multiplyScalar(.5),this.setLabelText(),this._initialized=!0),this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._movinglabel=!1,this.update()}setLabelText(){for(;!this._labeltext;)this._labeltext=prompt("Please enter the annotation text.","");this.displayLabel()}changeLabelText(e){e.stopPropagation();let t=this._labeltext;this._labeltext=prompt("Please enter a new annotation text.",this._label.innerHTML),null===this._labeltext&&(this._labeltext=t),this.displayLabel()}displayLabel(){this._label.innerHTML="string"==typeof this._labeltext&&this._labeltext.length>0?this._labeltext:"",this._label.style.display="",this._dashline.style.display="",this._label.style.transform=`translate3D(\n        ${this._handles[1].screenPosition.x-this._labelOffset.x-this._label.offsetWidth/2}px,\n        ${this._handles[1].screenPosition.y-this._labelOffset.y-this._label.offsetHeight/2-this._container.offsetHeight}px, 0)`}create(){this.createMesh(),this.createDOM()}createMesh(){let e=new THREE.LineBasicMaterial,t=[];t.push(this._handles[0].worldPosition),t.push(this._handles[1].worldPosition);let n=(new THREE.BufferGeometry).setFromPoints(t);this._meshline=new THREE.Line(n,e),this._meshline.visible=!0,this.add(this._meshline),n=new THREE.CylinderGeometry(0,2,10),n.translate(0,-5,0),n.rotateX(-Math.PI/2),this._meshCone=new THREE.Mesh(n,e),this._meshCone.visible=!0,this.add(this._meshCone),this.updateMeshColor()}createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._dashline=document.createElement("div"),this._dashline.className="sketch-dashline",this._dashline.style.display="none",this._container.appendChild(this._dashline),this._label=document.createElement("div"),this._label.className="sketch-label",this._label.style.display="none",this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._meshline&&this._meshline.material.color.set(this._color)}updateMeshPosition(){this._meshline&&(this._meshline.geometry.verticesNeedUpdate=!0),this._meshCone&&(this._meshCone.position.copy(this._handles[1].worldPosition),this._meshCone.lookAt(this._handles[0].worldPosition))}updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=e.line.multiplyScalar(.5),n=this._handles[1].screenPosition.clone().sub(this._labelmoved?this._labelOffset:t),r=this.adjustLabelTransform(this._label,n);this._label.style.transform=`translate3D(${r.x}px, ${r.y}px, 0)`,this._manuallabeldisplay&&this.displayLabel();let i=this.getLineData(this._handles[0].screenPosition,n),a=this.getLineData(e.center,n),o=this.getLineData(this._handles[1].screenPosition,n);i.length>a.length&&(i=a),i.length>o.length&&(i=o),this._dashline.style.transform=`translate3D(${i.transformX}px, ${i.transformY}px, 0) rotate(${i.transformAngle}rad)`,this._dashline.style.width=i.length+"px"}updateDOMColor(){this._line.style.backgroundColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color,this._label.style.borderColor=this._color}hideDOM(){this._line.style.display="none",this._dashline.style.display="none",this._label.style.display="none",this._handles.forEach((e=>e.hideDOM()))}showDOM(){this._line.style.display="",this._dashline.style.display="",this._label.style.display="",this._handles.forEach((e=>e.showDOM()))}free(){this.removeEventListeners(),this._handles.forEach((e=>{this.remove(e),e.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._dashline),this._container.removeChild(this._label),this.remove(this._meshline),this._meshline.geometry.dispose(),this._meshline.material.dispose(),this._meshline=null,this.remove(this._meshCone),this._meshCone.geometry.dispose(),this._meshCone=null}}ze.prototype.isSketchAnnotation=!0,t.SketchAnnotation=ze,Object.defineProperties(ze.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach((t=>t.targetMesh=e)),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}}}),t.removeMedicalWorkspace=function(e){e=void 0===e||e;var n=t.medicalWorker;n.workspace="",!0===e&&n.stack&&(n.stack.dispose(),n.stack=null),n.medical&&(t.dispose(n.medical),n.medical=null,n.sketches=[]),n.medicalDom&&(t.removeHTMLElement(n.medicalDom),n.medicalDom=null,n.elements=[])},t.createMedicalWorkspace=function(e,n,r){t.hideFlashtext();var i=t.medicalWorker;i.stack=e,i.workspace=n||"quadWorkspace","quadWorkspace"===i.workspace?function(e){var n=t.medicalWorker;n.prepareStack(e);var[r,i,a]=n.getMedicalSlicers(e),o=n.getMedicalVolume(e),s=new THREE.Object3D,l=n.getStackCenter(e),c=1.2*n.getStackSize(e),u=n.getAppWorks(),h=u.width,d=u.height,f=~~(h/2),p=~~(d/2),m=new THREE.Object3D;m.name="medical",t.add(m);var g=document.createElement("div");g.id="medicalDom",g.style.cssText="position:absolute; top:0; width:100%; height:100%; overflow:hidden; z-index:0;",u.dom.appendChild(g),n.workspace="quadWorkspace",n.medical=m,n.medicalDom=g,n.stackSize=c;for(var v="\n        z-index: 1;\n        color: #fff;\n        font-size: 16px;\n        position: absolute;\n        padding: 4px;\n        border-radius: 50%;\n        width: 18px;\n        height: 18px;\n        text-align: center;\n        vertical-align: middle;\n        line-height: 18px;\n        background-color: rgba(0, 0, 0, 0.3);\n    ",y="position: relative; display: inline-block; margin-bottom: -4px; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",_=`<div class="scene" style="width: ${f}px; height: ${p}px;"></div>\n        <div id="leftLabel" style="${v}"></div>\n        <div id="rightLabel" style="${v}"></div>\n        <div id="topLabel" style="${v}"></div>\n        <div id="bottomLabel" style="${v}"></div>`,b={0:["L","R","A","P"],2:["A","P","S","I"],3:["R","L","S","I"]},E=0;E<4;E++){var w=new THREE.Scene;switch(w.name="scene"+E,E){case 0:w.add(a);break;case 1:w.add(o),w.children.push(a),w.children.push(r),w.children.push(i),w.children.push(s);break;case 2:w.add(r);break;case 3:w.add(i)}var x=document.createElement("div");x.style.cssText=y,x.innerHTML=_,N(x,E),g.appendChild(x);var T,A=x.querySelector(".scene");if(A.id=E,w.userData.element=A,n.elements.push(A),1===E){var M=(L=A.getBoundingClientRect()).width/L.height,S=50,R=.1,k=10*c,P=new THREE.PerspectiveCamera(S,M,R,k);w.userData.camera=P,P.up.set(0,0,1),P.position.copy(l),P.position.y-=c,P.lookAt(l),o.uniforms.uCameraNear.value=P.near,o.uniforms.uCameraFar.value=P.far}else{R=.1,k=2*c;var L,C=c,I=c*(M=(L=A.getBoundingClientRect()).width/L.height);P=new THREE.OrthographicCamera(-I/2,I/2,C/2,-C/2,R,k);switch(w.userData.camera=P,E){case 0:P.up.set(0,-1,0),P.position.copy(l),P.position.z+=c;break;case 2:P.up.set(0,0,1),P.position.copy(l),P.position.x+=c;break;case 3:P.up.set(0,0,1),P.position.copy(l),P.position.y-=c}P.lookAt(l)}if(1===E)(T=new THREE.TrackballControls(P,A)).target.copy(l),T.panSpeed=.3,T.rotateSpeed=2,T.zoomSpeed=1.2,T.dynamicDampingFactor=.3,w.userData.controls=T,T.addEventListener("start",(e=>{let n=t.medicalWorker;if(n.elementDblClicked){t.appWorks.renderer.setPixelRatio(.5*window.devicePixelRatio),n.volumeSteps=o.uniforms.uSteps.value,o.uniforms.uSteps.value=Math.min(o.uniforms.uSteps.value,128)}})),T.addEventListener("end",(e=>{let n=t.medicalWorker;if(n.elementDblClicked){let e=t.appWorks.renderer;e.setPixelRatio(.75*window.devicePixelRatio),setTimeout((()=>{e.setPixelRatio(window.devicePixelRatio)}),100),o.uniforms.uSteps.value=n.volumeSteps}}));else(T=new THREE.OrthographicTrackballControls(P,A)).target.copy(l),T.panSpeed=.3,T.rotateSpeed=1,T.zoomSpeed=1.2,T.dynamicDampingFactor=.3,T.noRotate=!0,w.userData.controls=T;A.addEventListener("mouseenter",n.onMouseEnter,!1),A.addEventListener("mouseleave",n.onMouseLeave,!1),A.addEventListener("click",n.onClick,!1),A.addEventListener("dblclick",n.onDoubleClick,!1),A.addEventListener("mousedown",n.onMouseDown,!1),A.addEventListener("mouseup",n.onMouseUp,!1),A.addEventListener("mousemove",n.onMouseMove,!1),window.addEventListener("resize",n.onWindowResize,!1),m.add(w)}function N(e,t){let n;if(1===t)return n=e.querySelector("#leftLabel"),n.remove(),n=e.querySelector("#rightLabel"),n.remove(),n=e.querySelector("#topLabel"),n.remove(),n=e.querySelector("#bottomLabel"),void n.remove();n=e.querySelector("#leftLabel"),n.style.left="0",n.style.top="50%",n.textContent=b[t][0],n=e.querySelector("#rightLabel"),n.style.right="0",n.style.top="50%",n.textContent=b[t][1],n=e.querySelector("#topLabel"),n.style.top="0",n.style.left="50%",n.textContent=b[t][2],n=e.querySelector("#bottomLabel"),n.style.bottom="0",n.style.left="50%",n.textContent=b[t][3]}u.signals.initSidebar.dispatch(n),m.update=function(e,t){n.onUpdateMedical(e,t)}}(e):"slicesWorkspace"===i.workspace&&function(e,n){n=void 0!==n?n:2;var r=t.medicalWorker;r.prepareStack(e);var i,a,[o,s,l]=e.worldSliceOrientation(),c=e.dimensionsIJK,u=e.worldCenter(),h=r.getStackSize(e),d=200,f=200;switch(n){case 0:i=o;break;case 1:i=s;break;case 2:i=l}switch(i){case 0:a=c.x-1;break;case 1:a=c.y-1;break;case 2:a=c.z-1}var p=new THREE.Vector3,m=new THREE.Vector3;switch(n){case 0:p.set(0,0,1),m.copy(u),m.x+=h;break;case 1:p.set(0,0,1),m.copy(u),m.y-=h;break;case 2:p.set(0,-1,0),m.copy(u),m.z+=h}var g=r.getAppWorks(),v=new THREE.Object3D;v.name="medical",t.add(v),document.body.style.backgroundColor="black";var y=document.createElement("div");y.id="medicalDom",y.style.cssText="position:absolute; top:0; width:100%; height:100%; text-align:center; overflow:auto; z-index:0;",g.dom.appendChild(y),r.workspace="slicesWorkspace",r.medical=v,r.medicalDom=y,r.stackSize=h;for(var _="position: relative; display: inline-block; margin-bottom: -4px; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",b=`<div class="scene" style="width: ${d}px; height: ${f}px;"></div>\n        <div id="index" style="\n        color: #fff;\n        font-size: 12px;\n        position: absolute;\n        left: 0;\n        top: 0;\n    "></div>`,o=0;o<=a;o++){var E=new THREE.Scene;E.name="scene"+o;var w=new t.MedicalSlicer(e);w.name="slicer"+o,w.bbox.visible=!1,w.border.visible=!1,w.worldAxis=n,w.orientation=i,w.index=o,E.add(w);var x=document.createElement("div");x.style.cssText=_,x.innerHTML=b,x.querySelector("#index").textContent=w.index.toString(),y.appendChild(x);var T=x.querySelector(".scene");T.id=o,E.userData.element=T,r.elements.push(T);var A=T.getBoundingClientRect(),M=.1,S=2*h,R=h,k=h*(A.width/A.height),P=new THREE.OrthographicCamera(-k/2,k/2,R/2,-R/2,M,S);E.userData.camera=P,P.up.copy(p),P.position.copy(m),P.lookAt(u);var L=new THREE.OrthographicTrackballControls(P,T);L.target.copy(u),L.panSpeed=.3,L.rotateSpeed=1,L.zoomSpeed=1.2,L.dynamicDampingFactor=.3,L.noRotate=!0,L.enabled=!1,E.userData.controls=L,T.addEventListener("mouseenter",r.onMouseEnter,!1),T.addEventListener("mouseleave",r.onMouseLeave,!1),T.addEventListener("click",r.onClick,!1),T.addEventListener("dblclick",r.onDoubleClick,!1),T.addEventListener("mousedown",r.onMouseDown,!1),T.addEventListener("mouseup",r.onMouseUp,!1),T.addEventListener("mousemove",r.onMouseMove,!1),window.addEventListener("resize",r.onWindowResize,!1),v.add(E)}g.signals.initSidebar.dispatch(r),v.update=function(e,t){r.onUpdateMedical(e,t)}}(e,r)};var Ve={Element:function(e){this.dom=e}};Ve.Element.prototype={add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof Ve.Element?this.dom.appendChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof Ve.Element?this.dom.removeChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},clear:function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)},setId:function(e){return this.dom.id=e,this},setClass:function(e){return this.dom.className=e,this},setStyle:function(e,t){for(var n=0;n<t.length;n++)this.dom.style[e]=t[n];return this},setDisabled:function(e){return this.dom.disabled=e,this},setTextContent:function(e){return this.dom.textContent=e,this}};["position","left","top","right","bottom","width","height","maxHeight","display","overflow","border","borderWidth","borderLeft","borderTop","borderRight","borderBottom","borderRadius","borderColor","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","verticalAlign","textAlign","textDecoration","textTransform","textShadow","cursor","zIndex","transform","transition","lineHeight","visibility","textIndent","wordBreak","boxShadow"].forEach((function(e){var t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);Ve.Element.prototype[t]=function(){return this.setStyle(e,arguments),this}}));var je;["KeyDown","KeyUp","MouseDown","MouseUp","MouseEnter","MouseLeave","MouseOver","MouseOut","Click","DblClick","Change","Input"].forEach((function(e){var t="on"+e;Ve.Element.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this),!1),this}})),Ve.Span=function(){return Ve.Element.call(this),this.dom=document.createElement("span"),this},Ve.Span.prototype=Object.create(Ve.Element.prototype),Ve.Span.prototype.constructor=Ve.Span,Ve.Div=function(){return Ve.Element.call(this),this.dom=document.createElement("div"),this},Ve.Div.prototype=Object.create(Ve.Element.prototype),Ve.Div.prototype.constructor=Ve.Div,Ve.Row=function(){Ve.Element.call(this);var e=document.createElement("div");return e.className="Row",this.dom=e,this},Ve.Row.prototype=Object.create(Ve.Element.prototype),Ve.Row.prototype.constructor=Ve.Row,Ve.Column=function(){Ve.Element.call(this);var e=document.createElement("div");return e.className="Column",this.dom=e,this},Ve.Column.prototype=Object.create(Ve.Element.prototype),Ve.Column.prototype.constructor=Ve.Column,Ve.Panel=function(){Ve.Element.call(this);var e=document.createElement("div");return e.className="Panel",this.dom=e,this},Ve.Panel.prototype=Object.create(Ve.Element.prototype),Ve.Panel.prototype.constructor=Ve.Panel,Ve.Text=function(e){Ve.Element.call(this);var t=document.createElement("span");return t.className="Text",t.style.cursor="default",t.style.display="inline-block",t.style.verticalAlign="middle",this.dom=t,this.setValue(e),this},Ve.Text.prototype=Object.create(Ve.Element.prototype),Ve.Text.prototype.constructor=Ve.Text,Ve.Text.prototype.getValue=function(){return this.dom.textContent},Ve.Text.prototype.setValue=function(e){return void 0!==e&&(this.dom.textContent=e),this},Ve.Input=function(e){Ve.Element.call(this);var t=document.createElement("input");return t.className="Input",t.style.padding="2px",t.style.border="1px solid transparent",t.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.dom=t,this.setValue(e),this},Ve.Input.prototype=Object.create(Ve.Element.prototype),Ve.Input.prototype.constructor=Ve.Input,Ve.Input.prototype.getValue=function(){return this.dom.value},Ve.Input.prototype.setValue=function(e){return this.dom.value=e,this},Ve.TextArea=function(){Ve.Element.call(this);var e=document.createElement("textarea");return e.className="TextArea",e.style.padding="2px",e.spellcheck=!1,e.addEventListener("keydown",(function(t){if(t.stopPropagation(),9===t.keyCode){t.preventDefault();var n=e.selectionStart;e.value=e.value.substring(0,n)+"\t"+e.value.substring(n),e.selectionStart=n+1,e.selectionEnd=e.selectionStart}}),!1),this.dom=e,this},Ve.TextArea.prototype=Object.create(Ve.Element.prototype),Ve.TextArea.prototype.constructor=Ve.TextArea,Ve.TextArea.prototype.getValue=function(){return this.dom.value},Ve.TextArea.prototype.setValue=function(e){return this.dom.value=e,this},Ve.Select=function(){Ve.Element.call(this);var e=document.createElement("select");return e.className="Select",e.style.padding="2px",this.dom=e,this},Ve.Select.prototype=Object.create(Ve.Element.prototype),Ve.Select.prototype.constructor=Ve.Select,Ve.Select.prototype.setMultiple=function(e){return this.dom.multiple=e,this},Ve.Select.prototype.setOptions=function(e){for(var t=this.dom.value;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var n in e){var r=document.createElement("option");r.value=n,r.innerHTML=e[n],this.dom.appendChild(r)}return this.dom.value=t,this},Ve.Select.prototype.getValue=function(){return this.dom.value},Ve.Select.prototype.setValue=function(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this},Ve.Checkbox=function(e){Ve.Element.call(this);var t=document.createElement("input");return t.className="Checkbox",t.type="checkbox",this.dom=t,this.setValue(e),this},Ve.Checkbox.prototype=Object.create(Ve.Element.prototype),Ve.Checkbox.prototype.constructor=Ve.Checkbox,Ve.Checkbox.prototype.getValue=function(){return this.dom.checked},Ve.Checkbox.prototype.setValue=function(e){return void 0!==e&&(this.dom.checked=e),this},Ve.Color=function(){Ve.Element.call(this);var e=document.createElement("input");e.className="Color",e.style.width="64px",e.style.height="17px",e.style.border="0px",e.style.padding="2px",e.style.backgroundColor="transparent";try{e.type="color",e.value="#ffffff"}catch(e){}return this.dom=e,this},Ve.Color.prototype=Object.create(Ve.Element.prototype),Ve.Color.prototype.constructor=Ve.Color,Ve.Color.prototype.getValue=function(){return this.dom.value},Ve.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},Ve.Color.prototype.setValue=function(e){return this.dom.value=e,this},Ve.Color.prototype.setHexValue=function(e){return this.dom.value="#"+("000000"+e.toString(16)).slice(-6),this},Ve.Number=function(e){Ve.Element.call(this);var t=this,n=document.createElement("input");n.className="Number",n.value="0.00",n.addEventListener("keydown",(function(e){e.stopPropagation(),13===e.keyCode&&n.blur()}),!1),this.value=0,this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.unit="",this.dom=n,this.setValue(e);var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var c=a+i/(e.shiftKey?5:50)*t.step;l!==(c=Math.min(t.max,Math.max(t.min,c)))&&(t.setValue(c),n.dispatchEvent(r)),s=[e.clientX,e.clientY]}function c(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",c,!1),Math.abs(i)<2&&(n.focus(),n.select())}function u(e){var l=t.value;o=[e.touches[0].pageX,e.touches[0].pageY],i+=o[0]-s[0]-(o[1]-s[1]);var c=a+i/(e.shiftKey?5:50)*t.step;l!==(c=Math.min(t.max,Math.max(t.min,c)))&&(t.setValue(c),n.dispatchEvent(r)),s=[e.touches[0].pageX,e.touches[0].pageY]}function h(e){0===e.touches.length&&(document.removeEventListener("touchmove",u,!1),document.removeEventListener("touchend",h,!1))}function d(e){n.style.backgroundColor="transparent",n.style.cursor="col-resize"}return d(),n.addEventListener("mousedown",(function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",c,!1)}),!1),n.addEventListener("touchstart",(function(e){1===e.touches.length&&(i=0,a=t.value,s=[e.touches[0].pageX,e.touches[0].pageY],document.addEventListener("touchmove",u,!1),document.addEventListener("touchend",h,!1))}),!1),n.addEventListener("change",(function(e){t.setValue(n.value)}),!1),n.addEventListener("focus",(function(e){n.style.backgroundColor="",n.style.cursor=""}),!1),n.addEventListener("blur",d,!1),this},Ve.Number.prototype=Object.create(Ve.Element.prototype),Ve.Number.prototype.constructor=Ve.Number,Ve.Number.prototype.getValue=function(){return this.value},Ve.Number.prototype.setValue=function(e){return void 0!==e&&((e=parseFloat(e))<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,this.dom.value=e.toFixed(this.precision),""!==this.unit&&(this.dom.value+=" "+this.unit)),this},Ve.Number.prototype.setPrecision=function(e){return this.precision=e,this},Ve.Number.prototype.setStep=function(e){return this.step=e,this},Ve.Number.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},Ve.Number.prototype.setUnit=function(e){return this.unit=e,this},Ve.Integer=function(e){Ve.Element.call(this);var t=this,n=document.createElement("input");n.className="Number",n.value="0",n.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.value=0,this.min=-1/0,this.max=1/0,this.step=1,this.dom=n,this.setValue(e);var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var c=a+i/(e.shiftKey?5:50)*t.step;l!==(c=0|Math.min(t.max,Math.max(t.min,c)))&&(t.setValue(c),n.dispatchEvent(r)),s=[e.clientX,e.clientY]}function c(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",c,!1),Math.abs(i)<2&&(n.focus(),n.select())}function u(e){n.style.backgroundColor="transparent",n.style.cursor="col-resize"}return u(),n.addEventListener("mousedown",(function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",c,!1)}),!1),n.addEventListener("change",(function(e){t.setValue(n.value)}),!1),n.addEventListener("focus",(function(e){n.style.backgroundColor="",n.style.cursor=""}),!1),n.addEventListener("blur",u,!1),this},Ve.Integer.prototype=Object.create(Ve.Element.prototype),Ve.Integer.prototype.constructor=Ve.Integer,Ve.Integer.prototype.getValue=function(){return this.value},Ve.Integer.prototype.setValue=function(e){return void 0!==e&&(e=parseInt(e),this.value=e,this.dom.value=e),this},Ve.Integer.prototype.setStep=function(e){return this.step=parseInt(e),this},Ve.Integer.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},Ve.Break=function(){Ve.Element.call(this);var e=document.createElement("br");return e.className="Break",this.dom=e,this},Ve.Break.prototype=Object.create(Ve.Element.prototype),Ve.Break.prototype.constructor=Ve.Break,Ve.HorizontalRule=function(){Ve.Element.call(this);var e=document.createElement("hr");return e.className="HorizontalRule",this.dom=e,this},Ve.HorizontalRule.prototype=Object.create(Ve.Element.prototype),Ve.HorizontalRule.prototype.constructor=Ve.HorizontalRule,Ve.Button=function(e){Ve.Element.call(this);var t=document.createElement("button");return t.className="Button",this.dom=t,this.dom.textContent=e,this},Ve.Button.prototype=Object.create(Ve.Element.prototype),Ve.Button.prototype.constructor=Ve.Button,Ve.Button.prototype.setLabel=function(e){return this.dom.textContent=e,this},Ve.TabbedPanel=function(){Ve.Element.call(this);var e=document.createElement("div");return this.dom=e,this.setClass("TabbedPanel"),this.tabs=[],this.panels=[],this.tabsDiv=new Ve.Div,this.tabsDiv.setClass("Tabs"),this.panelsDiv=new Ve.Div,this.panelsDiv.setClass("Panels"),this.add(this.tabsDiv),this.add(this.panelsDiv),this.selected="",this},Ve.TabbedPanel.prototype=Object.create(Ve.Element.prototype),Ve.TabbedPanel.prototype.constructor=Ve.TabbedPanel,Ve.TabbedPanel.prototype.select=function(e){var t,n,r=this;return this.selected&&this.selected.length&&(t=this.tabs.find((function(e){return e.dom.id===r.selected})),n=this.panels.find((function(e){return e.dom.id===r.selected})),t&&t.removeClass("selected"),n&&n.setDisplay("none")),t=this.tabs.find((function(t){return t.dom.id===e})),n=this.panels.find((function(t){return t.dom.id===e})),t&&t.addClass("selected"),n&&n.setDisplay(""),this.selected=e,this},Ve.TabbedPanel.prototype.addTab=function(e,t,n){var r=new Ve.TabbedPanel.Tab(t,this);r.setId(e),this.tabs.push(r),this.tabsDiv.add(r);var i=new Ve.Div;i.setId(e),i.add(n),i.setDisplay("none"),this.panels.push(i),this.panelsDiv.add(i),this.select(e)},Ve.TabbedPanel.Tab=function(e,t){Ve.Text.call(this,e),this.parent=t,this.setClass("Tab");var n=this;return this.dom.addEventListener("click",(function(e){n.parent.select(n.dom.id)})),this},Ve.TabbedPanel.Tab.prototype=Object.create(Ve.Text.prototype),Ve.TabbedPanel.Tab.prototype.constructor=Ve.TabbedPanel.Tab,Ve.Listbox=function(){Ve.Element.call(this);var e=document.createElement("div");return e.className="Listbox",e.tabIndex=0,this.dom=e,this.items=[],this.listitems=[],this.selectedIndex=0,this.selectedValue=null,this},Ve.Listbox.prototype=Object.create(Ve.Element.prototype),Ve.Listbox.prototype.constructor=Ve.Listbox,Ve.Listbox.prototype.setItems=function(e){Array.isArray(e)&&(this.items=e),this.render()},Ve.Listbox.prototype.render=function(){for(;this.listitems.length;){(t=this.listitems[0]).dom.remove(),this.listitems.splice(0,1)}for(var e=0;e<this.items.length;e++){var t=this.items[e],n=new Ve.Listbox.ListboxItem(this);n.setId(t.id||`Listbox-${e}`),n.setTextContent(t.name||t.type),this.add(n)}},Ve.Listbox.prototype.add=function(){var e=Array.from(arguments);this.listitems=this.listitems.concat(e),Ve.Element.prototype.add.apply(this,e)},Ve.Listbox.prototype.selectIndex=function(e){e>=0&&e<this.items.length&&this.setValue(this.listitems[e].getId()),this.selectedIndex=e},Ve.Listbox.prototype.getValue=function(){return this.selectedValue},Ve.Listbox.prototype.setValue=function(e){for(var t=0;t<this.listitems.length;t++){var n=this.listitems[t];n.getId()===e?n.addClass("active"):n.removeClass("active")}this.selectedValue=e;var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0),this.dom.dispatchEvent(r)},Ve.Listbox.ListboxItem=function(e){Ve.Element.call(this);var t=document.createElement("div");t.className="ListboxItem",this.parent=e,this.dom=t;var n=this;return t.addEventListener("click",(function(){n.parent&&n.parent.setValue(n.getId())}),!1),this},Ve.Listbox.ListboxItem.prototype=Object.create(Ve.Element.prototype),Ve.Listbox.ListboxItem.prototype.constructor=Ve.Listbox.ListboxItem,Ve.Image=function(e){Ve.Element.call(this);var t=document.createElement("img");return t.className="Image",t.src=e,this.dom=t,this},Ve.Image.prototype=Object.create(Ve.Element.prototype),Ve.Image.prototype.constructor=Ve.Image,Ve.Tooltip=function(e){Ve.Element.call(this);var t=document.createElement("span");return t.setAttribute("data-tooltip",e),t.setAttribute("data-tooltip-position","top"),this.dom=t,this},Ve.Tooltip.prototype=Object.create(Ve.Element.prototype),Ve.Tooltip.prototype.constructor=Ve.Tooltip,Ve.Modal=function(){var e=this,t=document.createElement("div");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.display="none",t.style.alignItems="center",t.style.justifyContent="center",t.addEventListener("click",(function(t){e.hide()})),this.dom=t,this.container=new Ve.Panel,this.container.dom.style.width="200px",this.container.dom.style.padding="20px",this.container.dom.style.backgroundColor="#ffffff",this.container.dom.style.boxShadow="0px 5px 10px rgba(0,0,0,0.5)",this.add(this.container),this},Ve.Modal.prototype=Object.create(Ve.Element.prototype),Ve.Modal.prototype.constructor=Ve.Modal,Ve.Modal.prototype.show=function(e){return this.container.clear(),this.container.add(e),this.dom.style.display="flex",this},Ve.Modal.prototype.hide=function(){return this.dom.style.display="none",this},Ve.Texture=function(e){Ve.Element.call(this);var t=this,n=document.createElement("span"),r=document.createElement("form"),i=document.createElement("input");i.type="file",i.addEventListener("change",(function(e){o(e.target.files[0])})),r.appendChild(i);var a=document.createElement("canvas");function o(n){var i=n.name.split(".").pop().toLowerCase(),a=new FileReader;"hdr"===i?(a.addEventListener("load",(function(e){(new RGBELoader).setDataType(THREE.UnsignedByteType).load(e.target.result,(function(e){e.sourceFile=n.name,e.isHDRTexture=!0,t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e)}))})),a.readAsDataURL(n)):"tga"===i?(a.addEventListener("load",(function(r){var i=(new TGALoader).parse(r.target.result),a=new THREE.CanvasTexture(i,e);a.sourceFile=n.name,t.setValue(a),t.onChangeCallback&&t.onChangeCallback(a)}),!1),a.readAsArrayBuffer(n)):n.type.match("image.*")&&(a.addEventListener("load",(function(r){var i=document.createElement("img");i.addEventListener("load",(function(){var r=new THREE.Texture(this,e);r.sourceFile=n.name,r.format="image/jpeg"===n.type?THREE.RGBFormat:THREE.RGBAFormat,r.needsUpdate=!0,t.setValue(r),t.onChangeCallback&&t.onChangeCallback(r)}),!1),i.src=r.target.result}),!1),a.readAsDataURL(n)),r.reset()}return a.width=50,a.height=50,a.style.cursor="pointer",a.style.marginRight="5px",a.style.border="1px solid #888",a.addEventListener("click",(function(e){i.click()}),!1),a.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()}),!1),a.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),o(e.dataTransfer.files[0])}),!1),n.appendChild(a),this.dom=n,this.texture=null,this.onChangeCallback=null,this},Ve.Texture.prototype=Object.create(Ve.Element.prototype),Ve.Texture.prototype.constructor=Ve.Texture,Ve.Texture.prototype.getValue=function(){return this.texture},Ve.Texture.prototype.setValue=function(e){var t=this.dom.children[0],n=t.getContext("2d");if(n&&n.clearRect(0,0,t.width,t.height),null!==e){if(void 0===e.sourceFile)return void(this.texture=e);var r=e.isCubeTexture?e.image[0]:e.image;if(void 0!==r&&r.width>0){t.title=e.sourceFile;var i=t.width/r.width;if(void 0===r.data)n.drawImage(r,0,0,r.width*i,r.height*i);else{var a=function(e){void 0===je&&(je=new THREE.WebGLRenderer({canvas:new OffscreenCanvas(1,1)}));var t=e.image;je.setSize(t.width,t.height,!1),je.toneMapping=THREE.ReinhardToneMapping,je.toneMappingExposure=2,je.outputEncoding=THREE.sRGBEncoding;var n=new THREE.Scene,r=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=new THREE.MeshBasicMaterial({map:e}),a=new THREE.PlaneBufferGeometry(2,2),o=new THREE.Mesh(a,i);return n.add(o),je.render(n,r),je.domElement}(e);n.drawImage(a,0,0,r.width*i,r.height*i)}}else t.title=e.sourceFile+" (error)"}else t.title="empty";this.texture=e},Ve.Texture.prototype.setEncoding=function(e){var t=this.getValue();return null!==t&&(t.encoding=e),this},Ve.Texture.prototype.onChange=function(e){return this.onChangeCallback=e,this},Ve.Tree=function(e){Ve.Element.call(this);var t=this;this.appWorks=e;var n=document.createElement("div");return n.className="Tree",n.tabIndex=0,n.addEventListener("keydown",(function(e){switch(e.keyCode){case 38:case 40:e.preventDefault(),e.stopPropagation()}}),!1),n.addEventListener("keyup",(function(e){switch(e.keyCode){case 38:t.selectIndex(t.selectedIndex-1);break;case 40:t.selectIndex(t.selectedIndex+1)}}),!1),this.dom=n,this.items=[],this.selectedIndex=-1,this},Ve.Tree.prototype=Object.create(Ve.Element.prototype),Ve.Tree.prototype.constructor=Ve.Tree,Ve.Tree.prototype.selectIndex=function(e){e>=0&&e<this.items.length&&(this.selectedIndex=e,this.appWorks.selectById(parseInt(this.items[e].id)))},Ve.Tree.prototype.clean=function(e,t){for(var n=this.items,r=0,i=n.length;r<i;r++)n[r].classList.toggle(e,t)},Ve.Tree.prototype.toggle=function(e,t,n){e.forEach((function(e){var r=document.getElementById(e);r&&r.classList.toggle(t,n)}))},Ve.Tree.prototype.setInnerHTML=function(e){for(var t=this.appWorks;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);this.dom.innerHTML=e;for(var n,r,i,a=this.dom.getElementsByClassName("box"),o=0;o<a.length;o++){(w=a[o]).addEventListener("click",(function(e){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("check-box")}))}function s(e){e.stopPropagation();var n=void 0;e.ctrlKey?n="multiple":e.altKey&&(n="ancestor"),t.selectById(parseInt(this.id),n)}function l(e){e.stopPropagation(),e.preventDefault(),t.selectById(parseInt(this.id)),t.guiContextMenu.toggle(e)}function c(e){e.preventDefault(),n&&clearTimeout(n),t.mouseMovePosition.copy(t.getMousePosition(e))}function u(e){e.preventDefault(),r||(t.selectById(parseInt(this.id)),n=setTimeout(d,500,e),r=!0,t.mouseDownPosition.copy(t.getMousePosition(e)),document.addEventListener("touchend",h,!1))}function h(e){n&&(clearTimeout(n),r=!1),t.mouseUpPosition.copy(t.getMousePosition(e)),document.removeEventListener("touchend",h,!1)}function d(e){e.stopPropagation(),e.preventDefault(),t.guiContextMenu.toggle(e)}function f(e){i=this,e.stopPropagation()}function p(e){e.dataTransfer.setData("text","foo"),e.stopPropagation()}function m(e){if(this!==i){var t=e.offsetY/this.clientHeight;this.className=t<.25?"dragTop":t>.75?"dragBottom":"drag",e.preventDefault()}}function g(){this!==i&&(this.className="")}function v(e){if(this!==i){this.className="";var n=t.scene,r=n.getObjectById(parseInt(i.id));if(void 0!==r){var a=e.offsetY/this.clientHeight;if(a<.25)y(r,(o=n.getObjectById(parseInt(this.id))).parent,o);else if(a>.75){var o;y(r,(o=n.getObjectById(parseInt(this.nextSibling.id))).parent,o)}else{y(r,n.getObjectById(parseInt(this.id)))}e.stopPropagation()}}}function y(e,n,r){if(null!==n){null===r&&(r=void 0);var i=!1;e.traverse((function(e){e===n&&(i=!0)})),i||t.move(e,n,r)}}var _=this.dom.getElementsByTagName("li");this.items=_;var b=this.appWorks.scene.id.toString(),E=this.appWorks.camera.id.toString();for(o=0;o<_.length;o++){var w;(w=_[o]).className="",w.addEventListener("click",s,!1),w.addEventListener("contextmenu",l,!1),w.addEventListener("touchmove",c,!0),w.addEventListener("touchstart",u,!1),w.id===b||w.id===E?w.draggable=!1:(w.draggable=!0,w.addEventListener("drag",f,!1),w.addEventListener("dragstart",p,!1),w.addEventListener("dragover",m,!1),w.addEventListener("dragleave",g,!1),w.addEventListener("drop",v,!1))}var x=t.selectObjects.map((function(e){return e.id.toString()}));this.clean("selected",!1),this.toggle(x,"selected",!0);x=[];return t.scene.traverse((function(e){!1===e.visible&&x.push(e.id.toString())})),this.clean("translucent",!1),this.toggle(x,"translucent",!0),this},Ve.Boolean=function(e,t){Ve.Span.call(this),this.setMarginRight("10px"),this.checkbox=new Ve.Checkbox(e),this.text=new Ve.Text(t).setMarginLeft("3px"),this.add(this.checkbox),this.add(this.text)},Ve.Boolean.prototype=Object.create(Ve.Span.prototype),Ve.Boolean.prototype.constructor=Ve.Boolean,Ve.Boolean.prototype.getValue=function(){return this.checkbox.getValue()},Ve.Boolean.prototype.setValue=function(e){return this.checkbox.setValue(e)},t.createMedicalGUI=function(e){return(e=e||t.appWorks).appGUI=new t.MedicalGUI(e),e.appGUI},t.MedicalGUI=function(e,n){(e=e||t.appWorks).guiOptions=n||{},Ve.Div.call(this);new t.MedicalGUIStrings(e);var r=new t.MedicalSidebar(e);this.add(r);var i=new t.MedicalIconbar(e);this.add(i);var a=new t.MedicalModal(e);this.add(a),document.addEventListener("keydown",(function(t){e.onKeyDown(t)}),!1)},t.MedicalGUI.prototype=Object.create(Ve.Div.prototype),t.MedicalGUI.prototype.constructor=t.MedicalGUI,t.MedicalGUIStrings=function(e){var t={English:{"sidebar/slicer":"Slicer","sidebar/slicer/slicerview":"Slice View","sidebar/slicer/slicerview/axial":"Axial","sidebar/slicer/slicerview/sagittal":"Sagittal","sidebar/slicer/slicerview/coronal":"Coronal","sidebar/slicer/index":"Index","sidebar/slicer/thickness":"Thickness","sidebar/slicer/thicknessmethod":"Thickness Method","sidebar/slicer/thicknessmethod/mip":"MIP","sidebar/slicer/thicknessmethod/mean":"Mean","sidebar/slicer/thicknessmethod/minip":"MinIP","sidebar/slicer/windowwidth":"Window Width","sidebar/slicer/windowcenter":"Window Center","sidebar/slicer/rescaleslope":"Rescale Slope","sidebar/slicer/rescaleintercept":"Rescale Intercept","sidebar/slicer/intensityauto":"Auto Intensity","sidebar/slicer/invert":"Invert Intensity","sidebar/slicer/visible":"Visible","sidebar/slicer/lut":"Lookup Table","sidebar/slicer/lut/none":"none","sidebar/slicer/lut/grayscale":"grayscale","sidebar/slicer/lut/spectrum":"spectrum","sidebar/slicer/lut/hot_and_cold":"hot_and_cold","sidebar/slicer/lut/gold":"gold","sidebar/slicer/lut/red_to_green":"red_to_green","sidebar/slicer/lut/blue_to_green":"blue_to_green","sidebar/slicer/lut/red_to_white":"red_to_white","sidebar/slicer/lut/green_to_white":"green_to_white","sidebar/slicer/lut/blue_to_white":"blue_to_white","sidebar/slicer/lut/walking_dead":"walking_dead","sidebar/slicer/lut/random":"random","sidebar/slicer/lut/fire":"fire","sidebar/slicer/lut/muscle_bone":"muscle_bone","sidebar/volume":"Volume","sidebar/volume/windowwidth":"Window Width","sidebar/volume/windowcenter":"Window Center","sidebar/volume/rescaleslope":"Rescale Slope","sidebar/volume/rescaleintercept":"Rescale Intercept","sidebar/volume/visible":"Visible","sidebar/volume/steps":"Steps","sidebar/volume/alphacorrection":"Alpha","sidebar/volume/interpolation":"Trilinear","sidebar/volume/shading":"Phong Shading","sidebar/volume/algorithm":"Rendering Algorithm","sidebar/volume/algorithm/ray_marching":"ray_marching","sidebar/volume/algorithm/mip":"mip","sidebar/volume/lut":"Color LUT","sidebar/volume/lut/grayscale":"grayscale","sidebar/volume/lut/spectrum":"spectrum","sidebar/volume/lut/hot_and_cold":"hot_and_cold","sidebar/volume/lut/gold":"gold","sidebar/volume/lut/red_to_green":"red_to_green","sidebar/volume/lut/blue_to_green":"blue_to_green","sidebar/volume/lut/red_to_white":"red_to_white","sidebar/volume/lut/green_to_white":"green_to_white","sidebar/volume/lut/blue_to_white":"blue_to_white","sidebar/volume/lut/walking_dead":"walking_dead","sidebar/volume/lut/random":"random","sidebar/volume/lut/fire":"fire","sidebar/volume/lut/muscle_bone":"muscle_bone","sidebar/volume/luto":"Opacity LUT","sidebar/volume/luto/linear":"linear","sidebar/volume/luto/lowpass":"lowpass","sidebar/volume/luto/bandpass":"bandpass","sidebar/volume/luto/highpass":"highpass","sidebar/volume/luto/flat":"flat","sidebar/volume/luto/random":"random","sidebar/volume/luto/linear_full":"linear_full","sidebar/volume/tablediscrete":"Discrete LUT","sidebar/isosurface":"Isosurface","sidebar/isosurface/isolevel":"Iso-level","sidebar/isosurface/smoothing":"Smoothing","sidebar/isosurface/smoothing/none":"none","sidebar/isosurface/smoothing/little":"little","sidebar/isosurface/smoothing/rough":"rough","sidebar/isosurface/smoothing/middle":"middle","sidebar/isosurface/smoothing/fine":"fine","sidebar/isosurface/smoothing/full":"full","sidebar/isosurface/visible":"Visible","sidebar/isosurface/color":"Color","sidebar/isosurface/opacity":"Opacity","sidebar/isosurface/matcap":"MatCap","sidebar/isosurface/clipping":"Clipping","sidebar/isosurface/zclipping":"Axial","sidebar/isosurface/xclipping":"Sagittal","sidebar/isosurface/yclipping":"Coronal","sidebar/sketch":"Sketch","sidebar/sketch/type":"Create Type","sidebar/sketch/type/handle":"handle","sidebar/sketch/type/voxelprobe":"voxelprobe","sidebar/sketch/type/ruler":"ruler","sidebar/sketch/type/biruler":"biruler","sidebar/sketch/type/angle":"angle","sidebar/sketch/type/rectangle":"rectangle","sidebar/sketch/type/polygon":"polygon","sidebar/sketch/type/freehand":"freehand","sidebar/sketch/type/annotation":"annotation","sidebar/settings":"Settings","sidebar/settings/aaa":"Aaa","modal/histogram":"Histogram","modal/histogram/graph/axial":"Axial","modal/histogram/graph/sagittal":"Sagittal","modal/histogram/graph/coronal":"Coronal","modal/histogram/graph/volume":"Volume","menubar/file":"File","menubar/file/new":"New","menubar/file/open":"Open Files...","others/confirmfilenew":"Any unsaved data will be lost. Are you sure?"},Korean:{}},n={getKey:function(e){return t.English[e]||"Undefined"}};return e.guiStrings=n,n},t.MedicalSidebar=function(e){var n=e.guiStrings,r=new Ve.Panel;r.setId("sidebar"),r.setDisplay("none");var i=(new Ve.Span).setClass("fas fa-landmark icon"),a=new Ve.Text(n.getKey("sidebar/slicer")).setTextTransform("uppercase").onClick((function(){M(n.getKey("sidebar/slicer"))})).add(i),o=(new Ve.Span).setClass("fas fa-igloo icon"),s=new Ve.Text(n.getKey("sidebar/volume")).setTextTransform("uppercase").onClick((function(){M(n.getKey("sidebar/volume"))})).add(o),l=(new Ve.Span).setClass("fas fa-shapes icon"),c=new Ve.Text(n.getKey("sidebar/isosurface")).setTextTransform("uppercase").onClick((function(){M(n.getKey("sidebar/isosurface"))})).add(l),u=(new Ve.Span).setClass("fas fa-palette icon"),h=new Ve.Text(n.getKey("sidebar/sketch")).setTextTransform("uppercase").onClick((function(){M(n.getKey("sidebar/sketch"))})).add(u),d=(new Ve.Span).setClass("fas fa-bars icon"),f=new Ve.Text(n.getKey("sidebar/settings")).setTextTransform("uppercase").onClick((function(){M(n.getKey("sidebar/settings"))})).add(d),p=(new Ve.Div).setLineHeight("32px").setWordBreak("keep-all");p.setId("tabs"),p.add(a,s,c,h,f),r.add(p);var m=new t.MedicalSidebar.Slicer(e),g=(new Ve.Span).add(m);r.add(g);var v=new t.MedicalSidebar.Volume(e),y=(new Ve.Span).add(v);r.add(y);var _=new t.MedicalSidebar.Isosurface(e),b=(new Ve.Span).add(_);r.add(b);var E=new t.MedicalSidebar.Sketch(e),w=(new Ve.Span).add(E);r.add(w);var x=new t.MedicalSidebar.Settings(e),T=(new Ve.Span).add(x);r.add(T);var A="inclusive";function M(e,t){void 0!==t&&(A=t);var n=r.dom.children,i=n[0].children;if("inclusive"===A){r.dom.style.display="inclusive"===t?"none"===r.dom.style.display?"":"none":"";for(var a=0,o=i.length;a<o;a++){var s=n[a+1];(l=i[a]).textContent===e?(l.style.display="",l.className="selected",s.style.display=""):(l.style.display="",l.className="",s.style.display="none")}}else for(a=0,o=i.length;a<o;a++){var l;s=n[a+1];if((l=i[a]).textContent===e){var c="none"===s.style.display?"":"none";l.style.display=c,l.className="selected",l.style.lineHeight="32px",s.style.display=c,r.dom.style.display=c}else l.style.display="none",s.style.display="none"}}return M("Slicer"),r.select=function(e,t){M(e,t)},e.guiSidebar=r,e.guiSlicer=m,e.guiVolume=v,e.guiIsosurface=_,e.guiSketch=E,e.guiSettings=x,r},t.MedicalSidebar.Slicer=function(e){var n,r=e.signals,i=e.guiStrings,a=[],o=[];o[0]=i.getKey("sidebar/slicer/slicerview/axial"),o[1]=i.getKey("sidebar/slicer/slicerview/sagittal"),o[2]=i.getKey("sidebar/slicer/slicerview/coronal");var s=[],l=[],c=[],u=[],h=[],d=[],f=[],p=[],m=[],g=[],v=[],y=[],_=[],b=new Ve.Panel;b.setBorderTop("0"),b.setPaddingTop("20px");var E=(new Ve.Row).setDisplay("none"),w=(new Ve.Select).setWidth("135px").setOptions({0:o[0],1:o[1],2:o[2]}).setValue("0").onChange(q);E.add(new Ve.Text(i.getKey("sidebar/slicer/slicerview")).setWidth("120px")),E.add(w),b.add(E);for(var x="120px",T=0;T<3;T++){var A=(new Ve.Row).setDisplay("");A.add(new Ve.Text(o[T]).setWidth("80px").setVerticalAlign("top"));var M=(new Ve.Span).setDisplay("inline-block").setWidth("200px");M.setId(T),A.add(M);var S=(new Ve.Integer).setWidth("60px").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/index")).setWidth(x)),M.add(S);var R=(new Ve.Number).setWidth("60px").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/thickness")).setWidth(x)),M.add(R);var k=(new Ve.Select).setWidth("65px").setOptions({0:i.getKey("sidebar/slicer/thicknessmethod/mip"),1:i.getKey("sidebar/slicer/thicknessmethod/mean"),2:i.getKey("sidebar/slicer/thicknessmethod/minip")}).setValue("0").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/thicknessmethod")).setWidth(x)),M.add(k);var P=(new Ve.Number).setWidth("60px").onChange(q),L=new Ve.Text(i.getKey("sidebar/slicer/windowwidth")).setWidth(x);L.slicerIndex=T,L.onClick(N.bind(L)),L.onMouseOver(F.bind(L)),L.onMouseOut(O.bind(L)),M.add(L),M.add(P);var C=(new Ve.Number).setWidth("60px").onChange(q),I=new Ve.Text(i.getKey("sidebar/slicer/windowcenter")).setWidth(x);function N(){e.guiHistogram.setDisplay(""),e.guiHistogram.update(a[this.slicerIndex])}function F(){this.dom.style.cursor="pointer",this.dom.style.textDecoration="underline"}function O(){this.dom.style.cursor="",this.dom.style.textDecoration=""}I.slicerIndex=T,I.onClick(N.bind(I)),I.onMouseOver(F.bind(I)),I.onMouseOut(O.bind(I)),M.add(I),M.add(C);var H=(new Ve.Number).setWidth("60px").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/rescaleslope")).setWidth(x)),M.add(H);var D=(new Ve.Number).setWidth("60px").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/rescaleintercept")).setWidth(x)),M.add(D);var U=new Ve.Checkbox(!1).setLeft("60px").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/intensityauto")).setWidth(x)),M.add(U);var B=new Ve.Checkbox(!1).setLeft("60px").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/invert")).setWidth(x)),M.add(B);var z=new Ve.Checkbox(!0).setLeft("60px").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/visible")).setWidth(x)),M.add(z);var V=(new Ve.Select).setWidth("65px").setOptions({none:i.getKey("sidebar/slicer/lut/none"),grayscale:i.getKey("sidebar/slicer/lut/grayscale"),spectrum:i.getKey("sidebar/slicer/lut/spectrum"),hot_and_cold:i.getKey("sidebar/slicer/lut/hot_and_cold"),gold:i.getKey("sidebar/slicer/lut/gold"),red_to_green:i.getKey("sidebar/slicer/lut/red_to_green"),blue_to_green:i.getKey("sidebar/slicer/lut/blue_to_green"),red_to_white:i.getKey("sidebar/slicer/lut/red_to_white"),green_to_white:i.getKey("sidebar/slicer/lut/green_to_white"),blue_to_white:i.getKey("sidebar/slicer/lut/blue_to_white"),walking_dead:i.getKey("sidebar/slicer/lut/walking_dead"),random:i.getKey("sidebar/slicer/lut/random"),fire:i.getKey("sidebar/slicer/lut/fire"),muscle_bone:i.getKey("sidebar/slicer/lut/muscle_bone")}).setValue("none").onChange(q);M.add(new Ve.Text(i.getKey("sidebar/slicer/lut")).setWidth(x)),M.add(V);var j=(new Ve.Row).setWidth("200px"),G=new t.LookupTable(j.dom),W=j.dom.firstChild;W.style.width="200px",W.firstChild.width=200,M.add(j),b.add(A),s.push(A),l.push(S),c.push(R),u.push(k),h.push(P),d.push(C),f.push(H),p.push(D),m.push(U),g.push(B),v.push(z),y.push(V),_.push(G)}function q(r){function i(t){var n=a[t];if(n){var r=n.slice,i=e.guiHistogram,o=!(!i||""!==i.dom.style.display);n.index!==l[t].getValue()&&(n.index=l[t].getValue(),o&&i.update(n,!0)),r.thickness!==c[t].getValue()&&(r.thickness=c[t].getValue()),r.thicknessMethod!==parseInt(u[t].getValue())&&(r.thicknessMethod=parseInt(u[t].getValue())),r.invert!==g[t].getValue()&&(r.invert=g[t].getValue()),n.visible!==v[t].getValue()&&(n.visible=v[t].getValue());var s=_[t];s.lut!==y[t].getValue()&&(s.lut=y[t].getValue(),"none"===s.lut?(r.lutTexture=null,r.lut=!1):(r.lutTexture=s.texture,r.lut=!0)),r.intensityAuto=m[t].getValue(),!1===m[t].getValue()?(r.windowWidth=h[t].getValue(),r.windowCenter=d[t].getValue(),r.rescaleSlope=f[t].getValue(),r.rescaleIntercept=p[t].getValue(),o&&i.update(n)):(h[t].setValue(r.windowWidth),d[t].setValue(r.windowCenter),f[t].setValue(r.rescaleSlope),p[t].setValue(r.rescaleIntercept))}}if("number"==typeof r?i(r):r instanceof Event?i(parseInt(r.target.parentElement.id)):(i(0),i(1),i(2)),""==E.dom.style.display&&n!==parseInt(w.getValue())){let e=function(e){return 0===e?2:1===e?0:2===e?1:-1}(n=parseInt(w.getValue())),r=t.medicalWorker;t.removeMedicalWorkspace(!1),t.createMedicalWorkspace(r.stack,"slicesWorkspace",e)}}function X(e){function t(e){var t=a[e];if(t){var n=t.slice;l[e].setValue(t.index),c[e].setValue(n.thickness),u[e].setValue(n.thicknessMethod.toString()),h[e].setValue(n.windowWidth),d[e].setValue(n.windowCenter),f[e].setValue(n.rescaleSlope),p[e].setValue(n.rescaleIntercept),m[e].setValue(n.intensityAuto),g[e].setValue(n.invert),v[e].setValue(t.visible),y[e].setValue(_[e].lut)}}"number"==typeof e?t(e):(t(0),t(1),t(2)),""==E.dom.style.display&&w.setValue(n.toString())}function Y(e){return 2===e.worldAxis?0:0===e.worldAxis?1:1===e.worldAxis?2:-1}return r.initSidebar.add((function(e){!function(e){if(E.setDisplay("none"),"quadWorkspace"===e.workspace){let t=e.medical;a[0]=t.children[0].children[0],a[1]=t.children[2].children[0],a[2]=t.children[3].children[0];for(let e=0;e<3;e++){let t=a[e],n=t.slice,r=t.stack;s[e].setDisplay(""),l[e].setRange(0,t.orientationMaxIndex),c[e].setRange(0,10),h[e].setRange(1,r.minMax[1]-r.minMax[0]),d[e].setRange(r.minMax[0],r.minMax[1]),f[e].setRange(-1/0,1/0),p[e].setRange(-1/0,1/0),_[e].lut="none",n.lutTexture=null,n.lut=!1,X(e)}}else if("slicesWorkspace"===e.workspace){E.setDisplay("");let t=e.medical.children[0].children[0],r=t.slice,i=t.stack,o=Y(t);if(-1===o)return;n=o,a[o]=t,a[(o+1)%3]=null,a[(o+2)%3]=null,s.forEach((e=>{e.setDisplay("none")})),s[o].setDisplay(""),l[o].setRange(0,t.orientationMaxIndex),c[o].setRange(0,10),h[o].setRange(1,i.minMax[1]-i.minMax[0]),d[o].setRange(i.minMax[0],i.minMax[1]),f[o].setRange(-1/0,1/0),p[o].setRange(-1/0,1/0),_[o].lut="none",r.lutTexture=null,r.lut=!1,X(o)}}(e)})),r.objectSelected.add((function(e){if("slicesWorkspace"===t.medicalWorker.workspace){let t=Y(e);if(-1===t)return;t!==n&&console.warn("warning: unexpected slicer..."),a[t]=e,a[(t+1)%3]=null,a[(t+2)%3]=null,X(t),q(t)}})),b.update=function(e){if(void 0!==e){let t=Y(e);if(-1===t)return;l[t].setValue(a[t].index),q(t)}},b},t.MedicalSidebar.Volume=function(e){var n,r,i=e.signals,a=e.guiStrings,o=new Ve.Panel;o.setBorderTop("0"),o.setPaddingTop("20px");var s="100px",l="120px",c=new Ve.Row,u=(new Ve.Number).setWidth(s).onChange(V),h=new Ve.Text(a.getKey("sidebar/volume/windowwidth")).setWidth(l);h.onClick(m.bind(h)),h.onMouseOver(g.bind(h)),h.onMouseOut(v.bind(h)),c.add(h),c.add(u),o.add(c);var d=new Ve.Row,f=(new Ve.Number).setWidth(s).onChange(V),p=new Ve.Text(a.getKey("sidebar/volume/windowcenter")).setWidth(l);function m(){e.guiHistogram.setDisplay(""),e.guiHistogram.update(n)}function g(){this.dom.style.cursor="pointer",this.dom.style.textDecoration="underline"}function v(){this.dom.style.cursor="",this.dom.style.textDecoration=""}p.onClick(m.bind(p)),p.onMouseOver(g.bind(p)),p.onMouseOut(v.bind(p)),d.add(p),d.add(f),o.add(d);var y=new Ve.Row,_=(new Ve.Number).setWidth(s).onChange(V);y.add(new Ve.Text(a.getKey("sidebar/volume/rescaleslope")).setWidth(l)),y.add(_),o.add(y);var b=new Ve.Row,E=(new Ve.Number).setWidth(s).onChange(V);b.add(new Ve.Text(a.getKey("sidebar/volume/rescaleintercept")).setWidth(l)),b.add(E),o.add(b);var w=new Ve.Row,x=new Ve.Checkbox(!0).setWidth("10px").onChange(V);w.add(new Ve.Text(a.getKey("sidebar/volume/visible")).setWidth(l)),w.add(x),o.add(w);var T=new Ve.Row,A=(new Ve.Integer).setWidth(s).onChange(V);T.add(new Ve.Text(a.getKey("sidebar/volume/steps")).setWidth(l)),T.add(A),o.add(T);var M=new Ve.Row,S=(new Ve.Number).setWidth(s).onChange(V);M.add(new Ve.Text(a.getKey("sidebar/volume/alphacorrection")).setWidth(l)),M.add(S),o.add(M);var R=new Ve.Row,k=new Ve.Checkbox(!0).setWidth("10px").onChange(V);R.add(new Ve.Text(a.getKey("sidebar/volume/interpolation")).setWidth(l)),R.add(k),o.add(R);var P=new Ve.Row,L=new Ve.Checkbox(!0).setWidth("10px").onChange(V);P.add(new Ve.Text(a.getKey("sidebar/volume/shading")).setWidth(l)),P.add(L),o.add(P);var C=new Ve.Row,I=(new Ve.Select).setWidth("135px").setOptions({0:a.getKey("sidebar/volume/algorithm/ray_marching"),1:a.getKey("sidebar/volume/algorithm/mip")}).setValue("ray_marching").onChange(V);C.add(new Ve.Text(a.getKey("sidebar/volume/algorithm")).setWidth(l)),C.add(I),o.add(C);var N=new Ve.Row,F=(new Ve.Select).setWidth("135px").setOptions({grayscale:a.getKey("sidebar/volume/lut/grayscale"),spectrum:a.getKey("sidebar/volume/lut/spectrum"),hot_and_cold:a.getKey("sidebar/volume/lut/hot_and_cold"),gold:a.getKey("sidebar/volume/lut/gold"),red_to_green:a.getKey("sidebar/volume/lut/red_to_green"),blue_to_green:a.getKey("sidebar/volume/lut/blue_to_green"),red_to_white:a.getKey("sidebar/volume/lut/red_to_white"),green_to_white:a.getKey("sidebar/volume/lut/green_to_white"),blue_to_white:a.getKey("sidebar/volume/lut/blue_to_white"),walking_dead:a.getKey("sidebar/volume/lut/walking_dead"),random:a.getKey("sidebar/volume/lut/random"),fire:a.getKey("sidebar/volume/lut/fire"),muscle_bone:a.getKey("sidebar/volume/lut/muscle_bone")}).setValue("grayscale").onChange(V);N.add(new Ve.Text(a.getKey("sidebar/volume/lut")).setWidth(l)),N.add(F),o.add(N);var O=new Ve.Row,H=(new Ve.Select).setWidth("135px").setOptions({linear:a.getKey("sidebar/volume/luto/linear"),lowpass:a.getKey("sidebar/volume/luto/lowpass"),bandpass:a.getKey("sidebar/volume/luto/bandpass"),highpass:a.getKey("sidebar/volume/luto/highpass"),flat:a.getKey("sidebar/volume/luto/flat"),random:a.getKey("sidebar/volume/luto/random"),linear_full:a.getKey("sidebar/volume/luto/linear_full")}).setValue("linear").onChange(V);O.add(new Ve.Text(a.getKey("sidebar/volume/luto")).setWidth(l)),O.add(H),o.add(O);var D=new Ve.Row,U=new Ve.Checkbox(!1).setWidth("10px").onChange(V);D.add(new Ve.Text(a.getKey("sidebar/volume/tablediscrete")).setWidth(l)),D.add(U),o.add(D);var B=new Ve.Row,z=new t.LookupTable(B.dom);function V(){function t(){let t=e.guiHistogram;t&&""===t.dom.style.display&&t.update(n)}n.windowWidth!==u.getValue()&&(n.windowWidth=u.getValue(),t()),n.windowCenter!==f.getValue()&&(n.windowCenter=f.getValue(),t()),n.rescaleSlope!==_.getValue()&&(n.rescaleSlope=_.getValue()),n.rescaleIntercept!==E.getValue()&&(n.rescaleIntercept=E.getValue()),n.visible!==x.getValue()&&(n.visible=x.getValue()),r.uSteps.value!==A.getValue()&&(r.uSteps.value=A.getValue()),r.uAlphaCorrection.value!==S.getValue()&&(r.uAlphaCorrection.value=S.getValue()),r.uInterpolation.value!==k.getValue()&&(r.uInterpolation.value=k.getValue()),r.uShading.value!==L.getValue()&&(r.uShading.value=L.getValue()),r.uAlgorithm.value!==parseInt(I.getValue())&&(r.uAlgorithm.value=parseInt(I.getValue())),z.lut!==F.getValue()&&(z.lut=F.getValue(),n.lutTexture=z.texture,n.lut=!0),z.lutO!==H.getValue()&&(z.lutO=H.getValue(),n.lutTexture=z.texture,n.lut=!0),z.discrete!==U.getValue()&&(z.discrete=U.getValue(),n.lutTexture=z.texture,n.lut=!0)}function j(e){n=e.medical.children[1].children[0],r=n.uniforms;var t=n.stack;u.setRange(1,t.minMax[1]-t.minMax[0]),f.setRange(t.minMax[0],t.minMax[1]),_.setRange(0,1/0),E.setRange(-1/0,1/0),A.setRange(0,512),S.setRange(0,1).setStep(.01),z.lutO="linear",z.lut="grayscale",n.lutTexture=z.texture,n.lut=!0,z.discrete=!1,u.setValue(n.windowWidth),f.setValue(n.windowCenter),_.setValue(n.rescaleSlope),E.setValue(n.rescaleIntercept),x.setValue(n.visible),A.setValue(r.uSteps.value),S.setValue(r.uAlphaCorrection.value),k.setValue(r.uInterpolation.value),L.setValue(r.uShading.value),I.setValue(r.uAlgorithm.value.toString()),F.setValue(z.lut),H.setValue(z.lutO),U.setValue(z.discrete)}return o.add(B),i.initSidebar.add((function(e){"quadWorkspace"===e.workspace?(o.setDisplay(""),j(e)):"slicesWorkspace"===e.workspace&&o.setDisplay("none")})),o},t.MedicalSidebar.Isosurface=function(e){var n,r,i=e.signals,a=e.guiStrings,o=new Ve.Panel;o.setBorderTop("0"),o.setPaddingTop("20px");var s="100px",l="70px",c="120px",u=new Ve.Row,h=(new Ve.Integer).setWidth(s).onChange(S);u.add(new Ve.Text(a.getKey("sidebar/isosurface/isolevel")).setWidth(c)),u.add(h),o.add(u);var d=new Ve.Row,f=(new Ve.Select).setWidth("135px").setOptions({0:a.getKey("sidebar/isosurface/smoothing/none"),2:a.getKey("sidebar/isosurface/smoothing/little"),4:a.getKey("sidebar/isosurface/smoothing/rough"),6:a.getKey("sidebar/isosurface/smoothing/middle"),8:a.getKey("sidebar/isosurface/smoothing/fine"),10:a.getKey("sidebar/isosurface/smoothing/full")}).setValue("0").onChange(S);d.add(new Ve.Text(a.getKey("sidebar/isosurface/smoothing")).setWidth(c)),d.add(f),o.add(d);var p=new Ve.Row,m=new Ve.Checkbox(!1).setWidth("10px").onChange(S);p.add(new Ve.Text(a.getKey("sidebar/isosurface/visible")).setWidth(c)),p.add(m),o.add(p);var g=new Ve.Row,v=(new Ve.Color).onChange(S);g.add(new Ve.Text(a.getKey("sidebar/isosurface/color")).setWidth(c)),g.add(v),o.add(g);var y=new Ve.Row,_=(new Ve.Number).setWidth(s).onChange(S);y.add(new Ve.Text(a.getKey("sidebar/isosurface/opacity")).setWidth(c)),y.add(_),o.add(y);var b=new Ve.Row;b.setBorderTop("1px solid lightgrey"),b.setBorderBottom("1px solid lightgrey"),b.setVerticalAlign("middle");var E=new Ve.Column,w=new Ve.Checkbox(!1).onChange(S),x=(new Ve.Texture).setDisplay("block").onChange(S);E.add(new Ve.Text(a.getKey("sidebar/isosurface/matcap"))),E.add(w,new Ve.Break),E.add(x),b.add(E),o.add(b);var T=new Ve.Row,A=new Ve.Checkbox(!0).setWidth("10px").onChange(S),M=[(new Ve.Number).setWidth(l).onChange(S),(new Ve.Number).setWidth(l).onChange(S),(new Ve.Number).setWidth(l).onChange(S),(new Ve.Number).setWidth(l).onChange(S),(new Ve.Number).setWidth(l).onChange(S),(new Ve.Number).setWidth(l).onChange(S)];function S(){if(n.isoLevel!==h.getValue()&&(n.isoLevel=h.getValue()),n.smoothing!==parseFloat(f.getValue())&&(n.smoothing=.1*parseFloat(f.getValue())),n.visible!==m.getValue()&&(n.visible=m.getValue()),r.color.getHex()!==v.getHexValue()&&r.color.setHex(v.getHexValue()),r.opacity!==_.getValue()&&(r.opacity=_.getValue()),void 0!==r.matcap){var e=!0===w.getValue()?x.getValue():null;r.matcap!==e&&(r.matcap=e,r.needsUpdate=!0)}let i=t.appWorks.renderer;if(i.localClippingEnabled!==A.getValue()&&(i.localClippingEnabled=A.getValue()),r.clippingPlanes)if(!0===i.localClippingEnabled)for(var a=0;a<6;a++)r.clippingPlanes[a].constant!==M[a].getValue()&&(r.clippingPlanes[a].constant=M[a].getValue());else for(a=0;a<6;a++)M[a].setValue(r.clippingPlanes[a].constant)}function R(e){t.createSpincircle(),setTimeout((function(){(n=e.medical.children[1].children[4])&&!0===n.isMedicalIsosurface||(n=new t.MedicalIsosurface(e.stack),e.medical.children[1].children[4]=n);r=n.material,h.setRange(0,255),n.visible=!1,_.setRange(0,1),E.setDisplay(void 0!==r.matcap?"":"none");let i=n._stack.worldBoundingBox(),a=[(i[1]-i[0])/2,(i[3]-i[2])/2,(i[5]-i[4])/2];for(var o=0;o<6;o++){let e=r.clippingPlanes[o].constant,t=e-a[~~(o/2)],n=e;M[o].setRange(t,n)}(function(){h.setValue(n.isoLevel),f.setValue((10*n.smoothing).toString()),m.setValue(n.visible),v.setHexValue(r.color.getHex()),_.setValue(r.opacity),void 0!==r.matcap&&(w.setValue(null!==r.matcap),r.matcap&&x.setValue(r.matcap));let e=t.appWorks.renderer;if(A.setValue(e.localClippingEnabled),r.clippingPlanes)for(var i=0;i<6;i++)M[i].setValue(r.clippingPlanes[i].constant)})(),t.hideSpincircle()}),500)}return T.add(new Ve.Text(a.getKey("sidebar/isosurface/clipping")).setWidth(c)),T.add(A,new Ve.Break),T.add(new Ve.Text(a.getKey("sidebar/isosurface/zclipping")).setWidth(c)),T.add(M[4]),T.add(M[5]),T.add(new Ve.Text(a.getKey("sidebar/isosurface/xclipping")).setWidth(c)),T.add(M[0]),T.add(M[1]),T.add(new Ve.Text(a.getKey("sidebar/isosurface/yclipping")).setWidth(c)),T.add(M[2]),T.add(M[3]),o.add(T),i.initSidebar.add((function(e){"quadWorkspace"===e.workspace?(o.setDisplay(""),setTimeout((()=>R(e)),1e3)):"slicesWorkspace"===e.workspace&&o.setDisplay("none")})),o},t.MedicalSidebar.Sketch=function(e){var n=e.signals,r=e.guiStrings,i=new Ve.Panel;i.setBorderTop("0"),i.setPaddingTop("20px");var a=new Ve.Row,o=(new Ve.Select).setWidth("150px").setOptions({Handle:r.getKey("sidebar/sketch/type/handle"),VoxelProbe:r.getKey("sidebar/sketch/type/voxelprobe"),Ruler:r.getKey("sidebar/sketch/type/ruler"),BiRuler:r.getKey("sidebar/sketch/type/biruler"),Angle:r.getKey("sidebar/sketch/type/angle"),Rectangle:r.getKey("sidebar/sketch/type/rectangle"),Polygon:r.getKey("sidebar/sketch/type/polygon"),Freehand:r.getKey("sidebar/sketch/type/freehand"),Annotation:r.getKey("sidebar/sketch/type/annotation")}).setValue("Handle").onChange((function(){t.medicalWorker.sketchType!==o.getValue()&&(t.medicalWorker.sketchType=o.getValue())}));function s(e){e.sketchType="Handle",o.setValue(t.medicalWorker.sketchType)}return a.add(new Ve.Text(r.getKey("sidebar/sketch/type")).setWidth("90px")),a.add(o),i.add(a),n.initSidebar.add((function(e){s(e)})),i},t.MedicalSidebar.Settings=function(e){var t=e.guiStrings,n=new Ve.Panel;n.setBorderTop("0"),n.setPaddingTop("20px");var r=new Ve.Row,i=(new Ve.Select).setOptions({111:"111",222:"222",333:"333"}).setWidth("150px").onChange((function(){console.log("updateAaa: aaaType = "+i.getValue()),console.log("refreshAaa: aaaType = "+i.getValue())}));return r.add(new Ve.Text(t.getKey("sidebar/settings/aaa")).setWidth("90px")),r.add(i),n.add(r),n},t.MedicalIconbar=function(e){var n,r=e.guiStrings,i=new Ve.Panel;return i.setId("iconbar"),(n=(new Ve.Span).setClass("fas fa-file icon")).onClick((function(){confirm(r.getKey("others/confirmfilenew"))&&(t.removeMedicalWorkspace(),window.location.reload())})),i.add(n),(n=(new Ve.Span).setClass("fas fa-folder-open icon")).onClick((function(){e.fileExplorer.openFile()})),i.add(n),(n=(new Ve.Span).setClass("fas fa-dice-four icon")).onClick((function(){t.removeMedicalWorkspace(!1),t.createMedicalWorkspace(t.medicalWorker.stack,"quadWorkspace")})),i.add(n),(n=(new Ve.Span).setClass("fas fa-city icon")).onClick((function(){t.removeMedicalWorkspace(!1),t.createMedicalWorkspace(t.medicalWorker.stack,"slicesWorkspace")})),i.add(n),(n=(new Ve.Span).setClass("fas fa-info icon")).onClick((function(){e.guiAbout.setDisplay("")})),i.add(n),e.guiIconbar=i,i},t.MedicalMenubar=function(e){var n=new Ve.Panel;return n.setId("menubar"),n.add(new t.MedicalMenubar.File(e)),n},t.MedicalMenubar.File=function(e){var t=e.guiStrings,n=new Ve.Panel;n.setClass("menu");var r=new Ve.Panel;r.setClass("title"),r.setTextContent(t.getKey("menubar/file")),n.add(r);var i,a=new Ve.Panel;return a.setClass("options"),n.add(a),(i=new Ve.Row).setClass("option"),i.add((new Ve.Span).setClass("fas fa-file icon")),i.add(new Ve.Text(t.getKey("menubar/file/new"))),i.onClick((function(){confirm(t.getKey("others/confirmfilenew"))&&e.clear()})),a.add(i),(i=new Ve.Row).setClass("option"),i.add((new Ve.Span).setClass("fas fa-folder-open icon")),i.add(new Ve.Text(t.getKey("menubar/file/open"))),i.onClick((function(){e.fileExplorer.openFile()})),a.add(i),n},t.MedicalModal=function(e){var n=new Ve.Panel;return n.add(new t.MedicalModal.About(e)),n.add(new t.MedicalModal.Histogram(e)),n},t.MedicalModal.About=function(e){var t=new Ve.Panel;t.setClass("Modal"),t.setDisplay("none");var n=new Ve.Panel;n.setClass("content"),t.add(n);var r=(new Ve.Row).setClass("header"),i=(new Ve.Span).setClass("close").onClick((function(){t.setDisplay("none")})).add((new Ve.Span).setClass("fas fa-times icon"));r.add(i),r.add(new Ve.Text("About").setTextTransform("uppercase").setFontSize("18px")),n.add(r);var a=(new Ve.Row).setClass("body");a.add(new Ve.Text("Abstract").setFontSize("16px").setPadding("6px 0 6px 0"),new Ve.Break,new Ve.Text("This application is a 3D WebGL-based medical application that will provide versatile tools that import various kinds of medical files, construct anatomical models from these files, design patient-specific guides, and export the 3D models for CAE analysis or 3D printing.")),n.add(a);var o=(new Ve.Row).setClass("body");return o.add(new Ve.Text("Copyright Notice").setFontSize("16px ").setPadding("0 0 6px 0"),new Ve.Break,new Ve.Text("This presentation is protected by U.S. and International copyright laws. Reproduction and distribution of the presentation without written permission of the sponsor is prohibited."),new Ve.Break,(new Ve.Div).setPadding("6px 0").add(new Ve.Text("Copyright"),(new Ve.Span).setClass("fas fa-copyright icon").setPadding("0 6px"),new Ve.Text("2020 NovaGraphix, Co. All rights reserved."))),n.add(o),e.guiAbout=t,t},t.MedicalModal.Histogram=function(e){var n,r=e.guiStrings,i=(new Ve.Panel).setClass("Modal-draggble").setWidth("278px").setDisplay("none"),a=(new Ve.Row).setClass("header"),o=(new Ve.Span).setClass("close").onClick((function(){i.setDisplay("none")})).add((new Ve.Span).setClass("fas fa-times icon"));a.add(new Ve.Text(r.getKey("modal/histogram"))),a.add((new Ve.Span).setClass("fas fa-chart-bar icon")),a.add(o),i.add(a);var s=new Ve.Panel;i.add(s);var l=new Ve.Row,c=new Ve.Text("Title").setWidth("100px");l.add(c),s.add(l);var u={zSlicer:r.getKey("modal/histogram/graph/axial"),xSlicer:r.getKey("modal/histogram/graph/sagittal"),ySlicer:r.getKey("modal/histogram/graph/coronal"),volume:r.getKey("modal/histogram/graph/volume")};return t.setDraggable(i.dom),i.update=function(e,r){r=r||!1,n?!0===r?(n.computeHistogram(e),n.drawHistogram()):n.object=e:n=new t.MedicalHistogram(e,l.dom),function(){let e=n.object;e.isMedicalSlicer?c.setValue(u[e.name]):e.isMedicalVolume&&c.setValue(u.volume)}()},e.guiHistogram=i,i},t.createViewWorks=function(e,n){return t.viewWorks=new t.GraphicWorks({appName:"ViewWorks",width:e||window.innerWidth,height:n||window.innerHeight,glVersion:2,background:(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg"),controlsType:"OrbitControls",FXAAEnabled:!0,fileExplorer:!0}),t.viewWorks.renderScene(),t.viewWorks},t.createWPViewWorks=function(e,n){return t.viewWorks=new t.GraphicWorks({appName:"ViewWorks",customer:"wordpress.org",width:e||window.innerWidth,height:n||window.innerHeight,glVersion:2,background:12632256,controlsType:"OrbitControls",FXAAEnabled:!0,fileExplorer:!0}),t.viewWorks.renderScene(),t.viewWorks},t.createGameWorks=function(e,n){return t.gameWorks=new t.GraphicWorks({appName:"GameWorks",width:e||window.innerWidth,height:n||window.innerHeight,glVersion:2,hud:!0}),t.gameWorks.renderScene(),t.gameWorks},t.createNatureWorks=function(e,n){return t.natureWorks=new t.GraphicWorks({appName:"NatureWorks",width:e||window.innerWidth,height:n||window.innerHeight,signals:!0,config:!0,history:!0,glVersion:2,fog:{type:"exp2"},controlsType:"OrbitControls",stats:!0,audioFiles:void 0,gridVisible:!1,hud:!0,bleachEnabled:!1,bloomEnabled:!1,dotScreenEnabled:!1,glitchEnabled:!1,sepiaEnabled:!1,outlineEnabled:!1,FXAAEnabled:!0,ssaoEnabled:!1,godRaysEnabled:!1,bokehEnabled:!1,vignetteEnabled:!1,effectType:void 0,fileExplorer:!0,dragControls:!0,transformControls:!0}),t.natureWorks.renderScene(),t.natureWorks},t.createMedicalWorks=function(e,n){return t.medicalWorks=new t.GraphicWorks({appName:"MedicalWorks",width:e||window.innerWidth,height:n||window.innerHeight,signals:!0,glVersion:2,stats:!0,fileExplorer:!0}),t.medicalWorks.renderScene(),t.medicalWorks},t.add=function(e){t.updateMaterialMapEncoding(e,THREE.sRGBEncoding),t.appWorks.history?t.appWorks.add(e):t.appWorks.scene.add(e)},t.remove=function(e){e&&(t.appWorks.history?t.appWorks.remove(e):e.parent&&e.parent.remove(e))},t.dispose=function(e){e&&(e.parent&&e.parent.remove(e),e.traverse((function(e){var t=e.geometry;t&&t.dispose();var n=e.material;n&&(Array.isArray(n)?n:[n]).forEach((function(e){Object.keys(e).forEach((t=>{e[t]&&"function"==typeof e[t].dispose&&e[t].dispose()})),e.dispose()}))})))},window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,window.JAMIE=t})()})();