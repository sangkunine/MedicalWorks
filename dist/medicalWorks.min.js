!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=150)}([function(e,t,r){!function(e){"use strict";function t(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,n=r[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var n=r.slice(0),i=0,a=n.length;i<a;i++)n[i].call(this,e)}}}});var r,n,i,a="106",o=0,s=1,l=2,u=1,c=2,h=0,d=1,f=2,p=0,m=1,v=2,g=0,y=1,_=2,b=3,E=4,w=5,x=100,T=101,S=102,M=103,R=104,A=200,k=201,P=202,C=203,L=204,I=205,O=206,H=207,D=208,N=209,F=210,U=0,B=1,z=2,j=3,V=4,G=5,W=6,X=7,Y=0,q=1,Z=2,J=0,K=1,Q=2,$=3,ee=4,te=5,re=301,ne=302,ie=303,ae=304,oe=305,se=306,le=307,ue=1e3,ce=1001,he=1002,de=1003,fe=1004,pe=1005,me=1006,ve=1007,ge=1008,ye=1009,_e=1010,be=1011,Ee=1012,we=1013,xe=1014,Te=1015,Se=1016,Me=1017,Re=1018,Ae=1019,ke=1020,Pe=1021,Ce=1022,Le=1023,Ie=1024,Oe=1025,He=Le,De=1026,Ne=1027,Fe=1028,Ue=33776,Be=33777,ze=33778,je=33779,Ve=35840,Ge=35841,We=35842,Xe=35843,Ye=36196,qe=37808,Ze=37809,Je=37810,Ke=37811,Qe=37812,$e=37813,et=37814,tt=37815,rt=37816,nt=37817,it=37818,at=37819,ot=37820,st=37821,lt=2201,ut=2400,ct=0,ht=1,dt=2,ft=3e3,pt=3001,mt=3007,vt=3002,gt=3004,yt=3005,_t=3006,bt=3200,Et=3201,wt=0,xt=1,Tt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,a=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255];return a.toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Tt.DEG2RAD},radToDeg:function(e){return e*Tt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function St(e,t){this.x=e||0,this.y=t||0}function Mt(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}function Rt(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function At(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(St.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(St.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}}),Object.assign(Mt,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,a,o){var s=r[n+0],l=r[n+1],u=r[n+2],c=r[n+3],h=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(c!==p||s!==h||l!==d||u!==f){var m=1-o,v=s*h+l*d+u*f+c*p,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,v*g);m=Math.sin(m*b)/_,o=Math.sin(o*b)/_}var E=o*g;if(s=s*m+h*E,l=l*m+d*E,u=u*m+f*E,c=c*m+p*E,m===1-o){var w=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=w,l*=w,u*=w,c*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}}),Object.defineProperties(Mt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Mt.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(r/2),u=o(n/2),c=o(i/2),h=s(r/2),d=s(n/2),f=s(i/2);return"XYZ"===a?(this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f):"YXZ"===a?(this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f):"ZXY"===a?(this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f):"ZYX"===a?(this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f):"YZX"===a?(this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f):"XZY"===a&&(this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],u=r[2],c=r[6],h=r[10],d=n+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(a-u)*t,this._z=(o-i)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+u)/t):s>h?(t=2*Math.sqrt(1+s-n-h),this._w=(a-u)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-n-s),this._w=(o-i)/t,this._x=(a+u)/t,this._y=(l+c)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Tt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var n=Math.min(1,t/r);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=r*u+a*o+n*l-i*s,this._y=n*u+a*s+i*o-r*l,this._z=i*u+a*l+r*s-n*o,this._w=a*u-r*o-n*s-i*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*r+t*this._x,this._y=l*n+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Rt.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(i=new Mt,function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(i.setFromEuler(e))}),applyAxisAngle:function(){var e=new Mt;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,u=s*r+o*t-i*n,c=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+u*-o-c*-a,this.y=u*s+h*-a+c*-i-l*-o,this.z=c*s+h*-o+l*-a-u*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:(n=new Rt,function(e){return n.copy(this).projectOnVector(e),this.sub(n)}),reflect:function(){var e=new Rt;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Tt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(At.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=n,u[2]=o,u[3]=t,u[4]=i,u[5]=s,u[6]=r,u[7]=a,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Rt;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],f=r[8],p=n[0],m=n[3],v=n[6],g=n[1],y=n[4],_=n[7],b=n[2],E=n[5],w=n[8];return i[0]=a*p+o*g+s*b,i[3]=a*m+o*y+s*E,i[6]=a*v+o*_+s*w,i[1]=l*p+u*g+c*b,i[4]=l*m+u*y+c*E,i[7]=l*v+u*_+c*w,i[2]=h*p+d*g+f*b,i[5]=h*m+d*y+f*E,i[8]=h*v+d*_+f*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-r*i*u+r*o*s+n*i*l-n*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],f=d*l-u*h,p=u*c-d*s,m=h*s-l*c,v=i*f+a*p+o*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=f*y,n[1]=(o*h-d*a)*y,n[2]=(u*a-o*l)*y,n[3]=p*y,n[4]=(d*i-o*c)*y,n[5]=(o*s-u*i)*y,n[6]=m*y,n[7]=(a*c-h*i)*y,n[8]=(l*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*a+l*o)+a+e,-n*l,n*s,-n*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],u=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*u,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*u,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var kt,Pt,Ct,Lt,It,Ot,Ht,Dt,Nt,Ft,Ut={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===r&&(r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),r.width=e.width,r.height=e.height;var n=r.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=r}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Bt=0;function zt(e,t,r,n,i,a,o,s,l,u){Object.defineProperty(this,"id",{value:Bt++}),this.uuid=Tt.generateUUID(),this.name="",this.image=void 0!==e?e:zt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:zt.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:ce,this.wrapT=void 0!==n?n:ce,this.magFilter=void 0!==i?i:me,this.minFilter=void 0!==a?a:ge,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Le,this.type=void 0!==s?s:ye,this.offset=new St(0,0),this.repeat=new St(1,1),this.center=new St(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new At,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:ft,this.version=0,this.onUpdate=null}function jt(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function Vt(e,t,r){this.width=e,this.height=t,this.scissor=new jt(0,0,e,t),this.scissorTest=!1,this.viewport=new jt(0,0,e,t),r=r||{},this.texture=new zt(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:me,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function Gt(e,t,r){Vt.call(this,e,t,r),this.samples=4}function Wt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Xt(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||Xt.DefaultOrder}function Yt(){this.mask=1}zt.DEFAULT_IMAGE=void 0,zt.DEFAULT_MAPPING=300,zt.prototype=Object.assign(Object.create(t.prototype),{constructor:zt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(this.isDataTexture){var i=document.createElement("canvas"),a=i.getContext("2d");n=a.getImageData(0,0,n.width,n.height)}if(void 0===n.uuid&&(n.uuid=Tt.generateUUID()),!t&&void 0===e.images[n.uuid]){var o;if(Array.isArray(n)){o=[];for(var s=0,l=n.length;s<l;s++)o.push(Ut.getDataURL(n[s]))}else o=Ut.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:o}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ue:e.x=e.x-Math.floor(e.x);break;case ce:e.x=e.x<0?0:1;break;case he:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ue:e.y=e.y-Math.floor(e.y);break;case ce:e.y=e.y<0?0:1;break;case he:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(zt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(jt.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(jt.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,a=e.elements,o=a[0],s=a[4],l=a[8],u=a[1],c=a[5],h=a[9],d=a[2],f=a[6],p=a[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(o+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,v=(c+1)/2,g=(p+1)/2,y=(s+u)/4,_=(l+d)/4,b=(h+f)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(m),n=y/r,i=_/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(v),r=y/n,i=b/n):g<.01?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(g),r=_/i,n=b/i),this.set(r,n,i,t),this}var E=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(E)<.001&&(E=1),this.x=(f-h)/E,this.y=(l-d)/E,this.z=(u-s)/E,this.w=Math.acos((o+c+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return void 0===Nt&&(Nt=new jt,Ft=new jt),Nt.set(e,e,e,e),Ft.set(t,t,t,t),this.clamp(Nt,Ft)},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Vt.prototype=Object.assign(Object.create(t.prototype),{constructor:Vt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Gt.prototype=Object.assign(Object.create(Vt.prototype),{constructor:Gt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Vt.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(Wt.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,a,o,s,l,u,c,h,d,f,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=d,v[7]=f,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Wt).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new Rt;return function(t){var r=this.elements,n=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[3]=0,r[4]=n[4]*a,r[5]=n[5]*a,r[6]=n[6]*a,r[7]=0,r[8]=n[8]*o,r[9]=n[9]*o,r[10]=n[10]*o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),l=Math.sin(n),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=a*u,d=a*c,f=o*u,p=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-o*s,t[2]=p-h*l,t[6]=f+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*u,v=s*c,g=l*u,y=l*c;t[0]=m+y*o,t[4]=g*o-v,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){var m=s*u,v=s*c,g=l*u,y=l*c;t[0]=m-y*o,t[4]=-a*c,t[8]=g+v*o,t[1]=v+g*o,t[5]=a*u,t[9]=y-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var h=a*u,d=a*c,f=o*u,p=o*c;t[0]=s*u,t[4]=f*l-d,t[8]=h*l+p,t[1]=s*c,t[5]=p*l+h,t[9]=d*l-f,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var _=a*s,b=a*l,E=o*s,w=o*l;t[0]=s*u,t[4]=w-_*c,t[8]=E*c+b,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=b*c+E,t[10]=_-w*c}else if("XZY"===e.order){var _=a*s,b=a*l,E=o*s,w=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=_*c+w,t[5]=a*u,t[9]=b*c-E,t[2]=E*c-b,t[6]=o*u,t[10]=w*c+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(Ht=new Rt(0,0,0),Dt=new Rt(1,1,1),function(e){return this.compose(Ht,e,Dt)}),lookAt:(Lt=new Rt,It=new Rt,Ot=new Rt,function(e,t,r){var n=this.elements;return Ot.subVectors(e,t),0===Ot.lengthSq()&&(Ot.z=1),Ot.normalize(),Lt.crossVectors(r,Ot),0===Lt.lengthSq()&&(1===Math.abs(r.z)?Ot.x+=1e-4:Ot.z+=1e-4,Ot.normalize(),Lt.crossVectors(r,Ot)),Lt.normalize(),It.crossVectors(Ot,Lt),n[0]=Lt.x,n[4]=It.x,n[8]=Ot.x,n[1]=Lt.y,n[5]=It.y,n[9]=Ot.y,n[2]=Lt.z,n[6]=It.z,n[10]=Ot.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],f=r[2],p=r[6],m=r[10],v=r[14],g=r[3],y=r[7],_=r[11],b=r[15],E=n[0],w=n[4],x=n[8],T=n[12],S=n[1],M=n[5],R=n[9],A=n[13],k=n[2],P=n[6],C=n[10],L=n[14],I=n[3],O=n[7],H=n[11],D=n[15];return i[0]=a*E+o*S+s*k+l*I,i[4]=a*w+o*M+s*P+l*O,i[8]=a*x+o*R+s*C+l*H,i[12]=a*T+o*A+s*L+l*D,i[1]=u*E+c*S+h*k+d*I,i[5]=u*w+c*M+h*P+d*O,i[9]=u*x+c*R+h*C+d*H,i[13]=u*T+c*A+h*L+d*D,i[2]=f*E+p*S+m*k+v*I,i[6]=f*w+p*M+m*P+v*O,i[10]=f*x+p*R+m*C+v*H,i[14]=f*T+p*A+m*L+v*D,i[3]=g*E+y*S+_*k+b*I,i[7]=g*w+y*M+_*P+b*O,i[11]=g*x+y*R+_*C+b*H,i[15]=g*T+y*A+_*L+b*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Rt;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14],f=e[3],p=e[7],m=e[11],v=e[15];return f*(+i*s*c-n*l*c-i*o*h+r*l*h+n*o*d-r*s*d)+p*(+t*s*d-t*l*h+i*a*h-n*a*d+n*l*u-i*s*u)+m*(+t*l*c-t*o*d-i*a*c+r*a*d+i*o*u-r*l*u)+v*(-n*o*u-t*s*c+t*o*h+n*a*c-r*a*h+r*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],h=n[7],d=n[8],f=n[9],p=n[10],m=n[11],v=n[12],g=n[13],y=n[14],_=n[15],b=f*y*h-g*p*h+g*c*m-u*y*m-f*c*_+u*p*_,E=v*p*h-d*y*h-v*c*m+l*y*m+d*c*_-l*p*_,w=d*g*h-v*f*h+v*u*m-l*g*m-d*u*_+l*f*_,x=v*f*c-d*g*c-v*u*p+l*g*p+d*u*y-l*f*y,T=i*b+a*E+o*w+s*x;if(0===T){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var M=1/T;return r[0]=b*M,r[1]=(g*p*s-f*y*s-g*o*m+a*y*m+f*o*_-a*p*_)*M,r[2]=(u*y*s-g*c*s+g*o*h-a*y*h-u*o*_+a*c*_)*M,r[3]=(f*c*s-u*p*s-f*o*h+a*p*h+u*o*m-a*c*m)*M,r[4]=E*M,r[5]=(d*y*s-v*p*s+v*o*m-i*y*m-d*o*_+i*p*_)*M,r[6]=(v*c*s-l*y*s-v*o*h+i*y*h+l*o*_-i*c*_)*M,r[7]=(l*p*s-d*c*s+d*o*h-i*p*h-l*o*m+i*c*m)*M,r[8]=w*M,r[9]=(v*f*s-d*g*s-v*a*m+i*g*m+d*a*_-i*f*_)*M,r[10]=(l*g*s-v*u*s+v*a*h-i*g*h-l*a*_+i*u*_)*M,r[11]=(d*u*s-l*f*s-d*a*h+i*f*h+l*a*m-i*u*m)*M,r[12]=x*M,r[13]=(d*g*o-v*f*o+v*a*p-i*g*p-d*a*y+i*f*y)*M,r[14]=(v*u*o-l*g*o-v*a*c+i*g*c+l*a*y-i*u*y)*M,r[15]=(l*f*o-d*u*o+d*a*c-i*f*c-l*a*p+i*u*p)*M,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,u=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,u*o+r,u*s-n*a,0,l*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,u=a+a,c=o+o,h=i*l,d=i*u,f=i*c,p=a*u,m=a*c,v=o*c,g=s*l,y=s*u,_=s*c,b=r.x,E=r.y,w=r.z;return n[0]=(1-(p+v))*b,n[1]=(d+_)*b,n[2]=(f-y)*b,n[3]=0,n[4]=(d-_)*E,n[5]=(1-(h+v))*E,n[6]=(m+g)*E,n[7]=0,n[8]=(f+y)*w,n[9]=(m-g)*w,n[10]=(1-(h+p))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:(Pt=new Rt,Ct=new Wt,function(e,t,r){var n=this.elements,i=Pt.set(n[0],n[1],n[2]).length(),a=Pt.set(n[4],n[5],n[6]).length(),o=Pt.set(n[8],n[9],n[10]).length(),s=this.determinant();s<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],Ct.copy(this);var l=1/i,u=1/a,c=1/o;return Ct.elements[0]*=l,Ct.elements[1]*=l,Ct.elements[2]*=l,Ct.elements[4]*=u,Ct.elements[5]*=u,Ct.elements[6]*=u,Ct.elements[8]*=c,Ct.elements[9]*=c,Ct.elements[10]*=c,t.setFromRotationMatrix(Ct),r.x=i,r.y=a,r.z=o,this}),makePerspective:function(e,t,r,n,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(r-n),u=(t+e)/(t-e),c=(r+n)/(r-n),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),u=1/(a-i),c=(t+e)*s,h=(r+n)*l,d=(a+i)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Xt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Xt.DefaultOrder="XYZ",Object.defineProperties(Xt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Xt.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=Tt.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],u=i[5],c=i[9],h=i[2],d=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(){var e=new Wt;return function(t,r,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(kt=new Mt,function(e){return kt.setFromEuler(this),this.setFromQuaternion(kt,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Rt(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Yt.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var qt,Zt,Jt,Kt,Qt,$t,er,tr,rr,nr,ir,ar,or,sr,lr,ur,cr,hr,dr,fr,pr=0;function mr(){Object.defineProperty(this,"id",{value:pr++}),this.uuid=Tt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mr.DefaultUp.clone();var e=new Rt,t=new Xt,r=new Mt,n=new Rt(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Wt},normalMatrix:{value:new At}}),this.matrix=new Wt,this.matrixWorld=new Wt,this.matrixAutoUpdate=mr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Yt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function vr(){mr.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function gr(e,t){this.min=void 0!==e?e:new Rt(1/0,1/0,1/0),this.max=void 0!==t?t:new Rt(-1/0,-1/0,-1/0)}function yr(e,t){this.center=void 0!==e?e:new Rt,this.radius=void 0!==t?t:0}function _r(e,t){this.origin=void 0!==e?e:new Rt,this.direction=void 0!==t?t:new Rt}function br(e,t,r){this.a=void 0!==e?e:new Rt,this.b=void 0!==t?t:new Rt,this.c=void 0!==r?r:new Rt}mr.DefaultUp=new Rt(0,1,0),mr.DefaultMatrixAutoUpdate=!0,mr.prototype=Object.assign(Object.create(t.prototype),{constructor:mr,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(fr=new Mt,function(e,t){return fr.setFromAxisAngle(e,t),this.quaternion.multiply(fr),this}),rotateOnWorldAxis:function(){var e=new Mt;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Rt(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Rt(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Rt(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Rt;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new Rt(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Rt(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Rt(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(dr=new Wt,function(e){return e.applyMatrix4(dr.getInverse(this.matrixWorld))}),lookAt:function(){var e=new Mt,t=new Wt,r=new Rt,n=new Rt;return function(i,a,o){i.isVector3?r.copy(i):r.set(i,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(n,r,this.up):t.lookAt(r,n,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent({type:"removed"})),this},attach:(hr=new Wt,function(e){return this.updateWorldMatrix(!0,!1),hr.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),hr.multiply(e.parent.matrixWorld)),e.applyMatrix(hr),e.updateWorldMatrix(!1,!1),this.add(e),this}),getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r],a=i.getObjectByProperty(e,t);if(void 0!==a)return a}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Rt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(ur=new Rt,cr=new Rt,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Mt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ur,e,cr),e}),getWorldScale:function(){var e=new Rt,t=new Mt;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Rt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Rt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,i=0,a=n.length;i<a;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==ct&&(n.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];i(e.shapes,u)}else i(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],s=0,l=this.material.length;s<l;s++)c.push(i(e.materials,this.material[s]));n.material=c}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(var s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),d=m(e.materials),f=m(e.textures),p=m(e.images),o=m(e.shapes);h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),f.length>0&&(r.textures=f),p.length>0&&(r.images=p),o.length>0&&(r.shapes=o)}return r.object=n,r;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}}),vr.prototype=Object.assign(Object.create(mr.prototype),{constructor:vr,isScene:!0,copy:function(e,t){return mr.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(gr.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<r&&(r=c),h<n&&(n=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<r&&(r=c),h<n&&(n=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Rt;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Rt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Rt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,r,n=new Rt;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)n.copy(o[t]),n.applyMatrix4(i.matrixWorld),e.expandByPoint(n)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t).applyMatrix4(i.matrixWorld),e.expandByPoint(n)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(i),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Rt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(lr=new Rt,function(e){return this.clampPoint(e.center,lr),lr.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(){var e=new Rt,t=new Rt,r=new Rt,n=new Rt,i=new Rt,a=new Rt,o=new Rt,s=new Rt,l=new Rt,u=new Rt;function c(n){var i,a;for(i=0,a=n.length-3;i<=a;i+=3){o.fromArray(n,i);var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),u=e.dot(o),c=t.dot(o),h=r.dot(o);if(Math.max(-Math.max(u,c,h),Math.min(u,c,h))>s)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),e.subVectors(o.a,s),t.subVectors(o.b,s),r.subVectors(o.c,s),n.subVectors(t,e),i.subVectors(r,t),a.subVectors(e,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-a.z,a.y,n.z,0,-n.x,i.z,0,-i.x,a.z,0,-a.x,-n.y,n.x,0,-i.y,i.x,0,-a.y,a.x,0];return!!c(h)&&!!c(h=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(n,i),c(h=[u.x,u.y,u.z]))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Rt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Rt;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new Rt;return function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(sr=[new Rt,new Rt,new Rt,new Rt,new Rt,new Rt,new Rt,new Rt],function(e){return this.isEmpty()?this:(sr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),sr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),sr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),sr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),sr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),sr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),sr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),sr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(sr),this)}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(yr.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(or=new gr,function(e,t){var r=this.center;void 0!==t?r.copy(t):or.setFromPoints(e).getCenter(r);for(var n=0,i=0,a=e.length;i<a;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Rt),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new gr),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(_r.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Rt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Rt;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Rt),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Rt;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(nr=new Rt,ir=new Rt,ar=new Rt,function(e,t,r,n){nr.copy(e).add(t).multiplyScalar(.5),ir.copy(t).sub(e).normalize(),ar.copy(this.origin).sub(nr);var i,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(ir),c=ar.dot(this.direction),h=-ar.dot(ir),d=ar.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(a=u*c-h,s=l*f,(i=u*h-c)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(i*=p)*(i+u*(a*=p)+2*c)+a*(u*i+a+2*h)+d}else a=l,i=Math.max(0,-(u*a+c)),o=-i*i+a*(a+2*h)+d;else a=-l,i=Math.max(0,-(u*a+c)),o=-i*i+a*(a+2*h)+d;else a<=-s?(i=Math.max(0,-(-u*l+c)),a=i>0?-l:Math.min(Math.max(-l,-h),l),o=-i*i+a*(a+2*h)+d):a<=s?(i=0,a=Math.min(Math.max(-l,-h),l),o=a*(a+2*h)+d):(i=Math.max(0,-(u*l+c)),a=i>0?l:Math.min(Math.max(-l,-h),l),o=-i*i+a*(a+2*h)+d);else a=u>0?-l:l,i=Math.max(0,-(u*a+c)),o=-i*i+a*(a+2*h)+d;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(ir).multiplyScalar(a).add(nr),o}),intersectSphere:function(){var e=new Rt;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,a=t.radius*t.radius;if(i>a)return null;var o=Math.sqrt(a-i),s=n-o,l=n+o;return s<0&&l<0?null:s<0?this.at(l,r):this.at(s,r)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return r*t<0},intersectBox:function(e,t){var r,n,i,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:(rr=new Rt,function(e){return null!==this.intersectBox(e,rr)}),intersectTriangle:function(){var e=new Rt,t=new Rt,r=new Rt,n=new Rt;return function(i,a,o,s,l){t.subVectors(a,i),r.subVectors(o,i),n.crossVectors(t,r);var u,c=this.direction.dot(n);if(c>0){if(s)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}e.subVectors(this.origin,i);var h=u*this.direction.dot(r.crossVectors(e,r));if(h<0)return null;var d=u*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>c)return null;var f=-u*e.dot(n);return f<0?null:this.at(f/c,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(br,{getNormal:(tr=new Rt,function(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Rt),n.subVectors(r,t),tr.subVectors(e,t),n.cross(tr);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}),getBarycoord:function(){var e=new Rt,t=new Rt,r=new Rt;return function(n,i,a,o,s){e.subVectors(o,i),t.subVectors(a,i),r.subVectors(n,i);var l=e.dot(e),u=e.dot(t),c=e.dot(r),h=t.dot(t),d=t.dot(r),f=l*h-u*u;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Rt),0===f)return s.set(-2,-1,-1);var p=1/f,m=(h*c-u*d)*p,v=(l*d-u*c)*p;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var e=new Rt;return function(t,r,n,i){return br.getBarycoord(t,r,n,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:(er=new Rt,function(e,t,r,n,i,a,o,s){return this.getBarycoord(e,t,r,n,er),s.set(0,0),s.addScaledVector(i,er.x),s.addScaledVector(a,er.y),s.addScaledVector(o,er.z),s}),isFrontFacing:function(){var e=new Rt,t=new Rt;return function(r,n,i,a){return e.subVectors(i,n),t.subVectors(r,n),e.cross(t).dot(a)<0}}()}),Object.assign(br.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Rt,t=new Rt;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Rt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return br.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Rt),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return br.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,n,i){return br.getUV(e,this.a,this.b,this.c,t,r,n,i)},containsPoint:function(e){return br.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return br.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:(qt=new Rt,Zt=new Rt,Jt=new Rt,Kt=new Rt,Qt=new Rt,$t=new Rt,function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Rt);var r,n,i=this.a,a=this.b,o=this.c;qt.subVectors(a,i),Zt.subVectors(o,i),Kt.subVectors(e,i);var s=qt.dot(Kt),l=Zt.dot(Kt);if(s<=0&&l<=0)return t.copy(i);Qt.subVectors(e,a);var u=qt.dot(Qt),c=Zt.dot(Qt);if(u>=0&&c<=u)return t.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return r=s/(s-u),t.copy(i).addScaledVector(qt,r);$t.subVectors(e,o);var d=qt.dot($t),f=Zt.dot($t);if(f>=0&&d<=f)return t.copy(o);var p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return n=l/(l-f),t.copy(i).addScaledVector(Zt,n);var m=u*f-d*c;if(m<=0&&c-u>=0&&d-f>=0)return Jt.subVectors(o,a),n=(c-u)/(c-u+(d-f)),t.copy(a).addScaledVector(Jt,n);var v=1/(m+p+h);return r=p*v,n=h*v,t.copy(i).addScaledVector(qt,r).addScaledVector(Zt,n)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Er,wr,xr,Tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Sr(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function Mr(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function Rr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ar(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function kr(e,t,r,n,i,a){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new Rt,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Sr,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}Object.assign(Sr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=Tt.euclideanModulo(e,1),t=Tt.clamp(t,0,1),r=Tt.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=Mr(i,n,e+1/3),this.g=Mr(i,n,e),this.b=Mr(i,n,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=r[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}if(e&&e.length>0){var u=Tr[e];void 0!==u?this.setHex(u):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this},copyLinearToSRGB:function(e){return this.r=Ar(e.r),this.g=Ar(e.g),this.b=Ar(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),l=(s+o)/2;if(s===o)t=0,r=0;else{var u=o-s;switch(r=l<=.5?u/(o+s):u/(2-o-s),o){case n:t=(i-a)/u+(i<a?6:0);break;case i:t=(a-n)/u+2;break;case a:t=(n-i)/u+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(xr={},function(e,t,r){return this.getHSL(xr),xr.h+=e,xr.s+=t,xr.l+=r,this.setHSL(xr.h,xr.s,xr.l),this}),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(Er={h:0,s:0,l:0},wr={h:0,s:0,l:0},function(e,t){this.getHSL(Er),e.getHSL(wr);var r=Tt.lerp(Er.h,wr.h,t),n=Tt.lerp(Er.s,wr.s,t),i=Tt.lerp(Er.l,wr.l,t);return this.setHSL(r,n,i),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(kr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Pr=0;function Cr(){Object.defineProperty(this,"id",{value:Pr++}),this.uuid=Tt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=y,this.side=h,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=p,this.opacity=1,this.transparent=!1,this.blendSrc=L,this.blendDst=I,this.blendEquation=x,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=j,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function Lr(e){Cr.call(this),this.type="MeshBasicMaterial",this.color=new Sr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Ir(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Or(e,t,r){Ir.call(this,new Int8Array(e),t,r)}function Hr(e,t,r){Ir.call(this,new Uint8Array(e),t,r)}function Dr(e,t,r){Ir.call(this,new Uint8ClampedArray(e),t,r)}function Nr(e,t,r){Ir.call(this,new Int16Array(e),t,r)}function Fr(e,t,r){Ir.call(this,new Uint16Array(e),t,r)}function Ur(e,t,r){Ir.call(this,new Int32Array(e),t,r)}function Br(e,t,r){Ir.call(this,new Uint32Array(e),t,r)}function zr(e,t,r){Ir.call(this,new Float32Array(e),t,r)}function jr(e,t,r){Ir.call(this,new Float64Array(e),t,r)}function Vr(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Gr(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}Cr.prototype=Object.assign(Object.create(t.prototype),{constructor:Cr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==y&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==h&&(r.side=this.side),this.vertexColors!==p&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),a=n(e.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Lr.prototype=Object.create(Cr.prototype),Lr.prototype.constructor=Lr,Lr.prototype.isMeshBasicMaterial=!0,Lr.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(Ir.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ir.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new Sr),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new St),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new Rt),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new jt),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Or.prototype=Object.create(Ir.prototype),Or.prototype.constructor=Or,Hr.prototype=Object.create(Ir.prototype),Hr.prototype.constructor=Hr,Dr.prototype=Object.create(Ir.prototype),Dr.prototype.constructor=Dr,Nr.prototype=Object.create(Ir.prototype),Nr.prototype.constructor=Nr,Fr.prototype=Object.create(Ir.prototype),Fr.prototype.constructor=Fr,Ur.prototype=Object.create(Ir.prototype),Ur.prototype.constructor=Ur,Br.prototype=Object.create(Ir.prototype),Br.prototype.constructor=Br,zr.prototype=Object.create(Ir.prototype),zr.prototype.constructor=zr,jr.prototype=Object.create(Ir.prototype),jr.prototype.constructor=jr,Object.assign(Vr.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,r.push(t)),t={start:3*a,materialIndex:n})}void 0!==t&&(t.count=3*a-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(var u=0;u<d;u++)c[u]={name:h[u].name,data:[]};this.morphTargets.normal=c}var f=e.skinIndices,p=e.skinWeights,m=f.length===n.length,v=p.length===n.length;n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var u=0;u<r.length;u++){var g=r[u];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=g.normal;this.normals.push(_,_,_)}var b=g.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var E=g.color;this.colors.push(E,E,E)}if(!0===a){var w=i[0][u];void 0!==w?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new St,new St,new St))}if(!0===o){var w=i[1][u];void 0!==w?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new St,new St,new St))}for(var x=0;x<l;x++){var T=s[x].vertices;t[x].data.push(T[g.a],T[g.b],T[g.c])}for(var x=0;x<d;x++){var S=h[x].vertexNormals[u];c[x].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Wr,Xr,Yr=1;function qr(){Object.defineProperty(this,"id",{value:Yr+=2}),this.uuid=Tt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Zr(e,t){mr.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new qr,this.material=void 0!==t?t:new Lr({color:16777215*Math.random()}),this.drawMode=ct,this.updateMorphTargets()}qr.prototype=Object.assign(Object.create(t.prototype),{constructor:qr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Gr(e)>65535?Br:Fr)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new Ir(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new At).getNormalMatrix(e);n.applyToBufferAttribute(r),r.needsUpdate=!0}var i=this.attributes.tangent;if(void 0!==i){var n=(new At).getNormalMatrix(e);n.applyToBufferAttribute(i),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Wt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Wt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Wt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Wt;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Wt;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:(Xr=new mr,function(e){Xr.lookAt(e),Xr.updateMatrix(),this.applyMatrix(Xr.matrix)}),center:(Wr=new Rt,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wr).negate(),this.translate(Wr.x,Wr.y,Wr.z),this}),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new zr(3*t.vertices.length,3),n=new zr(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new zr(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new zr(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Vr).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new Ir(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new Ir(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new Ir(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new Ir(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new Ir(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],u=0,c=l.length;u<c;u++){var h=l[u],d=new zr(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var f=new zr(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new zr(4*e.skinWeights.length,4);this.addAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){var e=new gr;return function(){null===this.boundingBox&&(this.boundingBox=new gr);var t=this.attributes.position,r=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),r)for(var n=0,i=r.length;n<i;n++){var a=r[n];e.setFromBufferAttribute(a),this.boundingBox.expandByPoint(e.min),this.boundingBox.expandByPoint(e.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new gr,t=new gr,r=new Rt;return function(){null===this.boundingSphere&&(this.boundingSphere=new yr);var n=this.attributes.position,i=this.morphAttributes.position;if(n){var a=this.boundingSphere.center;if(e.setFromBufferAttribute(n),i)for(var o=0,s=i.length;o<s;o++){var l=i[o];t.setFromBufferAttribute(l),e.expandByPoint(t.min),e.expandByPoint(t.max)}e.getCenter(a);for(var u=0,o=0,s=n.count;o<s;o++)r.fromBufferAttribute(n,o),u=Math.max(u,a.distanceToSquared(r));if(i)for(var o=0,s=i.length;o<s;o++)for(var l=i[o],c=0,h=l.count;c<h;c++)r.fromBufferAttribute(l,c),u=Math.max(u,a.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new Ir(new Float32Array(r.length),3));else for(var n=t.normal.array,i=0,a=n.length;i<a;i++)n[i]=0;var o,s,l,u=t.normal.array,c=new Rt,h=new Rt,d=new Rt,f=new Rt,p=new Rt;if(e)for(var m=e.array,i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],c.fromArray(r,o),h.fromArray(r,s),d.fromArray(r,l),f.subVectors(d,h),p.subVectors(c,h),f.cross(p),u[o]+=f.x,u[o+1]+=f.y,u[o+2]+=f.z,u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z;else for(var i=0,a=r.length;i<a;i+=9)c.fromArray(r,i),h.fromArray(r,i+3),d.fromArray(r,i+6),f.subVectors(d,h),p.subVectors(c,h),f.cross(p),u[i]=f.x,u[i+1]=f.y,u[i+2]=f.z,u[i+3]=f.x,u[i+4]=f.y,u[i+5]=f.z,u[i+6]=f.x,u[i+7]=f.y,u[i+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n],a=i.array,o=e.attributes[n],s=o.array,l=o.itemSize*t,u=Math.min(s.length,a.length-l),c=0,h=l;c<u;c++,h++)a[h]=s[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new Rt;return function(){for(var t=this.attributes.normal,r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){function e(e,t){for(var r=e.array,n=e.itemSize,i=new r.constructor(t.length*n),a=0,o=0,s=0,l=t.length;s<l;s++){a=t[s]*n;for(var u=0;u<n;u++)i[o++]=r[a++]}return new Ir(i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new qr,r=this.index.array,n=this.attributes;for(var i in n){var a=n[i],o=e(a,r);t.addAttribute(i,o)}var s=this.morphAttributes;for(i in s){for(var l=[],u=s[i],c=0,h=u.length;c<h;c++){var a=u[c],o=e(a,r);l.push(o)}t.morphAttributes[i]=l}for(var d=this.groups,c=0,f=d.length;c<f;c++){var p=d[c];t.addGroup(p.start,p.count,p.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var a=i[r],o=a.toJSON();""!==a.name&&(o.name=a.name),e.data.attributes[r]=o}var s={},l=!1;for(var r in this.morphAttributes){for(var u=this.morphAttributes[r],c=[],h=0,d=u.length;h<d;h++){var a=u[h],o=a.toJSON();""!==a.name&&(o.name=a.name),c.push(o)}c.length>0&&(s[r]=c,l=!0)}l&&(e.data.morphAttributes=s);var f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));var p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e},clone:function(){return(new qr).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[],u=s[t];for(r=0,n=u.length;r<n;r++)l.push(u[r].clone());this.morphAttributes[t]=l}var c=e.groups;for(r=0,n=c.length;r<n;r++){var h=c[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Zr.prototype=Object.assign(Object.create(mr.prototype),{constructor:Zr,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return mr.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var e=new Wt,t=new _r,r=new yr,n=new Rt,i=new Rt,a=new Rt,o=new Rt,s=new Rt,l=new Rt,u=new Rt,c=new Rt,h=new Rt,p=new St,m=new St,v=new St,g=new Rt,y=new Rt;function _(e,t,r,n,i,a,o,s){if(null===(t.side===d?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,t.side!==f,s)))return null;y.copy(s),y.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(y);return l<r.near||l>r.far?null:{distance:l,point:y.clone(),object:e}}function b(e,t,r,d,f,y,b,E,w,x){n.fromBufferAttribute(f,E),i.fromBufferAttribute(f,w),a.fromBufferAttribute(f,x);var T=e.morphTargetInfluences;if(t.morphTargets&&y&&T){u.set(0,0,0),c.set(0,0,0),h.set(0,0,0);for(var S=0,M=y.length;S<M;S++){var R=T[S],A=y[S];0!==R&&(o.fromBufferAttribute(A,E),s.fromBufferAttribute(A,w),l.fromBufferAttribute(A,x),u.addScaledVector(o.sub(n),R),c.addScaledVector(s.sub(i),R),h.addScaledVector(l.sub(a),R))}n.add(u),i.add(c),a.add(h)}var k=_(e,t,r,d,n,i,a,g);if(k){b&&(p.fromBufferAttribute(b,E),m.fromBufferAttribute(b,w),v.fromBufferAttribute(b,x),k.uv=br.getUV(g,n,i,a,p,m,v,new St));var P=new kr(E,w,x);br.getNormal(n,i,a,P.normal),k.face=P}return k}return function(n,i){var a,o=this.geometry,s=this.material,l=this.matrixWorld;if(void 0!==s&&(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)&&(e.getInverse(l),t.copy(n.ray).applyMatrix4(e),null===o.boundingBox||!1!==t.intersectsBox(o.boundingBox))))if(o.isBufferGeometry){var u,c,h,d,f,y,E,w,x,T,S,M=o.index,R=o.attributes.position,A=o.morphAttributes.position,k=o.attributes.uv,P=o.groups,C=o.drawRange;if(null!==M)if(Array.isArray(s))for(d=0,y=P.length;d<y;d++)for(w=P[d],x=s[w.materialIndex],T=Math.max(w.start,C.start),S=Math.min(w.start+w.count,C.start+C.count),f=T,E=S;f<E;f+=3)u=M.getX(f),c=M.getX(f+1),h=M.getX(f+2),(a=b(this,x,n,t,R,A,k,u,c,h))&&(a.faceIndex=Math.floor(f/3),a.face.materialIndex=w.materialIndex,i.push(a));else for(T=Math.max(0,C.start),S=Math.min(M.count,C.start+C.count),d=T,y=S;d<y;d+=3)u=M.getX(d),c=M.getX(d+1),h=M.getX(d+2),(a=b(this,s,n,t,R,A,k,u,c,h))&&(a.faceIndex=Math.floor(d/3),i.push(a));else if(void 0!==R)if(Array.isArray(s))for(d=0,y=P.length;d<y;d++)for(w=P[d],x=s[w.materialIndex],T=Math.max(w.start,C.start),S=Math.min(w.start+w.count,C.start+C.count),f=T,E=S;f<E;f+=3)(a=b(this,x,n,t,R,A,k,u=f,c=f+1,h=f+2))&&(a.faceIndex=Math.floor(f/3),a.face.materialIndex=w.materialIndex,i.push(a));else for(T=Math.max(0,C.start),S=Math.min(R.count,C.start+C.count),d=T,y=S;d<y;d+=3)(a=b(this,s,n,t,R,A,k,u=d,c=d+1,h=d+2))&&(a.faceIndex=Math.floor(d/3),i.push(a))}else if(o.isGeometry){var L,I,O,H,D=Array.isArray(s),N=o.vertices,F=o.faces,U=o.faceVertexUvs[0];U.length>0&&(H=U);for(var B=0,z=F.length;B<z;B++){var j=F[B],V=D?s[j.materialIndex]:s;if(void 0!==V&&(L=N[j.a],I=N[j.b],O=N[j.c],a=_(this,V,n,t,L,I,O,g))){if(H&&H[B]){var G=H[B];p.copy(G[0]),m.copy(G[1]),v.copy(G[2]),a.uv=br.getUV(g,L,I,O,p,m,v,new St)}a.face=j,a.faceIndex=B,i.push(a)}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Jr=0;function Kr(){Object.defineProperty(this,"id",{value:Jr+=2}),this.uuid=Tt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Qr(e,t,r,n,i,a){Kr.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new $r(e,t,r,n,i,a)),this.mergeVertices()}function $r(e,t,r,n,i,a){qr.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:a};var o=this;e=e||1,t=t||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,a=Math.floor(a)||1;var s=[],l=[],u=[],c=[],h=0,d=0;function f(e,t,r,n,i,a,f,p,m,v,g){var y,_,b=a/m,E=f/v,w=a/2,x=f/2,T=p/2,S=m+1,M=v+1,R=0,A=0,k=new Rt;for(_=0;_<M;_++){var P=_*E-x;for(y=0;y<S;y++){var C=y*b-w;k[e]=C*n,k[t]=P*i,k[r]=T,l.push(k.x,k.y,k.z),k[e]=0,k[t]=0,k[r]=p>0?1:-1,u.push(k.x,k.y,k.z),c.push(y/m),c.push(1-_/v),R+=1}}for(_=0;_<v;_++)for(y=0;y<m;y++){var L=h+y+S*_,I=h+y+S*(_+1),O=h+(y+1)+S*(_+1),H=h+(y+1)+S*_;s.push(L,I,H),s.push(I,O,H),A+=6}o.addGroup(d,A,g),d+=A,h+=R}f("z","y","x",-1,-1,r,t,e,a,i,0),f("z","y","x",1,-1,r,t,-e,a,i,1),f("x","z","y",1,1,e,r,t,n,a,2),f("x","z","y",1,-1,e,r,-t,n,a,3),f("x","y","z",1,-1,e,t,r,n,i,4),f("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(s),this.addAttribute("position",new zr(l,3)),this.addAttribute("normal",new zr(u,3)),this.addAttribute("uv",new zr(c,2))}function en(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}function tn(e){for(var t={},r=0;r<e.length;r++){var n=en(e[r]);for(var i in n)t[i]=n[i]}return t}Kr.prototype=Object.assign(Object.create(t.prototype),{constructor:Kr,isGeometry:!0,applyMatrix:function(e){for(var t=(new At).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){var i=this.vertices[r];i.applyMatrix4(e)}for(var r=0,n=this.faces.length;r<n;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++)a.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Wt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Wt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Wt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Wt;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Wt;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new mr;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,i=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,o=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0;u<i.length;u+=3)t.vertices.push((new Rt).fromArray(i,u)),void 0!==o&&t.colors.push((new Sr).fromArray(o,u));function c(e,r,n,i){var u=void 0===o?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],c=void 0===a?[]:[(new Rt).fromArray(a,3*e),(new Rt).fromArray(a,3*r),(new Rt).fromArray(a,3*n)],h=new kr(e,r,n,c,u,i);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new St).fromArray(s,2*e),(new St).fromArray(s,2*r),(new St).fromArray(s,2*n)]),void 0!==l&&t.faceVertexUvs[1].push([(new St).fromArray(l,2*e),(new St).fromArray(l,2*r),(new St).fromArray(l,2*n)])}var h=e.groups;if(h.length>0)for(var u=0;u<h.length;u++)for(var d=h[u],f=d.start,p=d.count,m=f,v=f+p;m<v;m+=3)void 0!==r?c(r[m],r[m+1],r[m+2],d.materialIndex):c(m,m+1,m+2,d.materialIndex);else if(void 0!==r)for(var u=0;u<r.length;u+=3)c(r[u],r[u+1],r[u+2]);else for(var u=0;u<i.length/3;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new Rt;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new Wt;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new Rt,t=new Rt,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)o[t]=new Rt;if(e){var s,l,u,c=new Rt,h=new Rt;for(n=0,i=this.faces.length;n<i;n++)a=this.faces[n],s=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],c.subVectors(u,l),h.subVectors(s,l),c.cross(h),o[a.a].add(c),o[a.b].add(c),o[a.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a=this.faces[n],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)o[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var d=(a=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var a=new Kr;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Rt,u={a:new Rt,b:new Rt,c:new Rt},o.push(l),s.push(u)}var l,u,c=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=c.faceNormals[r],u=c.vertexNormals[r],l.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new gr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new yr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,u=this.faceVertexUvs[0],c=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new At).getNormalMatrix(t));for(var f=0,p=o.length;f<p;f++){var m=o[f],v=m.clone();void 0!==t&&v.applyMatrix4(t),a.push(v)}for(var f=0,p=d.length;f<p;f++)h.push(d[f].clone());for(f=0,p=l.length;f<p;f++){var g,y,_,b=l[f],E=b.vertexNormals,w=b.vertexColors;(g=new kr(b.a+i,b.b+i,b.c+i)).normal.copy(b.normal),void 0!==n&&g.normal.applyMatrix3(n).normalize();for(var x=0,T=E.length;x<T;x++)y=E[x].clone(),void 0!==n&&y.applyMatrix3(n).normalize(),g.vertexNormals.push(y);g.color.copy(b.color);for(var x=0,T=w.length;x<T;x++)_=w[x],g.vertexColors.push(_.clone());g.materialIndex=b.materialIndex+r,s.push(g)}for(f=0,p=c.length;f<p;f++){var S=c[f],M=[];if(void 0!==S){for(var x=0,T=S.length;x<T;x++)M.push(S[x].clone());u.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,a,o,s,l={},u=[],c=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h),void 0===l[t]?(l[t]=r,u.push(this.vertices[r]),c[r]=u.length-1):c[r]=c[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],a=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var p=d[r];for(this.faces.splice(p,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(p,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new Rt(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(n=[]),o&&o.length===t&&(i=[]);for(var r=0;r<t;r++){var s=e[r]._id;n&&n.push(a[s]),i&&i.push(o[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}for(var o=[],s=[],l={},u=[],c={},h=[],d={},i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,v=f.vertexNormals.length>0,g=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,_=0;if(_=x(_,0,0),_=x(_,1,!0),_=x(_,2,!1),_=x(_,3,p),_=x(_,4,m),_=x(_,5,v),_=x(_,6,g),_=x(_,7,y),o.push(_),o.push(f.a,f.b,f.c),o.push(f.materialIndex),p){var b=this.faceVertexUvs[0][i];o.push(M(b[0]),M(b[1]),M(b[2]))}if(m&&o.push(T(f.normal)),v){var E=f.vertexNormals;o.push(T(E[0]),T(E[1]),T(E[2]))}if(g&&o.push(S(f.color)),y){var w=f.vertexColors;o.push(S(w[0]),S(w[1]),S(w[2]))}}function x(e,t,r){return r?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function S(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]?c[t]:(c[t]=u.length,u.push(e.getHex()),c[t])}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=n,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new Kr).copy(this)},copy:function(e){var t,r,n,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var u=e.faces;for(t=0,r=u.length;t<r;t++)this.faces.push(u[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=c.length;n<i;n++){var h=c[n],d=[];for(a=0,o=h.length;a<o;a++){var f=h[a];d.push(f.clone())}this.faceVertexUvs[t].push(d)}}var p=e.morphTargets;for(t=0,r=p.length;t<r;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],n=0,i=p[t].vertices.length;n<i;n++)m.vertices.push(p[t].vertices[n].clone());if(void 0!==p[t].normals)for(m.normals=[],n=0,i=p[t].normals.length;n<i;n++)m.normals.push(p[t].normals[n].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,r=v.length;t<r;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],n=0,i=v[t].vertexNormals.length;n<i;n++){var y=v[t].vertexNormals[n],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),g.vertexNormals.push(_)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],n=0,i=v[t].faceNormals.length;n<i;n++)g.faceNormals.push(v[t].faceNormals[n].clone());this.morphNormals.push(g)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var E=e.skinIndices;for(t=0,r=E.length;t<r;t++)this.skinIndices.push(E[t].clone());var w=e.lineDistances;for(t=0,r=w.length;t<r;t++)this.lineDistances.push(w[t]);var x=e.boundingBox;null!==x&&(this.boundingBox=x.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Qr.prototype=Object.create(Kr.prototype),Qr.prototype.constructor=Qr,$r.prototype=Object.create(qr.prototype),$r.prototype.constructor=$r;var rn={clone:en,merge:tn},nn="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",an="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function on(e){Cr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=nn,this.fragmentShader=an,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function sn(){mr.call(this),this.type="Camera",this.matrixWorldInverse=new Wt,this.projectionMatrix=new Wt,this.projectionMatrixInverse=new Wt}function ln(e,t,r,n){sn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}on.prototype=Object.create(Cr.prototype),on.prototype.constructor=on,on.prototype.isShaderMaterial=!0,on.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=en(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},on.prototype.toJSON=function(e){var t=Cr.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var n=this.uniforms[r],i=n.value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t},sn.prototype=Object.assign(Object.create(mr.prototype),{constructor:sn,isCamera:!0,copy:function(e,t){return mr.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Rt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){mr.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ln.prototype=Object.assign(Object.create(sn.prototype),{constructor:ln,isPerspectiveCamera:!0,copy:function(e,t){return sn.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Tt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Tt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Tt.RAD2DEG*Math.atan(Math.tan(.5*Tt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Tt.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*n/o,t-=a.offsetY*r/s,n*=a.width/o,r*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var un,cn,hn=90,dn=1;function fn(e,t,r,n){mr.call(this),this.type="CubeCamera";var i=new ln(hn,dn,e,t);i.up.set(0,-1,0),i.lookAt(new Rt(1,0,0)),this.add(i);var a=new ln(hn,dn,e,t);a.up.set(0,-1,0),a.lookAt(new Rt(-1,0,0)),this.add(a);var o=new ln(hn,dn,e,t);o.up.set(0,0,1),o.lookAt(new Rt(0,1,0)),this.add(o);var s=new ln(hn,dn,e,t);s.up.set(0,0,-1),s.lookAt(new Rt(0,-1,0)),this.add(s);var l=new ln(hn,dn,e,t);l.up.set(0,-1,0),l.lookAt(new Rt(0,0,1)),this.add(l);var u=new ln(hn,dn,e,t);u.up.set(0,-1,0),u.lookAt(new Rt(0,0,-1)),this.add(u),n=n||{format:Ce,magFilter:me,minFilter:me},this.renderTarget=new pn(r,r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),n=this.renderTarget,c=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=c,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(r)},this.clear=function(e,t,r,n){for(var i=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,r,n);e.setRenderTarget(i)}}function pn(e,t,r){Vt.call(this,e,t,r)}function mn(e,t,r,n,i,a,o,s,l,u,c,h){zt.call(this,null,a,o,s,l,u,n,i,c,h),this.image={data:e,width:t,height:r},this.magFilter=void 0!==l?l:de,this.minFilter=void 0!==u?u:de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function vn(e,t){this.normal=void 0!==e?e:new Rt(1,0,0),this.constant=void 0!==t?t:0}function gn(e,t,r,n,i,a){this.planes=[void 0!==e?e:new vn,void 0!==t?t:new vn,void 0!==r?r:new vn,void 0!==n?n:new vn,void 0!==i?i:new vn,void 0!==a?a:new vn]}fn.prototype=Object.create(mr.prototype),fn.prototype.constructor=fn,pn.prototype=Object.create(Vt.prototype),pn.prototype.constructor=pn,pn.prototype.isWebGLRenderTargetCube=!0,pn.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new vr,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new on({type:"CubemapFromEquirect",uniforms:en(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:d,blending:g});i.uniforms.tEquirect.value=t;var a=new Zr(new $r(5,5,5),i);r.add(a);var o=new fn(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(e,r),a.geometry.dispose(),a.material.dispose(),this},mn.prototype=Object.create(zt.prototype),mn.prototype.constructor=mn,mn.prototype.isDataTexture=!0,Object.assign(vn.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Rt,t=new Rt;return function(r,n,i){var a=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(a,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Rt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Rt;return function(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Rt);var n=t.delta(e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/i;return a<0||a>1?void 0:r.copy(n).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Rt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Rt,t=new At;return function(r,n){var i=n||t.getNormalMatrix(r),a=this.coplanarPoint(e).applyMatrix4(r),o=this.normal.applyMatrix3(i).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(gn.prototype,{set:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],f=r[10],p=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(o-n,c-s,p-h,y-m).normalize(),t[1].setComponents(o+n,c+s,p+h,y+m).normalize(),t[2].setComponents(o+i,c+l,p+d,y+v).normalize(),t[3].setComponents(o-i,c-l,p-d,y-v).normalize(),t[4].setComponents(o-a,c-u,p-f,y-g).normalize(),t[5].setComponents(o+a,c+u,p+f,y+g).normalize(),this},intersectsObject:(cn=new yr,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),cn.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(cn)}),intersectsSprite:function(){var e=new yr;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){var a=t[i].distanceToPoint(r);if(a<n)return!1}return!0},intersectsBox:(un=new Rt,function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(un.x=n.normal.x>0?e.max.x:e.min.x,un.y=n.normal.y>0?e.max.y:e.min.y,un.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(un)<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var yn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},_n={common:{diffuse:{value:new Sr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new At},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new St(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Sr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Sr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new At}},sprite:{diffuse:{value:new Sr(15658734)},opacity:{value:1},center:{value:new St(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new At}}},bn={basic:{uniforms:tn([_n.common,_n.specularmap,_n.envmap,_n.aomap,_n.lightmap,_n.fog]),vertexShader:yn.meshbasic_vert,fragmentShader:yn.meshbasic_frag},lambert:{uniforms:tn([_n.common,_n.specularmap,_n.envmap,_n.aomap,_n.lightmap,_n.emissivemap,_n.fog,_n.lights,{emissive:{value:new Sr(0)}}]),vertexShader:yn.meshlambert_vert,fragmentShader:yn.meshlambert_frag},phong:{uniforms:tn([_n.common,_n.specularmap,_n.envmap,_n.aomap,_n.lightmap,_n.emissivemap,_n.bumpmap,_n.normalmap,_n.displacementmap,_n.gradientmap,_n.fog,_n.lights,{emissive:{value:new Sr(0)},specular:{value:new Sr(1118481)},shininess:{value:30}}]),vertexShader:yn.meshphong_vert,fragmentShader:yn.meshphong_frag},standard:{uniforms:tn([_n.common,_n.envmap,_n.aomap,_n.lightmap,_n.emissivemap,_n.bumpmap,_n.normalmap,_n.displacementmap,_n.roughnessmap,_n.metalnessmap,_n.fog,_n.lights,{emissive:{value:new Sr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag},matcap:{uniforms:tn([_n.common,_n.bumpmap,_n.normalmap,_n.displacementmap,_n.fog,{matcap:{value:null}}]),vertexShader:yn.meshmatcap_vert,fragmentShader:yn.meshmatcap_frag},points:{uniforms:tn([_n.points,_n.fog]),vertexShader:yn.points_vert,fragmentShader:yn.points_frag},dashed:{uniforms:tn([_n.common,_n.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yn.linedashed_vert,fragmentShader:yn.linedashed_frag},depth:{uniforms:tn([_n.common,_n.displacementmap]),vertexShader:yn.depth_vert,fragmentShader:yn.depth_frag},normal:{uniforms:tn([_n.common,_n.bumpmap,_n.normalmap,_n.displacementmap,{opacity:{value:1}}]),vertexShader:yn.normal_vert,fragmentShader:yn.normal_frag},sprite:{uniforms:tn([_n.sprite,_n.fog]),vertexShader:yn.sprite_vert,fragmentShader:yn.sprite_frag},background:{uniforms:{uvTransform:{value:new At},t2D:{value:null}},vertexShader:yn.background_vert,fragmentShader:yn.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yn.cube_vert,fragmentShader:yn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yn.equirect_vert,fragmentShader:yn.equirect_frag},distanceRGBA:{uniforms:tn([_n.common,_n.displacementmap,{referencePosition:{value:new Rt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yn.distanceRGBA_vert,fragmentShader:yn.distanceRGBA_frag},shadow:{uniforms:tn([_n.lights,_n.fog,{color:{value:new Sr(0)},opacity:{value:1}}]),vertexShader:yn.shadow_vert,fragmentShader:yn.shadow_frag}};function En(){var e=null,t=!1,r=null;function n(i,a){!1!==t&&(r(i,a),e.requestAnimationFrame(n))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function wn(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=t.get(r);n&&(e.deleteBuffer(n.buffer),t.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);void 0===i?t.set(r,function(t,r){var n=t.array,i=t.dynamic?35048:35044,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,n,i),t.onUploadCallback();var o=5126;return n instanceof Float32Array?o=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?o=5123:n instanceof Int16Array?o=5122:n instanceof Uint32Array?o=5125:n instanceof Int32Array?o=5124:n instanceof Int8Array?o=5120:n instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(r,n)):i.version<r.version&&(function(t,r,n){var i=r.array,a=r.updateRange;e.bindBuffer(n,t),!1===r.dynamic?e.bufferData(n,i,35044):-1===a.count?e.bufferSubData(n,0,i):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,a.offset*i.BYTES_PER_ELEMENT,i.subarray(a.offset,a.offset+a.count)),a.count=-1)}(i.buffer,r,n),i.version=r.version)}}}function xn(e,t,r,n){Kr.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Tn(e,t,r,n)),this.mergeVertices()}function Tn(e,t,r,n){qr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(r)||1,u=Math.floor(n)||1,c=l+1,h=u+1,d=e/l,f=t/u,p=[],m=[],v=[],g=[];for(a=0;a<h;a++){var y=a*f-s;for(i=0;i<c;i++){var _=i*d-o;m.push(_,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-a/u)}}for(a=0;a<u;a++)for(i=0;i<l;i++){var b=i+c*a,E=i+c*(a+1),w=i+1+c*(a+1),x=i+1+c*a;p.push(b,E,x),p.push(E,w,x)}this.setIndex(p),this.addAttribute("position",new zr(m,3)),this.addAttribute("normal",new zr(v,3)),this.addAttribute("uv",new zr(g,2))}function Sn(e,t,r,n){var i,a,o=new Sr(0),s=0,l=null,u=0;function c(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),c(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){c(o,s=e)},render:function(t,n,f,p){var m=n.background,v=e.vr,g=v.getSession&&v.getSession();if(g&&"additive"===g.environmentBlendMode&&(m=null),null===m?(c(o,s),l=null,u=0):m&&m.isColor&&(c(m,1),p=!0,l=null,u=0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLRenderTargetCube)){void 0===a&&((a=new Zr(new $r(1,1,1),new on({type:"BackgroundCubeMaterial",uniforms:en(bn.cube.uniforms),vertexShader:bn.cube.vertexShader,fragmentShader:bn.cube.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(a));var y=m.isWebGLRenderTargetCube?m.texture:m;a.material.uniforms.tCube.value=y,a.material.uniforms.tFlip.value=m.isWebGLRenderTargetCube?1:-1,l===m&&u===y.version||(a.material.needsUpdate=!0,l=m,u=y.version),t.unshift(a,a.geometry,a.material,0,0,null)}else m&&m.isTexture&&(void 0===i&&((i=new Zr(new Tn(2,2),new on({type:"BackgroundMaterial",uniforms:en(bn.background.uniforms),vertexShader:bn.background.vertexShader,fragmentShader:bn.background.fragmentShader,side:h,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),i.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&u===m.version||(i.material.needsUpdate=!0,l=m,u=m.version),t.unshift(i,i.geometry,i.material,0,0,null))}}}function Mn(e,t,r,n){var i;this.setMode=function(e){i=e},this.render=function(t,n){e.drawArrays(i,t,n),r.update(n,i)},this.renderInstances=function(a,o,s){var l;if(n.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[n.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](i,o,s,a.maxInstancedCount),r.update(s,i,a.maxInstancedCount)}}function Rn(e,t,r){var n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=c>0,y=a||!!t.get("OES_texture_float"),_=g&&y,b=a?e.getParameter(36183):0;return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:_,maxSamples:b}}function An(){var e=this,t=null,r=0,n=!1,i=!1,a=new vn,o=new At,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,r,n,i){var l=null!==t?t.length:0,u=null;if(0!==l){if(u=s.value,!0!==i||null===u){var c=n+4*l,h=r.matrixWorldInverse;o.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,f=n;d!==l;++d,f+=4)a.copy(t[d]).applyMatrix4(h,o),a.normal.toArray(u,f),u[f+3]=a.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=l,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||0!==r||n;return n=i,t=u(e,a,0),r=e.length,o},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,a,o,c,h,d){if(!n||null===e||0===e.length||i&&!o)i?u(null):l();else{var f=i?0:r,p=4*f,m=h.clippingState||null;s.value=m,m=u(e,c,p,d);for(var v=0;v!==p;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=f}}}function kn(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}function Pn(e,t,r){var n={},i={};function a(e){var o=e.target,s=n[o.id];for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",a),delete n[o.id];var u=i[s.id];u&&(t.remove(u),delete i[s.id]),r.memory.geometries--}return{get:function(e,t){var i=n[t.id];return i||(t.addEventListener("dispose",a),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new qr).setFromObject(e)),i=t._bufferGeometry),n[t.id]=i,r.memory.geometries++,i)},update:function(e){var r=e.index,n=e.attributes;for(var i in null!==r&&t.update(r,34963),n)t.update(n[i],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var r=i[e.id];if(r)return r;var n=[],a=e.index,o=e.attributes;if(null!==a)for(var s=a.array,l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],d=s[l+2];n.push(c,h,h,d,d,c)}else for(var s=o.position.array,l=0,u=s.length/3-1;l<u;l+=3){var c=l+0,h=l+1,d=l+2;n.push(c,h,h,d,d,c)}return r=new(Gr(n)>65535?Br:Fr)(n,1),t.update(r,34963),i[e.id]=r,r}}}function Cn(e,t,r,n){var i,a,o;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,n){e.drawElements(i,n,a,t*o),r.update(n,i)},this.renderInstances=function(s,l,u){if(n.isWebGL2)c=e;else{var c=t.get("ANGLE_instanced_arrays");if(null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}c[n.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](i,u,a,l*o,s.maxInstancedCount),r.update(u,i,s.maxInstancedCount)}}function Ln(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,n){switch(n=n||1,t.calls++,r){case 4:t.triangles+=n*(e/3);break;case 5:case 6:t.triangles+=n*(e-2);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function In(e,t){return Math.abs(t[1])-Math.abs(e[1])}function On(e){var t={},r=new Float32Array(8);return{update:function(n,i,a,o){var s=n.morphTargetInfluences,l=s.length,u=t[i.id];if(void 0===u){u=[];for(var c=0;c<l;c++)u[c]=[c,0];t[i.id]=u}for(var h=a.morphTargets&&i.morphAttributes.position,d=a.morphNormals&&i.morphAttributes.normal,c=0;c<l;c++){var f=u[c];0!==f[1]&&(h&&i.removeAttribute("morphTarget"+c),d&&i.removeAttribute("morphNormal"+c))}for(var c=0;c<l;c++){var f=u[c];f[0]=c,f[1]=s[c]}u.sort(In);for(var c=0;c<8;c++){var f=u[c];if(f){var p=f[0],m=f[1];if(m){h&&i.addAttribute("morphTarget"+c,h[p]),d&&i.addAttribute("morphNormal"+c,d[p]),r[c]=m;continue}}r[c]=0}o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function Hn(e,t){var r={};return{update:function(n){var i=t.render.frame,a=n.geometry,o=e.get(n,a);return r[o.id]!==i&&(a.isGeometry&&o.updateFromObject(n),e.update(o),r[o.id]=i),o},dispose:function(){r={}}}}function Dn(e,t,r,n,i,a,o,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:re,o=void 0!==o?o:Ce,zt.call(this,e,t,r,n,i,a,o,s,l,u),this.flipY=!1}function Nn(e,t,r,n){zt.call(this,null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=de,this.minFilter=de,this.wrapR=ce,this.generateMipmaps=!1,this.flipY=!1}function Fn(e,t,r,n){zt.call(this,null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=de,this.minFilter=de,this.wrapR=ce,this.generateMipmaps=!1,this.flipY=!1}bn.physical={uniforms:tn([bn.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag},xn.prototype=Object.create(Kr.prototype),xn.prototype.constructor=xn,Tn.prototype=Object.create(qr.prototype),Tn.prototype.constructor=Tn,Dn.prototype=Object.create(zt.prototype),Dn.prototype.constructor=Dn,Dn.prototype.isCubeTexture=!0,Object.defineProperty(Dn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Nn.prototype=Object.create(zt.prototype),Nn.prototype.constructor=Nn,Nn.prototype.isDataTexture2DArray=!0,Fn.prototype=Object.create(zt.prototype),Fn.prototype.constructor=Fn,Fn.prototype.isDataTexture3D=!0;var Un=new zt,Bn=new Nn,zn=new Fn,jn=new Dn,Vn=[],Gn=[],Wn=new Float32Array(16),Xn=new Float32Array(9),Yn=new Float32Array(4);function qn(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,a=Vn[i];if(void 0===a&&(a=new Float32Array(i),Vn[i]=a),0!==t){n.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(a,s)}return a}function Zn(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Jn(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function Kn(e,t){var r=Gn[t];void 0===r&&(r=new Int32Array(t),Gn[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function Qn(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function $n(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Zn(r,t))return;e.uniform2fv(this.addr,t),Jn(r,t)}}function ei(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(Zn(r,t))return;e.uniform3fv(this.addr,t),Jn(r,t)}}function ti(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Zn(r,t))return;e.uniform4fv(this.addr,t),Jn(r,t)}}function ri(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Zn(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Jn(r,t)}else{if(Zn(r,n))return;Yn.set(n),e.uniformMatrix2fv(this.addr,!1,Yn),Jn(r,n)}}function ni(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Zn(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Jn(r,t)}else{if(Zn(r,n))return;Xn.set(n),e.uniformMatrix3fv(this.addr,!1,Xn),Jn(r,n)}}function ii(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Zn(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Jn(r,t)}else{if(Zn(r,n))return;Wn.set(n),e.uniformMatrix4fv(this.addr,!1,Wn),Jn(r,n)}}function ai(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(t||Un,i)}function oi(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||Bn,i)}function si(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||zn,i)}function li(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(t||jn,i)}function ui(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function ci(e,t){var r=this.cache;Zn(r,t)||(e.uniform2iv(this.addr,t),Jn(r,t))}function hi(e,t){var r=this.cache;Zn(r,t)||(e.uniform3iv(this.addr,t),Jn(r,t))}function di(e,t){var r=this.cache;Zn(r,t)||(e.uniform4iv(this.addr,t),Jn(r,t))}function fi(e,t){e.uniform1fv(this.addr,t)}function pi(e,t){e.uniform1iv(this.addr,t)}function mi(e,t){e.uniform2iv(this.addr,t)}function vi(e,t){e.uniform3iv(this.addr,t)}function gi(e,t){e.uniform4iv(this.addr,t)}function yi(e,t){var r=qn(t,this.size,2);e.uniform2fv(this.addr,r)}function _i(e,t){var r=qn(t,this.size,3);e.uniform3fv(this.addr,r)}function bi(e,t){var r=qn(t,this.size,4);e.uniform4fv(this.addr,r)}function Ei(e,t){var r=qn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function wi(e,t){var r=qn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function xi(e,t){var r=qn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function Ti(e,t,r){var n=t.length,i=Kn(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTexture2D(t[a]||Un,i[a])}function Si(e,t,r){var n=t.length,i=Kn(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTextureCube(t[a]||jn,i[a])}function Mi(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Qn;case 35664:return $n;case 35665:return ei;case 35666:return ti;case 35674:return ri;case 35675:return ni;case 35676:return ii;case 35678:case 36198:return ai;case 35679:return si;case 35680:return li;case 36289:return oi;case 5124:case 35670:return ui;case 35667:case 35671:return ci;case 35668:case 35672:return hi;case 35669:case 35673:return di}}(t.type)}function Ri(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return fi;case 35664:return yi;case 35665:return _i;case 35666:return bi;case 35674:return Ei;case 35675:return wi;case 35676:return xi;case 35678:return Ti;case 35680:return Si;case 5124:case 35670:return pi;case 35667:case 35671:return mi;case 35668:case 35672:return vi;case 35669:case 35673:return gi}}(t.type)}function Ai(e){this.id=e,this.seq=[],this.map={}}Ri.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Jn(t,e)},Ai.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,a=n.length;i!==a;++i){var o=n[i];o.setValue(e,t[o.id],r)}};var ki=/([\w\d_]+)(\])?(\[|\.)?/g;function Pi(e,t){e.seq.push(t),e.map[t.id]=t}function Ci(e,t,r){var n=e.name,i=n.length;for(ki.lastIndex=0;;){var a=ki.exec(n),o=ki.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===i){Pi(r,void 0===u?new Mi(s,e,t):new Ri(s,e,t));break}var c=r.map,h=c[s];void 0===h&&(h=new Ai(s),Pi(r,h)),r=h}}function Li(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),n=0;n<r;++n){var i=e.getActiveUniform(t,n),a=e.getUniformLocation(t,i.name);Ci(i,a,this)}}function Ii(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}Li.prototype.setValue=function(e,t,r,n){var i=this.map[t];void 0!==i&&i.setValue(e,r,n)},Li.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},Li.upload=function(e,t,r,n){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=r[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,n)}},Li.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var a=e[n];a.id in t&&r.push(a)}return r};var Oi=0;function Hi(e){switch(e){case ft:return["Linear","( value )"];case pt:return["sRGB","( value )"];case vt:return["RGBE","( value )"];case gt:return["RGBM","( value, 7.0 )"];case yt:return["RGBM","( value, 16.0 )"];case _t:return["RGBD","( value, 256.0 )"];case mt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Di(e,t,r){var n=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(n&&""===i)return"";var a=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(a)}function Ni(e,t){var r=Hi(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Fi(e,t){var r;switch(t){case K:r="Linear";break;case Q:r="Reinhard";break;case $:r="Uncharted2";break;case ee:r="OptimizedCineon";break;case te:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Ui(e){return""!==e}function Bi(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function zi(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function ji(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){var r=yn[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return ji(r)})}function Vi(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,n){for(var i="",a=parseInt(t);a<parseInt(r);a++)i+=n.replace(/\[ i \]/g,"[ "+a+" ]");return i})}function Gi(e,t,r,n,i,a,o){var s=e.context,l=n.defines,h=i.vertexShader,d=i.fragmentShader,f="SHADOWMAP_TYPE_BASIC";a.shadowMapType===u?f="SHADOWMAP_TYPE_PCF":a.shadowMapType===c&&(f="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",v="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(n.envMap.mapping){case re:case ne:p="ENVMAP_TYPE_CUBE";break;case se:case le:p="ENVMAP_TYPE_CUBE_UV";break;case ie:case ae:p="ENVMAP_TYPE_EQUIREC";break;case oe:p="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case ne:case ae:m="ENVMAP_MODE_REFRACTION"}switch(n.combine){case Y:v="ENVMAP_BLENDING_MULTIPLY";break;case q:v="ENVMAP_BLENDING_MIX";break;case Z:v="ENVMAP_BLENDING_ADD"}}var g,y,_,b,E,w=e.gammaFactor>0?e.gammaFactor:1,x=o.isWebGL2?"":function(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ui).join("\n")}(n.extensions,a,t),T=function(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(l),S=s.createProgram();if(n.isRawShaderMaterial?((g=[T].filter(Ui).join("\n")).length>0&&(g+="\n"),(y=[x,T].filter(Ui).join("\n")).length>0&&(y+="\n")):(g=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,T,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+w,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ui).join("\n"),y=[x,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,T,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+w,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+p:"",a.envMap?"#define "+m:"",a.envMap?"#define "+v:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==J?"#define TONE_MAPPING":"",a.toneMapping!==J?yn.tonemapping_pars_fragment:"",a.toneMapping!==J?Fi("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?yn.encodings_pars_fragment:"",a.mapEncoding?Ni("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?Ni("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?Ni("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Ni("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(_="linearToOutputTexel",b=a.outputEncoding,E=Hi(b),"vec4 "+_+"( vec4 value ) { return LinearTo"+E[0]+E[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ui).join("\n")),h=zi(h=Bi(h=ji(h),a),a),d=zi(d=Bi(d=ji(d),a),a),h=Vi(h),d=Vi(d),o.isWebGL2&&!n.isRawShaderMaterial){var M=!1,R=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==h.match(R)&&null!==d.match(R)&&(M=!0,h=h.replace(R,""),d=d.replace(R,"")),g=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y}var A,k,P=g+h,C=y+d,L=Ii(s,35633,P),I=Ii(s,35632,C);if(s.attachShader(S,L),s.attachShader(S,I),void 0!==n.index0AttributeName?s.bindAttribLocation(S,0,n.index0AttributeName):!0===a.morphTargets&&s.bindAttribLocation(S,0,"position"),s.linkProgram(S),e.debug.checkShaderErrors){var O=s.getProgramInfoLog(S).trim(),H=s.getShaderInfoLog(L).trim(),D=s.getShaderInfoLog(I).trim(),N=!0,F=!0;if(!1===s.getProgramParameter(S,35714)){N=!1;var U=Di(s,L,"vertex"),B=Di(s,I,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(S,35715),"gl.getProgramInfoLog",O,U,B)}else""!==O?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",O):""!==H&&""!==D||(F=!1);F&&(this.diagnostics={runnable:N,material:n,programLog:O,vertexShader:{log:H,prefix:g},fragmentShader:{log:D,prefix:y}})}return s.deleteShader(L),s.deleteShader(I),this.getUniforms=function(){return void 0===A&&(A=new Li(s,S)),A},this.getAttributes=function(){return void 0===k&&(k=function(e,t){for(var r={},n=e.getProgramParameter(t,35721),i=0;i<n;i++){var a=e.getActiveAttrib(t,i),o=a.name;r[o]=e.getAttribLocation(t,o)}return r}(s,S)),k},this.destroy=function(){s.deleteProgram(S),this.program=void 0},this.name=i.name,this.id=Oi++,this.code=r,this.usedTimes=1,this.program=S,this.vertexShader=L,this.fragmentShader=I,this}function Wi(e,t,r){var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function o(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=ft,r===ft&&t&&(r=mt),r}this.getParameters=function(t,n,a,s,l,u,c){var h=i[t.type],p=c.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(r.floatVertexTextures)return 1024;var n=r.maxVertexUniforms,i=Math.floor((n-20)/4),a=Math.min(i,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}(c):0,m=r.precision;null!==t.precision&&(m=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",m,"instead.");var v=e.getRenderTarget(),g={shaderID:h,precision:m,supportsVertexTextures:r.vertexTextures,outputEncoding:o(v?v.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:o(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:o(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:o(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===se||t.envMap.mapping===le),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:o(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===xt,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&p>0,maxBones:p,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:u,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===f,flipSided:t.side===d,depthPacking:void 0!==t.depthPacking&&t.depthPacking};return g},this.getProgramCode=function(t,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(var o=0;o<a.length;o++)n.push(r[a[o]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.push(e.gammaFactor),n.join()},this.acquireProgram=function(i,a,o,s){for(var l,u=0,c=n.length;u<c;u++){var h=n[u];if(h.code===s){++(l=h).usedTimes;break}}return void 0===l&&(l=new Gi(e,t,s,i,a,o,r),n.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function Xi(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}}function Yi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function qi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Zi(){var e=[],t=0,r=[],n=[],i={id:-1};function a(r,n,a,o,s,l){var u=e[t];return void 0===u?(u={id:r.id,object:r,geometry:n,material:a,program:a.program||i,groupOrder:o,renderOrder:r.renderOrder,z:s,group:l},e[t]=u):(u.id=r.id,u.object=r,u.geometry=n,u.material=a,u.program=a.program||i,u.groupOrder=o,u.renderOrder=r.renderOrder,u.z=s,u.group=l),t++,u}return{opaque:r,transparent:n,init:function(){t=0,r.length=0,n.length=0},push:function(e,t,i,o,s,l){var u=a(e,t,i,o,s,l);(!0===i.transparent?n:r).push(u)},unshift:function(e,t,i,o,s,l){var u=a(e,t,i,o,s,l);(!0===i.transparent?n:r).unshift(u)},sort:function(){r.length>1&&r.sort(Yi),n.length>1&&n.sort(qi)}}}function Ji(){var e={};function t(r){var n=r.target;n.removeEventListener("dispose",t),delete e[n.id]}return{get:function(r,n){var i,a=e[r.id];return void 0===a?(i=new Zi,e[r.id]={},e[r.id][n.id]=i,r.addEventListener("dispose",t)):void 0===(i=a[n.id])&&(i=new Zi,a[n.id]=i),i},dispose:function(){e={}}}}function Ki(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new Rt,color:new Sr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new St};break;case"SpotLight":r={position:new Rt,direction:new Rt,color:new Sr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new St};break;case"PointLight":r={position:new Rt,color:new Sr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new St,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Rt,skyColor:new Sr,groundColor:new Sr};break;case"RectAreaLight":r={color:new Sr,position:new Rt,halfWidth:new Rt,halfHeight:new Rt}}return e[t.id]=r,r}}}var Qi=0;function $i(){for(var e=new Ki,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;r<9;r++)t.probe.push(new Rt);var n=new Rt,i=new Wt,a=new Wt;return{setup:function(r,o,s){for(var l=0,u=0,c=0,h=0;h<9;h++)t.probe[h].set(0,0,0);for(var d=0,f=0,p=0,m=0,v=0,g=s.matrixWorldInverse,h=0,y=r.length;h<y;h++){var _=r[h],b=_.color,E=_.intensity,w=_.distance,x=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)l+=b.r*E,u+=b.g*E,c+=b.b*E;else if(_.isLightProbe)for(var T=0;T<9;T++)t.probe[T].addScaledVector(_.sh.coefficients[T],E);else if(_.isDirectionalLight){var S=e.get(_);if(S.color.copy(_.color).multiplyScalar(_.intensity),S.direction.setFromMatrixPosition(_.matrixWorld),n.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.shadow=_.castShadow,_.castShadow){var M=_.shadow;S.shadowBias=M.bias,S.shadowRadius=M.radius,S.shadowMapSize=M.mapSize}t.directionalShadowMap[d]=x,t.directionalShadowMatrix[d]=_.shadow.matrix,t.directional[d]=S,d++}else if(_.isSpotLight){var S=e.get(_);if(S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(g),S.color.copy(b).multiplyScalar(E),S.distance=w,S.direction.setFromMatrixPosition(_.matrixWorld),n.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.coneCos=Math.cos(_.angle),S.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),S.decay=_.decay,S.shadow=_.castShadow,_.castShadow){var M=_.shadow;S.shadowBias=M.bias,S.shadowRadius=M.radius,S.shadowMapSize=M.mapSize}t.spotShadowMap[p]=x,t.spotShadowMatrix[p]=_.shadow.matrix,t.spot[p]=S,p++}else if(_.isRectAreaLight){var S=e.get(_);S.color.copy(b).multiplyScalar(E),S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(g),a.identity(),i.copy(_.matrixWorld),i.premultiply(g),a.extractRotation(i),S.halfWidth.set(.5*_.width,0,0),S.halfHeight.set(0,.5*_.height,0),S.halfWidth.applyMatrix4(a),S.halfHeight.applyMatrix4(a),t.rectArea[m]=S,m++}else if(_.isPointLight){var S=e.get(_);if(S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(g),S.color.copy(_.color).multiplyScalar(_.intensity),S.distance=_.distance,S.decay=_.decay,S.shadow=_.castShadow,_.castShadow){var M=_.shadow;S.shadowBias=M.bias,S.shadowRadius=M.radius,S.shadowMapSize=M.mapSize,S.shadowCameraNear=M.camera.near,S.shadowCameraFar=M.camera.far}t.pointShadowMap[f]=x,t.pointShadowMatrix[f]=_.shadow.matrix,t.point[f]=S,f++}else if(_.isHemisphereLight){var S=e.get(_);S.direction.setFromMatrixPosition(_.matrixWorld),S.direction.transformDirection(g),S.direction.normalize(),S.skyColor.copy(_.color).multiplyScalar(E),S.groundColor.copy(_.groundColor).multiplyScalar(E),t.hemi[v]=S,v++}}t.ambient[0]=l,t.ambient[1]=u,t.ambient[2]=c;var R=t.hash;R.directionalLength===d&&R.pointLength===f&&R.spotLength===p&&R.rectAreaLength===m&&R.hemiLength===v&&R.shadowsLength===o.length||(t.directional.length=d,t.spot.length=p,t.rectArea.length=m,t.point.length=f,t.hemi.length=v,R.directionalLength=d,R.pointLength=f,R.spotLength=p,R.rectAreaLength=m,R.hemiLength=v,R.shadowsLength=o.length,t.version=Qi++)},state:t}}function ea(){var e=new $i,t=[],r=[],n={lightsArray:t,shadowsArray:r,lights:e};return{init:function(){t.length=0,r.length=0},state:n,setupLights:function(n){e.setup(t,r,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function ta(){var e={};function t(r){var n=r.target;n.removeEventListener("dispose",t),delete e[n.id]}return{get:function(r,n){var i;return void 0===e[r.id]?(i=new ea,e[r.id]={},e[r.id][n.id]=i,r.addEventListener("dispose",t)):void 0===e[r.id][n.id]?(i=new ea,e[r.id][n.id]=i):i=e[r.id][n.id],i},dispose:function(){e={}}}}function ra(e){Cr.call(this),this.type="MeshDepthMaterial",this.depthPacking=bt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function na(e){Cr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Rt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function ia(e,t,r){for(var n=new gn,i=new Wt,a=new St,o=new St(r,r),s=new Rt,l=new Rt,c=1,p=2,m=1+(c|p),v=new Array(m),y=new Array(m),_={},b={0:d,1:h,2:f},E=[new Rt(1,0,0),new Rt(-1,0,0),new Rt(0,0,1),new Rt(0,0,-1),new Rt(0,1,0),new Rt(0,-1,0)],w=[new Rt(0,1,0),new Rt(0,1,0),new Rt(0,1,0),new Rt(0,1,0),new Rt(0,0,1),new Rt(0,0,-1)],x=[new jt,new jt,new jt,new jt,new jt,new jt],T=0;T!==m;++T){var S=0!=(T&c),M=0!=(T&p),R=new ra({depthPacking:Et,morphTargets:S,skinning:M});v[T]=R;var A=new na({morphTargets:S,skinning:M});y[T]=A}var k=this;function P(t,r,n,i,a,o){var s=t.geometry,l=null,u=v,h=t.customDepthMaterial;if(n&&(u=y,h=t.customDistanceMaterial),h)l=h;else{var d=!1;r.morphTargets&&(s&&s.isBufferGeometry?d=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(d=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var f=t.isSkinnedMesh&&r.skinning,m=0;d&&(m|=c),f&&(m|=p),l=u[m]}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var g=l.uuid,E=r.uuid,w=_[g];void 0===w&&(w={},_[g]=w);var x=w[E];void 0===x&&(x=l.clone(),w[E]=x),l=x}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:b[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=a,l.farDistance=o),l}function C(r,i,a,o){if(!1!==r.visible){var s=r.layers.test(i.layers);if(s&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var u=t.update(r),c=r.material;if(Array.isArray(c))for(var h=u.groups,d=0,f=h.length;d<f;d++){var p=h[d],m=c[p.materialIndex];if(m&&m.visible){var v=P(r,m,o,l,a.near,a.far);e.renderBufferDirect(a,null,u,v,r,p)}}else if(c.visible){var v=P(r,c,o,l,a.near,a.far);e.renderBufferDirect(a,null,u,v,r,null)}}for(var g=r.children,y=0,_=g.length;y<_;y++)C(g[y],i,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u,this.render=function(t,r,u){if(!1!==k.enabled&&(!1!==k.autoUpdate||!1!==k.needsUpdate)&&0!==t.length){var c,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipMapLevel(),p=e.state;p.setBlending(g),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var m=0,v=t.length;m<v;m++){var y=t[m],_=y.shadow,b=y&&y.isPointLight;if(void 0!==_){var T=_.camera;if(a.copy(_.mapSize),a.min(o),b){var S=a.x,M=a.y;x[0].set(2*S,M,S,M),x[1].set(0,M,S,M),x[2].set(3*S,M,S,M),x[3].set(S,M,S,M),x[4].set(3*S,0,S,M),x[5].set(S,0,S,M),a.x*=4,a.y*=2}if(null===_.map){var R={minFilter:de,magFilter:de,format:Le};_.map=new Vt(a.x,a.y,R),_.map.texture.name=y.name+".shadowMap",T.updateProjectionMatrix()}_.isSpotLightShadow&&_.update(y);var A=_.map,P=_.matrix;l.setFromMatrixPosition(y.matrixWorld),T.position.copy(l),b?(c=6,P.makeTranslation(-l.x,-l.y,-l.z)):(c=1,s.setFromMatrixPosition(y.target.matrixWorld),T.lookAt(s),T.updateMatrixWorld(),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(T.projectionMatrix),P.multiply(T.matrixWorldInverse)),e.setRenderTarget(A),e.clear();for(var L=0;L<c;L++){if(b){s.copy(T.position),s.add(E[L]),T.up.copy(w[L]),T.lookAt(s),T.updateMatrixWorld();var I=x[L];p.viewport(I)}i.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),n.setFromMatrix(i),C(r,u,T,b)}}else console.warn("THREE.WebGLShadowMap:",y,"has no shadow.")}k.needsUpdate=!1,e.setRenderTarget(h,d,f)}}}function aa(e,t,r,n){var i=new function(){var t=!1,r=new jt,n=null,i=new jt(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,a,o,s){!0===s&&(t*=o,n*=o,a*=o),r.set(t,n,a,o),!1===i.equals(r)&&(e.clearColor(t,n,a,o),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},a=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(e){e?ae(2929):oe(2929)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case U:e.depthFunc(512);break;case B:e.depthFunc(519);break;case z:e.depthFunc(513);break;case j:e.depthFunc(515);break;case V:e.depthFunc(514);break;case G:e.depthFunc(518);break;case W:e.depthFunc(516);break;case X:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},u=new function(){var t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){e?ae(2960):oe(2960)},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,o){n===t&&i===r&&a===o||(e.stencilFunc(t,r,o),n=t,i=r,a=o)},setOp:function(t,r,n){o===t&&s===r&&l===n||(e.stencilOp(t,r,n),o=t,s=r,l=n)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null}}},c=e.getParameter(34921),h=new Uint8Array(c),p=new Uint8Array(c),m=new Uint8Array(c),v={},T=null,S=null,M=null,R=null,A=null,k=null,P=null,C=null,L=null,I=null,O=!1,H=null,D=null,N=null,F=null,Y=null,q=e.getParameter(35661),Z=!1,J=0,K=e.getParameter(7938);-1!==K.indexOf("WebGL")?(J=parseFloat(/^WebGL\ ([0-9])/.exec(K)[1]),Z=J>=1):-1!==K.indexOf("OpenGL ES")&&(J=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(K)[1]),Z=J>=2);var Q=null,$={},ee=new jt,te=new jt;function re(t,r,n){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<n;o++)e.texImage2D(r+o,0,6408,1,1,0,6408,5121,i);return a}var ne={};function ie(r,i){if(h[r]=1,0===p[r]&&(e.enableVertexAttribArray(r),p[r]=1),m[r]!==i){var a=n.isWebGL2?e:t.get("ANGLE_instanced_arrays");a[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),m[r]=i}}function ae(t){!0!==v[t]&&(e.enable(t),v[t]=!0)}function oe(t){!1!==v[t]&&(e.disable(t),v[t]=!1)}function se(t,n,i,a,o,s,l,u){if(t!==g){if(M||(ae(3042),M=!0),t===w)o=o||n,s=s||i,l=l||a,n===A&&o===C||(e.blendEquationSeparate(r.convert(n),r.convert(o)),A=n,C=o),i===k&&a===P&&s===L&&l===I||(e.blendFuncSeparate(r.convert(i),r.convert(a),r.convert(s),r.convert(l)),k=i,P=a,L=s,I=l),R=t,O=null;else if(t!==R||u!==O){if(A===x&&C===x||(e.blendEquation(32774),A=x,C=x),u)switch(t){case y:e.blendFuncSeparate(1,771,1,771);break;case _:e.blendFunc(1,1);break;case b:e.blendFuncSeparate(0,0,769,771);break;case E:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case y:e.blendFuncSeparate(770,771,1,771);break;case _:e.blendFunc(770,1);break;case b:e.blendFunc(0,769);break;case E:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}k=null,P=null,L=null,I=null,R=t,O=u}}else M&&(oe(3042),M=!1)}function le(t){H!==t&&(t?e.frontFace(2304):e.frontFace(2305),H=t)}function ue(t){t!==o?(ae(2884),t!==D&&(t===s?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):oe(2884),D=t}function ce(t,r,n){t?(ae(32823),F===r&&Y===n||(e.polygonOffset(r,n),F=r,Y=n)):oe(32823)}function he(t){void 0===t&&(t=33984+q-1),Q!==t&&(e.activeTexture(t),Q=t)}return ne[3553]=re(3553,3553,1),ne[34067]=re(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),u.setClear(0),ae(2929),a.setFunc(j),le(!1),ue(s),ae(2884),se(g),{buffers:{color:i,depth:a,stencil:u},initAttributes:function(){for(var e=0,t=h.length;e<t;e++)h[e]=0},enableAttribute:function(e){ie(e,0)},enableAttributeAndDivisor:ie,disableUnusedAttributes:function(){for(var t=0,r=p.length;t!==r;++t)p[t]!==h[t]&&(e.disableVertexAttribArray(t),p[t]=0)},enable:ae,disable:oe,getCompressedTextureFormats:function(){if(null===T&&(T=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(34467),n=0;n<r.length;n++)T.push(r[n]);return T},useProgram:function(t){return S!==t&&(e.useProgram(t),S=t,!0)},setBlending:se,setMaterial:function(e,t){e.side===f?oe(2884):ae(2884);var r=e.side===d;t&&(r=!r),le(r),e.blending===y&&!1===e.transparent?se(g):se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),i.setMask(e.colorWrite),ce(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:le,setCullFace:ue,setLineWidth:function(t){t!==N&&(Z&&e.lineWidth(t),N=t)},setPolygonOffset:ce,setScissorTest:function(e){e?ae(3089):oe(3089)},activeTexture:he,bindTexture:function(t,r){null===Q&&he();var n=$[Q];void 0===n&&(n={type:void 0,texture:void 0},$[Q]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||ne[t]),n.type=t,n.texture=r)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===ee.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ee.copy(t))},viewport:function(t){!1===te.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),te.copy(t))},reset:function(){for(var t=0;t<p.length;t++)1===p[t]&&(e.disableVertexAttribArray(t),p[t]=0);v={},T=null,Q=null,$={},S=null,R=null,H=null,D=null,i.reset(),a.reset(),u.reset()}}}function oa(e,t,r,n,i,a,o){var s,l={},u="undefined"!=typeof OffscreenCanvas;function c(e,t){return u?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function h(e,t,r,n){var i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?Tt.floorPowerOfTwo:Math.floor,o=a(i*e.width),l=a(i*e.height);void 0===s&&(s=c(o,l));var u=r?c(o,l):s;u.width=o,u.height=l;var h=u.getContext("2d");return h.drawImage(e,0,0,o,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+l+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function d(e){return Tt.isPowerOfTwo(e.width)&&Tt.isPowerOfTwo(e.height)}function f(e,t){return e.generateMipmaps&&t&&e.minFilter!==de&&e.minFilter!==me}function p(t,r,i,a){e.generateMipmap(t);var o=n.get(r);o.__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function m(e,r){if(!i.isWebGL2)return e;var n=e;return 6403===e&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r&&(n=33321)),6407===e&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r&&(n=32849)),6408===e&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r&&(n=32856)),33325===n||33326===n||34842===n||34836===n?t.get("EXT_color_buffer_float"):34843!==n&&34837!==n||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),n}function v(e){return e===de||e===fe||e===pe?9728:9729}function g(t){var r=t.target;r.removeEventListener("dispose",g),function(t){var r=n.get(t);void 0!==r.__webglInit&&(e.deleteTexture(r.__webglTexture),n.remove(t))}(r),r.isVideoTexture&&delete l[r.id],o.memory.textures--}function y(t){var r=t.target;r.removeEventListener("dispose",y),function(t){var r=n.get(t),i=n.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[a]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}}(r),o.memory.textures--}var _=0;function b(e,t){var i=n.get(e);if(e.isVideoTexture&&function(e){var t=e.id,r=o.render.frame;l[t]!==r&&(l[t]=r,e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void S(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,i.__webglTexture)}function E(t,o){var s=n.get(t);if(6===t.image.length)if(t.version>0&&s.__version!==t.version){T(s,t),r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture),e.pixelStorei(37440,t.flipY);for(var l=t&&t.isCompressedTexture,u=t.image[0]&&t.image[0].isDataTexture,c=[],v=0;v<6;v++)c[v]=l||u?u?t.image[v].image:t.image[v]:h(t.image[v],!1,!0,i.maxCubemapSize);var g=c[0],y=d(g)||i.isWebGL2,_=a.convert(t.format),b=a.convert(t.type),E=m(_,b);x(34067,t,y);for(var v=0;v<6;v++)if(l)for(var w,S=c[v].mipmaps,M=0,R=S.length;M<R;M++)w=S[M],t.format!==Le&&t.format!==Ce?r.getCompressedTextureFormats().indexOf(_)>-1?r.compressedTexImage2D(34069+v,M,E,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+v,M,E,w.width,w.height,0,_,b,w.data);else u?r.texImage2D(34069+v,0,E,c[v].width,c[v].height,0,_,b,c[v].data):r.texImage2D(34069+v,0,E,_,b,c[v]);s.__maxMipLevel=l?S.length-1:0,f(t,y)&&p(34067,t,g.width,g.height),s.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture)}function w(e,t){r.activeTexture(33984+t),r.bindTexture(34067,n.get(e).__webglTexture)}function x(r,o,s){var l;if(s?(e.texParameteri(r,10242,a.convert(o.wrapS)),e.texParameteri(r,10243,a.convert(o.wrapT)),32879!==r&&35866!==r||e.texParameteri(r,32882,a.convert(o.wrapR)),e.texParameteri(r,10240,a.convert(o.magFilter)),e.texParameteri(r,10241,a.convert(o.minFilter))):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),32879!==r&&35866!==r||e.texParameteri(r,32882,33071),o.wrapS===ce&&o.wrapT===ce||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,v(o.magFilter)),e.texParameteri(r,10241,v(o.minFilter)),o.minFilter!==de&&o.minFilter!==me&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(o.type===Te&&null===t.get("OES_texture_float_linear"))return;if(o.type===Se&&null===(i.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(e.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function T(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",g),t.__webglTexture=e.createTexture(),o.memory.textures++)}function S(t,n,o){var s=3553;n.isDataTexture2DArray&&(s=35866),n.isDataTexture3D&&(s=32879),T(t,n),r.activeTexture(33984+o),r.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);var l=function(e){return!i.isWebGL2&&(e.wrapS!==ce||e.wrapT!==ce||e.minFilter!==de&&e.minFilter!==me)}(n)&&!1===d(n.image),u=h(n.image,l,!1,i.maxTextureSize),c=d(u)||i.isWebGL2,v=a.convert(n.format),g=a.convert(n.type),y=m(v,g);x(s,n,c);var _,b=n.mipmaps;if(n.isDepthTexture){if(y=6402,n.type===Te){if(!i.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");y=36012}else i.isWebGL2&&(y=33189);n.format===De&&6402===y&&n.type!==Ee&&n.type!==xe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ee,g=a.convert(n.type)),n.format===Ne&&(y=34041,n.type!==ke&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=ke,g=a.convert(n.type))),r.texImage2D(3553,0,y,u.width,u.height,0,v,g,null)}else if(n.isDataTexture)if(b.length>0&&c){for(var E=0,w=b.length;E<w;E++)_=b[E],r.texImage2D(3553,E,y,_.width,_.height,0,v,g,_.data);n.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else r.texImage2D(3553,0,y,u.width,u.height,0,v,g,u.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(var E=0,w=b.length;E<w;E++)_=b[E],n.format!==Le&&n.format!==Ce?r.getCompressedTextureFormats().indexOf(v)>-1?r.compressedTexImage2D(3553,E,y,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,E,y,_.width,_.height,0,v,g,_.data);t.__maxMipLevel=b.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,y,u.width,u.height,u.depth,0,v,g,u.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,y,u.width,u.height,u.depth,0,v,g,u.data),t.__maxMipLevel=0;else if(b.length>0&&c){for(var E=0,w=b.length;E<w;E++)_=b[E],r.texImage2D(3553,E,y,v,g,_);n.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else r.texImage2D(3553,0,y,v,g,u),t.__maxMipLevel=0;f(n,c)&&p(3553,n,u.width,u.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function M(t,i,o,s){var l=a.convert(i.texture.format),u=a.convert(i.texture.type),c=m(l,u);r.texImage2D(s,0,c,i.width,i.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,n.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function R(t,r,n){if(e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){if(n){var i=k(r);e.renderbufferStorageMultisample(36161,i,33189,r.width,r.height)}else e.renderbufferStorage(36161,33189,r.width,r.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(r.depthBuffer&&r.stencilBuffer){if(n){var i=k(r);e.renderbufferStorageMultisample(36161,i,35056,r.width,r.height)}else e.renderbufferStorage(36161,34041,r.width,r.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var o=a.convert(r.texture.format),s=a.convert(r.texture.type),l=m(o,s);if(n){var i=k(r);e.renderbufferStorageMultisample(36161,i,l,r.width,r.height)}else e.renderbufferStorage(36161,l,r.width,r.height)}e.bindRenderbuffer(36161,null)}function A(t){var r=n.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),b(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===De)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(r.depthTexture.format!==Ne)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,t)}else if(i){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=e.createRenderbuffer(),R(r.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),R(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function k(e){return i.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(i.maxSamples,e.samples):0}var P=!1,C=!1;this.allocateTextureUnit=function(){var e=_;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),_+=1,e},this.resetTextureUnits=function(){_=0},this.setTexture2D=b,this.setTexture2DArray=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?S(i,e,t):(r.activeTexture(33984+t),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?S(i,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setTextureCubeDynamic=w,this.setupRenderTarget=function(t){var s=n.get(t),l=n.get(t.texture);t.addEventListener("dispose",y),l.__webglTexture=e.createTexture(),o.memory.textures++;var u=!0===t.isWebGLRenderTargetCube,c=!0===t.isWebGLMultisampleRenderTarget,h=d(t)||i.isWebGL2;if(u){s.__webglFramebuffer=[];for(var v=0;v<6;v++)s.__webglFramebuffer[v]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),c)if(i.isWebGL2){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var g=a.convert(t.texture.format),_=a.convert(t.texture.type),b=m(g,_),E=k(t);e.renderbufferStorageMultisample(36161,E,b,t.width,t.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),R(s.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){r.bindTexture(34067,l.__webglTexture),x(34067,t.texture,h);for(var v=0;v<6;v++)M(s.__webglFramebuffer[v],t,36064,34069+v);f(t.texture,h)&&p(34067,t.texture,t.width,t.height),r.bindTexture(34067,null)}else r.bindTexture(3553,l.__webglTexture),x(3553,t.texture,h),M(s.__webglFramebuffer,t,36064,3553),f(t.texture,h)&&p(3553,t.texture,t.width,t.height),r.bindTexture(3553,null);t.depthBuffer&&A(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture,a=d(e)||i.isWebGL2;if(f(t,a)){var o=e.isWebGLRenderTargetCube?34067:3553,s=n.get(t).__webglTexture;r.bindTexture(o,s),p(o,t,e.width,e.height),r.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(i.isWebGL2){var r=n.get(t);e.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,r.__webglFramebuffer);var a=t.width,o=t.height,s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===P&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),P=!0),e=e.texture),b(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===C&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),C=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?E(e,t):w(e,t)}}function sa(e,t,r){return{convert:function(e){var n;if(e===ue)return 10497;if(e===ce)return 33071;if(e===he)return 33648;if(e===de)return 9728;if(e===fe)return 9984;if(e===pe)return 9986;if(e===me)return 9729;if(e===ve)return 9985;if(e===ge)return 9987;if(e===ye)return 5121;if(e===Me)return 32819;if(e===Re)return 32820;if(e===Ae)return 33635;if(e===_e)return 5120;if(e===be)return 5122;if(e===Ee)return 5123;if(e===we)return 5124;if(e===xe)return 5125;if(e===Te)return 5126;if(e===Se){if(r.isWebGL2)return 5131;if(null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES}if(e===Pe)return 6406;if(e===Ce)return 6407;if(e===Le)return 6408;if(e===Ie)return 6409;if(e===Oe)return 6410;if(e===De)return 6402;if(e===Ne)return 34041;if(e===Fe)return 6403;if(e===x)return 32774;if(e===T)return 32778;if(e===S)return 32779;if(e===A)return 0;if(e===k)return 1;if(e===P)return 768;if(e===C)return 769;if(e===L)return 770;if(e===I)return 771;if(e===O)return 772;if(e===H)return 773;if(e===D)return 774;if(e===N)return 775;if(e===F)return 776;if((e===Ue||e===Be||e===ze||e===je)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(e===Ue)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Be)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===ze)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===je)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===Ve||e===Ge||e===We||e===Xe)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(e===Ve)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ge)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===We)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Xe)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Ye&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((e===qe||e===Ze||e===Je||e===Ke||e===Qe||e===$e||e===et||e===tt||e===rt||e===nt||e===it||e===at||e===ot||e===st)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return e;if(e===M||e===R){if(r.isWebGL2){if(e===M)return 32775;if(e===R)return 32776}if(null!==(n=t.get("EXT_blend_minmax"))){if(e===M)return n.MIN_EXT;if(e===R)return n.MAX_EXT}}if(e===ke){if(r.isWebGL2)return 34042;if(null!==(n=t.get("WEBGL_depth_texture")))return n.UNSIGNED_INT_24_8_WEBGL}return 0}}}function la(){mr.call(this),this.type="Group"}function ua(e){ln.call(this),this.cameras=e||[]}ra.prototype=Object.create(Cr.prototype),ra.prototype.constructor=ra,ra.prototype.isMeshDepthMaterial=!0,ra.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},na.prototype=Object.create(Cr.prototype),na.prototype.constructor=na,na.prototype.isMeshDistanceMaterial=!0,na.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},la.prototype=Object.assign(Object.create(mr.prototype),{constructor:la,isGroup:!0}),ua.prototype=Object.assign(Object.create(ln.prototype),{constructor:ua,isArrayCamera:!0});var ca,ha,da,fa,pa,ma,va=new Rt,ga=new Rt;function ya(e,t,r){va.setFromMatrixPosition(t.matrixWorld),ga.setFromMatrixPosition(r.matrixWorld);var n=va.distanceTo(ga),i=t.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,f=o*h,p=n/(-c+h),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=o+p,g=s+p,y=d-m,_=f+(n-m),b=l*s/g*v,E=u*s/g*v;e.projectionMatrix.makePerspective(y,_,b,E,v,g)}function _a(e){var t,r,n=this,i=null,a=null,o=null,s=[],l=new Wt,u=new Wt,c=1,h="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(a=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",E,!1));var d=new Wt,f=new Mt,p=new Rt,m=new ln;m.viewport=new jt,m.layers.enable(1);var v=new ln;v.viewport=new jt,v.layers.enable(2);var g=new ua([m,v]);function y(){return null!==i&&!0===i.isPresenting}g.layers.enable(1),g.layers.enable(2);var _,b=new St;function E(){if(y()){var a=i.getEyeParameters("left");t=2*a.renderWidth*c,r=a.renderHeight*c,_=e.getPixelRatio(),e.getSize(b),e.setDrawingBufferSize(t,r,1),m.viewport.set(0,0,t/2,r),v.viewport.set(t/2,0,t/2,r),S.start(),n.dispatchEvent({type:"sessionstart"})}else n.enabled&&e.setDrawingBufferSize(b.width,b.height,_),S.stop(),n.dispatchEvent({type:"sessionend"})}var w=[];function x(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,n=0,i=t.length;r<i;r++){var a=t[r];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("HTC Vive Focus")||a.id.startsWith("Spatial Controller"))){if(n===e)return a;n++}}}function T(e,n){null!==n&&4===n.length&&e.set(n[0]*t,n[1]*r,n[2]*t,n[3]*r)}this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new la).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),S.setContext(e)},this.setFramebufferScaleFactor=function(e){c=e},this.setReferenceSpaceType=function(e){h=e},this.setPoseTarget=function(e){void 0!==e&&(o=e)},this.getCamera=function(e){var t="local-floor"===h?1.6:0;if(!1===y())return e.position.set(0,t,0),e.rotation.set(0,0,0),e;if(i.depthNear=e.near,i.depthFar=e.far,i.getFrameData(a),"local-floor"===h){var r=i.stageParameters;r?l.fromArray(r.sittingToStandingTransform):l.makeTranslation(0,t,0)}var n=a.pose,c=null!==o?o:e;c.matrix.copy(l),c.matrix.decompose(c.position,c.quaternion,c.scale),null!==n.orientation&&(f.fromArray(n.orientation),c.quaternion.multiply(f)),null!==n.position&&(f.setFromRotationMatrix(l),p.fromArray(n.position),p.applyQuaternion(f),c.position.add(p)),c.updateMatrixWorld(),m.near=e.near,v.near=e.near,m.far=e.far,v.far=e.far,m.matrixWorldInverse.fromArray(a.leftViewMatrix),v.matrixWorldInverse.fromArray(a.rightViewMatrix),u.getInverse(l),"local-floor"===h&&(m.matrixWorldInverse.multiply(u),v.matrixWorldInverse.multiply(u));var _=c.parent;null!==_&&(d.getInverse(_.matrixWorld),m.matrixWorldInverse.multiply(d),v.matrixWorldInverse.multiply(d)),m.matrixWorld.getInverse(m.matrixWorldInverse),v.matrixWorld.getInverse(v.matrixWorldInverse),m.projectionMatrix.fromArray(a.leftProjectionMatrix),v.projectionMatrix.fromArray(a.rightProjectionMatrix),ya(g,m,v);var b=i.getLayers();if(b.length){var E=b[0];T(m.viewport,E.leftBounds),T(v.viewport,E.rightBounds)}return function(){for(var e=0;e<s.length;e++){var t=s[e],r=x(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var n=r.pose;!1===n.hasPosition&&t.position.set(.2,-.6,-.05),null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(l),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var i="Daydream Controller"===r.id?0:1;void 0===w[e]&&(w[e]=!1),w[e]!==r.buttons[i].pressed&&(w[e]=r.buttons[i].pressed,!0===w[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return l},this.isPresenting=y;var S=new En;this.setAnimationLoop=function(e){S.setAnimationLoop(e),y()&&S.start()},this.submitFrame=function(){y()&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",E)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function ba(e){var t=this,r=e.context,n=null,i=null,a="local-floor",o=null,s=[],l=[];function u(){return null!==n&&null!==i}var c=new ln;c.layers.enable(1),c.viewport=new jt;var h=new ln;h.layers.enable(2),h.viewport=new jt;var d=new ua([c,h]);function f(e){for(var t=0;t<s.length;t++)l[t]===e.inputSource&&s[t].dispatchEvent({type:e.type})}function p(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),y.stop(),t.dispatchEvent({type:"sessionend"})}function m(e){i=e,y.setContext(n),y.start(),t.dispatchEvent({type:"sessionstart"})}function v(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}d.layers.enable(1),d.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new la).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.setFramebufferScaleFactor=function(e){},this.setReferenceSpaceType=function(e){a=e},this.getSession=function(){return n},this.setSession=function(e){null!==(n=e)&&(n.addEventListener("select",f),n.addEventListener("selectstart",f),n.addEventListener("selectend",f),n.addEventListener("end",p),n.updateRenderState({baseLayer:new XRWebGLLayer(n,r)}),n.requestReferenceSpace(a).then(m),l=n.inputSources,n.addEventListener("inputsourceschange",function(){l=n.inputSources,console.log(l);for(var e=0;e<s.length;e++){var t=s[e];t.userData.inputSource=l[e]}}))},this.getCamera=function(e){if(u()){var t=e.parent,r=d.cameras;v(d,t);for(var n=0;n<r.length;n++)v(r[n],t);e.matrixWorld.copy(d.matrixWorld);for(var i=e.children,n=0,a=i.length;n<a;n++)i[n].updateMatrixWorld(!0);return ya(d,c,h),d}return e},this.isPresenting=u;var g=null,y=new En;y.setAnimationLoop(function(t,r){if(null!==(o=r.getViewerPose(i))){var a=o.views,u=n.renderState.baseLayer;e.setFramebuffer(u.framebuffer);for(var c=0;c<a.length;c++){var h=a[c],f=u.getViewport(h),p=h.transform.inverse.matrix,m=d.cameras[c];m.matrix.fromArray(p).getInverse(m.matrix),m.projectionMatrix.fromArray(h.projectionMatrix),m.viewport.set(f.x,f.y,f.width,f.height),0===c&&d.matrix.copy(m.matrix)}}for(var c=0;c<s.length;c++){var v=s[c],y=l[c];if(y){var _=r.getPose(y.targetRaySpace,i);if(null!==_){v.matrix.fromArray(_.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.visible=!0;continue}}v.visible=!1}g&&g(t)}),this.setAnimationLoop=function(e){g=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new Wt},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Ea(e){console.log("THREE.WebGLRenderer",a);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,l=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,f=null,p=null;this.domElement=t,this.context=null,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var m,v,g,y,_,b,E,w,x,T,S,M,R,A,k,P,C,L,I=this,O=!1,H=null,D=0,N=0,F=null,U=null,B=-1,z={geometry:null,program:null,wireframe:!1},j=null,V=null,G=new jt,W=new jt,X=null,Y=t.width,q=t.height,Z=1,J=new jt(0,0,Y,q),Q=new jt(0,0,Y,q),$=!1,ee=new gn,te=new An,re=!1,ne=!1,ie=new Wt,ae=new Rt;function oe(){return null===F?Z:1}try{var se={alpha:n,depth:i,stencil:o,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:h,xrCompatible:!0};if(t.addEventListener("webglcontextlost",he,!1),t.addEventListener("webglcontextrestored",de,!1),null===(m=r||t.getContext("webgl",se)||t.getContext("experimental-webgl",se)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===m.getShaderPrecisionFormat&&(m.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function le(){v=new kn(m),(g=new Rn(m,v,e)).isWebGL2||(v.get("WEBGL_depth_texture"),v.get("OES_texture_float"),v.get("OES_texture_half_float"),v.get("OES_texture_half_float_linear"),v.get("OES_standard_derivatives"),v.get("OES_element_index_uint"),v.get("ANGLE_instanced_arrays")),v.get("OES_texture_float_linear"),L=new sa(m,v,g),(y=new aa(m,v,L,g)).scissor(W.copy(Q).multiplyScalar(Z).floor()),y.viewport(G.copy(J).multiplyScalar(Z).floor()),_=new Ln(m),b=new Xi,E=new oa(m,v,y,b,g,L,_),w=new wn(m),x=new Pn(m,w,_),T=new Hn(x,_),k=new On(m),S=new Wi(I,v,g),M=new Ji,R=new ta,A=new Sn(I,y,T,l),P=new Mn(m,v,_,g),C=new Cn(m,v,_,g),_.programs=S.programs,I.context=m,I.capabilities=g,I.extensions=v,I.properties=b,I.renderLists=M,I.state=y,I.info=_}le();var ue="undefined"!=typeof navigator&&"xr"in navigator&&"supportsSession"in navigator.xr?new ba(I):new _a(I);this.vr=ue;var ce=new ia(I,T,g.maxTextureSize);function he(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),O=!0}function de(){console.log("THREE.WebGLRenderer: Context Restored."),O=!1,le()}function fe(e){var t=e.target;t.removeEventListener("dispose",fe),function(e){pe(e),b.remove(e)}(t)}function pe(e){var t=b.get(e).program;e.program=void 0,void 0!==t&&S.releaseProgram(t)}this.shadowMap=ce,this.getContext=function(){return m},this.getContextAttributes=function(){return m.getContextAttributes()},this.forceContextLoss=function(){var e=v.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=v.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Z},this.setPixelRatio=function(e){void 0!==e&&(Z=e,this.setSize(Y,q,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new St),e.set(Y,q)},this.setSize=function(e,r,n){ue.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Y=e,q=r,t.width=Math.floor(e*Z),t.height=Math.floor(r*Z),!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new St),e.set(Y*Z,q*Z).floor()},this.setDrawingBufferSize=function(e,r,n){Y=e,q=r,Z=n,t.width=Math.floor(e*n),t.height=Math.floor(r*n),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new jt),e.copy(G)},this.getViewport=function(e){return e.copy(J)},this.setViewport=function(e,t,r,n){e.isVector4?J.set(e.x,e.y,e.z,e.w):J.set(e,t,r,n),y.viewport(G.copy(J).multiplyScalar(Z).floor())},this.getScissor=function(e){return e.copy(Q)},this.setScissor=function(e,t,r,n){e.isVector4?Q.set(e.x,e.y,e.z,e.w):Q.set(e,t,r,n),y.scissor(W.copy(Q).multiplyScalar(Z).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(e){y.setScissorTest($=e)},this.getClearColor=function(){return A.getClearColor()},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===r||r)&&(n|=1024),m.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",he,!1),t.removeEventListener("webglcontextrestored",de,!1),M.dispose(),R.dispose(),b.dispose(),T.dispose(),ue.dispose(),ve.stop()},this.renderBufferImmediate=function(e,t){y.initAttributes();var r=b.get(e);e.hasPositions&&!r.position&&(r.position=m.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=m.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=m.createBuffer()),e.hasColors&&!r.color&&(r.color=m.createBuffer());var n=t.getAttributes();e.hasPositions&&(m.bindBuffer(34962,r.position),m.bufferData(34962,e.positionArray,35048),y.enableAttribute(n.position),m.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(m.bindBuffer(34962,r.normal),m.bufferData(34962,e.normalArray,35048),y.enableAttribute(n.normal),m.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(m.bindBuffer(34962,r.uv),m.bufferData(34962,e.uvArray,35048),y.enableAttribute(n.uv),m.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(m.bindBuffer(34962,r.color),m.bufferData(34962,e.colorArray,35048),y.enableAttribute(n.color),m.vertexAttribPointer(n.color,3,5126,!1,0,0)),y.disableUnusedAttributes(),m.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,a){var o=i.isMesh&&i.matrixWorld.determinant()<0;y.setMaterial(n,o);var s=we(e,t,n,i),l=!1;z.geometry===r.id&&z.program===s.id&&z.wireframe===(!0===n.wireframe)||(z.geometry=r.id,z.program=s.id,z.wireframe=!0===n.wireframe,l=!0),i.morphTargetInfluences&&(k.update(i,r,n,s),l=!0);var u,c=r.index,h=r.attributes.position,d=1;!0===n.wireframe&&(c=x.getWireframeAttribute(r),d=2);var f=P;null!==c&&(u=w.get(c),(f=C).setIndex(u)),l&&(function(e,t,r){if(r&&r.isInstancedBufferGeometry&&!g.isWebGL2&&null===v.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{y.initAttributes();var n=r.attributes,i=t.getAttributes(),a=e.defaultAttributeValues;for(var o in i){var s=i[o];if(s>=0){var l=n[o];if(void 0!==l){var u=l.normalized,c=l.itemSize,h=w.get(l);if(void 0===h)continue;var d=h.buffer,f=h.type,p=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var _=l.data,b=_.stride,E=l.offset;_&&_.isInstancedInterleavedBuffer?(y.enableAttributeAndDivisor(s,_.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=_.meshPerAttribute*_.count)):y.enableAttribute(s),m.bindBuffer(34962,d),m.vertexAttribPointer(s,c,f,u,b*p,E*p)}else l.isInstancedBufferAttribute?(y.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):y.enableAttribute(s),m.bindBuffer(34962,d),m.vertexAttribPointer(s,c,f,u,0,0)}else if(void 0!==a){var x=a[o];if(void 0!==x)switch(x.length){case 2:m.vertexAttrib2fv(s,x);break;case 3:m.vertexAttrib3fv(s,x);break;case 4:m.vertexAttrib4fv(s,x);break;default:m.vertexAttrib1fv(s,x)}}}}y.disableUnusedAttributes()}}(n,s,r),null!==c&&m.bindBuffer(34963,u.buffer));var p=1/0;null!==c?p=c.count:void 0!==h&&(p=h.count);var _=r.drawRange.start*d,b=r.drawRange.count*d,E=null!==a?a.start*d:0,T=null!==a?a.count*d:1/0,S=Math.max(_,E),M=Math.min(p,_+b,E+T)-1,R=Math.max(0,M-S+1);if(0!==R){if(i.isMesh)if(!0===n.wireframe)y.setLineWidth(n.wireframeLinewidth*oe()),f.setMode(1);else switch(i.drawMode){case ct:f.setMode(4);break;case ht:f.setMode(5);break;case dt:f.setMode(6)}else if(i.isLine){var A=n.linewidth;void 0===A&&(A=1),y.setLineWidth(A*oe()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&f.renderInstances(r,S,R):f.render(S,R)}},this.compile=function(e,t){(p=R.get(e,t)).init(),e.traverse(function(e){e.isLight&&(p.pushLight(e),e.castShadow&&p.pushShadow(e))}),p.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)Ee(t.material[r],e.fog,t);else Ee(t.material,e.fog,t)})};var me=null,ve=new En;function ge(e,t,r,n){if(!1!==e.visible){var i=e.layers.test(t.layers);if(i)if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ee.intersectsSprite(e)){n&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie);var a=T.update(e),o=e.material;o.visible&&f.push(e,a,o,r,ae.z,null)}}else if(e.isImmediateRenderObject)n&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie),f.push(e,null,e.material,r,ae.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||ee.intersectsObject(e))){n&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie);var a=T.update(e),o=e.material;if(Array.isArray(o))for(var s=a.groups,l=0,u=s.length;l<u;l++){var c=s[l],h=o[c.materialIndex];h&&h.visible&&f.push(e,a,h,r,ae.z,c)}else o.visible&&f.push(e,a,o,r,ae.z,null)}for(var d=e.children,l=0,u=d.length;l<u;l++)ge(d[l],t,r,n)}}function _e(e,t,r,n){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,u=void 0===n?o.material:n,c=o.group;if(r.isArrayCamera){V=r;for(var h=r.cameras,d=0,f=h.length;d<f;d++){var m=h[d];s.layers.test(m.layers)&&(y.viewport(G.copy(m.viewport)),p.setupLights(m),be(s,t,m,l,u,c))}}else V=null,be(s,t,r,l,u,c)}}function be(e,t,r,n,i,a){if(e.onBeforeRender(I,t,r,n,i,a),p=R.get(t,V||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){y.setMaterial(i);var o=we(r,t.fog,i,e);z.geometry=null,z.program=null,z.wireframe=!1,function(e,t){e.render(function(e){I.renderBufferImmediate(e,t)})}(e,o)}else I.renderBufferDirect(r,t.fog,n,i,e,a);e.onAfterRender(I,t,r,n,i,a),p=R.get(t,V||r)}function Ee(e,t,r){var n=b.get(e),i=p.state.lights,a=p.state.shadowsArray,o=i.state.version,s=S.getParameters(e,i.state,a,t,te.numPlanes,te.numIntersection,r),l=S.getProgramCode(e,s),u=n.program,c=!0;if(void 0===u)e.addEventListener("dispose",fe);else if(u.code!==l)pe(e);else if(n.lightsStateVersion!==o)n.lightsStateVersion=o,c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var h=bn[s.shaderID];n.shader={name:e.type,uniforms:en(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader,I),l=S.getProgramCode(e,s),u=S.acquireProgram(e,n.shader,s,l),n.program=u,e.program=u}var d=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<I.maxMorphTargets;f++)d["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var f=0;f<I.maxMorphNormals;f++)d["morphNormal"+f]>=0&&e.numSupportedMorphNormals++}var m=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=te.numPlanes,n.numIntersection=te.numIntersection,m.clippingPlanes=te.uniform),n.fog=t,n.lightsStateVersion=o,e.lights&&(m.ambientLightColor.value=i.state.ambient,m.lightProbe.value=i.state.probe,m.directionalLights.value=i.state.directional,m.spotLights.value=i.state.spot,m.rectAreaLights.value=i.state.rectArea,m.pointLights.value=i.state.point,m.hemisphereLights.value=i.state.hemi,m.directionalShadowMap.value=i.state.directionalShadowMap,m.directionalShadowMatrix.value=i.state.directionalShadowMatrix,m.spotShadowMap.value=i.state.spotShadowMap,m.spotShadowMatrix.value=i.state.spotShadowMatrix,m.pointShadowMap.value=i.state.pointShadowMap,m.pointShadowMatrix.value=i.state.pointShadowMatrix);var v=n.program.getUniforms(),g=Li.seqWithValue(v.seq,m);n.uniformsList=g}function we(e,t,r,n){E.resetTextureUnits();var i=b.get(r),a=p.state.lights;if(re&&(ne||e!==j)){var o=e===j&&r.id===B;te.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,o)}!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:r.lights&&i.lightsStateVersion!==a.state.version?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===te.numPlanes&&i.numIntersection===te.numIntersection||(r.needsUpdate=!0)),r.needsUpdate&&(Ee(r,t,n),r.needsUpdate=!1);var s,l,u=!1,c=!1,h=!1,f=i.program,v=f.getUniforms(),_=i.shader.uniforms;if(y.useProgram(f.program)&&(u=!0,c=!0,h=!0),r.id!==B&&(B=r.id,c=!0),u||j!==e){if(v.setValue(m,"projectionMatrix",e.projectionMatrix),g.logarithmicDepthBuffer&&v.setValue(m,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),j!==e&&(j=e,c=!0,h=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var w=v.map.cameraPosition;void 0!==w&&w.setValue(m,ae.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&v.setValue(m,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){v.setOptional(m,n,"bindMatrix"),v.setOptional(m,n,"bindMatrixInverse");var x=n.skeleton;if(x){var T=x.bones;if(g.floatVertexTextures){if(void 0===x.boneTexture){var S=Math.sqrt(4*T.length);S=Tt.ceilPowerOfTwo(S),S=Math.max(S,4);var M=new Float32Array(S*S*4);M.set(x.boneMatrices);var R=new mn(M,S,S,Le,Te);R.needsUpdate=!0,x.boneMatrices=M,x.boneTexture=R,x.boneTextureSize=S}v.setValue(m,"boneTexture",x.boneTexture,E),v.setValue(m,"boneTextureSize",x.boneTextureSize)}else v.setOptional(m,x,"boneMatrices")}}return c&&(v.setValue(m,"toneMappingExposure",I.toneMappingExposure),v.setValue(m,"toneMappingWhitePoint",I.toneMappingWhitePoint),r.lights&&(l=h,(s=_).ambientLightColor.needsUpdate=l,s.lightProbe.needsUpdate=l,s.directionalLights.needsUpdate=l,s.pointLights.needsUpdate=l,s.spotLights.needsUpdate=l,s.rectAreaLights.needsUpdate=l,s.hemisphereLights.needsUpdate=l),t&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(_,t),r.isMeshBasicMaterial?xe(_,r):r.isMeshLambertMaterial?(xe(_,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(_,r)):r.isMeshPhongMaterial?(xe(_,r),r.isMeshToonMaterial?function(e,t){Me(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(_,r):Me(_,r)):r.isMeshStandardMaterial?(xe(_,r),r.isMeshPhysicalMaterial?function(e,t){Re(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(_,r):Re(_,r)):r.isMeshMatcapMaterial?(xe(_,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(_,r)):r.isMeshDepthMaterial?(xe(_,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(_,r)):r.isMeshDistanceMaterial?(xe(_,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(_,r)):r.isMeshNormalMaterial?(xe(_,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(_,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(_,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(_,r)):r.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*Z,e.scale.value=.5*q,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(_,r):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(_,r):r.isShadowMaterial&&(_.color.value.copy(r.color),_.opacity.value=r.opacity),void 0!==_.ltc_1&&(_.ltc_1.value=_n.LTC_1),void 0!==_.ltc_2&&(_.ltc_2.value=_n.LTC_2),Li.upload(m,i.uniformsList,_,E)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Li.upload(m,i.uniformsList,_,E),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&v.setValue(m,"center",n.center),v.setValue(m,"modelViewMatrix",n.modelViewMatrix),v.setValue(m,"normalMatrix",n.normalMatrix),v.setValue(m,"modelMatrix",n.matrixWorld),f}function xe(e,t){var r;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=b.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function Me(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Re(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}ve.setAnimationLoop(function(e){ue.isPresenting()||me&&me(e)}),"undefined"!=typeof window&&ve.setContext(window),this.setAnimationLoop=function(e){me=e,ue.setAnimationLoop(e),ve.start()},this.render=function(e,t){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),t&&t.isCamera){if(!O){z.geometry=null,z.program=null,z.wireframe=!1,B=-1,j=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ue.enabled&&(t=ue.getCamera(t)),(p=R.get(e,t)).init(),e.onBeforeRender(I,e,t,r||F),ie.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ee.setFromMatrix(ie),ne=this.localClippingEnabled,re=te.init(this.clippingPlanes,ne,t),(f=M.get(e,t)).init(),ge(e,t,0,I.sortObjects),!0===I.sortObjects&&f.sort(),re&&te.beginShadows();var i=p.state.shadowsArray;ce.render(i,e,t),p.setupLights(t),re&&te.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),A.render(f,e,t,n);var a=f.opaque,o=f.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&_e(a,e,t,s),o.length&&_e(o,e,t,s)}else a.length&&_e(a,e,t),o.length&&_e(o,e,t);e.onAfterRender(I,e,t),null!==F&&(E.updateRenderTargetMipmap(F),E.updateMultisampleRenderTarget(F)),y.buffers.depth.setTest(!0),y.buffers.depth.setMask(!0),y.buffers.color.setMask(!0),y.setPolygonOffset(!1),ue.enabled&&ue.submitFrame(),f=null,p=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){H!==e&&m.bindFramebuffer(36160,e),H=e},this.getActiveCubeFace=function(){return D},this.getActiveMipMapLevel=function(){return N},this.getRenderTarget=function(){return F},this.setRenderTarget=function(e,t,r){F=e,D=t,N=r,e&&void 0===b.get(e).__webglFramebuffer&&E.setupRenderTarget(e);var n=H,i=!1;if(e){var a=b.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(n=a[t||0],i=!0):n=e.isWebGLMultisampleRenderTarget?b.get(e).__webglMultisampledFramebuffer:a,G.copy(e.viewport),W.copy(e.scissor),X=e.scissorTest}else G.copy(J).multiplyScalar(Z).floor(),W.copy(Q).multiplyScalar(Z).floor(),X=$;if(U!==n&&(m.bindFramebuffer(36160,n),U=n),y.viewport(G),y.scissor(W),y.setScissorTest(X),i){var o=b.get(e.texture);m.framebufferTexture2D(36160,36064,34069+(t||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,n,i,a,o){if(e&&e.isWebGLRenderTarget){var s=b.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==o&&(s=s[o]),s){var l=!1;s!==U&&(m.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(c!==Le&&L.convert(c)!==m.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===ye||L.convert(h)===m.getParameter(35738)||h===Te&&(g.isWebGL2||v.get("OES_texture_float")||v.get("WEBGL_color_buffer_float"))||h===Se&&(g.isWebGL2?v.get("EXT_color_buffer_float"):v.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===m.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&m.readPixels(t,r,n,i,L.convert(c),L.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&m.bindFramebuffer(36160,U)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var n=t.image.width,i=t.image.height,a=L.convert(t.format);E.setTexture2D(t,0),m.copyTexImage2D(3553,r||0,a,e.x,e.y,n,i,0)},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,a=t.image.height,o=L.convert(r.format),s=L.convert(r.type);E.setTexture2D(r,0),t.isDataTexture?m.texSubImage2D(3553,n||0,e.x,e.y,i,a,o,s,t.image.data):m.texSubImage2D(3553,n||0,e.x,e.y,o,s,t.image)},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function wa(e,t){this.name="",this.color=new Sr(e),this.density=void 0!==t?t:25e-5}function xa(e,t,r){this.name="",this.color=new Sr(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function Ta(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Sa(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function Ma(e){Cr.call(this),this.type="SpriteMaterial",this.color=new Sr(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Ra(e){if(mr.call(this),this.type="Sprite",void 0===ca){ca=new qr;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Ta(t,5);ca.setIndex([0,1,2,0,2,3]),ca.addAttribute("position",new Sa(r,3,0,!1)),ca.addAttribute("uv",new Sa(r,2,3,!1))}this.geometry=ca,this.material=void 0!==e?e:new Ma,this.center=new St(.5,.5)}function Aa(){mr.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function ka(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Zr.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wt,this.bindMatrixInverse=new Wt}function Pa(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Wt)}}function Ca(){mr.call(this),this.type="Bone"}function La(e){Cr.call(this),this.type="LineBasicMaterial",this.color=new Sr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Ia(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),mr.call(this),this.type="Line",this.geometry=void 0!==e?e:new qr,this.material=void 0!==t?t:new La({color:16777215*Math.random()})}function Oa(e,t){Ia.call(this,e,t),this.type="LineSegments"}function Ha(e,t){Ia.call(this,e,t),this.type="LineLoop"}function Da(e){Cr.call(this),this.type="PointsMaterial",this.color=new Sr(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Na(e,t){mr.call(this),this.type="Points",this.geometry=void 0!==e?e:new qr,this.material=void 0!==t?t:new Da({color:16777215*Math.random()}),this.updateMorphTargets()}function Fa(e,t,r,n,i,a,o,s,l){zt.call(this,e,t,r,n,i,a,o,s,l),this.format=void 0!==o?o:Ce,this.minFilter=void 0!==a?a:me,this.magFilter=void 0!==i?i:me,this.generateMipmaps=!1}function Ua(e,t,r,n,i,a,o,s,l,u,c,h){zt.call(this,null,a,o,s,l,u,n,i,c,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Ba(e,t,r,n,i,a,o,s,l){zt.call(this,e,t,r,n,i,a,o,s,l),this.needsUpdate=!0}function za(e,t,r,n,i,a,o,s,l,u){if((u=void 0!==u?u:De)!==De&&u!==Ne)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===De&&(r=Ee),void 0===r&&u===Ne&&(r=ke),zt.call(this,null,n,i,a,o,s,u,r,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:de,this.minFilter=void 0!==s?s:de,this.flipY=!1,this.generateMipmaps=!1}function ja(e){qr.call(this),this.type="WireframeGeometry";var t,r,n,i,a,o,s,l,u,c,h=[],d=[0,0],f={},p=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var v=m[t];for(r=0;r<3;r++)s=v[p[r]],l=v[p[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),u=d[0]+","+d[1],void 0===f[u]&&(f[u]={index1:d[0],index2:d[1]})}for(u in f)o=f[u],c=e.vertices[o.index1],h.push(c.x,c.y,c.z),c=e.vertices[o.index2],h.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var g,y,_,b,E,w,x,T;if(c=new Rt,null!==e.index){for(g=e.attributes.position,y=e.index,0===(_=e.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),i=0,a=_.length;i<a;++i)for(b=_[i],E=b.start,w=b.count,t=E,n=E+w;t<n;t+=3)for(r=0;r<3;r++)s=y.getX(t+r),l=y.getX(t+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),u=d[0]+","+d[1],void 0===f[u]&&(f[u]={index1:d[0],index2:d[1]});for(u in f)o=f[u],c.fromBufferAttribute(g,o.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(g,o.index2),h.push(c.x,c.y,c.z)}else for(g=e.attributes.position,t=0,n=g.count/3;t<n;t++)for(r=0;r<3;r++)x=3*t+r,c.fromBufferAttribute(g,x),h.push(c.x,c.y,c.z),T=3*t+(r+1)%3,c.fromBufferAttribute(g,T),h.push(c.x,c.y,c.z)}this.addAttribute("position",new zr(h,3))}function Va(e,t,r){Kr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Ga(e,t,r)),this.mergeVertices()}function Ga(e,t,r){qr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,a=[],o=[],s=[],l=[],u=new Rt,c=new Rt,h=new Rt,d=new Rt,f=new Rt;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var v=i/t;e(v,m,c),o.push(c.x,c.y,c.z),v-1e-5>=0?(e(v-1e-5,m,h),d.subVectors(c,h)):(e(v+1e-5,m,h),d.subVectors(h,c)),m-1e-5>=0?(e(v,m-1e-5,h),f.subVectors(c,h)):(e(v,m+1e-5,h),f.subVectors(h,c)),u.crossVectors(d,f).normalize(),s.push(u.x,u.y,u.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var g=n*p+i,y=n*p+i+1,_=(n+1)*p+i+1,b=(n+1)*p+i;a.push(g,y,b),a.push(y,_,b)}this.setIndex(a),this.addAttribute("position",new zr(o,3)),this.addAttribute("normal",new zr(s,3)),this.addAttribute("uv",new zr(l,2))}function Wa(e,t,r,n){Kr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new Xa(e,t,r,n)),this.mergeVertices()}function Xa(e,t,r,n){qr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],a=[];function o(e,t,r,n){var i,a,o=Math.pow(2,n),l=[];for(i=0;i<=o;i++){l[i]=[];var u=e.clone().lerp(r,i/o),c=t.clone().lerp(r,i/o),h=o-i;for(a=0;a<=h;a++)l[i][a]=0===a&&i===o?u:u.clone().lerp(c,a/h)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var d=Math.floor(a/2);a%2==0?(s(l[i][d+1]),s(l[i+1][d]),s(l[i][d])):(s(l[i][d+1]),s(l[i+1][d+1]),s(l[i+1][d]))}}function s(e){i.push(e.x,e.y,e.z)}function l(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function u(e,t,r,n){n<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=n/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){for(var r=new Rt,n=new Rt,i=new Rt,a=0;a<t.length;a+=3)l(t[a+0],r),l(t[a+1],n),l(t[a+2],i),o(r,n,i,e)}(n=n||0),function(e){for(var t=new Rt,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){for(var e=new Rt,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=c(e)/2/Math.PI+.5,n=(o=e,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(r,1-n)}var o;(function(){for(var e=new Rt,t=new Rt,r=new Rt,n=new Rt,o=new St,s=new St,l=new St,h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),n.copy(e).add(t).add(r).divideScalar(3);var f=c(n);u(o,d+0,e,f),u(s,d+2,t,f),u(l,d+4,r,f)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],r=a[e+2],n=a[e+4],i=Math.max(t,r,n),o=Math.min(t,r,n);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.addAttribute("position",new zr(i,3)),this.addAttribute("normal",new zr(i.slice(),3)),this.addAttribute("uv",new zr(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Ya(e,t){Kr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qa(e,t)),this.mergeVertices()}function qa(e,t){Xa.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Za(e,t){Kr.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ja(e,t)),this.mergeVertices()}function Ja(e,t){Xa.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ka(e,t){Kr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Qa(e,t)),this.mergeVertices()}function Qa(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Xa.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function $a(e,t){Kr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new eo(e,t)),this.mergeVertices()}function eo(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];Xa.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function to(e,t,r,n,i,a){Kr.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new ro(e,t,r,n,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function ro(e,t,r,n,i){qr.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,l=new Rt,u=new Rt,c=new St,h=new Rt,d=[],f=[],p=[],m=[];function v(i){h=e.getPointAt(i/t,h);var o=a.normals[i],c=a.binormals[i];for(s=0;s<=n;s++){var p=s/n*Math.PI*2,m=Math.sin(p),v=-Math.cos(p);u.x=v*o.x+m*c.x,u.y=v*o.y+m*c.y,u.z=v*o.z+m*c.z,u.normalize(),f.push(u.x,u.y,u.z),l.x=h.x+r*u.x,l.y=h.y+r*u.y,l.z=h.z+r*u.z,d.push(l.x,l.y,l.z)}}!function(){for(o=0;o<t;o++)v(o);v(!1===i?t:0),function(){for(o=0;o<=t;o++)for(s=0;s<=n;s++)c.x=o/t,c.y=s/n,p.push(c.x,c.y)}(),function(){for(s=1;s<=t;s++)for(o=1;o<=n;o++){var e=(n+1)*(s-1)+(o-1),r=(n+1)*s+(o-1),i=(n+1)*s+o,a=(n+1)*(s-1)+o;m.push(e,r,a),m.push(r,i,a)}}()}(),this.setIndex(m),this.addAttribute("position",new zr(d,3)),this.addAttribute("normal",new zr(f,3)),this.addAttribute("uv",new zr(p,2))}function no(e,t,r,n,i,a,o){Kr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new io(e,t,r,n,i,a)),this.mergeVertices()}function io(e,t,r,n,i,a){qr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,a=a||3;var o,s,l=[],u=[],c=[],h=[],d=new Rt,f=new Rt,p=new Rt,m=new Rt,v=new Rt,g=new Rt,y=new Rt;for(o=0;o<=r;++o){var _=o/r*i*Math.PI*2;for(R(_,i,a,e,p),R(_+.01,i,a,e,m),g.subVectors(m,p),y.addVectors(m,p),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,E=-t*Math.cos(b),w=t*Math.sin(b);d.x=p.x+(E*y.x+w*v.x),d.y=p.y+(E*y.y+w*v.y),d.z=p.z+(E*y.z+w*v.z),u.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),c.push(f.x,f.y,f.z),h.push(o/r),h.push(s/n)}}for(s=1;s<=r;s++)for(o=1;o<=n;o++){var x=(n+1)*(s-1)+(o-1),T=(n+1)*s+(o-1),S=(n+1)*s+o,M=(n+1)*(s-1)+o;l.push(x,T,M),l.push(T,S,M)}function R(e,t,r,n,i){var a=Math.cos(e),o=Math.sin(e),s=r/t*e,l=Math.cos(s);i.x=n*(2+l)*.5*a,i.y=n*(2+l)*o*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new zr(u,3)),this.addAttribute("normal",new zr(c,3)),this.addAttribute("uv",new zr(h,2))}function ao(e,t,r,n,i){Kr.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new oo(e,t,r,n,i)),this.mergeVertices()}function oo(e,t,r,n,i){qr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var a,o,s=[],l=[],u=[],c=[],h=new Rt,d=new Rt,f=new Rt;for(a=0;a<=r;a++)for(o=0;o<=n;o++){var p=o/n*i,m=a/r*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(p),d.y=(e+t*Math.cos(m))*Math.sin(p),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),f.subVectors(d,h).normalize(),u.push(f.x,f.y,f.z),c.push(o/n),c.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=n;o++){var v=(n+1)*a+o-1,g=(n+1)*(a-1)+o-1,y=(n+1)*(a-1)+o,_=(n+1)*a+o;s.push(v,g,_),s.push(g,y,_)}this.setIndex(s),this.addAttribute("position",new zr(l,3)),this.addAttribute("normal",new zr(u,3)),this.addAttribute("uv",new zr(c,2))}Object.assign(_a.prototype,t.prototype),Object.assign(ba.prototype,t.prototype),Object.assign(wa.prototype,{isFogExp2:!0,clone:function(){return new wa(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(xa.prototype,{isFog:!0,clone:function(){return new xa(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Ta.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ta.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Sa.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Sa.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),Ma.prototype=Object.create(Cr.prototype),Ma.prototype.constructor=Ma,Ma.prototype.isSpriteMaterial=!0,Ma.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Ra.prototype=Object.assign(Object.create(mr.prototype),{constructor:Ra,isSprite:!0,raycast:function(){var e=new Rt,t=new Rt,r=new Rt,n=new St,i=new St,a=new Wt,o=new Rt,s=new Rt,l=new Rt,u=new St,c=new St,h=new St;function d(e,t,r,o,s,l){n.subVectors(e,r).addScalar(.5).multiply(o),void 0!==s?(i.x=l*n.x-s*n.y,i.y=s*n.x+l*n.y):i.copy(n),e.copy(t),e.x+=i.x,e.y+=i.y,e.applyMatrix4(a)}return function(n,i){t.setFromMatrixScale(this.matrixWorld),a.copy(n._camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n._camera.matrixWorldInverse,this.matrixWorld),r.setFromMatrixPosition(this.modelViewMatrix),n._camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&t.multiplyScalar(-r.z);var f,p,m=this.material.rotation;0!==m&&(p=Math.cos(m),f=Math.sin(m));var v=this.center;d(o.set(-.5,-.5,0),r,v,t,f,p),d(s.set(.5,-.5,0),r,v,t,f,p),d(l.set(.5,.5,0),r,v,t,f,p),u.set(0,0),c.set(1,0),h.set(1,1);var g=n.ray.intersectTriangle(o,s,l,!1,e);if(null!==g||(d(s.set(-.5,.5,0),r,v,t,f,p),c.set(0,1),null!==(g=n.ray.intersectTriangle(o,l,s,!1,e)))){var y=n.ray.origin.distanceTo(e);y<n.near||y>n.far||i.push({distance:y,point:e.clone(),uv:br.getUV(e,o,s,l,u,c,h,new St),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return mr.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Aa.prototype=Object.assign(Object.create(mr.prototype),{constructor:Aa,isLOD:!0,copy:function(e){mr.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:(ma=new Rt,function(e,t){ma.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(ma);this.getObjectForDistance(r).raycast(e,t)}),update:function(){var e=new Rt,t=new Rt;return function(r){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);n[0].object.visible=!0;for(var a=1,o=n.length;a<o&&i>=n[a].distance;a++)n[a-1].object.visible=!1,n[a].object.visible=!0;for(;a<o;a++)n[a].object.visible=!1}}}(),toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var a=r[n];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),ka.prototype=Object.assign(Object.create(Zr.prototype),{constructor:ka,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new jt,t=this.geometry.attributes.skinWeight,r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Zr.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Pa.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Wt;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(fa=new Wt,pa=new Wt,function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:pa;fa.multiplyMatrices(o,t[i]),fa.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new Pa(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),Ca.prototype=Object.assign(Object.create(mr.prototype),{constructor:Ca,isBone:!0}),La.prototype=Object.create(Cr.prototype),La.prototype.constructor=La,La.prototype.isLineBasicMaterial=!0,La.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Ia.prototype=Object.assign(Object.create(mr.prototype),{constructor:Ia,isLine:!0,computeLineDistances:(ha=new Rt,da=new Rt,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)ha.fromBufferAttribute(t,n-1),da.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=ha.distanceTo(da);e.addAttribute("lineDistance",new zr(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices,r=e.lineDistances;r[0]=0;for(var n=1,i=a.length;n<i;n++)r[n]=r[n-1],r[n]+=a[n-1].distanceTo(a[n])}return this}),raycast:function(){var e=new Wt,t=new _r,r=new yr;return function(n,i){var a=n.linePrecision,o=this.geometry,s=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=a,!1!==n.ray.intersectsSphere(r)){e.getInverse(s),t.copy(n.ray).applyMatrix4(e);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,c=new Rt,h=new Rt,d=new Rt,f=new Rt,p=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var m=o.index,v=o.attributes,g=v.position.array;if(null!==m)for(var y=m.array,_=0,b=y.length-1;_<b;_+=p){var E=y[_],w=y[_+1];c.fromArray(g,3*E),h.fromArray(g,3*w);var x=t.distanceSqToSegment(c,h,f,d);if(!(x>u)){f.applyMatrix4(this.matrixWorld);var T=n.ray.origin.distanceTo(f);T<n.near||T>n.far||i.push({distance:T,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else for(var _=0,b=g.length/3-1;_<b;_+=p){c.fromArray(g,3*_),h.fromArray(g,3*_+3);var x=t.distanceSqToSegment(c,h,f,d);if(!(x>u)){f.applyMatrix4(this.matrixWorld);var T=n.ray.origin.distanceTo(f);T<n.near||T>n.far||i.push({distance:T,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}else if(o.isGeometry)for(var S=o.vertices,M=S.length,_=0;_<M-1;_+=p){var x=t.distanceSqToSegment(S[_],S[_+1],f,d);if(!(x>u)){f.applyMatrix4(this.matrixWorld);var T=n.ray.origin.distanceTo(f);T<n.near||T>n.far||i.push({distance:T,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Oa.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Oa,isLineSegments:!0,computeLineDistances:function(){var e=new Rt,t=new Rt;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],a=0,o=n.count;a<o;a+=2)e.fromBufferAttribute(n,a),t.fromBufferAttribute(n,a+1),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t);r.addAttribute("lineDistance",new zr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry)for(var s=r.vertices,i=r.lineDistances,a=0,o=s.length;a<o;a+=2)e.copy(s[a]),t.copy(s[a+1]),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t);return this}}()}),Ha.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Ha,isLineLoop:!0}),Da.prototype=Object.create(Cr.prototype),Da.prototype.constructor=Da,Da.prototype.isPointsMaterial=!0,Da.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Na.prototype=Object.assign(Object.create(mr.prototype),{constructor:Na,isPoints:!0,raycast:function(){var e=new Wt,t=new _r,r=new yr;return function(n,i){var a=this,o=this.geometry,s=this.matrixWorld,l=n.params.Points.threshold;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=l,!1!==n.ray.intersectsSphere(r)){e.getInverse(s),t.copy(n.ray).applyMatrix4(e);var u=l/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,h=new Rt,d=new Rt;if(o.isBufferGeometry){var f=o.index,p=o.attributes,m=p.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length;g<y;g++){var _=v[g];h.fromArray(m,3*_),w(h,_)}else for(var g=0,b=m.length/3;g<b;g++)h.fromArray(m,3*g),w(h,g)}else for(var E=o.vertices,g=0,b=E.length;g<b;g++)w(E[g],g)}function w(e,r){var o=t.distanceSqToPoint(e);if(o<c){t.closestPointToPoint(e,d),d.applyMatrix4(s);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(o),point:d.clone(),index:r,face:null,object:a})}}}}(),updateMorphTargets:function(){var e,t,r,n=this.geometry,i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Fa.prototype=Object.assign(Object.create(zt.prototype),{constructor:Fa,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Ua.prototype=Object.create(zt.prototype),Ua.prototype.constructor=Ua,Ua.prototype.isCompressedTexture=!0,Ba.prototype=Object.create(zt.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isCanvasTexture=!0,za.prototype=Object.create(zt.prototype),za.prototype.constructor=za,za.prototype.isDepthTexture=!0,ja.prototype=Object.create(qr.prototype),ja.prototype.constructor=ja,Va.prototype=Object.create(Kr.prototype),Va.prototype.constructor=Va,Ga.prototype=Object.create(qr.prototype),Ga.prototype.constructor=Ga,Wa.prototype=Object.create(Kr.prototype),Wa.prototype.constructor=Wa,Xa.prototype=Object.create(qr.prototype),Xa.prototype.constructor=Xa,Ya.prototype=Object.create(Kr.prototype),Ya.prototype.constructor=Ya,qa.prototype=Object.create(Xa.prototype),qa.prototype.constructor=qa,Za.prototype=Object.create(Kr.prototype),Za.prototype.constructor=Za,Ja.prototype=Object.create(Xa.prototype),Ja.prototype.constructor=Ja,Ka.prototype=Object.create(Kr.prototype),Ka.prototype.constructor=Ka,Qa.prototype=Object.create(Xa.prototype),Qa.prototype.constructor=Qa,$a.prototype=Object.create(Kr.prototype),$a.prototype.constructor=$a,eo.prototype=Object.create(Xa.prototype),eo.prototype.constructor=eo,to.prototype=Object.create(Kr.prototype),to.prototype.constructor=to,ro.prototype=Object.create(qr.prototype),ro.prototype.constructor=ro,ro.prototype.toJSON=function(){var e=qr.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},no.prototype=Object.create(Kr.prototype),no.prototype.constructor=no,io.prototype=Object.create(qr.prototype),io.prototype.constructor=io,ao.prototype=Object.create(Kr.prototype),ao.prototype.constructor=ao,oo.prototype=Object.create(qr.prototype),oo.prototype.constructor=oo;var so={triangulate:function(e,t,r){r=r||2;var n,i,a,o,s,l,u,c=t&&t.length,h=c?t[0]*r:e.length,d=lo(e,0,h,r,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,r,n){var i,a,o,s,l,u=[];for(i=0,a=t.length;i<a;i++)o=t[i]*n,s=i<a-1?t[i+1]*n:e.length,(l=lo(e,o,s,n,!1))===l.next&&(l.steiner=!0),u.push(_o(l));for(u.sort(vo),i=0;i<u.length;i++)go(u[i],r),r=uo(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=a=e[0],i=o=e[1];for(var p=r;p<h;p+=r)s=e[p],l=e[p+1],s<n&&(n=s),l<i&&(i=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-n,o-i))?1/u:0}return co(d,f,r,n,i,u),f}};function lo(e,t,r,n,i){var a,o;if(i===function(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,r,n)>0)for(a=t;a<r;a+=n)o=Ro(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=Ro(a,e[a],e[a+1],o);return o&&xo(o,o.next)&&(Ao(o),o=o.next),o}function uo(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!xo(n,n.next)&&0!==wo(n.prev,n,n.next))n=n.next;else{if(Ao(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function co(e,t,r,n,i,a,o){if(e){!o&&a&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=yo(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(e,n,i,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?fo(e,n,i,a):ho(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),Ao(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?co(e=po(e,t,r),t,r,n,i,a,2):2===o&&mo(e,t,r,n,i,a):co(uo(e),t,r,n,i,a,1);break}}}function ho(e){var t=e.prev,r=e,n=e.next;if(wo(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(bo(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&wo(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function fo(e,t,r,n){var i=e.prev,a=e,o=e.next;if(wo(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=yo(s,l,t,r,n),d=yo(u,c,t,r,n),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&bo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&wo(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&bo(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&wo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&bo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&wo(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&bo(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&wo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function po(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!xo(i,a)&&To(i,n,n.next,a)&&So(i,a)&&So(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),Ao(n),Ao(n.next),n=e=a),n=n.next}while(n!==e);return n}function mo(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Eo(o,s)){var l=Mo(o,s);return o=uo(o,o.next),l=uo(l,l.next),co(o,t,r,n,i,a),void co(l,t,r,n,i,a)}s=s.next}o=o.next}while(o!==e)}function vo(e,t){return e.x-t.x}function go(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,u=r,c=r.x,h=r.y,d=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=c&&i!==n.x&&bo(a<h?i:o,a,c,h,a<h?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&So(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=Mo(t,e);uo(r,r.next)}}function yo(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _o(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function bo(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function Eo(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&To(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&So(e,t)&&So(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function wo(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function xo(e,t){return e.x===t.x&&e.y===t.y}function To(e,t,r,n){return!!(xo(e,r)&&xo(t,n)||xo(e,n)&&xo(r,t))||wo(e,t,r)>0!=wo(e,t,n)>0&&wo(r,n,e)>0!=wo(r,n,t)>0}function So(e,t){return wo(e.prev,e,e.next)<0?wo(e,t,e.next)>=0&&wo(e,e.prev,t)>=0:wo(e,t,e.prev)<0||wo(e,e.next,t)<0}function Mo(e,t){var r=new ko(e.i,e.x,e.y),n=new ko(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function Ro(e,t,r,n){var i=new ko(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ao(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ko(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Po={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return Po.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];Co(e),Lo(r,e);var a=e.length;t.forEach(Co);for(var o=0;o<t.length;o++)n.push(a),a+=t[o].length,Lo(r,t[o]);for(var s=so.triangulate(r,n),o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function Co(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Lo(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function Io(e,t){Kr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Oo(e,t)),this.mergeVertices()}function Oo(e,t){qr.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,n=[],i=[],a=0,o=e.length;a<o;a++){var s=e[a];l(s)}function l(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,u=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:c-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Ho;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var v,g,y,_,b,E,w,x,T=!1;p&&(v=p.getSpacedPoints(s),T=!0,u=!1,g=p.computeFrenetFrames(s,!1),y=new Rt,_=new Rt,b=new Rt),u||(f=0,c=0,h=0,d=0);var S=e.extractPoints(o),M=S.shape,R=S.holes,A=!Po.isClockWise(M);if(A)for(M=M.reverse(),w=0,x=R.length;w<x;w++)E=R[w],Po.isClockWise(E)&&(R[w]=E.reverse());var k=Po.triangulateShape(M,R),P=M;for(w=0,x=R.length;w<x;w++)E=R[w],M=M.concat(E);function C(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var L,I,O,H,D,N,F=M.length,U=k.length;function B(e,t,r){var n,i,a,o=e.x-t.x,s=e.y-t.y,l=r.x-e.x,u=r.y-e.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),f=Math.sqrt(l*l+u*u),p=t.x-s/d,m=t.y+o/d,v=r.x-u/f,g=r.y+l/f,y=((v-p)*u-(g-m)*l)/(o*u-s*l);n=p+o*y-e.x,i=m+s*y-e.y;var _=n*n+i*i;if(_<=2)return new St(n,i);a=Math.sqrt(_/2)}else{var b=!1;o>Number.EPSILON?l>Number.EPSILON&&(b=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(b=!0):Math.sign(s)===Math.sign(u)&&(b=!0),b?(n=-s,i=o,a=Math.sqrt(c)):(n=o,i=s,a=Math.sqrt(c/2))}return new St(n/a,i/a)}for(var z=[],j=0,V=P.length,G=V-1,W=j+1;j<V;j++,G++,W++)G===V&&(G=0),W===V&&(W=0),z[j]=B(P[j],P[G],P[W]);var X,Y,q=[],Z=z.concat();for(w=0,x=R.length;w<x;w++){for(E=R[w],X=[],j=0,V=E.length,G=V-1,W=j+1;j<V;j++,G++,W++)G===V&&(G=0),W===V&&(W=0),X[j]=B(E[j],E[G],E[W]);q.push(X),Z=Z.concat(X)}for(L=0;L<f;L++){for(O=L/f,H=c*Math.cos(O*Math.PI/2),I=h*Math.sin(O*Math.PI/2)+d,j=0,V=P.length;j<V;j++)K((D=C(P[j],z[j],I)).x,D.y,-H);for(w=0,x=R.length;w<x;w++)for(E=R[w],X=q[w],j=0,V=E.length;j<V;j++)K((D=C(E[j],X[j],I)).x,D.y,-H)}for(I=h+d,j=0;j<F;j++)D=u?C(M[j],Z[j],I):M[j],T?(_.copy(g.normals[0]).multiplyScalar(D.x),y.copy(g.binormals[0]).multiplyScalar(D.y),b.copy(v[0]).add(_).add(y),K(b.x,b.y,b.z)):K(D.x,D.y,0);for(Y=1;Y<=s;Y++)for(j=0;j<F;j++)D=u?C(M[j],Z[j],I):M[j],T?(_.copy(g.normals[Y]).multiplyScalar(D.x),y.copy(g.binormals[Y]).multiplyScalar(D.y),b.copy(v[Y]).add(_).add(y),K(b.x,b.y,b.z)):K(D.x,D.y,l/s*Y);for(L=f-1;L>=0;L--){for(O=L/f,H=c*Math.cos(O*Math.PI/2),I=h*Math.sin(O*Math.PI/2)+d,j=0,V=P.length;j<V;j++)K((D=C(P[j],z[j],I)).x,D.y,l+H);for(w=0,x=R.length;w<x;w++)for(E=R[w],X=q[w],j=0,V=E.length;j<V;j++)D=C(E[j],X[j],I),T?K(D.x,D.y+v[s-1].y,v[s-1].x+H):K(D.x,D.y,l+H)}function J(e,t){var r,n;for(j=e.length;--j>=0;){r=j,(n=j-1)<0&&(n=e.length-1);var i=0,a=s+2*f;for(i=0;i<a;i++){var o=F*i,l=F*(i+1),u=t+r+o,c=t+n+o,h=t+n+l,d=t+r+l;$(u,c,h,d)}}}function K(e,t,r){a.push(e),a.push(t),a.push(r)}function Q(e,t,i){ee(e),ee(t),ee(i);var a=n.length/3,o=m.generateTopUV(r,n,a-3,a-2,a-1);te(o[0]),te(o[1]),te(o[2])}function $(e,t,i,a){ee(e),ee(t),ee(a),ee(t),ee(i),ee(a);var o=n.length/3,s=m.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);te(s[0]),te(s[1]),te(s[3]),te(s[1]),te(s[2]),te(s[3])}function ee(e){n.push(a[3*e+0]),n.push(a[3*e+1]),n.push(a[3*e+2])}function te(e){i.push(e.x),i.push(e.y)}!function(){var e=n.length/3;if(u){var t=0,i=F*t;for(j=0;j<U;j++)Q((N=k[j])[2]+i,N[1]+i,N[0]+i);for(i=F*(t=s+2*f),j=0;j<U;j++)Q((N=k[j])[0]+i,N[1]+i,N[2]+i)}else{for(j=0;j<U;j++)Q((N=k[j])[2],N[1],N[0]);for(j=0;j<U;j++)Q((N=k[j])[0]+F*s,N[1]+F*s,N[2]+F*s)}r.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;for(J(P,t),t+=P.length,w=0,x=R.length;w<x;w++)J(E=R[w],t),t+=E.length;r.addGroup(e,n.length/3-e,1)}()}this.addAttribute("position",new zr(n,3)),this.addAttribute("uv",new zr(i,2)),this.computeVertexNormals()}Io.prototype=Object.create(Kr.prototype),Io.prototype.constructor=Io,Io.prototype.toJSON=function(){var e=Kr.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return Do(t,r,e)},Oo.prototype=Object.create(qr.prototype),Oo.prototype.constructor=Oo,Oo.prototype.toJSON=function(){var e=qr.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return Do(t,r,e)};var Ho={generateTopUV:function(e,t,r,n,i){var a=t[3*r],o=t[3*r+1],s=t[3*n],l=t[3*n+1],u=t[3*i],c=t[3*i+1];return[new St(a,o),new St(s,l),new St(u,c)]},generateSideWallUV:function(e,t,r,n,i,a){var o=t[3*r],s=t[3*r+1],l=t[3*r+2],u=t[3*n],c=t[3*n+1],h=t[3*n+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*a],v=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<.01?[new St(o,1-l),new St(u,1-h),new St(d,1-p),new St(m,1-g)]:[new St(s,1-l),new St(c,1-h),new St(f,1-p),new St(v,1-g)]}};function Do(e,t,r){if(r.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var a=e[n];r.shapes.push(a.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function No(e,t){Kr.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Fo(e,t)),this.mergeVertices()}function Fo(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Kr;var n=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Oo.call(this,n,t),this.type="TextBufferGeometry"}function Uo(e,t,r,n,i,a,o){Kr.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Bo(e,t,r,n,i,a,o)),this.mergeVertices()}function Bo(e,t,r,n,i,a,o){qr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,u=Math.min(a+o,Math.PI),c=0,h=[],d=new Rt,f=new Rt,p=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],_=l/r,b=0;for(0==l&&0==a?b=.5/t:l==r&&u==Math.PI&&(b=-.5/t),s=0;s<=t;s++){var E=s/t;d.x=-e*Math.cos(n+E*i)*Math.sin(a+_*o),d.y=e*Math.cos(a+_*o),d.z=e*Math.sin(n+E*i)*Math.sin(a+_*o),m.push(d.x,d.y,d.z),f.copy(d).normalize(),v.push(f.x,f.y,f.z),g.push(E+b,1-_),y.push(c++)}h.push(y)}for(l=0;l<r;l++)for(s=0;s<t;s++){var w=h[l][s+1],x=h[l][s],T=h[l+1][s],S=h[l+1][s+1];(0!==l||a>0)&&p.push(w,x,S),(l!==r-1||u<Math.PI)&&p.push(x,T,S)}this.setIndex(p),this.addAttribute("position",new zr(m,3)),this.addAttribute("normal",new zr(v,3)),this.addAttribute("uv",new zr(g,2))}function zo(e,t,r,n,i,a){Kr.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new jo(e,t,r,n,i,a)),this.mergeVertices()}function jo(e,t,r,n,i,a){qr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,n=void 0!==n?Math.max(1,n):1;var o,s,l,u=[],c=[],h=[],d=[],f=e,p=(t-e)/n,m=new Rt,v=new St;for(s=0;s<=n;s++){for(l=0;l<=r;l++)o=i+l/r*a,m.x=f*Math.cos(o),m.y=f*Math.sin(o),c.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);f+=p}for(s=0;s<n;s++){var g=s*(r+1);for(l=0;l<r;l++){var y=o=l+g,_=o+r+1,b=o+r+2,E=o+1;u.push(y,_,E),u.push(_,b,E)}}this.setIndex(u),this.addAttribute("position",new zr(c,3)),this.addAttribute("normal",new zr(h,3)),this.addAttribute("uv",new zr(d,2))}function Vo(e,t,r,n){Kr.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new Go(e,t,r,n)),this.mergeVertices()}function Go(e,t,r,n){qr.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=Tt.clamp(n,0,2*Math.PI);var i,a,o,s=[],l=[],u=[],c=1/t,h=new Rt,d=new St;for(a=0;a<=t;a++){var f=r+a*c*n,p=Math.sin(f),m=Math.cos(f);for(o=0;o<=e.length-1;o++)h.x=e[o].x*p,h.y=e[o].y,h.z=e[o].x*m,l.push(h.x,h.y,h.z),d.x=a/t,d.y=o/(e.length-1),u.push(d.x,d.y)}for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var v=i=o+a*e.length,g=i+e.length,y=i+e.length+1,_=i+1;s.push(v,g,_),s.push(g,y,_)}if(this.setIndex(s),this.addAttribute("position",new zr(l,3)),this.addAttribute("uv",new zr(u,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,E=new Rt,w=new Rt,x=new Rt;for(i=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)E.x=b[o+0],E.y=b[o+1],E.z=b[o+2],w.x=b[i+o+0],w.y=b[i+o+1],w.z=b[i+o+2],x.addVectors(E,w).normalize(),b[o+0]=b[i+o+0]=x.x,b[o+1]=b[i+o+1]=x.y,b[o+2]=b[i+o+2]=x.z}}function Wo(e,t){Kr.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Xo(e,t)),this.mergeVertices()}function Xo(e,t){qr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],a=[],o=0,s=0;if(!1===Array.isArray(e))u(e);else for(var l=0;l<e.length;l++)u(e[l]),this.addGroup(o,s,l),o+=s,s=0;function u(e){var o,l,u,c=n.length/3,h=e.extractPoints(t),d=h.shape,f=h.holes;for(!1===Po.isClockWise(d)&&(d=d.reverse()),o=0,l=f.length;o<l;o++)u=f[o],!0===Po.isClockWise(u)&&(f[o]=u.reverse());var p=Po.triangulateShape(d,f);for(o=0,l=f.length;o<l;o++)u=f[o],d=d.concat(u);for(o=0,l=d.length;o<l;o++){var m=d[o];n.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}for(o=0,l=p.length;o<l;o++){var v=p[o],g=v[0]+c,y=v[1]+c,_=v[2]+c;r.push(g,y,_),s+=3}}this.setIndex(r),this.addAttribute("position",new zr(n,3)),this.addAttribute("normal",new zr(i,3)),this.addAttribute("uv",new zr(a,2))}function Yo(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function qo(e,t){qr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,a,o=[],s=Math.cos(Tt.DEG2RAD*t),l=[0,0],u={},c=["a","b","c"];e.isBufferGeometry?(a=new Kr).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,d=a.faces,f=0,p=d.length;f<p;f++)for(var m=d[f],v=0;v<3;v++)r=m[c[v]],n=m[c[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),i=l[0]+","+l[1],void 0===u[i]?u[i]={index1:l[0],index2:l[1],face1:f,face2:void 0}:u[i].face2=f;for(i in u){var g=u[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];o.push(y.x,y.y,y.z),y=h[g.index2],o.push(y.x,y.y,y.z)}}this.addAttribute("position",new zr(o,3))}function Zo(e,t,r,n,i,a,o,s){Kr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Jo(e,t,r,n,i,a,o,s)),this.mergeVertices()}function Jo(e,t,r,n,i,a,o,s){qr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var u=[],c=[],h=[],d=[],f=0,p=[],m=r/2,v=0;function g(r){var i,a,p,g=new St,y=new Rt,_=0,b=!0===r?e:t,E=!0===r?1:-1;for(a=f,i=1;i<=n;i++)c.push(0,m*E,0),h.push(0,E,0),d.push(.5,.5),f++;for(p=f,i=0;i<=n;i++){var w=i/n,x=w*s+o,T=Math.cos(x),S=Math.sin(x);y.x=b*S,y.y=m*E,y.z=b*T,c.push(y.x,y.y,y.z),h.push(0,E,0),g.x=.5*T+.5,g.y=.5*S*E+.5,d.push(g.x,g.y),f++}for(i=0;i<n;i++){var M=a+i,R=p+i;!0===r?u.push(R,R+1,M):u.push(R+1,R,M),_+=3}l.addGroup(v,_,!0===r?1:2),v+=_}!function(){var a,g,y=new Rt,_=new Rt,b=0,E=(t-e)/r;for(g=0;g<=i;g++){var w=[],x=g/i,T=x*(t-e)+e;for(a=0;a<=n;a++){var S=a/n,M=S*s+o,R=Math.sin(M),A=Math.cos(M);_.x=T*R,_.y=-x*r+m,_.z=T*A,c.push(_.x,_.y,_.z),y.set(R,E,A).normalize(),h.push(y.x,y.y,y.z),d.push(S,1-x),w.push(f++)}p.push(w)}for(a=0;a<n;a++)for(g=0;g<i;g++){var k=p[g][a],P=p[g+1][a],C=p[g+1][a+1],L=p[g][a+1];u.push(k,P,L),u.push(P,C,L),b+=6}l.addGroup(v,b,0),v+=b}(),!1===a&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(u),this.addAttribute("position",new zr(c,3)),this.addAttribute("normal",new zr(h,3)),this.addAttribute("uv",new zr(d,2))}function Ko(e,t,r,n,i,a,o){Zo.call(this,0,e,t,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function Qo(e,t,r,n,i,a,o){Jo.call(this,0,e,t,r,n,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function $o(e,t,r,n){Kr.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new es(e,t,r,n)),this.mergeVertices()}function es(e,t,r,n){qr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,a,o=[],s=[],l=[],u=[],c=new Rt,h=new St;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var d=r+a/t*n;c.x=e*Math.cos(d),c.y=e*Math.sin(d),s.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,u.push(h.x,h.y)}for(i=1;i<=t;i++)o.push(i,i+1,0);this.setIndex(o),this.addAttribute("position",new zr(s,3)),this.addAttribute("normal",new zr(l,3)),this.addAttribute("uv",new zr(u,2))}No.prototype=Object.create(Kr.prototype),No.prototype.constructor=No,Fo.prototype=Object.create(Oo.prototype),Fo.prototype.constructor=Fo,Uo.prototype=Object.create(Kr.prototype),Uo.prototype.constructor=Uo,Bo.prototype=Object.create(qr.prototype),Bo.prototype.constructor=Bo,zo.prototype=Object.create(Kr.prototype),zo.prototype.constructor=zo,jo.prototype=Object.create(qr.prototype),jo.prototype.constructor=jo,Vo.prototype=Object.create(Kr.prototype),Vo.prototype.constructor=Vo,Go.prototype=Object.create(qr.prototype),Go.prototype.constructor=Go,Wo.prototype=Object.create(Kr.prototype),Wo.prototype.constructor=Wo,Wo.prototype.toJSON=function(){var e=Kr.prototype.toJSON.call(this),t=this.parameters.shapes;return Yo(t,e)},Xo.prototype=Object.create(qr.prototype),Xo.prototype.constructor=Xo,Xo.prototype.toJSON=function(){var e=qr.prototype.toJSON.call(this),t=this.parameters.shapes;return Yo(t,e)},qo.prototype=Object.create(qr.prototype),qo.prototype.constructor=qo,Zo.prototype=Object.create(Kr.prototype),Zo.prototype.constructor=Zo,Jo.prototype=Object.create(qr.prototype),Jo.prototype.constructor=Jo,Ko.prototype=Object.create(Zo.prototype),Ko.prototype.constructor=Ko,Qo.prototype=Object.create(Jo.prototype),Qo.prototype.constructor=Qo,$o.prototype=Object.create(Kr.prototype),$o.prototype.constructor=$o,es.prototype=Object.create(qr.prototype),es.prototype.constructor=es;var ts=Object.freeze({WireframeGeometry:ja,ParametricGeometry:Va,ParametricBufferGeometry:Ga,TetrahedronGeometry:Ya,TetrahedronBufferGeometry:qa,OctahedronGeometry:Za,OctahedronBufferGeometry:Ja,IcosahedronGeometry:Ka,IcosahedronBufferGeometry:Qa,DodecahedronGeometry:$a,DodecahedronBufferGeometry:eo,PolyhedronGeometry:Wa,PolyhedronBufferGeometry:Xa,TubeGeometry:to,TubeBufferGeometry:ro,TorusKnotGeometry:no,TorusKnotBufferGeometry:io,TorusGeometry:ao,TorusBufferGeometry:oo,TextGeometry:No,TextBufferGeometry:Fo,SphereGeometry:Uo,SphereBufferGeometry:Bo,RingGeometry:zo,RingBufferGeometry:jo,PlaneGeometry:xn,PlaneBufferGeometry:Tn,LatheGeometry:Vo,LatheBufferGeometry:Go,ShapeGeometry:Wo,ShapeBufferGeometry:Xo,ExtrudeGeometry:Io,ExtrudeBufferGeometry:Oo,EdgesGeometry:qo,ConeGeometry:Ko,ConeBufferGeometry:Qo,CylinderGeometry:Zo,CylinderBufferGeometry:Jo,CircleGeometry:$o,CircleBufferGeometry:es,BoxGeometry:Qr,BoxBufferGeometry:$r});function rs(e){Cr.call(this),this.type="ShadowMaterial",this.color=new Sr(0),this.transparent=!0,this.setValues(e)}function ns(e){on.call(this,e),this.type="RawShaderMaterial"}function is(e){Cr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Sr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Sr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function as(e){is.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function os(e){Cr.call(this),this.type="MeshPhongMaterial",this.color=new Sr(16777215),this.specular=new Sr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Sr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ss(e){os.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function ls(e){Cr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function us(e){Cr.call(this),this.type="MeshLambertMaterial",this.color=new Sr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Sr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function cs(e){Cr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Sr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wt,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function hs(e){La.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}rs.prototype=Object.create(Cr.prototype),rs.prototype.constructor=rs,rs.prototype.isShadowMaterial=!0,rs.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this},ns.prototype=Object.create(on.prototype),ns.prototype.constructor=ns,ns.prototype.isRawShaderMaterial=!0,is.prototype=Object.create(Cr.prototype),is.prototype.constructor=is,is.prototype.isMeshStandardMaterial=!0,is.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},as.prototype=Object.create(is.prototype),as.prototype.constructor=as,as.prototype.isMeshPhysicalMaterial=!0,as.prototype.copy=function(e){return is.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},os.prototype=Object.create(Cr.prototype),os.prototype.constructor=os,os.prototype.isMeshPhongMaterial=!0,os.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ss.prototype=Object.create(os.prototype),ss.prototype.constructor=ss,ss.prototype.isMeshToonMaterial=!0,ss.prototype.copy=function(e){return os.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},ls.prototype=Object.create(Cr.prototype),ls.prototype.constructor=ls,ls.prototype.isMeshNormalMaterial=!0,ls.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},us.prototype=Object.create(Cr.prototype),us.prototype.constructor=us,us.prototype.isMeshLambertMaterial=!0,us.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},cs.prototype=Object.create(Cr.prototype),cs.prototype.constructor=cs,cs.prototype.isMeshMatcapMaterial=!0,cs.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},hs.prototype=Object.create(La.prototype),hs.prototype.constructor=hs,hs.prototype.isLineDashedMaterial=!0,hs.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ds=Object.freeze({ShadowMaterial:rs,SpriteMaterial:Ma,RawShaderMaterial:ns,ShaderMaterial:on,PointsMaterial:Da,MeshPhysicalMaterial:as,MeshStandardMaterial:is,MeshPhongMaterial:os,MeshToonMaterial:ss,MeshNormalMaterial:ls,MeshLambertMaterial:us,MeshDepthMaterial:ra,MeshDistanceMaterial:na,MeshBasicMaterial:Lr,MeshMatcapMaterial:cs,LineDashedMaterial:hs,LineBasicMaterial:La,Material:Cr}),fs={arraySlice:function(e,t,r){return fs.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),a=0,o=0;o!==n;++a)for(var s=r[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,r,n){for(var i=1,a=e[0];void 0!==a&&void 0===a[n];)a=e[i++];if(void 0!==a){var o=a[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[n])&&(t.push(a.time),r.push.apply(r,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[n])&&(t.push(a.time),o.toArray(r,r.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[n])&&(t.push(a.time),r.push(o)),a=e[i++]}while(void 0!==a)}}};function ps(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function ms(e,t,r,n){ps.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function vs(e,t,r,n){ps.call(this,e,t,r,n)}function gs(e,t,r,n){ps.call(this,e,t,r,n)}function ys(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=fs.convertArray(t,this.TimeBufferType),this.values=fs.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function _s(e,t,r){ys.call(this,e,t,r)}function bs(e,t,r,n){ys.call(this,e,t,r,n)}function Es(e,t,r,n){ys.call(this,e,t,r,n)}function ws(e,t,r,n){ps.call(this,e,t,r,n)}function xs(e,t,r,n){ys.call(this,e,t,r,n)}function Ts(e,t,r,n){ys.call(this,e,t,r,n)}function Ss(e,t,r,n){ys.call(this,e,t,r,n)}function Ms(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=Tt.generateUUID(),this.duration<0&&this.resetDuration()}function Rs(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Es;case"vector":case"vector2":case"vector3":case"vector4":return Ss;case"color":return bs;case"quaternion":return xs;case"bool":case"boolean":return _s;case"string":return Ts}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],n=[];fs.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(ps.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var a;r:{n:if(!(e<n)){for(var o=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===o)break;if(i=n,n=t[++r],e<n)break t}a=t.length;break r}if(e>=i)break e;var s=t[1];e<s&&(r=2,i=s);for(var o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===o)break;if(n=i,i=t[--r-1],e>=i)break t}a=r,r=0}for(;r<a;){var l=r+a>>>1;e<t[l]?a=l:r=l+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,a=0;a!==n;++a)t[a]=r[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(ps.prototype,{beforeStart_:ps.prototype.copySampleValue_,afterEnd_:ps.prototype.copySampleValue_}),ms.prototype=Object.assign(Object.create(ps.prototype),{constructor:ms,DefaultSettings_:{endingStart:ut,endingEnd:ut},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,a=e+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=e,o=2*t-r;break;case 2402:i=n.length-2,o=t+n[i]-n[i+1];break;default:i=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*r-t;break;case 2402:a=1,s=r+n[1]-n[0];break;default:a=e-1,s=t}var l=.5*(r-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-r),this._offsetPrev=i*u,this._offsetNext=a*u},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(r-t)/(n-t),p=f*f,m=p*f,v=-h*m+2*h*p-h*f,g=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,_=d*m-d*p,b=0;b!==o;++b)i[b]=v*a[u+b]+g*a[l+b]+y*a[s+b]+_*a[c+b];return i}}),vs.prototype=Object.assign(Object.create(ps.prototype),{constructor:vs,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(r-t)/(n-t),c=1-u,h=0;h!==o;++h)i[h]=a[l+h]*c+a[s+h]*u;return i}}),gs.prototype=Object.assign(Object.create(ps.prototype),{constructor:gs,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(ys,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:fs.convertArray(e.times,Array),values:fs.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(ys.prototype,{constructor:ys,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new gs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new vs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ms(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,a=n-1;i!==n&&r[i]<e;)++i;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==i||a!==n){i>=a&&(a=Math.max(a,1),i=a-1);var o=this.getValueSize();this.times=fs.arraySlice(r,i,a),this.values=fs.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==n&&fs.isTypedArray(n))for(var o=0,l=n.length;o!==l;++o){var u=n[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o],u=e[o+1];if(l!==u&&(1!==o||l!==l[0]))if(n)s=!0;else for(var c=o*r,h=c-r,d=c+r,f=0;f!==r;++f){var p=t[c+f];if(p!==t[h+f]||p!==t[d+f]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var m=o*r,v=i*r,f=0;f!==r;++f)t[v+f]=t[m+f]}++i}}if(a>0){e[i]=e[a];for(var m=a*r,v=i*r,f=0;f!==r;++f)t[v+f]=t[m+f];++i}return i!==e.length&&(this.times=fs.arraySlice(e,0,i),this.values=fs.arraySlice(t,0,i*r)),this},clone:function(){var e=fs.arraySlice(this.times,0),t=fs.arraySlice(this.values,0),r=this.constructor,n=new r(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),_s.prototype=Object.assign(Object.create(ys.prototype),{constructor:_s,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),bs.prototype=Object.assign(Object.create(ys.prototype),{constructor:bs,ValueTypeName:"color"}),Es.prototype=Object.assign(Object.create(ys.prototype),{constructor:Es,ValueTypeName:"number"}),ws.prototype=Object.assign(Object.create(ps.prototype),{constructor:ws,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(r-t)/(n-t),u=s+o;s!==u;s+=4)Mt.slerpFlat(i,0,a,s-o,a,s,l);return i}}),xs.prototype=Object.assign(Object.create(ys.prototype),{constructor:xs,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new ws(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Ts.prototype=Object.assign(Object.create(ys.prototype),{constructor:Ts,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ss.prototype=Object.assign(Object.create(ys.prototype),{constructor:Ss,ValueTypeName:"vector"}),Object.assign(Ms,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,a=r.length;i!==a;++i)t.push(Rs(r[i]).scale(n));return new Ms(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,a=r.length;i!==a;++i)t.push(ys.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var u=fs.getKeyframeOrder(s);s=fs.sortedArray(s,1,u),l=fs.sortedArray(l,1,u),n||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new Es(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/r))}return new Ms(e,-1,a)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var u=l[1],c=n[u];c||(n[u]=c=[]),c.push(s)}}var h=[];for(var u in n)h.push(Ms.CreateFromMorphTargetSequence(u,n[u],t,r));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var a=[],o=[];fs.flattenJSON(r,a,o,n),0!==a.length&&i.push(new e(t,a,o))}},n=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)c[u[h].morphTargets[d]]=-1;for(var f in c){for(var p=[],m=[],d=0;d!==u[h].morphTargets.length;++d){var v=u[h];p.push(v.time),m.push(v.morphTarget===f?1:0)}n.push(new Es(".morphTargetInfluence["+f+"]",p,m))}a=c.length*(o||1)}else{var g=".bones["+t[l].name+"]";r(Ss,g+".position",u,"pos",n),r(xs,g+".quaternion",u,"rot",n),r(Ss,g+".scale",u,"scl",n)}}if(0===n.length)return null;var y=new Ms(i,a,n);return y}}),Object.assign(Ms.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,r=0,n=e.length;r!==n;++r){var i=this.tracks[r];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Ms(this.name,this.duration,e)}});var As={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function ks(e,t,r){var n=this,i=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===i&&void 0!==n.onStart&&n.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,o),a===o&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var Ps=new ks,Cs={};function Ls(e){this.manager=void 0!==e?e:Ps}function Is(e){this.manager=void 0!==e?e:Ps}function Os(e){this.manager=void 0!==e?e:Ps,this._parser=null}function Hs(e){this.manager=void 0!==e?e:Ps,this._parser=null}function Ds(e){this.manager=void 0!==e?e:Ps}function Ns(e){this.manager=void 0!==e?e:Ps}function Fs(e){this.manager=void 0!==e?e:Ps}function Us(){this.type="Curve",this.arcLengthDivisions=200}function Bs(e,t,r,n,i,a,o,s){Us.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function zs(e,t,r,n,i,a){Bs.call(this,e,t,r,r,n,i,a),this.type="ArcCurve"}function js(){var e=0,t=0,r=0,n=0;function i(i,a,o,s){e=i,t=o,r=-3*i+3*a-2*o-s,n=2*i-2*a+o+s}return{initCatmullRom:function(e,t,r,n,a){i(t,r,a*(r-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,a,o,s){var l=(t-e)/a-(r-e)/(a+o)+(r-t)/o,u=(r-t)/o-(n-t)/(o+s)+(n-r)/s;i(t,r,l*=o,u*=o)},calc:function(i){var a=i*i,o=a*i;return e+t*i+r*a+n*o}}}Object.assign(Ls.prototype,{load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=As.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;if(void 0===Cs[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],u=o[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),f=0;f<u.length;f++)d[f]=u.charCodeAt(f);c="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var p=new DOMParser;c=p.parseFromString(u,s);break;case"json":c=JSON.parse(u);break;default:c=u}setTimeout(function(){t&&t(c),i.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)},0)}}else{Cs[e]=[],Cs[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;As.add(e,r);var n=Cs[e];if(delete Cs[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=n.length;a<o;a++){var s=n[a];s.onLoad&&s.onLoad(r)}i.manager.itemEnd(e)}else{for(var a=0,o=n.length;a<o;a++){var s=n[a];s.onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var r=Cs[e],n=0,i=r.length;n<i;n++){var a=r[n];a.onProgress&&a.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=Cs[e];delete Cs[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var r=Cs[e];delete Cs[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}Cs[e].push({onLoad:t,onProgress:r,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Is.prototype,{load:function(e,t,r,n){var i=this,a=new Ls(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var n=Ms.parse(e[r]);t.push(n)}return t},setPath:function(e){return this.path=e,this}}),Object.assign(Os.prototype,{load:function(e,t,r,n){var i=this,a=[],o=new Ua;o.image=a;var s=new Ls(this.manager);function l(l){s.load(e[l],function(e){var r=i._parser(e,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(u+=1)&&(1===r.mipmapCount&&(o.minFilter=me),o.format=r.format,o.needsUpdate=!0,t&&t(o))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,c=0,h=e.length;c<h;++c)l(c);else s.load(e,function(e){var r=i._parser(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){a[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=me),o.format=r.format,o.needsUpdate=!0,t&&t(o)},r,n);return o},setPath:function(e){return this.path=e,this}}),Object.assign(Hs.prototype,{load:function(e,t,r,n){var i=this,a=new mn,o=new Ls(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){var r=i._parser(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:ce,a.wrapT=void 0!==r.wrapT?r.wrapT:ce,a.magFilter=void 0!==r.magFilter?r.magFilter:me,a.minFilter=void 0!==r.minFilter?r.minFilter:ge,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=me),a.needsUpdate=!0,t&&t(a,r))},r,n),a},setPath:function(e){return this.path=e,this}}),Object.assign(Ds.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=As.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),As.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Ns.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=new Dn,a=new Ds(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(e[r],function(e){i.images[r]=e,6==++o&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(var l=0;l<e.length;++l)s(l);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Fs.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=new zt,a=new Ds(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(r){i.image=r;var n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?Ce:Le,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Us.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),a=0;for(n.push(0),r=1;r<=e;r++)t=this.getPoint(r/e),a+=t.distanceTo(i),n.push(a),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,a=n.length;r=t||e*n[a-1];for(var o,s=0,l=a-1;s<=l;)if(i=Math.floor(s+(l-s)/2),(o=n[i]-r)<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(a-1);var u=n[i],c=n[i+1],h=c-u,d=(r-u)/h,f=(i+d)/(a-1);return f},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t),i=this.getPoint(r),a=i.clone().sub(n);return a.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,a=new Rt,o=[],s=[],l=[],u=new Rt,c=new Wt;for(r=0;r<=e;r++)n=r/e,o[r]=this.getTangentAt(n),o[r].normalize();s[0]=new Rt,l[0]=new Rt;var h=Number.MAX_VALUE,d=Math.abs(o[0].x),f=Math.abs(o[0].y),p=Math.abs(o[0].z);for(d<=h&&(h=d,a.set(1,0,0)),f<=h&&(h=f,a.set(0,1,0)),p<=h&&a.set(0,0,1),u.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],u),l[0].crossVectors(o[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),u.crossVectors(o[r-1],o[r]),u.length()>Number.EPSILON&&(u.normalize(),i=Math.acos(Tt.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(c.makeRotationAxis(u,i))),l[r].crossVectors(o[r],s[r]);if(!0===t)for(i=Math.acos(Tt.clamp(s[0].dot(s[e]),-1,1)),i/=e,o[0].dot(u.crossVectors(s[0],s[e]))>0&&(i=-i),r=1;r<=e;r++)s[r].applyMatrix4(c.makeRotationAxis(o[r],i*r)),l[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Bs.prototype=Object.create(Us.prototype),Bs.prototype.constructor=Bs,Bs.prototype.isEllipseCurve=!0,Bs.prototype.getPoint=function(e,t){for(var r=t||new St,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),!0!==this.aClockwise||a||(i===n?i=-n:i-=n);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return r.set(s,l)},Bs.prototype.copy=function(e){return Us.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Bs.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Bs.prototype.fromJSON=function(e){return Us.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},zs.prototype=Object.create(Bs.prototype),zs.prototype.constructor=zs,zs.prototype.isArcCurve=!0;var Vs=new Rt,Gs=new js,Ws=new js,Xs=new js;function Ys(e,t,r,n){Us.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function qs(e,t,r,n,i){var a=.5*(n-t),o=.5*(i-r),s=e*e,l=e*s;return(2*r-2*n+a+o)*l+(-3*r+3*n-2*a-o)*s+a*e+r}function Zs(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function Js(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}function Ks(e,t,r,n){Us.call(this),this.type="CubicBezierCurve",this.v0=e||new St,this.v1=t||new St,this.v2=r||new St,this.v3=n||new St}function Qs(e,t,r,n){Us.call(this),this.type="CubicBezierCurve3",this.v0=e||new Rt,this.v1=t||new Rt,this.v2=r||new Rt,this.v3=n||new Rt}function $s(e,t){Us.call(this),this.type="LineCurve",this.v1=e||new St,this.v2=t||new St}function el(e,t){Us.call(this),this.type="LineCurve3",this.v1=e||new Rt,this.v2=t||new Rt}function tl(e,t,r){Us.call(this),this.type="QuadraticBezierCurve",this.v0=e||new St,this.v1=t||new St,this.v2=r||new St}function rl(e,t,r){Us.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Rt,this.v1=t||new Rt,this.v2=r||new Rt}function nl(e){Us.call(this),this.type="SplineCurve",this.points=e||[]}Ys.prototype=Object.create(Us.prototype),Ys.prototype.constructor=Ys,Ys.prototype.isCatmullRomCurve3=!0,Ys.prototype.getPoint=function(e,t){var r,n,i,a,o=t||new Rt,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e,c=Math.floor(u),h=u-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===h&&c===l-1&&(c=l-2,h=1),this.closed||c>0?r=s[(c-1)%l]:(Vs.subVectors(s[0],s[1]).add(s[0]),r=Vs),n=s[c%l],i=s[(c+1)%l],this.closed||c+2<l?a=s[(c+2)%l]:(Vs.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=Vs),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(r.distanceToSquared(n),d),p=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(a),d);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),Gs.initNonuniformCatmullRom(r.x,n.x,i.x,a.x,f,p,m),Ws.initNonuniformCatmullRom(r.y,n.y,i.y,a.y,f,p,m),Xs.initNonuniformCatmullRom(r.z,n.z,i.z,a.z,f,p,m)}else"catmullrom"===this.curveType&&(Gs.initCatmullRom(r.x,n.x,i.x,a.x,this.tension),Ws.initCatmullRom(r.y,n.y,i.y,a.y,this.tension),Xs.initCatmullRom(r.z,n.z,i.z,a.z,this.tension));return o.set(Gs.calc(h),Ws.calc(h),Xs.calc(h)),o},Ys.prototype.copy=function(e){Us.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ys.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Ys.prototype.fromJSON=function(e){Us.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Rt).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ks.prototype=Object.create(Us.prototype),Ks.prototype.constructor=Ks,Ks.prototype.isCubicBezierCurve=!0,Ks.prototype.getPoint=function(e,t){var r=t||new St,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Js(e,n.x,i.x,a.x,o.x),Js(e,n.y,i.y,a.y,o.y)),r},Ks.prototype.copy=function(e){return Us.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ks.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ks.prototype.fromJSON=function(e){return Us.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Qs.prototype=Object.create(Us.prototype),Qs.prototype.constructor=Qs,Qs.prototype.isCubicBezierCurve3=!0,Qs.prototype.getPoint=function(e,t){var r=t||new Rt,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Js(e,n.x,i.x,a.x,o.x),Js(e,n.y,i.y,a.y,o.y),Js(e,n.z,i.z,a.z,o.z)),r},Qs.prototype.copy=function(e){return Us.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Qs.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Qs.prototype.fromJSON=function(e){return Us.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},$s.prototype=Object.create(Us.prototype),$s.prototype.constructor=$s,$s.prototype.isLineCurve=!0,$s.prototype.getPoint=function(e,t){var r=t||new St;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},$s.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},$s.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},$s.prototype.copy=function(e){return Us.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},$s.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},$s.prototype.fromJSON=function(e){return Us.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},el.prototype=Object.create(Us.prototype),el.prototype.constructor=el,el.prototype.isLineCurve3=!0,el.prototype.getPoint=function(e,t){var r=t||new Rt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},el.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},el.prototype.copy=function(e){return Us.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},el.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},el.prototype.fromJSON=function(e){return Us.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},tl.prototype=Object.create(Us.prototype),tl.prototype.constructor=tl,tl.prototype.isQuadraticBezierCurve=!0,tl.prototype.getPoint=function(e,t){var r=t||new St,n=this.v0,i=this.v1,a=this.v2;return r.set(Zs(e,n.x,i.x,a.x),Zs(e,n.y,i.y,a.y)),r},tl.prototype.copy=function(e){return Us.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},tl.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},tl.prototype.fromJSON=function(e){return Us.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},rl.prototype=Object.create(Us.prototype),rl.prototype.constructor=rl,rl.prototype.isQuadraticBezierCurve3=!0,rl.prototype.getPoint=function(e,t){var r=t||new Rt,n=this.v0,i=this.v1,a=this.v2;return r.set(Zs(e,n.x,i.x,a.x),Zs(e,n.y,i.y,a.y),Zs(e,n.z,i.z,a.z)),r},rl.prototype.copy=function(e){return Us.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},rl.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},rl.prototype.fromJSON=function(e){return Us.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},nl.prototype=Object.create(Us.prototype),nl.prototype.constructor=nl,nl.prototype.isSplineCurve=!0,nl.prototype.getPoint=function(e,t){var r=t||new St,n=this.points,i=(n.length-1)*e,a=Math.floor(i),o=i-a,s=n[0===a?a:a-1],l=n[a],u=n[a>n.length-2?n.length-1:a+1],c=n[a>n.length-3?n.length-1:a+2];return r.set(qs(o,s.x,l.x,u.x,c.x),qs(o,s.y,l.y,u.y,c.y)),r},nl.prototype.copy=function(e){Us.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},nl.prototype.toJSON=function(){var e=Us.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},nl.prototype.fromJSON=function(e){Us.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new St).fromArray(n))}return this};var il=Object.freeze({ArcCurve:zs,CatmullRomCurve3:Ys,CubicBezierCurve:Ks,CubicBezierCurve3:Qs,EllipseCurve:Bs,LineCurve:$s,LineCurve3:el,QuadraticBezierCurve:tl,QuadraticBezierCurve3:rl,SplineCurve:nl});function al(){Us.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function ol(e){al.call(this),this.type="Path",this.currentPoint=new St,e&&this.setFromPoints(e)}function sl(e){ol.call(this,e),this.uuid=Tt.generateUUID(),this.type="Shape",this.holes=[]}function ll(e,t){mr.call(this),this.type="Light",this.color=new Sr(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function ul(e,t,r){ll.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(mr.DefaultUp),this.updateMatrix(),this.groundColor=new Sr(t)}function cl(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new St(512,512),this.map=null,this.matrix=new Wt}function hl(){cl.call(this,new ln(50,1,.5,500))}function dl(e,t,r,n,i,a){ll.call(this,e,t),this.type="SpotLight",this.position.copy(mr.DefaultUp),this.updateMatrix(),this.target=new mr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new hl}function fl(e,t,r,n){ll.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new cl(new ln(90,1,.5,500))}function pl(e,t,r,n,i,a){sn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function ml(){cl.call(this,new pl(-5,5,5,-5,.5,500))}function vl(e,t){ll.call(this,e,t),this.type="DirectionalLight",this.position.copy(mr.DefaultUp),this.updateMatrix(),this.target=new mr,this.shadow=new ml}function gl(e,t){ll.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function yl(e,t,r,n){ll.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function _l(e){this.manager=void 0!==e?e:Ps,this.textures={}}al.prototype=Object.assign(Object.create(Us.prototype),{constructor:al,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new $s(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,a=this.curves[n],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var a=i[n],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];t&&t.equals(u)||(r.push(u),t=u)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){Us.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Us.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Us.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new il[n.type]).fromJSON(n))}return this}}),ol.prototype=Object.assign(Object.create(al.prototype),{constructor:ol,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new $s(this.currentPoint.clone(),new St(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){var i=new tl(this.currentPoint.clone(),new St(e,t),new St(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(e,t,r,n,i,a){var o=new Ks(this.currentPoint.clone(),new St(e,t),new St(r,n),new St(i,a));this.curves.push(o),this.currentPoint.set(i,a)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),r=new nl(t);this.curves.push(r),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,n,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,r,n,i,a)},absarc:function(e,t,r,n,i,a){this.absellipse(e,t,r,r,n,i,a)},ellipse:function(e,t,r,n,i,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(e+l,t+u,r,n,i,a,o,s)},absellipse:function(e,t,r,n,i,a,o,s){var l=new Bs(e,t,r,n,i,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);this.currentPoint.copy(c)},copy:function(e){return al.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=al.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return al.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),sl.prototype=Object.assign(Object.create(ol.prototype),{constructor:sl,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){ol.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=ol.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){ol.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new ol).fromJSON(n))}return this}}),ll.prototype=Object.assign(Object.create(mr.prototype),{constructor:ll,isLight:!0,copy:function(e){return mr.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),ul.prototype=Object.assign(Object.create(ll.prototype),{constructor:ul,isHemisphereLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(cl.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),hl.prototype=Object.assign(Object.create(cl.prototype),{constructor:hl,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*Tt.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix())}}),dl.prototype=Object.assign(Object.create(ll.prototype),{constructor:dl,isSpotLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),fl.prototype=Object.assign(Object.create(ll.prototype),{constructor:fl,isPointLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),pl.prototype=Object.assign(Object.create(sn.prototype),{constructor:pl,isOrthographicCamera:!0,copy:function(e,t){return sn.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,a=r+e,o=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;i+=c*(this.view.offsetX/l),a=i+c*(this.view.width/l),o-=h*(this.view.offsetY/u),s=o-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),ml.prototype=Object.assign(Object.create(cl.prototype),{constructor:ml}),vl.prototype=Object.assign(Object.create(ll.prototype),{constructor:vl,isDirectionalLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),gl.prototype=Object.assign(Object.create(ll.prototype),{constructor:gl,isAmbientLight:!0}),yl.prototype=Object.assign(Object.create(ll.prototype),{constructor:yl,isRectAreaLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=ll.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(_l.prototype,{load:function(e,t,r,n){var i=this,a=new Ls(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new ds[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearCoat&&(n.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(n.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(n.uniforms[i]={},a.type){case"t":n.uniforms[i].value=r(a.value);break;case"c":n.uniforms[i].value=(new Sr).setHex(a.value);break;case"v2":n.uniforms[i].value=(new St).fromArray(a.value);break;case"v3":n.uniforms[i].value=(new Rt).fromArray(a.value);break;case"v4":n.uniforms[i].value=(new jt).fromArray(a.value);break;case"m3":n.uniforms[i].value=(new At).fromArray(a.value);case"m4":n.uniforms[i].value=(new Wt).fromArray(a.value);break;default:n.uniforms[i].value=a.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)n.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.matcap&&(n.matcap=r(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new St).fromArray(s)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),n},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var bl={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function El(){qr.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function wl(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Ir.call(this,e,t,r),this.meshPerAttribute=n||1}function xl(e){this.manager=void 0!==e?e:Ps}El.prototype=Object.assign(Object.create(qr.prototype),{constructor:El,isInstancedBufferGeometry:!0,copy:function(e){return qr.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=qr.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),wl.prototype=Object.assign(Object.create(Ir.prototype),{constructor:wl,isInstancedBufferAttribute:!0,copy:function(e){return Ir.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Ir.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Object.assign(xl.prototype,{load:function(e,t,r,n){var i=this,a=new Ls(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new El:new qr,r=e.data.index;if(void 0!==r){var n=new Tl[r.type](r.array);t.setIndex(new Ir(n,1))}var i=e.data.attributes;for(var a in i){var o=i[a],n=new Tl[o.type](o.array),s=o.isInstancedBufferAttribute?wl:Ir,l=new s(n,o.itemSize,o.normalized);void 0!==o.name&&(l.name=o.name),t.addAttribute(a,l)}var u=e.data.morphAttributes;if(u)for(var a in u){for(var c=u[a],h=[],d=0,f=c.length;d<f;d++){var o=c[d],n=new Tl[o.type](o.array),l=new Ir(n,o.itemSize,o.normalized);void 0!==o.name&&(l.name=o.name),h.push(l)}t.morphAttributes[a]=h}var p=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==p)for(var d=0,m=p.length;d!==m;++d){var v=p[d];t.addGroup(v.start,v.count,v.materialIndex)}var g=e.data.boundingSphere;if(void 0!==g){var y=new Rt;void 0!==g.center&&y.fromArray(g.center),t.boundingSphere=new yr(y,g.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var Tl={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Sl(e){this.manager=void 0!==e?e:Ps,this.resourcePath=""}Object.assign(Sl.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?bl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new Ls(i.manager);o.setPath(this.path),o.load(e,function(r){var a=null;try{a=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,n,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new sl).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new xl,i=0,a=e.length;i<a;i++){var o,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new ts[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new ts[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new ts[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new ts[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new ts[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new ts[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new ts[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new ts[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new ts[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new ts[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new ts[s.type]((new il[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new ts[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new ts[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,c=s.shapes.length;u<c;u++){var h=t[s.shapes[u]];l.push(h)}o=new ts[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var l=[],u=0,c=s.shapes.length;u<c;u++){var h=t[s.shapes[u]];l.push(h)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new il[d.type]).fromJSON(d)),o=new ts[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var f=new THREE.LegacyJSONLoader;o=f.parse(s,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(e,t){var r={},n={};if(void 0!==e){var i=new _l;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===r[c.uuid]&&(r[c.uuid]=i.parse(c)),l.push(r[c.uuid])}n[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=Ms.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),t.push(i)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),o.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var a=new ks(t),o=new Ds(a);o.setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var u=e[s],c=u.url;if(Array.isArray(c)){n[u.uuid]=[];for(var h=0,d=c.length;h<d;h++){var f=c[h],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f)?f:r.resourcePath+f;n[u.uuid].push(i(p))}}else{var p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:r.resourcePath+u.url;n[u.uuid]=i(p)}}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new Dn(t[s.image]):new zt(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,Cl)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],Ll),o.wrapT=r(s.wrap[1],Ll)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,Il)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,Il)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n},parseObject:function(e,t,r){var n;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var a=e[n];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(r[a])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new vr,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new Sr(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new xa(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new wa(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new ln(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new pl(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new gl(e.color,e.intensity);break;case"DirectionalLight":n=new vl(e.color,e.intensity);break;case"PointLight":n=new fl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new yl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new dl(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new ul(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(e.geometry),s=a(e.material);n=o.bones&&o.bones.length>0?new ka(o,s):new Zr(o,s),void 0!==e.drawMode&&n.setDrawMode(e.drawMode);break;case"LOD":n=new Aa;break;case"Line":n=new Ia(i(e.geometry),a(e.material),e.mode);break;case"LineLoop":n=new Ha(i(e.geometry),a(e.material));break;case"LineSegments":n=new Oa(i(e.geometry),a(e.material));break;case"PointCloud":case"Points":n=new Na(i(e.geometry),a(e.material));break;case"Sprite":n=new Ra(a(e.material));break;case"Group":n=new la;break;default:n=new mr}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,u=0;u<l.length;u++)n.add(this.parseObject(l[u],t,r));if("LOD"===e.type)for(var c=e.levels,h=0;h<c.length;h++){var d=c[h],f=n.getObjectByProperty("uuid",d.object);void 0!==f&&n.addLevel(f,d.distance)}return n}});var Ml,Rl,Al,kl,Pl,Cl={UVMapping:300,CubeReflectionMapping:re,CubeRefractionMapping:ne,EquirectangularReflectionMapping:ie,EquirectangularRefractionMapping:ae,SphericalReflectionMapping:oe,CubeUVReflectionMapping:se,CubeUVRefractionMapping:le},Ll={RepeatWrapping:ue,ClampToEdgeWrapping:ce,MirroredRepeatWrapping:he},Il={NearestFilter:de,NearestMipMapNearestFilter:fe,NearestMipMapLinearFilter:pe,LinearFilter:me,LinearMipMapNearestFilter:ve,LinearMipMapLinearFilter:ge};function Ol(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Ps,this.options=void 0}function Hl(){this.type="ShapePath",this.color=new Sr,this.subPaths=[],this.currentPath=null}function Dl(e){this.type="Font",this.data=e}function Nl(e,t,r,n,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,u,c,h,d,f,p=new Hl;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,g=m.length;v<g;){var y=m[v++];switch(y){case"m":o=m[v++]*t+r,s=m[v++]*t+n,p.moveTo(o,s);break;case"l":o=m[v++]*t+r,s=m[v++]*t+n,p.lineTo(o,s);break;case"q":l=m[v++]*t+r,u=m[v++]*t+n,c=m[v++]*t+r,h=m[v++]*t+n,p.quadraticCurveTo(c,h,l,u);break;case"b":l=m[v++]*t+r,u=m[v++]*t+n,c=m[v++]*t+r,h=m[v++]*t+n,d=m[v++]*t+r,f=m[v++]*t+n,p.bezierCurveTo(c,h,d,f,l,u)}}return{offsetX:a.ha*t,path:p}}}function Fl(e){this.manager=void 0!==e?e:Ps}function Ul(){}Ol.prototype={constructor:Ol,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=As.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;fetch(e).then(function(e){return e.blob()}).then(function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)}).then(function(r){As.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(Hl.prototype,{moveTo:function(e,t){this.currentPath=new ol,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function(e,t,r,n,i,a){this.currentPath.bezierCurveTo(e,t,r,n,i,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=new sl;a.curves=i.curves,t.push(a)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,a=0;a<r;i=a++){var o=t[i],s=t[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],l=-l,s=t[i],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=u*(e.x-o.x)-l*(e.y-o.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return n}var i=Po.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return r(a);var o,s,l,u=[];if(1===a.length)return s=a[0],(l=new sl).curves=s.curves,u.push(l),u;var c=!i(a[0].getPoints());c=e?!c:c;var h,d,f=[],p=[],m=[],v=0;p[v]=void 0,m[v]=[];for(var g=0,y=a.length;g<y;g++)s=a[g],h=s.getPoints(),o=i(h),(o=e?!o:o)?(!c&&p[v]&&v++,p[v]={s:new sl,p:h},p[v].s.curves=s.curves,c&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!p[0])return r(a);if(p.length>1){for(var _=!1,b=[],E=0,w=p.length;E<w;E++)f[E]=[];for(var E=0,w=p.length;E<w;E++)for(var x=m[E],T=0;T<x.length;T++){for(var S=x[T],M=!0,R=0;R<p.length;R++)n(S.p,p[R].p)&&(E!==R&&b.push({froms:E,tos:R,hole:T}),M?(M=!1,f[R].push(S)):_=!0);M&&f[E].push(S)}b.length>0&&(_||(m=f))}for(var g=0,A=p.length;g<A;g++){l=p[g].s,u.push(l),d=m[g];for(var k=0,P=d.length;k<P;k++)l.holes.push(d[k].h)}return u}}),Object.assign(Dl.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],n=function(e,t,r){for(var n=Array.from?Array.from(e):String(e).split(""),i=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,o=[],s=0,l=0,u=0;u<n.length;u++){var c=n[u];if("\n"===c)s=0,l-=a;else{var h=Nl(c,i,s,l,r);s+=h.offsetX,o.push(h.path)}}return o}(e,t,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),Object.assign(Fl.prototype,{load:function(e,t,r,n){var i=this,a=new Ls(this.manager);a.setPath(this.path),a.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)},r,n)},parse:function(e){return new Dl(e)},setPath:function(e){return this.path=e,this}}),Ul.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r],a=t[r+1];if(i.test(e))return a}return null}},Object.assign(Ul.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:(Rl={NoBlending:g,NormalBlending:y,AdditiveBlending:_,SubtractiveBlending:b,MultiplyBlending:E,CustomBlending:w},Al=new Sr,kl=new Fs,Pl=new _l,function(e,t,r){var n={};function i(e,i,a,o,s){var l,u=t+e,c=Ul.Handlers.get(u);null!==c?l=c.load(u):(kl.setCrossOrigin(r),l=kl.load(u)),void 0!==i&&(l.repeat.fromArray(i),1!==i[0]&&(l.wrapS=ue),1!==i[1]&&(l.wrapT=ue)),void 0!==a&&l.offset.fromArray(a),void 0!==o&&("repeat"===o[0]&&(l.wrapS=ue),"mirror"===o[0]&&(l.wrapS=he),"repeat"===o[1]&&(l.wrapT=ue),"mirror"===o[1]&&(l.wrapT=he)),void 0!==s&&(l.anisotropy=s);var h=Tt.generateUUID();return n[h]=l,h}var a={uuid:Tt.generateUUID(),type:"MeshLambertMaterial"};for(var o in e){var s=e[o];switch(o){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":a.name=s;break;case"blending":a.blending=Rl[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",o,"is no longer supported.");break;case"colorDiffuse":a.color=Al.fromArray(s).getHex();break;case"colorSpecular":a.specular=Al.fromArray(s).getHex();break;case"colorEmissive":a.emissive=Al.fromArray(s).getHex();break;case"specularCoef":a.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(a.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(a.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(a.type="MeshStandardMaterial");break;case"mapDiffuse":a.map=i(s,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":a.emissiveMap=i(s,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":a.lightMap=i(s,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":a.aoMap=i(s,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":a.bumpMap=i(s,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":a.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":a.normalMap=i(s,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":a.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":a.specularMap=i(s,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":a.metalnessMap=i(s,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":a.roughnessMap=i(s,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":a.alphaMap=i(s,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":a.side=d;break;case"doubleSided":a.side=f;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),a.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":a[o]=s;break;case"vertexColors":!0===s&&(a.vertexColors=v),"face"===s&&(a.vertexColors=m);break;default:console.error("THREE.Loader.createMaterial: Unsupported",o,s)}}return"MeshBasicMaterial"===a.type&&delete a.emissive,"MeshPhongMaterial"!==a.type&&delete a.specular,a.opacity<1&&(a.transparent=!0),Pl.setTextures(n),Pl.parse(a)})});var Bl,zl,jl,Vl,Gl,Wl,Xl,Yl,ql,Zl,Jl,Kl,Ql,$l,eu,tu={getContext:function(){return void 0===Ml&&(Ml=new(window.AudioContext||window.webkitAudioContext)),Ml},setContext:function(e){Ml=e}};function ru(e){this.manager=void 0!==e?e:Ps}function nu(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Rt)}function iu(e,t){ll.call(this,void 0,t),this.sh=void 0!==e?e:new nu}function au(e,t,r){iu.call(this,void 0,r);var n=(new Sr).set(e),i=(new Sr).set(t),a=new Rt(n.r,n.g,n.b),o=new Rt(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function ou(e,t){iu.call(this,void 0,t);var r=(new Sr).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}function su(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ln,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ln,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function lu(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function uu(){mr.call(this),this.type="AudioListener",this.context=tu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function cu(e){mr.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function hu(e){cu.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function du(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function fu(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function pu(e,t,r){var n=r||mu.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function mu(e,t,r){this.path=t,this.parsedPath=r||mu.parseTrackName(t),this.node=mu.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function vu(){this.uuid=Tt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function gu(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,a=new Array(i),o={endingStart:ut,endingEnd:ut},s=0;s!==i;++s){var l=n[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=lt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function yu(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function _u(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function bu(e,t,r){Ta.call(this,e,t),this.meshPerAttribute=r||1}function Eu(e,t,r,n){this.ray=new _r(e,t),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function wu(e,t){return e.distance-t.distance}function xu(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var i=e.children,a=0,o=i.length;a<o;a++)xu(i[a],t,r,!0)}function Tu(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function Su(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}function Mu(e,t){this.min=void 0!==e?e:new St(1/0,1/0),this.max=void 0!==t?t:new St(-1/0,-1/0)}function Ru(e,t){this.start=void 0!==e?e:new Rt,this.end=void 0!==t?t:new Rt}function Au(e){mr.call(this),this.material=e,this.render=function(){}}function ku(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16711680,a=void 0!==n?n:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var l=new qr,u=new zr(2*o*3,3);l.addAttribute("position",u),Oa.call(this,l,new La({color:i,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Pu(e,t){mr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new qr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new zr(n,3));var l=new La({fog:!1});this.cone=new Oa(r,l),this.add(this.cone),this.update()}function Cu(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new qr,n=[],i=[],a=new Sr(0,0,1),o=new Sr(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.addAttribute("position",new zr(n,3)),r.addAttribute("color",new zr(i,3));var u=new La({vertexColors:v,depthTest:!1,depthWrite:!1,transparent:!0});Oa.call(this,r,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Lu(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new Bo(t,4,2),i=new Lr({wireframe:!0,fog:!1});Zr.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Iu(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var r=new qr;r.addAttribute("position",new zr([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var n=new La({fog:!1});Ia.call(this,r,n);var i=new qr;i.addAttribute("position",new zr([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new Zr(i,new Lr({side:d,fog:!1}))),this.update()}function Ou(e,t,r){mr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Ja(t);n.rotateY(.5*Math.PI),this.material=new Lr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=v);var i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.addAttribute("color",new Ir(a,3)),this.add(new Zr(n,this.material)),this.update()}function Hu(e,t){this.lightProbe=e,this.size=t;var r={GAMMA_OUTPUT:""},n=new on({defines:r,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),i=new Bo(1,32,16);Zr.call(this,i,n),this.onBeforeRender()}function Du(e,t,r,n){e=e||10,t=t||10,r=new Sr(void 0!==r?r:4473924),n=new Sr(void 0!==n?n:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],l=[],u=0,c=0,h=-o;u<=t;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=u===i?r:n;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var f=new qr;f.addAttribute("position",new zr(s,3)),f.addAttribute("color",new zr(l,3));var p=new La({vertexColors:v});Oa.call(this,f,p)}function Nu(e,t,r,n,i,a){e=e||10,t=t||16,r=r||8,n=n||64,i=new Sr(void 0!==i?i:4473924),a=new Sr(void 0!==a?a:8947848);var o,s,l,u,c,h,d,f=[],p=[];for(u=0;u<=t;u++)l=u/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(o,0,s),d=1&u?i:a,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(u=0;u<=r;u++)for(d=1&u?i:a,h=e-e/r*u,c=0;c<n;c++)l=c/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,f.push(o,0,s),p.push(d.r,d.g,d.b),l=(c+1)/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,f.push(o,0,s),p.push(d.r,d.g,d.b);var m=new qr;m.addAttribute("position",new zr(f,3)),m.addAttribute("color",new zr(p,3));var g=new La({vertexColors:v});Oa.call(this,m,g)}function Fu(e,t,r,n){this.audio=e,this.range=t||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=n||2;var i=new qr,a=this.divisionsInnerAngle+2*this.divisionsOuterAngle,o=new Float32Array(3*(3*a+3));i.addAttribute("position",new Ir(o,3));var s=new La({color:65280}),l=new La({color:16776960});Ia.call(this,i,[l,s]),this.update()}function Uu(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16776960,a=void 0!==n?n:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new qr,u=new zr(2*o*3,3);l.addAttribute("position",u),Oa.call(this,l,new La({color:i,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Bu(e,t,r){mr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new qr;n.addAttribute("position",new zr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new La({fog:!1});this.lightPlane=new Ia(n,i),this.add(this.lightPlane),(n=new qr).addAttribute("position",new zr([0,0,0,0,0,1],3)),this.targetLine=new Ia(n,i),this.add(this.targetLine),this.update()}function zu(e){var t=new qr,r=new La({color:16777215,vertexColors:m}),n=[],i=[],a={},o=new Sr(16755200),s=new Sr(16711680),l=new Sr(43775),u=new Sr(16777215),c=new Sr(3355443);function h(e,t,r){d(e,r),d(t,r)}function d(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),t.addAttribute("position",new zr(n,3)),t.addAttribute("color",new zr(i,3)),Oa.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function ju(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new qr;i.setIndex(new Ir(r,1)),i.addAttribute("position",new Ir(n,3)),Oa.call(this,i,new La({color:t})),this.matrixAutoUpdate=!1,this.update()}function Vu(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new qr;n.setIndex(new Ir(r,1)),n.addAttribute("position",new zr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Oa.call(this,n,new La({color:t})),this.geometry.computeBoundingSphere()}function Gu(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new qr;i.addAttribute("position",new zr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Ia.call(this,i,new La({color:n}));var a=new qr;a.addAttribute("position",new zr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Zr(a,new Lr({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Wu(e,t,r,n,i,a){mr.call(this),void 0===e&&(e=new Rt(0,0,1)),void 0===t&&(t=new Rt(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===a&&(a=.2*i),void 0===Bl&&((Bl=new qr).addAttribute("position",new zr([0,0,0,0,1,0],3)),(zl=new Jo(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ia(Bl,new La({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Zr(zl,new Lr({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,a)}function Xu(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new qr;r.addAttribute("position",new zr(t,3)),r.addAttribute("color",new zr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new La({vertexColors:v});Oa.call(this,r,n)}function Yu(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ys.call(this,e),this.type="catmullrom",this.closed=!0}function qu(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ys.call(this,e),this.type="catmullrom"}function Zu(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ys.call(this,e),this.type="catmullrom"}Object.assign(ru.prototype,{load:function(e,t,r,n){var i=new Ls(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,function(e){var r=e.slice(0),n=tu.getContext();n.decodeAudioData(r,function(e){t(e)})},r,n)},setPath:function(e){return this.path=e,this}}),Object.assign(nu.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScale(a[1],.488603*n),t.addScale(a[2],.488603*i),t.addScale(a[3],.488603*r),t.addScale(a[4],r*n*1.092548),t.addScale(a[5],n*i*1.092548),t.addScale(a[6],.315392*(3*i*i-1)),t.addScale(a[7],r*i*1.092548),t.addScale(a[8],.546274*(r*r-n*n)),t},getIrradianceAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScale(a[1],1.023328*n),t.addScale(a[2],1.023328*i),t.addScale(a[3],1.023328*r),t.addScale(a[4],.858086*r*n),t.addScale(a[5],.858086*n*i),t.addScale(a[6],.743125*i*i-.247708),t.addScale(a[7],.858086*r*i),t.addScale(a[8],.429043*(r*r-n*n)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e){for(var t=this.coefficients,r=0;r<9;r++)t[r].fromArray(e,3*r);return this},toArray:function(){for(var e=[],t=this.coefficients,r=0;r<9;r++)t[r].toArray(e,3*r);return e}}),Object.assign(nu,{getBasisAt:function(e,t){var r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}),iu.prototype=Object.assign(Object.create(ll.prototype),{constructor:iu,isLightProbe:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){var t=ll.prototype.toJSON.call(this,e);return t}}),au.prototype=Object.assign(Object.create(iu.prototype),{constructor:au,isHemisphereLightProbe:!0,copy:function(e){return iu.prototype.copy.call(this,e),this},toJSON:function(e){var t=iu.prototype.toJSON.call(this,e);return t}}),ou.prototype=Object.assign(Object.create(iu.prototype),{constructor:ou,isAmbientLightProbe:!0,copy:function(e){return iu.prototype.copy.call(this,e),this},toJSON:function(e){var t=iu.prototype.toJSON.call(this,e);return t}}),Object.assign(su.prototype,{update:function(){var e,t,r,n,i,a,o,s,l=new Wt,u=new Wt;return function(c){var h=e!==this||t!==c.focus||r!==c.fov||n!==c.aspect*this.aspect||i!==c.near||a!==c.far||o!==c.zoom||s!==this.eyeSep;if(h){e=this,t=c.focus,r=c.fov,n=c.aspect*this.aspect,i=c.near,a=c.far,o=c.zoom;var d,f,p=c.projectionMatrix.clone(),m=(s=this.eyeSep/2)*i/t,v=i*Math.tan(Tt.DEG2RAD*r*.5)/o;u.elements[12]=-s,l.elements[12]=s,d=-v*n+m,f=v*n+m,p.elements[0]=2*i/(f-d),p.elements[8]=(f+d)/(f-d),this.cameraL.projectionMatrix.copy(p),d=-v*n-m,f=v*n-m,p.elements[0]=2*i/(f-d),p.elements[8]=(f+d)/(f-d),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(l)}}()}),Object.assign(lu.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),uu.prototype=Object.assign(Object.create(mr.prototype),{constructor:uu,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new Rt,t=new Mt,r=new Rt,n=new Rt,i=new lu;return function(a){mr.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;if(this.timeDelta=i.getDelta(),this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),o.positionX){var l=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(e.x,l),o.positionY.linearRampToValueAtTime(e.y,l),o.positionZ.linearRampToValueAtTime(e.z,l),o.forwardX.linearRampToValueAtTime(n.x,l),o.forwardY.linearRampToValueAtTime(n.y,l),o.forwardZ.linearRampToValueAtTime(n.z,l),o.upX.linearRampToValueAtTime(s.x,l),o.upY.linearRampToValueAtTime(s.y,l),o.upZ.linearRampToValueAtTime(s.z,l)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z)}}()}),cu.prototype=Object.assign(Object.create(mr.prototype),{constructor:cu,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),hu.prototype=Object.assign(Object.create(cu.prototype),{constructor:hu,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var e=new Rt,t=new Mt,r=new Rt,n=new Rt;return function(i){if(mr.prototype.updateMatrixWorld.call(this,i),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(e,t,r),n.set(0,0,1).applyQuaternion(t);var a=this.panner;if(a.positionX){var o=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(e.x,o),a.positionY.linearRampToValueAtTime(e.y,o),a.positionZ.linearRampToValueAtTime(e.z,o),a.orientationX.linearRampToValueAtTime(n.x,o),a.orientationY.linearRampToValueAtTime(n.y,o),a.orientationZ.linearRampToValueAtTime(n.z,o)}else a.setPosition(e.x,e.y,e.z),a.setOrientation(n.x,n.y,n.z)}}}()}),Object.assign(du.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(fu.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==n;++o)r[i+o]=r[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*t;this._mixBufferRegion(r,n,o,1-i,t)}for(var s=t,l=t+t;s!==l;++s)if(r[s]!==r[s+t]){a.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,a=n;i!==a;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(n>=.5)for(var a=0;a!==i;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,n){Mt.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var a=1-n,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*n}}}),Object.assign(pu.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(mu,{Composite:pu,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new mu.Composite(e,t,r):new mu(e,t,r)},sanitizeNodeName:(eu=new RegExp("[\\[\\]\\.:\\/]","g"),function(e){return e.replace(/\s/g,"_").replace(eu,"")}),parseTrackName:(Xl="[^\\[\\]\\.:\\/]",Yl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",ql=/((?:WC+[\/:])*)/.source.replace("WC",Xl),Zl=/(WCOD+)?/.source.replace("WCOD",Yl),Jl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Xl),Kl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Xl),Ql=new RegExp("^"+ql+Zl+Jl+Kl+"$"),$l=["material","materials","bones"],function(e){var t=Ql.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==$l.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var a=n(i.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(mu.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=mu.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[n];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(mu.prototype,{_getValue_unbound:mu.prototype.getValue,_setValue_unbound:mu.prototype.setValue}),Object.assign(vu.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,f=n[d];if(void 0===f){f=t++,n[d]=f,e.push(h);for(var p=0,m=s;p!==m;++p)o[p].push(new mu(h,i[p],a[p]))}else if(f<r){l=e[f];var v=--r,g=e[v];n[g.uuid]=f,e[f]=g,n[d]=v,e[v]=h;for(var p=0,m=s;p!==m;++p){var y=o[p],_=y[v],b=y[f];y[f]=_,void 0===b&&(b=new mu(h,i[p],a[p])),y[v]=b}}else e[f]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=r[l];if(void 0!==u&&u>=t){var c=t++,h=e[c];r[h.uuid]=u,e[u]=h,r[l]=c,e[c]=s;for(var d=0,f=i;d!==f;++d){var p=n[d],m=p[c],v=p[u];p[u]=m,p[c]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o],u=l.uuid,c=n[u];if(void 0!==c)if(delete n[u],c<r){var h=--r,d=e[h],f=--t,p=e[f];n[d.uuid]=c,e[c]=d,n[p.uuid]=h,e[h]=p,e.pop();for(var m=0,v=a;m!==v;++m){var g=i[m],y=g[h],_=g[f];g[c]=y,g[h]=_,g.pop()}}else{var f=--t,p=e[f];n[p.uuid]=c,e[c]=p,e.pop();for(var m=0,v=a;m!==v;++m){var g=i[m];g[c]=g[f],g.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);n=i.length,r[e]=n,a.push(e),o.push(t),i.push(c);for(var h=u,d=s.length;h!==d;++h){var f=s[h];c[h]=new mu(f,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],l=e[o];t[l]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}),Object.assign(gu.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,a=i/n,o=n/i;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+r,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*r;if(a<0||0===r)return;this._startTime=null,t=r*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,i=this._loopCount,a=2202===n;if(0===e)return-1===i?t:a&&1==(1&i)?r-t:t;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=r||t<0){var o=Math.floor(t/r);t-=r*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=t;if(a&&1==(1&i))return r-t}return t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:ut:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:ut:2402)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=r,this}}),yu.prototype=Object.assign(Object.create(t.prototype),{constructor:yu,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,a=e._propertyBindings,o=e._interpolants,s=r.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==i;++c){var h=n[c],d=h.name,f=u[d];if(void 0!==f)a[c]=f;else{if(void 0!==(f=a[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new fu(mu.create(r,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),a[c]=f}o[c].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null;var c=o.actionByRoot,h=(e._localRoot||this._root).uuid;delete c[h],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],a=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[n]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new vs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Ms.findByName(r,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[n];if(void 0!==l)return l;s=o.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new gu(this,i,t);return this._bindAction(u,s),this._addInactiveAction(u,a,n),u},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Ms.findByName(r,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(var i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o){var s=t[o];s._update(n,e,i,a)}for(var l=this._bindings,u=this._nActiveBindings,o=0;o!==u;++o)l[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot,a=i[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var o=this._bindingsByRootAndName,s=o[t];if(void 0!==s)for(var l in s){var u=s[l];u.restoreOriginalState(),this._removeInactiveBinding(u)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),_u.prototype.clone=function(){return new _u(void 0===this.value.clone?this.value:this.value.clone())},bu.prototype=Object.assign(Object.create(Ta.prototype),{constructor:bu,isInstancedInterleavedBuffer:!0,copy:function(e){return Ta.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Eu.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this._camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this._camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return xu(e,this,n,t),n.sort(wu),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,a=e.length;i<a;i++)xu(e[i],this,n,t);return n.sort(wu),n}}),Object.assign(Tu.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Tt.clamp(t/this.radius,-1,1))),this}}),Object.assign(Su.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}}),Object.assign(Mu.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new St;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new St),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new St),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new St),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new St),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new St;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Ru.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Rt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Rt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Rt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(Gl=new Rt,Wl=new Rt,function(e,t){Gl.subVectors(e,this.start),Wl.subVectors(this.end,this.start);var r=Wl.dot(Wl),n=Wl.dot(Gl),i=n/r;return t&&(i=Tt.clamp(i,0,1)),i}),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Rt),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Au.prototype=Object.create(mr.prototype),Au.prototype.constructor=Au,Au.prototype.isImmediateRenderObject=!0,ku.prototype=Object.create(Oa.prototype),ku.prototype.constructor=ku,ku.prototype.update=function(){var e=new Rt,t=new Rt,r=new At;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,l=o.faces,u=0,c=0,h=l.length;c<h;c++)for(var d=l[c],f=0,p=d.vertexNormals.length;f<p;f++){var m=s[d[n[f]]],v=d.vertexNormals[f];e.copy(m).applyMatrix4(i),t.copy(v).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(u,e.x,e.y,e.z),u+=1,a.setXYZ(u,t.x,t.y,t.z),u+=1}else if(o&&o.isBufferGeometry)for(var g=o.attributes.position,y=o.attributes.normal,u=0,f=0,p=g.count;f<p;f++)e.set(g.getX(f),g.getY(f),g.getZ(f)).applyMatrix4(i),t.set(y.getX(f),y.getY(f),y.getZ(f)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(u,e.x,e.y,e.z),u+=1,a.setXYZ(u,t.x,t.y,t.z),u+=1;a.needsUpdate=!0}}(),Pu.prototype=Object.create(mr.prototype),Pu.prototype.constructor=Pu,Pu.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Pu.prototype.update=function(){var e=new Rt;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,r=t*Math.tan(this.light.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),Cu.prototype=Object.create(Oa.prototype),Cu.prototype.constructor=Cu,Cu.prototype.updateMatrixWorld=function(){var e=new Rt,t=new Wt,r=new Wt;return function(n){var i=this.bones,a=this.geometry,o=a.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<i.length;s++){var u=i[s];u.parent&&u.parent.isBone&&(t.multiplyMatrices(r,u.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(r,u.parent.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l+1,e.x,e.y,e.z),l+=2)}a.getAttribute("position").needsUpdate=!0,mr.prototype.updateMatrixWorld.call(this,n)}}(),Lu.prototype=Object.create(Zr.prototype),Lu.prototype.constructor=Lu,Lu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Lu.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},Iu.prototype=Object.create(Ia.prototype),Iu.prototype.constructor=Iu,Iu.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},Iu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ou.prototype=Object.create(mr.prototype),Ou.prototype.constructor=Ou,Ou.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ou.prototype.update=function(){var e=new Rt,t=new Sr,r=new Sr;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var a=0,o=i.count;a<o;a++){var s=a<o/2?t:r;i.setXYZ(a,s.r,s.g,s.b)}i.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Hu.prototype=Object.create(Zr.prototype),Hu.prototype.constructor=Hu,Hu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Hu.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Du.prototype=Object.assign(Object.create(Oa.prototype),{constructor:Du,copy:function(e){return Oa.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Nu.prototype=Object.create(Oa.prototype),Nu.prototype.constructor=Nu,Fu.prototype=Object.create(Ia.prototype),Fu.prototype.constructor=Fu,Fu.prototype.update=function(){var e,t,r=this.audio,n=this.range,i=this.divisionsInnerAngle,a=this.divisionsOuterAngle,o=Tt.degToRad(r.panner.coneInnerAngle),s=Tt.degToRad(r.panner.coneOuterAngle),l=o/2,u=s/2,c=0,h=0,d=this.geometry,f=d.attributes.position;function p(r,i,a,o){var s=(i-r)/a;for(f.setXYZ(c,0,0,0),h++,e=r;e<i;e+=s)t=c+h,f.setXYZ(t,Math.sin(e)*n,0,Math.cos(e)*n),f.setXYZ(t+1,Math.sin(Math.min(e+s,i))*n,0,Math.cos(Math.min(e+s,i))*n),f.setXYZ(t+2,0,0,0),h+=3;d.addGroup(c,h,o),c+=h,h=0}d.clearGroups(),p(-u,-l,a,0),p(-l,l,i,1),p(l,u,a,0),f.needsUpdate=!0,o===s&&(this.material[0].visible=!1)},Fu.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},Uu.prototype=Object.create(Oa.prototype),Uu.prototype.constructor=Uu,Uu.prototype.update=function(){var e=new Rt,t=new Rt,r=new At;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,l=0,u=0,c=s.length;u<c;u++){var h=s[u],d=h.normal;e.copy(o[h.a]).add(o[h.b]).add(o[h.c]).divideScalar(3).applyMatrix4(n),t.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),i.setXYZ(l,e.x,e.y,e.z),l+=1,i.setXYZ(l,t.x,t.y,t.z),l+=1}i.needsUpdate=!0}}(),Bu.prototype=Object.create(mr.prototype),Bu.prototype.constructor=Bu,Bu.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Bu.prototype.update=function(){var e=new Rt,t=new Rt,r=new Rt;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=r.length()}}(),zu.prototype=Object.create(Oa.prototype),zu.prototype.constructor=zu,zu.prototype.update=function(){var e,t,r=new Rt,n=new sn;function i(i,a,o,s){r.set(a,o,s).unproject(n);var l=t[i];if(void 0!==l)for(var u=e.getAttribute("position"),c=0,h=l.length;c<h;c++)u.setXYZ(l[c],r.x,r.y,r.z)}return function(){e=this.geometry,t=this.pointMap,n.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),ju.prototype=Object.create(Oa.prototype),ju.prototype.constructor=ju,ju.prototype.update=function(){var e=new gr;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,n=e.max,i=this.geometry.attributes.position,a=i.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=r.x,a[4]=n.y,a[5]=n.z,a[6]=r.x,a[7]=r.y,a[8]=n.z,a[9]=n.x,a[10]=r.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=r.z,a[15]=r.x,a[16]=n.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=n.x,a[22]=r.y,a[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),ju.prototype.setFromObject=function(e){return this.object=e,this.update(),this},ju.prototype.copy=function(e){return Oa.prototype.copy.call(this,e),this.object=e.object,this},ju.prototype.clone=function(){return(new this.constructor).copy(this)},Vu.prototype=Object.create(Oa.prototype),Vu.prototype.constructor=Vu,Vu.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),mr.prototype.updateMatrixWorld.call(this,e))},Gu.prototype=Object.create(Ia.prototype),Gu.prototype.constructor=Gu,Gu.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?d:h,this.lookAt(this.plane.normal),mr.prototype.updateMatrixWorld.call(this,e)},Wu.prototype=Object.create(mr.prototype),Wu.prototype.constructor=Wu,Wu.prototype.setDirection=(Vl=new Rt,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Vl.set(e.z,0,-e.x).normalize(),jl=Math.acos(e.y),this.quaternion.setFromAxisAngle(Vl,jl))}),Wu.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Wu.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Wu.prototype.copy=function(e){return mr.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Wu.prototype.clone=function(){return(new this.constructor).copy(this)},Xu.prototype=Object.create(Oa.prototype),Xu.prototype.constructor=Xu,Us.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Us.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(al.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Kr,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new Rt(i.x,i.y,i.z||0))}return t}}),Object.assign(ol.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Yu.prototype=Object.create(Ys.prototype),qu.prototype=Object.create(Ys.prototype),Zu.prototype=Object.create(Ys.prototype),Object.assign(Zu.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Du.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Cu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ul.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),bl.extractUrlBase(e)}}),Object.assign(Sl.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Mu.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(gr.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Ru.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Tt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Tt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Tt.ceilPowerOfTwo(e)}}),Object.assign(At.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Wt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new Rt),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,a)}}),vn.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Mt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(_r.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(br.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(br,{barycoordFromPoint:function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),br.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),br.getNormal(e,t,r,n)}}),Object.assign(sl.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Io(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Wo(this,e)}}),Object.assign(St.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Rt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(jt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Kr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(mr.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(mr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Aa.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Pa.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ka.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Us.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),ln.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ll.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ir.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(qr.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(qr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Oo.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(_u.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Cr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Sr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(os.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(on.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ea.prototype,{clearTarget:function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")}}),Object.defineProperties(Ea.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ia.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(pn.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(Vt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(_a.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),cu.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,r=new ru;return r.load(e,function(e){t.setBuffer(e)}),this},du.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},fn.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Ju={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Ut.crossOrigin=void 0,Ut.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Fs;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},Ut.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Ns;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},Ut.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ut.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Ku={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.ACESFilmicToneMapping=te,e.AddEquation=x,e.AddOperation=Z,e.AdditiveBlending=_,e.AlphaFormat=Pe,e.AlwaysDepth=B,e.AmbientLight=gl,e.AmbientLightProbe=ou,e.AnimationClip=Ms,e.AnimationLoader=Is,e.AnimationMixer=yu,e.AnimationObjectGroup=vu,e.AnimationUtils=fs,e.ArcCurve=zs,e.ArrayCamera=ua,e.ArrowHelper=Wu,e.Audio=cu,e.AudioAnalyser=du,e.AudioContext=tu,e.AudioListener=uu,e.AudioLoader=ru,e.AxesHelper=Xu,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Xu(e)},e.BackSide=d,e.BasicDepthPacking=bt,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Hs(e)},e.Bone=Ca,e.BooleanKeyframeTrack=_s,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ju(e,t)},e.Box2=Mu,e.Box3=gr,e.Box3Helper=Vu,e.BoxBufferGeometry=$r,e.BoxGeometry=Qr,e.BoxHelper=ju,e.BufferAttribute=Ir,e.BufferGeometry=qr,e.BufferGeometryLoader=xl,e.ByteType=_e,e.Cache=As,e.Camera=sn,e.CameraHelper=zu,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=Ba,e.CatmullRomCurve3=Ys,e.CineonToneMapping=ee,e.CircleBufferGeometry=es,e.CircleGeometry=$o,e.ClampToEdgeWrapping=ce,e.Clock=lu,e.ClosedSplineCurve3=Yu,e.Color=Sr,e.ColorKeyframeTrack=bs,e.CompressedTexture=Ua,e.CompressedTextureLoader=Os,e.ConeBufferGeometry=Qo,e.ConeGeometry=Ko,e.CubeCamera=fn,e.CubeGeometry=Qr,e.CubeReflectionMapping=re,e.CubeRefractionMapping=ne,e.CubeTexture=Dn,e.CubeTextureLoader=Ns,e.CubeUVReflectionMapping=se,e.CubeUVRefractionMapping=le,e.CubicBezierCurve=Ks,e.CubicBezierCurve3=Qs,e.CubicInterpolant=ms,e.CullFaceBack=s,e.CullFaceFront=l,e.CullFaceFrontBack=3,e.CullFaceNone=o,e.Curve=Us,e.CurvePath=al,e.CustomBlending=w,e.CylinderBufferGeometry=Jo,e.CylinderGeometry=Zo,e.Cylindrical=Su,e.DataTexture=mn,e.DataTexture2DArray=Nn,e.DataTexture3D=Fn,e.DataTextureLoader=Hs,e.DefaultLoadingManager=Ps,e.DepthFormat=De,e.DepthStencilFormat=Ne,e.DepthTexture=za,e.DirectionalLight=vl,e.DirectionalLightHelper=Bu,e.DirectionalLightShadow=ml,e.DiscreteInterpolant=gs,e.DodecahedronBufferGeometry=eo,e.DodecahedronGeometry=$a,e.DoubleSide=f,e.DstAlphaFactor=O,e.DstColorFactor=D,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new Ir(e,t).setDynamic(!0)},e.EdgesGeometry=qo,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Oa(new qo(e.geometry),new La({color:void 0!==t?t:16777215}))},e.EllipseCurve=Bs,e.EqualDepth=V,e.EquirectangularReflectionMapping=ie,e.EquirectangularRefractionMapping=ae,e.Euler=Xt,e.EventDispatcher=t,e.ExtrudeBufferGeometry=Oo,e.ExtrudeGeometry=Io,e.Face3=kr,e.Face4=function(e,t,r,n,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new kr(e,t,r,i,a,o)},e.FaceColors=m,e.FaceNormalsHelper=Uu,e.FileLoader=Ls,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new zr(e,t)},e.Float32BufferAttribute=zr,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new jr(e,t)},e.Float64BufferAttribute=jr,e.FloatType=Te,e.Fog=xa,e.FogExp2=wa,e.Font=Dl,e.FontLoader=Fl,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=h,e.Frustum=gn,e.GammaEncoding=mt,e.Geometry=Kr,e.GeometryUtils=Ju,e.GreaterDepth=W,e.GreaterEqualDepth=G,e.GridHelper=Du,e.Group=la,e.HalfFloatType=Se,e.HemisphereLight=ul,e.HemisphereLightHelper=Ou,e.HemisphereLightProbe=au,e.IcosahedronBufferGeometry=Qa,e.IcosahedronGeometry=Ka,e.ImageBitmapLoader=Ol,e.ImageLoader=Ds,e.ImageUtils=Ut,e.ImmediateRenderObject=Au,e.InstancedBufferAttribute=wl,e.InstancedBufferGeometry=El,e.InstancedInterleavedBuffer=bu,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Nr(e,t)},e.Int16BufferAttribute=Nr,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ur(e,t)},e.Int32BufferAttribute=Ur,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Or(e,t)},e.Int8BufferAttribute=Or,e.IntType=we,e.InterleavedBuffer=Ta,e.InterleavedBufferAttribute=Sa,e.Interpolant=ps,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeyframeTrack=ys,e.LOD=Aa,e.LatheBufferGeometry=Go,e.LatheGeometry=Vo,e.Layers=Yt,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},e.LessDepth=z,e.LessEqualDepth=j,e.Light=ll,e.LightProbe=iu,e.LightProbeHelper=Hu,e.LightShadow=cl,e.Line=Ia,e.Line3=Ru,e.LineBasicMaterial=La,e.LineCurve=$s,e.LineCurve3=el,e.LineDashedMaterial=hs,e.LineLoop=Ha,e.LinePieces=1,e.LineSegments=Oa,e.LineStrip=0,e.LinearEncoding=ft,e.LinearFilter=me,e.LinearInterpolant=vs,e.LinearMipMapLinearFilter=ge,e.LinearMipMapNearestFilter=ve,e.LinearToneMapping=K,e.Loader=Ul,e.LoaderUtils=bl,e.LoadingManager=ks,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=lt,e.LuminanceAlphaFormat=Oe,e.LuminanceFormat=Ie,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.Material=Cr,e.MaterialLoader=_l,e.Math=Tt,e.Matrix3=At,e.Matrix4=Wt,e.MaxEquation=R,e.Mesh=Zr,e.MeshBasicMaterial=Lr,e.MeshDepthMaterial=ra,e.MeshDistanceMaterial=na,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=us,e.MeshMatcapMaterial=cs,e.MeshNormalMaterial=ls,e.MeshPhongMaterial=os,e.MeshPhysicalMaterial=as,e.MeshStandardMaterial=is,e.MeshToonMaterial=ss,e.MinEquation=M,e.MirroredRepeatWrapping=he,e.MixOperation=q,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=E,e.MultiplyOperation=Y,e.NearestFilter=de,e.NearestMipMapLinearFilter=pe,e.NearestMipMapNearestFilter=fe,e.NeverDepth=U,e.NoBlending=g,e.NoColors=p,e.NoToneMapping=J,e.NormalBlending=y,e.NotEqualDepth=X,e.NumberKeyframeTrack=Es,e.Object3D=mr,e.ObjectLoader=Sl,e.ObjectSpaceNormalMap=xt,e.OctahedronBufferGeometry=Ja,e.OctahedronGeometry=Za,e.OneFactor=k,e.OneMinusDstAlphaFactor=H,e.OneMinusDstColorFactor=N,e.OneMinusSrcAlphaFactor=I,e.OneMinusSrcColorFactor=C,e.OrthographicCamera=pl,e.PCFShadowMap=u,e.PCFSoftShadowMap=c,e.ParametricBufferGeometry=Ga,e.ParametricGeometry=Va,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ra(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Da(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Na(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Da(e)},e.Path=ol,e.PerspectiveCamera=ln,e.Plane=vn,e.PlaneBufferGeometry=Tn,e.PlaneGeometry=xn,e.PlaneHelper=Gu,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Na(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Da(e)},e.PointLight=fl,e.PointLightHelper=Lu,e.Points=Na,e.PointsMaterial=Da,e.PolarGridHelper=Nu,e.PolyhedronBufferGeometry=Xa,e.PolyhedronGeometry=Wa,e.PositionalAudio=hu,e.PositionalAudioHelper=Fu,e.PropertyBinding=mu,e.PropertyMixer=fu,e.QuadraticBezierCurve=tl,e.QuadraticBezierCurve3=rl,e.Quaternion=Mt,e.QuaternionKeyframeTrack=xs,e.QuaternionLinearInterpolant=ws,e.REVISION=a,e.RGBADepthPacking=Et,e.RGBAFormat=Le,e.RGBA_ASTC_10x10_Format=at,e.RGBA_ASTC_10x5_Format=rt,e.RGBA_ASTC_10x6_Format=nt,e.RGBA_ASTC_10x8_Format=it,e.RGBA_ASTC_12x10_Format=ot,e.RGBA_ASTC_12x12_Format=st,e.RGBA_ASTC_4x4_Format=qe,e.RGBA_ASTC_5x4_Format=Ze,e.RGBA_ASTC_5x5_Format=Je,e.RGBA_ASTC_6x5_Format=Ke,e.RGBA_ASTC_6x6_Format=Qe,e.RGBA_ASTC_8x5_Format=$e,e.RGBA_ASTC_8x6_Format=et,e.RGBA_ASTC_8x8_Format=tt,e.RGBA_PVRTC_2BPPV1_Format=Xe,e.RGBA_PVRTC_4BPPV1_Format=We,e.RGBA_S3TC_DXT1_Format=Be,e.RGBA_S3TC_DXT3_Format=ze,e.RGBA_S3TC_DXT5_Format=je,e.RGBDEncoding=_t,e.RGBEEncoding=vt,e.RGBEFormat=He,e.RGBFormat=Ce,e.RGBM16Encoding=yt,e.RGBM7Encoding=gt,e.RGB_ETC1_Format=Ye,e.RGB_PVRTC_2BPPV1_Format=Ge,e.RGB_PVRTC_4BPPV1_Format=Ve,e.RGB_S3TC_DXT1_Format=Ue,e.RawShaderMaterial=ns,e.Ray=_r,e.Raycaster=Eu,e.RectAreaLight=yl,e.RectAreaLightHelper=Iu,e.RedFormat=Fe,e.ReinhardToneMapping=Q,e.RepeatWrapping=ue,e.ReverseSubtractEquation=S,e.RingBufferGeometry=jo,e.RingGeometry=zo,e.Scene=vr,e.SceneUtils=Ku,e.ShaderChunk=yn,e.ShaderLib=bn,e.ShaderMaterial=on,e.ShadowMaterial=rs,e.Shape=sl,e.ShapeBufferGeometry=Xo,e.ShapeGeometry=Wo,e.ShapePath=Hl,e.ShapeUtils=Po,e.ShortType=be,e.Skeleton=Pa,e.SkeletonHelper=Cu,e.SkinnedMesh=ka,e.SmoothShading=2,e.Sphere=yr,e.SphereBufferGeometry=Bo,e.SphereGeometry=Uo,e.Spherical=Tu,e.SphericalHarmonics3=nu,e.SphericalReflectionMapping=oe,e.Spline=Zu,e.SplineCurve=nl,e.SplineCurve3=qu,e.SpotLight=dl,e.SpotLightHelper=Pu,e.SpotLightShadow=hl,e.Sprite=Ra,e.SpriteMaterial=Ma,e.SrcAlphaFactor=L,e.SrcAlphaSaturateFactor=F,e.SrcColorFactor=P,e.StereoCamera=su,e.StringKeyframeTrack=Ts,e.SubtractEquation=T,e.SubtractiveBlending=b,e.TangentSpaceNormalMap=wt,e.TetrahedronBufferGeometry=qa,e.TetrahedronGeometry=Ya,e.TextBufferGeometry=Fo,e.TextGeometry=No,e.Texture=zt,e.TextureLoader=Fs,e.TorusBufferGeometry=oo,e.TorusGeometry=ao,e.TorusKnotBufferGeometry=io,e.TorusKnotGeometry=no,e.Triangle=br,e.TriangleFanDrawMode=dt,e.TriangleStripDrawMode=ht,e.TrianglesDrawMode=ct,e.TubeBufferGeometry=ro,e.TubeGeometry=to,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Fr(e,t)},e.Uint16BufferAttribute=Fr,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Br(e,t)},e.Uint32BufferAttribute=Br,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Hr(e,t)},e.Uint8BufferAttribute=Hr,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Dr(e,t)},e.Uint8ClampedBufferAttribute=Dr,e.Uncharted2ToneMapping=$,e.Uniform=_u,e.UniformsLib=_n,e.UniformsUtils=rn,e.UnsignedByteType=ye,e.UnsignedInt248Type=ke,e.UnsignedIntType=xe,e.UnsignedShort4444Type=Me,e.UnsignedShort5551Type=Re,e.UnsignedShort565Type=Ae,e.UnsignedShortType=Ee,e.Vector2=St,e.Vector3=Rt,e.Vector4=jt,e.VectorKeyframeTrack=Ss,e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Rt(e,t,r)},e.VertexColors=v,e.VertexNormalsHelper=ku,e.VideoTexture=Fa,e.WebGLMultisampleRenderTarget=Gt,e.WebGLRenderTarget=Vt,e.WebGLRenderTargetCube=pn,e.WebGLRenderer=Ea,e.WebGLUtils=sa,e.WireframeGeometry=ja,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Oa(new ja(e.geometry),new La({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Ls(e)},e.ZeroCurvatureEnding=ut,e.ZeroFactor=A,e.ZeroSlopeEnding=2401,e.sRGBEncoding=pt,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t,r){
/*! chevrotain - v4.6.0 */
"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=18)}([function(e,t,r){"use strict";function n(e){return e&&0===e.length}function i(e){return null==e?[]:Object.keys(e)}function a(e){for(var t=[],r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}function o(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.call(null,e[r],r);else{if(!v(e))throw Error("non exhaustive match");var n=i(e);for(r=0;r<n.length;r++){var a=n[r],o=e[a];t.call(null,o,a)}}}function s(e){return void 0===e}function l(e,t){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r}function u(e,t){return l(e,function(e){return!t(e)})}function c(e,t){return!!v(e)&&e.hasOwnProperty(t)}function h(e,t){return void 0!==p(e,function(e){return e===t})}function d(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}function f(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function p(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(t.call(null,n))return n}}function m(e,t,r){for(var n=Array.isArray(e),o=n?e:a(e),s=n?[]:i(e),l=r,u=0;u<o.length;u++)l=t.call(null,l,o[u],n?u:s[u]);return l}function v(e){return e instanceof Object}function g(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++){var a=t[n];if(!s(a))for(var o=i(a),l=0;l<o.length;l++){var u=o[l];c(e,u)||(e[u]=a[u])}}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.isEmpty=n,t.keys=i,t.values=a,t.mapValues=function(e,t){for(var r=[],n=i(e),a=0;a<n.length;a++){var o=n[a];r.push(t.call(null,e[o],o))}return r},t.map=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t.call(null,e[n],n));return r},t.flatten=function e(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];Array.isArray(i)?r=r.concat(e(i)):r.push(i)}return r},t.first=function(e){return n(e)?void 0:e[0]},t.last=function(e){var t=e&&e.length;return t?e[t-1]:void 0},t.forEach=o,t.isString=function(e){return"string"==typeof e},t.isUndefined=s,t.isFunction=function(e){return e instanceof Function},t.drop=function(e,t){return void 0===t&&(t=1),e.slice(t,e.length)},t.dropRight=function(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)},t.filter=l,t.reject=u,t.pick=function(e,t){for(var r=Object.keys(e),n={},i=0;i<r.length;i++){var a=r[i],o=e[a];t(o)&&(n[a]=o)}return n},t.has=c,t.contains=h,t.cloneArr=d,t.cloneObj=f,t.find=p,t.findAll=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r},t.reduce=m,t.compact=function(e){return u(e,function(e){return null==e})},t.uniq=function(e,t){void 0===t&&(t=function(e){return e});var r=[];return m(e,function(e,n){var i=t(n);return h(r,i)?e:(r.push(i),e.concat(n))},[])},t.partial=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=[null].concat(t);return Function.bind.apply(e,n)},t.isArray=function(e){return Array.isArray(e)},t.isRegExp=function(e){return e instanceof RegExp},t.isObject=v,t.every=function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r))return!1;return!0},t.difference=function(e,t){return u(e,function(e){return h(t,e)})},t.some=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1},t.indexOf=function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1},t.sortBy=function(e,t){var r=d(e);return r.sort(function(e,r){return t(e)-t(r)}),r},t.zipObject=function(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var r={},n=0;n<e.length;n++)r[e[n]]=t[n];return r},t.assign=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var a=t[n],o=i(a),s=0;s<o.length;s++){var l=o[s];e[l]=a[l]}return e},t.assignNoOverwrite=g,t.defaults=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g.apply(null,[{}].concat(e))},t.groupBy=function(e,t){var r={};return o(e,function(e){var n=t(e),i=r[n];i?i.push(e):r[n]=[e]}),r},t.merge=function(e,t){for(var r=f(e),n=i(t),a=0;a<n.length;a++){var o=n[a],s=t[o];r[o]=s}return r},t.NOOP=function(){},t.IDENTITY=function(e){return e},t.packArray=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(void 0!==n?n:void 0)}return t},t.PRINT_ERROR=function(e){console&&console.error&&console.error("Error: "+e)},t.PRINT_WARNING=function(e){console&&console.warn&&console.warn("Warning: "+e)},t.isES2015MapSupported=function(){return"function"==typeof Map},t.applyMixins=function(e,t){t.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if("constructor"!==n){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(e.prototype,n,i):e.prototype[n]=t.prototype[n]}})})},t.toFastProperties=function(e){function t(){}t.prototype=e;var r=new t;function n(){return typeof r.bar}return n(),n(),e}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(2),s=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),a.forEach(this.definition,function(t){t.accept(e)})},e}();t.AbstractProduction=s;var l=function(e){function t(t){var r=e.call(this,[])||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(s);t.NonTerminal=l;var u=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.orgText="",a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Rule=u;var c=function(e){function t(t){var r=e.call(this,t.definition)||this;return a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Flat=c;var h=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Option=h;var d=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionMandatory=d;var f=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionMandatoryWithSeparator=f;var p=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Repetition=p;var m=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionWithSeparator=m;var v=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Alternation=v;var g=function(){function e(e){this.idx=1,a.assign(this,a.pick(e,function(e){return void 0!==e}))}return e.prototype.accept=function(e){e.visit(this)},e}();function y(e){function t(e){return a.map(e,y)}if(e instanceof l)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof c)return{type:"Flat",definition:t(e.definition)};if(e instanceof h)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof d)return{type:"RepetitionMandatory",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof f)return{type:"RepetitionMandatoryWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof m)return{type:"RepetitionWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof p)return{type:"Repetition",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof v)return{type:"Alternation",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof g){var r={type:"Terminal",name:o.tokenName(e.terminalType),label:o.tokenLabel(e.terminalType),idx:e.idx},n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=a.isRegExp(n)?n.source:n),r}if(e instanceof u)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}t.Terminal=g,t.serializeGrammar=function(e){return a.map(e,y)},t.serializeProduction=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(15),o=r(7);function s(e){return n.isString(e.LABEL)&&""!==e.LABEL}function l(e){return n.isObject(e)&&e.hasOwnProperty("tokenName")&&n.isString(e.tokenName)?e.tokenName:i.functionName(e)}t.tokenLabel=function(e){return s(e)?e.LABEL:l(e)},t.hasTokenLabel=s,t.tokenName=l;var u="parent",c="categories",h="label",d="group",f="push_mode",p="pop_mode",m="longer_alt",v="line_breaks",g="start_chars_hint";function y(e){return function(e){var t=e.name,r=e.pattern,a={};if(i.defineNameProp(a,t)||(a.tokenName=t),n.isUndefined(r)||(a.PATTERN=r),n.has(e,u))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return n.has(e,c)&&(a.CATEGORIES=e[c]),o.augmentTokenTypes([a]),n.has(e,h)&&(a.LABEL=e[h]),n.has(e,d)&&(a.GROUP=e[d]),n.has(e,p)&&(a.POP_MODE=e[p]),n.has(e,f)&&(a.PUSH_MODE=e[f]),n.has(e,m)&&(a.LONGER_ALT=e[m]),n.has(e,v)&&(a.LINE_BREAKS=e[v]),n.has(e,g)&&(a.START_CHARS_HINT=e[g]),a}(e)}t.createToken=y,t.EOF=y({name:"EOF",pattern:a.Lexer.NA}),o.augmentTokenTypes([t.EOF]),t.createTokenInstance=function(e,t,r,n,i,a,o,s){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return o.tokenStructuredMatcher(e,t)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=r(0),s=r(26),l=r(2),u=r(23),c=r(16),h=r(10),d=r(24),f=r(25),p=r(31),m=r(32),v=r(34),g=r(35),y=r(36),_=r(37),b=r(38);t.END_OF_FILE=l.createTokenInstance(l.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:h.defaultParserErrorProvider,serializedGrammar:null}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",e[e.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={})),t.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var E=function(){function e(e,r){void 0===r&&(r=t.DEFAULT_PARSER_CONFIG),this.ignoredIssues=t.DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(r),this.initLexerAdapter(),this.initLooksAhead(r),this.initRecognizerEngine(e,r),this.initRecoverable(r),this.initTreeBuilder(r),this.initContentAssist(),this.ignoredIssues=o.has(r,"ignoredIssues")?r.ignoredIssues:t.DEFAULT_PARSER_CONFIG.ignoredIssues,o.toFastProperties(this)}return e.performSelfAnalysis=function(e){e.performSelfAnalysis()},e.prototype.performSelfAnalysis=function(){var t,r=this;this.selfAnalysisDone=!0;var n=a.classNameFromInstance(this),i=this.gastProductionsCache;if(this.serializedGrammar){var l=u.deserializeGrammar(this.serializedGrammar,this.tokensMap);o.forEach(l,function(e){r.gastProductionsCache.put(e.name,e)})}var f=d.resolveGrammar({rules:i.values()});if(this.definitionErrors.push.apply(this.definitionErrors,f),o.isEmpty(f)){var p=d.validateGrammar({rules:i.values(),maxLookahead:this.maxLookahead,tokenTypes:o.values(this.tokensMap),ignoredIssues:this.ignoredIssues,errMsgProvider:h.defaultGrammarValidatorErrorProvider,grammarName:n});this.definitionErrors.push.apply(this.definitionErrors,p)}if(o.isEmpty(this.definitionErrors)){var m=s.computeAllProdsFollows(i.values());this.resyncFollows=m}var v=c.analyzeCst(i.values(),this.fullRuleNameToShort);if(this.allRuleNames=v.allRuleNames,!e.DEFER_DEFINITION_ERRORS_HANDLING&&!o.isEmpty(this.definitionErrors))throw t=o.map(this.definitionErrors,function(e){return e.message}),new Error("Parser Definition Errors detected:\n "+t.join("\n-------------------------------\n"))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();t.Parser=E,o.applyMixins(E,[f.Recoverable,p.LooksAhead,m.TreeBuilder,v.LexerAdapter,y.RecognizerEngine,g.RecognizerApi,_.ErrorHandler,b.ContentAssist]);var w=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!0,e.call(this,r,i)||this}return i(r,e),r}(E);t.CstParser=w;var x=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!1,e.call(this,r,i)||this}return i(r,e),r}(E);t.EmbeddedActionsParser=x},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.classNameFromInstance=function(e){return o(e.constructor)};var i=/^\s*function\s*(\S*)\s*\(/,a="name";function o(e){var t=e.name;return t||e.toString().match(i)[1]}t.functionName=o,t.defineNameProp=function(e,t){var r=Object.getOwnPropertyDescriptor(e,a);return!(!n.isUndefined(r)&&!r.configurable||(Object.defineProperty(e,a,{enumerable:!1,configurable:!0,writable:!1,value:t}),0))};var s=function(){function e(){this._state={}}return e.prototype.keys=function(){return n.keys(this._state)},e.prototype.values=function(){return n.values(this._state)},e.prototype.put=function(e,t){this._state[e]=t},e.prototype.putAll=function(e){this._state=n.assign(this._state,e._state)},e.prototype.get=function(e){return this._state[e]},e.prototype.containsKey=function(e){return n.has(this._state,e)},e.prototype.clear=function(){this._state={}},e}();t.HashTable=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function e(){}return e.prototype.visit=function(e){if(e instanceof n.NonTerminal)return this.visitNonTerminal(e);if(e instanceof n.Flat)return this.visitFlat(e);if(e instanceof n.Option)return this.visitOption(e);if(e instanceof n.RepetitionMandatory)return this.visitRepetitionMandatory(e);if(e instanceof n.RepetitionMandatoryWithSeparator)return this.visitRepetitionMandatoryWithSeparator(e);if(e instanceof n.RepetitionWithSeparator)return this.visitRepetitionWithSeparator(e);if(e instanceof n.Repetition)return this.visitRepetition(e);if(e instanceof n.Alternation)return this.visitAlternation(e);if(e instanceof n.Terminal)return this.visitTerminal(e);if(e instanceof n.Rule)return this.visitRule(e);throw Error("non exhaustive match")},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();t.GAstVisitor=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i="MismatchedTokenException",a="NoViableAltException",o="EarlyExitException",s="NotAllInputParsedException",l=[i,a,o,s];function u(e,t,r){this.name=i,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function c(e,t,r){this.name=a,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function h(e,t){this.name=s,this.message=e,this.token=t,this.resyncedTokens=[]}function d(e,t,r){this.name=o,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}Object.freeze(l),t.isRecognitionException=function(e){return n.contains(l,e.name)},t.MismatchedTokenException=u,u.prototype=Error.prototype,t.NoViableAltException=c,c.prototype=Error.prototype,t.NotAllInputParsedException=h,h.prototype=Error.prototype,t.EarlyExitException=d,d.prototype=Error.prototype},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(2);function o(e){for(var t=n.cloneArr(e),r=e,i=!0;i;){r=n.compact(n.flatten(n.map(r,function(e){return e.CATEGORIES})));var a=n.difference(r,t);t=t.concat(a),n.isEmpty(a)?i=!1:r=a}return t}function s(e){n.forEach(e,function(e){h(e)||(t.tokenIdxToClass.put(t.tokenShortNameIdx,e),e.tokenTypeIdx=t.tokenShortNameIdx++),d(e)&&!n.isArray(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),d(e)||(e.CATEGORIES=[]),f(e)||(e.categoryMatches=[]),p(e)||(e.categoryMatchesMap={}),m(e)||(e.tokenName=a.tokenName(e))})}function l(e){n.forEach(e,function(e){e.categoryMatches=[],n.forEach(e.categoryMatchesMap,function(r,n){e.categoryMatches.push(t.tokenIdxToClass.get(n).tokenTypeIdx)})})}function u(e){n.forEach(e,function(e){c([],e)})}function c(e,t){n.forEach(e,function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0}),n.forEach(t.CATEGORIES,function(r){var i=e.concat(t);n.contains(i,r)||c(i,r)})}function h(e){return n.has(e,"tokenTypeIdx")}function d(e){return n.has(e,"CATEGORIES")}function f(e){return n.has(e,"categoryMatches")}function p(e){return n.has(e,"categoryMatchesMap")}function m(e){return n.has(e,"tokenName")}t.tokenStructuredMatcher=function(e,t){var r=e.tokenTypeIdx;return r===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[r]},t.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},t.tokenShortNameIdx=1,t.tokenIdxToClass=new i.HashTable,t.augmentTokenTypes=function(e){var t=o(e);s(t),u(t),l(t),n.forEach(t,function(e){e.isParent=e.categoryMatches.length>0})},t.expandCategories=o,t.assignTokenDefaultProps=s,t.assignCategoriesTokensProp=l,t.assignCategoriesMapProp=u,t.singleAssignCategoriesToksMap=c,t.hasShortKeyProperty=h,t.hasCategoriesProperty=d,t.hasExtendingTokensTypesProperty=f,t.hasExtendingTokensTypesMapProperty=p,t.hasTokenNameProperty=m,t.isTokenType=function(e){return n.has(e,"tokenTypeIdx")}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(1),s=r(5),l=r(2);t.isSequenceProd=function(e){return e instanceof o.Flat||e instanceof o.Option||e instanceof o.Repetition||e instanceof o.RepetitionMandatory||e instanceof o.RepetitionMandatoryWithSeparator||e instanceof o.RepetitionWithSeparator||e instanceof o.Terminal||e instanceof o.Rule},t.isOptionalProd=function e(t,r){return void 0===r&&(r=[]),!!(t instanceof o.Option||t instanceof o.Repetition||t instanceof o.RepetitionWithSeparator)||(t instanceof o.Alternation?a.some(t.definition,function(t){return e(t,r)}):!(t instanceof o.NonTerminal&&a.contains(r,t))&&t instanceof o.AbstractProduction&&(t instanceof o.NonTerminal&&r.push(t),a.every(t.definition,function(t){return e(t,r)})))},t.isBranchingProd=function(e){return e instanceof o.Alternation},t.getProductionDslName=function(e){if(e instanceof o.NonTerminal)return"SUBRULE";if(e instanceof o.Option)return"OPTION";if(e instanceof o.Alternation)return"OR";if(e instanceof o.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof o.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof o.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof o.Repetition)return"MANY";if(e instanceof o.Terminal)return"CONSUME";throw Error("non exhaustive match")};var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return i(t,e),t.prototype.visitTerminal=function(e){var t=l.tokenName(e.terminalType)+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(s.GAstVisitor);t.DslMethodsCollectorVisitor=u},function(e,t,r){"use strict";function n(e,t,r){return r|t|e}Object.defineProperty(t,"__esModule",{value:!0}),t.BITS_FOR_METHOD_IDX=4,t.BITS_FOR_OCCURRENCE_IDX=4,t.BITS_FOR_RULE_IDX=24,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_METHOD_IDX,t.OPTION_IDX=2<<t.BITS_FOR_METHOD_IDX,t.MANY_IDX=3<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_METHOD_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_METHOD_IDX,t.getKeyForAutomaticLookahead=n;var i=32-t.BITS_FOR_ALT_IDX;t.getKeyForAltIndex=function(e,t,r,a){var o=a+1<<i;return n(e,t,r)|o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(0),o=r(1),s=r(8),l=r(11),u=r(17),c=r(3);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,r=e.actual;return e.previous,e.ruleName,"Expecting "+(n.hasTokenLabel(t)?"--\x3e "+n.tokenLabel(t)+" <--":"token of type --\x3e "+n.tokenName(t)+" <--")+" but found --\x3e '"+r.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,r=e.actual,i=(e.previous,e.customUserDescription),o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");if(i)return"Expecting: "+i+o;var s=a.reduce(t,function(e,t){return e.concat(t)},[]),l=a.map(s,function(e){return"["+a.map(e,function(e){return n.tokenLabel(e)}).join(", ")+"]"});return"Expecting: one of these possible Token sequences:\n"+a.map(l,function(e,t){return"  "+(t+1)+". "+e}).join("\n")+o},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,r=e.actual,i=e.customUserDescription,o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");return i?"Expecting: "+i+o:"Expecting: expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+a.map(t,function(e){return"["+a.map(e,function(e){return n.tokenLabel(e)}).join(",")+"]"}).join(" ,")+">"+o}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var r,i=e.name,l=a.first(t),u=l.idx,c=s.getProductionDslName(l),h=(r=l)instanceof o.Terminal?n.tokenName(r.terminalType):r instanceof o.NonTerminal?r.nonTerminalName:"",d="->"+c+"<- with numerical suffix: ->"+u+"<-\n                  "+(h?"and argument: ->"+h+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+i+"<-.\n                  "+(0===u?"Also note that numerical suffix 0 means "+c+" without any suffix.":"")+"\n                  To fix this make sure each usage of "+c+" "+(h?"with the argument: ->"+h+"<-":"")+"\n                  in the rule ->"+i+"<- has a different occurrence index (0-5), as that combination acts as a unique\n                  position key in the grammar, which is needed by the parsing engine.\n                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return d=(d=d.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildInvalidNestedRuleNameError:function(e,t){return"Invalid nested rule name: ->"+t.name+"<- inside rule: ->"+e.name+"<-\nit must match the pattern: ->"+l.validNestedRuleName.toString()+"<-.\nNote that this means a nested rule name must start with the '$'(dollar) sign."},buildDuplicateNestedRuleNameError:function(e,t){return"Duplicate nested rule name: ->"+a.first(t).name+"<- inside rule: ->"+e.name+"<-\nA nested name must be unique in the scope of a top level grammar rule."},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=a.map(e.prefixPath,function(e){return n.tokenLabel(e)}).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nhttps://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=a.map(e.prefixPath,function(e){return n.tokenLabel(e)}).join(", "),r=0===e.alternation.idx?"":e.alternation.idx,i="Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n",o=u.VERSION.replace(/\./g,"_");return i=i+"To Resolve this, try one of of the following: \n1. Refactor your grammar to be LL(K) for the current value of k (by default k="+c.DEFAULT_PARSER_CONFIG.maxLookahead+"})\n2. Increase the value of K for your grammar by providing a larger 'maxLookahead' value in the parser's config\n3. This issue can be ignored (if you know what you are doing...), see https://sap.github.io/chevrotain/documentation/"+o+"/interfaces/iparserconfig.html#ignoredissues for more details\n"},buildEmptyRepetitionError:function(e){var t=s.getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"Invalid Grammar Token name: ->"+n.tokenName(e.tokenType)+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+t+" --\x3e "+i.map(e.leftRecursionPath,function(e){return e.name}).concat([t]).join(" --\x3e ")+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"Invalid grammar rule name: ->"+e.topLevelRule.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof o.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(0),s=r(3),l=r(8),u=r(2),c=r(12),h=r(16),d=r(13),f=r(1),p=r(5);function m(e){return l.getProductionDslName(e)+"_#_"+e.idx+"_#_"+v(e)}function v(e){return e instanceof f.Terminal?u.tokenName(e.terminalType):e instanceof f.NonTerminal?e.nonTerminalName:""}t.validateGrammar=function(e,t,r,n,i,c){var d=a.map(e,function(e){return function(e,t){var r=new g;e.accept(r);var n=r.allProductions,i=a.groupBy(n,m),o=a.pick(i,function(e){return e.length>1});return a.map(a.values(o),function(r){var n=a.first(r),i=t.buildDuplicateFoundError(e,r),o=l.getProductionDslName(n),u={message:i,type:s.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:o,occurrence:n.idx},c=v(n);return c&&(u.parameter=c),u})}(e,i)}),f=a.map(e,function(e){return w(e,e,i)}),p=[],x=[],T=[];o.every(f,o.isEmpty)&&(p=o.map(e,function(e){return S(e,i)}),x=o.map(e,function(e){return M(e,t,n,i)}),T=k(e,t,i));var R=function(e,t,r){var n=[],i=o.map(t,function(e){return u.tokenName(e)});return o.forEach(e,function(e){var t=e.name;if(o.contains(i,t)){var a=r.buildNamespaceConflictError(e);n.push({message:a,type:s.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}}),n}(e,r,i),P=a.map(r,function(e){return b(e,i)}),C=function(e,t){var r=[];return o.forEach(e,function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.map(n.result,function(e){return e.orgProd});r.push(o.map(i,function(r){return _(e,r,t)}))}),o.flatten(r)}(e,i),L=function(e,t){var r=[];return o.forEach(e,function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.groupBy(n.result,function(e){return e.name}),a=o.pick(i,function(e){return e.length>1});o.forEach(o.values(a),function(n){var i=o.map(n,function(e){return e.orgProd}),a=t.buildDuplicateNestedRuleNameError(e,i);r.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})})}),r}(e,i),I=o.map(e,function(e){return A(e,i)}),O=o.map(e,function(e){return y(e,i)}),H=o.map(e,function(t){return E(t,e,c,i)});return a.flatten(d.concat(P,C,L,T,f,p,x,R,I,O,H))},t.identifyProductionForDuplicates=m;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function y(e,r){var n=[],i=e.name;return i.match(t.validTermsPattern)||n.push({message:r.buildInvalidRuleNameError({topLevelRule:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:i}),n}function _(e,r,n){var i,a=[];return r.name.match(t.validNestedRuleName)||(i=n.buildInvalidNestedRuleNameError(e,r),a.push({message:i,type:s.ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:e.name})),a}function b(e,r){var n=[];return u.tokenName(e).match(t.validTermsPattern)||n.push({message:r.buildTokenNameError({tokenType:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_TOKEN_NAME}),n}function E(e,t,r,n){var i=[];if(o.reduce(t,function(t,r){return r.name===e.name?t+1:t},0)>1){var a=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function w(e,t,r,n){void 0===n&&(n=[]);var i=[],o=x(t.definition);if(a.isEmpty(o))return[];var l=e.name;a.contains(o,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:s.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:l});var u=a.difference(o,n.concat([e])),c=a.map(u,function(t){var i=a.cloneArr(n);return i.push(t),w(e,t,r,i)});return i.concat(a.flatten(c))}function x(e){var t=[];if(a.isEmpty(e))return t;var r=a.first(e);if(r instanceof f.NonTerminal)t.push(r.referencedRule);else if(r instanceof f.Flat||r instanceof f.Option||r instanceof f.RepetitionMandatory||r instanceof f.RepetitionMandatoryWithSeparator||r instanceof f.RepetitionWithSeparator||r instanceof f.Repetition)t=t.concat(x(r.definition));else if(r instanceof f.Alternation)t=a.flatten(a.map(r.definition,function(e){return x(e.definition)}));else if(!(r instanceof f.Terminal))throw Error("non exhaustive match");var n=l.isOptionalProd(r),i=e.length>1;if(n&&i){var o=a.drop(e);return t.concat(x(o))}return t}t.OccurrenceValidationCollector=g,t.validTermsPattern=/^[a-zA-Z_]\w*$/,t.validNestedRuleName=new RegExp(t.validTermsPattern.source.replace("^","^\\$")),t.validateRuleName=y,t.validateNestedRuleName=_,t.validateTokenName=b,t.validateRuleDoesNotAlreadyExist=E,t.validateRuleIsOverridden=function(e,t,r){var n,i=[];return a.contains(t,e)||(n="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+r+"<-as it is not defined in any of the super grammars ",i.push({message:n,type:s.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),i},t.validateNoLeftRecursion=w,t.getFirstNoneTerminal=x;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return i(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(p.GAstVisitor);function S(e,t){var r=new T;e.accept(r);var n=r.alternations;return a.reduce(n,function(r,n){var i=a.dropRight(n.definition),o=a.map(i,function(r,i){var o=d.nextPossibleTokensAfter([r],[],null,1);return a.isEmpty(o)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:n,emptyChoiceIdx:i}),type:s.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:n.idx,alternative:i+1}:null});return r.concat(a.compact(o))},[])}function M(e,t,r,n){var i=new T;e.accept(i);var u=i.alternations,h=r[e.name];return h&&(u=o.reject(u,function(e){return h[l.getProductionDslName(e)+(0===e.idx?"":e.idx)]})),a.reduce(u,function(r,i){var l=i.idx,u=c.getLookaheadPathsForOr(l,e,t),h=function(e,t,r,n){var i=[],l=o.reduce(e,function(t,r,n){return o.forEach(r,function(r){var a=[n];o.forEach(e,function(e,t){n!==t&&c.containsPath(e,r)&&a.push(t)}),a.length>1&&!c.containsPath(i,r)&&(i.push(r),t.push({alts:a,path:r}))}),t},[]);return a.map(l,function(e){var i=o.map(e.alts,function(e){return e+1}),a=n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path});return{message:a,type:s.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:[e.alts]}})}(u,i,e,n),d=P(u,i,e,n);return r.concat(h,d)},[])}t.validateEmptyOrAlternative=S,t.validateAmbiguousAlternationAlternatives=M;var R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function A(e,t){var r=new T;e.accept(r);var n=r.alternations;return a.reduce(n,function(r,n){return n.definition.length>255&&r.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:n}),type:s.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:n.idx}),r},[])}function k(e,t,r){var n=[];return o.forEach(e,function(e){var i=new R;e.accept(i);var a=i.allProductions;o.forEach(a,function(i){var a=c.getProdType(i),l=i.idx,u=c.getLookaheadPathsForOptionalProd(l,e,a,t)[0];if(o.isEmpty(o.flatten(u))){var h=r.buildEmptyRepetitionError({topLevelRule:e,repetition:i});n.push({message:h,type:s.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}})}),n}function P(e,t,r,n){var i=[],a=o.reduce(e,function(e,t,r){var n=o.map(t,function(e){return{idx:r,path:e}});return e.concat(n)},[]);return o.forEach(a,function(e){var l=e.idx,u=e.path,h=o.findAll(a,function(e){return e.idx<l&&c.isStrictPrefixOfPath(e.path,u)}),d=o.map(h,function(e){var i=[e.idx+1,l+1],a=0===t.idx?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:a,alternatives:i}});i=i.concat(d)}),i}t.RepetionCollector=R,t.validateTooManyAlts=A,t.validateSomeNonEmptyLookaheadPath=k,t.checkPrefixAlternativesAmbiguities=P},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r(0),s=r(13),l=r(14),u=r(7),c=r(1),h=r(5);!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(a=t.PROD_TYPE||(t.PROD_TYPE={})),t.getProdType=function(e){if(e instanceof c.Option)return a.OPTION;if(e instanceof c.Repetition)return a.REPETITION;if(e instanceof c.RepetitionMandatory)return a.REPETITION_MANDATORY;if(e instanceof c.RepetitionMandatoryWithSeparator)return a.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof c.RepetitionWithSeparator)return a.REPETITION_WITH_SEPARATOR;if(e instanceof c.Alternation)return a.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,r,n,i,a){var o=m(e,t,r);return a(o,n,y(o)?u.tokenStructuredMatcherNoCategories:u.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,r,n,i,a){var o=v(e,t,i,r),s=y(o)?u.tokenStructuredMatcherNoCategories:u.tokenStructuredMatcher;return a(o[0],s,n)},t.buildAlternativesLookAheadFunc=function(e,t,r,n){var i=e.length,a=o.every(e,function(e){return o.every(e,function(e){return 1===e.length})});if(t)return function(t){for(var n=o.map(t,function(e){return e.GATE}),a=0;a<i;a++){var s=e[a],l=s.length,u=n[a];if(void 0===u||!1!==u.call(this))e:for(var c=0;c<l;c++){for(var h=s[c],d=h.length,f=0;f<d;f++){var p=this.LA(f+1);if(!1===r(p,h[f]))continue e}return a}}};if(a&&!n){var s=o.map(e,function(e){return o.flatten(e)}),l=o.reduce(s,function(e,t,r){return o.forEach(t,function(t){o.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),o.forEach(t.categoryMatches,function(t){o.has(e,t)||(e[t]=r)})}),e},[]);return function(){var e=this.LA(1);return l[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var n=e[t],a=n.length;e:for(var o=0;o<a;o++){for(var s=n[o],l=s.length,u=0;u<l;u++){var c=this.LA(u+1);if(!1===r(c,s[u]))continue e}return t}}}},t.buildSingleAlternativeLookaheadFunction=function(e,t,r){var n=o.every(e,function(e){return 1===e.length}),i=e.length;if(n&&!r){var a=o.flatten(e);if(1===a.length&&o.isEmpty(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var l=o.reduce(a,function(e,t,r){return e[t.tokenTypeIdx]=!0,o.forEach(t.categoryMatches,function(t){e[t]=!0}),e},[]);return function(){var e=this.LA(1);return!0===l[e.tokenTypeIdx]}}return function(){e:for(var r=0;r<i;r++){for(var n=e[r],a=n.length,o=0;o<a;o++){var s=this.LA(o+1);if(!1===t(s,n[o]))continue e}return!0}return!1}};var d=function(e){function t(t,r,n){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,r,n){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=r.concat(n),!0)},t.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,a.OPTION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,a.REPETITION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t}(l.RestWalker),f=function(e){function t(t,r){var n=e.call(this)||this;return n.targetOccurrence=t,n.targetProdType=r,n.result=[],n}return i(t,e),t.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,a.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,a.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,a.ALTERNATION)},t}(h.GAstVisitor);function p(e,t){function r(e,t){return o.reduce(e,function(e,r,n){if(n!==t){var i=o.map(r,function(e){return e.partialPath});return e.concat(i)}return e},[])}function n(e,t){return void 0===o.find(e,function(e){return o.every(t,function(t,r){return n=t,i=e[r],n===i||n&&i&&(n.categoryMatchesMap[i.tokenTypeIdx]||i.categoryMatchesMap[n.tokenTypeIdx]);var n,i})})}function i(e){for(var t=[],r=0;r<e;r++)t.push([]);return t}for(var a=o.map(e,function(e){return s.possiblePathsFrom([e],1)}),l=i(a.length),u=a,c=1;c<=t;c++){var h=u;u=i(h.length);for(var d=0;d<h.length;d++)for(var f=h[d],p=r(h,d),m=0;m<f.length;m++){var v=f[m].partialPath,y=f[m].suffixDef;if(n(p,v)||o.isEmpty(y)||v.length===t){var _=l[d];g(_,v)||_.push(v)}else{var b=s.possiblePathsFrom(y,c+1,v);u[d]=u[d].concat(b)}}}return l}function m(e,t,r){var n=new f(e,a.ALTERNATION);return t.accept(n),p(n.result,r)}function v(e,t,r,n){var i=new f(e,r);t.accept(i);var a=i.result,o=new d(t,e,r).startWalking();return p([new c.Flat({definition:a}),new c.Flat({definition:o})],n)}function g(e,t){return void 0!==o.find(e,function(e){return t.length===e.length&&o.every(t,function(t,r){return t===e[r]||e[r].categoryMatchesMap[t.tokenTypeIdx]})})}function y(e){return o.every(e,function(e){return o.every(e,function(e){return o.every(e,function(e){return o.isEmpty(e.categoryMatches)})})})}t.lookAheadSequenceFromAlternatives=p,t.getLookaheadPathsForOr=m,t.getLookaheadPathsForOptionalProd=v,t.containsPath=g,t.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&o.every(e,function(e,r){var n=t[r];return e===n||n.categoryMatchesMap[e.tokenTypeIdx]})},t.areTokenCategoriesNotUsed=y},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(0),s=r(2),l=r(21),u=r(1),c=function(e){function t(t,r){var n=e.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return i(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=o.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=o.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,r){void 0===r&&(r=[]),this.found||e.prototype.walk.call(this,t,r)},t.prototype.walkProdRef=function(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var n=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,n)}},t.prototype.updateExpectedNext=function(){o.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(a.RestWalker);t.AbstractNextPossibleTokensWalker=c;var h=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=s.tokenName(n.path.lastTok),n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return i(t,e),t.prototype.walkTerminal=function(e,t,r){if(this.isAtEndOfPath&&s.tokenName(e.terminalType)===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var n=t.concat(r),i=new u.Flat({definition:n});this.possibleTokTypes=l.first(i),this.found=!0}},t}(c);t.NextAfterTokenWalker=h;var d=function(e){function t(t,r){var n=e.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(a.RestWalker);t.AbstractNextTerminalAfterProductionWalker=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkMany.call(this,t,r,n)},t}(d);t.NextTerminalAfterManyWalker=f;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkManySep.call(this,t,r,n)},t}(d);t.NextTerminalAfterManySepWalker=p;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOne.call(this,t,r,n)},t}(d);t.NextTerminalAfterAtLeastOneWalker=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,r,n)},t}(d);function g(e,t,r,n){var i=o.cloneArr(r);i.push(e.name);var a=o.cloneArr(n);return a.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:a}}t.NextTerminalAfterAtLeastOneSepWalker=v,t.possiblePathsFrom=function e(t,r,n){void 0===n&&(n=[]),n=o.cloneArr(n);var i=[],a=0;function s(s){var l=e(s.concat(o.drop(t,a+1)),r,n);return i.concat(l)}for(;n.length<r&&a<t.length;){var l=t[a];if(l instanceof u.Flat)return s(l.definition);if(l instanceof u.NonTerminal)return s(l.definition);if(l instanceof u.Option)i=s(l.definition);else{if(l instanceof u.RepetitionMandatory)return s(c=l.definition.concat([new u.Repetition({definition:l.definition})]));if(l instanceof u.RepetitionMandatoryWithSeparator)return s(c=[new u.Flat({definition:l.definition}),new u.Repetition({definition:[new u.Terminal({terminalType:l.separator})].concat(l.definition)})]);if(l instanceof u.RepetitionWithSeparator){var c=l.definition.concat([new u.Repetition({definition:[new u.Terminal({terminalType:l.separator})].concat(l.definition)})]);i=s(c)}else if(l instanceof u.Repetition)c=l.definition.concat([new u.Repetition({definition:l.definition})]),i=s(c);else{if(l instanceof u.Alternation)return o.forEach(l.definition,function(e){i=s(e.definition)}),i;if(!(l instanceof u.Terminal))throw Error("non exhaustive match");n.push(l.terminalType)}}a++}return i.push({partialPath:n,suffixDef:o.drop(t,a)}),i},t.nextPossibleTokensAfter=function(e,t,r,n){var i=["EXIT_NONE_TERMINAL"],a=!1,s=t.length,l=s-n-1,c=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!o.isEmpty(h);){var d=h.pop();if("EXIT_ALTERNATIVE"!==d){var f=d.def,p=d.idx,m=d.ruleStack,v=d.occurrenceStack;if(!o.isEmpty(f)){var y=f[0];if("EXIT_NONE_TERMINAL"===y){var _={idx:p,def:o.drop(f),ruleStack:o.dropRight(m),occurrenceStack:o.dropRight(v)};h.push(_)}else if(y instanceof u.Terminal)if(p<s-1){var b=p+1;r(t[b],y.terminalType)&&(_={idx:b,def:o.drop(f),ruleStack:m,occurrenceStack:v},h.push(_))}else{if(p!==s-1)throw Error("non exhaustive match");c.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:v}),a=!0}else if(y instanceof u.NonTerminal){var E=o.cloneArr(m);E.push(y.nonTerminalName);var w=o.cloneArr(v);w.push(y.idx),_={idx:p,def:y.definition.concat(i,o.drop(f)),ruleStack:E,occurrenceStack:w},h.push(_)}else if(y instanceof u.Option){var x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:v};h.push(x),h.push("EXIT_ALTERNATIVE");var T={idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:v};h.push(T)}else if(y instanceof u.RepetitionMandatory){var S=new u.Repetition({definition:y.definition,idx:y.idx});_={idx:p,def:y.definition.concat([S],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(_)}else if(y instanceof u.RepetitionMandatoryWithSeparator){var M=new u.Terminal({terminalType:y.separator});S=new u.Repetition({definition:[M].concat(y.definition),idx:y.idx}),_={idx:p,def:y.definition.concat([S],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(_)}else if(y instanceof u.RepetitionWithSeparator){x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:v},h.push(x),h.push("EXIT_ALTERNATIVE"),M=new u.Terminal({terminalType:y.separator});var R=new u.Repetition({definition:[M].concat(y.definition),idx:y.idx});T={idx:p,def:y.definition.concat([R],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(T)}else if(y instanceof u.Repetition)x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:v},h.push(x),h.push("EXIT_ALTERNATIVE"),R=new u.Repetition({definition:y.definition,idx:y.idx}),T={idx:p,def:y.definition.concat([R],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(T);else if(y instanceof u.Alternation)for(var A=y.definition.length-1;A>=0;A--){var k={idx:p,def:y.definition[A].definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:v};h.push(k),h.push("EXIT_ALTERNATIVE")}else if(y instanceof u.Flat)h.push({idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:v});else{if(!(y instanceof u.Rule))throw Error("non exhaustive match");h.push(g(y,p,m,v))}}}else a&&o.last(h).idx<=l&&h.pop()}return c}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=function(){function e(){}return e.prototype.walk=function(e,t){var r=this;void 0===t&&(t=[]),n.forEach(e.definition,function(a,o){var s=n.drop(e.definition,o+1);if(a instanceof i.NonTerminal)r.walkProdRef(a,s,t);else if(a instanceof i.Terminal)r.walkTerminal(a,s,t);else if(a instanceof i.Flat)r.walkFlat(a,s,t);else if(a instanceof i.Option)r.walkOption(a,s,t);else if(a instanceof i.RepetitionMandatory)r.walkAtLeastOne(a,s,t);else if(a instanceof i.RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(a,s,t);else if(a instanceof i.RepetitionWithSeparator)r.walkManySep(a,s,t);else if(a instanceof i.Repetition)r.walkMany(a,s,t);else{if(!(a instanceof i.Alternation))throw Error("non exhaustive match");r.walkOr(a,s,t)}})},e.prototype.walkTerminal=function(e,t,r){},e.prototype.walkProdRef=function(e,t,r){},e.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkAtLeastOne=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkAtLeastOneSep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkMany=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkManySep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkOr=function(e,t,r){var a=this,o=t.concat(r);n.forEach(e.definition,function(e){var t=new i.Flat({definition:[e]});a.walk(t,o)})},e}();function o(e,t,r){return[new i.Option({definition:[new i.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}t.RestWalker=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(27),i=r(0),a=r(7),o=r(20);!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var s={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:o.defaultLexerErrorProvider};Object.freeze(s);var l=function(){function e(e,t){var r=this;if(void 0===t&&(t=s),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");if(this.config=i.merge(s,t),this.config.lineTerminatorsPattern===s.lineTerminatorsPattern)this.config.lineTerminatorsPattern=n.LineTerminatorOptimizedTester;else if(this.config.lineTerminatorCharacters===s.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking);var o,l=!0;i.isArray(e)?((o={modes:{}}).modes[n.DEFAULT_MODE]=i.cloneArr(e),o[n.DEFAULT_MODE]=n.DEFAULT_MODE):(l=!1,o=i.cloneObj(e)),this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(n.performRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(n.performWarningRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),o.modes=o.modes?o.modes:{},i.forEach(o.modes,function(e,t){o.modes[t]=i.reject(e,function(e){return i.isUndefined(e)})});var u=i.keys(o.modes);if(i.forEach(o.modes,function(e,o){if(r.modes.push(o),r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(n.validatePatterns(e,u)),i.isEmpty(r.lexerDefinitionErrors)){a.augmentTokenTypes(e);var s=n.analyzeTokenTypes(e,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode});r.patternIdxToConfig[o]=s.patternIdxToConfig,r.charCodeToPatternIdxToConfig[o]=s.charCodeToPatternIdxToConfig,r.emptyGroups=i.merge(r.emptyGroups,s.emptyGroups),r.hasCustom=s.hasCustom||r.hasCustom,r.canModeBeOptimized[o]=s.canBeOptimized}}),this.defaultMode=o.defaultMode,!i.isEmpty(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){var c=i.map(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+c)}if(i.forEach(this.lexerDefinitionWarning,function(e){i.PRINT_WARNING(e.message)}),n.SUPPORT_STICKY?(this.chopInput=i.IDENTITY,this.match=this.matchWithTest):(this.updateLastIndex=i.NOOP,this.match=this.matchWithExec),l&&(this.handleModes=i.NOOP),!1===this.trackStartLines&&(this.computeNewColumn=i.IDENTITY),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=i.NOOP),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+this.config.positionTracking+'"');this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?this.addToken=this.addTokenUsingPush:this.addToken=this.addTokenUsingMemberAccess;var h=i.reduce(this.canModeBeOptimized,function(e,t,r){return!1===t&&e.push(r),e},[]);if(t.ensureOptimizations&&!i.isEmpty(h))throw Error("Lexer Modes: < "+h.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!i.isEmpty(this.lexerDefinitionErrors)){var r=i.map(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+r)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var r,a,o,s,l,u,c,h,d,f,p,m,v=this,g=e,y=g.length,_=0,b=0,E=this.hasCustom?0:Math.floor(e.length/10),w=new Array(E),x=[],T=this.trackStartLines?1:void 0,S=this.trackStartLines?1:void 0,M=n.cloneEmptyGroups(this.emptyGroups),R=this.trackStartLines,A=this.config.lineTerminatorsPattern,k=0,P=[],C=[],L=[],I=[];Object.freeze(I);var O,H=void 0,D=function(e){if(1===L.length&&void 0===e.tokenType.PUSH_MODE){var t=v.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);x.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{L.pop();var r=i.last(L);P=v.patternIdxToConfig[r],C=v.charCodeToPatternIdxToConfig[r],k=P.length;var n=v.canModeBeOptimized[r]&&!1===v.config.safeMode;H=C&&n?function(e){var t=C[e];return void 0===t?I:t}:function(){return P}}};function N(e){L.push(e),C=this.charCodeToPatternIdxToConfig[e],P=this.patternIdxToConfig[e],k=P.length,k=P.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;H=C&&t?function(e){var t=C[e];return void 0===t?I:t}:function(){return P}}for(N.call(this,t);_<y;){l=null;var F=g.charCodeAt(_),U=H(F),B=U.length;for(r=0;r<B;r++){var z=(O=U[r]).pattern;if(!1!==(K=O.short)?F===K&&(l=z):!0===O.isCustom?l=null!==(m=z.exec(g,_,w,M))?m[0]:m:(this.updateLastIndex(z,_),l=this.match(z,e,_)),null!==l){if(void 0!==(s=O.longerAlt)){var j=P[s],V=j.pattern;!0===j.isCustom?o=null!==(m=V.exec(g,_,w,M))?m[0]:m:(this.updateLastIndex(V,_),o=this.match(V,e,_)),o&&o.length>l.length&&(l=o,O=j)}break}}if(null!==l){if(u=l.length,void 0!==(c=O.group)&&(h=O.tokenTypeIdx,d=this.createTokenInstance(l,_,h,O.tokenType,T,S,u),!1===c?b=this.addToken(w,b,d):M[c].push(d)),e=this.chopInput(e,u),_+=u,S=this.computeNewColumn(S,u),!0===R&&!0===O.canLineTerminator){var G=0,W=void 0,X=void 0;A.lastIndex=0;do{!0===(W=A.test(l))&&(X=A.lastIndex-1,G++)}while(W);0!==G&&(T+=G,S=u-X,this.updateTokenEndLineColumnLocation(d,c,X,G,T,S,u))}this.handleModes(O,D,N,d)}else{for(var Y=_,q=T,Z=S,J=!1;!J&&_<y;)for(g.charCodeAt(_),e=this.chopInput(e,1),_++,a=0;a<k;a++){var K,Q=P[a];if(z=Q.pattern,!1!==(K=Q.short)?g.charCodeAt(_)===K&&(J=!0):!0===Q.isCustom?J=null!==z.exec(g,_,w,M):(this.updateLastIndex(z,_),J=null!==z.exec(e)),!0===J)break}f=_-Y,p=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(g,Y,f,q,Z),x.push({offset:Y,line:q,column:Z,length:f,message:p})}}return this.hasCustom||(w.length=b),{tokens:w,groups:M,errors:x}},e.prototype.handleModes=function(e,t,r,n){if(!0===e.pop){var i=e.push;t(n),void 0!==i&&r.call(this,i)}else void 0!==e.push&&r.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var s,l;void 0!==t&&(l=(s=r===o-1)?-1:0,1===n&&!0===s||(e.endLine=i+l,e.endColumn=a-1-l))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},e.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},e.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},e.prototype.addToken=function(e,t,r){return 666},e.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},e.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,++t},e.prototype.match=function(e,t,r){return null},e.prototype.matchWithTest=function(e,t,r){return!0===e.test(t)?t.substring(r,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var r=e.exec(t);return null!==r?r[0]:r},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();t.Lexer=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(4),s=r(9),l=r(1),u=r(5);t.addTerminalToCst=function(e,t,r){void 0===e.children[r]?e.children[r]=[t]:e.children[r].push(t)},t.addNoneTerminalToCst=function(e,t,r){void 0===e.children[t]?e.children[t]=[r]:e.children[t].push(r)};var c=function(e){function t(t){var r=e.call(this)||this;return r.result=[],r.ruleIdx=t,r}return i(t,e),t.prototype.collectNamedDSLMethod=function(e,t,r){if(!a.isUndefined(e.name)){var n=void 0;if(e instanceof l.Option||e instanceof l.Repetition||e instanceof l.RepetitionMandatory||e instanceof l.Alternation)n=new t({definition:e.definition,idx:e.idx});else{if(!(e instanceof l.RepetitionMandatoryWithSeparator||e instanceof l.RepetitionWithSeparator))throw Error("non exhaustive match");n=new t({definition:e.definition,idx:e.idx,separator:e.separator})}var i=[n],o=s.getKeyForAutomaticLookahead(this.ruleIdx,r,e.idx);this.result.push({def:i,key:o,name:e.name,orgProd:e})}},t.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,l.Option,s.OPTION_IDX)},t.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,l.Repetition,s.MANY_IDX)},t.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatory,s.AT_LEAST_ONE_IDX)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatoryWithSeparator,s.AT_LEAST_ONE_SEP_IDX)},t.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionWithSeparator,s.MANY_SEP_IDX)},t.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,l.Alternation,s.OR_IDX);var r=e.definition.length>1;a.forEach(e.definition,function(n,i){if(!a.isUndefined(n.name)){var o=n.definition;o=r?[new l.Option({definition:n.definition})]:n.definition;var u=s.getKeyForAltIndex(t.ruleIdx,s.OR_IDX,e.idx,i);t.result.push({def:o,key:u,name:n.name,orgProd:n})}})},t}(u.GAstVisitor);t.NamedDSLMethodsCollectorVisitor=c,t.analyzeCst=function(e,t){var r={dictDef:new o.HashTable,allRuleNames:[]};return a.forEach(e,function(e){var n=t.get(e.name);r.allRuleNames.push(e.name);var i=new c(n);e.accept(i),a.forEach(i.result,function(t){t.def,t.key;var n=t.name;r.allRuleNames.push(e.name+n)})}),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="4.6.0"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(15),a=r(2),o=r(6),s=r(17),l=r(10),u=r(39),c=r(5),h=r(1),d=r(24),f=r(40),p=r(20),m={};m.VERSION=s.VERSION,m.Parser=n.Parser,m.CstParser=n.CstParser,m.EmbeddedActionsParser=n.EmbeddedActionsParser,m.ParserDefinitionErrorType=n.ParserDefinitionErrorType,m.Lexer=i.Lexer,m.LexerDefinitionErrorType=i.LexerDefinitionErrorType,m.EOF=a.EOF,m.tokenName=a.tokenName,m.tokenLabel=a.tokenLabel,m.tokenMatcher=a.tokenMatcher,m.createToken=a.createToken,m.createTokenInstance=a.createTokenInstance,m.EMPTY_ALT=n.EMPTY_ALT,m.defaultParserErrorProvider=l.defaultParserErrorProvider,m.isRecognitionException=o.isRecognitionException,m.EarlyExitException=o.EarlyExitException,m.MismatchedTokenException=o.MismatchedTokenException,m.NotAllInputParsedException=o.NotAllInputParsedException,m.NoViableAltException=o.NoViableAltException,m.defaultLexerErrorProvider=p.defaultLexerErrorProvider,m.Flat=h.Flat,m.Repetition=h.Repetition,m.RepetitionWithSeparator=h.RepetitionWithSeparator,m.RepetitionMandatory=h.RepetitionMandatory,m.RepetitionMandatoryWithSeparator=h.RepetitionMandatoryWithSeparator,m.Option=h.Option,m.Alternation=h.Alternation,m.NonTerminal=h.NonTerminal,m.Terminal=h.Terminal,m.Rule=h.Rule,m.GAstVisitor=c.GAstVisitor,m.serializeGrammar=h.serializeGrammar,m.serializeProduction=h.serializeProduction,m.resolveGrammar=d.resolveGrammar,m.defaultGrammarResolverErrorProvider=l.defaultGrammarResolverErrorProvider,m.validateGrammar=d.validateGrammar,m.defaultGrammarValidatorErrorProvider=l.defaultGrammarValidatorErrorProvider,m.assignOccurrenceIndices=d.assignOccurrenceIndices,m.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")},m.createSyntaxDiagramsCode=u.createSyntaxDiagramsCode,m.generateParserFactory=f.generateParserFactory,m.generateParserModule=f.generateParserModule,e.exports=m},function(e,t,r){var n,i,a;"undefined"!=typeof self&&self,i=[],void 0===(a="function"==typeof(n=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var r={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(r,"global");break;case"i":s(r,"ignoreCase");break;case"m":s(r,"multiLine");break;case"u":s(r,"unicode");break;case"y":s(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:"Alternative",value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}l(e);var t=this.disjunction();return this.consumeChar(")"),{type:e,value:t}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":var n;this.isDigit()?(n=this.integerIncludingZero(),t={atLeast:r,atMost:n}):t={atLeast:r,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;l(t)}if(!0!==e||void 0!==t)return l(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t},e.prototype.atom=function(){var e;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),l(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var e=this.positiveInteger();return{type:"GroupBackReference",value:e}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=u;break;case"D":e=u,t=!0;break;case"s":e=h;break;case"S":e=h,t=!0;break;case"w":e=c;break;case"W":e=c,t=!0}return l(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\v")}return l(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");var t=e.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:t}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var e=this.popChar();return{type:"Character",value:a(e)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var e=this.popChar();return{type:"Character",value:a(e)}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var r=this.classAtom(),n="Character"===r.type;if(n&&this.isRangeDash()){this.consumeChar("-");var i=this.classAtom(),s="Character"===i.type;if(s){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else o(r.value,e),e.push(a("-")),o(i.value,e)}else o(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++}var t=this.disjunction();this.consumeChar(")");var r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===i.test(e))throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===n.test(e))throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",n=0;n<e;n++){var i=this.popChar();if(!1===r.test(i))throw Error("Expecting a HexDecimal digits");t+=i}var a=parseInt(t,16);return{type:"Character",value:a}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t,r=/[0-9a-fA-F]/,n=/[0-9]/,i=/[1-9]/;function a(e){return e.charCodeAt(0)}function o(e,t){void 0!==e.length?e.forEach(function(e){t.push(e)}):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function l(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var u=[];for(t=a("0");t<=a("9");t++)u.push(t);var c=[a("_")].concat(u);for(t=a("a");t<=a("z");t++)c.push(t);for(t=a("A");t<=a("Z");t++)c.push(t);var h=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\v"),a("\t"),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a("\u2028"),a("\u2029"),a(" "),a(" "),a("　"),a("\ufeff")];function d(){}return d.prototype.visitChildren=function(e){for(var t in e){var r=e[t];e.hasOwnProperty(t)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach(function(e){this.visit(e)},this))}},d.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},d.prototype.visitPattern=function(e){},d.prototype.visitFlags=function(e){},d.prototype.visitDisjunction=function(e){},d.prototype.visitAlternative=function(e){},d.prototype.visitStartAnchor=function(e){},d.prototype.visitEndAnchor=function(e){},d.prototype.visitWordBoundary=function(e){},d.prototype.visitNonWordBoundary=function(e){},d.prototype.visitLookahead=function(e){},d.prototype.visitNegativeLookahead=function(e){},d.prototype.visitCharacter=function(e){},d.prototype.visitSet=function(e){},d.prototype.visitGroup=function(e){},d.prototype.visitGroupBackReference=function(e){},d.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:d,VERSION:"0.4.0"}})?n.apply(t,i):n)||(e.exports=a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,r,n,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+r+" characters."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=r(8);function o(e){if(e instanceof i.NonTerminal)return o(e.referencedRule);if(e instanceof i.Terminal)return u(e);if(a.isSequenceProd(e))return s(e);if(a.isBranchingProd(e))return l(e);throw Error("non exhaustive match")}function s(e){for(var t,r=[],i=e.definition,s=0,l=i.length>s,u=!0;l&&u;)t=i[s],u=a.isOptionalProd(t),r=r.concat(o(t)),s+=1,l=i.length>s;return n.uniq(r)}function l(e){var t=n.map(e.definition,function(e){return o(e)});return n.uniq(n.flatten(t))}function u(e){return[e.terminalType]}t.first=o,t.firstForSequence=s,t.firstForBranching=l,t.firstForTerminal=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN="_~IN~_"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(29),a=r(0),o=r(1);!function(e){e[e.OPTION=0]="OPTION",e[e.OR=1]="OR",e[e.MANY=2]="MANY",e[e.MANY_SEP=3]="MANY_SEP",e[e.AT_LEAST_ONE=4]="AT_LEAST_ONE",e[e.AT_LEAST_ONE_SEP=5]="AT_LEAST_ONE_SEP",e[e.REF=6]="REF",e[e.TERMINAL=7]="TERMINAL",e[e.FLAT=8]="FLAT"}(n=t.ProdType||(t.ProdType={}));var s=/(?:\s*{\s*NAME\s*:\s*["'`]([\w$]*)["'`])?/,l=new RegExp(s.source.replace("{","").replace(")?","\\s*,)?")),u=/\.\s*CONSUME(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,c=new RegExp(u.source,"g"),h=/\.\s*SUBRULE(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,d=new RegExp(h.source,"g"),f=/\.\s*OPTION(\d+)?\s*\(/,p=new RegExp(f.source+s.source),m=new RegExp(f.source,"g"),v=/\.\s*MANY(\d+)?\s*\(/,g=new RegExp(v.source+s.source),y=new RegExp(v.source,"g"),_=/\s*SEP\s*:\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,b=new RegExp(/\.\s*MANY_SEP(\d+)?\s*\(\s*{/.source+l.source+_.source),E=new RegExp(b.source,"g"),w=new RegExp(/\.\s*AT_LEAST_ONE_SEP(\d+)?\s*\(\s*{/.source+l.source+_.source),x=new RegExp(w.source,"g"),T=/\.\s*AT_LEAST_ONE(\d+)?\s*\(/,S=new RegExp(T.source+s.source),M=new RegExp(T.source,"g"),R=/\.\s*OR(\d+)?\s*\(/,A=new RegExp(R.source+s.source),k=new RegExp(R.source,"g"),P=new RegExp(l.source+/\s*(ALT)\s*:/.source),C=new RegExp(P.source,"g");function L(e,r,i){switch(e.type){case n.AT_LEAST_ONE:return function(e,t,r){return I(S,new o.RepetitionMandatory({definition:[]}),e,t,r)}(e,r,i);case n.AT_LEAST_ONE_SEP:return function(e,t,r){return O(e,t,o.RepetitionMandatoryWithSeparator,w,r)}(e,r,i);case n.MANY_SEP:return function(e,t,r){return O(e,t,o.RepetitionWithSeparator,b,r)}(e,r,i);case n.MANY:return function(e,t,r){return I(g,new o.Repetition({definition:[]}),e,t,r)}(e,r,i);case n.OPTION:return function(e,t,r){return I(p,new o.Option({definition:[]}),e,t,r)}(e,r,i);case n.OR:return function(e,t,r){return I(A,new o.Alternation({definition:[]}),e,t,r)}(e,r,i);case n.FLAT:return function(e,t,r){var n=new o.Flat({definition:[]}),i=P.exec(e.text)[1];return a.isUndefined(i)||(n.name=i),H(n,e.range,t,r)}(e,r,i);case n.REF:return function(e){var t=h.exec(e.text),r=void 0===t[1]?0:parseInt(t[1],10),n=t[2];return new o.NonTerminal({nonTerminalName:n,idx:r})}(e);case n.TERMINAL:return function(e,r){var n=u.exec(e.text),i=void 0===n[1]?0:parseInt(n[1],10),a=n[2],s=t.terminalNameToConstructor[a];if(!s)throw Error("Terminal Token name: <"+a+"> not found in rule: <"+r+">  \n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#TERMINAL_NAME_NOT_FOUND\n\tFor Further details.");return new o.Terminal({terminalType:s,idx:i})}(e,i);default:throw Error("non exhaustive match")}}function I(e,t,r,n,i){var o=e.exec(r.text),s=void 0===o[1];t.idx=s?0:parseInt(o[1],10);var l=o[2];return a.isUndefined(l)||(t.name=l),H(t,r.range,n,i)}function O(e,r,n,i,o){var s=i.exec(e.text),l=void 0===s[1]?0:parseInt(s[1],10),u=s[3],c=t.terminalNameToConstructor[u];if(!c)throw Error("Separator Terminal Token name: "+u+" not found");var h=new n({definition:[],separator:c,idx:l}),d=s[2];return a.isUndefined(d)||(h.name=d),H(h,e.range,r,o)}function H(e,t,r,n){var i=D(t,r),o=a.sortBy(i,function(e){return e.range.start}),s=[];return a.forEach(o,function(e){s.push(L(e,r,n))}),e.definition=s,e}function D(e,t){return a.filter(t,function(r){var n=e.strictlyContainsRange(r.range),i=a.every(t,function(t){var n=t.range.strictlyContainsRange(r.range),i=t.range.isStrictlyContainedInRange(e);return!(n&&i)});return n&&i})}t.terminalNameToConstructor={},t.buildTopProduction=function(e,r,n){t.terminalNameToConstructor=n;var a=G(V(z("  "+e)));return function(e,t,r,n){return H(new o.Rule({name:e,definition:[],orgText:n}),t,r,e)}(r,new i.Range(0,e.length+2),a,e)},t.buildProdGast=L,t.getDirectlyContainedRanges=D;var N=/\/\/.*/g,F=/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\//g,U=/(NAME\s*:\s*)?"([^\\"]|\\([bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/g,B=/(NAME\s*:\s*)?'([^\\']|\\([bfnrtv'\\\/]|u[0-9a-fA-F]{4}))*'/g;function z(e){return e.replace(N,"").replace(F,"")}function j(e,t){return void 0!==t?e:""}function V(e){return e.replace(U,j).replace(B,j)}function G(e){var t=W(e),r=X(e),n=Y(e),i=q(e),a=Z(e),o=J(e),s=K(e),l=Q(e);return[].concat(t,r,n,i,a,o,s,l)}function W(e){return re(e,n.TERMINAL,c)}function X(e){return re(e,n.REF,d)}function Y(e){return ne(e,n.AT_LEAST_ONE,M)}function q(e){return ne(e,n.AT_LEAST_ONE_SEP,x)}function Z(e){return ne(e,n.MANY,y)}function J(e){return ne(e,n.MANY_SEP,E)}function K(e){return ne(e,n.OPTION,m)}function Q(e){var t=ne(e,n.OR,k),r=te(t);return t.concat(r)}t.removeComments=z,t.removeStringLiterals=V,t.createRanges=G,t.createTerminalRanges=W,t.createRefsRanges=X,t.createAtLeastOneRanges=Y,t.createAtLeastOneSepRanges=q,t.createManyRanges=Z,t.createManySepRanges=J,t.createOptionRanges=K,t.createOrRanges=Q;var $=a.partial(ae,"{","}"),ee=a.partial(ae,"(",")");function te(e){var t=[];return a.forEach(e,function(e){var r=ie(e.text,n.FLAT,C,$),i=e.range.start;a.forEach(r,function(e){e.range.start+=i,e.range.end+=i}),t=t.concat(r)}),a.uniq(t,function(e){return e.type+"~"+e.range.start+"~"+e.range.end+"~"+e.text})}function re(e,t,r){for(var n,a=[];n=r.exec(e);){var o=n.index,s=r.lastIndex,l=new i.Range(o,s),u=n[0];a.push({range:l,text:u,type:t})}return a}function ne(e,t,r){return ie(e,t,r,ee)}function ie(e,t,r,n){for(var a,o=[];a=r.exec(e);){var s=a.index,l=n(s+a[0].length,e),u=new i.Range(s,l),c=e.substr(s,l-s+1);o.push({range:u,text:c,type:t})}return o}function ae(e,t,r,n){for(var i=[1],o=-1;!a.isEmpty(i)&&o+r<n.length;){o++;var s=n.charAt(r+o);s===e?i.push(1):s===t&&i.pop()}if(a.isEmpty(i))return o+r;throw new Error("INVALID INPUT TEXT, UNTERMINATED PARENTHESIS")}function oe(e,t){return a.map(e,function(e){return se(e,t)})}function se(e,t){switch(e.type){case"NonTerminal":return new o.NonTerminal({nonTerminalName:e.name,idx:e.idx});case"Flat":return new o.Flat({name:e.name,definition:oe(e.definition,t)});case"Option":return new o.Option({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatory":return new o.RepetitionMandatory({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatoryWithSeparator":return new o.RepetitionMandatoryWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"RepetitionWithSeparator":return new o.RepetitionWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"Repetition":return new o.Repetition({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Alternation":return new o.Alternation({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Terminal":return new o.Terminal({terminalType:t[e.name],idx:e.idx});case"Rule":return new o.Rule({name:e.name,orgText:e.orgText,definition:oe(e.definition,t)})}}t.createOrPartRanges=te,t.findClosingOffset=ae,t.deserializeGrammar=oe,t.deserializeProduction=se},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(30),o=r(11),s=r(10),l=r(8);t.resolveGrammar=function(e){e=n.defaults(e,{errMsgProvider:s.defaultGrammarResolverErrorProvider});var t=new i.HashTable;return n.forEach(e.rules,function(e){t.put(e.name,e)}),a.resolveGrammar(t,e.errMsgProvider)},t.validateGrammar=function(e){return e=n.defaults(e,{errMsgProvider:s.defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),o.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)},t.assignOccurrenceIndices=function(e){n.forEach(e.rules,function(e){var t=new l.DslMethodsCollectorVisitor;e.accept(t),n.forEach(t.dslMethods,function(e){n.forEach(e,function(e,t){e.idx=t+1})})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(6),o=r(22),s=r(4),l=r(3);function u(e){this.name=t.IN_RULE_RECOVERY_EXCEPTION,this.message=e}t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",t.InRuleRecoveryException=u,u.prototype=Error.prototype;var c=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap=new s.HashTable,this.resyncFollows=new s.HashTable,this.recoveryEnabled=i.has(e,"recoveryEnabled")?e.recoveryEnabled:l.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=h)},e.prototype.getTokenToInsert=function(e){var t=n.createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var o=this,s=this.findReSyncTokenType(),l=this.exportLexerState(),u=[],c=!1,h=this.LA(1),d=this.LA(1),f=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:h,previous:e,ruleName:o.getCurrRuleFullName()}),r=new a.MismatchedTokenException(t,h,o.LA(0));r.resyncedTokens=i.dropRight(u),o.SAVE_ERROR(r)};!c;){if(this.tokenMatcher(d,n))return void f();if(r.call(this))return f(),void e.apply(this,t);this.tokenMatcher(d,s)?c=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,u))}this.importLexerState(l)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t){return void 0!==e&&void 0!==t&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new u("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if(i.isEmpty(t))return!1;var n=this.LA(1);return void 0!==i.find(t,function(e){return r.tokenMatcher(n,e)})},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return i.contains(r,e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(i.contains(e,n))return n;t=this.LA(r),r++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return t.EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,r=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(r=i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.RULE_STACK[t]}),n=i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.RULE_OCCURRENCE_STACK[t]})),i.map(r,function(i,a){return 0===a?t.EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(i),idxInCallingRule:n[a],inRule:e.shortRuleNameToFullName(r[a-1])}})},e.prototype.flattenFollowSet=function(){var e=this,t=i.map(this.buildFullFollowKeyStack(),function(t){return e.getFollowSetFromFollowKey(t)});return i.flatten(t)},e.prototype.getFollowSetFromFollowKey=function(e){if(e===t.EOF_FOLLOW_KEY)return[n.EOF];var r=e.ruleName+e.idxInCallingRule+o.IN+e.inRule;return this.resyncFollows.get(r)},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,n.EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return i.dropRight(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)?i.map(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},e}();function h(e,t,r,i,a,o){var s=this.getKeyForAutomaticLookahead(i,a),l=this.firstAfterRepMap.get(s);if(void 0===l){var u=this.getCurrRuleFullName();l=new o(this.getGAstProductions().get(u),a).startWalking(),this.firstAfterRepMap.put(s,l)}var c=l.token,h=l.occurrence,d=l.isEndOfRule;1===this.RULE_STACK.length&&d&&void 0===c&&(c=n.EOF,h=1),this.shouldInRepetitionRecoveryBeTried(c,h)&&this.tryInRepetitionRecovery(e,t,r,c)}t.Recoverable=c,t.attemptInRepetitionRecovery=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(4),s=r(21),l=r(0),u=r(22),c=r(2),h=r(1),d=function(e){function t(t){var r=e.call(this)||this;return r.topProd=t,r.follows=new o.HashTable,r}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,r){},t.prototype.walkProdRef=function(e,t,r){var n=f(e.referencedRule,e.idx)+this.topProd.name,i=t.concat(r),a=new h.Flat({definition:i}),o=s.first(a);this.follows.put(n,o)},t}(a.RestWalker);function f(e,t){return e.name+t+u.IN}t.ResyncFollowsWalker=d,t.computeAllProdsFollows=function(e){var t=new o.HashTable;return l.forEach(e,function(e){var r=new d(e).startWalking();t.putAll(r)}),t},t.buildBetweenProdsFollowPrefix=f,t.buildInProdFollowPrefix=function(e){return c.tokenName(e.terminalType)+e.idx+u.IN}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(2),s=r(15),l=r(0),u=r(28),c=new a.RegExpParser,h="PATTERN";function d(e){var t=l.filter(e,function(e){return!l.has(e,h)});return{errors:l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- missing static 'PATTERN' property",type:s.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}}),valid:l.difference(e,t)}}function f(e){var t=l.filter(e,function(e){var t=e[h];return!(l.isRegExp(t)||l.isFunction(t)||l.has(t,"exec")||l.isString(t))});return{errors:l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:s.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}}),valid:l.difference(e,t)}}t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,t.disableSticky=function(){t.SUPPORT_STICKY=!1},t.enableSticky=function(){t.SUPPORT_STICKY=!0},t.analyzeTokenTypes=function(e,r){r=l.defaults(r,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"]});var n=l.reject(e,function(e){return e[h]===s.Lexer.NA}),i=!1,a=l.map(n,function(e){var t=e[h];if(l.isRegExp(t)){var n=t.source;return 1===n.length&&"^"!==n&&"$"!==n&&"."!==n?n:2!==n.length||"\\"!==n[0]||l.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],n[1])?r.useSticky?S(t):T(t):n[1]}if(l.isFunction(t))return i=!0,{exec:t};if(l.has(t,"exec"))return i=!0,t;if("string"==typeof t){if(1===t.length)return t;var a=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(a);return r.useSticky?S(o):T(o)}throw Error("non exhaustive match")}),c=l.map(n,function(e){return e.tokenTypeIdx}),d=l.map(n,function(e){var t=e.GROUP;if(t!==s.Lexer.SKIPPED){if(l.isString(t))return t;if(l.isUndefined(t))return!1;throw Error("non exhaustive match")}}),f=l.map(n,function(e){var t=e.LONGER_ALT;if(t)return l.indexOf(n,t)}),p=l.map(n,function(e){return e.PUSH_MODE}),m=l.map(n,function(e){return l.has(e,"POP_MODE")}),v=P(r.lineTerminatorCharacters),g=l.map(n,function(e){return!1});"onlyOffset"!==r.positionTracking&&(g=l.map(n,function(e){return l.has(e,"LINE_BREAKS")?e.LINE_BREAKS:!1===A(e,v)?u.canMatchCharCode(v,e.PATTERN):void 0}));var y=l.map(n,M),_=l.map(a,R),b=l.reduce(n,function(e,t){var r=t.GROUP;return l.isString(r)&&r!==s.Lexer.SKIPPED&&(e[r]=[]),e},{}),E=l.map(a,function(e,t){return{pattern:a[t],longerAlt:f[t],canLineTerminator:g[t],isCustom:y[t],short:_[t],group:d[t],push:p[t],pop:m[t],tokenTypeIdx:c[t],tokenType:n[t]}});function w(e,t,r){void 0===e[t]&&(e[t]=[]),e[t].push(r)}var x=!0,k=[];return r.safeMode||(k=l.reduce(n,function(e,t,n){if("string"==typeof t.PATTERN){var i=t.PATTERN.charCodeAt(0);w(e,i,E[n])}else if(l.isArray(t.START_CHARS_HINT))l.forEach(t.START_CHARS_HINT,function(t){var r="string"==typeof t?t.charCodeAt(0):t;w(e,r,E[n])});else if(l.isRegExp(t.PATTERN))if(t.PATTERN.unicode)x=!1,r.ensureOptimizations&&l.PRINT_ERROR(u.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var a=u.getStartCodes(t.PATTERN,r.ensureOptimizations);l.isEmpty(a)&&(x=!1),l.forEach(a,function(t){w(e,t,E[n])})}else r.ensureOptimizations&&l.PRINT_ERROR(u.failedOptimizationPrefixMsg+"\tTokenType: <"+o.tokenName(t)+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),x=!1;return e},[])),x&&k.length<65536&&(k=l.packArray(k)),{emptyGroups:b,patternIdxToConfig:E,charCodeToPatternIdxToConfig:k,hasCustom:i,canBeOptimized:x}},t.validatePatterns=function(e,t){var r=[],n=d(e);r=r.concat(n.errors);var i=f(n.valid),a=i.valid;return r=(r=(r=(r=(r=r.concat(i.errors)).concat(function(e){var t=[],r=l.filter(e,function(e){return l.isRegExp(e[h])});return t=(t=(t=(t=(t=t.concat(m(r))).concat(y(r))).concat(_(r))).concat(b(r))).concat(v(r))}(a))).concat(E(a))).concat(w(a,t))).concat(x(a))},t.findMissingPatterns=d,t.findInvalidPatterns=f;var p=/[^\\][\$]/;function m(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,function(e){var r=e[h];try{var n=c.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return p.test(r.source)}});return l.map(r,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}})}function v(e){var t=l.filter(e,function(e){return e[h].test("")});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' must not match an empty string",type:s.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}})}t.findEndOfInputAnchor=m,t.findEmptyMatchRegExps=v;var g=/[^\\[][\^]|^\^/;function y(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,function(e){var r=e[h];try{var n=c.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return g.test(r.source)}});return l.map(r,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}})}function _(e){var t=l.filter(e,function(e){var t=e[h];return t instanceof RegExp&&(t.multiline||t.global)});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:s.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}})}function b(e){var t=[],r=l.map(e,function(r){return l.reduce(e,function(e,n){return r.PATTERN.source!==n.PATTERN.source||l.contains(t,n)||n.PATTERN===s.Lexer.NA?e:(t.push(n),e.push(n),e)},[])});r=l.compact(r);var n=l.filter(r,function(e){return e.length>1});return l.map(n,function(e){var t=l.map(e,function(e){return o.tokenName(e)});return{message:"The same RegExp pattern ->"+l.first(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:s.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}})}function E(e){var t=l.filter(e,function(e){if(!l.has(e,"GROUP"))return!1;var t=e.GROUP;return t!==s.Lexer.SKIPPED&&t!==s.Lexer.NA&&!l.isString(t)});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:s.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}})}function w(e,t){var r=l.filter(e,function(e){return void 0!==e.PUSH_MODE&&!l.contains(t,e.PUSH_MODE)});return l.map(r,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:s.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}})}function x(e){var t=[],r=l.reduce(e,function(e,t,r){var n,i=t.PATTERN;return i===s.Lexer.NA?e:(l.isString(i)?e.push({str:i,idx:r,tokenType:t}):l.isRegExp(i)&&(n=i,void 0===l.find([".","\\","[","]","|","^","$","(",")","?","*","+","{"],function(e){return-1!==n.source.indexOf(e)}))&&e.push({str:i.source,idx:r,tokenType:t}),e)},[]);return l.forEach(e,function(e,n){l.forEach(r,function(r){var i=r.str,a=r.idx,u=r.tokenType;if(n<a&&function(e,t){if(l.isRegExp(t)){var r=t.exec(e);return null!==r&&0===r.index}if(l.isFunction(t))return t(e,0,[],{});if(l.has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(i,e.PATTERN)){var c="Token: ->"+o.tokenName(u)+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+o.tokenName(e)+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:c,type:s.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,u]})}})}),t}function T(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function S(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function M(e){var t=e.PATTERN;if(l.isRegExp(t))return!1;if(l.isFunction(t))return!0;if(l.has(t,"exec"))return!0;if(l.isString(t))return!1;throw Error("non exhaustive match")}function R(e){return!(!l.isString(e)||1!==e.length)&&e.charCodeAt(0)}function A(e,t){if(l.has(e,"LINE_BREAKS"))return!1;if(l.isRegExp(e.PATTERN)){try{u.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(l.isString(e.PATTERN))return!1;if(M(e))return{issue:s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function k(e,t){if(t.issue===s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function P(e){return l.map(e,function(e){return l.isString(e)&&e.length>0?e.charCodeAt(0):e})}t.findStartOfInputAnchor=y,t.findUnsupportedFlags=_,t.findDuplicatePatterns=b,t.findInvalidGroupType=E,t.findModesThatDoNotExist=w,t.findUnreachablePatterns=x,t.addStartOfInput=T,t.addStickyFlag=S,t.performRuntimeChecks=function(e,r,n){var i=[];return l.has(e,t.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),l.has(e,t.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),l.has(e,t.MODES)&&l.has(e,t.DEFAULT_MODE)&&!l.has(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a "+t.DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),l.has(e,t.MODES)&&l.forEach(e.modes,function(e,t){l.forEach(e,function(e,r){l.isUndefined(e)&&i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+r+">\n",type:s.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),i},t.performWarningRuntimeChecks=function(e,t,r){var n=[],i=!1,a=l.compact(l.flatten(l.mapValues(e.modes,function(e){return e}))),o=l.reject(a,function(e){return e[h]===s.Lexer.NA}),c=P(r);return t&&l.forEach(o,function(e){var t=A(e,c);if(!1!==t){var r={message:k(e,t),type:t.issue,tokenType:e};n.push(r)}else l.has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):u.canMatchCharCode(c,e.PATTERN)&&(i=!0)}),t&&!i&&n.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:s.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),n},t.cloneEmptyGroups=function(e){var t={},r=l.keys(e);return l.forEach(r,function(r){var n=e[r];if(!l.isArray(n))throw Error("non exhaustive match");t[r]=[]}),t},t.isCustomPattern=M,t.isShortPattern=R,t.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,r=this.lastIndex;r<t;r++){var n=e.charCodeAt(r);if(10===n)return this.lastIndex=r+1,!0;if(13===n)return 10===e.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0},t.buildLineBreakIssueMessage=k},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(0),s=new a.RegExpParser,l="Complement Sets are not supported for first char optimization";function u(e){switch(e.type){case"Disjunction":return o.flatten(o.map(e.value,u));case"Alternative":for(var t=[],r=e.value,n=0;n<r.length;n++){var i=r[n];if(!o.contains(["GroupBackReference","Lookahead","NegativeLookahead","StartAnchor","EndAnchor","WordBoundary","NonWordBoundary"],i.type)){var a=i;switch(a.type){case"Character":t.push(a.value);break;case"Set":if(!0===a.complement)throw Error(l);o.forEach(a.value,function(e){if("number"==typeof e)t.push(e);else for(var r=e,n=r.from;n<=r.to;n++)t.push(n)});break;case"Group":var s=u(a.value);o.forEach(s,function(e){return t.push(e)});break;default:throw Error("Non Exhaustive Match")}var c=void 0!==a.quantifier&&0===a.quantifier.atLeast;if("Group"===a.type&&!1===d(a)||"Group"!==a.type&&!1===c)break}}return t;default:throw Error("non exhaustive match!")}}function c(e){var t=[];return o.forEach(e,function(e){t.push(e);var r=String.fromCharCode(e);r.toUpperCase()!==r?t.push(r.toUpperCase().charCodeAt(0)):r.toLowerCase()!==r&&t.push(r.toLowerCase().charCodeAt(0))}),t}function h(e,t){return o.find(e.value,function(e){if("number"==typeof e)return o.contains(t,e);var r=e;return void 0!==o.find(t,function(e){return r.from<=e&&e<=r.to})})}function d(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(o.isArray(e.value)?o.every(e.value,d):d(e.value))}t.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',t.getStartCodes=function(e,r){void 0===r&&(r=!1);try{var n=s.pattern(e.toString()),i=u(n.value);return n.flags.ignoreCase&&(i=c(i)),i}catch(n){if(n.message===l)r&&o.PRINT_WARNING(t.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var h="";r&&(h="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),o.PRINT_ERROR(t.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+a.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+h)}}return[]},t.firstChar=u,t.applyIgnoreCase=c;var f=function(e){function t(t){var r=e.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return i(t,e),t.prototype.visitChildren=function(t){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)},t.prototype.visitCharacter=function(e){o.contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===h(e,this.targetCharCodes)&&(this.found=!0):void 0!==h(e,this.targetCharCodes)&&(this.found=!0)},t}(a.BaseRegExpVisitor);t.canMatchCharCode=function(e,t){if(t instanceof RegExp){var r=s.pattern(t.toString()),n=new f(e);return n.visit(r),n.found}return void 0!==o.find(t,function(t){return o.contains(e,t.charCodeAt(0))})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){if(this.start=e,this.end=t,!i(e,t))throw new Error("INVALID RANGE")}return e.prototype.contains=function(e){return this.start<=e&&this.end>=e},e.prototype.containsRange=function(e){return this.start<=e.start&&this.end>=e.end},e.prototype.isContainedInRange=function(e){return e.containsRange(this)},e.prototype.strictlyContainsRange=function(e){return this.start<e.start&&this.end>e.end},e.prototype.isStrictlyContainedInRange=function(e){return e.strictlyContainsRange(this)},e}();function i(e,t){return!(e<0||t<e)}t.Range=n,t.isValidRange=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),o=r(0),s=r(5);t.resolveGrammar=function(e,t){var r=new l(e,t);return r.resolveRefs(),r.errors};var l=function(e){function t(t,r){var n=e.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return i(t,e),t.prototype.resolveRefs=function(){var e=this;o.forEach(this.nameToTopRule.values(),function(t){e.currTopLevel=t,t.accept(e)})},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule.get(e.nonTerminalName);if(t)e.referencedRule=t;else{var r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:a.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(s.GAstVisitor);t.GastRefResolverVisitor=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(0),a=r(3),o=r(9),s=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=i.has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:a.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=i.has(e,"maxLookahead")?e.maxLookahead:a.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=i.isES2015MapSupported()?new Map:[],i.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.lookAheadBuilderForOptional=function(e,t,r){return n.buildSingleAlternativeLookaheadFunction(e,t,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,r,i){return n.buildAlternativesLookAheadFunc(e,t,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return o.getKeyForAutomaticLookahead(r,e,t)},e.prototype.getLookaheadFuncForOr=function(e,t){var r=this.getKeyForAutomaticLookahead(o.OR_IDX,e),a=this.getLaFuncFromCache(r);if(void 0===a){var s=this.getCurrRuleFullName(),l=this.getGAstProductions().get(s),u=i.some(t,function(e){return i.isFunction(e.GATE)});return a=n.buildLookaheadFuncForOr(e,l,this.maxLookahead,u,this.dynamicTokensEnabled,this.lookAheadBuilderForAlternatives),this.setLaFuncCache(r,a),a}return a},e.prototype.getLookaheadFuncForOption=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.OPTION)},e.prototype.getLookaheadFuncForMany=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION)},e.prototype.getLookaheadFuncForManySep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.getLookaheadFuncForAtLeastOne=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY)},e.prototype.getLookaheadFuncForAtLeastOneSep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.getLookaheadFuncFor=function(e,t,r,i){var a=this.getLaFuncFromCache(e);if(void 0===a){var o=this.getCurrRuleFullName(),s=this.getGAstProductions().get(o);return a=n.buildLookaheadFuncForOptionalProd(t,s,r,this.dynamicTokensEnabled,i,this.lookAheadBuilderForOptional),this.setLaFuncCache(e,a),a}return a},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();t.LooksAhead=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16),i=r(0),a=r(33),o=r(9),s=r(3),l=function(){function e(){}return e.prototype.initTreeBuilder=function(e){this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=i.has(e,"outputCst")?e.outputCst:s.DEFAULT_PARSER_CONFIG.outputCst,this.outputCst||(this.cstInvocationStateUpdate=i.NOOP,this.cstFinallyStateUpdate=i.NOOP,this.cstPostTerminal=i.NOOP,this.cstPostNonTerminal=i.NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst)},e.prototype.cstNestedInvocationStateUpdate=function(e,t){this.CST_STACK.push({name:e,fullName:this.shortRuleNameToFull.get(this.getLastExplicitRuleShortName())+e,children:{}})},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1),this.CST_STACK.push({name:e,children:{}})},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];n.addTerminalToCst(r,t,e)},e.prototype.cstPostNonTerminal=function(e,t){n.addNoneTerminalToCst(this.CST_STACK[this.CST_STACK.length-1],t,e)},e.prototype.getBaseCstVisitorConstructor=function(){if(i.isUndefined(this.baseCstVisitorConstructor)){var e=a.createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(i.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=a.createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var r;return void 0!==e.NAME?(r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r):void 0},e.prototype.nestedAltBeforeClause=function(e,t,r,n){var i,a=this.getLastExplicitRuleShortName(),s=o.getKeyForAltIndex(a,r,t,n);return void 0!==e.NAME?(i=e.NAME,this.nestedRuleInvocationStateUpdate(i,s),{shortName:s,nestedName:i}):void 0},e.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,i=r[r.length-1];this.nestedRuleFinallyStateUpdate();var a=r[r.length-1];n.addNoneTerminalToCst(a,t,i)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}();t.TreeBuilder=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(0),a=r(4),o=r(11);function s(e,t){for(var r=i.keys(e),n=r.length,a=0;a<n;a++)for(var o=e[r[a]],s=o.length,l=0;l<s;l++){var u=o[l];void 0===u.tokenTypeIdx&&(void 0!==u.fullName?this[u.fullName](u.children,t):this[u.name](u.children,t))}}function l(e,t){var r=u(e,t),n=h(e,t);return r.concat(n)}function u(e,t){var r=i.map(t,function(t){if(!i.isFunction(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+a.functionName(e.constructor)+" CST Visitor.",type:n.MISSING_METHOD,methodName:t}});return i.compact(r)}t.defaultVisit=s,t.createBaseSemanticVisitorConstructor=function(e,t){var r=function(){};return a.defineNameProp(r,e+"BaseSemantics"),(r.prototype={visit:function(e,t){if(i.isArray(e)&&(e=e[0]),!i.isUndefined(e))return void 0!==e.fullName?this[e.fullName](e.children,t):this[e.name](e.children,t)},validateVisitor:function(){var e=l(this,t);if(!i.isEmpty(e)){var r=i.map(e,function(e){return e.msg});throw Error("Errors Detected in CST Visitor <"+a.functionName(this.constructor)+">:\n\t"+r.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=r,r._RULE_NAMES=t,r},t.createBaseVisitorConstructorWithDefaults=function(e,t,r){var n=function(){};a.defineNameProp(n,e+"BaseSemanticsWithDefaults");var o=Object.create(r.prototype);return i.forEach(t,function(e){o[e]=s}),(n.prototype=o).constructor=n,n},function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(n=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={})),t.validateVisitor=l,t.validateMissingCstMethods=u;var c=["constructor","visit","validateVisitor"];function h(e,t){var r=[];for(var s in e)o.validTermsPattern.test(s)&&i.isFunction(e[s])&&!i.contains(c,s)&&!i.contains(t,s)&&r.push({msg:"Redundant visitor method: <"+s+"> on "+a.functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+o.validTermsPattern.source+"/.",type:n.REDUNDANT_METHOD,methodName:s});return r}t.validateRedundantMethods=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):n.END_OF_FILE},e.prototype.LA=function(e){return this.currIdx+e<0||this.tokVectorLength<=this.currIdx+e?n.END_OF_FILE:this.tokVector[this.currIdx+e]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();t.LexerAdapter=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(6),a=r(3),o=r(10),s=r(23),l=r(11),u=r(1),c=function(){function e(){}return e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,r){if(void 0===r&&(r=a.DEFAULT_RULE_CONFIG),n.contains(this.definedRulesNames,e)){var i={message:o.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}if(this.definedRulesNames.push(e),!this.gastProductionsCache.containsKey(e)&&!this.serializedGrammar){var l=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,l)}var u=this.defineRule(e,t,r);return this[e]=u,u},e.prototype.OVERRIDE_RULE=function(e,t,r){void 0===r&&(r=a.DEFAULT_RULE_CONFIG);var n=[];if(n=n.concat(l.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n),!this.serializedGrammar){var i=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,i)}var o=this.defineRule(e,t,r);return this[e]=o,o},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(i.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return u.serializeGrammar(this.gastProductionsCache.values())},e}();t.RecognizerApi=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(9),a=r(6),o=r(12),s=r(13),l=r(3),u=r(25),c=r(2),h=r(7),d=r(4),f=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=d.classNameFromInstance(this),this.shortRuleNameToFull=new d.HashTable,this.fullRuleNameToShort=new d.HashTable,this.ruleShortNameIdx=256,this.tokenMatcher=h.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache=new d.HashTable,this.serializedGrammar=n.has(t,"serializedGrammar")?t.serializedGrammar:l.DEFAULT_PARSER_CONFIG.serializedGrammar,n.isArray(e)){if(n.isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(n.isArray(e))this.tokensMap=n.reduce(e,function(e,t){return e[c.tokenName(t)]=t,e},{});else if(n.has(e,"modes")&&n.every(n.flatten(n.values(e.modes)),h.isTokenType)){var r=n.flatten(n.values(e.modes)),i=n.uniq(r);this.tokensMap=n.reduce(i,function(e,t){return e[c.tokenName(t)]=t,e},{})}else{if(!n.isObject(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=n.cloneObj(e)}this.tokensMap.EOF=c.EOF;var a=n.every(n.values(e),function(e){return n.isEmpty(e.categoryMatches)});this.tokenMatcher=a?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,h.augmentTokenTypes(n.values(this.tokensMap))},e.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var o,s=n.has(r,"resyncEnabled")?r.resyncEnabled:l.DEFAULT_RULE_CONFIG.resyncEnabled,u=n.has(r,"recoveryValueFunc")?r.recoveryValueFunc:l.DEFAULT_RULE_CONFIG.recoveryValueFunc,c=this.ruleShortNameIdx<<i.BITS_FOR_METHOD_IDX+i.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull.put(c,e),this.fullRuleNameToShort.put(e,c),(o=function(r,n){return void 0===r&&(r=0),this.ruleInvocationStateUpdate(c,e,r),function(e){try{return!0===this.outputCst?(t.apply(this,e),this.CST_STACK[this.CST_STACK.length-1]):t.apply(this,e)}catch(e){var r=1===this.RULE_STACK.length,n=s&&!this.isBackTracking()&&this.recoveryEnabled;if(a.isRecognitionException(e)){if(n){var i,o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))return e.resyncedTokens=this.reSyncTo(o),this.outputCst?((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i):u();throw this.outputCst&&((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,e.partialCstResult=i),e}if(r)return this.moveToTerminatedState(),u();throw e}throw e}finally{this.ruleFinallyStateUpdate()}}.call(this,n)}).ruleName=e,o},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,r){var n,i,a=this,o=this.getLookaheadFuncForOption(r,t);if(void 0!==e.DEF){if(n=e.DEF,void 0!==(i=e.GATE)){var s=o;o=function(){return i.call(a)&&s.call(a)}}}else n=e;if(!0===o.call(this))return n.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var n,a,l=this,u=this.getLookaheadFuncForAtLeastOne(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var c=u;u=function(){return a.call(l)&&c.call(l)}}}else n=t;if(!0!==u.call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var h=this.doSingleRepetition(n);!0===u.call(this)&&!0===h;)h=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],u,i.AT_LEAST_ONE_IDX,e,s.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,l=t.SEP;if(!0!==this.getLookaheadFuncForAtLeastOneSep(r,e).call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);a.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),l)};!0===this.tokenMatcher(this.LA(1),l);)this.CONSUME(l),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,l,u,a,s.NextTerminalAfterAtLeastOneSepWalker],u,i.AT_LEAST_ONE_SEP_IDX,e,s.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var n,a,o=this,l=this.getLookaheadFuncForMany(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var u=l;l=function(){return a.call(o)&&u.call(o)}}}else n=t;for(var c=!0;!0===l.call(this)&&!0===c;)c=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],l,i.MANY_IDX,e,s.NextTerminalAfterManyWalker)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,o=t.SEP;if(!0===this.getLookaheadFuncForManySep(r,e).call(this)){a.call(this);for(var l=function(){return n.tokenMatcher(n.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,l,a,s.NextTerminalAfterManySepWalker],l,i.MANY_SEP_IDX,e,s.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,n,a){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,a],r,i.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,t){var r=n.isArray(e)?e:e.DEF,i=this.getLookaheadFuncForOr(t,r).call(this,r);if(void 0!==i)return r[i].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OR_IDX,t),a=this.nestedRuleBeforeClause(e,r);try{var o=n.isArray(e)?e:e.DEF,s=this.getLookaheadFuncForOr(t,o).call(this,o);if(void 0!==s){var l=o[s],u=this.nestedAltBeforeClause(l,t,i.OR_IDX,s);try{return l.ALT.call(this)}finally{void 0!==u&&this.nestedRuleFinallyClause(u.shortName,u.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{void 0!==a&&this.nestedRuleFinallyClause(r,a)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new a.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,r){var n;try{var i=void 0!==r?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),n}catch(t){throw a.isRecognitionException(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),delete t.partialCstResult),t}},e.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);if(!0!==this.tokenMatcher(i,e)){var o=void 0,s=this.LA(0);throw o=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:i,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new a.MismatchedTokenException(o,i,s))}this.consumeToken(),n=i}catch(r){if(!this.recoveryEnabled||"MismatchedTokenException"!==r.name||this.isBackTracking())throw r;var l=this.getFollowsForInRuleRecovery(e,t);try{n=this.tryInRuleRecovery(e,l)}catch(e){throw e.name===u.IN_RULE_RECOVERY_EXCEPTION?r:e}}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:e.tokenName,n),n},e.prototype.saveRecogState=function(){var e=this.errors,t=n.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return!n.isEmpty(this.isBackTrackingStack)},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull.get(e)},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull.get(e)},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),c.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();t.RecognizerEngine=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=r(0),a=r(12),o=r(3),s=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=i.defaults(e.errorMessageProvider,o.DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(n.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return i.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,r){for(var i=this.getCurrRuleFullName(),o=this.getGAstProductions().get(i),s=a.getLookaheadPathsForOptionalProd(e,o,t,this.maxLookahead)[0],l=[],u=1;u<this.maxLookahead;u++)l.push(this.LA(u));var c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:l,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new n.EarlyExitException(c,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),i=this.getGAstProductions().get(r),o=a.getLookaheadPathsForOr(e,i,this.maxLookahead),s=[],l=1;l<=this.maxLookahead;l++)s.push(this.LA(l));var u=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:u,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new n.NoViableAltException(c,this.LA(1),u))},e}();t.ErrorHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),i=r(0),a=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache.get(e);if(i.isUndefined(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return n.nextPossibleTokensAfter([r],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=i.first(e.ruleStack),r=this.getGAstProductions().get(t);return new n.NextAfterTokenWalker(r,e).startWalking()},e}();t.ContentAssist=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(17);t.createSyntaxDiagramsCode=function(e,t){var r=void 0===t?{}:t,i=r.resourceBase,a=void 0===i?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/":i,o=r.css;return"\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n\n<link rel='stylesheet' href='"+(void 0===o?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/diagrams.css":o)+"'>\n\n<script src='"+a+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+a+"src/diagrams_builder.js'><\/script>\n<script src='"+a+"src/diagrams_behavior.js'><\/script>\n<script src='"+a+'src/main.js\'><\/script>\n\n<div id="diagrams" align="center"></div>    \n\n<script>\n    window.serializedGrammar = '+JSON.stringify(e,null,"  ")+';\n<\/script>\n\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(41);t.generateParserFactory=function(e){var t=n.genWrapperFunction({name:e.name,rules:e.rules}),i=new Function("tokenVocabulary","config","chevrotain",t);return function(t){return i(e.tokenVocabulary,t,r(18))}},t.generateParserModule=function(e){return n.genUmdModule({name:e.name,rules:e.rules})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),a=r(1),o="\n";function s(e){return"\nfunction "+e.name+"(tokenVocabulary, config) {\n    // invoke super constructor\n    // No support for embedded actions currently, so we can 'hardcode'\n    // The use of CstParser.\n    chevrotain.CstParser.call(this, tokenVocabulary, config)\n\n    const $ = this\n\n    "+l(e.rules)+"\n\n    // very important to call this after all the rules have been defined.\n    // otherwise the parser may not work correctly as it will lack information\n    // derived during the self analysis phase.\n    this.performSelfAnalysis(this)\n}\n\n// inheritance as implemented in javascript in the previous decade... :(\n"+e.name+".prototype = Object.create(chevrotain.CstParser.prototype)\n"+e.name+".prototype.constructor = "+e.name+"    \n    "}function l(e){return n.map(e,function(e){return u(e,1)}).join("\n")}function u(e,t){var r=g(t,'$.RULE("'+e.name+'", function() {')+o;return r+=v(e.definition,t+1),r+=g(t+1,"})")+o}function c(e,t){var r=i.tokenName(e.terminalType);return g(t,"$.CONSUME"+e.idx+"(this.tokensMap."+r+")"+o)}function h(e,t){return g(t,"$.SUBRULE"+e.idx+"($."+e.nonTerminalName+")"+o)}function d(e,t){var r=g(t,"$.OR"+e.idx+"([")+o;return r+=n.map(e.definition,function(e){return f(e,t+1)}).join(","+o),r+=o+g(t,"])"+o)}function f(e,t){var r=g(t,"{")+o;return e.name&&(r+=g(t+1,'NAME: "'+e.name+'",')+o),r+=g(t+1,"ALT: function() {")+o,r+=v(e.definition,t+1),r+=g(t+1,"}")+o,r+=g(t,"}")}function p(e,t,r){var n=g(r,"$."+(e+t.idx)+"(");return t.name||t.separator?(n+="{"+o,t.name&&(n+=g(r+1,'NAME: "'+t.name+'"')+","+o),t.separator&&(n+=g(r+1,"SEP: this.tokensMap."+i.tokenName(t.separator))+","+o),n+="DEF: "+m(t.definition,r+2)+o,n+=g(r,"}")+o):n+=m(t.definition,r+1),n+=g(r,")")+o}function m(e,t){var r="function() {"+o;return r+=v(e,t),r+=g(t,"}")+o}function v(e,t){var r="";return n.forEach(e,function(e){r+=function(e,t){if(e instanceof a.NonTerminal)return h(e,t);if(e instanceof a.Option)return p("OPTION",e,t);if(e instanceof a.RepetitionMandatory)return p("AT_LEAST_ONE",e,t);if(e instanceof a.RepetitionMandatoryWithSeparator)return p("AT_LEAST_ONE_SEP",e,t);if(e instanceof a.RepetitionWithSeparator)return p("MANY_SEP",e,t);if(e instanceof a.Repetition)return p("MANY",e,t);if(e instanceof a.Alternation)return d(e,t);if(e instanceof a.Terminal)return c(e,t);if(e instanceof a.Flat)return v(e.definition,t);throw Error("non exhaustive match")}(e,t+1)}),r}function g(e,t){return Array(4*e+1).join(" ")+t}t.genUmdModule=function(e){return"\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['chevrotain'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('chevrotain'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(root.b);\n    }\n}(typeof self !== 'undefined' ? self : this, function (chevrotain) {\n\n"+s(e)+"\n    \nreturn {\n    "+e.name+": "+e.name+" \n}\n}));\n"},t.genWrapperFunction=function(e){return"    \n"+s(e)+"\nreturn new "+e.name+"(tokenVocabulary, config)    \n"},t.genClass=s,t.genAllRules=l,t.genRule=u,t.genTerminal=c,t.genNonTerminal=h,t.genAlternation=d,t.genSingleAlt=f}])},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||function(e,t,r){this.buffer=void 0===t&&void 0===r?new Uint8Array(e):new Uint8Array(e,t,r),this.index=0},n.lossless.DataStream.prototype.get16=function(){var e=(this.buffer[this.index]<<8)+this.buffer[this.index+1];return this.index+=2,e},n.lossless.DataStream.prototype.get8=function(){var e=this.buffer[this.index];return this.index+=1,e},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.DataStream)},function(e,t,r){(function(r){var n,i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:o.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[r[n]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a,o=new i;o.Group=i,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof self&&void 0!==r&&r.hrtime?o.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?o.now=self.performance.now.bind(self.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,n;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,n=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,n):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?i+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=i+(a-i)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],n):t>1?a(e[r],e[r-1],r-n):a(e[i],e[i+1>r?r:i+1],n-i)},Bezier:function(e,t){for(var r=0,n=e.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=n;s++)r+=i(1-t,n-s)*i(t,s)*e[s]*a(n,s);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(i=Math.floor(n=r*(1+t))),a(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(a(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):a(e[i?i-1:0],e[i],e[r<i+1?r:i+1],e[r<i+2?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=o.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(a=[1],function(e){var t=1;if(a[e])return a[e];for(var r=e;r>1;r--)t*=r;return a[e]=t,t}),CatmullRom:function(e,t,r,n,i){var a=.5*(r-e),o=.5*(n-t),s=i*i;return(2*t-2*r+a+o)*(i*s)+(-3*t+3*r-2*a-o)*s+a*i+t}}},void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}).call(this,r(6))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!c){var e=s(d);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.Utils=n.lossless.Utils||{},n.lossless.Utils.createArray=function(e){var t=new Array(e||0),r=e;if(arguments.length>1)for(var i=Array.prototype.slice.call(arguments,1);r--;)t[e-1-r]=n.lossless.Utils.createArray.apply(this,i);return t},n.lossless.Utils.makeCRCTable=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},n.lossless.Utils.crc32=function(e){for(var t=new Uint8Array(e.buffer),r=n.lossless.Utils.crcTable||(n.lossless.Utils.crcTable=n.lossless.Utils.makeCRCTable()),i=-1,a=0;a<t.length;a++)i=i>>>8^r[255&(i^t[a])];return(-1^i)>>>0},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.Utils)},function(e,t,r){(function(t){var r;e.exports=function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!l&&u)return r(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return a(r||e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,a,o,s,l,u="",c=0;c<e.length;)t=e.charCodeAt(c++),r=e.charCodeAt(c++),i=e.charCodeAt(c++),a=t>>2,o=(3&t)<<4|r>>4,s=(15&r)<<2|i>>6,l=63&i,isNaN(r)?s=l=64:isNaN(i)&&(l=64),u=u+n.charAt(a)+n.charAt(o)+n.charAt(s)+n.charAt(l);return u},r.decode=function(e){var t,r,i,a,o,s,l,u="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)a=n.indexOf(e.charAt(c++)),o=n.indexOf(e.charAt(c++)),s=n.indexOf(e.charAt(c++)),l=n.indexOf(e.charAt(c++)),t=a<<2|o>>4,r=(15&o)<<4|s>>2,i=(3&s)<<6|l,u+=String.fromCharCode(t),64!=s&&(u+=String.fromCharCode(r)),64!=l&&(u+=String.fromCharCode(i));return u}},{}],2:[function(e,t){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,r){"use strict";r.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},r.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){"use strict";var r=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==r.getTypeOf(e);void 0===t&&(t=0);var a=0;t^=-1;for(var o=0,s=e.length;s>o;o++)a=i?e[o]:e.charCodeAt(o),t=t>>>8^n[255&(t^a)];return-1^t}},{"./utils":21}],5:[function(e,t){"use strict";function r(){this.data=null,this.length=0,this.index=0}var n=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!1,r.date=null,r.compression=null,r.comment=null},{}],7:[function(e,t,r){"use strict";var n=e("./utils");r.string2binary=function(e){return n.string2binary(e)},r.string2Uint8Array=function(e){return n.transformTo("uint8array",e)},r.uint8Array2String=function(e){return n.transformTo("string",e)},r.string2Blob=function(e){var t=n.transformTo("arraybuffer",e);return n.arrayBuffer2Blob(t)},r.arrayBuffer2Blob=function(e){return n.arrayBuffer2Blob(e)},r.transformTo=function(e,t){return n.transformTo(e,t)},r.getTypeOf=function(e){return n.getTypeOf(e)},r.checkSupport=function(e){return n.checkSupport(e)},r.MAX_VALUE_16BITS=n.MAX_VALUE_16BITS,r.MAX_VALUE_32BITS=n.MAX_VALUE_32BITS,r.pretty=function(e){return n.pretty(e)},r.findCompression=function(e){return n.findCompression(e)},r.isRegExp=function(e){return n.isRegExp(e)}},{"./utils":21}],8:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako");r.uncompressInputType=n?"uint8array":"array",r.compressInputType=n?"uint8array":"array",r.magic="\b\0",r.compress=function(e){return i.deflateRaw(e)},r.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t){"use strict";function r(e,t){return this instanceof r?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(e,t)}var n=e("./base64");r.prototype=e("./object"),r.prototype.load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){"use strict";var r=e("./base64"),n=e("./zipEntries");t.exports=function(e,t){var i,a,o,s;for((t=t||{}).base64&&(e=r.decode(e)),a=new n(e,t),i=a.files,o=0;o<i.length;o++)s=i[o],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:t.createFolders});return a.zipComment.length&&(this.comment=a.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,r){(function(e){"use strict";r.exports=function(t,r){return new e(t,r)},r.exports.test=function(t){return e.isBuffer(t)}}).call(this,void 0!==t?t:void 0)},{}],12:[function(e,t){"use strict";function r(e){this.data=e,this.length=this.data.length,this.index=0}var n=e("./uint8ArrayReader");r.prototype=new n,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t){"use strict";var r=e("./support"),n=e("./utils"),i=e("./crc32"),a=e("./signature"),o=e("./defaults"),s=e("./base64"),l=e("./compressions"),u=e("./compressedObject"),c=e("./nodeBuffer"),h=e("./utf8"),d=e("./stringWriter"),f=e("./uint8ArrayWriter"),p=function(e){if(e._data instanceof u&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},m=function(e){var t=p(e),i=n.getTypeOf(t);return"string"===i?!e.options.binary&&r.nodebuffer?c(t,"utf-8"):e.asBinary():t},v=function(e){var t=p(this);return null==t?"":(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?M.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",M.utf8encode(t))),t)},g=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this._data=t,this.options=r,this._initialMetadata={dir:r.dir,date:r.date}};g.prototype={asText:function(){return v.call(this,!0)},asBinary:function(){return v.call(this,!1)},asNodeBuffer:function(){var e=m(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=m(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var y=function(e,t){var r,n="";for(r=0;t>r;r++)n+=String.fromCharCode(255&e),e>>>=8;return n},_=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},b=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=_(e,o)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},E=function(e,t,r){var i,a=n.getTypeOf(t);if((r=b(r)).createFolders&&(i=w(e))&&x.call(this,i,!0),r.dir||null==t)r.base64=!1,r.binary=!1,t=null;else if("string"===a)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=n.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(a||t instanceof u))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===a&&(t=n.transformTo("uint8array",t))}var o=new g(e,t,r);return this.files[e]=o,o},w=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},x=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t=void 0!==t&&t,this.files[e]||E.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},T=function(e,t){var r,a=new u;return e._data instanceof u?(a.uncompressedSize=e._data.uncompressedSize,a.crc32=e._data.crc32,0===a.uncompressedSize||e.dir?(t=l.STORE,a.compressedContent="",a.crc32=0):e._data.compressionMethod===t.magic?a.compressedContent=e._data.getCompressedContent():(r=e._data.getContent(),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r)))):((!(r=m(e))||0===r.length||e.dir)&&(t=l.STORE,r=""),a.uncompressedSize=r.length,a.crc32=i(r),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r))),a.compressedSize=a.compressedContent.length,a.compressionMethod=t.magic,a},S=function(e,t,r,o){var s,l,u,c,d=(r.compressedContent,n.transformTo("string",h.utf8encode(t.name))),f=t.comment||"",p=n.transformTo("string",h.utf8encode(f)),m=d.length!==t.name.length,v=p.length!==f.length,g=t.options,_="",b="",E="";u=t._initialMetadata.dir!==t.dir?t.dir:g.dir,c=t._initialMetadata.date!==t.date?t.date:g.date,s=c.getHours(),s<<=6,s|=c.getMinutes(),s<<=5,s|=c.getSeconds()/2,l=c.getFullYear()-1980,l<<=4,l|=c.getMonth()+1,l<<=5,l|=c.getDate(),m&&(b=y(1,1)+y(i(d),4)+d,_+="up"+y(b.length,2)+b),v&&(E=y(1,1)+y(this.crc32(p),4)+p,_+="uc"+y(E.length,2)+E);var w="";w+="\n\0",w+=m||v?"\0\b":"\0\0",w+=r.compressionMethod,w+=y(s,2),w+=y(l,2),w+=y(r.crc32,4),w+=y(r.compressedSize,4),w+=y(r.uncompressedSize,4),w+=y(d.length,2),w+=y(_.length,2);var x=a.LOCAL_FILE_HEADER+w+d+_,T=a.CENTRAL_FILE_HEADER+"\0"+w+y(p.length,2)+"\0\0\0\0"+(!0===u?"\0\0\0":"\0\0\0\0")+y(o,4)+d+_+p;return{fileRecord:x,dirRecord:T,compressedObject:r}},M={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,n,i,a=[];for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],i=new g(n.name,n._data,_(n.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(r,i)&&a.push(i));return a},file:function(e,t,r){if(1===arguments.length){if(n.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}return this.filter(function(t,r){return!r.dir&&t===e})[0]||null}return e=this.root+e,E.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter(function(t,r){return r.dir&&e.test(t)});var t=this.root+e,r=x.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(t,r){return r.name.slice(0,e.length)===e}),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){e=_(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),n.checkSupport(e.type);var t,r,i=[],o=0,u=0,c=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var h in this.files)if(this.files.hasOwnProperty(h)){var p=this.files[h],m=p.options.compression||e.compression.toUpperCase(),v=l[m];if(!v)throw new Error(m+" is not a valid compression method !");var g=T.call(this,p,v),b=S.call(this,h,p,g,o);o+=b.fileRecord.length+g.compressedSize,u+=b.dirRecord.length,i.push(b)}var E="";E=a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+y(i.length,2)+y(i.length,2)+y(u,4)+y(o,4)+y(c.length,2)+c;var w=e.type.toLowerCase();for(t="uint8array"===w||"arraybuffer"===w||"blob"===w||"nodebuffer"===w?new f(o+u+E.length):new d(o+u+E.length),r=0;r<i.length;r++)t.append(i[r].fileRecord),t.append(i[r].compressedObject.compressedContent);for(r=0;r<i.length;r++)t.append(i[r].dirRecord);t.append(E);var x=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),x);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",x));case"base64":return e.base64?s.encode(x):x;default:return x}},crc32:function(e,t){return i(e,t)},utf8encode:function(e){return n.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=M},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t){"use strict";function r(e,t){this.data=e,t||(this.data=i.string2binary(this.data)),this.length=this.data.length,this.index=0}var n=e("./dataReader"),i=e("./utils");r.prototype=new n,r.prototype.byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,t){"use strict";var r=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":21}],17:[function(e,r,n){(function(e){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==e,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new r;i.append(t),n.blob=0===i.getBlob("application/zip").size}catch(e){n.blob=!1}}}}).call(this,void 0!==t?t:void 0)},{}],18:[function(e,t){"use strict";function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var n=e("./dataReader");r.prototype=new n,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===n&&this.data[a+3]===i)return a;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t){"use strict";var r=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":21}],20:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),a=e("./nodeBuffer"),o=new Array(256),s=0;256>s;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;o[254]=o[254]=1;var l=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+o[e[r]]>t?r:t},u=function(e){var t,r,i,a,s=e.length,l=new Array(2*s);for(r=0,t=0;s>t;)if(128>(i=e[t++]))l[r++]=i;else if((a=o[i])>4)l[r++]=65533,t+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&s>t;)i=i<<6|63&e[t++],a--;a>1?l[r++]=65533:65536>i?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)};r.utf8encode=function(e){return i.nodebuffer?a(e,"utf-8"):function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t}(e)},r.utf8decode=function(e){if(i.nodebuffer)return n.transformTo("nodebuffer",e).toString("utf-8");e=n.transformTo(i.uint8array?"uint8array":"array",e);for(var t=[],r=0,a=e.length;a>r;){var o=l(e,Math.min(r+65536,a));t.push(i.uint8array?u(e.subarray(r,o)):u(e.slice(r,o))),r=o}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,r){"use strict";function n(e){return e}function i(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function a(e){var t=65536,n=[],i=e.length,a=r.getTypeOf(e),o=0,s=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,u(0))}}catch(e){s=!1}if(!s){for(var l="",c=0;c<e.length;c++)l+=String.fromCharCode(e[c]);return l}for(;i>o&&t>1;)try{n.push("array"===a||"nodebuffer"===a?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,i))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,i)))),o+=t}catch(e){t=Math.floor(t/2)}return n.join("")}function o(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var s=e("./support"),l=e("./compressions"),u=e("./nodeBuffer");r.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},r.arrayBuffer2Blob=function(e){r.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(r){try{var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=new t;return n.append(e),n.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},r.applyFromCharCode=a;var c={};c.string={string:n,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,u(e.length))}},c.array={string:a,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(e)}},c.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(new Uint8Array(e))}},c.uint8array={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return u(e)}},c.nodebuffer={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:n},r.transformTo=function(e,t){if(t||(t=""),!e)return t;r.checkSupport(e);var n=r.getTypeOf(t),i=c[n][e](t);return i},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&u.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){var t=s[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)t=e.charCodeAt(r),n+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return n},r.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){"use strict";function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var n=e("./stringReader"),i=e("./nodeBufferReader"),a=e("./uint8ArrayReader"),o=e("./utils"),s=e("./signature"),l=e("./zipEntry"),u=e("./support"),c=e("./object");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=c.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;n>0;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);this.reader="string"!==t||u.uint8array?"nodebuffer"===t?new i(e):new a(o.transformTo("uint8array",e)):new n(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var n=e("./stringReader"),i=e("./utils"),a=e("./compressedObject"),o=e("./object");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,r){return function(){var n=e.index;e.setIndex(t);var i=e.readData(r);return e.setIndex(n),i}},prepareContent:function(e,t,r,n,a){return function(){var e=i.transformTo(n.uncompressInputType,this.getCompressedContent()),t=n.uncompress(e);if(t.length!==a)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(r),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=i.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new a,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=i.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),n=e.readString(r),this.extraFields[t]={id:t,length:r,value:n}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){"use strict";var r=e("./lib/utils/common").assign,n=e("./lib/deflate"),i=e("./lib/inflate"),a=e("./lib/zlib/constants"),o={};r(o,n,i,a),t.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,r){"use strict";function n(e,t){var r=new u(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/deflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/messages"),l=e("./zlib/zstream"),u=function(e){this.options=a.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(s[r]);t.header&&i.deflateSetHeader(this.strm,t.header)};u.prototype.push=function(e,t){var r,n,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,s.input="string"==typeof e?o.string2buf(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=i.deflate(s,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;(0===s.avail_out||0===s.avail_in&&4===n)&&this.onData("string"===this.options.to?o.buf2binstring(a.shrinkBuf(s.output,s.next_out)):a.shrinkBuf(s.output,s.next_out))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4!==n||(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=u,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,r){"use strict";function n(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/inflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/constants"),l=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),h=function(e){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,t.windowBits);if(r!==s.Z_OK)throw new Error(l[r]);this.header=new c,i.inflateGetHeader(this.strm,this.header)};h.prototype.push=function(e,t){var r,n,l,u,c,h=this.strm,d=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,h.input="string"==typeof e?o.binstring2buf(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),(r=i.inflate(h,s.Z_NO_FLUSH))!==s.Z_STREAM_END&&r!==s.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0===h.avail_out||r===s.Z_STREAM_END||0===h.avail_in&&n===s.Z_FINISH)&&("string"===this.options.to?(l=o.utf8border(h.output,h.next_out),u=h.next_out-l,c=o.buf2string(h.output,l),h.next_out=u,h.avail_out=d-u,u&&a.arraySet(h.output,h.output,l,u,0),this.onData(c)):this.onData(a.shrinkBuf(h.output,h.next_out)))}while(h.avail_in>0&&r!==s.Z_STREAM_END);return r===s.Z_STREAM_END&&(n=s.Z_FINISH),n!==s.Z_FINISH||(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===s.Z_OK)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===s.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=h,r.inflate=n,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.ungzip=n},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;r>t;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;r>t;t++)a=e[t],o.set(a,i),i+=a.length;return o}},a={arraySet:function(e,t,r,n,i){for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],28:[function(e,t,r){"use strict";function n(e,t){if(65537>t&&(e.subarray&&o||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",n=0;t>n;n++)r+=String.fromCharCode(e[n]);return r}var i=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new i.Buf8(256),l=0;256>l;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,r.string2buf=function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=new i.Buf8(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},r.buf2binstring=function(e){return n(e,e.length)},r.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;n>r;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,i,a,o,l=t||e.length,u=new Array(2*l);for(i=0,r=0;l>r;)if(128>(a=e[r++]))u[i++]=a;else if((o=s[a])>4)u[i++]=65533,r+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&l>r;)a=a<<6|63&e[r++],o--;o>1?u[i++]=65533:65536>a?u[i++]=a:(a-=65536,u[i++]=55296|a>>10&1023,u[i++]=56320|1023&a)}return n(u,i)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+s[e[r]]>t?r:t}},{"./common":27}],29:[function(e,t){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{i=i+t[n++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){"use strict";var r=function(){for(var e,t=[],r=0;256>r;r++){e=r;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;o>s;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},{}],32:[function(e,t,r){"use strict";function n(e,t){return e.msg=M[t],t}function i(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(w.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function s(e,t){x._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,w.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=T(e.adler,t,i,r):2===e.state.wrap&&(e.adler=S(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function h(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-te?e.strstart-(e.w_size-te):0,u=e.window,c=e.w_mask,h=e.prev,d=e.strstart+ee,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===f&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&d>a);if(n=ee-(d-a),a=d-ee,n>o){if(e.match_start=t,o=n,n>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=h[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function d(e){var t,r,n,i,a,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-te)){w.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,r=e.hash_size,t=r;do{n=e.head[--t],e.head[t]=n>=o?n-o:0}while(--r);t=r=o;do{n=e.prev[--t],e.prev[t]=n>=o?n-o:0}while(--r);i+=o}if(0===e.strm.avail_in)break;if(r=c(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=$)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+$-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<$)););}while(e.lookahead<te&&0!==e.strm.avail_in)}function f(e,t){for(var r,n;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===R)return ce;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r)),e.match_length>=$)if(n=x._tr_tally(e,e.strstart-e.match_start,e.match_length-$),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=$){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=x._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=e.strstart<$-1?e.strstart:$-1,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function p(e,t){for(var r,n,i;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===R)return ce;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=$-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r),e.match_length<=5&&(e.strategy===F||e.match_length===$&&e.strstart-e.match_start>4096)&&(e.match_length=$-1)),e.prev_length>=$&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-$,n=x._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-$),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=$-1,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return ce}else if(e.match_available){if((n=x._tr_tally(e,0,e.window[e.strstart-1]))&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ce}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=x._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<$-1?e.strstart:$-1,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function m(e,t){for(var r,n,i,a,o=e.window;;){if(e.lookahead<=ee){if(d(e),e.lookahead<=ee&&t===R)return ce;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=$&&e.strstart>0&&(i=e.strstart-1,(n=o[i])===o[++i]&&n===o[++i]&&n===o[++i])){a=e.strstart+ee;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&a>i);e.match_length=ee-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=$?(r=x._tr_tally(e,1,e.match_length-$),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=x._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function v(e,t){for(var r;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===R)return ce;break}if(e.match_length=0,r=x._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function g(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=G,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new w.Buf16(2*K),this.dyn_dtree=new w.Buf16(2*(2*Z+1)),this.bl_tree=new w.Buf16(2*(2*J+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new w.Buf16(Q+1),this.heap=new w.Buf16(2*q+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new w.Buf16(2*q+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=V,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ne:le,e.adler=2===t.wrap?0:1,t.last_flush=R,x._tr_init(t),L):n(e,O)}function _(e){var t=y(e);return t===L&&function(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=E[e.level].max_lazy,e.good_match=E[e.level].good_length,e.nice_match=E[e.level].nice_length,e.max_chain_length=E[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=$-1,e.match_available=0,e.ins_h=0}(e.state),t}function b(e,t,r,i,a,o){if(!e)return O;var s=1;if(t===N&&(t=6),0>i?(s=0,i=-i):i>15&&(s=2,i-=16),1>a||a>W||r!==G||8>i||i>15||0>t||t>9||0>o||o>z)return n(e,O);8===i&&(i=9);var l=new g;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+$-1)/$),l.window=new w.Buf8(2*l.w_size),l.head=new w.Buf16(l.hash_size),l.prev=new w.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new w.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,_(e)}var E,w=e("../utils/common"),x=e("./trees"),T=e("./adler32"),S=e("./crc32"),M=e("./messages"),R=0,A=1,k=3,P=4,C=5,L=0,I=1,O=-2,H=-3,D=-5,N=-1,F=1,U=2,B=3,z=4,j=0,V=2,G=8,W=9,X=15,Y=8,q=286,Z=30,J=19,K=2*q+1,Q=15,$=3,ee=258,te=ee+$+1,re=32,ne=42,ie=69,ae=73,oe=91,se=103,le=113,ue=666,ce=1,he=2,de=3,fe=4,pe=3,me=function(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i};E=[new me(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===R)return ce;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,s(e,!1),0===e.strm.avail_out))return ce;if(e.strstart-e.block_start>=e.w_size-te&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):(e.strstart>e.block_start&&(s(e,!1),e.strm.avail_out),ce)}),new me(4,4,8,4,f),new me(4,5,16,8,f),new me(4,6,32,32,f),new me(4,4,16,16,p),new me(8,16,32,32,p),new me(8,16,128,128,p),new me(8,32,128,256,p),new me(32,128,258,1024,p),new me(32,258,258,4096,p)],r.deflateInit=function(e,t){return b(e,t,G,X,Y,j)},r.deflateInit2=b,r.deflateReset=_,r.deflateResetKeep=y,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?O:(e.state.gzhead=t,L):O},r.deflate=function(e,t){var r,s,c,h;if(!e||!e.state||t>C||0>t)return e?n(e,O):O;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ue&&t!==P)return n(e,0===e.avail_out?D:O);if(s.strm=e,r=s.last_flush,s.last_flush=t,s.status===ne)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=S(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=ie):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,pe),s.status=le);else{var d=G+(s.w_bits-8<<4)<<8,f=-1;f=s.strategy>=U||s.level<2?0:s.level<6?1:6===s.level?2:3,d|=f<<6,0!==s.strstart&&(d|=re),d+=31-d%31,s.status=le,u(s,d),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(s.status===ie)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=ae)}else s.status=ae;if(s.status===ae)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.gzindex=0,s.status=oe)}else s.status=oe;if(s.status===oe)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.status=se)}else s.status=se;if(s.status===se&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=le)):s.status=le),0!==s.pending){if(o(e),0===e.avail_out)return s.last_flush=-1,L}else if(0===e.avail_in&&i(t)<=i(r)&&t!==P)return n(e,D);if(s.status===ue&&0!==e.avail_in)return n(e,D);if(0!==e.avail_in||0!==s.lookahead||t!==R&&s.status!==ue){var p=s.strategy===U?v(s,t):s.strategy===B?m(s,t):E[s.level].func(s,t);if((p===de||p===fe)&&(s.status=ue),p===ce||p===de)return 0===e.avail_out&&(s.last_flush=-1),L;if(p===he&&(t===A?x._tr_align(s):t!==C&&(x._tr_stored_block(s,0,0,!1),t===k&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(e),0===e.avail_out))return s.last_flush=-1,L}return t!==P?L:s.wrap<=0?I:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),o(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?L:I)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ne&&t!==ie&&t!==ae&&t!==oe&&t!==se&&t!==le&&t!==ue?n(e,O):(e.state=null,t===le?n(e,H):L):O},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(e,t){"use strict";t.exports=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,v,g,y,_,b,E,w,x,T,S,M;r=e.state,n=e.next_in,S=e.input,i=n+(e.avail_in-5),a=e.next_out,M=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,d=r.window,f=r.hold,p=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{15>p&&(f+=S[n++]<<p,p+=8,f+=S[n++]<<p,p+=8),_=m[f&g];t:for(;;){if(f>>>=b=_>>>24,p-=b,0==(b=_>>>16&255))M[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&_,(b&=15)&&(b>p&&(f+=S[n++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),15>p&&(f+=S[n++]<<p,p+=8,f+=S[n++]<<p,p+=8),_=v[f&y];r:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=v[(65535&_)+(f&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&_,(b&=15)>p&&(f+=S[n++]<<p,b>(p+=8)&&(f+=S[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=0,T=d,0===h){if(x+=u-b,E>b){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}else if(b>h){if(x+=u+h-b,E>(b-=h)){E-=b;do{M[a++]=d[x++]}while(--b);if(x=0,E>h){E-=b=h;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}}else if(x+=h-b,E>b){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}for(;E>2;)M[a++]=T[x++],M[a++]=T[x++],M[a++]=T[x++],E-=3;E&&(M[a++]=T[x++],E>1&&(M[a++]=T[x++]))}else{x=a-w;do{M[a++]=M[x++],M[a++]=M[x++],M[a++]=M[x++],E-=3}while(E>2);E&&(M[a++]=M[x++],E>1&&(M[a++]=M[x++]))}break}}break}}while(i>n&&s>a);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=i>n?i-n+5:5-(n-i),e.avail_out=s>a?s-a+257:257-(a-s),r.hold=f,r.bits=p}},{}],35:[function(e,t,r){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=C,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(ue),t.distcode=t.distdyn=new d.Buf32(ce),t.sane=1,t.back=-1,x):M}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):M}function s(e,t){var r,n;return e&&e.state?(n=e.state,0>t?(r=0,t=-t):(r=1+(t>>4),48>t&&(t&=15)),t&&(8>t||t>15)?M:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):M}function l(e,t){var r,n;return e?(n=new i,e.state=n,n.window=null,(r=s(e,t))!==x&&(e.state=null),r):M}function u(e){if(de){var t;for(c=new d.Buf32(512),h=new d.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(v(y,e.lens,0,288,c,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;v(_,e.lens,0,32,h,0,e.work,{bits:5}),de=!1}e.lencode=c,e.lenbits=9,e.distcode=h,e.distbits=5}var c,h,d=e("../utils/common"),f=e("./adler32"),p=e("./crc32"),m=e("./inffast"),v=e("./inftrees"),g=0,y=1,_=2,b=4,E=5,w=6,x=0,T=1,S=2,M=-2,R=-3,A=-4,k=-5,P=8,C=1,L=2,I=3,O=4,H=5,D=6,N=7,F=8,U=9,B=10,z=11,j=12,V=13,G=14,W=15,X=16,Y=17,q=18,Z=19,J=20,K=21,Q=22,$=23,ee=24,te=25,re=26,ne=27,ie=28,ae=29,oe=30,se=31,le=32,ue=852,ce=592,he=15,de=!0;r.inflateReset=o,r.inflateReset2=s,r.inflateResetKeep=a,r.inflateInit=function(e){return l(e,he)},r.inflateInit2=l,r.inflate=function(e,t){var r,i,a,o,s,l,c,h,ue,ce,he,de,fe,pe,me,ve,ge,ye,_e,be,Ee,we,xe,Te,Se=0,Me=new d.Buf8(4),Re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return M;(r=e.state).mode===j&&(r.mode=V),s=e.next_out,a=e.output,c=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ue=r.bits,ce=l,he=c,we=x;e:for(;;)switch(r.mode){case C:if(0===r.wrap){r.mode=V;break}for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(2&r.wrap&&35615===h){r.check=0,Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0),h=0,ue=0,r.mode=L;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",r.mode=oe;break}if((15&h)!==P){e.msg="unknown compression method",r.mode=oe;break}if(ue-=4,Ee=8+(15&(h>>>=4)),0===r.wbits)r.wbits=Ee;else if(Ee>r.wbits){e.msg="invalid window size",r.mode=oe;break}r.dmax=1<<Ee,e.adler=r.check=1,r.mode=512&h?B:j,h=0,ue=0;break;case L:for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(r.flags=h,(255&r.flags)!==P){e.msg="unknown compression method",r.mode=oe;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=oe;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0)),h=0,ue=0,r.mode=I;case I:for(;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.head&&(r.head.time=h),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,Me[2]=h>>>16&255,Me[3]=h>>>24&255,r.check=p(r.check,Me,4,0)),h=0,ue=0,r.mode=O;case O:for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0)),h=0,ue=0,r.mode=H;case H:if(1024&r.flags){for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0)),h=0,ue=0}else r.head&&(r.head.extra=null);r.mode=D;case D:if(1024&r.flags&&((de=r.length)>l&&(de=l),de&&(r.head&&(Ee=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),d.arraySet(r.head.extra,i,o,de,Ee)),512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,r.length-=de),r.length))break e;r.length=0,r.mode=N;case N:if(2048&r.flags){if(0===l)break e;de=0;do{Ee=i[o+de++],r.head&&Ee&&r.length<65536&&(r.head.name+=String.fromCharCode(Ee))}while(Ee&&l>de);if(512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,Ee)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=F;case F:if(4096&r.flags){if(0===l)break e;de=0;do{Ee=i[o+de++],r.head&&Ee&&r.length<65536&&(r.head.comment+=String.fromCharCode(Ee))}while(Ee&&l>de);if(512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,Ee)break e}else r.head&&(r.head.comment=null);r.mode=U;case U:if(512&r.flags){for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(h!==(65535&r.check)){e.msg="header crc mismatch",r.mode=oe;break}h=0,ue=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=j;break;case B:for(;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}e.adler=r.check=n(h),h=0,ue=0,r.mode=z;case z:if(0===r.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ue,S;e.adler=r.check=1,r.mode=j;case j:if(t===E||t===w)break e;case V:if(r.last){h>>>=7&ue,ue-=7&ue,r.mode=ne;break}for(;3>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}switch(r.last=1&h,ue-=1,3&(h>>>=1)){case 0:r.mode=G;break;case 1:if(u(r),r.mode=J,t===w){h>>>=2,ue-=2;break e}break;case 2:r.mode=Y;break;case 3:e.msg="invalid block type",r.mode=oe}h>>>=2,ue-=2;break;case G:for(h>>>=7&ue,ue-=7&ue;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",r.mode=oe;break}if(r.length=65535&h,h=0,ue=0,r.mode=W,t===w)break e;case W:r.mode=X;case X:if(de=r.length){if(de>l&&(de=l),de>c&&(de=c),0===de)break e;d.arraySet(a,i,o,de,s),l-=de,o+=de,c-=de,s+=de,r.length-=de;break}r.mode=j;break;case Y:for(;14>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(r.nlen=257+(31&h),h>>>=5,ue-=5,r.ndist=1+(31&h),h>>>=5,ue-=5,r.ncode=4+(15&h),h>>>=4,ue-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=oe;break}r.have=0,r.mode=q;case q:for(;r.have<r.ncode;){for(;3>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.lens[Re[r.have++]]=7&h,h>>>=3,ue-=3}for(;r.have<19;)r.lens[Re[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,xe={bits:r.lenbits},we=v(g,r.lens,0,19,r.lencode,0,r.work,xe),r.lenbits=xe.bits,we){e.msg="invalid code lengths set",r.mode=oe;break}r.have=0,r.mode=Z;case Z:for(;r.have<r.nlen+r.ndist;){for(;Se=r.lencode[h&(1<<r.lenbits)-1],ve=Se>>>16&255,ge=65535&Se,!(ue>=(me=Se>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(16>ge)h>>>=me,ue-=me,r.lens[r.have++]=ge;else{if(16===ge){for(Te=me+2;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(h>>>=me,ue-=me,0===r.have){e.msg="invalid bit length repeat",r.mode=oe;break}Ee=r.lens[r.have-1],de=3+(3&h),h>>>=2,ue-=2}else if(17===ge){for(Te=me+3;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}ue-=me,Ee=0,de=3+(7&(h>>>=me)),h>>>=3,ue-=3}else{for(Te=me+7;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}ue-=me,Ee=0,de=11+(127&(h>>>=me)),h>>>=7,ue-=7}if(r.have+de>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=oe;break}for(;de--;)r.lens[r.have++]=Ee}}if(r.mode===oe)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=oe;break}if(r.lenbits=9,xe={bits:r.lenbits},we=v(y,r.lens,0,r.nlen,r.lencode,0,r.work,xe),r.lenbits=xe.bits,we){e.msg="invalid literal/lengths set",r.mode=oe;break}if(r.distbits=6,r.distcode=r.distdyn,xe={bits:r.distbits},we=v(_,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,xe),r.distbits=xe.bits,we){e.msg="invalid distances set",r.mode=oe;break}if(r.mode=J,t===w)break e;case J:r.mode=K;case K:if(l>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ue,m(e,he),s=e.next_out,a=e.output,c=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ue=r.bits,r.mode===j&&(r.back=-1);break}for(r.back=0;Se=r.lencode[h&(1<<r.lenbits)-1],ve=Se>>>16&255,ge=65535&Se,!(ue>=(me=Se>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(ve&&0==(240&ve)){for(ye=me,_e=ve,be=ge;Se=r.lencode[be+((h&(1<<ye+_e)-1)>>ye)],ve=Se>>>16&255,ge=65535&Se,!(ue>=ye+(me=Se>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}h>>>=ye,ue-=ye,r.back+=ye}if(h>>>=me,ue-=me,r.back+=me,r.length=ge,0===ve){r.mode=re;break}if(32&ve){r.back=-1,r.mode=j;break}if(64&ve){e.msg="invalid literal/length code",r.mode=oe;break}r.extra=15&ve,r.mode=Q;case Q:if(r.extra){for(Te=r.extra;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,ue-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=$;case $:for(;Se=r.distcode[h&(1<<r.distbits)-1],ve=Se>>>16&255,ge=65535&Se,!(ue>=(me=Se>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(0==(240&ve)){for(ye=me,_e=ve,be=ge;Se=r.distcode[be+((h&(1<<ye+_e)-1)>>ye)],ve=Se>>>16&255,ge=65535&Se,!(ue>=ye+(me=Se>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}h>>>=ye,ue-=ye,r.back+=ye}if(h>>>=me,ue-=me,r.back+=me,64&ve){e.msg="invalid distance code",r.mode=oe;break}r.offset=ge,r.extra=15&ve,r.mode=ee;case ee:if(r.extra){for(Te=r.extra;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,ue-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=oe;break}r.mode=te;case te:if(0===c)break e;if(de=he-c,r.offset>de){if((de=r.offset-de)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=oe;break}de>r.wnext?(de-=r.wnext,fe=r.wsize-de):fe=r.wnext-de,de>r.length&&(de=r.length),pe=r.window}else pe=a,fe=s-r.offset,de=r.length;de>c&&(de=c),c-=de,r.length-=de;do{a[s++]=pe[fe++]}while(--de);0===r.length&&(r.mode=K);break;case re:if(0===c)break e;a[s++]=r.length,c--,r.mode=K;break;case ne:if(r.wrap){for(;32>ue;){if(0===l)break e;l--,h|=i[o++]<<ue,ue+=8}if(he-=c,e.total_out+=he,r.total+=he,he&&(e.adler=r.check=r.flags?p(r.check,a,he,s-he):f(r.check,a,he,s-he)),he=c,(r.flags?h:n(h))!==r.check){e.msg="incorrect data check",r.mode=oe;break}h=0,ue=0}r.mode=ie;case ie:if(r.wrap&&r.flags){for(;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(h!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=oe;break}h=0,ue=0}r.mode=ae;case ae:we=T;break e;case oe:we=R;break e;case se:return A;case le:default:return M}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ue,(r.wsize||he!==e.avail_out&&r.mode<oe&&(r.mode<ne||t!==b))&&function(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new d.Buf8(a.wsize)),n>=a.wsize?(d.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),d.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(d.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}(e,e.output,e.next_out,he-e.avail_out)?(r.mode=se,A):(ce-=e.avail_in,he-=e.avail_out,e.total_in+=ce,e.total_out+=he,r.total+=he,r.wrap&&he&&(e.adler=r.check=r.flags?p(r.check,a,he,e.next_out-he):f(r.check,a,he,e.next_out-he)),e.data_type=r.bits+(r.last?64:0)+(r.mode===j?128:0)+(r.mode===J||r.mode===W?256:0),(0===ce&&0===he||t===b)&&we===x&&(we=k),we)},r.inflateEnd=function(e){if(!e||!e.state)return M;var t=e.state;return t.window&&(t.window=null),e.state=null,x},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?M:(r.head=t,t.done=!1,x):M},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){"use strict";var r=e("../utils/common"),n=15,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,l,u,c,h,d,f){var p,m,v,g,y,_,b,E,w,x=f.bits,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=null,H=0,D=new r.Buf16(16),N=new r.Buf16(16),F=null,U=0;for(T=0;n>=T;T++)D[T]=0;for(S=0;u>S;S++)D[t[l+S]]++;for(A=x,R=n;R>=1&&0===D[R];R--);if(A>R&&(A=R),0===R)return c[h++]=20971520,c[h++]=20971520,f.bits=1,0;for(M=1;R>M&&0===D[M];M++);for(M>A&&(A=M),C=1,T=1;n>=T;T++)if(C<<=1,0>(C-=D[T]))return-1;if(C>0&&(0===e||1!==R))return-1;for(N[1]=0,T=1;n>T;T++)N[T+1]=N[T]+D[T];for(S=0;u>S;S++)0!==t[l+S]&&(d[N[t[l+S]]++]=S);if(0===e?(O=F=d,_=19):1===e?(O=i,H-=257,F=a,U-=257,_=256):(O=o,F=s,_=-1),I=0,S=0,T=M,y=h,k=A,P=0,v=-1,g=(L=1<<A)-1,1===e&&L>852||2===e&&L>592)return 1;for(;;){b=T-P,d[S]<_?(E=0,w=d[S]):d[S]>_?(E=F[U+d[S]],w=O[H+d[S]]):(E=96,w=0),p=1<<T-P,M=m=1<<k;do{c[y+(I>>P)+(m-=p)]=b<<24|E<<16|w|0}while(0!==m);for(p=1<<T-1;I&p;)p>>=1;if(0!==p?(I&=p-1,I+=p):I=0,S++,0==--D[T]){if(T===R)break;T=t[l+d[S]]}if(T>A&&(I&g)!==v){for(0===P&&(P=A),y+=M,C=1<<(k=T-P);R>k+P&&!(0>=(C-=D[k+P]));)k++,C<<=1;if(L+=1<<k,1===e&&L>852||2===e&&L>592)return 1;c[v=I&g]=A<<24|k<<16|y-h|0}}return 0!==I&&(c[y+I]=T-P<<24|64<<16|0),f.bits=A,0}},{"../utils/common":27}],37:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,r){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?X[e]:X[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function o(e,t,r){e.bi_valid>O-r?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>O-e.bi_valid,e.bi_valid+=r-O):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function s(e,t,r){o(e,r[2*t],r[2*t+1])}function l(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function u(e,t,r){var n,i,a=new Array(I+1),o=0;for(n=1;I>=n;n++)a[n]=o=o+r[n-1]<<1;for(i=0;t>=i;i++){var s=e[2*i+1];0!==s&&(e[2*i]=l(a[s]++,s))}}function c(e){var t;for(t=0;k>t;t++)e.dyn_ltree[2*t]=0;for(t=0;P>t;t++)e.dyn_dtree[2*t]=0;for(t=0;C>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*D]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function h(e){e.bi_valid>8?a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function d(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function f(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&d(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!d(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function p(e,t,r){var n,a,l,u,c=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],a=e.pending_buf[e.l_buf+c],c++,0===n?s(e,a,t):(l=Y[a],s(e,l+A+1,t),0!==(u=B[l])&&(a-=q[l],o(e,a,u)),l=i(--n),s(e,l,r),0!==(u=z[l])&&(n-=Z[l],o(e,n,u)))}while(c<e.last_lit);s(e,D,t)}function m(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=L,r=0;l>r;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>c?++c:0,a[2*i]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)f(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],f(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,f(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;I>=a;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;L>r;r++)n=e.heap[r],(a=l[2*l[2*n+1]+1]+1)>p&&(a=p,m++),l[2*n+1]=a,n>u||(e.bl_count[a]++,o=0,n>=f&&(o=d[n-f]),s=l[2*n],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(c[2*n+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),u(a,c,e.bl_count)}function v(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;r>=n;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(u>s?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*N]++):10>=s?e.bl_tree[2*F]++:e.bl_tree[2*U]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function g(e,t,r){var n,i,a=-1,l=t[1],u=0,c=7,h=4;for(0===l&&(c=138,h=3),n=0;r>=n;n++)if(i=l,l=t[2*(n+1)+1],!(++u<c&&i===l)){if(h>u)do{s(e,i,e.bl_tree)}while(0!=--u);else 0!==i?(i!==a&&(s(e,i,e.bl_tree),u--),s(e,N,e.bl_tree),o(e,u-3,2)):10>=u?(s(e,F,e.bl_tree),o(e,u-3,3)):(s(e,U,e.bl_tree),o(e,u-11,7));u=0,a=i,0===l?(c=138,h=3):i===l?(c=6,h=3):(c=7,h=4)}}function y(e,t,r,n){o(e,(T<<1)+(n?1:0),3),function(e,t,r,n){h(e),n&&(a(e,r),a(e,~r)),_.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}var _=e("../utils/common"),b=4,E=0,w=1,x=2,T=0,S=1,M=2,R=29,A=256,k=A+1+R,P=30,C=19,L=2*k+1,I=15,O=16,H=7,D=256,N=16,F=17,U=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(k+2));n(G);var W=new Array(2*P);n(W);var X=new Array(512);n(X);var Y=new Array(256);n(Y);var q=new Array(R);n(q);var Z=new Array(P);n(Z);var J,K,Q,$=function(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length},ee=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},te=!1;r._tr_init=function(e){te||(function(){var e,t,r,n,i,a=new Array(I+1);for(r=0,n=0;R-1>n;n++)for(q[n]=r,e=0;e<1<<B[n];e++)Y[r++]=n;for(Y[r-1]=n,i=0,n=0;16>n;n++)for(Z[n]=i,e=0;e<1<<z[n];e++)X[i++]=n;for(i>>=7;P>n;n++)for(Z[n]=i<<7,e=0;e<1<<z[n]-7;e++)X[256+i++]=n;for(t=0;I>=t;t++)a[t]=0;for(e=0;143>=e;)G[2*e+1]=8,e++,a[8]++;for(;255>=e;)G[2*e+1]=9,e++,a[9]++;for(;279>=e;)G[2*e+1]=7,e++,a[7]++;for(;287>=e;)G[2*e+1]=8,e++,a[8]++;for(u(G,k+1,a),e=0;P>e;e++)W[2*e+1]=5,W[2*e]=l(e,5);J=new $(G,B,A+1,k,I),K=new $(W,z,0,P,I),Q=new $(new Array(0),j,0,C,H)}(),te=!0),e.l_desc=new ee(e.dyn_ltree,J),e.d_desc=new ee(e.dyn_dtree,K),e.bl_desc=new ee(e.bl_tree,Q),e.bi_buf=0,e.bi_valid=0,c(e)},r._tr_stored_block=y,r._tr_flush_block=function(e,t,r,n){var i,a,s=0;e.level>0?(e.strm.data_type===x&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;31>=t;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return E;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return w;for(t=32;A>t;t++)if(0!==e.dyn_ltree[2*t])return w;return E}(e)),m(e,e.l_desc),m(e,e.d_desc),s=function(e){var t;for(v(e,e.dyn_ltree,e.l_desc.max_code),v(e,e.dyn_dtree,e.d_desc.max_code),m(e,e.bl_desc),t=C-1;t>=3&&0===e.bl_tree[2*V[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,i>=a&&(i=a)):i=a=r+5,i>=r+4&&-1!==t?y(e,t,r,n):e.strategy===b||a===i?(o(e,(S<<1)+(n?1:0),3),p(e,G,W)):(o(e,(M<<1)+(n?1:0),3),function(e,t,r,n){var i;for(o(e,t-257,5),o(e,r-1,5),o(e,n-4,4),i=0;n>i;i++)o(e,e.bl_tree[2*V[i]+1],3);g(e,e.dyn_ltree,t-1),g(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),p(e,e.dyn_ltree,e.dyn_dtree)),c(e),n&&h(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Y[r]+A+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){o(e,S<<1,3),s(e,D,G),function(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":27}],39:[function(e,t){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9)}).call(this,r(66).Buffer)},function(e,t,r){var n,i,a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r,s){"object"===o(t)&&void 0!==e?s(t):(i=[t],void 0===(a="function"==typeof(n=s)?n.apply(t,i):n)||(e.exports=a))}(0,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function c(e){return function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(e,t,r){return M(S(e,r),t)}function d(e,t,r,n){var i,a=0;return t<r?(i=t,a=0):(i=r,a=1),n<i&&(a=2),_e[e][a]}function f(e){var t,r,n=e.children,i=0;if(null!==n)for(t=0,r=n.length;t<r;++t)i+=f(n[t]);else null!==e.points&&(i=e.points.length);return i}function p(e,t,r,n,i){var a,o,s=n.children,l=!1,u=!1;if(n.contains(e,r.bias)){if(null===s){if(null===n.points)n.points=[],n.data=[];else for(a=0,o=n.points.length;!l&&a<o;++a)l=n.points[a].equals(e);l?(n.data[a-1]=t,u=!0):n.points.length<r.maxPoints||i===r.maxDepth?(n.points.push(e.clone()),n.data.push(t),++r.pointCount,u=!0):(n.split(),n.redistribute(r.bias),s=n.children)}if(null!==s)for(++i,a=0,o=s.length;!u&&a<o;++a)u=p(e,t,r,s[a],i)}return u}function m(e,t,r,n){var i,a,o,s,l,u=r.children,c=null;if(r.contains(e,t.bias))if(null!==u)for(i=0,a=u.length;null===c&&i<a;++i)c=m(e,t,u[i],r);else if(null!==r.points)for(o=r.points,s=r.data,i=0,a=o.length;i<a;++i)if(o[i].equals(e)){l=a-1,c=s[i],i<l&&(o[i]=o[l],s[i]=s[l]),o.pop(),s.pop(),--t.pointCount,null!==n&&f(n)<=t.maxPoints&&n.merge();break}return c}function v(e,t,r,n){var i,a,o,s,l,u,c,h=n.points,d=n.children,f=null,p=t;if(null!==d)for(i=0,a=(l=d.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance})).length;i<a;++i)(u=l[i].octant).contains(e,p)&&(null!==(c=v(e,p,r,u))&&(s=c.point.distanceToSquared(e),(!r||0<s)&&s<p&&(p=s,f=c)));else if(null!==h)for(i=0,a=h.length;i<a;++i)o=h[i],s=e.distanceToSquared(o),(!r||0<s)&&s<p&&(p=s,f={point:o.clone(),data:n.data[i]});return f}function g(e,t,r,n,i){var a,o,s,l,u,c=n.points,h=n.children;if(null!==h)for(a=0,o=h.length;a<o;++a)(u=h[a]).contains(e,t)&&g(e,t,r,u,i);else if(null!==c)for(a=0,o=c.length;a<o;++a)s=c[a],l=e.distanceToSquared(s),(!r||0<l)&&l<=t*t&&i.push({point:s.clone(),data:n.data[a]})}var y=Math.PI,_=Math.atan2,b=Math.round,E=Math.ceil,w=Math.floor,x=Math.abs,T=Math.acos,S=Math.min,M=Math.max,R=Math.sqrt,A=Math.cos,k=Math.sin,P=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=r,this.y=n,this.z=i}return n(e,[{key:"set",value:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,r){var n=k(t)*e;return this.x=n*k(r),this.y=A(t)*e,this.z=n*A(r),this}},{key:"setFromCylindrical",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,r){return this.x=e*k(t),this.y=r,this.z=e*A(t),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,u=s*r+o*t-i*n,c=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+u*-o-c*-a,this.y=u*s+h*-a+c*-i-l*-o,this.z=c*s+h*-o+l*-a-u*-i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,r=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,r,n),this}},{key:"angleTo",value:function(e){var t=this.dot(e)/R(this.lengthSquared()*e.lengthSquared());return T(S(M(t,-1),1))}},{key:"manhattanLength",value:function(){return x(this.x)+x(this.y)+x(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return R(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return x(this.x-e.x)+x(this.y-e.y)+x(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}},{key:"distanceTo",value:function(e){return R(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=S(this.x,e.x),this.y=S(this.y,e.y),this.z=S(this.z,e.z),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this.z=M(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,S(t.x,this.x)),this.y=M(e.y,S(t.y,this.y)),this.z=M(e.z,S(t.z,this.z)),this}},{key:"floor",value:function(){return this.x=w(this.x),this.y=w(this.y),this.z=w(this.z),this}},{key:"ceil",value:function(){return this.x=E(this.x),this.y=E(this.y),this.z=E(this.z),this}},{key:"round",value:function(){return this.x=b(this.x),this.y=b(this.y),this.z=b(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),C=new P,L=[new P,new P,new P,new P,new P,new P,new P,new P],I=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P(-1/0,-1/0,-1/0);t(this,e),this.min=r,this.max=n}return n(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,r;for(this.min.set(0,0,0),this.max.set(0,0,0),t=0,r=e.length;t<r;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var r=C.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return C.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,r=this.max;return this.isEmpty()||(L[0].set(t.x,t.y,t.z).applyMatrix4(e),L[1].set(t.x,t.y,r.z).applyMatrix4(e),L[2].set(t.x,r.y,t.z).applyMatrix4(e),L[3].set(t.x,r.y,r.z).applyMatrix4(e),L[4].set(r.x,t.y,t.z).applyMatrix4(e),L[5].set(r.x,t.y,r.z).applyMatrix4(e),L[6].set(r.x,r.y,t.z).applyMatrix4(e),L[7].set(r.x,r.y,r.z).applyMatrix4(e),this.setFromPoints(L)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,r=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=r.x&&e.y<=r.y&&e.z<=r.z}},{key:"containsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=r.x&&t.y<=n.y&&i.y<=r.y&&t.z<=n.z&&i.z<=r.z}},{key:"intersectsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&n.x<=r.x&&n.y<=r.y&&n.z<=r.z}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,C).distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,r;return 0<e.normal.x?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),O=new I,H=new P,D=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.center=r,this.radius=n}return n(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(e){var t,r,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:O.setFromPoints(e).getCenter(this.center),i=0;for(t=0,r=e.length;t<r;++t)i=M(i,n.distanceToSquared(e[t]));return this.radius=R(i),this}},{key:"setFromBox",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(H).length(),this}},{key:"isEmpty",value:function(){return 0>=this.radius}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return x(e.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),N=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.x=r,this.y=n}return n(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"manhattanLength",value:function(){return x(this.x)+x(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return R(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(e){return x(this.x-e.x)+x(this.y-e.y)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r}},{key:"distanceTo",value:function(e){return R(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=S(this.x,e.x),this.y=S(this.y,e.y),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,S(t.x,this.x)),this.y=M(e.y,S(t.y,this.y)),this}},{key:"floor",value:function(){return this.x=w(this.x),this.y=w(this.y),this}},{key:"ceil",value:function(){return this.x=E(this.x),this.y=E(this.y),this}},{key:"round",value:function(){return this.x=b(this.x),this.y=b(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var e=_(this.y,this.x);return 0>e&&(e+=2*y),e}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"rotateAround",value:function(e,t){var r=A(t),n=k(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"width",get:function(){return this.x},set:function(e){return this.x=e}},{key:"height",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),F=new N,U=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new N(-1/0,-1/0);t(this,e),this.min=r,this.max=n}n(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new D;return this.getCenter(e.center),e.radius=.5*this.getSize(F).length(),e}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,r;for(this.min.set(0,0),this.max.set(0,0),t=0,r=e.length;t<r;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var r=F.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new N;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return F.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,r=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=r.x&&e.y<=r.y}},{key:"containsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=r.x&&t.y<=n.y&&i.y<=r.y}},{key:"intersectsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&n.x<=r.x&&n.y<=r.y}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}(),function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=r,this.theta=n,this.y=i}n(e,[{key:"set",value:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,r){return this.radius=R(e*e+r*r),this.theta=_(e,r),this.y=t,this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(e,[{key:"set",value:function(e,t,r,n,i,a,o,s,l){var u=this.elements;return u[0]=e,u[3]=t,u[6]=r,u[1]=n,u[4]=i,u[7]=a,u[2]=o,u[5]=s,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,r=this.elements;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;9>t;++t)n[t]=e[t+r];return this}},{key:"toArray",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;9>e;++e)t[e+r]=n[e];return t}},{key:"multiplyMatrices",value:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],f=r[8],p=n[0],m=n[3],v=n[6],g=n[1],y=n[4],_=n[7],b=n[2],E=n[5],w=n[8];return i[0]=a*p+o*g+s*b,i[3]=a*m+o*y+s*E,i[6]=a*v+o*_+s*w,i[1]=l*p+u*g+c*b,i[4]=l*m+u*y+c*E,i[7]=l*v+u*_+c*w,i[2]=h*p+d*g+f*b,i[5]=h*m+d*y+f*E,i[8]=h*v+d*_+f*w,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-r*i*u+r*o*s+n*i*l-n*a*s}},{key:"getInverse",value:function(e){var t,r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],f=d*l-u*h,p=u*c-d*s,m=h*s-l*c,v=i*f+a*p+o*m;return 0==v?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(t=1/v,n[0]=f*t,n[1]=(o*h-d*a)*t,n[2]=(u*a-o*l)*t,n[3]=p*t,n[4]=(d*i-o*c)*t,n[5]=(o*s-u*i)*t,n[6]=m*t,n[7]=(a*c-h*i)*t,n[8]=(l*i-a*s)*t),this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"scale",value:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}},{key:"rotate",value:function(e){var t=A(e),r=k(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],u=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*u,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*u,this}},{key:"translate",value:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&9>t;++t)r[t]!==n[t]&&(i=!1);return i}}]),e}()),B="XYZ",z="YZX",j="ZXY",V="XZY",G="YXZ",W="ZYX",X=new P,Y=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.w=a}var r=Number.EPSILON;return n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setFromEuler",value:function(e){var t=e.x,r=e.y,n=e.z,i=A,a=k,o=i(t/2),s=i(r/2),l=i(n/2),u=a(t/2),c=a(r/2),h=a(n/2);switch(e.order){case B:this.x=u*s*l+o*c*h,this.y=o*c*l-u*s*h,this.z=o*s*h+u*c*l,this.w=o*s*l-u*c*h;break;case G:this.x=u*s*l+o*c*h,this.y=o*c*l-u*s*h,this.z=o*s*h-u*c*l,this.w=o*s*l+u*c*h;break;case j:this.x=u*s*l-o*c*h,this.y=o*c*l+u*s*h,this.z=o*s*h+u*c*l,this.w=o*s*l-u*c*h;break;case W:this.x=u*s*l-o*c*h,this.y=o*c*l+u*s*h,this.z=o*s*h-u*c*l,this.w=o*s*l+u*c*h;break;case z:this.x=u*s*l+o*c*h,this.y=o*c*l+u*s*h,this.z=o*s*h-u*c*l,this.w=o*s*l-u*c*h;break;case V:this.x=u*s*l-o*c*h,this.y=o*c*l-u*s*h,this.z=o*s*h+u*c*l,this.w=o*s*l+u*c*h}return this}},{key:"setFromAxisAngle",value:function(e,t){var r=t/2,n=k(r);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=A(r),this}},{key:"setFromRotationMatrix",value:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],u=r[2],c=r[6],h=r[10],d=n+s+h;return 0<d?(t=.5/R(d+1),this.w=.25/t,this.x=(c-l)*t,this.y=(a-u)*t,this.z=(o-i)*t):n>s&&n>h?(t=2*R(1+n-s-h),this.w=(c-l)/t,this.x=.25*t,this.y=(i+o)/t,this.z=(a+u)/t):s>h?(t=2*R(1+s-n-h),this.w=(a-u)/t,this.x=(i+o)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*R(1+h-n-s),this.w=(o-i)/t,this.x=(a+u)/t,this.y=(l+c)/t,this.z=.25*t),this}},{key:"setFromUnitVectors",value:function(e,t){var r=e.dot(t)+1;return 1e-6>r?(r=0,x(e.x)>x(e.z)?X.set(-e.y,e.x,0):X.set(0,-e.z,e.y)):X.crossVectors(e,t),this.x=X.x,this.y=X.y,this.z=X.z,this.w=r,this.normalize()}},{key:"angleTo",value:function(e){return 2*T(x(S(M(this.dot(e),-1),1)))}},{key:"rotateTowards",value:function(e,t){var r=this.angleTo(e);return 0!==r&&this.slerp(e,S(1,t/r)),this}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return R(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var e,t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"multiplyQuaternions",value:function(e,t){var r=e.x,n=e.y,i=e.z,a=e.w,o=t.x,s=t.y,l=t.z,u=t.w;return this.x=r*u+a*o+n*l-i*s,this.y=n*u+a*s+i*o-r*l,this.z=i*u+a*l+r*s-n*o,this.w=a*u-r*o-n*s-i*l,this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"slerp",value:function(e,t){var n,i,a,o,s,l,u,c=this.x,h=this.y,d=this.z,f=this.w;return 1===t?this.copy(e):0<t&&(0>(n=f*e.w+c*e.x+h*e.y+d*e.z)?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,n=-n):this.copy(e),1<=n?(this.w=f,this.x=c,this.y=h,this.z=d):(s=1-t,(i=1-n*n)<=r?(this.w=s*f+t*this.w,this.x=s*c+t*this.x,this.y=s*h+t*this.y,this.z=s*d+t*this.z,this.normalize()):(a=R(i),o=_(a,n),l=k(s*o)/a,u=k(t*o)/a,this.w=f*l+this.w*u,this.x=c*l+this.x*u,this.y=h*l+this.y*u,this.z=d*l+this.z*u))),this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:"slerp",value:function(e,t,r,n){return r.copy(e).slerp(t,n)}},{key:"slerpFlat",value:function(e,t,n,i,a,o,s){var l,u,c,h,d,f,p,m,v=a[o],g=a[o+1],y=a[o+2],b=a[o+3],E=n[i],w=n[i+1],x=n[i+2],T=n[i+3];(T!==b||E!==v||w!==g||x!==y)&&(l=1-s,f=0<=(h=E*v+w*g+x*y+T*b)?1:-1,(d=1-h*h)>r&&(c=R(d),p=_(c,h*f),l=k(l*p)/c,s=k(s*p)/c),E=E*l+v*(m=s*f),w=w*l+g*m,x=x*l+y*m,T=T*l+b*m,l===1-s&&(E*=u=1/R(E*E+w*w+x*x+T*T),w*=u,x*=u,T*=u)),e[t]=E,e[t+1]=w,e[t+2]=x,e[t+3]=T}}]),e}(),q=new U,Z=new Y,J=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.order=e.defaultOrder}n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.order=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.order=e.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:"toVector3",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(e){var t=Math.asin,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,n=e.elements,i=n[0],a=n[4],o=n[8],s=n[1],l=n[5],u=n[9],c=n[2],d=n[6],f=n[10],p=.99999;switch(r){case B:this.y=t(h(o,-1,1)),x(o)<p?(this.x=_(-u,f),this.z=_(-a,i)):(this.x=_(d,l),this.z=0);break;case G:this.x=t(-h(u,-1,1)),x(u)<p?(this.y=_(o,f),this.z=_(s,l)):(this.y=_(-c,i),this.z=0);break;case j:this.x=t(h(d,-1,1)),x(d)<p?(this.y=_(-c,f),this.z=_(-a,l)):(this.y=0,this.z=_(s,i));break;case W:this.y=t(-h(c,-1,1)),x(c)<p?(this.x=_(d,f),this.z=_(s,i)):(this.x=0,this.z=_(-a,l));break;case z:this.z=t(h(s,-1,1)),x(s)<p?(this.x=_(-u,l),this.y=_(-c,i)):(this.x=0,this.y=_(o,f));break;case V:this.z=t(-h(a,-1,1)),x(a)<p?(this.x=_(d,l),this.y=_(o,i)):(this.x=_(-u,f),this.y=0)}return this.order=r,this}},{key:"setFromQuaternion",value:function(e,t){return q.makeRotationFromQuaternion(e),this.setFromRotationMatrix(q,t)}},{key:"setFromVector3",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Z.setFromEuler(this),this.setFromQuaternion(Z,e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.order===this.order}}],[{key:"defaultOrder",get:function(){return B}}])}(),new P),K=new P,Q=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.normal=r,this.constant=n}return n(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,r){var n=J.subVectors(r,t).cross(K.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,J),this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"intersectLine",value:function(e,t){var r=e.delta(J),n=this.normal.dot(r);if(0===n)0===this.distanceToPoint(e.start)&&t.copy(e.start);else{var i=-(e.start.dot(this.normal)+this.constant)/n;0<=i&&1>=i&&t.copy(r).multiplyScalar(i).add(e.start)}return t}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&0<r||0>r&&0<t}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),$=new P,ee=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Q,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Q,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Q,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new Q,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new Q,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new Q;t(this,e),this.planes=[r,n,i,a,o,s]}n(e,[{key:"set",value:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){var t,r=this.planes;for(t=0;6>t;++t)r[t].copy(e.planes[t]);return this}},{key:"setFromMatrix",value:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],f=r[10],p=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(o-n,c-s,p-h,y-m).normalize(),t[1].setComponents(o+n,c+s,p+h,y+m).normalize(),t[2].setComponents(o+i,c+l,p+d,y+v).normalize(),t[3].setComponents(o-i,c-l,p-d,y-v).normalize(),t[4].setComponents(o-a,c-u,p-f,y-g).normalize(),t[5].setComponents(o+a,c+u,p+f,y+g).normalize(),this}},{key:"intersectsSphere",value:function(e){var t,r=this.planes,n=e.center,i=-e.radius,a=!0;for(t=0;6>t;++t)if(r[t].distanceToPoint(n)<i){a=!1;break}return a}},{key:"intersectsBox",value:function(e){var t,r,n=this.planes,i=e.min,a=e.max;for(t=0;6>t;++t)if(r=n[t],$.x=0<r.normal.x?a.x:i.x,$.y=0<r.normal.y?a.y:i.y,$.z=0<r.normal.z?a.z:i.z,0>r.distanceToPoint($))return!1;return!0}},{key:"containsPoint",value:function(e){var t,r=this.planes,n=!0;for(t=0;6>t;++t)if(0>r[t].distanceToPoint(e)){n=!1;break}return n}}])}(),new P),te=new P,re=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;t(this,e),this.start=r,this.end=n}n(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){ee.subVectors(e,this.start),te.subVectors(this.end,this.start);var r=te.dot(te),n=te.dot(ee);return t?S(M(n/r,0),1):n/r}},{key:"closestPointToPoint",value:function(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new P,n=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}])}(),new P),ne=new P,ie=new P,ae=(function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}n(e,[{key:"set",value:function(e,t,r,n,i,a,o,s,l,u,c,h,d,f,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=d,v[7]=f,v[11]=p,v[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,r=this.elements;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;16>t;++t)n[t]=e[t+r];return this}},{key:"toArray",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;16>e;++e)t[e+r]=n[e];return t}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return R(M(t,r,n))}},{key:"copyPosition",value:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}},{key:"setPosition",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:"extractBasis",value:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,r=e.elements,n=1/re.setFromMatrixColumn(e,0).length(),i=1/re.setFromMatrixColumn(e,1).length(),a=1/re.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t,r,n,i,a,o,s,l,u,c,h,d,f=this.elements,p=e.x,m=e.y,v=e.z,g=A(p),y=k(p),_=A(m),b=k(m),E=A(v),w=k(v);switch(e.order){case B:t=g*E,r=g*w,n=y*E,i=y*w,f[0]=_*E,f[4]=-_*w,f[8]=b,f[1]=r+n*b,f[5]=t-i*b,f[9]=-y*_,f[2]=i-t*b,f[6]=n+r*b,f[10]=g*_;break;case G:a=_*E,o=_*w,s=b*E,l=b*w,f[0]=a+l*y,f[4]=s*y-o,f[8]=g*b,f[1]=g*w,f[5]=g*E,f[9]=-y,f[2]=o*y-s,f[6]=l+a*y,f[10]=g*_;break;case j:a=_*E,o=_*w,s=b*E,l=b*w,f[0]=a-l*y,f[4]=-g*w,f[8]=s+o*y,f[1]=o+s*y,f[5]=g*E,f[9]=l-a*y,f[2]=-g*b,f[6]=y,f[10]=g*_;break;case W:t=g*E,r=g*w,n=y*E,i=y*w,f[0]=_*E,f[4]=n*b-r,f[8]=t*b+i,f[1]=_*w,f[5]=i*b+t,f[9]=r*b-n,f[2]=-b,f[6]=y*_,f[10]=g*_;break;case z:u=g*_,c=g*b,h=y*_,d=y*b,f[0]=_*E,f[4]=d-u*w,f[8]=h*w+c,f[1]=w,f[5]=g*E,f[9]=-y*E,f[2]=-b*E,f[6]=c*w+h,f[10]=u-d*w;break;case V:u=g*_,c=g*b,h=y*_,d=y*b,f[0]=_*E,f[4]=-w,f[8]=b*E,f[1]=u*w+d,f[5]=g*E,f[9]=c*w-h,f[2]=h*w-c,f[6]=y*E,f[10]=d*w+u}return f[3]=0,f[7]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(re.set(0,0,0),e,ne.set(1,1,1))}},{key:"lookAt",value:function(e,t,r){var n=this.elements,i=re,a=ne,o=ie;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(r,o),0===i.lengthSquared()&&(1===x(r.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(r,o)),i.normalize(),a.crossVectors(o,i),n[0]=i.x,n[4]=a.x,n[8]=o.x,n[1]=i.y,n[5]=a.y,n[9]=o.y,n[2]=i.z,n[6]=a.z,n[10]=o.z,this}},{key:"multiplyMatrices",value:function(e,t){var r=this.elements,n=e.elements,i=t.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],v=n[14],g=n[3],y=n[7],_=n[11],b=n[15],E=i[0],w=i[4],x=i[8],T=i[12],S=i[1],M=i[5],R=i[9],A=i[13],k=i[2],P=i[6],C=i[10],L=i[14],I=i[3],O=i[7],H=i[11],D=i[15];return r[0]=a*E+o*S+s*k+l*I,r[4]=a*w+o*M+s*P+l*O,r[8]=a*x+o*R+s*C+l*H,r[12]=a*T+o*A+s*L+l*D,r[1]=u*E+c*S+h*k+d*I,r[5]=u*w+c*M+h*P+d*O,r[9]=u*x+c*R+h*C+d*H,r[13]=u*T+c*A+h*L+d*D,r[2]=f*E+p*S+m*k+v*I,r[6]=f*w+p*M+m*P+v*O,r[10]=f*x+p*R+m*C+v*H,r[14]=f*T+p*A+m*L+v*D,r[3]=g*E+y*S+_*k+b*I,r[7]=g*w+y*M+_*P+b*O,r[11]=g*x+y*R+_*C+b*H,r[15]=g*T+y*A+_*L+b*D,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14],f=t*o,p=t*s,m=t*l,v=r*a,g=r*s,y=r*l,_=n*a,b=n*o,E=n*l,w=i*a,x=i*o,T=i*s;return e[3]*(T*c-E*c-x*h+y*h+b*d-g*d)+e[7]*(p*d-m*h+w*h-_*d+E*u-T*u)+e[11]*(m*c-f*d-w*c+v*d+x*u-y*u)+e[15]*(-b*u-p*c+f*h+_*c-v*h+g*u)}},{key:"getInverse",value:function(e){var t,r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],h=n[7],d=n[8],f=n[9],p=n[10],m=n[11],v=n[12],g=n[13],y=n[14],_=n[15],b=f*y*h-g*p*h+g*c*m-u*y*m-f*c*_+u*p*_,E=v*p*h-d*y*h-v*c*m+l*y*m+d*c*_-l*p*_,w=d*g*h-v*f*h+v*u*m-l*g*m-d*u*_+l*f*_,x=v*f*c-d*g*c-v*u*p+l*g*p+d*u*y-l*f*y,T=i*b+a*E+o*w+s*x;return 0==T?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(t=1/T,r[0]=b*t,r[1]=(g*p*s-f*y*s-g*o*m+a*y*m+f*o*_-a*p*_)*t,r[2]=(u*y*s-g*c*s+g*o*h-a*y*h-u*o*_+a*c*_)*t,r[3]=(f*c*s-u*p*s-f*o*h+a*p*h+u*o*m-a*c*m)*t,r[4]=E*t,r[5]=(d*y*s-v*p*s+v*o*m-i*y*m-d*o*_+i*p*_)*t,r[6]=(v*c*s-l*y*s-v*o*h+i*y*h+l*o*_-i*c*_)*t,r[7]=(l*p*s-d*c*s+d*o*h-i*p*h-l*o*m+i*c*m)*t,r[8]=w*t,r[9]=(v*f*s-d*g*s-v*a*m+i*g*m+d*a*_-i*f*_)*t,r[10]=(l*g*s-v*u*s+v*a*h-i*g*h-l*a*_+i*u*_)*t,r[11]=(d*u*s-l*f*s-d*a*h+i*f*h+l*a*m-i*u*m)*t,r[12]=x*t,r[13]=(d*g*o-v*f*o+v*a*p-i*g*p-d*a*y+i*f*y)*t,r[14]=(v*u*o-l*g*o-v*a*c+i*g*c+l*a*y-i*u*y)*t,r[15]=(l*f*o-d*u*o+d*a*c-i*f*c-l*a*p+i*u*p)*t),this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"scale",value:function(e,t,r){var n=this.elements;return n[0]*=e,n[4]*=t,n[8]*=r,n[1]*=e,n[5]*=t,n[9]*=r,n[2]*=e,n[6]*=t,n[10]*=r,n[3]*=e,n[7]*=t,n[11]*=r,this}},{key:"makeScale",value:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}},{key:"makeTranslation",value:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=A(e),r=k(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=A(e),r=k(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=A(e),r=k(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var r=A(t),n=k(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,u=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,u*o+r,u*s-n*a,0,l*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,r){var n=this.elements,i=t.x,a=t.y,o=t.z,s=t.w,l=i+i,u=a+a,c=o+o,h=i*l,d=i*u,f=i*c,p=a*u,m=a*c,v=o*c,g=s*l,y=s*u,_=s*c,b=r.x,E=r.y,w=r.z;return n[0]=(1-(p+v))*b,n[1]=(d+_)*b,n[2]=(f-y)*b,n[3]=0,n[4]=(d-_)*E,n[5]=(1-(h+v))*E,n[6]=(m+g)*E,n[7]=0,n[8]=(f+y)*w,n[9]=(m-g)*w,n[10]=(1-(h+p))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}},{key:"decompose",value:function(e,t,r){var n=this.elements,i=n[0],a=n[1],o=n[2],s=n[4],l=n[5],u=n[6],c=n[8],h=n[9],d=n[10],f=this.determinant(),p=re.set(i,a,o).length()*(0>f?-1:1),m=re.set(s,l,u).length(),v=re.set(c,h,d).length(),g=1/p,y=1/m,_=1/v;return e.x=n[12],e.y=n[13],e.z=n[14],n[0]*=g,n[1]*=g,n[2]*=g,n[4]*=y,n[5]*=y,n[6]*=y,n[8]*=_,n[9]*=_,n[10]*=_,t.setFromRotationMatrix(this),n[0]=i,n[1]=a,n[2]=o,n[4]=s,n[5]=l,n[6]=u,n[8]=c,n[9]=h,n[10]=d,r.x=p,r.y=m,r.z=v,this}},{key:"makePerspective",value:function(e,t,r,n,i,a){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(a+i)/(a-i),o[14]=-2*a*i/(a-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),u=1/(a-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-(t+e)*s,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-(r+n)*l,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-(a+i)*u,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&16>t;++t)r[t]!==n[t]&&(i=!1);return i}}])}(),[new P,new P,new P,new P]),oe=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;t(this,e),this.origin=r,this.direction=n}return n(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,ae[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,r=t.subVectors(e,this.origin).dot(this.direction);return 0<=r?t.copy(this.direction).multiplyScalar(r).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=ae[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):ae[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return R(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction),r=0===t?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null}},{key:"distanceSquaredToSegment",value:function(e,t,r,n){var i,a,o,s,l,u=ae[0].copy(e).add(t).multiplyScalar(.5),c=ae[1].copy(t).sub(e).normalize(),h=ae[2].copy(this.origin).sub(u),d=.5*e.distanceTo(t),f=-this.direction.dot(c),p=h.dot(this.direction),m=-h.dot(c),v=h.lengthSq(),g=x(1-f*f);return 0<g?(a=f*p-m,o=d*g,0<=(i=f*m-p)?a>=-o?a<=o?l=(i*=s=1/g)*(i+f*(a*=s)+2*p)+a*(f*i+a+2*m)+v:l=-(i=M(0,-(f*(a=d)+p)))*i+a*(a+2*m)+v:l=-(i=M(0,-(f*(a=-d)+p)))*i+a*(a+2*m)+v:a<=-o?l=-(i=M(0,-(-f*d+p)))*i+(a=0<i?-d:S(M(-d,-m),d))*(a+2*m)+v:a<=o?(i=0,l=(a=S(M(-d,-m),d))*(a+2*m)+v):l=-(i=M(0,-(f*d+p)))*i+(a=0<i?d:S(M(-d,-m),d))*(a+2*m)+v):l=-(i=M(0,-(f*(a=0<f?-d:d)+p)))*i+a*(a+2*m)+v,void 0!==r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),void 0!==n&&n.copy(c).multiplyScalar(a).add(u),l}},{key:"intersectSphere",value:function(e){var t,r,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,a=ae[0].subVectors(e.center,this.origin),o=a.dot(this.direction),s=a.dot(a)-o*o,l=e.radius*e.radius,u=null;return s<=l&&(n=o+(t=R(l-s)),(0<=(r=o-t)||0<=n)&&(u=0>r?this.at(n,i):this.at(r,i))),u}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"intersectPlane",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t,r,n,i,a,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,l=this.origin,u=this.direction,c=e.min,h=e.max,d=1/u.x,f=1/u.y,p=1/u.z,m=null;return 0<=d?(t=(c.x-l.x)*d,r=(h.x-l.x)*d):(t=(h.x-l.x)*d,r=(c.x-l.x)*d),0<=f?(n=(c.y-l.y)*f,i=(h.y-l.y)*f):(n=(h.y-l.y)*f,i=(c.y-l.y)*f),t<=i&&n<=r&&((n>t||t!=t)&&(t=n),(i<r||r!=r)&&(r=i),0<=p?(a=(c.z-l.z)*p,o=(h.z-l.z)*p):(a=(h.z-l.z)*p,o=(c.z-l.z)*p),t<=o&&a<=r&&((a>t||t!=t)&&(t=a),(o<r||r!=r)&&(r=o),0<=r&&(m=this.at(0<=t?t:r,s)))),m}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,ae[0])}},{key:"intersectTriangle",value:function(e,t,r,n,i){var a,o,s,l,u,c=this.direction,h=ae[0],d=ae[1],f=ae[2],p=ae[3],m=null;return d.subVectors(t,e),f.subVectors(r,e),p.crossVectors(d,f),0===(a=c.dot(p))||n&&0<a||(0<a?o=1:(o=-1,a=-a),h.subVectors(this.origin,e),0<=(s=o*c.dot(f.crossVectors(h,f)))&&(0<=(l=o*c.dot(d.cross(h)))&&s+l<=a&&(0<=(u=-o*h.dot(p))&&(m=this.at(u/a,i))))),m}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),se=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=r,this.phi=n,this.theta=i}n(e,[{key:"set",value:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeSafe",value:function(){return this.phi=M(1e-6,S(y-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,r){return this.radius=R(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=_(e,r),this.phi=T(S(M(t/this.radius,-1),1))),this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}n(e,[{key:"set",value:function(e,t,r,n,i,a){var o=this.elements;return o[0]=e,o[1]=t,o[3]=n,o[2]=r,o[4]=i,o[5]=a,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:"add",value:function(e){var t=this.elements,r=e.elements;return t[0]+=r[0],t[1]+=r[1],t[3]+=r[3],t[2]+=r[2],t[4]+=r[4],t[5]+=r[5],this}},{key:"norm",value:function(){var e=this.elements,t=e[1]*e[1],r=e[2]*e[2],n=e[4]*e[4];return R(e[0]*e[0]+t+r+t+e[3]*e[3]+n+r+n+e[5]*e[5])}},{key:"off",value:function(){var e=this.elements;return R(2*(e[1]*e[1]+e[2]*e[2]+e[4]*e[4]))}},{key:"applyToVector3",value:function(e){var t=e.x,r=e.y,n=e.z,i=this.elements;return e.x=i[0]*t+i[1]*r+i[2]*n,e.y=i[1]*t+i[3]*r+i[4]*n,e.z=i[2]*t+i[4]*r+i[5]*n,e}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&6>t;++t)r[t]!==n[t]&&(i=!1);return i}}],[{key:"calculateIndex",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}])}(),function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.w=a}n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*T(e.w);var t=R(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,r,n,i,a,o,s,l,u,c,h,d=.01,f=e.elements,p=f[0],m=f[4],v=f[8],g=f[1],_=f[5],b=f[9],E=f[2],w=f[6],S=f[10];return x(m-g)<d&&x(v-E)<d&&x(b-w)<d?x(m+g)<.1&&x(v+E)<.1&&x(b+w)<.1&&x(p+_+S-3)<.1?this.set(1,0,0,0):(t=y,s=(S+1)/2,l=(m+g)/4,u=(v+E)/4,c=(b+w)/4,(a=(p+1)/2)>(o=(_+1)/2)&&a>s?a<d?(r=0,n=.707106781,i=.707106781):(n=l/(r=R(a)),i=u/r):o>s?o<d?(r=.707106781,n=0,i=.707106781):(r=l/(n=R(o)),i=c/n):s<d?(r=.707106781,n=.707106781,i=0):(r=u/(i=R(s)),n=c/i),this.set(r,n,i,t)):(h=R((w-b)*(w-b)+(v-E)*(v-E)+(g-m)*(g-m)),.001>x(h)&&(h=1),this.x=(w-b)/h,this.y=(v-E)/h,this.z=(g-m)/h,this.w=T((p+_+S-1)/2)),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"manhattanLength",value:function(){return x(this.x)+x(this.y)+x(this.z)+x(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return R(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(e){return x(this.x-e.x)+x(this.y-e.y)+x(this.z-e.z)+x(this.w-e.w)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z,i=this.w-e.w;return t*t+r*r+n*n+i*i}},{key:"distanceTo",value:function(e){return R(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=S(this.x,e.x),this.y=S(this.y,e.y),this.z=S(this.z,e.z),this.w=S(this.w,e.w),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this.z=M(this.z,e.z),this.w=M(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,S(t.x,this.x)),this.y=M(e.y,S(t.y,this.y)),this.z=M(e.z,S(t.z,this.z)),this.w=M(e.w,S(t.w,this.w)),this}},{key:"floor",value:function(){return this.x=w(this.x),this.y=w(this.y),this.z=w(this.z),this.w=w(this.w),this}},{key:"ceil",value:function(){return this.x=E(this.x),this.y=E(this.y),this.z=E(this.z),this.w=E(this.w),this}},{key:"round",value:function(){return this.x=b(this.x),this.y=b(this.y),this.z=b(this.z),this.w=b(this.w),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}])}(),new P),le=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;t(this,e),this.min=r,this.max=n,this.children=null}return n(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e,t,r=this.min,n=this.max,i=this.getCenter(se),a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ue[e],a[e]=new this.constructor(new P(0===t[0]?r.x:i.x,0===t[1]?r.y:i.y,0===t[2]?r.z:i.z),new P(0===t[0]?i.x:n.x,0===t[1]?i.y:n.y,0===t[2]?i.z:n.z))}}]),e}(),ue=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],ce=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],he=new P,de=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.min=r,this.size=n,this.children=null}return n(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e,t,r=this.min,n=this.getCenter(he),i=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ue[e],a[e]=new this.constructor(new P(0===t[0]?r.x:n.x,0===t[1]?r.y:n.y,0===t[2]?r.z:n.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),fe=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];t(this,e),this.value=r,this.done=n}return n(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),pe=new I,me=function(){function e(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.octree=r,this.region=n,this.cull=null!==n,this.result=new fe,this.trace=null,this.indices=null,this.reset()}return n(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(pe.min=e.min,pe.max=e.max,(!this.cull||this.region.intersectsBox(pe))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e,t,r,n=this.cull,i=this.region,a=this.indices,o=this.trace,s=null,l=o.length-1;null===s&&0<=l;)if(e=a[l]++,t=o[l].children,8>e)if(null!==t){if(r=t[e],n&&(pe.min=r.min,pe.max=r.max,!i.intersectsBox(pe)))continue;o.push(r),a.push(0),++l}else s=o.pop(),a.pop();else o.pop(),a.pop(),--l;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),ve=[new P,new P,new P],ge=new I,ye=new oe,_e=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],be=0,Ee=function(){function e(){t(this,e)}return n(e,null,[{key:"intersectOctree",value:function(e,t,r){var n,i,a,o,s,l,u,c,h,f=ge.min.set(0,0,0),p=ge.max.subVectors(e.max,e.min),m=e.getDimensions(ve[0]),v=ve[1].copy(m).multiplyScalar(.5),g=ye.origin.copy(t.ray.origin),y=ye.direction.copy(t.ray.direction);g.sub(e.getCenter(ve[2])).add(v),be=0,0>y.x&&(g.x=m.x-g.x,y.x=-y.x,be|=4),0>y.y&&(g.y=m.y-g.y,y.y=-y.y,be|=2),0>y.z&&(g.z=m.z-g.z,y.z=-y.z,be|=1),n=1/y.x,i=1/y.y,a=1/y.z,o=(f.x-g.x)*n,s=(p.x-g.x)*n,l=(f.y-g.y)*i,u=(p.y-g.y)*i,c=(f.z-g.z)*a,h=(p.z-g.z)*a,M(M(o,l),c)<S(S(s,u),h)&&function e(t,r,n,i,a,o,s,l,u){var c,h,f,p,m=t.children;if(0<=a&&0<=o&&0<=s)if(null===m)u.push(t);else{c=function(e,t,r,n,i,a){var o=0;return e>t&&e>r?(i<e&&(o|=2),a<e&&(o|=1)):t>r?(n<t&&(o|=4),a<t&&(o|=1)):(n<r&&(o|=4),i<r&&(o|=2)),o}(r,n,i,h=.5*(r+a),f=.5*(n+o),p=.5*(i+s));do{0===c?(e(m[be],r,n,i,h,f,p,l,u),c=d(c,h,f,p)):1===c?(e(m[1^be],r,n,p,h,f,s,l,u),c=d(c,h,f,s)):2===c?(e(m[2^be],r,f,i,h,o,p,l,u),c=d(c,h,o,p)):3===c?(e(m[3^be],r,f,p,h,o,s,l,u),c=d(c,h,o,s)):4===c?(e(m[4^be],h,n,i,a,f,p,l,u),c=d(c,a,f,p)):5===c?(e(m[5^be],h,n,p,a,f,s,l,u),c=d(c,a,f,s)):6===c?(e(m[6^be],h,f,i,a,o,p,l,u),c=d(c,a,o,p)):7===c&&(e(m[7^be],h,f,p,a,o,s,l,u),c=8)}while(8>c)}}(e.root,o,l,c,s,u,h,t,r)}}]),e}(),we=new I,xe=function(){function e(r,n){t(this,e),this.root=void 0!==r&&void 0!==n?new le(r,n):null}return n(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"getDepth",value:function(){return function e(t){var r,n,i,a=t.children,o=0;if(null!==a)for(r=0,n=a.length;r<n;++r)(i=1+e(a[r]))>o&&(o=i);return o}(this.root)}},{key:"cull",value:function(e){var t=[];return function e(t,r,n){var i,a,o=t.children;if(we.min=t.min,we.max=t.max,r.intersectsBox(we))if(null!==o)for(i=0,a=o.length;i<a;++i)e(o[i],r,n);else n.push(t)}(this.root,e,t),t}},{key:"findOctantsByLevel",value:function(e){var t=[];return function e(t,r,n,i){var a,o,s=t.children;if(n===r)i.push(t);else if(null!==s)for(++n,a=0,o=s.length;a<o;++a)e(s[a],r,n,i)}(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Ee.intersectOctree(this,e,t),t}},{key:"leaves",value:function(e){return new me(this,e)}},{key:Symbol.iterator,value:function(){return new me(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),Te=new P,Se=function(e){function r(e,n){var i;return t(this,r),(i=l(this,a(r).call(this,e,n))).points=null,i.data=null,i}return i(r,le),n(r,[{key:"distanceToSquared",value:function(e){return Te.copy(e).clamp(this.min,this.max).sub(e).lengthSquared()}},{key:"distanceToCenterSquared",value:function(e){var t=this.getCenter(Te),r=e.x-t.x,n=e.y-t.x,i=e.z-t.z;return r*r+n*n+i*i}},{key:"contains",value:function(e,t){var r=this.min,n=this.max;return e.x>=r.x-t&&e.y>=r.y-t&&e.z>=r.z-t&&e.x<=n.x+t&&e.y<=n.y+t&&e.z<=n.z+t}},{key:"redistribute",value:function(e){var t,r,n,i,a,o,s,l=this.children,u=this.points,c=this.data;if(null!==l&&null!==u)for(t=0,n=u.length;t<n;++t)for(o=u[t],s=c[t],r=0,i=l.length;r<i;++r)if((a=l[r]).contains(o,e)){null===a.points&&(a.points=[],a.data=[]),a.points.push(o),a.data.push(s);break}this.points=null,this.data=null}},{key:"merge",value:function(){var e,t,r,n=this.children;if(null!==n){for(this.points=[],this.data=[],e=0,t=n.length;e<t;++e)if(null!==(r=n[e]).points){var i,a;(i=this.points).push.apply(i,c(r.points)),(a=this.data).push.apply(a,c(r.data))}this.children=null}}}]),r}(),Me=function e(r,n,i){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;t(this,e),this.distance=r,this.distanceToRay=n,this.point=i,this.object=a},Re=1e-6,Ae=function(e){function r(e,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,u=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return t(this,r),(i=l(this,a(r).call(this))).root=new Se(e,n),i.bias=M(0,o),i.maxPoints=M(1,b(s)),i.maxDepth=M(0,b(u)),i.pointCount=0,i}return i(r,xe),n(r,[{key:"countPoints",value:function(e){return f(e)}},{key:"put",value:function(e,t){return p(e,t,this,this.root,0)}},{key:"remove",value:function(e){return m(e,this,this.root,null)}},{key:"fetch",value:function(e){return function e(t,r,n){var i,a,o,s=n.children,l=null;if(n.contains(t,r.bias))if(null!==s)for(i=0,a=s.length;null===l&&i<a;++i)l=e(t,r,s[i]);else if(null!==n.points)for(i=0,a=(o=n.points).length;null===l&&i<a;++i)t.distanceToSquared(o[i])<=Re&&(l=n.data[i]);return l}(e,this,this.root)}},{key:"move",value:function(e,t){return function e(t,r,n,i,a,o){var s,l,u,c=i.children,h=null;if(i.contains(t,n.bias))if(i.contains(r,n.bias)){if(null!==c)for(++o,s=0,l=c.length;null===h&&s<l;++s)h=e(t,r,n,c[s],i,o);else if(null!==i.points)for(s=0,l=(u=i.points).length;s<l;++s)if(t.distanceToSquared(u[s])<=Re){u[s].copy(r),h=i.data[s];break}}else p(r,h=m(t,n,i,a),n,a,o-1);return h}(e,t,this,this.root,null,0)}},{key:"findNearestPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return v(e,t,r,this.root)}},{key:"findPoints",value:function(e,t){var r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=[];return g(e,t,r,this.root,n),n}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=u(a(r.prototype),"raycast",this).call(this,e);return 0<n.length&&this.testPoints(n,e,t),t}},{key:"testPoints",value:function(e,t,r){var n,i,a,o,s,l,u,c,h,d,f,p=t.params.Points.threshold;for(s=0,u=e.length;s<u;++s)if(null!==(d=(h=e[s]).points))for(l=0,c=d.length;l<c;++l)f=d[l],(o=t.ray.distanceSqToPoint(f))<p*p&&(n=t.ray.closestPointToPoint(f,new P),(i=t.ray.origin.distanceTo(n))>=t.near&&i<=t.far&&(a=R(o),r.push(new Me(i,a,n,h.data[l]))))}}]),r}(),ke=new I,Pe=new P,Ce=new P,Le=new P,Ie=function(){function e(){t(this,e)}return n(e,null,[{key:"recycleOctants",value:function(e,t){var r,n,i,a,o=e.min,s=e.getCenter(Ce),l=e.getDimensions(Le).multiplyScalar(.5),u=e.children,c=t.length;for(r=0;8>r;++r)for(i=ue[r],ke.min.addVectors(o,Pe.fromArray(i).multiply(l)),ke.max.addVectors(s,Pe.fromArray(i).multiply(l)),n=0;n<c;++n)if(null!==(a=t[n])&&ke.min.equals(a.min)&&ke.max.equals(a.max)){u[r]=a,t[n]=null;break}}}]),e}();e.CubicOctant=de,e.edges=ce,e.Octant=le,e.Octree=xe,e.OctantIterator=me,e.OctreeRaycaster=Ee,e.pattern=ue,e.PointOctant=Se,e.PointOctree=Ae,e.RayPointIntersection=Me,e.OctreeUtils=Ie,Object.defineProperty(e,"__esModule",{value:!0})})},function(e,t,r){e.exports=function(){"use strict";var e=Math.pow(2,-52),t=function(t){var o=t.length>>1;if(o>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;var s=2*o-5,l=this.triangles=new Uint32Array(3*s),u=this.halfedges=new Int32Array(3*s);this._hashSize=Math.ceil(Math.sqrt(o));for(var c=this.hullPrev=new Uint32Array(o),h=this.hullNext=new Uint32Array(o),d=this.hullTri=new Uint32Array(o),f=new Int32Array(this._hashSize).fill(-1),p=new Uint32Array(o),m=1/0,v=1/0,g=-1/0,y=-1/0,_=0;_<o;_++){var b=t[2*_],E=t[2*_+1];b<m&&(m=b),E<v&&(v=E),b>g&&(g=b),E>y&&(y=E),p[_]=_}for(var w,x,T,S=(m+g)/2,M=(v+y)/2,R=1/0,A=0;A<o;A++){var k=r(S,M,t[2*A],t[2*A+1]);k<R&&(w=A,R=k)}var P=t[2*w],C=t[2*w+1];R=1/0;for(var L=0;L<o;L++)if(L!==w){var I=r(P,C,t[2*L],t[2*L+1]);I<R&&I>0&&(x=L,R=I)}for(var O=t[2*x],H=t[2*x+1],D=1/0,N=0;N<o;N++)if(N!==w&&N!==x){var F=i(P,C,O,H,t[2*N],t[2*N+1]);F<D&&(T=N,D=F)}var U=t[2*T],B=t[2*T+1];if(D===1/0)throw new Error("No Delaunay triangulation exists for this input.");if(n(P,C,O,H,U,B)){var z=x,j=O,V=H;x=T,O=U,H=B,T=z,U=j,B=V}var G=function(e,t,r,n,i,a){var o=NaN,s=NaN,l=NaN,u=NaN,c=o*o+s*s,h=l*l+u*u,d=.5/(o*u-s*l);return{x:e+(u*c-s*h)*d,y:t+(o*h-l*c)*d}}(P,C);this._cx=G.x,this._cy=G.y;for(var W=new Float64Array(o),X=0;X<o;X++)W[X]=r(t[2*X],t[2*X+1],G.x,G.y);!function e(t,r,n,i){if(i-n<=20)for(var o=n+1;o<=i;o++){for(var s=t[o],l=r[s],u=o-1;u>=n&&r[t[u]]>l;)t[u+1]=t[u--];t[u+1]=s}else{var c=n+i>>1,h=n+1,d=i;a(t,c,h),r[t[n]]>r[t[i]]&&a(t,n,i),r[t[h]]>r[t[i]]&&a(t,h,i),r[t[n]]>r[t[h]]&&a(t,n,h);for(var f=t[h],p=r[f];;){do{h++}while(r[t[h]]<p);do{d--}while(r[t[d]]>p);if(d<h)break;a(t,h,d)}t[n+1]=t[d],t[d]=f,i-h+1>=d-n?(e(t,r,h,i),e(t,r,n,d-1)):(e(t,r,n,d-1),e(t,r,h,i))}}(p,W,0,o-1),this.hullStart=w;var Y=3;h[w]=c[T]=x,h[x]=c[w]=T,h[T]=c[x]=w,d[w]=0,d[x]=1,d[T]=2,f[this._hashKey(P,C)]=w,f[this._hashKey(O,H)]=x,f[this._hashKey(U,B)]=T,this.trianglesLen=0,this._addTriangle(w,x,T,-1,-1,-1);for(var q=0,Z=void 0,J=void 0;q<p.length;q++){var K=p[q],Q=t[2*K],$=t[2*K+1];if(!(q>0&&Math.abs(Q-Z)<=e&&Math.abs($-J)<=e)&&(Z=Q,J=$,K!==w&&K!==x&&K!==T)){for(var ee=0,te=0,re=this._hashKey(Q,$);te<this._hashSize&&(-1===(ee=f[(re+te)%this._hashSize])||ee===h[ee]);te++);for(var ne=ee=c[ee],ie=void 0;ie=h[ne],!n(Q,$,t[2*ne],t[2*ne+1],t[2*ie],t[2*ie+1]);)if((ne=ie)===ee){ne=-1;break}if(-1!==ne){var ae=this._addTriangle(ne,K,h[ne],-1,-1,d[ne]);d[K]=this._legalize(ae+2),d[ne]=ae,Y++;for(var oe=h[ne];ie=h[oe],n(Q,$,t[2*oe],t[2*oe+1],t[2*ie],t[2*ie+1]);)ae=this._addTriangle(oe,K,ie,d[K],-1,d[oe]),d[K]=this._legalize(ae+2),h[oe]=oe,Y--,oe=ie;if(ne===ee)for(;n(Q,$,t[2*(ie=c[ne])],t[2*ie+1],t[2*ne],t[2*ne+1]);)ae=this._addTriangle(ie,K,ne,-1,d[ne],d[ie]),this._legalize(ae+2),d[ie]=ae,h[ne]=ne,Y--,ne=ie;this.hullStart=c[K]=ne,h[ne]=c[oe]=K,h[K]=oe,f[this._hashKey(Q,$)]=K,f[this._hashKey(t[2*ne],t[2*ne+1])]=ne}}}this.hull=new Uint32Array(Y);for(var se=0,le=this.hullStart;se<Y;se++)this.hull[se]=le,le=h[le];this.hullPrev=this.hullNext=this.hullTri=null,this.triangles=l.subarray(0,this.trianglesLen),this.halfedges=u.subarray(0,this.trianglesLen)};function r(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}function n(e,t,r,n,i,a){return(n-t)*(i-r)-(r-e)*(a-n)<0}function i(e,t,r,n,i,a){var o=r-e,s=n-t,l=i-e,u=a-t,c=o*o+s*s,h=l*l+u*u,d=.5/(o*u-s*l),f=(u*c-s*h)*d,p=(o*h-l*c)*d;return f*f+p*p}function a(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function o(e){return e[0]}function s(e){return e[1]}return t.from=function(e,r,n){void 0===r&&(r=o),void 0===n&&(n=s);for(var i=e.length,a=new Float64Array(2*i),l=0;l<i;l++){var u=e[l];a[2*l]=r(u),a[2*l+1]=n(u)}return new t(a)},t.prototype._hashKey=function(e,t){return Math.floor((r=e-this._cx,n=t-this._cy,i=r/(Math.abs(r)+Math.abs(n)),(n>0?3-i:1+i)/4*this._hashSize))%this._hashSize;var r,n,i},t.prototype._legalize=function(e){var t=this.triangles,r=this.coords,n=this.halfedges,i=n[e],a=e-e%3,o=i-i%3,s=a+(e+1)%3,l=a+(e+2)%3,u=o+(i+2)%3;if(-1===i)return l;var c,h,d,f,p,m,v,g,y,_,b,E,w,x,T,S,M=t[l],R=t[e],A=t[s],k=t[u];if(c=r[2*M],h=r[2*M+1],d=r[2*R],f=r[2*R+1],p=r[2*A],m=r[2*A+1],v=r[2*k],g=r[2*k+1],(y=c-v)*((E=f-g)*(S=(w=p-v)*w+(x=m-g)*x)-(T=(b=d-v)*b+E*E)*x)-(_=h-g)*(b*S-T*w)+(y*y+_*_)*(b*x-E*w)<0){t[e]=k,t[i]=M;var P=n[u];if(-1===P){var C=this.hullStart;do{if(this.hullTri[C]===u){this.hullTri[C]=e;break}C=this.hullNext[C]}while(C!==this.hullStart)}this._link(e,P),this._link(i,n[l]),this._link(l,u);var L=o+(i+1)%3;return this._legalize(e),this._legalize(L)}return l},t.prototype._link=function(e,t){this.halfedges[e]=t,-1!==t&&(this.halfedges[t]=e)},t.prototype._addTriangle=function(e,t,r,n,i,a){var o=this.trianglesLen;return this.triangles[o]=e,this.triangles[o+1]=t,this.triangles[o+2]=r,this._link(o,n),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o},t}()},function(e,t,r){"use strict";var n=n||{};n.NIFTI1=n.NIFTI1||r(34),n.NIFTI2=n.NIFTI2||r(143),n.Utils=n.Utils||r(17);var i=i||r(12);n.isNIFTI1=function(e){var t,r,i,a;return!(e.byteLength<n.NIFTI1.STANDARD_HEADER_SIZE)&&((t=new DataView(e))&&(r=t.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION)),i=t.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(r!==n.NIFTI1.MAGIC_NUMBER[0]||i!==n.NIFTI1.MAGIC_NUMBER[1]||a!==n.NIFTI1.MAGIC_NUMBER[2]))},n.isNIFTI2=function(e){var t,r,i,a;return!(e.byteLength<n.NIFTI1.STANDARD_HEADER_SIZE)&&(r=(t=new DataView(e)).getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION),i=t.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(r!==n.NIFTI2.MAGIC_NUMBER[0]||i!==n.NIFTI2.MAGIC_NUMBER[1]||a!==n.NIFTI2.MAGIC_NUMBER[2]))},n.isNIFTI=function(e){return n.isNIFTI1(e)||n.isNIFTI2(e)},n.isCompressed=function(e){var t,r,i;if(e){if(r=(t=new DataView(e)).getUint8(0),i=t.getUint8(1),r===n.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(i===n.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},n.decompress=function(e){return i.inflate(e).buffer},n.readHeader=function(e){var t=null;return n.isCompressed(e)&&(e=n.decompress(e)),n.isNIFTI1(e)?t=new n.NIFTI1:n.isNIFTI2(e)&&(t=new n.NIFTI2),t?t.readHeader(e):console.error("That file does not appear to be NIFTI!"),t},n.hasExtension=function(e){return 0!=e.extensionFlag[0]},n.readImage=function(e,t){var r=e.vox_offset,n=1,i=1;e.dims[4]&&(n=e.dims[4]),e.dims[5]&&(i=e.dims[5]);var a=e.dims[1]*e.dims[2]*e.dims[3]*n*i*(e.numBitsPerVoxel/8);return t.slice(r,r+a)},n.readExtension=function(e,t){var r=e.getExtensionLocation(),n=e.extensionSize;return t.slice(r,r+n)},n.readExtensionData=function(e,t){var r=e.getExtensionLocation(),n=e.extensionSize;return t.slice(r+8,r+n-8)},"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";var n={};(0,r(1).assign)(n,r(118),r(121),r(25)),e.exports=n},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){"use strict";e.exports=function(e){return"string"==typeof e}},function(e,t,r){"use strict";var n=r(131);e.exports=function(e){return n(e)&&e>=0}},function(e,t,r){"use strict";var n=r(14),i=r(15),a=9007199254740991;e.exports=function(e,t){var r,o;if(!n(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(0===e.length||0===t)return"";if(e.length*t>a)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(r="",o=t;1==(1&o)&&(r+=e),0!=(o>>>=1);)e+=e;return r}},function(e,t,r){"use strict";var n=n||{};n.Utils=n.Utils||{},n.Utils.crcTable=null,n.Utils.GUNZIP_MAGIC_COOKIE1=31,n.Utils.GUNZIP_MAGIC_COOKIE2=139,n.Utils.getStringAt=function(e,t,r){var n,i,a="";for(n=t;n<r;n+=1)0!==(i=e.getUint8(n))&&(a+=String.fromCharCode(i));return a},n.Utils.getByteAt=function(e,t){return e.getInt8(t)},n.Utils.getShortAt=function(e,t,r){return e.getInt16(t,r)},n.Utils.getIntAt=function(e,t,r){return e.getInt32(t,r)},n.Utils.getFloatAt=function(e,t,r){return e.getFloat32(t,r)},n.Utils.getDoubleAt=function(e,t,r){return e.getFloat64(t,r)},n.Utils.getLongAt=function(e,t,r){var i,a=[],o=0;for(i=0;i<8;i+=1)a[i]=n.Utils.getByteAt(e,t+i,r);for(i=a.length-1;i>=0;i--)o=256*o+a[i];return o},n.Utils.toArrayBuffer=function(e){var t,r,n;for(t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n+=1)r[n]=e[n];return t},n.Utils.isString=function(e){return"string"==typeof e||e instanceof String},n.Utils.formatNumber=function(e,t){var r=0;return r=n.Utils.isString(e)?Number(e):e,r=t?r.toPrecision(5):r.toPrecision(7),parseFloat(r)},n.Utils.makeCRCTable=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},n.Utils.crc32=function(e){for(var t=n.Utils.crcTable||(n.Utils.crcTable=n.Utils.makeCRCTable()),r=-1,i=0;i<e.byteLength;i++)r=r>>>8^t[255&(r^e.getUint8(i))];return(-1^r)>>>0},"undefined"!==typeof e&&e.exports&&(e.exports=n.Utils)},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";var e=void 0,t=this;function r(r,n){var i,a=r.split("."),o=t;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===e?o=o[i]?o[i]:o[i]={}:o[i]=n}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e){var t,r,i,a,o,s,l,u,c,h,d=e.length,f=0,p=Number.POSITIVE_INFINITY;for(u=0;u<d;++u)e[u]>f&&(f=e[u]),e[u]<p&&(p=e[u]);for(t=1<<f,r=new(n?Uint32Array:Array)(t),i=1,a=0,o=2;i<=f;){for(u=0;u<d;++u)if(e[u]===i){for(s=0,l=a,c=0;c<i;++c)s=s<<1|1&l,l>>=1;for(h=i<<16|u,c=s;c<t;c+=o)r[c]=h;++a}++i,a<<=1,o<<=1}return[r,f,p]}function a(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=n?new Uint8Array(e):e,this.m=!1,this.i=s,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case o:this.b=32768,this.c=new(n?Uint8Array:Array)(32768+this.h+258);break;case s:this.b=0,this.c=new(n?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var o=0,s=1,l={t:o,s:s};a.prototype.k=function(){for(;!this.m;){var t=R(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var r=this.input,a=this.a,l=this.c,u=this.b,c=r.length,h=e,f=l.length,p=e;if(this.d=this.f=0,a+1>=c)throw Error("invalid uncompressed block header: LEN");if(h=r[a++]|r[a++]<<8,a+1>=c)throw Error("invalid uncompressed block header: NLEN");if(h===~(r[a++]|r[a++]<<8))throw Error("invalid uncompressed block header: length verify");if(a+h>r.length)throw Error("input buffer is broken");switch(this.i){case o:for(;u+h>l.length;){if(h-=p=f-u,n)l.set(r.subarray(a,a+p),u),u+=p,a+=p;else for(;p--;)l[u++]=r[a++];this.b=u,l=this.e(),u=this.b}break;case s:for(;u+h>l.length;)l=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(n)l.set(r.subarray(a,a+h),u),u+=h,a+=h;else for(;h--;)l[u++]=r[a++];this.a=a,this.b=u,this.c=l;break;case 1:this.j(T,M);break;case 2:var m,v,g,y,_=R(this,5)+257,b=R(this,5)+1,E=R(this,4)+4,w=new(n?Uint8Array:Array)(d.length),x=e,S=e,k=e,P=e,C=e;for(C=0;C<E;++C)w[d[C]]=R(this,3);if(!n)for(C=E,E=w.length;C<E;++C)w[d[C]]=0;for(m=i(w),x=new(n?Uint8Array:Array)(_+b),C=0,y=_+b;C<y;)switch(S=A(this,m),S){case 16:for(P=3+R(this,2);P--;)x[C++]=k;break;case 17:for(P=3+R(this,3);P--;)x[C++]=0;k=0;break;case 18:for(P=11+R(this,7);P--;)x[C++]=0;k=0;break;default:k=x[C++]=S}v=i(n?x.subarray(0,_):x.slice(0,_)),g=i(n?x.subarray(_):x.slice(_)),this.j(v,g);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var u,c,h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=n?new Uint16Array(h):h,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],p=n?new Uint16Array(f):f,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],v=n?new Uint8Array(m):m,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],y=n?new Uint16Array(g):g,_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=n?new Uint8Array(_):_,E=new(n?Uint8Array:Array)(288);for(u=0,c=E.length;u<c;++u)E[u]=143>=u?8:255>=u?9:279>=u?7:8;var w,x,T=i(E),S=new(n?Uint8Array:Array)(30);for(w=0,x=S.length;w<x;++w)S[w]=5;var M=i(S);function R(e,t){for(var r,n=e.f,i=e.d,a=e.input,o=e.a,s=a.length;i<t;){if(o>=s)throw Error("input buffer is broken");n|=a[o++]<<i,i+=8}return r=n&(1<<t)-1,e.f=n>>>t,e.d=i-t,e.a=o,r}function A(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.a,l=o.length,u=t[0],c=t[1];a<c&&!(s>=l);)i|=o[s++]<<a,a+=8;if((n=(r=u[i&(1<<c)-1])>>>16)>a)throw Error("invalid code length: "+n);return e.f=i>>n,e.d=a-n,e.a=s,65535&r}function k(e,t){var r,n;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),r=e[this.a++],n=e[this.a++],15&r){case P:this.method=P;break;default:throw Error("unsupported compression method")}if(0!=((r<<8)+n)%31)throw Error("invalid fcheck flag:"+((r<<8)+n)%31);if(32&n)throw Error("fdict flag is not supported");this.q=new a(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}a.prototype.j=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length-258;256!==(i=A(this,e));)if(256>i)n>=l&&(this.b=n,r=this.e(),n=this.b),r[n++]=i;else for(s=p[a=i-257],0<v[a]&&(s+=R(this,v[a])),i=A(this,t),o=y[i],0<b[i]&&(o+=R(this,b[i])),n>=l&&(this.b=n,r=this.e(),n=this.b);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.w=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length;256!==(i=A(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=p[a=i-257],0<v[a]&&(s+=R(this,v[a])),i=A(this,t),o=y[i],0<b[i]&&(o+=R(this,b[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.e=function(){var e,t,r=new(n?Uint8Array:Array)(this.b-32768),i=this.b-32768,a=this.c;if(n)r.set(a.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=a[e+32768];if(this.g.push(r),this.l+=r.length,n)a.set(a.subarray(i,i+32768));else for(e=0;32768>e;++e)a[e]=a[i+e];return this.b=32768,a},a.prototype.z=function(e){var t,r,i,a=this.input.length/this.a+1|0,o=this.input,s=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),2>a?r=(i=(o.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+i:s.length<<1:r=s.length*a,n?(t=new Uint8Array(r)).set(s):t=s,this.c=t},a.prototype.n=function(){var e,t,r,i,a,o=0,s=this.c,l=this.g,u=new(n?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return n?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,r=l.length;t<r;++t)for(i=0,a=(e=l[t]).length;i<a;++i)u[o++]=e[i];for(t=32768,r=this.b;t<r;++t)u[o++]=s[t];return this.g=[],this.buffer=u},a.prototype.v=function(){var e,t=this.b;return n?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},k.prototype.k=function(){var e,t,r=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;var n=e;if("string"==typeof n){var i,a,o=n.split("");for(i=0,a=o.length;i<a;i++)o[i]=(255&o[i].charCodeAt(0))>>>0;n=o}for(var s,l=1,u=0,c=n.length,h=0;0<c;){c-=s=1024<c?1024:c;do{u+=l+=n[h++]}while(--s);l%=65521,u%=65521}if(t!==(u<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return e};var P=8;r("Zlib.Inflate",k),r("Zlib.Inflate.prototype.decompress",k.prototype.k);var C,L,I,O,H={ADAPTIVE:l.s,BLOCK:l.t};if(Object.keys)C=Object.keys(H);else for(L in C=[],I=0,H)C[I++]=L;for(I=0,O=C.length;I<O;++I)r("Zlib.Inflate.BufferType."+(L=C[I]),H[L])}).call(this)},function(e,t,r){var n=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),t(++r%i.children.length)},!1);var a=(performance||Date).now(),o=a,s=0,l=e(new n.Panel("FPS","#0ff","#002")),u=e(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new n.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:i,setMode:t}};n.Panel=function(e,t,r){var n=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,u=3*o,c=2*o,h=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=r,v.fillRect(0,0,s,l),v.fillStyle=t,v.fillText(e,u,c),v.fillRect(h,d,f,p),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(h,d,f,p),{dom:m,update:function(l,g){n=Math.min(n,l),i=Math.max(i,l),v.fillStyle=r,v.globalAlpha=1,v.fillRect(0,0,s,d),v.fillStyle=t,v.fillText(a(l)+" "+e+" ("+a(n)+"-"+a(i)+")",u,c),v.drawImage(m,h+o,d,f-o,p,h,d,f-o,p),v.fillRect(h+f-o,d,o,p),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(h+f-o,d,o,a((1-l/g)*p))}}},e.exports=n},function(module,exports,__webpack_require__){(function(process,__dirname){/*! OpenJPEG.js - v0.10.2 - 2016-07-11 | (c) 2016 Chris Hafey | https://github.com/chafey/openjpeg */
var OpenJPEG=function(Module){var Module;Module=Module||{},Module||(Module=(void 0!==OpenJPEG?OpenJPEG:null)||{});var moduleOverrides={};for(var key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER,ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print||(Module.print=function(e){process.stdout.write(e+"\n")}),Module.printErr||(Module.printErr=function(e){process.stderr.write(e+"\n")});var nodeFS=__webpack_require__(136),nodePath=__webpack_require__(137);Module.read=function(e,t){e=nodePath.normalize(e);var r=nodeFS.readFileSync(e);return r||e==nodePath.resolve(e)||(e=path.join(__dirname,"..","src",e),r=nodeFS.readFileSync(e)),r&&!t&&(r=r.toString()),r},Module.readBinary=function(e){var t=Module.read(e,!0);return t.buffer||(t=new Uint8Array(t)),assert(t.buffer),t},Module.load=function(e){globalEval(read(e))},Module.thisProgram||(process.argv.length>1?Module.thisProgram=process.argv[1].replace(/\\/g,"/"):Module.thisProgram="unknown-program"),Module.arguments=process.argv.slice(2),module.exports=Module,process.on("uncaughtException",function(e){if(!(e instanceof ExitStatus))throw e}),Module.inspect=function(){return"[Emscripten Module object]"}}else if(ENVIRONMENT_IS_SHELL)Module.print||(Module.print=print),"undefined"!=typeof printErr&&(Module.printErr=printErr),"undefined"!=typeof read?Module.read=read:Module.read=function(){throw"no read() available (jsc?)"},Module.readBinary=function(e){if("function"==typeof readbuffer)return new Uint8Array(readbuffer(e));var t=read(e,"binary");return assert("object"==typeof t),t},"undefined"!=typeof scriptArgs?Module.arguments=scriptArgs:void 0!==arguments&&(Module.arguments=arguments);else{if(!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER)throw"Unknown runtime environment. Where are we?";if(Module.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},void 0!==arguments&&(Module.arguments=arguments),"undefined"!=typeof console)Module.print||(Module.print=function(e){console.log(e)}),Module.printErr||(Module.printErr=function(e){console.log(e)});else{var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&"undefined"!=typeof dump?function(e){dump(e)}:function(e){})}ENVIRONMENT_IS_WORKER&&(Module.load=importScripts),void 0===Module.setWindowTitle&&(Module.setWindowTitle=function(e){document.title=e})}function globalEval(e){eval.call(null,e)}for(var key in!Module.load&&Module.read&&(Module.load=function(e){globalEval(Module.read(e))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.thisProgram||(Module.thisProgram="./this.program"),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun=[],Module.postRun=[],moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);var Runtime={setTempRet0:function(e){tempRet0=e},getTempRet0:function(){return tempRet0},stackSave:function(){return STACKTOP},stackRestore:function(e){STACKTOP=e},getNativeTypeSize:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return Runtime.QUANTUM_SIZE;if("i"===e[0]){var t=parseInt(e.substr(1));return assert(t%8==0),t/8}return 0}},getNativeFieldSize:function(e){return Math.max(Runtime.getNativeTypeSize(e),Runtime.QUANTUM_SIZE)},STACK_ALIGN:16,prepVararg:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},getAlignSize:function(e,t,r){return r||"i64"!=e&&"double"!=e?e?Math.min(t||(e?Runtime.getNativeFieldSize(e):0),Runtime.QUANTUM_SIZE):Math.min(t,8):8},dynCall:function(e,t,r){return r&&r.length?(r.splice||(r=Array.prototype.slice.call(r)),r.splice(0,0,t),Module["dynCall_"+e].apply(null,r)):Module["dynCall_"+e].call(null,t)},functionPointers:[],addFunction:function(e){for(var t=0;t<Runtime.functionPointers.length;t++)if(!Runtime.functionPointers[t])return Runtime.functionPointers[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},removeFunction:function(e){Runtime.functionPointers[(e-2)/2]=null},warnOnce:function(e){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[e]||(Runtime.warnOnce.shown[e]=1,Module.printErr(e))},funcWrappers:{},getFuncWrapper:function(e,t){assert(t),Runtime.funcWrappers[t]||(Runtime.funcWrappers[t]={});var r=Runtime.funcWrappers[t];return r[e]||(r[e]=function(){return Runtime.dynCall(t,e,arguments)}),r[e]},getCompilerSetting:function(e){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},stackAlloc:function(e){var t=STACKTOP;return STACKTOP=(STACKTOP=STACKTOP+e|0)+15&-16,t},staticAlloc:function(e){var t=STATICTOP;return STATICTOP=(STATICTOP=STATICTOP+e|0)+15&-16,t},dynamicAlloc:function(e){var t=DYNAMICTOP;if((DYNAMICTOP=(DYNAMICTOP=DYNAMICTOP+e|0)+15&-16)>=TOTAL_MEMORY&&!enlargeMemory())return DYNAMICTOP=t,0;return t},alignMemory:function(e,t){return e=Math.ceil(e/(t||16))*(t||16)},makeBigInt:function(e,t,r){return r?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module.Runtime=Runtime;var __THREW__=0,ABORT=!1,EXITSTATUS=0,undef=0,tempValue,tempInt,tempBigInt,tempInt2,tempBigInt2,tempPair,tempBigIntI,tempBigIntR,tempBigIntS,tempBigIntP,tempBigIntD,tempDouble,tempFloat,tempI64,tempI64b,tempRet0,tempRet1,tempRet2,tempRet3,tempRet4,tempRet5,tempRet6,tempRet7,tempRet8,tempRet9;function assert(e,t){e||abort("Assertion failed: "+t)}var globalScope=this,cwrap,ccall;function getCFunc(ident){var func=Module["_"+ident];if(!func)try{func=eval("_"+ident)}catch(e){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}function setValue(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":HEAP8[e>>0]=t;break;case"i16":HEAP16[e>>1]=t;break;case"i32":HEAP32[e>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,+Math_abs(tempDouble)>=1?tempDouble>0?(0|Math_min(+Math_floor(tempDouble/4294967296),4294967295))>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=t;break;case"double":HEAPF64[e>>3]=t;break;default:abort("invalid type for setValue: "+r)}}function getValue(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return HEAP8[e>>0];case"i16":return HEAP16[e>>1];case"i32":case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for setValue: "+t)}return null}!function(){var JSfuncs={stackSave:function(){Runtime.stackSave()},stackRestore:function(){Runtime.stackRestore()},arrayToC:function(e){var t=Runtime.stackAlloc(e.length);return writeArrayToMemory(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&writeStringToMemory(e,t=Runtime.stackAlloc(1+(e.length<<2))),t}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};ccall=function(e,t,r,n,i){var a=getCFunc(e),o=[],s=0;if(n)for(var l=0;l<n.length;l++){var u=toC[r[l]];u?(0===s&&(s=Runtime.stackSave()),o[l]=u(n[l])):o[l]=n[l]}var c=a.apply(null,o);if("string"===t&&(c=Pointer_stringify(c)),0!==s){if(i&&i.async)return void EmterpreterAsync.asyncFinalizers.push(function(){Runtime.stackRestore(s)});Runtime.stackRestore(s)}return c};var sourceRegex=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/;function parseJSFunc(e){var t=e.toString().match(sourceRegex).slice(1);return{arguments:t[0],body:t[1],returnValue:t[2]}}var JSsource={};for(var fun in JSfuncs)JSfuncs.hasOwnProperty(fun)&&(JSsource[fun]=parseJSFunc(JSfuncs[fun]));cwrap=function cwrap(ident,returnType,argTypes){argTypes=argTypes||[];var cfunc=getCFunc(ident),numericArgs=argTypes.every(function(e){return"number"===e}),numericRet="string"!==returnType;if(numericRet&&numericArgs)return cfunc;var argNames=argTypes.map(function(e,t){return"$"+t}),funcstr="(function("+argNames.join(",")+") {",nargs=argTypes.length;if(!numericArgs){funcstr+="var stack = "+JSsource.stackSave.body+";";for(var i=0;i<nargs;i++){var arg=argNames[i],type=argTypes[i];if("number"!==type){var convertCode=JSsource[type+"ToC"];funcstr+="var "+convertCode.arguments+" = "+arg+";",funcstr+=convertCode.body+";",funcstr+=arg+"="+convertCode.returnValue+";"}}}var cfuncname=parseJSFunc(function(){return cfunc}).returnValue;if(funcstr+="var ret = "+cfuncname+"("+argNames.join(",")+");",!numericRet){var strgfy=parseJSFunc(function(){return Pointer_stringify}).returnValue;funcstr+="ret = "+strgfy+"(ret);"}return numericArgs||(funcstr+=JSsource.stackRestore.body.replace("()","(stack)")+";"),funcstr+="return ret})",eval(funcstr)}}(),Module.ccall=ccall,Module.cwrap=cwrap,Module.setValue=setValue,Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;function allocate(e,t,r,n){var i,a;"number"==typeof e?(i=!0,a=e):(i=!1,a=e.length);var o,s="string"==typeof t?t:null;if(o=r==ALLOC_NONE?n:[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][void 0===r?ALLOC_STATIC:r](Math.max(a,s?1:t.length)),i){var l;n=o;for(assert(0==(3&o)),l=o+(-4&a);n<l;n+=4)HEAP32[n>>2]=0;for(l=o+a;n<l;)HEAP8[n++>>0]=0;return o}if("i8"===s)return e.subarray||e.slice?HEAPU8.set(e,o):HEAPU8.set(new Uint8Array(e),o),o;for(var u,c,h,d=0;d<a;){var f=e[d];"function"==typeof f&&(f=Runtime.getFunctionIndex(f)),0!==(u=s||t[d])?("i64"==u&&(u="i32"),setValue(o+d,f,u),h!==u&&(c=Runtime.getNativeTypeSize(u),h=u),d+=c):d++}return o}function getMemory(e){return staticSealed?void 0!==_sbrk&&!_sbrk.called||!runtimeInitialized?Runtime.dynamicAlloc(e):_malloc(e):Runtime.staticAlloc(e)}function Pointer_stringify(e,t){if(0===t||!e)return"";for(var r,n=0,i=0;n|=r=HEAPU8[e+i>>0],(0!=r||t)&&(i++,!t||i!=t););t||(t=i);var a="";if(n<128){for(var o;t>0;)o=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(t,1024))),a=a?a+o:o,e+=1024,t-=1024;return a}return Module.UTF8ToString(e)}function AsciiToString(e){for(var t="";;){var r=HEAP8[e++>>0];if(!r)return t;t+=String.fromCharCode(r)}}function stringToAscii(e,t){return writeAsciiToMemory(e,t,!1)}function UTF8ArrayToString(e,t){for(var r,n,i,a,o,s="";;){if(!(r=e[t++]))return s;if(128&r)if(n=63&e[t++],192!=(224&r))if(i=63&e[t++],224==(240&r)?r=(15&r)<<12|n<<6|i:(a=63&e[t++],240==(248&r)?r=(7&r)<<18|n<<12|i<<6|a:(o=63&e[t++],r=248==(252&r)?(3&r)<<24|n<<18|i<<12|a<<6|o:(1&r)<<30|n<<24|i<<18|a<<12|o<<6|63&e[t++])),r<65536)s+=String.fromCharCode(r);else{var l=r-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}else s+=String.fromCharCode((31&r)<<6|n);else s+=String.fromCharCode(r)}}function UTF8ToString(e){return UTF8ArrayToString(HEAPU8,e)}function stringToUTF8Array(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=2097151){if(r+3>=a)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=67108863){if(r+4>=a)break;t[r++]=248|s>>24,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+5>=a)break;t[r++]=252|s>>30,t[r++]=128|s>>24&63,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function stringToUTF8(e,t,r){return stringToUTF8Array(e,HEAPU8,t,r)}function lengthBytesUTF8(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:n<=2097151?4:n<=67108863?5:6}return t}function UTF16ToString(e){for(var t=0,r="";;){var n=HEAP16[e+2*t>>1];if(0==n)return r;++t,r+=String.fromCharCode(n)}}function stringToUTF16(e,t,r){if(void 0===r&&(r=2147483647),r<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,a=0;a<i;++a){var o=e.charCodeAt(a);HEAP16[t>>1]=o,t+=2}return HEAP16[t>>1]=0,t-n}function lengthBytesUTF16(e){return 2*e.length}function UTF32ToString(e){for(var t=0,r="";;){var n=HEAP32[e+4*t>>2];if(0==n)return r;if(++t,n>=65536){var i=n-65536;r+=String.fromCharCode(55296|i>>10,56320|1023&i)}else r+=String.fromCharCode(n)}}function stringToUTF32(e,t,r){if(void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a);if(HEAP32[t>>2]=o,(t+=4)+4>i)break}return HEAP32[t>>2]=0,t-n}function lengthBytesUTF32(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function demangle(e){var t=!!Module.___cxa_demangle;if(t)try{var r=_malloc(e.length);writeStringToMemory(e.substr(1),r);var n=_malloc(4),i=Module.___cxa_demangle(r,0,0,n);if(0===getValue(n,"i32")&&i)return Pointer_stringify(i)}catch(e){}finally{r&&_free(r),n&&_free(n),i&&_free(i)}var a=3,o={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},s=[],l=!0;var u=e;try{if("Object._main"==e||"_main"==e)return"main()";if("number"==typeof e&&(e=Pointer_stringify(e)),"_"!==e[0])return e;if("_"!==e[1])return e;if("Z"!==e[2])return e;switch(e[3]){case"n":return"operator new()";case"d":return"operator delete()"}u=function t(r,n,i){n=n||1/0;var u,c="",h=[];if("N"===e[a]){if(u=function(){"K"===e[++a]&&a++;for(var t=[];"E"!==e[a];)if("S"!==e[a])if("C"!==e[a]){var r=parseInt(e.substr(a)),n=r.toString().length;if(!r||!n){a--;break}var i=e.substr(a+n,r);t.push(i),s.push(i),a+=n+r}else t.push(t[t.length-1]),a+=2;else{a++;var o=e.indexOf("_",a),l=e.substring(a,o)||0;t.push(s[l]||"?"),a=o+1}return a++,t}().join("::"),0==--n)return r?[u]:u}else if(("K"===e[a]||l&&"L"===e[a])&&a++,m=parseInt(e.substr(a))){var d=m.toString().length;u=e.substr(a+d,m),a+=d+m}if(l=!1,"I"===e[a]){a++;var f=t(!0);c+=t(!0,1,!0)[0]+" "+u+"<"+f.join(", ")+">"}else c=u;e:for(;a<e.length&&n-- >0;){var p=e[a++];if(p in o)h.push(o[p]);else switch(p){case"P":h.push(t(!0,1,!0)[0]+"*");break;case"R":h.push(t(!0,1,!0)[0]+"&");break;case"L":a++;var m=e.indexOf("E",a)-a;h.push(e.substr(a,m)),a+=m+2;break;case"A":if(m=parseInt(e.substr(a)),a+=m.toString().length,"_"!==e[a])throw"?";a++,h.push(t(!0,1,!0)[0]+" ["+m+"]");break;case"E":break e;default:c+="?"+p;break e}}return i||1!==h.length||"void"!==h[0]||(h=[]),r?(c&&h.push(c+"?"),h):c+"("+h.join(", ")+")"}()}catch(e){u+="?"}return u.indexOf("?")>=0&&!t&&Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),u}function demangleAll(e){return e.replace(/__Z[\w\d_]+/g,function(e){var t=demangle(e);return e===t?e:e+" ["+t+"]"})}function jsStackTrace(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE,Module.allocate=allocate,Module.getMemory=getMemory,Module.Pointer_stringify=Pointer_stringify,Module.AsciiToString=AsciiToString,Module.stringToAscii=stringToAscii,Module.UTF8ArrayToString=UTF8ArrayToString,Module.UTF8ToString=UTF8ToString,Module.stringToUTF8Array=stringToUTF8Array,Module.stringToUTF8=stringToUTF8,Module.lengthBytesUTF8=lengthBytesUTF8,Module.UTF16ToString=UTF16ToString,Module.stringToUTF16=stringToUTF16,Module.lengthBytesUTF16=lengthBytesUTF16,Module.UTF32ToString=UTF32ToString,Module.stringToUTF32=stringToUTF32,Module.lengthBytesUTF32=lengthBytesUTF32,Module.stackTrace=stackTrace;var PAGE_SIZE=4096,HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function alignMemoryPage(e){return e%4096>0&&(e+=4096-e%4096),e}var STATIC_BASE=0,STATICTOP=0,staticSealed=!1,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0,byteLength;function enlargeMemory(){var e=Math.pow(2,31);if(DYNAMICTOP>=e)return!1;for(;TOTAL_MEMORY<=DYNAMICTOP;)if(TOTAL_MEMORY<e/2)TOTAL_MEMORY=alignMemoryPage(2*TOTAL_MEMORY);else{var t=TOTAL_MEMORY;if((TOTAL_MEMORY=alignMemoryPage((3*TOTAL_MEMORY+e)/4))<=t)return!1}if((TOTAL_MEMORY=Math.max(TOTAL_MEMORY,16777216))>=e)return!1;try{if(ArrayBuffer.transfer)buffer=ArrayBuffer.transfer(buffer,TOTAL_MEMORY);else{var r=HEAP8;buffer=new ArrayBuffer(TOTAL_MEMORY)}}catch(e){return!1}return!!_emscripten_replace_memory(buffer)&&(Module.buffer=buffer,Module.HEAP8=HEAP8=new Int8Array(buffer),Module.HEAP16=HEAP16=new Int16Array(buffer),Module.HEAP32=HEAP32=new Int32Array(buffer),Module.HEAPU8=HEAPU8=new Uint8Array(buffer),Module.HEAPU16=HEAPU16=new Uint16Array(buffer),Module.HEAPU32=HEAPU32=new Uint32Array(buffer),Module.HEAPF32=HEAPF32=new Float32Array(buffer),Module.HEAPF64=HEAPF64=new Float64Array(buffer),ArrayBuffer.transfer||HEAP8.set(r),!0)}try{byteLength=Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get),byteLength(new ArrayBuffer(4))}catch(e){byteLength=function(e){return e.byteLength}}for(var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216,totalMemory=65536,buffer;totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK;)totalMemory<16777216?totalMemory*=2:totalMemory+=16777216;function callRuntimeCallbacks(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?Runtime.dynCall("v",r):Runtime.dynCall("vi",r,[t.arg]):r(void 0===t.arg?null:t.arg)}else t()}}totalMemory=Math.max(totalMemory,16777216),totalMemory!==TOTAL_MEMORY&&(TOTAL_MEMORY=totalMemory),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(TOTAL_MEMORY),HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(255===HEAPU8[0]&&0===HEAPU8[3],"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.buffer=buffer,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1;function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__),runtimeExited=!0}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPreMain(e){__ATMAIN__.unshift(e)}function addOnExit(e){__ATEXIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}function intArrayFromString(e,t,r){var n=r>0?r:lengthBytesUTF8(e)+1,i=new Array(n),a=stringToUTF8Array(e,i,0,i.length);return t&&(i.length=a),i}function intArrayToString(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n>255&&(n&=255),t.push(String.fromCharCode(n))}return t.join("")}function writeStringToMemory(e,t,r){for(var n=intArrayFromString(e,r),i=0;i<n.length;){var a=n[i];HEAP8[t+i>>0]=a,i+=1}}function writeArrayToMemory(e,t){for(var r=0;r<e.length;r++)HEAP8[t++>>0]=e[r]}function writeAsciiToMemory(e,t,r){for(var n=0;n<e.length;++n)HEAP8[t++>>0]=e.charCodeAt(n);r||(HEAP8[t>>0]=0)}function unSign(e,t,r){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function reSign(e,t,r){if(e<=0)return e;var n=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=n&&(t<=32||e>n)&&(e=-2*n+e),e}Module.addOnPreRun=addOnPreRun,Module.addOnInit=addOnInit,Module.addOnPreMain=addOnPreMain,Module.addOnExit=addOnExit,Module.addOnPostRun=addOnPostRun,Module.intArrayFromString=intArrayFromString,Module.intArrayToString=intArrayToString,Module.writeStringToMemory=writeStringToMemory,Module.writeArrayToMemory=writeArrayToMemory,Module.writeAsciiToMemory=writeAsciiToMemory,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16)*n+r*(t>>>16)<<16)|0}),Math.imul=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;t<32;t++)if(e&1<<31-t)return t;return 32}),Math.clz32=Math.clz32;var Math_abs=Math.abs,Math_cos=Math.cos,Math_sin=Math.sin,Math_tan=Math.tan,Math_acos=Math.acos,Math_asin=Math.asin,Math_atan=Math.atan,Math_atan2=Math.atan2,Math_exp=Math.exp,Math_log=Math.log,Math_sqrt=Math.sqrt,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_imul=Math.imul,Math_fround=Math.fround,Math_min=Math.min,Math_clz32=Math.clz32,runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}Module.addRunDependency=addRunDependency,Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={};var memoryInitializer=null,ASM_CONSTS=[];STATIC_BASE=8,STATICTOP=STATIC_BASE+25664,__ATINIT__.push(),allocate([131,192,202,161,69,182,251,63,127,251,58,112,206,136,234,63,127,251,58,112,206,136,234,63,131,192,202,161,69,182,251,63,225,122,20,174,71,225,252,63,94,186,73,12,2,43,249,63,0,0,0,0,0,0,240,63,0,0,0,0,0,0,248,63,0,0,0,0,0,0,6,64,0,0,0,0,0,128,21,64,92,143,194,245,40,92,37,64,215,163,112,61,10,87,53,64,246,40,92,143,194,85,69,64,133,235,81,184,30,85,85,64,102,102,102,102,102,86,101,64,205,204,204,204,204,84,117,64,207,247,83,227,165,155,240,63,70,182,243,253,212,120,249,63,39,49,8,172,28,90,7,64,29,90,100,59,223,207,22,64,41,92,143,194,245,168,38,64,164,112,61,10,215,163,54,64,0,0,0,0,0,160,70,64,31,133,235,81,184,158,86,64,205,204,204,204,204,156,102,64,0,0,0,0,0,0,0,0,207,247,83,227,165,155,240,63,70,182,243,253,212,120,249,63,39,49,8,172,28,90,7,64,29,90,100,59,223,207,22,64,41,92,143,194,245,168,38,64,164,112,61,10,215,163,54,64,0,0,0,0,0,160,70,64,31,133,235,81,184,158,86,64,205,204,204,204,204,156,102,64,0,0,0,0,0,0,0,0,173,250,92,109,197,254,230,63,86,125,174,182,98,127,237,63,199,75,55,137,65,96,249,63,242,210,77,98,16,88,8,64,250,126,106,188,116,19,24,64,133,235,81,184,30,5,40,64,0,0,0,0,0,0,56,64,92,143,194,245,40,252,71,64,236,81,184,30,133,251,87,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240,63,113,61,10,215,163,112,255,63,104,145,237,124,63,181,16,64,117,147,24,4,86,206,32,64,102,102,102,102,102,230,48,64,236,81,184,30,133,235,64,64,92,143,194,245,40,236,80,64,154,153,153,153,153,233,96,64,154,153,153,153,153,233,112,64,51,51,51,51,51,231,128,64,147,24,4,86,14,45,0,64,182,243,253,212,120,233,15,64,246,40,92,143,194,181,32,64,10,215,163,112,61,10,49,64,195,245,40,92,143,34,65,64,184,30,133,235,81,40,81,64,154,153,153,153,153,41,97,64,154,153,153,153,153,41,113,64,0,0,0,0,0,40,129,64,0,0,0,0,0,0,0,0,147,24,4,86,14,45,0,64,182,243,253,212,120,233,15,64,246,40,92,143,194,181,32,64,10,215,163,112,61,10,49,64,195,245,40,92,143,34,65,64,184,30,133,235,81,40,81,64,154,153,153,153,153,41,97,64,154,153,153,153,153,41,113,64,0,0,0,0,0,40,129,64,0,0,0,0,0,0,0,0,164,112,61,10,215,163,0,64,236,81,184,30,133,235,14,64,119,190,159,26,47,157,32,64,174,71,225,122,20,46,49,64,123,20,174,71,225,90,65,64,246,40,92,143,194,101,81,64,154,153,153,153,153,105,97,64,154,153,153,153,153,105,113,64,154,153,153,153,153,105,129,64,0,0,0,0,0,0,0,0,4,0,0,0,67,80,82,76,0,0,0,0,0,0,0,0,76,82,67,80,0,0,0,0,3,0,0,0,80,67,82,76,0,0,0,0,1,0,0,0,82,76,67,80,0,0,0,0,2,0,0,0,82,80,67,76,0,0,0,0,255,255,255,255,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,3,0,0,0,4,0,0,0,144,255,0,0,12,0,0,0,1,0,0,0,82,255,0,0,20,0,0,0,2,0,0,0,83,255,0,0,20,0,0,0,3,0,0,0,94,255,0,0,20,0,0,0,4,0,0,0,92,255,0,0,20,0,0,0,5,0,0,0,93,255,0,0,20,0,0,0,6,0,0,0,95,255,0,0,20,0,0,0,7,0,0,0,81,255,0,0,2,0,0,0,8,0,0,0,85,255,0,0,4,0,0,0,9,0,0,0,87,255,0,0,4,0,0,0,10,0,0,0,88,255,0,0,16,0,0,0,11,0,0,0,96,255,0,0,4,0,0,0,12,0,0,0,97,255,0,0,16,0,0,0,13,0,0,0,145,255,0,0,0,0,0,0,0,0,0,0,99,255,0,0,4,0,0,0,14,0,0,0,100,255,0,0,20,0,0,0,15,0,0,0,116,255,0,0,20,0,0,0,16,0,0,0,120,255,0,0,4,0,0,0,17,0,0,0,117,255,0,0,20,0,0,0,18,0,0,0,119,255,0,0,20,0,0,0,19,0,0,0,0,0,0,0,20,0,0,0,0,0,0,0,2,0,0,0,4,0,0,0,4,0,0,0,8,0,0,0,5,0,0,0,6,0,0,0,7,0,0,0,8,0,0,0,9,0,0,0,10,0,0,0,11,0,0,0,12,0,0,0,32,32,80,106,20,0,0,0,112,121,116,102,21,0,0,0,104,50,112,106,22,0,0,0,114,100,104,105,23,0,0,0,114,108,111,99,24,0,0,0,99,99,112,98,25,0,0,0,114,108,99,112,26,0,0,0,112,97,109,99,27,0,0,0,102,101,100,99,28,0,0,0,1,86,0,0,0,0,0,0,164,4,0,0,180,4,0,0,1,86,0,0,1,0,0,0,180,4,0,0,164,4,0,0,1,52,0,0,0,0,0,0,196,4,0,0,68,5,0,0,1,52,0,0,1,0,0,0,212,4,0,0,84,5,0,0,1,24,0,0,0,0,0,0,228,4,0,0,164,5,0,0,1,24,0,0,1,0,0,0,244,4,0,0,180,5,0,0,193,10,0,0,0,0,0,0,4,5,0,0,4,6,0,0,193,10,0,0,1,0,0,0,20,5,0,0,20,6,0,0,33,5,0,0,0,0,0,0,36,5,0,0,36,8,0,0,33,5,0,0,1,0,0,0,52,5,0,0,52,8,0,0,33,2,0,0,0,0,0,0,68,9,0,0,164,8,0,0,33,2,0,0,1,0,0,0,84,9,0,0,180,8,0,0,1,86,0,0,0,0,0,0,100,5,0,0,84,5,0,0,1,86,0,0,1,0,0,0,116,5,0,0,68,5,0,0,1,84,0,0,0,0,0,0,132,5,0,0,68,6,0,0,1,84,0,0,1,0,0,0,148,5,0,0,84,6,0,0,1,72,0,0,0,0,0,0,164,5,0,0,68,6,0,0,1,72,0,0,1,0,0,0,180,5,0,0,84,6,0,0,1,56,0,0,0,0,0,0,196,5,0,0,68,6,0,0,1,56,0,0,1,0,0,0,212,5,0,0,84,6,0,0,1,48,0,0,0,0,0,0,228,5,0,0,164,6,0,0,1,48,0,0,1,0,0,0,244,5,0,0,180,6,0,0,1,36,0,0,0,0,0,0,4,6,0,0,196,6,0,0,1,36,0,0,1,0,0,0,20,6,0,0,212,6,0,0,1,28,0,0,0,0,0,0,36,6,0,0,4,7,0,0,1,28,0,0,1,0,0,0,52,6,0,0,20,7,0,0,1,22,0,0,0,0,0,0,36,8,0,0,36,7,0,0,1,22,0,0,1,0,0,0,52,8,0,0,52,7,0,0,1,86,0,0,0,0,0,0,100,6,0,0,84,6,0,0,1,86,0,0,1,0,0,0,116,6,0,0,68,6,0,0,1,84,0,0,0,0,0,0,132,6,0,0,68,6,0,0,1,84,0,0,1,0,0,0,148,6,0,0,84,6,0,0,1,81,0,0,0,0,0,0,164,6,0,0,100,6,0,0,1,81,0,0,1,0,0,0,180,6,0,0,116,6,0,0,1,72,0,0,0,0,0,0,196,6,0,0,132,6,0,0,1,72,0,0,1,0,0,0,212,6,0,0,148,6,0,0,1,56,0,0,0,0,0,0,228,6,0,0,164,6,0,0,1,56,0,0,1,0,0,0,244,6,0,0,180,6,0,0,1,52,0,0,0,0,0,0,4,7,0,0,196,6,0,0,1,52,0,0,1,0,0,0,20,7,0,0,212,6,0,0,1,48,0,0,0,0,0,0,36,7,0,0,228,6,0,0,1,48,0,0,1,0,0,0,52,7,0,0,244,6,0,0,1,40,0,0,0,0,0,0,68,7,0,0,228,6,0,0,1,40,0,0,1,0,0,0,84,7,0,0,244,6,0,0,1,36,0,0,0,0,0,0,100,7,0,0,4,7,0,0,1,36,0,0,1,0,0,0,116,7,0,0,20,7,0,0,1,34,0,0,0,0,0,0,132,7,0,0,36,7,0,0,1,34,0,0,1,0,0,0,148,7,0,0,52,7,0,0,1,28,0,0,0,0,0,0,164,7,0,0,68,7,0,0,1,28,0,0,1,0,0,0,180,7,0,0,84,7,0,0,1,24,0,0,0,0,0,0,196,7,0,0,100,7,0,0,1,24,0,0,1,0,0,0,212,7,0,0,116,7,0,0,1,22,0,0,0,0,0,0,228,7,0,0,132,7,0,0,1,22,0,0,1,0,0,0,244,7,0,0,148,7,0,0,1,20,0,0,0,0,0,0,4,8,0,0,164,7,0,0,1,20,0,0,1,0,0,0,20,8,0,0,180,7,0,0,1,18,0,0,0,0,0,0,36,8,0,0,196,7,0,0,1,18,0,0,1,0,0,0,52,8,0,0,212,7,0,0,1,17,0,0,0,0,0,0,68,8,0,0,228,7,0,0,1,17,0,0,1,0,0,0,84,8,0,0,244,7,0,0,193,10,0,0,0,0,0,0,100,8,0,0,4,8,0,0,193,10,0,0,1,0,0,0,116,8,0,0,20,8,0,0,193,9,0,0,0,0,0,0,132,8,0,0,36,8,0,0,193,9,0,0,1,0,0,0,148,8,0,0,52,8,0,0,161,8,0,0,0,0,0,0,164,8,0,0,68,8,0,0,161,8,0,0,1,0,0,0,180,8,0,0,84,8,0,0,33,5,0,0,0,0,0,0,196,8,0,0,100,8,0,0,33,5,0,0,1,0,0,0,212,8,0,0,116,8,0,0,65,4,0,0,0,0,0,0,228,8,0,0,132,8,0,0,65,4,0,0,1,0,0,0,244,8,0,0,148,8,0,0,161,2,0,0,0,0,0,0,4,9,0,0,164,8,0,0,161,2,0,0,1,0,0,0,20,9,0,0,180,8,0,0,33,2,0,0,0,0,0,0,36,9,0,0,196,8,0,0,33,2,0,0,1,0,0,0,52,9,0,0,212,8,0,0,65,1,0,0,0,0,0,0,68,9,0,0,228,8,0,0,65,1,0,0,1,0,0,0,84,9,0,0,244,8,0,0,17,1,0,0,0,0,0,0,100,9,0,0,4,9,0,0,17,1,0,0,1,0,0,0,116,9,0,0,20,9,0,0,133,0,0,0,0,0,0,0,132,9,0,0,36,9,0,0,133,0,0,0,1,0,0,0,148,9,0,0,52,9,0,0,73,0,0,0,0,0,0,0,164,9,0,0,68,9,0,0,73,0,0,0,1,0,0,0,180,9,0,0,84,9,0,0,37,0,0,0,0,0,0,0,196,9,0,0,100,9,0,0,37,0,0,0,1,0,0,0,212,9,0,0,116,9,0,0,21,0,0,0,0,0,0,0,228,9,0,0,132,9,0,0,21,0,0,0,1,0,0,0,244,9,0,0,148,9,0,0,9,0,0,0,0,0,0,0,4,10,0,0,164,9,0,0,9,0,0,0,1,0,0,0,20,10,0,0,180,9,0,0,5,0,0,0,0,0,0,0,36,10,0,0,196,9,0,0,5,0,0,0,1,0,0,0,52,10,0,0,212,9,0,0,1,0,0,0,0,0,0,0,36,10,0,0,228,9,0,0,1,0,0,0,1,0,0,0,52,10,0,0,244,9,0,0,1,86,0,0,0,0,0,0,68,10,0,0,68,10,0,0,1,86,0,0,1,0,0,0,84,10,0,0,84,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,11,0,0,12,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,3,0,0,0,38,94,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,64,4,32,0,32,2,128,0,128,8,16,0,16,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,3,128,4,0,6,128,7,0,9,128,10,0,12,128,13,0,15,128,16,0,18,128,19,0,21,128,22,0,24,128,25,0,27,128,28,0,30,128,31,0,33,128,34,0,36,128,37,0,39,128,40,0,42,128,43,0,45,128,46,0,48,128,49,0,51,128,52,0,54,128,55,0,57,128,58,0,60,128,61,0,63,128,64,0,66,128,67,0,69,128,70,0,72,128,73,0,75,128,76,0,78,128,79,0,81,128,82,0,84,128,85,0,87,128,88,0,90,128,91,0,93,128,94,0,96,128,97,0,99,128,100,0,102,128,103,0,105,128,106,0,108,128,109,0,111,128,112,0,114,128,115,0,117,128,118,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,128,0,128,0,0,1,0,1,0,1,128,1,128,1,0,2,0,2,128,2,128,2,0,3,0,3,128,3,0,4,0,4,128,4,0,5,128,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,128,11,0,12,128,12,0,13,0,14,128,14,0,15,0,16,128,16,128,17,0,18,0,19,128,19,128,20,0,21,0,22,0,23,128,23,128,24,128,25,128,26,0,27,0,28,0,29,0,30,0,31,0,32,0,33,0,34,0,35,0,36,0,37,128,38,128,39,128,40,128,41,0,43,0,44,0,45,128,46,128,47,0,49,0,50,128,51,128,52,0,54,0,55,128,56,0,58,0,59,128,60,0,62,128,63,128,64,0,66,128,67,0,69,128,70,0,72,128,73,0,75,128,76,0,78,128,79,128,81,0,83,128,84,0,86,0,88,128,89,0,91,0,93,128,94,128,96,0,98,0,100,128,101,128,103,0,105,0,107,0,109,128,110,128,112,128,114,128,116,0,118,0,120,0,122,0,124,0,126,0,24,128,23,0,23,128,22,0,22,128,21,0,21,128,20,0,20,128,19,0,19,128,18,0,18,128,17,0,17,128,16,0,16,128,15,0,15,128,14,0,14,128,13,0,13,128,12,0,12,128,11,0,11,128,10,0,10,128,9,0,9,128,8,0,8,128,7,0,7,128,6,0,6,128,5,0,5,128,4,0,4,128,3,0,3,128,2,0,2,128,1,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,1,128,1,0,2,128,2,0,3,128,3,0,4,128,4,0,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,0,11,128,11,0,12,128,12,0,13,128,13,0,14,128,14,0,15,128,15,0,16,128,16,0,17,128,17,0,18,128,18,0,19,128,19,0,20,128,20,0,21,128,21,0,22,128,22,0,23,128,23,0,32,0,31,0,30,0,29,0,28,0,27,128,26,128,25,128,24,128,23,0,23,0,22,0,21,128,20,128,19,0,19,0,18,128,17,128,16,0,16,0,15,128,14,0,14,0,13,128,12,0,12,128,11,128,10,0,10,128,9,0,9,128,8,0,8,128,7,0,7,128,6,0,6,128,5,128,5,0,5,128,4,0,4,0,4,128,3,0,3,0,3,128,2,128,2,0,2,0,2,128,1,128,1,0,1,0,1,0,1,128,0,128,0,128,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,128,0,128,0,0,1,0,1,0,1,128,1,128,1,0,2,0,2,128,2,128,2,0,3,0,3,128,3,0,4,0,4,128,4,0,5,128,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,128,11,0,12,128,12,0,13,0,14,128,14,0,15,0,16,128,16,128,17,0,18,0,19,128,19,128,20,0,21,0,22,0,23,128,23,128,24,128,25,128,26,0,27,0,28,0,29,0,30,0,31,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,115,101,116,117,112,32,116,104,101,32,100,101,99,111,100,101,114,0,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,114,101,97,100,32,116,104,101,32,104,101,97,100,101,114,0,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,33,0,91,69,82,82,79,82,93,32,37,115,0,83,116,114,101,97,109,32,114,101,97,99,104,101,100,32,105,116,115,32,101,110,100,32,33,10,0,69,114,114,111,114,32,111,110,32,119,114,105,116,105,110,103,32,115,116,114,101,97,109,33,10,0,83,116,114,101,97,109,32,101,114,114,111,114,33,10,0,50,46,49,46,48,0,67,111,100,101,99,32,112,114,111,118,105,100,101,100,32,116,111,32,116,104,101,32,111,112,106,95,115,101,116,117,112,95,100,101,99,111,100,101,114,32,102,117,110,99,116,105,111,110,32,105,115,32,110,111,116,32,97,32,100,101,99,111,109,112,114,101,115,115,111,114,32,104,97,110,100,108,101,114,46,10,0,67,111,100,101,99,32,112,114,111,118,105,100,101,100,32,116,111,32,116,104,101,32,111,112,106,95,114,101,97,100,95,104,101,97,100,101,114,32,102,117,110,99,116,105,111,110,32,105,115,32,110,111,116,32,97,32,100,101,99,111,109,112,114,101,115,115,111,114,32,104,97,110,100,108,101,114,46,10,0,119,98,0,114,98,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,58,32,37,100,32,110,111,116,32,105,110,32,114,97,110,103,101,32,91,49,44,37,100,93,10,0,68,101,112,114,101,99,97,116,101,100,32,102,105,101,108,100,115,32,99,112,95,99,105,110,101,109,97,32,111,114,32,99,112,95,114,115,105,122,32,97,114,101,32,117,115,101,100,10,80,108,101,97,115,101,32,99,111,110,115,105,100,101,114,32,117,115,105,110,103,32,111,110,108,121,32,116,104,101,32,114,115,105,122,32,102,105,101,108,100,10,83,101,101,32,111,112,101,110,106,112,101,103,46,104,32,100,111,99,117,109,101,110,116,97,116,105,111,110,32,102,111,114,32,109,111,114,101,32,100,101,116,97,105,108,115,10,0,84,104,101,32,100,101,115,105,114,101,100,32,109,97,120,105,109,117,109,32,99,111,100,101,115,116,114,101,97,109,32,115,105,122,101,32,104,97,115,32,108,105,109,105,116,101,100,10,97,116,32,108,101,97,115,116,32,111,110,101,32,111,102,32,116,104,101,32,100,101,115,105,114,101,100,32,113,117,97,108,105,116,121,32,108,97,121,101,114,115,10,0,74,80,69,71,32,50,48,48,48,32,83,99,97,108,97,98,108,101,32,68,105,103,105,116,97,108,32,67,105,110,101,109,97,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,49,32,115,105,110,103,108,101,32,113,117,97,108,105,116,121,32,108,97,121,101,114,45,62,32,78,117,109,98,101,114,32,111,102,32,108,97,121,101,114,115,32,102,111,114,99,101,100,32,116,111,32,49,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,45,62,32,82,97,116,101,32,111,102,32,116,104,101,32,108,97,115,116,32,108,97,121,101,114,32,40,37,51,46,49,102,41,32,119,105,108,108,32,98,101,32,117,115,101,100,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,60,61,32,53,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,53,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,62,61,32,49,32,38,38,32,60,61,32,54,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,49,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,62,61,32,49,32,38,38,32,60,61,32,54,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,54,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,51,48,50,48,56,51,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,65,115,32,110,111,32,114,97,116,101,32,104,97,115,32,98,101,101,110,32,103,105,118,101,110,44,32,116,104,105,115,32,108,105,109,105,116,32,119,105,108,108,32,98,101,32,117,115,101,100,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,51,48,50,48,56,51,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,45,62,32,83,112,101,99,105,102,105,101,100,32,114,97,116,101,32,101,120,99,101,101,100,115,32,116,104,105,115,32,108,105,109,105,116,46,32,82,97,116,101,32,119,105,108,108,32,98,101,32,102,111,114,99,101,100,32,116,111,32,49,51,48,50,48,56,51,32,98,121,116,101,115,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,48,52,49,54,54,54,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,65,115,32,110,111,32,114,97,116,101,32,104,97,115,32,98,101,101,110,32,103,105,118,101,110,44,32,116,104,105,115,32,108,105,109,105,116,32,119,105,108,108,32,98,101,32,117,115,101,100,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,48,52,49,54,54,54,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,45,62,32,83,112,101,99,105,102,105,101,100,32,114,97,116,101,32,101,120,99,101,101,100,115,32,116,104,105,115,32,108,105,109,105,116,46,32,82,97,116,101,32,119,105,108,108,32,98,101,32,102,111,114,99,101,100,32,116,111,32,49,48,52,49,54,54,54,32,98,121,116,101,115,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,51,32,99,111,109,112,111,110,101,110,116,115,45,62,32,78,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,111,102,32,105,110,112,117,116,32,105,109,97,103,101,32,40,37,100,41,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,115,105,103,110,101,100,0,117,110,115,105,103,110,101,100,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,80,114,101,99,105,115,105,111,110,32,111,102,32,101,97,99,104,32,99,111,109,112,111,110,101,110,116,32,115,104,97,108,108,32,98,101,32,49,50,32,98,105,116,115,32,117,110,115,105,103,110,101,100,45,62,32,65,116,32,108,101,97,115,116,32,99,111,109,112,111,110,101,110,116,32,37,100,32,111,102,32,105,110,112,117,116,32,105,109,97,103,101,32,40,37,100,32,98,105,116,115,44,32,37,115,41,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,119,105,100,116,104,32,60,61,32,50,48,52,56,32,97,110,100,32,104,101,105,103,104,116,32,60,61,32,49,48,56,48,10,45,62,32,73,110,112,117,116,32,105,109,97,103,101,32,115,105,122,101,32,37,100,32,120,32,37,100,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,119,105,100,116,104,32,60,61,32,52,48,57,54,32,97,110,100,32,104,101,105,103,104,116,32,60,61,32,50,49,54,48,10,45,62,32,73,109,97,103,101,32,115,105,122,101,32,37,100,32,120,32,37,100,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,52,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,76,111,110,103,32,84,101,114,109,32,83,116,111,114,97,103,101,32,112,114,111,102,105,108,101,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,66,114,111,97,100,99,97,115,116,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,73,77,70,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,97,114,116,45,50,32,112,114,111,102,105,108,101,32,100,101,102,105,110,101,100,10,98,117,116,32,110,111,32,80,97,114,116,45,50,32,101,120,116,101,110,115,105,111,110,32,101,110,97,98,108,101,100,46,10,80,114,111,102,105,108,101,32,115,101,116,32,116,111,32,78,79,78,69,46,10,0,85,110,115,117,112,112,111,114,116,101,100,32,80,97,114,116,45,50,32,101,120,116,101,110,115,105,111,110,32,101,110,97,98,108,101,100,10,80,114,111,102,105,108,101,32,115,101,116,32,116,111,32,78,79,78,69,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,112,121,32,111,102,32,117,115,101,114,32,101,110,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,112,121,32,111,102,32,99,111,109,109,101,110,116,32,115,116,114,105,110,103,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,109,109,101,110,116,32,115,116,114,105,110,103,10,0,37,115,37,115,0,67,114,101,97,116,101,100,32,98,121,32,79,112,101,110,74,80,69,71,32,118,101,114,115,105,111,110,32,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,105,108,101,32,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,99,104,101,99,107,105,110,103,32,116,104,101,32,112,111,99,32,118,97,108,117,101,115,46,10,0,77,105,115,115,105,110,103,32,112,97,99,107,101,116,115,32,112,111,115,115,105,98,108,101,32,108,111,115,115,32,111,102,32,100,97,116,97,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,105,108,101,32,99,111,109,112,111,110,101,110,116,32,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,101,109,112,32,98,117,102,102,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,100,101,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,70,97,105,108,101,100,32,116,111,32,105,110,118,101,114,115,101,32,101,110,99,111,100,101,114,32,77,67,84,32,100,101,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,110,111,114,109,115,32,10,0,70,97,105,108,101,100,32,116,111,32,115,101,116,117,112,32,106,50,107,32,109,99,116,32,101,110,99,111,100,105,110,103,10,0,67,97,110,110,111,116,32,112,101,114,102,111,114,109,32,77,67,84,32,111,110,32,99,111,109,112,111,110,101,110,116,115,32,119,105,116,104,32,100,105,102,102,101,114,101,110,116,32,115,105,122,101,115,46,32,68,105,115,97,98,108,105,110,103,32,77,67,84,46,10,0,83,116,114,101,97,109,32,116,111,111,32,115,104,111,114,116,10,0,73,110,99,111,110,115,105,115,116,101,110,116,32,109,97,114,107,101,114,32,115,105,122,101,10,0,77,97,114,107,101,114,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,32,119,105,116,104,32,105,116,115,32,112,111,115,105,116,105,111,110,10,0,77,97,114,107,101,114,32,115,105,122,101,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,115,116,114,101,97,109,32,108,101,110,103,116,104,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,104,101,97,100,101,114,10,0,78,111,116,32,115,117,114,101,32,104,111,119,32,116,104,97,116,32,104,97,112,112,101,110,101,100,46,10,0,70,97,105,108,32,116,111,32,114,101,97,100,32,116,104,101,32,99,117,114,114,101,110,116,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,32,40,37,35,120,41,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,116,108,32,109,97,114,107,101,114,10,0,84,105,108,101,32,112,97,114,116,32,108,101,110,103,116,104,32,115,105,122,101,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,115,116,114,101,97,109,32,108,101,110,103,116,104,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,79,84,32,109,97,114,107,101,114,10,0,111,112,106,95,106,50,107,95,97,112,112,108,121,95,110,98,95,116,105,108,101,95,112,97,114,116,115,95,99,111,114,114,101,99,116,105,111,110,32,101,114,114,111,114,10,0,78,111,110,32,99,111,110,102,111,114,109,97,110,116,32,99,111,100,101,115,116,114,101,97,109,32,84,80,115,111,116,61,61,84,78,115,111,116,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,80,80,84,32,109,97,114,107,101,114,10,0,70,97,105,108,101,100,32,116,111,32,109,101,114,103,101,32,80,80,84,32,100,97,116,97,10,0,67,97,110,110,111,116,32,100,101,99,111,100,101,32,116,105,108,101,44,32,109,101,109,111,114,121,32,101,114,114,111,114,10,0,72,101,97,100,101,114,32,111,102,32,116,105,108,101,32,37,100,32,47,32,37,100,32,104,97,115,32,98,101,101,110,32,114,101,97,100,46,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,46,10,0,78,111,32,69,79,67,32,109,97,114,107,101,114,46,32,80,111,115,115,105,98,108,121,32,97,32,116,114,117,110,99,97,116,101,100,32,115,116,114,101,97,109,10,0,83,116,114,101,97,109,32,100,111,101,115,32,110,111,116,32,101,110,100,32,119,105,116,104,32,69,79,67,10,0,83,116,114,101,97,109,32,116,111,111,32,115,104,111,114,116,44,32,101,120,112,101,99,116,101,100,32,83,79,84,10,0,78,101,101,100,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,109,97,105,110,32,104,101,97,100,101,114,32,98,101,102,111,114,101,32,98,101,103,105,110,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,114,101,109,97,105,110,105,110,103,32,99,111,100,101,115,116,114,101,97,109,0,78,111,32,100,101,99,111,100,101,100,32,97,114,101,97,32,112,97,114,97,109,101,116,101,114,115,44,32,115,101,116,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,116,111,32,116,104,101,32,119,104,111,108,101,32,105,109,97,103,101,10,0,76,101,102,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,115,105,122,61,37,100,41,46,10,0,76,101,102,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,79,115,105,122,61,37,100,41,46,10,0,85,112,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,115,105,122,61,37,100,41,46,10,0,85,112,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,79,115,105,122,61,37,100,41,46,10,0,82,105,103,104,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,79,115,105,122,61,37,100,41,46,10,0,82,105,103,104,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,115,105,122,61,37,100,41,46,10,0,66,111,116,116,111,109,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,79,115,105,122,61,37,100,41,46,10,0,66,111,116,116,111,109,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,115,105,122,61,37,100,41,46,10,0,83,105,122,101,32,120,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,99,111,109,112,111,110,101,110,116,32,105,109,97,103,101,32,105,115,32,105,110,99,111,114,114,101,99,116,32,40,99,111,109,112,91,37,100,93,46,119,61,37,100,41,46,10,0,83,105,122,101,32,121,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,99,111,109,112,111,110,101,110,116,32,105,109,97,103,101,32,105,115,32,105,110,99,111,114,114,101,99,116,32,40,99,111,109,112,91,37,100,93,46,104,61,37,100,41,46,10,0,83,101,116,116,105,110,103,32,100,101,99,111,100,105,110,103,32,97,114,101,97,32,116,111,32,37,100,44,37,100,44,37,100,44,37,100,10,0,87,114,111,110,103,32,102,108,97,103,10,0,67,111,100,101,115,116,114,101,97,109,32,105,110,102,111,32,102,114,111,109,32,109,97,105,110,32,104,101,97,100,101,114,58,32,123,10,0,9,32,116,120,48,61,37,100,44,32,116,121,48,61,37,100,10,0,9,32,116,100,120,61,37,100,44,32,116,100,121,61,37,100,10,0,9,32,116,119,61,37,100,44,32,116,104,61,37,100,10,0,125,10,0,67,111,100,101,115,116,114,101,97,109,32,105,110,100,101,120,32,102,114,111,109,32,109,97,105,110,32,104,101,97,100,101,114,58,32,123,10,0,9,32,77,97,105,110,32,104,101,97,100,101,114,32,115,116,97,114,116,32,112,111,115,105,116,105,111,110,61,37,108,108,105,10,9,32,77,97,105,110,32,104,101],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE),allocate([97,100,101,114,32,101,110,100,32,112,111,115,105,116,105,111,110,61,37,108,108,105,10,0,9,32,77,97,114,107,101,114,32,108,105,115,116,58,32,123,10,0,9,9,32,116,121,112,101,61,37,35,120,44,32,112,111,115,61,37,108,108,105,44,32,108,101,110,61,37,100,10,0,9,32,125,10,0,9,32,84,105,108,101,32,105,110,100,101,120,58,32,123,10,0,9,9,32,110,98,32,111,102,32,116,105,108,101,45,112,97,114,116,32,105,110,32,116,105,108,101,32,91,37,100,93,61,37,100,10,0,9,9,9,32,116,105,108,101,45,112,97,114,116,91,37,100,93,58,32,115,116,97,114,95,112,111,115,61,37,108,108,105,44,32,101,110,100,95,104,101,97,100,101,114,61,37,108,108,105,44,32,101,110,100,95,112,111,115,61,37,108,108,105,46,10,0,91,68,69,86,93,32,68,117,109,112,32,97,110,32,105,109,97,103,101,95,104,101,97,100,101,114,32,115,116,114,117,99,116,32,123,10,0,73,109,97,103,101,32,105,110,102,111,32,123,10,0,37,115,32,120,48,61,37,100,44,32,121,48,61,37,100,10,0,37,115,32,120,49,61,37,100,44,32,121,49,61,37,100,10,0,37,115,32,110,117,109,99,111,109,112,115,61,37,100,10,0,37,115,9,32,99,111,109,112,111,110,101,110,116,32,37,100,32,123,10,0,37,115,125,10,0,91,68,69,86,93,32,68,117,109,112,32,97,110,32,105,109,97,103,101,95,99,111,109,112,95,104,101,97,100,101,114,32,115,116,114,117,99,116,32,123,10,0,37,115,32,100,120,61,37,100,44,32,100,121,61,37,100,10,0,37,115,32,112,114,101,99,61,37,100,10,0,37,115,32,115,103,110,100,61,37,100,10,0,87,101,32,110,101,101,100,32,97,110,32,105,109,97,103,101,32,112,114,101,118,105,111,117,115,108,121,32,99,114,101,97,116,101,100,46,10,0,84,105,108,101,32,105,110,100,101,120,32,112,114,111,118,105,100,101,100,32,98,121,32,116,104,101,32,117,115,101,114,32,105,115,32,105,110,99,111,114,114,101,99,116,32,37,100,32,40,109,97,120,32,61,32,37,100,41,32,10,0,82,101,115,111,108,117,116,105,111,110,32,102,97,99,116,111,114,32,105,115,32,103,114,101,97,116,101,114,32,116,104,97,110,32,116,104,101,32,109,97,120,105,109,117,109,32,114,101,115,111,108,117,116,105,111,110,32,105,110,32,116,104,101,32,99,111,109,112,111,110,101,110,116,46,10,0,84,104,101,32,103,105,118,101,110,32,116,105,108,101,32,105,110,100,101,120,32,100,111,101,115,32,110,111,116,32,109,97,116,99,104,46,0,116,105,108,101,32,110,117,109,98,101,114,32,37,100,32,47,32,37,100,10,0,69,114,114,111,114,32,97,108,108,111,99,97,116,105,110,103,32,116,105,108,101,32,99,111,109,112,111,110,101,110,116,32,100,97,116,97,46,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,101,110,99,111,100,101,32,97,108,108,32,116,105,108,101,115,10,0,83,105,122,101,32,109,105,115,109,97,116,99,104,32,98,101,116,119,101,101,110,32,116,105,108,101,32,100,97,116,97,32,97,110,100,32,115,101,110,116,32,100,97,116,97,46,0,70,97,105,108,101,100,32,116,111,32,97,108,108,111,99,97,116,101,32,105,109,97,103,101,32,104,101,97,100,101,114,46,0,69,114,114,111,114,32,119,104,105,108,101,32,111,112,106,95,106,50,107,95,112,114,101,95,119,114,105,116,101,95,116,105,108,101,32,119,105,116,104,32,116,105,108,101,32,105,110,100,101,120,32,61,32,37,100,10,0,69,114,114,111,114,32,119,104,105,108,101,32,111,112,106,95,106,50,107,95,112,111,115,116,95,119,114,105,116,101,95,116,105,108,101,32,119,105,116,104,32,116,105,108,101,32,105,110,100,101,120,32,61,32,37,100,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,105,108,101,32,67,111,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,66,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,84,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,67,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,79,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,116,104,101,32,67,79,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,80,79,67,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,84,76,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,81,67,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,83,81,99,100,32,83,81,99,99,32,101,108,101,109,101,110,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,79,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,81,67,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,81,67,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,79,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,67,79,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,104,101,32,83,73,90,32,109,97,114,107,101,114,10,0,78,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,105,115,32,116,111,111,32,104,105,103,104,32,105,110,32,99,111,109,112,97,114,105,115,111,110,32,116,111,32,116,104,101,32,115,105,122,101,32,111,102,32,116,105,108,101,115,10,0,67,97,110,110,111,116,32,101,110,99,111,100,101,32,116,105,108,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,111,110,101,32,116,105,108,101,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,115,101,101,107,32,102,117,110,99,116,105,111,110,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,32,37,100,47,37,100,10,0,84,105,108,101,32,37,100,47,37,100,32,104,97,115,32,98,101,101,110,32,100,101,99,111,100,101,100,46,10,0,73,109,97,103,101,32,100,97,116,97,32,104,97,115,32,98,101,101,110,32,117,112,100,97,116,101,100,32,119,105,116,104,32,116,105,108,101,32,37,100,46,10,10,0,84,105,108,101,32,114,101,97,100,44,32,100,101,99,111,100,101,100,32,97,110,100,32,117,112,100,97,116,101,100,32,105,115,32,110,111,116,32,116,104,101,32,100,101,115,105,114,101,100,32,111,110,101,32,40,37,100,32,118,115,32,37,100,41,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,115,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,32,37,100,47,37,100,10,0,9,32,100,101,102,97,117,108,116,32,116,105,108,101,32,123,10,0,9,9,32,99,115,116,121,61,37,35,120,10,0,9,9,32,112,114,103,61,37,35,120,10,0,9,9,32,110,117,109,108,97,121,101,114,115,61,37,100,10,0,9,9,32,109,99,116,61,37,120,10,0,9,9,32,99,111,109,112,32,37,100,32,123,10,0,9,9,9,32,99,115,116,121,61,37,35,120,10,0,9,9,9,32,110,117,109,114,101,115,111,108,117,116,105,111,110,115,61,37,100,10,0,9,9,9,32,99,98,108,107,119,61,50,94,37,100,10,0,9,9,9,32,99,98,108,107,104,61,50,94,37,100,10,0,9,9,9,32,99,98,108,107,115,116,121,61,37,35,120,10,0,9,9,9,32,113,109,102,98,105,100,61,37,100,10,0,9,9,9,32,112,114,101,99,99,105,110,116,115,105,122,101,32,40,119,44,104,41,61,0,40,37,100,44,37,100,41,32,0,9,9,9,32,113,110,116,115,116,121,61,37,100,10,0,9,9,9,32,110,117,109,103,98,105,116,115,61,37,100,10,0,9,9,9,32,115,116,101,112,115,105,122,101,115,32,40,109,44,101,41,61,0,9,9,9,32,114,111,105,115,104,105,102,116,61,37,100,10,0,9,9,32,125,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,79,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,116,114,97,110,115,102,111,114,109,97,116,105,111,110,32,115,116,97,103,101,115,46,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,67,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,100,97,116,97,32,115,112,97,110,110,105,110,103,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,77,67,67,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,99,111,108,108,101,99,116,105,111,110,115,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,111,116,104,101,114,32,116,104,97,110,32,97,114,114,97,121,32,100,101,99,111,114,114,101,108,97,116,105,111,110,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,119,105,116,104,32,105,110,100,105,120,32,115,104,117,102,102,108,101,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,119,105,116,104,111,117,116,32,115,97,109,101,32,110,117,109,98,101,114,32,111,102,32,105,110,100,105,120,101,115,10,0,67,114,114,111,114,32,114,101,97,100,105,110,103,32,67,66,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,84,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,99,116,32,100,97,116,97,32,119,105,116,104,105,110,32,109,117,108,116,105,112,108,101,32,77,67,84,32,114,101,99,111,114,100,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,77,67,84,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,77,67,84,32,109,97,114,107,101,114,115,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,82,71,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,84,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,84,32,109,97,114,107,101,114,58,32,112,97,99,107,101,116,32,104,101,97,100,101,114,32,104,97,118,101,32,98,101,101,110,32,112,114,101,118,105,111,117,115,108,121,32,102,111,117,110,100,32,105,110,32,116,104,101,32,109,97,105,110,32,104,101,97,100,101,114,32,40,80,80,77,32,109,97,114,107,101,114,41,46,10,0,90,112,112,116,32,37,117,32,97,108,114,101,97,100,121,32,114,101,97,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,80,80,77,32,109,97,114,107,101,114,10,0,90,112,112,109,32,37,117,32,97,108,114,101,97,100,121,32,114,101,97,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,76,84,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,76,77,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,84,76,77,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,32,115,105,122,101,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,32,105,115,32,105,108,108,101,103,97,108,32,45,62,32,37,100,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,32,105,115,32,110,111,116,32,99,111,109,112,97,116,105,98,108,101,32,119,105,116,104,32,116,104,101,32,114,101,109,97,105,110,105,110,103,32,110,117,109,98,101,114,32,111,102,32,112,97,114,97,109,101,116,101,114,115,32,40,32,37,100,32,118,115,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,101,103,97,116,105,118,101,32,111,114,32,122,101,114,111,32,105,109,97,103,101,32,115,105,122,101,32,40,37,100,32,120,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,105,110,118,97,108,105,100,32,116,105,108,101,32,115,105,122,101,32,40,116,100,120,58,32,37,100,44,32,116,100,121,58,32,37,100,41,10,0,80,114,101,118,101,110,116,32,98,117,102,102,101,114,32,111,118,101,114,102,108,111,119,32,40,120,49,58,32,37,100,44,32,121,49,58,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,105,108,108,101,103,97,108,32,116,105,108,101,32,111,102,102,115,101,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,83,73,90,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,118,97,108,117,101,115,32,102,111,114,32,99,111,109,112,32,61,32,37,100,32,58,32,100,120,61,37,117,32,100,121,61,37,117,10,32,40,115,104,111,117,108,100,32,98,101,32,98,101,116,119,101,101,110,32,49,32,97,110,100,32,50,53,53,32,97,99,99,111,114,100,105,110,103,32,116,104,101,32,74,80,69,71,50,48,48,48,32,110,111,114,109,41,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,115,32,58,32,37,117,32,120,32,37,117,32,40,109,97,120,105,109,117,109,32,102,105,120,101,100,32,98,121,32,106,112,101,103,50,48,48,48,32,110,111,114,109,32,105,115,32,54,53,53,51,53,32,116,105,108,101,115,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,79,67,32,109,97,114,107,101,114,10,0,84,111,111,32,109,97,110,121,32,80,79,67,115,32,37,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,81,67,67,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,32,110,117,109,98,101,114,58,32,37,100,44,32,114,101,103,97,114,100,105,110,103,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,37,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,81,99,100,32,111,114,32,83,81,99,99,32,101,108,101,109,101,110,116,10,0,87,104,105,108,101,32,114,101,97,100,105,110,103,32,67,67,80,95,81,78,84,83,84,89,32,101,108,101,109,101,110,116,32,105,110,115,105,100,101,32,81,67,68,32,111,114,32,81,67,67,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,44,32,110,117,109,98,101,114,32,111,102,32,115,117,98,98,97,110,100,115,32,40,37,100,41,32,105,115,32,103,114,101,97,116,101,114,32,116,111,32,79,80,74,95,74,50,75,95,77,65,88,66,65,78,68,83,32,40,37,100,41,46,32,83,111,32,119,101,32,108,105,109,105,116,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,101,108,101,109,101,110,116,115,32,115,116,111,114,101,100,32,116,111,32,79,80,74,95,74,50,75,95,77,65,88,66,65,78,68,83,32,40,37,100,41,32,97,110,100,32,115,107,105,112,32,116,104,101,32,114,101,115,116,46,32,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,81,67,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,82,71,78,32,109,97,114,107,101,114,10,0,98,97,100,32,99,111,109,112,111,110,101,110,116,32,110,117,109,98,101,114,32,105,110,32,82,71,78,32,40,37,100,32,119,104,101,110,32,116,104,101,114,101,32,97,114,101,32,111,110,108,121,32,37,100,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,67,32,109,97,114,107,101,114,32,40,98,97,100,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,10,0,73,110,118,97,108,105,100,32,118,97,108,117,101,32,102,111,114,32,110,117,109,114,101,115,111,108,117,116,105,111,110,115,32,58,32,37,100,44,32,109,97,120,32,118,97,108,117,101,32,105,115,32,115,101,116,32,105,110,32,111,112,101,110,106,112,101,103,46,104,32,97,116,32,37,100,10,0,69,114,114,111,114,32,100,101,99,111,100,105,110,103,32,99,111,109,112,111,110,101,110,116,32,37,100,46,10,84,104,101,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,116,111,32,114,101,109,111,118,101,32,105,115,32,104,105,103,104,101,114,32,116,104,97,110,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,111,102,32,116,104,105,115,32,99,111,109,112,111,110,101,110,116,10,77,111,100,105,102,121,32,116,104,101,32,99,112,95,114,101,100,117,99,101,32,112,97,114,97,109,101,116,101,114,46,10,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,44,32,73,110,118,97,108,105,100,32,99,98,108,107,119,47,99,98,108,107,104,32,99,111,109,98,105,110,97,116,105,111,110,10,0,73,110,118,97,108,105,100,32,112,114,101,99,105,110,99,116,32,115,105,122,101,10,0,67,79,68,32,109,97,114,107,101,114,32,97,108,114,101,97,100,121,32,114,101,97,100,46,32,78,111,32,109,111,114,101,32,116,104,97,110,32,111,110,101,32,67,79,68,32,109,97,114,107,101,114,32,112,101,114,32,116,105,108,101,46,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,68,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,110,32,83,99,111,100,32,118,97,108,117,101,32,105,110,32,67,79,68,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,110,32,112,114,111,103,114,101,115,115,105,111,110,32,111,114,100,101,114,32,105,110,32,67,79,68,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,108,97,121,101,114,115,32,105,110,32,67,79,68,32,109,97,114,107,101,114,32,58,32,37,100,32,110,111,116,32,105,110,32,114,97,110,103,101,32,91,49,45,54,53,53,51,53,93,10,0,73,110,118,97,108,105,100,32,116,105,108,101,32,110,117,109,98,101,114,32,37,100,10,0,69,109,112,116,121,32,83,79,84,32,109,97,114,107,101,114,32,100,101,116,101,99,116,101,100,58,32,80,115,111,116,61,37,100,46,10,0,80,115,111,116,32,118,97,108,117,101,32,105,115,32,110,111,116,32,99,111,114,114,101,99,116,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,74,80,69,71,50,48,48,48,32,110,111,114,109,58,32,37,100,46,10,0,80,115,111,116,32,118,97,108,117,101,32,111,102,32,116,104,101,32,99,117,114,114,101,110,116,32,116,105,108,101,45,112,97,114,116,32,105,115,32,101,113,117,97,108,32,116,111,32,122,101,114,111,44,32,119,101,32,97,115,115,117,109,105,110,103,32,105,116,32,105,115,32,116,104,101,32,108,97,115,116,32,116,105,108,101,45,112,97,114,116,32,111,102,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,46,10,0,73,110,32,83,79,84,32,109,97,114,107,101,114,44,32,84,80,83,111,116,32,40,37,100,41,32,105,115,32,110,111,116,32,118,97,108,105,100,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,99,117,114,114,101,110,116,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,45,112,97,114,116,32,40,37,100,41,44,32,103,105,118,105,110,103,32,117,112,10,0,73,110,32,83,79,84,32,109,97,114,107,101,114,44,32,84,80,83,111,116,32,40,37,100,41,32,105,115,32,110,111,116,32,118,97,108,105,100,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,99,117,114,114,101,110,116,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,45,112,97,114,116,32,40,104,101,97,100,101,114,41,32,40,37,100,41,44,32,103,105,118,105,110,103,32,117,112,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,83,79,84,32,109,97,114,107,101,114,46,32,84,105,108,101,32,105,110,100,101,120,32,97,108,108,111,99,97,116,105,111,110,32,102,97,105,108,101,100,10,0,83,116,97,114,116,32,116,111,32,114,101,97,100,32,106,50,107,32,109,97,105,110,32,104,101,97,100,101,114,32,40,37,100,41,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,109,104,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,97,32,83,79,67,32,109,97,114,107,101,114,32,10,0,65,32,109,97,114,107,101,114,32,73,68,32,119,97,115,32,101,120,112,101,99,116,101,100,32,40,48,120,102,102,45,45,41,32,105,110,115,116,101,97,100,32,111,102,32,37,46,56,120,10,0,85,110,107,110,111,119,110,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,32,109,97,114,107,101,114,32,104,97,118,101,32,98,101,101,110,32,100,101,116,101,99,116,101,100,32,97,110,100,32,103,101,110,101,114,97,116,101,100,32,101,114,114,111,114,46,10,0,77,97,114,107,101,114,32,104,97,110,100,108,101,114,32,102,117,110,99,116,105,111,110,32,102,97,105,108,101,100,32,116,111,32,114,101,97,100,32,116,104,101,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,10,0,114,101,113,117,105,114,101,100,32,83,73,90,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,114,101,113,117,105,114,101,100,32,67,79,68,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,114,101,113,117,105,114,101,100,32,81,67,68,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,98,121,116,101,115,32,116,111,32,114,101,97,100,32,78,112,112,109,10,0,67,111,114,114,117,112,116,101,100,32,80,80,77,32,109,97,114,107,101,114,115,10,0,70,97,105,108,101,100,32,116,111,32,109,101,114,103,101,32,80,80,77,32,100,97,116,97,10,0,77,97,105,110,32,104,101,97,100,101,114,32,104,97,115,32,98,101,101,110,32,99,111,114,114,101,99,116,108,121,32,100,101,99,111,100,101,100,46,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,32,105,110,32,116,104,101,32,74,80,50,32,102,105,108,101,10,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,115,112,101,99,105,102,105,101,100,32,119,104,105,108,101,32,115,101,116,116,105,110,103,32,117,112,32,74,80,50,32,101,110,99,111,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,119,104,101,110,32,115,101,116,117,112,32,116,104,101,32,74,80,50,32,101,110,99,111,100,101,114,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,115,112,101,99,105,102,105,101,100,32,98,117,116,32,117,110,107,110,111,119,110,32,101,110,117,109,99,115,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,115,112,101,99,105,102,105,101,100,32,98,117,116,32,110,111,116,32,101,110,111,117,103,104,32,105,109,97,103,101,32,99,111,109,112,111,110,101,110,116,115,32,102,111,114,32,97,110,32,97,117,116,111,109,97,116,105,99,32,99,100,101,102,32,98,111,120,32,99,114,101,97,116,105,111,110,46,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,112,111,115,105,116,105,111,110,32,99,111,110,102,108,105,99,116,115,32,119,105,116,104,32,99,111,108,111,114,32,99,104,97,110,110,101,108,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,77,117,108,116,105,112,108,101,32,97,108,112,104,97,32,99,104,97,110,110,101,108,115,32,115,112,101,99,105,102,105,101,100,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,115,101,116,117,112,32,116,104,101,32,74,80,50,32,101,110,99,111,100,101,114,10,0,74,80,50,32,98,111,120,32,119,104,105,99,104,32,97,114,101,32,97,102,116,101,114,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,110,111,116,32,98,101,32,114,101,97,100,32,98,121,32,116,104,105,115,32,102,117,110,99,116,105,111,110,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,111,108,100,32,74,80,50,32,72,101,97,100,101,114,32,100,97,116,97,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,119,114,105,116,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,102,116,121,112,32,100,97,116,97,10,0,69,114,114,111,114,32,119,104,105,108,101,32,119,114,105,116,105,110,103,32,102,116,121,112,32,100,97,116,97,32,116,111,32,115,116,114,101,97,109,10,0,70,97,105,108,101,100,32,116,111,32,115,101,101,107,32,105,110,32,116,104,101,32,115,116,114,101,97,109,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,106,112,101,103,50,48,48,48,32,102,105,108,101,32,104,101,97,100,101,114,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,115,105,122,101,115,32,104,105,103,104,101,114,32,116,104,97,110,32,50,94,51,50,10,0,98,97,100,32,112,108,97,99,101,100,32,106,112,101,103,32,99,111,100,101,115,116,114,101,97,109,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,111,102,32,117,110,100,101,102,105,110,101,100,32,115,105,122,101,115,10,0,105,110,118,97,108,105,100,32,98,111,120,32,115,105,122,101,32,37,100,32,40,37,120,41,10,0,70,111,117,110,100,32,97,32,109,105,115,112,108,97,99,101,100,32,39,37,99,37,99,37,99,37,99,39,32,98,111,120,32,111,117,116,115,105,100,101,32,106,112,50,104,32,98,111,120,10,0,74,80,69,71,50,48,48,48,32,72,101,97,100,101,114,32,98,111,120,32,110,111,116,32,114,101,97,100,32,121,101,116,44,32,39,37,99,37,99,37,99,37,99,39,32,98,111,120,32,119,105,108,108,32,98,101,32,105,103,110,111,114,101,100,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,115,107,105,112,112,105,110,103,32,74,80,69,71,50,48,48,48,32,98,111,120,44,32,115,116,114,101,97,109,32,101,114,114,111,114,10,0,73,110,118,97,108,105,100,32,98,111,120,32,115,105,122,101,32,37,100,32,102,111,114,32,98,111,120,32,39,37,99,37,99,37,99,37,99,39,46,32,78,101,101,100,32,37,100,32,98,121,116,101,115,44,32,37,100,32,98,121,116,101,115,32,114,101,109,97,105,110,105,110,103,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,106,112,101,103,50,48,48,48,32,98,111,120,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,114,101,97,100,105,110,103,32,74,80,69,71,50,48,48,48,32,98,111,120,44,32,115,116,114,101,97,109,32,101,114,114,111,114,10,0,77,97,108,102,111,114,109,101,100,32,74,80,50,32,102,105,108,101,32,102,111,114,109,97,116,58,32,102,105,114,115,116,32,98,111,120,32,109,117,115,116,32,98,101,32,74,80,69,71,32,50,48,48,48,32,115,105,103,110,97,116,117,114,101,32,98,111,120,10,0,77,97,108,102,111,114,109,101,100,32,74,80,50,32,102,105,108,101,32,102,111,114,109,97,116,58,32,115,101,99,111,110,100,32,98,111,120,32,109,117,115,116,32,98,101,32,102,105,108,101,32,116,121,112,101,32,98,111,120,10,0,73,110,115,117,102,102,105,99,105,101,110,116,32,100,97,116,97,32,102,111,114,32,67,68,69,70,32,98,111,120,46,10,0,78,117,109,98,101,114,32,111,102,32,99,104,97,110,110,101,108,32,100,101,115,99,114,105,112,116,105,111,110,32,105,115,32,101,113,117,97,108,32,116,111,32,122,101,114,111,32,105,110,32,67,68,69,70,32,98,111,120,46,10,0,78,101,101,100,32,116,111,32,114,101,97,100,32,97,32,80,67,76,82,32,98,111,120,32,98,101,102,111,114,101,32,116,104,101,32,67,77,65,80,32,98,111,120,46,10,0,79,110,108,121,32,111,110,101,32,67,77,65,80,32,98,111,120,32,105,115,32,97,108,108,111,119,101,100,46,10,0,73,110,115,117,102,102,105,99,105,101,110,116,32,100,97,116,97,32,102,111,114,32,67,77,65,80,32,98,111,120,46,10,0,73,110,118,97,108,105,100,32,80,67,76,82,32,98,111,120,46,32,82,101,112,111,114,116,115,32,37,100,32,101,110,116,114,105,101,115,10,0,73,110,118,97,108,105,100,32,80,67,76,82,32,98,111,120,46,32,82,101,112,111,114,116,115,32,48,32,112,97,108,101,116,116,101,32,99,111,108,117,109,110,115,10,0,65,32,66,80,67,67,32,104,101,97,100,101,114,32,98,111,120,32,105,115,32,97,118,97,105,108,97,98,108,101,32,97,108,116,104,111,117,103,104,32,66,80,67,32,103,105,118,101,110,32,98,121,32,116,104,101,32,73,72,68,82,32,98,111,120,32,40,37,100,41,32,105,110,100,105,99,97,116,101,32,99,111,109,112,111,110,101,110,116,115,32,98,105,116,32,100,101,112,116,104,32,105,115,32,99,111,110,115,116,97,110,116,10,0,66,97,100,32,66,80,67,67,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,65,32,99,111,110,102,111,114,109,105,110,103,32,74,80,50,32,114,101,97,100,101,114,32,115,104,97,108,108,32,105,103,110,111,114,101,32,97,108,108,32,67,111,108,111,117,114,32,83,112,101,99,105,102,105,99,97,116,105,111,110,32,98,111,120,101,115,32,97,102,116,101,114,32,116,104,101,32,102,105,114,115,116,44,32,115,111,32,119,101,32,105,103,110,111,114,101,32,116,104,105,115,32,111,110,101,46,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,58,32,37,100,41,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,67,73,69,76,97,98,44,32,98,97,100,32,115,105,122,101,58,32,37,100,41,10,0,67,79,76,82,32,66,79,88,32,109,101,116,104,32,118,97,108,117,101,32,105,115,32,110,111,116,32,97,32,114,101,103,117,108,97,114,32,118,97,108,117,101,32,40,37,100,41,44,32,115,111,32,119,101,32,119,105,108,108,32,105,103,110,111,114,101,32,116,104,101,32,101,110,116,105,114,101,32,67,111,108,111,117,114,32,83,112,101,99,105,102,105,99,97,116,105,111,110,32,98,111,120,46,32,10,0,66,97,100,32,105,109,97,103,101,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,105,109,97,103,101,32,104,101,97,100,101,114,32,40,105,104,100,114,41,10,0,74,80,50,32,73,72,68,82,32,98,111,120,58,32,99,111,109,112,114,101,115,115,105,111,110,32,116,121,112,101,32,105,110,100,105,99,97,116,101,32,116,104,97,116,32,116,104,101,32,102,105,108,101,32,105,115,32,110,111,116,32,97,32,99,111,110,102,111,114,109,105,110,103,32,74,80,50,32,102,105,108,101,32,40,37,100,41,32,10,0,84,104,101,32,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,102,105,114,115,116,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,111,102,32,108,101,115,115,32,116,104,97,110,32,56,32,98,121,116,101,115,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,88,76,32,98,111,120,32,111,102,32,108,101,115,115,32,116,104,97,110,32,49,54,32,98,121,116,101,115,10,0,66,111,120,32,108,101,110,103,116,104,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,46,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,58,32,98,111,120,32,108,101,110,103,116,104,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,46,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,58,32,110,111,32,39,105,104,100,114,39,32,98,111,120,46,10,0,84,104,101,32,102,116,121,112,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,115,101,99,111,110,100,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,69,114,114,111,114,32,119,105,116,104,32,70,84,89,80,32,115,105,103,110,97,116,117,114,101,32,66,111,120,32,115,105,122,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,119,105,116,104,32,70,84,89,80,32,66,111,120,10,0,84,104,101,32,115,105,103,110,97,116,117,114,101,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,102,105,114,115,116,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,69,114,114,111,114,32,119,105,116,104,32,74,80,32,115,105,103,110,97,116,117,114,101,32,66,111,120,32,115,105,122,101,10,0,69,114,114,111,114,32,119,105,116,104,32,74,80,32,83,105,103,110,97,116,117,114,101,32,58,32,98,97,100,32,109,97,103,105,99,32,110,117,109,98,101,114,10,0,111,112,106,95,106,112,50,95,97,112,112,108,121,95,99,100,101,102,58,32,99,110,61,37,100,44,32,110,117,109,99,111,109,112,115,61,37,100,10,0,111,112,106,95,106,112,50,95,97,112,112,108,121,95,99,100,101,102,58,32,97,99,110,61,37,100,44,32,110,117,109,99,111,109,112,115,61,37,100,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,32,105,110,100,101,120,32,37,100,32,40,62,61,32,37,100,41,46,10,0,73,110,99,111,109,112,108,101,116,101,32,99,104,97,110,110,101,108,32,100,101,102,105,110,105,116,105,111,110,115,46,10,0,85,110,101,120,112,101,99,116,101,100,32,79,79,77,46,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,47,112,97,108,101,116,116,101,32,105,110,100,101,120,32,102,111,114,32,100,105,114,101,99,116,32,109,97,112,112,105,110,103,32,37,100,46,10,0,67,111,109,112,111,110,101,110,116,32,37,100,32,105,115,32,109,97,112,112,101,100,32,116,119,105,99,101,46,10,0,68,105,114,101,99,116,32,117,115,101,32,97,116,32,35,37,100,32,104,111,119,101,118,101,114,32,112,99,111,108,61,37,100,46,10,0,67,111,109,112,111,110,101,110,116,32,37,100,32,100,111,101,115,110,39,116,32,104,97,118,101,32,97,32,109,97,112,112,105,110,103,46,10,0,67,111,109,112,111,110,101,110,116,32,109,97,112,112,105,110,103,32,115,101,101,109,115,32,119,114,111,110,103,46,32,84,114,121,105,110,103,32,116,111,32,99,111,114,114,101,99,116,46,10,0,84,105,108,101,115,32,100,111,110,39,116,32,97,108,108,32,104,97,118,101,32,116,104,101,32,115,97,109,101,32,100,105,109,101,110,115,105,111,110,46,32,83,107,105,112,32,116,104,101,32,77,67,84,32,115,116,101,112,46,10,0,78,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,40,37,100,41,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,97,32,77,67,84,46,32,83,107,105,112,32,116,104,101,32,77,67,84,32,115,116,101,112,46,10,0,116,105,108,101,115,32,114,101,113,117,105,114,101,32,97,116,32,108,101,97,115,116,32,111,110,101,32,114,101,115,111,108,117,116,105,111,110,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,105,108,101,32,100,97,116,97,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,105,108,101,32,114,101,115,111,108,117,116,105,111,110,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,98,97,110,100,32,112,114,101,99,105,110,116,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,99,117,114,114,101,110,116,32,112,114,101,99,105,110,99,116,32,99,111,100,101,98,108,111,99,107,32,101,108,101,109,101,110,116,10,0,78,111,32,105,110,99,108,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,32,105,109,115,98,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,97,103,45,116,114,101,101,10,0,116,103,116,95,99,114,101,97,116,101,32,116,114,101,101,45,62,110,117,109,110,111,100,101,115,32,61,61,32,48,44,32,110,111,32,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,97,103,45,116,114,101,101,32,110,111,100,101,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,105,110,105,116,105,97,108,105,122,101,32,116,104,101,32,116,97,103,32,116,114,101,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,97,32,110,101,119,32,118,97,108,105,100,97,116,105,111,110,32,112,114,111,99,101,100,117,114,101,10,0,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+10240),allocate([7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,3,3,6,3,6,6,8,3,6,6,8,6,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,9,10,12,13,10,10,13,13,12,13,12,13,13,13,13,13,9,10,12,11,10,9,13,12,12,11,12,11,13,12,13,12,9,10,12,11,10,10,11,11,12,13,9,10,13,13,10,10,9,10,12,13,10,9,11,12,12,11,9,10,13,12,10,9,9,10,12,13,10,9,11,12,12,13,12,13,11,12,11,12,9,10,12,11,10,10,11,11,12,11,12,11,11,11,11,11,9,10,12,11,10,9,13,12,12,13,9,10,11,12,10,9,9,10,12,13,10,10,13,13,12,11,9,10,11,11,10,10,9,10,12,13,10,10,13,13,12,11,9,10,11,11,10,10,9,10,12,11,10,9,13,12,12,13,9,10,11,12,10,9,9,10,12,11,10,10,11,11,12,11,12,11,11,11,11,11,9,10,12,13,10,9,11,12,12,13,12,13,11,12,11,12,9,10,12,13,10,9,11,12,12,11,9,10,13,12,10,9,9,10,12,11,10,10,11,11,12,13,9,10,13,13,10,10,9,10,12,11,10,9,13,12,12,11,12,11,13,12,13,12,9,10,12,13,10,10,13,13,12,13,12,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,1,0,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,1,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,1,1,0,1,1,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,114,101,97,100,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,109,97,120,32,40,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,114,101,97,100,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,99,117,114,114,101,110,116,32,115,105,122,101,32,40,37,100,32,62,32,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,115,107,105,112,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,109,97,120,32,40,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,78,111,116,32,101,110,111,117,103,104,32,115,112,97,99,101,32,102,111,114,32,101,120,112,101,99,116,101,100,32,83,79,80,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,83,79,80,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,115,112,97,99,101,32,102,111,114,32,101,120,112,101,99,116,101,100,32,69,80,72,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,69,80,72,32,109,97,114,107,101,114,10,0,84,33,34,25,13,1,2,3,17,75,28,12,16,4,11,29,18,30,39,104,110,111,112,113,98,32,5,6,15,19,20,21,26,8,22,7,40,36,23,24,9,10,14,27,31,37,35,131,130,125,38,42,43,60,61,62,63,67,71,74,77,88,89,90,91,92,93,94,95,96,97,99,100,101,102,103,105,106,107,108,114,115,116,121,122,123,124,0,73,108,108,101,103,97,108,32,98,121,116,101,32,115,101,113,117,101,110,99,101,0,68,111,109,97,105,110,32,101,114,114,111,114,0,82,101,115,117,108,116,32,110,111,116,32,114,101,112,114,101,115,101,110,116,97,98,108,101,0,78,111,116,32,97,32,116,116,121,0,80,101,114,109,105,115,115,105,111,110,32,100,101,110,105,101,100,0,79,112,101,114,97,116,105,111,110,32,110,111,116,32,112,101,114,109,105,116,116,101,100,0,78,111,32,115,117,99,104,32,102,105,108,101,32,111,114,32,100,105,114,101,99,116,111,114,121,0,78,111,32,115,117,99,104,32,112,114,111,99,101,115,115,0,70,105,108,101,32,101,120,105,115,116,115,0,86,97,108,117,101,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,100,97,116,97,32,116,121,112,101,0,78,111,32,115,112,97,99,101,32,108,101,102,116,32,111,110,32,100,101,118,105,99,101,0,79,117,116,32,111,102,32,109,101,109,111,114,121,0,82,101,115,111,117,114,99,101,32,98,117,115,121,0,73,110,116,101,114,114,117,112,116,101,100,32,115,121,115,116,101,109,32,99,97,108,108,0,82,101,115,111,117,114,99,101,32,116,101,109,112,111,114,97,114,105,108,121,32,117,110,97,118,97,105,108,97,98,108,101,0,73,110,118,97,108,105,100,32,115,101,101,107,0,67,114,111,115,115,45,100,101,118,105,99,101,32,108,105,110,107,0,82,101,97,100,45,111,110,108,121,32,102,105,108,101,32,115,121,115,116,101,109,0,68,105,114,101,99,116,111,114,121,32,110,111,116,32,101,109,112,116,121,0,67,111,110,110,101,99,116,105,111,110,32,114,101,115,101,116,32,98,121,32,112,101,101,114,0,79,112,101,114,97,116,105,111,110,32,116,105,109,101,100,32,111,117,116,0,67,111,110,110,101,99,116,105,111,110,32,114,101,102,117,115,101,100,0,72,111,115,116,32,105,115,32,100,111,119,110,0,72,111,115,116,32,105,115,32,117,110,114,101,97,99,104,97,98,108,101,0,65,100,100,114,101,115,115,32,105,110,32,117,115,101,0,66,114,111,107,101,110,32,112,105,112,101,0,73,47,79,32,101,114,114,111,114,0,78,111,32,115,117,99,104,32,100,101,118,105,99,101,32,111,114,32,97,100,100,114,101,115,115,0,66,108,111,99,107,32,100,101,118,105,99,101,32,114,101,113,117,105,114,101,100,0,78,111,32,115,117,99,104,32,100,101,118,105,99,101,0,78,111,116,32,97,32,100,105,114,101,99,116,111,114,121,0,73,115,32,97,32,100,105,114,101,99,116,111,114,121,0,84,101,120,116,32,102,105,108,101,32,98,117,115,121,0,69,120,101,99,32,102,111,114,109,97,116,32,101,114,114,111,114,0,73,110,118,97,108,105,100,32,97,114,103,117,109,101,110,116,0,65,114,103,117,109,101,110,116,32,108,105,115,116,32,116,111,111,32,108,111,110,103,0,83,121,109,98,111,108,105,99,32,108,105,110,107,32,108,111,111,112,0,70,105,108,101,110,97,109,101,32,116,111,111,32,108,111,110,103,0,84,111,111,32,109,97,110,121,32,111,112,101,110,32,102,105,108,101,115,32,105,110,32,115,121,115,116,101,109,0,78,111,32,102,105,108,101,32,100,101,115,99,114,105,112,116,111,114,115,32,97,118,97,105,108,97,98,108,101,0,66,97,100,32,102,105,108,101,32,100,101,115,99,114,105,112,116,111,114,0,78,111,32,99,104,105,108,100,32,112,114,111,99,101,115,115,0,66,97,100,32,97,100,100,114,101,115,115,0,70,105,108,101,32,116,111,111,32,108,97,114,103,101,0,84,111,111,32,109,97,110,121,32,108,105,110,107,115,0,78,111,32,108,111,99,107,115,32,97,118,97,105,108,97,98,108,101,0,82,101,115,111,117,114,99,101,32,100,101,97,100,108,111,99,107,32,119,111,117,108,100,32,111,99,99,117,114,0,83,116,97,116,101,32,110,111,116,32,114,101,99,111,118,101,114,97,98,108,101,0,80,114,101,118,105,111,117,115,32,111,119,110,101,114,32,100,105,101,100,0,79,112,101,114,97,116,105,111,110,32,99,97,110,99,101,108,101,100,0,70,117,110,99,116,105,111,110,32,110,111,116,32,105,109,112,108,101,109,101,110,116,101,100,0,78,111,32,109,101,115,115,97,103,101,32,111,102,32,100,101,115,105,114,101,100,32,116,121,112,101,0,73,100,101,110,116,105,102,105,101,114,32,114,101,109,111,118,101,100,0,68,101,118,105,99,101,32,110,111,116,32,97,32,115,116,114,101,97,109,0,78,111,32,100,97,116,97,32,97,118,97,105,108,97,98,108,101,0,68,101,118,105,99,101,32,116,105,109,101,111,117,116,0,79,117,116,32,111,102,32,115,116,114,101,97,109,115,32,114,101,115,111,117,114,99,101,115,0,76,105,110,107,32,104,97,115,32,98,101,101,110,32,115,101,118,101,114,101,100,0,80,114,111,116,111,99,111,108,32,101,114,114,111,114,0,66,97,100,32,109,101,115,115,97,103,101,0,70,105,108,101,32,100,101,115,99,114,105,112,116,111,114,32,105,110,32,98,97,100,32,115,116,97,116,101,0,78,111,116,32,97,32,115,111,99,107,101,116,0,68,101,115,116,105,110,97,116,105,111,110,32,97,100,100,114,101,115,115,32,114,101,113,117,105,114,101,100,0,77,101,115,115,97,103,101,32,116,111,111,32,108,97,114,103,101,0,80,114,111,116,111,99,111,108,32,119,114,111,110,103,32,116,121,112,101,32,102,111,114,32,115,111,99,107,101,116,0,80,114,111,116,111,99,111,108,32,110,111,116,32,97,118,97,105,108,97,98,108,101,0,80,114,111,116,111,99,111,108,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,83,111,99,107,101,116,32,116,121,112,101,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,78,111,116,32,115,117,112,112,111,114,116,101,100,0,80,114,111,116,111,99,111,108,32,102,97,109,105,108,121,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,65,100,100,114,101,115,115,32,102,97,109,105,108,121,32,110,111,116,32,115,117,112,112,111,114,116,101,100,32,98,121,32,112,114,111,116,111,99,111,108,0,65,100,100,114,101,115,115,32,110,111,116,32,97,118,97,105,108,97,98,108,101,0,78,101,116,119,111,114,107,32,105,115,32,100,111,119,110,0,78,101,116,119,111,114,107,32,117,110,114,101,97,99,104,97,98,108,101,0,67,111,110,110,101,99,116,105,111,110,32,114,101,115,101,116,32,98,121,32,110,101,116,119,111,114,107,0,67,111,110,110,101,99,116,105,111,110,32,97,98,111,114,116,101,100,0,78,111,32,98,117,102,102,101,114,32,115,112,97,99,101,32,97,118,97,105,108,97,98,108,101,0,83,111,99,107,101,116,32,105,115,32,99,111,110,110,101,99,116,101,100,0,83,111,99,107,101,116,32,110,111,116,32,99,111,110,110,101,99,116,101,100,0,67,97,110,110,111,116,32,115,101,110,100,32,97,102,116,101,114,32,115,111,99,107,101,116,32,115,104,117,116,100,111,119,110,0,79,112,101,114,97,116,105,111,110,32,97,108,114,101,97,100,121,32,105,110,32,112,114,111,103,114,101,115,115,0,79,112,101,114,97,116,105,111,110,32,105,110,32,112,114,111,103,114,101,115,115,0,83,116,97,108,101,32,102,105,108,101,32,104,97,110,100,108,101,0,82,101,109,111,116,101,32,73,47,79,32,101,114,114,111,114,0,81,117,111,116,97,32,101,120,99,101,101,100,101,100,0,78,111,32,109,101,100,105,117,109,32,102,111,117,110,100,0,87,114,111,110,103,32,109,101,100,105,117,109,32,116,121,112,101,0,78,111,32,101,114,114,111,114,32,105,110,102,111,114,109,97,116,105,111,110,0,0,114,119,97],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+20480),allocate([17,0,10,0,17,17,17,0,0,0,0,5,0,0,0,0,0,0,9,0,0,0,0,11,0,0,0,0,0,0,0,0,17,0,15,10,17,17,17,3,10,7,0,1,19,9,11,11,0,0,9,6,11,0,0,11,0,6,17,0,0,0,17,17,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,0,17,0,10,10,17,17,17,0,10,0,0,2,0,9,11,0,0,0,9,0,11,0,0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,12,0,0,0,0,9,12,0,0,0,0,0,12,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,13,0,0,0,4,13,0,0,0,0,9,14,0,0,0,0,0,14,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,15,0,0,0,0,15,0,0,0,0,9,16,0,0,0,0,0,16,0,0,16,0,0,18,0,0,0,18,18,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,18,18,18,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,10,0,0,0,0,9,11,0,0,0,0,0,11,0,0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,12,0,0,0,0,9,12,0,0,0,0,0,12,0,0,12,0,0,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,45,43,32,32,32,48,88,48,120,0,40,110,117,108,108,41,0,45,48,88,43,48,88,32,48,88,45,48,120,43,48,120,32,48,120,0,105,110,102,0,73,78,70,0,110,97,110,0,78,65,78,0,46,0],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+25118);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}assert(tempDoublePtr%8==0),Module._i64Subtract=_i64Subtract;var _floorf=Math_floor;Module._bitshift64Ashr=_bitshift64Ashr;var _SItoF=!0;Module._memset=_memset;var _BDtoILow=!0,_ceilf=Math_ceil;function _abort(){Module.abort()}function ___lock(){}function ___unlock(){}Module._bitshift64Shl=_bitshift64Shl,Module._i64Add=_i64Add;var _floor=Math_floor,_sqrt=Math_sqrt,PATH=void 0;function _emscripten_set_main_loop_timing(e,t){if(Browser.mainLoop.timingMode=e,Browser.mainLoop.timingValue=t,!Browser.mainLoop.func)return 1;if(0==e)Browser.mainLoop.scheduler=function(){setTimeout(Browser.mainLoop.runner,t)},Browser.mainLoop.method="timeout";else if(1==e)Browser.mainLoop.scheduler=function(){Browser.requestAnimationFrame(Browser.mainLoop.runner)},Browser.mainLoop.method="rAF";else if(2==e){if(!window.setImmediate){var r=[],n="__emcc";window.addEventListener("message",function(e){e.source===window&&e.data===n&&(e.stopPropagation(),r.shift()())},!0),window.setImmediate=function(e){r.push(e),window.postMessage(n,"*")}}Browser.mainLoop.scheduler=function(){window.setImmediate(Browser.mainLoop.runner)},Browser.mainLoop.method="immediate"}return 0}function _emscripten_set_main_loop(e,t,r,n,i){Module.noExitRuntime=!0,assert(!Browser.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),Browser.mainLoop.func=e,Browser.mainLoop.arg=n;var a=Browser.mainLoop.currentlyRunningMainloop;if(Browser.mainLoop.runner=function(){if(!ABORT){if(Browser.mainLoop.queue.length>0){var t=Date.now(),r=Browser.mainLoop.queue.shift();if(r.func(r.arg),Browser.mainLoop.remainingBlockers){var i=Browser.mainLoop.remainingBlockers,o=i%1==0?i-1:Math.floor(i);r.counted?Browser.mainLoop.remainingBlockers=o:(o+=.5,Browser.mainLoop.remainingBlockers=(8*i+o)/9)}return console.log('main loop blocker "'+r.name+'" took '+(Date.now()-t)+" ms"),Browser.mainLoop.updateStatus(),void setTimeout(Browser.mainLoop.runner,0)}a<Browser.mainLoop.currentlyRunningMainloop||(Browser.mainLoop.currentFrameNumber=Browser.mainLoop.currentFrameNumber+1|0,1==Browser.mainLoop.timingMode&&Browser.mainLoop.timingValue>1&&Browser.mainLoop.currentFrameNumber%Browser.mainLoop.timingValue!=0?Browser.mainLoop.scheduler():("timeout"===Browser.mainLoop.method&&Module.ctx&&(Module.printErr("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),Browser.mainLoop.method=""),Browser.mainLoop.runIter(function(){void 0!==n?Runtime.dynCall("vi",e,[n]):Runtime.dynCall("v",e)}),a<Browser.mainLoop.currentlyRunningMainloop||("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),Browser.mainLoop.scheduler())))}},i||(t&&t>0?_emscripten_set_main_loop_timing(0,1e3/t):_emscripten_set_main_loop_timing(1,1),Browser.mainLoop.scheduler()),r)throw"SimulateInfiniteLoop"}var Browser={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Browser.mainLoop.scheduler=null,Browser.mainLoop.currentlyRunningMainloop++},resume:function(){Browser.mainLoop.currentlyRunningMainloop++;var e=Browser.mainLoop.timingMode,t=Browser.mainLoop.timingValue,r=Browser.mainLoop.func;Browser.mainLoop.func=null,_emscripten_set_main_loop(r,0,!1,Browser.mainLoop.arg,!0),_emscripten_set_main_loop_timing(e,t),Browser.mainLoop.scheduler()},updateStatus:function(){if(Module.setStatus){var e=Module.statusMessage||"Please wait...",t=Browser.mainLoop.remainingBlockers,r=Browser.mainLoop.expectedBlockers;t?t<r?Module.setStatus(e+" ("+(r-t)+"/"+r+")"):Module.setStatus(e):Module.setStatus("")}},runIter:function(e){if(!ABORT){if(Module.preMainLoop)if(!1===Module.preMainLoop())return;try{e()}catch(e){if(e instanceof ExitStatus)return;throw e&&"object"==typeof e&&e.stack&&Module.printErr("exception thrown: "+[e,e.stack]),e}Module.postMainLoop&&Module.postMainLoop()}}},isFullScreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(Module.preloadPlugins||(Module.preloadPlugins=[]),!Browser.initted){Browser.initted=!0;try{new Blob,Browser.hasBlobConstructor=!0}catch(e){Browser.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Browser.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),Browser.URLObject="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,Module.noImageDecoding||void 0!==Browser.URLObject||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),Module.noImageDecoding=!0);var e={canHandle:function(e){return!Module.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,r,n){var i=null;if(Browser.hasBlobConstructor)try{(i=new Blob([e],{type:Browser.getMimetype(t)})).size!==e.length&&(i=new Blob([new Uint8Array(e).buffer],{type:Browser.getMimetype(t)}))}catch(e){Runtime.warnOnce("Blob constructor present but fails: "+e+"; falling back to blob builder")}if(!i){var a=new Browser.BlobBuilder;a.append(new Uint8Array(e).buffer),i=a.getBlob()}var o=Browser.URLObject.createObjectURL(i),s=new Image;s.onload=function(){assert(s.complete,"Image "+t+" could not be decoded");var n=document.createElement("canvas");n.width=s.width,n.height=s.height,n.getContext("2d").drawImage(s,0,0),Module.preloadedImages[t]=n,Browser.URLObject.revokeObjectURL(o),r&&r(e)},s.onerror=function(e){console.log("Image "+o+" could not be decoded"),n&&n()},s.src=o}};Module.preloadPlugins.push(e);var t={canHandle:function(e){return!Module.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,r,n){var i=!1;function a(n){i||(i=!0,Module.preloadedAudios[t]=n,r&&r(e))}function o(){i||(i=!0,Module.preloadedAudios[t]=new Audio,n&&n())}if(!Browser.hasBlobConstructor)return o();try{var s=new Blob([e],{type:Browser.getMimetype(t)})}catch(e){return o()}var l=Browser.URLObject.createObjectURL(s),u=new Audio;u.addEventListener("canplaythrough",function(){a(u)},!1),u.onerror=function(r){i||(console.log("warning: browser could not fully decode audio "+t+", trying slower base64 approach"),u.src="data:audio/x-"+t.substr(-3)+";base64,"+function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",n=0,i=0,a=0;a<e.length;a++)for(n=n<<8|e[a],i+=8;i>=6;){var o=n>>i-6&63;i-=6,r+=t[o]}return 2==i?(r+=t[(3&n)<<4],r+="=="):4==i&&(r+=t[(15&n)<<2],r+="="),r}(e),a(u))},u.src=l,Browser.safeSetTimeout(function(){a(u)},1e4)}};Module.preloadPlugins.push(t);var r=Module.canvas;r&&(r.requestPointerLock=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.exitPointerLock=r.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",n,!1),document.addEventListener("mozpointerlockchange",n,!1),document.addEventListener("webkitpointerlockchange",n,!1),document.addEventListener("mspointerlockchange",n,!1),Module.elementPointerLock&&r.addEventListener("click",function(e){!Browser.pointerLock&&r.requestPointerLock&&(r.requestPointerLock(),e.preventDefault())},!1))}function n(){Browser.pointerLock=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}},createContext:function(e,t,r,n){if(t&&Module.ctx&&e==Module.canvas)return Module.ctx;var i,a;if(t){var o={antialias:!1,alpha:!1};if(n)for(var s in n)o[s]=n[s];(a=GL.createContext(e,o))&&(i=GL.getContext(a).GLctx),e.style.backgroundColor="black"}else i=e.getContext("2d");return i?(r&&(t||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),Module.ctx=i,t&&GL.makeContextCurrent(a),Module.useWebGL=t,Browser.moduleContextCreatedCallbacks.forEach(function(e){e()}),Browser.init()),i):null},destroyContext:function(e,t,r){},fullScreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullScreen:function(e,t,r){Browser.lockPointer=e,Browser.resizeCanvas=t,Browser.vrDevice=r,void 0===Browser.lockPointer&&(Browser.lockPointer=!0),void 0===Browser.resizeCanvas&&(Browser.resizeCanvas=!1),void 0===Browser.vrDevice&&(Browser.vrDevice=null);var n=Module.canvas;function i(){Browser.isFullScreen=!1;var e=n.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===e?(n.cancelFullScreen=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},n.cancelFullScreen=n.cancelFullScreen.bind(document),Browser.lockPointer&&n.requestPointerLock(),Browser.isFullScreen=!0,Browser.resizeCanvas&&Browser.setFullScreenCanvasSize()):(e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e),Browser.resizeCanvas&&Browser.setWindowedCanvasSize()),Module.onFullScreen&&Module.onFullScreen(Browser.isFullScreen),Browser.updateCanvasDimensions(n)}Browser.fullScreenHandlersInstalled||(Browser.fullScreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var a=document.createElement("div");n.parentNode.insertBefore(a,n),a.appendChild(n),a.requestFullScreen=a.requestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullScreen?function(){a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),r?a.requestFullScreen({vrDisplay:r}):a.requestFullScreen()},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===Browser.nextRAF)Browser.nextRAF=t+1e3/60;else for(;t+2>=Browser.nextRAF;)Browser.nextRAF+=1e3/60;var r=Math.max(Browser.nextRAF-t,0);setTimeout(e,r)},requestAnimationFrame:function(e){"undefined"==typeof window?Browser.fakeRequestAnimationFrame(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Browser.fakeRequestAnimationFrame),window.requestAnimationFrame(e))},safeCallback:function(e){return function(){if(!ABORT)return e.apply(null,arguments)}},allowAsyncCallbacks:!0,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){Browser.allowAsyncCallbacks=!1},resumeAsyncCallbacks:function(){if(Browser.allowAsyncCallbacks=!0,Browser.queuedAsyncCallbacks.length>0){var e=Browser.queuedAsyncCallbacks;Browser.queuedAsyncCallbacks=[],e.forEach(function(e){e()})}},safeRequestAnimationFrame:function(e){return Browser.requestAnimationFrame(function(){ABORT||(Browser.allowAsyncCallbacks?e():Browser.queuedAsyncCallbacks.push(e))})},safeSetTimeout:function(e,t){return Module.noExitRuntime=!0,setTimeout(function(){ABORT||(Browser.allowAsyncCallbacks?e():Browser.queuedAsyncCallbacks.push(e))},t)},safeSetInterval:function(e,t){return Module.noExitRuntime=!0,setInterval(function(){ABORT||Browser.allowAsyncCallbacks&&e()},t)},getMimetype:function(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail;break;case"mousewheel":t=e.wheelDelta;break;case"wheel":t=e.deltaY;break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(e){if(Browser.pointerLock)"mousemove"!=e.type&&"mozMovementX"in e?Browser.mouseMovementX=Browser.mouseMovementY=0:(Browser.mouseMovementX=Browser.getMovementX(e),Browser.mouseMovementY=Browser.getMovementY(e)),"undefined"!=typeof SDL?(Browser.mouseX=SDL.mouseX+Browser.mouseMovementX,Browser.mouseY=SDL.mouseY+Browser.mouseMovementY):(Browser.mouseX+=Browser.mouseMovementX,Browser.mouseY+=Browser.mouseMovementY);else{var t=Module.canvas.getBoundingClientRect(),r=Module.canvas.width,n=Module.canvas.height,i=void 0!==window.scrollX?window.scrollX:window.pageXOffset,a=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type){var o=e.touch;if(void 0===o)return;var s=o.pageX-(i+t.left),l=o.pageY-(a+t.top),u={x:s*=r/t.width,y:l*=n/t.height};if("touchstart"===e.type)Browser.lastTouches[o.identifier]=u,Browser.touches[o.identifier]=u;else if("touchend"===e.type||"touchmove"===e.type){var c=Browser.touches[o.identifier];c||(c=u),Browser.lastTouches[o.identifier]=c,Browser.touches[o.identifier]=u}return}var h=e.pageX-(i+t.left),d=e.pageY-(a+t.top);h*=r/t.width,d*=n/t.height,Browser.mouseMovementX=h-Browser.mouseX,Browser.mouseMovementY=d-Browser.mouseY,Browser.mouseX=h,Browser.mouseY=d}},xhrLoad:function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)},asyncLoad:function(e,t,r,n){Browser.xhrLoad(e,function(r){assert(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),n||removeRunDependency("al "+e)},function(t){if(!r)throw'Loading data file "'+e+'" failed.';r()}),n||addRunDependency("al "+e)},resizeListeners:[],updateResizeListeners:function(){var e=Module.canvas;Browser.resizeListeners.forEach(function(t){t(e.width,e.height)})},setCanvasSize:function(e,t,r){var n=Module.canvas;Browser.updateCanvasDimensions(n,e,t),r||Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullScreenCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2];e|=8388608,HEAP32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2]=e}Browser.updateResizeListeners()},setWindowedCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2];e&=-8388609,HEAP32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2]=e}Browser.updateResizeListeners()},updateCanvasDimensions:function(e,t,r){t&&r?(e.widthNative=t,e.heightNative=r):(t=e.widthNative,r=e.heightNative);var n=t,i=r;if(Module.forcedAspectRatio&&Module.forcedAspectRatio>0&&(n/i<Module.forcedAspectRatio?n=Math.round(i*Module.forcedAspectRatio):i=Math.round(n/Module.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var a=Math.min(screen.width/n,screen.height/i);n=Math.round(n*a),i=Math.round(i*a)}Browser.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=i&&(e.height=i),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=t&&(e.width=t),e.height!=r&&(e.height=r),void 0!==e.style&&(n!=t||i!=r?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",i+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var e=Browser.nextWgetRequestHandle;return Browser.nextWgetRequestHandle++,e}},SYSCALLS={varargs:0,get:function(e){return SYSCALLS.varargs+=4,HEAP32[SYSCALLS.varargs-4>>2]},getStr:function(){return Pointer_stringify(SYSCALLS.get())},get64:function(){var e=SYSCALLS.get(),t=SYSCALLS.get();return assert(e>=0?0===t:-1===t),e},getZero:function(){assert(0===SYSCALLS.get())}};function ___syscall54(e,t){SYSCALLS.varargs=t;try{return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___setErrNo(e){return Module.___errno_location&&(HEAP32[Module.___errno_location()>>2]=e),e}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(e){switch(e){case 30:return PAGE_SIZE;case 85:return totalMemory/PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ___setErrNo(ERRNO_CODES.EINVAL),-1}Module._bitshift64Lshr=_bitshift64Lshr;var _BDtoIHigh=!0;function _pthread_cleanup_push(e,t){__ATEXIT__.push(function(){Runtime.dynCall("vi",e,[t])}),_pthread_cleanup_push.level=__ATEXIT__.length}function _pthread_cleanup_pop(){assert(_pthread_cleanup_push.level==__ATEXIT__.length,"cannot pop if something else added meanwhile!"),__ATEXIT__.pop(),_pthread_cleanup_push.level=__ATEXIT__.length}function ___syscall5(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStr(),n=SYSCALLS.get(),i=SYSCALLS.get();return FS.open(r,n,i).fd}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function _emscripten_memcpy_big(e,t,r){return HEAPU8.set(HEAPU8.subarray(t,t+r),e),e}function ___syscall6(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD();return FS.close(r),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}Module._memcpy=_memcpy;var _llvm_pow_f64=Math_pow;function _sbrk(e){var t=_sbrk;t.called||(DYNAMICTOP=alignMemoryPage(DYNAMICTOP),t.called=!0,assert(Runtime.dynamicAlloc),t.alloc=Runtime.dynamicAlloc,Runtime.dynamicAlloc=function(){abort("cannot dynamically allocate, sbrk now has control")});var r=DYNAMICTOP;if(0!=e&&!t.alloc(e))return-1>>>0;return r}var _BItoD=!0;function _time(e){var t=Date.now()/1e3|0;return e&&(HEAP32[e>>2]=t),t}function _pthread_self(){return 0}function ___syscall140(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD(),n=SYSCALLS.get(),i=SYSCALLS.get(),a=SYSCALLS.get(),o=SYSCALLS.get(),s=i;return assert(0===n),FS.llseek(r,s,o),HEAP32[a>>2]=r.position,r.getdents&&0===s&&0===o&&(r.getdents=null),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall146(e,t){SYSCALLS.varargs=t;try{SYSCALLS.get();var r=SYSCALLS.get(),n=SYSCALLS.get(),i=0;___syscall146.buffer||(___syscall146.buffer=[]);for(var a=___syscall146.buffer,o=0;o<n;o++){for(var s=HEAP32[r+8*o>>2],l=HEAP32[r+(8*o+4)>>2],u=0;u<l;u++){var c=HEAPU8[s+u];0===c||10===c?(Module.print(UTF8ArrayToString(a,0)),a.length=0):a.push(c)}i+=l}return i}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall221(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD();switch(SYSCALLS.get()){case 0:return(n=SYSCALLS.get())<0?-ERRNO_CODES.EINVAL:FS.open(r.path,r.flags,0,n).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:var n=SYSCALLS.get();return r.flags|=n,0;case 12:case 12:n=SYSCALLS.get();return HEAP16[n+0>>1]=2,0;case 13:case 14:case 13:case 14:return 0;case 16:case 8:return-ERRNO_CODES.EINVAL;case 9:return ___setErrNo(ERRNO_CODES.EINVAL),-1;default:return-ERRNO_CODES.EINVAL}}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall145(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD(),n=SYSCALLS.get(),i=SYSCALLS.get();return SYSCALLS.doReadv(r,n,i)}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}Module.requestFullScreen=function(e,t,r){Browser.requestFullScreen(e,t,r)},Module.requestAnimationFrame=function(e){Browser.requestAnimationFrame(e)},Module.setCanvasSize=function(e,t,r){Browser.setCanvasSize(e,t,r)},Module.pauseMainLoop=function(){Browser.mainLoop.pause()},Module.resumeMainLoop=function(){Browser.mainLoop.resume()},Module.getUserMedia=function(){Browser.getUserMedia()},Module.createContext=function(e,t,r,n){return Browser.createContext(e,t,r,n)},STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),staticSealed=!0,STACK_MAX=STACK_BASE+TOTAL_STACK,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);function invoke_iiiiiiii(e,t,r,n,i,a,o,s){try{return Module.dynCall_iiiiiiii(e,t,r,n,i,a,o,s)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiii(e,t,r,n){try{return Module.dynCall_iiii(e,t,r,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_di(e,t){try{return Module.dynCall_di(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_vi(e,t){try{Module.dynCall_vi(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_vii(e,t,r){try{Module.dynCall_vii(e,t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiiii(e,t,r,n,i,a,o){try{return Module.dynCall_iiiiiii(e,t,r,n,i,a,o)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_ii(e,t){try{return Module.dynCall_ii(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_viii(e,t,r,n){try{Module.dynCall_viii(e,t,r,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiiiiiiiii(e,t,r,n,i,a,o,s,l,u,c,h){try{return Module.dynCall_iiiiiiiiiiii(e,t,r,n,i,a,o,s,l,u,c,h)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiii(e,t,r,n,i){try{return Module.dynCall_iiiii(e,t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iii(e,t,r){try{return Module.dynCall_iii(e,t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiii(e,t,r,n,i,a){try{return Module.dynCall_iiiiii(e,t,r,n,i,a)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_viiii(e,t,r,n,i){try{Module.dynCall_viiii(e,t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}Module.asmGlobalArg={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,byteLength:byteLength},Module.asmLibraryArg={abort:abort,assert:assert,invoke_iiiiiiii:invoke_iiiiiiii,invoke_iiii:invoke_iiii,invoke_di:invoke_di,invoke_vi:invoke_vi,invoke_vii:invoke_vii,invoke_iiiiiii:invoke_iiiiiii,invoke_ii:invoke_ii,invoke_viii:invoke_viii,invoke_iiiiiiiiiiii:invoke_iiiiiiiiiiii,invoke_iiiii:invoke_iiiii,invoke_iii:invoke_iii,invoke_iiiiii:invoke_iiiiii,invoke_viiii:invoke_viiii,_pthread_cleanup_pop:_pthread_cleanup_pop,___syscall221:___syscall221,_llvm_pow_f64:_llvm_pow_f64,_abort:_abort,_pthread_cleanup_push:_pthread_cleanup_push,_ceilf:_ceilf,_emscripten_set_main_loop_timing:_emscripten_set_main_loop_timing,_sbrk:_sbrk,_emscripten_memcpy_big:_emscripten_memcpy_big,_sysconf:_sysconf,___setErrNo:___setErrNo,_floor:_floor,_pthread_self:_pthread_self,_sqrt:_sqrt,_floorf:_floorf,___syscall54:___syscall54,___unlock:___unlock,_emscripten_set_main_loop:_emscripten_set_main_loop,___lock:___lock,___syscall6:___syscall6,___syscall5:___syscall5,_time:_time,___syscall140:___syscall140,___syscall145:___syscall145,___syscall146:___syscall146,STACKTOP:STACKTOP,STACK_MAX:STACK_MAX,tempDoublePtr:tempDoublePtr,ABORT:ABORT,cttz_i8:cttz_i8};var asm=function(e,t,r){"use asm";var n=e.Int8Array;var i=e.Int16Array;var a=e.Int32Array;var o=e.Uint8Array;var s=e.Uint16Array;var l=e.Uint32Array;var u=e.Float32Array;var c=e.Float64Array;var h=new n(r);var d=new i(r);var f=new a(r);var p=new o(r);var m=new s(r);var v=new l(r);var g=new u(r);var y=new c(r);var _=e.byteLength;var b=t.STACKTOP|0;var E=t.STACK_MAX|0;var w=t.tempDoublePtr|0;var x=t.ABORT|0;var T=t.cttz_i8|0;var S=0;var M=0;var R=0;var A=0;var k=e.NaN,P=e.Infinity;var C=0,L=0,I=0,O=0,H=0.0,D=0,N=0,F=0,U=0.0;var B=0;var z=0;var j=0;var V=0;var G=0;var W=0;var X=0;var Y=0;var q=0;var Z=0;var J=e.Math.floor;var K=e.Math.abs;var Q=e.Math.sqrt;var $=e.Math.pow;var ee=e.Math.cos;var te=e.Math.sin;var re=e.Math.tan;var ne=e.Math.acos;var ie=e.Math.asin;var ae=e.Math.atan;var oe=e.Math.atan2;var se=e.Math.exp;var le=e.Math.log;var ue=e.Math.ceil;var ce=e.Math.imul;var he=e.Math.min;var de=e.Math.clz32;var fe=t.abort;var pe=t.assert;var me=t.invoke_iiiiiiii;var ve=t.invoke_iiii;var ge=t.invoke_di;var ye=t.invoke_vi;var _e=t.invoke_vii;var be=t.invoke_iiiiiii;var Ee=t.invoke_ii;var we=t.invoke_viii;var xe=t.invoke_iiiiiiiiiiii;var Te=t.invoke_iiiii;var Se=t.invoke_iii;var Me=t.invoke_iiiiii;var Re=t.invoke_viiii;var Ae=t._pthread_cleanup_pop;var ke=t.___syscall221;var Pe=t._llvm_pow_f64;var Ce=t._abort;var Le=t._pthread_cleanup_push;var Ie=t._ceilf;var Oe=t._emscripten_set_main_loop_timing;var He=t._sbrk;var De=t._emscripten_memcpy_big;var Ne=t._sysconf;var Fe=t.___setErrNo;var Ue=t._floor;var Be=t._pthread_self;var ze=t._sqrt;var je=t._floorf;var Ve=t.___syscall54;var Ge=t.___unlock;var We=t._emscripten_set_main_loop;var Xe=t.___lock;var Ye=t.___syscall6;var qe=t.___syscall5;var Ze=t._time;var Je=t.___syscall140;var Ke=t.___syscall145;var Qe=t.___syscall146;var $e=0.0;function et(e){if(_(e)&16777215||_(e)<=16777215||_(e)>2147483648)return false;h=new n(e);d=new i(e);f=new a(e);p=new o(e);m=new s(e);v=new l(e);g=new u(e);y=new c(e);r=e;return true}function tt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=b;b=b+48|0;i=c+32|0;u=c+28|0;f[i>>2]=r;if((f[e+8>>2]|0)==16)l=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else l=f[e+12>>2]|0;a=(f[e+80>>2]|0)+16|0;o=(f[a>>2]|0)>>>0<257?1:2;s=o+1|0;if(s>>>0>r>>>0){Qn(n,1,14585,c)|0;n=0;b=c;return n|0}f[i>>2]=r-s;wn(t,u,o);r=f[u>>2]|0;if(r>>>0>=(f[a>>2]|0)>>>0){Qn(n,1,14611,c+8|0)|0;n=0;b=c;return n|0}wn(t+o|0,(f[l+5584>>2]|0)+(r*1080|0)|0,1);if(!(Rt(e,f[u>>2]|0,t+s|0,i,n)|0)){Qn(n,1,14585,c+16|0)|0;n=0;b=c;return n|0}if(!(f[i>>2]|0)){n=1;b=c;return n|0}Qn(n,1,14585,c+24|0)|0;n=0;b=c;return n|0}function rt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+32|0;s=l+8|0;i=l+20|0;o=f[(f[e+80>>2]|0)+16>>2]|0;a=o>>>0<257?1:2;if((a+2|0)!=(r|0)){Qn(n,1,14502,l)|0;s=0;b=l;return s|0}if((f[e+8>>2]|0)==16)e=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else e=f[e+12>>2]|0;wn(t,i,a);wn(t+a|0,l+16|0,1);r=f[i>>2]|0;if(r>>>0<o>>>0){wn(t+(a+1)|0,(f[e+5584>>2]|0)+(r*1080|0)+808|0,1);s=1;b=l;return s|0}else{f[s>>2]=r;f[s+4>>2]=o;Qn(n,1,14528,s)|0;s=0;b=l;return s|0}return 0}function nt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0;o=b;b=b+16|0;i=o+12|0;f[i>>2]=r;if(!(Mt(e,0,t,i,n)|0)){Qn(n,1,14476,o)|0;a=0;b=o;return a|0}if(f[i>>2]|0){Qn(n,1,14476,o+8|0)|0;a=0;b=o;return a|0}if((f[e+8>>2]|0)==16)i=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else i=f[e+12>>2]|0;i=f[i+5584>>2]|0;r=e+80|0;if((f[(f[r>>2]|0)+16>>2]|0)>>>0<=1){a=1;b=o;return a|0}n=i+24|0;e=i+804|0;a=i+28|0;t=1;while(1){f[i+1104>>2]=f[n>>2];f[i+1884>>2]=f[e>>2];Yl(i+1108|0,a|0,776)|0;t=t+1|0;if(t>>>0>=(f[(f[r>>2]|0)+16>>2]|0)>>>0){i=1;break}else i=i+1080|0}b=o;return i|0}function it(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;d=b;b=b+48|0;h=d+32|0;c=d+24|0;u=d+16|0;a=d+8|0;i=d;l=d+40|0;o=d+36|0;f[l>>2]=r;s=e+80|0;do{if((f[(f[s>>2]|0)+16>>2]|0)>>>0<257){if(r){wn(t,o,1);a=t+1|0;t=r+-1|0;break}Qn(n,1,14129,i)|0;h=0;b=d;return h|0}else{if(r>>>0>=2){wn(t,o,2);a=t+2|0;t=r+-2|0;break}Qn(n,1,14129,a)|0;h=0;b=d;return h|0}}while(0);f[l>>2]=t;i=f[o>>2]|0;t=f[(f[s>>2]|0)+16>>2]|0;if(i>>>0>=t>>>0){f[u>>2]=i;f[u+4>>2]=t;Qn(n,1,14155,u)|0;h=0;b=d;return h|0}if(!(Mt(e,i,a,l,n)|0)){Qn(n,1,14129,c)|0;h=0;b=d;return h|0}if(!(f[l>>2]|0)){h=1;b=d;return h|0}Qn(n,1,14129,h)|0;h=0;b=d;return h|0}function at(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0;y=b;b=b+16|0;a=y+8|0;g=y+12|0;v=f[(f[e+80>>2]|0)+16>>2]|0;m=v>>>0<257?1:2;p=(m<<1)+5|0;i=(r>>>0)/(p>>>0)|0;if((i|0)==0|((r>>>0)%(p>>>0)|0|0)!=0){Qn(n,1,14085,y)|0;g=0;b=y;return g|0}if((f[e+8>>2]|0)==16)p=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else p=f[e+12>>2]|0;r=p+5636|0;e=h[r>>0]|0;if(!(e&4))d=0;else d=(f[p+420>>2]|0)+1|0;c=d+i|0;if(c>>>0>31){f[a>>2]=c;Qn(n,1,14111,a)|0;g=0;b=y;return g|0}h[r>>0]=e|4;if(d>>>0<c>>>0){n=m+1|0;u=p+8|0;a=m+3|0;o=m|4;s=o+m|0;l=s+1|0;e=t;i=d;r=p+424+(d*148|0)|0;while(1){wn(e,r,1);wn(e+1|0,r+4|0,m);t=r+8|0;wn(e+n|0,t,2);_=f[t>>2]|0;d=f[u>>2]|0;f[t>>2]=_>>>0<d>>>0?_:d;wn(e+a|0,r+12|0,1);t=r+16|0;wn(e+o|0,t,m);wn(e+s|0,g,1);f[r+36>>2]=f[g>>2];d=f[t>>2]|0;f[t>>2]=d>>>0<v>>>0?d:v;i=i+1|0;if(i>>>0>=c>>>0)break;else{e=e+l|0;r=r+148|0}}}f[p+420>>2]=c+-1;_=1;b=y;return _|0}function ot(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0;N=b;b=b+144|0;D=N+128|0;L=N+120|0;C=N+112|0;P=N+104|0;k=N+96|0;A=N+88|0;M=N+72|0;y=N+64|0;v=N+56|0;m=N+48|0;p=N+40|0;g=N+32|0;s=N+24|0;a=N+16|0;i=N+136|0;w=N+132|0;O=f[e+80>>2]|0;H=e+88|0;if(r>>>0<36){Qn(n,1,13440,N)|0;n=0;b=N;return n|0}I=r+-36|0;c=(I>>>0)/3|0;if((I>>>0)%3|0){Qn(n,1,13440,N+8|0)|0;n=0;b=N;return n|0}wn(t,i,2);d[H>>1]=f[i>>2];x=O+8|0;wn(t+2|0,x,4);R=O+12|0;wn(t+6|0,R,4);wn(t+10|0,O,4);u=O+4|0;wn(t+14|0,u,4);E=e+100|0;wn(t+18|0,E,4);S=e+104|0;wn(t+22|0,S,4);_=e+92|0;wn(t+26|0,_,4);T=e+96|0;wn(t+30|0,T,4);wn(t+34|0,i,2);o=t+36|0;r=f[i>>2]|0;if(r>>>0>=16385){f[a>>2]=r;Qn(n,1,13468,a)|0;n=0;b=N;return n|0}r=r&65535;I=O+16|0;f[I>>2]=r;if((r|0)!=(c|0)){f[s>>2]=r;f[s+4>>2]=c;Qn(n,1,13529,s)|0;n=0;b=N;return n|0}s=f[O>>2]|0;l=f[x>>2]|0;if(l>>>0>s>>>0){r=f[u>>2]|0;t=f[R>>2]|0;if(r>>>0<t>>>0){i=f[E>>2]|0;a=f[S>>2]|0;if(!(ce(a,i)|0)){f[p>>2]=i;f[p+4>>2]=a;Qn(n,1,13705,p)|0;n=0;b=N;return n|0}g=Ql(t|0,0,l|0,0)|0;if(!((g|0)==(ce(t,l)|0)&(B|0)==0)){f[m>>2]=l;f[m+4>>2]=t;Qn(n,1,13766,m)|0;n=0;b=N;return n|0}l=f[_>>2]|0;p=Wl(l|0,0,i|0,0)|0;m=B;u=f[T>>2]|0;g=Wl(u|0,0,a|0,0)|0;if(l>>>0<=s>>>0?u>>>0<=r>>>0&(p|0-m)>>>0>s>>>0&(g|0-B)>>>0>r>>>0:0){t=qi(c,52)|0;c=O+24|0;f[c>>2]=t;if(!t){f[I>>2]=0;Qn(n,1,13852,y)|0;n=0;b=N;return n|0}e:do{if(f[I>>2]|0){s=e+168|0;r=0;a=t;while(1){wn(o,w,1);f[a+24>>2]=(f[w>>2]&127)+1;f[a+32>>2]=(f[w>>2]|0)>>>7;wn(o+1|0,w,1);f[a>>2]=f[w>>2];wn(o+2|0,w,1);i=f[w>>2]|0;f[a+4>>2]=i;t=f[a>>2]|0;if((i+-1|0)>>>0>254|(t+-1|0)>>>0>254)break;f[a+36>>2]=0;f[a+40>>2]=f[s>>2];r=r+1|0;if(r>>>0>=(f[I>>2]|0)>>>0)break e;else{o=o+3|0;a=a+52|0}}f[M>>2]=r;f[M+4>>2]=t;f[M+8>>2]=i;Qn(n,1,13900,M)|0;n=0;b=N;return n|0}}while(0);l=f[_>>2]|0;s=f[E>>2]|0;o=((f[x>>2]|0)+-1-l+s|0)/(s|0)|0;f[e+112>>2]=o;a=f[T>>2]|0;i=f[S>>2]|0;t=((f[R>>2]|0)+-1-a+i|0)/(i|0)|0;f[e+116>>2]=t;if(!((t|0)==0|(o|0)==0)?o>>>0<=(65535/(t>>>0)|0)>>>0:0){u=ce(o,t)|0;r=e+28|0;if(!(h[e+76>>0]&2)){f[r>>2]=0;f[e+32>>2]=0;f[e+36>>2]=o;f[e+40>>2]=t}else{f[r>>2]=(((f[r>>2]|0)-l|0)>>>0)/(s>>>0)|0;A=e+32|0;f[A>>2]=(((f[A>>2]|0)-a|0)>>>0)/(i>>>0)|0;A=e+36|0;f[A>>2]=((f[A>>2]|0)+-1-l+s|0)/(s|0)|0;A=e+40|0;f[A>>2]=((f[A>>2]|0)+-1-a+i|0)/(i|0)|0}A=qi(u,5640)|0;o=e+164|0;f[o>>2]=A;if(!A){Qn(n,1,13852,k)|0;n=0;b=N;return n|0}k=qi(f[I>>2]|0,1080)|0;t=e+12|0;f[(f[t>>2]|0)+5584>>2]=k;if(!k){Qn(n,1,13852,P)|0;n=0;b=N;return n|0}P=qi(10,20)|0;r=f[t>>2]|0;f[r+5612>>2]=P;if(!P){Qn(n,1,13852,C)|0;n=0;b=N;return n|0}f[r+5620>>2]=10;C=qi(10,20)|0;r=f[t>>2]|0;f[r+5624>>2]=C;if(!C){Qn(n,1,13852,L)|0;n=0;b=N;return n|0}f[r+5632>>2]=10;a=f[I>>2]|0;if(a){i=f[c>>2]|0;r=r+5584|0;t=0;do{if(!(f[i+(t*52|0)+32>>2]|0))f[(f[r>>2]|0)+(t*1080|0)+1076>>2]=1<<(f[i+(t*52|0)+24>>2]|0)+-1;t=t+1|0}while(t>>>0<a>>>0)}e:do{if(u){r=f[o>>2]|0;L=qi(a,1080)|0;f[r+5584>>2]=L;if(L){t=0;while(1){t=t+1|0;if(t>>>0>=u>>>0)break e;L=qi(f[I>>2]|0,1080)|0;f[r+11224>>2]=L;if(!L)break;else r=r+5640|0}}Qn(n,1,13852,D)|0;n=0;b=N;return n|0}}while(0);f[e+8>>2]=4;ii(O,H);n=1;b=N;return n|0}f[A>>2]=o;f[A+4>>2]=t;Qn(n,1,14002,A)|0;n=0;b=N;return n|0}Qn(n,1,13808,v)|0;n=0;b=N;return n|0}}else{t=f[R>>2]|0;r=f[u>>2]|0}f[g>>2]=l-s;f[g+4>>2]=t-r;Qn(n,1,13643,g)|0;n=0;b=N;return n|0}function st(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0;i=b;b=b+32|0;e=i+12|0;if(r>>>0<2){Qn(n,1,13414,i)|0;n=0;b=i;return n|0}wn(t,i+16|0,1);wn(t+1|0,e,1);t=f[e>>2]|0;if(!(((r+-2|0)>>>0)%(((t>>>5&2)+2+(t>>>4&3)|0)>>>0)|0)){n=1;b=i;return n|0}Qn(n,1,13414,i+8|0)|0;n=0;b=i;return n|0}function lt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;e=b;b=b+16|0;if(!r){Qn(n,1,13388,e)|0;t=0}else t=1;b=e;return t|0}function ut(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+32|0;s=l+8|0;o=l+12|0;if(!r){Qn(n,1,13362,l)|0;n=0;b=l;return n|0}wn(t,l+16|0,1);i=r+-1|0;if(!i){n=1;b=l;return n|0}else{a=0;e=0}do{t=t+1|0;wn(t,o,1);r=f[o>>2]|0;if(!(r&128))e=0;else e=(r&127|e)<<7;a=a+1|0}while((a|0)!=(i|0));if(!e){n=1;b=l;return n|0}Qn(n,1,13362,s)|0;n=0;b=l;return n|0}function ct(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0;p=b;b=b+48|0;d=p+32|0;l=p+24|0;a=p+16|0;i=p+8|0;c=p+36|0;if(r>>>0<2){Qn(n,1,13276,p)|0;d=0;b=p;return d|0}u=e+184|0;h[u>>0]=h[u>>0]|1;wn(t,c,1);u=t+1|0;s=r+-1|0;o=e+124|0;r=f[o>>2]|0;do{if(r){i=e+120|0;t=f[c>>2]|0;if((f[i>>2]|0)>>>0<=t>>>0){e=t+1|0;t=Ki(r,e<<3)|0;if(t){f[o>>2]=t;r=f[i>>2]|0;Vl(t+(r<<3)|0,0,e-r<<3|0)|0;f[i>>2]=e;r=f[o>>2]|0;break}Qn(n,1,13302,a)|0;d=0;b=p;return d|0}}else{t=(f[c>>2]|0)+1|0;r=qi(t,8)|0;f[o>>2]=r;if(r){f[e+120>>2]=t;break}Qn(n,1,13302,i)|0;d=0;b=p;return d|0}}while(0);t=f[c>>2]|0;if(f[r+(t<<3)>>2]|0){f[l>>2]=t;Qn(n,1,13340,l)|0;d=0;b=p;return d|0}l=Yi(s)|0;r=f[c>>2]|0;t=f[o>>2]|0;f[t+(r<<3)>>2]=l;if(!l){Qn(n,1,13302,d)|0;d=0;b=p;return d|0}else{f[t+(r<<3)+4>>2]=s;Yl(f[t+(f[c>>2]<<3)>>2]|0,u|0,s|0)|0;d=1;b=p;return d|0}return 0}function ht(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0;v=b;b=b+48|0;m=v+40|0;d=v+32|0;s=v+24|0;o=v+16|0;p=v+44|0;if(r>>>0<2){Qn(n,1,13127,v)|0;m=0;b=v;return m|0}if(h[e+184>>0]&1){Qn(n,1,13153,v+8|0)|0;m=0;b=v;return m|0}a=f[e+200>>2]|0;i=f[e+164>>2]|0;c=i+(a*5640|0)+5636|0;h[c>>0]=h[c>>0]|2;wn(t,p,1);c=t+1|0;u=r+-1|0;l=i+(a*5640|0)+5164|0;t=f[l>>2]|0;do{if(t){i=i+(a*5640|0)+5160|0;e=f[p>>2]|0;if((f[i>>2]|0)>>>0<=e>>>0){r=e+1|0;e=Ki(t,r<<3)|0;if(e){f[l>>2]=e;t=f[i>>2]|0;Vl(e+(t<<3)|0,0,r-t<<3|0)|0;f[i>>2]=r;t=f[l>>2]|0;break}Qn(n,1,8775,s)|0;m=0;b=v;return m|0}}else{e=(f[p>>2]|0)+1|0;t=qi(e,8)|0;f[l>>2]=t;if(t){f[i+(a*5640|0)+5160>>2]=e;break}Qn(n,1,8775,o)|0;m=0;b=v;return m|0}}while(0);e=f[p>>2]|0;if(f[t+(e<<3)>>2]|0){f[d>>2]=e;Qn(n,1,13254,d)|0;m=0;b=v;return m|0}d=Yi(u)|0;t=f[p>>2]|0;e=f[l>>2]|0;f[e+(t<<3)>>2]=d;if(!d){Qn(n,1,8775,m)|0;m=0;b=v;return m|0}else{f[e+(t<<3)+4>>2]=u;Yl(f[e+(f[p>>2]<<3)>>2]|0,c|0,u|0)|0;m=1;b=v;return m|0}return 0}function dt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;t=b;b=b+16|0;if((f[(f[e+80>>2]|0)+16>>2]<<2|0)==(r|0)){n=1;b=t;return n|0}Qn(n,1,13101,t)|0;n=0;b=t;return n|0}function ft(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return 1}function pt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0;g=b;b=b+48|0;v=g+40|0;m=g+32|0;u=g+24|0;p=g+44|0;if((f[e+8>>2]|0)==16)s=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else s=f[e+12>>2]|0;if(r>>>0<2){Qn(n,1,12933,g)|0;v=0;b=g;return v|0}wn(t,p,2);if(f[p>>2]|0){Qn(n,2,12959,g+8|0)|0;v=1;b=g;return v|0}if(r>>>0<7){Qn(n,1,12933,g+16|0)|0;v=0;b=g;return v|0}wn(t+2|0,p,2);h=t+4|0;d=f[p>>2]&255;l=s+5612|0;i=f[l>>2]|0;c=s+5616|0;e=f[c>>2]|0;e:do{if(!e){a=0;o=i}else{a=0;o=i;do{if((f[o+8>>2]|0)==(d|0))break e;o=o+20|0;a=a+1|0}while(a>>>0<e>>>0)}}while(0);if((a|0)==(e|0)){a=s+5620|0;do{if((e|0)==(f[a>>2]|0)){e=e+10|0;f[a>>2]=e;e=Ki(i,e*20|0)|0;if(e){f[l>>2]=e;i=f[c>>2]|0;Vl(e+(i*20|0)|0,0,((f[a>>2]|0)-i|0)*20|0)|0;i=f[l>>2]|0;e=f[c>>2]|0;break}Qi(f[l>>2]|0);f[l>>2]=0;f[a>>2]=0;f[c>>2]=0;Qn(n,1,13019,u)|0;v=0;b=g;return v|0}}while(0);f[c>>2]=e+1;o=i+(e*20|0)|0}a=o+12|0;e=f[a>>2]|0;if(e){Qi(e);f[a>>2]=0}f[o+8>>2]=d;d=f[p>>2]|0;f[o+4>>2]=d>>>8&3;f[o>>2]=d>>>10&3;wn(h,p,2);if(f[p>>2]|0){Qn(n,2,13057,m)|0;v=1;b=g;return v|0}e=r+-6|0;i=Yi(e)|0;f[a>>2]=i;if(!i){Qn(n,1,12933,v)|0;v=0;b=g;return v|0}else{Yl(i|0,t+6|0,e|0)|0;f[o+16>>2]=e;v=1;b=g;return v|0}return 0}function mt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;i=s+16|0;o=s+12|0;e=e+80|0;a=f[(f[e>>2]|0)+16>>2]|0;if((a+2|0)!=(r|0)){Qn(n,1,12907,s)|0;o=0;b=s;return o|0}wn(t,i,2);if((f[i>>2]|0)!=(a|0)){Qn(n,1,12907,s+8|0)|0;o=0;b=s;return o|0}if(!a){o=1;b=s;return o|0}i=t+2|0;t=0;e=f[(f[e>>2]|0)+24>>2]|0;while(1){wn(i,o,1);f[e+32>>2]=(f[o>>2]|0)>>>7&1;f[e+24>>2]=(f[o>>2]&127)+1;t=t+1|0;if((t|0)==(a|0)){e=1;break}else{i=i+1|0;e=e+52|0}}b=s;return e|0}function vt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0;H=b;b=b+144|0;O=H+120|0;I=H+112|0;L=H+104|0;C=H+96|0;P=H+88|0;k=H+80|0;A=H+72|0;R=H+64|0;M=H+56|0;S=H+48|0;p=H+40|0;d=H+32|0;u=H+24|0;x=H+136|0;_=H+132|0;E=H+128|0;w=H+124|0;if((f[e+8>>2]|0)==16)m=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else m=f[e+12>>2]|0;if(r>>>0<2){Qn(n,1,12567,H)|0;O=0;b=H;return O|0}wn(t,x,2);if(f[x>>2]|0){Qn(n,2,12593,H+8|0)|0;O=1;b=H;return O|0}if(r>>>0<7){Qn(n,1,12567,H+16|0)|0;O=0;b=H;return O|0}wn(t+2|0,_,1);c=t+3|0;l=m+5624|0;i=f[l>>2]|0;T=m+5628|0;e=f[T>>2]|0;e:do{if(!e){o=0;a=i}else{s=f[_>>2]|0;o=0;a=i;do{if((f[a>>2]|0)==(s|0))break e;a=a+20|0;o=o+1|0}while(o>>>0<e>>>0)}}while(0);if((o|0)==(e|0)){a=m+5632|0;do{if((e|0)==(f[a>>2]|0)){e=e+10|0;f[a>>2]=e;e=Ki(i,e*20|0)|0;if(e){f[l>>2]=e;i=f[T>>2]|0;Vl(e+(i*20|0)|0,0,((f[a>>2]|0)-i|0)*20|0)|0;i=f[l>>2]|0;e=f[T>>2]|0;break}Qi(f[l>>2]|0);f[l>>2]=0;f[a>>2]=0;f[T>>2]=0;Qn(n,1,12639,u)|0;O=0;b=H;return O|0}}while(0);a=i+(e*20|0)|0}f[a>>2]=f[_>>2];wn(c,x,2);if(f[x>>2]|0){Qn(n,2,12593,d)|0;O=1;b=H;return O|0}wn(t+5|0,E,2);i=f[E>>2]|0;if(i>>>0>1){Qn(n,2,12677,p)|0;O=1;b=H;return O|0}e=r+-7|0;e:do{if(i){v=a+4|0;g=a+16|0;y=a+8|0;r=a+12|0;p=m+5612|0;d=m+5616|0;u=t+7|0;c=0;t:while(1){if(e>>>0<3){i=27;break}wn(u,x,1);if((f[x>>2]|0)!=1){i=29;break}wn(u+1|0,w,2);i=e+-3|0;o=f[w>>2]|0;s=(o>>>15)+1|0;o=o&32767;f[v>>2]=o;a=(ce(s,o)|0)+2|0;if(i>>>0<a>>>0){i=31;break}e=u+3|0;l=i-a|0;if(o){i=0;do{wn(e,x,s);if((f[x>>2]|0)!=(i|0)){i=34;break t}e=e+s|0;i=i+1|0}while(i>>>0<(f[v>>2]|0)>>>0)}wn(e,w,2);i=e+2|0;a=f[w>>2]|0;o=(a>>>15)+1|0;a=a&32767;f[w>>2]=a;if((a|0)!=(f[v>>2]|0)){i=37;break}e=(ce(o,a)|0)+3|0;if(l>>>0<e>>>0){i=39;break}e=l-e|0;if(a){a=0;do{wn(i,x,o);if((f[x>>2]|0)!=(a|0)){i=42;break t}i=i+o|0;a=a+1|0}while(a>>>0<(f[v>>2]|0)>>>0)}wn(i,x,3);u=i+3|0;h[g>>0]=((f[x>>2]|0)>>>16^1)&1|h[g>>0]&-2;f[y>>2]=0;f[r>>2]=0;l=f[x>>2]|0;a=l&255;f[_>>2]=a;if(a){o=f[d>>2]|0;if(!o){i=50;break}s=0;i=f[p>>2]|0;while(1){if((f[i+8>>2]|0)==(a|0))break;s=s+1|0;if(s>>>0>=o>>>0){i=50;break t}else i=i+20|0}f[y>>2]=i}a=l>>>8&255;f[_>>2]=a;if(a){o=f[d>>2]|0;if(!o){i=57;break}s=0;i=f[p>>2]|0;while(1){if((f[i+8>>2]|0)==(a|0))break;s=s+1|0;if(s>>>0>=o>>>0){i=57;break t}else i=i+20|0}f[r>>2]=i}c=c+1|0;if(c>>>0>=(f[E>>2]|0)>>>0)break e}if((i|0)==27){Qn(n,1,12567,S)|0;O=0;b=H;return O|0}else if((i|0)==29){Qn(n,2,12721,M)|0;O=1;b=H;return O|0}else if((i|0)==31){Qn(n,1,12567,R)|0;O=0;b=H;return O|0}else if((i|0)==34){Qn(n,2,12787,A)|0;O=1;b=H;return O|0}else if((i|0)==37){Qn(n,2,12841,k)|0;O=1;b=H;return O|0}else if((i|0)==39){Qn(n,1,12567,P)|0;O=0;b=H;return O|0}else if((i|0)==42){Qn(n,2,12787,C)|0;O=1;b=H;return O|0}else if((i|0)==50){Qn(n,1,12567,L)|0;O=0;b=H;return O|0}else if((i|0)==57){Qn(n,1,12567,I)|0;O=0;b=H;return O|0}}}while(0);if(!e){f[T>>2]=(f[T>>2]|0)+1;O=1;b=H;return O|0}else{Qn(n,1,12567,O)|0;O=0;b=H;return O|0}return 0}function gt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0;g=b;b=b+32|0;v=g+24|0;m=g+20|0;h=e+80|0;i=f[h>>2]|0;if((f[e+8>>2]|0)==16)a=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else a=f[e+12>>2]|0;if(!r){Qn(n,1,12486,g)|0;v=0;b=g;return v|0}wn(t,m,1);e=f[m>>2]|0;if(e>>>0>1){Qn(n,2,12512,g+8|0)|0;v=1;b=g;return v|0}if((e+1|0)!=(r|0)){Qn(n,2,12486,g+16|0)|0;v=0;b=g;return v|0}c=a+5584|0;e=f[i+16>>2]|0;if(e){r=0;n=f[c>>2]|0;while(1){f[n+1076>>2]=0;r=r+1|0;if(r>>>0>=e>>>0)break;else n=n+1080|0}}u=a+5604|0;e=f[u>>2]|0;if(e){Qi(e);f[u>>2]=0}if(!(f[m>>2]|0)){v=1;b=g;return v|0}l=a+5624|0;o=a+5628|0;s=0;while(1){t=t+1|0;wn(t,v,1);e=f[h>>2]|0;i=f[l>>2]|0;a=f[o>>2]|0;if(((a|0)!=0?!((a|0)==0?1:(f[i>>2]|0)!=(f[v>>2]|0)):0)?(d=f[i+4>>2]|0,p=e+16|0,(d|0)==(f[p>>2]|0)):0){e=f[i+8>>2]|0;if(e){r=ce(d,d)|0;a=ce(f[1036+(f[e>>2]<<2)>>2]|0,r)|0;if((f[e+16>>2]|0)!=(a|0)){e=0;r=32;break}n=Yi(r<<2)|0;f[u>>2]=n;if(!n){e=0;r=32;break}Hu[f[1052+(f[e>>2]<<2)>>2]&15](f[e+12>>2]|0,n,r)}e=f[i+12>>2]|0;if(e){r=f[p>>2]|0;a=ce(r,f[1036+(f[e>>2]<<2)>>2]|0)|0;if((f[e+16>>2]|0)!=(a|0)){e=0;r=32;break}a=Yi(r<<2)|0;if(!a){e=0;r=32;break}Hu[f[1068+(f[e>>2]<<2)>>2]&15](f[e+12>>2]|0,a,r);e=f[p>>2]|0;if(e){r=0;n=a;i=f[c>>2]|0;while(1){f[i+1076>>2]=f[n>>2];r=r+1|0;if((r|0)==(e|0))break;else{n=n+4|0;i=i+1080|0}}}Qi(a)}}s=s+1|0;if(s>>>0>=(f[m>>2]|0)>>>0){e=1;r=32;break}}if((r|0)==32){b=g;return e|0}return 0}function yt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,2);f[t>>2]=f[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+2|0}}b=a;return}function _t(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,4);f[t>>2]=f[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function bt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Mn(e,i);f[t>>2]=~~+g[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function Et(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Tn(e,i);f[t>>2]=~~+y[i>>3];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+8|0}}b=a;return}function wt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,2);g[t>>2]=+((f[i>>2]|0)>>>0);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+2|0}}b=a;return}function xt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,4);g[t>>2]=+((f[i>>2]|0)>>>0);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function Tt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Mn(e,i);f[t>>2]=f[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function St(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Tn(e,i);g[t>>2]=+y[i>>3];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+8|0}}b=a;return}function Mt(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0;h=b;b=b+32|0;o=h+8|0;l=h+20|0;if((f[e+8>>2]|0)==16)e=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else e=f[e+12>>2]|0;c=f[e+5584>>2]|0;e=f[n>>2]|0;if(!e){Qn(i,1,14224,h)|0;t=0;b=h;return t|0}f[n>>2]=e+-1;wn(r,l,1);r=r+1|0;a=f[l>>2]&31;s=c+(t*1080|0)+24|0;f[s>>2]=a;f[c+(t*1080|0)+804>>2]=(f[l>>2]|0)>>>5;do{if((a|0)==1){e=1;u=8}else{e=(f[n>>2]|0)>>>((a|0)!=0&1);if(e>>>0>97){f[o>>2]=e;f[o+4>>2]=97;f[o+8>>2]=97;Qn(i,2,14260,o)|0;a=f[s>>2]|0}i=(e|0)==0;if(a)if(i){e=0;u=20;break}else{u=8;break}if(!i){a=0;while(1){wn(r,l,1);if(a>>>0<97){f[c+(t*1080|0)+28+(a<<3)>>2]=(f[l>>2]|0)>>>3;f[c+(t*1080|0)+28+(a<<3)+4>>2]=0}a=a+1|0;if((a|0)==(e|0))break;else r=r+1|0}}e=(f[n>>2]|0)-e|0}}while(0);if((u|0)==8){a=0;while(1){wn(r,l,2);if(a>>>0<97){f[c+(t*1080|0)+28+(a<<3)>>2]=(f[l>>2]|0)>>>11;f[c+(t*1080|0)+28+(a<<3)+4>>2]=f[l>>2]&2047}a=a+1|0;if((a|0)==(e|0)){u=20;break}else r=r+2|0}}if((u|0)==20)e=(f[n>>2]|0)-(e<<1)|0;f[n>>2]=e;if((f[s>>2]|0)!=1){t=1;b=h;return t|0}e=c+(t*1080|0)+28|0;r=c+(t*1080|0)+32|0;a=1;do{n=(f[e>>2]|0)-(((a+-1|0)>>>0)/3|0)|0;f[c+(t*1080|0)+28+(a<<3)>>2]=(n|0)>0?n:0;f[c+(t*1080|0)+28+(a<<3)+4>>2]=f[r>>2];a=a+1|0}while((a|0)!=97);e=1;b=h;return e|0}function Rt(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0;v=b;b=b+48|0;p=v+40|0;u=v+32|0;l=v+16|0;s=v+8|0;d=v+44|0;o=e+8|0;if((f[o>>2]|0)==16)a=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else a=f[e+12>>2]|0;c=f[a+5584>>2]|0;if((f[n>>2]|0)>>>0<5){Qn(i,1,14664,v)|0;n=0;b=v;return n|0}h=c+(t*1080|0)+4|0;wn(r,h,1);a=(f[h>>2]|0)+1|0;f[h>>2]=a;if(a>>>0>33){f[s>>2]=a;f[s+4>>2]=33;Qn(i,1,14699,s)|0;n=0;b=v;return n|0}if((f[e+168>>2]|0)>>>0>=a>>>0){f[l>>2]=t;Qn(i,1,14776,l)|0;f[o>>2]=f[o>>2]|32768;n=0;b=v;return n|0}s=c+(t*1080|0)+8|0;wn(r+1|0,s,1);f[s>>2]=(f[s>>2]|0)+2;e=c+(t*1080|0)+12|0;wn(r+2|0,e,1);l=(f[e>>2]|0)+2|0;f[e>>2]=l;s=f[s>>2]|0;if(s>>>0>10|l>>>0>10|(s+l|0)>>>0>12){Qn(i,1,14934,v+24|0)|0;n=0;b=v;return n|0}wn(r+3|0,c+(t*1080|0)+16|0,1);wn(r+4|0,c+(t*1080|0)+20|0,1);o=(f[n>>2]|0)+-5|0;f[n>>2]=o;a=f[h>>2]|0;if(!(f[c+(t*1080|0)>>2]&1)){if(!a){n=1;b=v;return n|0}else a=0;do{f[c+(t*1080|0)+812+(a<<2)>>2]=15;f[c+(t*1080|0)+944+(a<<2)>>2]=15;a=a+1|0}while(a>>>0<(f[h>>2]|0)>>>0);a=1;b=v;return a|0}if(o>>>0<a>>>0){Qn(i,1,14664,u)|0;n=0;b=v;return n|0}do{if(!a)a=0;else{e=0;o=r+5|0;while(1){wn(o,d,1);o=o+1|0;a=f[d>>2]|0;if((e|0)!=0?a>>>0<16|(a&15|0)==0:0)break;f[c+(t*1080|0)+812+(e<<2)>>2]=a&15;f[c+(t*1080|0)+944+(e<<2)>>2]=(f[d>>2]|0)>>>4;e=e+1|0;a=f[h>>2]|0;if(e>>>0>=a>>>0){m=22;break}}if((m|0)==22){o=f[n>>2]|0;break}Qn(i,1,15002,p)|0;n=0;b=v;return n|0}}while(0);f[n>>2]=o-a;n=1;b=v;return n|0}function At(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){En(t,~~+g[e>>2]>>>0,2);n=n+1|0;if((n|0)==(r|0))break;else{t=t+2|0;e=e+4|0}}return}function kt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){En(t,~~+g[e>>2]>>>0,4);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}return}function Pt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){Sn(t,+g[e>>2]);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}return}function Ct(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){xn(t,+g[e>>2]);n=n+1|0;if((n|0)==(r|0))break;else{t=t+8|0;e=e+4|0}}return}function Lt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+16|0;if(!r){r=0;b=s;return r|0}if(!(ga(f[e>>2]|0,t,r,n)|0)){Qn(n,1,16303,s)|0;r=0;b=s;return r|0}if(f[e+128>>2]|0){r=1;b=s;return r|0}o=e+108|0;if(!(Kt(r,o,n)|0)){r=0;b=s;return r|0}t=f[e+48>>2]|0;e:do{switch(t|0){case 16:{f[r+20>>2]=1;break}case 17:{f[r+20>>2]=2;break}case 18:{f[r+20>>2]=3;break}case 24:{f[r+20>>2]=4;break}default:{i=r+20|0;if((t|0)==12){f[i>>2]=5;break e}else{f[i>>2]=-1;break e}}}}while(0);a=e+120|0;t=f[a>>2]|0;do{if(t){if(f[t+12>>2]|0){Qt(r,o);break}Qi(f[t+4>>2]|0);Qi(f[(f[a>>2]|0)+8>>2]|0);Qi(f[f[a>>2]>>2]|0);t=f[a>>2]|0;i=f[t+12>>2]|0;if(i){Qi(i);t=f[a>>2]|0}Qi(t);f[a>>2]=0}}while(0);if(f[e+116>>2]|0)$t(r,o,n);t=f[o>>2]|0;if(!t){r=1;b=s;return r|0}f[r+28>>2]=t;f[r+32>>2]=f[e+112>>2];f[o>>2]=0;r=1;b=s;return r|0}function It(e,t){e=e|0;t=t|0;ea(f[e>>2]|0,t);h[e+124>>0]=0;f[e+128>>2]=f[t+8248>>2]&1;return}function Ot(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0;w=b;b=b+80|0;E=w+64|0;g=w+56|0;h=w+48|0;v=w+40|0;m=w+32|0;p=w+24|0;if(!((e|0)!=0&(t|0)!=0&(r|0)!=0)){t=0;b=w;return t|0}y=r+16|0;if(((f[y>>2]|0)+-1|0)>>>0>16383){Qn(n,1,16352,w)|0;t=0;b=w;return t|0}if(!(na(f[e>>2]|0,t,r,n)|0)){t=0;b=w;return t|0}f[e+56>>2]=1785737760;f[e+60>>2]=0;f[e+64>>2]=1;i=Yi(4)|0;a=e+68|0;f[a>>2]=i;if(!i){f[a>>2]=0;Qn(n,1,16421,w+8|0)|0;t=0;b=w;return t|0}f[i>>2]=1785737760;l=f[y>>2]|0;f[e+20>>2]=l;l=Yi(l*12|0)|0;i=e+72|0;f[i>>2]=l;if(!l){f[i>>2]=0;Qn(n,1,16421,w+16|0)|0;t=0;b=w;return t|0}f[e+16>>2]=(f[r+12>>2]|0)-(f[r+4>>2]|0);f[e+12>>2]=(f[r+8>>2]|0)-(f[r>>2]|0);_=r+24|0;u=f[_>>2]|0;o=f[u+24>>2]|0;s=f[u+32>>2]|0;i=e+24|0;f[i>>2]=o+-1+(s<<7);c=f[y>>2]|0;if(c>>>0>1){a=1;do{if((o|0)!=(f[u+(a*52|0)+24>>2]|0))f[i>>2]=255;a=a+1|0}while(a>>>0<c>>>0)}f[e+28>>2]=7;f[e+32>>2]=0;f[e+36>>2]=0;a=(c|0)==0;if(!a?(f[l+8>>2]=o+-1+(s<<7),c>>>0>1):0){i=1;do{f[l+(i*12|0)+8>>2]=(f[u+(i*52|0)+24>>2]|0)+-1+(f[u+(i*52|0)+32>>2]<<7);i=i+1|0}while(i>>>0<c>>>0)}i=e+40|0;e:do{if(!(f[r+32>>2]|0)){f[i>>2]=1;switch(f[r+20>>2]|0){case 1:{f[e+48>>2]=16;break e}case 2:{f[e+48>>2]=17;break e}case 3:{f[e+48>>2]=18;break e}default:break e}}else{f[i>>2]=2;f[e+48>>2]=0}}while(0);e:do{if(!a){a=0;i=0;o=0;do{r=(d[u+(o*52|0)+48>>1]|0)==0;i=(r&1^1)+i|0;a=r?a:o;o=o+1|0}while(o>>>0<c>>>0);o=a;if((i|0)!=1){if(i>>>0<=1)break;Qn(n,2,16717,h)|0;break}switch(f[e+48>>2]|0){case 18:case 16:{a=3;break}case 17:{a=1;break}default:{Qn(n,2,16467,p)|0;break e}}if(c>>>0<(a+1|0)>>>0){Qn(n,2,16541,m)|0;break}if(o>>>0<a>>>0){Qn(n,2,16634,v)|0;break}v=Yi(8)|0;i=e+116|0;f[i>>2]=v;if(!v){Qn(n,1,16782,g)|0;t=0;b=w;return t|0}g=Yi((f[y>>2]|0)*6|0)|0;r=f[i>>2]|0;f[r>>2]=g;if(!g){Qn(n,1,16782,E)|0;t=0;b=w;return t|0}l=f[y>>2]|0;d[r+4>>1]=l;s=f[r>>2]|0;i=0;do{d[s+(i*6|0)>>1]=i;d[s+(i*6|0)+2>>1]=0;E=i;i=i+1|0;d[s+(E*6|0)+4>>1]=i}while((i|0)!=(a|0));if(a>>>0<l>>>0){o=f[_>>2]|0;do{E=(d[o+(a*52|0)+48>>1]|0)==0;d[s+(a*6|0)>>1]=a;i=s+(a*6|0)+2|0;if(E){d[i>>1]=-1;d[s+(a*6|0)+4>>1]=-1}else{d[i>>1]=1;d[(f[r>>2]|0)+(a*6|0)+4>>1]=0}a=a+1|0}while(a>>>0<l>>>0)}}}while(0);f[e+52>>2]=0;f[e+44>>2]=0;f[e+96>>2]=f[t+18692>>2];t=1;b=w;return t|0}function Ht(e,t,r){e=e|0;t=t|0;r=r|0;return ba(f[e>>2]|0,t,r)|0}function Dt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;n=e+8|0;if(!(_o(f[n>>2]|0,52,r)|0)){r=0;return r|0}a=f[n>>2]|0;o=bo(a)|0;n=Eo(a)|0;if(o){s=0;i=1;while(1){if(!i)i=0;else i=(ku[f[n>>2]&63](e,t,r)|0)!=0;s=s+1|0;if((s|0)==(o|0))break;else{n=n+4|0;i=i&1}}wo(a);if(!i){r=0;return r|0}}else wo(a);r=aa(f[e>>2]|0,t,r)|0;return r|0}function Nt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;n=e+8|0;if(!(_o(f[n>>2]|0,53,r)|0)){r=0;return r|0}if(!(Ea(f[e>>2]|0,t,r)|0)){r=0;return r|0}s=f[n>>2]|0;a=bo(s)|0;n=Eo(s)|0;if(!a)n=1;else{o=0;i=n;n=1;while(1){if(!n)n=0;else n=(ku[f[i>>2]&63](e,t,r)|0)!=0;n=n&1;o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}wo(s);r=n;return r|0}function Ft(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;i=e+4|0;if(!(_o(f[i>>2]|0,54,n)|0)){t=0;return t|0}o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](e,t,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){t=0;return t|0}}else wo(o);i=e+8|0;if(!(_o(f[i>>2]|0,55,n)|0)){t=0;return t|0}if(!(_o(f[i>>2]|0,56,n)|0)){t=0;return t|0}if(!(_o(f[i>>2]|0,57,n)|0)){t=0;return t|0}if((f[e+96>>2]|0)!=0?(_o(f[i>>2]|0,58,n)|0)==0:0){t=0;return t|0}if(!(_o(f[i>>2]|0,59,n)|0)){t=0;return t|0}o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](e,t,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){t=0;return t|0}}else wo(o);t=wa(f[e>>2]|0,t,r,n)|0;return t|0}function Ut(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;u=t+8|0;if(!(_o(f[u>>2]|0,52,n)|0)){e=0;return e|0}o=f[t+4>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){e=0;return e|0}}else wo(o);o=f[u>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){e=0;return e|0}}else wo(o);e=oa(e,f[t>>2]|0,r,n)|0;return e|0}function Bt(e,t,r,n,i,a,o,s,l,u,c){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;return la(f[e>>2]|0,t,r,n,i,a,o,s,l,u,c)|0}function zt(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;return xa(f[e>>2]|0,t,r,n,i,a)|0}function jt(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;return ua(f[e>>2]|0,t,r,n,i,a)|0}function Vt(e){e=e|0;var t=0,r=0,n=0;if(!e)return;ra(f[e>>2]|0);f[e>>2]=0;t=e+72|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+68|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+108|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}n=e+116|0;t=f[n>>2]|0;if(t){r=f[t>>2]|0;if(r){Qi(r);t=f[n>>2]|0;f[t>>2]=0}Qi(t);f[n>>2]=0}n=e+120|0;t=f[n>>2]|0;if(t){r=f[t+12>>2]|0;if(r){Qi(r);t=f[n>>2]|0;f[t+12>>2]=0}r=f[t+4>>2]|0;if(r){Qi(r);t=f[n>>2]|0;f[t+4>>2]=0}r=f[t+8>>2]|0;if(r){Qi(r);t=f[n>>2]|0;f[t+8>>2]=0}r=f[t>>2]|0;if(r){Qi(r);t=f[n>>2]|0;f[t>>2]=0}Qi(t);f[n>>2]=0}t=e+4|0;r=f[t>>2]|0;if(r){yo(r);f[t>>2]=0}t=e+8|0;r=f[t>>2]|0;if(r){yo(r);f[t>>2]=0}Qi(e);return}function Gt(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;return ca(f[e>>2]|0,t,r,n,i,a,o)|0}function Wt(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+16|0;if(!r){e=0;b=s;return e|0}Qn(n,2,16826,s)|0;if(!(ya(f[e>>2]|0,t,r,n,i)|0)){Qn(n,1,16303,s+8|0)|0;e=0;b=s;return e|0}o=e+108|0;if(!(Kt(r,o,n)|0)){e=0;b=s;return e|0}i=f[e+48>>2]|0;e:do{switch(i|0){case 16:{f[r+20>>2]=1;break}case 17:{f[r+20>>2]=2;break}case 18:{f[r+20>>2]=3;break}case 24:{f[r+20>>2]=4;break}default:{t=r+20|0;if((i|0)==12){f[t>>2]=5;break e}else{f[t>>2]=-1;break e}}}}while(0);a=e+120|0;t=f[a>>2]|0;do{if(t){if(f[t+12>>2]|0){Qt(r,o);break}Qi(f[t+4>>2]|0);Qi(f[(f[a>>2]|0)+8>>2]|0);Qi(f[f[a>>2]>>2]|0);t=f[a>>2]|0;i=f[t+12>>2]|0;if(i){Qi(i);t=f[a>>2]|0}Qi(t);f[a>>2]=0}}while(0);if(f[e+116>>2]|0)$t(r,o,n);t=f[o>>2]|0;if(!t){e=1;b=s;return e|0}f[r+28>>2]=t;f[r+32>>2]=f[e+112>>2];f[o>>2]=0;e=1;b=s;return e|0}function Xt(e){e=e|0;var t=0;t=qi(1,136)|0;if(!t)return t|0;if(!e){e=ta()|0;f[t>>2]=e}else{e=ha()|0;f[t>>2]=e}if(!e){Vt(t);t=0;return t|0}e=t+108|0;f[e>>2]=0;f[e+4>>2]=0;f[e+8>>2]=0;f[e+12>>2]=0;h[e+16>>0]=0;e=go()|0;f[t+4>>2]=e;if(!e){Vt(t);t=0;return t|0}e=go()|0;f[t+8>>2]=e;if(e)return t|0;Vt(t);t=0;return t|0}function Yt(e,t,r){e=e|0;t=t|0;r=r|0;da(f[e>>2]|0,t,r);return}function qt(e){e=e|0;return va(f[e>>2]|0)|0}function Zt(e){e=e|0;return ma(f[e>>2]|0)|0}function Jt(e,t,r){e=e|0;t=t|0;r=r|0;return _a(f[e>>2]|0,t,r)|0}function Kt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0;R=b;b=b+80|0;M=R+72|0;S=R+64|0;T=R+56|0;x=R+48|0;w=R+40|0;E=R+32|0;_=R+24|0;g=R+16|0;l=R+8|0;s=R;n=f[t+8>>2]|0;e:do{if(n){v=f[n>>2]|0;c=d[n+4>>1]|0;n=f[e+16>>2]|0;u=f[t+12>>2]|0;if((u|0)!=0?(f[u+12>>2]|0)!=0:0)t=p[u+18>>0]|0;else t=n;o=c<<16>>16==0;t:do{if(!o){a=0;r:while(1){i=a&65535;n=m[v+(i*6|0)>>1]|0;if(n>>>0>=t>>>0){i=15;break}n=d[v+(i*6|0)+4>>1]|0;switch(n<<16>>16){case 0:case-1:break;default:{n=(n&65535)+-1|0;if(n>>>0>=t>>>0){i=18;break r}}}a=a+1<<16>>16;if((a&65535)>=(c&65535))break t}if((i|0)==15){f[s>>2]=n;f[s+4>>2]=t;Qn(r,1,19343,s)|0;r=0;b=R;return r|0}else if((i|0)==18){f[l>>2]=n;f[l+4>>2]=t;Qn(r,1,19343,l)|0;r=0;b=R;return r|0}}}while(0);if(!t)n=u;else{t:do{if(!o)while(1){t=t+-1|0;n=0;do{if((m[v+((n&65535)*6|0)>>1]|0)==(t|0))break;n=n+1<<16>>16}while((n&65535)<(c&65535));if(n<<16>>16==c<<16>>16)break t;if(!t){n=u;break e}}}while(0);Qn(r,1,19380,g)|0;r=0;b=R;return r|0}}else n=f[t+12>>2]|0}while(0);if(!n){r=1;b=R;return r|0}y=f[n+12>>2]|0;if(!y){r=1;b=R;return r|0}u=h[n+18>>0]|0;g=u&255;v=u<<24>>24==0;if(v)n=1;else{a=e+16|0;t=0;o=0;n=1;do{t=m[y+(t<<2)>>1]|0;i=f[a>>2]|0;if(t>>>0>=i>>>0){f[_>>2]=t;f[_+4>>2]=i;Qn(r,1,19343,_)|0;n=0}o=o+1<<16>>16;t=o&65535}while(t>>>0<g>>>0)}c=qi(g,4)|0;if(!c){Qn(r,1,19413,E)|0;r=0;b=R;return r|0}if(!v){s=0;l=0;do{i=h[y+(s<<2)+3>>0]|0;a=i&255;do{if((i&255)<(u&255)){o=c+(a<<2)|0;t=h[y+(s<<2)+2>>0]|0;if((f[o>>2]|0)!=0&t<<24>>24==1){f[x>>2]=a;Qn(r,1,19486,x)|0;n=0;break}if(t<<24>>24!=0|i<<24>>24==0){f[o>>2]=1;break}else{f[T>>2]=s;f[T+4>>2]=a;Qn(r,1,19517,T)|0;n=0;break}}else{f[w>>2]=a;Qn(r,1,19430,w)|0;n=0}}while(0);l=l+1<<16>>16;s=l&65535}while(s>>>0<g>>>0);if(!v){t=0;i=0;do{if((f[c+(t<<2)>>2]|0)==0?(h[y+(t<<2)+2>>0]|0)!=0:0){f[S>>2]=t;Qn(r,1,19553,S)|0;n=0}i=i+1<<16>>16;t=i&65535}while(t>>>0<g>>>0)}}if(!n){Qi(c);r=0;b=R;return r|0}e:do{if(!((f[e+16>>2]|0)!=1|v)){n=0;t=0;while(1){t=t+1<<16>>16;if(!(f[c+(n<<2)>>2]|0))break;n=t&65535;if(n>>>0>=g>>>0)break e}f[M>>2]=n;Qn(r,2,19591,M)|0;if(!v){n=0;t=0;do{h[y+(n<<2)+2>>0]=1;h[y+(n<<2)+3>>0]=t;t=t+1<<16>>16;n=t&65535}while(n>>>0<g>>>0)}}}while(0);Qi(c);r=1;b=R;return r|0}function Qt(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0;w=t+12|0;t=f[w>>2]|0;s=f[t+8>>2]|0;u=f[t+4>>2]|0;v=f[t>>2]|0;g=f[t+12>>2]|0;t=h[t+18>>0]|0;y=e+24|0;_=f[y>>2]|0;b=t&255;E=Yi(b*52|0)|0;if(!E)return;l=t<<24>>24==0;if(!l){a=0;o=0;do{t=d[g+(a<<2)>>1]|0;if(!(h[g+(a<<2)+2>>0]|0)){t=t&65535;r=E+(a*52|0)|0;n=_+(t*52|0)|0;i=r+52|0;do{f[r>>2]=f[n>>2];r=r+4|0;n=n+4|0}while((r|0)<(i|0))}else{t=t&65535;r=E+((p[g+(a<<2)+3>>0]|0)*52|0)|0;n=_+(t*52|0)|0;i=r+52|0;do{f[r>>2]=f[n>>2];r=r+4|0;n=n+4|0}while((r|0)<(i|0))}i=Yi(ce(f[_+(t*52|0)+8>>2]<<2,f[_+(t*52|0)+12>>2]|0)|0)|0;f[E+(a*52|0)+44>>2]=i;if(!i){c=7;break}f[E+(a*52|0)+24>>2]=p[s+a>>0];f[E+(a*52|0)+32>>2]=p[u+a>>0];o=o+1<<16>>16;a=o&65535}while(a>>>0<b>>>0);if((c|0)==7){Qi(E);return}s=(m[(f[w>>2]|0)+16>>1]|0)+-1|0;if(!l){t=0;o=0;do{i=f[_+((m[g+(t<<2)>>1]|0)*52|0)+44>>2]|0;n=p[g+(t<<2)+3>>0]|0;a=ce(f[E+(n*52|0)+12>>2]|0,f[E+(n*52|0)+8>>2]|0)|0;if(!(h[g+(t<<2)+2>>0]|0)){t=f[E+(t*52|0)+44>>2]|0;if(a){r=0;do{f[t+(r<<2)>>2]=f[i+(r<<2)>>2];r=r+1|0}while((r|0)!=(a|0))}}else{t=f[E+(n*52|0)+44>>2]|0;if(a){r=0;do{c=f[i+(r<<2)>>2]|0;c=v+((ce((c|0)<0?0:(c|0)>(s|0)?s:c,b)|0)+n<<2)|0;f[t+(r<<2)>>2]=f[c>>2];r=r+1|0}while((r|0)!=(a|0))}}o=o+1<<16>>16;t=o&65535}while(t>>>0<b>>>0)}}r=e+16|0;n=f[r>>2]|0;if(n){t=0;i=0;do{t=f[_+(t*52|0)+44>>2]|0;if(t)Qi(t);i=i+1<<16>>16;t=i&65535}while(t>>>0<n>>>0)}Qi(_);f[y>>2]=E;f[r>>2]=b;Qi(f[(f[w>>2]|0)+4>>2]|0);Qi(f[(f[w>>2]|0)+8>>2]|0);Qi(f[f[w>>2]>>2]|0);t=f[w>>2]|0;r=f[t+12>>2]|0;if(r){Qi(r);t=f[w>>2]|0}Qi(t);f[w>>2]=0;return}function $t(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0;T=b;b=b+80|0;w=T+8|0;E=T;_=T+16|0;x=t+8|0;n=f[x>>2]|0;t=f[n>>2]|0;y=d[n+4>>1]|0;if(y<<16>>16){g=e+16|0;h=e+24|0;m=1;v=0;while(1){p=d[t+(v*6|0)>>1]|0;c=p&65535;e=f[g>>2]|0;e:do{if(c>>>0<e>>>0){n=d[t+(v*6|0)+4>>1]|0;switch(n<<16>>16){case-1:case 0:{d[(f[h>>2]|0)+(c*52|0)+48>>1]=d[t+(v*6|0)+2>>1]|0;break e}default:{}}s=(n&65535)+65535|0;u=s&65535;s=s&65535;if(s>>>0>=e>>>0){f[w>>2]=s;f[w+4>>2]=e;Qn(r,2,19302,w)|0;break}l=t+(v*6|0)+2|0;if((c|0)!=(s|0)?(d[l>>1]|0)==0:0){n=f[h>>2]|0;e=n+(c*52|0)|0;i=_;a=e;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));i=e;a=n+(s*52|0)|0;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));i=(f[h>>2]|0)+(s*52|0)|0;a=_;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));if((v+1&65535)<(y&65535)){i=m;do{n=t+(i*6|0)|0;e=d[n>>1]|0;if(e<<16>>16!=p<<16>>16){if(e<<16>>16==u<<16>>16)d[n>>1]=p}else d[n>>1]=u;i=i+1|0}while((i&65535)<<16>>16!=y<<16>>16)}}d[(f[h>>2]|0)+(c*52|0)+48>>1]=d[l>>1]|0}else{f[E>>2]=c;f[E+4>>2]=e;Qn(r,2,19262,E)|0}}while(0);v=v+1|0;if((v&65535)<<16>>16==y<<16>>16)break;else m=m+1|0}t=f[x>>2]|0;n=t;t=f[t>>2]|0}if(!t){w=n;Qi(w);f[x>>2]=0;b=T;return}else{Qi(t);w=f[x>>2]|0;Qi(w);f[x>>2]=0;b=T;return}}function er(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0;I=b;b=b+192|0;T=I+152|0;x=I+144|0;w=I+136|0;E=I+128|0;_=I+120|0;k=I+88|0;g=I+80|0;m=I+64|0;p=I+48|0;C=I+40|0;S=I+32|0;P=I+24|0;y=I+16|0;v=I+8|0;h=I+176|0;d=I+168|0;A=I+156|0;n=qi(1,1024)|0;if(!n){Qn(r,1,17098,I)|0;L=0;b=I;return L|0}c=h+4|0;M=A+4|0;R=e+100|0;u=1024;e:while(1){if((Gn(t,h,8,r)|0)!=8)break;while(1){wn(h,A,4);wn(c,M,4);switch(f[A>>2]|0){case 0:{i=qn(t)|0;l=B;if((l|0)>0|(l|0)==0&i>>>0>4294967287){L=6;break e}f[A>>2]=i+8;s=8;break}case 1:{if((Gn(t,h,8,r)|0)!=8)break e;wn(h,d,4);if(f[d>>2]|0){L=10;break e}wn(c,A,4);s=16;break}default:s=8}a=f[M>>2]|0;if((a|0)==1785737827){L=13;break e}i=f[A>>2]|0;if(!i){L=17;break e}if(i>>>0<s>>>0){L=19;break e}if((a|0)==1783636e3){o=1084;a=s;L=22;break}if((a|0)==1718909296){o=1092;a=s;L=22;break}l=(a|0)==1785737832;t:do{if((a|0)!=1768449138)if((a|0)!=1668246642)if((a|0)!=1651532643)if((a|0)!=1885564018)if((a|0)!=1668112752){o=(a|0)==1667523942?1148:0;i=i-s|0;if((a|0)<1785737832)switch(a|0){case 1667523942:{L=30;break t}default:{}}else switch(a|0){case 1785737832:{L=30;break t}default:{}}a=f[R>>2]|0;if(!(a&1)){L=45;break e}if(!(a&2)){L=47;break e}f[R>>2]=a|2147483647;l=Zn(t,i,0,r)|0;if(!((l|0)==(i|0)&(B|0)==0)){L=50;break e}}else{o=1140;L=28}else{o=1132;L=28}else{o=1124;L=28}else{o=1116;L=28}else{o=1108;L=28}}while(0);if((L|0)==28){i=i-s|0;L=30}if((L|0)==30){L=0;if(l){o=1100;break}f[p>>2]=a>>>24;f[p+4>>2]=a>>>16&255;f[p+8>>2]=a>>>8&255;f[p+12>>2]=a&255;Qn(r,2,17282,p)|0;if(f[R>>2]&4)break;l=f[M>>2]|0;f[m>>2]=l>>>24;f[m+4>>2]=l>>>16&255;f[m+8>>2]=l>>>8&255;f[m+12>>2]=l&255;Qn(r,2,17333,m)|0;f[R>>2]=f[R>>2]|2147483647;l=Zn(t,i,0,r)|0;if(!((l|0)==(i|0)&(B|0)==0)){L=33;break e}}if((Gn(t,h,8,r)|0)!=8)break e}if((L|0)==22){L=0;i=i-a|0}l=qn(t)|0;s=B;if(0>(s|0)|0==(s|0)&i>>>0>l>>>0){L=35;break}if(i>>>0>u>>>0){a=Ki(n,i)|0;if(!a){L=38;break}else{n=a;a=i}}else a=u;if((Gn(t,n,i,r)|0)!=(i|0)){L=40;break}if(!(Nu[f[o+4>>2]&63](e,n,i,r)|0)){L=43;break}else u=a}switch(L|0){case 6:{Qn(r,1,17148,v)|0;break}case 10:{Qn(r,1,17148,y)|0;break}case 13:{i=f[R>>2]|0;if(!(i&4)){Qn(r,1,17190,P)|0;Qi(n);L=0;b=I;return L|0}else{f[R>>2]=i|8;Qi(n);L=1;b=I;return L|0}}case 17:{Qn(r,1,17218,S)|0;Qi(n);L=0;b=I;return L|0}case 19:{f[C>>2]=i;f[C+4>>2]=a;Qn(r,1,17256,C)|0;Qi(n);L=0;b=I;return L|0}case 33:{Qn(r,1,17399,g)|0;Qi(n);L=0;b=I;return L|0}case 35:{P=f[A>>2]|0;C=f[M>>2]|0;L=qn(t)|0;f[k>>2]=P;f[k+4>>2]=C>>>24;f[k+8>>2]=C>>>16&255;f[k+12>>2]=C>>>8&255;f[k+16>>2]=C&255;f[k+20>>2]=i;f[k+24>>2]=L;Qn(r,1,17449,k)|0;Qi(n);L=0;b=I;return L|0}case 38:{Qi(n);Qn(r,1,17525,_)|0;L=0;b=I;return L|0}case 40:{Qn(r,1,17567,E)|0;Qi(n);L=0;b=I;return L|0}case 43:{Qi(n);L=0;b=I;return L|0}case 45:{Qn(r,1,17616,w)|0;Qi(n);L=0;b=I;return L|0}case 47:{Qn(r,1,17686,x)|0;Qi(n);L=0;b=I;return L|0}case 50:{Qn(r,1,17399,T)|0;Qi(n);L=0;b=I;return L|0}}Qi(n);L=1;b=I;return L|0}function tr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;o=b;b=b+32|0;a=o+24|0;n=Yn(t)|0;i=B;e=e+80|0;s=e;s=zl(n|0,i|0,f[s>>2]|0,f[s+4>>2]|0)|0;En(a,s,4);En(a+4|0,1785737827,4);if(!(Jn(t,f[e>>2]|0,f[e+4>>2]|0,r)|0)){Qn(r,1,17067,o)|0;s=0;b=o;return s|0}if((Wn(t,a,8,r)|0)!=8){Qn(r,1,17067,o+8|0)|0;s=0;b=o;return s|0}if(Jn(t,n,i,r)|0){s=1;b=o;return s|0}Qn(r,1,17067,o+16|0)|0;s=0;b=o;return s|0}function rr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;r=((f[e>>2]|0)!=0?(f[e+104>>2]|f[e+100>>2]|0)==0:0)&(f[e+8>>2]|0)!=0&(f[e+4>>2]|0)!=0&(f[e+64>>2]|0)!=0&(f[e+16>>2]|0)!=0&(f[e+12>>2]|0)!=0&1;n=f[e+20>>2]|0;if(!n){a=r;e=e+40|0;e=f[e>>2]|0;e=e+-1|0;e=e>>>0<2;e=e&1;t=Kn(t)|0;t=t&a;e=t&e;return e|0}i=f[e+72>>2]|0;a=0;do{r=(f[i+(a*12|0)+8>>2]&126)>>>0<38&r;a=a+1|0}while(a>>>0<n>>>0);e=e+40|0;e=f[e>>2]|0;e=e+-1|0;e=e>>>0<2;e=e&1;t=Kn(t)|0;t=t&r;e=t&e;return e|0}function nr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;e=b;b=b+16|0;n=e;En(n,12,4);En(n+4|0,1783636e3,4);En(n+8|0,218793738,4);r=(Wn(t,n,12,r)|0)==12&1;b=e;return r|0}function ir(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;l=u+8|0;i=e+64|0;o=(f[i>>2]<<2)+16|0;s=qi(1,o)|0;if(!s){Qn(r,1,16987,u)|0;l=0;b=u;return l|0}En(s,o,4);En(s+4|0,1718909296,4);En(s+8|0,f[e+56>>2]|0,4);En(s+12|0,f[e+60>>2]|0,4);a=s+16|0;if(f[i>>2]|0){e=e+68|0;n=0;do{En(a,f[(f[e>>2]|0)+(n<<2)>>2]|0,4);n=n+1|0}while(n>>>0<(f[i>>2]|0)>>>0)}e=(Wn(t,s,o,r)|0)==(o|0);if(!e)Qn(r,1,17026,l)|0;Qi(s);l=e&1;b=u;return l|0}function ar(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0;m=b;b=b+80|0;d=m+16|0;c=m+8|0;l=m;i=m+24|0;u=m+72|0;n=i;a=n+48|0;do{f[n>>2]=0;n=n+4|0}while((n|0)<(a|0));p=(f[e+24>>2]|0)==255;f[i>>2]=2;n=i+12|0;if(p){f[n>>2]=3;f[i+24>>2]=4;n=3}else{f[n>>2]=4;n=2}if(!(f[e+116>>2]|0))p=n;else{f[i+(n*12|0)>>2]=5;p=n+1|0}En(u+4|0,1785737832,4);o=0;s=i;n=8;while(1){a=s+8|0;v=Fu[f[s>>2]&7](e,a)|0;f[s+4>>2]=v;if(!v){h=8;break}n=(f[a>>2]|0)+n|0;o=o+1|0;if((o|0)>=(p|0))break;else s=s+12|0}if((h|0)==8){Qn(r,1,16901,l)|0;a=0;while(1){n=f[i+4>>2]|0;if(n)Qi(n);a=a+1|0;if((a|0)>=(p|0)){n=0;break}else i=i+12|0}b=m;return n|0}En(u,n,4);e:do{if((Wn(t,u,8,r)|0)==8){n=0;a=i;while(1){v=a+8|0;h=Wn(t,f[a+4>>2]|0,f[v>>2]|0,r)|0;if((h|0)!=(f[v>>2]|0))break;n=n+1|0;if((n|0)>=(p|0)){n=1;break e}else a=a+12|0}Qn(r,1,16944,d)|0;n=0}else{Qn(r,1,16944,c)|0;n=0}}while(0);o=0;while(1){a=f[i+4>>2]|0;if(a)Qi(a);o=o+1|0;if((o|0)>=(p|0))break;else i=i+12|0}b=m;return n|0}function or(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=Yn(t)|0;e=e+88|0;f[e>>2]=n;f[e+4>>2]=B;t=Zn(t,24,0,r)|0;return(t|0)==24&(B|0)==0&1|0}function sr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=Yn(t)|0;e=e+80|0;f[e>>2]=n;f[e+4>>2]=B;t=Zn(t,8,0,r)|0;return(t|0)==8&(B|0)==0&1|0}function lr(e,t){e=e|0;t=t|0;var r=0;r=qi(1,22)|0;if(!r){t=0;return t|0}En(r,22,4);En(r+4|0,1768449138,4);En(r+8|0,f[e+16>>2]|0,4);En(r+12|0,f[e+12>>2]|0,4);En(r+16|0,f[e+20>>2]|0,2);En(r+18|0,f[e+24>>2]|0,1);En(r+19|0,f[e+28>>2]|0,1);En(r+20|0,f[e+32>>2]|0,1);En(r+21|0,f[e+36>>2]|0,1);f[t>>2]=22;t=r;return t|0}function ur(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0;i=e+20|0;a=(f[i>>2]|0)+8|0;o=qi(1,a)|0;if(!o){t=0;return t|0}En(o,a,4);En(o+4|0,1651532643,4);if(f[i>>2]|0){e=e+72|0;r=0;n=o+8|0;while(1){En(n,f[(f[e>>2]|0)+(r*12|0)+8>>2]|0,1);r=r+1|0;if(r>>>0>=(f[i>>2]|0)>>>0)break;else n=n+1|0}}f[t>>2]=a;t=o;return t|0}function cr(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0;r=e+40|0;switch(f[r>>2]|0){case 1:{s=15;break}case 2:{s=(f[e+112>>2]|0)+11|0;break}default:{t=0;return t|0}}o=qi(1,s)|0;if(!o){t=0;return t|0}En(o,s,4);En(o+4|0,1668246642,4);En(o+8|0,f[r>>2]|0,1);En(o+9|0,f[e+52>>2]|0,1);En(o+10|0,f[e+44>>2]|0,1);i=o+11|0;switch(f[r>>2]|0){case 1:{En(i,f[e+48>>2]|0,4);break}case 2:{a=e+112|0;if(f[a>>2]|0){e=e+108|0;n=0;r=i;while(1){En(r,p[(f[e>>2]|0)+n>>0]|0,1);n=n+1|0;if(n>>>0>=(f[a>>2]|0)>>>0)break;else r=r+1|0}}break}default:{}}f[t>>2]=s;t=o;return t|0}function hr(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0;a=e+116|0;o=((m[(f[a>>2]|0)+4>>1]|0)*6|0)+10|0;s=Yi(o)|0;if(!s){t=0;return t|0}En(s,o,4);En(s+4|0,1667523942,4);En(s+8|0,m[(f[a>>2]|0)+4>>1]|0,2);e=f[a>>2]|0;if(d[e+4>>1]|0){n=0;r=0;i=s+10|0;while(1){En(i,m[(f[e>>2]|0)+(n*6|0)>>1]|0,2);En(i+2|0,m[(f[f[a>>2]>>2]|0)+(n*6|0)+2>>1]|0,2);En(i+4|0,m[(f[f[a>>2]>>2]|0)+(n*6|0)+4>>1]|0,2);r=r+1<<16>>16;e=f[a>>2]|0;if((r&65535)>=(m[e+4>>1]|0))break;else{n=r&65535;i=i+6|0}}}f[t>>2]=o;t=s;return t|0}function dr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;a=b;b=b+32|0;i=a+16|0;if((r|0)!=14){Qn(n,1,18507,a)|0;i=0;b=a;return i|0}wn(t,e+16|0,4);wn(t+4|0,e+12|0,4);r=e+20|0;wn(t+8|0,r,2);r=qi(f[r>>2]|0,12)|0;f[e+72>>2]=r;if(!r){Qn(n,1,18540,a+8|0)|0;i=0;b=a;return i|0}wn(t+10|0,e+24|0,1);r=e+28|0;wn(t+11|0,r,1);r=f[r>>2]|0;if((r|0)!=7){f[i>>2]=r;Qn(n,4,18589,i)|0}wn(t+12|0,e+32|0,1);wn(t+13|0,e+36|0,1);i=1;b=a;return i|0}function fr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0;x=b;b=b+80|0;o=x+40|0;y=x+32|0;l=x+24|0;s=x+16|0;_=x+72|0;g=x+68|0;p=x+64|0;m=x+60|0;c=x+56|0;v=x+52|0;d=x+48|0;u=x+44|0;if(r>>>0<3){Qn(n,1,18180,x)|0;w=0;b=x;return w|0}E=e+108|0;w=e+124|0;if(h[w>>0]|0){Qn(n,4,18212,x+8|0)|0;w=1;b=x;return w|0}a=e+40|0;wn(t,a,1);wn(t+1|0,e+52|0,1);wn(t+2|0,e+44|0,1);i=t+3|0;a=f[a>>2]|0;switch(a|0){case 1:{if(r>>>0<7){f[s>>2]=r;Qn(n,1,18321,s)|0;w=0;b=x;return w|0}a=e+48|0;if(r>>>0>7?(f[a>>2]|0)!=14:0){f[l>>2]=r;Qn(n,2,18321,l)|0}wn(i,a,4);if((f[a>>2]|0)==14){i=Yi(36)|0;f[i>>2]=14;f[d>>2]=0;f[c>>2]=0;f[p>>2]=0;f[v>>2]=0;f[m>>2]=0;f[g>>2]=0;f[u>>2]=4470064;a=i+4|0;f[a>>2]=1145390592;switch(r|0){case 35:{wn(t+7|0,g,4);wn(t+11|0,p,4);wn(t+15|0,m,4);wn(t+19|0,c,4);wn(t+23|0,v,4);wn(t+27|0,d,4);wn(t+31|0,u,4);f[a>>2]=0;break}case 7:break;default:{f[y>>2]=r;Qn(n,2,18357,y)|0}}f[i+8>>2]=f[g>>2];f[i+16>>2]=f[m>>2];f[i+24>>2]=f[v>>2];f[i+12>>2]=f[p>>2];f[i+20>>2]=f[c>>2];f[i+28>>2]=f[d>>2];f[i+32>>2]=f[u>>2];f[E>>2]=i;f[e+112>>2]=0}h[w>>0]=1;w=1;b=x;return w|0}case 2:{o=r+-3|0;a=e+112|0;f[a>>2]=o;e=qi(1,o)|0;f[E>>2]=e;if(!e){f[a>>2]=0;w=0;b=x;return w|0}if((r|0)>3){a=0;while(1){wn(i,_,1);h[(f[E>>2]|0)+a>>0]=f[_>>2];a=a+1|0;if((a|0)==(o|0))break;else i=i+1|0}}h[w>>0]=1;w=1;b=x;return w|0}default:{if(a>>>0<=2){w=1;b=x;return w|0}f[o>>2]=a;Qn(n,4,18401,o)|0;w=1;b=x;return w|0}}return 0}function pr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+16|0;a=s;i=f[e+24>>2]|0;if((i|0)!=255){f[a>>2]=i;Qn(n,2,18034,a)|0}o=e+20|0;if((f[o>>2]|0)!=(r|0)){Qn(n,1,18148,s+8|0)|0;o=0;b=s;return o|0}if(!r){o=1;b=s;return o|0}a=e+72|0;i=0;while(1){wn(t,(f[a>>2]|0)+(i*12|0)+8|0,1);i=i+1|0;if(i>>>0>=(f[o>>2]|0)>>>0){t=1;break}else t=t+1|0}b=s;return t|0}function mr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,m=0,v=0;v=b;b=b+16|0;i=v;m=v+12|0;a=e+120|0;if(r>>>0<3|(f[a>>2]|0)!=0){r=0;b=v;return r|0}wn(t,m,2);o=f[m>>2]|0;c=o&65535;if((c+-1|0)>>>0>1023){f[i>>2]=c;Qn(n,1,17951,i)|0;r=0;b=v;return r|0}wn(t+2|0,m,1);u=f[m>>2]&65535;if(!u){Qn(n,1,17989,v+8|0)|0;r=0;b=v;return r|0}if((u+3|0)>>>0>r>>>0){r=0;b=v;return r|0}i=Yi(ce(c<<2,u)|0)|0;if(!i){r=0;b=v;return r|0}l=Yi(u)|0;if(!l){Qi(i);r=0;b=v;return r|0}s=Yi(u)|0;if(!s){Qi(i);Qi(l);r=0;b=v;return r|0}e=Yi(20)|0;if(!e){Qi(i);Qi(l);Qi(s);r=0;b=v;return r|0}f[e+4>>2]=s;f[e+8>>2]=l;f[e>>2]=i;d[e+16>>1]=o;h[e+18>>0]=f[m>>2];f[e+12>>2]=0;f[a>>2]=e;e=t+3|0;n=0;a=0;do{wn(e,m,1);e=e+1|0;h[l+n>>0]=(f[m>>2]&127)+1;h[s+n>>0]=(f[m>>2]|0)>>>7&1;a=a+1<<16>>16;n=a&65535}while(n>>>0<u>>>0);if(!c){r=1;b=v;return r|0}n=0;e:while(1){o=0;a=i;s=0;while(1){i=((p[l+o>>0]|0)+7|0)>>>3;i=i>>>0>4?4:i;if((e-t+i|0)>(r|0)){e=0;i=22;break e}wn(e,m,i);e=e+i|0;f[a>>2]=f[m>>2];i=a+4|0;s=s+1<<16>>16;o=s&65535;if(o>>>0>=u>>>0)break;else a=i}n=n+1<<16>>16;if((n&65535)>>>0>=c>>>0){e=1;i=22;break}}if((i|0)==22){b=v;return e|0}return 0}function vr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;o=s+20|0;a=e+120|0;e=f[a>>2]|0;if(!e){Qn(n,1,17841,s)|0;o=0;b=s;return o|0}if(f[e+12>>2]|0){Qn(n,1,17887,s+8|0)|0;o=0;b=s;return o|0}i=h[e+18>>0]|0;e=(i&255)<<2;if(e>>>0>r>>>0){Qn(n,1,17918,s+16|0)|0;o=0;b=s;return o|0}n=Yi(e)|0;if(!n){o=0;b=s;return o|0}if(i<<24>>24){e=t;r=0;while(1){wn(e,o,2);d[n+(r<<2)>>1]=f[o>>2];wn(e+2|0,o,1);h[n+(r<<2)+2>>0]=f[o>>2];wn(e+3|0,o,1);h[n+(r<<2)+3>>0]=f[o>>2];r=r+1|0;if((r&255)<<24>>24==i<<24>>24)break;else e=e+4|0}}f[(f[a>>2]|0)+12>>2]=n;o=1;b=s;return o|0}function gr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;o=s+20|0;a=e+116|0;if(f[a>>2]|0){o=0;b=s;return o|0}if(r>>>0<2){Qn(n,1,17747,s)|0;o=0;b=s;return o|0}wn(t,o,2);e=f[o>>2]|0;i=e&65535;if(!i){Qn(n,1,17780,s+8|0)|0;o=0;b=s;return o|0}if(((i*6|0)+2|0)>>>0>r>>>0){Qn(n,1,17747,s+16|0)|0;o=0;b=s;return o|0}r=Yi(e*6|0)|0;if(!r){o=0;b=s;return o|0}e=Yi(8)|0;f[a>>2]=e;if(!e){Qi(r);o=0;b=s;return o|0}f[e>>2]=r;n=f[o>>2]&65535;d[e+4>>1]=n;if(!(n<<16>>16)){o=1;b=s;return o|0}else{i=0;e=t}do{t=i&65535;wn(e+2|0,o,2);d[r+(t*6|0)>>1]=f[o>>2];wn(e+4|0,o,2);e=e+6|0;d[r+(t*6|0)+2>>1]=f[o>>2];wn(e,o,2);d[r+(t*6|0)+4>>1]=f[o>>2];i=i+1<<16>>16}while((i&65535)<(m[(f[a>>2]|0)+4>>1]|0));e=1;b=s;return e|0}function yr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;a=b;b=b+32|0;i=a+20|0;e=e+100|0;if(f[e>>2]|0){Qn(n,1,19130,a)|0;n=0;b=a;return n|0}if((r|0)!=4){Qn(n,1,19184,a+8|0)|0;n=0;b=a;return n|0}wn(t,i,4);if((f[i>>2]|0)==218793738){f[e>>2]=f[e>>2]|1;n=1;b=a;return n|0}else{Qn(n,1,19218,a+16|0)|0;n=0;b=a;return n|0}return 0}function _r(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;a=s+24|0;o=e+100|0;if((f[o>>2]|0)!=1){Qn(n,1,19011,s)|0;o=0;b=s;return o|0}if(r>>>0<8){Qn(n,1,19061,s+8|0)|0;o=0;b=s;return o|0}wn(t,e+56|0,4);wn(t+4|0,e+60|0,4);t=t+8|0;r=r+-8|0;if(r&3){Qn(n,1,19061,s+16|0)|0;o=0;b=s;return o|0}r=r>>>2;i=e+64|0;f[i>>2]=r;if(r){r=qi(r,4)|0;f[e+68>>2]=r;if(!r){Qn(n,1,19097,a)|0;o=0;b=s;return o|0}if(f[i>>2]|0){e=e+68|0;r=0;while(1){wn(t,(f[e>>2]|0)+(r<<2)|0,4);r=r+1|0;if(r>>>0>=(f[i>>2]|0)>>>0)break;else t=t+4|0}}}f[o>>2]=f[o>>2]|2;o=1;b=s;return o|0}function br(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0;M=b;b=b+96|0;T=M+72|0;g=M+64|0;v=M+56|0;m=M+48|0;w=M+40|0;E=M+32|0;_=M+24|0;y=M+16|0;p=M+8|0;h=M+80|0;d=M+76|0;x=e+100|0;if(!(f[x>>2]&2)){Qn(n,1,18679,M)|0;S=0;b=M;return S|0}c=e+104|0;f[c>>2]=0;do{if(r){l=t;t=0;e:while(1){if(r>>>0<8){S=6;break}wn(l,h,4);i=f[h>>2]|0;wn(l+4|0,h,4);s=f[h>>2]|0;switch(i|0){case 0:{S=14;break e}case 1:{if(r>>>0<16){S=9;break e}wn(l+8|0,d,4);if(f[d>>2]|0){S=11;break e}wn(l+12|0,h,4);i=f[h>>2]|0;if(!i){S=13;break e}else a=16;break}default:a=8}if(i>>>0<a>>>0){S=16;break}if(r>>>0<i>>>0){S=19;break}o=(s|0)==1768449138;if(!o)if((s|0)!=1668246642)if((s|0)!=1651532643)if((s|0)!=1885564018)if((s|0)!=1668112752)if((s|0)==1667523942){u=1148;S=26}else f[c>>2]=f[c>>2]|2147483647;else{u=1140;S=26}else{u=1132;S=26}else{u=1124;S=26}else{u=1116;S=26}else{u=1108;S=26}if((S|0)==26?(S=0,(Nu[f[u+4>>2]&63](e,l+a|0,i-a|0,n)|0)==0):0){t=0;S=32;break}t=o?1:t;if((r|0)==(i|0)){S=29;break}else{l=l+i|0;r=r-i|0}}if((S|0)==6)Qn(n,1,18724,p)|0;else if((S|0)==9)Qn(n,1,18764,y)|0;else if((S|0)==11)Qn(n,1,17148,_)|0;else if((S|0)==13)Qn(n,1,17218,E)|0;else if((S|0)==14)Qn(n,1,17218,w)|0;else if((S|0)==16)Qn(n,1,18808,m)|0;else if((S|0)==19){Qn(n,1,18880,g)|0;S=0;b=M;return S|0}else if((S|0)==29){if(!t)break;f[x>>2]=f[x>>2]|4;S=1;b=M;return S|0}else if((S|0)==32){b=M;return t|0}Qn(n,1,18837,v)|0;S=0;b=M;return S|0}}while(0);Qn(n,1,18952,T)|0;S=0;b=M;return S|0}function Er(){return 8}function wr(){return 32}function xr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!n)return;else i=0;do{c=e+(i<<2)|0;s=f[c>>2]|0;l=t+(i<<2)|0;o=f[l>>2]|0;a=r+(i<<2)|0;u=f[a>>2]|0;f[c>>2]=(o<<1)+s+u>>2;f[l>>2]=u-o;f[a>>2]=s-o;i=i+1|0}while((i|0)!=(n|0));return}function Tr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!n)return;else i=0;do{u=e+(i<<2)|0;l=t+(i<<2)|0;o=f[l>>2]|0;a=r+(i<<2)|0;c=f[a>>2]|0;s=(f[u>>2]|0)-(c+o>>2)|0;f[u>>2]=s+c;f[l>>2]=s;f[a>>2]=s+o;i=i+1|0}while((i|0)!=(n|0));return}function Sr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0;if(!n)return;else i=0;do{p=e+(i<<2)|0;b=f[p>>2]|0;u=t+(i<<2)|0;_=f[u>>2]|0;a=r+(i<<2)|0;y=f[a>>2]|0;l=((b|0)<0)<<31>>31;v=Ql(b|0,l|0,2449,0)|0;v=Wl(v|0,B|0,4096,0)|0;v=Xl(v|0,B|0,13)|0;s=((_|0)<0)<<31>>31;g=Ql(_|0,s|0,4809,0)|0;g=Wl(g|0,B|0,4096,0)|0;g=Xl(g|0,B|0,13)|0;o=((y|0)<0)<<31>>31;m=Ql(y|0,o|0,934,0)|0;m=Wl(m|0,B|0,4096,0)|0;m=Xl(m|0,B|0,13)|0;c=Ql(b|0,l|0,1382,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=Ql(_|0,s|0,2714,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=Xl(h|0,B|0,13)|0;d=Gl(y|0,o|0,12)|0;d=Wl(d|0,B|0,4096,0)|0;d=Xl(d|0,B|0,13)|0;l=Gl(b|0,l|0,12)|0;l=Wl(l|0,B|0,4096,0)|0;l=Xl(l|0,B|0,13)|0;s=Ql(_|0,s|0,3430,0)|0;s=Wl(s|0,B|0,4096,0)|0;s=Xl(s|0,B|0,13)|0;o=Ql(y|0,o|0,666,0)|0;o=Wl(o|0,B|0,4096,0)|0;o=Xl(o|0,B|0,13)|0;f[p>>2]=g+v+m;f[u>>2]=d-(h+c);f[a>>2]=l-s-o;i=i+1|0}while((i|0)!=(n|0));return}function Mr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0.0,s=0.0,l=0,u=0.0,c=0;if(!n)return;else i=0;do{c=e+(i<<2)|0;s=+g[c>>2];l=t+(i<<2)|0;o=+g[l>>2];a=r+(i<<2)|0;u=+g[a>>2];g[c>>2]=s+u*1.4019999504089355;g[l>>2]=s-o*.3441300094127655-u*.714139997959137;g[a>>2]=s+o*1.7719999551773071;i=i+1|0}while((i|0)!=(n|0));return}function Rr(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;a=ce(n,n)|0;d=Yi(a+n<<2)|0;if(!d){n=0;return n|0}if(a){o=0;i=e;while(1){f[d+(o+n<<2)>>2]=~~(+g[i>>2]*8192.0);o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}if(t){c=(n|0)==0;h=0;do{if(!c){i=0;do{f[d+(i<<2)>>2]=f[f[r+(i<<2)>>2]>>2];i=i+1|0}while((i|0)!=(n|0));if(!c){e=0;l=d;do{l=l+(n<<2)|0;a=r+(e<<2)|0;i=f[a>>2]|0;f[i>>2]=0;o=0;s=0;u=l;while(1){p=f[u>>2]|0;m=f[d+(s<<2)>>2]|0;p=Ql(m|0,((m|0)<0)<<31>>31|0,p|0,((p|0)<0)<<31>>31|0)|0;p=Wl(p|0,B|0,4096,0)|0;p=Xl(p|0,B|0,13)|0;o=p+o|0;f[i>>2]=o;s=s+1|0;if((s|0)==(n|0))break;else u=u+4|0}f[a>>2]=i+4;e=e+1|0}while((e|0)!=(n|0))}}h=h+1|0}while((h|0)!=(t|0))}Qi(d);m=1;return m|0}function Ar(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;c=Yi(n<<3)|0;if(!c){n=0;return n|0}if(t){h=(n|0)==0;d=0;do{if(!h){i=0;do{f[c+(i<<2)>>2]=f[f[r+(i<<2)>>2]>>2];i=i+1|0}while((i|0)!=(n|0));if(!h){l=0;u=e;while(1){i=c+(l+n<<2)|0;g[i>>2]=0.0;a=0.0;o=0;s=u;while(1){a=a+ +g[s>>2]*+g[c+(o<<2)>>2];g[i>>2]=a;o=o+1|0;if((o|0)==(n|0))break;else s=s+4|0}o=r+(l<<2)|0;s=f[o>>2]|0;f[o>>2]=s+4;g[s>>2]=a;l=l+1|0;if((l|0)==(n|0))break;else u=u+(n<<2)|0}}}d=d+1|0}while((d|0)!=(t|0))}Qi(c);n=1;return n|0}function kr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0.0,i=0,a=0,o=0,s=0,l=0.0;if(!t)return;else s=0;do{o=e+(s<<3)|0;y[o>>3]=0.0;n=0.0;i=0;a=s;while(1){l=+g[r+(a<<2)>>2];n=n+l*l;i=i+1|0;if((i|0)==(t|0))break;else a=a+t|0}l=+Q(+n);y[o>>3]=l;s=s+1|0}while((s|0)!=(t|0));return}function Pr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0;C=b;b=b+32|0;R=C+28|0;w=C+24|0;x=C+20|0;T=C+16|0;S=C+12|0;M=C+8|0;s=C+4|0;l=C;n=t+76|0;k=f[n>>2]|0;A=k+(r*5640|0)+420|0;P=(f[A>>2]|0)+1|0;u=e+16|0;E=Yi((f[u>>2]|0)*528|0)|0;if(!E){P=0;b=C;return P|0}_=Yi(f[u>>2]<<2)|0;if(!_){Qi(E);P=0;b=C;return P|0}n=Dr(e,f[n>>2]|0,r)|0;if(!n){Qi(E);Qi(_);P=0;b=C;return P|0}i=f[u>>2]|0;if(i){a=0;o=E;while(1){f[_+(a<<2)>>2]=o;a=a+1|0;if(a>>>0>=i>>>0)break;else o=o+528|0}}Nr(e,t,r,x,T,S,M,s,l,w,R,_);g=f[w>>2]|0;m=ce(f[u>>2]|0,g)|0;v=ce(f[R>>2]|0,m)|0;y=k+(r*5640|0)+8|0;p=qi(ce((f[y>>2]|0)+1|0,v)|0,2)|0;a=n+4|0;f[a>>2]=p;if(!p){Qi(E);Qi(_);i=f[a>>2]|0;if(i){Qi(i);f[a>>2]=0}if(P){e=n;c=0;while(1){u=e+196|0;i=f[u>>2]|0;if(i){t=e+192|0;a=f[t>>2]|0;if(a){l=0;while(1){o=i+12|0;s=f[o>>2]|0;if(s){Qi(s);f[o>>2]=0;a=f[t>>2]|0}l=l+1|0;if(l>>>0>=a>>>0)break;else i=i+16|0}i=f[u>>2]|0}Qi(i);f[u>>2]=0}c=c+1|0;if((c|0)==(P|0))break;else e=e+232|0}}Qi(n);P=0;b=C;return P|0}i=f[n+196>>2]|0;p=f[e+24>>2]|0;f[n+200>>2]=f[x>>2];f[n+204>>2]=f[S>>2];f[n+208>>2]=f[T>>2];f[n+212>>2]=f[M>>2];f[n+20>>2]=1;f[n+16>>2]=g;f[n+12>>2]=m;f[n+8>>2]=v;u=f[n+192>>2]|0;if(u){e=0;t=p;while(1){o=f[i+12>>2]|0;a=f[_+(e<<2)>>2]|0;f[i>>2]=f[t>>2];f[i+4>>2]=f[t+4>>2];l=f[i+8>>2]|0;if(l){s=0;while(1){f[o>>2]=f[a>>2];f[o+4>>2]=f[a+4>>2];f[o+8>>2]=f[a+8>>2];f[o+12>>2]=f[a+12>>2];s=s+1|0;if(s>>>0>=l>>>0)break;else{a=a+16|0;o=o+16|0}}}e=e+1|0;if(e>>>0>=u>>>0)break;else{i=i+16|0;t=t+52|0}}}if(P>>>0>1){u=n;d=1;do{i=f[u+428>>2]|0;f[u+432>>2]=f[x>>2];f[u+436>>2]=f[S>>2];f[u+440>>2]=f[T>>2];f[u+444>>2]=f[M>>2];f[u+252>>2]=1;f[u+248>>2]=g;f[u+244>>2]=m;f[u+240>>2]=v;e=f[u+424>>2]|0;if(e){c=0;t=p;while(1){o=f[i+12>>2]|0;a=f[_+(c<<2)>>2]|0;f[i>>2]=f[t>>2];f[i+4>>2]=f[t+4>>2];l=f[i+8>>2]|0;if(l){s=0;while(1){f[o>>2]=f[a>>2];f[o+4>>2]=f[a+4>>2];f[o+8>>2]=f[a+8>>2];f[o+12>>2]=f[a+12>>2];s=s+1|0;if(s>>>0>=l>>>0)break;else{a=a+16|0;o=o+16|0}}}c=c+1|0;if(c>>>0>=e>>>0)break;else{i=i+16|0;t=t+52|0}}}f[u+236>>2]=f[u+4>>2];u=u+232|0;d=d+1|0}while((d|0)!=(P|0))}Qi(E);Qi(_);u=f[w>>2]|0;if(!(h[k+(r*5640|0)+5636>>0]&4)){t=f[R>>2]|0;l=(f[A>>2]|0)+1|0;if(!l){P=n;b=C;return P|0}s=f[k+(r*5640|0)+4>>2]|0;i=f[y>>2]|0;a=n;o=0;while(1){f[a+80>>2]=s;f[a+40>>2]=1;f[a+44>>2]=0;f[a+48>>2]=0;f[a+64>>2]=0;f[a+68>>2]=0;f[a+56>>2]=t;f[a+60>>2]=f[a+192>>2];f[a+52>>2]=i;f[a+72>>2]=u;o=o+1|0;if((o|0)==(l|0))break;else a=a+232|0}b=C;return n|0}else{o=(f[A>>2]|0)+1|0;if(!o){P=n;b=C;return P|0}s=n;i=k+(r*5640|0)+424|0;a=0;while(1){f[s+80>>2]=f[i+36>>2];f[s+40>>2]=1;f[s+44>>2]=f[i>>2];f[s+48>>2]=f[i+4>>2];f[s+64>>2]=0;f[s+68>>2]=0;f[s+56>>2]=f[i+12>>2];f[s+60>>2]=f[i+16>>2];f[s+52>>2]=f[i+8>>2];f[s+72>>2]=u;a=a+1|0;if((a|0)==(o|0))break;else{s=s+232|0;i=i+148|0}}b=C;return n|0}return 0}function Cr(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!e)return;r=e+4|0;n=f[r>>2]|0;if(n){Qi(n);f[r>>2]=0}if(t){u=e;c=0;while(1){l=u+196|0;r=f[l>>2]|0;if(r){s=u+192|0;n=f[s>>2]|0;if(n){o=0;while(1){i=r+12|0;a=f[i>>2]|0;if(a){Qi(a);f[i>>2]=0;n=f[s>>2]|0}o=o+1|0;if(o>>>0>=n>>>0)break;else r=r+16|0}r=f[l>>2]|0}Qi(r);f[l>>2]=0}c=c+1|0;if((c|0)==(t|0))break;else u=u+232|0}}Qi(e);return}function Lr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0;N=b;b=b+32|0;L=N+28|0;C=N+24|0;R=N+20|0;A=N+16|0;k=N+12|0;P=N+8|0;I=N+4|0;O=N;H=t+76|0;x=f[H>>2]|0;D=(f[x+(r*5640|0)+420>>2]|0)+1|0;M=e+16|0;S=Yi((f[M>>2]|0)*528|0)|0;if(!S){r=0;b=N;return r|0}T=Yi(f[M>>2]<<2)|0;if(!T){Qi(S);r=0;b=N;return r|0}i=Dr(e,f[H>>2]|0,r)|0;if(!i){Qi(S);Qi(T);r=0;b=N;return r|0}a=f[M>>2]|0;if(a){o=0;s=S;while(1){f[T+(o<<2)>>2]=s;o=o+1|0;if(o>>>0>=a>>>0)break;else s=s+528|0}}Nr(e,t,r,R,A,k,P,I,O,C,L,T);_=f[C>>2]|0;E=ce(f[M>>2]|0,_)|0;w=ce(f[L>>2]|0,E)|0;h[i>>0]=(p[t+93>>0]|0)>>>3&1;y=qi(ce(f[x+(r*5640|0)+8>>2]|0,w)|0,2)|0;o=i+4|0;f[o>>2]=y;if(!y){Qi(S);Qi(T);a=f[o>>2]|0;if(a){Qi(a);f[o>>2]=0}if(D){m=i;v=0;while(1){c=m+196|0;a=f[c>>2]|0;if(a){u=m+192|0;o=f[u>>2]|0;if(o){l=0;while(1){s=a+12|0;e=f[s>>2]|0;if(e){Qi(e);f[s>>2]=0;o=f[u>>2]|0}l=l+1|0;if(l>>>0>=o>>>0)break;else a=a+16|0}a=f[c>>2]|0}Qi(a);f[c>>2]=0}v=v+1|0;if((v|0)==(D|0))break;else m=m+232|0}}Qi(i);r=0;b=N;return r|0}a=f[i+196>>2]|0;y=f[e+24>>2]|0;f[i+200>>2]=f[R>>2];f[i+204>>2]=f[k>>2];f[i+208>>2]=f[A>>2];f[i+212>>2]=f[P>>2];f[i+224>>2]=f[I>>2];f[i+228>>2]=f[O>>2];f[i+20>>2]=1;f[i+16>>2]=_;f[i+12>>2]=E;f[i+8>>2]=w;c=f[i+192>>2]|0;if(c){m=0;u=y;while(1){s=f[a+12>>2]|0;o=f[T+(m<<2)>>2]|0;f[a>>2]=f[u>>2];f[a+4>>2]=f[u+4>>2];l=f[a+8>>2]|0;if(l){e=0;while(1){f[s>>2]=f[o>>2];f[s+4>>2]=f[o+4>>2];f[s+8>>2]=f[o+8>>2];f[s+12>>2]=f[o+12>>2];e=e+1|0;if(e>>>0>=l>>>0)break;else{o=o+16|0;s=s+16|0}}}m=m+1|0;if(m>>>0>=c>>>0)break;else{a=a+16|0;u=u+52|0}}}if(D>>>0>1){c=i;g=1;do{a=f[c+428>>2]|0;f[c+432>>2]=f[R>>2];f[c+436>>2]=f[k>>2];f[c+440>>2]=f[A>>2];f[c+444>>2]=f[P>>2];f[c+456>>2]=f[I>>2];f[c+460>>2]=f[O>>2];f[c+252>>2]=1;f[c+248>>2]=_;f[c+244>>2]=E;f[c+240>>2]=w;m=f[c+424>>2]|0;if(m){v=0;u=y;while(1){s=f[a+12>>2]|0;o=f[T+(v<<2)>>2]|0;f[a>>2]=f[u>>2];f[a+4>>2]=f[u+4>>2];l=f[a+8>>2]|0;if(l){e=0;while(1){f[s>>2]=f[o>>2];f[s+4>>2]=f[o+4>>2];f[s+8>>2]=f[o+8>>2];f[s+12>>2]=f[o+12>>2];e=e+1|0;if(e>>>0>=l>>>0)break;else{o=o+16|0;s=s+16|0}}}v=v+1|0;if(v>>>0>=m>>>0)break;else{a=a+16|0;u=u+52|0}}}f[c+236>>2]=f[c+4>>2];c=c+232|0;g=g+1|0}while((g|0)!=(D|0))}Qi(S);Qi(T);do{if(h[x+(r*5640|0)+5636>>0]&4){a=d[t>>1]|0;if((a&65535)>2){if(!((n|0)==1|(a&65535)<7))break}else if((n|0)!=1)break;Fr(f[H>>2]|0,r,f[R>>2]|0,f[A>>2]|0,f[k>>2]|0,f[P>>2]|0,f[C>>2]|0,f[I>>2]|0,f[O>>2]|0);r=i;b=N;return r|0}}while(0);w=f[M>>2]|0;E=f[R>>2]|0;_=f[A>>2]|0;y=f[k>>2]|0;g=f[P>>2]|0;v=f[C>>2]|0;m=f[L>>2]|0;c=f[I>>2]|0;u=f[O>>2]|0;a=f[H>>2]|0;s=(f[a+(r*5640|0)+420>>2]|0)+1|0;if(!s){r=i;b=N;return r|0}e=f[a+(r*5640|0)+8>>2]|0;l=f[a+(r*5640|0)+4>>2]|0;a=a+(r*5640|0)+424|0;o=0;while(1){f[a+76>>2]=0;f[a+92>>2]=w;f[a+72>>2]=0;f[a+88>>2]=m;f[a+68>>2]=0;f[a+84>>2]=e;f[a+36>>2]=l;f[a+80>>2]=0;f[a+96>>2]=v;f[a+100>>2]=E;f[a+104>>2]=_;f[a+108>>2]=y;f[a+112>>2]=g;f[a+116>>2]=c;f[a+120>>2]=u;o=o+1|0;if((o|0)==(s|0))break;else a=a+148|0}b=N;return i|0}function Ir(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,u=0,c=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0;j=f[t+76>>2]|0;V=j+(r*5640|0)+424+(n*148|0)+36|0;G=$i(f[V>>2]|0)|0;f[e+(n*232|0)+40>>2]=1;W=e+(n*232|0)+44|0;f[e+(n*232|0)+80>>2]=f[V>>2];do{if(h[t+93>>0]&8){s=d[t>>1]|0;if((s&65535)>2){if(!((o|0)==1&(s&65535)>6|(s+-3&65535)<4))break}else if(!((o|0)==1|(s+-3&65535)<4))break;s=a+1|0;e:do{if((s|0)<4){o=j+(r*5640|0)+424+(n*148|0)+72|0;l=j+(r*5640|0)+424+(n*148|0)+88|0;u=e+(n*232|0)+56|0;c=j+(r*5640|0)+424+(n*148|0)+76|0;p=e+(n*232|0)+48|0;m=j+(r*5640|0)+424+(n*148|0)+92|0;v=e+(n*232|0)+60|0;g=j+(r*5640|0)+424+(n*148|0)+68|0;y=e+(n*232|0)+64|0;_=j+(r*5640|0)+424+(n*148|0)+84|0;b=e+(n*232|0)+52|0;E=j+(r*5640|0)+424+(n*148|0)+80|0;w=e+(n*232|0)+68|0;x=j+(r*5640|0)+424+(n*148|0)+96|0;T=e+(n*232|0)+72|0;S=j+(r*5640|0)+424+(n*148|0)+100|0;M=e+(n*232|0)+96|0;R=j+(r*5640|0)+424+(n*148|0)+108|0;A=e+(n*232|0)+104|0;k=j+(r*5640|0)+424+(n*148|0)+104|0;P=e+(n*232|0)+100|0;C=j+(r*5640|0)+424+(n*148|0)+112|0;L=e+(n*232|0)+108|0;while(1){t:do{switch(h[G+s>>0]|0){case 82:{f[W>>2]=f[o>>2];f[u>>2]=f[l>>2];break}case 67:{f[p>>2]=f[c>>2];f[v>>2]=f[m>>2];break}case 76:{f[y>>2]=f[g>>2];f[b>>2]=f[_>>2];break}case 80:if((f[V>>2]|0)>>>0<2){f[w>>2]=f[E>>2];f[T>>2]=f[x>>2];break t}else{f[M>>2]=f[S>>2];f[A>>2]=f[R>>2];f[P>>2]=f[k>>2];f[L>>2]=f[C>>2];break t}default:{}}}while(0);s=s+1|0;if((s|0)==4)break e}}}while(0);s=(a|0)>-1;if(!i){if(!s)return;u=j+(r*5640|0)+424+(n*148|0)+76|0;c=j+(r*5640|0)+424+(n*148|0)+132|0;p=e+(n*232|0)+48|0;m=e+(n*232|0)+60|0;v=j+(r*5640|0)+424+(n*148|0)+72|0;g=j+(r*5640|0)+424+(n*148|0)+128|0;y=e+(n*232|0)+56|0;_=j+(r*5640|0)+424+(n*148|0)+68|0;b=j+(r*5640|0)+424+(n*148|0)+124|0;E=e+(n*232|0)+64|0;w=e+(n*232|0)+52|0;x=j+(r*5640|0)+424+(n*148|0)+80|0;T=j+(r*5640|0)+424+(n*148|0)+136|0;S=e+(n*232|0)+68|0;M=e+(n*232|0)+72|0;R=j+(r*5640|0)+424+(n*148|0)+100|0;A=j+(r*5640|0)+424+(n*148|0)+140|0;k=j+(r*5640|0)+424+(n*148|0)+108|0;P=j+(r*5640|0)+424+(n*148|0)+144|0;C=e+(n*232|0)+96|0;L=j+(r*5640|0)+424+(n*148|0)+116|0;i=e+(n*232|0)+100|0;I=e+(n*232|0)+104|0;l=j+(r*5640|0)+424+(n*148|0)+120|0;o=e+(n*232|0)+108|0;s=a;while(1){e:do{switch(h[G+s>>0]|0){case 67:{n=f[u>>2]|0;f[p>>2]=n;n=n+1|0;f[m>>2]=n;f[c>>2]=n;break}case 82:{n=f[v>>2]|0;f[W>>2]=n;n=n+1|0;f[y>>2]=n;f[g>>2]=n;break}case 76:{n=f[_>>2]|0;f[E>>2]=n;n=n+1|0;f[w>>2]=n;f[b>>2]=n;break}case 80:if((f[V>>2]|0)>>>0<2){n=f[x>>2]|0;f[S>>2]=n;n=n+1|0;f[M>>2]=n;f[T>>2]=n;break e}else{n=f[R>>2]|0;a=f[k>>2]|0;f[C>>2]=n;r=f[L>>2]|0;r=r+n-((n>>>0)%(r>>>0)|0)|0;f[i>>2]=r;f[I>>2]=a;n=f[l>>2]|0;n=n+a-((a>>>0)%(n>>>0)|0)|0;f[o>>2]=n;f[A>>2]=r;f[P>>2]=n;break e}default:{}}}while(0);if((s|0)>0)s=s+-1|0;else break}return}if(!s)return;N=j+(r*5640|0)+424+(n*148|0)+128|0;F=j+(r*5640|0)+424+(n*148|0)+88|0;U=j+(r*5640|0)+424+(n*148|0)+72|0;B=e+(n*232|0)+56|0;z=j+(r*5640|0)+424+(n*148|0)+132|0;m=j+(r*5640|0)+424+(n*148|0)+92|0;v=j+(r*5640|0)+424+(n*148|0)+76|0;g=e+(n*232|0)+48|0;y=e+(n*232|0)+60|0;_=j+(r*5640|0)+424+(n*148|0)+124|0;b=j+(r*5640|0)+424+(n*148|0)+84|0;E=j+(r*5640|0)+424+(n*148|0)+68|0;w=e+(n*232|0)+64|0;x=e+(n*232|0)+52|0;T=j+(r*5640|0)+424+(n*148|0)+136|0;S=j+(r*5640|0)+424+(n*148|0)+96|0;M=j+(r*5640|0)+424+(n*148|0)+80|0;R=e+(n*232|0)+68|0;A=e+(n*232|0)+72|0;k=j+(r*5640|0)+424+(n*148|0)+140|0;P=j+(r*5640|0)+424+(n*148|0)+104|0;C=e+(n*232|0)+96|0;L=j+(r*5640|0)+424+(n*148|0)+116|0;i=e+(n*232|0)+100|0;I=j+(r*5640|0)+424+(n*148|0)+144|0;O=j+(r*5640|0)+424+(n*148|0)+112|0;H=e+(n*232|0)+104|0;D=j+(r*5640|0)+424+(n*148|0)+120|0;c=e+(n*232|0)+108|0;p=j+(r*5640|0)+424+(n*148|0)+100|0;u=j+(r*5640|0)+424+(n*148|0)+108|0;l=a;s=1;while(1){o=G+l|0;e:do{switch(h[o>>0]|0){case 67:{a=f[z>>2]|0;f[g>>2]=a+-1;f[y>>2]=a;break}case 82:{a=f[N>>2]|0;f[W>>2]=a+-1;f[B>>2]=a;break}case 76:{a=f[_>>2]|0;f[w>>2]=a+-1;f[x>>2]=a;break}case 80:if((f[V>>2]|0)>>>0<2){a=f[T>>2]|0;f[R>>2]=a+-1;f[A>>2]=a;break e}else{a=f[k>>2]|0;j=f[L>>2]|0;f[C>>2]=a-j-((a>>>0)%(j>>>0)|0);f[i>>2]=a;a=f[I>>2]|0;j=f[D>>2]|0;f[H>>2]=a-j-((a>>>0)%(j>>>0)|0);f[c>>2]=a;break e}default:{}}}while(0);e:do{if((s|0)==1)switch(h[o>>0]|0){case 82:{s=f[N>>2]|0;if((s|0)!=(f[F>>2]|0)){f[W>>2]=s;s=s+1|0;f[B>>2]=s;f[N>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[U>>2]|0;f[W>>2]=s;s=s+1|0;f[B>>2]=s;f[N>>2]=s;s=1;break e}case 67:{s=f[z>>2]|0;if((s|0)!=(f[m>>2]|0)){f[g>>2]=s;s=s+1|0;f[y>>2]=s;f[z>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[v>>2]|0;f[g>>2]=s;s=s+1|0;f[y>>2]=s;f[z>>2]=s;s=1;break e}case 76:{s=f[_>>2]|0;if((s|0)!=(f[b>>2]|0)){f[w>>2]=s;s=s+1|0;f[x>>2]=s;f[_>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[E>>2]|0;f[w>>2]=s;s=s+1|0;f[x>>2]=s;f[_>>2]=s;s=1;break e}case 80:{if((f[V>>2]|0)>>>0<2){s=f[T>>2]|0;if((s|0)!=(f[S>>2]|0)){f[R>>2]=s;s=s+1|0;f[A>>2]=s;f[T>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[M>>2]|0;f[R>>2]=s;s=s+1|0;f[A>>2]=s;f[T>>2]=s;s=1;break e}s=f[k>>2]|0;if(s>>>0<(f[P>>2]|0)>>>0){f[C>>2]=s;a=f[L>>2]|0;s=a+s-((s>>>0)%(a>>>0)|0)|0;f[i>>2]=s;f[k>>2]=s;s=0;break e}o=f[I>>2]|0;if(o>>>0<(f[O>>2]|0)>>>0){f[H>>2]=o;a=f[D>>2]|0;s=0;o=a+o-((o>>>0)%(a>>>0)|0)|0}else{if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}a=f[u>>2]|0;f[I>>2]=a;f[H>>2]=a;o=f[D>>2]|0;s=1;o=o+a-((a>>>0)%(o>>>0)|0)|0}f[c>>2]=o;f[I>>2]=o;j=f[p>>2]|0;f[C>>2]=j;a=f[L>>2]|0;a=a+j-((j>>>0)%(a>>>0)|0)|0;f[i>>2]=a;f[k>>2]=a;break e}default:{s=1;break e}}}while(0);if((l|0)>0)l=l+-1|0;else break}return}}while(0);f[W>>2]=f[j+(r*5640|0)+424+(n*148|0)+72>>2];f[e+(n*232|0)+56>>2]=f[j+(r*5640|0)+424+(n*148|0)+88>>2];f[e+(n*232|0)+48>>2]=f[j+(r*5640|0)+424+(n*148|0)+76>>2];f[e+(n*232|0)+60>>2]=f[j+(r*5640|0)+424+(n*148|0)+92>>2];f[e+(n*232|0)+64>>2]=f[j+(r*5640|0)+424+(n*148|0)+68>>2];f[e+(n*232|0)+52>>2]=f[j+(r*5640|0)+424+(n*148|0)+84>>2];f[e+(n*232|0)+68>>2]=f[j+(r*5640|0)+424+(n*148|0)+80>>2];f[e+(n*232|0)+72>>2]=f[j+(r*5640|0)+424+(n*148|0)+96>>2];f[e+(n*232|0)+96>>2]=f[j+(r*5640|0)+424+(n*148|0)+100>>2];f[e+(n*232|0)+104>>2]=f[j+(r*5640|0)+424+(n*148|0)+108>>2];f[e+(n*232|0)+100>>2]=f[j+(r*5640|0)+424+(n*148|0)+104>>2];f[e+(n*232|0)+108>>2]=f[j+(r*5640|0)+424+(n*148|0)+112>>2];return}function Or(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0;I=f[t+76>>2]|0;H=f[t+24>>2]|0;F=(r>>>0)%(H>>>0)|0;H=(r>>>0)/(H>>>0)|0;D=f[t+4>>2]|0;L=f[t+12>>2]|0;C=(ce(L,F)|0)+D|0;N=f[e>>2]|0;N=(C|0)>(N|0)?C:N;D=(ce(L,F+1|0)|0)+D|0;F=f[e+8>>2]|0;F=(D|0)<(F|0)?D:F;D=f[t+8>>2]|0;L=f[t+16>>2]|0;C=(ce(L,H)|0)+D|0;O=f[e+4>>2]|0;O=(C|0)>(O|0)?C:O;D=(ce(L,H+1|0)|0)+D|0;H=f[e+12>>2]|0;H=(D|0)<(H|0)?D:H;D=f[e+16>>2]|0;if(!D){u=0;l=2147483647;s=2147483647;o=0}else{A=H+-1|0;k=F+-1|0;P=O+-1|0;C=N+-1|0;u=0;l=2147483647;s=2147483647;o=0;L=0;M=f[e+24>>2]|0;R=f[I+(r*5640|0)+5584>>2]|0;while(1){x=f[M>>2]|0;T=f[M+4>>2]|0;S=f[R+4>>2]|0;o=S>>>0>o>>>0?S:o;if(S){E=(A+T|0)/(T|0)|0;_=(k+x|0)/(x|0)|0;g=(P+T|0)/(T|0)|0;m=(C+x|0)/(x|0)|0;m=Wl(m|0,((m|0)<0)<<31>>31|0,-1,-1)|0;v=B;g=Wl(g|0,((g|0)<0)<<31>>31|0,-1,-1)|0;y=B;_=Wl(_|0,((_|0)<0)<<31>>31|0,-1,-1)|0;b=B;E=Wl(E|0,((E|0)<0)<<31>>31|0,-1,-1)|0;w=B;t=0;p=0;while(1){c=f[R+812+(p<<2)>>2]|0;d=f[R+944+(p<<2)>>2]|0;i=t+-1+S|0;a=x<<i+c;U=T<<d+i;l=l>>>0<a>>>0?l:a;s=s>>>0<U>>>0?s:U;U=Gl(1,0,i|0)|0;a=B;t=Wl(m|0,v|0,U|0,a|0)|0;t=jl(t|0,B|0,i|0)|0;n=Wl(g|0,y|0,U|0,a|0)|0;n=jl(n|0,B|0,i|0)|0;e=Wl(_|0,b|0,U|0,a|0)|0;e=jl(e|0,B|0,i|0)|0;a=Wl(E|0,w|0,U|0,a|0)|0;i=jl(a|0,B|0,i|0)|0;a=Gl(1,0,d|0)|0;a=Wl(a|0,B|0,-1,-1)|0;a=Wl(a|0,B|0,i|0,((i|0)<0)<<31>>31|0)|0;a=jl(a|0,B|0,d|0)|0;if((t|0)==(e|0))t=0;else{U=Gl(1,0,c|0)|0;U=Wl(U|0,B|0,-1,-1)|0;U=Wl(U|0,B|0,e|0,((e|0)<0)<<31>>31|0)|0;U=jl(U|0,B|0,c|0)|0;t=(U<<c)-(t>>c<<c)>>c}e=ce(t,(n|0)==(i|0)?0:(a<<d)-(n>>d<<d)>>d)|0;u=e>>>0>u>>>0?e:u;e=p+1|0;if(e>>>0<S>>>0){t=~p;p=e}else break}}L=L+1|0;if(L>>>0>=D>>>0)break;else{M=M+52|0;R=R+1080|0}}}if(h[I+(r*5640|0)+5636>>0]&4){Fr(I,r,N,F,O,H,u,l,s);return}n=(f[I+(r*5640|0)+420>>2]|0)+1|0;if(!n)return;i=f[I+(r*5640|0)+8>>2]|0;a=f[I+(r*5640|0)+4>>2]|0;t=I+(r*5640|0)+424|0;e=0;while(1){f[t+76>>2]=0;f[t+92>>2]=D;f[t+72>>2]=0;f[t+88>>2]=o;f[t+68>>2]=0;f[t+84>>2]=i;f[t+36>>2]=a;f[t+80>>2]=0;f[t+96>>2]=u;f[t+100>>2]=N;f[t+104>>2]=F;f[t+108>>2]=O;f[t+112>>2]=H;f[t+116>>2]=l;f[t+120>>2]=s;e=e+1|0;if((e|0)==(n|0))break;else t=t+148|0}return}function Hr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,J=0,K=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ve=0,ge=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Se=0,Me=0,Re=0,Ae=0,ke=0,Pe=0,Ce=0,Le=0,Ie=0,Oe=0,He=0,De=0,Ne=0,Fe=0,Ue=0,Be=0,ze=0,je=0,Ve=0,Ge=0,We=0,Xe=0,Ye=0,qe=0,Ze=0,Je=0,Ke=0,Qe=0,$e=0,et=0,tt=0,rt=0,nt=0,it=0,at=0,ot=0,st=0,lt=0,ut=0,ct=0,ht=0,dt=0,ft=0;switch(f[e+80>>2]|0){case 0:{t=e+40|0;if(!(f[t>>2]|0)){P=e+32|0;l=P;P=f[P>>2]|0;r=18}else{f[t>>2]=0;_=f[e+64>>2]|0;f[e+36>>2]=_;r=5}while(1){if((r|0)==5){if(_>>>0>=(f[e+52>>2]|0)>>>0){ft=0;r=153;break}S=f[e+44>>2]|0;f[e+28>>2]=S;r=7}else if((r|0)==18){o=P+1|0;f[l>>2]=o;i=l;r=14}while(1){if((r|0)==7){r=0;if(S>>>0>=(f[e+56>>2]|0)>>>0){r=21;break}M=f[e+48>>2]|0;m=e+24|0;f[m>>2]=M}else if((r|0)==14){if(o>>>0<(f[e+72>>2]|0)>>>0){r=16;break}C=e+24|0;c=C;C=f[C>>2]|0;r=19}while(1){if((r|0)==19){r=0;M=C+1|0;f[c>>2]=M;m=c}if(M>>>0>=(f[e+60>>2]|0)>>>0){r=20;break}R=f[e+196>>2]|0;A=f[e+28>>2]|0;if(A>>>0<(f[R+(M<<4)+8>>2]|0)>>>0)break;else{c=m;C=M;r=19}}if((r|0)==20){r=e+28|0;S=(f[r>>2]|0)+1|0;f[r>>2]=S;r=7;continue}t=f[R+(M<<4)+12>>2]|0;if(!(h[e>>0]|0)){dt=ce(f[t+(A<<4)+12>>2]|0,f[t+(A<<4)+8>>2]|0)|0;f[e+72>>2]=dt}o=f[e+68>>2]|0;i=e+32|0;f[i>>2]=o;r=14}if((r|0)==16){r=0;k=ce(f[e+8>>2]|0,f[e+36>>2]|0)|0;k=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+k|0;k=k+(ce(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;k=k+(ce(f[e+20>>2]|0,o)|0)|0;k=(f[e+4>>2]|0)+(k<<1)|0;if(!(d[k>>1]|0))break;else{l=i;P=o;r=18;continue}}else if((r|0)==21){r=e+36|0;_=(f[r>>2]|0)+1|0;f[r>>2]=_;r=5;continue}}if((r|0)==153)return ft|0;d[k>>1]=1;e=1;return e|0}case 1:{t=e+40|0;if(!(f[t>>2]|0)){x=e+32|0;s=x;x=f[x>>2]|0;r=38}else{f[t>>2]=0;L=f[e+44>>2]|0;f[e+28>>2]=L;r=25}while(1){if((r|0)==25){if(L>>>0>=(f[e+56>>2]|0)>>>0){ft=0;r=153;break}g=f[e+64>>2]|0;f[e+36>>2]=g;r=27}else if((r|0)==38){a=x+1|0;f[s>>2]=a;n=s;r=34}while(1){if((r|0)==27){r=0;if(g>>>0>=(f[e+52>>2]|0)>>>0){r=41;break}y=f[e+48>>2]|0;p=e+24|0;f[p>>2]=y}else if((r|0)==34){if(a>>>0<(f[e+72>>2]|0)>>>0){r=36;break}T=e+24|0;u=T;T=f[T>>2]|0;r=39}while(1){if((r|0)==39){r=0;y=T+1|0;f[u>>2]=y;p=u}if(y>>>0>=(f[e+60>>2]|0)>>>0){r=40;break}b=f[e+196>>2]|0;E=f[e+28>>2]|0;if(E>>>0<(f[b+(y<<4)+8>>2]|0)>>>0)break;else{u=p;T=y;r=39}}if((r|0)==40){r=e+36|0;g=(f[r>>2]|0)+1|0;f[r>>2]=g;r=27;continue}t=f[b+(y<<4)+12>>2]|0;if(!(h[e>>0]|0)){dt=ce(f[t+(E<<4)+12>>2]|0,f[t+(E<<4)+8>>2]|0)|0;f[e+72>>2]=dt}a=f[e+68>>2]|0;n=e+32|0;f[n>>2]=a;r=34}if((r|0)==36){r=0;w=ce(f[e+8>>2]|0,f[e+36>>2]|0)|0;w=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+w|0;w=w+(ce(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;w=w+(ce(f[e+20>>2]|0,a)|0)|0;w=(f[e+4>>2]|0)+(w<<1)|0;if(!(d[w>>1]|0))break;else{s=n;x=a;r=38;continue}}else if((r|0)==41){r=e+28|0;L=(f[r>>2]|0)+1|0;f[r>>2]=L;r=25;continue}}if((r|0)==153)return ft|0;d[w>>1]=1;e=1;return e|0}case 2:{t=e+40|0;if(!(f[t>>2]|0)){ht=e+36|0;We=ht;ht=f[ht>>2]|0;r=75}else{f[t>>2]=0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;v=f[e+192>>2]|0;if(v){g=f[e+196>>2]|0;t=0;r=0;y=0;do{o=f[g+(y<<4)+8>>2]|0;if(o){s=f[g+(y<<4)+12>>2]|0;l=f[g+(y<<4)>>2]|0;u=f[g+(y<<4)+4>>2]|0;c=o+-1|0;n=0;a=0;while(1){i=c+n|0;Ge=l<<i+(f[s+(a<<4)>>2]|0);i=u<<(f[s+(a<<4)+4>>2]|0)+i;t=(t|0)==0?Ge:t>>>0<Ge>>>0?t:Ge;r=(r|0)==0?i:r>>>0<i>>>0?r:i;i=a+1|0;if((i|0)==(o|0))break;else{n=~a;a=i}}f[p>>2]=t;f[m>>2]=r}y=y+1|0}while((y|0)!=(v|0))}if(!(h[e>>0]|0)){f[e+104>>2]=f[e+204>>2];f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}H=f[e+44>>2]|0;f[e+28>>2]=H;r=54}while(1){if((r|0)==54){if(H>>>0>=(f[e+56>>2]|0)>>>0){ft=0;r=153;break}Ze=f[e+104>>2]|0;f[e+220>>2]=Ze;r=56}else if((r|0)==75){ut=ht+1|0;f[We>>2]=ut;Xe=We;r=71}while(1){if((r|0)==56){if((Ze|0)>=(f[e+108>>2]|0)){r=79;break}Je=f[e+96>>2]|0;f[e+216>>2]=Je;r=58}else if((r|0)==71){if(ut>>>0<(f[e+52>>2]|0)>>>0){r=73;break}dt=e+24|0;Ye=dt;dt=f[dt>>2]|0;r=76}while(1){if((r|0)==58){if((Je|0)>=(f[e+100>>2]|0)){r=78;break}Ke=f[e+48>>2]|0;qe=e+24|0;f[qe>>2]=Ke}else if((r|0)==76){Ke=dt+1|0;f[Ye>>2]=Ke;qe=Ye}if(Ke>>>0>=(f[e+60>>2]|0)>>>0){Je=f[e+224>>2]|0;r=e+216|0;Ge=f[r>>2]|0;Je=Ge+Je-((Ge|0)%(Je|0)|0)|0;f[r>>2]=Je;r=58;continue}r=f[e+196>>2]|0;u=f[e+28>>2]|0;t=f[r+(Ke<<4)+8>>2]|0;if(u>>>0>=t>>>0){Ye=qe;dt=Ke;r=76;continue}c=f[r+(Ke<<4)+12>>2]|0;a=t+~u|0;o=f[e+200>>2]|0;s=f[r+(Ke<<4)>>2]|0;Qe=s<<a;$e=(o+-1+Qe|0)/(Qe|0)|0;l=f[e+204>>2]|0;Ge=f[r+(Ke<<4)+4>>2]|0;et=Ge<<a;tt=(l+-1+et|0)/(et|0)|0;rt=Qe+-1|0;t=(rt+(f[e+208>>2]|0)|0)/(Qe|0)|0;nt=et+-1|0;r=(nt+(f[e+212>>2]|0)|0)/(et|0)|0;it=f[c+(u<<4)>>2]|0;n=it+a|0;at=f[c+(u<<4)+4>>2]|0;i=at+a|0;ot=f[e+220>>2]|0;if((ot|0)%(Ge<<i|0)|0){if((ot|0)!=(l|0)){Ye=qe;dt=Ke;r=76;continue}if(!((tt<<a|0)%(1<<i|0)|0)){Ye=qe;dt=Ke;r=76;continue}}st=f[e+216>>2]|0;if((st|0)%(s<<n|0)|0){if((st|0)!=(o|0)){Ye=qe;dt=Ke;r=76;continue}if(!(($e<<a|0)%(1<<n|0)|0)){Ye=qe;dt=Ke;r=76;continue}}lt=f[c+(u<<4)+8>>2]|0;if(!lt){Ye=qe;dt=Ke;r=76;continue}if((tt|0)==(r|0)|(($e|0)==(t|0)?1:(f[c+(u<<4)+12>>2]|0)==0)){Ye=qe;dt=Ke;r=76}else{r=70;break}}if((r|0)==70){ut=(((rt+st|0)/(Qe|0)|0)>>it)-($e>>it)+(ce((((nt+ot|0)/(et|0)|0)>>at)-(tt>>at)|0,lt)|0)|0;f[e+32>>2]=ut;ut=f[e+64>>2]|0;Xe=e+36|0;f[Xe>>2]=ut;r=71;continue}else if((r|0)==78){Ze=f[e+228>>2]|0;r=e+220|0;Ge=f[r>>2]|0;Ze=Ge+Ze-((Ge|0)%(Ze|0)|0)|0;f[r>>2]=Ze;r=56;continue}}if((r|0)==73){r=0;ct=ce(f[e+8>>2]|0,ut)|0;ct=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+ct|0;ct=ct+(ce(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;ct=ct+(ce(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;ct=(f[e+4>>2]|0)+(ct<<1)|0;if(!(d[ct>>1]|0))break;else{We=Xe;ht=ut;r=75;continue}}else if((r|0)==79){r=e+28|0;H=(f[r>>2]|0)+1|0;f[r>>2]=H;r=54;continue}}if((r|0)==153)return ft|0;d[ct>>1]=1;e=1;return e|0}case 3:{r=e+40|0;if(!(f[r>>2]|0)){Ve=f[e+24>>2]|0;De=e+36|0;me=De;De=f[De>>2]|0;Ue=Ve;Ve=(f[e+196>>2]|0)+(Ve<<4)|0;r=113}else{f[r>>2]=0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;v=f[e+192>>2]|0;if(v){g=f[e+196>>2]|0;t=0;r=0;y=0;do{o=f[g+(y<<4)+8>>2]|0;if(o){s=f[g+(y<<4)+12>>2]|0;l=f[g+(y<<4)>>2]|0;u=f[g+(y<<4)+4>>2]|0;c=o+-1|0;n=0;a=0;while(1){i=c+n|0;dt=l<<i+(f[s+(a<<4)>>2]|0);i=u<<(f[s+(a<<4)+4>>2]|0)+i;t=(t|0)==0?dt:t>>>0<dt>>>0?t:dt;r=(r|0)==0?i:r>>>0<i>>>0?r:i;i=a+1|0;if((i|0)==(o|0))break;else{n=~a;a=i}}f[p>>2]=t;f[m>>2]=r}y=y+1|0}while((y|0)!=(v|0))}if(!(h[e>>0]|0)){t=f[e+204>>2]|0;f[e+104>>2]=t;f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}else t=f[e+104>>2]|0;f[e+220>>2]=t;r=93}while(1){if((r|0)==93){if((t|0)>=(f[e+108>>2]|0)){ft=0;r=153;break}_e=f[e+96>>2]|0;f[e+216>>2]=_e;r=95}else if((r|0)==113){Ie=De+1|0;f[me>>2]=Ie;ve=me;Oe=Ue;je=Ve;r=109}while(1){if((r|0)==95){if((_e|0)>=(f[e+100>>2]|0)){r=117;break}be=f[e+48>>2]|0;f[e+24>>2]=be;r=97}else if((r|0)==109){if(Ie>>>0<(f[e+52>>2]|0)>>>0){r=111;break}Ne=e+28|0;ge=Ne;Ne=f[Ne>>2]|0;Be=Oe;Ge=je;r=114}while(1){if((r|0)==97){if(be>>>0>=(f[e+60>>2]|0)>>>0){r=116;break}ze=(f[e+196>>2]|0)+(be<<4)|0;Ee=f[e+44>>2]|0;ye=e+28|0;f[ye>>2]=Ee;Fe=be}else if((r|0)==114){Ee=Ne+1|0;f[ge>>2]=Ee;ye=ge;Fe=Be;ze=Ge}dt=f[e+56>>2]|0;r=f[ze+8>>2]|0;if(Ee>>>0>=(dt>>>0<r>>>0?dt:r)>>>0){be=Fe+1|0;f[e+24>>2]=be;r=97;continue}c=f[ze+12>>2]|0;r=r+~Ee|0;n=f[e+200>>2]|0;i=f[ze>>2]|0;we=i<<r;xe=(n+-1+we|0)/(we|0)|0;a=f[e+204>>2]|0;dt=f[ze+4>>2]|0;Te=dt<<r;Se=(a+-1+Te|0)/(Te|0)|0;Me=we+-1|0;o=(Me+(f[e+208>>2]|0)|0)/(we|0)|0;Re=Te+-1|0;s=(Re+(f[e+212>>2]|0)|0)/(Te|0)|0;Ae=f[c+(Ee<<4)>>2]|0;l=Ae+r|0;ke=f[c+(Ee<<4)+4>>2]|0;u=ke+r|0;Pe=f[e+220>>2]|0;if((Pe|0)%(dt<<u|0)|0){if((Pe|0)!=(a|0)){ge=ye;Ne=Ee;Be=Fe;Ge=ze;r=114;continue}if(!((Se<<r|0)%(1<<u|0)|0)){ge=ye;Ne=Ee;Be=Fe;Ge=ze;r=114;continue}}Ce=f[e+216>>2]|0;if((Ce|0)%(i<<l|0)|0){if((Ce|0)!=(n|0)){ge=ye;Ne=Ee;Be=Fe;Ge=ze;r=114;continue}if(!((xe<<r|0)%(1<<l|0)|0)){ge=ye;Ne=Ee;Be=Fe;Ge=ze;r=114;continue}}Le=f[c+(Ee<<4)+8>>2]|0;if(!Le){ge=ye;Ne=Ee;Be=Fe;Ge=ze;r=114;continue}if((Se|0)==(s|0)|((xe|0)==(o|0)?1:(f[c+(Ee<<4)+12>>2]|0)==0)){ge=ye;Ne=Ee;Be=Fe;Ge=ze;r=114}else{r=108;break}}if((r|0)==108){Ie=(((Me+Ce|0)/(we|0)|0)>>Ae)-(xe>>Ae)+(ce((((Re+Pe|0)/(Te|0)|0)>>ke)-(Se>>ke)|0,Le)|0)|0;f[e+32>>2]=Ie;Ie=f[e+64>>2]|0;ve=e+36|0;f[ve>>2]=Ie;Oe=Fe;je=ze;r=109;continue}else if((r|0)==116){_e=f[e+224>>2]|0;r=e+216|0;dt=f[r>>2]|0;_e=dt+_e-((dt|0)%(_e|0)|0)|0;f[r>>2]=_e;r=95;continue}}if((r|0)==111){r=0;He=ce(f[e+8>>2]|0,Ie)|0;He=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+He|0;He=He+(ce(f[e+16>>2]|0,Oe)|0)|0;He=He+(ce(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;He=(f[e+4>>2]|0)+(He<<1)|0;if(!(d[He>>1]|0))break;else{me=ve;De=Ie;Ue=Oe;Ve=je;r=113;continue}}else if((r|0)==117){t=f[e+228>>2]|0;r=e+220|0;dt=f[r>>2]|0;t=dt+t-((dt|0)%(t|0)|0)|0;f[r>>2]=t;r=93;continue}}if((r|0)==153)return ft|0;d[He>>1]=1;e=1;return e|0}case 4:{t=e+40|0;if(!(f[t>>2]|0)){fe=f[e+24>>2]|0;ne=e+36|0;D=ne;ne=f[ne>>2]|0;ae=fe;fe=(f[e+196>>2]|0)+(fe<<4)|0;r=148}else{f[t>>2]=0;B=f[e+48>>2]|0;f[e+24>>2]=B;r=121}while(1){if((r|0)==121){if(B>>>0>=(f[e+60>>2]|0)>>>0){ft=0;r=153;break}t=f[e+196>>2]|0;v=t+(B<<4)|0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;l=f[t+(B<<4)+8>>2]|0;if(l){u=f[t+(B<<4)+12>>2]|0;c=f[v>>2]|0;i=f[t+(B<<4)+4>>2]|0;a=l+-1|0;r=0;t=0;n=0;s=0;while(1){o=a+n|0;dt=c<<o+(f[u+(s<<4)>>2]|0);o=i<<(f[u+(s<<4)+4>>2]|0)+o;r=(r|0)==0?dt:r>>>0<dt>>>0?r:dt;t=(t|0)==0?o:t>>>0<o>>>0?t:o;o=s+1|0;if((o|0)==(l|0))break;else{n=~s;s=o}}f[p>>2]=r;f[m>>2]=t}if(!(h[e>>0]|0)){t=f[e+204>>2]|0;f[e+104>>2]=t;f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}else t=f[e+104>>2]|0;f[e+220>>2]=t;I=t;O=B;r=130}else if((r|0)==148){ee=ne+1|0;f[D>>2]=ee;N=D;te=ae;de=fe;r=144}while(1){if((r|0)==130){if((I|0)>=(f[e+108>>2]|0)){r=152;break}z=f[e+96>>2]|0;f[e+216>>2]=z;oe=O;ue=v;r=132}else if((r|0)==144){if(ee>>>0<(f[e+52>>2]|0)>>>0){r=146;break}ie=e+28|0;F=ie;ie=f[ie>>2]|0;le=te;pe=de;r=149}while(1){if((r|0)==132){if((z|0)>=(f[e+100>>2]|0)){r=151;break}j=f[e+44>>2]|0;U=e+28|0;f[U>>2]=j;se=oe;he=ue}else if((r|0)==149){j=ie+1|0;f[F>>2]=j;U=F;se=le;he=pe}dt=f[e+56>>2]|0;t=f[he+8>>2]|0;if(j>>>0>=(dt>>>0<t>>>0?dt:t)>>>0){z=f[e+224>>2]|0;oe=e+216|0;ue=f[oe>>2]|0;z=ue+z-((ue|0)%(z|0)|0)|0;f[oe>>2]=z;oe=se;ue=he;r=132;continue}u=f[he+12>>2]|0;t=t+~j|0;r=f[e+200>>2]|0;n=f[he>>2]|0;V=n<<t;G=(r+-1+V|0)/(V|0)|0;i=f[e+204>>2]|0;dt=f[he+4>>2]|0;W=dt<<t;X=(i+-1+W|0)/(W|0)|0;Y=V+-1|0;a=(Y+(f[e+208>>2]|0)|0)/(V|0)|0;q=W+-1|0;o=(q+(f[e+212>>2]|0)|0)/(W|0)|0;Z=f[u+(j<<4)>>2]|0;s=Z+t|0;J=f[u+(j<<4)+4>>2]|0;l=J+t|0;K=f[e+220>>2]|0;if((K|0)%(dt<<l|0)|0){if((K|0)!=(i|0)){F=U;ie=j;le=se;pe=he;r=149;continue}if(!((X<<t|0)%(1<<l|0)|0)){F=U;ie=j;le=se;pe=he;r=149;continue}}Q=f[e+216>>2]|0;if((Q|0)%(n<<s|0)|0){if((Q|0)!=(r|0)){F=U;ie=j;le=se;pe=he;r=149;continue}if(!((G<<t|0)%(1<<s|0)|0)){F=U;ie=j;le=se;pe=he;r=149;continue}}$=f[u+(j<<4)+8>>2]|0;if(!$){F=U;ie=j;le=se;pe=he;r=149;continue}if((X|0)==(o|0)|((G|0)==(a|0)?1:(f[u+(j<<4)+12>>2]|0)==0)){F=U;ie=j;le=se;pe=he;r=149}else{r=143;break}}if((r|0)==143){ee=(((Y+Q|0)/(V|0)|0)>>Z)-(G>>Z)+(ce((((q+K|0)/(W|0)|0)>>J)-(X>>J)|0,$)|0)|0;f[e+32>>2]=ee;ee=f[e+64>>2]|0;N=e+36|0;f[N>>2]=ee;te=se;de=he;r=144;continue}else if((r|0)==151){I=f[e+228>>2]|0;O=e+220|0;v=f[O>>2]|0;I=v+I-((v|0)%(I|0)|0)|0;f[O>>2]=I;O=oe;v=ue;r=130;continue}}if((r|0)==146){r=0;re=ce(f[e+8>>2]|0,ee)|0;re=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+re|0;re=re+(ce(f[e+16>>2]|0,te)|0)|0;re=re+(ce(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;re=(f[e+4>>2]|0)+(re<<1)|0;if(!(d[re>>1]|0))break;else{D=N;ne=ee;ae=te;fe=de;r=148;continue}}else if((r|0)==152){B=O+1|0;f[e+24>>2]=B;r=121;continue}}if((r|0)==153)return ft|0;d[re>>1]=1;e=1;return e|0}default:{e=0;return e|0}}return 0}function Dr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=(f[t+(r*5640|0)+420>>2]|0)+1|0;n=qi(c,232)|0;if(!n){c=0;return c|0}if(!c){c=n;return c|0}l=e+16|0;a=t+(r*5640|0)+5584|0;e=f[l>>2]|0;o=n;s=0;e:while(1){t=qi(e,16)|0;i=o+196|0;f[i>>2]=t;if(!t){e=5;break}u=f[l>>2]|0;f[o+192>>2]=u;t:do{if(!u)e=0;else{e=(f[a>>2]|0)+4|0;u=qi(f[e>>2]|0,16)|0;f[t+12>>2]=u;if(!u){e=18;break e}else r=0;while(1){f[t+(r<<4)+8>>2]=f[e>>2];r=r+1|0;e=f[l>>2]|0;if(r>>>0>=e>>>0)break t;t=f[i>>2]|0;e=(f[a>>2]|0)+(r*1080|0)+4|0;u=qi(f[e>>2]|0,16)|0;f[t+(r<<4)+12>>2]=u;if(!u){e=18;break e}}}}while(0);s=s+1|0;if(s>>>0>=c>>>0){e=32;break}else o=o+232|0}if((e|0)==5){e=n+4|0;t=f[e>>2]|0;if(!t){l=n;u=0}else{Qi(t);f[e>>2]=0;l=n;u=0}while(1){s=l+196|0;e=f[s>>2]|0;if(e){o=l+192|0;t=f[o>>2]|0;if(t){a=0;while(1){r=e+12|0;i=f[r>>2]|0;if(i){Qi(i);f[r>>2]=0;t=f[o>>2]|0}a=a+1|0;if(a>>>0>=t>>>0)break;else e=e+16|0}e=f[s>>2]|0}Qi(e);f[s>>2]=0}u=u+1|0;if((u|0)==(c|0))break;else l=l+232|0}Qi(n);c=0;return c|0}else if((e|0)==18){e=n+4|0;t=f[e>>2]|0;if(!t){l=n;u=0}else{Qi(t);f[e>>2]=0;l=n;u=0}while(1){s=l+196|0;e=f[s>>2]|0;if(e){o=l+192|0;t=f[o>>2]|0;if(t){a=0;while(1){r=e+12|0;i=f[r>>2]|0;if(i){Qi(i);f[r>>2]=0;t=f[o>>2]|0}a=a+1|0;if(a>>>0>=t>>>0)break;else e=e+16|0}e=f[s>>2]|0}Qi(e);f[s>>2]=0}u=u+1|0;if((u|0)==(c|0))break;else l=l+232|0}Qi(n);c=0;return c|0}else if((e|0)==32)return n|0;return 0}function Nr(e,t,r,n,i,a,o,s,l,u,c,h){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;h=h|0;var d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0;p=f[(f[t+76>>2]|0)+(r*5640|0)+5584>>2]|0;d=f[e+24>>2]|0;I=f[t+24>>2]|0;L=t+12|0;C=(ce(f[L>>2]|0,(r>>>0)%(I>>>0)|0)|0)+(f[t+4>>2]|0)|0;P=f[e>>2]|0;f[n>>2]=C>>>0>P>>>0?C:P;C=Wl(f[L>>2]|0,0,C|0,0)|0;C=C|0-B;L=f[e+8>>2]|0;f[i>>2]=C>>>0<L>>>0?C:L;L=t+16|0;I=(ce(f[L>>2]|0,(r>>>0)/(I>>>0)|0)|0)+(f[t+8>>2]|0)|0;C=f[e+4>>2]|0;f[a>>2]=I>>>0>C>>>0?I:C;I=Wl(f[L>>2]|0,0,I|0,0)|0;I=I|0-B;L=f[e+12>>2]|0;f[o>>2]=I>>>0<L>>>0?I:L;f[u>>2]=0;f[c>>2]=0;f[s>>2]=2147483647;f[l>>2]=2147483647;L=e+16|0;if(!(f[L>>2]|0))return;else I=0;while(1){g=f[h+(I<<2)>>2]|0;m=f[d>>2]|0;e=((f[n>>2]|0)+-1+m|0)/(m|0)|0;P=d+4|0;v=f[P>>2]|0;r=((f[a>>2]|0)+-1+v|0)/(v|0)|0;m=(m+-1+(f[i>>2]|0)|0)/(m|0)|0;v=(v+-1+(f[o>>2]|0)|0)/(v|0)|0;C=p+4|0;t=f[C>>2]|0;if(t>>>0>(f[c>>2]|0)>>>0){f[c>>2]=t;t=f[C>>2]|0}if(t){A=Wl(e|0,((e|0)<0)<<31>>31|0,-1,-1)|0;k=B;M=Wl(r|0,((r|0)<0)<<31>>31|0,-1,-1)|0;R=B;T=Wl(m|0,((m|0)<0)<<31>>31|0,-1,-1)|0;S=B;w=Wl(v|0,((v|0)<0)<<31>>31|0,-1,-1)|0;x=B;E=0;while(1){t=t+-1|0;m=f[p+812+(E<<2)>>2]|0;b=f[p+944+(E<<2)>>2]|0;f[g>>2]=m;f[g+4>>2]=b;y=f[d>>2]<<m+t;O=f[P>>2]<<b+t;e=f[s>>2]|0;f[s>>2]=(e|0)<(y|0)?e:y;y=f[l>>2]|0;f[l>>2]=(y|0)<(O|0)?y:O;O=Gl(1,0,t|0)|0;y=B;e=Wl(A|0,k|0,O|0,y|0)|0;e=jl(e|0,B|0,t|0)|0;v=Wl(M|0,R|0,O|0,y|0)|0;v=jl(v|0,B|0,t|0)|0;r=Wl(T|0,S|0,O|0,y|0)|0;r=jl(r|0,B|0,t|0)|0;y=Wl(w|0,x|0,O|0,y|0)|0;y=jl(y|0,B|0,t|0)|0;O=Gl(1,0,b|0)|0;_=B;H=Wl(y|0,((y|0)<0)<<31>>31|0,-1,-1)|0;_=Wl(H|0,B|0,O|0,_|0)|0;_=jl(_|0,B|0,b|0)|0;if((e|0)==(r|0))e=0;else{r=Wl(r|0,((r|0)<0)<<31>>31|0,-1,-1)|0;O=B;H=Gl(1,0,m|0)|0;H=Wl(r|0,O|0,H|0,B|0)|0;H=jl(H|0,B|0,m|0)|0;e=(H<<m)-(e>>m<<m)>>m}H=(v|0)==(y|0)?0:(_<<b)-(v>>b<<b)>>b;f[g+8>>2]=e;f[g+12>>2]=H;e=ce(e,H)|0;if(e>>>0>(f[u>>2]|0)>>>0)f[u>>2]=e;E=E+1|0;if(E>>>0>=(f[C>>2]|0)>>>0)break;else g=g+16|0}}I=I+1|0;if(I>>>0>=(f[L>>2]|0)>>>0)break;else{d=d+52|0;p=p+1080|0}}return}function Fr(e,t,r,n,i,a,o,s,l){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;var u=0,c=0;u=(f[e+(t*5640|0)+420>>2]|0)+1|0;f[e+(t*5640|0)+500>>2]=f[e+(t*5640|0)+428>>2];f[e+(t*5640|0)+516>>2]=f[e+(t*5640|0)+440>>2];f[e+(t*5640|0)+496>>2]=f[e+(t*5640|0)+424>>2];f[e+(t*5640|0)+512>>2]=f[e+(t*5640|0)+436>>2];f[e+(t*5640|0)+508>>2]=f[e+(t*5640|0)+432>>2];f[e+(t*5640|0)+492>>2]=0;f[e+(t*5640|0)+460>>2]=f[e+(t*5640|0)+456>>2];f[e+(t*5640|0)+504>>2]=0;f[e+(t*5640|0)+520>>2]=o;f[e+(t*5640|0)+524>>2]=r;f[e+(t*5640|0)+528>>2]=n;f[e+(t*5640|0)+532>>2]=i;f[e+(t*5640|0)+536>>2]=a;f[e+(t*5640|0)+540>>2]=s;f[e+(t*5640|0)+544>>2]=l;if(u>>>0<=1)return;e=e+(t*5640|0)+572|0;t=1;while(1){f[e+76>>2]=f[e+4>>2];f[e+92>>2]=f[e+16>>2];f[e+72>>2]=f[e>>2];f[e+88>>2]=f[e+12>>2];c=f[e+8>>2]|0;f[e+84>>2]=c;f[e+36>>2]=f[e+32>>2];f[e+80>>2]=0;f[e+68>>2]=c>>>0>(f[e+-64>>2]|0)>>>0?c:0;f[e+96>>2]=o;f[e+100>>2]=r;f[e+104>>2]=n;f[e+108>>2]=i;f[e+112>>2]=a;f[e+116>>2]=s;f[e+120>>2]=l;t=t+1|0;if((t|0)==(u|0))break;else e=e+148|0}return}function Ur(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=f[t+76>>2]|0;if((e|0)>-1)a=e;else{r=0;return r|0}e:while(1){switch(h[i+a>>0]|0){case 82:{o=3;break e}case 67:{o=5;break e}case 76:{o=7;break e}case 80:{o=9;break e}default:{}}a=a+-1|0}if((o|0)==3)if((f[s+(r*5640|0)+424+(n*148|0)+128>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+88>>2]|0))return(Ur(e+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}else if((o|0)==5)if((f[s+(r*5640|0)+424+(n*148|0)+132>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+92>>2]|0))return(Ur(e+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}else if((o|0)==7)if((f[s+(r*5640|0)+424+(n*148|0)+124>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+84>>2]|0))return(Ur(e+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}else if((o|0)==9){if((f[s+(r*5640|0)+424+(n*148|0)+36>>2]|0)>>>0<2)if((f[s+(r*5640|0)+424+(n*148|0)+136>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+96>>2]|0))return(Ur(a+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}if((f[s+(r*5640|0)+424+(n*148|0)+140>>2]|0)!=(f[s+(r*5640|0)+424+(n*148|0)+104>>2]|0)){r=1;return r|0}if((f[s+(r*5640|0)+424+(n*148|0)+144>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+112>>2]|0))return(Ur(a+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}}return 0}function Br(e){e=e|0;var t=0,r=0;t=qi(1,44)|0;if(!t){e=0;return e|0}r=t+40|0;h[r>>0]=h[r>>0]&-2|(e|0)!=0;e=qi(1,4)|0;f[t+20>>2]=e;if(e){r=t;return r|0}Qi(t);r=0;return r|0}function zr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0;B=b;b=b+1200|0;U=B;n=f[f[e+20>>2]>>2]|0;F=n+16|0;i=f[F>>2]|0;if(!i){b=B;return}H=n+20|0;D=(f[e+32>>2]|0)+8|0;N=(f[e+28>>2]|0)+88|0;I=e+24|0;O=(t|0)==0;C=(r|0)==0;L=t+-1|0;n=i;P=0;do{s=f[H>>2]|0;l=f[D>>2]|0;A=f[s+(P*52|0)+16>>2]|0;if(l){if(A){e=f[N>>2]|0;a=+((f[(f[(f[I>>2]|0)+24>>2]|0)+(P*52|0)+24>>2]|0)>>>0)*.0625;i=0;do{r=ce(A,i)|0;o=0;do{k=(r+o|0)*3|0;f[U+(i*120|0)+(o*12|0)>>2]=~~(+(f[e+(k<<2)>>2]|0)*a);f[U+(i*120|0)+(o*12|0)+4>>2]=~~(+(f[e+(k+1<<2)>>2]|0)*a);f[U+(i*120|0)+(o*12|0)+8>>2]=~~(+(f[e+(k+2<<2)>>2]|0)*a);o=o+1|0}while(o>>>0<A>>>0);i=i+1|0}while(i>>>0<l>>>0);k=9}}else k=9;if((k|0)==9){k=0;if(A){w=s+(P*52|0)+24|0;R=0;do{x=f[w>>2]|0;T=x+(R*136|0)+24|0;n=f[T>>2]|0;if(n){S=x+(R*136|0)+16|0;M=x+(R*136|0)+20|0;e=f[M>>2]|0;r=f[S>>2]|0;E=0;do{if(ce(e,r)|0){g=x+(R*136|0)+28+(E*36|0)+20|0;y=U+(t*120|0)+(R*12|0)+(E<<2)|0;_=U+(L*120|0)+(R*12|0)+(E<<2)|0;v=0;do{n=f[g>>2]|0;m=ce(f[n+(v*40|0)+20>>2]|0,f[n+(v*40|0)+16>>2]|0)|0;if(m){c=n+(v*40|0)+24|0;h=f[y>>2]|0;p=0;do{l=f[c>>2]|0;u=l+(p*52|0)|0;d=f[l+(p*52|0)+4>>2]|0;n=(f[(f[(f[I>>2]|0)+24>>2]|0)+(P*52|0)+24>>2]|0)-(f[l+(p*52|0)+28>>2]|0)|0;if(!O){e=f[_>>2]|0;r=h-e|0;if((e|0)<=(n|0)){r=r+(e-n)|0;r=(r|0)<0?0:r}}else{f[l+(p*52|0)+44>>2]=0;r=(h|0)>(n|0)?h-n|0:0}s=l+(p*52|0)+44|0;i=f[s>>2]|0;o=(i|0)==0;if(o)if(!r)r=0;else r=(r*3|0)+-2|0;else r=(r*3|0)+i|0;f[d+(t*24|0)>>2]=r-i;do{if((r|0)!=(i|0)){e=f[l+(p*52|0)+8>>2]|0;n=f[e+((r+-1|0)*24|0)>>2]|0;if(o)f[d+(t*24|0)+16>>2]=f[u>>2];else{l=f[e+((i+-1|0)*24|0)>>2]|0;f[d+(t*24|0)+16>>2]=(f[u>>2]|0)+l;n=n-l|0}f[d+(t*24|0)+4>>2]=n;if(C)break;f[s>>2]=r}}while(0);p=p+1|0}while(p>>>0<m>>>0);e=f[M>>2]|0;r=f[S>>2]|0}v=v+1|0}while(v>>>0<(ce(e,r)|0)>>>0);n=f[T>>2]|0}E=E+1|0}while(E>>>0<n>>>0)}R=R+1|0}while(R>>>0<A>>>0);n=f[F>>2]|0}}P=P+1|0}while(P>>>0<n>>>0);b=B;return}function jr(e,t,r,n){e=e|0;t=t|0;r=+r;n=n|0;var i=0,a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0;e=f[f[e+20>>2]>>2]|0;L=e+40+(t<<3)|0;y[L>>3]=0.0;I=e+16|0;i=f[I>>2]|0;if(!i)return;P=e+20|0;C=(t|0)==0;k=(n|0)==0;e=i;A=0;do{i=f[P>>2]|0;R=f[i+(A*52|0)+16>>2]|0;if(R){E=i+(A*52|0)+24|0;M=0;do{w=f[E>>2]|0;x=w+(M*136|0)+24|0;e=f[x>>2]|0;if(e){T=w+(M*136|0)+16|0;S=w+(M*136|0)+20|0;i=f[S>>2]|0;n=f[T>>2]|0;b=0;do{if(ce(i,n)|0){_=w+(M*136|0)+28+(b*36|0)+20|0;g=0;do{e=f[_>>2]|0;v=ce(f[e+(g*40|0)+20>>2]|0,f[e+(g*40|0)+16>>2]|0)|0;if(v){h=e+(g*40|0)+24|0;m=0;do{l=f[h>>2]|0;u=l+(m*52|0)|0;d=f[l+(m*52|0)+4>>2]|0;p=l+(m*52|0)+44|0;if(C){f[p>>2]=0;c=0}else c=f[p>>2]|0;n=f[l+(m*52|0)+48>>2]|0;if(c>>>0<n>>>0){o=f[l+(m*52|0)+8>>2]|0;e=c;s=c;do{i=f[o+(s*24|0)>>2]|0;a=+y[o+(s*24|0)+8>>3];if(e){H=e+-1|0;a=a-+y[o+(H*24|0)+8>>3];i=i-(f[o+(H*24|0)>>2]|0)|0}do{if(!i){if(!(a!=0.0))break;e=s+1|0}else{if(!(r-a/+(i>>>0)<2.220446049250313e-16))break;e=s+1|0}}while(0);s=s+1|0}while(s>>>0<n>>>0);o=e;f[d+(t*24|0)>>2]=o-c;if((o|0)!=(c|0)){n=o+-1|0;i=f[l+(m*52|0)+8>>2]|0;e=f[i+(n*24|0)>>2]|0;if(!c){f[d+(t*24|0)+16>>2]=f[u>>2];a=+y[i+(n*24|0)+8>>3]}else{c=c+-1|0;H=f[i+(c*24|0)>>2]|0;f[d+(t*24|0)+16>>2]=(f[u>>2]|0)+H;a=+y[i+(n*24|0)+8>>3]-+y[i+(c*24|0)+8>>3];e=e-H|0}f[d+(t*24|0)+4>>2]=e;y[d+(t*24|0)+8>>3]=a;y[L>>3]=a+ +y[L>>3];if(!k)f[p>>2]=o}else O=26}else{f[d+(t*24|0)>>2]=0;O=26}if((O|0)==26){O=0;y[d+(t*24|0)+8>>3]=0.0}m=m+1|0}while(m>>>0<v>>>0);i=f[S>>2]|0;n=f[T>>2]|0}g=g+1|0}while(g>>>0<(ce(i,n)|0)>>>0);e=f[x>>2]|0}b=b+1|0}while(b>>>0<e>>>0)}M=M+1|0}while(M>>>0<R>>>0);e=f[I>>2]|0}A=A+1|0}while(A>>>0<e>>>0);return}function Vr(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0.0,l=0.0,u=0.0,c=0.0,p=0.0,m=0.0,v=0,_=0,E=0,w=0,x=0.0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0.0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0;Y=b;b=b+800|0;X=Y;V=f[e+28>>2]|0;G=f[f[e+20>>2]>>2]|0;W=f[e+32>>2]|0;B=G+24|0;f[B>>2]=0;z=f[G+16>>2]|0;if(!z){a=0;H=0.0;s=0.0;u=1797693134862315708145274.0e284}else{F=f[G+20>>2]|0;U=f[(f[e+24>>2]|0)+24>>2]|0;a=0;j=0;l=0.0;s=0.0;u=1797693134862315708145274.0e284;do{O=F+(j*52|0)+48|0;f[O>>2]=0;D=f[F+(j*52|0)+16>>2]|0;if(!D)o=0;else{N=f[F+(j*52|0)+24>>2]|0;o=0;I=0;do{P=f[N+(I*136|0)+24>>2]|0;if(P){C=ce(f[N+(I*136|0)+20>>2]|0,f[N+(I*136|0)+16>>2]|0)|0;L=(C|0)==0;k=0;do{if(!L){A=f[N+(I*136|0)+28+(k*36|0)+20>>2]|0;R=0;do{S=ce(f[A+(R*40|0)+20>>2]|0,f[A+(R*40|0)+16>>2]|0)|0;if(S){M=f[A+(R*40|0)+24>>2]|0;T=0;do{E=f[M+(T*52|0)+48>>2]|0;if(E){w=f[M+(T*52|0)+8>>2]|0;_=0;do{v=f[w+(_*24|0)>>2]|0;c=+y[w+(_*24|0)+8>>3];if(_){q=_+-1|0;c=c-+y[w+(q*24|0)+8>>3];v=v-(f[w+(q*24|0)>>2]|0)|0}do{if(v){c=c/+(v|0);u=c<u?c:u;if(!(c>l))break;l=c}}while(0);_=_+1|0}while(_>>>0<E>>>0)}q=ce((f[M+(T*52|0)+24>>2]|0)-(f[M+(T*52|0)+16>>2]|0)|0,(f[M+(T*52|0)+20>>2]|0)-(f[M+(T*52|0)+12>>2]|0)|0)|0;a=q+a|0;o=q+o|0;T=T+1|0}while(T>>>0<S>>>0);f[B>>2]=a;f[O>>2]=o}R=R+1|0}while(R>>>0<C>>>0)}k=k+1|0}while(k>>>0<P>>>0)}I=I+1|0}while(I>>>0<D>>>0)}H=+(1<<f[U+(j*52|0)+24>>2]|0)+-1.0;s=s+ +(o|0)*(H*H);j=j+1|0}while(j>>>0<z>>>0);H=l}O=(i|0)!=0;if(O){j=f[e+36>>2]|0;z=f[i+88>>2]|0;f[z+(j*592|0)+552>>2]=a;y[z+(j*592|0)+560>>3]=+y[G+32>>3];a=W+8|0;q=Yi(f[a>>2]<<3)|0;f[z+(j*592|0)>>2]=q;if(!q){q=0;b=Y;return q|0}}else a=W+8|0;if(!(f[a>>2]|0)){q=1;b=Y;return q|0}S=G+32|0;M=V+93|0;R=e+36|0;A=i+88|0;k=G+40|0;P=e+24|0;C=e+8|0;L=e+16|0;I=0;while(1){l=+g[W+20+(I<<2)>>2];if(l!=0.0){w=~~+ue(+l)>>>0;w=w>>>0<n>>>0?w:n}else w=n;m=+g[W+5184+(I<<2)>>2];x=+y[S>>3]-s/+$(10.0,+(m/10.0));q=h[M>>0]|0;if(!((q&1)!=0&l>0.0)?!((q&4)!=0&m>0.0):0)l=u;else{T=is(f[P>>2]|0,V)|0;if(!T){a=0;o=57;break}E=I+1|0;o=X+(I+-1<<3)|0;v=G+40+(I<<3)|0;if(!I){p=H;o=0;m=u;c=0.0;do{l=(m+p)*.5;jr(e,0,l,0);do{if(h[M>>0]&4){if(((d[V>>1]|0)+-3&65535)>=4){q=+y[k>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c;break}if(!(rs(T,f[R>>2]|0,G,E,t,r,w,i,f[C>>2]|0,f[e>>2]|0,f[L>>2]|0,0)|0))m=l;else{q=+y[k>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c}}else{q=(rs(T,f[R>>2]|0,G,E,t,r,w,i,f[C>>2]|0,f[e>>2]|0,f[L>>2]|0,0)|0)==0;p=q?p:l;m=q?l:m;c=q?c:l}}while(0);o=o+1|0}while((o|0)!=128)}else{p=H;_=0;m=u;c=0.0;do{l=(m+p)*.5;jr(e,I,l,0);do{if(h[M>>0]&4){if(((d[V>>1]|0)+-3&65535)>=4){q=+y[o>>3]+ +y[v>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c;break}if(!(rs(T,f[R>>2]|0,G,E,t,r,w,i,f[C>>2]|0,f[e>>2]|0,f[L>>2]|0,0)|0))m=l;else{q=+y[o>>3]+ +y[v>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c}}else{q=(rs(T,f[R>>2]|0,G,E,t,r,w,i,f[C>>2]|0,f[e>>2]|0,f[L>>2]|0,0)|0)==0;p=q?p:l;m=q?l:m;c=q?c:l}}while(0);_=_+1|0}while((_|0)!=128)}as(T);l=c==0.0?l:c}if(O)y[(f[(f[A>>2]|0)+((f[R>>2]|0)*592|0)>>2]|0)+(I<<3)>>3]=l;jr(e,I,l,1);if(!I)l=+y[k>>3];else l=+y[X+(I+-1<<3)>>3]+ +y[G+40+(I<<3)>>3];y[X+(I<<3)>>3]=l;I=I+1|0;if(I>>>0>=(f[a>>2]|0)>>>0){a=1;o=57;break}}if((o|0)==57){b=Y;return a|0}return 0}function Gr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;f[e+24>>2]=t;f[e+28>>2]=r;i=qi(1,848)|0;n=e+20|0;f[f[n>>2]>>2]=i;if(!i){e=0;return e|0}i=t+16|0;a=qi(f[i>>2]|0,52)|0;t=f[f[n>>2]>>2]|0;f[t+20>>2]=a;if(!a){a=0;return a|0}f[t+16>>2]=f[i>>2];f[e>>2]=f[r+84>>2];a=1;return a|0}function Wr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0;if(!e)return;y=e+20|0;t=f[y>>2]|0;do{if(t){g=(h[e+40>>0]&1)==0?3:4;r=f[t>>2]|0;if(r){p=r+20|0;l=r+16|0;if(f[l>>2]|0){c=0;d=f[p>>2]|0;while(1){u=d+24|0;t=f[u>>2]|0;if(t){o=f[d+28>>2]|0;s=(o>>>0)/136|0;if(o>>>0>135){o=0;while(1){a=t+48|0;r=f[a>>2]|0;if(r){n=f[t+52>>2]|0;i=(n>>>0)/40|0;if(n>>>0>39){n=0;while(1){_=r+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=r+36|0;fo(f[_>>2]|0);f[_>>2]=0;Cu[g&7](r);n=n+1|0;if(n>>>0>=i>>>0)break;else r=r+40|0}r=f[a>>2]|0}Qi(r);f[a>>2]=0}a=t+84|0;r=f[a>>2]|0;if(r){_=f[t+88>>2]|0;i=(_>>>0)/40|0;if(_>>>0>39){n=0;while(1){_=r+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=r+36|0;fo(f[_>>2]|0);f[_>>2]=0;Cu[g&7](r);n=n+1|0;if(n>>>0>=i>>>0)break;else r=r+40|0}r=f[a>>2]|0}Qi(r);f[a>>2]=0}a=t+120|0;r=f[a>>2]|0;if(r){_=f[t+124>>2]|0;i=(_>>>0)/40|0;if(_>>>0>39){n=0;while(1){_=r+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=r+36|0;fo(f[_>>2]|0);f[_>>2]=0;Cu[g&7](r);n=n+1|0;if(n>>>0>=i>>>0)break;else r=r+40|0}r=f[a>>2]|0}Qi(r);f[a>>2]=0}o=o+1|0;if(o>>>0>=s>>>0)break;else t=t+136|0}t=f[u>>2]|0}Qi(t);f[u>>2]=0}if((f[d+36>>2]|0)!=0?(m=d+32|0,v=f[m>>2]|0,(v|0)!=0):0){Ji(v);f[m>>2]=0;f[m+4>>2]=0;f[m+8>>2]=0;f[m+12>>2]=0}c=c+1|0;if(c>>>0>=(f[l>>2]|0)>>>0)break;else d=d+52|0}}Qi(f[p>>2]|0);f[p>>2]=0;Qi(f[f[y>>2]>>2]|0);t=f[y>>2]|0;f[t>>2]=0;if(!t)break}Qi(t);f[y>>2]=0}}while(0);Qi(e);return}function Xr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;n=e+32|0;i=f[n>>2]|0;t=e+40|0;r=f[t>>2]|0;if(i){a=e+44|0;if(r>>>0<=(f[a>>2]|0)>>>0){e=1;return e|0}if(f[e+36>>2]|0){Ji(i);i=Zi(f[t>>2]|0)|0;f[n>>2]=i;if(!i){f[a>>2]=0;f[t>>2]=0;f[e+36>>2]=0;e=0;return e|0}else{f[a>>2]=f[t>>2];f[e+36>>2]=1;e=1;return e|0}}}a=Zi(r)|0;f[n>>2]=a;if(!a){e=0;return e|0}f[e+44>>2]=f[t>>2];f[e+36>>2]=1;e=1;return e|0}function Yr(e,t,r){e=e|0;t=t|0;r=r|0;return nn(e,t,1,1.0,52,r)|0}function qr(e,t,r){e=e|0;t=t|0;r=r|0;return nn(e,t,0,.5,56,r)|0}function Zr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0;r=f[e+24>>2]|0;i=f[r+16>>2]|0;if(!i){a=0;return a|0}a=0;t=0;n=f[r+24>>2]|0;r=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){s=f[n+24>>2]|0;s=((s&7|0)!=0&1)+(s>>>3)|0;o=f[r+24>>2]|0;e=(f[r+20>>2]|0)+-1|0;t=(ce(ce((s|0)==3?4:s,(f[o+(e*136|0)+8>>2]|0)-(f[o+(e*136|0)>>2]|0)|0)|0,(f[o+(e*136|0)+12>>2]|0)-(f[o+(e*136|0)+4>>2]|0)|0)|0)+t|0;a=a+1|0;if(a>>>0>=i>>>0)break;else{n=n+52|0;r=r+52|0}}return t|0}function Jr(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0;T=b;b=b+16|0;w=T;if(!(f[e+8>>2]|0)){f[e+36>>2]=t;_=e+28|0;o=f[(f[_>>2]|0)+76>>2]|0;x=e+32|0;f[x>>2]=o+(t*5640|0);E=(a|0)==0;y=e+20|0;if(!E){s=f[(f[f[y>>2]>>2]|0)+20>>2]|0;d=f[o+(t*5640|0)+5584>>2]|0;p=s+16|0;if(!(f[p>>2]|0)){s=a+88|0;o=0}else{l=f[s+24>>2]|0;s=a+88|0;u=f[s>>2]|0;c=0;o=0;do{g=l+(c*136|0)+16|0;f[u+(t*592|0)+20+(c<<2)>>2]=f[g>>2];v=l+(c*136|0)+20|0;f[u+(t*592|0)+152+(c<<2)>>2]=f[v>>2];o=(ce(f[v>>2]|0,f[g>>2]|0)|0)+o|0;f[u+(t*592|0)+284+(c<<2)>>2]=f[d+812+(c<<2)>>2];f[u+(t*592|0)+416+(c<<2)>>2]=f[d+944+(c<<2)>>2];c=c+1|0}while(c>>>0<(f[p>>2]|0)>>>0)}g=qi(ce(ce(f[a+52>>2]|0,o)|0,f[a+56>>2]|0)|0,32)|0;f[(f[s>>2]|0)+(t*592|0)+548>>2]=g;if(!g){e=0;b=T;return e|0}}o=f[f[y>>2]>>2]|0;g=o+16|0;if(!(f[g>>2]|0)){c=f[x>>2]|0;l=0;s=f[o+20>>2]|0}else{c=f[x>>2]|0;s=f[o+20>>2]|0;t=0;m=f[c+5584>>2]|0;v=s;while(1){d=f[v+32>>2]|0;p=ce((f[v+12>>2]|0)-(f[v+4>>2]|0)|0,(f[v+8>>2]|0)-(f[v>>2]|0)|0)|0;o=(p|0)==0;if((f[m+20>>2]|0)==1){if(!o){l=m+1076|0;u=0;o=d;while(1){f[o>>2]=(f[o>>2]|0)-(f[l>>2]|0);u=u+1|0;if((u|0)==(p|0))break;else o=o+4|0}}}else if(!o){l=m+1076|0;u=0;o=d;while(1){f[o>>2]=(f[o>>2]|0)-(f[l>>2]|0)<<11;u=u+1|0;if((u|0)==(p|0))break;else o=o+4|0}}t=t+1|0;l=f[g>>2]|0;if(t>>>0>=l>>>0)break;else{m=m+1080|0;v=v+52|0}}}d=ce((f[s+12>>2]|0)-(f[s+4>>2]|0)|0,(f[s+8>>2]|0)-(f[s>>2]|0)|0)|0;e:do{switch(f[c+16>>2]|0){case 0:break;case 2:{if(f[c+5608>>2]|0){u=Yi(l<<2)|0;if(!u){e=0;b=T;return e|0}o=f[g>>2]|0;if(!o)o=0;else{l=0;while(1){f[u+(l<<2)>>2]=f[s+32>>2];l=l+1|0;if((l|0)==(o|0))break;else s=s+52|0}}g=(Rr(f[(f[x>>2]|0)+5608>>2]|0,d,u,o,f[(f[(f[e+24>>2]|0)+24>>2]|0)+32>>2]|0)|0)==0;Qi(u);if(g){e=0;b=T;return e|0}}break}default:{l=f[s+32>>2]|0;u=f[s+84>>2]|0;o=f[s+136>>2]|0;if(!(f[(f[c+5584>>2]|0)+20>>2]|0)){Sr(l,u,o,d);break e}else{xr(l,u,o,d);break e}}}}while(0);o=f[f[y>>2]>>2]|0;s=o+16|0;e:do{if(f[s>>2]|0){l=0;u=f[(f[x>>2]|0)+5584>>2]|0;o=f[o+20>>2]|0;t:while(1){switch(f[u+20>>2]|0){case 1:{if(!(Lo(o)|0)){o=0;s=54;break t}break}case 0:{if(!(Do(o)|0)){o=0;s=54;break t}break}default:{}}l=l+1|0;if(l>>>0>=(f[s>>2]|0)>>>0)break e;else{u=u+1080|0;o=o+52|0}}if((s|0)==54){b=T;return o|0}}}while(0);o=f[x>>2]|0;s=Zo(1)|0;if(!s){e=0;b=T;return e|0}do{if((f[o+16>>2]|0)==1)if(!(f[(f[o+5584>>2]|0)+20>>2]|0)){l=wr()|0;u=3;break}else{l=Er()|0;u=3;break}else{l=f[o+5600>>2]|0;u=f[(f[e+24>>2]|0)+16>>2]|0}}while(0);y=Qo(s,f[f[y>>2]>>2]|0,o,l,u)|0;Jo(s);if(!y){e=0;b=T;return e|0}o=f[_>>2]|0;f[w>>2]=0;if(!E)f[a+12>>2]=0;if(!(h[o+93>>0]&5)){if(f[(f[x>>2]|0)+8>>2]|0){o=0;do{zr(e,o,1);o=o+1|0}while(o>>>0<(f[(f[x>>2]|0)+8>>2]|0)>>>0)}}else if(!(Vr(e,r,w,i,a)|0)){e=0;b=T;return e|0}}if(a)f[a+12>>2]=1;o=is(f[e+24>>2]|0,f[e+28>>2]|0)|0;if(!o)o=1;else{e=rs(o,f[e+36>>2]|0,f[f[e+20>>2]>>2]|0,f[(f[e+32>>2]|0)+8>>2]|0,r,n,i,a,f[e+4>>2]|0,f[e>>2]|0,f[e+16>>2]|0,1)|0;as(o);o=(e|0)==0}e=o&1^1;b=T;return e|0}function Kr(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,y=0,_=0;_=b;b=b+16|0;u=_+8|0;l=_;s=_+12|0;o=e+36|0;f[o>>2]=n;y=f[e+28>>2]|0;d=e+32|0;f[d>>2]=(f[y+76>>2]|0)+(n*5640|0);f[s>>2]=0;h=e+24|0;n=is(f[h>>2]|0,y)|0;if(!n){y=0;b=_;return y|0}c=e+20|0;y=ns(n,f[o>>2]|0,f[f[c>>2]>>2]|0,t,s,r,i,a)|0;as(n);if(!y){y=0;b=_;return y|0}n=f[f[c>>2]>>2]|0;e=f[(f[d>>2]|0)+5584>>2]|0;o=f[n+20>>2]|0;r=Zo(0)|0;if(!r){y=0;b=_;return y|0}s=n+16|0;e:do{if(f[s>>2]|0){i=0;n=o;while(1){if(!(Ko(r,n,e)|0))break;i=i+1|0;if(i>>>0>=(f[s>>2]|0)>>>0)break e;else{e=e+1080|0;n=n+52|0}}Jo(r);y=0;b=_;return y|0}}while(0);Jo(r);n=f[f[c>>2]>>2]|0;o=n+16|0;do{if(f[o>>2]|0){s=0;i=f[(f[h>>2]|0)+24>>2]|0;r=f[(f[d>>2]|0)+5584>>2]|0;e=f[n+20>>2]|0;while(1){n=(f[i+36>>2]|0)+1|0;if((f[r+20>>2]|0)==1){if(!(Io(e,n)|0)){n=0;e=49;break}}else if(!(Bo(e,n)|0)){n=0;e=49;break}s=s+1|0;if(s>>>0>=(f[o>>2]|0)>>>0){e=14;break}else{i=i+52|0;r=r+1080|0;e=e+52|0}}if((e|0)==14){n=f[f[c>>2]>>2]|0;break}else if((e|0)==49){b=_;return n|0}}}while(0);s=f[d>>2]|0;e=f[n+20>>2]|0;o=f[s+16>>2]|0;do{if(o){t=ce((f[e+12>>2]|0)-(f[e+4>>2]|0)|0,(f[e+8>>2]|0)-(f[e>>2]|0)|0)|0;r=n+16|0;n=f[r>>2]|0;if(n>>>0<=2){f[u>>2]=n;Qn(a,1,19703,u)|0;break}if((ce((f[e+64>>2]|0)-(f[e+56>>2]|0)|0,(f[e+60>>2]|0)-(f[e+52>>2]|0)|0)|0)>=(t|0)?(ce((f[e+116>>2]|0)-(f[e+108>>2]|0)|0,(f[e+112>>2]|0)-(f[e+104>>2]|0)|0)|0)>=(t|0):0){if((o|0)!=2){n=f[e+32>>2]|0;if((f[(f[s+5584>>2]|0)+20>>2]|0)==1){Tr(n,f[e+84>>2]|0,f[e+136>>2]|0,t);break}else{Mr(n,f[e+84>>2]|0,f[e+136>>2]|0,t);break}}i=s+5604|0;if(!(f[i>>2]|0))break;s=Yi(n<<2)|0;if(!s){y=0;b=_;return y|0}n=f[r>>2]|0;if(!n)n=0;else{o=0;while(1){f[s+(o<<2)>>2]=f[e+32>>2];o=o+1|0;if((o|0)==(n|0))break;else e=e+52|0}}y=(Ar(f[i>>2]|0,t,s,n,f[(f[(f[h>>2]|0)+24>>2]|0)+32>>2]|0)|0)==0;Qi(s);if(y)n=0;else break;b=_;return n|0}Qn(a,1,19642,l)|0;y=0;b=_;return y|0}}while(0);n=f[f[c>>2]>>2]|0;v=n+16|0;if(!(f[v>>2]|0)){y=1;b=_;return y|0}y=0;m=f[(f[h>>2]|0)+24>>2]|0;p=f[(f[d>>2]|0)+5584>>2]|0;d=f[n+20>>2]|0;while(1){h=f[d+24>>2]|0;a=f[m+36>>2]|0;o=f[h+(a*136|0)+8>>2]|0;s=f[h+(a*136|0)>>2]|0;c=o-s|0;i=f[h+(a*136|0)+12>>2]|0;a=f[h+(a*136|0)+4>>2]|0;h=(f[d+8>>2]|0)-(f[d>>2]|0)-c|0;n=f[m+24>>2]|0;if(!(f[m+32>>2]|0)){n=1<<n;u=0}else{u=1<<n+-1;n=u;u=0-u|0}l=n+-1|0;n=f[d+32>>2]|0;e=(i|0)==(a|0);if((f[p+20>>2]|0)==1){if(!e){r=(o|0)==(s|0);t=p+1076|0;s=i-a|0;i=0;while(1){if(!r){e=0;o=n;while(1){a=(f[t>>2]|0)+(f[o>>2]|0)|0;f[o>>2]=(a|0)<(u|0)?u:(a|0)>(l|0)?l:a;e=e+1|0;if((e|0)==(c|0))break;else o=o+4|0}n=n+(c<<2)|0}i=i+1|0;if((i|0)==(s|0))break;else n=n+(h<<2)|0}}}else if(!e){r=(o|0)==(s|0);t=p+1076|0;s=i-a|0;i=0;while(1){if(!r){e=0;o=n;while(1){a=Os(+g[o>>2])|0;a=(f[t>>2]|0)+a|0;f[o>>2]=(a|0)<(u|0)?u:(a|0)>(l|0)?l:a;e=e+1|0;if((e|0)==(c|0))break;else o=o+4|0}n=n+(c<<2)|0}i=i+1|0;if((i|0)==(s|0))break;else n=n+(h<<2)|0}}y=y+1|0;if(y>>>0>=(f[v>>2]|0)>>>0){n=1;break}else{m=m+52|0;p=p+1080|0;d=d+52|0}}b=_;return n|0}function Qr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,v=0;v=e+24|0;u=f[v>>2]|0;i=f[u+16>>2]|0;l=(i|0)==0;if(l){v=1;return v|0}a=0;n=0;o=f[u+24>>2]|0;s=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){c=f[o+24>>2]|0;c=((c&7|0)!=0&1)+(c>>>3)|0;p=f[s+24>>2]|0;m=(f[s+20>>2]|0)+-1|0;n=(ce(ce((c|0)==3?4:c,(f[p+(m*136|0)+8>>2]|0)-(f[p+(m*136|0)>>2]|0)|0)|0,(f[p+(m*136|0)+12>>2]|0)-(f[p+(m*136|0)+4>>2]|0)|0)|0)+n|0;a=a+1|0;if((a|0)==(i|0))break;else{o=o+52|0;s=s+52|0}}n=n>>>0>r>>>0;if(n|l){v=n&1^1;return v|0}m=0;p=f[u+24>>2]|0;c=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){l=f[p+24>>2]|0;e=f[c+24>>2]|0;r=f[p+36>>2]|0;a=f[e+(r*136|0)+8>>2]|0;o=f[e+(r*136|0)>>2]|0;u=a-o|0;s=f[e+(r*136|0)+12>>2]|0;r=f[e+(r*136|0)+4>>2]|0;e=(f[c+8>>2]|0)-(f[c>>2]|0)-u|0;l=((l&7|0)!=0&1)+(l>>>3)|0;e:do{switch(((l|0)==3?4:l)|0){case 1:{n=f[c+32>>2]|0;i=(s|0)==(r|0);if(!(f[p+32>>2]|0)){if(i)break e;l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+u|0;a=0;i=n;while(1){h[t>>0]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+1|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}else{if(i)break e;l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+u|0;a=0;i=n;while(1){h[t>>0]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+1|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}break}case 2:{n=f[c+32>>2]|0;i=(s|0)==(r|0);if(!(f[p+32>>2]|0)){if(!i){l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+(u<<1)|0;a=0;i=n;while(1){d[t>>1]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+2|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}}else if(!i){l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+(u<<1)|0;a=0;i=n;while(1){d[t>>1]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+2|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}break}case 4:{if((s|0)!=(r|0)){l=(a|0)==(o|0);s=s-r|0;r=0;n=f[c+32>>2]|0;while(1){if(!l){o=t+(u<<2)|0;a=0;i=n;while(1){f[t>>2]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+4|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}break}default:{}}}while(0);m=m+1|0;if(m>>>0>=(f[(f[v>>2]|0)+16>>2]|0)>>>0){t=1;break}else{p=p+52|0;c=c+52|0}}return t|0}function $r(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;r=f[e+24>>2]|0;i=f[r+16>>2]|0;if(!i){a=0;return a|0}a=0;t=0;n=f[r+24>>2]|0;r=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){e=f[n+24>>2]|0;e=((e&7|0)!=0&1)+(e>>>3)|0;t=(ce(ce((f[r+12>>2]|0)-(f[r+4>>2]|0)|0,(f[r+8>>2]|0)-(f[r>>2]|0)|0)|0,(e|0)==3?4:e)|0)+t|0;a=a+1|0;if(a>>>0>=i>>>0)break;else{n=n+52|0;r=r+52|0}}return t|0}function en(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,v=0;u=f[e+24>>2]|0;v=u+16|0;i=f[v>>2]|0;l=(i|0)==0;if(l)n=0;else{a=0;n=0;o=f[u+24>>2]|0;s=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){c=f[o+24>>2]|0;c=((c&7|0)!=0&1)+(c>>>3)|0;n=(ce(ce((f[s+12>>2]|0)-(f[s+4>>2]|0)|0,(f[s+8>>2]|0)-(f[s>>2]|0)|0)|0,(c|0)==3?4:c)|0)+n|0;a=a+1|0;if((a|0)==(i|0))break;else{o=o+52|0;s=s+52|0}}}n=(n|0)!=(r|0);if(n|l){v=n&1^1;return v|0}c=0;l=f[u+24>>2]|0;r=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){e=f[l+24>>2]|0;n=(f[r+8>>2]|0)-(f[r>>2]|0)|0;i=(f[r+12>>2]|0)-(f[r+4>>2]|0)|0;s=ce(i,n)|0;e=((e&7|0)!=0&1)+(e>>>3)|0;e:do{switch(((e|0)==3?4:e)|0){case 1:{i=f[r+32>>2]|0;n=(s|0)==0;if(!(f[l+32>>2]|0)){if(n)break e;else{a=0;n=i;i=t}while(1){f[n>>2]=p[i>>0];a=a+1|0;if((a|0)==(s|0))break;else{n=n+4|0;i=i+1|0}}t=t+s|0;break e}else{if(n)break e;else{a=0;n=i;i=t}while(1){f[n>>2]=h[i>>0];a=a+1|0;if((a|0)==(s|0))break;else{n=n+4|0;i=i+1|0}}t=t+s|0;break e}}case 2:{o=f[r+32>>2]|0;a=(s|0)==0;if(!(f[l+32>>2]|0)){if(!a){a=t+(ce(i<<1,n)|0)|0;i=0;n=o;while(1){f[n>>2]=m[t>>1];i=i+1|0;if((i|0)==(s|0))break;else{n=n+4|0;t=t+2|0}}t=a}}else if(!a){a=t+(ce(i<<1,n)|0)|0;i=0;n=o;while(1){f[n>>2]=d[t>>1];i=i+1|0;if((i|0)==(s|0))break;else{n=n+4|0;t=t+2|0}}t=a}break}case 4:{if(s){a=t+(ce(i<<2,n)|0)|0;n=0;i=f[r+32>>2]|0;while(1){f[i>>2]=f[t>>2];n=n+1|0;if((n|0)==(s|0))break;else{i=i+4|0;t=t+4|0}}t=a}break}default:{}}}while(0);c=c+1|0;if(c>>>0>=(f[v>>2]|0)>>>0){t=1;break}else{l=l+52|0;r=r+52|0}}return t|0}function tn(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=e+24|0;t=f[a>>2]|0;if(!t)return;i=f[e+28>>2]|0;n=(i>>>0)/52|0;if(i>>>0>51){i=0;while(1){e=f[t>>2]|0;if(e){Qi(e+-1|0);f[t>>2]=0}e=t+4|0;r=f[e>>2]|0;if(r){Qi(r);f[e>>2]=0}e=t+8|0;r=f[e>>2]|0;if(r){Qi(r);f[e>>2]=0}i=i+1|0;if(i>>>0>=n>>>0)break;else t=t+52|0}t=f[a>>2]|0}Qi(t);f[a>>2]=0;return}function rn(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=e+24|0;t=f[a>>2]|0;if(!t)return;i=f[e+28>>2]|0;n=(i>>>0)/56|0;if(i>>>0>55){i=0;while(1){e=f[t>>2]|0;if(e){Qi(e);f[t>>2]=0}r=t+4|0;e=f[r>>2]|0;if(e){Qi(e);f[r>>2]=0}i=i+1|0;if(i>>>0>=n>>>0)break;else t=t+56|0}t=f[a>>2]|0}Qi(t);f[a>>2]=0;return}function nn(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=+n;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,J=0,K=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ve=0,ge=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Se=0,Me=0,Re=0,Ae=0,ke=0,Pe=0,Ce=0,Le=0,Ie=0,Oe=0,He=0,De=0,Ne=0,Fe=0,Ue=0,Be=0,ze=0,je=0,Ve=0,Ge=0,We=0.0;Ge=b;b=b+80|0;Ne=Ge+64|0;De=Ge+56|0;Ue=Ge+48|0;ze=Ge+40|0;Be=Ge+32|0;je=Ge+24|0;Fe=Ge+16|0;He=Ge+8|0;o=f[e+28>>2]|0;Oe=f[f[e+20>>2]>>2]|0;d=f[(f[o+76>>2]|0)+(t*5640|0)+5584>>2]|0;p=f[Oe+20>>2]|0;u=f[e+24>>2]|0;c=f[u+24>>2]|0;Ce=f[o+24>>2]|0;l=f[o+12>>2]|0;Ie=(ce(l,(t>>>0)%(Ce>>>0)|0)|0)+(f[o+4>>2]|0)|0;s=f[u>>2]|0;s=Ie>>>0>s>>>0?Ie:s;f[Oe>>2]=s;Ie=Wl(l|0,0,Ie|0,0)|0;Ie=Ie|0-B;l=f[u+8>>2]|0;l=Ie>>>0<l>>>0?Ie:l;Ie=Oe+8|0;f[Ie>>2]=l;Le=f[o+16>>2]|0;Ce=(ce(Le,(t>>>0)/(Ce>>>0)|0)|0)+(f[o+8>>2]|0)|0;t=f[u+4>>2]|0;t=Ce>>>0>t>>>0?Ce:t;Pe=Oe+4|0;f[Pe>>2]=t;Ce=Wl(Le|0,0,Ce|0,0)|0;Ce=Ce|0-B;u=f[u+12>>2]|0;u=Ce>>>0<u>>>0?Ce:u;Ce=Oe+12|0;f[Ce>>2]=u;if(!(f[d+4>>2]|0)){Qn(a,1,19777,Ge)|0;Ve=0;b=Ge;return Ve|0}Le=Oe+16|0;if(!(f[Le>>2]|0)){Ve=1;b=Ge;return Ve|0}ke=o+80|0;Ae=e+40|0;Re=(r|0)==0;o=t;Me=0;e:while(1){f[c+36>>2]=0;Ee=f[c>>2]|0;t=(s+-1+Ee|0)/(Ee|0)|0;f[p>>2]=t;we=f[c+4>>2]|0;o=(o+-1+we|0)/(we|0)|0;Se=p+4|0;f[Se>>2]=o;Ee=(l+-1+Ee|0)/(Ee|0)|0;Te=p+8|0;f[Te>>2]=Ee;we=(u+-1+we|0)/(we|0)|0;xe=p+12|0;f[xe>>2]=we;t=Ee-t|0;o=we-o|0;if((4294967295/(t>>>0)|0)>>>0<o>>>0){Ve=6;break}t=ce(o,t)|0;if(t>>>0>1073741823){Ve=8;break}l=t<<2;Ee=f[d+4>>2]|0;we=p+16|0;f[we>>2]=Ee;e=f[ke>>2]|0;f[p+20>>2]=Ee>>>0<e>>>0?1:Ee-e|0;e=p+40|0;f[e>>2]=l;do{if(h[Ae>>0]&1){r=p+32|0;s=f[r>>2]|0;if(s){o=p+44|0;if(l>>>0<=(f[o>>2]|0)>>>0)break;t=p+36|0;if(f[t>>2]|0){Ji(s);Ee=Zi(f[e>>2]|0)|0;f[r>>2]=Ee;if(!Ee){Ve=16;break e}f[o>>2]=f[e>>2];f[t>>2]=1;break}}Ee=Zi(l)|0;f[r>>2]=Ee;if(!Ee)break e;f[p+44>>2]=f[e>>2];f[p+36>>2]=1}}while(0);r=(f[we>>2]|0)*136|0;o=p+24|0;e=f[o>>2]|0;if(e){t=p+28|0;if(r>>>0>(f[t>>2]|0)>>>0){e=Ki(e,r)|0;if(!e){Ve=24;break}f[o>>2]=e;Ee=f[t>>2]|0;Vl(e+Ee|0,0,r-Ee|0)|0;f[t>>2]=r}}else{t=Yi(r)|0;f[o>>2]=t;if(!t){t=0;Ve=87;break}f[p+28>>2]=r;Vl(t|0,0,r|0)|0}t=f[we>>2]|0;Ee=(f[d+20>>2]|0)==0?7:8;if(t){ge=d+8|0;ye=d+12|0;_e=c+24|0;be=d+804|0;ve=f[o>>2]|0;o=d+28|0;e=0;while(1){pe=t;me=t+-1|0;he=f[p>>2]|0;de=Gl(1,0,me|0)|0;de=Wl(de|0,B|0,-1,-1)|0;fe=B;he=Wl(de|0,fe|0,he|0,((he|0)<0)<<31>>31|0)|0;he=jl(he|0,B|0,me|0)|0;f[ve>>2]=he;r=f[Se>>2]|0;r=Wl(de|0,fe|0,r|0,((r|0)<0)<<31>>31|0)|0;r=jl(r|0,B|0,me|0)|0;f[ve+4>>2]=r;t=f[Te>>2]|0;t=Wl(de|0,fe|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,me|0)|0;f[ve+8>>2]=t;s=f[xe>>2]|0;s=Wl(de|0,fe|0,s|0,((s|0)<0)<<31>>31|0)|0;s=jl(s|0,B|0,me|0)|0;f[ve+12>>2]=s;m=f[d+812+(e<<2)>>2]|0;u=f[d+944+(e<<2)>>2]|0;v=he>>m<<m;y=r>>u<<u;l=Gl(1,0,u|0)|0;l=Wl(l|0,B|0,-1,-1)|0;l=Wl(l|0,B|0,s|0,((s|0)<0)<<31>>31|0)|0;l=jl(l|0,B|0,u|0)|0;if((he|0)==(t|0))t=0;else{he=Gl(1,0,m|0)|0;he=Wl(he|0,B|0,-1,-1)|0;t=Wl(he|0,B|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,m|0)|0;t=(t<<m)-v>>m}he=ve+16|0;f[he>>2]=t;se=(r|0)==(s|0)?0:(l<<u)-y>>u;f[ve+20>>2]=se;se=ce(se,t)|0;le=se*40|0;ue=(e|0)==0;if(ue)t=1;else{v=Wl(v|0,((v|0)<0)<<31>>31|0,1,0)|0;v=Xl(v|0,B|0,1)|0;y=Wl(y|0,((y|0)<0)<<31>>31|0,1,0)|0;y=Xl(y|0,B|0,1)|0;t=3;u=u+-1|0;m=m+-1|0}oe=ve+24|0;f[oe>>2]=t;G=f[ge>>2]|0;G=G>>>0<m>>>0?G:m;W=f[ye>>2]|0;W=W>>>0<u>>>0?W:u;X=(se|0)!=0;Y=(se|0)==0;q=1<<m;Z=1<<u;J=Gl(1,0,G|0)|0;J=Wl(J|0,B|0,-1,-1)|0;K=B;Q=Gl(1,0,W|0)|0;Q=Wl(Q|0,B|0,-1,-1)|0;$=B;ee=1<<G;te=1<<W;re=Gl(1,0,pe|0)|0;re=Wl(re|0,B|0,-1,-1)|0;ne=B;ie=0;ae=ve+28|0;V=o;while(1){if(ue){t=f[p>>2]|0;t=Wl(de|0,fe|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,me|0)|0;o=f[Se>>2]|0;o=Wl(de|0,fe|0,o|0,((o|0)<0)<<31>>31|0)|0;o=jl(o|0,B|0,me|0)|0;r=f[Te>>2]|0;r=Wl(de|0,fe|0,r|0,((r|0)<0)<<31>>31|0)|0;r=jl(r|0,B|0,me|0)|0;l=f[xe>>2]|0;l=Wl(de|0,fe|0,l|0,((l|0)<0)<<31>>31|0)|0;l=jl(l|0,B|0,me|0)|0;s=0}else{s=ie+1|0;t=f[p>>2]|0;U=Gl(s&1|0,0,me|0)|0;U=zl(re|0,ne|0,U|0,B|0)|0;l=B;t=Wl(U|0,l|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,pe|0)|0;o=f[Se>>2]|0;z=Gl(s>>>1|0,0,me|0)|0;z=zl(re|0,ne|0,z|0,B|0)|0;j=B;o=Wl(z|0,j|0,o|0,((o|0)<0)<<31>>31|0)|0;o=jl(o|0,B|0,pe|0)|0;r=f[Te>>2]|0;r=Wl(U|0,l|0,r|0,((r|0)<0)<<31>>31|0)|0;r=jl(r|0,B|0,pe|0)|0;l=f[xe>>2]|0;l=Wl(z|0,j|0,l|0,((l|0)<0)<<31>>31|0)|0;l=jl(l|0,B|0,pe|0)|0}f[ae+16>>2]=s;f[ae>>2]=t;j=ae+4|0;f[j>>2]=o;z=ae+8|0;f[z>>2]=r;U=ae+12|0;f[U>>2]=l;o=Ou[Ee&15](s)|0;We=+(f[V+4>>2]|0)*.00048828125+1.0;We=+Is(1.0,(f[_e>>2]|0)+o-(f[V>>2]|0)|0)*We*n;g[ae+32>>2]=We;f[ae+28>>2]=(f[V>>2]|0)+-1+(f[be>>2]|0);o=ae+20|0;r=f[o>>2]|0;if(!(X&(r|0)==0)){t=ae+24|0;if((f[t>>2]|0)>>>0<le>>>0){r=Ki(r,le)|0;if(!r){Ve=41;break e}f[o>>2]=r;F=f[t>>2]|0;Vl(r+F|0,0,le-F|0)|0;f[t>>2]=le}}else{t=Yi(le)|0;f[o>>2]=t;if(!t){t=0;Ve=87;break e}Vl(t|0,0,le|0)|0;f[ae+24>>2]=le}if(!Y){N=f[o>>2]|0;F=0;while(1){P=f[he>>2]|0;O=(((F>>>0)%(P>>>0)|0)<<m)+v|0;P=(((F>>>0)/(P>>>0)|0)<<u)+y|0;C=O+q|0;L=P+Z|0;I=f[ae>>2]|0;I=(O|0)>(I|0)?O:I;f[N>>2]=I;O=f[j>>2]|0;O=(P|0)>(O|0)?P:O;P=N+4|0;f[P>>2]=O;D=f[z>>2]|0;D=(C|0)<(D|0)?C:D;C=N+8|0;f[C>>2]=D;s=f[U>>2]|0;s=(L|0)<(s|0)?L:s;L=N+12|0;f[L>>2]=s;I=I>>G<<G;O=O>>W<<W;D=Wl(J|0,K|0,D|0,((D|0)<0)<<31>>31|0)|0;D=jl(D|0,B|0,G|0)|0;s=Wl(Q|0,$|0,s|0,((s|0)<0)<<31>>31|0)|0;s=jl(s|0,B|0,W|0)|0;D=(D<<G)-I>>G;H=N+16|0;f[H>>2]=D;s=(s<<W)-O>>W;_=N+20|0;f[_>>2]=s;D=ce(s,D)|0;s=ce(D,i)|0;o=N+24|0;r=f[o>>2]|0;do{if((r|0)==0&(D|0)!=0){t=Yi(s)|0;f[o>>2]=t;if(!t){t=0;Ve=87;break e}Vl(t|0,0,s|0)|0;f[N+28>>2]=s}else{t=N+28|0;if(s>>>0<=(f[t>>2]|0)>>>0)break;r=Ki(r,s)|0;if(!r){Ve=50;break e}f[o>>2]=r;k=f[t>>2]|0;Vl(r+k|0,0,s-k|0)|0;f[t>>2]=s}}while(0);l=N+32|0;t=f[l>>2]|0;r=f[H>>2]|0;s=f[_>>2]|0;if(!t)t=an(r,s,a)|0;else t=ho(t,r,s,a)|0;f[l>>2]=t;if(!t)Qn(a,2,19990,De)|0;l=N+36|0;r=f[l>>2]|0;s=f[H>>2]|0;t=f[_>>2]|0;if(!r)t=an(s,t,a)|0;else t=ho(r,s,t,a)|0;f[l>>2]=t;if(!t)Qn(a,2,20012,Ne)|0;if(D){k=0;do{M=f[H>>2]|0;S=(((k>>>0)%(M>>>0)|0)<<G)+I|0;M=(((k>>>0)/(M>>>0)|0)<<W)+O|0;R=S+ee|0;A=M+te|0;do{if(Re){t=f[o>>2]|0;r=t+(k*56|0)|0;s=f[r>>2]|0;if(!s){T=Yi(8192)|0;f[r>>2]=T;if(!T){t=0;Ve=87;break e}f[t+(k*56|0)+32>>2]=8192;T=qi(10,32)|0;f[t+(k*56|0)+4>>2]=T;if(!T){t=0;Ve=87;break e}f[t+(k*56|0)+52>>2]=10}else{l=t+(k*56|0)+32|0;_=f[l>>2]|0;E=t+(k*56|0)+4|0;w=f[E>>2]|0;x=r;T=x+52|0;do{f[x>>2]=0;x=x+4|0}while((x|0)<(T|0));f[r>>2]=s;f[l>>2]=_;f[E>>2]=w}T=f[N>>2]|0;f[t+(k*56|0)+8>>2]=(S|0)>(T|0)?S:T;S=f[P>>2]|0;f[t+(k*56|0)+12>>2]=(M|0)>(S|0)?M:S;M=f[C>>2]|0;f[t+(k*56|0)+16>>2]=(R|0)<(M|0)?R:M;R=f[L>>2]|0;f[t+(k*56|0)+20>>2]=(A|0)<(R|0)?A:R}else{r=f[o>>2]|0;t=r+(k*52|0)+4|0;if((f[t>>2]|0)==0?(T=qi(100,24)|0,f[t>>2]=T,(T|0)==0):0){t=0;Ve=87;break e}t=r+(k*52|0)+8|0;if((f[t>>2]|0)==0?(T=qi(100,24)|0,f[t>>2]=T,(T|0)==0):0){t=0;Ve=87;break e}l=f[N>>2]|0;l=(S|0)>(l|0)?S:l;f[r+(k*52|0)+12>>2]=l;t=f[P>>2]|0;M=(M|0)>(t|0)?M:t;f[r+(k*52|0)+16>>2]=M;t=f[C>>2]|0;t=(R|0)<(t|0)?R:t;f[r+(k*52|0)+20>>2]=t;R=f[L>>2]|0;A=(A|0)<(R|0)?A:R;f[r+(k*52|0)+24>>2]=A;l=ce(A-M|0,t-l<<2)|0;t=r+(k*52|0)+36|0;if(l>>>0<=(f[t>>2]|0)>>>0)break;s=r+(k*52|0)|0;r=f[s>>2]|0;if(r)Qi(r+-1|0);r=Yi(l|1)|0;f[s>>2]=r;if(!r){Ve=74;break e}f[t>>2]=l;h[r>>0]=0;f[s>>2]=(f[s>>2]|0)+1}}while(0);k=k+1|0}while(k>>>0<D>>>0)}F=F+1|0;if(F>>>0>=se>>>0)break;else N=N+40|0}}o=V+8|0;ie=ie+1|0;if(ie>>>0>=(f[oe>>2]|0)>>>0)break;else{ae=ae+36|0;V=o}}e=e+1|0;if(e>>>0<(f[we>>2]|0)>>>0){t=me;ve=ve+136|0}else break}}t=Me+1|0;if(t>>>0>=(f[Le>>2]|0)>>>0){t=1;Ve=87;break}s=f[Oe>>2]|0;o=f[Pe>>2]|0;l=f[Ie>>2]|0;u=f[Ce>>2]|0;Me=t;c=c+52|0;d=d+1080|0;p=p+52|0}if((Ve|0)==6){Qn(a,1,19816,He)|0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==8){Qn(a,1,19816,Fe)|0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==16){f[o>>2]=0;f[e>>2]=0;f[t>>2]=0}else if((Ve|0)==24){Qn(a,1,19849,Be)|0;Qi(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==41){Qn(a,1,19889,ze)|0;Qi(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==50){Qi(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;Qn(a,1,19932,Ue)|0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==74){f[t>>2]=0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==87){b=Ge;return t|0}Qn(a,1,19816,je)|0;Ve=0;b=Ge;return Ve|0}function an(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0;E=b;b=b+288|0;u=E+16|0;s=E+8|0;y=E+152|0;_=E+24|0;n=qi(1,20)|0;if(!n){Qn(r,1,20034,E)|0;_=0;b=E;return _|0}f[n>>2]=e;c=n+4|0;f[c>>2]=t;f[y>>2]=e;f[_>>2]=t;l=n+8|0;f[l>>2]=0;i=0;o=0;while(1){g=ce(t,e)|0;e=(e+1|0)/2|0;a=o+1|0;f[y+(a<<2)>>2]=e;t=(t+1|0)/2|0;f[_+(a<<2)>>2]=t;i=i+g|0;if(g>>>0<=1)break;else o=a}f[l>>2]=i;if(!i){Qi(n);Qn(r,2,20072,s)|0;_=0;b=E;return _|0}i=qi(i,16)|0;f[n+12>>2]=i;if(!i){Qn(r,1,20122,u)|0;Qi(n);_=0;b=E;return _|0}g=f[l>>2]|0;f[n+16>>2]=g<<4;t=i+((ce(f[c>>2]|0,f[n>>2]|0)|0)<<4)|0;if(!o)t=i;else{v=0;a=t;e=t;t=i;do{p=f[_+(v<<2)>>2]|0;e:do{if((p|0)>0){m=f[y+(v<<2)>>2]|0;if((m|0)<=0){l=p+-1|0;r=0;while(1){d=(r&1|0)!=0|(r|0)==(l|0);s=d?a:e;e=d?a:e+(m<<4)|0;r=r+1|0;if((r|0)>=(p|0)){a=s;break e}else a=s}}d=((m+2+((m|0)<2?~m:-3)|0)>>>1)+1|0;c=p+-1|0;h=0;do{r=m;u=a;while(1){f[t>>2]=u;s=t+16|0;l=r;r=r+-2|0;if((r|0)>-1){f[s>>2]=u;t=t+32|0}else t=s;if((l|0)<=2)break;else u=u+16|0}u=a+(d<<4)|0;r=(h&1|0)!=0|(h|0)==(c|0);a=r?u:e;e=r?u:e+(m<<4)|0;h=h+1|0}while((h|0)<(p|0))}}while(0);v=v+1|0}while((v|0)!=(o|0))}f[t>>2]=0;if(!g){_=n;b=E;return _|0}else t=0;while(1){f[i+4>>2]=999;f[i+8>>2]=0;f[i+12>>2]=0;t=t+1|0;if((t|0)==(g|0))break;else i=i+16|0}b=E;return n|0}function on(e){e=e|0;var t=0,r=0;if(!e)return;t=f[e+8>>2]|0;if(!t)return;r=0;e=f[e+12>>2]|0;while(1){f[e+4>>2]=999;f[e+8>>2]=0;f[e+12>>2]=0;r=r+1|0;if(r>>>0>=t>>>0)break;else e=e+16|0}return}function sn(e){e=e|0;var t=0;t=b;b=b+e|0;b=b+15&-16;return t|0}function ln(){return b|0}function un(e){e=e|0;b=e}function cn(e,t){e=e|0;t=t|0;b=e;E=t}function hn(e,t){e=e|0;t=t|0;if(!S){S=e;M=t}}function dn(e){e=e|0;h[w>>0]=h[e>>0];h[w+1>>0]=h[e+1>>0];h[w+2>>0]=h[e+2>>0];h[w+3>>0]=h[e+3>>0]}function fn(e){e=e|0;h[w>>0]=h[e>>0];h[w+1>>0]=h[e+1>>0];h[w+2>>0]=h[e+2>>0];h[w+3>>0]=h[e+3>>0];h[w+4>>0]=h[e+4>>0];h[w+5>>0]=h[e+5>>0];h[w+6>>0]=h[e+6>>0];h[w+7>>0]=h[e+7>>0]}function pn(e){e=e|0;B=e}function mn(){return B|0}function vn(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,u=0,c=0,h=0,d=0;d=b;b=b+8272|0;l=d+16|0;c=d+12|0;s=d;f[c>>2]=0;if((f[e>>2]|0)==1375686655)h=di(0)|0;else h=di(2)|0;si(h,1,0)|0;li(h,2,0)|0;ui(h,3,0)|0;fi(l);f[s>>2]=e;f[s+4>>2]=e;f[s+8>>2]=t;u=ci(s,1)|0;if(!(pi(h,l)|0)){fl(4476)|0;Nn(u);Ci(h);a=1;b=d;return a|0}if(!(mi(u,h,c)|0)){fl(4528)|0;Nn(u);Ci(h);ni(f[c>>2]|0);a=1;b=d;return a|0}if(!(bi(h,u,f[c>>2]|0,f[l+8228>>2]|0)|0)){fl(4578)|0;Ci(h);Nn(u);ni(f[c>>2]|0);a=1;b=d;return a|0}s=f[c>>2]|0;f[i>>2]=f[s+8>>2];f[a>>2]=f[s+12>>2];e=f[s+16>>2]|0;f[o>>2]=e;e=ce(ce(e<<2,f[i>>2]|0)|0,f[a>>2]|0)|0;f[n>>2]=e;n=Ll(e)|0;f[r>>2]=n;switch(f[o>>2]|0){case 1:{Yl(n|0,f[(f[s+24>>2]|0)+44>>2]|0,e|0)|0;break}case 3:{if((ce(f[a>>2]|0,f[i>>2]|0)|0)>0){t=f[s+24>>2]|0;s=f[t+44>>2]|0;e=f[t+96>>2]|0;t=f[t+148>>2]|0;l=0;do{o=l*3|0;f[n+(o<<2)>>2]=f[s+(l<<2)>>2];f[n+(o+1<<2)>>2]=f[e+(l<<2)>>2];f[n+(o+2<<2)>>2]=f[t+(l<<2)>>2];l=l+1|0}while((l|0)<(ce(f[a>>2]|0,f[i>>2]|0)|0))}break}default:{}}Nn(u);Ci(h);ni(f[c>>2]|0);a=0;b=d;return a|0}function gn(){return hi()|0}function yn(e,t){e=e|0;t=t|0;return}function _n(e,t){e=e|0;t=t|0;return}function bn(e,t){e=e|0;t=t|0;var r=0;t=b;b=b+16|0;r=t;f[r>>2]=e;dl(4625,r)|0;b=t;return}function En(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;f[i>>2]=t;if(!r){b=a;return}t=e;n=0;e=i+(r+-1)|0;while(1){h[t>>0]=h[e>>0]|0;n=n+1|0;if((n|0)==(r|0))break;else{t=t+1|0;e=e+-1|0}}b=a;return}function wn(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;f[t>>2]=0;if(!r)return;n=0;t=t+(r+-1)|0;while(1){h[t>>0]=h[e>>0]|0;n=n+1|0;if((n|0)==(r|0))break;else{e=e+1|0;t=t+-1|0}}return}function xn(e,t){e=e|0;t=+t;var r=0,n=0,i=0,a=0,o=0;r=b;b=b+16|0;a=r;y[a>>3]=t;a=a+8|0;y[w>>3]=t;n=f[w>>2]|0;i=f[w+4>>2]|0;o=Xl(n|0,i|0,56)|0;h[e>>0]=o;o=Xl(n|0,i|0,48)|0;h[e+1>>0]=o;o=Xl(n|0,i|0,40)|0;h[e+2>>0]=o;h[e+3>>0]=i;h[e+4>>0]=h[a+-5>>0]|0;h[e+5>>0]=h[a+-6>>0]|0;i=Xl(n|0,i|0,8)|0;h[e+6>>0]=i;h[e+7>>0]=n;b=r;return}function Tn(e,t){e=e|0;t=t|0;var r=0;r=t+8|0;h[r+-1>>0]=h[e>>0]|0;h[r+-2>>0]=h[e+1>>0]|0;h[r+-3>>0]=h[e+2>>0]|0;h[r+-4>>0]=h[e+3>>0]|0;h[r+-5>>0]=h[e+4>>0]|0;h[r+-6>>0]=h[e+5>>0]|0;h[r+-7>>0]=h[e+6>>0]|0;h[t>>0]=h[e+7>>0]|0;return}function Sn(e,t){e=e|0;t=+t;var r=0;r=(g[w>>2]=t,f[w>>2]|0);h[e>>0]=r>>>24;h[e+1>>0]=r>>>16;h[e+2>>0]=r>>>8;h[e+3>>0]=r;return}function Mn(e,t){e=e|0;t=t|0;var r=0;r=t+4|0;h[r+-1>>0]=h[e>>0]|0;h[r+-2>>0]=h[e+1>>0]|0;h[r+-3>>0]=h[e+2>>0]|0;h[t>>0]=h[e+3>>0]|0;return}function Rn(e,t){e=e|0;t=t|0;var r=0,n=0;n=qi(1,72)|0;if(!n){t=0;return t|0}f[n+64>>2]=e;e=Yi(e)|0;f[n+32>>2]=e;if(!e){Qi(n);t=0;return t|0}f[n+36>>2]=e;e=n+68|0;r=f[e>>2]|0;if(!t){f[e>>2]=r|1;f[n+40>>2]=31;f[n+44>>2]=32}else{f[e>>2]=r|2;f[n+40>>2]=29;f[n+44>>2]=30}f[n+16>>2]=4;f[n+20>>2]=5;f[n+24>>2]=6;f[n+28>>2]=7;t=n;return t|0}function An(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0;h=b;b=b+16|0;c=h;i=e+48|0;a=f[i>>2]|0;if(a>>>0>=t>>>0){c=e+36|0;f[c>>2]=(f[c>>2]|0)+t;f[i>>2]=a-t;c=e+56|0;e=c;e=Wl(f[e>>2]|0,f[e+4>>2]|0,t|0,r|0)|0;f[c>>2]=e;f[c+4>>2]=B;c=r;e=t;B=c;b=h;return e|0}u=e+68|0;if(f[u>>2]&4){c=e+36|0;f[c>>2]=(f[c>>2]|0)+a;f[i>>2]=0;e=e+56|0;c=e;c=Wl(f[c>>2]|0,f[c+4>>2]|0,a|0,0)|0;f[e>>2]=c;f[e+4>>2]=B;e=(a|0)!=0;c=e?0:-1;e=e?a:-1;B=c;b=h;return e|0}if(!a){a=0;i=0}else{f[e+36>>2]=f[e+32>>2];t=zl(t|0,r|0,a|0,0)|0;f[i>>2]=0;i=0;r=B}e:do{if((r|0)>0|(r|0)==0&t>>>0>0){l=e+24|0;while(1){o=ku[f[l>>2]&63](t,r,f[e>>2]|0)|0;s=B;if((o|0)==-1&(s|0)==-1)break;t=zl(t|0,r|0,o|0,s|0)|0;r=B;a=Wl(o|0,s|0,a|0,i|0)|0;i=B;if(!((r|0)>0|(r|0)==0&t>>>0>0))break e}Qn(n,4,4636,c)|0;f[u>>2]=f[u>>2]|4;e=e+56|0;c=e;c=Wl(f[c>>2]|0,f[c+4>>2]|0,a|0,i|0)|0;f[e>>2]=c;f[e+4>>2]=B;e=(a|0)!=0|(i|0)!=0;c=e?i:-1;e=e?a:-1;B=c;b=h;return e|0}}while(0);c=e+56|0;e=c;e=Wl(f[e>>2]|0,f[e+4>>2]|0,a|0,i|0)|0;f[c>>2]=e;f[c+4>>2]=B;c=i;e=a;B=c;b=h;return e|0}function kn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;f[e+36>>2]=f[e+32>>2];f[e+48>>2]=0;a=(ku[f[e+28>>2]&63](t,r,f[e>>2]|0)|0)==0;n=e+68|0;i=f[n>>2]|0;if(a){f[n>>2]=i|4;a=0;return a|0}else{f[n>>2]=i&-5;a=e+56|0;f[a>>2]=t;f[a+4>>2]=r;a=1;return a|0}return 0}function Pn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0;v=b;b=b+16|0;m=v+8|0;c=v;p=e+68|0;if(f[p>>2]&8){m=-1;e=-1;B=m;b=v;return e|0}l=e+32|0;i=f[l>>2]|0;d=e+36|0;f[d>>2]=i;u=e+48|0;a=f[u>>2]|0;do{if(a){s=e+20|0;while(1){o=ku[f[s>>2]&63](i,a,f[e>>2]|0)|0;if((o|0)==-1)break;i=(f[d>>2]|0)+o|0;f[d>>2]=i;g=f[u>>2]|0;a=g-o|0;f[u>>2]=a;if((g|0)==(o|0)){h=6;break}}if((h|0)==6){i=f[l>>2]|0;break}f[p>>2]=f[p>>2]|8;Qn(n,4,4662,c)|0;f[p>>2]=f[p>>2]|8;f[u>>2]=0;e=-1;g=-1;B=e;b=v;return g|0}}while(0);f[d>>2]=i;e:do{if((r|0)>0|(r|0)==0&t>>>0>0){l=e+24|0;a=0;i=0;while(1){o=ku[f[l>>2]&63](t,r,f[e>>2]|0)|0;s=B;if((o|0)==-1&(s|0)==-1)break;t=zl(t|0,r|0,o|0,s|0)|0;r=B;a=Wl(o|0,s|0,a|0,i|0)|0;i=B;if(!((r|0)>0|(r|0)==0&t>>>0>0))break e}Qn(n,4,4688,m)|0;f[p>>2]=f[p>>2]|8;g=e+56|0;e=g;e=Wl(f[e>>2]|0,f[e+4>>2]|0,a|0,i|0)|0;f[g>>2]=e;f[g+4>>2]=B;g=(a|0)!=0|(i|0)!=0;e=g?i:-1;g=g?a:-1;B=e;b=v;return g|0}else{a=0;i=0}}while(0);e=e+56|0;g=e;g=Wl(f[g>>2]|0,f[g+4>>2]|0,a|0,i|0)|0;f[e>>2]=g;f[e+4>>2]=B;e=i;g=a;B=e;b=v;return g|0}function Cn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;p=b;b=b+16|0;l=p;c=e+32|0;i=f[c>>2]|0;h=e+36|0;f[h>>2]=i;d=e+48|0;a=f[d>>2]|0;do{if(!a)a=e;else{s=e+20|0;while(1){o=ku[f[s>>2]&63](i,a,f[e>>2]|0)|0;if((o|0)==-1)break;i=(f[h>>2]|0)+o|0;f[h>>2]=i;m=f[d>>2]|0;a=m-o|0;f[d>>2]=a;if((m|0)==(o|0)){u=6;break}}if((u|0)==6){a=e;i=f[c>>2]|0;break}m=e+68|0;f[m>>2]=f[m>>2]|8;Qn(n,4,4662,l)|0;f[m>>2]=f[m>>2]|8;m=0;b=p;return m|0}}while(0);f[h>>2]=i;f[d>>2]=0;if(!(ku[f[e+28>>2]&63](t,r,f[a>>2]|0)|0)){m=e+68|0;f[m>>2]=f[m>>2]|8;m=0;b=p;return m|0}else{m=e+56|0;f[m>>2]=t;f[m+4>>2]=r;m=1;b=p;return m|0}return 0}function Ln(e,t,r){e=e|0;t=t|0;r=r|0;return-1}function In(e,t,r){e=e|0;t=t|0;r=r|0;return-1}function On(e,t,r){e=e|0;t=t|0;r=r|0;B=-1;return-1}function Hn(e,t,r){e=e|0;t=t|0;r=r|0;return 0}function Dn(e){e=e|0;var t=0,r=0,n=0;n=qi(1,72)|0;if(!n){e=0;return e|0}f[n+64>>2]=1048576;t=Yi(1048576)|0;f[n+32>>2]=t;if(!t){Qi(n);e=0;return e|0}f[n+36>>2]=t;t=n+68|0;r=f[t>>2]|0;if(!e){f[t>>2]=r|1;f[n+40>>2]=31;f[n+44>>2]=32}else{f[t>>2]=r|2;f[n+40>>2]=29;f[n+44>>2]=30}f[n+16>>2]=4;f[n+20>>2]=5;f[n+24>>2]=6;f[n+28>>2]=7;e=n;return e|0}function Nn(e){e=e|0;var t=0;if(!e)return;t=f[e+4>>2]|0;if(t)Cu[t&7](f[e>>2]|0);t=e+32|0;Qi(f[t>>2]|0);f[t>>2]=0;Qi(e);return}function Fn(e,t){e=e|0;t=t|0;if(!e)return;if(!(f[e+68>>2]&2))return;f[e+16>>2]=t;return}function Un(e,t){e=e|0;t=t|0;if(!e)return;f[e+28>>2]=t;return}function Bn(e,t){e=e|0;t=t|0;if(!e)return;if(!(f[e+68>>2]&1))return;f[e+20>>2]=t;return}function zn(e,t){e=e|0;t=t|0;if(!e)return;f[e+24>>2]=t;return}function jn(e,t,r){e=e|0;t=t|0;r=r|0;if(!e)return;f[e>>2]=t;f[e+4>>2]=r;return}function Vn(e,t,r){e=e|0;t=t|0;r=r|0;if(!e)return;e=e+8|0;f[e>>2]=t;f[e+4>>2]=r;return}function Gn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0;w=b;b=b+16|0;g=w+8|0;v=w;E=e+48|0;i=f[E>>2]|0;if(i>>>0>=r>>>0){_=e+36|0;Yl(t|0,f[_>>2]|0,r|0)|0;f[_>>2]=(f[_>>2]|0)+r;f[E>>2]=(f[E>>2]|0)-r;E=e+56|0;_=E;_=Wl(f[_>>2]|0,f[_+4>>2]|0,r|0,0)|0;f[E>>2]=_;f[E+4>>2]=B;E=r;b=w;return E|0}y=e+68|0;if(f[y>>2]&4){_=e+36|0;Yl(t|0,f[_>>2]|0,i|0)|0;n=f[E>>2]|0;f[_>>2]=(f[_>>2]|0)+n;_=e+56|0;y=_;n=Wl(f[y>>2]|0,f[y+4>>2]|0,n|0,0)|0;f[_>>2]=n;f[_+4>>2]=B;f[E>>2]=0;E=(i|0)!=0?i:-1;b=w;return E|0}if(!i){d=e+32|0;a=f[d>>2]|0;p=e+36|0;f[p>>2]=a;m=p;_=e+56|0;i=0}else{p=e+36|0;Yl(t|0,f[p>>2]|0,i|0)|0;d=e+32|0;a=f[d>>2]|0;f[p>>2]=a;m=f[E>>2]|0;_=e+56|0;c=_;c=Wl(f[c>>2]|0,f[c+4>>2]|0,m|0,0)|0;h=_;f[h>>2]=c;f[h+4>>2]=B;f[E>>2]=0;r=r-m|0;t=t+m|0;m=p}c=e+64|0;h=e+16|0;u=t;o=a;while(1){t=f[c>>2]|0;a=f[h>>2]|0;if(r>>>0<t>>>0){a=ku[a&63](o,t,f[e>>2]|0)|0;f[E>>2]=a;if((a|0)==-1){a=11;break}if(a>>>0>=r>>>0){t=u;a=14;break}Yl(u|0,f[m>>2]|0,a|0)|0;o=f[d>>2]|0;f[p>>2]=o;t=f[E>>2]|0;s=_;s=Wl(f[s>>2]|0,f[s+4>>2]|0,t|0,0)|0;l=B;i=a+i|0}else{t=ku[a&63](u,r,f[e>>2]|0)|0;f[E>>2]=t;if((t|0)==-1){a=16;break}i=t+i|0;if(t>>>0>=r>>>0){a=20;break}o=f[d>>2]|0;f[p>>2]=o;s=_;s=Wl(f[s>>2]|0,f[s+4>>2]|0,t|0,0)|0;l=B}a=_;f[a>>2]=s;f[a+4>>2]=l;f[E>>2]=0;r=r-t|0;u=u+t|0}if((a|0)==11){Qn(n,4,4636,v)|0;f[E>>2]=0;f[y>>2]=f[y>>2]|4;E=(i|0)!=0?i:-1;b=w;return E|0}else if((a|0)==14){Yl(t|0,f[m>>2]|0,r|0)|0;f[m>>2]=(f[m>>2]|0)+r;f[E>>2]=(f[E>>2]|0)-r;n=_;n=Wl(f[n>>2]|0,f[n+4>>2]|0,r|0,0)|0;E=_;f[E>>2]=n;f[E+4>>2]=B;E=i+r|0;b=w;return E|0}else if((a|0)==16){Qn(n,4,4636,g)|0;f[E>>2]=0;f[y>>2]=f[y>>2]|4;E=(i|0)!=0?i:-1;b=w;return E|0}else if((a|0)==20){n=_;n=Wl(f[n>>2]|0,f[n+4>>2]|0,t|0,0)|0;f[_>>2]=n;f[_+4>>2]=B;f[p>>2]=f[d>>2];f[E>>2]=0;E=i;b=w;return E|0}return 0}function Wn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0;_=b;b=b+16|0;v=_;h=e+68|0;if(f[h>>2]&8){y=-1;b=_;return y|0}m=e+64|0;i=f[m>>2]|0;y=e+48|0;l=f[y>>2]|0;a=i-l|0;do{if(a>>>0<r>>>0){d=e+32|0;o=e+36|0;p=e+20|0;s=e+56|0;u=i;c=a;i=0;e:while(1){if((u|0)==(l|0))a=f[d>>2]|0;else{Yl(f[o>>2]|0,t|0,c|0)|0;a=f[d>>2]|0;f[o>>2]=a;l=(f[y>>2]|0)+c|0;f[y>>2]=l;E=s;E=Wl(f[E>>2]|0,f[E+4>>2]|0,c|0,0)|0;u=s;f[u>>2]=E;f[u+4>>2]=B;r=r-c|0;t=t+c|0;i=c+i|0}f[o>>2]=a;if(!l)l=0;else{do{u=ku[f[p>>2]&63](a,l,f[e>>2]|0)|0;if((u|0)==-1)break e;a=(f[o>>2]|0)+u|0;f[o>>2]=a;E=f[y>>2]|0;l=E-u|0;f[y>>2]=l}while((E|0)!=(u|0));a=f[d>>2]|0}f[o>>2]=a;u=f[m>>2]|0;c=u-l|0;if(r>>>0<=c>>>0){g=5;break}}if((g|0)==5)break;f[h>>2]=f[h>>2]|8;Qn(n,4,4662,v)|0;E=-1;b=_;return E|0}else{a=e+36|0;s=e+56|0;o=a;a=f[a>>2]|0;i=0}}while(0);Yl(a|0,t|0,r|0)|0;f[o>>2]=(f[o>>2]|0)+r;f[y>>2]=(f[y>>2]|0)+r;y=s;y=Wl(f[y>>2]|0,f[y+4>>2]|0,r|0,0)|0;E=s;f[E>>2]=y;f[E+4>>2]=B;E=i+r|0;b=_;return E|0}function Xn(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;h=b;b=b+16|0;l=h;a=e+32|0;r=f[a>>2]|0;c=e+36|0;f[c>>2]=r;o=e+48|0;n=f[o>>2]|0;do{if(n){s=e+20|0;while(1){i=ku[f[s>>2]&63](r,n,f[e>>2]|0)|0;if((i|0)==-1)break;r=(f[c>>2]|0)+i|0;f[c>>2]=r;d=f[o>>2]|0;n=d-i|0;f[o>>2]=n;if((d|0)==(i|0)){u=6;break}}if((u|0)==6){r=f[a>>2]|0;break}d=e+68|0;f[d>>2]=f[d>>2]|8;Qn(t,4,4662,l)|0;d=0;b=h;return d|0}}while(0);f[c>>2]=r;d=1;b=h;return d|0}function Yn(e){e=e|0;e=e+56|0;B=f[e+4>>2]|0;return f[e>>2]|0}function qn(e){e=e|0;var t=0,r=0;r=e+8|0;t=f[r>>2]|0;r=f[r+4>>2]|0;if((t|0)==0&(r|0)==0){r=0;e=0;B=r;return e|0}e=e+56|0;e=zl(t|0,r|0,f[e>>2]|0,f[e+4>>2]|0)|0;r=B;B=r;return e|0}function Zn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;e=Nu[f[e+40>>2]&63](e,t,r,n)|0;return e|0}function Jn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return Nu[f[e+44>>2]&63](e,t,r,n)|0}function Kn(e){e=e|0;return(f[e+28>>2]|0)!=7|0}function Qn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+528|0;a=s;o=s+16|0;e:do{if(e){switch(t|0){case 1:{t=e;i=e+12|0;break}case 2:{t=e+4|0;i=e+16|0;break}case 4:{t=e+8|0;i=e+20|0;break}default:{t=0;break e}}e=f[t>>2]|0;t=f[i>>2]|0;if(t)if(!r)t=1;else{Vl(o|0,0,512)|0;f[a>>2]=n;vl(o,512,r,a)|0;Lu[t&7](o,e);t=1}else t=0}else t=0}while(0);b=s;return t|0}function $n(e){e=e|0;f[e>>2]=0;f[e+4>>2]=0;f[e+8>>2]=0;f[e+12>>2]=4;f[e+20>>2]=4;f[e+16>>2]=4;return}function ei(e,t){e=e|0;t=t|0;return}function ti(){return qi(1,36)|0}function ri(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;n=qi(1,36)|0;if(!n){s=n;return s|0}f[n+20>>2]=r;o=n+16|0;f[o>>2]=e;r=qi(1,e*52|0)|0;s=n+24|0;f[s>>2]=r;if(!r){r=f[n+28>>2]|0;if(r)Qi(r);Qi(n);s=0;return s|0}if(!e){s=n;return s|0}i=0;while(1){f[r+(i*52|0)>>2]=f[t+(i*36|0)>>2];f[r+(i*52|0)+4>>2]=f[t+(i*36|0)+4>>2];l=f[t+(i*36|0)+8>>2]|0;f[r+(i*52|0)+8>>2]=l;u=f[t+(i*36|0)+12>>2]|0;f[r+(i*52|0)+12>>2]=u;f[r+(i*52|0)+16>>2]=f[t+(i*36|0)+16>>2];f[r+(i*52|0)+20>>2]=f[t+(i*36|0)+20>>2];f[r+(i*52|0)+24>>2]=f[t+(i*36|0)+24>>2];f[r+(i*52|0)+28>>2]=f[t+(i*36|0)+28>>2];f[r+(i*52|0)+32>>2]=f[t+(i*36|0)+32>>2];l=qi(ce(u,l)|0,4)|0;f[r+(i*52|0)+44>>2]=l;i=i+1|0;if(!l)break;if(i>>>0>=e>>>0){a=22;break}r=f[s>>2]|0}if((a|0)==22)return n|0;r=f[s>>2]|0;if(r){i=f[o>>2]|0;if(i){t=0;while(1){r=f[r+(t*52|0)+44>>2]|0;if(r){Qi(r);i=f[o>>2]|0}t=t+1|0;if(t>>>0>=i>>>0)break;r=f[s>>2]|0}r=f[s>>2]|0}Qi(r)}r=f[n+28>>2]|0;if(r)Qi(r);Qi(n);u=0;return u|0}function ni(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;if(!e)return;i=e+24|0;t=f[i>>2]|0;if(t){a=e+16|0;r=f[a>>2]|0;if(r){n=0;while(1){t=f[t+(n*52|0)+44>>2]|0;if(t){Qi(t);r=f[a>>2]|0}n=n+1|0;if(n>>>0>=r>>>0)break;t=f[i>>2]|0}t=f[i>>2]|0}Qi(t)}t=f[e+28>>2]|0;if(t)Qi(t);Qi(e);return}function ii(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0;r=f[t+4>>2]|0;n=f[e>>2]|0;a=f[t+8>>2]|0;o=f[e+4>>2]|0;i=f[t+12>>2]|0;c=(ce((f[t+24>>2]|0)+-1|0,i)|0)+r|0;s=f[t+16>>2]|0;l=(ce((f[t+28>>2]|0)+-1|0,s)|0)+a|0;t=Wl(c|0,0,i|0,0)|0;t=t|0-B;i=f[e+8>>2]|0;s=Wl(l|0,0,s|0,0)|0;s=s|0-B;l=f[e+12>>2]|0;c=f[e+16>>2]|0;if(!c)return;u=(r>>>0>n>>>0?r:n)+-1|0;a=(a>>>0>o>>>0?a:o)+-1|0;i=(t>>>0<i>>>0?t:i)+-1|0;r=(s>>>0<l>>>0?s:l)+-1|0;n=0;t=f[e+24>>2]|0;while(1){o=f[t>>2]|0;l=((u+o|0)>>>0)/(o>>>0)|0;p=f[t+4>>2]|0;e=((a+p|0)>>>0)/(p>>>0)|0;s=f[t+40>>2]|0;d=Gl(1,0,s|0)|0;h=B;o=Wl((((i+o|0)>>>0)/(o>>>0)|0)-l|0,0,-1,-1)|0;o=Wl(o|0,B|0,d|0,h|0)|0;o=Xl(o|0,B|0,s|0)|0;p=Wl((((r+p|0)>>>0)/(p>>>0)|0)-e|0,0,-1,-1)|0;h=Wl(p|0,B|0,d|0,h|0)|0;s=Xl(h|0,B|0,s|0)|0;f[t+8>>2]=o;f[t+12>>2]=s;f[t+16>>2]=l;f[t+20>>2]=e;n=n+1|0;if(n>>>0>=c>>>0)break;else t=t+52|0}return}function ai(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0;f[t>>2]=f[e>>2];f[t+4>>2]=f[e+4>>2];f[t+8>>2]=f[e+8>>2];f[t+12>>2]=f[e+12>>2];l=t+24|0;n=f[l>>2]|0;s=t+16|0;if(!n)r=l;else{r=f[s>>2]|0;if(!r)r=l;else{i=0;while(1){n=f[n+(i*52|0)+44>>2]|0;if(n){Qi(n);r=f[s>>2]|0}i=i+1|0;if(i>>>0>=r>>>0)break;n=f[l>>2]|0}r=l;n=f[l>>2]|0}Qi(n);f[l>>2]=0}n=f[e+16>>2]|0;f[s>>2]=n;n=Yi(n*52|0)|0;f[r>>2]=n;if(!n){f[l>>2]=0;f[s>>2]=0;return}if(f[s>>2]|0){o=e+24|0;a=0;do{r=n+(a*52|0)|0;n=(f[o>>2]|0)+(a*52|0)|0;i=r+52|0;do{f[r>>2]=f[n>>2];r=r+4|0;n=n+4|0}while((r|0)<(i|0));n=f[l>>2]|0;f[n+(a*52|0)+44>>2]=0;a=a+1|0}while(a>>>0<(f[s>>2]|0)>>>0)}f[t+20>>2]=f[e+20>>2];i=e+32|0;r=f[i>>2]|0;a=t+32|0;f[a>>2]=r;if(!r){f[t+28>>2]=0;return}n=Yi(r)|0;r=t+28|0;f[r>>2]=n;if(!n){f[r>>2]=0;f[a>>2]=0;return}else{Yl(n|0,f[e+28>>2]|0,f[i>>2]|0)|0;return}}function oi(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=qi(1,36)|0;if(!n){e=n;return e|0}f[n+20>>2]=r;f[n+16>>2]=e;r=qi(e,52)|0;f[n+24>>2]=r;if(!r){r=f[n+28>>2]|0;if(r)Qi(r);Qi(n);e=0;return e|0}else{if(!e){e=n;return e|0}else i=0;do{f[r+(i*52|0)>>2]=f[t+(i*36|0)>>2];f[r+(i*52|0)+4>>2]=f[t+(i*36|0)+4>>2];f[r+(i*52|0)+8>>2]=f[t+(i*36|0)+8>>2];f[r+(i*52|0)+12>>2]=f[t+(i*36|0)+12>>2];f[r+(i*52|0)+16>>2]=f[t+(i*36|0)+16>>2];f[r+(i*52|0)+20>>2]=f[t+(i*36|0)+20>>2];f[r+(i*52|0)+24>>2]=f[t+(i*36|0)+24>>2];f[r+(i*52|0)+32>>2]=f[t+(i*36|0)+32>>2];f[r+(i*52|0)+44>>2]=0;i=i+1|0}while((i|0)!=(e|0));return n|0}return 0}function si(e,t,r){e=e|0;t=t|0;r=r|0;if(!e){r=0;return r|0}f[e+64>>2]=t;f[e+52>>2]=r;r=1;return r|0}function li(e,t,r){e=e|0;t=t|0;r=r|0;if(!e){r=0;return r|0}f[e+60>>2]=t;f[e+48>>2]=r;r=1;return r|0}function ui(e,t,r){e=e|0;t=t|0;r=r|0;if(!e){r=0;return r|0}f[e+56>>2]=t;f[e+44>>2]=r;r=1;return r|0}function ci(e,t){e=e|0;t=t|0;var r=0;if(!e){e=0;return e|0}r=Dn(t)|0;if(!r){e=0;return e|0}jn(r,e,0);Vn(r,f[e+8>>2]|0,0);if(!t)Bn(r,9);else Fn(r,8);zn(r,1);Un(r,10);e=r;return e|0}function hi(){return 4703}function di(e){e=e|0;var t=0;t=qi(1,84)|0;if(!t){e=0;return e|0}f[t+68>>2]=1;switch(e|0){case 0:{f[t+72>>2]=13;f[t+76>>2]=2;f[t+80>>2]=3;f[t+4>>2]=33;f[t+16>>2]=11;f[t>>2]=34;f[t+20>>2]=1;f[t+24>>2]=5;f[t+8>>2]=1;f[t+12>>2]=1;f[t+28>>2]=1;f[t+32>>2]=1;f[t+36>>2]=12;e=ha()|0;f[t+40>>2]=e;if(!e){Qi(t);e=0;return e|0}break}case 2:{f[t+72>>2]=14;f[t+76>>2]=4;f[t+80>>2]=5;f[t+4>>2]=35;f[t+16>>2]=13;f[t>>2]=36;f[t+8>>2]=2;f[t+12>>2]=2;f[t+20>>2]=2;f[t+24>>2]=6;f[t+28>>2]=2;f[t+32>>2]=2;f[t+36>>2]=14;e=Xt(1)|0;f[t+40>>2]=e;if(!e){Qi(t);e=0;return e|0}break}default:{Qi(t);e=0;return e|0}}$n(t+44|0);e=t;return e|0}function fi(e){e=e|0;if(!e)return;Vl(e|0,0,8248)|0;f[e+8200>>2]=-1;f[e+8204>>2]=-1;f[e+8248>>2]=0;return}function pi(e,t){e=e|0;t=t|0;var r=0;r=b;b=b+16|0;if(!((e|0)!=0&(t|0)!=0)){t=0;b=r;return t|0}if(!(f[e+68>>2]|0)){Qn(e+44|0,1,4709,r)|0;t=0;b=r;return t|0}else{Lu[f[e+24>>2]&7](f[e+40>>2]|0,t);t=1;b=r;return t|0}return 0}function mi(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=b;b=b+16|0;if(!((e|0)!=0&(t|0)!=0)){e=0;b=n;return e|0}if(!(f[t+68>>2]|0)){Qn(t+44|0,1,4790,n)|0;e=0;b=n;return e|0}else{e=Nu[f[t>>2]&63](e,f[t+40>>2]|0,r,t+44|0)|0;b=n;return e|0}return 0}function vi(e,t,r){e=e|0;t=t|0;r=r|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=Nu[f[e+4>>2]&63](f[e+40>>2]|0,t,r,e+44|0)|0;return t|0}function gi(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;if(!e){n=0;return n|0}if(!(f[e+68>>2]|0)){n=0;return n|0}n=Au[f[e+28>>2]&3](f[e+40>>2]|0,t,r,n,i,a,e+44|0)|0;return n|0}function yi(e,t,r,n,i,a,o,s,l,u){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;if(!((r|0)!=0&((e|0)!=0&(t|0)!=0&(n|0)!=0))){s=0;return s|0}if(!(f[e+68>>2]|0)){s=0;return s|0}s=Du[f[e+8>>2]&3](f[e+40>>2]|0,r,n,i,a,o,s,l,u,t,e+44|0)|0;return s|0}function _i(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;if(!((e|0)!=0&(r|0)!=0&(i|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=Iu[f[e+12>>2]&7](f[e+40>>2]|0,t,r,n,i,e+44|0)|0;return t|0}function bi(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;if(!((e|0)!=0&(t|0)!=0)){n=0;return n|0}if(!(f[e+68>>2]|0)){n=0;return n|0}n=Uu[f[e+32>>2]&3](f[e+40>>2]|0,t,r,e+44|0,n)|0;return n|0}function Ei(e,t){e=e|0;t=t|0;if(!e){t=0;return t|0}t=ku[f[e+36>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function wi(e){e=e|0;var t=0;t=qi(1,84)|0;if(!t){e=0;return e|0}f[t+68>>2]=0;switch(e|0){case 0:{f[t+4>>2]=15;f[t+12>>2]=16;f[t>>2]=37;f[t+8>>2]=3;f[t+16>>2]=1;f[t+20>>2]=38;e=ta()|0;f[t+40>>2]=e;if(!e){Qi(t);e=0;return e|0}break}case 2:{f[t+4>>2]=17;f[t+12>>2]=18;f[t>>2]=39;f[t+8>>2]=4;f[t+16>>2]=2;f[t+20>>2]=40;e=Xt(0)|0;f[t+40>>2]=e;if(!e){Qi(t);e=0;return e|0}break}default:{Qi(t);e=0;return e|0}}$n(t+44|0);e=t;return e|0}function xi(e){e=e|0;if(!e)return;Vl(e|0,0,18708)|0;f[e+5592>>2]=6;f[e+18684>>2]=0;f[e+5596>>2]=64;f[e+5600>>2]=64;f[e+44>>2]=0;f[e+5612>>2]=-1;f[e+18188>>2]=1;f[e+18192>>2]=1;h[e+18688>>0]=0;f[e+18196>>2]=-1;f[e+18200>>2]=-1;g[e+4792>>2]=0.0;f[e+4788>>2]=0;f[e+20>>2]=0;f[e+24>>2]=0;f[e+28>>2]=0;f[e+18692>>2]=0;return}function Ti(e,t,r){e=e|0;t=t|0;r=r|0;if(!((e|0)!=0&(t|0)!=0&(r|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=Nu[f[e+20>>2]&63](f[e+40>>2]|0,t,r,e+44|0)|0;return t|0}function Si(e,t,r){e=e|0;t=t|0;r=r|0;if(!((e|0)!=0&(r|0)!=0)){r=0;return r|0}if(f[e+68>>2]|0){r=0;return r|0}r=Nu[f[e>>2]&63](f[e+40>>2]|0,r,t,e+44|0)|0;return r|0}function Mi(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=ku[f[e+4>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function Ri(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=ku[f[e+12>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function Ai(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=ku[f[e+16>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function ki(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0;o=n<<2;i=ce(o,n)|0;a=e+18704|0;n=m[a>>1]|0;d[a>>1]=(n&32768|0)==0?-32512:(n|256)&65535;f[e+5608>>2]=1;h[e+18690>>0]=2;a=Yi(i+o|0)|0;n=e+18696|0;f[n>>2]=a;if(!a){r=0;return r|0}Yl(a|0,t|0,i|0)|0;Yl((f[n>>2]|0)+i|0,r|0,o|0)|0;r=1;return r|0}function Pi(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;if(!((r|0)!=0&((e|0)!=0&(i|0)!=0))){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=Iu[f[e+8>>2]&7](f[e+40>>2]|0,t,r,n,i,e+44|0)|0;return t|0}function Ci(e){e=e|0;var t=0,r=0;if(!e)return;t=e+40|0;r=f[t>>2]|0;if(!(f[e+68>>2]|0))Cu[f[e+16>>2]&7](r);else Cu[f[e+20>>2]&7](r);f[t>>2]=0;Qi(e);return}function Li(e,t,r){e=e|0;t=t|0;r=r|0;if(!e)return;Hu[f[e+72>>2]&15](f[e+40>>2]|0,t,r);return}function Ii(e){e=e|0;if(!e){e=0;return e|0}e=Ou[f[e+76>>2]&15](f[e+40>>2]|0)|0;return e|0}function Oi(e){e=e|0;var t=0,r=0;if(!e)return;t=f[e>>2]|0;r=f[t+48>>2]|0;if(r){Qi(r);t=f[e>>2]|0}Qi(t);f[e>>2]=0;return}function Hi(e){e=e|0;if(!e){e=0;return e|0}e=Ou[f[e+80>>2]&15](f[e+40>>2]|0)|0;return e|0}function Di(e){e=e|0;var t=0;t=f[e>>2]|0;if(!t)return;sa(t);f[e>>2]=0;return}function Ni(e,t){e=e|0;t=t|0;return Fi(e,1048576,t)|0}function Fi(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!e){t=0;return t|0}n=$s(e,(r|0)==0?4869:4872)|0;if(!n){t=0;return t|0}e=Rn(t,r)|0;if(!e){Ks(n)|0;t=0;return t|0}else{jn(e,n,6);ol(n,0,2)|0;t=ul(n)|0;ol(n,0,0)|0;Vn(e,t,((t|0)<0)<<31>>31);Fn(e,19);Bn(e,20);zn(e,21);Un(e,22);t=e;return t|0}return 0}function Ui(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=(f[r>>2]|0)+(f[r+8>>2]|0)|0;r=r+4|0;n=f[r>>2]|0;i=a-n|0;if((a|0)==(n|0)){a=-1;return a|0}a=i>>>0>t>>>0?t:i;Yl(e|0,n|0,a|0)|0;f[r>>2]=(f[r>>2]|0)+a;return a|0}function Bi(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=r+4|0;n=f[u>>2]|0;s=r+8|0;a=f[s>>2]|0;l=n-(f[r>>2]|0)|0;i=(a|0)==0?1:a;while(1)if((i-l|0)>>>0<t>>>0)i=i<<1;else{o=i;break}if((o|0)!=(a|0)){n=Yi(o)|0;if(!n){t=-1;return t|0}i=f[r>>2]|0;if(i){Yl(n|0,i|0,l|0)|0;Qi(f[r>>2]|0)}f[r>>2]=n;n=n+l|0;f[u>>2]=n;f[s>>2]=o}Yl(n|0,e|0,t|0)|0;f[u>>2]=(f[u>>2]|0)+t;return t|0}function zi(e,t){e=e|0;t=t|0;var r=0,n=0,i=0;i=(f[t>>2]|0)+(f[t+8>>2]|0)|0;t=t+4|0;r=f[t>>2]|0;n=i-r|0;if((i|0)==(r|0)){i=-1;return i|0}f[t>>2]=r+e;i=n>>>0>e>>>0?e:n;return i|0}function ji(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=f[r+8>>2]|0;f[r+4>>2]=(f[r>>2]|0)+(0>(t|0)|0==(t|0)&n>>>0>e>>>0?e:n);return 1}function Vi(e,t,r){e=e|0;t=t|0;r=r|0;t=nl(e,1,t,r)|0;return((t|0)!=0?t:-1)|0}function Gi(e,t,r){e=e|0;t=t|0;r=r|0;return hl(e,1,t,r)|0}function Wi(e,t,r){e=e|0;t=t|0;r=r|0;r=(ol(r,e,1)|0)==0;B=r?t:-1;return(r?e:-1)|0}function Xi(e,t,r){e=e|0;t=t|0;r=r|0;return(ol(r,e,0)|0)==0|0}function Yi(e){e=e|0;if(!e)e=0;else e=Ll(e)|0;return e|0}function qi(e,t){e=e|0;t=t|0;if(!t)e=0;else e=Ol(e,t)|0;return e|0}function Zi(e){e=e|0;var t=0,r=0;r=b;b=b+16|0;t=r;do{if(e)if(!(Dl(t,16,e)|0)){t=f[t>>2]|0;break}else{f[t>>2]=0;t=0;break}else t=0}while(0);b=r;return t|0}function Ji(e){e=e|0;Il(e);return}function Ki(e,t){e=e|0;t=t|0;if(!t)t=0;else t=Hl(e,t)|0;return t|0}function Qi(e){e=e|0;Il(e);return}function $i(e){e=e|0;var t=0,r=0;t=696;while(1){r=f[t>>2]|0;if((r|0)==-1|(r|0)==(e|0))break;else t=t+12|0}return t+4|0}function ea(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0))return;f[e+172>>2]=f[t+4>>2];f[e+168>>2]=f[t>>2];return}function ta(){var e=0,t=0;e=qi(1,208)|0;if(!e){e=0;return e|0}f[e>>2]=0;t=e+184|0;h[t>>0]=h[t>>0]&-3;t=Yi(1e3)|0;f[e+44>>2]=t;if(!t){ra(e);t=0;return t|0}f[e+48>>2]=1e3;t=go()|0;f[e+192>>2]=t;if(!t){ra(e);t=0;return t|0}t=go()|0;f[e+188>>2]=t;if(t){t=e;return t|0}ra(e);t=0;return t|0}function ra(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;if(!e)return;if(!(f[e>>2]|0)){t=e+36|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+24|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0;f[e+28>>2]=0}t=e+44|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0;f[e+48>>2]=0}}else{t=e+12|0;r=f[t>>2]|0;if(r){Ta(r);Qi(f[t>>2]|0);f[t>>2]=0}t=e+16|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0;f[e+20>>2]=0}}Wr(f[e+204>>2]|0);t=e+88|0;a=e+164|0;r=f[a>>2]|0;if(r){n=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;if(n){i=0;while(1){Ta(r);i=i+1|0;if((i|0)==(n|0))break;else r=r+5640|0}r=f[a>>2]|0}Qi(r);f[a>>2]=0}a=e+124|0;r=f[a>>2]|0;if(r){o=e+120|0;n=f[o>>2]|0;if(n){i=0;while(1){r=f[r+(i<<3)>>2]|0;if(r){Qi(r);n=f[o>>2]|0}i=i+1|0;if(i>>>0>=n>>>0)break;r=f[a>>2]|0}r=f[a>>2]|0}f[o>>2]=0;Qi(r);f[a>>2]=0}o=e+144|0;Qi(f[o>>2]|0);f[o>>2]=0;f[e+128>>2]=0;o=e+108|0;Qi(f[o>>2]|0);f[o>>2]=0;if(!(h[e+184>>0]&2)){o=e+176|0;Qi(f[o>>2]|0);f[o>>2]=0}r=t+100|0;do{f[t>>2]=0;t=t+4|0}while((t|0)<(r|0));o=e+188|0;yo(f[o>>2]|0);f[o>>2]=0;yo(f[e+192>>2]|0);f[o>>2]=0;o=e+196|0;sa(f[o>>2]|0);f[o>>2]=0;o=e+80|0;ni(f[o>>2]|0);f[o>>2]=0;o=e+84|0;ni(f[o>>2]|0);f[o>>2]=0;Qi(e);return}function na(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0.0,m=0,v=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0.0;ue=b;b=b+320|0;ie=ue+296|0;ne=ue+288|0;le=ue+280|0;se=ue+272|0;oe=ue+264|0;ae=ue+256|0;re=ue+248|0;te=ue+240|0;Y=ue+232|0;W=ue+224|0;G=ue+216|0;V=ue+208|0;j=ue+200|0;z=ue+192|0;B=ue+184|0;E=ue+176|0;_=ue+168|0;v=ue+160|0;m=ue+152|0;c=ue+144|0;O=ue+136|0;I=ue+128|0;F=ue+112|0;L=ue+104|0;C=ue+96|0;P=ue+88|0;A=ue+80|0;R=ue+72|0;M=ue+64|0;S=ue+56|0;T=ue+48|0;x=ue+32|0;w=ue+24|0;u=ue+16|0;o=ue+8|0;a=ue;D=ue+309|0;N=ue+300|0;if(!((e|0)!=0&(t|0)!=0&(r|0)!=0)){n=0;b=ue;return n|0}ee=t+5592|0;i=f[ee>>2]|0;if((i+-1|0)>>>0>32){f[a>>2]=i;f[a+4>>2]=33;Qn(n,1,4875,a)|0;n=0;b=ue;return n|0}Q=e+112|0;f[Q>>2]=1;$=e+116|0;f[$>>2]=1;H=t+18704|0;do{if(!(d[H>>1]|0)){switch(f[t+18676>>2]|0){case 1:{d[H>>1]=3;f[t+18700>>2]=1302083;f[t+18680>>2]=1041666;a=1;break}case 2:{d[H>>1]=3;f[t+18700>>2]=651041;f[t+18680>>2]=520833;a=1;break}case 3:{d[H>>1]=4;f[t+18700>>2]=1302083;f[t+18680>>2]=1041666;a=1;break}default:a=0}i=f[t+18684>>2]|0;e:do{if((i|0)>=4)if((i|0)<33024){switch(i|0){case 4:break;default:{K=13;break e}}d[H>>1]=4;break}else{switch(i|0){case 33024:break;default:{K=13;break e}}d[H>>1]=-32512;break}else{switch(i|0){case 3:break;default:{K=13;break e}}d[H>>1]=3}}while(0);if((K|0)==13?(a|0)==0:0)break;Qn(n,2,4931,o)|0}}while(0);k=t+18700|0;i=f[k>>2]|0;do{if((i|0)<1){p=+g[t+4792+((f[t+4788>>2]|0)+-1<<2)>>2];if(p>0.0){q=f[r+24>>2]|0;u=ce(f[q+8>>2]|0,f[r+16>>2]|0)|0;u=ce(u,f[q+12>>2]|0)|0;he=+((ce(u,f[q+24>>2]|0)|0)>>>0);q=~~+J(+(he/(p*8.0*+((f[q>>2]|0)>>>0)*+((f[q+4>>2]|0)>>>0))));f[k>>2]=q;break}else{f[k>>2]=0;break}}else{l=f[r+24>>2]|0;q=ce(f[l+8>>2]|0,f[r+16>>2]|0)|0;q=ce(q,f[l+12>>2]|0)|0;p=+((ce(q,f[l+24>>2]|0)|0)>>>0);i=ce(i<<3,f[l>>2]|0)|0;p=p/+((ce(i,f[l+4>>2]|0)|0)>>>0);l=t+4788|0;i=f[l>>2]|0;if(i){o=i;i=0;s=0;while(1){a=t+4792+(s<<2)|0;if(+g[a>>2]<p){g[a>>2]=p;a=f[l>>2]|0;i=1}else a=o;s=s+1|0;if(s>>>0>=a>>>0)break;else o=a}if(i)Qn(n,2,5068,u)|0}}}while(0);i=d[H>>1]|0;e:do{if((i+-3&65535)>=4){if(i<<16>>16==7){Qn(n,2,7228,c)|0;d[H>>1]=0;i=0;break}if((i+-256&65535)<524){Qn(n,2,7283,m)|0;d[H>>1]=0;i=0;break}if((i+-1024&65535)<1180){Qn(n,2,7331,v)|0;d[H>>1]=0;i=0;break}if(i<<16>>16<=-1)switch(i<<16>>16){case-32512:{i=-32512;break e}case-32768:{Qn(n,2,7373,_)|0;d[H>>1]=0;i=0;break e}default:{Qn(n,2,7461,E)|0;d[H>>1]=0;i=0;break e}}}else{if((i+-5&65535)<2){Qn(n,2,5160,w)|0;d[H>>1]=0;i=0;break}f[t>>2]=0;f[t+12>>2]=1;f[t+16>>2]=1;h[t+18689>>0]=67;h[t+18688>>0]=1;f[t+4>>2]=0;f[t+8>>2]=0;f[t+18180>>2]=0;f[t+18184>>2]=0;f[t+5596>>2]=32;f[t+5600>>2]=32;f[t+5604>>2]=0;f[t+5612>>2]=-1;f[t+18188>>2]=1;f[t+18192>>2]=1;f[t+5608>>2]=1;a=t+4788|0;o=f[a>>2]|0;if((o|0)>1){he=+g[t+4792+(o+-1<<2)>>2];f[x>>2]=o;y[x+8>>3]=he;Qn(n,2,5222,x)|0;f[t+4792>>2]=f[t+4792+((f[a>>2]|0)+-1<<2)>>2];f[a>>2]=1;i=d[H>>1]|0}t:do{switch(i&65535|0){case 3:{i=f[ee>>2]|0;if((i|0)>6){f[T>>2]=i+1;Qn(n,2,5395,T)|0;f[ee>>2]=6;i=6}break}case 4:{i=f[ee>>2]|0;if((i|0)<2){f[S>>2]=i+1;Qn(n,2,5541,S)|0;f[ee>>2]=1;i=1;break t}if((i|0)>7){f[M>>2]=i+1;Qn(n,2,5695,M)|0;f[ee>>2]=7;i=7}break}default:i=f[ee>>2]|0}}while(0);a=t+40|0;f[a>>2]=f[a>>2]|1;a=t+5620|0;f[a>>2]=i+-1;if((i|0)>1){i=0;do{f[t+5624+(i<<2)>>2]=256;f[t+5756+(i<<2)>>2]=256;i=i+1|0}while((i|0)<(f[a>>2]|0))}f[t+44>>2]=4;if((d[H>>1]|0)==4){i=f[ee>>2]|0;f[t+96>>2]=1;f[t+48>>2]=0;f[t+52>>2]=0;f[t+56>>2]=1;q=i+-1|0;f[t+60>>2]=q;f[t+64>>2]=3;f[t+80>>2]=4;f[t+244>>2]=1;f[t+196>>2]=q;f[t+200>>2]=0;f[t+204>>2]=1;f[t+208>>2]=i;f[t+212>>2]=3;f[t+228>>2]=4;i=2}else i=0;f[t+4784>>2]=i;f[t+20>>2]=1;i=f[k>>2]|0;if((i|0)>=1){if((i|0)>1302083){Qn(n,2,5998,A)|0;f[k>>2]=1302083}}else{f[k>>2]=1302083;Qn(n,2,5849,R)|0}i=t+18680|0;a=f[i>>2]|0;if((a|0)>=1){if((a|0)>1041666){Qn(n,2,6320,C)|0;f[i>>2]=1041666}}else{f[i>>2]=1041666;Qn(n,2,6171,P)|0}a=f[r+16>>2]|0;s=f[r+24>>2]|0;l=f[s+8>>2]|0;i=ce(l,a)|0;u=f[s+12>>2]|0;i=ce(i,u)|0;he=+((ce(i,f[s+24>>2]|0)|0)>>>0);i=ce(f[k>>2]<<3,f[s>>2]|0)|0;he=he/+((ce(i,f[s+4>>2]|0)|0)>>>0);g[t+4792>>2]=he;i=d[H>>1]|0;t:do{if((a|0)==3){a=s+28|0;o=s+32|0;if(!((f[a>>2]|0)!=12|f[o>>2])){a=s+80|0;o=s+84|0;if(!((f[a>>2]|0)!=12|f[o>>2])){a=s+132|0;o=s+136|0;if(!((f[a>>2]|0)!=12|f[o>>2])){switch(i&65535|0){case 3:{if(u>>>0>1080|l>>>0>2048){f[I>>2]=l;f[I+4>>2]=u;Qn(n,2,6892,I)|0;break t}break}case 4:{if(u>>>0>2160|l>>>0>4096){f[O>>2]=l;f[O+4>>2]=u;Qn(n,2,7063,O)|0;break t}break}default:{}}break e}else{u=a;i=o;a=2}}else{u=a;i=o;a=1}}else{u=a;i=o;a=0}h[D>>0]=h[6659]|0;h[D+1>>0]=h[6660]|0;h[D+2>>0]=h[6661]|0;h[D+3>>0]=h[6662]|0;h[D+4>>0]=h[6663]|0;h[D+5>>0]=h[6664]|0;h[D+6>>0]=h[6665]|0;o=N;s=6666;l=o+9|0;do{h[o>>0]=h[s>>0]|0;o=o+1|0;s=s+1|0}while((o|0)<(l|0));q=(f[i>>2]|0)!=0?D:N;N=f[u>>2]|0;f[F>>2]=a;f[F+4>>2]=N;f[F+8>>2]=q;Qn(n,2,6675,F)|0}else{f[L>>2]=a;Qn(n,2,6493,L)|0}}while(0);d[H>>1]=0;i=0}}while(0);f[e+168>>2]=f[t+18680>>2];q=e+88|0;d[q>>1]=i;F=e+181|0;D=h[F>>0]&-2|f[t+20>>2]&1;h[F>>0]=D;N=t+24|0;D=(f[N>>2]&255)<<1&2|D&-3;h[F>>0]=D;h[F>>0]=D&-5|(f[t+28>>2]&255)<<2&4;do{if((f[N>>2]|0)!=0?(U=t+32|0,(f[U>>2]|0)!=0):0){i=ce((f[t+4788>>2]|0)*12|0,f[ee>>2]|0)|0;a=Yi(i)|0;f[e+176>>2]=a;if(a){Yl(a|0,f[U>>2]|0,i|0)|0;break}Qn(n,1,7520,B)|0;n=0;b=ue;return n|0}}while(0);s=e+100|0;f[s>>2]=f[t+12>>2];l=e+104|0;f[l>>2]=f[t+16>>2];o=e+92|0;f[o>>2]=f[t+4>>2];u=e+96|0;f[u>>2]=f[t+8>>2];a=t+36|0;i=f[a>>2]|0;do{if(!i){i=hi()|0;a=Yi((xl(i)|0)+29|0)|0;f[e+108>>2]=a;if(a){f[V>>2]=7697;f[V+4>>2]=i;pl(a,7692,V)|0;break}Qn(n,1,7646,j)|0;n=0;b=ue;return n|0}else{i=Yi((xl(i)|0)+1|0)|0;f[e+108>>2]=i;if(i){wl(i,f[a>>2]|0)|0;break}Qn(n,1,7592,z)|0;n=0;b=ue;return n|0}}while(0);i=(f[r+8>>2]|0)-(f[o>>2]|0)|0;a=f[r+12>>2]|0;if(!(f[t>>2]|0)){f[s>>2]=i;f[l>>2]=a-(f[u>>2]|0)}else{V=f[s>>2]|0;f[Q>>2]=(i+-1+V|0)/(V|0)|0;V=f[l>>2]|0;f[$>>2]=(a+-1-(f[u>>2]|0)+V|0)/(V|0)|0}if(h[t+18688>>0]|0){h[e+180>>0]=h[t+18689>>0]|0;h[F>>0]=h[F>>0]|8}V=qi(ce(f[$>>2]|0,f[Q>>2]|0)|0,5640)|0;N=e+164|0;f[N>>2]=V;if(!V){Qn(n,1,7726,G)|0;n=0;b=ue;return n|0}D=t+4784|0;M=f[D>>2]|0;do{if(M){w=t+48|0;R=f[ee>>2]|0;A=f[r+16>>2]|0;k=f[t+4788>>2]|0;P=ce(A,R)|0;C=qi(ce(P,k)|0,4)|0;if(!C){Qn(n,1,7780,W)|0;break}o=f[w>>2]|0;m=t+60|0;i=f[m>>2]|0;if(o>>>0<i>>>0){c=ce(o,A)|0;v=t+52|0;_=t+64|0;E=t+56|0;a=f[_>>2]|0;while(1){s=f[v>>2]|0;if(s>>>0<a>>>0){i=f[E>>2]|0;u=s;l=s+c|0;while(1){if(!i)i=0;else{a=l;s=0;while(1){f[C+(a<<2)>>2]=1;s=s+1|0;i=f[E>>2]|0;if(s>>>0>=i>>>0)break;else a=a+P|0}a=f[_>>2]|0}u=u+1|0;if(u>>>0>=a>>>0)break;else l=l+1|0}i=f[m>>2]|0}o=o+1|0;if(o>>>0>=i>>>0)break;else c=c+A|0}}if(M>>>0>1){S=1;do{i=w;w=w+148|0;E=f[i+8>>2]|0;_=i+156|0;s=f[_>>2]|0;E=s>>>0>E>>>0?E:0;l=f[w>>2]|0;x=i+160|0;a=f[x>>2]|0;if(l>>>0<a>>>0){c=ce(l,A)|0;T=i+152|0;m=i+164|0;v=ce(E,P)|0;o=f[m>>2]|0;i=s;while(1){s=f[T>>2]|0;if(s>>>0<o>>>0){u=s;s=s+c|0;while(1){if(E>>>0<i>>>0){a=s+v|0;o=E;while(1){f[C+(a<<2)>>2]=1;o=o+1|0;i=f[_>>2]|0;if(o>>>0>=i>>>0)break;else a=a+P|0}o=f[m>>2]|0}u=u+1|0;if(u>>>0>=o>>>0)break;else s=s+1|0}a=f[x>>2]|0}l=l+1|0;if(l>>>0>=a>>>0)break;else c=c+A|0}}S=S+1|0}while((S|0)!=(M|0))}if((k|0)!=0?(X=(A|0)==0,(R|0)!=0):0){a=0;c=0;i=0;do{if(!X){u=a;l=0;while(1){o=0;s=u;while(1){i=(f[C+(s<<2)>>2]|0)!=1|i;o=o+1|0;if((o|0)==(A|0))break;else s=s+1|0}l=l+1|0;if((l|0)==(R|0))break;else u=u+A|0}a=P+a|0}c=c+1|0}while((c|0)!=(k|0));if(i)Qn(n,1,7828,Y)|0}Qi(C)}}while(0);e:do{if(ce(f[$>>2]|0,f[Q>>2]|0)|0){w=t+4788|0;x=t+40|0;T=t+44|0;S=t+18690|0;M=r+16|0;a=t+18696|0;R=r+24|0;A=t+5596|0;k=t+5600|0;P=t+5604|0;C=t+5608|0;L=t+5612|0;I=t+5616|0;O=t+5620|0;H=0;t:while(1){c=f[N>>2]|0;m=c+(H*5640|0)|0;Y=f[w>>2]|0;i=c+(H*5640|0)+8|0;f[i>>2]=Y;if(Y){o=((d[q>>1]|0)+-3&65535)<4;l=0;do{s=(h[F>>0]&4)==0;do{if(!o)if(s){f[c+(H*5640|0)+20+(l<<2)>>2]=f[t+4792+(l<<2)>>2];break}else{f[c+(H*5640|0)+5184+(l<<2)>>2]=f[t+5192+(l<<2)>>2];break}else{if(!s)f[c+(H*5640|0)+5184+(l<<2)>>2]=f[t+5192+(l<<2)>>2];f[c+(H*5640|0)+20+(l<<2)>>2]=f[t+4792+(l<<2)>>2]}}while(0);l=l+1|0}while(l>>>0<(f[i>>2]|0)>>>0)}f[m>>2]=f[x>>2];f[c+(H*5640|0)+4>>2]=f[T>>2];u=c+(H*5640|0)+16|0;f[u>>2]=h[S>>0];i=c+(H*5640|0)+5636|0;o=h[i>>0]|0;h[i>>0]=o&-5;if(!(f[D>>2]|0))f[c+(H*5640|0)+420>>2]=0;else{h[i>>0]=o|4;o=f[D>>2]|0;if(!o)i=0;else{s=H+1|0;l=0;i=0;do{if((s|0)==(f[t+48+(l*148|0)+48>>2]|0)){f[c+(H*5640|0)+424+(i*148|0)>>2]=f[t+48+(i*148|0)>>2];f[c+(H*5640|0)+424+(i*148|0)+4>>2]=f[t+48+(i*148|0)+4>>2];f[c+(H*5640|0)+424+(i*148|0)+8>>2]=f[t+48+(i*148|0)+8>>2];f[c+(H*5640|0)+424+(i*148|0)+12>>2]=f[t+48+(i*148|0)+12>>2];f[c+(H*5640|0)+424+(i*148|0)+16>>2]=f[t+48+(i*148|0)+16>>2];f[c+(H*5640|0)+424+(i*148|0)+32>>2]=f[t+48+(i*148|0)+32>>2];f[c+(H*5640|0)+424+(i*148|0)+48>>2]=f[t+48+(i*148|0)+48>>2];i=i+1|0}l=l+1|0}while(l>>>0<o>>>0)}f[c+(H*5640|0)+420>>2]=i+-1}Y=qi(f[M>>2]|0,1080)|0;E=c+(H*5640|0)+5584|0;f[E>>2]=Y;if(!Y){K=149;break}do{if(!(f[a>>2]|0)){r:do{if((f[u>>2]|0)==1){i=f[M>>2]|0;if(i>>>0<=2){s=i;break}o=f[R>>2]|0;i=f[o>>2]|0;do{if((i|0)==(f[o+52>>2]|0)){if((i|0)!=(f[o+104>>2]|0))break;i=f[o+4>>2]|0;if((i|0)!=(f[o+56>>2]|0))break;if((i|0)==(f[o+108>>2]|0)){K=175;break r}}}while(0);Qn(n,2,8224,ie)|0;f[u>>2]=0;K=175}else K=175}while(0);if((K|0)==175){K=0;s=f[M>>2]|0}if(!s)break;i=f[R>>2]|0;o=0;do{if(!(f[i+(o*52|0)+32>>2]|0))f[(f[E>>2]|0)+(o*1080|0)+1076>>2]=1<<(f[i+(o*52|0)+24>>2]|0)+-1;o=o+1|0}while(o>>>0<s>>>0);Z=s;K=166}else{s=f[M>>2]|0;s=ce(s<<2,s)|0;i=Yi(s)|0;l=(f[a>>2]|0)+s|0;if(!i){K=152;break t}f[u>>2]=2;o=Yi(s)|0;f[c+(H*5640|0)+5608>>2]=o;if(!o){K=154;break t}Yl(o|0,f[a>>2]|0,s|0)|0;Yl(i|0,f[a>>2]|0,s|0)|0;o=Yi(s)|0;s=c+(H*5640|0)+5604|0;f[s>>2]=o;if(!o){K=156;break t}if(!(qo(i,o,f[M>>2]|0)|0)){K=158;break t}o=Yi(f[M>>2]<<3)|0;f[c+(H*5640|0)+5600>>2]=o;if(!o){K=160;break t}kr(o,f[M>>2]|0,f[s>>2]|0);Qi(i);i=f[M>>2]|0;if(i){o=f[E>>2]|0;s=0;do{f[o+(s*1080|0)+1076>>2]=f[l+(s<<2)>>2];s=s+1|0}while(s>>>0<i>>>0)}if(!(ia(m,r)|0)){K=167;break t}Z=f[M>>2]|0;K=166}}while(0);if((K|0)==166?(K=0,(Z|0)!=0):0){_=0;do{m=f[E>>2]|0;v=m+(_*1080|0)|0;f[v>>2]=f[x>>2]&1;s=f[ee>>2]|0;l=m+(_*1080|0)+4|0;f[l>>2]=s;i=f[A>>2]|0;if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+8>>2]=i;i=f[k>>2]|0;if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+12>>2]=i;f[m+(_*1080|0)+16>>2]=f[P>>2];Y=f[C>>2]|0;f[m+(_*1080|0)+20>>2]=(Y|0)==0&1;f[m+(_*1080|0)+24>>2]=(Y|0)!=0?2:0;f[m+(_*1080|0)+804>>2]=2;if((_|0)==(f[L>>2]|0))i=f[I>>2]|0;else i=0;f[m+(_*1080|0)+808>>2]=i;do{if(!(f[x>>2]&1)){if(!s)break;else i=0;do{f[m+(_*1080|0)+812+(i<<2)>>2]=15;f[m+(_*1080|0)+944+(i<<2)>>2]=15;i=i+1|0}while(i>>>0<(f[l>>2]|0)>>>0)}else{if((s|0)>0){l=s;c=0}else break;while(1){u=l;l=l+-1|0;i=f[O>>2]|0;do{if((c|0)<(i|0)){i=f[t+5624+(c<<2)>>2]|0;if((i|0)<1)f[m+(_*1080|0)+812+(l<<2)>>2]=1;else{if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+812+(l<<2)>>2]=i}i=f[t+5756+(c<<2)>>2]|0;if((i|0)<1){f[m+(_*1080|0)+944+(l<<2)>>2]=1;break}if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+944+(l<<2)>>2]=i}else{Y=i+-1|0;o=c-Y|0;i=f[t+5624+(Y<<2)>>2]>>o;o=f[t+5756+(Y<<2)>>2]>>o;if((i|0)<1)f[m+(_*1080|0)+812+(l<<2)>>2]=1;else{if((i|0)>1){s=0;do{i=i>>1;s=s+1|0}while((i|0)>1);i=s}else i=0;f[m+(_*1080|0)+812+(l<<2)>>2]=i}if((o|0)<1){f[m+(_*1080|0)+944+(l<<2)>>2]=1;break}if((o|0)>1){i=0;do{o=o>>1;i=i+1|0}while((o|0)>1)}else i=0;f[m+(_*1080|0)+944+(l<<2)>>2]=i}}while(0);if((u|0)<=1)break;else c=c+1|0}}}while(0);Uo(v,f[(f[R>>2]|0)+(_*52|0)+24>>2]|0);_=_+1|0}while(_>>>0<(f[M>>2]|0)>>>0)}H=H+1|0;if(H>>>0>=(ce(f[$>>2]|0,f[Q>>2]|0)|0)>>>0)break e}if((K|0)==149){Qn(n,1,7867,te)|0;n=0;b=ue;return n|0}else if((K|0)==152){Qn(n,1,7931,re)|0;n=0;b=ue;return n|0}else if((K|0)==154){Qi(i);Qn(n,1,7974,ae)|0;n=0;b=ue;return n|0}else if((K|0)==156){Qi(i);Qn(n,1,8032,oe)|0;n=0;b=ue;return n|0}else if((K|0)==158){Qi(i);Qn(n,1,8092,se)|0;n=0;b=ue;return n|0}else if((K|0)==160){Qi(i);Qn(n,1,8140,le)|0;n=0;b=ue;return n|0}else if((K|0)==167){Qn(n,1,8190,ne)|0;n=0;b=ue;return n|0}}else a=t+18696|0}while(0);i=f[a>>2]|0;if(!i){n=1;b=ue;return n|0}Qi(i);f[a>>2]=0;n=1;b=ue;return n|0}function ia(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0;if((f[e+16>>2]|0)!=2){e=1;return e|0}u=e+5604|0;v=e+5616|0;r=f[v>>2]|0;c=e+5620|0;do{if(f[u>>2]|0){do{if((r|0)==(f[c>>2]|0)){r=r+10|0;f[c>>2]=r;n=e+5612|0;r=Ki(f[n>>2]|0,r*20|0)|0;if(r){f[n>>2]=r;m=f[v>>2]|0;Vl(r+(m*20|0)|0,0,((f[c>>2]|0)-m|0)*20|0)|0;r=f[v>>2]|0;break}Qi(f[n>>2]|0);f[n>>2]=0;f[c>>2]=0;f[v>>2]=0;e=0;return e|0}else n=e+5612|0}while(0);s=f[n>>2]|0;a=s+(r*20|0)|0;l=s+(r*20|0)+12|0;n=f[l>>2]|0;if(n){Qi(n);f[l>>2]=0}f[s+(r*20|0)+8>>2]=1;f[s+(r*20|0)+4>>2]=1;f[a>>2]=2;n=f[t+16>>2]|0;n=ce(n,n)|0;i=n<<2;o=Yi(i)|0;f[l>>2]=o;if(!o){e=0;return e|0}else{Hu[f[768+(f[a>>2]<<2)>>2]&15](f[u>>2]|0,o,n);f[s+(r*20|0)+16>>2]=i;r=(f[v>>2]|0)+1|0;f[v>>2]=r;o=2;break}}else{o=1;a=0}}while(0);do{if((r|0)==(f[c>>2]|0)){n=r+10|0;f[c>>2]=n;r=e+5612|0;n=Ki(f[r>>2]|0,n*20|0)|0;if(!n){Qi(f[r>>2]|0);f[r>>2]=0;f[c>>2]=0;f[v>>2]=0;e=0;return e|0}else{f[r>>2]=n;i=f[v>>2]|0;Vl(n+(i*20|0)|0,0,((f[c>>2]|0)-i|0)*20|0)|0;if(!a){a=0;break}a=n+((i+-1|0)*20|0)|0;break}}else r=e+5612|0}while(0);u=f[r>>2]|0;c=f[v>>2]|0;m=u+(c*20|0)|0;d=u+(c*20|0)+12|0;r=f[d>>2]|0;if(r){Qi(r);f[d>>2]=0}p=o+1|0;f[u+(c*20|0)+8>>2]=o;f[u+(c*20|0)+4>>2]=2;f[m>>2]=2;t=t+16|0;r=f[t>>2]|0;n=r<<2;l=Yi(n)|0;f[d>>2]=l;if(!l){e=0;return e|0}i=Yi(n)|0;if(!i){Qi(f[d>>2]|0);f[d>>2]=0;e=0;return e|0}if(r){o=0;s=i;l=f[e+5584>>2]|0;while(1){g[s>>2]=+(f[l+1076>>2]|0);o=o+1|0;if((o|0)==(r|0))break;else{s=s+4|0;l=l+1080|0}}}Hu[f[768+(f[m>>2]<<2)>>2]&15](i,f[d>>2]|0,r);Qi(i);f[u+(c*20|0)+16>>2]=n;f[v>>2]=(f[v>>2]|0)+1;o=e+5628|0;r=f[o>>2]|0;i=e+5632|0;do{if((r|0)==(f[i>>2]|0)){r=r+10|0;f[i>>2]=r;n=e+5624|0;r=Ki(f[n>>2]|0,r*20|0)|0;if(r){f[n>>2]=r;e=f[o>>2]|0;Vl(r+(e*20|0)|0,0,((f[i>>2]|0)-e|0)*20|0)|0;r=f[o>>2]|0;break}Qi(f[n>>2]|0);f[n>>2]=0;f[i>>2]=0;f[o>>2]=0;e=0;return e|0}else n=e+5624|0}while(0);e=f[n>>2]|0;f[e+(r*20|0)+8>>2]=a;v=e+(r*20|0)+16|0;h[v>>0]=h[v>>0]|1;f[e+(r*20|0)+4>>2]=f[t>>2];f[e+(r*20|0)>>2]=p;f[e+(r*20|0)+12>>2]=m;f[o>>2]=(f[o>>2]|0)+1;e=1;return e|0}function aa(e,t,r){e=e|0;t=t|0;r=r|0;return 1}function oa(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;l=ti()|0;u=t+80|0;f[u>>2]=l;if(!l){u=0;return u|0}i=t+192|0;if((_o(f[i>>2]|0,23,n)|0)!=0?(_o(f[i>>2]|0,24,n)|0)!=0:0){o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}}else wo(o);i=t+188|0;if((_o(f[i>>2]|0,25,n)|0)!=0?(_o(f[i>>2]|0,26,n)|0)!=0:0){o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}}else wo(o);i=ti()|0;f[r>>2]=i;if(!i){u=0;return u|0}ai(f[u>>2]|0,i);i=ce(f[t+116>>2]|0,f[t+112>>2]|0)|0;s=t+196|0;f[(f[s>>2]|0)+36>>2]=i;i=qi(i,40)|0;a=f[s>>2]|0;f[a+40>>2]=i;if(!i){u=0;return u|0}if(!(f[a+36>>2]|0)){u=1;return u|0}o=0;while(1){f[i+(o*40|0)+28>>2]=100;f[i+(o*40|0)+20>>2]=0;u=qi(100,24)|0;a=f[s>>2]|0;i=f[a+40>>2]|0;f[i+(o*40|0)+24>>2]=u;o=o+1|0;if(!u){i=0;a=30;break}if(o>>>0>=(f[a+36>>2]|0)>>>0){i=1;a=30;break}}if((a|0)==30)return i|0}ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}function sa(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;if(!e)return;t=e+28|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}o=e+40|0;t=f[o>>2]|0;if(t){a=e+36|0;if(f[a>>2]|0){r=t;i=0;do{n=f[r+(i*40|0)+36>>2]|0;if(n){Qi(n);t=f[o>>2]|0;f[t+(i*40|0)+36>>2]=0;r=t}n=f[r+(i*40|0)+16>>2]|0;if(n){Qi(n);t=f[o>>2]|0;f[t+(i*40|0)+16>>2]=0;r=t}n=f[r+(i*40|0)+24>>2]|0;if(n){Qi(n);r=f[o>>2]|0;f[r+(i*40|0)+24>>2]=0;t=r}i=i+1|0}while(i>>>0<(f[a>>2]|0)>>>0)}Qi(t);f[o>>2]=0}Qi(e);return}function la(e,t,r,n,i,a,o,s,l,u,c){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;var p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,J=0,K=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ve=0,ge=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Se=0,Me=0,Re=0,Ae=0,ke=0;ke=b;b=b+256|0;Ae=ke+200|0;Re=ke+192|0;Se=ke+184|0;Te=ke+176|0;me=ke+168|0;pe=ke+160|0;fe=ke+152|0;de=ke+144|0;he=ke+136|0;ue=ke+128|0;se=ke+120|0;oe=ke+112|0;we=ke+104|0;be=ke+96|0;ae=ke+88|0;ie=ke+80|0;ne=ke+72|0;Ee=ke+64|0;re=ke+56|0;te=ke+48|0;ye=ke+40|0;ge=ke+32|0;ve=ke+24|0;le=ke+16|0;ee=ke+8|0;$=ke;Y=ke+240|0;W=ke+236|0;Z=ke+232|0;K=ke+228|0;Q=ke+224|0;X=ke+220|0;J=ke+216|0;G=ke+212|0;q=ke+208|0;f[G>>2]=65424;Me=e+8|0;e:do{switch(f[Me>>2]|0){case 256:{f[G>>2]=65497;p=e+76|0;xe=117;break}case 8:{_e=e+76|0;if(!(h[_e>>0]&1)){U=e+200|0;z=e+164|0;j=e+72|0;V=e+24|0;R=e+196|0;A=e+112|0;k=e+116|0;C=Y+2|0;L=Y+6|0;I=Y+7|0;O=e+16|0;H=e+20|0;D=e+64|0;p=65424;t:while(1){r:do{if((p|0)!=65427){while(1){M=qn(u)|0;if((M|0)==0&(B|0)==0){xe=7;break}if((Gn(u,f[O>>2]|0,2,c)|0)!=2){xe=9;break t}wn(f[O>>2]|0,q,2);if((f[q>>2]|0)>>>0<2){xe=11;break t}if((f[G>>2]|0)==32896?(M=qn(u)|0,(M|0)==0&(B|0)==0):0){xe=14;break}g=f[Me>>2]|0;p=f[q>>2]|0;if(g&16)f[V>>2]=-2-p+(f[V>>2]|0);m=p+-2|0;f[q>>2]=m;p=f[G>>2]|0;v=784;while(1){M=f[v>>2]|0;if((M|0)==0|(M|0)==(p|0)){T=v;break}else v=v+12|0}if(!(f[v+4>>2]&g)){xe=20;break t}if(m>>>0>(f[H>>2]|0)>>>0){M=qn(u)|0;S=B;if(0>(S|0)|0==(S|0)&m>>>0>M>>>0){xe=24;break t}p=Ki(f[O>>2]|0,f[q>>2]|0)|0;if(!p){xe=26;break t}f[O>>2]=p;m=f[q>>2]|0;f[H>>2]=m}else p=f[O>>2]|0;m=Gn(u,p,m,c)|0;if((m|0)!=(f[q>>2]|0)){xe=29;break t}p=f[v+8>>2]|0;if(!p){xe=31;break t}if(!(Nu[p&63](e,f[O>>2]|0,m,c)|0)){xe=33;break t}v=f[U>>2]|0;m=f[R>>2]|0;E=f[T>>2]|0;w=Yn(u)|0;x=f[q>>2]|0;w=w-x+-4|0;x=x+4|0;m=m+40|0;_=f[m>>2]|0;p=f[_+(v*40|0)+20>>2]|0;g=_+(v*40|0)+28|0;y=f[g>>2]|0;if((p+1|0)>>>0>y>>>0){y=~~(+(y>>>0)+100.0)>>>0;f[g>>2]=y;g=Ki(f[_+(v*40|0)+24>>2]|0,y*24|0)|0;y=f[m>>2]|0;p=y+(v*40|0)+24|0;if(!g){xe=41;break t}f[p>>2]=g;m=y;p=f[y+(v*40|0)+20>>2]|0}else{m=_;g=f[_+(v*40|0)+24>>2]|0}d[g+(p*24|0)>>1]=E;M=g+(p*24|0)+8|0;f[M>>2]=w;f[M+4>>2]=((w|0)<0)<<31>>31;f[g+(p*24|0)+16>>2]=x;f[m+(v*40|0)+20>>2]=p+1;if((E|0)==65424?(P=f[m+(v*40|0)+16>>2]|0,(P|0)!=0):0){M=P+((f[m+(v*40|0)+12>>2]|0)*24|0)|0;f[M>>2]=w;f[M+4>>2]=0}do{if((f[T>>2]|0)==65424){p=Yn(u)|0;p=-4-(f[q>>2]|0)+p|0;M=D;S=f[M+4>>2]|0;if(!(0>(S|0)|(0==(S|0)?p>>>0>(f[M>>2]|0)>>>0:0)))break;M=D;f[M>>2]=p;f[M+4>>2]=0}}while(0);if(h[_e>>0]&4){xe=46;break}if((Gn(u,f[O>>2]|0,2,c)|0)!=2){xe=50;break t}wn(f[O>>2]|0,G,2);if((f[G>>2]|0)==65427)break r}if((xe|0)==7){xe=0;f[Me>>2]=64;break}else if((xe|0)==14){xe=0;f[Me>>2]=64;break}else if((xe|0)==46){xe=0;M=Zn(u,f[V>>2]|0,0,c)|0;if(!((B|0)==0?(M|0)==(f[V>>2]|0):0)){xe=47;break t}f[G>>2]=65427;break}}}while(0);M=qn(u)|0;if((M|0)==0&(B|0)==0?(f[Me>>2]|0)==64:0){xe=115;break}p=h[_e>>0]|0;if(!(p&4)){m=f[U>>2]|0;v=f[z>>2]|0;if(!(f[j>>2]|0)){p=f[V>>2]|0;if(p>>>0>1){g=p+-2|0;f[V>>2]=g}else g=p}else{g=qn(u)|0;g=Wl(g|0,B|0,-2,0)|0;f[V>>2]=g}p=v+(m*5640|0)+5592|0;M=v+(m*5640|0)+5596|0;do{if(!g)S=1;else{S=qn(u)|0;T=B;if(0>(T|0)|0==(T|0)&g>>>0>S>>>0)Qn(c,2,8573,ae)|0;m=f[p>>2]|0;if(!m){S=Yi(f[V>>2]|0)|0;f[p>>2]=S;if(!S)break t;else{S=0;break}}m=Ki(m,(f[V>>2]|0)+(f[M>>2]|0)|0)|0;if(!m){xe=65;break t}f[p>>2]=m;S=0}}while(0);m=f[R>>2]|0;if(m){w=Yn(u)|0;g=B;T=Wl(w|0,g|0,-2,-1)|0;v=f[U>>2]|0;m=m+40|0;_=f[m>>2]|0;E=f[_+(v*40|0)+12>>2]|0;y=f[_+(v*40|0)+16>>2]|0;x=y+(E*24|0)+8|0;f[x>>2]=T;f[x+4>>2]=B;x=f[V>>2]|0;g=Wl(x|0,0,w|0,g|0)|0;E=y+(E*24|0)+16|0;f[E>>2]=g;f[E+4>>2]=B;x=x+2|0;E=f[_+(v*40|0)+20>>2]|0;g=_+(v*40|0)+28|0;y=f[g>>2]|0;if((E+1|0)>>>0>y>>>0){y=~~(+(y>>>0)+100.0)>>>0;f[g>>2]=y;g=Ki(f[_+(v*40|0)+24>>2]|0,y*24|0)|0;y=f[m>>2]|0;_=y+(v*40|0)+24|0;if(!g){p=_;xe=74;break}f[_>>2]=g;w=y;m=f[y+(v*40|0)+20>>2]|0}else{w=_;g=f[_+(v*40|0)+24>>2]|0;m=E}d[g+(m*24|0)>>1]=-109;E=jl(0,T|0,32)|0;T=g+(m*24|0)+8|0;f[T>>2]=E;f[T+4>>2]=B;f[g+(m*24|0)+16>>2]=x;f[w+(v*40|0)+20>>2]=m+1}if(!S)p=Gn(u,(f[p>>2]|0)+(f[M>>2]|0)|0,f[V>>2]|0,c)|0;else p=0;f[Me>>2]=(p|0)==(f[V>>2]|0)?8:64;f[M>>2]=(f[M>>2]|0)+p;p=h[_e>>0]|0;if((p&9)==1){h[_e>>0]=p|8;m=f[U>>2]|0;do{if((Kn(u)|0)!=0?(N=Yn(u)|0,F=B,!((N|0)==-1&(F|0)==-1)):0){while(1){if((Gn(u,Y,2,c)|0)!=2){xe=81;break}wn(Y,W,2);if((f[W>>2]|0)!=65424){xe=83;break}if((Gn(u,Y,2,c)|0)!=2){xe=85;break}wn(Y,Z,2);if((f[Z>>2]|0)!=10){xe=87;break}f[Z>>2]=8;p=Gn(u,Y,8,c)|0;if((p|0)!=(f[Z>>2]|0)){xe=89;break}if((p|0)!=8){xe=91;break}wn(Y,K,2);wn(C,Q,4);wn(L,X,1);wn(I,J,1);if((f[K>>2]|0)==(m|0)){xe=97;break}p=f[Q>>2]|0;if(p>>>0<14){xe=94;break}xe=p+-12|0;f[Q>>2]=xe;xe=Zn(u,xe,0,c)|0;if(!((B|0)==0?(xe|0)==(f[Q>>2]|0):0)){xe=96;break}}if((xe|0)==81){xe=0;p=(Jn(u,N,F,c)|0)!=0&1;m=0;break}else if((xe|0)==83){xe=0;p=(Jn(u,N,F,c)|0)!=0&1;m=0;break}else if((xe|0)==85){xe=0;Qn(c,1,8295,oe)|0;p=0;m=0;break}else if((xe|0)==87){xe=0;Qn(c,1,8313,se)|0;p=0;m=0;break}else if((xe|0)==89){xe=0;Qn(c,1,8295,ue)|0;p=0;m=0;break}else if((xe|0)==91){xe=0;Qn(c,1,8662,he)|0;p=0;m=0;break}else if((xe|0)==94){xe=0;p=(Jn(u,N,F,c)|0)!=0&1;m=0;break}else if((xe|0)==96){xe=0;p=(Jn(u,N,F,c)|0)!=0&1;m=0;break}else if((xe|0)==97){xe=0;m=(f[X>>2]|0)==(f[J>>2]|0)&1;p=(Jn(u,N,F,c)|0)!=0&1;break}}else{p=1;m=0}}while(0);if(!p){xe=99;break}if(m){p=ce(f[k>>2]|0,f[A>>2]|0)|0;h[_e>>0]=h[_e>>0]&-18|16;if(p){m=f[z>>2]|0;y=0;do{v=m+(y*5640|0)+5588|0;g=f[v>>2]|0;if(g)f[v>>2]=g+1;y=y+1|0}while((y|0)!=(p|0))}Qn(c,2,8734,fe)|0}}if(!(h[_e>>0]&1)){if((Gn(u,f[O>>2]|0,2,c)|0)!=2){xe=109;break}wn(f[O>>2]|0,G,2)}}else{h[_e>>0]=p&-6;f[Me>>2]=8;if((Gn(u,f[O>>2]|0,2,c)|0)!=2){xe=113;break}wn(f[O>>2]|0,G,2)}p=f[G>>2]|0;if(!((p|0)!=65497&(h[_e>>0]&1)==0)){xe=116;break}}switch(xe|0){case 9:{Qn(c,1,8295,$)|0;c=0;b=ke;return c|0}case 11:{Qn(c,1,8313,ee)|0;c=0;b=ke;return c|0}case 20:{Qn(c,1,8339,le)|0;c=0;b=ke;return c|0}case 24:{Qn(c,1,8382,ve)|0;c=0;b=ke;return c|0}case 26:{Qi(f[O>>2]|0);f[O>>2]=0;f[H>>2]=0;Qn(c,1,8427,ge)|0;c=0;b=ke;return c|0}case 29:{Qn(c,1,8295,ye)|0;c=0;b=ke;return c|0}case 31:{Qn(c,1,8461,te)|0;c=0;b=ke;return c|0}case 33:{f[re>>2]=f[G>>2];Qn(c,1,8490,re)|0;c=0;b=ke;return c|0}case 41:{Qi(f[p>>2]|0);Ae=f[m>>2]|0;f[Ae+(v*40|0)+24>>2]=0;f[Ae+(v*40|0)+28>>2]=0;f[Ae+(v*40|0)+20>>2]=0;Qn(c,1,8537,Ee)|0;c=0;b=ke;return c|0}case 47:{Qn(c,1,8295,ne)|0;c=0;b=ke;return c|0}case 50:{Qn(c,1,8295,ie)|0;c=0;b=ke;return c|0}case 65:{Qi(f[p>>2]|0);f[p>>2]=0;break}case 74:{Qi(f[p>>2]|0);Ae=f[m>>2]|0;f[Ae+(v*40|0)+24>>2]=0;f[Ae+(v*40|0)+28>>2]=0;f[Ae+(v*40|0)+20>>2]=0;Qn(c,1,8537,we)|0;c=0;b=ke;return c|0}case 99:{Qn(c,1,8688,de)|0;c=0;b=ke;return c|0}case 109:{Qn(c,1,8295,pe)|0;c=0;b=ke;return c|0}case 113:{Qn(c,1,8295,me)|0;c=0;b=ke;return c|0}case 115:{p=f[G>>2]|0;xe=116;break}}if((xe|0)==116)if((p|0)==65497){p=_e;xe=117;break e}else{p=_e;break e}Qn(c,1,8628,be)|0;c=0;b=ke;return c|0}else p=_e;break}default:{c=0;b=ke;return c|0}}}while(0);if((xe|0)==117)if((f[Me>>2]|0)!=256){f[e+200>>2]=0;f[Me>>2]=256}if(!(h[p>>0]&1)){g=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;y=e+200|0;m=f[y>>2]|0;e:do{if(m>>>0<g>>>0){p=m;v=(f[e+164>>2]|0)+(m*5640|0)|0;while(1){if(f[v+5592>>2]|0){m=p;break e}m=p+1|0;f[y>>2]=m;if(m>>>0<g>>>0){p=m;v=v+5640|0}else break}}}while(0);if((m|0)==(g|0)){f[l>>2]=0;c=1;b=ke;return c|0}}else{m=e+200|0;y=m;m=f[m>>2]|0}M=f[e+164>>2]|0;if(h[M+(m*5640|0)+5636>>0]&2){R=M+(m*5640|0)+5160|0;v=f[R>>2]|0;if(!v)p=0;else{g=f[M+(m*5640|0)+5164>>2]|0;_=0;p=0;do{p=(f[g+(_<<3)+4>>2]|0)+p|0;_=_+1|0}while((_|0)!=(v|0))}xe=Yi(p)|0;S=M+(m*5640|0)+5172|0;f[S>>2]=xe;if(!xe){Qn(c,1,8775,Te)|0;Qn(c,1,8813,Se)|0;c=0;b=ke;return c|0}T=M+(m*5640|0)+5180|0;f[T>>2]=p;v=f[R>>2]|0;x=M+(m*5640|0)+5164|0;if(!v)p=f[x>>2]|0;else{p=f[x>>2]|0;E=p;w=0;_=0;while(1){g=f[E+(w<<3)>>2]|0;if(!g)g=E;else{Yl((f[S>>2]|0)+_|0,g|0,f[E+(w<<3)+4>>2]|0)|0;g=f[x>>2]|0;_=(f[g+(w<<3)+4>>2]|0)+_|0;Qi(f[g+(w<<3)>>2]|0);g=f[x>>2]|0;f[g+(w<<3)>>2]=0;f[g+(w<<3)+4>>2]=0;v=f[R>>2]|0;p=g}w=w+1|0;if(w>>>0>=v>>>0)break;else E=g}}f[R>>2]=0;Qi(p);f[x>>2]=0;f[M+(m*5640|0)+5168>>2]=f[S>>2];f[M+(m*5640|0)+5176>>2]=f[T>>2];m=f[y>>2]|0}p=e+204|0;if(!(qr(f[p>>2]|0,m,c)|0)){Qn(c,1,8839,Re)|0;c=0;b=ke;return c|0}else{Re=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;f[Ae>>2]=(f[y>>2]|0)+1;f[Ae+4>>2]=Re;Qn(c,4,8873,Ae)|0;f[t>>2]=f[y>>2];f[l>>2]=1;c=Zr(f[p>>2]|0)|0;f[r>>2]=c;c=f[f[(f[p>>2]|0)+20>>2]>>2]|0;f[n>>2]=f[c>>2];f[i>>2]=f[c+4>>2];f[a>>2]=f[c+8>>2];f[o>>2]=f[c+12>>2];f[s>>2]=f[c+16>>2];f[Me>>2]=f[Me>>2]|128;c=1;b=ke;return c|0}return 0}function ua(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0;y=b;b=b+48|0;v=y+28|0;g=y+32|0;d=e+8|0;if(!(f[d>>2]&128)){i=0;b=y;return i|0}m=e+200|0;if((f[m>>2]|0)!=(t|0)){i=0;b=y;return i|0}o=f[e+164>>2]|0;c=o+(t*5640|0)|0;p=o+(t*5640|0)+5592|0;s=f[p>>2]|0;if(!s){Ta(c);i=0;b=y;return i|0}l=e+204|0;u=o+(t*5640|0)+5596|0;if(!(Kr(f[l>>2]|0,s,f[u>>2]|0,t,f[e+196>>2]|0,a)|0)){Ta(c);f[d>>2]=f[d>>2]|32768;Qn(a,1,8912,y)|0;i=0;b=y;return i|0}if(!(Qr(f[l>>2]|0,r,n)|0)){i=0;b=y;return i|0}o=f[p>>2]|0;if(o){Qi(o);f[p>>2]=0;f[u>>2]=0}p=e+76|0;h[p>>0]=h[p>>0]&-2;f[d>>2]=f[d>>2]&-129;p=qn(i)|0;e=f[d>>2]|0;if((e|0)==256|(p|0)==0&(B|0)==0&(e|0)==64){i=1;b=y;return i|0}if((Gn(i,g,2,a)|0)!=2){Qn(a,2,8931,y+8|0)|0;i=1;b=y;return i|0}wn(g,v,2);switch(f[v>>2]|0){case 65497:{f[m>>2]=0;f[d>>2]=256;i=1;b=y;return i|0}case 65424:{i=1;b=y;return i|0}default:if((qn(i)|0)==0&(B|0)==0){f[d>>2]=64;Qn(a,2,8975,y+16|0)|0;i=1;b=y;return i|0}else{Qn(a,1,9005,y+24|0)|0;i=0;b=y;return i|0}}return 0}function ca(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0;S=b;b=b+112|0;T=S+96|0;x=S+88|0;w=S+80|0;E=S+72|0;_=S+64|0;g=S+56|0;v=S+48|0;d=S+40|0;c=S+32|0;u=S+24|0;l=S+16|0;p=f[e+80>>2]|0;if((f[e+8>>2]|0)!=8){Qn(o,1,9037,S)|0;o=0;b=S;return o|0}if(!(n|r|i|a)){Qn(o,4,9116,S+8|0)|0;f[e+28>>2]=0;f[e+32>>2]=0;f[e+36>>2]=f[e+112>>2];f[e+40>>2]=f[e+116>>2];o=1;b=S;return o|0}y=p+8|0;s=f[y>>2]|0;if(s>>>0<r>>>0){f[l>>2]=r;f[l+4>>2]=s;Qn(o,1,9185,l)|0;o=0;b=S;return o|0}s=f[p>>2]|0;if(s>>>0>r>>>0){f[u>>2]=r;f[u+4>>2]=s;Qn(o,2,9272,u)|0;s=0;r=f[p>>2]|0}else s=((r-(f[e+92>>2]|0)|0)>>>0)/((f[e+100>>2]|0)>>>0)|0;f[e+28>>2]=s;f[t>>2]=r;m=p+12|0;r=f[m>>2]|0;if(r>>>0<n>>>0){f[c>>2]=n;f[c+4>>2]=r;Qn(o,1,9360,c)|0;o=0;b=S;return o|0}l=p+4|0;r=f[l>>2]|0;if(r>>>0>n>>>0){f[d>>2]=n;f[d+4>>2]=r;Qn(o,2,9445,d)|0;r=0;n=f[l>>2]|0}else r=((n-(f[e+96>>2]|0)|0)>>>0)/((f[e+104>>2]|0)>>>0)|0;f[e+32>>2]=r;u=t+4|0;f[u>>2]=n;r=f[p>>2]|0;if(r>>>0>i>>>0){f[v>>2]=i;f[v+4>>2]=r;Qn(o,1,9531,v)|0;o=0;b=S;return o|0}r=f[y>>2]|0;if(r>>>0<i>>>0){f[g>>2]=i;f[g+4>>2]=r;Qn(o,2,9620,g)|0;r=f[e+112>>2]|0;i=f[y>>2]|0}else{r=f[e+100>>2]|0;r=(i+-1-(f[e+92>>2]|0)+r|0)/(r|0)|0}f[e+36>>2]=r;s=t+8|0;f[s>>2]=i;i=f[l>>2]|0;if(i>>>0>a>>>0){f[_>>2]=a;f[_+4>>2]=i;Qn(o,1,9708,_)|0;o=0;b=S;return o|0}i=f[m>>2]|0;if(i>>>0<a>>>0){f[E>>2]=a;f[E+4>>2]=i;Qn(o,2,9798,E)|0;r=f[m>>2]|0;i=f[e+116>>2]|0}else{i=f[e+104>>2]|0;r=a;i=(a+-1-(f[e+96>>2]|0)+i|0)/(i|0)|0}f[e+40>>2]=i;a=t+12|0;f[a>>2]=r;E=e+76|0;h[E>>0]=h[E>>0]|2;E=f[t+16>>2]|0;e=f[t>>2]|0;e:do{if(E){n=f[u>>2]|0;y=n+-1|0;_=f[s>>2]|0;m=_+-1|0;v=e+-1|0;i=0;p=f[t+24>>2]|0;while(1){t=f[p>>2]|0;r=(v+t|0)/(t|0)|0;f[p+16>>2]=r;d=f[p+4>>2]|0;s=(y+d|0)/(d|0)|0;f[p+20>>2]=s;t=(m+t|0)/(t|0)|0;l=f[p+40>>2]|0;u=Gl(1,0,l|0)|0;c=B;t=Wl(t|0,((t|0)<0)<<31>>31|0,-1,-1)|0;t=Wl(t|0,B|0,u|0,c|0)|0;t=jl(t|0,B|0,l|0)|0;r=Wl(r|0,((r|0)<0)<<31>>31|0,-1,-1)|0;r=Wl(r|0,B|0,u|0,c|0)|0;r=jl(r|0,B|0,l|0)|0;r=t-r|0;if((r|0)<0){s=29;break}g=f[a>>2]|0;t=(d+-1+g|0)/(d|0)|0;f[p+8>>2]=r;t=Wl(t|0,((t|0)<0)<<31>>31|0,-1,-1)|0;t=Wl(t|0,B|0,u|0,c|0)|0;t=jl(t|0,B|0,l|0)|0;r=Wl(s|0,((s|0)<0)<<31>>31|0,-1,-1)|0;r=Wl(r|0,B|0,u|0,c|0)|0;r=jl(r|0,B|0,l|0)|0;r=t-r|0;if((r|0)<0){s=31;break}f[p+12>>2]=r;i=i+1|0;if(i>>>0>=E>>>0){r=_;i=g;break e}else p=p+52|0}if((s|0)==29){f[w>>2]=i;f[w+4>>2]=r;Qn(o,1,9887,w)|0;o=0;b=S;return o|0}else if((s|0)==31){f[x>>2]=i;f[x+4>>2]=r;Qn(o,1,9956,x)|0;o=0;b=S;return o|0}}else{n=f[u>>2]|0;r=f[s>>2]|0;i=f[a>>2]|0}}while(0);f[T>>2]=e;f[T+4>>2]=n;f[T+8>>2]=r;f[T+12>>2]=i;Qn(o,4,10025,T)|0;o=1;b=S;return o|0}function ha(){var e=0,t=0,r=0;e=qi(1,208)|0;if(!e){t=0;return t|0}f[e>>2]=1;t=e+184|0;h[t>>0]=h[t>>0]|2;t=qi(1,5640)|0;f[e+12>>2]=t;if(!t){ra(e);t=0;return t|0}t=qi(1,1e3)|0;f[e+16>>2]=t;if(!t){ra(e);t=0;return t|0}f[e+20>>2]=1e3;f[e+60>>2]=-1;t=e+64|0;f[t>>2]=0;f[t+4>>2]=0;t=qi(1,48)|0;do{if(t){f[t+32>>2]=100;f[t+24>>2]=0;r=qi(100,24)|0;f[t+28>>2]=r;if(!r){Qi(t);break}f[t+40>>2]=0;f[e+196>>2]=t;r=go()|0;f[e+192>>2]=r;if(!r){ra(e);r=0;return r|0}r=go()|0;f[e+188>>2]=r;if(r){r=e;return r|0}ra(e);r=0;return r|0}}while(0);f[e+196>>2]=0;ra(e);r=0;return r|0}function da(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,v=0,g=0,y=0,_=0;y=b;b=b+128|0;g=y+104|0;v=y+72|0;p=y+64|0;c=y+40|0;l=y+24|0;o=y+16|0;a=y+8|0;i=y;if(t&384){hl(10063,11,1,r)|0;b=y;return}if((t&1|0)!=0?(n=f[e+80>>2]|0,(n|0)!=0):0)fa(n,0,r);if(t&2){hl(10075,36,1,r)|0;n=f[e+96>>2]|0;f[i>>2]=f[e+92>>2];f[i+4>>2]=n;el(r,10112,i)|0;i=f[e+104>>2]|0;f[a>>2]=f[e+100>>2];f[a+4>>2]=i;el(r,10130,a)|0;a=f[e+116>>2]|0;f[o>>2]=f[e+112>>2];f[o+4>>2]=a;el(r,10148,o)|0;ka(f[e+12>>2]|0,f[(f[e+80>>2]|0)+16>>2]|0,r);hl(10164,2,1,r)|0}if((t&8|0)!=0?(s=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0,(s|0)!=0):0){n=e+80|0;i=0;a=f[e+164>>2]|0;while(1){ka(a,f[(f[n>>2]|0)+16>>2]|0,r);i=i+1|0;if((i|0)==(s|0))break;else a=a+5640|0}}if(!(t&16)){b=y;return}o=f[e+196>>2]|0;hl(10167,37,1,r)|0;s=o;t=f[s+4>>2]|0;n=o+8|0;e=f[n>>2]|0;n=f[n+4>>2]|0;a=l;f[a>>2]=f[s>>2];f[a+4>>2]=t;a=l+8|0;f[a>>2]=e;f[a+4>>2]=n;el(r,10205,l)|0;hl(10272,17,1,r)|0;a=o+28|0;n=f[a>>2]|0;e:do{if((n|0)!=0?(u=o+24|0,(f[u>>2]|0)!=0):0){i=0;while(1){t=n+(i*24|0)+8|0;s=f[t>>2]|0;t=f[t+4>>2]|0;l=f[n+(i*24|0)+16>>2]|0;f[c>>2]=m[n+(i*24|0)>>1];e=c+8|0;f[e>>2]=s;f[e+4>>2]=t;f[c+16>>2]=l;el(r,10290,c)|0;i=i+1|0;if(i>>>0>=(f[u>>2]|0)>>>0)break e;n=f[a>>2]|0}}}while(0);hl(10321,4,1,r)|0;t=o+40|0;a=f[t>>2]|0;if((a|0)!=0?(d=o+36|0,h=f[d>>2]|0,(h|0)!=0):0){i=0;n=0;do{n=(f[a+(i*40|0)+4>>2]|0)+n|0;i=i+1|0}while((i|0)!=(h|0));if(n){hl(10326,16,1,r)|0;if(f[d>>2]|0){n=f[t>>2]|0;s=0;do{o=f[n+(s*40|0)+4>>2]|0;f[p>>2]=s;f[p+4>>2]=o;el(r,10343,p)|0;n=f[t>>2]|0;i=f[n+(s*40|0)+16>>2]|0;e:do{if(!((o|0)==0|(i|0)==0)){n=0;while(1){e=i+(n*24|0)|0;_=f[e>>2]|0;e=f[e+4>>2]|0;u=i+(n*24|0)+8|0;l=f[u>>2]|0;u=f[u+4>>2]|0;h=i+(n*24|0)+16|0;c=f[h>>2]|0;h=f[h+4>>2]|0;f[v>>2]=n;a=v+8|0;f[a>>2]=_;f[a+4>>2]=e;a=v+16|0;f[a>>2]=l;f[a+4>>2]=u;a=v+24|0;f[a>>2]=c;f[a+4>>2]=h;el(r,10379,v)|0;a=n+1|0;n=f[t>>2]|0;if((a|0)==(o|0))break e;i=f[n+(s*40|0)+16>>2]|0;n=a}}}while(0);i=f[n+(s*40|0)+24>>2]|0;e:do{if((i|0)!=0?(f[n+(s*40|0)+20>>2]|0)!=0:0){n=0;while(1){h=i+(n*24|0)+8|0;c=f[h>>2]|0;h=f[h+4>>2]|0;a=f[i+(n*24|0)+16>>2]|0;f[g>>2]=m[i+(n*24|0)>>1];_=g+8|0;f[_>>2]=c;f[_+4>>2]=h;f[g+16>>2]=a;el(r,10290,g)|0;a=n+1|0;n=f[t>>2]|0;if(a>>>0>=(f[n+(s*40|0)+20>>2]|0)>>>0)break e;i=f[n+(s*40|0)+24>>2]|0;n=a}}}while(0);s=s+1|0}while(s>>>0<(f[d>>2]|0)>>>0)}hl(10321,4,1,r)|0}}hl(10164,2,1,r)|0;b=y;return}function fa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0;c=b;b=b+64|0;u=c+48|0;l=c+40|0;o=c+32|0;a=c+16|0;i=c;s=c+52|0;if(!t){hl(10482,13,1,r)|0;h[s+1>>0]=0;n=9}else{hl(10445,36,1,f[676]|0)|0;n=0}h[s>>0]=n;d=f[e>>2]|0;n=f[e+4>>2]|0;f[i>>2]=s;f[i+4>>2]=d;f[i+8>>2]=n;el(r,10496,i)|0;i=f[e+8>>2]|0;n=f[e+12>>2]|0;f[a>>2]=s;f[a+4>>2]=i;f[a+8>>2]=n;el(r,10513,a)|0;a=e+16|0;n=f[a>>2]|0;f[o>>2]=s;f[o+4>>2]=n;el(r,10530,o)|0;n=e+24|0;if(!(f[n>>2]|0)){hl(10164,2,1,r)|0;b=c;return}if(!(f[a>>2]|0)){hl(10164,2,1,r)|0;b=c;return}else i=0;do{f[l>>2]=s;f[l+4>>2]=i;el(r,10546,l)|0;pa((f[n>>2]|0)+(i*52|0)|0,t,r);f[u>>2]=s;el(r,10566,u)|0;i=i+1|0}while(i>>>0<(f[a>>2]|0)>>>0);hl(10164,2,1,r)|0;b=c;return}function pa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;l=b;b=b+48|0;s=l+24|0;o=l+16|0;a=l;i=l+32|0;n=(t|0)!=0;if(n){hl(10571,41,1,f[676]|0)|0;t=0}else{h[i+1>>0]=9;h[i+2>>0]=0;t=9}h[i>>0]=t;u=f[e>>2]|0;t=f[e+4>>2]|0;f[a>>2]=i;f[a+4>>2]=u;f[a+8>>2]=t;el(r,10613,a)|0;a=f[e+24>>2]|0;f[o>>2]=i;f[o+4>>2]=a;el(r,10630,o)|0;o=f[e+32>>2]|0;f[s>>2]=i;f[s+4>>2]=o;el(r,10642,s)|0;if(!n){b=l;return}hl(10164,2,1,r)|0;b=l;return}function ma(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=b;b=b+16|0;n=c;t=e+80|0;l=f[(f[t>>2]|0)+16>>2]|0;r=qi(1,56)|0;f[n>>2]=r;if(!r){u=0;b=c;return u|0}f[r+24>>2]=f[(f[t>>2]|0)+16>>2];f[r>>2]=f[e+92>>2];f[r+4>>2]=f[e+96>>2];f[r+8>>2]=f[e+100>>2];f[r+12>>2]=f[e+104>>2];f[r+16>>2]=f[e+112>>2];f[r+20>>2]=f[e+116>>2];f[r+52>>2]=0;r=f[e+12>>2]|0;t=f[n>>2]|0;f[t+32>>2]=f[r>>2];f[t+36>>2]=f[r+4>>2];f[t+40>>2]=f[r+8>>2];f[t+44>>2]=f[r+16>>2];s=qi(f[t+24>>2]|0,1080)|0;f[t+48>>2]=s;t=f[n>>2]|0;s=t+48|0;e=f[s>>2]|0;if(!e){Oi(n);u=0;b=c;return u|0}if(!l){u=t;b=c;return u|0}o=r+5584|0;r=0;while(1){a=f[o>>2]|0;f[e+(r*1080|0)+4>>2]=f[a+(r*1080|0)>>2];n=a+(r*1080|0)+4|0;i=f[n>>2]|0;f[e+(r*1080|0)+8>>2]=i;f[e+(r*1080|0)+12>>2]=f[a+(r*1080|0)+8>>2];f[e+(r*1080|0)+16>>2]=f[a+(r*1080|0)+12>>2];f[e+(r*1080|0)+20>>2]=f[a+(r*1080|0)+16>>2];f[e+(r*1080|0)+24>>2]=f[a+(r*1080|0)+20>>2];if(i>>>0<33){Yl(e+(r*1080|0)+948|0,a+(r*1080|0)+944|0,i|0)|0;Yl(e+(r*1080|0)+816|0,a+(r*1080|0)+812|0,f[n>>2]|0)|0}i=f[a+(r*1080|0)+24>>2]|0;f[e+(r*1080|0)+28>>2]=i;f[e+(r*1080|0)+808>>2]=f[a+(r*1080|0)+804>>2];if((i|0)!=1){i=(f[n>>2]|0)*3|0;n=i+-2|0;if((n|0)<97&(i|0)>2)u=10}else{n=1;u=10}if((u|0)==10){u=0;i=0;do{f[e+(r*1080|0)+32+(i<<2)>>2]=f[a+(r*1080|0)+28+(i<<3)+4>>2];f[e+(r*1080|0)+420+(i<<2)>>2]=f[a+(r*1080|0)+28+(i<<3)>>2];i=i+1|0}while((i|0)!=(n|0))}f[e+(r*1080|0)+812>>2]=f[a+(r*1080|0)+808>>2];r=r+1|0;if((r|0)==(l|0))break;e=f[s>>2]|0}b=c;return t|0}function va(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0;t=qi(1,48)|0;if(!t){u=0;return u|0}o=e+196|0;r=f[o>>2]|0;s=r;u=f[s+4>>2]|0;e=t;f[e>>2]=f[s>>2];f[e+4>>2]=u;e=r+8|0;u=f[e+4>>2]|0;s=t+8|0;f[s>>2]=f[e>>2];f[s+4>>2]=u;s=r+16|0;u=f[s+4>>2]|0;e=t+16|0;f[e>>2]=f[s>>2];f[e+4>>2]=u;r=f[r+24>>2]|0;e=t+24|0;f[e>>2]=r;r=Yi(r*24|0)|0;u=t+28|0;f[u>>2]=r;if(!r){Qi(t);u=0;return u|0}n=f[(f[o>>2]|0)+28>>2]|0;if(!n){Qi(r);f[u>>2]=0}else Yl(r|0,n|0,(f[e>>2]|0)*24|0)|0;e=f[(f[o>>2]|0)+36>>2]|0;a=t+36|0;f[a>>2]=e;e=qi(e,40)|0;s=t+40|0;f[s>>2]=e;if(!e){Qi(f[u>>2]|0);Qi(t);u=0;return u|0}r=f[(f[o>>2]|0)+40>>2]|0;if(!r){Qi(e);f[s>>2]=0;u=t;return u|0}if(!(f[a>>2]|0)){u=t;return u|0}r=f[r+20>>2]|0;f[e+20>>2]=r;r=Yi(r*24|0)|0;e=f[s>>2]|0;f[e+24>>2]=r;e:do{if(!r)r=0;else{i=r;r=0;while(1){n=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+24>>2]|0;if(!n){Qi(i);e=f[s>>2]|0;f[e+(r*40|0)+24>>2]=0}else{Yl(i|0,n|0,(f[e+(r*40|0)+20>>2]|0)*24|0)|0;e=f[s>>2]|0}n=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+4>>2]|0;f[e+(r*40|0)+4>>2]=n;n=Yi(n*24|0)|0;e=f[s>>2]|0;f[e+(r*40|0)+16>>2]=n;if(!n)break;i=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+16>>2]|0;if(!i){Qi(n);e=f[s>>2]|0;f[e+(r*40|0)+16>>2]=0}else{Yl(n|0,i|0,(f[e+(r*40|0)+4>>2]|0)*24|0)|0;e=f[s>>2]|0}f[e+(r*40|0)+32>>2]=0;f[e+(r*40|0)+36>>2]=0;r=r+1|0;if(r>>>0>=(f[a>>2]|0)>>>0){l=32;break}i=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+20>>2]|0;f[e+(r*40|0)+20>>2]=i;i=Yi(i*24|0)|0;e=f[s>>2]|0;f[e+(r*40|0)+24>>2]=i;if(!i)break e}if((l|0)==32)return t|0;if(r){Qi(f[e+24>>2]|0);Qi(f[(f[s>>2]|0)+16>>2]|0);if((r|0)!=1){e=1;do{Qi(f[(f[s>>2]|0)+(e*40|0)+24>>2]|0);Qi(f[(f[s>>2]|0)+(e*40|0)+16>>2]|0);e=e+1|0}while((e|0)!=(r|0))}e=f[s>>2]|0}Qi(e);Qi(f[u>>2]|0);Qi(t);u=0;return u|0}}while(0);if(r){Qi(f[e+24>>2]|0);if((r|0)!=1){e=1;do{Qi(f[(f[s>>2]|0)+(e*40|0)+24>>2]|0);e=e+1|0}while((e|0)!=(r|0))}e=f[s>>2]|0}Qi(e);Qi(f[u>>2]|0);Qi(t);u=0;return u|0}function ga(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;if(!r){r=0;return r|0}i=ti()|0;u=e+84|0;f[u>>2]=i;if(!i){r=0;return r|0}ai(r,i);o=e+188|0;_o(f[o>>2]|0,27,n)|0;o=f[o>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](e,t,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){r=e+80|0;ni(f[r>>2]|0);f[r>>2]=0;r=0;return r|0}}else wo(o);s=f[r+16>>2]|0;if(!s){r=1;return r|0}o=f[(f[u>>2]|0)+24>>2]|0;i=f[r+24>>2]|0;a=0;do{f[i+(a*52|0)+36>>2]=f[o+(a*52|0)+36>>2];r=o+(a*52|0)+44|0;f[i+(a*52|0)+44>>2]=f[r>>2];f[r>>2]=0;a=a+1|0}while(a>>>0<s>>>0);i=1;return i|0}function ya(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0;y=b;b=b+16|0;s=y+8|0;if(!r){Qn(n,1,10654,y)|0;g=0;b=y;return g|0}a=f[e+112>>2]|0;o=ce(f[e+116>>2]|0,a)|0;if(o>>>0<=i>>>0){f[s>>2]=i;f[s+4>>2]=o+-1;Qn(n,1,10692,s)|0;g=0;b=y;return g|0}g=(i>>>0)%(a>>>0)|0;v=(i>>>0)/(a>>>0)|0;s=f[e+100>>2]|0;o=ce(s,g)|0;l=f[e+92>>2]|0;o=o+l|0;f[r>>2]=o;m=e+80|0;a=f[m>>2]|0;u=f[a>>2]|0;o=o>>>0<u>>>0?u:o;f[r>>2]=o;l=(ce(s,g+1|0)|0)+l|0;g=r+8|0;f[g>>2]=l;s=f[a+8>>2]|0;l=l>>>0>s>>>0?s:l;f[g>>2]=l;g=f[e+104>>2]|0;s=ce(g,v)|0;u=f[e+96>>2]|0;s=s+u|0;p=r+4|0;f[p>>2]=s;d=f[a+4>>2]|0;s=s>>>0<d>>>0?d:s;f[p>>2]=s;u=(ce(g,v+1|0)|0)+u|0;v=r+12|0;f[v>>2]=u;g=f[a+12>>2]|0;u=u>>>0>g>>>0?g:u;f[v>>2]=u;v=r+24|0;g=r+16|0;p=f[g>>2]|0;if(p){d=f[a+24>>2]|0;h=o+-1|0;c=s+-1|0;l=l+-1|0;a=u+-1|0;o=0;s=f[v>>2]|0;while(1){u=f[d+(o*52|0)+40>>2]|0;f[s+40>>2]=u;S=f[s>>2]|0;T=(h+S|0)/(S|0)|0;f[s+16>>2]=T;_=f[s+4>>2]|0;x=(c+_|0)/(_|0)|0;f[s+20>>2]=x;S=(l+S|0)/(S|0)|0;_=(a+_|0)/(_|0)|0;w=Gl(1,0,u|0)|0;E=B;S=Wl(S|0,((S|0)<0)<<31>>31|0,-1,-1)|0;S=Wl(S|0,B|0,w|0,E|0)|0;S=jl(S|0,B|0,u|0)|0;T=Wl(T|0,((T|0)<0)<<31>>31|0,-1,-1)|0;T=Wl(T|0,B|0,w|0,E|0)|0;T=jl(T|0,B|0,u|0)|0;f[s+8>>2]=S-T;_=Wl(_|0,((_|0)<0)<<31>>31|0,-1,-1)|0;_=Wl(_|0,B|0,w|0,E|0)|0;_=jl(_|0,B|0,u|0)|0;x=Wl(x|0,((x|0)<0)<<31>>31|0,-1,-1)|0;E=Wl(x|0,B|0,w|0,E|0)|0;u=jl(E|0,B|0,u|0)|0;f[s+12>>2]=_-u;o=o+1|0;if(o>>>0>=p>>>0)break;else s=s+52|0}}c=e+84|0;a=f[c>>2]|0;if(a)ni(a);a=ti()|0;f[c>>2]=a;if(!a){S=0;b=y;return S|0}ai(r,a);f[e+60>>2]=i;s=e+188|0;_o(f[s>>2]|0,28,n)|0;s=f[s>>2]|0;l=bo(s)|0;a=Eo(s)|0;if(l){u=0;o=1;while(1){if(!o)o=0;else o=(ku[f[a>>2]&63](e,t,n)|0)!=0;u=u+1|0;if((u|0)==(l|0))break;else{a=a+4|0;o=o&1}}wo(s);if(!o){ni(f[m>>2]|0);f[m>>2]=0;S=0;b=y;return S|0}}else wo(s);a=f[g>>2]|0;if(!a){S=1;b=y;return S|0}l=f[(f[c>>2]|0)+24>>2]|0;s=f[v>>2]|0;u=0;while(1){f[s+(u*52|0)+36>>2]=f[l+(u*52|0)+36>>2];o=f[s+(u*52|0)+44>>2]|0;if(!o)o=l;else{Qi(o);o=f[(f[c>>2]|0)+24>>2]|0;s=f[v>>2]|0;a=f[g>>2]|0}S=o+(u*52|0)+44|0;f[s+(u*52|0)+44>>2]=f[S>>2];f[S>>2]=0;u=u+1|0;if(u>>>0>=a>>>0){a=1;break}else l=o}b=y;return a|0}function _a(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0;l=b;b=b+16|0;s=l;f[e+168>>2]=t;n=f[e+80>>2]|0;e:do{if((((n|0)!=0?(o=f[n+24>>2]|0,(o|0)!=0):0)?(i=f[e+12>>2]|0,(i|0)!=0):0)?(a=f[i+5584>>2]|0,(a|0)!=0):0){n=f[n+16>>2]|0;if(!n)n=1;else{i=0;while(1){if((f[a+(i*1080|0)+4>>2]|0)>>>0<=t>>>0)break;f[o+(i*52|0)+40>>2]=t;i=i+1|0;if(i>>>0>=n>>>0){n=1;break e}}Qn(r,1,10753,s)|0;n=0}}else n=0}while(0);b=l;return n|0}function ba(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0;j=b;b=b+48|0;B=j+32|0;U=j+24|0;F=j+16|0;D=j+8|0;N=j;M=e+204|0;n=f[M>>2]|0;C=e+116|0;L=e+112|0;I=ce(f[L>>2]|0,f[C>>2]|0)|0;O=(I|0)==1;if(!I){z=1;b=j;return z|0}H=e+200|0;R=e+12|0;A=e+164|0;k=e+8|0;P=n+20|0;T=n+24|0;S=0;n=0;s=0;e:while(1){if((f[H>>2]|0)!=(S|0)){z=5;break}w=S;S=S+1|0;x=ce(f[C>>2]|0,f[L>>2]|0)|0;f[D>>2]=S;f[D+4>>2]=x;Qn(r,4,10866,D)|0;f[R>>2]=0;x=f[M>>2]|0;f[x+12>>2]=f[(f[A>>2]|0)+(w*5640|0)+5588>>2];f[k>>2]=0;if(!(Yr(x,f[H>>2]|0,r)|0))break;i=f[M>>2]|0;if(f[(f[i+24>>2]|0)+16>>2]|0){o=0;do{a=f[(f[f[P>>2]>>2]|0)+20>>2]|0;if(O){f[a+(o*52|0)+32>>2]=f[(f[(f[T>>2]|0)+24>>2]|0)+(o*52|0)+44>>2];f[a+(o*52|0)+36>>2]=0}else{if(!(Xr(a+(o*52|0)|0)|0)){z=14;break e}i=f[M>>2]|0}o=o+1|0}while(o>>>0<(f[(f[i+24>>2]|0)+16>>2]|0)>>>0)}x=$r(i)|0;if(!O){if(x>>>0>s>>>0){i=Ki(n,x)|0;if(!i){z=20;break}else{n=i;i=x}}else i=s;a=f[M>>2]|0;w=a+24|0;o=f[w>>2]|0;if(f[o+16>>2]|0){E=a+20|0;a=n;_=0;do{v=f[(f[f[E>>2]>>2]|0)+20>>2]|0;l=f[o+24>>2]|0;m=f[l+(_*52|0)+24>>2]|0;m=((m&7|0)!=0&1)+(m>>>3)|0;u=f[v+(_*52|0)+8>>2]|0;c=f[v+(_*52|0)>>2]|0;y=u-c|0;p=f[v+(_*52|0)+12>>2]|0;v=f[v+(_*52|0)+4>>2]|0;W=f[o>>2]|0;G=f[l+(_*52|0)>>2]|0;s=f[l+(_*52|0)+4>>2]|0;V=(G+~W+(f[o+8>>2]|0)|0)/(G|0)|0;g=V-y|0;o=c-((W+-1+G|0)/(G|0)|0)+(ce(V,v-(((f[o+4>>2]|0)+-1+s|0)/(s|0)|0)|0)|0)|0;o=(f[l+(_*52|0)+44>>2]|0)+(o<<2)|0;t:do{switch(((m|0)==3?4:m)|0){case 1:{s=(p|0)==(v|0);if(!(f[l+(_*52|0)+32>>2]|0)){if(s)break t;m=(u|0)==(c|0);c=p-v|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){h[l>>0]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+1|0;u=u+4|0}}a=a+y|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(g<<2)|0}}else{if(s)break t;m=(u|0)==(c|0);c=p-v|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){h[l>>0]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+1|0;u=u+4|0}}a=a+y|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(g<<2)|0}}break}case 2:{s=(p|0)==(v|0);if(!(f[l+(_*52|0)+32>>2]|0)){if(!s){m=(u|0)==(c|0);c=p-v|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){d[l>>1]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+2|0;u=u+4|0}}a=a+(y<<1)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(g<<2)|0}}}else if(!s){m=(u|0)==(c|0);c=p-v|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){d[l>>1]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+2|0;u=u+4|0}}a=a+(y<<1)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(g<<2)|0}}break}case 4:{if((p|0)!=(v|0)){m=(u|0)==(c|0);c=p-v|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){f[l>>2]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+4|0;u=u+4|0}}a=a+(y<<2)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(g<<2)|0}}break}default:{}}}while(0);_=_+1|0;o=f[w>>2]|0}while(_>>>0<(f[o+16>>2]|0)>>>0);a=f[M>>2]|0}if(!(en(a,n,x)|0)){z=63;break}}else i=s;if(!(La(e,t,r)|0)){z=65;break}if(S>>>0>=I>>>0){z=67;break}else s=i}if((z|0)==5)Qn(r,1,10829,N)|0;else if((z|0)==14){Qn(r,1,10887,F)|0;if(!n){W=0;b=j;return W|0}Qi(n);W=0;b=j;return W|0}else if((z|0)==20){if(n)Qi(n);Qn(r,1,10925,U)|0;W=0;b=j;return W|0}else if((z|0)==63){Qn(r,1,10964,B)|0;Qi(n);W=0;b=j;return W|0}else if((z|0)==65){if(!n){W=0;b=j;return W|0}Qi(n);W=0;b=j;return W|0}else if((z|0)==67){if(!n){W=1;b=j;return W|0}Qi(n);W=1;b=j;return W|0}if(!n){W=0;b=j;return W|0}Qi(n);W=0;b=j;return W|0}function Ea(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;n=e+188|0;if(!(_o(f[n>>2]|0,29,r)|0)){t=0;return t|0}if(((d[e+88>>1]|0)+-3&65535)<4?(_o(f[n>>2]|0,30,r)|0)==0:0){t=0;return t|0}if(!(_o(f[n>>2]|0,31,r)|0)){t=0;return t|0}if(!(_o(f[n>>2]|0,32,r)|0)){t=0;return t|0}if(!(_o(f[n>>2]|0,33,r)|0)){t=0;return t|0}s=f[n>>2]|0;a=bo(s)|0;n=Eo(s)|0;if(!a)n=1;else{o=0;i=n;n=1;while(1){if(!n)n=0;else n=(ku[f[i>>2]&63](e,t,r)|0)!=0;n=n&1;o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}wo(s);t=n;return t|0}function wa(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;i=ti()|0;s=e+80|0;f[s>>2]=i;if(!i){Qn(n,1,11011,u)|0;t=0;b=u;return t|0}ai(r,i);o=f[r+24>>2]|0;if((o|0)!=0?(l=f[r+16>>2]|0,(l|0)!=0):0){a=0;do{r=o+(a*52|0)+44|0;i=f[r>>2]|0;if(i){f[(f[(f[s>>2]|0)+24>>2]|0)+(a*52|0)+44>>2]=i;f[r>>2]=0}a=a+1|0}while(a>>>0<l>>>0)}i=e+192|0;if(!(_o(f[i>>2]|0,34,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,35,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,36,n)|0)){t=0;b=u;return t|0}a=f[i>>2]|0;o=bo(a)|0;i=Eo(a)|0;if(o){s=0;r=1;while(1){if(!r)r=0;else r=(ku[f[i>>2]&63](e,t,n)|0)!=0;s=s+1|0;if((s|0)==(o|0))break;else{i=i+4|0;r=r&1}}wo(a);if(!r){t=0;b=u;return t|0}}else wo(a);i=e+188|0;if(!(_o(f[i>>2]|0,37,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,38,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,39,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,40,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,41,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,42,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,43,n)|0)){t=0;b=u;return t|0}r=e+88|0;if(((d[r>>1]|0)+-3&65535)<4){if(!(_o(f[i>>2]|0,44,n)|0)){t=0;b=u;return t|0}if((d[r>>1]|0)==4?(_o(f[i>>2]|0,45,n)|0)==0:0){t=0;b=u;return t|0}}if(!(_o(f[i>>2]|0,46,n)|0)){t=0;b=u;return t|0}if((f[e+108>>2]|0)!=0?(_o(f[i>>2]|0,47,n)|0)==0:0){t=0;b=u;return t|0}if((d[r>>1]&256)!=0?(_o(f[i>>2]|0,48,n)|0)==0:0){t=0;b=u;return t|0}if((f[e+196>>2]|0)!=0?(_o(f[i>>2]|0,49,n)|0)==0:0){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,50,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,51,n)|0)){t=0;b=u;return t|0}s=f[i>>2]|0;a=bo(s)|0;i=Eo(s)|0;if(!a)i=1;else{o=0;r=i;i=1;while(1){if(!i)i=0;else i=(ku[f[r>>2]&63](e,t,n)|0)!=0;i=i&1;o=o+1|0;if((o|0)==(a|0))break;else r=r+4|0}}wo(s);t=i;b=u;return t|0}function xa(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;m=b;b=b+48|0;d=m+40|0;p=m+32|0;h=m+24|0;u=m+16|0;s=m+8|0;o=m;l=e+200|0;if((f[l>>2]|0)==(t|0)){c=ce(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[s>>2]=t+1;f[s+4>>2]=c;Qn(a,4,10866,s)|0;f[e+12>>2]=0;c=e+204|0;s=f[c>>2]|0;f[s+12>>2]=f[(f[e+164>>2]|0)+(t*5640|0)+5588>>2];f[e+8>>2]=0;if(Yr(s,f[l>>2]|0,a)|0){o=f[c>>2]|0;e:do{if(f[(f[o+24>>2]|0)+16>>2]|0){s=0;while(1){if(!(Xr((f[(f[f[o+20>>2]>>2]|0)+20>>2]|0)+(s*52|0)|0)|0))break;s=s+1|0;o=f[c>>2]|0;if(s>>>0>=(f[(f[o+24>>2]|0)+16>>2]|0)>>>0)break e}Qn(a,1,10887,h)|0;p=0;b=m;return p|0}}while(0);if(!(en(o,r,n)|0)){Qn(a,1,10964,p)|0;p=0;b=m;return p|0}if(La(e,i,a)|0){p=1;b=m;return p|0}f[d>>2]=t;Qn(a,1,11101,d)|0;p=0;b=m;return p|0}}else Qn(a,1,10829,o)|0;f[u>>2]=t;Qn(a,1,11044,u)|0;p=0;b=m;return p|0}function Ta(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0;if(!e)return;i=e+5164|0;t=f[i>>2]|0;if(t){a=e+5160|0;r=f[a>>2]|0;if(r){n=0;while(1){t=f[t+(n<<3)>>2]|0;if(t){Qi(t);r=f[a>>2]|0}n=n+1|0;if(n>>>0>=r>>>0)break;t=f[i>>2]|0}t=f[i>>2]|0}f[a>>2]=0;Qi(t);f[i>>2]=0}t=e+5172|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+5584|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+5608|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+5604|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+5624|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0;f[e+5632>>2]=0;f[e+5628>>2]=0}s=e+5612|0;t=f[s>>2]|0;if(t){o=e+5616|0;r=f[o>>2]|0;if(r){a=0;while(1){n=t+12|0;i=f[n>>2]|0;if(i){Qi(i);f[n>>2]=0;r=f[o>>2]|0}a=a+1|0;if(a>>>0>=r>>>0)break;else t=t+20|0}t=f[s>>2]|0}Qi(t);f[s>>2]=0}t=e+5600|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}t=e+5592|0;r=f[t>>2]|0;if(!r)return;Qi(r);f[t>>2]=0;f[e+5596>>2]=0;return}function Sa(e,t,r){e=e|0;t=t|0;r=r|0;return 1}function Ma(e,t,r){e=e|0;t=t|0;r=r|0;return(f[e+8>>2]|0)==0&(f[e+188>>2]|0)!=0&(f[e+192>>2]|0)!=0&1|0}function Ra(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,J=0;J=b;b=b+224|0;Z=J+200|0;X=J+192|0;W=J+184|0;j=J+176|0;z=J+168|0;U=J+160|0;N=J+152|0;D=J+144|0;H=J+136|0;k=J+128|0;O=J+120|0;A=J+112|0;R=J+104|0;M=J+96|0;S=J+88|0;T=J+80|0;I=J+72|0;L=J+64|0;x=J+56|0;w=J+48|0;E=J+40|0;P=J+32|0;p=J+24|0;l=J+16|0;s=J+8|0;F=J;G=J+216|0;n=J+204|0;C=J+212|0;_=J+208|0;q=e+8|0;f[q>>2]=1;e:do{if((Gn(t,G,2,r)|0)==2?(wn(G,n,2),(f[n>>2]|0)==65359):0){f[q>>2]=2;c=Yn(t)|0;c=Wl(c|0,B|0,-2,-1)|0;u=B;Y=e+196|0;i=f[Y>>2]|0;f[i>>2]=c;f[i+4>>2]=u;i=F;f[i>>2]=c;f[i+4>>2]=u;Qn(r,4,15766,F)|0;i=f[Y>>2]|0;u=f[i>>2]|0;c=i+24|0;n=f[c>>2]|0;o=i+32|0;a=f[o>>2]|0;do{if((n+1|0)>>>0>a>>>0){y=~~(+(a>>>0)+100.0)>>>0;f[o>>2]=y;n=i+28|0;i=Ki(f[n>>2]|0,y*24|0)|0;if(!i){Qi(f[n>>2]|0);f[n>>2]=0;f[o>>2]=0;f[c>>2]=0;Qn(r,1,15803,s)|0;break e}else{f[n>>2]=i;n=f[c>>2]|0;break}}else i=f[i+28>>2]|0}while(0);d[i+(n*24|0)>>1]=-177;g=jl(0,u|0,32)|0;y=i+(n*24|0)+8|0;f[y>>2]=g;f[y+4>>2]=B;f[i+(n*24|0)+16>>2]=2;f[c>>2]=n+1;y=e+16|0;if((Gn(t,f[y>>2]|0,2,r)|0)!=2){Qn(r,1,8295,p)|0;r=0;b=J;return r|0}wn(f[y>>2]|0,C,2);n=f[C>>2]|0;if((n|0)!=65424){g=e+20|0;m=0;a=0;v=0;t:while(1){if(n>>>0<65280){V=14;break}else s=784;while(1){i=f[s>>2]|0;o=(i|0)==0;if(o|(i|0)==(n|0))break;else s=s+12|0}if(o){Qn(r,2,15914,E)|0;l=2;r:while(1){do{if((Gn(t,f[y>>2]|0,2,r)|0)!=2){V=20;break t}wn(f[y>>2]|0,F,2);n=f[F>>2]|0}while(n>>>0<65280);s=784;while(1){i=f[s>>2]|0;if((i|0)==0|(i|0)==(n|0)){o=s;n=s;break}else s=s+12|0}if(!(f[n+4>>2]&f[q>>2])){V=25;break t}if((i|0)>=65424){V=100;break}switch(i|0){case 0:break;default:{p=o;c=l;break r}}l=l+2|0}if((V|0)==100){V=0;switch(i|0){case 65424:{i=m;n=v;V=27;break t}default:{p=o;c=l}}}s=f[Y>>2]|0;u=Yn(t)|0;u=u-c|0;o=s+24|0;n=f[o>>2]|0;i=s+32|0;l=f[i>>2]|0;if((n+1|0)>>>0>l>>>0){n=~~(+(l>>>0)+100.0)>>>0;f[i>>2]=n;s=s+28|0;n=Ki(f[s>>2]|0,n*24|0)|0;if(!n){a=s;n=s;V=32;break}f[s>>2]=n;i=n;n=f[o>>2]|0}else i=f[s+28>>2]|0;d[i+(n*24|0)>>1]=0;l=i+(n*24|0)+8|0;f[l>>2]=u;f[l+4>>2]=((u|0)<0)<<31>>31;f[i+(n*24|0)+16>>2]=c;f[o>>2]=n+1;n=f[p>>2]|0;f[C>>2]=n;if((n|0)==65424){i=m;n=v;break}else o=784;while(1){i=f[o>>2]|0;if((i|0)==0|(i|0)==(n|0))break;else o=o+12|0}}else o=s;v=(i|0)==65361?1:v;m=(i|0)==65362?1:m;a=(i|0)==65372?1:a;if(!(f[o+4>>2]&f[q>>2])){V=38;break}if((Gn(t,f[y>>2]|0,2,r)|0)!=2){V=40;break}wn(f[y>>2]|0,_,2);i=(f[_>>2]|0)+-2|0;f[_>>2]=i;n=f[y>>2]|0;if(i>>>0>(f[g>>2]|0)>>>0){n=Ki(n,i)|0;if(!n){V=43;break}f[y>>2]=n;i=f[_>>2]|0;f[g>>2]=i}n=Gn(t,n,i,r)|0;if((n|0)!=(f[_>>2]|0)){V=46;break}if(!(Nu[f[o+8>>2]&63](e,f[y>>2]|0,n,r)|0)){V=48;break}l=f[Y>>2]|0;u=f[o>>2]|0;c=Yn(t)|0;p=f[_>>2]|0;c=-4-p+c|0;p=p+4|0;o=l+24|0;n=f[o>>2]|0;i=l+32|0;s=f[i>>2]|0;if((n+1|0)>>>0>s>>>0){n=~~(+(s>>>0)+100.0)>>>0;f[i>>2]=n;s=l+28|0;n=Ki(f[s>>2]|0,n*24|0)|0;if(!n){a=s;n=s;V=53;break}f[s>>2]=n;i=n;n=f[o>>2]|0}else i=f[l+28>>2]|0;d[i+(n*24|0)>>1]=u;u=i+(n*24|0)+8|0;f[u>>2]=c;f[u+4>>2]=((c|0)<0)<<31>>31;f[i+(n*24|0)+16>>2]=p;f[o>>2]=n+1;if((Gn(t,f[y>>2]|0,2,r)|0)!=2){V=55;break}wn(f[y>>2]|0,C,2);n=f[C>>2]|0;if((n|0)==65424){i=m;n=v;break}}switch(V|0){case 14:{f[P>>2]=n;Qn(r,1,15863,P)|0;r=0;b=J;return r|0}case 20:{Qn(r,1,8295,w)|0;V=34;break}case 25:{Qn(r,1,8339,x)|0;V=34;break}case 27:{f[C>>2]=65424;break}case 32:{Qi(f[n>>2]|0);f[a>>2]=0;f[i>>2]=0;f[o>>2]=0;Qn(r,1,15803,L)|0;V=34;break}case 38:{Qn(r,1,8339,T)|0;r=0;b=J;return r|0}case 40:{Qn(r,1,8295,S)|0;r=0;b=J;return r|0}case 43:{Qi(f[y>>2]|0);f[y>>2]=0;f[g>>2]=0;Qn(r,1,8427,M)|0;r=0;b=J;return r|0}case 46:{Qn(r,1,8295,R)|0;r=0;b=J;return r|0}case 48:{Qn(r,1,15985,A)|0;r=0;b=J;return r|0}case 53:{Qi(f[n>>2]|0);f[a>>2]=0;f[i>>2]=0;f[o>>2]=0;Qn(r,1,15803,O)|0;r=0;b=J;return r|0}case 55:{Qn(r,1,8295,k)|0;r=0;b=J;return r|0}}if((V|0)==34){Qn(r,1,15930,I)|0;r=0;b=J;return r|0}if(n){if(!i){Qn(r,1,16090,D)|0;r=0;b=J;return r|0}if(!a){Qn(r,1,16136,N)|0;r=0;b=J;return r|0}t:do{if(h[e+184>>0]&1){g=e+120|0;do{if(f[g>>2]|0){u=e+124|0;c=0;n=0;i=0;r:do{a=f[u>>2]|0;o=f[a+(c<<3)>>2]|0;n:do{if(o){s=f[a+(c<<3)+4>>2]|0;a=n>>>0<s>>>0;l=a?0:n-s|0;if((s|0)==(n|0)|a^1)n=l;else{o=a?o+n|0:o;n=s-n|0;while(1){if(n>>>0<4){V=70;break r}wn(o,F,4);a=n+-4|0;n=f[F>>2]|0;i=n+i|0;if(a>>>0<n>>>0)break;if((a|0)==(n|0)){n=l;break n}else{o=o+(n+4)|0;n=a-n|0}}n=n-a|0}}}while(0);c=c+1|0}while(c>>>0<(f[g>>2]|0)>>>0);if((V|0)==70){Qn(r,1,16182,U)|0;break}if(!n)V=77;else Qn(r,1,16213,z)|0}else{i=0;V=77}}while(0);r:do{if((V|0)==77){a=Yi(i)|0;p=e+144|0;f[p>>2]=a;if(!a){Qn(r,1,13302,j)|0;break}m=e+132|0;f[m>>2]=i;o=f[g>>2]|0;v=e+124|0;do{if(o){n=f[v>>2]|0;a=n;c=0;u=0;i=0;n:while(1){s=f[a+(c<<3)>>2]|0;if(!s)s=u;else{a=f[a+(c<<3)+4>>2]|0;n=(f[p>>2]|0)+i|0;i:do{if(u>>>0<a>>>0){Yl(n|0,s|0,u|0)|0;i=i+u|0;if((a|0)==(u|0)){s=0;break}l=s+u|0;n=a-u|0;while(1){if(n>>>0<4){V=88;break n}wn(l,G,4);s=l+4|0;o=n+-4|0;a=f[G>>2]|0;n=(f[p>>2]|0)+i|0;if(o>>>0<a>>>0){a=s;break}Yl(n|0,s|0,a|0)|0;n=f[G>>2]|0;i=n+i|0;if((o|0)==(n|0)){s=0;break i}else{l=l+(n+4)|0;n=o-n|0}}Yl(n|0,a|0,o|0)|0;s=(f[G>>2]|0)-o|0;i=o+i|0}else{Yl(n|0,s|0,a|0)|0;s=u-a|0;i=a+i|0}}while(0);Qi(f[(f[v>>2]|0)+(c<<3)>>2]|0);a=f[v>>2]|0;f[a+(c<<3)>>2]=0;f[a+(c<<3)+4>>2]=0;o=f[g>>2]|0;n=a}c=c+1|0;if(c>>>0>=o>>>0){V=94;break}else u=s}if((V|0)==88){Qn(r,1,16182,W)|0;break r}else if((V|0)==94){a=f[p>>2]|0;i=f[m>>2]|0;break}}else n=f[v>>2]|0}while(0);f[e+128>>2]=a;f[e+152>>2]=i;f[g>>2]=0;Qi(n);f[v>>2]=0;break t}}while(0);Qn(r,1,16236,X)|0;r=0;b=J;return r|0}}while(0);Qn(r,4,16262,Z)|0;Z=Yn(t)|0;r=(f[Y>>2]|0)+8|0;f[r>>2]=Z+-2;f[r+4>>2]=0;f[q>>2]=8;r=1;b=J;return r|0}}Qn(r,1,16044,H)|0;r=0;b=J;return r|0}}while(0);Qn(r,1,15839,l)|0;r=0;b=J;return r|0}function Aa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0;L=b;b=b+16|0;C=L;k=f[e+80>>2]|0;P=e+88|0;M=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;m=f[k+16>>2]|0;d=m*1080|0;p=f[e+12>>2]|0;m=ce(m<<2,m)|0;e:do{if(M){v=p+5604|0;g=p+5620|0;y=p+5612|0;_=p+5616|0;E=p+5632|0;w=p+5624|0;x=p+5584|0;R=0;A=f[e+164>>2]|0;t:while(1){s=A+5584|0;T=f[s>>2]|0;Yl(A|0,p|0,5640)|0;t=A+5636|0;h[t>>0]=h[t>>0]&-4;f[A+5168>>2]=0;t=A+5604|0;f[t>>2]=0;l=A+5620|0;f[l>>2]=0;S=A+5612|0;f[S>>2]=0;u=A+5632|0;f[u>>2]=0;c=A+5624|0;f[c>>2]=0;f[s>>2]=T;if(f[v>>2]|0){n=Yi(m)|0;f[t>>2]=n;if(!n){t=0;n=25;break}Yl(n|0,f[v>>2]|0,m|0)|0}t=(f[g>>2]|0)*20|0;n=Yi(t)|0;f[S>>2]=n;if(!n){t=0;n=25;break}Yl(n|0,f[y>>2]|0,t|0)|0;t=f[_>>2]|0;if(t){a=0;o=f[S>>2]|0;s=f[y>>2]|0;while(1){i=s+12|0;if(f[i>>2]|0){t=s+16|0;n=Yi(f[t>>2]|0)|0;f[o+12>>2]=n;if(!n){t=0;n=25;break t}Yl(n|0,f[i>>2]|0,f[t>>2]|0)|0;t=f[_>>2]|0}f[l>>2]=(f[l>>2]|0)+1;a=a+1|0;if(a>>>0>=t>>>0)break;else{o=o+20|0;s=s+20|0}}}t=(f[E>>2]|0)*20|0;n=Yi(t)|0;f[c>>2]=n;if(!n){t=0;n=25;break}Yl(n|0,f[w>>2]|0,t|0)|0;f[u>>2]=f[E>>2];a=f[E>>2]|0;if(a){o=0;n=f[c>>2]|0;i=f[w>>2]|0;while(1){t=f[i+8>>2]|0;if(t)f[n+8>>2]=(f[S>>2]|0)+(((t-(f[y>>2]|0)|0)/20|0)*20|0);t=f[i+12>>2]|0;if(t)f[n+12>>2]=(f[S>>2]|0)+(((t-(f[y>>2]|0)|0)/20|0)*20|0);o=o+1|0;if(o>>>0>=a>>>0)break;else{n=n+20|0;i=i+20|0}}}Yl(T|0,f[x>>2]|0,d|0)|0;R=R+1|0;if(R>>>0>=M>>>0)break e;else A=A+5640|0}if((n|0)==25){b=L;return t|0}}}while(0);n=Br(1)|0;t=e+204|0;f[t>>2]=n;if(!n){r=0;b=L;return r|0}if(Gr(n,k,P)|0){r=1;b=L;return r|0}Wr(f[t>>2]|0);f[t>>2]=0;Qn(r,1,8839,C)|0;r=0;b=L;return r|0}function ka(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0;w=b;b=b+128|0;_=w+120|0;y=w+112|0;g=w+104|0;v=w+96|0;m=w+88|0;p=w+80|0;d=w+72|0;h=w+64|0;c=w+56|0;u=w+48|0;l=w+40|0;s=w+32|0;o=w+24|0;a=w+16|0;i=w+8|0;n=w;if(!e){b=w;return}hl(12191,17,1,r)|0;f[n>>2]=f[e>>2];el(r,12209,n)|0;f[i>>2]=f[e+4>>2];el(r,12222,i)|0;f[a>>2]=f[e+8>>2];el(r,12234,a)|0;f[o>>2]=f[e+16>>2];el(r,12251,o)|0;if((t|0)>0){a=e+5584|0;o=0;do{i=f[a>>2]|0;f[s>>2]=o;el(r,12262,s)|0;f[l>>2]=f[i+(o*1080|0)>>2];el(r,12276,l)|0;e=i+(o*1080|0)+4|0;f[u>>2]=f[e>>2];el(r,12290,u)|0;f[c>>2]=f[i+(o*1080|0)+8>>2];el(r,12313,c)|0;f[h>>2]=f[i+(o*1080|0)+12>>2];el(r,12329,h)|0;f[d>>2]=f[i+(o*1080|0)+16>>2];el(r,12345,d)|0;f[p>>2]=f[i+(o*1080|0)+20>>2];el(r,12362,p)|0;hl(12377,23,1,r)|0;if(f[e>>2]|0){n=0;do{x=f[i+(o*1080|0)+944+(n<<2)>>2]|0;f[m>>2]=f[i+(o*1080|0)+812+(n<<2)>>2];f[m+4>>2]=x;el(r,12401,m)|0;n=n+1|0}while(n>>>0<(f[e>>2]|0)>>>0)}tl(10,r)|0;x=i+(o*1080|0)+24|0;f[v>>2]=f[x>>2];el(r,12410,v)|0;f[g>>2]=f[i+(o*1080|0)+804>>2];el(r,12425,g)|0;hl(12442,20,1,r)|0;if((f[x>>2]|0)!=1){e=(f[e>>2]|0)*3|0;if((e|0)>2){e=e+-2|0;E=8}}else{e=1;E=8}if((E|0)==8){E=0;n=0;do{x=f[i+(o*1080|0)+28+(n<<3)>>2]|0;f[y>>2]=f[i+(o*1080|0)+28+(n<<3)+4>>2];f[y+4>>2]=x;el(r,12401,y)|0;n=n+1|0}while((n|0)!=(e|0))}tl(10,r)|0;f[_>>2]=f[i+(o*1080|0)+808>>2];el(r,12463,_)|0;hl(12480,5,1,r)|0;o=o+1|0}while((o|0)!=(t|0))}hl(10321,4,1,r)|0;b=w;return}function Pa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0;R=b;b=b+80|0;_=R+32|0;E=R+24|0;T=R+16|0;x=R+8|0;d=R+64|0;w=R+60|0;h=R+56|0;m=R+52|0;g=R+48|0;v=R+44|0;y=R+40|0;p=R+36|0;f[d>>2]=1;n=Yi(1e3)|0;if(!n){Qn(r,1,12127,R)|0;r=0;b=R;return r|0}S=e+116|0;M=e+112|0;l=e+204|0;u=e+84|0;c=e+8|0;i=1e3;s=0;while(1){if(!(la(e,w,h,m,g,v,y,p,d,t,r)|0)){a=5;break}if(!(f[d>>2]|0)){a=17;break}o=f[h>>2]|0;if(o>>>0>i>>>0){i=Ki(n,o)|0;if(!i){a=9;break}else{n=i;a=o}}else a=i;i=f[w>>2]|0;if(!(ua(e,i,n,o,t,r)|0)){a=11;break}i=i+1|0;o=ce(f[M>>2]|0,f[S>>2]|0)|0;f[E>>2]=i;f[E+4>>2]=o;Qn(r,4,11986,E)|0;o=f[l>>2]|0;if(!(lo(f[(f[f[o+20>>2]>>2]|0)+20>>2]|0,f[o+24>>2]|0,n,f[(f[u>>2]|0)+24>>2]|0)|0)){a=13;break}f[_>>2]=i;Qn(r,4,12016,_)|0;o=qn(t)|0;if((o|0)==0&(B|0)==0?(f[c>>2]|0)==64:0){a=17;break}s=s+1|0;if((s|0)==(ce(f[M>>2]|0,f[S>>2]|0)|0)){a=17;break}else i=a}if((a|0)==5){Qi(n);r=0;b=R;return r|0}else if((a|0)==9){Qi(n);M=ce(f[M>>2]|0,f[S>>2]|0)|0;f[x>>2]=(f[w>>2]|0)+1;f[x+4>>2]=M;Qn(r,1,11946,x)|0;r=0;b=R;return r|0}else if((a|0)==11){Qi(n);M=ce(f[M>>2]|0,f[S>>2]|0)|0;f[T>>2]=i+1;f[T+4>>2]=M;Qn(r,1,12162,T)|0;r=0;b=R;return r|0}else if((a|0)==13){Qi(n);r=0;b=R;return r|0}else if((a|0)==17){Qi(n);r=1;b=R;return r|0}return 0}function Ca(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0;C=b;b=b+96|0;T=C+56|0;A=C+48|0;x=C+40|0;S=C+32|0;k=C+24|0;l=C+16|0;s=C+8|0;v=C+92|0;R=C+88|0;m=C+84|0;y=C+80|0;E=C+76|0;_=C+72|0;w=C+68|0;g=C+64|0;f[v>>2]=1;n=Yi(1e3)|0;if(!n){Qn(r,1,11880,C)|0;P=0;b=C;return P|0}M=e+196|0;a=f[M>>2]|0;i=f[a+40>>2]|0;e:do{if(!i){i=ce(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[a+36>>2]=i;i=qi(i,40)|0;a=f[M>>2]|0;f[a+40>>2]=i;t:do{if(i){if(f[a+36>>2]|0){o=0;do{f[i+(o*40|0)+28>>2]=100;f[i+(o*40|0)+20>>2]=0;p=qi(100,24)|0;a=f[M>>2]|0;i=f[a+40>>2]|0;f[i+(o*40|0)+24>>2]=p;o=o+1|0;if(!p)break t}while(o>>>0<(f[a+36>>2]|0)>>>0)}a=f[e+60>>2]|0;if(!i)break e;else{P=12;break e}}}while(0);Qi(n);P=0;b=C;return P|0}else{a=f[e+60>>2]|0;P=12}}while(0);if((P|0)==12)if(f[i+16>>2]|0){if(!(f[i+(a*40|0)+4>>2]|0)){p=e+64|0;p=Wl(f[p>>2]|0,f[p+4>>2]|0,2,0)|0;if(!(kn(t,p,B,r)|0)){Qn(r,1,11918,s)|0;Qi(n);P=0;b=C;return P|0}}else{p=f[i+(a*40|0)+16>>2]|0;p=Wl(f[p>>2]|0,f[p+4>>2]|0,2,0)|0;if(!(kn(t,p,B,r)|0)){Qn(r,1,11918,l)|0;Qi(n);P=0;b=C;return P|0}}i=e+8|0;if((f[i>>2]|0)==256)f[i>>2]=8}e:do{if(la(e,R,m,y,E,_,w,g,v,t,r)|0){d=e+116|0;p=e+112|0;u=e+204|0;c=e+84|0;h=a+1|0;i=1e3;while(1){if(!(f[v>>2]|0))break;l=f[m>>2]|0;if(l>>>0>i>>>0){i=Ki(n,l)|0;if(!i){P=26;break}else{n=i;s=l}}else s=i;o=f[R>>2]|0;if(!(ua(e,o,n,l,t,r)|0)){P=28;break}i=o+1|0;l=ce(f[p>>2]|0,f[d>>2]|0)|0;f[S>>2]=i;f[S+4>>2]=l;Qn(r,4,11986,S)|0;l=f[u>>2]|0;if(!(lo(f[(f[f[l+20>>2]>>2]|0)+20>>2]|0,f[l+24>>2]|0,n,f[(f[c>>2]|0)+24>>2]|0)|0)){P=30;break}f[x>>2]=i;Qn(r,4,12016,x)|0;if((o|0)==(a|0)){P=32;break}f[T>>2]=i;f[T+4>>2]=h;Qn(r,2,12060,T)|0;if(!(la(e,R,m,y,E,_,w,g,v,t,r)|0))break e;else i=s}if((P|0)==26){Qi(n);P=ce(f[p>>2]|0,f[d>>2]|0)|0;f[k>>2]=(f[R>>2]|0)+1;f[k+4>>2]=P;Qn(r,1,11946,k)|0;P=0;b=C;return P|0}else if((P|0)==28){Qi(n);P=0;b=C;return P|0}else if((P|0)==30){Qi(n);P=0;b=C;return P|0}else if((P|0)==32){P=(f[M>>2]|0)+8|0;P=Wl(f[P>>2]|0,f[P+4>>2]|0,2,0)|0;if(!(kn(t,P,B,r)|0)){Qn(r,1,11918,A)|0;Qi(n);P=0;b=C;return P|0}}Qi(n);P=1;b=C;return P|0}}while(0);Qi(n);P=0;b=C;return P|0}function La(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0;I=b;b=b+32|0;k=I+16|0;y=I+8|0;l=I;A=I+20|0;P=f[e+40>>2]|0;L=e+36|0;c=f[L>>2]|0;h=e+204|0;s=f[h>>2]|0;f[s+16>>2]=0;R=e+8|0;f[R>>2]=0;f[A>>2]=0;En(c,65424,2);En(c+2|0,10,2);C=e+200|0;En(c+4|0,f[C>>2]|0,2);S=e+12|0;En(c+10|0,f[S>>2]|0,1);M=e+164|0;En(c+11|0,f[(f[M>>2]|0)+((f[C>>2]|0)*5640|0)+5588>>2]|0,1);f[A>>2]=12;a=c+12|0;n=P+-12|0;u=e+88|0;if(((d[u>>1]|0)+-3&65535)>=4?(i=f[C>>2]|0,o=f[M>>2]|0,(f[o+(i*5640|0)+420>>2]|0)!=0):0){f[A>>2]=0;io(f[(f[e+80>>2]|0)+16>>2]|0,o,i,a,A);T=f[A>>2]|0;i=T+12|0;a=c+i|0;n=n-T|0}else i=12;f[A>>2]=0;En(a,65427,2);f[s+4>>2]=f[R>>2];T=f[S>>2]|0;f[s+8>>2]=T;if(!T)f[(f[f[s+20>>2]>>2]|0)+840>>2]=0;f[A>>2]=0;if(!(Jr(s,f[C>>2]|0,a+2|0,A,n+-4|0,0)|0)){Qn(r,1,11860,l)|0;t=0;b=I;return t|0}n=(f[A>>2]|0)+2|0;f[A>>2]=n;n=n+i|0;En(c+6|0,n,4);if(((d[u>>1]|0)+-3&65535)<4){T=e+28|0;En(f[T>>2]|0,f[C>>2]|0,1);x=(f[T>>2]|0)+1|0;f[T>>2]=x;En(x,n,4);f[T>>2]=(f[T>>2]|0)+4}i=c+n|0;T=P-n|0;E=f[h>>2]|0;w=e+88|0;v=f[M>>2]|0;g=f[C>>2]|0;u=so(w,0,g)|0;x=e+8|0;f[S>>2]=(f[S>>2]|0)+1;e:do{if(u>>>0>1){c=E+4|0;h=E+8|0;p=E+20|0;m=e+28|0;o=i;i=T;n=0;l=1;while(1){f[x>>2]=l;f[A>>2]=0;En(o,65424,2);En(o+2|0,10,2);En(o+4|0,f[C>>2]|0,2);En(o+10|0,f[S>>2]|0,1);En(o+11|0,f[(f[M>>2]|0)+((f[C>>2]|0)*5640|0)+5588>>2]|0,1);f[A>>2]=0;En(o+12|0,65427,2);f[c>>2]=f[R>>2];s=f[S>>2]|0;f[h>>2]=s;if(!s)f[(f[f[p>>2]>>2]|0)+840>>2]=0;f[A>>2]=0;if(!(Jr(E,f[C>>2]|0,o+14|0,A,i+-16|0,0)|0))break;O=f[A>>2]|0;H=O+2|0;f[A>>2]=H;s=O+14|0;a=o+s|0;n=n+12+H|0;i=i+-12+(-2-O)|0;En(o+6|0,s,4);if(((d[w>>1]|0)+-3&65535)<4){En(f[m>>2]|0,f[C>>2]|0,1);H=(f[m>>2]|0)+1|0;f[m>>2]=H;En(H,s,4);f[m>>2]=(f[m>>2]|0)+4}f[S>>2]=(f[S>>2]|0)+1;l=l+1|0;if(l>>>0>=u>>>0){_=12;break e}else o=a}Qn(r,1,11860,y)|0}else{a=i;i=T;n=0;_=12}}while(0);e:do{if((_|0)==12){p=v+(g*5640|0)+420|0;t:do{if(f[p>>2]|0){m=E+16|0;v=E+4|0;g=E+8|0;y=E+20|0;h=e+28|0;c=1;r:while(1){f[m>>2]=c;u=so(w,c,f[C>>2]|0)|0;if(u){l=0;while(1){f[x>>2]=l;f[A>>2]=0;En(a,65424,2);En(a+2|0,10,2);En(a+4|0,f[C>>2]|0,2);En(a+10|0,f[S>>2]|0,1);En(a+11|0,f[(f[M>>2]|0)+((f[C>>2]|0)*5640|0)+5588>>2]|0,1);f[A>>2]=0;En(a+12|0,65427,2);f[v>>2]=f[R>>2];H=f[S>>2]|0;f[g>>2]=H;if(!H)f[(f[f[y>>2]>>2]|0)+840>>2]=0;f[A>>2]=0;if(!(Jr(E,f[C>>2]|0,a+14|0,A,i+-16|0,0)|0))break r;H=f[A>>2]|0;o=H+2|0;f[A>>2]=o;n=n+12+o|0;o=H+14|0;s=a+o|0;i=i+-12+(-2-H)|0;En(a+6|0,o,4);if(((d[w>>1]|0)+-3&65535)<4){En(f[h>>2]|0,f[C>>2]|0,1);H=(f[h>>2]|0)+1|0;f[h>>2]=H;En(H,o,4);f[h>>2]=(f[h>>2]|0)+4}f[S>>2]=(f[S>>2]|0)+1;l=l+1|0;if(l>>>0>=u>>>0){a=s;break}else a=s}}c=c+1|0;if(c>>>0>(f[p>>2]|0)>>>0)break t}Qn(r,1,11860,k)|0;break e}}while(0);H=n-T+P|0;if((Wn(t,f[L>>2]|0,H,r)|0)!=(H|0)){H=0;b=I;return H|0}f[C>>2]=(f[C>>2]|0)+1;H=1;b=I;return H|0}}while(0);H=0;b=I;return H|0}function Ia(e,t,r){e=e|0;t=t|0;r=r|0;e=e+44|0;En(f[e>>2]|0,65497,2);if((Wn(t,f[e>>2]|0,2,r)|0)!=2){t=0;return t|0}t=(Xn(t,r)|0)!=0&1;return t|0}function Oa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;a=(f[e+32>>2]|0)*5|0;s=e+16|0;s=Wl(f[s>>2]|0,f[s+4>>2]|0,6,0)|0;o=B;n=Yn(t)|0;i=B;if(!(Jn(t,s,o,r)|0)){s=0;return s|0}if((Wn(t,f[e+24>>2]|0,a,r)|0)!=(a|0)){s=0;return s|0}s=(Jn(t,n,i,r)|0)!=0&1;return s|0}function Ha(e,t,r){e=e|0;t=t|0;r=r|0;e=f[e+196>>2]|0;if(!e)return 1;t=Yn(t)|0;r=e;r=zl(t|0,B|0,f[r>>2]|0,f[r+4>>2]|0)|0;t=e+16|0;f[t>>2]=r;f[t+4>>2]=B;return 1}function Da(e,t,r){e=e|0;t=t|0;r=r|0;r=e+204|0;Wr(f[r>>2]|0);f[r>>2]=0;r=e+24|0;t=f[r>>2]|0;if(t){Qi(t);f[r>>2]=0;f[e+28>>2]=0}r=e+36|0;t=f[r>>2]|0;if(!t){e=e+40|0;f[e>>2]=0;return 1}Qi(t);f[r>>2]=0;e=e+40|0;f[e>>2]=0;return 1}function Na(e,t,r){e=e|0;t=t|0;r=r|0;r=e+44|0;t=f[r>>2]|0;if(t){Qi(t);f[r>>2]=0}f[e+48>>2]=0;return 1}function Fa(e,t,r){e=e|0;t=t|0;r=r|0;return 1}function Ua(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;i=b;b=b+32|0;n=(f[e+8>>2]|0)==0&(f[e+188>>2]|0)!=0&(f[e+192>>2]|0)!=0&1;t=(f[(f[(f[e+164>>2]|0)+5584>>2]|0)+4>>2]|0)+-1|0;if(t>>>0>31){Qn(r,1,11790,i)|0;r=0;b=i;return r|0}t=1<<t;if((f[e+100>>2]|0)>>>0<t>>>0){Qn(r,1,11790,i+8|0)|0;r=0;b=i;return r|0}if((f[e+104>>2]|0)>>>0>=t>>>0){r=n;b=i;return r|0}Qn(r,1,11790,i+16|0)|0;r=0;b=i;return r|0}function Ba(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;if((d[e+88>>1]&-32256)<<16>>16!=-32256){s=1;return s|0}o=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;if(!o){s=1;return s|0}a=e+80|0;s=0;r=1;i=f[e+164>>2]|0;while(1){if((f[i+16>>2]|0)==2){r=(f[i+5608>>2]|0)!=0&r;e=f[(f[a>>2]|0)+16>>2]|0;if(e){n=0;t=f[i+5584>>2]|0;while(1){r=(f[t+20>>2]&1^1)&r;n=n+1|0;if(n>>>0>=e>>>0)break;else t=t+1080|0}}}s=s+1|0;if((s|0)==(o|0))break;else i=i+5640|0}return r|0}function za(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;a=e+88|0;o=e+32|0;s=f[e+80>>2]|0;l=ce(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[o>>2]=0;if(!l)return 1;n=f[e+164>>2]|0;i=0;while(1){Or(s,a,i);t=n+420|0;r=0;e=0;do{u=so(a,e,i)|0;f[o>>2]=(f[o>>2]|0)+u;r=u+r|0;e=e+1|0}while(e>>>0<=(f[t>>2]|0)>>>0);f[n+5588>>2]=r;i=i+1|0;if((i|0)==(l|0))break;else n=n+5640|0}return 1}function ja(e,t,r){e=e|0;t=t|0;r=r|0;e=f[e+44>>2]|0;En(e,65359,2);return(Wn(t,e,2,r)|0)==2|0}function Va(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;d=b;b=b+16|0;o=d;s=f[e+80>>2]|0;c=s+16|0;l=(f[c>>2]|0)*3|0;h=l+40|0;n=f[s+24>>2]|0;a=e+48|0;u=e+44|0;i=f[u>>2]|0;do{if(h>>>0>(f[a>>2]|0)>>>0){i=Ki(i,h)|0;if(i){f[u>>2]=i;f[a>>2]=h;break}Qi(f[u>>2]|0);f[u>>2]=0;f[a>>2]=0;Qn(r,1,11752,o)|0;t=0;b=d;return t|0}}while(0);En(i,65361,2);En(i+2|0,l+38|0,2);En(i+4|0,m[e+88>>1]|0,2);En(i+6|0,f[s+8>>2]|0,4);En(i+10|0,f[s+12>>2]|0,4);En(i+14|0,f[s>>2]|0,4);En(i+18|0,f[s+4>>2]|0,4);En(i+22|0,f[e+100>>2]|0,4);En(i+26|0,f[e+104>>2]|0,4);En(i+30|0,f[e+92>>2]|0,4);En(i+34|0,f[e+96>>2]|0,4);En(i+38|0,f[c>>2]|0,2);if(f[c>>2]|0){a=0;i=i+40|0;while(1){En(i,(f[n+24>>2]|0)+-1+(f[n+32>>2]<<7)|0,1);En(i+1|0,f[n>>2]|0,1);En(i+2|0,f[n+4>>2]|0,1);a=a+1|0;if(a>>>0>=(f[c>>2]|0)>>>0)break;else{i=i+3|0;n=n+52|0}}}t=(Wn(t,f[u>>2]|0,h,r)|0)==(h|0)&1;b=d;return t|0}function Ga(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0;v=b;b=b+32|0;m=v+16|0;p=v+8|0;s=v;d=v+20|0;l=e+200|0;u=f[l>>2]|0;c=e+164|0;h=f[c>>2]|0;n=f[h+(u*5640|0)+5584>>2]|0;if(!(f[n>>2]&1))a=5;else a=(f[n+4>>2]|0)+5|0;o=a+9|0;f[d>>2]=o;i=e+48|0;e=e+44|0;n=f[e>>2]|0;do{if(o>>>0>(f[i>>2]|0)>>>0){n=Ki(n,o)|0;if(n){f[e>>2]=n;f[i>>2]=o;break}Qi(f[e>>2]|0);f[e>>2]=0;f[i>>2]=0;Qn(r,1,11687,s)|0;m=0;b=v;return m|0}}while(0);En(n,65362,2);En(n+2|0,a+7|0,2);En(n+4|0,f[h+(u*5640|0)>>2]|0,1);En(n+5|0,f[h+(u*5640|0)+4>>2]|0,1);En(n+6|0,f[h+(u*5640|0)+8>>2]|0,2);En(n+8|0,f[h+(u*5640|0)+16>>2]|0,1);f[d>>2]=a;if(!(oo(f[c>>2]|0,f[l>>2]|0,n+9|0,d,r)|0)){Qn(r,1,11726,p)|0;m=0;b=v;return m|0}if(!(f[d>>2]|0)){m=(Wn(t,f[e>>2]|0,o,r)|0)==(o|0)&1;b=v;return m|0}else{Qn(r,1,11726,m)|0;m=0;b=v;return m|0}return 0}function Wa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0;p=b;b=b+32|0;d=p+16|0;h=p+8|0;s=p;u=p+20|0;l=e+200|0;c=e+164|0;n=f[(f[c>>2]|0)+((f[l>>2]|0)*5640|0)+5584>>2]|0;i=f[n+24>>2]|0;if((i|0)==1)n=1;else n=((f[n+4>>2]|0)*3|0)+-2|0;a=(i|0)==0?n+1|0:n<<1|1;o=a+4|0;f[u>>2]=o;i=e+48|0;e=e+44|0;n=f[e>>2]|0;do{if(o>>>0>(f[i>>2]|0)>>>0){n=Ki(n,o)|0;if(n){f[e>>2]=n;f[i>>2]=o;break}Qi(f[e>>2]|0);f[e>>2]=0;f[i>>2]=0;Qn(r,1,11622,s)|0;d=0;b=p;return d|0}}while(0);En(n,65372,2);En(n+2|0,a+2|0,2);f[u>>2]=a;if(!(ao(f[c>>2]|0,f[l>>2]|0,0,n+4|0,u,r)|0)){Qn(r,1,11661,h)|0;d=0;b=p;return d|0}if(!(f[u>>2]|0)){d=(Wn(t,f[e>>2]|0,o,r)|0)==(o|0)&1;b=p;return d|0}else{Qn(r,1,11661,d)|0;d=0;b=p;return d|0}return 0}function Xa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0;w=b;b=b+16|0;_=w;v=w+4|0;d=e+80|0;n=f[(f[d>>2]|0)+16>>2]|0;if(n>>>0<=1){E=1;b=w;return E|0}g=e+164|0;y=e+200|0;m=e+48|0;h=e+44|0;c=1;while(1){o=f[g>>2]|0;l=f[y>>2]|0;a=f[o+(l*5640|0)+5584>>2]|0;s=f[a+(c*1080|0)>>2]|0;e:do{if((((((f[a>>2]|0)==(s|0)?(p=f[a+4>>2]|0,(p|0)==(f[a+(c*1080|0)+4>>2]|0)):0)?(f[a+8>>2]|0)==(f[a+(c*1080|0)+8>>2]|0):0)?(f[a+12>>2]|0)==(f[a+(c*1080|0)+12>>2]|0):0)?(f[a+16>>2]|0)==(f[a+(c*1080|0)+16>>2]|0):0)?(f[a+20>>2]|0)==(f[a+(c*1080|0)+20>>2]|0):0){if(p){e=0;do{if((f[a+812+(e<<2)>>2]|0)!=(f[a+(c*1080|0)+812+(e<<2)>>2]|0)){E=13;break e}if((f[a+944+(e<<2)>>2]|0)!=(f[a+(c*1080|0)+944+(e<<2)>>2]|0)){E=13;break e}e=e+1|0}while(e>>>0<p>>>0)}}else E=13}while(0);if((E|0)==13){E=0;if(!(s&1))e=5;else e=(f[a+(c*1080|0)+4>>2]|0)+5|0;u=e+(n>>>0<257?6:7)|0;i=f[h>>2]|0;if(u>>>0>(f[m>>2]|0)>>>0){e=Ki(i,u)|0;if(!e){E=17;break}f[h>>2]=e;f[m>>2]=u;l=f[y>>2]|0;o=f[g>>2]|0;a=f[o+(l*5640|0)+5584>>2]|0;n=f[(f[d>>2]|0)+16>>2]|0;s=f[a+(c*1080|0)>>2]|0;i=e}n=n>>>0<257?1:2;if(!(s&1))e=5;else e=(f[a+(c*1080|0)+4>>2]|0)+5|0;En(i,65363,2);En(i+2|0,n+3+e|0,2);En(i+4|0,c,n);s=n|4;En(i+s|0,f[(f[o+(l*5640|0)+5584>>2]|0)+(c*1080|0)>>2]|0,1);f[v>>2]=e;oo(f[g>>2]|0,f[y>>2]|0,i+(s+1)|0,v,r)|0;if((Wn(t,f[h>>2]|0,u,r)|0)!=(u|0)){e=0;E=24;break}n=f[(f[d>>2]|0)+16>>2]|0}c=c+1|0;if(c>>>0>=n>>>0){e=1;E=24;break}}if((E|0)==17){Qi(f[h>>2]|0);f[h>>2]=0;f[m>>2]=0;Qn(r,1,11548,_)|0;E=0;b=w;return E|0}else if((E|0)==24){b=w;return e|0}return 0}function Ya(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0;y=b;b=b+16|0;v=y;d=y+4|0;c=e+80|0;n=f[(f[c>>2]|0)+16>>2]|0;if(n>>>0<=1){g=1;b=y;return g|0}p=e+164|0;m=e+200|0;h=e+48|0;u=e+44|0;l=1;while(1){s=f[(f[p>>2]|0)+((f[m>>2]|0)*5640|0)+5584>>2]|0;a=f[s+24>>2]|0;o=f[s+(l*1080|0)+24>>2]|0;e:do{if((a|0)==(o|0)?(f[s+804>>2]|0)==(f[s+(l*1080|0)+804>>2]|0):0){if((a|0)!=1){i=(f[s+4>>2]|0)*3|0;e=i+-2|0;if((i|0)!=((f[s+(l*1080|0)+4>>2]|0)*3|0)){g=14;break}if(!e)break}else e=1;i=0;do{if((f[s+28+(i<<3)>>2]|0)!=(f[s+(l*1080|0)+28+(i<<3)>>2]|0)){g=14;break e}i=i+1|0}while(i>>>0<e>>>0);if(a){i=0;do{if((f[s+28+(i<<3)+4>>2]|0)!=(f[s+(l*1080|0)+28+(i<<3)+4>>2]|0)){g=14;break e}i=i+1|0}while(i>>>0<e>>>0)}}else g=14}while(0);if((g|0)==14){g=0;if((o|0)==1)e=1;else e=((f[s+(l*1080|0)+4>>2]|0)*3|0)+-2|0;a=((o|0)==0?e+1|0:e<<1|1)+5+(n>>>0>256&1)|0;e=f[u>>2]|0;if(a>>>0>(f[h>>2]|0)>>>0){e=Ki(e,a)|0;if(!e){g=18;break}f[u>>2]=e;f[h>>2]=a;n=f[(f[p>>2]|0)+((f[m>>2]|0)*5640|0)+5584>>2]|0;i=f[n+(l*1080|0)+24>>2]|0}else{i=o;n=s}if((i|0)==1)n=1;else n=((f[n+(l*1080|0)+4>>2]|0)*3|0)+-2|0;i=(i|0)==0?n+1|0:n<<1|1;f[d>>2]=i+6;En(e,65373,2);n=e+2|0;if((f[(f[c>>2]|0)+16>>2]|0)>>>0<257){En(n,i+3|0,2);En(e+4|0,l,1);e=e+5|0}else{En(n,i+4|0,2);En(e+4|0,l,2);e=e+6|0}f[d>>2]=i;ao(f[p>>2]|0,f[m>>2]|0,l,e,d,r)|0;if((Wn(t,f[u>>2]|0,a,r)|0)!=(a|0)){e=0;g=28;break}n=f[(f[c>>2]|0)+16>>2]|0}l=l+1|0;if(l>>>0>=n>>>0){e=1;g=28;break}}if((g|0)==18){Qi(f[u>>2]|0);f[u>>2]=0;f[h>>2]=0;Qn(r,1,11476,v)|0;g=0;b=y;return g|0}else if((g|0)==28){b=y;return e|0}return 0}function qa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;a=u;o=(f[e+32>>2]|0)*5|0;s=o+6|0;i=e+48|0;l=e+44|0;n=f[l>>2]|0;do{if(s>>>0>(f[i>>2]|0)>>>0){n=Ki(n,s)|0;if(n){f[l>>2]=n;f[i>>2]=s;break}Qi(f[l>>2]|0);f[l>>2]=0;f[i>>2]=0;Qn(r,1,11437,a)|0;t=0;b=u;return t|0}}while(0);a=Yn(t)|0;e=e+16|0;f[e>>2]=a;f[e+4>>2]=B;En(n,65365,2);En(n+2|0,o+4|0,2);En(n+4|0,0,1);En(n+5|0,80,1);t=(Wn(t,f[l>>2]|0,s,r)|0)==(s|0)&1;b=u;return t|0}function Za(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;m=b;b=b+16|0;s=m;p=m+4|0;f[p>>2]=0;c=e+200|0;n=f[c>>2]|0;u=e+164|0;i=f[u>>2]|0;l=e+80|0;o=f[(f[l>>2]|0)+16>>2]|0;d=(ce(o>>>0<257?7:9,(f[i+(n*5640|0)+420>>2]|0)+1|0)|0)+4|0;a=e+48|0;h=e+44|0;e=f[h>>2]|0;do{if(d>>>0>(f[a>>2]|0)>>>0){n=Ki(e,d)|0;if(n){f[h>>2]=n;f[a>>2]=d;a=n;e=f[(f[l>>2]|0)+16>>2]|0;i=f[u>>2]|0;n=f[c>>2]|0;break}Qi(f[h>>2]|0);f[h>>2]=0;f[a>>2]=0;Qn(r,1,11398,s)|0;t=0;b=m;return t|0}else{a=e;e=o}}while(0);io(e,i,n,a,p);t=(Wn(t,f[h>>2]|0,d,r)|0)==(d|0)&1;b=m;return t|0}function Ja(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0;s=e+164|0;l=e+80|0;i=f[l>>2]|0;n=f[i+16>>2]|0;if(!n){t=1;return t|0}o=e+44|0;e=0;a=f[(f[s>>2]|0)+5584>>2]|0;while(1){if(f[a+808>>2]|0){u=f[(f[s>>2]|0)+5584>>2]|0;h=n>>>0<257?1:2;i=h+6|0;c=f[o>>2]|0;En(c,65374,2);n=h|4;En(c+2|0,n,2);En(c+4|0,e,h);En(c+n|0,0,1);En(c+(n+1)|0,f[u+(e*1080|0)+808>>2]|0,1);if((Wn(t,f[o>>2]|0,i,r)|0)!=(i|0)){e=0;n=7;break}i=f[l>>2]|0}e=e+1|0;n=f[i+16>>2]|0;if(e>>>0>=n>>>0){e=1;n=7;break}else a=a+1080|0}if((n|0)==7)return e|0;return 0}function Ka(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;a=u;o=f[e+108>>2]|0;s=xl(o)|0;l=s+6|0;n=e+48|0;i=e+44|0;e=f[i>>2]|0;do{if(l>>>0>(f[n>>2]|0)>>>0){e=Ki(e,l)|0;if(e){f[i>>2]=e;f[n>>2]=l;break}Qi(f[i>>2]|0);f[i>>2]=0;f[n>>2]=0;Qn(r,1,11355,a)|0;t=0;b=u;return t|0}}while(0);En(e,65380,2);En(e+2|0,s+4|0,2);En(e+4|0,1,2);Yl(e+6|0,o|0,s|0)|0;t=(Wn(t,f[i>>2]|0,l,r)|0)==(l|0)&1;b=u;return t|0}function Qa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0;M=b;b=b+32|0;w=M+24|0;y=M+16|0;d=M+8|0;i=M;o=f[e+80>>2]|0;s=o+16|0;a=f[s>>2]|0;l=a+6|0;E=e+48|0;S=e+44|0;n=f[S>>2]|0;do{if(l>>>0>(f[E>>2]|0)>>>0){n=Ki(n,l)|0;if(n){f[S>>2]=n;f[E>>2]=l;break}Qi(f[S>>2]|0);f[S>>2]=0;f[E>>2]=0;Qn(r,1,11199,i)|0;t=0;b=M;return t|0}}while(0);En(n,65400,2);En(n+2|0,a+4|0,2);En(n+4|0,f[s>>2]|0,2);if(f[s>>2]|0){a=0;i=f[o+24>>2]|0;n=n+6|0;while(1){En(n,(f[i+24>>2]|0)+-1|f[i+32>>2]<<7,1);a=a+1|0;if(a>>>0>=(f[s>>2]|0)>>>0)break;else{i=i+52|0;n=n+1|0}}}if((Wn(t,f[S>>2]|0,l,r)|0)!=(l|0)){t=0;b=M;return t|0}m=e+200|0;c=f[m>>2]|0;v=e+164|0;u=f[v>>2]|0;i=u+(c*5640|0)+5616|0;e:do{if(f[i>>2]|0){l=0;e=f[u+(c*5640|0)+5612>>2]|0;while(1){a=e+16|0;o=f[a>>2]|0;s=o+10|0;n=f[S>>2]|0;if(s>>>0>(f[E>>2]|0)>>>0){n=Ki(n,s)|0;if(!n)break;f[S>>2]=n;f[E>>2]=s}En(n,65396,2);En(n+2|0,o+8|0,2);En(n+4|0,0,2);En(n+6|0,f[e+4>>2]<<8|f[e+8>>2]&255|f[e>>2]<<10,2);En(n+8|0,0,2);Yl(n+10|0,f[e+12>>2]|0,f[a>>2]|0)|0;if((Wn(t,f[S>>2]|0,s,r)|0)!=(s|0)){g=0;x=42;break}l=l+1|0;if(l>>>0>=(f[i>>2]|0)>>>0)break e;else e=e+20|0}if((x|0)==42){b=M;return g|0}Qi(f[S>>2]|0);f[S>>2]=0;f[E>>2]=0;Qn(r,1,11238,d)|0;t=0;b=M;return t|0}}while(0);d=u+(c*5640|0)+5628|0;e:do{if(f[d>>2]|0){p=0;u=f[u+(c*5640|0)+5624>>2]|0;while(1){l=u+4|0;i=f[l>>2]|0;o=i>>>0>255;s=o?2:1;o=o?32768:0;i=ce(s,i<<1)|0;e=i+19|0;n=f[S>>2]|0;if(e>>>0>(f[E>>2]|0)>>>0){n=Ki(n,e)|0;if(!n)break;f[S>>2]=n;f[E>>2]=e}En(n,65397,2);En(n+2|0,i+17|0,2);En(n+4|0,0,2);En(n+6|0,f[u>>2]|0,1);En(n+7|0,0,2);En(n+9|0,1,2);En(n+11|0,1,1);En(n+12|0,f[l>>2]|o,2);n=n+14|0;if(!(f[l>>2]|0))i=0;else{a=0;do{En(n,a,s);n=n+s|0;a=a+1|0;i=f[l>>2]|0}while(a>>>0<i>>>0)}En(n,i|o,2);n=n+2|0;if(!(f[l>>2]|0))a=n;else{i=0;do{En(n,i,s);n=n+s|0;i=i+1|0}while(i>>>0<(f[l>>2]|0)>>>0);a=n}n=((h[u+16>>0]^1)&255)<<16&65536;i=f[u+8>>2]|0;if(i)n=f[i+8>>2]|n;i=f[u+12>>2]|0;if(i)n=f[i+8>>2]<<8|n;En(a,n,3);if((Wn(t,f[S>>2]|0,e,r)|0)!=(e|0)){g=0;x=42;break}p=p+1|0;if(p>>>0>=(f[d>>2]|0)>>>0)break e;else u=u+20|0}if((x|0)==42){b=M;return g|0}Qi(f[S>>2]|0);f[S>>2]=0;f[E>>2]=0;Qn(r,1,11277,y)|0;t=0;b=M;return t|0}}while(0);s=f[m>>2]|0;o=f[v>>2]|0;l=o+(s*5640|0)+5628|0;i=f[l>>2]|0;e=i+5|0;n=f[S>>2]|0;do{if(e>>>0>(f[E>>2]|0)>>>0){n=Ki(n,e)|0;if(!n){Qi(f[S>>2]|0);f[S>>2]=0;f[E>>2]=0;Qn(r,1,11316,w)|0;_=1;break}else{f[S>>2]=n;f[E>>2]=e;T=n;x=37;break}}else{T=n;x=37}}while(0);if((x|0)==37){En(T,65399,2);En(T+2|0,i+3|0,2);En(T+4|0,f[l>>2]|0,1);if(f[l>>2]|0){a=0;i=T+5|0;n=f[o+(s*5640|0)+5624>>2]|0;while(1){En(i,f[n>>2]|0,1);a=a+1|0;if(a>>>0>=(f[l>>2]|0)>>>0)break;else{i=i+1|0;n=n+20|0}}}_=(Wn(t,f[S>>2]|0,e,r)|0)!=(e|0)}t=_&1^1;b=M;return t|0}function $a(e,t,r){e=e|0;t=t|0;r=r|0;r=Yn(t)|0;t=(f[e+196>>2]|0)+8|0;f[t>>2]=r;f[t+4>>2]=B;return 1}function eo(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;i=b;b=b+16|0;t=Br(0)|0;n=e+204|0;f[n>>2]=t;if(!t){Qn(r,1,11159,i)|0;r=0;b=i;return r|0}if(Gr(t,f[e+80>>2]|0,e+88|0)|0){r=1;b=i;return r|0}Wr(f[n>>2]|0);f[n>>2]=0;r=0;b=i;return r|0}function to(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0.0,c=0,p=0,m=0,v=0,y=0,_=0.0,b=0,E=0,w=0.0,x=0.0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0.0,L=0.0,I=0.0,O=0.0,H=0,D=0,N=0,F=0,U=0,z=0,j=0,V=0;U=e+80|0;k=f[U>>2]|0;z=e+164|0;i=f[z>>2]|0;F=k+24|0;P=f[F>>2]|0;r=f[P>>2]|0;n=f[P+4>>2]|0;N=k+16|0;P=ce(f[P+24>>2]|0,f[N>>2]|0)|0;A=Yn(t)|0;m=e+116|0;s=f[m>>2]|0;v=e+112|0;t=f[v>>2]|0;C=(+(A>>>0)+4294967296.0*+(B|0))/+((ce(t,s)|0)>>>0);A=(h[e+181>>0]&8)==0?1:2;if(s){y=e+92|0;b=e+100|0;E=e+96|0;T=e+104|0;S=k+4|0;M=k+8|0;R=k+12|0;x=+((ce(r<<3,n)|0)>>>0);l=t;r=t;p=0;t=i;do{c=p;p=p+1|0;if(!r)r=0;else{l=0;do{w=+Pu[A&3](t);s=f[t+8>>2]|0;w=w/+(s>>>0);j=f[y>>2]|0;i=f[b>>2]|0;o=(ce(i,l)|0)+j|0;r=f[k>>2]|0;r=(o|0)>(r|0)?o:r;o=f[E>>2]|0;a=f[T>>2]|0;V=(ce(a,c)|0)+o|0;n=f[S>>2]|0;n=(V|0)>(n|0)?V:n;l=l+1|0;j=(ce(i,l)|0)+j|0;i=f[M>>2]|0;i=(j|0)<(i|0)?j:i;o=(ce(a,p)|0)+o|0;a=f[R>>2]|0;a=(o|0)<(a|0)?o:a;o=t+20|0;u=+g[o>>2];if(u!=0.0){_=+((ce(ce(i-r|0,P)|0,a-n|0)|0)>>>0)/(x*u)-w;g[o>>2]=_}if(s>>>0>1){u=+((ce(ce(i-r|0,P)|0,a-n|0)|0)>>>0);r=1;n=t+24|0;while(1){_=+g[n>>2];if(_!=0.0)g[n>>2]=u/(x*_)-w;r=r+1|0;if(r>>>0>=s>>>0)break;else n=n+4|0}}t=t+5640|0;r=f[v>>2]|0}while(l>>>0<r>>>0);s=f[m>>2]|0;l=r}}while(p>>>0<s>>>0);if(!s)s=0;else{y=(l|0)==0;_=C+2.0;E=l>>>0>1?l:1;b=0;r=f[z>>2]|0;do{if(!y){p=r+16|0;m=0;v=r;while(1){t=v+20|0;u=+g[t>>2];if(u!=0.0?(x=u-C,g[t>>2]=x,x<30.0):0)g[t>>2]=30.0;a=v+24|0;t=f[v+8>>2]|0;c=t+-1|0;u=+g[a>>2];n=u!=0.0;if(c>>>0>1){o=p+(t<<2)|0;i=1;t=a;do{if(n?(x=u-C,g[t>>2]=x,I=+g[t+-4>>2],x<I+10.0):0)g[t>>2]=I+20.0;t=t+4|0;i=i+1|0;u=+g[t>>2];n=u!=0.0}while((i|0)!=(c|0));if(n){L=u;H=o;D=29}}else if(n){L=u;H=a;D=29}if((D|0)==29?(D=0,x=L-_,g[H>>2]=x,O=+g[H+-4>>2],x<O+10.0):0)g[H>>2]=O+20.0;m=m+1|0;if(m>>>0>=l>>>0)break;else{p=p+5640|0;v=v+5640|0}}r=r+(E*5640|0)|0}b=b+1|0}while(b>>>0<s>>>0)}}else{l=t;s=0}n=f[N>>2]|0;if(!n)b=0;else{i=(f[e+100>>2]|0)+-1|0;a=(f[e+104>>2]|0)+-1|0;o=0;t=f[F>>2]|0;r=0;while(1){V=f[t>>2]|0;j=f[t+4>>2]|0;V=ce(((a+j|0)>>>0)/(j>>>0)|0,((i+V|0)>>>0)/(V>>>0)|0)|0;r=(ce(V,f[t+24>>2]|0)|0)+r|0;o=o+1|0;if(o>>>0>=n>>>0)break;else t=t+52|0}b=~~(+(r>>>0)*.1625)>>>0}c=f[(f[U>>2]|0)+16>>2]|0;m=c+-1|0;y=ce(s,l)|0;p=(y|0)==0;if(p)i=0;else{t=0;r=0;n=f[z>>2]|0;while(1){V=f[n+5588>>2]|0;r=r>>>0>V>>>0?r:V;t=t+1|0;if((t|0)==(y|0))break;else n=n+5640|0}i=r*12|0}v=e+88|0;if(((d[v>>1]|0)+-3&65535)>=4){if(p){t=0;r=0}else{l=(c|0)==0;o=0;r=0;do{if(!l){n=f[(f[z>>2]|0)+(o*5640|0)+5584>>2]|0;a=0;do{if(!(f[n+(a*1080|0)>>2]&1))t=5;else t=(f[n+(a*1080|0)+4>>2]|0)+5|0;r=r>>>0>t>>>0?r:t;a=a+1|0}while((a|0)!=(c|0))}o=o+1|0}while((o|0)!=(y|0));s=0;t=0;do{if(!l){a=f[(f[z>>2]|0)+(s*5640|0)+5584>>2]|0;o=0;do{if(!(f[a+(o*1080|0)>>2]&1))n=5;else n=(f[a+(o*1080|0)+4>>2]|0)+5|0;t=t>>>0>n>>>0?t:n;o=o+1|0}while((o|0)!=(c|0))}s=s+1|0}while((s|0)!=(y|0))}i=(ce(r+12+t|0,m)|0)+i|0}if(p)r=13;else{n=0;r=0;t=f[z>>2]|0;while(1){V=f[t+420>>2]|0;r=r>>>0>V>>>0?r:V;n=n+1|0;if((n|0)==(y|0))break;else t=t+5640|0}r=(r*9|0)+13|0}V=i+b+r|0;f[e+40>>2]=V;V=Yi(V)|0;f[e+36>>2]=V;if(!V){V=0;return V|0}if(((d[v>>1]|0)+-3&65535)>=4){V=1;return V|0}r=Yi((f[e+32>>2]|0)*5|0)|0;f[e+24>>2]=r;if(!r){V=0;return V|0}f[e+28>>2]=r;V=1;return V|0}function ro(e){e=e|0;return 0.0}function no(e){e=e|0;return+ +((((f[e+5588>>2]|0)*14|0)+-14|0)>>>0)}function io(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0;a=f[t+(r*5640|0)+5584>>2]|0;v=(f[t+(r*5640|0)+420>>2]|0)+1|0;l=e>>>0<257?1:2;m=ce(v,(l<<1)+5|0)|0;g=m+4|0;En(n,65375,2);En(n+2|0,m+2|0,2);if(!v){f[i>>2]=g;return}u=l+1|0;c=l+3|0;h=l|4;d=h+l|0;p=d+1|0;m=t+(r*5640|0)+8|0;o=a+4|0;s=0;n=n+4|0;a=t+(r*5640|0)+424|0;while(1){En(n,f[a>>2]|0,1);En(n+1|0,f[a+4>>2]|0,l);_=a+8|0;En(n+u|0,f[_>>2]|0,2);t=a+12|0;En(n+c|0,f[t>>2]|0,1);r=a+16|0;En(n+h|0,f[r>>2]|0,l);En(n+d|0,f[a+36>>2]|0,1);b=f[_>>2]|0;y=f[m>>2]|0;f[_>>2]=(b|0)<(y|0)?b:y;_=f[t>>2]|0;y=f[o>>2]|0;f[t>>2]=(_|0)<(y|0)?_:y;t=f[r>>2]|0;f[r>>2]=(t|0)<(e|0)?t:e;s=s+1|0;if((s|0)==(v|0))break;else{n=n+p|0;a=a+148|0}}f[i>>2]=g;return}function ao(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,h=0;h=b;b=b+16|0;l=h+8|0;s=h;u=f[e+(t*5640|0)+5584>>2]|0;t=f[u+(r*1080|0)+24>>2]|0;do{if((t|0)!=1){e=(f[u+(r*1080|0)+4>>2]|0)*3|0;o=e+-2|0;if(!t){e=e+-1|0;if((f[i>>2]|0)>>>0<e>>>0){Qn(a,1,11515,s)|0;i=0;b=h;return i|0}else{En(n,f[u+(r*1080|0)+804>>2]<<5,1);if(!o)break;else t=0;do{n=n+1|0;En(n,f[u+(r*1080|0)+28+(t<<3)>>2]<<3,1);t=t+1|0}while((t|0)!=(o|0))}}else c=7}else{o=1;t=1;c=7}}while(0);if((c|0)==7){e=o<<1|1;if((f[i>>2]|0)>>>0<e>>>0){Qn(a,1,11515,l)|0;i=0;b=h;return i|0}En(n,(f[u+(r*1080|0)+804>>2]<<5)+t|0,1);if(o){n=n+1|0;t=0;while(1){En(n,(f[u+(r*1080|0)+28+(t<<3)>>2]<<11)+(f[u+(r*1080|0)+28+(t<<3)+4>>2]|0)|0,2);t=t+1|0;if((t|0)==(o|0))break;else n=n+2|0}}}f[i>>2]=(f[i>>2]|0)-e;i=1;b=h;return i|0}function oo(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+16|0;a=f[e+(t*5640|0)+5584>>2]|0;if((f[n>>2]|0)>>>0<5){Qn(i,1,11587,s)|0;n=0;b=s;return n|0}o=a+4|0;En(r,(f[o>>2]|0)+-1|0,1);En(r+1|0,(f[a+8>>2]|0)+-2|0,1);En(r+2|0,(f[a+12>>2]|0)+-2|0,1);En(r+3|0,f[a+16>>2]|0,1);En(r+4|0,f[a+20>>2]|0,1);t=(f[n>>2]|0)+-5|0;f[n>>2]=t;if(!(f[a>>2]&1)){n=1;b=s;return n|0}e=f[o>>2]|0;if(t>>>0<e>>>0){Qn(i,1,11587,s+8|0)|0;n=0;b=s;return n|0}if(!e)e=0;else{t=r+5|0;r=0;while(1){En(t,(f[a+944+(r<<2)>>2]<<4)+(f[a+812+(r<<2)>>2]|0)|0,1);r=r+1|0;e=f[o>>2]|0;if(r>>>0>=e>>>0)break;else t=t+1|0}t=f[n>>2]|0}f[n>>2]=t-e;n=1;b=s;return n|0}function so(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;a=f[e+76>>2]|0;n=f[a+(r*5640|0)+4>>2]|0;i=696;while(1){u=f[i>>2]|0;if((u|0)==-1|(u|0)==(n|0))break;else i=i+12|0}if(!(h[e+93>>0]&8)){e=1;return e|0}u=p[e+92>>0]|0;o=a+(r*5640|0)+424+(t*148|0)+92|0;s=a+(r*5640|0)+424+(t*148|0)+88|0;l=a+(r*5640|0)+424+(t*148|0)+96|0;t=a+(r*5640|0)+424+(t*148|0)+84|0;a=h[i+4>>0]|0;switch(a|0){case 67:{n=f[o>>2]|0;break}case 82:{n=f[s>>2]|0;break}case 80:{n=f[l>>2]|0;break}case 76:{n=f[t>>2]|0;break}default:n=1}if((u|0)!=(a|0)){a=h[i+5>>0]|0;switch(a|0){case 67:{n=ce(f[o>>2]|0,n)|0;break}case 82:{n=ce(f[s>>2]|0,n)|0;break}case 80:{n=ce(f[l>>2]|0,n)|0;break}case 76:{n=ce(f[t>>2]|0,n)|0;break}default:{}}if((u|0)!=(a|0)){a=h[i+6>>0]|0;switch(a|0){case 67:{n=ce(f[o>>2]|0,n)|0;break}case 82:{n=ce(f[s>>2]|0,n)|0;break}case 80:{n=ce(f[l>>2]|0,n)|0;break}case 76:{n=ce(f[t>>2]|0,n)|0;break}default:{}}if((u|0)!=(a|0)){i=h[i+7>>0]|0;switch(i|0){case 67:{n=ce(f[o>>2]|0,n)|0;break}case 82:{n=ce(f[s>>2]|0,n)|0;break}case 80:{n=ce(f[l>>2]|0,n)|0;break}case 76:{n=ce(f[t>>2]|0,n)|0;break}default:{}}if((u|0)==(i|0))i=3;else{e=n;return e|0}}else i=2}else i=1}else i=0;f[e+84>>2]=i;e=n;return e|0}function lo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0;R=t+16|0;if(!(f[R>>2]|0)){R=1;return R|0}M=0;S=f[t+24>>2]|0;while(1){a=n+44|0;i=f[a>>2]|0;o=n+8|0;if(!i){t=n+12|0;i=qi(ce(f[t>>2]|0,f[o>>2]|0)|0,4)|0;f[a>>2]=i;if(!i){r=0;n=61;break}}else t=n+12|0;v=S+36|0;f[n+36>>2]=f[v>>2];x=f[S+24>>2]|0;_=f[e+24>>2]|0;v=f[v>>2]|0;x=((x&7|0)!=0&1)+(x>>>3)|0;x=(x|0)==3?4:x;l=f[_+(v*136|0)+8>>2]|0;s=f[_+(v*136|0)>>2]|0;E=l-s|0;y=f[_+(v*136|0)+12>>2]|0;v=f[_+(v*136|0)+4>>2]|0;_=y-v|0;a=f[n+16>>2]|0;c=f[n+40>>2]|0;u=Gl(1,0,c|0)|0;w=B;a=Wl(a|0,0,-1,-1)|0;a=Wl(a|0,B|0,u|0,w|0)|0;a=Xl(a|0,B|0,c|0)|0;g=Wl(f[n+20>>2]|0,0,-1,-1)|0;w=Wl(g|0,B|0,u|0,w|0)|0;c=Xl(w|0,B|0,c|0)|0;w=f[o>>2]|0;o=a+w|0;u=f[t>>2]|0;g=c+u|0;do{if(a>>>0<s>>>0){t=s-a|0;if(l>>>0>o>>>0){T=o-s|0;b=0;s=E-T|0;l=t}else{b=0;s=0;l=t;T=E}}else{t=a-s|0;if(l>>>0>o>>>0){b=t;s=l-o|0;l=0;T=w;break}else{b=t;s=0;l=0;T=E-t|0;break}}}while(0);do{if(c>>>0<v>>>0){o=v-c|0;if(y>>>0>g>>>0){a=g-v|0;u=a;t=0;a=_-a|0}else{u=_;t=0;a=0}}else{t=c-v|0;if(y>>>0>g>>>0){a=y-g|0;o=0;break}else{u=_-t|0;a=0;o=0;break}}}while(0);if((b|s|T|a|t|u|0)<0){r=0;n=61;break}t=(ce(t,E)|0)+b|0;v=b+s|0;g=(ce(a,E)|0)-b|0;c=w-T|0;i=i+((ce(w,o)|0)+l<<2)|0;switch(x|0){case 1:{r=r+t|0;t=(u|0)==0;if(!(f[S+32>>2]|0)){if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=p[i>>0];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+1|0}}t=o;r=r+T|0}r=r+v|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}}else if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=h[i>>0];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+1|0}}t=o;r=r+T|0}r=r+v|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}r=r+g|0;break}case 2:{r=r+(t<<1)|0;t=(u|0)==0;if(!(f[S+32>>2]|0)){if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=m[i>>1];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+2|0}}t=o;r=r+(T<<1)|0}r=r+(v<<1)|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}}else if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=d[i>>1];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+2|0}}t=o;r=r+(T<<1)|0}r=r+(v<<1)|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}r=r+(g<<1)|0;break}case 4:{r=r+(t<<2)|0;if(u){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=f[i>>2];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+4|0}}t=o;r=r+(T<<2)|0}r=r+(v<<2)|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}r=r+(g<<2)|0;break}default:{}}M=M+1|0;if(M>>>0>=(f[R>>2]|0)>>>0){r=1;n=61;break}else{n=n+52|0;S=S+52|0;e=e+52|0}}if((n|0)==61)return r|0;return 0}function uo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0;S=b;b=b+112|0;x=S+88|0;_=S+80|0;E=S+72|0;y=S+64|0;m=S+56|0;d=S+48|0;l=S+40|0;o=S+32|0;a=S+24|0;i=S+16|0;v=S+100|0;g=S+96|0;w=S+92|0;f[g>>2]=0;T=e+200|0;if((r|0)!=8){Qn(n,1,8662,S)|0;Qn(n,1,8662,S+8|0)|0;n=0;b=S;return n|0}wn(t,T,2);wn(t+2|0,v,4);wn(t+6|0,w,1);wn(t+7|0,g,1);s=f[T>>2]|0;t=f[e+112>>2]|0;if(s>>>0>=(ce(f[e+116>>2]|0,t)|0)>>>0){f[i>>2]=s;Qn(n,1,15258,i)|0;n=0;b=S;return n|0}r=f[e+164>>2]|0;c=(s>>>0)%(t>>>0)|0;u=(s>>>0)/(t>>>0)|0;t=f[v>>2]|0;do{if((t+-1|0)>>>0<13){if((t|0)==12){f[a>>2]=12;Qn(n,2,15282,a)|0;t=f[v>>2]|0;break}f[o>>2]=t;Qn(n,1,15319,o)|0;n=0;b=S;return n|0}}while(0);if(!t){Qn(n,4,15380,l)|0;f[e+72>>2]=1}t=f[g>>2]|0;do{if(!t)t=f[r+(s*5640|0)+5588>>2]|0;else{t=((p[e+76>>0]|0)>>>4&1)+t|0;f[g>>2]=t;i=r+(s*5640|0)+5588|0;a=f[i>>2]|0;r=f[w>>2]|0;if((a+-1|0)>>>0<r>>>0){f[d>>2]=r;f[d+4>>2]=a;Qn(n,1,15491,d)|0;f[e+72>>2]=1;n=0;b=S;return n|0}if(r>>>0<t>>>0){f[i>>2]=t;break}f[m>>2]=r;f[m+4>>2]=t;Qn(n,1,15590,m)|0;f[e+72>>2]=1;n=0;b=S;return n|0}}while(0);if((t|0)!=0?(t|0)==((f[w>>2]|0)+1|0):0){m=e+76|0;h[m>>0]=h[m>>0]|1}f[e+24>>2]=(f[e+72>>2]|0)==0?(f[v>>2]|0)+-12|0:0;f[e+8>>2]=16;t=f[e+60>>2]|0;if((t|0)==-1){if((c>>>0>=(f[e+28>>2]|0)>>>0?c>>>0<(f[e+36>>2]|0)>>>0:0)?u>>>0>=(f[e+32>>2]|0)>>>0:0)t=(u>>>0>=(f[e+40>>2]|0)>>>0&1)<<2&255;else t=4;v=e+76|0;h[v>>0]=h[v>>0]&-5|t}else{v=e+76|0;h[v>>0]=((f[T>>2]|0)!=(t|0)&1)<<2&255|h[v>>0]&-5}o=e+196|0;t=f[o>>2]|0;if(!t){n=1;b=S;return n|0}a=f[T>>2]|0;t=f[t+40>>2]|0;f[t+(a*40|0)>>2]=a;f[t+(a*40|0)+12>>2]=f[w>>2];r=f[g>>2]|0;if(r){f[t+(a*40|0)+4>>2]=r;f[t+(a*40|0)+8>>2]=f[g>>2];t=f[t+(a*40|0)+16>>2]|0;if(!t){x=qi(f[g>>2]|0,24)|0;f[(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16>>2]=x;if(x){n=1;b=S;return n|0}Qn(n,1,15698,y)|0;n=0;b=S;return n|0}t=Ki(t,(f[g>>2]|0)*24|0)|0;r=(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16|0;if(!t){Qi(f[r>>2]|0);f[(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16>>2]=0;Qn(n,1,15698,E)|0;n=0;b=S;return n|0}else{f[r>>2]=t;n=1;b=S;return n|0}}if(!(f[t+(a*40|0)+16>>2]|0)){f[t+(a*40|0)+8>>2]=10;E=qi(10,24)|0;r=f[T>>2]|0;t=f[(f[o>>2]|0)+40>>2]|0;f[t+(r*40|0)+16>>2]=E;if(!E){f[t+(r*40|0)+8>>2]=0;Qn(n,1,15698,_)|0;n=0;b=S;return n|0}else a=r}r=f[w>>2]|0;i=t+(a*40|0)+8|0;if(r>>>0<(f[i>>2]|0)>>>0){n=1;b=S;return n|0}r=r+1|0;f[i>>2]=r;t=Ki(f[t+(a*40|0)+16>>2]|0,r*24|0)|0;r=(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16|0;if(!t){Qi(f[r>>2]|0);T=f[T>>2]|0;w=f[(f[o>>2]|0)+40>>2]|0;f[w+(T*40|0)+16>>2]=0;f[w+(T*40|0)+8>>2]=0;Qn(n,1,15698,x)|0;n=0;b=S;return n|0}else{f[r>>2]=t;n=1;b=S;return n|0}return 0}function co(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0;g=b;b=b+64|0;p=g+48|0;m=g+40|0;s=g+32|0;c=g+56|0;o=g+52|0;f[c>>2]=r;v=e+80|0;l=f[v>>2]|0;d=e+8|0;if((f[d>>2]|0)==16)u=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else u=f[e+12>>2]|0;i=u+5636|0;a=h[i>>0]|0;if(a&1){Qn(n,1,15025,g)|0;v=0;b=g;return v|0}h[i>>0]=a|1;if(r>>>0<5){Qn(n,1,15089,g+8|0)|0;v=0;b=g;return v|0}wn(t,u,1);if((f[u>>2]|0)>>>0>7){Qn(n,1,15115,g+16|0)|0;v=0;b=g;return v|0}wn(t+1|0,o,1);o=f[o>>2]|0;i=u+4|0;f[i>>2]=o;if((o|0)>4){Qn(n,1,15149,g+24|0)|0;f[i>>2]=-1}i=u+8|0;wn(t+2|0,i,2);i=f[i>>2]|0;if((i+-1|0)>>>0>65534){f[s>>2]=i;Qn(n,1,15190,s)|0;v=0;b=g;return v|0}s=f[e+172>>2]|0;f[u+12>>2]=(s|0)==0?i:s;wn(t+4|0,u+16|0,1);s=t+5|0;f[c>>2]=r+-5;o=f[l+16>>2]|0;if(o){t=f[u>>2]&1;i=f[u+5584>>2]|0;a=0;do{f[i+(a*1080|0)>>2]=t;a=a+1|0}while(a>>>0<o>>>0)}if(!(Rt(e,0,s,c,n)|0)){Qn(n,1,15089,m)|0;v=0;b=g;return v|0}if(f[c>>2]|0){Qn(n,1,15089,p)|0;v=0;b=g;return v|0}if((f[d>>2]|0)==16)i=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else i=f[e+12>>2]|0;i=f[i+5584>>2]|0;r=i+4|0;a=f[r>>2]|0;u=a<<2;if((f[(f[v>>2]|0)+16>>2]|0)>>>0<=1){v=1;b=g;return v|0}c=i+8|0;d=i+12|0;e=i+16|0;n=i+20|0;p=i+812|0;m=i+944|0;f[i+1084>>2]=a;o=f[c>>2]|0;f[i+1088>>2]=o;t=f[d>>2]|0;f[i+1092>>2]=t;s=f[e>>2]|0;f[i+1096>>2]=s;l=f[n>>2]|0;f[i+1100>>2]=l;Yl(i+1892|0,p|0,u|0)|0;Yl(i+2024|0,m|0,u|0)|0;if((f[(f[v>>2]|0)+16>>2]|0)>>>0<=2){v=1;b=g;return v|0}f[i+2164>>2]=a;f[i+2168>>2]=o;f[i+2172>>2]=t;f[i+2176>>2]=s;f[i+2180>>2]=l;Yl(i+2972|0,p|0,u|0)|0;Yl(i+3104|0,m|0,u|0)|0;if((f[(f[v>>2]|0)+16>>2]|0)>>>0>3)a=3;else{v=1;b=g;return v|0}while(1){o=f[c>>2]|0;t=f[d>>2]|0;s=f[e>>2]|0;l=f[n>>2]|0;f[i+3244>>2]=f[r>>2];f[i+3248>>2]=o;f[i+3252>>2]=t;f[i+3256>>2]=s;f[i+3260>>2]=l;Yl(i+4052|0,p|0,u|0)|0;Yl(i+4184|0,m|0,u|0)|0;a=a+1|0;if(a>>>0>=(f[(f[v>>2]|0)+16>>2]|0)>>>0){i=1;break}else i=i+1080|0}b=g;return i|0}function ho(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0;_=b;b=b+272|0;h=_;g=_+136|0;y=_+8|0;if(!e){y=0;b=_;return y|0}c=e+4|0;if((f[e>>2]|0)==(t|0)?(f[c>>2]|0)==(r|0):0)i=e+8|0;else{f[e>>2]=t;f[c>>2]=r;f[g>>2]=t;f[y>>2]=r;i=e+8|0;f[i>>2]=0;a=0;s=r;l=t;u=0;while(1){v=ce(s,l)|0;l=(l+1|0)/2|0;o=u+1|0;f[g+(o<<2)>>2]=l;s=(s+1|0)/2|0;f[y+(o<<2)>>2]=s;a=a+v|0;if(v>>>0<=1)break;else u=o}f[i>>2]=a;if(!a){i=e+12|0;a=f[i>>2]|0;if(a){Qi(a);f[i>>2]=0}Qi(e);y=0;b=_;return y|0}o=a<<4;s=e+16|0;l=e+12|0;do{if(o>>>0>(f[s>>2]|0)>>>0){a=Ki(f[l>>2]|0,o)|0;if(a){f[l>>2]=a;r=f[s>>2]|0;Vl(a+r|0,0,o-r|0)|0;f[s>>2]=o;r=f[c>>2]|0;t=f[e>>2]|0;break}Qn(n,1,20166,h)|0;i=f[l>>2]|0;if(i){Qi(i);f[l>>2]=0}Qi(e);y=0;b=_;return y|0}}while(0);a=f[l>>2]|0;t=a+((ce(r,t)|0)<<4)|0;if(u){v=0;r=t;do{p=f[y+(v<<2)>>2]|0;e:do{if((p|0)>0){m=f[g+(v<<2)>>2]|0;if((m|0)<=0){o=p+-1|0;s=0;while(1){d=(s&1|0)!=0|(s|0)==(o|0);l=d?r:t+(m<<4)|0;r=d?r:t;s=s+1|0;if((s|0)>=(p|0)){t=l;break e}else t=l}}d=((m+2+((m|0)<2?~m:-3)|0)>>>1)+1|0;n=p+-1|0;h=0;while(1){c=m;l=r;while(1){f[a>>2]=l;o=a+16|0;s=c;c=c+-2|0;if((c|0)>-1){f[o>>2]=l;a=a+32|0}else a=o;if((s|0)<=2)break;else l=l+16|0}r=r+(d<<4)|0;c=(h&1|0)!=0|(h|0)==(n|0);o=c?r:t+(m<<4)|0;r=c?r:t;h=h+1|0;if((h|0)>=(p|0)){t=o;break}else t=o}}}while(0);v=v+1|0}while((v|0)!=(u|0))}f[a>>2]=0}i=f[i>>2]|0;if(!i){y=e;b=_;return y|0}a=0;t=f[e+12>>2]|0;while(1){f[t+4>>2]=999;f[t+8>>2]=0;f[t+12>>2]=0;a=a+1|0;if((a|0)==(i|0))break;else t=t+16|0}b=_;return e|0}function fo(e){e=e|0;var t=0,r=0;if(!e)return;t=e+12|0;r=f[t>>2]|0;if(r){Qi(r);f[t>>2]=0}Qi(e);return}function po(e,t,r){e=e|0;t=t|0;r=r|0;t=(f[e+12>>2]|0)+(t<<4)|0;if(!t)return;while(1){e=t+4|0;if((f[e>>2]|0)<=(r|0)){t=4;break}f[e>>2]=r;t=f[t>>2]|0;if(!t){t=4;break}}if((t|0)==4)return}function mo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+128|0;s=l;r=(f[t+12>>2]|0)+(r<<4)|0;if(!(f[r>>2]|0)){i=0;a=s}else{i=r;t=s;while(1){a=t+4|0;f[t>>2]=r;r=f[i>>2]|0;if(!(f[r>>2]|0)){i=0;break}else{i=r;t=a}}}while(1){o=r+8|0;t=f[o>>2]|0;if((i|0)>(t|0)){f[o>>2]=i;t=i}e:do{if((t|0)<(n|0)){i=r+4|0;while(1){if((t|0)>=(f[i>>2]|0))break;Ao(e,0,1);t=t+1|0;if((t|0)>=(n|0)){r=t;break e}}r=r+12|0;if(!(f[r>>2]|0)){Ao(e,1,1);f[r>>2]=1;r=t}else r=t}else r=t}while(0);f[o>>2]=r;if((a|0)==(s|0))break;o=a+-4|0;i=r;r=f[o>>2]|0;a=o}b=l;return}function vo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+128|0;s=l;r=(f[t+12>>2]|0)+(r<<4)|0;if(!(f[r>>2]|0)){t=0;a=s}else{i=r;t=s;while(1){a=t+4|0;f[t>>2]=r;r=f[i>>2]|0;if(!(f[r>>2]|0)){t=0;break}else{i=r;t=a}}}while(1){o=r+8|0;i=f[o>>2]|0;if((t|0)>(i|0))f[o>>2]=t;else t=i;r=r+4|0;e:do{if((t|0)<(n|0)){while(1){if((t|0)>=(f[r>>2]|0))break e;if(ko(e,1)|0)break;t=t+1|0;if((t|0)>=(n|0))break e}f[r>>2]=t}}while(0);f[o>>2]=t;if((a|0)==(s|0))break;o=a+-4|0;r=f[o>>2]|0;a=o}b=l;return(f[r>>2]|0)<(n|0)|0}function go(){var e=0,t=0;e=qi(1,12)|0;if(!e){e=0;return e|0}f[e+4>>2]=10;t=qi(10,4)|0;f[e+8>>2]=t;if(t){t=e;return t|0}Qi(e);t=0;return t|0}function yo(e){e=e|0;var t=0;if(!e)return;t=f[e+8>>2]|0;if(t)Qi(t);Qi(e);return}function _o(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;s=b;b=b+16|0;o=s;a=e+4|0;i=f[a>>2]|0;n=f[e>>2]|0;do{if((i|0)==(n|0)){i=i+10|0;f[a>>2]=i;n=e+8|0;i=Ki(f[n>>2]|0,i<<2)|0;if(i){f[n>>2]=i;n=f[e>>2]|0;break}Qi(f[n>>2]|0);f[a>>2]=0;f[e>>2]=0;Qn(r,1,20214,o)|0;e=0;b=s;return e|0}else i=f[e+8>>2]|0}while(0);f[i+(n<<2)>>2]=t;f[e>>2]=n+1;e=1;b=s;return e|0}function bo(e){e=e|0;return f[e>>2]|0}function Eo(e){e=e|0;return f[e+8>>2]|0}function wo(e){e=e|0;f[e>>2]=0;return}function xo(){return Yi(20)|0}function To(e){e=e|0;if(!e)return;Qi(e);return}function So(e){e=e|0;return(f[e+8>>2]|0)-(f[e>>2]|0)|0}function Mo(e,t,r){e=e|0;t=t|0;r=r|0;f[e>>2]=t;f[e+4>>2]=t+r;f[e+8>>2]=t;f[e+12>>2]=0;f[e+16>>2]=8;return}function Ro(e,t,r){e=e|0;t=t|0;r=r|0;f[e>>2]=t;f[e+4>>2]=t+r;f[e+8>>2]=t;f[e+12>>2]=0;f[e+16>>2]=0;return}function Ao(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!r)return;l=e+16|0;u=e+12|0;c=e+8|0;a=e+4|0;e=f[l>>2]|0;s=r+-1|0;do{o=t>>>s&1;if(!e){i=f[u>>2]|0;e=i<<8&65280;f[u>>2]=e;e=(e|0)==65280?7:8;f[l>>2]=e;n=f[c>>2]|0;if(n>>>0<(f[a>>2]|0)>>>0){f[c>>2]=n+1;h[n>>0]=i;e=f[l>>2]|0}}e=e+-1|0;f[l>>2]=e;f[u>>2]=o<<e|f[u>>2];s=s+-1|0}while(s>>>0<r>>>0);return}function ko(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0;if(!t){t=0;return t|0}s=e+16|0;l=e+12|0;u=e+8|0;a=e+4|0;r=f[s>>2]|0;n=f[l>>2]|0;o=t+-1|0;e=0;do{if(!r){i=n<<8&65280;f[l>>2]=i;r=(i|0)==65280?7:8;f[s>>2]=r;n=f[u>>2]|0;if(n>>>0<(f[a>>2]|0)>>>0){f[u>>2]=n+1;n=p[n>>0]|0|i;f[l>>2]=n}else n=i}r=r+-1|0;f[s>>2]=r;e=((n>>>r&1)<<o)+e|0;o=o+-1|0}while(o>>>0<t>>>0);return e|0}function Po(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;n=e+12|0;t=f[n>>2]|0;o=t<<8&65280;f[n>>2]=o;i=e+16|0;f[i>>2]=(o|0)==65280?7:8;o=e+8|0;r=f[o>>2]|0;a=e+4|0;if(r>>>0>=(f[a>>2]|0)>>>0){o=0;return o|0}f[o>>2]=r+1;h[r>>0]=t;if((f[i>>2]|0)!=7){o=1;return o|0}t=f[n>>2]|0;e=t<<8&65280;f[n>>2]=e;f[i>>2]=(e|0)==65280?7:8;e=f[o>>2]|0;if(e>>>0>=(f[a>>2]|0)>>>0){o=0;return o|0}f[o>>2]=e+1;h[e>>0]=t;o=1;return o|0}function Co(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=e+12|0;t=f[a>>2]|0;do{if((t&255|0)==255){n=t<<8&65280;f[a>>2]=n;t=e+16|0;f[t>>2]=(n|0)==65280?7:8;i=e+8|0;r=f[i>>2]|0;if(r>>>0<(f[e+4>>2]|0)>>>0){f[i>>2]=r+1;f[a>>2]=p[r>>0]|0|n;break}else{e=0;return e|0}}else t=e+16|0}while(0);f[t>>2]=0;e=1;return e|0}function Lo(e){e=e|0;return jo(e,1)|0}function Io(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0;k=b;b=b+32|0;R=k+16|0;A=k;l=f[e+24>>2]|0;s=(f[l+8>>2]|0)-(f[l>>2]|0)|0;o=(f[l+12>>2]|0)-(f[l+4>>2]|0)|0;M=(f[e+8>>2]|0)-(f[e>>2]|0)|0;if((t|0)==1){A=1;b=k;return A|0}a=t+-1|0;i=(a|0)==0;if(i)t=0;else{r=l;n=a;t=0;do{S=r;r=r+136|0;T=(f[S+144>>2]|0)-(f[r>>2]|0)|0;t=t>>>0<T>>>0?T:t;S=(f[S+148>>2]|0)-(f[S+140>>2]|0)|0;t=t>>>0<S>>>0?S:t;n=n+-1|0}while((n|0)!=0);t=t<<2}S=Zi(t)|0;f[R>>2]=S;if(!S){A=0;b=k;return A|0}f[A>>2]=S;if(!i){g=e+32|0;y=R+8|0;_=A+8|0;E=R+4|0;w=R+12|0;x=A+4|0;T=A+12|0;do{m=f[g>>2]|0;h=l;l=l+136|0;f[y>>2]=s;f[_>>2]=o;d=f[h+144>>2]|0;p=f[l>>2]|0;n=s;s=d-p|0;t=f[h+148>>2]|0;h=h+140|0;v=f[h>>2]|0;r=o;o=t-v|0;f[E>>2]=s-n;f[w>>2]=(p|0)%2|0;v=(t|0)==(v|0);if(!v){c=s<<2;t=0;while(1){e=ce(t,M)|0;u=m+(e<<2)|0;if(n){r=u;i=S+(f[w>>2]<<2)|0;while(1){n=n+-1|0;f[i>>2]=f[r>>2];if(!n)break;else{r=r+4|0;i=i+8|0}}}r=f[E>>2]|0;if(r){n=m+((f[y>>2]|0)+e<<2)|0;i=S+(1-(f[w>>2]|0)<<2)|0;while(1){r=r+-1|0;f[i>>2]=f[n>>2];if(!r)break;else{n=n+4|0;i=i+8|0}}}Vo(R);Yl(u|0,S|0,c|0)|0;t=t+1|0;if((t|0)==(o|0))break;n=f[y>>2]|0}r=f[_>>2]|0;t=f[h>>2]|0}f[x>>2]=o-r;f[T>>2]=(t|0)%2|0;e:do{if((d|0)!=(p|0)){t=0;while(1){if(r){n=m+(t<<2)|0;i=S+(f[T>>2]<<2)|0;while(1){r=r+-1|0;f[i>>2]=f[n>>2];if(!r)break;else{n=n+(M<<2)|0;i=i+8|0}}}r=f[x>>2]|0;if(r){n=m+((ce(f[_>>2]|0,M)|0)+t<<2)|0;i=S+(1-(f[T>>2]|0)<<2)|0;while(1){r=r+-1|0;f[i>>2]=f[n>>2];if(!r)break;else{n=n+(M<<2)|0;i=i+8|0}}}Vo(A);if(!v){r=0;do{p=m+((ce(r,M)|0)+t<<2)|0;f[p>>2]=f[S+(r<<2)>>2];r=r+1|0}while((r|0)!=(o|0))}t=t+1|0;if((t|0)==(s|0))break e;r=f[_>>2]|0}}}while(0);a=a+-1|0}while((a|0)!=0)}Ji(S);A=1;b=k;return A|0}function Oo(e){e=e|0;if(!e){e=0;return e|0}e=(e+-1|0)>>>0<2?1:2;return e|0}function Ho(e,t){e=e|0;t=t|0;return+ +y[56+(t*80|0)+(e<<3)>>3]}function Do(e){e=e|0;return jo(e,2)|0}function No(e){e=e|0;return 0}function Fo(e,t){e=e|0;t=t|0;return+ +y[376+(t*80|0)+(e<<3)>>3]}function Uo(e,t){e=e|0;t=t|0;var r=0.0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;l=e+4|0;u=((f[l>>2]|0)*3|0)+-2|0;if(!u)return;c=e+20|0;h=e+24|0;d=0;do{if(!d){n=0;i=0}else{i=d+-1|0;n=((i>>>0)/3|0)+1|0;i=((i>>>0)%3|0)+1|0}if((i|0)==0|(f[c>>2]|0)==0)a=0;else a=(i+-1|0)>>>0<2?1:2;if(!(f[h>>2]|0))r=1.0;else r=+(1<<a|0)/+y[376+(i*80|0)+((f[l>>2]|0)+~n<<3)>>3];s=~~+J(+(r*8192.0));o=a+t|0;if((s|0)>1){n=s;i=0;while(1){n=n>>1;if((n|0)<=1)break;else i=i+1|0}a=s;n=0;do{a=a>>1;n=n+1|0}while((a|0)>1);i=i+-12|0}else{i=-13;n=0}a=11-n|0;f[e+28+(d<<3)+4>>2]=((a|0)<0?s>>0-a:s<<a)&2047;f[e+28+(d<<3)>>2]=o-i;d=d+1|0}while((d|0)!=(u|0));return}function Bo(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0;W=b;b=b+32|0;j=W+16|0;V=W;c=f[e+24>>2]|0;h=f[c+8>>2]|0;d=f[c>>2]|0;l=f[c+12>>2]|0;u=f[c+4>>2]|0;z=e+8|0;o=f[z>>2]|0;s=f[e>>2]|0;B=o-s|0;a=t+-1|0;i=(a|0)==0;if(i)t=80;else{r=c;n=a;t=0;do{U=r;r=r+136|0;F=(f[U+144>>2]|0)-(f[r>>2]|0)|0;t=t>>>0<F>>>0?F:t;U=(f[U+148>>2]|0)-(f[U+140>>2]|0)|0;t=t>>>0<U>>>0?U:t;n=n+-1|0}while((n|0)!=0);t=(t<<4)+80|0}U=Zi(t)|0;f[j>>2]=U;if(!U){G=0;b=W;return G|0}f[V>>2]=U;e:do{if(!i){T=e+32|0;S=e+12|0;M=e+4|0;R=j+8|0;A=V+8|0;k=j+4|0;P=j+12|0;C=V+4|0;L=V+12|0;I=B<<1;O=B<<2;H=B*3|0;N=s<<2;F=o<<2;D=N-F|0;N=F-N|0;F=o-s<<2;t=a;r=U;a=o;n=s;v=l-u|0;i=c;o=h-d|0;while(1){g=f[T>>2]|0;n=ce((f[S>>2]|0)-(f[M>>2]|0)|0,a-n|0)|0;f[R>>2]=o;f[A>>2]=v;w=i+136|0;p=f[i+144>>2]|0;m=f[w>>2]|0;x=p-m|0;_=f[i+148>>2]|0;h=i+140|0;y=f[h>>2]|0;E=_-y|0;f[k>>2]=x-o;f[P>>2]=(m|0)%2|0;if((E|0)>3){a=(x|0)>0;o=(_+-4-y|0)>>>2;c=ce(D,o)|0;o=g+(N+(ce(F,o)|0)<<2)|0;s=g;l=n;u=E;while(1){Wo(j,s,B,l);Xo(j);if(a){i=x;do{d=i;i=i+-1|0;f[s+(i<<2)>>2]=f[U+(i<<4)>>2];f[s+(i+B<<2)>>2]=f[U+(i<<4)+4>>2];f[s+(i+I<<2)>>2]=f[U+(i<<4)+8>>2];f[s+(i+H<<2)>>2]=f[U+(i<<4)+12>>2]}while((d|0)>1)}u=u+-4|0;if((u|0)<=3)break;else{s=s+(O<<2)|0;l=l-O|0}}n=D+n+c|0}else o=g;a=E&3;t:do{if(!a)G=21;else{Wo(j,o,B,n);Xo(j);if((x|0)>0)n=x;else{l=E-v|0;f[C>>2]=l;a=(f[h>>2]|0)%2|0;f[L>>2]=a;u=v;s=g;break}while(1){i=n;n=n+-1|0;switch(a|0){case 3:{f[o+(n+I<<2)>>2]=f[U+(n<<4)+8>>2];G=18;break}case 2:{G=18;break}case 1:{G=19;break}default:{}}if((G|0)==18){f[o+(n+B<<2)>>2]=f[U+(n<<4)+4>>2];G=19}if((G|0)==19){G=0;f[o+(n<<2)>>2]=f[U+(n<<4)>>2]}if((i|0)<=1){G=21;break t}}}}while(0);if((G|0)==21){G=0;l=E-v|0;f[C>>2]=l;a=(f[h>>2]|0)%2|0;f[L>>2]=a;if((x|0)>3){d=(_|0)==(y|0);p=p+-4-m|0;h=f[A>>2]|0;u=(h|0)>0;s=1-a|0;c=(l|0)>0;i=g;o=x;while(1){if(u){n=0;do{v=r+((n<<1)+a<<4)|0;m=i+((ce(n,B)|0)<<2)|0;f[v>>2]=f[m>>2];f[v+4>>2]=f[m+4>>2];f[v+8>>2]=f[m+8>>2];f[v+12>>2]=f[m+12>>2];n=n+1|0}while((n|0)!=(h|0))}if(c){n=0;do{v=r+(s+(n<<1)<<4)|0;m=i+((ce(n+h|0,B)|0)<<2)|0;f[v>>2]=f[m>>2];f[v+4>>2]=f[m+4>>2];f[v+8>>2]=f[m+8>>2];f[v+12>>2]=f[m+12>>2];n=n+1|0}while((n|0)!=(l|0))}Xo(V);if(!d){r=f[V>>2]|0;n=0;do{v=i+((ce(n,B)|0)<<2)|0;m=r+(n<<4)|0;f[v>>2]=f[m>>2];f[v+4>>2]=f[m+4>>2];f[v+8>>2]=f[m+8>>2];f[v+12>>2]=f[m+12>>2];n=n+1|0}while((n|0)!=(E|0))}o=o+-4|0;if((o|0)<=3)break;else i=i+16|0}u=h;s=g+((p+4&-4)<<2)|0}else{u=v;s=g}}o=x&3;if(o){r=f[V>>2]|0;if((u|0)>0){n=o<<2;i=0;do{Yl(r+((i<<1)+a<<4)|0,s+((ce(i,B)|0)<<2)|0,n|0)|0;i=i+1|0}while((i|0)!=(u|0))}n=1-a|0;if((l|0)>0){i=o<<2;a=0;do{Yl(r+(n+(a<<1)<<4)|0,s+((ce(a+u|0,B)|0)<<2)|0,i|0)|0;a=a+1|0}while((a|0)!=(l|0))}Xo(V);if((_|0)!=(y|0)){n=o<<2;i=0;do{Yl(s+((ce(i,B)|0)<<2)|0,r+(i<<4)|0,n|0)|0;i=i+1|0}while((i|0)!=(E|0))}}t=t+-1|0;if(!t)break e;a=f[z>>2]|0;n=f[e>>2]|0;v=E;i=w;o=x}}}while(0);Ji(U);G=1;b=W;return G|0}function zo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;if(!n){n=(t|0)>0;if(!(n|(r|0)>1))return;if(n){n=e+((r<<1)+-2<<2)|0;i=0;do{l=i;i=i+1|0;u=e+((l<<1|1)<<2)|0;f[u>>2]=(f[u>>2]|0)-((f[((i|0)<(r|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((l|0)<(r|0)?e+(l<<1<<2)|0:n)>>2]|0)>>1)}while((i|0)!=(t|0))}if((r|0)<=0)return;i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)n=i;else n=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;u=e+(o<<1<<2)|0;f[u>>2]=((f[n>>2]|0)+2+(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)>>2)+(f[u>>2]|0);o=o+1|0}while((o|0)!=(r|0));return}if((t|0)==1&(r|0)==0){f[e>>2]=f[e>>2]<<1;return}if((t|0)>0){i=e+4|0;a=(r<<1)+-1|0;o=e+(a<<2)|0;u=0;do{s=u<<1;l=f[e+(((u|0)<(r|0)?s|1:a)<<2)>>2]|0;if((u|0)>=1)if((u|0)>(r|0))n=o;else n=e+(s+-1<<2)|0;else n=i;s=e+(s<<2)|0;f[s>>2]=(f[s>>2]|0)-((f[n>>2]|0)+l>>1);u=u+1|0}while((u|0)!=(t|0))}if((r|0)<=0)return;n=e+((t<<1)+-2<<2)|0;i=0;do{l=i;i=i+1|0;u=e+((l<<1|1)<<2)|0;f[u>>2]=((f[((l|0)<(t|0)?e+(l<<1<<2)|0:n)>>2]|0)+2+(f[((i|0)<(t|0)?e+(i<<1<<2)|0:n)>>2]|0)>>2)+(f[u>>2]|0)}while((i|0)!=(r|0));return}function jo(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0;w=(f[e+8>>2]|0)-(f[e>>2]|0)|0;a=f[e+16>>2]|0;s=a+-1|0;x=f[e+32>>2]|0;o=f[e+24>>2]|0;i=(s|0)==0;if(i)e=0;else{r=o;n=s;e=0;do{E=r;r=r+136|0;b=(f[E+144>>2]|0)-(f[r>>2]|0)|0;e=e>>>0<b>>>0?b:e;E=(f[E+148>>2]|0)-(f[E+140>>2]|0)|0;e=e>>>0<E>>>0?E:e;n=n+-1|0}while((n|0)!=0);e=e<<2}E=Yi(e)|0;if(!((e|0)==0|(E|0)!=0)){t=0;return t|0}if(!i){_=a+-2|0;b=_;e=o+(s*136|0)|0;_=o+(_*136|0)|0;while(1){v=f[e>>2]|0;y=(f[e+8>>2]|0)-v|0;h=f[e+4>>2]|0;p=(f[e+12>>2]|0)-h|0;m=(f[_+8>>2]|0)-(f[_>>2]|0)|0;e=f[_+12>>2]|0;r=f[_+4>>2]|0;c=e-r|0;v=v&1;h=h&1;d=p-c|0;g=(y|0)>0;e:do{if(g){i=(e|0)==(r|0);s=(p|0)==(c|0);l=E+((h^1)<<2)|0;u=ce(c,w)|0;o=E+(h<<2)|0;if((p|0)>0){a=0;while(1){r=x+(a<<2)|0;e=0;do{n=x+((ce(e,w)|0)+a<<2)|0;f[E+(e<<2)>>2]=f[n>>2];e=e+1|0}while((e|0)!=(p|0));Bu[t&3](E,d,c,h);if(!i){n=c;e=o;while(1){n=n+-1|0;f[r>>2]=f[e>>2];if(!n)break;else{r=r+(w<<2)|0;e=e+8|0}}}if(!s){e=d;r=x+(a+u<<2)|0;n=l;while(1){e=e+-1|0;f[r>>2]=f[n>>2];if(!e)break;else{r=r+(w<<2)|0;n=n+8|0}}}a=a+1|0;if((a|0)==(y|0))break e}}if(i){r=0;while(1){Bu[t&3](E,d,c,h);if(!s){e=d;n=x+(r+u<<2)|0;i=l;while(1){e=e+-1|0;f[n>>2]=f[i>>2];if(!e)break;else{n=n+(w<<2)|0;i=i+8|0}}}r=r+1|0;if((r|0)==(y|0))break e}}else i=0;do{Bu[t&3](E,d,c,h);e=c;r=x+(i<<2)|0;n=o;while(1){e=e+-1|0;f[r>>2]=f[n>>2];if(!e)break;else{r=r+(w<<2)|0;n=n+8|0}}if(!s){e=d;r=x+(i+u<<2)|0;n=l;while(1){e=e+-1|0;f[r>>2]=f[n>>2];if(!e)break;else{r=r+(w<<2)|0;n=n+8|0}}}i=i+1|0}while((i|0)!=(y|0))}}while(0);a=y-m|0;if((p|0)>0){o=(m|0)>0;s=E+(v<<2)|0;l=(a|0)>0;u=E+((v^1)<<2)|0;c=0;do{i=ce(c,w)|0;r=x+(i<<2)|0;if(g){e=0;do{f[E+(e<<2)>>2]=f[x+(e+i<<2)>>2];e=e+1|0}while((e|0)!=(y|0))}Bu[t&3](E,a,m,v);if(o){n=0;e=s;while(1){f[r>>2]=f[e>>2];n=n+1|0;if((n|0)==(m|0))break;else{r=r+4|0;e=e+8|0}}}if(l){n=0;e=x+(i+m<<2)|0;r=u;while(1){f[e>>2]=f[r>>2];n=n+1|0;if((n|0)==(a|0))break;else{e=e+4|0;r=r+8|0}}}c=c+1|0}while((c|0)!=(p|0))}if(!b)break;else{e=_;b=b+-1|0;_=_+-136|0}}}Qi(E);t=1;return t|0}function Vo(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0;s=f[e>>2]|0;l=f[e+4>>2]|0;u=f[e+8>>2]|0;if(!(f[e+12>>2]|0)){n=(l|0)>0;if(!(n|(u|0)>1))return;if((u|0)>0){t=s+4|0;r=(l<<1)+-1|0;i=0;do{if((i|0)<1)e=t;else e=s+((((i|0)>(l|0)?l:i)<<1)+-1<<2)|0;a=i<<1;o=s+(a<<2)|0;f[o>>2]=(f[o>>2]|0)-((f[e>>2]|0)+2+(f[s+(((i|0)<(l|0)?a|1:r)<<2)>>2]|0)>>2);i=i+1|0}while((i|0)!=(u|0))}if(!n)return;e=s+((u<<1)+-2<<2)|0;t=0;do{a=t<<1;i=t;t=t+1|0;o=s+((a|1)<<2)|0;f[o>>2]=((f[((t|0)<(u|0)?s+(t<<1<<2)|0:e)>>2]|0)+(f[((i|0)<(u|0)?s+(a<<2)|0:e)>>2]|0)>>1)+(f[o>>2]|0)}while((t|0)!=(l|0));return}if((l|0)==1&(u|0)==0){f[s>>2]=(f[s>>2]|0)/2|0;return}if((u|0)>0){e=s+((l<<1)+-2<<2)|0;t=0;do{a=t<<1;i=t;t=t+1|0;o=s+((a|1)<<2)|0;f[o>>2]=(f[o>>2]|0)-((f[((i|0)<(l|0)?s+(a<<2)|0:e)>>2]|0)+2+(f[((t|0)<(l|0)?s+(t<<1<<2)|0:e)>>2]|0)>>2)}while((t|0)!=(u|0))}if((l|0)<=0)return;t=s+4|0;r=(u<<1)+-1|0;n=s+(r<<2)|0;o=0;do{i=o<<1;a=f[s+(((o|0)<(u|0)?i|1:r)<<2)>>2]|0;if((o|0)>=1)if((o|0)>(u|0))e=n;else e=s+(i+-1<<2)|0;else e=t;i=s+(i<<2)|0;f[i>>2]=((f[e>>2]|0)+a>>1)+(f[i>>2]|0);o=o+1|0}while((o|0)!=(l|0));return}function Go(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0;if(!n){l=(t|0)>0;if(!(l|(r|0)>1))return;if(l){n=e+((r<<1)+-2<<2)|0;i=0;do{h=i;i=i+1|0;c=(f[((i|0)<(r|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((h|0)<(r|0)?e+(h<<1<<2)|0:n)>>2]|0)|0;c=Ql(c|0,((c|0)<0)<<31>>31|0,12993,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+((h<<1|1)<<2)|0;f[h>>2]=(f[h>>2]|0)-c}while((i|0)!=(t|0))}s=(r|0)>0;if(s){i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)n=i;else n=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;c=(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)+(f[n>>2]|0)|0;c=Ql(c|0,((c|0)<0)<<31>>31|0,434,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+(o<<1<<2)|0;f[h>>2]=(f[h>>2]|0)-c;o=o+1|0}while((o|0)!=(r|0))}if(l){n=e+((r<<1)+-2<<2)|0;i=0;do{h=i;i=i+1|0;c=(f[((i|0)<(r|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((h|0)<(r|0)?e+(h<<1<<2)|0:n)>>2]|0)|0;c=Ql(c|0,((c|0)<0)<<31>>31|0,7233,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+((h<<1|1)<<2)|0;f[h>>2]=c+(f[h>>2]|0)}while((i|0)!=(t|0))}if(s){i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)n=i;else n=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;c=(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)+(f[n>>2]|0)|0;c=Ql(c|0,((c|0)<0)<<31>>31|0,3633,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+(o<<1<<2)|0;f[h>>2]=c+(f[h>>2]|0);o=o+1|0}while((o|0)!=(r|0))}if(l){n=0;do{h=e+((n<<1|1)<<2)|0;c=f[h>>2]|0;c=Ql(c|0,((c|0)<0)<<31>>31|0,5038,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;f[h>>2]=c;n=n+1|0}while((n|0)!=(t|0))}if(s)n=0;else return;do{t=e+(n<<1<<2)|0;h=f[t>>2]|0;h=Ql(h|0,((h|0)<0)<<31>>31|0,6659,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=Xl(h|0,B|0,13)|0;f[t>>2]=h;n=n+1|0}while((n|0)!=(r|0));return}h=(r|0)>0;if(!((t|0)>1|h))return;c=(t|0)>0;if(c){i=e+4|0;a=(r<<1)+-1|0;o=e+(a<<2)|0;u=0;do{s=u<<1;l=f[e+(((u|0)<(r|0)?s|1:a)<<2)>>2]|0;if((u|0)>=1)if((u|0)>(r|0))n=o;else n=e+(s+-1<<2)|0;else n=i;n=(f[n>>2]|0)+l|0;n=Ql(n|0,((n|0)<0)<<31>>31|0,12993,0)|0;n=Wl(n|0,B|0,4096,0)|0;n=Xl(n|0,B|0,13)|0;l=e+(s<<2)|0;f[l>>2]=(f[l>>2]|0)-n;u=u+1|0}while((u|0)!=(t|0))}if(h){n=e+((t<<1)+-2<<2)|0;i=0;do{u=i;i=i+1|0;l=(f[((i|0)<(t|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((u|0)<(t|0)?e+(u<<1<<2)|0:n)>>2]|0)|0;l=Ql(l|0,((l|0)<0)<<31>>31|0,434,0)|0;l=Wl(l|0,B|0,4096,0)|0;l=Xl(l|0,B|0,13)|0;u=e+((u<<1|1)<<2)|0;f[u>>2]=(f[u>>2]|0)-l}while((i|0)!=(r|0))}if(c){i=e+4|0;a=(r<<1)+-1|0;o=e+(a<<2)|0;u=0;do{s=u<<1;l=f[e+(((u|0)<(r|0)?s|1:a)<<2)>>2]|0;if((u|0)>=1)if((u|0)>(r|0))n=o;else n=e+(s+-1<<2)|0;else n=i;n=(f[n>>2]|0)+l|0;n=Ql(n|0,((n|0)<0)<<31>>31|0,7233,0)|0;n=Wl(n|0,B|0,4096,0)|0;n=Xl(n|0,B|0,13)|0;l=e+(s<<2)|0;f[l>>2]=n+(f[l>>2]|0);u=u+1|0}while((u|0)!=(t|0))}if(h){n=e+((t<<1)+-2<<2)|0;i=0;do{u=i;i=i+1|0;l=(f[((i|0)<(t|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((u|0)<(t|0)?e+(u<<1<<2)|0:n)>>2]|0)|0;l=Ql(l|0,((l|0)<0)<<31>>31|0,3633,0)|0;l=Wl(l|0,B|0,4096,0)|0;l=Xl(l|0,B|0,13)|0;u=e+((u<<1|1)<<2)|0;f[u>>2]=l+(f[u>>2]|0)}while((i|0)!=(r|0))}if(c){n=0;do{c=e+(n<<1<<2)|0;u=f[c>>2]|0;u=Ql(u|0,((u|0)<0)<<31>>31|0,5038,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=Xl(u|0,B|0,13)|0;f[c>>2]=u;n=n+1|0}while((n|0)!=(t|0))}if(h)n=0;else return;do{t=e+((n<<1|1)<<2)|0;h=f[t>>2]|0;h=Ql(h|0,((h|0)<0)<<31>>31|0,6659,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=Xl(h|0,B|0,13)|0;f[t>>2]=h;n=n+1|0}while((n|0)!=(r|0));return}function Wo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0;h=f[e>>2]|0;s=f[e+12>>2]|0;v=f[e+8>>2]|0;d=r*3|0;c=1-s|0;u=e+4|0;l=v;e=0;while(1){o=h+(s<<4)|0;if(((l+d|0)<(n|0)?(t&15|0)==0:0)?((o|r)&15|0)==0:0){if((l|0)>0){i=0;do{o=i<<3;f[h+(s<<4)+(o<<2)>>2]=f[t+(i<<2)>>2];a=i+r|0;f[h+(s<<4)+((o|1)<<2)>>2]=f[t+(a<<2)>>2];a=a+r|0;f[h+(s<<4)+((o|2)<<2)>>2]=f[t+(a<<2)>>2];f[h+(s<<4)+((o|3)<<2)>>2]=f[t+(a+r<<2)>>2];i=i+1|0}while((i|0)!=(l|0))}}else g=3;if((g|0)==3?(g=0,(l|0)>0):0){o=0;do{i=o<<3;f[h+(s<<4)+(i<<2)>>2]=f[t+(o<<2)>>2];a=o+r|0;if(((a|0)<(n|0)?(f[h+(s<<4)+((i|1)<<2)>>2]=f[t+(a<<2)>>2],p=a+r|0,(p|0)<(n|0)):0)?(f[h+(s<<4)+((i|2)<<2)>>2]=f[t+(p<<2)>>2],m=p+r|0,(m|0)<(n|0)):0)f[h+(s<<4)+((i|3)<<2)>>2]=f[t+(m<<2)>>2];o=o+1|0}while((o|0)!=(l|0))}e=e+1|0;if((e|0)==2)break;else{t=t+(v<<2)|0;n=n-v|0;s=c;l=f[u>>2]|0}}return}function Xo(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0.0,u=0.0,c=0,h=0.0,d=0,p=0;do{if(!(f[e+12>>2]|0)){r=f[e+8>>2]|0;if((f[e+4>>2]|0)>0){t=f[e>>2]|0;if((r|0)>0){o=0;i=1;s=9;break}else{o=0;a=1;break}}if((r|0)>1){n=0;i=1;s=7}else return}else{r=f[e+8>>2]|0;if((r|0)<=0)if((f[e+4>>2]|0)>1){t=f[e>>2]|0;o=1;a=0;break}else return;else{n=1;i=0;s=7}}}while(0);if((s|0)==7){t=f[e>>2]|0;o=n;s=9}if((s|0)==9){n=0;do{s=n<<3;d=t+(o<<4)+(s<<2)|0;c=t+(o<<4)+((s|1)<<2)|0;h=+g[c>>2];a=t+(o<<4)+((s|2)<<2)|0;u=+g[a>>2];s=t+(o<<4)+((s|3)<<2)|0;l=+g[s>>2];g[d>>2]=+g[d>>2]*1.2301740646362305;g[c>>2]=h*1.2301740646362305;g[a>>2]=u*1.2301740646362305;g[s>>2]=l*1.2301740646362305;n=n+1|0}while((n|0)!=(r|0));a=i}n=f[e+4>>2]|0;if((n|0)>0){i=0;do{d=i<<3;s=t+(a<<4)+(d<<2)|0;e=t+(a<<4)+((d|1)<<2)|0;l=+g[e>>2];c=t+(a<<4)+((d|2)<<2)|0;u=+g[c>>2];d=t+(a<<4)+((d|3)<<2)|0;h=+g[d>>2];g[s>>2]=+g[s>>2]*1.625732421875;g[e>>2]=l*1.625732421875;g[c>>2]=u*1.625732421875;g[d>>2]=h*1.625732421875;i=i+1|0}while((i|0)!=(n|0))}p=t+(a<<4)|0;i=t+(o+1<<4)|0;s=n-o|0;s=(r|0)<(s|0)?r:s;Yo(p,i,r,s,-.4435068666934967);e=t+(o<<4)|0;c=t+(a+1<<4)|0;d=r-a|0;d=(n|0)<(d|0)?n:d;Yo(e,c,n,d,-.8829110860824585);Yo(p,i,r,s,.05298011749982834);Yo(e,c,n,d,1.5861343145370483);return}function Yo(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=+i;var a=0.0,o=0.0,s=0.0,l=0.0,u=0,c=0,h=0,d=0,f=0.0,p=0.0,m=0,v=0.0,y=0.0,_=0,b=0.0,E=0.0,w=0,x=0.0;if((n|0)>0){h=n<<1;c=h+-2|0;o=+g[e>>2];s=+g[e+4>>2];l=+g[e+8>>2];a=+g[e+12>>2];e=t;u=0;while(1){w=e+-16|0;_=e+-12|0;E=+g[_>>2];m=e+-8|0;y=+g[m>>2];d=e+-4|0;p=+g[d>>2];x=o;o=+g[e>>2];b=s;s=+g[e+4>>2];v=l;l=+g[e+8>>2];f=a;a=+g[e+12>>2];g[w>>2]=+g[w>>2]+(x+o)*i;g[_>>2]=E+(b+s)*i;g[m>>2]=y+(v+l)*i;g[d>>2]=p+(f+a)*i;u=u+1|0;if((u|0)==(n|0))break;else e=e+32|0}e=t+(c<<4)|0;t=t+(h<<4)|0}if((n|0)>=(r|0))return;a=i+i;o=a*+g[e>>2];s=a*+g[e+4>>2];l=a*+g[e+8>>2];a=a*+g[e+12>>2];while(1){d=t+-16|0;m=t+-12|0;b=+g[m>>2];_=t+-8|0;E=+g[_>>2];w=t+-4|0;x=+g[w>>2];g[d>>2]=o+ +g[d>>2];g[m>>2]=s+b;g[_>>2]=l+E;g[w>>2]=a+x;n=n+1|0;if((n|0)==(r|0))break;else t=t+32|0}return}function qo(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0.0,p=0,m=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0;x=r<<2;T=Yi(r<<4)|0;if(!T){e=0;return e|0}S=T+x|0;Vl(T|0,0,x|0)|0;E=r+-1|0;b=(r|0)==0;if(!b){n=0;i=T;while(1){f[i>>2]=n;n=n+1|0;if((n|0)==(r|0))break;else i=i+4|0}}e:do{if(E){m=E;s=0;n=0;v=e;y=1;_=T;while(1){l=v+(s<<2)|0;if(s>>>0<r>>>0){o=s;i=l;a=0.0}else break;while(1){d=+g[i>>2];d=d>0.0?d:-d;w=d>a;n=w?o:n;a=w?d:a;o=o+1|0;if((o|0)==(r|0))break;else i=i+(r<<2)|0}if(a==0.0)break;if((n|0)!=(s|0)){w=n-s|0;p=_+(w<<2)|0;h=f[_>>2]|0;f[_>>2]=f[p>>2];f[p>>2]=h;w=v+((ce(w,r)|0)<<2)|0;Yl(S|0,w|0,x|0)|0;Yl(w|0,v|0,x|0)|0;Yl(v|0,S|0,x|0)|0}i=s;p=s+1|0;d=+g[l>>2];if(y>>>0<r>>>0){u=v+(p<<2)|0;h=p+m|0;c=y;o=v+(i+r<<2)|0;while(1){a=+g[o>>2]/d;g[o>>2]=a;i=y;s=o;l=u;while(1){s=s+4|0;g[s>>2]=+g[s>>2]-a*+g[l>>2];i=i+1|0;if((i|0)==(r|0))break;else l=l+4|0}c=c+1|0;if((c|0)==(r|0))break;else o=o+(h<<2)|0}}if(p>>>0<E>>>0){m=m+-1|0;s=p;v=v+(r<<2)|0;y=y+1|0;_=_+4|0}else break e}Qi(T);e=0;return e|0}}while(0);n=r<<1;w=S+(n<<2)|0;if(!b){b=S+(E+r<<2)|0;m=S+(n+E<<2)|0;v=e+((ce(r,r)|0)+-1<<2)|0;y=~r;_=0;p=t;while(1){Vl(S|0,0,x|0)|0;g[S+(_<<2)>>2]=1.0;s=0;l=1;u=T;c=w;h=e;while(1){if(!s)a=0.0;else{n=1;i=w;o=h;a=0.0;while(1){a=a+ +g[o>>2]*+g[i>>2];n=n+1|0;if((n|0)==(l|0))break;else{i=i+4|0;o=o+4|0}}}g[c>>2]=+g[S+(f[u>>2]<<2)>>2]-a;s=s+1|0;if((s|0)==(r|0)){s=r;l=b;u=w;c=m;h=v;break}else{l=l+1|0;u=u+4|0;c=c+4|0;h=h+(r<<2)|0}}while(1){n=s;s=s+-1|0;d=+g[h>>2];if(n>>>0<r>>>0){i=u;o=h;a=0.0;while(1){o=o+4|0;a=a+ +g[o>>2]*+g[i>>2];n=n+1|0;if((n|0)==(r|0))break;else i=i+4|0}}else a=0.0;u=u+-4|0;g[l>>2]=(+g[c>>2]-a)/d;if(!s){n=0;i=p;break}else{l=l+-4|0;c=c+-4|0;h=h+(y<<2)|0}}while(1){f[i>>2]=f[S+(n+r<<2)>>2];n=n+1|0;if((n|0)==(r|0))break;else i=i+(r<<2)|0}_=_+1|0;if((_|0)==(r|0))break;else p=p+4|0}}Qi(T);e=1;return e|0}function Zo(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;a=qi(1,44)|0;if(!a){a=0;return a|0}o=ls()|0;f[a>>2]=o;if(!o){us(0);f[a>>2]=0;o=a+4|0;Ss(f[o>>2]|0);f[o>>2]=0;if((f[a+40>>2]|0)==0?(r=a+8|0,t=f[r>>2]|0,(t|0)!=0):0){Ji(t);f[r>>2]=0}t=a+12|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}Qi(a);o=0;return o|0}o=Ts()|0;t=a+4|0;f[t>>2]=o;if(o){f[a+40>>2]=e;o=a;return o|0}us(f[a>>2]|0);f[a>>2]=0;Ss(f[t>>2]|0);f[t>>2]=0;if((f[a+40>>2]|0)==0?(n=a+8|0,i=f[n>>2]|0,(i|0)!=0):0){Ji(i);f[n>>2]=0}t=a+12|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}Qi(a);o=0;return o|0}function Jo(e){e=e|0;var t=0,r=0,n=0;if(!e)return;us(f[e>>2]|0);f[e>>2]=0;n=e+4|0;Ss(f[n>>2]|0);f[n>>2]=0;if((f[e+40>>2]|0)==0?(t=e+8|0,r=f[t>>2]|0,(r|0)!=0):0){Ji(r);f[t>>2]=0}t=e+12|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}Qi(e);return}function Ko(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,J=0,K=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ve=0,ge=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Se=0,Me=0,Re=0,Ae=0,ke=0;Te=(f[t+8>>2]|0)-(f[t>>2]|0)|0;Se=t+20|0;n=f[Se>>2]|0;if(!n){e=1;return e|0}Me=t+24|0;Re=r+808|0;Ae=r+16|0;_e=e+4|0;Ee=e+8|0;we=e+16|0;xe=e+20|0;ye=r+20|0;me=t+32|0;ve=e+32|0;ge=e+12|0;r=n;pe=0;e:while(1){de=f[Me>>2]|0;fe=de+(pe*136|0)+24|0;t=f[fe>>2]|0;if(t){le=de+(pe*136|0)+16|0;ue=de+(pe*136|0)+20|0;he=pe+-1|0;r=f[ue>>2]|0;n=f[le>>2]|0;se=0;do{if(ce(r,n)|0){re=de+(pe*136|0)+28+(se*36|0)+20|0;ne=de+(pe*136|0)+28+(se*36|0)+16|0;ie=de+(pe*136|0)+28+(se*36|0)|0;ae=de+(pe*136|0)+28+(se*36|0)+4|0;oe=de+(pe*136|0)+28+(se*36|0)+32|0;te=0;do{t=f[re>>2]|0;$=t+(te*40|0)+16|0;ee=t+(te*40|0)+20|0;if(ce(f[ee>>2]|0,f[$>>2]|0)|0){K=t+(te*40|0)+24|0;Q=0;do{r=f[K>>2]|0;G=f[ne>>2]|0;i=f[Re>>2]|0;t=f[Ae>>2]|0;W=f[_e>>2]|0;X=f[e>>2]|0;Y=r+(Q*56|0)+8|0;J=r+(Q*56|0)+12|0;if(!($o(e,(f[r+(Q*56|0)+16>>2]|0)-(f[Y>>2]|0)|0,(f[r+(Q*56|0)+20>>2]|0)-(f[J>>2]|0)|0)|0)){r=0;L=201;break e}q=r+(Q*56|0)+24|0;a=f[q>>2]|0;gs(X);ys(X,18,0,46);ys(X,17,0,3);ys(X,0,0,4);Z=r+(Q*56|0)+48|0;n=f[Z>>2]|0;if(n){U=r+(Q*56|0)+4|0;B=(t&1|0)!=0;z=(t&2|0)==0;j=(t&8|0)==0;V=G<<8;F=(t&32|0)==0;t=a+i|0;r=2;N=0;do{a=f[U>>2]|0;D=B&(r>>>0<2?(t|0)<=((f[q>>2]|0)+-4|0):0);i=f[a+(N<<5)>>2]|0;if(i){n=(f[i>>2]|0)+(f[a+(N<<5)+4>>2]|0)|0;i=f[a+(N<<5)+16>>2]|0;if(!D){if(!(ws(X,n,i)|0)){r=0;L=201;break e}}else Ms(W,n,i);O=a+(N<<5)+12|0;t:do{if(f[O>>2]|0){H=z|D;I=0;while(1){r:do{switch(r|0){case 0:{if(D){w=1<<t;w=w>>1|w;i=f[xe>>2]|0;if(!i)break r;E=0-w|0;n=f[we>>2]|0;b=0;while(1){_=b;b=b+4|0;if(!n)n=0;else{h=(_|0)==-4;v=_|3;y=0;do{n:do{if(!h)if(j){u=_;do{if(u>>>0>=(f[xe>>2]|0)>>>0)break n;s=u;u=u+1|0;n=(ce(f[ve>>2]|0,u)|0)+y|0;i=n+1|0;a=f[ge>>2]|0;o=a+(i<<1)|0;s=(ce(f[we>>2]|0,s)|0)+y|0;s=(f[Ee>>2]|0)+(s<<2)|0;l=f[_e>>2]|0;L=d[o>>1]|0;if((L&255|0)!=0&(L&20480|0)==0){if(Rs(l)|0){k=Rs(l)|0;f[s>>2]=(k|0)!=0?E:w;C=f[ve>>2]|0;L=a+(i-C<<1)|0;P=a+(C+i<<1)|0;A=a+(i+~C<<1)|0;d[A>>1]=m[A>>1]|2;d[L>>1]=d[L>>1]|d[3436+(k<<1)>>1];L=n+2|0;A=a+(L-C<<1)|0;d[A>>1]=m[A>>1]|4;A=a+(n<<1)|0;d[A>>1]=d[A>>1]|d[3436+(k+2<<1)>>1];d[o>>1]=m[o>>1]|4096;A=a+(L<<1)|0;d[A>>1]=d[A>>1]|d[3436+(k+4<<1)>>1];A=a+(C+n<<1)|0;d[A>>1]=m[A>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];L=a+(C+L<<1)|0;d[L>>1]=m[L>>1]|8}d[o>>1]=m[o>>1]|16384}}while(u>>>0<b>>>0)}else{c=_;do{n=f[xe>>2]|0;if(c>>>0>=n>>>0)break n;C=c;c=c+1|0;i=(ce(f[ve>>2]|0,c)|0)+y|0;a=i+1|0;o=f[ge>>2]|0;s=o+(a<<1)|0;l=(ce(f[we>>2]|0,C)|0)+y|0;l=(f[Ee>>2]|0)+(l<<2)|0;u=f[_e>>2]|0;L=d[s>>1]|0;L=(C|0)==(v|0)|(C|0)==(n+-1|0)?L&-1095:L;if((L&255|0)!=0&(L&20480|0)==0){if(Rs(u)|0){k=Rs(u)|0;f[l>>2]=(k|0)!=0?E:w;C=f[ve>>2]|0;L=o+(a-C<<1)|0;P=o+(C+a<<1)|0;A=o+(a+~C<<1)|0;d[A>>1]=m[A>>1]|2;d[L>>1]=d[L>>1]|d[3436+(k<<1)>>1];L=i+2|0;A=o+(L-C<<1)|0;d[A>>1]=m[A>>1]|4;A=o+(i<<1)|0;d[A>>1]=d[A>>1]|d[3436+(k+2<<1)>>1];d[s>>1]=m[s>>1]|4096;A=o+(L<<1)|0;d[A>>1]=d[A>>1]|d[3436+(k+4<<1)>>1];A=o+(C+i<<1)|0;d[A>>1]=m[A>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];L=o+(C+L<<1)|0;d[L>>1]=m[L>>1]|8}d[s>>1]=m[s>>1]|16384}}while(c>>>0<b>>>0)}}while(0);y=y+1|0;n=f[we>>2]|0}while(y>>>0<n>>>0);i=f[xe>>2]|0}if(b>>>0>=i>>>0){L=163;break r}}}if(j){a=f[Ee>>2]|0;o=(f[ge>>2]|0)+2|0;v=1<<t;v=v>>1|v;n=f[xe>>2]|0;i=f[we>>2]|0;if(n>>>0>3){u=i;l=0;while(1){if(!i){i=u;s=0}else{i=0;do{L=(f[ve>>2]|0)+i|0;es(e,o+(L<<1)|0,a+(i<<2)|0,G,v);n=(f[we>>2]|0)+i|0;L=(f[ve>>2]|0)+L|0;es(e,o+(L<<1)|0,a+(n<<2)|0,G,v);n=(f[we>>2]|0)+n|0;L=(f[ve>>2]|0)+L|0;es(e,o+(L<<1)|0,a+(n<<2)|0,G,v);es(e,o+((f[ve>>2]|0)+L<<1)|0,a+((f[we>>2]|0)+n<<2)|0,G,v);i=i+1|0;n=f[we>>2]|0}while(i>>>0<n>>>0);i=n;s=n;n=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=o+(f[ve>>2]<<2<<1)|0;l=l+4|0;if(l>>>0<(n&-4)>>>0){u=i;i=s}else{h=o;c=l;break}}}else{h=o;c=0}if(!i){L=163;break r}else u=0;while(1){if(c>>>0<n>>>0){o=a+(u<<2)|0;s=h+(u<<1)|0;l=c;while(1){s=s+(f[ve>>2]<<1)|0;es(e,s,o,G,v);i=f[we>>2]|0;l=l+1|0;n=f[xe>>2]|0;if(l>>>0>=n>>>0)break;else o=o+(i<<2)|0}}u=u+1|0;if(u>>>0>=i>>>0){L=163;break r}}}w=1<<t;w=w>>1|w;n=f[xe>>2]|0;if(!n){L=163;break r}x=0-w|0;i=f[we>>2]|0;o=i;E=0;while(1){b=E;E=E+4|0;do{if(!i){a=o;i=0}else{_=b|3;if((b|0)==-4){a=o;i=o;break}else y=0;do{v=b;do{n=f[xe>>2]|0;if(v>>>0>=n>>>0)break;L=v;v=v+1|0;o=(ce(f[ve>>2]|0,v)|0)+y|0;s=o+1|0;l=f[ge>>2]|0;u=l+(s<<1)|0;c=(ce(f[we>>2]|0,L)|0)+y|0;c=(f[Ee>>2]|0)+(c<<2)|0;h=f[e>>2]|0;i=d[u>>1]|0;n=(L|0)==(_|0)|(L|0)==(n+-1|0)?i&-1095:i;i=n&255;if((i|0)!=0&(n&20480|0)==0){a=h+100|0;f[a>>2]=h+24+(p[20267+(i|V)>>0]<<2);if(xs(h)|0){C=n>>>4&255;f[a>>2]=h+24+(p[21291+C>>0]<<2);L=xs(h)|0;C=p[21547+C>>0]|0;k=C^L;f[c>>2]=(L|0)!=(C|0)?x:w;C=f[ve>>2]|0;L=l+(s-C<<1)|0;P=l+(C+s<<1)|0;A=l+(s+~C<<1)|0;d[A>>1]=m[A>>1]|2;d[L>>1]=d[L>>1]|d[3436+(k<<1)>>1];L=o+2|0;A=l+(L-C<<1)|0;d[A>>1]=m[A>>1]|4;A=l+(o<<1)|0;d[A>>1]=d[A>>1]|d[3436+(k+2<<1)>>1];d[u>>1]=m[u>>1]|4096;A=l+(L<<1)|0;d[A>>1]=d[A>>1]|d[3436+(k+4<<1)>>1];A=l+(C+o<<1)|0;d[A>>1]=m[A>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];L=l+(C+L<<1)|0;d[L>>1]=m[L>>1]|8}d[u>>1]=m[u>>1]|16384}}while(v>>>0<E>>>0);y=y+1|0;n=f[we>>2]|0}while(y>>>0<n>>>0);a=n;i=n;n=f[xe>>2]|0}}while(0);if(E>>>0>=n>>>0){L=163;break}else o=a}break}case 1:{if(D){h=1<<t>>1;v=(t|0)>0?0-h|0:-1;i=f[xe>>2]|0;if(!i)break r;a=f[we>>2]|0;n=a;c=0;while(1){u=c;c=c+4|0;if(!a){o=n;a=0}else{l=(u|0)==-4;s=0;do{o=s;s=s+1|0;if(!l){a=u;do{if(a>>>0>=(f[xe>>2]|0)>>>0)break;i=a;a=a+1|0;n=(ce(f[ve>>2]|0,a)|0)+s|0;n=(f[ge>>2]|0)+(n<<1)|0;i=(ce(f[we>>2]|0,i)|0)+o|0;i=(f[Ee>>2]|0)+(i<<2)|0;if((d[n>>1]&20480)==4096){C=(Rs(f[_e>>2]|0)|0)!=0;C=C?h:v;L=f[i>>2]|0;f[i>>2]=((L|0)<0?0-C|0:C)+L;d[n>>1]=m[n>>1]|8192}}while(a>>>0<c>>>0);n=f[we>>2]|0}}while(s>>>0<n>>>0);o=n;a=n;i=f[xe>>2]|0}if(c>>>0>=i>>>0){L=163;break r}else n=o}}if(!j){_=1<<t>>1;b=(t|0)>0?0-_|0:-1;n=f[xe>>2]|0;if(!n){L=163;break r}i=f[we>>2]|0;a=i;y=0;while(1){v=y;y=y+4|0;if(!i)i=0;else{c=(v|0)==-4;h=v|3;n=a;u=0;do{l=u;u=u+1|0;if(!c){o=v;do{n=f[xe>>2]|0;if(o>>>0>=n>>>0)break;C=o;o=o+1|0;i=(ce(f[ve>>2]|0,o)|0)+u|0;i=(f[ge>>2]|0)+(i<<1)|0;a=(ce(f[we>>2]|0,C)|0)+l|0;a=(f[Ee>>2]|0)+(a<<2)|0;s=f[e>>2]|0;L=d[i>>1]|0;n=(C|0)==(h|0)|(C|0)==(n+-1|0)?L&-1095:L;if((n&20480|0)==4096){f[s+100>>2]=s+24+(((n&8192|0)!=0?16:(n&255|0)!=0?15:14)<<2);C=(xs(s)|0)!=0;C=C?_:b;L=f[a>>2]|0;f[a>>2]=((L|0)<0?0-C|0:C)+L;d[i>>1]=m[i>>1]|8192}}while(o>>>0<y>>>0);n=f[we>>2]|0}}while(u>>>0<n>>>0);a=n;i=n;n=f[xe>>2]|0}if(y>>>0>=n>>>0){L=163;break r}}}a=f[Ee>>2]|0;o=(f[ge>>2]|0)+2|0;E=1<<t>>1;w=(t|0)>0?0-E|0:-1;n=f[xe>>2]|0;i=f[we>>2]|0;if(n>>>0>3){l=i;_=o;b=0;while(1){if(!i){i=l;s=0}else{n=l;y=0;do{i=a+(y<<2)|0;l=f[ve>>2]|0;c=l+y|0;o=_+(c<<1)|0;u=f[e>>2]|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[u+100>>2]=u+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);l=(xs(u)|0)!=0;l=l?E:w;n=f[i>>2]|0;f[i>>2]=((n|0)<0?0-l|0:l)+n;d[o>>1]=m[o>>1]|8192;n=f[we>>2]|0;i=f[ve>>2]|0;l=f[e>>2]|0}else{i=l;l=u}h=n+y|0;u=a+(h<<2)|0;v=i+c|0;o=_+(v<<1)|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);i=(xs(l)|0)!=0;i=i?E:w;n=f[u>>2]|0;f[u>>2]=((n|0)<0?0-i|0:i)+n;d[o>>1]=m[o>>1]|8192;n=f[we>>2]|0;i=f[ve>>2]|0;l=f[e>>2]|0}c=n+h|0;u=a+(c<<2)|0;h=i+v|0;o=_+(h<<1)|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);i=(xs(l)|0)!=0;i=i?E:w;n=f[u>>2]|0;f[u>>2]=((n|0)<0?0-i|0:i)+n;d[o>>1]=m[o>>1]|8192;n=f[we>>2]|0;i=f[ve>>2]|0;l=f[e>>2]|0}s=a+(n+c<<2)|0;i=_+(i+h<<1)|0;o=d[i>>1]|0;if((o&20480|0)==4096){f[l+100>>2]=l+24+(((o&8192|0)!=0?16:(o&255|0)!=0?15:14)<<2);L=(xs(l)|0)!=0;L=L?E:w;n=f[s>>2]|0;f[s>>2]=((n|0)<0?0-L|0:L)+n;d[i>>1]=m[i>>1]|8192;n=f[we>>2]|0}y=y+1|0}while(y>>>0<n>>>0);i=n;s=n;n=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=_+(f[ve>>2]<<2<<1)|0;u=b+4|0;if(u>>>0<(n&-4)>>>0){l=i;i=s;_=o;b=u}else{y=u;break}}}else y=0;if(!i){L=163;break r}else v=0;do{if(y>>>0<n>>>0){u=a+(v<<2)|0;c=o+(v<<1)|0;h=y;while(1){c=c+(f[ve>>2]<<1)|0;l=f[e>>2]|0;s=d[c>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);n=(xs(l)|0)!=0;n=n?E:w;s=f[u>>2]|0;f[u>>2]=((s|0)<0?0-n|0:n)+s;d[c>>1]=m[c>>1]|8192;s=f[we>>2]|0;n=f[xe>>2]|0}else s=i;h=h+1|0;if(h>>>0>=n>>>0){i=s;break}else{i=s;u=u+(s<<2)|0}}}v=v+1|0}while(v>>>0<i>>>0);L=163;break}case 2:{P=f[e>>2]|0;C=1<<t;C=C>>1|C;do{if(j){a=f[Ee>>2]|0;o=(f[ge>>2]|0)+2|0;i=f[xe>>2]|0;if(i>>>0>3){w=P+92|0;x=P+100|0;T=P+96|0;S=0-C|0;s=f[we>>2]|0;n=s;u=0;while(1){if(!s)s=0;else{v=u|1;y=v+1|0;_=u|3;b=v+3|0;E=0;do{n=f[ve>>2]|0;i=E;E=E+1|0;A=(ce(n,v)|0)+E|0;R=f[ge>>2]|0;M=R+((ce(n,y)|0)+E<<1)|0;k=R+((ce(n,_)|0)+E<<1)|0;L=R+((ce(n,b)|0)+E<<1)|0;n:do{if(!((d[M>>1]|d[R+(A<<1)>>1]|d[k>>1]|d[L>>1])&20735)){f[x>>2]=w;if(!(xs(P)|0))break;f[x>>2]=T;c=(xs(P)|0)<<1;c=c|(xs(P)|0);if(c>>>0>=4)break;h=a+((ce(f[we>>2]|0,c)|0)+i<<2)|0;i=o+((ce(f[ve>>2]|0,c)|0)+i<<1)|0;l=c;while(1){if(l>>>0>=(f[xe>>2]|0)>>>0)break n;n=f[ve>>2]|0;s=i;i=i+(n<<1)|0;if((l|0)==(c|0)){L=f[e>>2]|0;k=(m[i>>1]|0)>>>4&255;f[L+100>>2]=L+24+(p[21291+k>>0]<<2);L=xs(L)|0;k=p[21547+k>>0]|0;R=k^L;f[h>>2]=(L|0)!=(k|0)?S:C;k=f[ve>>2]|0;L=s+(n-k<<1)|0;A=s+(k+n<<1)|0;M=s+(n+~k<<1)|0;d[M>>1]=m[M>>1]|2;d[L>>1]=d[L>>1]|d[3436+(R<<1)>>1];L=n+1|0;M=s+(L-k<<1)|0;d[M>>1]=m[M>>1]|4;M=n+-1|0;n=s+(M<<1)|0;d[n>>1]=d[n>>1]|d[3436+(R+2<<1)>>1];d[i>>1]=m[i>>1]|4096;n=s+(L<<1)|0;d[n>>1]=d[n>>1]|d[3436+(R+4<<1)>>1];M=s+(k+M<<1)|0;d[M>>1]=m[M>>1]|1;d[A>>1]=d[A>>1]|d[3436+(R+6<<1)>>1];L=s+(k+L<<1)|0;d[L>>1]=m[L>>1]|8;d[i>>1]=m[i>>1]&49151}else ts(e,i,h,G,C);l=l+1|0;if(l>>>0>=4)break;else h=h+(f[we>>2]<<2)|0}}else{k=n+i|0;ts(e,o+(k<<1)|0,a+(i<<2)|0,G,C);L=(f[we>>2]|0)+i|0;k=(f[ve>>2]|0)+k|0;ts(e,o+(k<<1)|0,a+(L<<2)|0,G,C);L=(f[we>>2]|0)+L|0;k=(f[ve>>2]|0)+k|0;ts(e,o+(k<<1)|0,a+(L<<2)|0,G,C);ts(e,o+((f[ve>>2]|0)+k<<1)|0,a+((f[we>>2]|0)+L<<2)|0,G,C)}}while(0);n=f[we>>2]|0}while(E>>>0<n>>>0);s=n;i=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=o+(f[ve>>2]<<2<<1)|0;u=u+4|0;if(u>>>0>=(i&-4)>>>0){h=a;c=o;break}}}else{n=f[we>>2]|0;h=a;c=o;u=0}if(!n)break;else l=0;do{if(u>>>0<i>>>0){a=h+(l<<2)|0;o=c+(l<<1)|0;s=u;while(1){o=o+(f[ve>>2]<<1)|0;ts(e,o,a,G,C);n=f[we>>2]|0;s=s+1|0;i=f[xe>>2]|0;if(s>>>0>=i>>>0)break;else a=a+(n<<2)|0}}l=l+1|0}while(l>>>0<n>>>0)}else{n=f[xe>>2]|0;if(!n)break;M=P+92|0;R=P+100|0;A=P+96|0;k=0-C|0;i=f[we>>2]|0;S=0;while(1){if(!i){a=S+4|0;i=0}else{E=S|3;w=S|1;x=w+1|0;T=w+3|0;a=S+4|0;b=0;while(1){do{if(E>>>0<n>>>0){n=f[ve>>2]|0;o=b+1|0;_=(ce(n,w)|0)+o|0;i=f[ge>>2]|0;if(d[i+(_<<1)>>1]&20735){_=0;n=0;L=127;break}_=i+((ce(n,x)|0)+o<<1)|0;if(d[_>>1]&20735){_=0;n=0;L=127;break}_=i+((ce(n,E)|0)+o<<1)|0;if(d[_>>1]&20735){_=0;n=0;L=127;break}_=i+((ce(n,T)|0)+o<<1)|0;if(d[_>>1]&20665){_=0;n=0;L=127;break}f[R>>2]=M;if(!(xs(P)|0))break;f[R>>2]=A;n=(xs(P)|0)<<1;_=1;n=n|(xs(P)|0);L=127}else{_=0;n=0;L=127}}while(0);if((L|0)==127){L=0;o=n+S|0;n:do{if(o>>>0<a>>>0){y=o;do{n=f[xe>>2]|0;if(y>>>0>=n>>>0)break n;ke=y;y=y+1|0;s=(ce(f[ve>>2]|0,y)|0)+b|0;l=s+1|0;u=f[ge>>2]|0;c=u+(l<<1)|0;h=(ce(f[we>>2]|0,ke)|0)+b|0;h=(f[Ee>>2]|0)+(h<<2)|0;v=f[e>>2]|0;i=d[c>>1]|0;i=(ke|0)==(E|0)|(ke|0)==(n+-1|0)?i&-1095:i;do{if(!(_&(ke|0)==(o|0))){if(i&20480)break;n=v+100|0;f[n>>2]=v+24+(p[20267+(i&255|V)>>0]<<2);if(xs(v)|0)L=133}else{n=v+100|0;L=133}}while(0);if((L|0)==133){L=0;i=i>>>4&255;f[n>>2]=v+24+(p[21291+i>>0]<<2);ke=xs(v)|0;v=p[21547+i>>0]|0;i=v^ke;f[h>>2]=(ke|0)!=(v|0)?k:C;v=f[ve>>2]|0;ke=u+(l-v<<1)|0;h=u+(v+l<<1)|0;l=u+(l+~v<<1)|0;d[l>>1]=m[l>>1]|2;d[ke>>1]=d[ke>>1]|d[3436+(i<<1)>>1];ke=s+2|0;l=u+(ke-v<<1)|0;d[l>>1]=m[l>>1]|4;l=u+(s<<1)|0;d[l>>1]=d[l>>1]|d[3436+(i+2<<1)>>1];d[c>>1]=m[c>>1]|4096;l=u+(ke<<1)|0;d[l>>1]=d[l>>1]|d[3436+(i+4<<1)>>1];l=u+(v+s<<1)|0;d[l>>1]=m[l>>1]|1;d[h>>1]=d[h>>1]|d[3436+(i+6<<1)>>1];ke=u+(v+ke<<1)|0;d[ke>>1]=m[ke>>1]|8}d[c>>1]=m[c>>1]&49151}while(y>>>0<a>>>0)}}while(0);o=b+1|0}i=f[we>>2]|0;n=f[xe>>2]|0;if(o>>>0<i>>>0)b=o;else break}}if(a>>>0<n>>>0)S=a;else break}}}while(0);if(F){L=163;break r}f[P+100>>2]=P+96;xs(P)|0;xs(P)|0;xs(P)|0;xs(P)|0;L=163;break}default:L=163}}while(0);do{if((L|0)==163){L=0;if(H)break;gs(X);ys(X,18,0,46);ys(X,17,0,3);ys(X,0,0,4)}}while(0);r=r+1|0;ke=(r|0)==3;t=(ke<<31>>31)+t|0;r=ke?0:r;I=I+1|0;if(I>>>0>=(f[O>>2]|0)>>>0)break t}}}while(0);n=f[Z>>2]|0}N=N+1|0}while(N>>>0<n>>>0)}r=(f[Y>>2]|0)-(f[ie>>2]|0)|0;t=(f[J>>2]|0)-(f[ae>>2]|0)|0;n=f[ne>>2]|0;if(n&1){ke=f[Me>>2]|0;r=(f[ke+(he*136|0)+8>>2]|0)+r-(f[ke+(he*136|0)>>2]|0)|0}if(n&2){ke=f[Me>>2]|0;t=(f[ke+(he*136|0)+12>>2]|0)+t-(f[ke+(he*136|0)+4>>2]|0)|0}c=f[Ee>>2]|0;h=f[we>>2]|0;v=f[xe>>2]|0;n=f[Re>>2]|0;if((n|0)!=0?(be=1<<n,(v|0)!=0):0){n=(h|0)==0;u=0;do{if(!n){i=ce(u,h)|0;l=0;do{a=c+(l+i<<2)|0;o=f[a>>2]|0;s=(o|0)>-1?o:0-o|0;if((s|0)>=(be|0)){ke=s>>f[Re>>2];f[a>>2]=(o|0)<0?0-ke|0:ke}l=l+1|0}while((l|0)!=(h|0))}u=u+1|0}while((u|0)!=(v|0))}l=(ce(t,Te)|0)+r|0;u=f[me>>2]|0;r=(v|0)==0;if((f[ye>>2]|0)==1){if(!r){r=(h|0)==0;a=0;do{if(!r){t=ce(a,h)|0;n=(ce(a,Te)|0)+l|0;i=0;do{f[u+(n+i<<2)>>2]=(f[c+(i+t<<2)>>2]|0)/2|0;i=i+1|0}while((i|0)!=(h|0))}a=a+1|0}while((a|0)!=(v|0))}}else if(!r){s=(h|0)==0;r=c;o=0;a=u+(l<<2)|0;while(1){if(!s){t=r;n=0;i=a;while(1){g[i>>2]=+(f[t>>2]|0)*+g[oe>>2];n=n+1|0;if((n|0)==(h|0))break;else{t=t+4|0;i=i+4|0}}r=r+(h<<2)|0}o=o+1|0;if((o|0)==(v|0))break;else a=a+(Te<<2)|0}}Q=Q+1|0}while(Q>>>0<(ce(f[ee>>2]|0,f[$>>2]|0)|0)>>>0);r=f[ue>>2]|0;n=f[le>>2]|0}te=te+1|0}while(te>>>0<(ce(r,n)|0)>>>0);t=f[fe>>2]|0}se=se+1|0}while(se>>>0<t>>>0);r=f[Se>>2]|0}pe=pe+1|0;if(pe>>>0>=r>>>0){r=1;L=201;break}}if((L|0)==201)return r|0;return 0}function Qo(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,v=0.0,_=0.0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,z=0,j=0,V=0,G=0,W=0.0,X=0,Y=0,q=0,Z=0,K=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0.0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ve=0,ge=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Se=0,Me=0,Re=0,Ae=0,ke=0,Pe=0,Ce=0,Le=0,Ie=0,Oe=0,He=0,De=0,Ne=0,Fe=0,Ue=0,Be=0,ze=0,je=0,Ve=0,Ge=0,We=0,Xe=0,Ye=0,qe=0,Ze=0,Je=0,Ke=0,Qe=0,$e=0;Je=t+32|0;y[Je>>3]=0.0;Ke=t+16|0;a=f[Ke>>2]|0;if(!a){Qe=1;return Qe|0}Ze=t+20|0;Ge=r+5584|0;We=e+16|0;Xe=e+20|0;Ye=e+8|0;qe=e+36|0;ze=(n|0)!=0;je=e+32|0;Ve=e+12|0;t=a;Be=0;e:while(1){r=f[Ze>>2]|0;a=f[Ge>>2]|0;Fe=(f[r+(Be*52|0)+8>>2]|0)-(f[r+(Be*52|0)>>2]|0)|0;Ue=r+(Be*52|0)+16|0;o=f[Ue>>2]|0;if(o){Ne=r+(Be*52|0)+24|0;He=r+(Be*52|0)+32|0;De=a+(Be*1080|0)+20|0;Le=a+(Be*1080|0)+16|0;Oe=ze&Be>>>0<i>>>0;Ie=n+(Be<<3)|0;t=o;Ce=0;do{ke=f[Ne>>2]|0;Pe=ke+(Ce*136|0)+24|0;r=f[Pe>>2]|0;if(r){Se=ke+(Ce*136|0)+16|0;Me=ke+(Ce*136|0)+20|0;Re=~Ce;Ae=Ce+-1|0;t=f[Me>>2]|0;a=f[Se>>2]|0;Te=0;do{xe=ke+(Ce*136|0)+28+(Te*36|0)+32|0;if(ce(t,a)|0){ge=67108864/(~~+J(+(+g[xe>>2]*8192.0))|0)|0;ye=ke+(Ce*136|0)+28+(Te*36|0)+20|0;_e=ke+(Ce*136|0)+28+(Te*36|0)|0;be=ke+(Ce*136|0)+28+(Te*36|0)+4|0;Ee=ke+(Ce*136|0)+28+(Te*36|0)+16|0;we=((ge|0)<0)<<31>>31;ve=0;do{r=f[ye>>2]|0;pe=r+(ve*40|0)+16|0;me=r+(ve*40|0)+20|0;if(ce(f[me>>2]|0,f[pe>>2]|0)|0){de=r+(ve*40|0)+24|0;fe=0;do{he=f[de>>2]|0;o=f[he+(fe*52|0)+12>>2]|0;t=o-(f[_e>>2]|0)|0;s=f[he+(fe*52|0)+16>>2]|0;r=s-(f[be>>2]|0)|0;a=f[Ee>>2]|0;if(a&1){ue=f[Ne>>2]|0;t=(f[ue+(Ae*136|0)+8>>2]|0)+t-(f[ue+(Ae*136|0)>>2]|0)|0}if(a&2){ue=f[Ne>>2]|0;r=(f[ue+(Ae*136|0)+12>>2]|0)+r-(f[ue+(Ae*136|0)+4>>2]|0)|0}if(!($o(e,(f[he+(fe*52|0)+20>>2]|0)-o|0,(f[he+(fe*52|0)+24>>2]|0)-s|0)|0)){t=0;Qe=173;break e}l=f[We>>2]|0;u=f[Xe>>2]|0;c=Fe-l|0;b=(ce(r,Fe)|0)+t|0;E=f[He>>2]|0;f[Ye>>2]=E+(b<<2);f[qe>>2]=Fe;t=(u|0)==0;if((f[De>>2]|0)==1){if(!t){o=(l|0)==0;s=0;t=0;while(1){if(!o){r=0;a=t;while(1){ue=E+(a+b<<2)|0;f[ue>>2]=f[ue>>2]<<6;r=r+1|0;if((r|0)==(l|0))break;else a=a+1|0}t=l+t|0}s=s+1|0;if((s|0)==(u|0))break;else t=t+c|0}}}else if(!t){o=(l|0)==0;s=0;t=0;while(1){if(!o){r=0;a=t;while(1){ue=E+(a+b<<2)|0;le=f[ue>>2]|0;le=Ql(le|0,((le|0)<0)<<31>>31|0,ge|0,we|0)|0;le=Wl(le|0,B|0,4096,0)|0;le=Xl(le|0,B|0,18)|0;f[ue>>2]=le;r=r+1|0;if((r|0)==(l|0))break;else a=a+1|0}t=l+t|0}s=s+1|0;if((s|0)==(u|0))break;else t=t+c|0}}ae=f[Ee>>2]|0;oe=(f[Ue>>2]|0)+Re|0;c=f[De>>2]|0;se=+g[xe>>2];le=f[Le>>2]|0;ue=f[e>>2]|0;o=f[We>>2]|0;do{if(!o)t=0;else{s=f[Xe>>2]|0;l=(s|0)==0;u=0;t=0;do{if(!l){r=f[qe>>2]|0;a=0;do{ie=E+(b+((ce(a,r)|0)+u)<<2)|0;ie=f[ie>>2]|0;ie=(ie|0)>-1?ie:0-ie|0;t=(t|0)>(ie|0)?t:ie;a=a+1|0}while((a|0)!=(s|0))}u=u+1|0}while((u|0)!=(o|0));if(!t){t=0;break}if((t|0)>1){r=t;t=0}else{t=-5;break}while(1){r=r>>1;if((r|0)<=1)break;else t=t+1|0}t=t+-4|0}}while(0);ne=he+(fe*52|0)+28|0;f[ne>>2]=t;t=t+-1|0;gs(ue);ys(ue,18,0,46);ys(ue,17,0,3);ys(ue,0,0,4);ie=he+(fe*52|0)|0;hs(ue,f[ie>>2]|0);t:do{if((t|0)>-1){te=he+(fe*52|0)+8|0;Y=le&1;re=(Y|0)!=0;q=(c|0)==1;Z=(le&4|0)==0;Y=(Y|0)==0;K=(le&2|0)==0;Q=(le&8|0)==0;$=ae<<8;ee=(le&32|0)==0;r=0;G=t;W=0.0;t=0;X=2;while(1){V=f[te>>2]|0;I=re&(X>>>0<2?(G|0)<((f[ne>>2]|0)+-4|0):0);r:do{switch(X|0){case 0:{C=1<<G+6;r=f[Xe>>2]|0;if(!r){o=0;break r}L=(G|0)==0;s=f[We>>2]|0;a=s;o=0;P=0;do{k=P;P=P+4|0;if(!a)a=0;else{R=(k|0)==-4;A=k|3;a=s;M=0;do{if(!R){S=k;do{r=f[Xe>>2]|0;if(S>>>0>=r>>>0)break;do{if(Q)r=0;else{if((S|0)==(A|0)){r=1;break}r=(S|0)==(r+-1|0)}}while(0);l=S;S=S+1|0;b=(ce(f[je>>2]|0,S)|0)+M|0;E=b+1|0;w=f[Ve>>2]|0;T=w+(E<<1)|0;l=(ce(f[qe>>2]|0,l)|0)+M|0;l=(f[Ye>>2]|0)+(l<<2)|0;x=f[e>>2]|0;u=d[T>>1]|0;u=r?u&-1095:u;r=u&255;if((r|0)!=0&(u&20480|0)==0){a=f[l>>2]|0;a=(((a|0)<0?0-a|0:a)&C|0)!=0;s=a&1;c=x+100|0;f[c>>2]=x+24+(p[20267+(r|$)>>0]<<2);if(I)ms(x,s);else ds(x,s);if(a){r=f[l>>2]|0;a=r>>>31;r=(r|0)<0?0-r|0:r;if(L)r=3708+((r&127)<<1)|0;else r=3452+((r>>>G&127)<<1)|0;o=(d[r>>1]|0)+o|0;r=u>>>4&255;f[c>>2]=x+24+(p[21291+r>>0]<<2);if(I)ms(x,a);else ds(x,p[21547+r>>0]^a);z=f[je>>2]|0;j=w+(E-z<<1)|0;U=w+(z+E<<1)|0;F=w+(E+~z<<1)|0;d[F>>1]=m[F>>1]|2;d[j>>1]=d[j>>1]|d[3436+(a<<1)>>1];j=b+2|0;F=w+(j-z<<1)|0;d[F>>1]=m[F>>1]|4;F=w+(b<<1)|0;d[F>>1]=d[F>>1]|d[3436+((a|2)<<1)>>1];d[T>>1]=m[T>>1]|4096;F=w+(j<<1)|0;d[F>>1]=d[F>>1]|d[3436+((a|4)<<1)>>1];F=w+(z+b<<1)|0;d[F>>1]=m[F>>1]|1;d[U>>1]=d[U>>1]|d[3436+((a|6)<<1)>>1];j=w+(z+j<<1)|0;d[j>>1]=m[j>>1]|8}d[T>>1]=m[T>>1]|16384}}while(S>>>0<P>>>0);a=f[We>>2]|0}M=M+1|0}while(M>>>0<a>>>0);r=f[Xe>>2]|0;s=a}}while(P>>>0<r>>>0);break}case 1:{M=1<<G+6;r=f[Xe>>2]|0;if(!r){o=0;break r}R=(G|0)==0;s=f[We>>2]|0;a=s;o=0;S=0;do{T=S;S=S+4|0;if(!a)a=0;else{w=(T|0)==-4;x=T|3;a=s;E=0;do{b=E;E=E+1|0;if(!w){c=T;do{r=f[Xe>>2]|0;if(c>>>0>=r>>>0)break;do{if(Q)r=0;else{if((c|0)==(x|0)){r=1;break}r=(c|0)==(r+-1|0)}}while(0);a=c;c=c+1|0;l=(ce(f[je>>2]|0,c)|0)+E|0;l=(f[Ve>>2]|0)+(l<<1)|0;u=f[e>>2]|0;s=d[l>>1]|0;s=r?s&-1095:s;if((s&20480|0)==4096){a=(f[Ye>>2]|0)+((ce(f[qe>>2]|0,a)|0)+b<<2)|0;a=f[a>>2]|0;a=(a|0)<0?0-a|0:a;if(R)r=4220+((a&127)<<1)|0;else r=3964+((a>>>G&127)<<1)|0;o=(d[r>>1]|0)+o|0;r=(a&M|0)!=0&1;f[u+100>>2]=u+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);if(I)ms(u,r);else ds(u,r);d[l>>1]=m[l>>1]|8192}}while(c>>>0<S>>>0);a=f[We>>2]|0}}while(E>>>0<a>>>0);r=f[Xe>>2]|0;s=a}}while(S>>>0<r>>>0);break}case 2:{D=f[e>>2]|0;N=1<<G+6;a=f[Xe>>2]|0;if(!a)r=0;else{F=D+92|0;U=D+100|0;z=D+96|0;j=(G|0)==0;o=f[We>>2]|0;r=0;H=0;while(1){if(!o){s=H+4|0;o=0}else{A=H|3;k=H|1;P=k+1|0;C=k+3|0;s=H+4|0;L=H+1|0;I=H+2|0;O=H+3|0;R=0;while(1){do{if(A>>>0<a>>>0){a=f[je>>2]|0;u=R+1|0;l=(ce(a,k)|0)+u|0;o=f[Ve>>2]|0;l=d[o+(l<<1)>>1]|0;if(Q){S=o+((ce(a,P)|0)+u<<1)|0;M=o+((ce(a,A)|0)+u<<1)|0;a=o+((ce(a,C)|0)+u<<1)|0;a=((d[S>>1]|l|d[M>>1]|d[a>>1])&20735)==0&1}else{do{if(!(l&20735)){M=o+((ce(a,P)|0)+u<<1)|0;if(d[M>>1]&20735){a=1;break}M=o+((ce(a,A)|0)+u<<1)|0;if(d[M>>1]&20735){a=1;break}a=o+((ce(a,C)|0)+u<<1)|0;a=(d[a>>1]&20665)!=0}else a=1}while(0);a=a&1^1}if(!a){M=0;a=0;Qe=109;break}a=f[qe>>2]|0;o=f[Ye>>2]|0;M=o+((ce(a,H)|0)+R<<2)|0;M=f[M>>2]|0;do{if(!(((M|0)<0?0-M|0:M)&N)){M=o+((ce(a,L)|0)+R<<2)|0;M=f[M>>2]|0;if(((M|0)<0?0-M|0:M)&N){a=1;break}M=o+((ce(a,I)|0)+R<<2)|0;M=f[M>>2]|0;if(((M|0)<0?0-M|0:M)&N){a=2;break}a=o+((ce(a,O)|0)+R<<2)|0;a=f[a>>2]|0;a=(((a|0)<0?0-a|0:a)&N|0)==0?4:3}else a=0}while(0);f[U>>2]=F;ds(D,(a|0)!=4&1);if((a|0)==4){l=u;break}f[U>>2]=z;ds(D,a>>>1);ds(D,a&1);M=1;Qe=109}else{M=0;a=0;Qe=109}}while(0);if((Qe|0)==109){Qe=0;S=a+H|0;n:do{if(S>>>0<s>>>0){T=S;do{a=f[Xe>>2]|0;if(T>>>0>=a>>>0)break n;do{if(Q)a=0;else{if((T|0)==(A|0)){a=1;break}a=(T|0)==(a+-1|0)}}while(0);$e=T;T=T+1|0;c=(ce(f[je>>2]|0,T)|0)+R|0;b=c+1|0;E=f[Ve>>2]|0;x=E+(b<<1)|0;o=(ce(f[qe>>2]|0,$e)|0)+R|0;o=(f[Ye>>2]|0)+(o<<2)|0;w=f[e>>2]|0;l=d[x>>1]|0;u=a?l&-1095:l;do{if(!(M&($e|0)==(S|0))){if(l&20480)break;f[w+100>>2]=w+24+(p[20267+(u&255|$)>>0]<<2);$e=f[o>>2]|0;$e=((($e|0)<0?0-$e|0:$e)&N|0)!=0;ds(w,$e&1);if($e)Qe=117}else Qe=117}while(0);if((Qe|0)==117){Qe=0;o=f[o>>2]|0;a=(o|0)<0?0-o|0:o;if(j)a=3708+((a&127)<<1)|0;else a=3452+((a>>>G&127)<<1)|0;r=(d[a>>1]|0)+r|0;$e=u>>>4&255;f[w+100>>2]=w+24+(p[21291+$e>>0]<<2);l=o>>>31;ds(w,p[21547+$e>>0]^l);w=f[je>>2]|0;$e=E+(b-w<<1)|0;u=E+(w+b<<1)|0;b=E+(b+~w<<1)|0;d[b>>1]=m[b>>1]|2;d[$e>>1]=d[$e>>1]|d[3436+(l<<1)>>1];$e=c+2|0;b=E+($e-w<<1)|0;d[b>>1]=m[b>>1]|4;b=E+(c<<1)|0;d[b>>1]=d[b>>1]|d[3436+((l|2)<<1)>>1];d[x>>1]=m[x>>1]|4096;b=E+($e<<1)|0;d[b>>1]=d[b>>1]|d[3436+((l|4)<<1)>>1];b=E+(w+c<<1)|0;d[b>>1]=m[b>>1]|1;d[u>>1]=d[u>>1]|d[3436+((l|6)<<1)>>1];$e=E+(w+$e<<1)|0;d[$e>>1]=m[$e>>1]|8}d[x>>1]=m[x>>1]&49151}while(T>>>0<s>>>0)}}while(0);l=R+1|0}o=f[We>>2]|0;a=f[Xe>>2]|0;if(l>>>0<o>>>0)R=l;else break}}if(s>>>0<a>>>0)H=s;else break}}if(ee){o=r;break r}Es(ue);o=r;break}default:o=r}}while(0);if(Oe)v=+y[Ie>>3];else v=1.0;if(q)_=+Ho(oe,ae);else _=+Fo(oe,ae);_=+(1<<G|0)*(se*(v*_));_=_*(+(o|0)*_*.0001220703125);W=W+_;y[Je>>3]=+y[Je>>3]+_;do{if(Z)Qe=137;else{if((G|0)<1&(X|0)==2){Qe=137;break}fs(ue);a=V+(t*24|0)+20|0;r=h[a>>0]|1;h[a>>0]=r;a=1}}while(0);do{if((Qe|0)==137){r=(f[ne>>2]|0)+-4|0;if((X|0)!=0&(G|0)<(r|0))if(Y)Qe=141;else Qe=140;else if(Y|((X|0)!=2|(G|0)!=(r|0)))Qe=141;else Qe=140;if((Qe|0)==140){Qe=0;fs(ue);a=V+(t*24|0)+20|0;r=h[a>>0]|1;h[a>>0]=r;a=1;break}else if((Qe|0)==141){Qe=0;a=V+(t*24|0)+20|0;r=h[a>>0]&-2;h[a>>0]=r;a=3;break}}}while(0);j=X+1|0;$e=(j|0)==3;X=$e?0:j;G=($e<<31>>31)+G|0;do{if((G|0)>0&(r&1)!=0)if(re&(X>>>0<2?(G|0)<((f[ne>>2]|0)+-4|0):0)){ps(ue);break}else{_s(ue);break}}while(0);y[V+(t*24|0)+8>>3]=W;$e=(cs(ue)|0)+a|0;f[V+(t*24|0)>>2]=$e;if(!K)vs(ue);t=t+1|0;if((G|0)<=-1)break t;else r=o}}else t=0}while(0);do{if(!(le&16)){if(le&1)break;fs(ue)}else bs(ue)}while(0);u=he+(fe*52|0)+48|0;f[u>>2]=t;if(t){o=he+(fe*52|0)+8|0;l=0;do{s=f[o>>2]|0;r=s+(l*24|0)|0;$e=f[r>>2]|0;if($e>>>0>(cs(ue)|0)>>>0){t=cs(ue)|0;f[r>>2]=t}else t=f[r>>2]|0;do{if(t>>>0>1){a=t+-1|0;if((h[(f[ie>>2]|0)+a>>0]|0)!=-1)break;f[r>>2]=a;t=a}}while(0);if(!l)r=0;else r=f[(f[o>>2]|0)+((l+-1|0)*24|0)>>2]|0;f[s+(l*24|0)+16>>2]=t-r;l=l+1|0}while(l>>>0<(f[u>>2]|0)>>>0)}fe=fe+1|0}while(fe>>>0<(ce(f[me>>2]|0,f[pe>>2]|0)|0)>>>0);t=f[Me>>2]|0;a=f[Se>>2]|0}ve=ve+1|0}while(ve>>>0<(ce(t,a)|0)>>>0);r=f[Pe>>2]|0}Te=Te+1|0}while(Te>>>0<r>>>0);t=f[Ue>>2]|0}Ce=Ce+1|0}while(Ce>>>0<t>>>0);t=f[Ke>>2]|0}Be=Be+1|0;if(Be>>>0>=t>>>0){t=1;Qe=173;break}}if((Qe|0)==173)return t|0;return 0}function $o(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;a=ce(r,t)|0;if(!(f[e+40>>2]|0)){o=e+24|0;s=e+8|0;n=f[s>>2]|0;do{if(a>>>0>(f[o>>2]|0)>>>0){Ji(n);i=a<<2;n=Zi(i)|0;f[s>>2]=n;if(!n){t=0;return t|0}else{f[o>>2]=a;break}}else i=a<<2}while(0);Vl(n|0,0,i|0)|0}a=t+2|0;f[e+32>>2]=a;a=ce(r+2|0,a)|0;o=e+28|0;s=e+12|0;n=f[s>>2]|0;do{if(a>>>0>(f[o>>2]|0)>>>0){Ji(n);i=a<<1;n=Zi(i)|0;f[s>>2]=n;if(!n){t=0;return t|0}else{f[o>>2]=a;break}}else i=a<<1}while(0);Vl(n|0,0,i|0)|0;f[e+16>>2]=t;f[e+20>>2]=r;t=1;return t|0}function es(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0;a=f[e>>2]|0;s=d[t>>1]|0;l=s&255;if(!((l|0)!=0&(s&20480|0)==0))return;o=a+100|0;f[o>>2]=a+24+(p[20267+(l|n<<8)>>0]<<2);if(xs(a)|0){n=s>>>4&255;f[o>>2]=a+24+(p[21291+n>>0]<<2);s=xs(a)|0;n=p[21547+n>>0]|0;l=n^s;f[r>>2]=(s|0)!=(n|0)?0-i|0:i;e=f[e+32>>2]|0;i=t+(0-e<<1)|0;n=t+(e<<1)|0;r=t+(~e<<1)|0;d[r>>1]=m[r>>1]|2;d[i>>1]=d[i>>1]|d[3436+(l<<1)>>1];i=t+(1-e<<1)|0;d[i>>1]=m[i>>1]|4;i=t+-2|0;d[i>>1]=d[i>>1]|d[3436+(l+2<<1)>>1];d[t>>1]=m[t>>1]|4096;i=t+2|0;d[i>>1]=d[i>>1]|d[3436+(l+4<<1)>>1];i=t+(e+-1<<1)|0;d[i>>1]=m[i>>1]|1;d[n>>1]=d[n>>1]|d[3436+(l+6<<1)>>1];e=t+(e+1<<1)|0;d[e>>1]=m[e>>1]|8}d[t>>1]=m[t>>1]|16384;return}function ts(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;a=f[e>>2]|0;s=d[t>>1]|0;if(s&20480){e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}o=a+100|0;f[o>>2]=a+24+(p[20267+(s&255|n<<8)>>0]<<2);if(!(xs(a)|0)){e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}n=s>>>4&255;f[o>>2]=a+24+(p[21291+n>>0]<<2);o=xs(a)|0;n=p[21547+n>>0]|0;s=n^o;f[r>>2]=(o|0)!=(n|0)?0-i|0:i;e=f[e+32>>2]|0;i=t+(0-e<<1)|0;n=t+(e<<1)|0;r=t+(~e<<1)|0;d[r>>1]=m[r>>1]|2;d[i>>1]=d[i>>1]|d[3436+(s<<1)>>1];i=t+(1-e<<1)|0;d[i>>1]=m[i>>1]|4;i=t+-2|0;d[i>>1]=d[i>>1]|d[3436+(s+2<<1)>>1];d[t>>1]=m[t>>1]|4096;i=t+2|0;d[i>>1]=d[i>>1]|d[3436+(s+4<<1)>>1];i=t+(e+-1<<1)|0;d[i>>1]=m[i>>1]|1;d[n>>1]=d[n>>1]|d[3436+(s+6<<1)>>1];e=t+(e+1<<1)|0;d[e>>1]=m[e>>1]|8;e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}function rs(e,t,r,n,i,a,o,s,l,u,c,h){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;h=h|0;var m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0;I=b;b=b+16|0;L=I;f[L>>2]=0;m=f[e>>2]|0;A=f[e+4>>2]|0;e=f[A+76>>2]|0;P=e+(t*5640|0)|0;g=(d[A>>1]|0)==4?2:1;y=A+80|0;if(!(f[y>>2]|0))v=1;else v=f[m+16>>2]|0;C=(f[e+(t*5640|0)+420>>2]|0)+1|0;k=Lr(m,A,t,h)|0;if(!k){t=0;b=I;return t|0}f[a>>2]=0;e:do{if(!h){if(v){e=0;t:while(1){h=0;c=k;m=0;while(1){Ir(k,A,t,m,e,u,0);if((f[c+80>>2]|0)==-1){e=9;break t}l=c+36|0;r:while(1){do{if(!(Hr(c)|0))break r}while((f[l>>2]|0)>>>0>=n>>>0);f[L>>2]=0;if(!(os(t,r,P,c,i,L,o,s)|0)){e=13;break t}R=f[L>>2]|0;f[a>>2]=(f[a>>2]|0)+R;o=o-R|0;h=R+h|0;i=i+R|0}R=f[y>>2]|0;if((R|0)!=0&h>>>0>R>>>0){e=17;break t}m=m+1|0;if(m>>>0<g>>>0)c=c+232|0;else break}e=e+1|0;if(e>>>0>=v>>>0)break e}if((e|0)==9){Cr(k,C);t=0;b=I;return t|0}else if((e|0)==13){Cr(k,C);t=0;b=I;return t|0}else if((e|0)==17){Cr(k,C);t=0;b=I;return t|0}}}else{Ir(k,A,t,c,l,u,h);S=k+(c*232|0)|0;if((f[k+(c*232|0)+80>>2]|0)==-1){Cr(k,C);t=0;b=I;return t|0}u=k+(c*232|0)+36|0;_=(s|0)==0;E=r+840|0;w=s+12|0;x=s+8|0;T=s+88|0;y=A+93|0;g=e+(t*5640|0)+5636|0;while(1){do{if(!(Hr(S)|0))break e}while((f[u>>2]|0)>>>0>=n>>>0);f[L>>2]=0;if(!(os(t,r,P,S,i,L,o,s)|0))break;v=f[L>>2]|0;i=i+v|0;o=o-v|0;f[a>>2]=(f[a>>2]|0)+v;if(!_){if(!(f[w>>2]|0))e=f[x>>2]|0;else{m=f[T>>2]|0;e=f[x>>2]|0;c=f[m+(t*592|0)+548>>2]|0;h=c+(e<<5)|0;if(!e){l=(f[m+(t*592|0)+12>>2]|0)+1|0;m=((l|0)<0)<<31>>31;A=h;f[A>>2]=l;f[A+4>>2]=m}else{if((((p[g>>0]|0)>>>2|(p[y>>0]|0)>>>3)&1)!=0?(R=h,M=f[R>>2]|0,R=f[R+4>>2]|0,!((M|0)==0&(R|0)==0)):0){l=M;m=R}else{l=c+(e+-1<<5)+16|0;l=Wl(f[l>>2]|0,f[l+4>>2]|0,1,0)|0;m=B}A=h;f[A>>2]=l;f[A+4>>2]=m}h=Wl(l|0,m|0,-1,-1)|0;l=B;v=Wl(h|0,l|0,v|0,0)|0;A=c+(e<<5)+16|0;f[A>>2]=v;f[A+4>>2]=B;A=c+(e<<5)+8|0;v=A;v=Wl(h|0,l|0,f[v>>2]|0,f[v+4>>2]|0)|0;f[A>>2]=v;f[A+4>>2]=B}f[x>>2]=e+1}f[E>>2]=(f[E>>2]|0)+1}Cr(k,C);t=0;b=I;return t|0}}while(0);Cr(k,C);t=1;b=I;return t|0}function ns(e,t,r,n,i,a,o,s){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;var l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,J=0,K=0,Q=0,$=0;Q=b;b=b+112|0;q=Q+64|0;Z=Q+32|0;G=Q;V=Q+96|0;j=Q+92|0;l=f[e>>2]|0;F=e+4|0;K=f[F>>2]|0;o=f[K+76>>2]|0;B=o+(t*5640|0)|0;z=o+(t*5640|0)+420|0;J=(f[z>>2]|0)+1|0;K=Pr(l,K,t)|0;if(!K){$=0;b=Q;return $|0}U=l+16|0;N=o+(t*5640|0)+12|0;D=r+20|0;H=l+24|0;t=a;e=n;I=K;O=0;e:while(1){if((f[I+80>>2]|0)==-1){$=4;break}o=Yi(f[U>>2]<<2)|0;if(!o){$=6;break}Vl(o|0,1,f[U>>2]<<2|0)|0;if(Hr(I)|0){a=I+24|0;r=I+28|0;L=I+36|0;l=I+32|0;C=t;P=e;while(1){if((f[N>>2]|0)>>>0>(f[L>>2]|0)>>>0){t=f[a>>2]|0;e=f[D>>2]|0;if((f[r>>2]|0)>>>0<(f[e+(t*52|0)+20>>2]|0)>>>0){f[o+(t<<2)>>2]=0;k=f[F>>2]|0;f[j>>2]=0;if(!(ss(k,e,B,I,V,P,j,C,s)|0)){$=45;break e}A=f[j>>2]|0;if(!(f[V>>2]|0))e=A;else{R=C-A|0;S=P+A|0;f[j>>2]=0;t=f[r>>2]|0;u=f[(f[D>>2]|0)+((f[a>>2]|0)*52|0)+24>>2]|0;x=u+(t*136|0)+24|0;e=f[x>>2]|0;t:do{if(!e){e=S;$=43}else{T=P+C|0;c=e;k=0;w=u+(t*136|0)+28|0;u=S;r:while(1){e=f[l>>2]|0;t=f[w+20>>2]|0;if(((f[w+8>>2]|0)!=(f[w>>2]|0)?(f[w+12>>2]|0)!=(f[w+4>>2]|0):0)?(Y=ce(f[t+(e*40|0)+20>>2]|0,f[t+(e*40|0)+16>>2]|0)|0,(Y|0)!=0):0){M=0;e=f[t+(e*40|0)+24>>2]|0;p=u;while(1){_=e+40|0;if(!(f[_>>2]|0))t=p;else{E=e+44|0;t=f[E>>2]|0;do{if(!t){d=f[e+4>>2]|0;f[E>>2]=1;f[e+36>>2]=0}else{u=t+-1|0;c=f[e+4>>2]|0;if((f[c+(u<<5)+8>>2]|0)!=(f[c+(u<<5)+20>>2]|0)){d=c+(u<<5)|0;break}f[E>>2]=t+1;d=c+(t<<5)|0}}while(0);y=e+36|0;t=e+32|0;g=p;h=d+28|0;u=f[h>>2]|0;if((u+g|0)>>>0<g>>>0|(p+u|0)>>>0>T>>>0){t=k;e=M;break r}c=f[y>>2]|0;g=p;v=d;while(1){d=u+c|0;if(d>>>0<c>>>0){t=k;e=M;$=29;break e}p=f[e>>2]|0;if(d>>>0>(f[t>>2]|0)>>>0){u=Ki(p,d)|0;if(!u){$=32;break e}c=f[y>>2]|0;m=f[h>>2]|0;f[t>>2]=m+c;f[e>>2]=u;p=u;u=m}Yl(p+c|0,g|0,u|0)|0;u=v+8|0;c=f[u>>2]|0;if(!c){f[v>>2]=e;d=f[y>>2]|0;f[v+4>>2]=d}else d=f[y>>2]|0;p=f[h>>2]|0;m=g;g=g+p|0;h=f[v+24>>2]|0;c=h+c|0;f[u>>2]=c;u=f[_>>2]|0;f[_>>2]=u-h;f[v+12>>2]=c;c=p+d|0;f[y>>2]=c;d=v+16|0;f[d>>2]=(f[d>>2]|0)+p;if((u|0)==(h|0)){t=g;break}f[E>>2]=(f[E>>2]|0)+1;d=g;h=v+60|0;u=f[h>>2]|0;if((u+d|0)>>>0<d>>>0?1:(m+(u+p)|0)>>>0>T>>>0){t=k;e=M;break r}else v=v+32|0}f[e+48>>2]=f[E>>2]}M=M+1|0;if(M>>>0>=Y>>>0){e=t;break}else{e=e+56|0;p=t}}t=f[x>>2]|0}else{t=c;e=u}k=k+1|0;if(k>>>0>=t>>>0){$=43;break t}else{c=t;w=w+36|0;u=e}}S=f[l>>2]|0;M=f[r>>2]|0;k=f[a>>2]|0;f[G>>2]=u;f[G+4>>2]=R;f[G+8>>2]=e;f[G+12>>2]=S;f[G+16>>2]=t;f[G+20>>2]=M;f[G+24>>2]=k;Qn(s,2,21803,G)|0;e=f[j>>2]|0}}while(0);if(($|0)==43){$=0;e=e-S|0;f[j>>2]=e}e=e+A|0}u=f[a>>2]|0;A=f[r>>2]|0;t=(f[H>>2]|0)+(u*52|0)+36|0;k=f[t>>2]|0;f[t>>2]=A>>>0>k>>>0?A:k;t=e}else $=47}else{e=f[D>>2]|0;$=47}if(($|0)==47){$=0;k=f[F>>2]|0;f[j>>2]=0;if(!(ss(k,e,B,I,V,P,j,C,s)|0)){$=69;break e}_=f[j>>2]|0;if(!(f[V>>2]|0))e=_;else{u=C-_|0;w=f[r>>2]|0;x=f[a>>2]|0;e=f[(f[D>>2]|0)+(x*52|0)+24>>2]|0;f[j>>2]=0;y=f[e+(w*136|0)+24>>2]|0;if(!y)e=0;else{E=f[l>>2]|0;t=0;g=e+(w*136|0)+28|0;while(1){c=f[g+20>>2]|0;if(((f[g+8>>2]|0)!=(f[g>>2]|0)?(f[g+12>>2]|0)!=(f[g+4>>2]|0):0)?(W=ce(f[c+(E*40|0)+20>>2]|0,f[c+(E*40|0)+16>>2]|0)|0,(W|0)!=0):0){e=0;v=f[c+(E*40|0)+24>>2]|0;while(1){p=v+40|0;t:do{if(f[p>>2]|0){m=v+44|0;c=f[m>>2]|0;do{if(!c){d=f[v+4>>2]|0;f[m>>2]=1;f[v+36>>2]=0}else{h=c+-1|0;d=f[v+4>>2]|0;if((f[d+(h<<5)+8>>2]|0)!=(f[d+(h<<5)+20>>2]|0)){d=d+(h<<5)|0;break}f[m>>2]=c+1;d=d+(c<<5)|0}}while(0);k=f[j>>2]|0;c=f[d+28>>2]|0;h=c+k|0;if(h>>>0<k>>>0|h>>>0>u>>>0){a=E;r=w;l=x;$=65;break e}while(1){f[j>>2]=h;k=f[d+24>>2]|0;A=d+8|0;f[A>>2]=(f[A>>2]|0)+k;A=f[p>>2]|0;f[p>>2]=A-k;if((A|0)==(k|0))break t;f[m>>2]=(f[m>>2]|0)+1;k=f[j>>2]|0;c=f[d+60>>2]|0;h=c+k|0;if(h>>>0<k>>>0|h>>>0>u>>>0){a=E;r=w;l=x;$=65;break e}else d=d+32|0}}}while(0);e=e+1|0;if(e>>>0>=W>>>0)break;else v=v+56|0}}t=t+1|0;if(t>>>0>=y>>>0)break;else g=g+36|0}e=f[j>>2]|0}e=e+_|0}u=f[a>>2]|0;t=e}if((f[o+(u<<2)>>2]|0)!=0?(X=(f[H>>2]|0)+(u*52|0)+36|0,(f[X>>2]|0)==0):0)f[X>>2]=(f[(f[D>>2]|0)+(u*52|0)+20>>2]|0)+-1;e=P+t|0;t=C-t|0;if(!(Hr(I)|0))break;else{C=t;P=e}}}Qi(o);O=O+1|0;if(O>>>0>(f[z>>2]|0)>>>0){o=e;$=75;break}else I=I+232|0}if(($|0)==4){Cr(K,J);$=0;b=Q;return $|0}else if(($|0)==6){Cr(K,J);$=0;b=Q;return $|0}else if(($|0)==29){i=f[l>>2]|0;n=f[r>>2]|0;q=f[a>>2]|0;f[Z>>2]=u;f[Z+4>>2]=c;f[Z+8>>2]=~u;f[Z+12>>2]=e;f[Z+16>>2]=i;f[Z+20>>2]=t;f[Z+24>>2]=n;f[Z+28>>2]=q;Qn(s,1,21888,Z)|0;$=45}else if(($|0)==32){Qi(f[e>>2]|0);f[e>>2]=0;f[t>>2]=0;$=45}else if(($|0)==65){f[q>>2]=c;f[q+4>>2]=u;f[q+8>>2]=e;f[q+12>>2]=a;f[q+16>>2]=t;f[q+20>>2]=r;f[q+24>>2]=l;Qn(s,1,21987,q)|0;$=69}else if(($|0)==75){Cr(K,J);f[i>>2]=o-n;$=1;b=Q;return $|0}if(($|0)==45){Cr(K,J);Qi(o);$=0;b=Q;return $|0}else if(($|0)==69){Cr(K,J);Qi(o);$=0;b=Q;return $|0}return 0}function is(e,t){e=e|0;t=t|0;var r=0;r=qi(1,8)|0;if(!r){e=0;return e|0}f[r>>2]=e;f[r+4>>2]=t;e=r;return e|0}function as(e){e=e|0;if(!e)return;Qi(e);return}function os(e,t,r,n,i,a,o,s){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;var l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0.0,H=0,D=0;g=f[n+28>>2]|0;H=f[n+32>>2]|0;D=f[n+36>>2]|0;v=f[(f[t+20>>2]|0)+((f[n+24>>2]|0)*52|0)+24>>2]|0;if(!(f[r>>2]&2))L=i;else{h[i>>0]=-1;h[i+1>>0]=-111;h[i+2>>0]=0;h[i+3>>0]=4;L=t+840|0;h[i+4>>0]=(f[L>>2]|0)>>>8;h[i+5>>0]=f[L>>2];o=o+-6|0;L=i+6|0}if((D|0)==0?(m=v+(g*136|0)+24|0,(f[m>>2]|0)!=0):0){d=v+(g*136|0)+28|0;p=0;while(1){n=f[d+20>>2]|0;on(f[n+(H*40|0)+32>>2]|0);u=n+(H*40|0)+36|0;on(f[u>>2]|0);c=ce(f[n+(H*40|0)+20>>2]|0,f[n+(H*40|0)+16>>2]|0)|0;if(c){n=n+(H*40|0)+24|0;t=d+28|0;l=0;do{I=f[n>>2]|0;f[I+(l*52|0)+40>>2]=0;po(f[u>>2]|0,l,(f[t>>2]|0)-(f[I+(l*52|0)+28>>2]|0)|0);l=l+1|0}while((l|0)!=(c|0))}p=p+1|0;if(p>>>0>=(f[m>>2]|0)>>>0)break;else d=d+36|0}}P=xo()|0;if(!P){a=0;return a|0}Mo(P,L,o);Ao(P,1,1);C=v+(g*136|0)+28|0;I=v+(g*136|0)+24|0;if(f[I>>2]|0){M=D+1|0;A=C;k=0;while(1){c=f[A+20>>2]|0;R=ce(f[c+(H*40|0)+20>>2]|0,f[c+(H*40|0)+16>>2]|0)|0;d=c+(H*40|0)+24|0;n=(R|0)==0;if(!n){t=c+(H*40|0)+32|0;l=f[d>>2]|0;u=0;while(1){if((f[l+40>>2]|0)==0?(f[(f[l+4>>2]|0)+(D*24|0)>>2]|0)!=0:0)po(f[t>>2]|0,u,D);u=u+1|0;if((u|0)==(R|0))break;else l=l+52|0}if(!n){S=c+(H*40|0)+32|0;T=c+(H*40|0)+36|0;w=f[d>>2]|0;x=0;while(1){n=(f[w+4>>2]|0)+(D*24|0)|0;E=w+40|0;if(!(f[E>>2]|0))mo(P,f[S>>2]|0,x,M);else Ao(P,(f[n>>2]|0)!=0&1,1);t=f[n>>2]|0;if(t){if(!(f[E>>2]|0)){f[w+32>>2]=3;mo(P,f[T>>2]|0,x,999);t=f[n>>2]|0}e:do{switch(t|0){case 1:{Ao(P,0,1);break}case 2:{Ao(P,2,2);break}default:{if(t>>>0<6){Ao(P,t+-3|12,4);break e}if(t>>>0<37){Ao(P,t+-6|480,9);break e}if(t>>>0<165)Ao(P,t+-37|65408,16)}}}while(0);d=f[E>>2]|0;t=f[n>>2]|0;b=t+d|0;_=w+8|0;if(d>>>0<b>>>0){g=w+32|0;m=d+-1+t|0;u=0;c=0;l=0;v=(f[_>>2]|0)+(d*24|0)|0;while(1){l=l+1|0;c=(f[v+16>>2]|0)+c|0;if((h[v+20>>0]&1)!=0|(d|0)==(m|0)){if((c|0)>1){t=0;do{c=c>>1;t=t+1|0}while((c|0)>1)}else t=0;p=f[g>>2]|0;if((l|0)>1){c=0;do{l=l>>1;c=c+1|0}while((l|0)>1);l=c}else l=0;c=t+1-p-l|0;u=(u|0)>(c|0)?u:c;c=0;l=0}d=d+1|0;if((d|0)==(b|0))break;else v=v+24|0}if((u|0)>0){t=u;while(1){Ao(P,1,1);if((t|0)>1)t=t+-1|0;else{t=c;break}}}else t=c}else{u=0;t=0;l=0}Ao(P,0,1);m=w+32|0;f[m>>2]=(f[m>>2]|0)+u;u=f[E>>2]|0;if(u>>>0<b>>>0){p=(f[_>>2]|0)+(u*24|0)|0;while(1){l=l+1|0;c=(f[p+16>>2]|0)+t|0;if((h[p+20>>0]&1)==0?(u|0)!=((f[E>>2]|0)+-1+(f[n>>2]|0)|0):0)t=c;else{d=f[m>>2]|0;if((l|0)>1){t=0;do{l=l>>1;t=t+1|0}while((l|0)>1)}else t=0;Ao(P,c,t+d|0);t=0;l=0}u=u+1|0;if((u|0)==(b|0))break;else p=p+24|0}}}x=x+1|0;if((x|0)==(R|0))break;else w=w+52|0}}}k=k+1|0;if(k>>>0>=(f[I>>2]|0)>>>0)break;else A=A+36|0}}if(!(Po(P)|0)){To(P);a=0;return a|0}t=So(P)|0;n=L+t|0;o=o-t|0;To(P);if(f[r>>2]&4){h[n>>0]=-1;h[L+(t+1)>>0]=-110;o=o+-2|0;n=L+(t+2)|0}_=(s|0)!=0;if(_?(f[s+12>>2]|0)!=0:0){L=n-i|0;r=(f[(f[s+88>>2]|0)+(e*592|0)+548>>2]|0)+(f[s+8>>2]<<5)+8|0;f[r>>2]=L;f[r+4>>2]=((L|0)<0)<<31>>31}t=f[I>>2]|0;e:do{if(t){b=s+12|0;E=s+8|0;w=s+88|0;v=C;g=0;t:while(1){l=f[v+20>>2]|0;m=ce(f[l+(H*40|0)+20>>2]|0,f[l+(H*40|0)+16>>2]|0)|0;l=f[l+(H*40|0)+24>>2]|0;if(m){if(_){p=0;while(1){d=f[l+4>>2]|0;t=d+(D*24|0)|0;if(f[t>>2]|0){u=d+(D*24|0)+4|0;c=f[u>>2]|0;if(c>>>0>o>>>0){n=0;o=81;break t}Yl(n|0,f[d+(D*24|0)+16>>2]|0,c|0)|0;r=l+40|0;f[r>>2]=(f[r>>2]|0)+(f[t>>2]|0);r=f[u>>2]|0;n=n+r|0;o=o-r|0;if((f[b>>2]|0)!=0?(r=(f[(f[w>>2]|0)+(e*592|0)+548>>2]|0)+(f[E>>2]<<5)+24|0,O=+y[d+(D*24|0)+8>>3]+ +y[r>>3],y[r>>3]=O,+y[s>>3]<O):0)y[s>>3]=O}p=p+1|0;if(p>>>0>=m>>>0)break;else l=l+52|0}}else{p=0;while(1){t=f[l+4>>2]|0;u=t+(D*24|0)|0;if(f[u>>2]|0){c=t+(D*24|0)+4|0;d=f[c>>2]|0;if(d>>>0>o>>>0){n=0;o=81;break t}Yl(n|0,f[t+(D*24|0)+16>>2]|0,d|0)|0;r=l+40|0;f[r>>2]=(f[r>>2]|0)+(f[u>>2]|0);r=f[c>>2]|0;o=o-r|0;n=n+r|0}p=p+1|0;if(p>>>0>=m>>>0)break;else l=l+52|0}}t=f[I>>2]|0}g=g+1|0;if(g>>>0>=t>>>0)break e;else v=v+36|0}if((o|0)==81)return n|0}}while(0);f[a>>2]=n-i+(f[a>>2]|0);a=1;return a|0}function ss(e,t,r,n,i,a,o,s,l){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;var u=0,c=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0;U=b;b=b+64|0;N=U+40|0;D=U+32|0;x=U+24|0;w=U+16|0;_=U+8|0;y=U;E=U+48|0;F=U+44|0;f[F>>2]=a;S=f[n+28>>2]|0;H=n+24|0;T=f[t+((f[H>>2]|0)*52|0)+24>>2]|0;I=n+36|0;if((f[I>>2]|0)==0?(g=T+(S*136|0)+24|0,u=f[g>>2]|0,(u|0)!=0):0){v=n+32|0;p=0;m=T+(S*136|0)+28|0;while(1){t=f[v>>2]|0;c=f[m+20>>2]|0;if((f[m+8>>2]|0)!=(f[m>>2]|0)?(f[m+12>>2]|0)!=(f[m+4>>2]|0):0){on(f[c+(t*40|0)+32>>2]|0);on(f[c+(t*40|0)+36>>2]|0);u=ce(f[c+(t*40|0)+20>>2]|0,f[c+(t*40|0)+16>>2]|0)|0;if(u){d=0;t=f[c+(t*40|0)+24>>2]|0;while(1){f[t+44>>2]=0;f[t+48>>2]=0;d=d+1|0;if((d|0)==(u|0))break;else t=t+56|0}}u=f[g>>2]|0}p=p+1|0;if(p>>>0>=u>>>0)break;else m=m+36|0}}do{if(f[r>>2]&2){if(s>>>0<6){Qn(l,2,22072,y)|0;break}t=f[F>>2]|0;if((h[t>>0]|0)==-1?(h[t+1>>0]|0)==-111:0){f[F>>2]=t+6;break}Qn(l,2,22114,_)|0}}while(0);L=xo()|0;if(!L){a=0;b=U;return a|0}do{if(!(h[e+96>>0]&1))if(!(h[r+5636>>0]&2)){P=f[F>>2]|0;f[E>>2]=a+s-P;C=F;break}else{C=r+5168|0;P=f[C>>2]|0;E=r+5180|0;break}else{C=e+40|0;P=f[C>>2]|0;E=e+44|0}}while(0);Ro(L,P,f[E>>2]|0);if(!(ko(L,1)|0)){Co(L)|0;u=So(L)|0;t=P+u|0;To(L);do{if(f[r>>2]&4){if(((f[E>>2]|0)-t+(f[C>>2]|0)|0)>>>0<2){Qn(l,2,22135,w)|0;break}if((h[t>>0]|0)==-1?(h[P+(u+1)>>0]|0)==-110:0){t=P+(u+2)|0;break}Qn(l,2,22177,x)|0}}while(0);f[E>>2]=(f[E>>2]|0)+((f[C>>2]|0)-t);f[C>>2]=t;f[i>>2]=0;f[o>>2]=(f[F>>2]|0)-a;a=1;b=U;return a|0}k=T+(S*136|0)+24|0;t=f[k>>2]|0;e:do{if(t){R=n+32|0;A=r+5584|0;M=0;T=T+(S*136|0)+28|0;t:while(1){u=f[R>>2]|0;c=f[T+20>>2]|0;if(((f[T+8>>2]|0)!=(f[T>>2]|0)?(f[T+12>>2]|0)!=(f[T+4>>2]|0):0)?(O=ce(f[c+(u*40|0)+20>>2]|0,f[c+(u*40|0)+16>>2]|0)|0,(O|0)!=0):0){e=c+(u*40|0)+32|0;n=c+(u*40|0)+36|0;w=T+28|0;x=0;s=f[c+(u*40|0)+24>>2]|0;while(1){u=s+44|0;if(!(f[u>>2]|0))t=vo(L,f[e>>2]|0,x,(f[I>>2]|0)+1|0)|0;else t=ko(L,1)|0;r:do{if(!t)f[s+40>>2]=0;else{if(!(f[u>>2]|0)){t=0;while(1)if(!(vo(L,f[n>>2]|0,x,t)|0))t=t+1|0;else break;f[s+24>>2]=1-t+(f[w>>2]|0);f[s+28>>2]=3}do{if(ko(L,1)|0)if(ko(L,1)|0){t=ko(L,2)|0;if((t|0)!=3){t=t+3|0;break}t=ko(L,5)|0;if((t|0)==31){t=(ko(L,7)|0)+37|0;break}else{t=t+6|0;break}}else t=2;else t=1}while(0);y=s+40|0;f[y>>2]=t;t=0;while(1)if(!(ko(L,1)|0))break;else t=t+1|0;_=s+28|0;f[_>>2]=(f[_>>2]|0)+t;u=f[u>>2]|0;do{if(!u){c=f[(f[A>>2]|0)+((f[H>>2]|0)*1080|0)+16>>2]|0;t=s+52|0;if(!(f[t>>2]|0)){f[t>>2]=10;d=s+4|0;u=Ki(f[d>>2]|0,320)|0;if(!u){u=t;c=d;t=d;d=66;break t}f[d>>2]=u}else u=f[s+4>>2]|0;f[u>>2]=0;f[u+4>>2]=0;f[u+8>>2]=0;f[u+12>>2]=0;f[u+16>>2]=0;f[u+20>>2]=0;f[u+24>>2]=0;f[u+28>>2]=0;if(c&4){f[u+20>>2]=1;u=0;break}u=u+20|0;if(!(c&1)){f[u>>2]=109;u=0;break}else{f[u>>2]=10;u=0;break}}else{m=u+-1|0;v=s+4|0;c=f[v>>2]|0;if((f[c+(m<<5)+8>>2]|0)!=(f[c+(m<<5)+20>>2]|0)){t=s+52|0;u=m;break}p=f[(f[A>>2]|0)+((f[H>>2]|0)*1080|0)+16>>2]|0;t=s+52|0;d=f[t>>2]|0;if((u+1|0)>>>0>d>>>0){S=d+10|0;f[t>>2]=S;c=Ki(c,S<<5)|0;if(!c){c=v;u=t;t=v;d=77;break t}f[v>>2]=c}S=c+(u<<5)|0;f[S>>2]=0;f[S+4>>2]=0;f[S+8>>2]=0;f[S+12>>2]=0;f[S+16>>2]=0;f[S+20>>2]=0;f[S+24>>2]=0;f[S+28>>2]=0;if(p&4){f[c+(u<<5)+20>>2]=1;break}if(!(p&1)){f[c+(u<<5)+20>>2]=109;break}else{S=f[c+(m<<5)+20>>2]|0;f[c+(u<<5)+20>>2]=(S|0)==1|(S|0)==10?2:1;break}}}while(0);g=s+4|0;m=f[y>>2]|0;while(1){p=f[g>>2]|0;c=(f[p+(u<<5)+20>>2]|0)-(f[p+(u<<5)+8>>2]|0)|0;c=(c|0)<(m|0)?c:m;f[p+(u<<5)+24>>2]=c;p=f[_>>2]|0;if(c>>>0>1){d=0;while(1){d=d+1|0;if(c>>>0>3)c=c>>>1;else{c=d;break}}}else c=0;p=ko(L,c+p|0)|0;c=f[g>>2]|0;f[c+(u<<5)+28>>2]=p;p=m-(f[c+(u<<5)+24>>2]|0)|0;if((p|0)<=0)break r;m=u+1|0;v=f[(f[A>>2]|0)+((f[H>>2]|0)*1080|0)+16>>2]|0;d=f[t>>2]|0;if((u+2|0)>>>0>d>>>0){S=d+10|0;f[t>>2]=S;c=Ki(c,S<<5)|0;if(!c){c=g;u=g;d=90;break t}f[g>>2]=c}S=c+(m<<5)|0;f[S>>2]=0;f[S+4>>2]=0;f[S+8>>2]=0;f[S+12>>2]=0;f[S+16>>2]=0;f[S+20>>2]=0;f[S+24>>2]=0;f[S+28>>2]=0;if(v&4){f[c+(m<<5)+20>>2]=1;u=m;m=p;continue}if(!(v&1)){f[c+(m<<5)+20>>2]=109;u=m;m=p;continue}else{S=f[c+(u<<5)+20>>2]|0;f[c+(m<<5)+20>>2]=(S|0)==1|(S|0)==10?2:1;u=m;m=p;continue}}}}while(0);x=x+1|0;if(x>>>0>=O>>>0)break;else s=s+56|0}t=f[k>>2]|0}M=M+1|0;if(M>>>0>=t>>>0)break e;else T=T+36|0}if((d|0)==66){Qi(f[t>>2]|0);f[c>>2]=0;f[u>>2]=0;To(L);a=0;b=U;return a|0}else if((d|0)==77){Qi(f[t>>2]|0);f[c>>2]=0;f[u>>2]=0;To(L);a=0;b=U;return a|0}else if((d|0)==90){Qi(f[u>>2]|0);f[c>>2]=0;f[t>>2]=0;To(L);a=0;b=U;return a|0}}}while(0);if(!(Co(L)|0)){To(L);a=0;b=U;return a|0}u=So(L)|0;t=P+u|0;To(L);do{if(f[r>>2]&4){if(((f[E>>2]|0)-t+(f[C>>2]|0)|0)>>>0<2){Qn(l,2,22135,D)|0;break}if((h[t>>0]|0)==-1?(h[P+(u+1)>>0]|0)==-110:0){t=P+(u+2)|0;break}Qn(l,2,22177,N)|0}}while(0);f[E>>2]=(f[E>>2]|0)+((f[C>>2]|0)-t);f[C>>2]=t;f[i>>2]=1;f[o>>2]=(f[F>>2]|0)-a;a=1;b=U;return a|0}function ls(){return Yi(104)|0}function us(e){e=e|0;if(!e)return;Qi(e);return}function cs(e){e=e|0;return(f[e+12>>2]|0)-(f[e+16>>2]|0)|0}function hs(e,t){e=e|0;t=t|0;var r=0,n=0;f[e+100>>2]=e+24;f[e+4>>2]=32768;f[e>>2]=0;n=t+-1|0;f[e+12>>2]=n;r=e+8|0;f[r>>2]=12;f[r>>2]=(h[n>>0]|0)==-1?13:12;f[e+16>>2]=t;return}function ds(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0;i=f[e+100>>2]|0;a=f[i>>2]|0;s=(f[a+4>>2]|0)==(t|0);n=f[a>>2]|0;l=e+4|0;t=(f[l>>2]|0)-n|0;f[l>>2]=t;if(!s){if(t>>>0<n>>>0){s=(f[e>>2]|0)+n|0;f[e>>2]=s;n=t;t=s;s=e}else{f[l>>2]=n;t=f[e>>2]|0;s=e}f[i>>2]=f[a+12>>2];o=e+8|0;a=e+12|0;i=t;t=f[o>>2]|0;while(1){n=n<<1;f[l>>2]=n;r=i<<1;f[s>>2]=r;t=t+-1|0;f[o>>2]=t;if(!t){t=f[a>>2]|0;n=h[t>>0]|0;do{if(n<<24>>24!=-1){if(!(r&134217728)){r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>18;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}h[t>>0]=n+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){e=f[s>>2]&134217727;f[s>>2]=e;r=t+1|0;f[a>>2]=r;h[r>>0]=e>>>20;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7;break}else{r=t+1|0;f[a>>2]=r;h[r>>0]=(f[s>>2]|0)>>>19;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}}else{r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>19;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7}}while(0);n=f[l>>2]|0}if(!(n&32768))i=r;else break}return}if(t&32768){f[e>>2]=(f[e>>2]|0)+n;return}if(t>>>0<n>>>0){f[l>>2]=n;r=f[e>>2]|0;s=e}else{r=(f[e>>2]|0)+n|0;f[e>>2]=r;n=t;s=e}f[i>>2]=f[a+8>>2];o=e+8|0;a=e+12|0;i=r;t=f[o>>2]|0;while(1){n=n<<1;f[l>>2]=n;r=i<<1;f[s>>2]=r;t=t+-1|0;f[o>>2]=t;if(!t){t=f[a>>2]|0;n=h[t>>0]|0;do{if(n<<24>>24!=-1){if(!(r&134217728)){r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>18;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}h[t>>0]=n+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){e=f[s>>2]&134217727;f[s>>2]=e;r=t+1|0;f[a>>2]=r;h[r>>0]=e>>>20;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7;break}else{r=t+1|0;f[a>>2]=r;h[r>>0]=(f[s>>2]|0)>>>19;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}}else{r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>19;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7}}while(0);n=f[l>>2]|0}if(!(n&32768))i=r;else break}return}function fs(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=f[e>>2]|0;n=a|65535;i=e+8|0;n=(n>>>0<((f[e+4>>2]|0)+a|0)>>>0?n:n+-32768|0)<<f[i>>2];f[e>>2]=n;a=e+12|0;t=f[a>>2]|0;r=h[t>>0]|0;do{if(r<<24>>24!=-1){if(!(n&134217728)){t=t+1|0;f[a>>2]=t;h[t>>0]=n>>>19;t=f[e>>2]&524287;f[e>>2]=t;f[i>>2]=8;r=8;break}h[t>>0]=r+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){r=f[e>>2]&134217727;f[e>>2]=r;t=t+1|0;f[a>>2]=t;h[t>>0]=r>>>20;t=f[e>>2]&1048575;f[e>>2]=t;f[i>>2]=7;r=7;break}else{t=t+1|0;f[a>>2]=t;h[t>>0]=(f[e>>2]|0)>>>19;t=f[e>>2]&524287;f[e>>2]=t;f[i>>2]=8;r=8;break}}else{t=t+1|0;f[a>>2]=t;h[t>>0]=n>>>20;t=f[e>>2]&1048575;f[e>>2]=t;f[i>>2]=7;r=7}}while(0);t=t<<r;f[e>>2]=t;r=f[a>>2]|0;n=h[r>>0]|0;do{if(n<<24>>24!=-1){if(!(t&134217728)){n=r+1|0;f[a>>2]=n;h[n>>0]=t>>>19;f[e>>2]=f[e>>2]&524287;f[i>>2]=8;break}h[r>>0]=n+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){r=f[e>>2]&134217727;f[e>>2]=r;n=t+1|0;f[a>>2]=n;h[n>>0]=r>>>20;f[e>>2]=f[e>>2]&1048575;f[i>>2]=7;break}else{n=t+1|0;f[a>>2]=n;h[n>>0]=(f[e>>2]|0)>>>19;f[e>>2]=f[e>>2]&524287;f[i>>2]=8;break}}else{n=r+1|0;f[a>>2]=n;h[n>>0]=t>>>20;f[e>>2]=f[e>>2]&1048575;f[i>>2]=7}}while(0);t=f[a>>2]|0;if((h[t>>0]|0)==-1)return;f[a>>2]=t+1;return}function ps(e){e=e|0;f[e>>2]=0;f[e+8>>2]=8;return}function ms(e,t){e=e|0;t=t|0;var r=0,n=0,i=0;r=e+8|0;n=(f[r>>2]|0)+-1|0;f[r>>2]=n;t=(t<<n)+(f[e>>2]|0)|0;f[e>>2]=t;if(n)return;n=e+12|0;i=(f[n>>2]|0)+1|0;f[n>>2]=i;h[i>>0]=t;f[r>>2]=8;f[r>>2]=(h[f[n>>2]>>0]|0)==-1?7:8;f[e>>2]=0;return}function vs(e){e=e|0;f[e+28>>2]=1156;f[e+32>>2]=1156;f[e+36>>2]=1156;f[e+40>>2]=1156;f[e+44>>2]=1156;f[e+48>>2]=1156;f[e+52>>2]=1156;f[e+56>>2]=1156;f[e+60>>2]=1156;f[e+64>>2]=1156;f[e+68>>2]=1156;f[e+72>>2]=1156;f[e+76>>2]=1156;f[e+80>>2]=1156;f[e+84>>2]=1156;f[e+88>>2]=1156;f[e+96>>2]=2628;f[e+92>>2]=1252;f[e+24>>2]=1284;return}function gs(e){e=e|0;f[e+24>>2]=1156;f[e+28>>2]=1156;f[e+32>>2]=1156;f[e+36>>2]=1156;f[e+40>>2]=1156;f[e+44>>2]=1156;f[e+48>>2]=1156;f[e+52>>2]=1156;f[e+56>>2]=1156;f[e+60>>2]=1156;f[e+64>>2]=1156;f[e+68>>2]=1156;f[e+72>>2]=1156;f[e+76>>2]=1156;f[e+80>>2]=1156;f[e+84>>2]=1156;f[e+88>>2]=1156;f[e+92>>2]=1156;f[e+96>>2]=1156;return}function ys(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;f[e+24+(t<<2)>>2]=1156+((n<<1)+r<<4);return}function _s(e){e=e|0;var t=0,r=0;f[e+100>>2]=e+24;f[e+4>>2]=32768;f[e>>2]=0;t=e+8|0;f[t>>2]=12;r=e+12|0;e=(f[r>>2]|0)+-1|0;f[r>>2]=e;if((h[e>>0]|0)!=-1)return;f[t>>2]=13;return}function bs(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;o=e+8|0;t=f[o>>2]|0;n=12-t|0;if((n|0)>0){i=e+12|0;r=f[e>>2]|0;do{t=r<<t;f[e>>2]=t;f[o>>2]=0;r=f[i>>2]|0;a=h[r>>0]|0;do{if(a<<24>>24!=-1){if(!(t&134217728)){r=r+1|0;f[i>>2]=r;h[r>>0]=t>>>19;r=f[e>>2]&524287;f[e>>2]=r;f[o>>2]=8;t=8;break}h[r>>0]=a+1<<24>>24;t=f[i>>2]|0;if((h[t>>0]|0)==-1){a=f[e>>2]&134217727;f[e>>2]=a;r=t+1|0;f[i>>2]=r;h[r>>0]=a>>>20;r=f[e>>2]&1048575;f[e>>2]=r;f[o>>2]=7;t=7;break}else{r=t+1|0;f[i>>2]=r;h[r>>0]=(f[e>>2]|0)>>>19;r=f[e>>2]&524287;f[e>>2]=r;f[o>>2]=8;t=8;break}}else{r=r+1|0;f[i>>2]=r;h[r>>0]=t>>>20;r=f[e>>2]&1048575;f[e>>2]=r;f[o>>2]=7;t=7}}while(0);n=n-t|0}while((n|0)>0)}else i=e+12|0;t=f[i>>2]|0;r=h[t>>0]|0;if(r<<24>>24==-1)return;n=f[e>>2]|0;if(!(n&134217728)){a=t+1|0;f[i>>2]=a;h[a>>0]=n>>>19;f[e>>2]=f[e>>2]&524287;f[o>>2]=8;return}h[t>>0]=r+1<<24>>24;t=f[i>>2]|0;if((h[t>>0]|0)==-1){n=f[e>>2]&134217727;f[e>>2]=n;a=t+1|0;f[i>>2]=a;h[a>>0]=n>>>20;f[e>>2]=f[e>>2]&1048575;f[o>>2]=7;return}else{a=t+1|0;f[i>>2]=a;h[a>>0]=(f[e>>2]|0)>>>19;f[e>>2]=f[e>>2]&524287;f[o>>2]=8;return}}function Es(e){e=e|0;f[e+100>>2]=e+96;ds(e,1);ds(e,0);ds(e,1);ds(e,0);return}function ws(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;f[e+100>>2]=e+24;f[e+16>>2]=t;f[e+20>>2]=t+r;i=e+12|0;f[i>>2]=t;do{if(r){a=p[t>>0]<<16;f[e>>2]=a;n=t+1|0;if((r|0)==1)r=255;else r=p[n>>0]|0;if((h[t>>0]|0)!=-1){f[i>>2]=n;n=a|r<<8;f[e>>2]=n;r=e+8|0;f[r>>2]=8;i=e;a=1;break}if(r>>>0>143){n=a|65280;f[e>>2]=n;r=e+8|0;f[r>>2]=8;i=e;a=1;break}else{f[i>>2]=n;n=a+(r<<9)|0;f[e>>2]=n;r=e+8|0;f[r>>2]=7;i=e;a=0;break}}else{f[e>>2]=16776960;r=e+8|0;f[r>>2]=8;n=16776960;i=e;a=1}}while(0);f[i>>2]=n<<7;f[r>>2]=a;f[e+4>>2]=32768;return 1}function xs(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;r=f[e+100>>2]|0;n=f[r>>2]|0;o=f[n>>2]|0;c=e+4|0;a=(f[c>>2]|0)-o|0;f[c>>2]=a;i=f[e>>2]|0;if(i>>>16>>>0<o>>>0){f[c>>2]=o;t=f[n+4>>2]|0;if(a>>>0<o>>>0)f[r>>2]=f[n+8>>2];else{f[r>>2]=f[n+12>>2];t=1-t|0}s=e+8|0;l=e+12|0;u=e+20|0;n=f[s>>2]|0;r=i;do{do{if(!n){i=f[l>>2]|0;n=f[u>>2]|0;if((i|0)==(n|0)){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}a=i+1|0;if((a|0)==(n|0))n=255;else n=p[a>>0]|0;if((h[i>>0]|0)!=-1){f[l>>2]=a;r=r+(n<<8)|0;f[e>>2]=r;f[s>>2]=8;n=8;break}if(n>>>0>143){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}else{f[l>>2]=a;r=r+(n<<9)|0;f[e>>2]=r;f[s>>2]=7;n=7;break}}}while(0);o=o<<1;f[c>>2]=o;r=r<<1;f[e>>2]=r;n=n+-1|0;f[s>>2]=n}while(o>>>0<32768);return t|0}i=i-(o<<16)|0;f[e>>2]=i;if(a&32768){e=f[n+4>>2]|0;return e|0}t=f[n+4>>2]|0;if(o>>>0>a>>>0){f[r>>2]=f[n+12>>2];t=1-t|0}else f[r>>2]=f[n+8>>2];s=e+8|0;l=e+12|0;u=e+20|0;n=f[s>>2]|0;r=i;o=a;do{do{if(!n){i=f[l>>2]|0;n=f[u>>2]|0;if((i|0)==(n|0)){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}a=i+1|0;if((a|0)==(n|0))n=255;else n=p[a>>0]|0;if((h[i>>0]|0)!=-1){f[l>>2]=a;r=r+(n<<8)|0;f[e>>2]=r;f[s>>2]=8;n=8;break}if(n>>>0>143){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}else{f[l>>2]=a;r=r+(n<<9)|0;f[e>>2]=r;f[s>>2]=7;n=7;break}}}while(0);o=o<<1;f[c>>2]=o;r=r<<1;f[e>>2]=r;n=n+-1|0;f[s>>2]=n}while(o>>>0<32768);return t|0}function Ts(){return Yi(28)|0}function Ss(e){e=e|0;if(!e)return;Qi(e);return}function Ms(e,t,r){e=e|0;t=t|0;r=r|0;f[e+20>>2]=t;f[e+8>>2]=r;f[e+12>>2]=0;h[e>>0]=0;f[e+4>>2]=0;return}function Rs(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;i=e+4|0;t=f[i>>2]|0;do{if(!t){f[i>>2]=8;r=e+12|0;n=f[r>>2]|0;if((n|0)==(f[e+8>>2]|0)){h[e>>0]=-1;t=8;r=-1;break}if((h[e>>0]|0)==-1){f[i>>2]=7;t=7}else t=8;a=h[(f[e+20>>2]|0)+n>>0]|0;h[e>>0]=a;f[r>>2]=n+1;r=a}else r=h[e>>0]|0}while(0);a=t+-1|0;f[i>>2]=a;return(r&255)>>>a&1|0}function As(){var e=0;if(!(f[665]|0))e=2712;else{e=(Be()|0)+60|0;e=f[e>>2]|0}return e|0}function ks(e){e=e|0;var t=0,r=0;t=0;while(1){if((p[22198+t>>0]|0)==(e|0)){r=2;break}t=t+1|0;if((t|0)==87){t=87;e=22286;r=5;break}}if((r|0)==2)if(!t)e=22286;else{e=22286;r=5}if((r|0)==5)while(1){r=e;while(1){e=r+1|0;if(!(h[r>>0]|0))break;else r=e}t=t+-1|0;if(!t)break;else r=5}return e|0}function Ps(e){e=e|0;var t=0;if(e>>>0>4294963200){t=As()|0;f[t>>2]=0-e;e=-1}return e|0}function Cs(e,t){e=+e;t=t|0;var r=0,n=0,i=0;y[w>>3]=e;r=f[w>>2]|0;n=f[w+4>>2]|0;i=Xl(r|0,n|0,52)|0;i=i&2047;switch(i|0){case 0:{if(e!=0.0){e=+Cs(e*18446744073709551616.0,t);r=(f[t>>2]|0)+-64|0}else r=0;f[t>>2]=r;break}case 2047:break;default:{f[t>>2]=i+-1022;f[w>>2]=r;f[w+4>>2]=n&-2146435073|1071644672;e=+y[w>>3]}}return+e}function Ls(e,t){e=+e;t=t|0;return+ +Cs(e,t)}function Is(e,t){e=+e;t=t|0;return+ +Ds(e,t)}function Os(e){e=+e;return~~+Hs(e)|0}function Hs(e){e=+e;var t=0;t=(g[w>>2]=e,f[w>>2]|0);if((t&2130706432)>>>0<=1249902592){t=(t|0)<0;e=t?e+-8388608.0+8388608.0:e+8388608.0+-8388608.0;if(e==0.0)e=t?-0.0:0.0}return+e}function Ds(e,t){e=+e;t=t|0;var r=0;if((t|0)>1023){e=e*8988465674311579538646525.0e283;r=t+-1023|0;if((r|0)>1023){r=t+-2046|0;r=(r|0)>1023?1023:r;e=e*8988465674311579538646525.0e283}}else if((t|0)<-1022){e=e*2.2250738585072014e-308;r=t+1022|0;if((r|0)<-1022){r=t+2044|0;r=(r|0)<-1022?-1022:r;e=e*2.2250738585072014e-308}}else r=t;r=Gl(r+1023|0,0,52)|0;t=B;f[w>>2]=r;f[w+4>>2]=t;return+(e*+y[w>>3])}function Ns(e,t,r){e=e|0;t=t|0;r=r|0;do{if(e){if(t>>>0<128){h[e>>0]=t;e=1;break}if(t>>>0<2048){h[e>>0]=t>>>6|192;h[e+1>>0]=t&63|128;e=2;break}if(t>>>0<55296|(t&-8192|0)==57344){h[e>>0]=t>>>12|224;h[e+1>>0]=t>>>6&63|128;h[e+2>>0]=t&63|128;e=3;break}if((t+-65536|0)>>>0<1048576){h[e>>0]=t>>>18|240;h[e+1>>0]=t>>>12&63|128;h[e+2>>0]=t>>>6&63|128;h[e+3>>0]=t&63|128;e=4;break}else{e=As()|0;f[e>>2]=84;e=-1;break}}else e=1}while(0);return e|0}function Fs(e,t){e=e|0;t=t|0;if(!e)e=0;else e=Ns(e,t,0)|0;return e|0}function Us(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0;d=b;b=b+112|0;c=d+40|0;l=d+24|0;s=d+16|0;i=d;u=d+52|0;n=h[t>>0]|0;if(yl(24090,n<<24>>24,4)|0){r=Ll(1144)|0;if(!r)r=0;else{a=r;o=a+112|0;do{f[a>>2]=0;a=a+4|0}while((a|0)<(o|0));if(!(bl(t,43)|0))f[r>>2]=n<<24>>24==114?8:4;if(bl(t,101)|0){f[i>>2]=e;f[i+4>>2]=2;f[i+8>>2]=1;ke(221,i|0)|0;n=h[t>>0]|0}if(n<<24>>24==97){f[s>>2]=e;f[s+4>>2]=3;n=ke(221,s|0)|0;if(!(n&1024)){f[l>>2]=e;f[l+4>>2]=4;f[l+8>>2]=n|1024;ke(221,l|0)|0}t=f[r>>2]|128;f[r>>2]=t}else t=f[r>>2]|0;f[r+60>>2]=e;f[r+44>>2]=r+120;f[r+48>>2]=1024;n=r+75|0;h[n>>0]=-1;if((t&8|0)==0?(f[c>>2]=e,f[c+4>>2]=21505,f[c+8>>2]=u,(Ve(54,c|0)|0)==0):0)h[n>>0]=10;f[r+32>>2]=60;f[r+36>>2]=61;f[r+40>>2]=3;f[r+12>>2]=1;if(!(f[666]|0))f[r+76>>2]=-1;Xe(2688);n=f[671]|0;f[r+56>>2]=n;if(n)f[n+52>>2]=r;f[671]=r;Ge(2688)}}else{r=As()|0;f[r>>2]=22;r=0}b=d;return r|0}function Bs(e){e=e|0;var t=0,r=0,n=0;r=(bl(e,43)|0)==0;t=h[e>>0]|0;r=r?t<<24>>24!=114&1:2;n=(bl(e,120)|0)==0;r=n?r:r|128;e=(bl(e,101)|0)==0;e=e?r:r|524288;e=t<<24>>24==114?e:e|64;e=t<<24>>24==119?e|512:e;return(t<<24>>24==97?e|1024:e)|0}function zs(e){e=e|0;return 0}function js(e){e=e|0;return}function Vs(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0;l=b;b=b+16|0;s=l;o=t&255;h[s>>0]=o;n=e+16|0;i=f[n>>2]|0;if(!i)if(!(Js(e)|0)){i=f[n>>2]|0;a=4}else r=-1;else a=4;do{if((a|0)==4){n=e+20|0;a=f[n>>2]|0;if(a>>>0<i>>>0?(r=t&255,(r|0)!=(h[e+75>>0]|0)):0){f[n>>2]=a+1;h[a>>0]=o;break}if((ku[f[e+36>>2]&63](e,s,1)|0)==1)r=p[s>>0]|0;else r=-1}}while(0);b=l;return r|0}function Gs(e){e=e|0;var t=0,r=0;t=b;b=b+16|0;r=t;f[r>>2]=f[e+60>>2];e=Ps(Ye(6,r|0)|0)|0;b=t;return e|0}function Ws(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;u=b;b=b+48|0;a=u+16|0;i=u;n=u+32|0;f[n>>2]=t;o=n+4|0;l=e+48|0;c=f[l>>2]|0;f[o>>2]=r-((c|0)!=0&1);s=e+44|0;f[n+8>>2]=f[s>>2];f[n+12>>2]=c;if(!(f[665]|0)){f[a>>2]=f[e+60>>2];f[a+4>>2]=n;f[a+8>>2]=2;n=Ps(Ke(145,a|0)|0)|0}else{Le(5,e|0);f[i>>2]=f[e+60>>2];f[i+4>>2]=n;f[i+8>>2]=2;n=Ps(Ke(145,i|0)|0)|0;Ae(0)}if((n|0)>=1){o=f[o>>2]|0;if(n>>>0>o>>>0){a=f[s>>2]|0;i=e+4|0;f[i>>2]=a;f[e+8>>2]=a+(n-o);if(!(f[l>>2]|0))n=r;else{f[i>>2]=a+1;h[t+(r+-1)>>0]=h[a>>0]|0;n=r}}}else{f[e>>2]=f[e>>2]|n&48^16;f[e+8>>2]=0;f[e+4>>2]=0}b=u;return n|0}function Xs(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;i=b;b=b+32|0;a=i;n=i+20|0;f[a>>2]=f[e+60>>2];f[a+4>>2]=0;f[a+8>>2]=t;f[a+12>>2]=n;f[a+16>>2]=r;if((Ps(Je(140,a|0)|0)|0)<0){f[n>>2]=-1;e=-1}else e=f[n>>2]|0;b=i;return e|0}function Ys(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;m=b;b=b+48|0;h=m+16|0;c=m;n=m+32|0;d=e+28|0;i=f[d>>2]|0;f[n>>2]=i;p=e+20|0;i=(f[p>>2]|0)-i|0;f[n+4>>2]=i;f[n+8>>2]=t;f[n+12>>2]=r;l=e+60|0;u=e+44|0;t=2;i=i+r|0;while(1){if(!(f[665]|0)){f[h>>2]=f[l>>2];f[h+4>>2]=n;f[h+8>>2]=t;o=Ps(Qe(146,h|0)|0)|0}else{Le(6,e|0);f[c>>2]=f[l>>2];f[c+4>>2]=n;f[c+8>>2]=t;o=Ps(Qe(146,c|0)|0)|0;Ae(0)}if((i|0)==(o|0)){i=6;break}if((o|0)<0){i=8;break}i=i-o|0;a=f[n+4>>2]|0;if(o>>>0<=a>>>0)if((t|0)==2){f[d>>2]=(f[d>>2]|0)+o;s=a;t=2}else s=a;else{s=f[u>>2]|0;f[d>>2]=s;f[p>>2]=s;s=f[n+12>>2]|0;o=o-a|0;n=n+8|0;t=t+-1|0}f[n>>2]=(f[n>>2]|0)+o;f[n+4>>2]=s-o}if((i|0)==6){h=f[u>>2]|0;f[e+16>>2]=h+(f[e+48>>2]|0);e=h;f[d>>2]=e;f[p>>2]=e}else if((i|0)==8){f[e+16>>2]=0;f[d>>2]=0;f[p>>2]=0;f[e>>2]=f[e>>2]|32;if((t|0)==2)r=0;else r=r-(f[n+4>>2]|0)|0}b=m;return r|0}function qs(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;i=b;b=b+80|0;n=i;f[e+36>>2]=61;if((f[e>>2]&64|0)==0?(f[n>>2]=f[e+60>>2],f[n+4>>2]=21505,f[n+8>>2]=i+12,(Ve(54,n|0)|0)!=0):0)h[e+75>>0]=-1;n=Ys(e,t,r)|0;b=i;return n|0}function Zs(e){e=e|0;var t=0,r=0;t=e+74|0;r=h[t>>0]|0;h[t>>0]=r+255|r;t=e+20|0;r=e+44|0;if((f[t>>2]|0)>>>0>(f[r>>2]|0)>>>0)ku[f[e+36>>2]&63](e,0,0)|0;f[e+16>>2]=0;f[e+28>>2]=0;f[t>>2]=0;t=f[e>>2]|0;if(t&20)if(!(t&4))t=-1;else{f[e>>2]=t|32;t=-1}else{t=f[r>>2]|0;f[e+8>>2]=t;f[e+4>>2]=t;t=0}return t|0}function Js(e){e=e|0;var t=0,r=0;t=e+74|0;r=h[t>>0]|0;h[t>>0]=r+255|r;t=f[e>>2]|0;if(!(t&8)){f[e+8>>2]=0;f[e+4>>2]=0;t=f[e+44>>2]|0;f[e+28>>2]=t;f[e+20>>2]=t;f[e+16>>2]=t+(f[e+48>>2]|0);t=0}else{f[e>>2]=t|32;t=-1}return t|0}function Ks(e){e=e|0;var t=0,r=0,n=0;n=(f[e>>2]&1|0)!=0;if(!n){Xe(2688);r=f[e+52>>2]|0;t=e+56|0;if(r)f[r+56>>2]=f[t>>2];t=f[t>>2]|0;if(t)f[t+52>>2]=r;if((f[671]|0)==(e|0))f[671]=t;Ge(2688)}t=Qs(e)|0;t=Ou[f[e+12>>2]&15](e)|0|t;r=f[e+92>>2]|0;if(r)Il(r);if(!n)Il(e);return t|0}function Qs(e){e=e|0;var t=0,r=0;do{if(e){if((f[e+76>>2]|0)<=-1){t=Ml(e)|0;break}r=(zs(e)|0)==0;t=Ml(e)|0;if(!r)js(e)}else{if(!(f[677]|0))t=0;else t=Qs(f[677]|0)|0;Xe(2688);e=f[671]|0;if(e)do{if((f[e+76>>2]|0)>-1)r=zs(e)|0;else r=0;if((f[e+20>>2]|0)>>>0>(f[e+28>>2]|0)>>>0)t=Ml(e)|0|t;if(r)js(e);e=f[e+56>>2]|0}while((e|0)!=0);Ge(2688)}}while(0);return t|0}function $s(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0;i=b;b=b+32|0;n=i+16|0;r=i;if(yl(24090,h[t>>0]|0,4)|0){a=Bs(t)|0|32768;f[r>>2]=e;f[r+4>>2]=a;f[r+8>>2]=438;r=Ps(qe(5,r|0)|0)|0;if((r|0)>=0){e=Us(r,t)|0;if(!e){f[n>>2]=r;Ye(6,n|0)|0;e=0}}else e=0}else{e=As()|0;f[e>>2]=22;e=0}b=i;return e|0}function el(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=b;b=b+16|0;i=n;f[i>>2]=r;r=ml(e,t,i)|0;b=n;return r|0}function tl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0;if((f[t+76>>2]|0)>=0?(zs(t)|0)!=0:0){if((h[t+75>>0]|0)!=(e|0)?(n=t+20|0,i=f[n>>2]|0,i>>>0<(f[t+16>>2]|0)>>>0):0){f[n>>2]=i+1;h[i>>0]=e;r=e&255}else r=Vs(t,e)|0;js(t)}else o=3;do{if((o|0)==3){if((h[t+75>>0]|0)!=(e|0)?(a=t+20|0,r=f[a>>2]|0,r>>>0<(f[t+16>>2]|0)>>>0):0){f[a>>2]=r+1;h[r>>0]=e;r=e&255;break}r=Vs(t,e)|0}}while(0);return r|0}function rl(e,t){e=e|0;t=t|0;return(hl(e,xl(e)|0,1,t)|0)+-1|0}function nl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;s=ce(r,t)|0;if((f[n+76>>2]|0)>-1)l=zs(n)|0;else l=0;i=n+74|0;a=h[i>>0]|0;h[i>>0]=a+255|a;i=n+4|0;a=f[i>>2]|0;o=(f[n+8>>2]|0)-a|0;if((o|0)>0){o=o>>>0<s>>>0?o:s;Yl(e|0,a|0,o|0)|0;f[i>>2]=a+o;e=e+o|0;i=s-o|0}else i=s;e:do{if(!i)u=13;else{o=n+32|0;a=i;while(1){if(Zs(n)|0){r=a;break}i=ku[f[o>>2]&63](n,e,a)|0;if((i+1|0)>>>0<2){r=a;break}if((a|0)==(i|0)){u=13;break e}else{e=e+i|0;a=a-i|0}}if(l)js(n);r=((s-r|0)>>>0)/(t>>>0)|0}}while(0);if((u|0)==13)if(l)js(n);return r|0}function il(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;if((r|0)==1)t=t-(f[e+8>>2]|0)+(f[e+4>>2]|0)|0;i=e+20|0;n=e+28|0;if((f[i>>2]|0)>>>0>(f[n>>2]|0)>>>0?(ku[f[e+36>>2]&63](e,0,0)|0,(f[i>>2]|0)==0):0)t=-1;else{f[e+16>>2]=0;f[n>>2]=0;f[i>>2]=0;if((ku[f[e+40>>2]&63](e,t,r)|0)<0)t=-1;else{f[e+8>>2]=0;f[e+4>>2]=0;f[e>>2]=f[e>>2]&-17;t=0}}return t|0}function al(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if((f[e+76>>2]|0)>-1){n=(zs(e)|0)==0;t=il(e,t,r)|0;if(!n)js(e)}else t=il(e,t,r)|0;return t|0}function ol(e,t,r){e=e|0;t=t|0;r=r|0;return al(e,t,r)|0}function sl(e){e=e|0;var t=0;if(!(f[e>>2]&128))t=1;else t=(f[e+20>>2]|0)>>>0>(f[e+28>>2]|0)>>>0?2:1;t=ku[f[e+40>>2]&63](e,0,t)|0;if((t|0)>=0)t=t-(f[e+8>>2]|0)+(f[e+4>>2]|0)+(f[e+20>>2]|0)-(f[e+28>>2]|0)|0;return t|0}function ll(e){e=e|0;var t=0;if((f[e+76>>2]|0)>-1){t=(zs(e)|0)==0;e=sl(e)|0}else e=sl(e)|0;return e|0}function ul(e){e=e|0;return ll(e)|0}function cl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0;n=r+16|0;i=f[n>>2]|0;if(!i)if(!(Js(r)|0)){i=f[n>>2]|0;a=4}else n=0;else a=4;e:do{if((a|0)==4){o=r+20|0;a=f[o>>2]|0;if((i-a|0)>>>0<t>>>0){n=ku[f[r+36>>2]&63](r,e,t)|0;break}t:do{if((h[r+75>>0]|0)>-1){n=t;while(1){if(!n){i=a;n=0;break t}i=n+-1|0;if((h[e+i>>0]|0)==10)break;else n=i}if((ku[f[r+36>>2]&63](r,e,n)|0)>>>0<n>>>0)break e;t=t-n|0;e=e+n|0;i=f[o>>2]|0}else{i=a;n=0}}while(0);Yl(i|0,e|0,t|0)|0;f[o>>2]=(f[o>>2]|0)+t;n=n+t|0}}while(0);return n|0}function hl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;i=ce(r,t)|0;if((f[n+76>>2]|0)>-1){a=(zs(n)|0)==0;e=cl(e,i,n)|0;if(!a)js(n)}else e=cl(e,i,n)|0;if((e|0)!=(i|0))r=(e>>>0)/(t>>>0)|0;return r|0}function dl(e,t){e=e|0;t=t|0;var r=0,n=0;r=b;b=b+16|0;n=r;f[n>>2]=t;t=ml(f[676]|0,e,n)|0;b=r;return t|0}function fl(e){e=e|0;var t=0,r=0,n=0,i=0;n=f[676]|0;if((f[n+76>>2]|0)>-1)i=zs(n)|0;else i=0;do{if((rl(e,n)|0)<0)t=1;else{if((h[n+75>>0]|0)!=10?(t=n+20|0,r=f[t>>2]|0,r>>>0<(f[n+16>>2]|0)>>>0):0){f[t>>2]=r+1;h[r>>0]=10;t=0;break}t=(Vs(n,10)|0)<0}}while(0);if(i)js(n);return t<<31>>31|0}function pl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=b;b=b+16|0;i=n;f[i>>2]=r;r=gl(e,t,i)|0;b=n;return r|0}function ml(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,v=0,g=0;g=b;b=b+224|0;d=g+80|0;v=g+96|0;m=g;p=g+136|0;n=v;i=n+40|0;do{f[n>>2]=0;n=n+4|0}while((n|0)<(i|0));f[d>>2]=f[r>>2];if((Rl(0,t,d,m,v)|0)<0)r=-1;else{if((f[e+76>>2]|0)>-1)u=zs(e)|0;else u=0;r=f[e>>2]|0;c=r&32;if((h[e+74>>0]|0)<1)f[e>>2]=r&-33;r=e+48|0;if(!(f[r>>2]|0)){i=e+44|0;a=f[i>>2]|0;f[i>>2]=p;o=e+28|0;f[o>>2]=p;s=e+20|0;f[s>>2]=p;f[r>>2]=80;l=e+16|0;f[l>>2]=p+80;n=Rl(e,t,d,m,v)|0;if(a){ku[f[e+36>>2]&63](e,0,0)|0;n=(f[s>>2]|0)==0?-1:n;f[i>>2]=a;f[r>>2]=0;f[l>>2]=0;f[o>>2]=0;f[s>>2]=0}}else n=Rl(e,t,d,m,v)|0;r=f[e>>2]|0;f[e>>2]=r|c;if(u)js(e);r=(r&32|0)==0?n:-1}b=g;return r|0}function vl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=b;b=b+128|0;i=c+112|0;u=c;a=u;o=2716;s=a+112|0;do{f[a>>2]=f[o>>2];a=a+4|0;o=o+4|0}while((a|0)<(s|0));if((t+-1|0)>>>0>2147483646)if(!t){t=1;l=4}else{t=As()|0;f[t>>2]=75;t=-1}else{i=e;l=4}if((l|0)==4){l=-2-i|0;l=t>>>0>l>>>0?l:t;f[u+48>>2]=l;e=u+20|0;f[e>>2]=i;f[u+44>>2]=i;t=i+l|0;i=u+16|0;f[i>>2]=t;f[u+28>>2]=t;t=ml(u,r,n)|0;if(l){r=f[e>>2]|0;h[r+(((r|0)==(f[i>>2]|0))<<31>>31)>>0]=0}}b=c;return t|0}function gl(e,t,r){e=e|0;t=t|0;r=r|0;return vl(e,2147483647,t,r)|0}function yl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0;a=t&255;n=(r|0)!=0;e:do{if(n&(e&3|0)!=0){i=t&255;while(1){if((h[e>>0]|0)==i<<24>>24){o=6;break e}e=e+1|0;r=r+-1|0;n=(r|0)!=0;if(!(n&(e&3|0)!=0)){o=5;break}}}else o=5}while(0);if((o|0)==5)if(n)o=6;else r=0;e:do{if((o|0)==6){i=t&255;if((h[e>>0]|0)!=i<<24>>24){n=ce(a,16843009)|0;t:do{if(r>>>0>3)while(1){a=f[e>>2]^n;if((a&-2139062144^-2139062144)&a+-16843009)break;e=e+4|0;r=r+-4|0;if(r>>>0<=3){o=11;break t}}else o=11}while(0);if((o|0)==11)if(!r){r=0;break}while(1){if((h[e>>0]|0)==i<<24>>24)break e;e=e+1|0;r=r+-1|0;if(!r){r=0;break}}}}}while(0);return((r|0)!=0?e:0)|0}function _l(e,t){e=e|0;t=t|0;var r=0,n=0;r=t;e:do{if(!((r^e)&3)){if(r&3)do{r=h[t>>0]|0;h[e>>0]=r;if(!(r<<24>>24))break e;t=t+1|0;e=e+1|0}while((t&3|0)!=0);r=f[t>>2]|0;if(!((r&-2139062144^-2139062144)&r+-16843009)){n=e;while(1){t=t+4|0;e=n+4|0;f[n>>2]=r;r=f[t>>2]|0;if((r&-2139062144^-2139062144)&r+-16843009)break;else n=e}}n=8}else n=8}while(0);if((n|0)==8){n=h[t>>0]|0;h[e>>0]=n;if(n<<24>>24)do{t=t+1|0;e=e+1|0;n=h[t>>0]|0;h[e>>0]=n}while(n<<24>>24!=0)}return e|0}function bl(e,t){e=e|0;t=t|0;e=El(e,t)|0;return((h[e>>0]|0)==(t&255)<<24>>24?e:0)|0}function El(e,t){e=e|0;t=t|0;var r=0,n=0,i=0;n=t&255;e:do{if(!n)e=e+(xl(e)|0)|0;else{if(e&3){r=t&255;do{i=h[e>>0]|0;if(i<<24>>24==0?1:i<<24>>24==r<<24>>24)break e;e=e+1|0}while((e&3|0)!=0)}n=ce(n,16843009)|0;r=f[e>>2]|0;t:do{if(!((r&-2139062144^-2139062144)&r+-16843009))do{i=r^n;if((i&-2139062144^-2139062144)&i+-16843009)break t;e=e+4|0;r=f[e>>2]|0}while(((r&-2139062144^-2139062144)&r+-16843009|0)==0)}while(0);r=t&255;while(1){i=h[e>>0]|0;if(i<<24>>24==0?1:i<<24>>24==r<<24>>24)break;else e=e+1|0}}}while(0);return e|0}function wl(e,t){e=e|0;t=t|0;_l(e,t)|0;return e|0}function xl(e){e=e|0;var t=0,r=0,n=0;n=e;e:do{if(!(n&3))r=4;else{t=e;e=n;while(1){if(!(h[t>>0]|0))break e;t=t+1|0;e=t;if(!(e&3)){e=t;r=4;break}}}}while(0);if((r|0)==4){while(1){t=f[e>>2]|0;if(!((t&-2139062144^-2139062144)&t+-16843009))e=e+4|0;else break}if((t&255)<<24>>24)do{e=e+1|0}while((h[e>>0]|0)!=0)}return e-n|0}function Tl(e){e=e|0;if(!(f[e+68>>2]|0))js(e);return}function Sl(e){e=e|0;if(!(f[e+68>>2]|0))js(e);return}function Ml(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;t=e+20|0;a=e+28|0;if((f[t>>2]|0)>>>0>(f[a>>2]|0)>>>0?(ku[f[e+36>>2]&63](e,0,0)|0,(f[t>>2]|0)==0):0)t=-1;else{o=e+4|0;r=f[o>>2]|0;n=e+8|0;i=f[n>>2]|0;if(r>>>0<i>>>0)ku[f[e+40>>2]&63](e,r-i|0,1)|0;f[e+16>>2]=0;f[a>>2]=0;f[t>>2]=0;f[n>>2]=0;f[o>>2]=0;t=0}return t|0}function Rl(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0.0,c=0,m=0,v=0,g=0,_=0.0,E=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,J=0,K=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0;oe=b;b=b+624|0;te=oe+24|0;ne=oe+16|0;re=oe+588|0;J=oe+576|0;ee=oe;Y=oe+536|0;ae=oe+8|0;ie=oe+528|0;N=(e|0)!=0;F=Y+40|0;X=F;Y=Y+39|0;q=ae+4|0;Z=J+12|0;J=J+11|0;K=re;Q=Z;$=Q-K|0;U=-2-K|0;z=Q+2|0;j=te+288|0;V=re+9|0;G=V;W=re+8|0;a=0;E=t;o=0;t=0;e:while(1){do{if((a|0)>-1)if((o|0)>(2147483647-a|0)){a=As()|0;f[a>>2]=75;a=-1;break}else{a=o+a|0;break}}while(0);o=h[E>>0]|0;if(!(o<<24>>24)){D=245;break}else s=E;t:while(1){switch(o<<24>>24){case 37:{o=s;D=9;break t}case 0:{o=s;break t}default:{}}H=s+1|0;o=h[H>>0]|0;s=H}t:do{if((D|0)==9)while(1){D=0;if((h[o+1>>0]|0)!=37)break t;s=s+1|0;o=o+2|0;if((h[o>>0]|0)==37)D=9;else break}}while(0);T=s-E|0;if(N?(f[e>>2]&32|0)==0:0)cl(E,T,e)|0;if((s|0)!=(E|0)){E=o;o=T;continue}c=o+1|0;s=h[c>>0]|0;l=(s<<24>>24)+-48|0;if(l>>>0<10){H=(h[o+2>>0]|0)==36;c=H?o+3|0:c;s=h[c>>0]|0;g=H?l:-1;t=H?1:t}else g=-1;o=s<<24>>24;t:do{if((o&-32|0)==32){l=0;while(1){if(!(1<<o+-32&75913)){m=l;o=c;break t}l=1<<(s<<24>>24)+-32|l;c=c+1|0;s=h[c>>0]|0;o=s<<24>>24;if((o&-32|0)!=32){m=l;o=c;break}}}else{m=0;o=c}}while(0);do{if(s<<24>>24==42){l=o+1|0;s=(h[l>>0]|0)+-48|0;if(s>>>0<10?(h[o+2>>0]|0)==36:0){f[i+(s<<2)>>2]=10;t=1;o=o+3|0;s=f[n+((h[l>>0]|0)+-48<<3)>>2]|0}else{if(t){a=-1;break e}if(!N){x=m;o=l;t=0;H=0;break}t=(f[r>>2]|0)+(4-1)&~(4-1);s=f[t>>2]|0;f[r>>2]=t+4;t=0;o=l}if((s|0)<0){x=m|8192;H=0-s|0}else{x=m;H=s}}else{l=(s<<24>>24)+-48|0;if(l>>>0<10){s=0;do{s=(s*10|0)+l|0;o=o+1|0;l=(h[o>>0]|0)+-48|0}while(l>>>0<10);if((s|0)<0){a=-1;break e}else{x=m;H=s}}else{x=m;H=0}}}while(0);t:do{if((h[o>>0]|0)==46){l=o+1|0;s=h[l>>0]|0;if(s<<24>>24!=42){c=(s<<24>>24)+-48|0;if(c>>>0<10){o=l;s=0}else{o=l;c=0;break}while(1){s=(s*10|0)+c|0;o=o+1|0;c=(h[o>>0]|0)+-48|0;if(c>>>0>=10){c=s;break t}}}l=o+2|0;s=(h[l>>0]|0)+-48|0;if(s>>>0<10?(h[o+3>>0]|0)==36:0){f[i+(s<<2)>>2]=10;o=o+4|0;c=f[n+((h[l>>0]|0)+-48<<3)>>2]|0;break}if(t){a=-1;break e}if(N){o=(f[r>>2]|0)+(4-1)&~(4-1);c=f[o>>2]|0;f[r>>2]=o+4;o=l}else{o=l;c=0}}else c=-1}while(0);v=0;while(1){s=(h[o>>0]|0)+-65|0;if(s>>>0>57){a=-1;break e}l=o+1|0;s=h[25126+(v*58|0)+s>>0]|0;m=s&255;if((m+-1|0)>>>0<8){o=l;v=m}else{O=l;break}}if(!(s<<24>>24)){a=-1;break}l=(g|0)>-1;do{if(s<<24>>24==19)if(l){a=-1;break e}else D=52;else{if(l){f[i+(g<<2)>>2]=m;L=n+(g<<3)|0;I=f[L+4>>2]|0;D=ee;f[D>>2]=f[L>>2];f[D+4>>2]=I;D=52;break}if(!N){a=0;break e}kl(ee,m,r)}}while(0);if((D|0)==52?(D=0,!N):0){E=O;o=T;continue}g=h[o>>0]|0;g=(v|0)!=0&(g&15|0)==3?g&-33:g;l=x&-65537;I=(x&8192|0)==0?x:l;t:do{switch(g|0){case 110:switch(v|0){case 0:{f[f[ee>>2]>>2]=a;E=O;o=T;continue e}case 1:{f[f[ee>>2]>>2]=a;E=O;o=T;continue e}case 2:{E=f[ee>>2]|0;f[E>>2]=a;f[E+4>>2]=((a|0)<0)<<31>>31;E=O;o=T;continue e}case 3:{d[f[ee>>2]>>1]=a;E=O;o=T;continue e}case 4:{h[f[ee>>2]>>0]=a;E=O;o=T;continue e}case 6:{f[f[ee>>2]>>2]=a;E=O;o=T;continue e}case 7:{E=f[ee>>2]|0;f[E>>2]=a;f[E+4>>2]=((a|0)<0)<<31>>31;E=O;o=T;continue e}default:{E=O;o=T;continue e}}case 112:{v=I|8;c=c>>>0>8?c:8;g=120;D=64;break}case 88:case 120:{v=I;D=64;break}case 111:{l=ee;s=f[l>>2]|0;l=f[l+4>>2]|0;if((s|0)==0&(l|0)==0)o=F;else{o=F;do{o=o+-1|0;h[o>>0]=s&7|48;s=Xl(s|0,l|0,3)|0;l=B}while(!((s|0)==0&(l|0)==0))}if(!(I&8)){s=I;v=0;m=25606;D=77}else{v=X-o+1|0;s=I;c=(c|0)<(v|0)?v:c;v=0;m=25606;D=77}break}case 105:case 100:{s=ee;o=f[s>>2]|0;s=f[s+4>>2]|0;if((s|0)<0){o=zl(0,0,o|0,s|0)|0;s=B;l=ee;f[l>>2]=o;f[l+4>>2]=s;l=1;m=25606;D=76;break t}if(!(I&2048)){m=I&1;l=m;m=(m|0)==0?25606:25608;D=76}else{l=1;m=25607;D=76}break}case 117:{s=ee;o=f[s>>2]|0;s=f[s+4>>2]|0;l=0;m=25606;D=76;break}case 99:{h[Y>>0]=f[ee>>2];E=Y;s=1;v=0;g=25606;o=F;break}case 109:{o=As()|0;o=ks(f[o>>2]|0)|0;D=82;break}case 115:{o=f[ee>>2]|0;o=(o|0)!=0?o:25616;D=82;break}case 67:{f[ae>>2]=f[ee>>2];f[q>>2]=0;f[ee>>2]=ae;c=-1;D=86;break}case 83:{if(!c){Cl(e,32,H,0,I);o=0;D=98}else D=86;break}case 65:case 71:case 70:case 69:case 97:case 103:case 102:case 101:{u=+y[ee>>3];f[ne>>2]=0;y[w>>3]=u;if((f[w+4>>2]|0)>=0)if(!(I&2048)){L=I&1;C=L;L=(L|0)==0?25624:25629}else{C=1;L=25626}else{u=-u;C=1;L=25623}y[w>>3]=u;P=f[w+4>>2]&2146435072;do{if(P>>>0<2146435072|(P|0)==2146435072&0<0){_=+Ls(u,ne)*2.0;s=_!=0.0;if(s)f[ne>>2]=(f[ne>>2]|0)+-1;A=g|32;if((A|0)==97){E=g&32;T=(E|0)==0?L:L+9|0;x=C|2;o=12-c|0;do{if(!(c>>>0>11|(o|0)==0)){u=8.0;do{o=o+-1|0;u=u*16.0}while((o|0)!=0);if((h[T>>0]|0)==45){u=-(u+(-_-u));break}else{u=_+u-u;break}}else u=_}while(0);s=f[ne>>2]|0;o=(s|0)<0?0-s|0:s;o=Pl(o,((o|0)<0)<<31>>31,Z)|0;if((o|0)==(Z|0)){h[J>>0]=48;o=J}h[o+-1>>0]=(s>>31&2)+43;v=o+-2|0;h[v>>0]=g+15;m=(c|0)<1;l=(I&8|0)==0;s=re;while(1){L=~~u;o=s+1|0;h[s>>0]=p[25590+L>>0]|E;u=(u-+(L|0))*16.0;do{if((o-K|0)==1){if(l&(m&u==0.0))break;h[o>>0]=46;o=s+2|0}}while(0);if(!(u!=0.0))break;else s=o}c=(c|0)!=0&(U+o|0)<(c|0)?z+c-v|0:$-v+o|0;l=c+x|0;Cl(e,32,H,l,I);if(!(f[e>>2]&32))cl(T,x,e)|0;Cl(e,48,H,l,I^65536);o=o-K|0;if(!(f[e>>2]&32))cl(re,o,e)|0;s=Q-v|0;Cl(e,48,c-(o+s)|0,0,0);if(!(f[e>>2]&32))cl(v,s,e)|0;Cl(e,32,H,l,I^8192);o=(l|0)<(H|0)?H:l;break}o=(c|0)<0?6:c;if(s){s=(f[ne>>2]|0)+-28|0;f[ne>>2]=s;u=_*268435456.0}else{u=_;s=f[ne>>2]|0}P=(s|0)<0?te:j;k=P;s=P;do{R=~~u>>>0;f[s>>2]=R;s=s+4|0;u=(u-+(R>>>0))*1.0e9}while(u!=0.0);l=s;s=f[ne>>2]|0;if((s|0)>0){m=P;while(1){v=(s|0)>29?29:s;c=l+-4|0;do{if(c>>>0<m>>>0)c=m;else{s=0;do{R=Gl(f[c>>2]|0,0,v|0)|0;R=Wl(R|0,B|0,s|0,0)|0;s=B;M=eu(R|0,s|0,1e9,0)|0;f[c>>2]=M;s=$l(R|0,s|0,1e9,0)|0;c=c+-4|0}while(c>>>0>=m>>>0);if(!s){c=m;break}c=m+-4|0;f[c>>2]=s}}while(0);while(1){if(l>>>0<=c>>>0)break;s=l+-4|0;if(!(f[s>>2]|0))l=s;else break}s=(f[ne>>2]|0)-v|0;f[ne>>2]=s;if((s|0)>0)m=c;else break}}else c=P;if((s|0)<0){T=((o+25|0)/9|0)+1|0;S=(A|0)==102;E=c;while(1){x=0-s|0;x=(x|0)>9?9:x;do{if(E>>>0<l>>>0){s=(1<<x)+-1|0;m=1e9>>>x;c=0;v=E;do{R=f[v>>2]|0;f[v>>2]=(R>>>x)+c;c=ce(R&s,m)|0;v=v+4|0}while(v>>>0<l>>>0);s=(f[E>>2]|0)==0?E+4|0:E;if(!c){c=s;break}f[l>>2]=c;c=s;l=l+4|0}else c=(f[E>>2]|0)==0?E+4|0:E}while(0);s=S?P:c;l=(l-s>>2|0)>(T|0)?s+(T<<2)|0:l;s=(f[ne>>2]|0)+x|0;f[ne>>2]=s;if((s|0)>=0){E=c;break}else E=c}}else E=c;do{if(E>>>0<l>>>0){s=(k-E>>2)*9|0;m=f[E>>2]|0;if(m>>>0<10)break;else c=10;do{c=c*10|0;s=s+1|0}while(m>>>0>=c>>>0)}else s=0}while(0);M=(A|0)==103;R=(o|0)!=0;c=o-((A|0)!=102?s:0)+((R&M)<<31>>31)|0;if((c|0)<(((l-k>>2)*9|0)+-9|0)){v=c+9216|0;S=(v|0)/9|0;c=P+(S+-1023<<2)|0;v=((v|0)%9|0)+1|0;if((v|0)<9){m=10;do{m=m*10|0;v=v+1|0}while((v|0)!=9)}else m=10;x=f[c>>2]|0;T=(x>>>0)%(m>>>0)|0;if((T|0)==0?(P+(S+-1022<<2)|0)==(l|0):0)m=E;else D=163;do{if((D|0)==163){D=0;_=(((x>>>0)/(m>>>0)|0)&1|0)==0?9007199254740992.0:9007199254740994.0;v=(m|0)/2|0;do{if(T>>>0<v>>>0)u=.5;else{if((T|0)==(v|0)?(P+(S+-1022<<2)|0)==(l|0):0){u=1.0;break}u=1.5}}while(0);do{if(C){if((h[L>>0]|0)!=45)break;_=-_;u=-u}}while(0);v=x-T|0;f[c>>2]=v;if(!(_+u!=_)){m=E;break}A=v+m|0;f[c>>2]=A;if(A>>>0>999999999){s=E;while(1){m=c+-4|0;f[c>>2]=0;if(m>>>0<s>>>0){s=s+-4|0;f[s>>2]=0}A=(f[m>>2]|0)+1|0;f[m>>2]=A;if(A>>>0>999999999)c=m;else{E=s;c=m;break}}}s=(k-E>>2)*9|0;v=f[E>>2]|0;if(v>>>0<10){m=E;break}else m=10;do{m=m*10|0;s=s+1|0}while(v>>>0>=m>>>0);m=E}}while(0);A=c+4|0;E=m;l=l>>>0>A>>>0?A:l}T=0-s|0;while(1){if(l>>>0<=E>>>0){S=0;A=l;break}c=l+-4|0;if(!(f[c>>2]|0))l=c;else{S=1;A=l;break}}do{if(M){o=(R&1^1)+o|0;if((o|0)>(s|0)&(s|0)>-5){g=g+-1|0;o=o+-1-s|0}else{g=g+-2|0;o=o+-1|0}l=I&8;if(l)break;do{if(S){l=f[A+-4>>2]|0;if(!l){c=9;break}if(!((l>>>0)%10|0)){m=10;c=0}else{c=0;break}do{m=m*10|0;c=c+1|0}while(((l>>>0)%(m>>>0)|0|0)==0)}else c=9}while(0);l=((A-k>>2)*9|0)+-9|0;if((g|32|0)==102){l=l-c|0;l=(l|0)<0?0:l;o=(o|0)<(l|0)?o:l;l=0;break}else{l=l+s-c|0;l=(l|0)<0?0:l;o=(o|0)<(l|0)?o:l;l=0;break}}else l=I&8}while(0);x=o|l;m=(x|0)!=0&1;v=(g|32|0)==102;if(v){s=(s|0)>0?s:0;g=0}else{c=(s|0)<0?T:s;c=Pl(c,((c|0)<0)<<31>>31,Z)|0;if((Q-c|0)<2)do{c=c+-1|0;h[c>>0]=48}while((Q-c|0)<2);h[c+-1>>0]=(s>>31&2)+43;k=c+-2|0;h[k>>0]=g;s=Q-k|0;g=k}T=C+1+o+m+s|0;Cl(e,32,H,T,I);if(!(f[e>>2]&32))cl(L,C,e)|0;Cl(e,48,H,T,I^65536);do{if(v){c=E>>>0>P>>>0?P:E;s=c;do{l=Pl(f[s>>2]|0,0,V)|0;do{if((s|0)==(c|0)){if((l|0)!=(V|0))break;h[W>>0]=48;l=W}else{if(l>>>0<=re>>>0)break;do{l=l+-1|0;h[l>>0]=48}while(l>>>0>re>>>0)}}while(0);if(!(f[e>>2]&32))cl(l,G-l|0,e)|0;s=s+4|0}while(s>>>0<=P>>>0);do{if(x){if(f[e>>2]&32)break;cl(25658,1,e)|0}}while(0);if((o|0)>0&s>>>0<A>>>0){l=s;while(1){s=Pl(f[l>>2]|0,0,V)|0;if(s>>>0>re>>>0)do{s=s+-1|0;h[s>>0]=48}while(s>>>0>re>>>0);if(!(f[e>>2]&32))cl(s,(o|0)>9?9:o,e)|0;l=l+4|0;s=o+-9|0;if(!((o|0)>9&l>>>0<A>>>0)){o=s;break}else o=s}}Cl(e,48,o+9|0,9,0)}else{v=S?A:E+4|0;if((o|0)>-1){m=(l|0)==0;c=E;do{s=Pl(f[c>>2]|0,0,V)|0;if((s|0)==(V|0)){h[W>>0]=48;s=W}do{if((c|0)==(E|0)){l=s+1|0;if(!(f[e>>2]&32))cl(s,1,e)|0;if(m&(o|0)<1){s=l;break}if(f[e>>2]&32){s=l;break}cl(25658,1,e)|0;s=l}else{if(s>>>0<=re>>>0)break;do{s=s+-1|0;h[s>>0]=48}while(s>>>0>re>>>0)}}while(0);l=G-s|0;if(!(f[e>>2]&32))cl(s,(o|0)>(l|0)?l:o,e)|0;o=o-l|0;c=c+4|0}while(c>>>0<v>>>0&(o|0)>-1)}Cl(e,48,o+18|0,18,0);if(f[e>>2]&32)break;cl(g,Q-g|0,e)|0}}while(0);Cl(e,32,H,T,I^8192);o=(T|0)<(H|0)?H:T}else{v=(g&32|0)!=0;m=u!=u|0.0!=0.0;s=m?0:C;c=s+3|0;Cl(e,32,H,c,l);o=f[e>>2]|0;if(!(o&32)){cl(L,s,e)|0;o=f[e>>2]|0}if(!(o&32))cl(m?v?25650:25654:v?25642:25646,3,e)|0;Cl(e,32,H,c,I^8192);o=(c|0)<(H|0)?H:c}}while(0);E=O;continue e}default:{l=I;s=c;v=0;g=25606;o=F}}}while(0);t:do{if((D|0)==64){l=ee;s=f[l>>2]|0;l=f[l+4>>2]|0;m=g&32;if(!((s|0)==0&(l|0)==0)){o=F;do{o=o+-1|0;h[o>>0]=p[25590+(s&15)>>0]|m;s=Xl(s|0,l|0,4)|0;l=B}while(!((s|0)==0&(l|0)==0));D=ee;if((v&8|0)==0|(f[D>>2]|0)==0&(f[D+4>>2]|0)==0){s=v;v=0;m=25606;D=77}else{s=v;v=2;m=25606+(g>>4)|0;D=77}}else{o=F;s=v;v=0;m=25606;D=77}}else if((D|0)==76){o=Pl(o,s,F)|0;s=I;v=l;D=77}else if((D|0)==82){D=0;I=yl(o,0,c)|0;L=(I|0)==0;E=o;s=L?c:I-o|0;v=0;g=25606;o=L?o+c|0:I}else if((D|0)==86){D=0;s=0;o=0;m=f[ee>>2]|0;while(1){l=f[m>>2]|0;if(!l)break;o=Fs(ie,l)|0;if((o|0)<0|o>>>0>(c-s|0)>>>0)break;s=o+s|0;if(c>>>0>s>>>0)m=m+4|0;else break}if((o|0)<0){a=-1;break e}Cl(e,32,H,s,I);if(!s){o=0;D=98}else{l=0;c=f[ee>>2]|0;while(1){o=f[c>>2]|0;if(!o){o=s;D=98;break t}o=Fs(ie,o)|0;l=o+l|0;if((l|0)>(s|0)){o=s;D=98;break t}if(!(f[e>>2]&32))cl(ie,o,e)|0;if(l>>>0>=s>>>0){o=s;D=98;break}else c=c+4|0}}}}while(0);if((D|0)==98){D=0;Cl(e,32,H,o,I^8192);E=O;o=(H|0)>(o|0)?H:o;continue}if((D|0)==77){D=0;l=(c|0)>-1?s&-65537:s;s=ee;s=(f[s>>2]|0)!=0|(f[s+4>>2]|0)!=0;if((c|0)!=0|s){s=(s&1^1)+(X-o)|0;E=o;s=(c|0)>(s|0)?c:s;g=m;o=F}else{E=F;s=0;g=m;o=F}}m=o-E|0;s=(s|0)<(m|0)?m:s;c=v+s|0;o=(H|0)<(c|0)?c:H;Cl(e,32,o,c,l);if(!(f[e>>2]&32))cl(g,v,e)|0;Cl(e,48,o,c,l^65536);Cl(e,48,s,m,0);if(!(f[e>>2]&32))cl(E,m,e)|0;Cl(e,32,o,c,l^8192);E=O}e:do{if((D|0)==245)if(!e)if(t){a=1;while(1){t=f[i+(a<<2)>>2]|0;if(!t)break;kl(n+(a<<3)|0,t,r);a=a+1|0;if((a|0)>=10){a=1;break e}}if((a|0)<10)while(1){if(f[i+(a<<2)>>2]|0){a=-1;break e}a=a+1|0;if((a|0)>=10){a=1;break}}else a=1}else a=0}while(0);b=oe;return a|0}function Al(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=e+20|0;i=f[n>>2]|0;e=(f[e+16>>2]|0)-i|0;e=e>>>0>r>>>0?r:e;Yl(i|0,t|0,e|0)|0;f[n>>2]=(f[n>>2]|0)+e;return r|0}function kl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0.0;e:do{if(t>>>0<=20)do{switch(t|0){case 9:{n=(f[r>>2]|0)+(4-1)&~(4-1);t=f[n>>2]|0;f[r>>2]=n+4;f[e>>2]=t;break e}case 10:{n=(f[r>>2]|0)+(4-1)&~(4-1);t=f[n>>2]|0;f[r>>2]=n+4;n=e;f[n>>2]=t;f[n+4>>2]=((t|0)<0)<<31>>31;break e}case 11:{n=(f[r>>2]|0)+(4-1)&~(4-1);t=f[n>>2]|0;f[r>>2]=n+4;n=e;f[n>>2]=t;f[n+4>>2]=0;break e}case 12:{n=(f[r>>2]|0)+(8-1)&~(8-1);t=n;i=f[t>>2]|0;t=f[t+4>>2]|0;f[r>>2]=n+8;n=e;f[n>>2]=i;f[n+4>>2]=t;break e}case 13:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;n=(n&65535)<<16>>16;i=e;f[i>>2]=n;f[i+4>>2]=((n|0)<0)<<31>>31;break e}case 14:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;i=e;f[i>>2]=n&65535;f[i+4>>2]=0;break e}case 15:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;n=(n&255)<<24>>24;i=e;f[i>>2]=n;f[i+4>>2]=((n|0)<0)<<31>>31;break e}case 16:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;i=e;f[i>>2]=n&255;f[i+4>>2]=0;break e}case 17:{i=(f[r>>2]|0)+(8-1)&~(8-1);a=+y[i>>3];f[r>>2]=i+8;y[e>>3]=a;break e}case 18:{i=(f[r>>2]|0)+(8-1)&~(8-1);a=+y[i>>3];f[r>>2]=i+8;y[e>>3]=a;break e}default:break e}}while(0)}while(0);return}function Pl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(t>>>0>0|(t|0)==0&e>>>0>4294967295)while(1){n=eu(e|0,t|0,10,0)|0;r=r+-1|0;h[r>>0]=n|48;n=$l(e|0,t|0,10,0)|0;if(t>>>0>9|(t|0)==9&e>>>0>4294967295){e=n;t=B}else{e=n;break}}if(e)while(1){r=r+-1|0;h[r>>0]=(e>>>0)%10|0|48;if(e>>>0<10)break;else e=(e>>>0)/10|0}return r|0}function Cl(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+256|0;o=s;do{if((r|0)>(n|0)&(i&73728|0)==0){i=r-n|0;Vl(o|0,t|0,(i>>>0>256?256:i)|0)|0;t=f[e>>2]|0;a=(t&32|0)==0;if(i>>>0>255){n=r-n|0;do{if(a){cl(o,256,e)|0;t=f[e>>2]|0}i=i+-256|0;a=(t&32|0)==0}while(i>>>0>255);if(a)i=n&255;else break}else if(!a)break;cl(o,i,e)|0}}while(0);b=s;return}function Ll(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=0,O=0,H=0,D=0,N=0,F=0;do{if(e>>>0<245){p=e>>>0<11?16:e+11&-8;e=p>>>3;s=f[735]|0;r=s>>>e;if(r&3){e=(r&1^1)+e|0;n=e<<1;r=2980+(n<<2)|0;n=2980+(n+2<<2)|0;i=f[n>>2]|0;a=i+8|0;o=f[a>>2]|0;do{if((r|0)!=(o|0)){if(o>>>0<(f[739]|0)>>>0)Ce();t=o+12|0;if((f[t>>2]|0)==(i|0)){f[t>>2]=r;f[n>>2]=o;break}else Ce()}else f[735]=s&~(1<<e)}while(0);F=e<<3;f[i+4>>2]=F|3;F=i+(F|4)|0;f[F>>2]=f[F>>2]|1;F=a;return F|0}o=f[737]|0;if(p>>>0>o>>>0){if(r){n=2<<e;n=r<<e&(n|0-n);n=(n&0-n)+-1|0;l=n>>>12&16;n=n>>>l;i=n>>>5&8;n=n>>>i;a=n>>>2&4;n=n>>>a;r=n>>>1&2;n=n>>>r;e=n>>>1&1;e=(i|l|a|r|e)+(n>>>e)|0;n=e<<1;r=2980+(n<<2)|0;n=2980+(n+2<<2)|0;a=f[n>>2]|0;l=a+8|0;i=f[l>>2]|0;do{if((r|0)!=(i|0)){if(i>>>0<(f[739]|0)>>>0)Ce();t=i+12|0;if((f[t>>2]|0)==(a|0)){f[t>>2]=r;f[n>>2]=i;u=f[737]|0;break}else Ce()}else{f[735]=s&~(1<<e);u=o}}while(0);F=e<<3;o=F-p|0;f[a+4>>2]=p|3;s=a+p|0;f[a+(p|4)>>2]=o|1;f[a+F>>2]=o;if(u){i=f[740]|0;r=u>>>3;t=r<<1;n=2980+(t<<2)|0;e=f[735]|0;r=1<<r;if(e&r){e=2980+(t+2<<2)|0;t=f[e>>2]|0;if(t>>>0<(f[739]|0)>>>0)Ce();else{c=e;h=t}}else{f[735]=e|r;c=2980+(t+2<<2)|0;h=n}f[c>>2]=i;f[h+12>>2]=i;f[i+8>>2]=h;f[i+12>>2]=n}f[737]=o;f[740]=s;F=l;return F|0}e=f[736]|0;if(e){r=(e&0-e)+-1|0;N=r>>>12&16;r=r>>>N;D=r>>>5&8;r=r>>>D;F=r>>>2&4;r=r>>>F;e=r>>>1&2;r=r>>>e;n=r>>>1&1;n=f[3244+((D|N|F|e|n)+(r>>>n)<<2)>>2]|0;r=(f[n+4>>2]&-8)-p|0;e=n;while(1){t=f[e+16>>2]|0;if(!t){t=f[e+20>>2]|0;if(!t){l=r;break}}e=(f[t+4>>2]&-8)-p|0;F=e>>>0<r>>>0;r=F?e:r;e=t;n=F?t:n}a=f[739]|0;if(n>>>0<a>>>0)Ce();s=n+p|0;if(n>>>0>=s>>>0)Ce();o=f[n+24>>2]|0;r=f[n+12>>2]|0;do{if((r|0)==(n|0)){e=n+20|0;t=f[e>>2]|0;if(!t){e=n+16|0;t=f[e>>2]|0;if(!t){d=0;break}}while(1){r=t+20|0;i=f[r>>2]|0;if(i){t=i;e=r;continue}r=t+16|0;i=f[r>>2]|0;if(!i)break;else{t=i;e=r}}if(e>>>0<a>>>0)Ce();else{f[e>>2]=0;d=t;break}}else{i=f[n+8>>2]|0;if(i>>>0<a>>>0)Ce();t=i+12|0;if((f[t>>2]|0)!=(n|0))Ce();e=r+8|0;if((f[e>>2]|0)==(n|0)){f[t>>2]=r;f[e>>2]=i;d=r;break}else Ce()}}while(0);do{if(o){t=f[n+28>>2]|0;e=3244+(t<<2)|0;if((n|0)==(f[e>>2]|0)){f[e>>2]=d;if(!d){f[736]=f[736]&~(1<<t);break}}else{if(o>>>0<(f[739]|0)>>>0)Ce();t=o+16|0;if((f[t>>2]|0)==(n|0))f[t>>2]=d;else f[o+20>>2]=d;if(!d)break}e=f[739]|0;if(d>>>0<e>>>0)Ce();f[d+24>>2]=o;t=f[n+16>>2]|0;do{if(t)if(t>>>0<e>>>0)Ce();else{f[d+16>>2]=t;f[t+24>>2]=d;break}}while(0);t=f[n+20>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Ce();else{f[d+20>>2]=t;f[t+24>>2]=d;break}}}while(0);if(l>>>0<16){F=l+p|0;f[n+4>>2]=F|3;F=n+(F+4)|0;f[F>>2]=f[F>>2]|1}else{f[n+4>>2]=p|3;f[n+(p|4)>>2]=l|1;f[n+(l+p)>>2]=l;t=f[737]|0;if(t){a=f[740]|0;r=t>>>3;t=r<<1;i=2980+(t<<2)|0;e=f[735]|0;r=1<<r;if(e&r){t=2980+(t+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Ce();else{m=t;v=e}}else{f[735]=e|r;m=2980+(t+2<<2)|0;v=i}f[m>>2]=a;f[v+12>>2]=a;f[a+8>>2]=v;f[a+12>>2]=i}f[737]=l;f[740]=s}F=n+8|0;return F|0}else v=p}else v=p}else if(e>>>0<=4294967231){e=e+11|0;h=e&-8;c=f[736]|0;if(c){r=0-h|0;e=e>>>8;if(e)if(h>>>0>16777215)u=31;else{v=(e+1048320|0)>>>16&8;E=e<<v;m=(E+520192|0)>>>16&4;E=E<<m;u=(E+245760|0)>>>16&2;u=14-(m|v|u)+(E<<u>>>15)|0;u=h>>>(u+7|0)&1|u<<1}else u=0;e=f[3244+(u<<2)>>2]|0;e:do{if(!e){i=0;e=0;E=86}else{o=r;i=0;s=h<<((u|0)==31?0:25-(u>>>1)|0);l=e;e=0;while(1){a=f[l+4>>2]&-8;r=a-h|0;if(r>>>0<o>>>0)if((a|0)==(h|0)){a=l;e=l;E=90;break e}else e=l;else r=o;E=f[l+20>>2]|0;l=f[l+16+(s>>>31<<2)>>2]|0;i=(E|0)==0|(E|0)==(l|0)?i:E;if(!l){E=86;break}else{o=r;s=s<<1}}}}while(0);if((E|0)==86){if((i|0)==0&(e|0)==0){e=2<<u;e=c&(e|0-e);if(!e){v=h;break}e=(e&0-e)+-1|0;d=e>>>12&16;e=e>>>d;c=e>>>5&8;e=e>>>c;m=e>>>2&4;e=e>>>m;v=e>>>1&2;e=e>>>v;i=e>>>1&1;i=f[3244+((c|d|m|v|i)+(e>>>i)<<2)>>2]|0;e=0}if(!i){s=r;l=e}else{a=i;E=90}}if((E|0)==90)while(1){E=0;v=(f[a+4>>2]&-8)-h|0;i=v>>>0<r>>>0;r=i?v:r;e=i?a:e;i=f[a+16>>2]|0;if(i){a=i;E=90;continue}a=f[a+20>>2]|0;if(!a){s=r;l=e;break}else E=90}if((l|0)!=0?s>>>0<((f[737]|0)-h|0)>>>0:0){i=f[739]|0;if(l>>>0<i>>>0)Ce();o=l+h|0;if(l>>>0>=o>>>0)Ce();a=f[l+24>>2]|0;r=f[l+12>>2]|0;do{if((r|0)==(l|0)){e=l+20|0;t=f[e>>2]|0;if(!t){e=l+16|0;t=f[e>>2]|0;if(!t){p=0;break}}while(1){r=t+20|0;n=f[r>>2]|0;if(n){t=n;e=r;continue}r=t+16|0;n=f[r>>2]|0;if(!n)break;else{t=n;e=r}}if(e>>>0<i>>>0)Ce();else{f[e>>2]=0;p=t;break}}else{n=f[l+8>>2]|0;if(n>>>0<i>>>0)Ce();t=n+12|0;if((f[t>>2]|0)!=(l|0))Ce();e=r+8|0;if((f[e>>2]|0)==(l|0)){f[t>>2]=r;f[e>>2]=n;p=r;break}else Ce()}}while(0);do{if(a){t=f[l+28>>2]|0;e=3244+(t<<2)|0;if((l|0)==(f[e>>2]|0)){f[e>>2]=p;if(!p){f[736]=f[736]&~(1<<t);break}}else{if(a>>>0<(f[739]|0)>>>0)Ce();t=a+16|0;if((f[t>>2]|0)==(l|0))f[t>>2]=p;else f[a+20>>2]=p;if(!p)break}e=f[739]|0;if(p>>>0<e>>>0)Ce();f[p+24>>2]=a;t=f[l+16>>2]|0;do{if(t)if(t>>>0<e>>>0)Ce();else{f[p+16>>2]=t;f[t+24>>2]=p;break}}while(0);t=f[l+20>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Ce();else{f[p+20>>2]=t;f[t+24>>2]=p;break}}}while(0);e:do{if(s>>>0>=16){f[l+4>>2]=h|3;f[l+(h|4)>>2]=s|1;f[l+(s+h)>>2]=s;t=s>>>3;if(s>>>0<256){e=t<<1;n=2980+(e<<2)|0;r=f[735]|0;t=1<<t;if(r&t){t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Ce();else{y=t;_=e}}else{f[735]=r|t;y=2980+(e+2<<2)|0;_=n}f[y>>2]=o;f[_+12>>2]=o;f[l+(h+8)>>2]=_;f[l+(h+12)>>2]=n;break}t=s>>>8;if(t)if(s>>>0>16777215)n=31;else{N=(t+1048320|0)>>>16&8;F=t<<N;D=(F+520192|0)>>>16&4;F=F<<D;n=(F+245760|0)>>>16&2;n=14-(D|N|n)+(F<<n>>>15)|0;n=s>>>(n+7|0)&1|n<<1}else n=0;t=3244+(n<<2)|0;f[l+(h+28)>>2]=n;f[l+(h+20)>>2]=0;f[l+(h+16)>>2]=0;e=f[736]|0;r=1<<n;if(!(e&r)){f[736]=e|r;f[t>>2]=o;f[l+(h+24)>>2]=t;f[l+(h+12)>>2]=o;f[l+(h+8)>>2]=o;break}t=f[t>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(s|0)){n=s<<((n|0)==31?0:25-(n>>>1)|0);while(1){e=t+16+(n>>>31<<2)|0;r=f[e>>2]|0;if(!r)break;if((f[r+4>>2]&-8|0)==(s|0)){T=r;break t}else{n=n<<1;t=r}}if(e>>>0<(f[739]|0)>>>0)Ce();else{f[e>>2]=o;f[l+(h+24)>>2]=t;f[l+(h+12)>>2]=o;f[l+(h+8)>>2]=o;break e}}else T=t}while(0);t=T+8|0;e=f[t>>2]|0;F=f[739]|0;if(e>>>0>=F>>>0&T>>>0>=F>>>0){f[e+12>>2]=o;f[t>>2]=o;f[l+(h+8)>>2]=e;f[l+(h+12)>>2]=T;f[l+(h+24)>>2]=0;break}else Ce()}else{F=s+h|0;f[l+4>>2]=F|3;F=l+(F+4)|0;f[F>>2]=f[F>>2]|1}}while(0);F=l+8|0;return F|0}else v=h}else v=h}else v=-1}while(0);r=f[737]|0;if(r>>>0>=v>>>0){t=r-v|0;e=f[740]|0;if(t>>>0>15){f[740]=e+v;f[737]=t;f[e+(v+4)>>2]=t|1;f[e+r>>2]=t;f[e+4>>2]=v|3}else{f[737]=0;f[740]=0;f[e+4>>2]=r|3;F=e+(r+4)|0;f[F>>2]=f[F>>2]|1}F=e+8|0;return F|0}e=f[738]|0;if(e>>>0>v>>>0){N=e-v|0;f[738]=N;F=f[741]|0;f[741]=F+v;f[F+(v+4)>>2]=N|1;f[F+4>>2]=v|3;F=F+8|0;return F|0}do{if(!(f[853]|0)){e=Ne(30)|0;if(!(e+-1&e)){f[855]=e;f[854]=e;f[856]=-1;f[857]=-1;f[858]=0;f[846]=0;T=(Ze(0)|0)&-16^1431655768;f[853]=T;break}else Ce()}}while(0);l=v+48|0;s=f[855]|0;u=v+47|0;o=s+u|0;s=0-s|0;c=o&s;if(c>>>0<=v>>>0){F=0;return F|0}e=f[845]|0;if((e|0)!=0?(_=f[843]|0,T=_+c|0,T>>>0<=_>>>0|T>>>0>e>>>0):0){F=0;return F|0}e:do{if(!(f[846]&4)){e=f[741]|0;t:do{if(e){i=3388;while(1){r=f[i>>2]|0;if(r>>>0<=e>>>0?(g=i+4|0,(r+(f[g>>2]|0)|0)>>>0>e>>>0):0){a=i;e=g;break}i=f[i+8>>2]|0;if(!i){E=174;break t}}r=o-(f[738]|0)&s;if(r>>>0<2147483647){i=He(r|0)|0;T=(i|0)==((f[a>>2]|0)+(f[e>>2]|0)|0);e=T?r:0;if(T){if((i|0)!=(-1|0)){w=i;m=e;E=194;break e}}else E=184}else e=0}else E=174}while(0);do{if((E|0)==174){a=He(0)|0;if((a|0)!=(-1|0)){e=a;r=f[854]|0;i=r+-1|0;if(!(i&e))r=c;else r=c-e+(i+e&0-r)|0;e=f[843]|0;i=e+r|0;if(r>>>0>v>>>0&r>>>0<2147483647){T=f[845]|0;if((T|0)!=0?i>>>0<=e>>>0|i>>>0>T>>>0:0){e=0;break}i=He(r|0)|0;T=(i|0)==(a|0);e=T?r:0;if(T){w=a;m=e;E=194;break e}else E=184}else e=0}else e=0}}while(0);t:do{if((E|0)==184){a=0-r|0;do{if(l>>>0>r>>>0&(r>>>0<2147483647&(i|0)!=(-1|0))?(b=f[855]|0,b=u-r+b&0-b,b>>>0<2147483647):0)if((He(b|0)|0)==(-1|0)){He(a|0)|0;break t}else{r=b+r|0;break}}while(0);if((i|0)!=(-1|0)){w=i;m=r;E=194;break e}}}while(0);f[846]=f[846]|4;E=191}else{e=0;E=191}}while(0);if((((E|0)==191?c>>>0<2147483647:0)?(w=He(c|0)|0,x=He(0)|0,w>>>0<x>>>0&((w|0)!=(-1|0)&(x|0)!=(-1|0))):0)?(S=x-w|0,M=S>>>0>(v+40|0)>>>0,M):0){m=M?S:e;E=194}if((E|0)==194){e=(f[843]|0)+m|0;f[843]=e;if(e>>>0>(f[844]|0)>>>0)f[844]=e;o=f[741]|0;e:do{if(o){a=3388;do{e=f[a>>2]|0;r=a+4|0;i=f[r>>2]|0;if((w|0)==(e+i|0)){R=e;A=r;k=i;P=a;E=204;break}a=f[a+8>>2]|0}while((a|0)!=0);if(((E|0)==204?(f[P+12>>2]&8|0)==0:0)?o>>>0<w>>>0&o>>>0>=R>>>0:0){f[A>>2]=k+m;F=(f[738]|0)+m|0;N=o+8|0;N=(N&7|0)==0?0:0-N&7;D=F-N|0;f[741]=o+N;f[738]=D;f[o+(N+4)>>2]=D|1;f[o+(F+4)>>2]=40;f[742]=f[857];break}e=f[739]|0;if(w>>>0<e>>>0){f[739]=w;e=w}r=w+m|0;a=3388;while(1){if((f[a>>2]|0)==(r|0)){i=a;r=a;E=212;break}a=f[a+8>>2]|0;if(!a){r=3388;break}}if((E|0)==212)if(!(f[r+12>>2]&8)){f[i>>2]=w;d=r+4|0;f[d>>2]=(f[d>>2]|0)+m;d=w+8|0;d=(d&7|0)==0?0:0-d&7;u=w+(m+8)|0;u=(u&7|0)==0?0:0-u&7;t=w+(u+m)|0;h=d+v|0;p=w+h|0;c=t-(w+d)-v|0;f[w+(d+4)>>2]=v|3;t:do{if((t|0)!=(o|0)){if((t|0)==(f[740]|0)){F=(f[737]|0)+c|0;f[737]=F;f[740]=p;f[w+(h+4)>>2]=F|1;f[w+(F+h)>>2]=F;break}s=m+4|0;r=f[w+(s+u)>>2]|0;if((r&3|0)==1){l=r&-8;a=r>>>3;r:do{if(r>>>0>=256){o=f[w+((u|24)+m)>>2]|0;n=f[w+(m+12+u)>>2]|0;do{if((n|0)==(t|0)){i=u|16;n=w+(s+i)|0;r=f[n>>2]|0;if(!r){n=w+(i+m)|0;r=f[n>>2]|0;if(!r){H=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<e>>>0)Ce();else{f[n>>2]=0;H=r;break}}else{i=f[w+((u|8)+m)>>2]|0;if(i>>>0<e>>>0)Ce();e=i+12|0;if((f[e>>2]|0)!=(t|0))Ce();r=n+8|0;if((f[r>>2]|0)==(t|0)){f[e>>2]=n;f[r>>2]=i;H=n;break}else Ce()}}while(0);if(!o)break;e=f[w+(m+28+u)>>2]|0;r=3244+(e<<2)|0;do{if((t|0)!=(f[r>>2]|0)){if(o>>>0<(f[739]|0)>>>0)Ce();e=o+16|0;if((f[e>>2]|0)==(t|0))f[e>>2]=H;else f[o+20>>2]=H;if(!H)break r}else{f[r>>2]=H;if(H)break;f[736]=f[736]&~(1<<e);break r}}while(0);r=f[739]|0;if(H>>>0<r>>>0)Ce();f[H+24>>2]=o;t=u|16;e=f[w+(t+m)>>2]|0;do{if(e)if(e>>>0<r>>>0)Ce();else{f[H+16>>2]=e;f[e+24>>2]=H;break}}while(0);t=f[w+(s+t)>>2]|0;if(!t)break;if(t>>>0<(f[739]|0)>>>0)Ce();else{f[H+20>>2]=t;f[t+24>>2]=H;break}}else{n=f[w+((u|8)+m)>>2]|0;i=f[w+(m+12+u)>>2]|0;r=2980+(a<<1<<2)|0;do{if((n|0)!=(r|0)){if(n>>>0<e>>>0)Ce();if((f[n+12>>2]|0)==(t|0))break;Ce()}}while(0);if((i|0)==(n|0)){f[735]=f[735]&~(1<<a);break}do{if((i|0)==(r|0))C=i+8|0;else{if(i>>>0<e>>>0)Ce();e=i+8|0;if((f[e>>2]|0)==(t|0)){C=e;break}Ce()}}while(0);f[n+12>>2]=i;f[C>>2]=n}}while(0);t=w+((l|u)+m)|0;i=l+c|0}else i=c;t=t+4|0;f[t>>2]=f[t>>2]&-2;f[w+(h+4)>>2]=i|1;f[w+(i+h)>>2]=i;t=i>>>3;if(i>>>0<256){e=t<<1;n=2980+(e<<2)|0;r=f[735]|0;t=1<<t;do{if(!(r&t)){f[735]=r|t;D=2980+(e+2<<2)|0;N=n}else{t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0>=(f[739]|0)>>>0){D=t;N=e;break}Ce()}}while(0);f[D>>2]=p;f[N+12>>2]=p;f[w+(h+8)>>2]=N;f[w+(h+12)>>2]=n;break}t=i>>>8;do{if(!t)n=0;else{if(i>>>0>16777215){n=31;break}D=(t+1048320|0)>>>16&8;N=t<<D;H=(N+520192|0)>>>16&4;N=N<<H;n=(N+245760|0)>>>16&2;n=14-(H|D|n)+(N<<n>>>15)|0;n=i>>>(n+7|0)&1|n<<1}}while(0);t=3244+(n<<2)|0;f[w+(h+28)>>2]=n;f[w+(h+20)>>2]=0;f[w+(h+16)>>2]=0;e=f[736]|0;r=1<<n;if(!(e&r)){f[736]=e|r;f[t>>2]=p;f[w+(h+24)>>2]=t;f[w+(h+12)>>2]=p;f[w+(h+8)>>2]=p;break}t=f[t>>2]|0;r:do{if((f[t+4>>2]&-8|0)!=(i|0)){n=i<<((n|0)==31?0:25-(n>>>1)|0);while(1){e=t+16+(n>>>31<<2)|0;r=f[e>>2]|0;if(!r)break;if((f[r+4>>2]&-8|0)==(i|0)){F=r;break r}else{n=n<<1;t=r}}if(e>>>0<(f[739]|0)>>>0)Ce();else{f[e>>2]=p;f[w+(h+24)>>2]=t;f[w+(h+12)>>2]=p;f[w+(h+8)>>2]=p;break t}}else F=t}while(0);t=F+8|0;e=f[t>>2]|0;N=f[739]|0;if(e>>>0>=N>>>0&F>>>0>=N>>>0){f[e+12>>2]=p;f[t>>2]=p;f[w+(h+8)>>2]=e;f[w+(h+12)>>2]=F;f[w+(h+24)>>2]=0;break}else Ce()}else{F=(f[738]|0)+c|0;f[738]=F;f[741]=p;f[w+(h+4)>>2]=F|1}}while(0);F=w+(d|8)|0;return F|0}else r=3388;while(1){e=f[r>>2]|0;if(e>>>0<=o>>>0?(t=f[r+4>>2]|0,n=e+t|0,n>>>0>o>>>0):0)break;r=f[r+8>>2]|0}i=e+(t+-39)|0;e=e+(t+-47+((i&7|0)==0?0:0-i&7))|0;i=o+16|0;e=e>>>0<i>>>0?o:e;t=e+8|0;r=w+8|0;r=(r&7|0)==0?0:0-r&7;F=m+-40-r|0;f[741]=w+r;f[738]=F;f[w+(r+4)>>2]=F|1;f[w+(m+-36)>>2]=40;f[742]=f[857];r=e+4|0;f[r>>2]=27;f[t>>2]=f[847];f[t+4>>2]=f[848];f[t+8>>2]=f[849];f[t+12>>2]=f[850];f[847]=w;f[848]=m;f[850]=0;f[849]=t;t=e+28|0;f[t>>2]=7;if((e+32|0)>>>0<n>>>0)do{F=t;t=t+4|0;f[t>>2]=7}while((F+8|0)>>>0<n>>>0);if((e|0)!=(o|0)){a=e-o|0;f[r>>2]=f[r>>2]&-2;f[o+4>>2]=a|1;f[e>>2]=a;t=a>>>3;if(a>>>0<256){e=t<<1;n=2980+(e<<2)|0;r=f[735]|0;t=1<<t;if(r&t){t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Ce();else{L=t;I=e}}else{f[735]=r|t;L=2980+(e+2<<2)|0;I=n}f[L>>2]=o;f[I+12>>2]=o;f[o+8>>2]=I;f[o+12>>2]=n;break}t=a>>>8;if(t)if(a>>>0>16777215)n=31;else{N=(t+1048320|0)>>>16&8;F=t<<N;D=(F+520192|0)>>>16&4;F=F<<D;n=(F+245760|0)>>>16&2;n=14-(D|N|n)+(F<<n>>>15)|0;n=a>>>(n+7|0)&1|n<<1}else n=0;r=3244+(n<<2)|0;f[o+28>>2]=n;f[o+20>>2]=0;f[i>>2]=0;t=f[736]|0;e=1<<n;if(!(t&e)){f[736]=t|e;f[r>>2]=o;f[o+24>>2]=r;f[o+12>>2]=o;f[o+8>>2]=o;break}t=f[r>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(a|0)){n=a<<((n|0)==31?0:25-(n>>>1)|0);while(1){e=t+16+(n>>>31<<2)|0;r=f[e>>2]|0;if(!r)break;if((f[r+4>>2]&-8|0)==(a|0)){O=r;break t}else{n=n<<1;t=r}}if(e>>>0<(f[739]|0)>>>0)Ce();else{f[e>>2]=o;f[o+24>>2]=t;f[o+12>>2]=o;f[o+8>>2]=o;break e}}else O=t}while(0);t=O+8|0;e=f[t>>2]|0;F=f[739]|0;if(e>>>0>=F>>>0&O>>>0>=F>>>0){f[e+12>>2]=o;f[t>>2]=o;f[o+8>>2]=e;f[o+12>>2]=O;f[o+24>>2]=0;break}else Ce()}}else{F=f[739]|0;if((F|0)==0|w>>>0<F>>>0)f[739]=w;f[847]=w;f[848]=m;f[850]=0;f[744]=f[853];f[743]=-1;t=0;do{F=t<<1;N=2980+(F<<2)|0;f[2980+(F+3<<2)>>2]=N;f[2980+(F+2<<2)>>2]=N;t=t+1|0}while((t|0)!=32);F=w+8|0;F=(F&7|0)==0?0:0-F&7;N=m+-40-F|0;f[741]=w+F;f[738]=N;f[w+(F+4)>>2]=N|1;f[w+(m+-36)>>2]=40;f[742]=f[857]}}while(0);t=f[738]|0;if(t>>>0>v>>>0){N=t-v|0;f[738]=N;F=f[741]|0;f[741]=F+v;f[F+(v+4)>>2]=N|1;f[F+4>>2]=v|3;F=F+8|0;return F|0}}F=As()|0;f[F>>2]=12;F=0;return F|0}function Il(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=0;if(!e)return;t=e+-8|0;s=f[739]|0;if(t>>>0<s>>>0)Ce();r=f[e+-4>>2]|0;n=r&3;if((n|0)==1)Ce();p=r&-8;v=e+(p+-8)|0;do{if(!(r&1)){t=f[t>>2]|0;if(!n)return;l=-8-t|0;c=e+l|0;h=t+p|0;if(c>>>0<s>>>0)Ce();if((c|0)==(f[740]|0)){t=e+(p+-4)|0;r=f[t>>2]|0;if((r&3|0)!=3){b=c;a=h;break}f[737]=h;f[t>>2]=r&-2;f[e+(l+4)>>2]=h|1;f[v>>2]=h;return}i=t>>>3;if(t>>>0<256){n=f[e+(l+8)>>2]|0;r=f[e+(l+12)>>2]|0;t=2980+(i<<1<<2)|0;if((n|0)!=(t|0)){if(n>>>0<s>>>0)Ce();if((f[n+12>>2]|0)!=(c|0))Ce()}if((r|0)==(n|0)){f[735]=f[735]&~(1<<i);b=c;a=h;break}if((r|0)!=(t|0)){if(r>>>0<s>>>0)Ce();t=r+8|0;if((f[t>>2]|0)==(c|0))o=t;else Ce()}else o=r+8|0;f[n+12>>2]=r;f[o>>2]=n;b=c;a=h;break}o=f[e+(l+24)>>2]|0;n=f[e+(l+12)>>2]|0;do{if((n|0)==(c|0)){r=e+(l+20)|0;t=f[r>>2]|0;if(!t){r=e+(l+16)|0;t=f[r>>2]|0;if(!t){u=0;break}}while(1){n=t+20|0;i=f[n>>2]|0;if(i){t=i;r=n;continue}n=t+16|0;i=f[n>>2]|0;if(!i)break;else{t=i;r=n}}if(r>>>0<s>>>0)Ce();else{f[r>>2]=0;u=t;break}}else{i=f[e+(l+8)>>2]|0;if(i>>>0<s>>>0)Ce();t=i+12|0;if((f[t>>2]|0)!=(c|0))Ce();r=n+8|0;if((f[r>>2]|0)==(c|0)){f[t>>2]=n;f[r>>2]=i;u=n;break}else Ce()}}while(0);if(o){t=f[e+(l+28)>>2]|0;r=3244+(t<<2)|0;if((c|0)==(f[r>>2]|0)){f[r>>2]=u;if(!u){f[736]=f[736]&~(1<<t);b=c;a=h;break}}else{if(o>>>0<(f[739]|0)>>>0)Ce();t=o+16|0;if((f[t>>2]|0)==(c|0))f[t>>2]=u;else f[o+20>>2]=u;if(!u){b=c;a=h;break}}r=f[739]|0;if(u>>>0<r>>>0)Ce();f[u+24>>2]=o;t=f[e+(l+16)>>2]|0;do{if(t)if(t>>>0<r>>>0)Ce();else{f[u+16>>2]=t;f[t+24>>2]=u;break}}while(0);t=f[e+(l+20)>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Ce();else{f[u+20>>2]=t;f[t+24>>2]=u;b=c;a=h;break}else{b=c;a=h}}else{b=c;a=h}}else{b=t;a=p}}while(0);if(b>>>0>=v>>>0)Ce();t=e+(p+-4)|0;r=f[t>>2]|0;if(!(r&1))Ce();if(!(r&2)){if((v|0)==(f[741]|0)){_=(f[738]|0)+a|0;f[738]=_;f[741]=b;f[b+4>>2]=_|1;if((b|0)!=(f[740]|0))return;f[740]=0;f[737]=0;return}if((v|0)==(f[740]|0)){_=(f[737]|0)+a|0;f[737]=_;f[740]=b;f[b+4>>2]=_|1;f[b+_>>2]=_;return}a=(r&-8)+a|0;i=r>>>3;do{if(r>>>0>=256){o=f[e+(p+16)>>2]|0;t=f[e+(p|4)>>2]|0;do{if((t|0)==(v|0)){r=e+(p+12)|0;t=f[r>>2]|0;if(!t){r=e+(p+8)|0;t=f[r>>2]|0;if(!t){m=0;break}}while(1){n=t+20|0;i=f[n>>2]|0;if(i){t=i;r=n;continue}n=t+16|0;i=f[n>>2]|0;if(!i)break;else{t=i;r=n}}if(r>>>0<(f[739]|0)>>>0)Ce();else{f[r>>2]=0;m=t;break}}else{r=f[e+p>>2]|0;if(r>>>0<(f[739]|0)>>>0)Ce();n=r+12|0;if((f[n>>2]|0)!=(v|0))Ce();i=t+8|0;if((f[i>>2]|0)==(v|0)){f[n>>2]=t;f[i>>2]=r;m=t;break}else Ce()}}while(0);if(o){t=f[e+(p+20)>>2]|0;r=3244+(t<<2)|0;if((v|0)==(f[r>>2]|0)){f[r>>2]=m;if(!m){f[736]=f[736]&~(1<<t);break}}else{if(o>>>0<(f[739]|0)>>>0)Ce();t=o+16|0;if((f[t>>2]|0)==(v|0))f[t>>2]=m;else f[o+20>>2]=m;if(!m)break}r=f[739]|0;if(m>>>0<r>>>0)Ce();f[m+24>>2]=o;t=f[e+(p+8)>>2]|0;do{if(t)if(t>>>0<r>>>0)Ce();else{f[m+16>>2]=t;f[t+24>>2]=m;break}}while(0);t=f[e+(p+12)>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Ce();else{f[m+20>>2]=t;f[t+24>>2]=m;break}}}else{n=f[e+p>>2]|0;r=f[e+(p|4)>>2]|0;t=2980+(i<<1<<2)|0;if((n|0)!=(t|0)){if(n>>>0<(f[739]|0)>>>0)Ce();if((f[n+12>>2]|0)!=(v|0))Ce()}if((r|0)==(n|0)){f[735]=f[735]&~(1<<i);break}if((r|0)!=(t|0)){if(r>>>0<(f[739]|0)>>>0)Ce();t=r+8|0;if((f[t>>2]|0)==(v|0))d=t;else Ce()}else d=r+8|0;f[n+12>>2]=r;f[d>>2]=n}}while(0);f[b+4>>2]=a|1;f[b+a>>2]=a;if((b|0)==(f[740]|0)){f[737]=a;return}}else{f[t>>2]=r&-2;f[b+4>>2]=a|1;f[b+a>>2]=a}t=a>>>3;if(a>>>0<256){r=t<<1;i=2980+(r<<2)|0;n=f[735]|0;t=1<<t;if(n&t){t=2980+(r+2<<2)|0;r=f[t>>2]|0;if(r>>>0<(f[739]|0)>>>0)Ce();else{g=t;y=r}}else{f[735]=n|t;g=2980+(r+2<<2)|0;y=i}f[g>>2]=b;f[y+12>>2]=b;f[b+8>>2]=y;f[b+12>>2]=i;return}t=a>>>8;if(t)if(a>>>0>16777215)i=31;else{g=(t+1048320|0)>>>16&8;y=t<<g;v=(y+520192|0)>>>16&4;y=y<<v;i=(y+245760|0)>>>16&2;i=14-(v|g|i)+(y<<i>>>15)|0;i=a>>>(i+7|0)&1|i<<1}else i=0;t=3244+(i<<2)|0;f[b+28>>2]=i;f[b+20>>2]=0;f[b+16>>2]=0;r=f[736]|0;n=1<<i;e:do{if(r&n){t=f[t>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(a|0)){i=a<<((i|0)==31?0:25-(i>>>1)|0);while(1){r=t+16+(i>>>31<<2)|0;n=f[r>>2]|0;if(!n)break;if((f[n+4>>2]&-8|0)==(a|0)){_=n;break t}else{i=i<<1;t=n}}if(r>>>0<(f[739]|0)>>>0)Ce();else{f[r>>2]=b;f[b+24>>2]=t;f[b+12>>2]=b;f[b+8>>2]=b;break e}}else _=t}while(0);t=_+8|0;r=f[t>>2]|0;y=f[739]|0;if(r>>>0>=y>>>0&_>>>0>=y>>>0){f[r+12>>2]=b;f[t>>2]=b;f[b+8>>2]=r;f[b+12>>2]=_;f[b+24>>2]=0;break}else Ce()}else{f[736]=r|n;f[t>>2]=b;f[b+24>>2]=t;f[b+12>>2]=b;f[b+8>>2]=b}}while(0);b=(f[743]|0)+-1|0;f[743]=b;if(!b)t=3396;else return;while(1){t=f[t>>2]|0;if(!t)break;else t=t+8|0}f[743]=-1;return}function Ol(e,t){e=e|0;t=t|0;var r=0;if(e){r=ce(t,e)|0;if((t|e)>>>0>65535)r=((r>>>0)/(e>>>0)|0|0)==(t|0)?r:-1}else r=0;t=Ll(r)|0;if(!t)return t|0;if(!(f[t+-4>>2]&3))return t|0;Vl(t|0,0,r|0)|0;return t|0}function Hl(e,t){e=e|0;t=t|0;var r=0,n=0;if(!e){e=Ll(t)|0;return e|0}if(t>>>0>4294967231){e=As()|0;f[e>>2]=12;e=0;return e|0}r=Nl(e+-8|0,t>>>0<11?16:t+11&-8)|0;if(r){e=r+8|0;return e|0}r=Ll(t)|0;if(!r){e=0;return e|0}n=f[e+-4>>2]|0;n=(n&-8)-((n&3|0)==0?8:4)|0;Yl(r|0,e|0,(n>>>0<t>>>0?n:t)|0)|0;Il(e);e=r;return e|0}function Dl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;do{if((t|0)!=8){n=t>>>2;if((t&3|0)!=0|(n|0)==0){e=22;return e|0}if(n+1073741823&n){e=22;return e|0}if((-64-t|0)>>>0<r>>>0){e=12;return e|0}else{n=Fl(t>>>0<16?16:t,r)|0;break}}else n=Ll(r)|0}while(0);if(!n){e=12;return e|0}f[e>>2]=n;e=0;return e|0}function Nl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;p=e+4|0;m=f[p>>2]|0;l=m&-8;c=e+l|0;s=f[739]|0;r=m&3;if(!((r|0)!=1&e>>>0>=s>>>0&e>>>0<c>>>0))Ce();n=e+(l|4)|0;i=f[n>>2]|0;if(!(i&1))Ce();if(!r){if(t>>>0<256){e=0;return e|0}if(l>>>0>=(t+4|0)>>>0?(l-t|0)>>>0<=f[855]<<1>>>0:0)return e|0;e=0;return e|0}if(l>>>0>=t>>>0){r=l-t|0;if(r>>>0<=15)return e|0;f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=r|3;f[n>>2]=f[n>>2]|1;Ul(e+t|0,r);return e|0}if((c|0)==(f[741]|0)){r=(f[738]|0)+l|0;if(r>>>0<=t>>>0){e=0;return e|0}d=r-t|0;f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=d|1;f[741]=e+t;f[738]=d;return e|0}if((c|0)==(f[740]|0)){n=(f[737]|0)+l|0;if(n>>>0<t>>>0){e=0;return e|0}r=n-t|0;if(r>>>0>15){f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=r|1;f[e+n>>2]=r;n=e+(n+4)|0;f[n>>2]=f[n>>2]&-2;n=e+t|0}else{f[p>>2]=m&1|n|2;n=e+(n+4)|0;f[n>>2]=f[n>>2]|1;n=0;r=0}f[737]=r;f[740]=n;return e|0}if(i&2){e=0;return e|0}h=(i&-8)+l|0;if(h>>>0<t>>>0){e=0;return e|0}d=h-t|0;a=i>>>3;do{if(i>>>0>=256){o=f[e+(l+24)>>2]|0;a=f[e+(l+12)>>2]|0;do{if((a|0)==(c|0)){n=e+(l+20)|0;r=f[n>>2]|0;if(!r){n=e+(l+16)|0;r=f[n>>2]|0;if(!r){u=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<s>>>0)Ce();else{f[n>>2]=0;u=r;break}}else{i=f[e+(l+8)>>2]|0;if(i>>>0<s>>>0)Ce();r=i+12|0;if((f[r>>2]|0)!=(c|0))Ce();n=a+8|0;if((f[n>>2]|0)==(c|0)){f[r>>2]=a;f[n>>2]=i;u=a;break}else Ce()}}while(0);if(o){r=f[e+(l+28)>>2]|0;n=3244+(r<<2)|0;if((c|0)==(f[n>>2]|0)){f[n>>2]=u;if(!u){f[736]=f[736]&~(1<<r);break}}else{if(o>>>0<(f[739]|0)>>>0)Ce();r=o+16|0;if((f[r>>2]|0)==(c|0))f[r>>2]=u;else f[o+20>>2]=u;if(!u)break}n=f[739]|0;if(u>>>0<n>>>0)Ce();f[u+24>>2]=o;r=f[e+(l+16)>>2]|0;do{if(r)if(r>>>0<n>>>0)Ce();else{f[u+16>>2]=r;f[r+24>>2]=u;break}}while(0);r=f[e+(l+20)>>2]|0;if(r)if(r>>>0<(f[739]|0)>>>0)Ce();else{f[u+20>>2]=r;f[r+24>>2]=u;break}}}else{i=f[e+(l+8)>>2]|0;n=f[e+(l+12)>>2]|0;r=2980+(a<<1<<2)|0;if((i|0)!=(r|0)){if(i>>>0<s>>>0)Ce();if((f[i+12>>2]|0)!=(c|0))Ce()}if((n|0)==(i|0)){f[735]=f[735]&~(1<<a);break}if((n|0)!=(r|0)){if(n>>>0<s>>>0)Ce();r=n+8|0;if((f[r>>2]|0)==(c|0))o=r;else Ce()}else o=n+8|0;f[i+12>>2]=n;f[o>>2]=i}}while(0);if(d>>>0<16){f[p>>2]=h|m&1|2;t=e+(h|4)|0;f[t>>2]=f[t>>2]|1;return e|0}else{f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=d|3;m=e+(h|4)|0;f[m>>2]=f[m>>2]|1;Ul(e+t|0,d);return e|0}return 0}function Fl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0;e=e>>>0<16?16:e;if(e+-1&e){r=16;while(1)if(r>>>0<e>>>0)r=r<<1;else{e=r;break}}if((-64-e|0)>>>0<=t>>>0){s=As()|0;f[s>>2]=12;s=0;return s|0}o=t>>>0<11?16:t+11&-8;n=Ll(o+12+e|0)|0;if(!n){s=0;return s|0}t=n+-8|0;r=e+-1|0;do{if(n&r){i=n+r&0-e;r=i+-8|0;a=t;i=(r-a|0)>>>0>15?r:i+(e+-8)|0;a=i-a|0;e=n+-4|0;n=f[e>>2]|0;r=(n&-8)-a|0;if(!(n&3)){f[i>>2]=(f[t>>2]|0)+a;f[i+4>>2]=r;t=i;break}else{n=i+4|0;f[n>>2]=r|f[n>>2]&1|2;r=i+(r+4)|0;f[r>>2]=f[r>>2]|1;f[e>>2]=a|f[e>>2]&1|2;f[n>>2]=f[n>>2]|1;Ul(t,a);t=i;break}}}while(0);e=t+4|0;r=f[e>>2]|0;if((r&3|0)!=0?(s=r&-8,s>>>0>(o+16|0)>>>0):0){a=s-o|0;f[e>>2]=o|r&1|2;f[t+(o|4)>>2]=a|3;s=t+(s|4)|0;f[s>>2]=f[s>>2]|1;Ul(t+o|0,a)}s=t+8|0;return s|0}function Ul(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0;v=e+t|0;r=f[e+4>>2]|0;do{if(!(r&1)){u=f[e>>2]|0;if(!(r&3))return;d=e+(0-u)|0;h=u+t|0;l=f[739]|0;if(d>>>0<l>>>0)Ce();if((d|0)==(f[740]|0)){n=e+(t+4)|0;r=f[n>>2]|0;if((r&3|0)!=3){_=d;o=h;break}f[737]=h;f[n>>2]=r&-2;f[e+(4-u)>>2]=h|1;f[v>>2]=h;return}a=u>>>3;if(u>>>0<256){i=f[e+(8-u)>>2]|0;n=f[e+(12-u)>>2]|0;r=2980+(a<<1<<2)|0;if((i|0)!=(r|0)){if(i>>>0<l>>>0)Ce();if((f[i+12>>2]|0)!=(d|0))Ce()}if((n|0)==(i|0)){f[735]=f[735]&~(1<<a);_=d;o=h;break}if((n|0)!=(r|0)){if(n>>>0<l>>>0)Ce();r=n+8|0;if((f[r>>2]|0)==(d|0))s=r;else Ce()}else s=n+8|0;f[i+12>>2]=n;f[s>>2]=i;_=d;o=h;break}s=f[e+(24-u)>>2]|0;i=f[e+(12-u)>>2]|0;do{if((i|0)==(d|0)){i=16-u|0;n=e+(i+4)|0;r=f[n>>2]|0;if(!r){n=e+i|0;r=f[n>>2]|0;if(!r){c=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<l>>>0)Ce();else{f[n>>2]=0;c=r;break}}else{a=f[e+(8-u)>>2]|0;if(a>>>0<l>>>0)Ce();r=a+12|0;if((f[r>>2]|0)!=(d|0))Ce();n=i+8|0;if((f[n>>2]|0)==(d|0)){f[r>>2]=i;f[n>>2]=a;c=i;break}else Ce()}}while(0);if(s){r=f[e+(28-u)>>2]|0;n=3244+(r<<2)|0;if((d|0)==(f[n>>2]|0)){f[n>>2]=c;if(!c){f[736]=f[736]&~(1<<r);_=d;o=h;break}}else{if(s>>>0<(f[739]|0)>>>0)Ce();r=s+16|0;if((f[r>>2]|0)==(d|0))f[r>>2]=c;else f[s+20>>2]=c;if(!c){_=d;o=h;break}}i=f[739]|0;if(c>>>0<i>>>0)Ce();f[c+24>>2]=s;r=16-u|0;n=f[e+r>>2]|0;do{if(n)if(n>>>0<i>>>0)Ce();else{f[c+16>>2]=n;f[n+24>>2]=c;break}}while(0);r=f[e+(r+4)>>2]|0;if(r)if(r>>>0<(f[739]|0)>>>0)Ce();else{f[c+20>>2]=r;f[r+24>>2]=c;_=d;o=h;break}else{_=d;o=h}}else{_=d;o=h}}else{_=e;o=t}}while(0);l=f[739]|0;if(v>>>0<l>>>0)Ce();r=e+(t+4)|0;n=f[r>>2]|0;if(!(n&2)){if((v|0)==(f[741]|0)){y=(f[738]|0)+o|0;f[738]=y;f[741]=_;f[_+4>>2]=y|1;if((_|0)!=(f[740]|0))return;f[740]=0;f[737]=0;return}if((v|0)==(f[740]|0)){y=(f[737]|0)+o|0;f[737]=y;f[740]=_;f[_+4>>2]=y|1;f[_+y>>2]=y;return}o=(n&-8)+o|0;a=n>>>3;do{if(n>>>0>=256){s=f[e+(t+24)>>2]|0;i=f[e+(t+12)>>2]|0;do{if((i|0)==(v|0)){n=e+(t+20)|0;r=f[n>>2]|0;if(!r){n=e+(t+16)|0;r=f[n>>2]|0;if(!r){m=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<l>>>0)Ce();else{f[n>>2]=0;m=r;break}}else{a=f[e+(t+8)>>2]|0;if(a>>>0<l>>>0)Ce();r=a+12|0;if((f[r>>2]|0)!=(v|0))Ce();n=i+8|0;if((f[n>>2]|0)==(v|0)){f[r>>2]=i;f[n>>2]=a;m=i;break}else Ce()}}while(0);if(s){r=f[e+(t+28)>>2]|0;n=3244+(r<<2)|0;if((v|0)==(f[n>>2]|0)){f[n>>2]=m;if(!m){f[736]=f[736]&~(1<<r);break}}else{if(s>>>0<(f[739]|0)>>>0)Ce();r=s+16|0;if((f[r>>2]|0)==(v|0))f[r>>2]=m;else f[s+20>>2]=m;if(!m)break}n=f[739]|0;if(m>>>0<n>>>0)Ce();f[m+24>>2]=s;r=f[e+(t+16)>>2]|0;do{if(r)if(r>>>0<n>>>0)Ce();else{f[m+16>>2]=r;f[r+24>>2]=m;break}}while(0);r=f[e+(t+20)>>2]|0;if(r)if(r>>>0<(f[739]|0)>>>0)Ce();else{f[m+20>>2]=r;f[r+24>>2]=m;break}}}else{i=f[e+(t+8)>>2]|0;n=f[e+(t+12)>>2]|0;r=2980+(a<<1<<2)|0;if((i|0)!=(r|0)){if(i>>>0<l>>>0)Ce();if((f[i+12>>2]|0)!=(v|0))Ce()}if((n|0)==(i|0)){f[735]=f[735]&~(1<<a);break}if((n|0)!=(r|0)){if(n>>>0<l>>>0)Ce();r=n+8|0;if((f[r>>2]|0)==(v|0))p=r;else Ce()}else p=n+8|0;f[i+12>>2]=n;f[p>>2]=i}}while(0);f[_+4>>2]=o|1;f[_+o>>2]=o;if((_|0)==(f[740]|0)){f[737]=o;return}}else{f[r>>2]=n&-2;f[_+4>>2]=o|1;f[_+o>>2]=o}r=o>>>3;if(o>>>0<256){n=r<<1;a=2980+(n<<2)|0;i=f[735]|0;r=1<<r;if(i&r){r=2980+(n+2<<2)|0;n=f[r>>2]|0;if(n>>>0<(f[739]|0)>>>0)Ce();else{g=r;y=n}}else{f[735]=i|r;g=2980+(n+2<<2)|0;y=a}f[g>>2]=_;f[y+12>>2]=_;f[_+8>>2]=y;f[_+12>>2]=a;return}r=o>>>8;if(r)if(o>>>0>16777215)a=31;else{g=(r+1048320|0)>>>16&8;y=r<<g;v=(y+520192|0)>>>16&4;y=y<<v;a=(y+245760|0)>>>16&2;a=14-(v|g|a)+(y<<a>>>15)|0;a=o>>>(a+7|0)&1|a<<1}else a=0;r=3244+(a<<2)|0;f[_+28>>2]=a;f[_+20>>2]=0;f[_+16>>2]=0;n=f[736]|0;i=1<<a;if(!(n&i)){f[736]=n|i;f[r>>2]=_;f[_+24>>2]=r;f[_+12>>2]=_;f[_+8>>2]=_;return}r=f[r>>2]|0;e:do{if((f[r+4>>2]&-8|0)!=(o|0)){a=o<<((a|0)==31?0:25-(a>>>1)|0);while(1){n=r+16+(a>>>31<<2)|0;i=f[n>>2]|0;if(!i)break;if((f[i+4>>2]&-8|0)==(o|0)){r=i;break e}else{a=a<<1;r=i}}if(n>>>0<(f[739]|0)>>>0)Ce();f[n>>2]=_;f[_+24>>2]=r;f[_+12>>2]=_;f[_+8>>2]=_;return}}while(0);n=r+8|0;i=f[n>>2]|0;y=f[739]|0;if(!(i>>>0>=y>>>0&r>>>0>=y>>>0))Ce();f[i+12>>2]=_;f[n>>2]=_;f[_+8>>2]=i;f[_+12>>2]=r;f[_+24>>2]=0;return}function Bl(){}function zl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;n=t-n-(r>>>0>e>>>0|0)>>>0;return(B=n,e-r>>>0|0)|0}function jl(e,t,r){e=e|0;t=t|0;r=r|0;if((r|0)<32){B=t>>r;return e>>>r|(t&(1<<r)-1)<<32-r}B=(t|0)<0?-1:0;return t>>r-32|0}function Vl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0;n=e+r|0;if((r|0)>=20){t=t&255;a=e&3;o=t|t<<8|t<<16|t<<24;i=n&~3;if(a){a=e+4-a|0;while((e|0)<(a|0)){h[e>>0]=t;e=e+1|0}}while((e|0)<(i|0)){f[e>>2]=o;e=e+4|0}}while((e|0)<(n|0)){h[e>>0]=t;e=e+1|0}return e-r|0}function Gl(e,t,r){e=e|0;t=t|0;r=r|0;if((r|0)<32){B=t<<r|(e&(1<<r)-1<<32-r)>>>32-r;return e<<r}B=e<<r-32;return 0}function Wl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;r=e+r>>>0;return(B=t+n+(r>>>0<e>>>0|0)>>>0,r|0)|0}function Xl(e,t,r){e=e|0;t=t|0;r=r|0;if((r|0)<32){B=t>>>r;return e>>>r|(t&(1<<r)-1)<<32-r}B=0;return t>>>r-32|0}function Yl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if((r|0)>=4096)return De(e|0,t|0,r|0)|0;n=e|0;if((e&3)==(t&3)){while(e&3){if(!r)return n|0;h[e>>0]=h[t>>0]|0;e=e+1|0;t=t+1|0;r=r-1|0}while((r|0)>=4){f[e>>2]=f[t>>2];e=e+4|0;t=t+4|0;r=r-4|0}}while((r|0)>0){h[e>>0]=h[t>>0]|0;e=e+1|0;t=t+1|0;r=r-1|0}return n|0}function ql(e){e=e|0;var t=0;t=h[T+(e&255)>>0]|0;if((t|0)<8)return t|0;t=h[T+(e>>8&255)>>0]|0;if((t|0)<8)return t+8|0;t=h[T+(e>>16&255)>>0]|0;if((t|0)<8)return t+16|0;return(h[T+(e>>>24)>>0]|0)+24|0}function Zl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0;a=e&65535;i=t&65535;r=ce(i,a)|0;n=e>>>16;e=(r>>>16)+(ce(i,n)|0)|0;i=t>>>16;t=ce(i,a)|0;return(B=(e>>>16)+(ce(i,n)|0)+(((e&65535)+t|0)>>>16)|0,e+t<<16|r&65535|0)|0}function Jl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;u=t>>31|((t|0)<0?-1:0)<<1;l=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1;a=n>>31|((n|0)<0?-1:0)<<1;i=((n|0)<0?-1:0)>>31|((n|0)<0?-1:0)<<1;s=zl(u^e,l^t,u,l)|0;o=B;e=a^u;t=i^l;return zl((tu(s,o,zl(a^r,i^n,a,i)|0,B,0)|0)^e,B^t,e,t)|0}function Kl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;i=b;b=b+16|0;s=i|0;o=t>>31|((t|0)<0?-1:0)<<1;a=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1;u=n>>31|((n|0)<0?-1:0)<<1;l=((n|0)<0?-1:0)>>31|((n|0)<0?-1:0)<<1;e=zl(o^e,a^t,o,a)|0;t=B;tu(e,t,zl(u^r,l^n,u,l)|0,B,s)|0;n=zl(f[s>>2]^o,f[s+4>>2]^a,o,a)|0;r=B;b=i;return(B=r,n)|0}function Ql(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;i=e;a=r;r=Zl(i,a)|0;e=B;return(B=(ce(t,a)|0)+(ce(n,i)|0)+e|e&0,r|0|0)|0}function $l(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return tu(e,t,r,n,0)|0}function eu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;a=b;b=b+16|0;i=a|0;tu(e,t,r,n,i)|0;b=a;return(B=f[i+4>>2]|0,f[i>>2]|0)|0}function tu(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;c=e;l=t;u=l;o=r;d=n;s=d;if(!u){a=(i|0)!=0;if(!s){if(a){f[i>>2]=(c>>>0)%(o>>>0);f[i+4>>2]=0}d=0;i=(c>>>0)/(o>>>0)>>>0;return(B=d,i)|0}else{if(!a){d=0;i=0;return(B=d,i)|0}f[i>>2]=e|0;f[i+4>>2]=t&0;d=0;i=0;return(B=d,i)|0}}a=(s|0)==0;do{if(o){if(!a){a=(de(s|0)|0)-(de(u|0)|0)|0;if(a>>>0<=31){h=a+1|0;s=31-a|0;t=a-31>>31;o=h;e=c>>>(h>>>0)&t|u<<s;t=u>>>(h>>>0)&t;a=0;s=c<<s;break}if(!i){d=0;i=0;return(B=d,i)|0}f[i>>2]=e|0;f[i+4>>2]=l|t&0;d=0;i=0;return(B=d,i)|0}a=o-1|0;if(a&o){s=(de(o|0)|0)+33-(de(u|0)|0)|0;m=64-s|0;h=32-s|0;l=h>>31;p=s-32|0;t=p>>31;o=s;e=h-1>>31&u>>>(p>>>0)|(u<<h|c>>>(s>>>0))&t;t=t&u>>>(s>>>0);a=c<<m&l;s=(u<<m|c>>>(p>>>0))&l|c<<h&s-33>>31;break}if(i){f[i>>2]=a&c;f[i+4>>2]=0}if((o|0)==1){p=l|t&0;m=e|0|0;return(B=p,m)|0}else{m=ql(o|0)|0;p=u>>>(m>>>0)|0;m=u<<32-m|c>>>(m>>>0)|0;return(B=p,m)|0}}else{if(a){if(i){f[i>>2]=(u>>>0)%(o>>>0);f[i+4>>2]=0}p=0;m=(u>>>0)/(o>>>0)>>>0;return(B=p,m)|0}if(!c){if(i){f[i>>2]=0;f[i+4>>2]=(u>>>0)%(s>>>0)}p=0;m=(u>>>0)/(s>>>0)>>>0;return(B=p,m)|0}a=s-1|0;if(!(a&s)){if(i){f[i>>2]=e|0;f[i+4>>2]=a&u|t&0}p=0;m=u>>>((ql(s|0)|0)>>>0);return(B=p,m)|0}a=(de(s|0)|0)-(de(u|0)|0)|0;if(a>>>0<=30){t=a+1|0;s=31-a|0;o=t;e=u<<s|c>>>(t>>>0);t=u>>>(t>>>0);a=0;s=c<<s;break}if(!i){p=0;m=0;return(B=p,m)|0}f[i>>2]=e|0;f[i+4>>2]=l|t&0;p=0;m=0;return(B=p,m)|0}}while(0);if(!o){u=s;l=0;s=0}else{h=r|0|0;c=d|n&0;u=Wl(h|0,c|0,-1,-1)|0;r=B;l=s;s=0;do{n=l;l=a>>>31|l<<1;a=s|a<<1;n=e<<1|n>>>31|0;d=e>>>31|t<<1|0;zl(u,r,n,d)|0;m=B;p=m>>31|((m|0)<0?-1:0)<<1;s=p&1;e=zl(n,d,p&h,(((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1)&c)|0;t=B;o=o-1|0}while((o|0)!=0);u=l;l=0}o=0;if(i){f[i>>2]=e;f[i+4>>2]=t}p=(a|0)>>>31|(u|o)<<1|(o<<1|a>>>31)&0|l;m=(a<<1|0>>>31)&-2|s;return(B=p,m)|0}function ru(e,t,r,n,i,a,o,s){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;return Au[e&3](t|0,r|0,n|0,i|0,a|0,o|0,s|0)|0}function nu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return ku[e&63](t|0,r|0,n|0)|0}function iu(e,t){e=e|0;t=t|0;return+Pu[e&3](t|0)}function au(e,t){e=e|0;t=t|0;Cu[e&7](t|0)}function ou(e,t,r){e=e|0;t=t|0;r=r|0;Lu[e&7](t|0,r|0)}function su(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;return Iu[e&7](t|0,r|0,n|0,i|0,a|0,o|0)|0}function lu(e,t){e=e|0;t=t|0;return Ou[e&15](t|0)|0}function uu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;Hu[e&15](t|0,r|0,n|0)}function cu(e,t,r,n,i,a,o,s,l,u,c,h){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;h=h|0;return Du[e&3](t|0,r|0,n|0,i|0,a|0,o|0,s|0,l|0,u|0,c|0,h|0)|0}function hu(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;return Nu[e&63](t|0,r|0,n|0,i|0)|0}function du(e,t,r){e=e|0;t=t|0;r=r|0;return Fu[e&7](t|0,r|0)|0}function fu(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;return Uu[e&3](t|0,r|0,n|0,i|0,a|0)|0}function pu(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;Bu[e&3](t|0,r|0,n|0,i|0)}function mu(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;fe(0);return 0}function vu(e,t,r){e=e|0;t=t|0;r=r|0;fe(1);return 0}function gu(e){e=e|0;fe(2);return 0.0}function yu(e){e=e|0;fe(3)}function _u(e,t){e=e|0;t=t|0;fe(4)}function bu(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;fe(5);return 0}function Eu(e){e=e|0;fe(6);return 0}function wu(e,t,r){e=e|0;t=t|0;r=r|0;fe(7)}function xu(e,t,r,n,i,a,o,s,l,u,c){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;fe(8);return 0}function Tu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;fe(9);return 0}function Su(e,t){e=e|0;t=t|0;fe(10);return 0}function Mu(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;fe(11);return 0}function Ru(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;fe(12)}var Au=[mu,ca,Gt,mu];var ku=[vu,Al,qs,Xs,Ln,In,On,Hn,Ui,Bi,ji,aa,_a,Dt,Jt,ba,Ea,Ht,Nt,Vi,Gi,Wi,Xi,Sa,Ma,Ra,Aa,Pa,Ca,Ia,Oa,Ha,Da,Na,Fa,Ua,Ba,za,ja,Va,Ga,Wa,Xa,Ya,qa,Za,Ja,Ka,Qa,$a,eo,to,er,tr,rr,nr,ir,ar,or,sr,Ws,Ys,vu,vu];var Pu=[gu,ro,no,gu];var Cu=[yu,ra,Vt,tn,rn,Tl,Sl,yu];var Lu=[_u,yn,_n,bn,ei,ea,It,_u];var Iu=[bu,ua,jt,xa,zt,bu,bu,bu];var Ou=[Eu,Gs,ma,va,Zt,qt,Ks,No,Oo,Eu,Eu,Eu,Eu,Eu,Eu,Eu];var Hu=[wu,At,kt,Pt,Ct,wt,xt,Tt,St,yt,_t,bt,Et,da,Yt,wu];var Du=[xu,la,Bt,xu];var Nu=[Tu,uo,co,tt,rt,nt,it,at,ot,st,lt,ut,ct,ht,dt,ft,pt,mt,vt,gt,yr,_r,br,dr,fr,pr,mr,vr,gr,An,kn,Pn,Cn,ga,oa,Lt,Ut,wa,na,Ft,Ot,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu];var Fu=[Su,zi,lr,ur,cr,hr,Su,Su];var Uu=[Mu,ya,Wt,Mu];var Bu=[Ru,zo,Go,Ru];return{_opj_stream_destroy:Nn,_opj_stream_set_read_function:Fn,_opj_read_tile_header:yi,_opj_set_warning_handler:li,_opj_destroy_cstr_info:Oi,_opj_image_create:ri,_opj_set_error_handler:ui,_opj_stream_set_user_data:jn,_opj_end_decompress:Ai,_bitshift64Lshr:Xl,_opj_stream_set_seek_function:Un,_opj_decode:vi,_opj_set_decoded_resolution_factor:Ei,_i64Add:Wl,_opj_stream_create_default_file_stream:Ni,_opj_encode:Mi,_bitshift64Ashr:jl,_opj_get_decoded_tile:bi,_memset:Vl,_opj_version:hi,_memcpy:Yl,_opj_destroy_cstr_index:Di,_opj_stream_set_user_data_length:Vn,_opj_stream_set_skip_function:zn,_opj_image_destroy:ni,_opj_stream_create_file_stream:Fi,_opj_setup_encoder:Ti,_opj_stream_default_create:Dn,_bitshift64Shl:Gl,_opj_stream_create:Rn,_jp2_version:gn,_i64Subtract:zl,_opj_get_cstr_index:Hi,_opj_set_default_decoder_parameters:fi,_opj_read_header:mi,_opj_get_cstr_info:Ii,_opj_set_default_encoder_parameters:xi,_opj_set_decode_area:gi,_opj_stream_set_write_function:Bn,_opj_dump_codec:Li,_opj_create_decompress:di,_opj_decode_tile_data:_i,_free:Il,_opj_image_tile_create:oi,_opj_set_MCT:ki,_opj_set_info_handler:si,_opj_start_compress:Si,_opj_write_tile:Pi,_opj_setup_decoder:pi,_malloc:Ll,_opj_end_compress:Ri,_opj_destroy_codec:Ci,_jp2_decode:vn,_opj_stream_create_buffer_stream:ci,_opj_create_compress:wi,runPostSets:Bl,_emscripten_replace_memory:et,stackAlloc:sn,stackSave:ln,stackRestore:un,establishStackSpace:cn,setThrew:hn,setTempRet0:pn,getTempRet0:mn,dynCall_iiiiiiii:ru,dynCall_iiii:nu,dynCall_di:iu,dynCall_vi:au,dynCall_vii:ou,dynCall_iiiiiii:su,dynCall_ii:lu,dynCall_viii:uu,dynCall_iiiiiiiiiiii:cu,dynCall_iiiii:hu,dynCall_iii:du,dynCall_iiiiii:fu,dynCall_viiii:pu}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer),_opj_stream_destroy=Module._opj_stream_destroy=asm._opj_stream_destroy,_opj_stream_set_read_function=Module._opj_stream_set_read_function=asm._opj_stream_set_read_function,_opj_read_tile_header=Module._opj_read_tile_header=asm._opj_read_tile_header,_opj_set_warning_handler=Module._opj_set_warning_handler=asm._opj_set_warning_handler,_opj_destroy_cstr_info=Module._opj_destroy_cstr_info=asm._opj_destroy_cstr_info,_opj_image_create=Module._opj_image_create=asm._opj_image_create,_opj_set_error_handler=Module._opj_set_error_handler=asm._opj_set_error_handler,_opj_image_tile_create=Module._opj_image_tile_create=asm._opj_image_tile_create,_opj_end_decompress=Module._opj_end_decompress=asm._opj_end_decompress,_bitshift64Lshr=Module._bitshift64Lshr=asm._bitshift64Lshr,_opj_stream_set_seek_function=Module._opj_stream_set_seek_function=asm._opj_stream_set_seek_function,_opj_decode=Module._opj_decode=asm._opj_decode,_opj_set_decoded_resolution_factor=Module._opj_set_decoded_resolution_factor=asm._opj_set_decoded_resolution_factor,_opj_stream_create_default_file_stream=Module._opj_stream_create_default_file_stream=asm._opj_stream_create_default_file_stream,_opj_set_default_decoder_parameters=Module._opj_set_default_decoder_parameters=asm._opj_set_default_decoder_parameters,_bitshift64Ashr=Module._bitshift64Ashr=asm._bitshift64Ashr,_opj_get_decoded_tile=Module._opj_get_decoded_tile=asm._opj_get_decoded_tile,_memset=Module._memset=asm._memset,_opj_version=Module._opj_version=asm._opj_version,_memcpy=Module._memcpy=asm._memcpy,_opj_destroy_cstr_index=Module._opj_destroy_cstr_index=asm._opj_destroy_cstr_index,_opj_stream_set_user_data_length=Module._opj_stream_set_user_data_length=asm._opj_stream_set_user_data_length,_opj_stream_set_skip_function=Module._opj_stream_set_skip_function=asm._opj_stream_set_skip_function,_opj_image_destroy=Module._opj_image_destroy=asm._opj_image_destroy,_opj_stream_create_file_stream=Module._opj_stream_create_file_stream=asm._opj_stream_create_file_stream,_opj_setup_encoder=Module._opj_setup_encoder=asm._opj_setup_encoder,_opj_stream_default_create=Module._opj_stream_default_create=asm._opj_stream_default_create,_bitshift64Shl=Module._bitshift64Shl=asm._bitshift64Shl,_opj_stream_create=Module._opj_stream_create=asm._opj_stream_create,_jp2_version=Module._jp2_version=asm._jp2_version,_i64Subtract=Module._i64Subtract=asm._i64Subtract,_opj_get_cstr_index=Module._opj_get_cstr_index=asm._opj_get_cstr_index,_opj_encode=Module._opj_encode=asm._opj_encode,_i64Add=Module._i64Add=asm._i64Add,_opj_get_cstr_info=Module._opj_get_cstr_info=asm._opj_get_cstr_info,_opj_set_default_encoder_parameters=Module._opj_set_default_encoder_parameters=asm._opj_set_default_encoder_parameters,_opj_set_decode_area=Module._opj_set_decode_area=asm._opj_set_decode_area,_opj_stream_set_write_function=Module._opj_stream_set_write_function=asm._opj_stream_set_write_function,_opj_dump_codec=Module._opj_dump_codec=asm._opj_dump_codec,_opj_read_header=Module._opj_read_header=asm._opj_read_header,_opj_create_decompress=Module._opj_create_decompress=asm._opj_create_decompress,_opj_decode_tile_data=Module._opj_decode_tile_data=asm._opj_decode_tile_data,_opj_set_info_handler=Module._opj_set_info_handler=asm._opj_set_info_handler,_opj_stream_set_user_data=Module._opj_stream_set_user_data=asm._opj_stream_set_user_data,_opj_set_MCT=Module._opj_set_MCT=asm._opj_set_MCT,_free=Module._free=asm._free,runPostSets=Module.runPostSets=asm.runPostSets,_opj_start_compress=Module._opj_start_compress=asm._opj_start_compress,_opj_write_tile=Module._opj_write_tile=asm._opj_write_tile,_opj_setup_decoder=Module._opj_setup_decoder=asm._opj_setup_decoder,_malloc=Module._malloc=asm._malloc,_opj_end_compress=Module._opj_end_compress=asm._opj_end_compress,_opj_destroy_codec=Module._opj_destroy_codec=asm._opj_destroy_codec,_emscripten_replace_memory=Module._emscripten_replace_memory=asm._emscripten_replace_memory,_jp2_decode=Module._jp2_decode=asm._jp2_decode,_opj_stream_create_buffer_stream=Module._opj_stream_create_buffer_stream=asm._opj_stream_create_buffer_stream,_opj_create_compress=Module._opj_create_compress=asm._opj_create_compress,dynCall_iiiiiiii=Module.dynCall_iiiiiiii=asm.dynCall_iiiiiiii,dynCall_iiii=Module.dynCall_iiii=asm.dynCall_iiii,dynCall_di=Module.dynCall_di=asm.dynCall_di,dynCall_vi=Module.dynCall_vi=asm.dynCall_vi,dynCall_vii=Module.dynCall_vii=asm.dynCall_vii,dynCall_iiiiiii=Module.dynCall_iiiiiii=asm.dynCall_iiiiiii,dynCall_ii=Module.dynCall_ii=asm.dynCall_ii,dynCall_viii=Module.dynCall_viii=asm.dynCall_viii,dynCall_iiiiiiiiiiii=Module.dynCall_iiiiiiiiiiii=asm.dynCall_iiiiiiiiiiii,dynCall_iiiii=Module.dynCall_iiiii=asm.dynCall_iiiii,dynCall_iii=Module.dynCall_iii=asm.dynCall_iii,dynCall_iiiiii=Module.dynCall_iiiiii=asm.dynCall_iiiiii,dynCall_viiii=Module.dynCall_viiii=asm.dynCall_viiii,initialStackTop;function ExitStatus(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}Runtime.stackAlloc=asm.stackAlloc,Runtime.stackSave=asm.stackSave,Runtime.stackRestore=asm.stackRestore,Runtime.establishStackSpace=asm.establishStackSpace,Runtime.setTempRet0=asm.setTempRet0,Runtime.getTempRet0=asm.getTempRet0,ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var preloadStartTime=null,calledMain=!1;function run(e){function t(){Module.calledRun||(Module.calledRun=!0,ABORT||(ensureInitRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),Module._main&&shouldRunNow&&Module.callMain(e),postRun()))}e=e||Module.arguments,null===preloadStartTime&&(preloadStartTime=Date.now()),runDependencies>0||(preRun(),runDependencies>0||Module.calledRun||(Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),t()},1)):t()))}function exit(e,t){if(!t||!Module.noExitRuntime)throw Module.noExitRuntime||(ABORT=!0,EXITSTATUS=e,STACKTOP=initialStackTop,exitRuntime(),Module.onExit&&Module.onExit(e)),ENVIRONMENT_IS_NODE?(process.stdout.once("drain",function(){process.exit(e)}),console.log(" "),setTimeout(function(){process.exit(e)},500)):ENVIRONMENT_IS_SHELL&&"function"==typeof quit&&quit(e),new ExitStatus(e)}dependenciesFulfilled=function e(){Module.calledRun||run(),Module.calledRun||(dependenciesFulfilled=e)},Module.callMain=Module.callMain=function(e){assert(0==runDependencies,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==__ATPRERUN__.length,"cannot call main when preRun functions remain to be called"),e=e||[],ensureInitRuntime();var t=e.length+1;function r(){for(var e=0;e<3;e++)n.push(0)}var n=[allocate(intArrayFromString(Module.thisProgram),"i8",ALLOC_NORMAL)];r();for(var i=0;i<t-1;i+=1)n.push(allocate(intArrayFromString(e[i]),"i8",ALLOC_NORMAL)),r();n.push(0),n=allocate(n,"i32",ALLOC_NORMAL);try{exit(Module._main(t,n,0),!0)}catch(e){if(e instanceof ExitStatus)return;if("SimulateInfiniteLoop"==e)return void(Module.noExitRuntime=!0);throw e&&"object"==typeof e&&e.stack&&Module.printErr("exception thrown: "+[e,e.stack]),e}finally{calledMain=!0}},Module.run=Module.run=run,Module.exit=Module.exit=exit;var abortDecorators=[];function abort(e){void 0!==e?(Module.print(e),Module.printErr(e),e=JSON.stringify(e)):e="",ABORT=!0,EXITSTATUS=1;var t="abort("+e+") at "+stackTrace()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw abortDecorators&&abortDecorators.forEach(function(r){t=r(t,e)}),t}if(Module.abort=Module.abort=abort,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;return Module.noInitialRun&&(shouldRunNow=!1),run(),Module}}).call(this,__webpack_require__(6),"/")},function(e,t,r){"use strict";e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";var n=r(1),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new n.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,t.string2buf=function(e){var t,r,i,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,n,i,a,s=t||e.length,u=new Array(2*s);for(n=0,r=0;r<s;)if((i=e[r++])<128)u[n++]=i;else if((a=o[i])>4)u[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<s;)i=i<<6|63&e[r++],a--;a>1?u[n++]=65533:i<65536?u[n++]=i:(i-=65536,u[n++]=55296|i>>10&1023,u[n++]=56320|1023&i)}return l(u,n)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+o[e[r]]>t?r:t}},function(e,t,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){"use strict";e.exports=Math.floor},function(e,t,r){"use strict";e.exports=Math.ceil},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.ComponentSpec)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||r(3),n.lossless.Utils=n.lossless.Utils||r(7),n.lossless.HuffmanTable=n.lossless.HuffmanTable||function(){this.l=n.lossless.Utils.createArray(4,2,16),this.th=[],this.v=n.lossless.Utils.createArray(4,2,16,200),this.tc=n.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},n.lossless.HuffmanTable.MSB=2147483648,n.lossless.HuffmanTable.prototype.read=function(e,t){var r,n,i,a,o,s,l=0;for(r=e.get16(),l+=2;l<r;){if(l+=1,(i=15&(n=e.get8()))>3)throw new Error("ERROR: Huffman table ID > 3");if((a=n>>4)>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[i]=1,this.tc[i][a]=1,o=0;o<16;o+=1)this.l[i][a][o]=e.get8(),l+=1;for(o=0;o<16;o+=1)for(s=0;s<this.l[i][a][o];s+=1){if(l>r)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[i][a][o][s]=e.get8(),l+=1}}if(l!==r)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(o=0;o<4;o+=1)for(s=0;s<2;s+=1)0!==this.tc[o][s]&&this.buildHuffTable(t[o][s],this.l[o][s],this.v[o][s]);return 1},n.lossless.HuffmanTable.prototype.buildHuffTable=function(e,t,r){var i,a,o,s,l;for(256,a=0,o=0;o<8;o+=1)for(s=0;s<t[o];s+=1)for(l=0;l<256>>o+1;l+=1)e[a]=r[o][s]|o+1<<8,a+=1;for(o=1;a<256;o+=1,a+=1)e[a]=o|n.lossless.HuffmanTable.MSB;for(i=1,a=0,o=8;o<16;o+=1)for(s=0;s<t[o];s+=1){for(l=0;l<256>>o-7;l+=1)e[256*i+a]=r[o][s]|o+1<<8,a+=1;if(a>=256){if(a>256)throw new Error("ERROR: Huffman table error(1)!");a=0,i+=1}}},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.HuffmanTable)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||r(3),n.lossless.Utils=n.lossless.Utils||r(7),n.lossless.QuantizationTable=n.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=n.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},n.lossless.QuantizationTable.enhanceQuantizationTable=function(e,t){var r;for(r=0;r<8;r+=1)e[t[0+r]]*=90,e[t[32+r]]*=90,e[t[16+r]]*=118,e[t[48+r]]*=49,e[t[40+r]]*=71,e[t[8+r]]*=126,e[t[56+r]]*=25,e[t[24+r]]*=106;for(r=0;r<8;r+=1)e[t[0+8*r]]*=90,e[t[4+8*r]]*=90,e[t[2+8*r]]*=118,e[t[6+8*r]]*=49,e[t[5+8*r]]*=71,e[t[1+8*r]]*=126,e[t[7+8*r]]*=25,e[t[3+8*r]]*=106;for(r=0;r<64;r+=1)e[r]>>=6},n.lossless.QuantizationTable.prototype.read=function(e,t){var r,i,a,o,s=0;for(r=e.get16(),s+=2;s<r;){if(s+=1,(a=15&(i=e.get8()))>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[a]=i>>4,0===this.precision[a])this.precision[a]=8;else{if(1!==this.precision[a])throw new Error("ERROR: Quantization table precision error");this.precision[a]=16}if(this.tq[a]=1,8===this.precision[a]){for(o=0;o<64;o+=1){if(s>r)throw new Error("ERROR: Quantization table format error");this.quantTables[a][o]=e.get8(),s+=1}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}else{for(o=0;o<64;o+=1){if(s>r)throw new Error("ERROR: Quantization table format error");this.quantTables[a][o]=e.get16(),s+=2}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}}if(s!==r)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.QuantizationTable)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||r(3),n.lossless.ScanComponent=n.lossless.ScanComponent||r(32),n.lossless.ScanHeader=n.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},n.lossless.ScanHeader.prototype.read=function(e){var t,r,i,a=0;for(t=e.get16(),a+=2,this.numComp=e.get8(),a+=1,r=0;r<this.numComp;r+=1){if(this.components[r]=new n.lossless.ScanComponent,a>t)throw new Error("ERROR: scan header format error");this.components[r].scanCompSel=e.get8(),a+=1,i=e.get8(),a+=1,this.components[r].dcTabSel=i>>4,this.components[r].acTabSel=15&i}if(this.selection=e.get8(),a+=1,this.spectralEnd=e.get8(),a+=1,i=e.get8(),this.ah=i>>4,this.al=15&i,(a+=1)!==t)throw new Error("ERROR: scan header format error [count!=Ns]");return 1},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.ScanHeader)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ScanComponent=n.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.ScanComponent)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||r(28),n.lossless.DataStream=n.lossless.DataStream||r(3),n.lossless.FrameHeader=n.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},n.lossless.FrameHeader.prototype.read=function(e){var t,r,i,a,o=0;for(t=e.get16(),o+=2,this.precision=e.get8(),o+=1,this.dimY=e.get16(),o+=2,this.dimX=e.get16(),o+=2,this.numComp=e.get8(),o+=1,r=1;r<=this.numComp;r+=1){if(o>t)throw new Error("ERROR: frame format error");if(i=e.get8(),(o+=1)>=t)throw new Error("ERROR: frame format error [c>=Lf]");a=e.get8(),o+=1,this.components[i]||(this.components[i]=new n.lossless.ComponentSpec),this.components[i].hSamp=a>>4,this.components[i].vSamp=15&a,this.components[i].quantTableSel=e.get8(),o+=1}if(o!==t)throw new Error("ERROR: frame format error [Lf!=count]");return 1},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.FrameHeader)},function(e,t,r){"use strict";var n=n||{};n.Utils=n.Utils||r(17),n.NIFTI1=n.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},n.NIFTI1.TYPE_NONE=0,n.NIFTI1.TYPE_BINARY=1,n.NIFTI1.TYPE_UINT8=2,n.NIFTI1.TYPE_INT16=4,n.NIFTI1.TYPE_INT32=8,n.NIFTI1.TYPE_FLOAT32=16,n.NIFTI1.TYPE_COMPLEX64=32,n.NIFTI1.TYPE_FLOAT64=64,n.NIFTI1.TYPE_RGB24=128,n.NIFTI1.TYPE_INT8=256,n.NIFTI1.TYPE_UINT16=512,n.NIFTI1.TYPE_UINT32=768,n.NIFTI1.TYPE_INT64=1024,n.NIFTI1.TYPE_UINT64=1280,n.NIFTI1.TYPE_FLOAT128=1536,n.NIFTI1.TYPE_COMPLEX128=1792,n.NIFTI1.TYPE_COMPLEX256=2048,n.NIFTI1.XFORM_UNKNOWN=0,n.NIFTI1.XFORM_SCANNER_ANAT=1,n.NIFTI1.XFORM_ALIGNED_ANAT=2,n.NIFTI1.XFORM_TALAIRACH=3,n.NIFTI1.XFORM_MNI_152=4,n.NIFTI1.SPATIAL_UNITS_MASK=7,n.NIFTI1.TEMPORAL_UNITS_MASK=56,n.NIFTI1.UNITS_UNKNOWN=0,n.NIFTI1.UNITS_METER=1,n.NIFTI1.UNITS_MM=2,n.NIFTI1.UNITS_MICRON=3,n.NIFTI1.UNITS_SEC=8,n.NIFTI1.UNITS_MSEC=16,n.NIFTI1.UNITS_USEC=24,n.NIFTI1.UNITS_HZ=32,n.NIFTI1.UNITS_PPM=40,n.NIFTI1.UNITS_RADS=48,n.NIFTI1.MAGIC_COOKIE=348,n.NIFTI1.STANDARD_HEADER_SIZE=348,n.NIFTI1.MAGIC_NUMBER_LOCATION=344,n.NIFTI1.MAGIC_NUMBER=[110,43,49],n.NIFTI1.MAGIC_NUMBER2=[110,105,49],n.NIFTI1.EXTENSION_HEADER_SIZE=8,n.NIFTI1.prototype.readHeader=function(e){var t,r,i,a,o=new DataView(e),s=n.Utils.getIntAt(o,0,this.littleEndian);if(s!==n.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,s=n.Utils.getIntAt(o,0,this.littleEndian)),s!==n.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=n.Utils.getByteAt(o,39),t=0;t<8;t+=1)a=40+2*t,this.dims[t]=n.Utils.getShortAt(o,a,this.littleEndian);for(this.intent_p1=n.Utils.getFloatAt(o,56,this.littleEndian),this.intent_p2=n.Utils.getFloatAt(o,60,this.littleEndian),this.intent_p3=n.Utils.getFloatAt(o,64,this.littleEndian),this.intent_code=n.Utils.getShortAt(o,68,this.littleEndian),this.datatypeCode=n.Utils.getShortAt(o,70,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(o,72,this.littleEndian),this.slice_start=n.Utils.getShortAt(o,74,this.littleEndian),t=0;t<8;t+=1)a=76+4*t,this.pixDims[t]=n.Utils.getFloatAt(o,a,this.littleEndian);for(this.vox_offset=n.Utils.getFloatAt(o,108,this.littleEndian),this.scl_slope=n.Utils.getFloatAt(o,112,this.littleEndian),this.scl_inter=n.Utils.getFloatAt(o,116,this.littleEndian),this.slice_end=n.Utils.getShortAt(o,120,this.littleEndian),this.slice_code=n.Utils.getByteAt(o,122),this.xyzt_units=n.Utils.getByteAt(o,123),this.cal_max=n.Utils.getFloatAt(o,124,this.littleEndian),this.cal_min=n.Utils.getFloatAt(o,128,this.littleEndian),this.slice_duration=n.Utils.getFloatAt(o,132,this.littleEndian),this.toffset=n.Utils.getFloatAt(o,136,this.littleEndian),this.description=n.Utils.getStringAt(o,148,228),this.aux_file=n.Utils.getStringAt(o,228,252),this.qform_code=n.Utils.getShortAt(o,252,this.littleEndian),this.sform_code=n.Utils.getShortAt(o,254,this.littleEndian),this.quatern_b=n.Utils.getFloatAt(o,256,this.littleEndian),this.quatern_c=n.Utils.getFloatAt(o,260,this.littleEndian),this.quatern_d=n.Utils.getFloatAt(o,264,this.littleEndian),this.qoffset_x=n.Utils.getFloatAt(o,268,this.littleEndian),this.qoffset_y=n.Utils.getFloatAt(o,272,this.littleEndian),this.qoffset_z=n.Utils.getFloatAt(o,276,this.littleEndian),r=0;r<3;r+=1)for(i=0;i<4;i+=1)a=280+4*(4*r+i),this.affine[r][i]=n.Utils.getFloatAt(o,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=n.Utils.getStringAt(o,328,344),this.magic=n.Utils.getStringAt(o,344,348),this.isHDR=this.magic===n.NIFTI1.MAGIC_NUMBER2,o.byteLength>n.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(o,348),this.extensionFlag[1]=n.Utils.getByteAt(o,349),this.extensionFlag[2]=n.Utils.getByteAt(o,350),this.extensionFlag[3]=n.Utils.getByteAt(o,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(o),this.extensionCode=this.getExtensionCode(o)))},n.NIFTI1.prototype.toFormattedString=function(){var e=n.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},n.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===n.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===n.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===n.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===n.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===n.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===n.NIFTI1.TYPE_RGB24?"RGB":e===n.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===n.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===n.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===n.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===n.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},n.NIFTI1.prototype.getTransformCodeString=function(e){return e===n.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===n.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===n.NIFTI1.XFORM_TALAIRACH?"Talairach":e===n.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},n.NIFTI1.prototype.getUnitsCodeString=function(e){return e===n.NIFTI1.UNITS_METER?"Meters":e===n.NIFTI1.UNITS_MM?"Millimeters":e===n.NIFTI1.UNITS_MICRON?"Microns":e===n.NIFTI1.UNITS_SEC?"Seconds":e===n.NIFTI1.UNITS_MSEC?"Milliseconds":e===n.NIFTI1.UNITS_USEC?"Microseconds":e===n.NIFTI1.UNITS_HZ?"Hz":e===n.NIFTI1.UNITS_PPM?"PPM":e===n.NIFTI1.UNITS_RADS?"Rads":"Unknown"},n.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,r,n,i,a,o,s,l,u){var c,h,d,f,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=e,v=t,g=r;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(c=1-(m*m+v*v+g*g))<1e-7?(m*=c=1/Math.sqrt(m*m+v*v+g*g),v*=c,g*=c,c=0):c=Math.sqrt(c),h=o>0?o:1,d=s>0?s:1,f=l>0?l:1,u<0&&(f=-f),p[0][0]=(c*c+m*m-v*v-g*g)*h,p[0][1]=2*(m*v-c*g)*d,p[0][2]=2*(m*g+c*v)*f,p[1][0]=2*(m*v+c*g)*h,p[1][1]=(c*c+v*v-m*m-g*g)*d,p[1][2]=2*(v*g-c*m)*f,p[2][0]=2*(m*g-c*v)*h,p[2][1]=2*(v*g+c*m)*d,p[2][2]=(c*c+g*g-v*v-m*m)*f,p[0][3]=n,p[1][3]=i,p[2][3]=a,p},n.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,r,n,i,a,o,s,l,u,c,h,d,f,p,m,v,g,y,_,b,E,w,x,T,S,M,R,A,k,P,C,L,I;if(p=0,M=[[0,0,0],[0,0,0],[0,0,0]],R=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],r=e[0][1],n=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],0===(c=Math.sqrt(t*t+i*i+s*s)))return null;if(t/=c,i/=c,s/=c,0===(c=Math.sqrt(r*r+a*a+l*l)))return null;if(c=t*(r/=c)+i*(a/=c)+s*(l/=c),Math.abs(c)>1e-4){if(r-=c*t,a-=c*i,l-=c*s,0===(c=Math.sqrt(r*r+a*a+l*l)))return null;r/=c,a/=c,l/=c}if(0===(c=Math.sqrt(n*n+o*o+u*u))?(n=i*l-s*a,o=s*r-l*t,u=t*a-i*r):(n/=c,o/=c,u/=c),c=t*n+i*o+s*u,Math.abs(c)>1e-4){if(n-=c*t,o-=c*i,u-=c*s,0===(c=Math.sqrt(n*n+o*o+u*u)))return null;n/=c,o/=c,u/=c}if(c=r*n+a*o+l*u,Math.abs(c)>1e-4){if(n-=c*r,o-=c*a,u-=c*l,0===(c=Math.sqrt(n*n+o*o+u*u)))return null;n/=c,o/=c,u/=c}if(M[0][0]=t,M[0][1]=r,M[0][2]=n,M[1][0]=i,M[1][1]=a,M[1][2]=o,M[2][0]=s,M[2][1]=l,M[2][2]=u,0===(h=this.nifti_mat33_determ(M)))return null;for(S=-666,y=E=w=x=1,_=2,b=3,d=1;d<=3;d+=1)for(f=1;f<=3;f+=1)if(d!==f)for(p=1;p<=3;p+=1)if(d!==p&&f!==p)for(R[0][0]=R[0][1]=R[0][2]=R[1][0]=R[1][1]=R[1][2]=R[2][0]=R[2][1]=R[2][2]=0,m=-1;m<=1;m+=2)for(v=-1;v<=1;v+=2)for(g=-1;g<=1;g+=2)R[0][d-1]=m,R[1][f-1]=v,R[2][p-1]=g,this.nifti_mat33_determ(R)*h>0&&(c=(T=this.nifti_mat33_mul(R,M))[0][0]+T[1][1]+T[2][2])>S&&(S=c,y=d,_=f,b=p,E=m,w=v,x=g);switch(A=k=P=C=L=I=0,y*E){case 1:A="X",C="+";break;case-1:A="X",C="-";break;case 2:A="Y",C="+";break;case-2:A="Y",C="-";break;case 3:A="Z",C="+";break;case-3:A="Z",C="-"}switch(_*w){case 1:k="X",L="+";break;case-1:k="X",L="-";break;case 2:k="Y",L="+";break;case-2:k="Y",L="-";break;case 3:k="Z",L="+";break;case-3:k="Z",L="-"}switch(b*x){case 1:P="X",I="+";break;case-1:P="X",I="-";break;case 2:P="Y",I="+";break;case-2:P="Y",I="-";break;case 3:P="Z",I="+";break;case-3:P="Z",I="-"}return A+k+P+C+L+I},n.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var r,n,i=[[0,0,0],[0,0,0],[0,0,0]];for(r=0;r<3;r+=1)for(n=0;n<3;n+=1)i[r][n]=e[r][0]*t[0][n]+e[r][1]*t[1][n]+e[r][2]*t[2][n];return i},n.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,r,n,i,a,o,s,l,u;return t=e[0][0],r=e[0][1],n=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],t*a*(u=e[2][2])-t*l*o-i*r*u+i*l*n+s*r*o-s*a*n},n.NIFTI1.prototype.getExtensionLocation=function(){return n.NIFTI1.MAGIC_COOKIE+4},n.NIFTI1.prototype.getExtensionSize=function(e){return n.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},n.NIFTI1.prototype.getExtensionCode=function(e){return n.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)},"undefined"!==typeof e&&e.exports&&(e.exports=n.NIFTI1)},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";function e(e){throw e}var t=void 0,r=this;function n(e,n){var i,a=e.split("."),o=r;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===t?o=o[i]?o[i]:o[i]={}:o[i]=n}var i,a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;for(new(a?Uint8Array:Array)(256),i=0;256>i;++i)for(var o=(o=i)>>>1;o;o>>>=1)0;function s(e,t,r){var n,i="number"==typeof t?t:t=0,a="number"==typeof r?r:e.length;for(n=-1,i=7&a;i--;++t)n=n>>>8^u[255&(n^e[t])];for(i=a>>3;i--;t+=8)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^u[255&(n^e[t])])>>>8^u[255&(n^e[t+1])])>>>8^u[255&(n^e[t+2])])>>>8^u[255&(n^e[t+3])])>>>8^u[255&(n^e[t+4])])>>>8^u[255&(n^e[t+5])])>>>8^u[255&(n^e[t+6])])>>>8^u[255&(n^e[t+7])];return(4294967295^n)>>>0}var l=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],u=a?new Uint32Array(l):l;function c(){}function h(e){var t,r,n,i,o,s,l,u,c,h,d=e.length,f=0,p=Number.POSITIVE_INFINITY;for(u=0;u<d;++u)e[u]>f&&(f=e[u]),e[u]<p&&(p=e[u]);for(t=1<<f,r=new(a?Uint32Array:Array)(t),n=1,i=0,o=2;n<=f;){for(u=0;u<d;++u)if(e[u]===n){for(s=0,l=i,c=0;c<n;++c)s=s<<1|1&l,l>>=1;for(h=n<<16|u,c=s;c<t;c+=o)r[c]=h;++i}++n,i<<=1,o<<=1}return[r,f,p]}c.prototype.getName=function(){return this.name},c.prototype.getData=function(){return this.data},c.prototype.H=function(){return this.I},n("Zlib.GunzipMember",c),n("Zlib.GunzipMember.prototype.getName",c.prototype.getName),n("Zlib.GunzipMember.prototype.getData",c.prototype.getData),n("Zlib.GunzipMember.prototype.getMtime",c.prototype.H);var d,f=[];for(d=0;288>d;d++)switch(!0){case 143>=d:f.push([d+48,8]);break;case 255>=d:f.push([d-144+400,9]);break;case 279>=d:f.push([d-256+0,7]);break;case 287>=d:f.push([d-280+192,8]);break;default:e("invalid literal: "+d)}var p=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var r,n,i=[];for(r=3;258>=r;r++)n=t(r),i[r]=n[2]<<24|n[1]<<16|n[0];return i}();function m(t,r){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=a?new Uint8Array(t):t,this.o=!1,this.k=g,this.z=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.j=r.bufferSize),r.bufferType&&(this.k=r.bufferType),r.resize&&(this.z=r.resize)),this.k){case v:this.a=32768,this.b=new(a?Uint8Array:Array)(32768+this.j+258);break;case g:this.a=0,this.b=new(a?Uint8Array:Array)(this.j),this.e=this.F,this.q=this.B,this.l=this.D;break;default:e(Error("invalid inflate mode"))}}a&&new Uint32Array(p);var v=0,g=1;m.prototype.g=function(){for(;!this.o;){var r=D(this,3);switch(1&r&&(this.o=!0),r>>>=1){case 0:var n=this.input,i=this.c,o=this.b,s=this.a,l=n.length,u=t,c=o.length,h=t;switch(this.d=this.f=0,i+1>=l&&e(Error("invalid uncompressed block header: LEN")),u=n[i++]|n[i++]<<8,i+1>=l&&e(Error("invalid uncompressed block header: NLEN")),u===~(n[i++]|n[i++]<<8)&&e(Error("invalid uncompressed block header: length verify")),i+u>n.length&&e(Error("input buffer is broken")),this.k){case v:for(;s+u>o.length;){if(u-=h=c-s,a)o.set(n.subarray(i,i+h),s),s+=h,i+=h;else for(;h--;)o[s++]=n[i++];this.a=s,o=this.e(),s=this.a}break;case g:for(;s+u>o.length;)o=this.e({t:2});break;default:e(Error("invalid inflate mode"))}if(a)o.set(n.subarray(i,i+u),s),s+=u,i+=u;else for(;u--;)o[s++]=n[i++];this.c=i,this.a=s,this.b=o;break;case 1:this.l(I,H);break;case 2:F(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.q()};var y,_,b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=a?new Uint16Array(b):b,w=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],x=a?new Uint16Array(w):w,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],S=a?new Uint8Array(T):T,M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],R=a?new Uint16Array(M):M,A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=a?new Uint8Array(A):A,P=new(a?Uint8Array:Array)(288);for(y=0,_=P.length;y<_;++y)P[y]=143>=y?8:255>=y?9:279>=y?7:8;var C,L,I=h(P),O=new(a?Uint8Array:Array)(30);for(C=0,L=O.length;C<L;++C)O[C]=5;var H=h(O);function D(t,r){for(var n,i=t.f,a=t.d,o=t.input,s=t.c,l=o.length;a<r;)s>=l&&e(Error("input buffer is broken")),i|=o[s++]<<a,a+=8;return n=i&(1<<r)-1,t.f=i>>>r,t.d=a-r,t.c=s,n}function N(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.c,l=o.length,u=t[0],c=t[1];a<c&&!(s>=l);)i|=o[s++]<<a,a+=8;return n=(r=u[i&(1<<c)-1])>>>16,e.f=i>>n,e.d=a-n,e.c=s,65535&r}function F(e){function t(e,t,r){var n,i,a,o=this.w;for(a=0;a<e;)switch(n=N(this,t),n){case 16:for(i=3+D(this,2);i--;)r[a++]=o;break;case 17:for(i=3+D(this,3);i--;)r[a++]=0;o=0;break;case 18:for(i=11+D(this,7);i--;)r[a++]=0;o=0;break;default:o=r[a++]=n}return this.w=o,r}var r,n,i,o,s=D(e,5)+257,l=D(e,5)+1,u=D(e,4)+4,c=new(a?Uint8Array:Array)(E.length);for(o=0;o<u;++o)c[E[o]]=D(e,3);if(!a)for(o=u,u=c.length;o<u;++o)c[E[o]]=0;r=h(c),n=new(a?Uint8Array:Array)(s),i=new(a?Uint8Array:Array)(l),e.w=0,e.l(h(t.call(e,s,r,n)),h(t.call(e,l,r,i)))}function U(e){this.input=e,this.c=0,this.m=[],this.s=!1}m.prototype.l=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length-258;256!==(i=N(this,e));)if(256>i)n>=l&&(this.a=n,r=this.e(),n=this.a),r[n++]=i;else for(s=x[a=i-257],0<S[a]&&(s+=D(this,S[a])),i=N(this,t),o=R[i],0<k[i]&&(o+=D(this,k[i])),n>=l&&(this.a=n,r=this.e(),n=this.a);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.D=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length;256!==(i=N(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=x[a=i-257],0<S[a]&&(s+=D(this,S[a])),i=N(this,t),o=R[i],0<k[i]&&(o+=D(this,k[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.e=function(){var e,t,r=new(a?Uint8Array:Array)(this.a-32768),n=this.a-32768,i=this.b;if(a)r.set(i.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=i[e+32768];if(this.i.push(r),this.n+=r.length,a)i.set(i.subarray(n,n+32768));else for(e=0;32768>e;++e)i[e]=i[n+e];return this.a=32768,i},m.prototype.F=function(e){var t,r,n,i=this.input.length/this.c+1|0,o=this.input,s=this.b;return e&&("number"==typeof e.t&&(i=e.t),"number"==typeof e.A&&(i+=e.A)),2>i?r=(n=(o.length-this.c)/this.r[2]/2*258|0)<s.length?s.length+n:s.length<<1:r=s.length*i,a?(t=new Uint8Array(r)).set(s):t=s,this.b=t},m.prototype.q=function(){var e,t,r,n,i,o=0,s=this.b,l=this.i,u=new(a?Uint8Array:Array)(this.n+(this.a-32768));if(0===l.length)return a?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,r=l.length;t<r;++t)for(n=0,i=(e=l[t]).length;n<i;++n)u[o++]=e[n];for(t=32768,r=this.a;t<r;++t)u[o++]=s[t];return this.i=[],this.buffer=u},m.prototype.B=function(){var e,t=this.a;return a?this.z?(e=new Uint8Array(t)).set(this.b.subarray(0,t)):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},U.prototype.G=function(){return this.s||this.g(),this.m.slice()},U.prototype.g=function(){for(var r=this.input.length;this.c<r;){var n,i,o=new c,l=t,u=t,h=t,d=t,f=t,p=t,v=t,g=this.input,y=this.c;switch(o.u=g[y++],o.v=g[y++],(31!==o.u||139!==o.v)&&e(Error("invalid file signature:"+o.u+","+o.v)),o.p=g[y++],o.p){case 8:break;default:e(Error("unknown compression method: "+o.p))}if(o.h=g[y++],i=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24,o.I=new Date(1e3*i),o.O=g[y++],o.N=g[y++],0<(4&o.h)&&(o.J=g[y++]|g[y++]<<8,y+=o.J),0<(8&o.h)){for(p=[],f=0;0<(d=g[y++]);)p[f++]=String.fromCharCode(d);o.name=p.join("")}if(0<(16&o.h)){for(p=[],f=0;0<(d=g[y++]);)p[f++]=String.fromCharCode(d);o.K=p.join("")}0<(2&o.h)&&(o.C=65535&s(g,0,y),o.C!==(g[y++]|g[y++]<<8)&&e(Error("invalid header crc16"))),l=g[g.length-4]|g[g.length-3]<<8|g[g.length-2]<<16|g[g.length-1]<<24,g.length-y-4-4<512*l&&(h=l),u=new m(g,{index:y,bufferSize:h}),o.data=n=u.g(),y=u.c,o.L=v=(g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24)>>>0,s(n,t,t)!==v&&e(Error("invalid CRC-32 checksum: 0x"+s(n,t,t).toString(16)+" / 0x"+v.toString(16))),o.M=l=(g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24)>>>0,(4294967295&n.length)!==l&&e(Error("invalid input size: "+(4294967295&n.length)+" / "+l)),this.m.push(o),this.c=y}this.s=!0;var _,b,E,w=this.m,x=0,T=0;for(_=0,b=w.length;_<b;++_)T+=w[_].data.length;if(a)for(E=new Uint8Array(T),_=0;_<b;++_)E.set(w[_].data,x),x+=w[_].data.length;else{for(E=[],_=0;_<b;++_)E[_]=w[_].data;E=Array.prototype.concat.apply([],E)}return E},n("Zlib.Gunzip",U),n("Zlib.Gunzip.prototype.decompress",U.prototype.g),n("Zlib.Gunzip.prototype.getMembers",U.prototype.G)}).call(this)},function(e,t,r){(function(t){var r;e.exports=function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!l&&u)return r(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var r=t[s][1][e];return a(r||e)},h,h.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){t.exports={version:"1.5.0"}},{}],2:[function(e,t,r){"use strict";var n=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};n.prototype.head=function(){return this.head_},n.prototype.setHead=function(e){this.head_=e},n.prototype.tail=function(){return this.tail_},n.prototype.setTail=function(e){this.tail_=e},n.prototype.search=function(){return this.search_node_},n.prototype.setSearch=function(e){this.search_node_=e},n.prototype.findSearchNode=function(){return this.search_node_},n.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},n.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),n=r.point.x;if(t===n){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<n)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=n,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,r){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};i.prototype.toString=function(){return n.toStringBase(this)},i.prototype.toJSON=function(){return{x:this.x,y:this.y}},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.set_zero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},i.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},i.prototype.mul=function(e){return this.x*=e,this.y*=e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},i.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},i.negate=function(e){return new i(-e.x,-e.y)},i.add=function(e,t){return new i(e.x+t.x,e.y+t.y)},i.sub=function(e,t){return new i(e.x-t.x,e.y-t.y)},i.mul=function(e,t){return new i(e*t.x,e*t.y)},i.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new i(-e*t.y,e*t.x):"number"==typeof t?new i(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},i.toString=n.toString,i.compare=n.compare,i.cmp=n.compare,i.equals=n.equals,i.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=i},{"./xy":11}],5:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+n.toString(t[r])};(i.prototype=new Error).constructor=i,t.exports=i},{"./xy":11}],6:[function(e,r,n){(function(t){"use strict";var r=t.poly2tri;n.noConflict=function(){return t.poly2tri=r,n},n.VERSION=e("../dist/version.json").version,n.PointError=e("./pointerror"),n.Point=e("./point"),n.Triangle=e("./triangle"),n.SweepContext=e("./sweepcontext");var i=e("./sweep");n.triangulate=i.triangulate,n.sweep={Triangulate:i.triangulate}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){"use strict";function n(e,t){var r=e.locateNode(t),n=function(e,t,r){var n=new _(t,r.point,r.next.point);n.markNeighbor(r.triangle),e.addToMap(n);var i=new b(t);return i.next=r.next,i.prev=r,r.next.prev=i,r.next=i,l(e,n)||e.mapTriangleToNodes(n),i}(e,t,r);return t.x<=r.point.x+w&&s(e,r),function(e,t){for(var r=t.next;r.next&&!M(r.point,r.next.point,r.prev.point);)s(e,r),r=r.next;for(r=t.prev;r.prev&&!M(r.point,r.next.point,r.prev.point);)s(e,r),r=r.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return g(r>=0,"unordered y"),t>=0||Math.abs(t)<r}(t)&&function(e,t){for(T(t.point,t.next.point,t.next.next.point)===x.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,r){if(!function(e,t){var r;return r=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>r}(t,r)&&(s(t,r),r.prev!==t.basin.left_node||r.next!==t.basin.right_node)){if(r.prev===t.basin.left_node){if(T(r.point,r.next.point,r.next.next.point)===x.CW)return;r=r.next}else if(r.next===t.basin.right_node){if(T(r.point,r.prev.point,r.prev.prev.point)===x.CCW)return;r=r.prev}else r=r.prev.point.y<r.next.point.y?r.prev:r.next;e(t,r)}}(e,e.basin.bottom_node))}}(e,t)}(e,n),n}function i(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,o(r.triangle,t.p,t.q)||(function(e,t,r){e.edge_event.right?function(e,t,r){for(;r.next.point.x<t.p.x;)T(t.q,r.next.point,t.p)===x.CCW?h(e,t,r):r=r.next}(e,t,r):function(e,t,r){for(;r.prev.point.x>t.p.x;)T(t.q,r.prev.point,t.p)===x.CW?f(e,t,r):r=r.prev}(e,t,r)}(e,t,r),a(e,t.p,t.q,r.triangle,t.q))}function a(e,t,r,n,i){if(!o(n,t,r)){var s=n.pointCCW(i),l=T(r,s,t);if(l===x.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,s,t]);var u=n.pointCW(i),c=T(r,u,t);if(c===x.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,u,t]);l===c?(n=l===x.CW?n.neighborCCW(i):n.neighborCW(i),a(e,t,r,n,i)):m(e,t,r,n,i)}}function o(e,t,r){var n=e.edgeIndex(t,r);if(-1!==n){e.markConstrainedEdgeByIndex(n);var i=e.getNeighbor(n);return i&&i.markConstrainedEdgeByPoints(t,r),!0}return!1}function s(e,t){var r=new _(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,l(e,r)||e.mapTriangleToNodes(r)}function l(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var n=t.getNeighbor(r);if(n){var i=t.getPoint(r),a=n.oppositePoint(t,i),o=n.index(a);if(n.constrained_edge[o]||n.delaunay_edge[o]){t.constrained_edge[r]=n.constrained_edge[o];continue}var s=u(i,t.pointCCW(i),t.pointCW(i),a);if(s){t.delaunay_edge[r]=!0,n.delaunay_edge[o]=!0,c(t,i,n,a);var h=!l(e,t);return h&&e.mapTriangleToNodes(t),(h=!l(e,n))&&e.mapTriangleToNodes(n),t.delaunay_edge[r]=!1,n.delaunay_edge[o]=!1,!0}}}return!1}function u(e,t,r,n){var i=e.x-n.x,a=e.y-n.y,o=t.x-n.x,s=t.y-n.y,l=i*s,u=o*a,c=l-u;if(c<=0)return!1;var h=r.x-n.x,d=r.y-n.y,f=h*a,p=i*d,m=f-p;return!(m<=0)&&(i*i+a*a)*(o*d-h*s)+(o*o+s*s)*m+(h*h+d*d)*c>0}function c(e,t,r,n){var i,a,o,s,l,u,c,h,d,f,p,m;i=e.neighborCCW(t),a=e.neighborCW(t),o=r.neighborCCW(n),s=r.neighborCW(n),l=e.getConstrainedEdgeCCW(t),u=e.getConstrainedEdgeCW(t),c=r.getConstrainedEdgeCCW(n),h=r.getConstrainedEdgeCW(n),d=e.getDelaunayEdgeCCW(t),f=e.getDelaunayEdgeCW(t),p=r.getDelaunayEdgeCCW(n),m=r.getDelaunayEdgeCW(n),e.legalize(t,n),r.legalize(n,t),r.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,f),e.setDelaunayEdgeCCW(n,p),r.setDelaunayEdgeCW(n,m),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,u),e.setConstrainedEdgeCCW(n,c),r.setConstrainedEdgeCW(n,h),e.clearNeighbors(),r.clearNeighbors(),i&&r.markNeighbor(i),a&&e.markNeighbor(a),o&&e.markNeighbor(o),s&&r.markNeighbor(s),e.markNeighbor(r)}function h(e,t,r){r.point.x<t.p.x&&(T(r.point,r.next.point,r.next.next.point)===x.CCW?d(e,t,r):(function e(t,r,n){T(n.next.point,n.next.next.point,n.next.next.next.point)===x.CCW?d(t,r,n.next):T(r.q,n.next.next.point,r.p)===x.CCW&&e(t,r,n.next)}(e,t,r),h(e,t,r)))}function d(e,t,r){s(e,r.next),r.next.point!==t.p&&T(t.q,r.next.point,t.p)===x.CCW&&T(r.point,r.next.point,r.next.next.point)===x.CCW&&d(e,t,r)}function f(e,t,r){r.point.x>t.p.x&&(T(r.point,r.prev.point,r.prev.prev.point)===x.CW?p(e,t,r):(function e(t,r,n){T(n.prev.point,n.prev.prev.point,n.prev.prev.prev.point)===x.CW?p(t,r,n.prev):T(r.q,n.prev.prev.point,r.p)===x.CW&&e(t,r,n.prev)}(e,t,r),f(e,t,r)))}function p(e,t,r){s(e,r.prev),r.prev.point!==t.p&&T(t.q,r.prev.point,t.p)===x.CW&&T(r.point,r.prev.point,r.prev.prev.point)===x.CW&&p(e,t,r)}function m(e,t,r,n,i){var o=n.neighborAcross(i);g(o,"FLIP failed due to missing triangle!");var s=o.oppositePoint(n,i);if(n.getConstrainedEdgeAcross(i)){var u=n.index(i);throw new y("poly2tri Intersecting Constraints",[i,s,n.getPoint((u+1)%3),n.getPoint((u+2)%3)])}if(S(i,n.pointCCW(i),n.pointCW(i),s))if(c(n,i,o,s),e.mapTriangleToNodes(n),e.mapTriangleToNodes(o),i===r&&s===t)r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,r),o.markConstrainedEdgeByPoints(t,r),l(e,n),l(e,o));else{var h=T(r,s,t);n=function(e,t,r,n,i,a){var o;return t===x.CCW?(o=n.edgeIndex(i,a),n.delaunay_edge[o]=!0,l(e,n),n.clearDelaunayEdges(),r):(o=r.edgeIndex(i,a),r.delaunay_edge[o]=!0,l(e,r),r.clearDelaunayEdges(),n)}(e,h,n,o,i,s),m(e,t,r,n,i)}else(function e(t,r,n,i,a,o){var s=a.neighborAcross(o);g(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(a,o);S(n,i.pointCCW(n),i.pointCW(n),l)?m(t,n,l,s,l):e(t,r,n,i,s,v(r,n,s,l))})(e,t,r,n,o,v(t,r,o,s)),a(e,t,r,n,i)}function v(e,t,r,n){var i=T(t,n,e);if(i===x.CW)return r.pointCCW(n);if(i===x.CCW)return r.pointCW(n);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}var g=e("./assert"),y=e("./pointerror"),_=e("./triangle"),b=e("./advancingfront").Node,E=e("./utils"),w=E.EPSILON,x=E.Orientation,T=E.orient2d,S=E.inScanArea,M=E.isAngleObtuse;r.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var a=e.getPoint(t),o=n(e,a),s=a._p2t_edge_list,l=0;s&&l<s.length;++l)i(e,s[l],o)}(e),function(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){"use strict";var n=e("./pointerror"),i=e("./point"),a=e("./triangle"),o=e("./sweep"),s=e("./advancingfront"),l=s.Node,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new n("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},c=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};c.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},d=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new c,this.edge_event=new h,this.initEdges(this.points_)};d.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},d.prototype.addPoint=function(e){return this.points_.push(e),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},d.prototype.triangulate=function(){return o.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(e){this.head_=e},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(e){this.tail_=e},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,n=this.points_[0].y,a=this.points_[0].y,o=this.points_.length;for(e=1;e<o;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<r&&(r=s.x),s.y>n&&(n=s.y),s.y<a&&(a=s.y)}this.pmin_=new i(r,a),this.pmax_=new i(t,n);var l=.3*(t-r),u=.3*(n-a);this.head_=new i(t+l,a-u),this.tail_=new i(r-l,a-u),this.points_.sort(i.compare)},d.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new u(e[t],e[(t+1)%r]))},d.prototype.getPoint=function(e){return this.points_[e]},d.prototype.addToMap=function(e){this.map_.push(e)},d.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},d.prototype.createAdvancingFront=function(){var e,t,r,n=new a(this.points_[0],this.tail_,this.head_);this.map_.push(n),e=new l(n.getPoint(1),n),t=new l(n.getPoint(0),n),r=new l(n.getPoint(2)),this.front_=new s(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t},d.prototype.removeNode=function(e){},d.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},d.prototype.removeFromMap=function(e){var t,r=this.map_,n=r.length;for(t=0;t<n;t++)if(r[t]===e){r.splice(t,1);break}},d.prototype.meshClean=function(e){for(var t,r,n=[e];t=n.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||n.push(t.getNeighbor(r))},t.exports=d},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},a=n.toString;i.prototype.toString=function(){return"["+a(this.points_[0])+a(this.points_[1])+a(this.points_[2])+"]"},i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,r){var n=this.points_;if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=r;else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=r;else{if(!(e===n[0]&&t===n[1]||e===n[1]&&t===n[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},i.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,r){"use strict";var n=1e-12;r.EPSILON=n;var i={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=i,r.orient2d=function(e,t,r){var a=(e.x-r.x)*(t.y-r.y),o=(e.y-r.y)*(t.x-r.x),s=a-o;return s>-n&&s<n?i.COLLINEAR:s>0?i.CCW:i.CW},r.inScanArea=function(e,t,r,i){return!((e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>=-n||(e.x-r.x)*(i.y-r.y)-(i.x-r.x)*(e.y-r.y)<=n)},r.isAngleObtuse=function(e,t,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)<0}},{}],11:[function(e,t,r){"use strict";function n(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?n(e):t},toStringBase:n,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}).call(this,r(5))},function(e,t,r){var n;!function(i){function a(e,t,r,n,i){this._listener=t,this._isOnce=r,this.context=n,this._signal=e,this._priority=i||0}function o(e,t){if("function"!=typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function s(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){s.prototype.dispatch.apply(e,arguments)}}a.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},s.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,n){var i=this._indexOfListener(e,r);if(-1!==i){if((e=this._bindings[i]).isOnce()!==t)throw Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else e=new a(this,e,t,r,n),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return o(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return o(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){o(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,r=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=r),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(r))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var l=s;l.Signal=s,void 0===(n=function(){return l}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){(function(r){var n;
/*!
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
/*!
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||a;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||f(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||f(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,f()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var r=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=n&&parseInt(n[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!r&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||a,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),r=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||r)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(){a._autoResume();var t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),void 0===t.start?t.noteOn(0):t.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),t.onended=function(){t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0)}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var r=0;r<e._howls[t]._sounds.length;r++)if(!e._howls[t]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return a.ctx||f(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhrWithCredentials=e.xhrWithCredentials||!1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,void 0!==a.ctx&&a.ctx&&a.mobileAutoEnable&&a._enableMobileAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=null;if(a.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var t=0;t<this._src.length;t++){var r,n;if(this._format&&this._format[t])r=this._format[t];else{if("string"!=typeof(n=this._src[t])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(n))||(r=/\.([^.]+)$/.exec(n.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&a.codecs(r)){e=this._src[t];break}}if(e)return this._src=e,this._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new s(this),this._webAudio&&u(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var r=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e){e="__default";for(var i=0,o=0;o<r._sounds.length;o++)r._sounds[o]._paused&&!r._sounds[o]._ended&&(i++,n=r._sounds[o]._id);1===i?e=null:n=null}}var s=n?r._soundById(n):r._inactiveSound();if(!s)return null;if(n&&!e&&(e=s._sprite||"__default"),"loaded"!==r._state){s._sprite=e,s._ended=!1;var l=s._id;return r._queue.push({event:"play",action:function(){r.play(l)}}),l}if(n&&!s._paused)return t||setTimeout(function(){r._emit("play",s._id)},0),s._id;r._webAudio&&a._autoResume();var u=Math.max(0,s._seek>0?s._seek:r._sprite[e][0]/1e3),c=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-u),h=1e3*c/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=u,s._start=r._sprite[e][0]/1e3,s._stop=(r._sprite[e][0]+r._sprite[e][1])/1e3,s._loop=!(!s._loop&&!r._sprite[e][2]);var d=s._node;if(r._webAudio){var f=function(){r._refreshBuffer(s);var e=s._muted||r._muted?0:s._volume;d.gain.setValueAtTime(e,a.ctx.currentTime),s._playStart=a.ctx.currentTime,void 0===d.bufferSource.start?s._loop?d.bufferSource.noteGrainOn(0,u,86400):d.bufferSource.noteGrainOn(0,u,c):s._loop?d.bufferSource.start(0,u,86400):d.bufferSource.start(0,u,c),h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||setTimeout(function(){r._emit("play",s._id)},0)};"running"===a.state?f():(r.once("resume",f),r._clearTimer(s._id))}else{var p=function(){d.currentTime=u,d.muted=s._muted||r._muted||a._muted||d.muted,d.volume=s._volume*a.volume(),d.playbackRate=s._rate;try{var e=d.play();if("undefined"!=typeof Promise&&e instanceof Promise&&(r._playLock=!0,e.then(function(){r._playLock=!1,r._loadQueue()})),d.paused)return void r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||r._emit("play",s._id)}catch(e){r._emit("playerror",s._id,e)}},m=window&&window.ejecta||!d.readyState&&a._navigator.isCocoonJS;if(4===d.readyState||m)p();else{var v=function(){p(),d.removeEventListener(a._canPlayEvent,v,!1)};d.addEventListener(a._canPlayEvent,v,!1),r._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var r=t._getSoundIds(e),n=0;n<r.length;n++){t._clearTimer(r[n]);var i=t._soundById(r[n]);if(i&&!i._paused&&(i._seek=t.seek(r[n]),i._rateSeek=0,i._paused=!0,t._stopFade(r[n]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"stop",action:function(){r.stop(e)}}),r;for(var n=r._getSoundIds(e),i=0;i<n.length;i++){r._clearTimer(n[i]);var a=r._soundById(n[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,r._stopFade(n[i]),a._node&&(r._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),r._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause())),t||r._emit("stop",a._id))}return r},mute:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"mute",action:function(){r.mute(e,t)}}),r;if(void 0===t){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var n=r._getSoundIds(t),i=0;i<n.length;i++){var o=r._soundById(n[i]);o&&(o._muted=e,o._interval&&r._stopFade(o._id),r._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),r._emit("mute",o._id))}return r},volume:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._volume;if(1===i.length||2===i.length&&void 0===i[1]){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(r=t?n._soundById(t):n._sounds[0])?r._volume:0;if("loaded"!==n._state)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,i)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)(r=n._soundById(t[l]))&&(r._volume=e,i[2]||n._stopFade(t[l]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,a.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*a.volume()),n._emit("volume",r._id));return n},fade:function(e,t,r,n){var i=this;if("loaded"!==i._state)return i._queue.push({event:"fade",action:function(){i.fade(e,t,r,n)}}),i;i.volume(e,n);for(var o=i._getSoundIds(n),s=0;s<o.length;s++){var l=i._soundById(o[s]);if(l){if(n||i._stopFade(o[s]),i._webAudio&&!l._muted){var u=a.ctx.currentTime,c=u+r/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(t,c)}i._startFadeInterval(l,e,t,r,o[s],void 0===n)}}return i},_startFadeInterval:function(e,t,r,n,i,a){var o=this,s=t,l=r-t,u=Math.abs(l/.01),c=Math.max(4,u>0?n/u:n),h=Date.now();e._fadeTo=r,e._interval=setInterval(function(){var i=(Date.now()-h)/n;h=Date.now(),s+=l*i,s=Math.max(0,s),s=Math.min(1,s),s=Math.round(100*s)/100,o._webAudio?e._volume=s:o.volume(s,e._id,!0),a&&(o._volume=s),(r<t&&s<=r||r>t&&s>=r)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(r,e._id),o._emit("fade",e._id))},c)},_stopFade:function(e){var t=this._soundById(e);return t&&t._interval&&(this._webAudio&&t._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(t._interval),t._interval=null,this.volume(t._fadeTo,e),t._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(r=n._soundById(parseInt(i[0],10)))&&r._loop;e=i[0],n._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=n._getSoundIds(t),o=0;o<a.length;o++)(r=n._soundById(a[o]))&&(r._loop=e,n._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=e,e&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop)));return n},rate:function(){var e,t,r,n=this,i=arguments;if(0===i.length)t=n._sounds[0]._id;else if(1===i.length){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(r=n._soundById(t))?r._rate:n._rate;if("loaded"!==n._state)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,i)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)if(r=n._soundById(t[l])){r._rateSeek=n.seek(t[l]),r._playStart=n._webAudio?a.ctx.currentTime:r._playStart,r._rate=e,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):r._node&&(r._node.playbackRate=e);var u=n.seek(t[l]),c=(n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-u,h=1e3*c/Math.abs(r._rate);!n._endTimers[t[l]]&&r._paused||(n._clearTimer(t[l]),n._endTimers[t[l]]=setTimeout(n._ended.bind(n,r),h)),n._emit("rate",r._id)}return n},seek:function(){var e,t,r=this,n=arguments;if(0===n.length)t=r._sounds[0]._id;else if(1===n.length){var i=r._getSoundIds(),o=i.indexOf(n[0]);o>=0?t=parseInt(n[0],10):r._sounds.length&&(t=r._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return r;if("loaded"!==r._state)return r._queue.push({event:"seek",action:function(){r.seek.apply(r,n)}}),r;var s=r._soundById(t);if(s){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var l=r.playing(t)?a.ctx.currentTime-s._playStart:0,u=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(u+l*Math.abs(s._rate))}return s._node.currentTime}var c=r.playing(t);c&&r.pause(t,!0),s._seek=e,s._ended=!1,r._clearTimer(t),c&&r.play(t,!0),!r._webAudio&&s._node&&(s._node.currentTime=e),r._emit("seek",t)}return r},playing:function(e){if("number"==typeof e){var t=this._soundById(e);return!!t&&!t._paused}for(var r=0;r<this._sounds.length;r++)if(!this._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this._duration,r=this._soundById(e);return r&&(t=this._sprite[r._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,r=0;r<t.length;r++){if(t[r]._paused||e.stop(t[r]._id),!e._webAudio)/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(t[r]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[r]._node.removeEventListener("error",t[r]._errorFn,!1),t[r]._node.removeEventListener(a._canPlayEvent,t[r]._loadFn,!1);delete t[r]._node,e._clearTimer(t[r]._id);var n=a._howls.indexOf(e);n>=0&&a._howls.splice(n,1)}var i=!0;for(r=0;r<a._howls.length;r++)if(a._howls[r]._src===e._src){i=!1;break}return l&&i&&delete l[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,r,n){var i=this["_on"+e];return"function"==typeof t&&i.push(n?{id:r,fn:t,once:n}:{id:r,fn:t}),this},off:function(e,t,r){var n=this["_on"+e],i=0;if("number"==typeof t&&(r=t,t=null),t||r)for(i=0;i<n.length;i++){var a=r===n[i].id;if(t===n[i].fn&&a||!t&&a){n.splice(i,1);break}}else if(e)this["_on"+e]=[];else{var o=Object.keys(this);for(i=0;i<o.length;i++)0===o[i].indexOf("_on")&&Array.isArray(this[o[i]])&&(this[o[i]]=[])}return this},once:function(e,t,r){return this.on(e,t,r,1),this},_emit:function(e,t,r){for(var n=this["_on"+e],i=n.length-1;i>=0;i--)n[i].id&&n[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,r)}.bind(this,n[i].fn),0),n[i].once&&this.off(e,n[i].fn,n[i].id));return this},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var t=e._sprite;if(!this._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(this._ended.bind(this,e),100),this;var r=!(!e._loop&&!this._sprite[t][2]);if(this._emit("end",e._id),!this._webAudio&&r&&this.stop(e._id,!0).play(e._id),this._webAudio&&r){this._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var n=1e3*(e._stop-e._start)/Math.abs(e._rate);this._endTimers[e._id]=setTimeout(this._ended.bind(this,e),n)}return this._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,this._clearTimer(e._id),this._cleanBuffer(e._node),a._autoSuspend()),this._webAudio||r||this.stop(e._id),this},_clearTimer:function(e){return this._endTimers[e]&&(clearTimeout(this._endTimers[e]),delete this._endTimers[e]),this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new s(this)},_drain:function(){var e=this._pool,t=0,r=0;if(!(this._sounds.length<e)){for(r=0;r<this._sounds.length;r++)this._sounds[r]._ended&&t++;for(r=this._sounds.length-1;r>=0;r--){if(t<=e)return;this._sounds[r]._ended&&(this._webAudio&&this._sounds[r]._node&&this._sounds[r]._node.disconnect(0),this._sounds.splice(r,1),t--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],r=0;r<this._sounds.length;r++)t.push(this._sounds[r]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){if(a._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=a._scratchBuffer}catch(e){}}return e.bufferSource=null,this}};var s=function(e){this._parent=e,this.init()};s.prototype={init:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,e._sounds.push(this),this.create(),this},create:function(){var e=this._parent,t=a._muted||this._muted||this._parent._muted?0:this._volume;return e._webAudio?(this._node=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),this._node.gain.setValueAtTime(t,a.ctx.currentTime),this._node.paused=!0,this._node.connect(a.masterGain)):(this._node=new Audio,this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(a._canPlayEvent,this._loadFn,!1),this._node.src=e._src,this._node.preload="auto",this._node.volume=t*a.volume(),this._node.load()),this},reset:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(a._canPlayEvent,this._loadFn,!1)}};var l={},u=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var r=atob(t.split(",")[1]),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);h(n.buffer,e)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.withCredentials=e._xhrWithCredentials,a.responseType="arraybuffer",a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?h(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},c(a)}},c=function(e){try{e.send()}catch(t){e.onerror()}},h=function(e,t){a.ctx.decodeAudioData(e,function(e){e&&t._sounds.length>0&&(l[t._src]=e,d(t,e))},function(){t._emit("loaderror",null,"Decoding audio data failed.")})},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},f=function(){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(e){a.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=t?parseInt(t[1],10):null;if(e&&r&&r<9){var n=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());(a._navigator&&a._navigator.standalone&&!n||a._navigator&&!a._navigator.standalone&&!n)&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:1,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()};void 0===(n=function(){return{Howler:a,Howl:o}}.apply(t,[]))||(e.exports=n),t.Howler=a,t.Howl=o,"undefined"!=typeof window?(window.HowlerGlobal=i,window.Howler=a,window.Howl=o,window.Sound=s):void 0!==r&&(r.HowlerGlobal=i,r.Howler=a,r.Howl=o,r.Sound=s)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){if(!this.ctx||!this.ctx.listener)return this;for(var t=this._howls.length-1;t>=0;t--)this._howls[t].stereo(e);return this},HowlerGlobal.prototype.pos=function(e,t,r){return this.ctx&&this.ctx.listener?(t="number"!=typeof t?this._pos[1]:t,r="number"!=typeof r?this._pos[2]:r,"number"!=typeof e?this._pos:(this._pos=[e,t,r],this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(e,t,r,n,i,a){if(!this.ctx||!this.ctx.listener)return this;var o=this._orientation;return t="number"!=typeof t?o[1]:t,r="number"!=typeof r?o[2]:r,n="number"!=typeof n?o[3]:n,i="number"!=typeof i?o[4]:i,a="number"!=typeof a?o[5]:a,"number"!=typeof e?o:(this._orientation=[e,t,r,n,i,a],this.ctx.listener.setOrientation(e,t,r,n,i,a),this)},Howl.prototype.init=(e=Howl.prototype.init,function(t){return this._orientation=t.orientation||[1,0,0],this._stereo=t.stereo||null,this._pos=t.pos||null,this._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},this._onstereo=t.onstereo?[{fn:t.onstereo}]:[],this._onpos=t.onpos?[{fn:t.onpos}]:[],this._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,r)}}),n;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===r){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var s=n._soundById(a[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,i),"spatial"===i?s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",s._id)}}return n},Howl.prototype.pos=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,r,n,i)}}),a;if(r="number"!=typeof r?0:r,n="number"!=typeof n?-.5:n,void 0===i){if("number"!=typeof e)return a._pos;a._pos=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,r,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),l._panner.setPosition(e,r,n)),a._emit("pos",l._id)}}return a},Howl.prototype.orientation=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,r,n,i)}}),a;if(r="number"!=typeof r?a._orientation[1]:r,n="number"!=typeof n?a._orientation[2]:n,void 0===i){if("number"!=typeof e)return a._orientation;a._orientation=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,r,n],l._node&&(l._panner||(l._pos||(l._pos=a._pos||[0,0,-.5]),t(l,"spatial")),l._panner.setOrientation(e,r,n)),a._emit("orientation",l._id)}}return a},Howl.prototype.pannerAttr=function(){var e,r,n,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(n=i._soundById(parseInt(a[0],10)))?n._pannerAttr:i._pannerAttr;e=a[0],void 0===r&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],r=parseInt(a[1],10));for(var o=i._getSoundIds(r),s=0;s<o.length;s++)if(n=i._soundById(o[s])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this._parent;this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this),this._stereo?t.stereo(this._stereo):this._pos&&t.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this._parent;return this._orientation=t._orientation,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()}).call(this,r(5))},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,r,n){var i,a,o,s;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,s=l,console&&console.warn&&console.warn(s)}return e}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}.bind(n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)a(l,this,t);else{var u=l.length,c=p(l,u);for(r=0;r<u;++r)a(c[r],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,a,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t){THREE.OrbitControls=function(e,t){var r,n,i,a,o;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=h.NONE},this.update=(r=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=n.clone().inverse(),a=new THREE.Vector3,o=new THREE.Quaternion,function(){var e=s.object.position;return r.copy(e).sub(s.target),r.applyQuaternion(n),p.setFromVector3(r),s.autoRotate&&d===h.NONE&&k(2*Math.PI/60/60*s.autoRotateSpeed),p.theta+=m.theta,p.phi+=m.phi,p.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,p.theta)),p.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=v,p.radius=Math.max(s.minDistance,Math.min(s.maxDistance,p.radius)),s.target.add(g),r.setFromSpherical(p),r.applyQuaternion(i),e.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,g.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v=1,!!(y||a.distanceToSquared(s.object.position)>f||8*(1-o.dot(s.object.quaternion))>f)&&(s.dispatchEvent(l),a.copy(s.object.position),o.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",X,!1),s.domElement.removeEventListener("mousedown",F,!1),s.domElement.removeEventListener("wheel",z,!1),s.domElement.removeEventListener("touchstart",V,!1),s.domElement.removeEventListener("touchend",W,!1),s.domElement.removeEventListener("touchmove",G,!1),document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",B,!1),window.removeEventListener("keydown",j,!1)};var s=this,l={type:"change"},u={type:"start"},c={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},d=h.NONE,f=1e-6,p=new THREE.Spherical,m=new THREE.Spherical,v=1,g=new THREE.Vector3,y=!1,_=new THREE.Vector2,b=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,T=new THREE.Vector2,S=new THREE.Vector2,M=new THREE.Vector2,R=new THREE.Vector2;function A(){return Math.pow(.95,s.zoomSpeed)}function k(e){m.theta-=e}function P(e){m.phi-=e}var C,L=(C=new THREE.Vector3,function(e,t){C.setFromMatrixColumn(t,0),C.multiplyScalar(-e),g.add(C)}),I=function(){var e=new THREE.Vector3;return function(t,r){!0===s.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),g.add(e)}}(),O=function(){var e=new THREE.Vector3;return function(t,r){var n=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var i=s.object.position;e.copy(i).sub(s.target);var a=e.length();a*=Math.tan(s.object.fov/2*Math.PI/180),L(2*t*a/n.clientHeight,s.object.matrix),I(2*r*a/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),I(r*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function H(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function D(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(e){w.set(e.clientX,e.clientY)}function F(e){if(!1!==s.enabled){switch(e.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;N(e),d=h.PAN}else{if(!1===s.enableRotate)return;!function(e){_.set(e.clientX,e.clientY)}(e),d=h.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(e){S.set(e.clientX,e.clientY)}(e),d=h.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;N(e),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",U,!1),document.addEventListener("mouseup",B,!1),s.dispatchEvent(u))}}function U(e){if(!1!==s.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;!function(e){b.set(e.clientX,e.clientY),E.subVectors(b,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;k(2*Math.PI*E.x/t.clientHeight),P(2*Math.PI*E.y/t.clientHeight),_.copy(b),s.update()}(e);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),R.subVectors(M,S),R.y>0?H(A()):R.y<0&&D(A()),S.copy(M),s.update()}(e);break;case h.PAN:if(!1===s.enablePan)return;!function(e){x.set(e.clientX,e.clientY),T.subVectors(x,w).multiplyScalar(s.panSpeed),O(T.x,T.y),w.copy(x),s.update()}(e)}}function B(e){!1!==s.enabled&&(document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",B,!1),s.dispatchEvent(c),d=h.NONE)}function z(e){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(u),function(e){e.deltaY<0?D(A()):e.deltaY>0&&H(A()),s.update()}(e),s.dispatchEvent(c))}function j(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){var t=!1;switch(e.keyCode){case s.keys.UP:O(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:O(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:O(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:O(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function V(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);S.set(0,n)}if(s.enablePan){var i=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(i,a)}}(e),d=h.TOUCH_DOLLY_PAN;break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(u)}}function G(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(e){b.set(e.touches[0].pageX,e.touches[0].pageY),E.subVectors(b,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;k(2*Math.PI*E.x/t.clientHeight),P(2*Math.PI*E.y/t.clientHeight),_.copy(b),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(d!==h.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);M.set(0,n),R.set(0,Math.pow(M.y/S.y,s.zoomSpeed)),H(R.y),S.copy(M)}if(s.enablePan){var i=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(i,a),T.subVectors(x,w).multiplyScalar(s.panSpeed),O(T.x,T.y),w.copy(x)}s.update()}(e);break;default:d=h.NONE}}function W(e){!1!==s.enabled&&(s.dispatchEvent(c),d=h.NONE)}function X(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",X,!1),s.domElement.addEventListener("mousedown",F,!1),s.domElement.addEventListener("wheel",z,!1),s.domElement.addEventListener("touchstart",V,!1),s.domElement.addEventListener("touchend",W,!1),s.domElement.addEventListener("touchmove",G,!1),window.addEventListener("keydown",j,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}})},function(e,t){THREE.TrackballControls=function(e,t){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3,a=n.NONE,o=n.NONE,s=new THREE.Vector3,l=new THREE.Vector2,u=new THREE.Vector2,c=new THREE.Vector3,h=0,d=new THREE.Vector2,f=new THREE.Vector2,p=0,m=0,v=new THREE.Vector2,g=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},_={type:"start"},b={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var E,w,x,T,S,M,R,A,k,P,C,L=(E=new THREE.Vector2,function(e,t){return E.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),E}),I=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function O(e){!1!==r.enabled&&(window.removeEventListener("keydown",O),o=a,a===n.NONE&&(e.keyCode!==r.keys[n.ROTATE]||r.noRotate?e.keyCode!==r.keys[n.ZOOM]||r.noZoom?e.keyCode!==r.keys[n.PAN]||r.noPan||(a=n.PAN):a=n.ZOOM:a=n.ROTATE))}function H(e){!1!==r.enabled&&(a=o,window.addEventListener("keydown",O,!1))}function D(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a===n.NONE&&(a=e.button),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||(v.copy(L(e.pageX,e.pageY)),g.copy(v)):(d.copy(L(e.pageX,e.pageY)),f.copy(d)):(u.copy(I(e.pageX,e.pageY)),l.copy(u)),document.addEventListener("mousemove",N,!1),document.addEventListener("mouseup",F,!1),r.dispatchEvent(_))}function N(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||g.copy(L(e.pageX,e.pageY)):f.copy(L(e.pageX,e.pageY)):(l.copy(u),u.copy(I(e.pageX,e.pageY))))}function F(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a=n.NONE,document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",F),r.dispatchEvent(b))}function U(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:d.y-=.025*e.deltaY;break;case 1:d.y-=.01*e.deltaY;break;default:d.y-=25e-5*e.deltaY}r.dispatchEvent(_),r.dispatchEvent(b)}}function B(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:a=n.TOUCH_ROTATE,u.copy(I(e.touches[0].pageX,e.touches[0].pageY)),l.copy(u);break;default:a=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;m=p=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(L(o,s)),g.copy(v)}r.dispatchEvent(_)}}function z(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:l.copy(u),u.copy(I(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;m=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(L(i,a))}}function j(e){if(!1!==r.enabled){switch(e.touches.length){case 0:a=n.NONE;break;case 1:a=n.TOUCH_ROTATE,u.copy(I(e.touches[0].pageX,e.touches[0].pageY)),l.copy(u)}r.dispatchEvent(b)}}function V(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=(x=new THREE.Vector3,T=new THREE.Quaternion,S=new THREE.Vector3,M=new THREE.Vector3,R=new THREE.Vector3,A=new THREE.Vector3,function(){A.set(u.x-l.x,u.y-l.y,0),(w=A.length())?(s.copy(r.object.position).sub(r.target),S.copy(s).normalize(),M.copy(r.object.up).normalize(),R.crossVectors(M,S).normalize(),M.setLength(u.y-l.y),R.setLength(u.x-l.x),A.copy(M.add(R)),x.crossVectors(A,s).normalize(),w*=r.rotateSpeed,T.setFromAxisAngle(x,w),s.applyQuaternion(T),r.object.up.applyQuaternion(T),c.copy(x),h=w):!r.staticMoving&&h&&(h*=Math.sqrt(1-r.dynamicDampingFactor),s.copy(r.object.position).sub(r.target),T.setFromAxisAngle(c,h),s.applyQuaternion(T),r.object.up.applyQuaternion(T)),l.copy(u)}),this.zoomCamera=function(){var e;a===n.TOUCH_ZOOM_PAN?(e=p/m,p=m,s.multiplyScalar(e)):(1!==(e=1+(f.y-d.y)*r.zoomSpeed)&&e>0&&s.multiplyScalar(e),r.staticMoving?d.copy(f):d.y+=(f.y-d.y)*this.dynamicDampingFactor)},this.panCamera=(k=new THREE.Vector2,P=new THREE.Vector3,C=new THREE.Vector3,function(){k.copy(g).sub(v),k.lengthSq()&&(k.multiplyScalar(s.length()*r.panSpeed),C.copy(s).cross(r.object.up).setLength(k.x),C.add(P.copy(r.object.up).setLength(k.y)),r.object.position.add(C),r.target.add(C),r.staticMoving?v.copy(g):v.add(k.subVectors(g,v).multiplyScalar(r.dynamicDampingFactor)))}),this.checkDistances=function(){r.noZoom&&r.noPan||(s.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,s.setLength(r.maxDistance)),d.copy(f)),s.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,s.setLength(r.minDistance)),d.copy(f)))},this.update=function(){s.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,s),r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(y),i.copy(r.object.position))},this.reset=function(){a=n.NONE,o=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),s.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(y),i.copy(r.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",V,!1),this.domElement.removeEventListener("mousedown",D,!1),this.domElement.removeEventListener("wheel",U,!1),this.domElement.removeEventListener("touchstart",B,!1),this.domElement.removeEventListener("touchend",j,!1),this.domElement.removeEventListener("touchmove",z,!1),document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",F,!1),window.removeEventListener("keydown",O,!1),window.removeEventListener("keyup",H,!1)},this.domElement.addEventListener("contextmenu",V,!1),this.domElement.addEventListener("mousedown",D,!1),this.domElement.addEventListener("wheel",U,!1),this.domElement.addEventListener("touchstart",B,!1),this.domElement.addEventListener("touchend",j,!1),this.domElement.addEventListener("touchmove",z,!1),window.addEventListener("keydown",O,!1),window.addEventListener("keyup",H,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls},function(e,t){THREE.FirstPersonControls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0;var r,n=0,i=0,a=new THREE.Vector3,o=new THREE.Spherical,s=new THREE.Vector3;function l(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,r){return e.isVector3?s.copy(e):s.set(e,t,r),this.object.lookAt(s),m(this),this},this.update=(r=new THREE.Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var a=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);var o=e*this.lookSpeed;this.activeLook||(o=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.mouseX*o,this.lookVertical&&(n-=this.mouseY*o*s),n=Math.max(-85,Math.min(85,n));var l=THREE.Math.degToRad(90-n),u=THREE.Math.degToRad(i);this.constrainVertical&&(l=THREE.Math.mapLinear(l,0,Math.PI,this.verticalMin,this.verticalMax));var c=this.object.position;r.setFromSphericalCoords(1,l,u).add(c),this.object.lookAt(r)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",c,!1),this.domElement.removeEventListener("mousemove",u,!1),this.domElement.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)};var u=p(this,this.onMouseMove),c=p(this,this.onMouseDown),h=p(this,this.onMouseUp),d=p(this,this.onKeyDown),f=p(this,this.onKeyUp);function p(e,t){return function(){t.apply(e,arguments)}}function m(e){var t=e.object.quaternion;a.set(0,0,-1).applyQuaternion(t),o.setFromVector3(a),n=90-THREE.Math.radToDeg(o.phi),i=THREE.Math.radToDeg(o.theta)}this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousemove",u,!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mouseup",h,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),this.handleResize(),m(this)}},function(e,t){THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,u=new THREE.Plane,c=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Matrix4,p=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector4,_=new THREE.Matrix4,b=new THREE.PerspectiveCamera,E={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},w=new THREE.WebGLRenderTarget(i,a,E);THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(a)||(w.texture.generateMipmaps=!1);var x=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});x.uniforms.tDiffuse.value=w.texture,x.uniforms.color.value=n,x.uniforms.textureMatrix.value=_,this.material=x,this.onBeforeRender=function(e,t,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),f.extractRotation(r.matrixWorld),c.set(0,0,1),c.applyMatrix4(f),v.subVectors(h,d),!(v.dot(c)>0)){v.reflect(c).negate(),v.add(h),f.extractRotation(n.matrixWorld),p.set(0,0,-1),p.applyMatrix4(f),p.add(d),g.subVectors(h,p),g.reflect(c).negate(),g.add(h),b.position.copy(v),b.up.set(0,1,0),b.up.applyMatrix4(f),b.up.reflect(c),b.lookAt(g),b.far=n.far,b.updateMatrixWorld(),b.projectionMatrix.copy(n.projectionMatrix),b.userData.recursion=0,_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(b.projectionMatrix),_.multiply(b.matrixWorldInverse),_.multiply(r.matrixWorld),u.setFromNormalAndCoplanarPoint(c,h),u.applyMatrix4(b.matrixWorldInverse),m.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var i=b.projectionMatrix;y.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],y.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],y.z=-1,y.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(y)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-o,i.elements[14]=m.w,r.visible=!1;var a=e.getRenderTarget(),s=e.vr.enabled,E=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.clear(),e.render(t,b),e.vr.enabled=s,e.shadowMap.autoUpdate=E,e.setRenderTarget(a),n.isArrayCamera&&e.state.viewport(n.viewport),r.visible=!0}},this.getRenderTarget=function(){return w}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var u=new THREE.Plane,c=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},d=new THREE.WebGLRenderTarget(i,a,h);THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(a)||(d.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=d.texture,this.material.uniforms.textureMatrix.value=c;f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Matrix4,v=new THREE.Vector3,g=new THREE.Vector3;var f,p,m,v,g,y,_,b,E=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;return function(){r.matrixWorld.decompose(t,n,i),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),w=(y=new THREE.Plane,_=new THREE.Vector4,b=new THREE.Vector4,function(e){l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(e.projectionMatrix),l.far=e.far,y.copy(u),y.applyMatrix4(l.matrixWorldInverse),_.set(y.normal.x,y.normal.y,y.normal.z,y.constant);var t=l.projectionMatrix;b.x=(Math.sign(_.x)+t.elements[8])/t.elements[0],b.y=(Math.sign(_.y)+t.elements[9])/t.elements[5],b.z=-1,b.w=(1+t.elements[10])/t.elements[14],_.multiplyScalar(2/_.dot(b)),t.elements[2]=_.x,t.elements[6]=_.y,t.elements[10]=_.z+1-o,t.elements[14]=_.w});this.onBeforeRender=function(e,t,n){!0!==n.userData.refractor&&(E(),function(e){c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(e.projectionMatrix),c.multiply(e.matrixWorldInverse),c.multiply(r.matrixWorld)}(n),w(n),function(e,t,n){r.visible=!1;var i=e.getRenderTarget(),a=e.vr.enabled,o=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(d),e.clear(),e.render(t,l),e.vr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i),n.isArrayCamera&&e.state.viewport(n.viewport),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return d}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.FresnelShader={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")}},function(e,t){THREE.RGBELoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.type=THREE.UnsignedByteType},THREE.RGBELoader.prototype=Object.create(THREE.DataTextureLoader.prototype),THREE.RGBELoader.prototype._parser=function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var n=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));0>(i=s.indexOf("\n"))&&a<t&&n<e.byteLength;)o+=s,a+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<i&&(!1!==r&&(e.pos+=a+i+1),o+s.slice(0,i))},n=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function r(r){e[0]=r;var n=t[0],i=n>>16&32768,a=n>>12&2047,o=n>>23&255;return o<103?i:o>142?(i|=31744,i|=(255==o?0:1)&&8388607&n):o<113?i|=((a|=2048)>>114-o)+(a>>113-o&1):(i|=o-112<<10|a>>1,i+=1&a)}return function(e,t,n,i){var a=e[t+3],o=Math.pow(2,a-128)/255;n[i+0]=r(e[t+0]*o),n[i+1]=r(e[t+1]*o),n[i+2]=r(e[t+2]*o)}}(),i=new Uint8Array(e);i.pos=0;var a,o,s,l,u,c,h=function(e){var n,i,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=r(e)))return t(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(u.valid|=1,u.programtype=i[1],u.string+=n+"\n";!1!==(n=r(e));)if(u.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(a))&&(u.gamma=parseFloat(i[1],10)),(i=n.match(o))&&(u.exposure=parseFloat(i[1],10)),(i=n.match(s))&&(u.valid|=2,u.format=i[1]),(i=n.match(l))&&(u.valid|=4,u.height=parseInt(i[1],10),u.width=parseInt(i[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=n+"\n";return 2&u.valid?4&u.valid?u:t(3,"missing image size specifier"):t(3,"missing format specifier")}(i);if(-1!==h){var d=h.width,f=h.height,p=function(e,r,n){var i,a,o,s,l,u,c,h,d,f,p,m,v,g=r,y=n;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return t(4,"unable to allocate buffer space");for(a=0,o=0,h=4*g,v=new Uint8Array(4),u=new Uint8Array(h);y>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(v[0]=e[o++],v[1]=e[o++],v[2]=e[o++],v[3]=e[o++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return t(3,"bad rgbe scanline format");for(c=0;c<h&&o<e.byteLength;){if((m=(s=e[o++])>128)&&(s-=128),0===s||c+s>h)return t(3,"bad scanline data");if(m)for(l=e[o++],d=0;d<s;d++)u[c++]=l;else u.set(e.subarray(o,o+s),c),c+=s,o+=s}for(f=g,d=0;d<f;d++)p=0,i[a]=u[d+p],p+=g,i[a+1]=u[d+p],p+=g,i[a+2]=u[d+p],p+=g,i[a+3]=u[d+p],a+=4;y--}return i}(i.subarray(i.pos),d,f);if(-1!==p){switch(this.type){case THREE.UnsignedByteType:var m=p,v=THREE.RGBEFormat,g=THREE.UnsignedByteType;break;case THREE.FloatType:for(var y=p.length/4*3,_=new Float32Array(y),b=0;b<y;b++)s=_,l=3*b,u=void 0,c=void 0,u=(a=p)[(o=4*b)+3],c=Math.pow(2,u-128)/255,s[l+0]=a[o+0]*c,s[l+1]=a[o+1]*c,s[l+2]=a[o+2]*c;m=_,v=THREE.RGBFormat,g=THREE.FloatType;break;case THREE.HalfFloatType:y=p.length/4*3;var E=new Uint16Array(y);for(b=0;b<y;b++)n(p,4*b,E,3*b);m=E,v=THREE.RGBFormat,g=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:f,data:m,header:h.string,gamma:h.gamma,exposure:h.exposure,format:v,type:g}}}return null},THREE.RGBELoader.prototype.setType=function(e){return this.type=e,this},THREE.RGBELoader.prototype.load=function(e,t,r,n){return THREE.DataTextureLoader.prototype.load.call(this,e,function(e,r){switch(e.type){case THREE.UnsignedByteType:e.encoding=THREE.RGBEEncoding,e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case THREE.FloatType:case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}},function(e,t){THREE.HDRCubeTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.hdrLoader=new THREE.RGBELoader,this.type=THREE.UnsignedByteType},THREE.HDRCubeTextureLoader.prototype.load=function(e,t,r,n){Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setType() instead."),this.setType(e),e=t,t=r,r=n,n=arguments[4]);var i=new THREE.CubeTexture;switch(i.type=this.type,i.type){case THREE.UnsignedByteType:i.encoding=THREE.RGBEEncoding,i.format=THREE.RGBAFormat,i.minFilter=THREE.NearestFilter,i.magFilter=THREE.NearestFilter,i.generateMipmaps=!1;break;case THREE.FloatType:case THREE.HalfFloatType:i.encoding=THREE.LinearEncoding,i.format=THREE.RGBFormat,i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.generateMipmaps=!1}var a=this,o=0;function s(t,r,n,s){new THREE.FileLoader(a.manager).setPath(a.path).setResponseType("arraybuffer").load(e[t],function(e){o++;var n=a.hdrLoader._parser(e);if(n){if(void 0!==n.data){var s=new THREE.DataTexture(n.data,n.width,n.height);s.type=i.type,s.encoding=i.encoding,s.format=i.format,s.minFilter=i.minFilter,s.magFilter=i.magFilter,s.generateMipmaps=i.generateMipmaps,i.images[t]=s}6===o&&(i.needsUpdate=!0,r&&r(i))}},n,s)}for(var l=0;l<e.length;l++)s(l,t,r,n);return i},THREE.HDRCubeTextureLoader.prototype.setPath=function(e){return this.path=e,this},THREE.HDRCubeTextureLoader.prototype.setType=function(e){return this.type=e,this.hdrLoader.setType(e),this}},function(e,t){THREE.PMREMGenerator=function(){var e,t=((e=new THREE.ShaderMaterial({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},tFlip:{value:-1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform float tFlip;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tvec3 correctedDirection = vec3( tFlip * sampleDirection.x, sampleDirection.yz );\n\t\t\t\t\tmat3 vecSpace = matrixFromVector( normalize( correctedDirection ) );\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap, vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:THREE.NoBlending})).type="PMREMGenerator",e),r=new THREE.OrthographicCamera(-1,1,1,-1,0,1e3),n=new THREE.Scene,i=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2,0),t);i.material.side=THREE.DoubleSide,n.add(i),n.add(r);var a=function(e,t,r){this.sourceTexture=e,this.resolution=void 0!==r?r:256,this.samplesPerLevel=void 0!==t?t:32;var n=this.sourceTexture.encoding===THREE.LinearEncoding||this.sourceTexture.encoding===THREE.GammaEncoding||this.sourceTexture.encoding===THREE.sRGBEncoding;this.sourceTexture.minFilter=n?THREE.LinearFilter:THREE.NearestFilter,this.sourceTexture.magFilter=n?THREE.LinearFilter:THREE.NearestFilter,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&n,this.cubeLods=[];var i=this.resolution,a={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(i)/Math.log(2)-2;for(var o=0;o<this.numLods;o++){var s=new THREE.WebGLRenderTargetCube(i,i,a);s.texture.name="PMREMGenerator.cube"+o,this.cubeLods.push(s),i=Math.max(16,i/2)}};return a.prototype={constructor:a,update:function(e){var r=this.sourceTexture.isCubeTexture?-1:1;t.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,t.uniforms.faceIndex.value=0,t.uniforms.envMap.value=this.sourceTexture,t.envMap=this.sourceTexture,t.needsUpdate=!0;var n=e.gammaInput,i=e.gammaOutput,a=e.toneMapping,o=e.toneMappingExposure,s=e.getRenderTarget();e.toneMapping=THREE.LinearToneMapping,e.toneMappingExposure=1,e.gammaInput=!1,e.gammaOutput=!1;for(var l=0;l<this.numLods;l++){var u=l/(this.numLods-1);t.uniforms.roughness.value=.9*u,t.uniforms.tFlip.value=0==l?r:1;var c=this.cubeLods[l].width;t.uniforms.mapSize.value=c,this.renderToCubeMapTarget(e,this.cubeLods[l]),l<5&&(t.uniforms.envMap.value=this.cubeLods[l].texture)}e.setRenderTarget(s),e.toneMapping=a,e.toneMappingExposure=o,e.gammaInput=n,e.gammaOutput=i},renderToCubeMapTarget:function(e,t){for(var r=0;r<6;r++)this.renderToCubeMapTargetFace(e,t,r)},renderToCubeMapTargetFace:function(e,i,a){t.uniforms.faceIndex.value=a,e.setRenderTarget(i,a),e.clear(),e.render(n,r)},dispose:function(){for(var e=0,t=this.cubeLods.length;e<t;e++)this.cubeLods[e].dispose()}},a}()},function(e,t){var r,n,i,a,o;THREE.PMREMCubeUVPacker=(n=new THREE.OrthographicCamera,i=new THREE.Scene,(r=new THREE.ShaderMaterial({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"precision highp float;        varying vec2 vUv;        void main() {          vUv = uv;          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );        }",fragmentShader:"precision highp float;        varying vec2 vUv;        uniform samplerCube envMap;        uniform float mapSize;        uniform vec3 testColor;        uniform int faceIndex;                void main() {          vec3 sampleDirection;          vec2 uv = vUv;          uv = uv * 2.0 - 1.0;          uv.y *= -1.0;          if(faceIndex == 0) {            sampleDirection = normalize(vec3(1.0, uv.y, -uv.x));          } else if(faceIndex == 1) {            sampleDirection = normalize(vec3(uv.x, 1.0, uv.y));          } else if(faceIndex == 2) {            sampleDirection = normalize(vec3(uv.x, uv.y, 1.0));          } else if(faceIndex == 3) {            sampleDirection = normalize(vec3(-1.0, uv.y, uv.x));          } else if(faceIndex == 4) {            sampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));          } else {            sampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));          }          vec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );          gl_FragColor = linearToOutputTexel( color );        }",blending:THREE.NoBlending})).type="PMREMCubeUVPacker",a=r,(o=function(e){this.cubeLods=e;var t=4*e[0].width,r=e[0].texture,n={format:r.format,magFilter:r.magFilter,minFilter:r.minFilter,type:r.type,generateMipmaps:r.generateMipmaps,anisotropy:r.anisotropy,encoding:r.encoding===THREE.RGBEEncoding?THREE.RGBM16Encoding:r.encoding};n.encoding===THREE.RGBM16Encoding&&(n.magFilter=THREE.LinearFilter,n.minFilter=THREE.LinearFilter),this.CubeUVRenderTarget=new THREE.WebGLRenderTarget(t,t,n),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=THREE.CubeUVReflectionMapping,this.objects=[];var i=new THREE.PlaneBufferGeometry(1,1),o=[];o.push(new THREE.Vector2(0,0)),o.push(new THREE.Vector2(1,0)),o.push(new THREE.Vector2(2,0)),o.push(new THREE.Vector2(0,1)),o.push(new THREE.Vector2(1,1)),o.push(new THREE.Vector2(2,1));var s=t;t=e[0].width;var l=0,u=4;this.numLods=Math.log(e[0].width)/Math.log(2)-2;for(var c=0;c<this.numLods;c++){var h=.5*(s-s/u);t>16&&(u*=2);for(var d=t>16?6:1,f=0,p=0,m=t,v=0;v<d;v++){for(var g=0;g<6;g++){var y=a.clone();y.uniforms.envMap.value=this.cubeLods[c].texture,y.envMap=this.cubeLods[c].texture,y.uniforms.faceIndex.value=g,y.uniforms.mapSize.value=m;var _=new THREE.Mesh(i,y);_.position.x=o[g].x*m-h+f,_.position.y=o[g].y*m-h+l+p,_.material.side=THREE.BackSide,_.scale.setScalar(m),this.objects.push(_)}p+=1.75*m,f+=1.25*m,m/=2}l+=2*t,t>16&&(t/=2)}}).prototype={constructor:o,update:function(e){var t=4*this.cubeLods[0].width;n.left=.5*-t,n.right=.5*t,n.top=.5*-t,n.bottom=.5*t,n.near=0,n.far=1,n.updateProjectionMatrix();for(var r=0;r<this.objects.length;r++)i.add(this.objects[r]);var a=e.gammaInput,o=e.gammaOutput,s=e.toneMapping,l=e.toneMappingExposure,u=e.getRenderTarget();for(e.gammaInput=!1,e.gammaOutput=!1,e.toneMapping=THREE.LinearToneMapping,e.toneMappingExposure=1,e.setRenderTarget(this.CubeUVRenderTarget),e.render(i,n),e.setRenderTarget(u),e.toneMapping=s,e.toneMappingExposure=l,e.gammaInput=a,e.gammaOutput=o,r=0;r<this.objects.length;r++)i.remove(this.objects[r])},dispose:function(){for(var e=0,t=this.objects.length;e<t;e++)this.objects[e].material.dispose();this.objects[0].geometry.dispose()}},o)},function(e,t){THREE.LegacyJSONLoader=function(){function e(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1}return Object.assign(e.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,function(r){var n=JSON.parse(r),o=n.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(n,a);t(l.geometry,l.materials)},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new THREE.Geometry;return function(e,t){function r(e,t){return e&1<<t}var n,i,a,o,s,l,u,c,h,d,f,p,m,v,g,y,_,b,E,w,x,T,S,M,R,A,k,P=e.faces,C=e.vertices,L=e.normals,I=e.colors,O=e.scale,H=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&H++;for(n=0;n<H;n++)t.faceVertexUvs[n]=[]}for(o=0,s=C.length;o<s;)(b=new THREE.Vector3).x=C[o++]*O,b.y=C[o++]*O,b.z=C[o++]*O,t.vertices.push(b);for(o=0,s=P.length;o<s;)if(f=r(d=P[o++],0),p=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),_=r(d,7),f){if((w=new THREE.Face3).a=P[o],w.b=P[o+1],w.c=P[o+3],(x=new THREE.Face3).a=P[o+1],x.b=P[o+2],x.c=P[o+3],o+=4,p&&(h=P[o++],w.materialIndex=h,x.materialIndex=h),a=t.faces.length,m)for(n=0;n<H;n++)for(M=e.uvs[n],t.faceVertexUvs[n][a]=[],t.faceVertexUvs[n][a+1]=[],i=0;i<4;i++)A=M[2*(c=P[o++])],k=M[2*c+1],R=new THREE.Vector2(A,k),2!==i&&t.faceVertexUvs[n][a].push(R),0!==i&&t.faceVertexUvs[n][a+1].push(R);if(v&&(u=3*P[o++],w.normal.set(L[u++],L[u++],L[u]),x.normal.copy(w.normal)),g)for(n=0;n<4;n++)u=3*P[o++],S=new THREE.Vector3(L[u++],L[u++],L[u]),2!==n&&w.vertexNormals.push(S),0!==n&&x.vertexNormals.push(S);if(y&&(T=I[l=P[o++]],w.color.setHex(T),x.color.setHex(T)),_)for(n=0;n<4;n++)T=I[l=P[o++]],2!==n&&w.vertexColors.push(new THREE.Color(T)),0!==n&&x.vertexColors.push(new THREE.Color(T));t.faces.push(w),t.faces.push(x)}else{if((E=new THREE.Face3).a=P[o++],E.b=P[o++],E.c=P[o++],p&&(h=P[o++],E.materialIndex=h),a=t.faces.length,m)for(n=0;n<H;n++)for(M=e.uvs[n],t.faceVertexUvs[n][a]=[],i=0;i<3;i++)A=M[2*(c=P[o++])],k=M[2*c+1],R=new THREE.Vector2(A,k),t.faceVertexUvs[n][a].push(R);if(v&&(u=3*P[o++],E.normal.set(L[u++],L[u++],L[u])),g)for(n=0;n<3;n++)u=3*P[o++],S=new THREE.Vector3(L[u++],L[u++],L[u]),E.vertexNormals.push(S);if(y&&(l=P[o++],E.color.setHex(I[l])),_)for(n=0;n<3;n++)l=P[o++],E.vertexColors.push(new THREE.Color(I[l]));t.faces.push(E)}}(e,r),function(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=r){var a=e.skinWeights[n],o=r>1?e.skinWeights[n+1]:0,s=r>2?e.skinWeights[n+2]:0,l=r>3?e.skinWeights[n+3]:0;t.skinWeights.push(new THREE.Vector4(a,o,s,l))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=r){var u=e.skinIndices[n],c=r>1?e.skinIndices[n+1]:0,h=r>2?e.skinIndices[n+2]:0,d=r>3?e.skinIndices[n+3]:0;t.skinIndices.push(new THREE.Vector4(u,c,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;n<i;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var a=t.morphTargets[n].vertices,o=e.morphTargets[n].vertices,s=0,l=o.length;s<l;s+=3){var u=new THREE.Vector3;u.x=o[s]*r,u.y=o[s+1]*r,u.z=o[s+2]*r,a.push(u)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var c=t.faces,h=e.morphColors[0].colors;for(n=0,i=c.length;n<i;n++)c[n].color.fromArray(h,3*n)}}(e,r),function(e,t){var r=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var a=THREE.AnimationClip.parseAnimation(n[i],t.bones);a&&r.push(a)}if(t.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(o)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:THREE.Loader.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}),e}()},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /;function n(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(e,t,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[r+0],n[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,i,a,o,s,l){var u=this.vertices.length,c=this.parseVertexIndex(e,u),h=this.parseVertexIndex(t,u),d=this.parseVertexIndex(r,u);if(this.addVertex(c,h,d),void 0!==n&&""!==n){var f=this.uvs.length;c=this.parseUVIndex(n,f),h=this.parseUVIndex(i,f),d=this.parseUVIndex(a,f),this.addUV(c,h,d)}if(void 0!==o&&""!==o){var p=this.normals.length;c=this.parseNormalIndex(o,p),h=o===s?c:this.parseNormalIndex(s,p),d=o===l?c:this.parseNormalIndex(l,p),this.addNormal(c,h,d)}this.colors.length>0&&this.addColor(c,h,d)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,n=e.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,a=e.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var o=0;for(a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],n))}};return e.startObject("",!1),e}function i(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return i.prototype={constructor:i,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(this.path),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(i){console.time("OBJLoader");var a=new n;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var o=i.split("\n"),s="",l="",u=[],c="function"==typeof"".trimLeft,h=0,d=o.length;h<d;h++)if(s=o[h],0!==(s=c?s.trimLeft():s.trim()).length&&"#"!==(l=s.charAt(0)))if("v"===l){var f=s.split(/\s+/);switch(f[0]){case"v":a.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),7===f.length&&a.colors.push(parseFloat(f[4]/255),parseFloat(f[5]/255),parseFloat(f[6]/255));break;case"vn":a.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":a.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===l){for(var p=s.substr(1).trim().split(/\s+/),m=[],v=0,g=p.length;v<g;v++){var y=p[v];if(y.length>0){var _=y.split("/");m.push(_)}}var b=m[0];for(v=1,g=m.length-1;v<g;v++){var E=m[v],w=m[v+1];a.addFace(b[0],E[0],w[0],b[1],E[1],w[1],b[2],E[2],w[2])}}else if("l"===l){var x=s.substring(1).trim().split(" "),T=[],S=[];if(-1===s.indexOf("/"))T=x;else for(var M=0,R=x.length;M<R;M++){var A=x[M].split("/");""!==A[0]&&T.push(A[0]),""!==A[1]&&S.push(A[1])}a.addLineGeometry(T,S)}else if("p"===l){var k=s.substr(1).trim().split(" ");a.addPointGeometry(k)}else if(null!==(u=e.exec(s))){var P=(" "+u[0].substr(1).trim()).substr(1);a.startObject(P)}else if(r.test(s))a.object.startMaterial(s.substring(7).trim(),a.materialLibraries);else if(t.test(s))a.materialLibraries.push(s.substring(7).trim());else{if("s"!==l){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if((u=s.split(" ")).length>1){var C=u[1].trim().toLowerCase();a.object.smooth="0"!==C&&"off"!==C}else a.object.smooth=!0;(W=a.object.currentMaterial())&&(W.smooth=a.object.smooth)}a.finalize();var L=new THREE.Group;L.materialLibraries=[].concat(a.materialLibraries);for(h=0,d=a.objects.length;h<d;h++){var I=a.objects[h],O=I.geometry,H=I.materials,D="Line"===O.type,N="Points"===O.type,F=!1;if(0!==O.vertices.length){var U=new THREE.BufferGeometry;U.addAttribute("position",new THREE.Float32BufferAttribute(O.vertices,3)),O.normals.length>0?U.addAttribute("normal",new THREE.Float32BufferAttribute(O.normals,3)):U.computeVertexNormals(),O.colors.length>0&&(F=!0,U.addAttribute("color",new THREE.Float32BufferAttribute(O.colors,3))),O.uvs.length>0&&U.addAttribute("uv",new THREE.Float32BufferAttribute(O.uvs,2));for(var B,z=[],j=0,V=H.length;j<V;j++){var G=H[j],W=void 0;if(null!==this.materials)if(W=this.materials.create(G.name),!D||!W||W instanceof THREE.LineBasicMaterial){if(N&&W&&!(W instanceof THREE.PointsMaterial)){var X=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(X,W),X.color.copy(W.color),X.map=W.map,X.lights=!1,W=X}}else{var Y=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(Y,W),Y.color.copy(W.color),Y.lights=!1,W=Y}W||((W=D?new THREE.LineBasicMaterial:N?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=G.name),W.flatShading=!G.smooth,W.vertexColors=F?THREE.VertexColors:THREE.NoColors,z.push(W)}if(z.length>1){for(j=0,V=H.length;j<V;j++){G=H[j];U.addGroup(G.groupStart,G.groupCount,j)}B=D?new THREE.LineSegments(U,z):N?new THREE.Points(U,z):new THREE.Mesh(U,z)}else B=D?new THREE.LineSegments(U,z[0]):N?new THREE.Points(U,z[0]):new THREE.Mesh(U,z[0]);B.name=I.name,L.add(B)}}return console.timeEnd("OBJLoader"),L}},i}()},function(e,t){THREE.OBJExporter=function(){},THREE.OBJExporter.prototype={constructor:THREE.OBJExporter,parse:function(e){var t,r,n,i,a,o="",s=0,l=0,u=0,c=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector2,f=[];return e.traverse(function(e){e instanceof THREE.Mesh&&function(e){var n=0,p=0,m=0,v=e.geometry,g=new THREE.Matrix3;if(v instanceof THREE.Geometry&&(v=(new THREE.BufferGeometry).setFromObject(e)),v instanceof THREE.BufferGeometry){var y=v.getAttribute("position"),_=v.getAttribute("normal"),b=v.getAttribute("uv"),E=v.getIndex();if(o+="o "+e.name+"\n",e.material&&e.material.name&&(o+="usemtl "+e.material.name+"\n"),void 0!==y)for(t=0,i=y.count;t<i;t++,n++)c.x=y.getX(t),c.y=y.getY(t),c.z=y.getZ(t),c.applyMatrix4(e.matrixWorld),o+="v "+c.x+" "+c.y+" "+c.z+"\n";if(void 0!==b)for(t=0,i=b.count;t<i;t++,m++)d.x=b.getX(t),d.y=b.getY(t),o+="vt "+d.x+" "+d.y+"\n";if(void 0!==_)for(g.getNormalMatrix(e.matrixWorld),t=0,i=_.count;t<i;t++,p++)h.x=_.getX(t),h.y=_.getY(t),h.z=_.getZ(t),h.applyMatrix3(g),o+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==E)for(t=0,i=E.count;t<i;t+=3){for(a=0;a<3;a++)r=E.getX(t+a)+1,f[a]=s+r+(_||b?"/"+(b?l+r:"")+(_?"/"+(u+r):""):"");o+="f "+f.join(" ")+"\n"}else for(t=0,i=y.count;t<i;t+=3){for(a=0;a<3;a++)r=t+a+1,f[a]=s+r+(_||b?"/"+(b?l+r:"")+(_?"/"+(u+r):""):"");o+="f "+f.join(" ")+"\n"}}else console.warn("THREE.OBJExporter.parseMesh(): geometry type unsupported",v);s+=n,l+=m,u+=p}(e),e instanceof THREE.Line&&function(e){var a=0,l=e.geometry,u=e.type;if(l instanceof THREE.Geometry&&(l=(new THREE.BufferGeometry).setFromObject(e)),l instanceof THREE.BufferGeometry){var h=l.getAttribute("position");if(o+="o "+e.name+"\n",void 0!==h)for(t=0,i=h.count;t<i;t++,a++)c.x=h.getX(t),c.y=h.getY(t),c.z=h.getZ(t),c.applyMatrix4(e.matrixWorld),o+="v "+c.x+" "+c.y+" "+c.z+"\n";if("Line"===u){for(o+="l ",r=1,i=h.count;r<=i;r++)o+=s+r+" ";o+="\n"}if("LineSegments"===u)for(n=1+(r=1),i=h.count;r<i;n=(r+=2)+1)o+="l "+(s+r)+" "+(s+n)+"\n"}else console.warn("THREE.OBJExporter.parseLine(): geometry type unsupported",l);s+=a}(e)}),o}}},function(e,t){THREE.MTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setTexturePath:function(e){return console.warn("THREE.MTLLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var r=e.split("\n"),n={},i=/\s+/,a={},o=0;o<r.length;o++){var s=r[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),u=l>=0?s.substring(0,l):s;u=u.toLowerCase();var c=l>=0?s.substring(l+1):"";if(c=c.trim(),"newmtl"===u)n={name:c},a[c]=n;else if("ka"===u||"kd"===u||"ks"===u||"ke"===u){var h=c.split(i,3);n[u]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else n[u]=c}}var d=new THREE.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(a),d}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],i={};for(var a in t[r]=i,n){var o=!0,s=n[a],l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(i[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function i(e,r){if(!n[e]){var i,a,o=t.getTextureParams(r,n),s=t.loadTexture((i=t.baseUrl,"string"!=typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:i+a));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,n[e]=s}}for(var a in r){var o,s=r[a];if(""!==s)switch(a.toLowerCase()){case"kd":n.color=(new THREE.Color).fromArray(s);break;case"ks":n.specular=(new THREE.Color).fromArray(s);break;case"ke":n.emissive=(new THREE.Color).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"map_ke":i("emissiveMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"map_d":i("alphaMap",s),n.transparent=!0;break;case"ns":n.shininess=parseFloat(s);break;case"d":(o=parseFloat(s))<1&&(n.opacity=o,n.transparent=!0);break;case"tr":o=parseFloat(s),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(n.opacity=1-o,n.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(n),this.materials[e]},getTextureParams:function(e,t){var r,n={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},i=e.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(e,t,r,n,i){var a,o=THREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),a=o.load(e,r,n,i),void 0!==t&&(a.mapping=t),a}}},function(e,t){THREE.STLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.STLLoader.prototype={constructor:THREE.STLLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){try{t(i.parse(e))}catch(e){n&&n(e)}},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e,t,r){for(var n=0,i=e.length;n<i;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}var r,n=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var r;if(84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(t(n,r,i))return!1;return!0}(n)?function(e){for(var t,r,n,i,a,o,s,l,u=new DataView(e),c=u.getUint32(80,!0),h=!1,d=0;d<70;d++)1129270351==u.getUint32(d,!1)&&82==u.getUint8(d+4)&&61==u.getUint8(d+5)&&(h=!0,i=[],a=u.getUint8(d+6)/255,o=u.getUint8(d+7)/255,s=u.getUint8(d+8)/255,l=u.getUint8(d+9)/255);for(var f=new THREE.BufferGeometry,p=[],m=[],v=0;v<c;v++){var g=84+50*v,y=u.getFloat32(g,!0),_=u.getFloat32(g+4,!0),b=u.getFloat32(g+8,!0);if(h){var E=u.getUint16(g+48,!0);0==(32768&E)?(t=(31&E)/31,r=(E>>5&31)/31,n=(E>>10&31)/31):(t=a,r=o,n=s)}for(var w=1;w<=3;w++){var x=g+12*w;p.push(u.getFloat32(x,!0)),p.push(u.getFloat32(x+4,!0)),p.push(u.getFloat32(x+8,!0)),m.push(y,_,b),h&&i.push(t,r,n)}}return f.addAttribute("position",new THREE.BufferAttribute(new Float32Array(p),3)),f.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(m),3)),h&&(f.addAttribute("color",new THREE.BufferAttribute(new Float32Array(i),3)),f.hasColors=!0,f.alpha=l),f}(n):function(e){for(var t,r=new THREE.BufferGeometry,n=/facet([\s\S]*?)endfacet/g,i=0,a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,o=new RegExp("vertex"+a+a+a,"g"),s=new RegExp("normal"+a+a+a,"g"),l=[],u=[],c=new THREE.Vector3;null!==(t=n.exec(e));){for(var h=0,d=0,f=t[0];null!==(t=s.exec(f));)c.x=parseFloat(t[1]),c.y=parseFloat(t[2]),c.z=parseFloat(t[3]),d++;for(;null!==(t=o.exec(f));)l.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),u.push(c.x,c.y,c.z),h++;1!==d&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+i),3!==h&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+i),i++}return r.addAttribute("position",new THREE.Float32BufferAttribute(l,3)),r.addAttribute("normal",new THREE.Float32BufferAttribute(u,3)),r}("string"!=typeof(r=e)?THREE.LoaderUtils.decodeText(new Uint8Array(r)):r)}}},function(e,t){var r,n;THREE.STLExporter=function(){},THREE.STLExporter.prototype={constructor:THREE.STLExporter,parse:(r=new THREE.Vector3,n=new THREE.Matrix3,function(e,t){void 0===t&&(t={});var i=void 0!==t.binary&&t.binary,a=[],o=0;if(e.traverse(function(e){if(e.isMesh){var t=e.geometry;t.isBufferGeometry&&(t=(new THREE.Geometry).fromBufferGeometry(t)),t.isGeometry&&(o+=t.faces.length,a.push({geometry:t,matrixWorld:e.matrixWorld}))}}),i){var s=80,l=new ArrayBuffer(2*o+3*o*4*4+80+4);(_=new DataView(l)).setUint32(s,o,!0),s+=4;for(var u=0,c=a.length;u<c;u++){var h=(b=a[u]).geometry.vertices,d=b.geometry.faces,f=b.matrixWorld;n.getNormalMatrix(f);for(var p=0,m=d.length;p<m;p++){var v=d[p];r.copy(v.normal).applyMatrix3(n).normalize(),_.setFloat32(s,r.x,!0),s+=4,_.setFloat32(s,r.y,!0),s+=4,_.setFloat32(s,r.z,!0),s+=4;for(var g=[v.a,v.b,v.c],y=0;y<3;y++)r.copy(h[g[y]]).applyMatrix4(f),_.setFloat32(s,r.x,!0),s+=4,_.setFloat32(s,r.y,!0),s+=4,_.setFloat32(s,r.z,!0),s+=4;_.setUint16(s,0,!0),s+=2}}return _}var _="";for(_+="solid exported\n",u=0,c=a.length;u<c;u++){var b;for(h=(b=a[u]).geometry.vertices,d=b.geometry.faces,f=b.matrixWorld,n.getNormalMatrix(f),p=0,m=d.length;p<m;p++){for(v=d[p],r.copy(v.normal).applyMatrix3(n).normalize(),_+="\tfacet normal "+r.x+" "+r.y+" "+r.z+"\n",_+="\t\touter loop\n",g=[v.a,v.b,v.c],y=0;y<3;y++)r.copy(h[g[y]]).applyMatrix4(f),_+="\t\t\tvertex "+r.x+" "+r.y+" "+r.z+"\n";_+="\t\tendloop\n",_+="\tendfacet\n"}}return _+="endsolid exported\n"})}},function(e,t){THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,n=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==n&&(t=n[1],r=n[0].length);var i,a,o,s,l,u,h={comments:[],elements:[],headerLength:r},d=t.split("\n");for(var f=0;f<d.length;f++){var p=d[f];if(""!==(p=p.trim()))switch(a=(o=p.split(/\s+/)).shift(),p=o.join(" "),a){case"format":h.format=o[0],h.version=o[1];break;case"comment":h.comments.push(p);break;case"element":void 0!==i&&h.elements.push(i),(i={}).name=o[0],i.count=parseInt(o[1]),i.properties=[];break;case"property":i.properties.push((s=o,l=c.propertyNameMapping,u=void 0,"list"===(u={type:s[0]}).type?(u.name=s[3],u.countType=s[1],u.itemType=s[2]):u.name=s[1],u.name in l&&(u.name=l[u.name]),u));break;default:console.log("unhandled",a,o)}}return void 0!==i&&h.elements.push(i),h}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function n(e,t){for(var n=t.split(/\s+/),i={},a=0;a<e.length;a++)if("list"===e[a].type){for(var o=[],s=r(n.shift(),e[a].countType),l=0;l<s;l++)o.push(r(n.shift(),e[a].itemType));i[e[a].name]=o}else i[e[a].name]=r(n.shift(),e[a].type);return i}function i(e,t){var r,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},s="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(s=r[1]);for(var l=s.split("\n"),u=0,c=0,h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim())){c>=t.elements[u].count&&(u++,c=0);var f=n(t.elements[u].properties,d);o(i,t.elements[u].name,f),c++}}return a(i)}function a(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).addAttribute("uv",new THREE.Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var n=r.vertex_indices||r.vertex_index,i=r.texcoord;3===n.length?(e.indices.push(n[0],n[1],n[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===n.length&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]))}}function s(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function l(e,t,r,n){for(var i,a={},o=0,l=0;l<r.length;l++)if("list"===r[l].type){var u=[],c=(i=s(e,t+o,r[l].countType,n))[0];o+=i[1];for(var h=0;h<c;h++)i=s(e,t+o,r[l].itemType,n),u.push(i[0]),o+=i[1];a[r[l].name]=u}else i=s(e,t+o,r[l].type,n),a[r[l].name]=i[0],o+=i[1];return[a,o]}var u,c=this;if(e instanceof ArrayBuffer){var h=THREE.LoaderUtils.decodeText(new Uint8Array(e)),d=t(h);u="ascii"===d.format?i(h,d):function(e,t){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,s=new DataView(e,t.headerLength),u=0,c=0;c<t.elements.length;c++)for(var h=0;h<t.elements[c].count;h++){u+=(r=l(s,u,t.elements[c].properties,i))[1];var d=r[0];o(n,t.elements[c].name,d)}return a(n)}(e,d)}else u=i(e,t(e));return u}}},function(e,t){THREE.PLYExporter=function(){},THREE.PLYExporter.prototype={constructor:THREE.PLYExporter,parse:function(e,t,r){function n(t){e.traverse(function(e){if(!0===e.isMesh){var r=e,n=r.geometry;!0===n.isGeometry&&(n=a.get(n)),!0===n.isBufferGeometry&&void 0!==n.getAttribute("position")&&t(r,n)}})}t&&"object"==typeof t&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=t,t=void 0);var i=(r=Object.assign({binary:!1,excludeAttributes:[]},r)).excludeAttributes,a=new WeakMap,o=!1,s=!1,l=!1,u=0,c=0;e.traverse(function(e){if(!0===e.isMesh){var t=e,r=t.geometry;if(!0===r.isGeometry){var n=a.get(r)||(new THREE.BufferGeometry).setFromObject(t);a.set(r,n),r=n}if(!0===r.isBufferGeometry){var i=r.getAttribute("position"),h=r.getAttribute("normal"),d=r.getAttribute("uv"),f=r.getAttribute("color"),p=r.getIndex();if(void 0===i)return;u+=i.count,c+=p?p.count/3:i.count/3,void 0!==h&&(o=!0),void 0!==d&&(l=!0),void 0!==f&&(s=!0)}}});var h=-1===i.indexOf("index");if(o=o&&-1===i.indexOf("normal"),s=s&&-1===i.indexOf("color"),l=l&&-1===i.indexOf("uv"),h&&c!==Math.floor(c))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var d=1;u>256&&(d=2),u>65536&&(d=4);var f="ply\n"+`format ${r.binary?"binary_big_endian":"ascii"} 1.0\n`+`element vertex ${u}\n`+"property float x\nproperty float y\nproperty float z\n";!0===o&&(f+="property float nx\nproperty float ny\nproperty float nz\n"),!0===l&&(f+="property float s\nproperty float t\n"),!0===s&&(f+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===h&&(f+=`element face ${c}\n`+`property list uchar uint${8*d} vertex_index\n`),f+="end_header\n";var p=new THREE.Vector3,m=new THREE.Matrix3,v=null;if(!0===r.binary){var g=(new TextEncoder).encode(f),y=u*(12+(o?12:0)+(s?3:0)+(l?8:0)),_=h?c*(3*d+1):0,b=new DataView(new ArrayBuffer(g.length+y+_));new Uint8Array(b.buffer).set(g,0);var E=g.length,w=g.length+y,x=0;n(function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),u=t.getIndex();m.getNormalMatrix(e.matrixWorld);for(var c=0,f=r.count;c<f;c++)p.x=r.getX(c),p.y=r.getY(c),p.z=r.getZ(c),p.applyMatrix4(e.matrixWorld),b.setFloat32(E,p.x),E+=4,b.setFloat32(E,p.y),E+=4,b.setFloat32(E,p.z),E+=4,!0===o&&(null!=n?(p.x=n.getX(c),p.y=n.getY(c),p.z=n.getZ(c),p.applyMatrix3(m),b.setFloat32(E,p.x),E+=4,b.setFloat32(E,p.y),E+=4,b.setFloat32(E,p.z),E+=4):(b.setFloat32(E,0),E+=4,b.setFloat32(E,0),E+=4,b.setFloat32(E,0),E+=4)),!0===l&&(null!=i?(b.setFloat32(E,i.getX(c)),E+=4,b.setFloat32(E,i.getY(c)),E+=4):!1!==l&&(b.setFloat32(E,0),E+=4,b.setFloat32(E,0),E+=4)),!0===s&&(null!=a?(b.setUint8(E,Math.floor(255*a.getX(c))),E+=1,b.setUint8(E,Math.floor(255*a.getY(c))),E+=1,b.setUint8(E,Math.floor(255*a.getZ(c))),E+=1):(b.setUint8(E,255),E+=1,b.setUint8(E,255),E+=1,b.setUint8(E,255),E+=1));if(!0===h){var v=`setUint${8*d}`;if(null!==u)for(c=0,f=u.count;c<f;c+=3)b.setUint8(w,3),w+=1,b[v](w,u.getX(c+0)+x),w+=d,b[v](w,u.getX(c+1)+x),w+=d,b[v](w,u.getX(c+2)+x),w+=d;else for(c=0,f=r.count;c<f;c+=3)b.setUint8(w,3),w+=1,b[v](w,x+c),w+=d,b[v](w,x+c+1),w+=d,b[v](w,x+c+2),w+=d}x+=r.count}),v=b.buffer}else{x=0;var T="",S="";n(function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),u=t.getIndex();m.getNormalMatrix(e.matrixWorld);for(var d=0,f=r.count;d<f;d++){p.x=r.getX(d),p.y=r.getY(d),p.z=r.getZ(d),p.applyMatrix4(e.matrixWorld);var v=p.x+" "+p.y+" "+p.z;!0===o&&(null!=n?(p.x=n.getX(d),p.y=n.getY(d),p.z=n.getZ(d),p.applyMatrix3(m),v+=" "+p.x+" "+p.y+" "+p.z):v+=" 0 0 0"),!0===l&&(null!=i?v+=" "+i.getX(d)+" "+i.getY(d):!1!==l&&(v+=" 0 0")),!0===s&&(v+=null!=a?" "+Math.floor(255*a.getX(d))+" "+Math.floor(255*a.getY(d))+" "+Math.floor(255*a.getZ(d)):" 255 255 255"),T+=v+"\n"}if(!0===h){if(null!==u)for(d=0,f=u.count;d<f;d+=3)S+=`3 ${u.getX(d+0)+x}`,S+=` ${u.getX(d+1)+x}`,S+=` ${u.getX(d+2)+x}\n`;else for(d=0,f=r.count;d<f;d+=3)S+=`3 ${x+d} ${x+d+1} ${x+d+2}\n`;c+=u?u.count/3:r.count/3}x+=r.count}),v=`${f}${T}\n${h?`${S}\n`:""}`}return"function"==typeof t&&requestAnimationFrame(()=>t(v)),v}}},function(e,t){THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,a=n.length;i<a;i++){var o=n[i];o.nodeName===t&&r.push(o)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function o(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function c(e,t,n,i){var a=r(e,t)[0];if(void 0!==a)for(var o=r(a,n),s=0;s<o.length;s++)i(o[s])}function h(e,t){for(var r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function f(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=o(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=a}}return t}function p(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),a=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)r=i.split("."),i=r.shift(),t.member=r.shift();else if(a){var l=i.split("(");i=l.shift();for(var u=0;u<l.length;u++)l[u]=parseInt(l[u].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=i,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}function m(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=n[o.sampler],l=s.inputs.INPUT,u=s.inputs.OUTPUT;E(g(o,i[l],i[u]),t)}return t}function v(e){return d(Je.animations[e],m)}function g(e,t,r){var n,i,a,o,s,l,u=Je.nodes[e.id],c=He(u.id),h=u.transforms[e.sid],d=u.matrix.clone().transpose(),f={};switch(h){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(n=t.array[a],i=a*r.stride,void 0===f[n]&&(f[n]={}),!0===e.arraySyntax){var p=r.array[i],m=e.indices[0]+4*e.indices[1];f[n][m]=p}else for(s=0,l=r.stride;s<l;s++)f[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var v=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort(function(e,t){return e.time-t.time});for(var i=0;i<16;i++)w(r,i,t.elements[i]);return r}(f,d);return{name:c.uuid,keyframes:v}}var y=new THREE.Vector3,_=new THREE.Vector3,b=new THREE.Quaternion;function E(e,t){for(var r=e.keyframes,n=e.name,i=[],a=[],o=[],s=[],l=0,u=r.length;l<u;l++){var c=r[l],h=c.time,d=c.value;Te.fromArray(d).transpose(),Te.decompose(y,b,_),i.push(h),a.push(y.x,y.y,y.z),o.push(b.x,b.y,b.z,b.w),s.push(_.x,_.y,_.z)}return a.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",i,a)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",i,o)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",i,s)),t}function w(e,t,r){var n,i,a,o=!0;for(i=0,a=e.length;i<a;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,a=e.length;i<a;i++){var o=e[i];if(null===o.value[t]){if(r=x(e,i,t),n=T(e,i,t),null===r){o.value[t]=n.value[t];continue}if(null===n){o.value[t]=r.value[t];continue}S(o,r,n,t)}}}(e,t)}function x(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function T(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function S(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function M(e){for(var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations,a=0,o=i.length;a<o;a++)for(var s=v(i[a]),l=0,u=s.length;l<u;l++)t.push(s[l]);return new THREE.AnimationClip(r,n,t)}function R(e){return d(Je.clips[e],M)}function A(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(a.textContent);break;case"source":var o=a.getAttribute("id");t.sources[o]=ie(a);break;case"joints":t.joints=k(a);break;case"vertex_weights":t.vertexWeights=P(a)}}return t}function k(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),s=o(i.getAttribute("source"));t.inputs[a]=s}}return t}function P(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=o(i.getAttribute("source")),u=parseInt(i.getAttribute("offset"));t.inputs[s]={id:l,offset:u};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function C(e){var t={id:e.id},r=Je.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=e.sources,o=e.vertexWeights,s=o.vcount,l=o.v,u=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=a[o.inputs.WEIGHT.id].array,p=0;for(t=0,n=s.length;t<n;t++){var m=s[t],v=[];for(r=0;r<m;r++){var g=l[p+u],y=l[p+c],_=f[y];v.push({index:g,weight:_}),p+=2}for(v.sort(x),r=0;r<4;r++){var b=v[r];void 0!==b?(i.indices.array.push(b.index),i.weights.array.push(b.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}e.bindShapeMatrix?i.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():i.bindMatrix=(new THREE.Matrix4).identity();for(t=0,n=h.array.length;t<n;t++){var E=h.array[t],w=(new THREE.Matrix4).fromArray(d.array,t*d.stride).transpose();i.joints.push({name:E,boneInverse:w})}return i;function x(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function L(e){return void 0!==e.build?e.build:e.init_from}function I(e){var t=Je.images[e];return void 0!==t?d(t,L):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function O(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":H(i,t);break;case"technique":t.technique=F(i);break;case"extra":t.extra=G(i)}}return t}function H(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=D(a);break;case"sampler2D":t.samplers[r]=N(a)}}}function D(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function N(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function F(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=U(i)}}return t}function U(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=B(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:B(i)}}}return t}function B(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":t[a.nodeName]=i(a.textContent);break;case"float":t[a.nodeName]=parseFloat(a.textContent);break;case"texture":t[a.nodeName]={id:a.getAttribute("texture"),extra:z(a)}}}return t}function z(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":j(i,t)}}return t}function j(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":V(i,t)}}}function V(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function G(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=W(i)}}return t}function W(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function X(e){return e}function Y(e){var t,r,n=(t=e.url,d(Je.effects[t],X)),i=n.profile.technique,a=n.profile.extra;switch(i.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}function o(e){var t=n.profile.samplers[e.id],r=null;void 0!==t?r=I(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=I(e.id));if(null!==r){var i=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=Ge;break;default:t=Xe}return t}(r);if(void 0!==i){var a=i.load(r),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var l=o.technique;a.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.offset.set(l.offsetU||0,l.offsetV||0),a.repeat.set(l.repeatU||1,l.repeatV||1)}else a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping;return a}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name||"";var l=i.parameters;for(var u in l){var c=l[u];switch(u){case"diffuse":c.color&&r.color.fromArray(c.color),c.texture&&(r.map=o(c.texture));break;case"specular":c.color&&r.specular&&r.specular.fromArray(c.color),c.texture&&(r.specularMap=o(c.texture));break;case"bump":c.texture&&(r.normalMap=o(c.texture));break;case"ambient":c.texture&&(r.lightMap=o(c.texture));break;case"shininess":c.float&&r.shininess&&(r.shininess=c.float);break;case"emission":c.color&&r.emissive&&r.emissive.fromArray(c.color),c.texture&&(r.emissiveMap=o(c.texture))}}var h=l.transparent,f=l.transparency;if(void 0===f&&h&&(f={float:1}),void 0===h&&f&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&f)if(h.data.texture)r.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=p[3]*f.float;break;case"RGB_ZERO":r.opacity=1-p[0]*f.float;break;case"A_ZERO":r.opacity=1-p[3]*f.float;break;case"RGB_ONE":r.opacity=p[0]*f.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(r.side=THREE.DoubleSide),r}function q(e){return d(Je.materials[e],Y)}function Z(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return J(r)}}return{}}function J(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=K(n)}}return t}function K(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function Q(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,n*=.5,r*=.5,t=new THREE.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name||"",t}function $(e){var t=Je.cameras[e];return void 0!==t?d(t,Q):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=te(i)}}return t}function te(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":var o=i(a.textContent);t.color=(new THREE.Color).fromArray(o);break;case"falloff_angle":t.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=Je.lights[e];return void 0!==t?d(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=n(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ae(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=o(n.getAttribute("source")))}return t}function oe(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=o(i.getAttribute("source")),l=i.getAttribute("semantic"),u=parseInt(i.getAttribute("offset")),c=parseInt(i.getAttribute("set")),h=c>0?l+c:l;t.inputs[h]={id:s,offset:u},t.stride=Math.max(t.stride,u+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var a=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var o in a){var s=a[o];se(s),t[o]=ue(s,r,n)}return t}function ue(e,t,r){for(var n={},i={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},u=[],c=4,h=[],d=4,f=new THREE.BufferGeometry,p=[],m=0,v=0;v<e.length;v++){var g=e[v],y=g.inputs,_=0;switch(g.type){case"lines":case"linestrips":_=2*g.count;break;case"triangles":_=3*g.count;break;case"polylist":for(var b=0;b<g.count;b++){var E=g.vcount[b];switch(E){case 3:_+=3;break;case 4:_+=6;break;default:_+=3*(E-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var w in f.addGroup(m,_,v),m+=_,g.material&&p.push(g.material),y){var x=y[w];switch(w){case"VERTEX":for(var T in r){var S=r[T];switch(T){case"POSITION":var M=i.array.length;if(ce(g,t[S],x.offset,i.array),i.stride=t[S].stride,t.skinWeights&&t.skinIndices&&(ce(g,t.skinIndices,x.offset,u),ce(g,t.skinWeights,x.offset,h)),!1===g.hasUV&&!0===e.uvsNeedsFix){_=(i.array.length-M)/i.stride;for(var R=0;R<_;R++)o.array.push(0,0)}break;case"NORMAL":ce(g,t[S],x.offset,a.array),a.stride=t[S].stride;break;case"COLOR":ce(g,t[S],x.offset,l.array),l.stride=t[S].stride;break;case"TEXCOORD":ce(g,t[S],x.offset,o.array),o.stride=t[S].stride;break;case"TEXCOORD1":ce(g,t[S],x.offset,s.array),o.stride=t[S].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',T)}}break;case"NORMAL":ce(g,t[x.id],x.offset,a.array),a.stride=t[x.id].stride;break;case"COLOR":ce(g,t[x.id],x.offset,l.array),l.stride=t[x.id].stride;break;case"TEXCOORD":ce(g,t[x.id],x.offset,o.array),o.stride=t[x.id].stride;break;case"TEXCOORD1":ce(g,t[x.id],x.offset,s.array),s.stride=t[x.id].stride}}}return i.array.length>0&&f.addAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),a.array.length>0&&f.addAttribute("normal",new THREE.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&f.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),o.array.length>0&&f.addAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&f.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),u.length>0&&f.addAttribute("skinIndex",new THREE.Float32BufferAttribute(u,c)),h.length>0&&f.addAttribute("skinWeight",new THREE.Float32BufferAttribute(h,d)),n.data=f,n.type=e[0].type,n.materialKeys=p,n}function ce(e,t,r,n){var i=e.p,a=e.stride,o=e.vcount;function s(e){for(var t=i[e+r]*u,a=t+u;t<a;t++)n.push(l[t])}var l=t.array,u=t.stride;if(void 0!==e.vcount)for(var c=0,h=0,d=o.length;h<d;h++){var f=o[h];if(4===f){var p=c+1*a,m=c+2*a,v=c+3*a;s(c+0*a),s(p),s(v),s(p),s(m),s(v)}else if(3===f){p=c+1*a,m=c+2*a;s(c+0*a),s(p),s(m)}else if(f>4)for(var g=1,y=f-2;g<=y;g++){p=c+a*g,m=c+a*(g+1);s(c+0*a),s(p),s(m)}c+=a*f}else for(h=0,d=i.length;h<d;h+=a)s(h)}function he(e){return d(Je.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function fe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=pe(n);break;case"link":t.links.push(ve(n))}}}function pe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var a=i(n.textContent);t.axis.fromArray(a);break;case"limits":var o=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ge(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.Math.degToRad(r[3])}return t}function _e(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":be(n,t)}}}function be(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=i(n.textContent);break;case"mass":t.mass=i(n.textContent)[0]}}}function Ee(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substr(0,a.length-1)}}return t}function we(e){return void 0!==e.build?e.build:e}function xe(e){for(var t=[],r=Ue.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var a=r.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"matrix":var o=i(a.textContent),s=(new THREE.Matrix4).fromArray(o).transpose();t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"translate":case"scale":o=i(a.textContent);var l=(new THREE.Vector3).fromArray(o);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"rotate":o=i(a.textContent),l=(new THREE.Vector3).fromArray(o);var u=THREE.Math.degToRad(o[3]);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l,angle:u})}}return t}var Te=new THREE.Matrix4,Se=new THREE.Vector3;function Me(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Me(n);break;case"instance_camera":t.instanceCameras.push(o(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Re(n));break;case"instance_light":t.instanceLights.push(o(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Re(n));break;case"instance_node":t.instanceNodes.push(o(n.getAttribute("url")));break;case"matrix":var a=i(n.textContent);t.matrix.multiply(Te.fromArray(a).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":a=i(n.textContent);Se.fromArray(a),t.matrix.multiply(Te.makeTranslation(Se.x,Se.y,Se.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":a=i(n.textContent);var s=THREE.Math.degToRad(a[3]);t.matrix.multiply(Te.makeRotationAxis(Se.fromArray(a),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":a=i(n.textContent);t.matrix.scale(Se.fromArray(a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Oe(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Je.nodes[t.id]=t,t}function Re(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),a=0;a<i.length;a++){var s=i[a],l=s.getAttribute("symbol"),u=s.getAttribute("target");t.materials[l]=o(u)}break;case"skeleton":t.skeletons.push(o(n.textContent))}}return t}function Ae(e,t){var r,n,i,a=[],o=[];for(r=0;r<e.length;r++){var s=e[r];if(Oe(s))ke(He(s),t,a);else if(i=s,void 0!==Je.visualScenes[i])for(var l=Je.visualScenes[s].children,u=0;u<l.length;u++){var c=l[u];if("JOINT"===c.type)ke(He(c.id),t,a)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(u=0;u<a.length;u++)if((n=a[u]).bone.name===t[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<a.length;r++)!1===(n=a[r]).processed&&(o.push(n),n.processed=!0);var h=[],d=[];for(r=0;r<o.length;r++)n=o[r],h.push(n.bone),d.push(n.boneInverse);return new THREE.Skeleton(h,d)}function ke(e,t,r){e.traverse(function(e){if(!0===e.isBone){for(var n,i=0;i<t.length;i++){var a=t[i];if(a.name===e.name){n=a.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}})}function Pe(e){for(var t,r=[],n=e.matrix,i=e.nodes,a=e.type,o=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,u=e.instanceGeometries,c=e.instanceNodes,h=0,f=i.length;h<f;h++)r.push(He(i[h]));for(h=0,f=o.length;h<f;h++){var p=$(o[h]);null!==p&&r.push(p.clone())}for(h=0,f=s.length;h<f;h++)for(var m=s[h],v=(t=m.id,d(Je.controllers[t],C)),g=Ie(he(v.id),m.materials),y=Ae(m.skeletons,v.skin.joints),_=0,b=g.length;_<b;_++){var E;(E=g[_]).isSkinnedMesh&&(E.bind(y,v.skin.bindMatrix),E.normalizeSkinWeights()),r.push(E)}for(h=0,f=l.length;h<f;h++){var w=ne(l[h]);null!==w&&r.push(w.clone())}for(h=0,f=u.length;h<f;h++)for(_=0,b=(g=Ie(he((m=u[h]).id),m.materials)).length;_<b;_++)r.push(g[_]);for(h=0,f=c.length;h<f;h++)r.push(He(c[h]).clone());if(0===i.length&&1===r.length)E=r[0];else{E="JOINT"===a?new THREE.Bone:new THREE.Group;for(h=0;h<r.length;h++)E.add(r[h])}return""===E.name&&(E.name="JOINT"===a?e.sid:e.name),E.matrix.copy(n),E.matrix.decompose(E.position,E.quaternion,E.scale),E}var Ce=new THREE.MeshBasicMaterial({color:16711935});function Le(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Ce)):r.push(q(a))}return r}function Ie(e,t){var r=[];for(var n in e){var i=e[n],a=Le(i.materialKeys,t);0===a.length&&("lines"===n||"linestrips"===n?a.push(new THREE.LineBasicMaterial):a.push(new THREE.MeshPhongMaterial));var o=void 0!==i.data.attributes.skinIndex;if(o)for(var s=0,l=a.length;s<l;s++)a[s].skinning=!0;var u,c=1===a.length?a[0]:a;switch(n){case"lines":u=new THREE.LineSegments(i.data,c);break;case"linestrips":u=new THREE.Line(i.data,c);break;case"triangles":case"polylist":u=o?new THREE.SkinnedMesh(i.data,c):new THREE.Mesh(i.data,c)}r.push(u)}return r}function Oe(e){return void 0!==Je.nodes[e]}function He(e){return d(Je.nodes[e],Pe)}function De(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var i=r[n];t.add(He(i.id))}return t}function Ne(e){return d(Je.visualScenes[e],De)}if(0===e.length)return{scene:new THREE.Scene};var Fe=(new DOMParser).parseFromString(e,"application/xml"),Ue=r(Fe,"COLLADA")[0],Be=Fe.getElementsByTagName("parsererror")[0];if(void 0!==Be){var ze,je=r(Be,"div")[0];return ze=je?je.textContent:function(e){for(var t="",r=[e];r.length;){var n=r.shift();n.nodeType===Node.TEXT_NODE?t+=n.textContent:(t+="\n",r.push.apply(r,n.childNodes))}return t.trim()}(Be),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",ze),null}var Ve=Ue.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ve);var Ge,We=function(e){return{unit:l(r(e,"unit")[0]),upAxis:u(r(e,"up_axis")[0])}}(r(Ue,"asset")[0]),Xe=new THREE.TextureLoader(this.manager);Xe.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Ge=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ye=[],qe={},Ze=0,Je={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(Ue,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var i,a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"source":i=a.getAttribute("id"),t.sources[i]=ie(a);break;case"sampler":i=a.getAttribute("id"),t.samplers[i]=f(a);break;case"channel":i=a.getAttribute("target"),t.channels[i]=p(a);break;default:console.log(a)}}Je.animations[e.getAttribute("id")]=t}),c(Ue,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(o(i.getAttribute("url")))}}Je.clips[e.getAttribute("id")]=t}),c(Ue,"library_controllers","controller",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=o(i.getAttribute("source")),t.skin=A(i);break;case"morph":t.id=o(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Je.controllers[e.getAttribute("id")]=t}),c(Ue,"library_images","image",function(e){var t={init_from:r(e,"init_from")[0].textContent};Je.images[e.getAttribute("id")]=t}),c(Ue,"library_effects","effect",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=O(i)}}Je.effects[e.getAttribute("id")]=t}),c(Ue,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=o(i.getAttribute("url"))}}Je.materials[e.getAttribute("id")]=t}),c(Ue,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=Z(i)}}Je.cameras[e.getAttribute("id")]=t}),c(Ue,"library_lights","light",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=ee(i)}}Je.lights[e.getAttribute("id")]=t}),c(Ue,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=ie(a);break;case"vertices":t.vertices=ae(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(a));break;default:console.log(a)}}}Je.geometries[e.getAttribute("id")]=t}}),c(Ue,"library_nodes","node",Me),c(Ue,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Ze++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(Me(n[i]));Je.visualScenes[e.getAttribute("id")]=t}),c(Ue,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":fe(n,t)}}Je.kinematicsModels[e.getAttribute("id")]=t}),c(Ue,"library_physics_models","physics_model",function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},_e(n,t.rigidBodies[n.getAttribute("name")])}}Je.physicsModels[e.getAttribute("id")]=t}),c(Ue,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ee(n))}}Je.kinematicsScenes[o(e.getAttribute("url"))]=t}),h(Je.animations,m),h(Je.clips,M),h(Je.controllers,C),h(Je.images,L),h(Je.effects,X),h(Je.materials,Y),h(Je.cameras,Q),h(Je.lights,re),h(Je.geometries,le),h(Je.visualScenes,De),function(){var e=Je.clips;if(!0===s(e)){if(!1===s(Je.animations)){var t=[];for(var r in Je.animations)for(var n=v(r),i=0,a=n.length;i<a;i++)t.push(n[i]);Ye.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)Ye.push(R(r))}(),function(){var e=Object.keys(Je.kinematicsModels)[0],t=Object.keys(Je.kinematicsScenes)[0],r=Object.keys(Je.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,i=(n=e,d(Je.kinematicsModels[n],de)),a=function(e){return d(Je.kinematicsScenes[e],we)}(t),o=Ne(r),s=a.bindJointAxis,l={},u=0,c=s.length;u<c;u++){var h=s[u],f=Ue.querySelector('[sid="'+h.target+'"]');if(f){var p=f.parentElement;v(h.jointIndex,p)}}var m=new THREE.Matrix4;qe={joints:i&&i.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=r.object,a=n.axis,o=r.transforms;Te.identity();for(var s=0;s<o.length;s++){var u=o[s];if(u.sid&&-1!==u.sid.indexOf(e))switch(n.type){case"revolute":Te.multiply(m.makeRotationAxis(a,THREE.Math.degToRad(t)));break;case"prismatic":Te.multiply(m.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(u.type){case"matrix":Te.multiply(u.obj);break;case"translate":Te.multiply(m.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":Te.scale(u.obj);break;case"rotate":Te.multiply(m.makeRotationAxis(u.obj,u.angle))}}i.matrix.copy(Te),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var r=t.getAttribute("name"),n=i.joints[e];o.traverse(function(i){i.name===r&&(l[e]={object:i,transforms:xe(t),joint:n,position:n.zeroPosition})})}}();var Ke=function(e){return Ne(o(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Ue,"scene")[0]);return"Z_UP"===We.upAxis&&Ke.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ke.scale.multiplyScalar(We.unit),{animations:Ye,kinematics:qe,library:Je,scene:Ke}}}},function(e,t){THREE.ColladaExporter=function(){},THREE.ColladaExporter.prototype={constructor:THREE.ColladaExporter,parse:function(e,t,r){r=r||{},""!==(r=Object.assign({version:"1.4.1",author:null,textureDirectory:""},r)).textureDirectory&&(r.textureDirectory=`${r.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/"));var n,i,a=r.version;if("1.4.1"!==a&&"1.5.0"!==a)return console.warn(`ColladaExporter : Version ${a} not supported for export. Only 1.4.1 and 1.5.0.`),null;function o(e,t){return n=n||document.createElement("canvas"),i=i||n.getContext("2d"),n.width=e.naturalWidth,n.height=e.naturalHeight,i.drawImage(e,0,0),function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0,i=r.length;n<i;n++)r[n]=t.charCodeAt(n);return r}(n.toDataURL(`image/${t}`,1).replace(/^data:image\/(png|jpg);base64,/,""))}var s,l=["getX","getY","getZ","getW"];function u(e){if(e.isInterleavedBufferAttribute){for(var t=new e.array.constructor(e.count*e.itemSize),r=e.itemSize,n=0,i=e.count;n<i;n++)for(var a=0;a<r;a++)t[n*r+a]=e[l[a]](n);return t}return e.array}function c(e,t,r,n){var i=u(e);return`<source id="${t}">`+`<float_array id="${t}-array" count="${i.length}">`+i.join(" ")+"</float_array><technique_common>"+`<accessor source="#${t}-array" count="${Math.floor(i.length/e.itemSize)}" stride="${e.itemSize}">`+r.map(e=>`<param name="${e}" type="${n}" />`).join("")+"</accessor></technique_common></source>"}function h(e){var t=p.get(e);if(null==t){t=`image-${v.length+1}`;var n=e.name||t,i=`<image id="${t}" name="${n}">`;i+="1.5.0"===a?`<init_from><ref>${r.textureDirectory}${n}.png</ref></init_from>`:`<init_from>${r.textureDirectory}${n}.png</init_from>`,i+="</image>",v.push(i),p.set(e,t),m.push({directory:r.textureDirectory,name:n,ext:"png",data:o(e.image,"png"),original:e})}return t}var d=new WeakMap,f=new WeakMap,p=new WeakMap,m=[],v=[],g=[],y=[],_=[],b=function e(t){var r=`<node name="${t.name}">`;if(r+=function(e){return e.updateMatrix(),(s=s||new THREE.Matrix4).copy(e.matrix),s.transpose(),`<matrix>${s.toArray().join(" ")}</matrix>`}(t),t instanceof THREE.Mesh&&null!=t.geometry){var n=function(e){var t,r,n,i=d.get(e);if(!i){var a=e;a instanceof THREE.Geometry&&(a=(new THREE.BufferGeometry).fromGeometry(a));var o=`Mesh${g.length+1}`,s=a.index?a.index.count*a.index.itemSize:a.attributes.position.count,l=null!=a.groups&&0!==a.groups.length?a.groups:[{start:0,count:s,materialIndex:0}],h=`<geometry id="${o}" name="${e.name}"><mesh>`,f=`${o}-position`,p=`${o}-vertices`;h+=c(a.attributes.position,f,["X","Y","Z"],"float"),h+=`<vertices id="${p}"><input semantic="POSITION" source="#${f}" /></vertices>`;var m=`<input semantic="VERTEX" source="#${p}" offset="0" />`;if("normal"in a.attributes){var v=`${o}-normal`;h+=c(a.attributes.normal,v,["X","Y","Z"],"float"),m+=`<input semantic="NORMAL" source="#${v}" offset="0" />`}if("uv"in a.attributes){var y=`${o}-texcoord`;h+=c(a.attributes.uv,y,["S","T"],"float"),m+=`<input semantic="TEXCOORD" source="#${y}" offset="0" set="0" />`}if("color"in a.attributes){var _=`${o}-color`;h+=c(a.attributes.color,_,["X","Y","Z"],"uint8"),m+=`<input semantic="COLOR" source="#${_}" offset="0" />`}var b=null;if(a.index)b=u(a.index);else for(var E=0,w=(b=new Array(s)).length;E<w;E++)b[E]=E;for(E=0,w=l.length;E<w;E++){var x=l[E],T=(t=b,r=x.start,n=x.count,Array.isArray(t)?t.slice(r,r+n):new t.constructor(t.buffer,r*t.BYTES_PER_ELEMENT,n)),S=T.length/3;h+=`<triangles material="MESH_MATERIAL_${x.materialIndex}" count="${S}">`,h+=m,h+=`<p>${T.join(" ")}</p>`,h+="</triangles>"}h+="</mesh></geometry>",g.push(h),i={meshid:o,bufferGeometry:a},d.set(e,i)}return i}(t.geometry),i=n.meshid,a=n.bufferGeometry,o=null,l=t.material||new THREE.MeshBasicMaterial,p=Array.isArray(l)?l:[l];o=(a.groups.length>p.length?new Array(a.groups.length):new Array(p.length)).fill().map((e,t)=>(function(e){var t=f.get(e);if(null==t){t=`Mat${y.length+1}`;var r="phong";e instanceof THREE.MeshLambertMaterial?r="lambert":e instanceof THREE.MeshBasicMaterial&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));var n=e.emissive?e.emissive:new THREE.Color(0,0,0),i=e.color?e.color:new THREE.Color(0,0,0),a=e.specular?e.specular:new THREE.Color(1,1,1),o=e.shininess||0,s=e.reflectivity||0,l="";!0===e.transparent&&(l+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(l+=`<transparency><float>${e.opacity}</float></transparency>`));var u=`<technique sid="common"><${r}>`+"<emission>"+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${n.r} ${n.g} ${n.b} 1</color>`)+"</emission>"+("constant"!==r?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${i.r} ${i.g} ${i.b} 1</color>`)+"</diffuse>":"")+("phong"===r?`<specular><color sid="specular">${a.r} ${a.g} ${a.b} 1</color></specular>`+"<shininess>"+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${o}</float>`)+"</shininess>":"")+`<reflective><color>${i.r} ${i.g} ${i.b} 1</color></reflective>`+`<reflectivity><float>${s}</float></reflectivity>`+l+`</${r}></technique>`,c=`<effect id="${t}-effect">`+"<profile_COMMON>"+(e.map?'<newparam sid="diffuse-surface"><surface type="2D">'+`<init_from>${h(e.map)}</init_from>`+'</surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>':"")+(e.specularMap?'<newparam sid="specular-surface"><surface type="2D">'+`<init_from>${h(e.specularMap)}</init_from>`+'</surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>':"")+(e.emissiveMap?'<newparam sid="emissive-surface"><surface type="2D">'+`<init_from>${h(e.emissiveMap)}</init_from>`+'</surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>':"")+u+(e.side===THREE.DoubleSide?'<extra><technique><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>";_.push(`<material id="${t}" name="${e.name}"><instance_effect url="#${t}-effect" /></material>`),y.push(c),f.set(e,t)}return t})(p[t%p.length])),r+=`<instance_geometry url="#${i}">`+(null!=o?"<bind_material><technique_common>"+o.map((e,t)=>`<instance_material symbol="MESH_MATERIAL_${t}" target="#${e}" >`+'<bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>').join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach(t=>r+=e(t)),r+="</node>"}(e),E='<?xml version="1.0" encoding="UTF-8" standalone="no" ?>'+`<COLLADA xmlns="${"1.4.1"===a?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${a}">`+"<asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>"+(null!==r.author?`<author>${r.author}</author>`:"")+"</contributor>"+`<created>${(new Date).toISOString()}</created>`+`<modified>${(new Date).toISOString()}</modified>`+"<up_axis>Y_UP</up_axis></asset>";E+=`<library_images>${v.join("")}</library_images>`,E+=`<library_effects>${y.join("")}</library_effects>`,E+=`<library_materials>${_.join("")}</library_materials>`,E+=`<library_geometries>${g.join("")}</library_geometries>`,E+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${b}</visual_scene></library_visual_scenes>`,E+='<scene><instance_visual_scene url="#Scene"/></scene>';var w,x,T,S,M,R,A={data:(w=E+="</COLLADA>",x=/^<\//,T=/(\?>$)|(\/>$)/,S=/<[^>]+>[^<]*<\/[^<]+>/,M=(e,t)=>t>0?e+M(e,t-1):"",R=0,w.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map(e=>{S.test(e)||T.test(e)||!x.test(e)||R--;var t=`${M("  ",R)}${e}`;return S.test(e)||T.test(e)||x.test(e)||R++,t}).join("\n")),textures:m};return"function"==typeof t&&requestAnimationFrame(()=>t(A)),A}}},function(e,t){THREE.GCodeLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.splitLayer=!1},THREE.GCodeLoader.prototype={constructor:THREE.GCodeLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){var t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},r=[],n=void 0,i=new THREE.LineBasicMaterial({color:16711680});i.name="path";var a=new THREE.LineBasicMaterial({color:65280});function o(e){n={vertex:[],pathVertex:[],z:e.z},r.push(n)}function s(e,r){return t.relative?r:r-e}function l(e,r){return t.relative?e+r:r}a.name="extruded";for(var u,c,h=e.replace(/;.+/g,"").split("\n"),d=0;d<h.length;d++){var f=h[d].split(" "),p=f[0].toUpperCase(),m={};if(f.splice(1).forEach(function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),r=parseFloat(e.substring(1));m[t]=r}}),"G0"===p||"G1"===p){var v={x:void 0!==m.x?l(t.x,m.x):t.x,y:void 0!==m.y?l(t.y,m.y):t.y,z:void 0!==m.z?l(t.z,m.z):t.z,e:void 0!==m.e?l(t.e,m.e):t.e,f:void 0!==m.f?l(t.f,m.f):t.f};s(t.e,v.e)>0&&(v.extruding=s(t.e,v.e)>0,null!=n&&v.z==n.z||o(v)),u=t,c=v,void 0===n&&o(u),v.extruding?(n.vertex.push(u.x,u.y,u.z),n.vertex.push(c.x,c.y,c.z)):(n.pathVertex.push(u.x,u.y,u.z),n.pathVertex.push(c.x,c.y,c.z)),t=v}else if("G2"===p||"G3"===p);else if("G90"===p)t.relative=!1;else if("G91"===p)t.relative=!0;else if("G92"===p){(v=t).x=void 0!==m.x?m.x:v.x,v.y=void 0!==m.y?m.y:v.y,v.z=void 0!==m.z?m.z:v.z,v.e=void 0!==m.e?m.e:v.e,t=v}}function g(e,t){var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.Float32BufferAttribute(e,3));var n=new THREE.LineSegments(r,t?a:i);n.name="layer"+d,y.add(n)}var y=new THREE.Group;if(y.name="gcode",this.splitLayer)for(d=0;d<r.length;d++){g((E=r[d]).vertex,!0),g(E.pathVertex,!1)}else{var _=[],b=[];for(d=0;d<r.length;d++){var E=r[d];_=_.concat(E.vertex),b=b.concat(E.pathVertex)}g(_,!0),g(b,!1)}return y.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),y}}},function(e,t){THREE.DRACOLoader=function(e){this.timeLoaded=0,this.manager=e||THREE.DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=THREE.TrianglesDrawMode,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}},THREE.DRACOLoader.prototype={constructor:THREE.DRACOLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){i.decodeDracoFile(e,t)},r,n)},setPath:function(e){return this.path=e,this},setVerbosity:function(e){return this.verbosity=e,this},setDrawMode:function(e){return this.drawMode=e,this},setSkipDequantization:function(e,t){var r=!0;return void 0!==t&&(r=t),this.getAttributeOptions(e).skipDequantization=r,this},decodeDracoFile:function(e,t,r,n){var i=this;THREE.DRACOLoader.getDecoderModule().then(function(a){i.decodeDracoFileInternal(e,a.decoder,t,r,n)})},decodeDracoFileInternal:function(e,t,r,n,i){var a=new t.DecoderBuffer;a.Init(new Int8Array(e),e.byteLength);var o=new t.Decoder,s=o.GetEncodedGeometryType(a);if(s==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(s!=t.POINT_CLOUD){var l="THREE.DRACOLoader: Unknown geometry type.";throw console.error(l),new Error(l)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(t,o,s,a,n,i))},addAttributeToGeometry:function(e,t,r,n,i,a,o,s){if(0===a.ptr){var l="THREE.DRACOLoader: No attribute "+n;throw console.error(l),new Error(l)}var u,c,h=a.num_components(),d=r.num_points()*h;switch(i){case Float32Array:u=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,a,u),s[n]=new Float32Array(d),c=THREE.Float32BufferAttribute;break;case Int8Array:u=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,a,u),s[n]=new Int8Array(d),c=THREE.Int8BufferAttribute;break;case Int16Array:u=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,a,u),s[n]=new Int16Array(d),c=THREE.Int16BufferAttribute;break;case Int32Array:u=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,a,u),s[n]=new Int32Array(d),c=THREE.Int32BufferAttribute;break;case Uint8Array:u=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,a,u),s[n]=new Uint8Array(d),c=THREE.Uint8BufferAttribute;break;case Uint16Array:u=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,a,u),s[n]=new Uint16Array(d),c=THREE.Uint16BufferAttribute;break;case Uint32Array:u=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,a,u),s[n]=new Uint32Array(d),c=THREE.Uint32BufferAttribute;break;default:l="THREE.DRACOLoader: Unexpected attribute type.";throw console.error(l),new Error(l)}for(var f=0;f<d;f++)s[n][f]=u.GetValue(f);o.addAttribute(n,new c(s[n],h)),e.destroy(u)},convertDracoGeometryTo3JS:function(e,t,r,n,i,a){var o,s;!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var l=performance.now();if(r===e.TRIANGULAR_MESH?(o=new e.Mesh,s=t.DecodeBufferToMesh(n,o)):(o=new e.PointCloud,s=t.DecodeBufferToPointCloud(n,o)),!s.ok()||0==o.ptr){var u="THREE.DRACOLoader: Decoding failed: ";throw u+=s.error_msg(),console.error(u),e.destroy(t),e.destroy(o),new Error(u)}var c,h=performance.now();e.destroy(n),r==e.TRIANGULAR_MESH?(c=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+c.toString())):c=0;var d=o.num_points(),f=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+d.toString()),console.log("Number of attributes loaded: "+f.toString()));var p=t.GetAttributeId(o,e.POSITION);if(-1==p){u="THREE.DRACOLoader: No position attribute found.";throw console.error(u),e.destroy(t),e.destroy(o),new Error(u)}var m=t.GetAttribute(o,p),v={},g=new THREE.BufferGeometry;if(i)for(var y in i){var _=a[y],b=i[y],E=t.GetAttributeByUniqueId(o,b);this.addAttributeToGeometry(e,t,o,y,_,E,g,v)}else for(var y in this.nativeAttributeMap){var w=t.GetAttributeId(o,e[this.nativeAttributeMap[y]]);if(-1!==w){this.verbosity>0&&console.log("Loaded "+y+" attribute.");E=t.GetAttribute(o,w);this.addAttributeToGeometry(e,t,o,y,Float32Array,E,g,v)}}if(r==e.TRIANGULAR_MESH)if(this.drawMode===THREE.TriangleStripDrawMode){var x=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(o,x),v.indices=new Uint32Array(x.size());for(var T=0;T<x.size();++T)v.indices[T]=x.GetValue(T);e.destroy(x)}else{var S=3*c;v.indices=new Uint32Array(S);var M=new e.DracoInt32Array;for(T=0;T<c;++T){t.GetFaceFromMesh(o,T,M);var R=3*T;v.indices[R]=M.GetValue(0),v.indices[R+1]=M.GetValue(1),v.indices[R+2]=M.GetValue(2)}e.destroy(M)}g.drawMode=this.drawMode,r==e.TRIANGULAR_MESH&&g.setIndex(new(v.indices.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(v.indices,1));var A=new e.AttributeQuantizationTransform;if(A.InitFromAttribute(m)){g.attributes.position.isQuantized=!0,g.attributes.position.maxRange=A.range(),g.attributes.position.numQuantizationBits=A.quantization_bits(),g.attributes.position.minValues=new Float32Array(3);for(T=0;T<3;++T)g.attributes.position.minValues[T]=A.min_value(T)}return e.destroy(A),e.destroy(t),e.destroy(o),this.decode_time=h-l,this.import_time=performance.now()-h,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),g},isVersionSupported:function(e,t){THREE.DRACOLoader.getDecoderModule().then(function(r){t(r.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},THREE.DRACOLoader.decoderPath="./",THREE.DRACOLoader.decoderConfig={},THREE.DRACOLoader.decoderModulePromise=null,THREE.DRACOLoader.setDecoderPath=function(e){THREE.DRACOLoader.decoderPath=e},THREE.DRACOLoader.setDecoderConfig=function(e){var t=THREE.DRACOLoader.decoderConfig.wasmBinary;THREE.DRACOLoader.decoderConfig=e||{},THREE.DRACOLoader.releaseDecoderModule(),t&&(THREE.DRACOLoader.decoderConfig.wasmBinary=t)},THREE.DRACOLoader.releaseDecoderModule=function(){THREE.DRACOLoader.decoderModulePromise=null},THREE.DRACOLoader.getDecoderModule=function(){var e=this,t=THREE.DRACOLoader.decoderPath,r=THREE.DRACOLoader.decoderConfig,n=THREE.DRACOLoader.decoderModulePromise;return n||("undefined"!=typeof DracoDecoderModule?n=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?n=THREE.DRACOLoader._loadScript(t+"draco_decoder.js"):(r.wasmBinaryFile=t+"draco_decoder.wasm",n=THREE.DRACOLoader._loadScript(t+"draco_wasm_wrapper.js").then(function(){return THREE.DRACOLoader._loadArrayBuffer(r.wasmBinaryFile)}).then(function(e){r.wasmBinary=e})),n=n.then(function(){return new Promise(function(t){r.onModuleLoaded=function(r){e.timeLoaded=performance.now(),t({decoder:r})},DracoDecoderModule(r)})}),THREE.DRACOLoader.decoderModulePromise=n,n)},THREE.DRACOLoader._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var r=document.getElementsByTagName("head")[0],n=document.createElement("script");return n.id="decoder_script",n.type="text/javascript",n.src=e,new Promise(function(e){n.onload=e,r.appendChild(n)})},THREE.DRACOLoader._loadArrayBuffer=function(e){var t=new THREE.FileLoader;return t.setResponseType("arraybuffer"),new Promise(function(r,n){t.load(e,r,void 0,n)})}},function(e,t){THREE.DDSLoader=function(e){THREE.CompressedTextureLoader.call(this,e),this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,r,n){for(var i=r*n*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i),s=0,l=0,u=0;u<n;u++)for(var c=0;c<r;c++){var h=a[l],d=a[++l],f=a[++l],p=a[++l];l++,o[s]=f,o[++s]=d,o[++s]=h,o[++s]=p,s++}return o}var a,o=n("DXT1"),s=n("DXT3"),l=n("DXT5"),u=n("ETC1"),c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!c[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var h,d=c[21],f=!1;switch(d){case o:a=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case s:a=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case l:a=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;case u:a=8,r.format=THREE.RGB_ETC1_Format;break;default:if(!(32===c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(h=d,String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255))),r;f=!0,a=64,r.format=THREE.RGBAFormat}r.mipmapCount=1,131072&c[2]&&!1!==t&&(r.mipmapCount=Math.max(1,c[7]));var p=c[28];if(r.isCubemap=!!(512&p),r.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),r;r.width=c[4],r.height=c[3];for(var m=c[1]+4,v=r.isCubemap?6:1,g=0;g<v;g++)for(var y=r.width,_=r.height,b=0;b<r.mipmapCount;b++){if(f)var E=(w=i(e,m,y,_)).length;else{E=Math.max(4,y)/4*Math.max(4,_)/4*a;var w=new Uint8Array(e,m,E)}var x={data:w,width:y,height:_};r.mipmaps.push(x),m+=E,y=Math.max(y>>1,1),_=Math.max(_>>1,1)}return r}},function(e,t){THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,n){var i,a=this;i=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),a.manager.itemStart(e);var o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new THREE.FileLoader(a.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===a.crossOrigin&&s.setWithCredentials(!0),s.load(e,function(r){try{a.parse(r,i,function(r){t(r),a.manager.itemEnd(e)},o)}catch(e){o(e)}},r,o)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,s,l){var f,p={};if("string"==typeof e)f=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o){try{p[r.KHR_BINARY_GLTF]=new u(e)}catch(e){return void(l&&l(e))}f=p[r.KHR_BINARY_GLTF].content}else f=THREE.LoaderUtils.decodeText(new Uint8Array(e));var m=JSON.parse(f);if(void 0===m.asset||m.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(m.extensionsUsed)for(var v=0;v<m.extensionsUsed.length;++v){var g=m.extensionsUsed[v],y=m.extensionsRequired||[];switch(g){case r.KHR_LIGHTS_PUNCTUAL:p[g]=new i(m);break;case r.KHR_MATERIALS_UNLIT:p[g]=new a;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:p[g]=new d;break;case r.KHR_DRACO_MESH_COMPRESSION:p[g]=new c(m,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:p[r.MSFT_TEXTURE_DDS]=new n(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:p[r.KHR_TEXTURE_TRANSFORM]=new h;break;default:y.indexOf(g)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}new U(m,p,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(s,l)}}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function a(){this.name=r.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(e){var t,r=this.lightDefs[e],n=new THREE.Color(16777215);void 0!==r.color&&n.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(n)).distance=i;break;case"spot":(t=new THREE.SpotLight(n)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},a.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},a.prototype.extendParams=function(e,t,r){var n=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(n)};var o="glTF",s=12,l={JSON:1313821514,BIN:5130562};function u(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,s);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var n=new DataView(e,s),i=0;i<n.byteLength;){var a=n.getUint32(i,!0);i+=4;var u=n.getUint32(i,!0);if(i+=4,u===l.JSON){var c=new Uint8Array(e,s+i,a);this.content=THREE.LoaderUtils.decodeText(c)}else if(u===l.BIN){var h=s+i;this.body=e.slice(h,h+a)}i+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function c(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function h(){this.name=r.KHR_TEXTURE_TRANSFORM}function d(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var n=t.extensions[this.name],i=THREE.ShaderLib.standard,a=THREE.UniformsUtils.clone(i.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",c);delete a.roughness,delete a.metalness,delete a.roughnessMap,delete a.metalnessMap,a.specular={value:(new THREE.Color).setHex(1118481)},a.glossiness={value:.5},a.specularMap={value:null},a.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=h,e.uniforms=a,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(n.diffuseFactor)){var f=n.diffuseFactor;e.color.fromArray(f),e.opacity=f[3]}if(void 0!==n.diffuseTexture&&d.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var p=n.specularGlossinessTexture;d.push(r.assignTexture(e,"glossinessMap",p)),d.push(r.assignTexture(e,"specularMap",p))}return Promise.all(d)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,n=0,i=r.length;n<i;n++){var a=e[r[n]];t[r[n]]=a&&a.isColor?a.clone():a}return t},refreshUniforms:function(e,t,r,n,i){if(!0===i.isGLTFSpecularGlossinessMaterial){var a,o=i.uniforms,s=i.defines;o.opacity.value=i.opacity,o.diffuse.value.copy(i.color),o.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),o.map.value=i.map,o.specularMap.value=i.specularMap,o.alphaMap.value=i.alphaMap,o.lightMap.value=i.lightMap,o.lightMapIntensity.value=i.lightMapIntensity,o.aoMap.value=i.aoMap,o.aoMapIntensity.value=i.aoMapIntensity,i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.glossinessMap?a=i.glossinessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap&&(a=i.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),o.uvTransform.value.copy(a.matrix)),i.envMap&&(o.envMap.value=i.envMap,o.envMapIntensity.value=i.envMapIntensity,o.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,o.reflectivity.value=i.reflectivity,o.refractionRatio.value=i.refractionRatio,o.maxMipLevel.value=e.properties.get(i.envMap).__maxMipLevel),o.specular.value.copy(i.specular),o.glossiness.value=i.glossiness,o.glossinessMap.value=i.glossinessMap,o.emissiveMap.value=i.emissiveMap,o.bumpMap.value=i.bumpMap,o.normalMap.value=i.normalMap,o.displacementMap.value=i.displacementMap,o.displacementScale.value=i.displacementScale,o.displacementBias.value=i.displacementBias,null!==o.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function f(e,t,r,n){THREE.Interpolant.call(this,e,t,r,n)}c.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var u in a){var c=M[u]||u.toLowerCase();o[c]=a[u]}for(u in e.attributes){c=M[u]||u.toLowerCase();if(void 0!==a[u]){var h=r.accessors[e.attributes[u]],d=w[h.componentType];l[c]=d,s[c]=!0===h.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){n.decodeDracoFile(e,function(e){for(var r in e.attributes){var n=e.attributes[r],i=s[r];void 0!==i&&(n.normalized=i)}t(e)},o,l)})})},h.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},f.prototype=Object.create(THREE.Interpolant.prototype),f.prototype.constructor=f,f.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n,a=0;a!==n;a++)t[a]=r[i+a];return t},f.prototype.beforeStart_=f.prototype.copySampleValue_,f.prototype.afterEnd_=f.prototype.copySampleValue_,f.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=n-t,c=(r-t)/u,h=c*c,d=h*c,f=e*l,p=f-l,m=-2*d+3*h,v=d-h,g=1-m,y=v-h+c,_=0;_!==o;_++){var b=a[p+_+o],E=a[p+_+s]*u,w=a[f+_+o],x=a[f+_]*u;i[_]=g*b+y*E+m*w+v*x}return i};var p,m=0,v=1,g=2,y=3,_=4,b=5,E=6,w={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},T={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},S={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},k="OPAQUE",P="MASK",C="BLEND",L={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function I(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function O(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function H(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function D(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function N(e){for(var t="",r=Object.keys(e).sort(),n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function F(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,n=e.array.slice(0,t*r),i=0,a=0;i<t;++i)n[a++]=e.getX(i),r>=2&&(n[a++]=e.getY(i)),r>=3&&(n[a++]=e.getZ(i)),r>=4&&(n[a++]=e.getW(i));return new THREE.BufferAttribute(n,r,e.normalized)}return e.clone()}function U(e,r,n){this.json=e||{},this.extensions=r||{},this.options=n||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function B(e,t,r){var n=t.attributes,i=[];function a(t,n){return r.getDependency("accessor",t).then(function(t){e.addAttribute(n,t)})}for(var o in n){var s=M[o]||o.toLowerCase();s in e.attributes||i.push(a(n[o],s))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(l)}return H(e,t),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(u=t[a]).POSITION&&(n=!0),void 0!==u.NORMAL&&(i=!0),!n||!i);a++);if(!n&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var u=t[a];if(n){var c=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;s.push(c)}i&&(c=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(r){for(var a=r[0],o=r[1],s=0,l=a.length;s<l;s++)e.attributes.position!==a[s]&&(a[s]=F(a[s]));for(s=0,l=o.length;s<l;s++)e.attributes.normal!==o[s]&&(o[s]=F(o[s]));for(s=0,l=t.length;s<l;s++){var u=t[s],c="morphTarget"+s;if(n&&void 0!==u.POSITION){var h=a[s];h.name=c;for(var d=e.attributes.position,f=0,p=h.count;f<p;f++)h.setXYZ(f,h.getX(f)+d.getX(f),h.getY(f)+d.getY(f),h.getZ(f)+d.getZ(f))}if(i&&void 0!==u.NORMAL){var m=o[s];m.name=c;var v=e.attributes.normal;for(f=0,p=m.count;f<p;f++)m.setXYZ(f,m.getX(f)+v.getX(f),m.getY(f)+v.getY(f),m.getZ(f)+v.getZ(f))}}return n&&(e.morphAttributes.position=a),i&&(e.morphAttributes.normal=o),e})}(e,t.targets,r):e})}return U.prototype.parse=function(e,t){var r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};O(i,a,n),H(a,n),e(a)}).catch(t)},U.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n={},i={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var c=0,h=e.length;c<h;c++){var d=e[c];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},U.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},U.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t},U.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,r){n.load(I(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},U.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})},U.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,a,o=e[0],s=S[n.type],l=w[n.componentType],u=l.BYTES_PER_ELEMENT,c=u*s,h=n.byteOffset||0,d=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,f=!0===n.normalized;if(d&&d!==c){var p="InterleavedBuffer:"+n.bufferView+":"+n.componentType,m=t.cache.get(p);m||(i=new l(o),m=new THREE.InterleavedBuffer(i,d/u),t.cache.add(p,m)),a=new THREE.InterleavedBufferAttribute(m,s,h/u,f)}else i=null===o?new l(n.count*s):new l(o,h,n.count*s),a=new THREE.BufferAttribute(i,s,f);if(void 0!==n.sparse){var v=S.SCALAR,g=w[n.sparse.indices.componentType],y=n.sparse.indices.byteOffset||0,_=n.sparse.values.byteOffset||0,b=new g(e[1],y,n.sparse.count*v),E=new l(e[2],_,n.sparse.count*s);null!==o&&a.setArray(a.array.slice());for(var x=0,T=b.length;x<T;x++){var M=b[x];if(a.setX(M,E[x*s]),s>=2&&a.setY(M,E[x*s+1]),s>=3&&a.setZ(M,E[x*s+2]),s>=4&&a.setW(M,E[x*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})},U.prototype.loadTexture=function(e){var t,n=this,i=this.json,a=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,l=i.textures[e],u=l.extensions||{},c=(t=u[r.MSFT_TEXTURE_DDS]?i.images[u[r.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(c=n.getDependency("bufferView",t.bufferView).then(function(e){h=!0;var r=new Blob([e],{type:t.mimeType});return c=s.createObjectURL(r)})),Promise.resolve(c).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=u[r.MSFT_TEXTURE_DDS]?n.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,n){t.load(I(e,a.path),r,void 0,n)})}).then(function(e){!0===h&&s.revokeObjectURL(c),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in L&&(e.format=L[t.mimeType]);var r=(i.samplers||{})[l.sampler]||{};return e.magFilter=x[r.magFilter]||THREE.LinearFilter,e.minFilter=x[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=T[r.wrapS]||THREE.RepeatWrapping,e.wrapT=T[r.wrapT]||THREE.RepeatWrapping,e})},U.prototype.assignTexture=function(e,t,n){var i=this;return this.getDependency("texture",n.index).then(function(a){if(!a.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":a.format=THREE.RGBFormat}if(i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;o&&(a=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(a,o))}e[t]=a})},U.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=this.extensions,a=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,u=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,h=this.cache.get(c);h||(h=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.lights=!1,this.cache.add(c,h)),n=h}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var d=this.cache.get(c);d||(d=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(d,n),d.color.copy(n.color),d.lights=!1,this.cache.add(c,d)),n=d}if(a||o||s||l){c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),s&&(c+="skinning:"),a&&(c+="vertex-colors:"),o&&(c+="flat-shading:"),l&&(c+="morph-targets:"),u&&(c+="morph-normals:");var f=this.cache.get(c);f||(f=n.isGLTFSpecularGlossinessMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(n):n.clone(),s&&(f.skinning=!0),a&&(f.vertexColors=THREE.VertexColors),o&&(f.flatShading=!0),l&&(f.morphTargets=!0),u&&(f.morphNormals=!0),this.cache.add(c,f)),n=f}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),t.addAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2))),n.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),e.material=n},U.prototype.loadMaterial=function(e){var t,n=this.json,i=this.extensions,a=n.materials[e],o={},s=a.extensions||{},l=[];if(s[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),l.push(u.extendParams(o,a,this))}else if(s[r.KHR_MATERIALS_UNLIT]){var c=i[r.KHR_MATERIALS_UNLIT];t=c.getMaterialType(),l.push(c.extendParams(o,a,this))}else{t=THREE.MeshStandardMaterial;var h=a.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var d=h.baseColorFactor;o.color.fromArray(d),o.opacity=d[3]}void 0!==h.baseColorTexture&&l.push(this.assignTexture(o,"map",h.baseColorTexture)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===a.doubleSided&&(o.side=THREE.DoubleSide);var f=a.alphaMode||k;return f===C?o.transparent=!0:(o.transparent=!1,f===P&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==a.normalTexture.scale&&o.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(l).then(function(){var e;return e=t===THREE.ShaderMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==a.name&&(e.name=a.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),H(e,a),a.extensions&&O(i,e,a),e})},U.prototype.loadGeometries=function(e){var t=this,n=this.extensions,i=this.primitiveCache;function a(e){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return B(r,e,t)})}for(var o,s,l=[],u=0,c=e.length;u<c;u++){var h,d=e[u],f=(s=void 0,(s=(o=d).extensions&&o.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+N(s.attributes):o.indices+":"+N(o.attributes)+":"+o.mode),p=i[f];if(p)l.push(p.promise);else h=d.extensions&&d.extensions[r.KHR_DRACO_MESH_COMPRESSION]?a(d):B(new THREE.BufferGeometry,d,t),i[f]={primitive:d,promise:h},l.push(h)}return Promise.all(l)},U.prototype.loadMesh=function(e){for(var t=this,r=this.json.meshes[e],n=r.primitives,i=[],a=0,o=n.length;a<o;a++){var s=void 0===n[a].material?p=p||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",n[a].material);i.push(s)}return Promise.all(i).then(function(i){return t.loadGeometries(n).then(function(a){for(var o=[],s=0,l=a.length;s<l;s++){var u,c=a[s],h=n[s],d=i[s];if(h.mode===_||h.mode===b||h.mode===E||void 0===h.mode)!0!==(u=!0===r.isSkinnedMesh?new THREE.SkinnedMesh(c,d):new THREE.Mesh(c,d)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),h.mode===b?u.drawMode=THREE.TriangleStripDrawMode:h.mode===E&&(u.drawMode=THREE.TriangleFanDrawMode);else if(h.mode===v)u=new THREE.LineSegments(c,d);else if(h.mode===y)u=new THREE.Line(c,d);else if(h.mode===g)u=new THREE.LineLoop(c,d);else{if(h.mode!==m)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new THREE.Points(c,d)}Object.keys(u.geometry.morphAttributes).length>0&&D(u,r),u.name=r.name||"mesh_"+e,a.length>1&&(u.name+="_"+s),H(u,r),t.assignFinalMaterial(u),o.push(u)}if(1===o.length)return o[0];var f=new THREE.Group;for(s=0,l=o.length;s<l;s++)f.add(o[s]);return f})})},U.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),void 0!==r.name&&(t.name=r.name),H(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},U.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},U.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],n=[],i=[],a=[],o=[],s=0,l=t.channels.length;s<l;s++){var u=t.channels[s],c=t.samplers[u.sampler],h=u.target,d=void 0!==h.node?h.node:h.id,p=void 0!==t.parameters?t.parameters[c.input]:c.input,m=void 0!==t.parameters?t.parameters[c.output]:c.output;r.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",p)),i.push(this.getDependency("accessor",m)),a.push(c),o.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then(function(r){for(var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=[],u=0,c=n.length;u<c;u++){var h=n[u],d=i[u],p=a[u],m=o[u],v=s[u];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,R[v.path]){case R.weights:g=THREE.NumberKeyframeTrack;break;case R.rotation:g=THREE.QuaternionKeyframeTrack;break;case R.position:case R.scale:default:g=THREE.VectorKeyframeTrack}var y=h.name?h.name:h.uuid,_=void 0!==m.interpolation?A[m.interpolation]:THREE.InterpolateLinear,b=[];R[v.path]===R.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)}):b.push(y);var E=p.array;if(p.normalized){var w;if(E.constructor===Int8Array)w=1/127;else if(E.constructor===Uint8Array)w=1/255;else if(E.constructor==Int16Array)w=1/32767;else{if(E.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var x=new Float32Array(E.length),T=0,S=E.length;T<S;T++)x[T]=E[T]*w;E=x}for(T=0,S=b.length;T<S;T++){var M=new g(b[T]+"."+R[v.path],d.array,E,_);"CUBICSPLINE"===m.interpolation&&(M.createInterpolant=function(e){return new f(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(M)}}}var k=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(k,void 0,l)})},U.prototype.loadNode=function(e){var t=this.json,n=this.extensions,i=this,a=t.meshReferences,o=t.meshUses,s=t.nodes[e];return(!0===s.isBone?Promise.resolve(new THREE.Bone):void 0!==s.mesh?i.getDependency("mesh",s.mesh).then(function(e){var t;if(a[s.mesh]>1){var r=o[s.mesh]++;(t=e.clone()).name+="_instance_"+r,t.onBeforeRender=e.onBeforeRender;for(var n=0,i=t.children.length;n<i;n++)t.children[n].name+="_instance_"+r,t.children[n].onBeforeRender=e.children[n].onBeforeRender}else t=e;return void 0!==s.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=s.weights.length;t<r;t++)e.morphTargetInfluences[t]=s.weights[t]}),t}):void 0!==s.camera?i.getDependency("camera",s.camera):s.extensions&&s.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[r.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",s.extensions[r.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new THREE.Object3D)).then(function(e){if(void 0!==s.name&&(e.userData.name=s.name,e.name=THREE.PropertyBinding.sanitizeNodeName(s.name)),H(e,s),s.extensions&&O(n,e,s),void 0!==s.matrix){var t=new THREE.Matrix4;t.fromArray(s.matrix),e.applyMatrix(t)}else void 0!==s.translation&&e.position.fromArray(s.translation),void 0!==s.rotation&&e.quaternion.fromArray(s.rotation),void 0!==s.scale&&e.scale.fromArray(s.scale);return e})},U.prototype.loadScene=function(){function e(t,r,n,i){var a=n.nodes[t];return i.getDependency("node",t).then(function(e){return void 0===a.skin?e:i.getDependency("skin",a.skin).then(function(e){for(var r=[],n=0,a=(t=e).joints.length;n<a;n++)r.push(i.getDependency("node",t.joints[n]));return Promise.all(r)}).then(function(r){for(var n=!0===e.isGroup?e.children:[e],i=0,a=n.length;i<a;i++){for(var o=n[i],s=[],l=[],u=0,c=r.length;u<c;u++){var h=r[u];if(h){s.push(h);var d=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&d.fromArray(t.inverseBindMatrices.array,16*u),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}o.bind(new THREE.Skeleton(s,l),o.matrixWorld)}return e});var t}).then(function(t){r.add(t);var o=[];if(a.children)for(var s=a.children,l=0,u=s.length;l<u;l++){var c=s[l];o.push(e(c,t,n,i))}return Promise.all(o)})}return function(t){var r=this.json,n=this.extensions,i=this.json.scenes[t],a=new THREE.Scene;void 0!==i.name&&(a.name=i.name),H(a,i),i.extensions&&O(n,a,i);for(var o=i.nodes||[],s=[],l=0,u=o.length;l<u;l++)s.push(e(o[l],a,r,this));return Promise.all(s).then(function(){return a})}}(),e}()},function(e,t){var r={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},n={};n[THREE.NearestFilter]=r.NEAREST,n[THREE.NearestMipMapNearestFilter]=r.NEAREST_MIPMAP_NEAREST,n[THREE.NearestMipMapLinearFilter]=r.NEAREST_MIPMAP_LINEAR,n[THREE.LinearFilter]=r.LINEAR,n[THREE.LinearMipMapNearestFilter]=r.LINEAR_MIPMAP_NEAREST,n[THREE.LinearMipMapLinearFilter]=r.LINEAR_MIPMAP_LINEAR,n[THREE.ClampToEdgeWrapping]=r.CLAMP_TO_EDGE,n[THREE.RepeatWrapping]=r.REPEAT,n[THREE.MirroredRepeatWrapping]=r.MIRRORED_REPEAT;var i={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,t,a){(a=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1},a)).animations.length>0&&(a.trs=!0);var o,s={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},l=0,u=[],c=[],h=new Map,d=[],f={},p={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},m=new Map,v=0;function g(e){return m.has(e)||m.set(e,v++),m.get(e)}function y(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function _(e){return 4*Math.ceil(e/4)}function b(e,t){t=t||0;var r=_(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}function E(e,t){if(0!==Object.keys(e.userData).length)try{var r=JSON.parse(JSON.stringify(e.userData));if(a.includeCustomExtensions&&r.gltfExtensions){for(var n in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[n]=r.gltfExtensions[n],f[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function w(e,t){var r=!1,n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,f.KHR_texture_transform=!0)}function x(e){return s.buffers||(s.buffers=[{byteLength:0}]),u.push(e),0}function T(e,t,n,i){var o;if(e.array.constructor===Float32Array)o=r.FLOAT;else if(e.array.constructor===Uint32Array)o=r.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=r.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=r.UNSIGNED_BYTE}if(void 0===n&&(n=0),void 0===i&&(i=e.count),a.truncateDrawRange&&void 0!==t&&null===t.index){var u=n+i,c=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),(i=Math.min(u,c)-n)<0&&(i=0)}if(0===i)return null;var h,d=function(e,t,r){for(var n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+r;i++)for(var a=0;a<e.itemSize;a++){var o=e.array[i*e.itemSize+a];n.min[a]=Math.min(n.min[a],o),n.max[a]=Math.max(n.max[a],o)}return n}(e,n,i);void 0!==t&&(h=e===t.index?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER);var f=function(e,t,n,i,a){var o;s.bufferViews||(s.bufferViews=[]),o=t===r.UNSIGNED_BYTE?1:t===r.UNSIGNED_SHORT?2:4;for(var u=_(i*e.itemSize*o),c=new DataView(new ArrayBuffer(u)),h=0,d=n;d<n+i;d++)for(var f=0;f<e.itemSize;f++){var p=e.array[d*e.itemSize+f];t===r.FLOAT?c.setFloat32(h,p,!0):t===r.UNSIGNED_INT?c.setUint32(h,p,!0):t===r.UNSIGNED_SHORT?c.setUint16(h,p,!0):t===r.UNSIGNED_BYTE&&c.setUint8(h,p),h+=o}var m={buffer:x(c.buffer),byteOffset:l,byteLength:u};return void 0!==a&&(m.target=a),a===r.ARRAY_BUFFER&&(m.byteStride=e.itemSize*o),l+=u,s.bufferViews.push(m),{id:s.bufferViews.length-1,byteLength:0}}(e,o,n,i,h),p={bufferView:f.id,byteOffset:f.byteOffset,componentType:o,count:i,max:d.max,min:d.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return s.accessors||(s.accessors=[]),s.accessors.push(p),s.accessors.length-1}function S(e,t,r){p.images.has(e)||p.images.set(e,{});var n=p.images.get(e),i=t===THREE.RGBAFormat?"image/png":"image/jpeg",u=i+":flipY/"+r.toString();if(void 0!==n[u])return n[u];s.images||(s.images=[]);var h={mimeType:i};if(a.embedImages){var d=o=o||document.createElement("canvas");d.width=e.width,d.height=e.height,a.forcePowerOfTwoTextures&&!function(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}(e)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),d.width=THREE.Math.floorPowerOfTwo(d.width),d.height=THREE.Math.floorPowerOfTwo(d.height));var f=d.getContext("2d");!0===r&&(f.translate(0,d.height),f.scale(1,-1)),f.drawImage(e,0,0,d.width,d.height),!0===a.binary?c.push(new Promise(function(e){d.toBlob(function(t){(function(e){return s.bufferViews||(s.bufferViews=[]),new Promise(function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=b(r.result),n={buffer:x(e),byteOffset:l,byteLength:e.byteLength};l+=e.byteLength,s.bufferViews.push(n),t(s.bufferViews.length-1)}})})(t).then(function(t){h.bufferView=t,e()})},i)})):h.uri=d.toDataURL(i)}else h.uri=e.src;s.images.push(h);var m=s.images.length-1;return n[u]=m,m}function M(e){s.samplers||(s.samplers=[]);var t={magFilter:n[e.magFilter],minFilter:n[e.minFilter],wrapS:n[e.wrapS],wrapT:n[e.wrapT]};return s.samplers.push(t),s.samplers.length-1}function R(e){if(p.textures.has(e))return p.textures.get(e);s.textures||(s.textures=[]);var t={sampler:M(e),source:S(e.image,e.format,e.flipY)};s.textures.push(t);var r=s.textures.length-1;return p.textures.set(e,r),r}function A(e){if(p.materials.has(e))return p.materials.get(e);if(s.materials||(s.materials=[]),e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},f.KHR_materials_unlit=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(y(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var n={index:R(e.metalnessMap)};w(n,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=n}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var i={index:R(e.map)};w(i,e.map),t.pbrMetallicRoughness.baseColorTexture=i}if(e.isMeshBasicMaterial||e.isLineBasicMaterial||e.isPointsMaterial);else{var a=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(y(a,[0,0,0])||(t.emissiveFactor=a),e.emissiveMap){var o={index:R(e.emissiveMap)};w(o,e.emissiveMap),t.emissiveTexture=o}}if(e.normalMap){var l={index:R(e.normalMap)};-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),l.scale=e.normalScale.x),w(l,e.normalMap),t.normalTexture=l}if(e.aoMap){var u={index:R(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(u.strength=e.aoMapIntensity),w(u,e.aoMap),t.occlusionTexture=u}(e.transparent||e.alphaTest>0)&&(t.alphaMode=e.opacity<1?"BLEND":"MASK",e.alphaTest>0&&.5!==e.alphaTest&&(t.alphaCutoff=e.alphaTest)),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),E(e,t),s.materials.push(t);var c=s.materials.length-1;return p.materials.set(e,c),c}function k(e){var t=e.geometry.uuid+":"+e.material.uuid;if(p.meshes.has(t))return p.meshes.get(t);var n,i=e.geometry;if(e.isLineSegments)n=r.LINES;else if(e.isLineLoop)n=r.LINE_LOOP;else if(e.isLine)n=r.LINE_STRIP;else if(e.isPoints)n=r.POINTS;else{if(!i.isBufferGeometry){console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use THREE.BufferGeometry instead.");var o=new THREE.BufferGeometry;o.fromGeometry(i),i=o}e.drawMode===THREE.TriangleFanDrawMode?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),n=r.TRIANGLE_FAN):n=e.drawMode===THREE.TriangleStripDrawMode?e.material.wireframe?r.LINE_STRIP:r.TRIANGLE_STRIP:e.material.wireframe?r.LINES:r.TRIANGLES}var l={},u={},c=[],h=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=i.getAttribute("normal");void 0===f||function(e){if(p.attributesNormalized.has(e))return!1;for(var t=new THREE.Vector3,r=0,n=e.count;r<n;r++)if(Math.abs(t.fromArray(e.array,3*r).length()-1)>5e-4)return!1;return!0}(f)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),i.addAttribute("normal",function(e){if(p.attributesNormalized.has(e))return p.attributesNormalized.get(e);for(var t=e.clone(),r=new THREE.Vector3,n=0,i=t.count;n<i;n++)r.fromArray(t.array,3*n),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*n);return p.attributesNormalized.set(e,t),t}(f)));var m=null;for(var v in i.attributes)if("morph"!==v.substr(0,5)){var y=i.attributes[v];v=d[v]||v.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(v)||(v="_"+v),p.attributes.has(g(y)))u[v]=p.attributes.get(g(y));else{m=null;var _=y.array;"JOINTS_0"!==v||_ instanceof Uint16Array||_ instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),m=new THREE.BufferAttribute(new Uint16Array(_),y.itemSize,y.normalized));var b=T(m||y,i);null!==b&&(u[v]=b,p.attributes.set(g(y),b))}}if(void 0!==f&&i.addAttribute("normal",f),0===Object.keys(u).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var w=[],x=[],S={};if(void 0!==e.morphTargetDictionary)for(var M in e.morphTargetDictionary)S[e.morphTargetDictionary[M]]=M;for(var R=0;R<e.morphTargetInfluences.length;++R){var k={},P=!1;for(var v in i.morphAttributes)if("position"===v||"normal"===v){y=i.morphAttributes[v][R];var C=v.toUpperCase(),L=i.attributes[v];if(p.attributes.has(g(y)))k[C]=p.attributes.get(g(y));else{for(var I=y.clone(),O=0,H=y.count;O<H;O++)I.setXYZ(O,y.getX(O)-L.getX(O),y.getY(O)-L.getY(O),y.getZ(O)-L.getZ(O));k[C]=T(I,i),p.attributes.set(g(L),k[C])}}else P||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),P=!0);h.push(k),w.push(e.morphTargetInfluences[R]),void 0!==e.morphTargetDictionary&&x.push(S[R])}l.weights=w,x.length>0&&(l.extras={},l.extras.targetNames=x)}var D=a.forceIndices,N=Array.isArray(e.material);if(N&&0===i.groups.length)return null;!D&&null===i.index&&N&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),D=!0);var F=!1;if(null===i.index&&D){for(var U=[],B=(R=0,i.attributes.position.count);R<B;R++)U[R]=R;i.setIndex(U),F=!0}var z=N?e.material:[e.material],j=N?i.groups:[{materialIndex:0,start:void 0,count:void 0}];for(R=0,B=j.length;R<B;R++){var V={mode:n,attributes:u};if(E(i,V),h.length>0&&(V.targets=h),null!==i.index){t=g(i.index);void 0===j[R].start&&void 0===j[R].count||(t+=":"+j[R].start+":"+j[R].count),p.attributes.has(t)?V.indices=p.attributes.get(t):(V.indices=T(i.index,i,j[R].start,j[R].count),p.attributes.set(t,V.indices)),null===V.indices&&delete V.indices}var G=A(z[j[R].materialIndex]);null!==G&&(V.material=G),c.push(V)}F&&i.setIndex(null),l.primitives=c,s.meshes||(s.meshes=[]),s.meshes.push(l);var W=s.meshes.length-1;return p.meshes.set(t,W),W}function P(e,t){s.animations||(s.animations=[]);for(var r=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,n=[],a=[],o=0;o<r.length;++o){var l=r[o],u=THREE.PropertyBinding.parseTrackName(l.name),c=THREE.PropertyBinding.findNode(t,u.nodeName),d=i[u.propertyName];if("bones"===u.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(u.objectIndex):void 0),!c||!d)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;var f,p=l.values.length/l.times.length;d===i.morphTargetInfluences&&(p/=c.morphTargetInfluences.length),!0===l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(f="CUBICSPLINE",p/=3):f=l.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:T(new THREE.BufferAttribute(l.times,1)),output:T(new THREE.BufferAttribute(l.values,p)),interpolation:f}),n.push({sampler:a.length-1,target:{node:h.get(c),path:d}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:a,channels:n}),s.animations.length-1}function C(e){var t=s.nodes[h.get(e)],r=e.skeleton,n=e.skeleton.bones[0];if(void 0===n)return null;for(var i=[],a=new Float32Array(16*r.bones.length),o=0;o<r.bones.length;++o)i.push(h.get(r.bones[o])),r.boneInverses[o].toArray(a,16*o);return void 0===s.skins&&(s.skins=[]),s.skins.push({inverseBindMatrices:T(new THREE.BufferAttribute(a,16)),joints:i,skeleton:h.get(n)}),t.skin=s.skins.length-1}function L(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=s.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function I(e){s.nodes||(s.nodes=[]);var t={};if(a.trs){var r=e.quaternion.toArray(),n=e.position.toArray(),i=e.scale.toArray();y(r,[0,0,0,1])||(t.rotation=r),y(n,[0,0,0])||(t.translation=n),y(i,[1,1,1])||(t.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),y(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),E(e,t),e.isMesh||e.isLine||e.isPoints){var o=k(e);null!==o&&(t.mesh=o)}else if(e.isCamera)t.camera=function(e){s.cameras||(s.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.Math.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),s.cameras.push(r),s.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)f.KHR_lights_punctual||(s.extensions=s.extensions||{},s.extensions.KHR_lights_punctual={lights:[]},f.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:L(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&d.push(e),e.children.length>0){for(var l=[],u=0,c=e.children.length;u<c;u++){var p=e.children[u];if(p.visible||!1===a.onlyVisible){var m=I(p);null!==m&&l.push(m)}}l.length>0&&(t.children=l)}s.nodes.push(t);var v=s.nodes.length-1;return h.set(e,v),v}function O(e){s.scenes||(s.scenes=[],s.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),e.userData&&Object.keys(e.userData).length>0&&(t.extras=E(e)),s.scenes.push(t);for(var r=[],n=0,i=e.children.length;n<i;n++){var o=e.children[n];if(o.visible||!1===a.onlyVisible){var l=I(o);null!==l&&r.push(l)}}r.length>0&&(t.nodes=r),E(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof THREE.Scene?O(e[r]):t.push(e[r]);for(t.length>0&&function(e){var t=new THREE.Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);O(t)}(t),r=0;r<d.length;++r)C(d[r]);for(r=0;r<a.animations.length;++r)P(a.animations[r],e[0])}(e),Promise.all(c).then(function(){var e=new Blob(u,{type:"application/octet-stream"}),r=Object.keys(f);if(r.length>0&&(s.extensionsUsed=r),s.buffers&&s.buffers.length>0){s.buffers[0].byteLength=e.size;var n=new window.FileReader;if(!0===a.binary){n.readAsArrayBuffer(e),n.onloadend=function(){var e=b(n.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var i=b(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);t[r]=i>255?32:i}return t.buffer}(JSON.stringify(s)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,i.byteLength,!0),a.setUint32(4,1313821514,!0);var o=new ArrayBuffer(12),l=new DataView(o);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);var u=12+a.byteLength+i.byteLength+r.byteLength+e.byteLength;l.setUint32(8,u,!0);var c=new Blob([o,a,i,r,e],{type:"application/octet-stream"}),h=new window.FileReader;h.readAsArrayBuffer(c),h.onloadend=function(){t(h.result)}}}else n.readAsDataURL(e),n.onloadend=function(){var e=n.result;s.buffers[0].uri=e,t(s)}}else t(s)})}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var r,n=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+n),o=e.createInterpolant(new e.ValueBufferType(n));if(0===e.times.length){i[0]=t;for(var s=0;s<n;s++)a[s]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;i[0]=t,i.set(e.times,1),a.set(o.evaluate(t),0),a.set(e.values,n),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),a.set(e.values,0),a.set(o.evaluate(t),e.values.length),r=i.length-1}else for(s=0;s<e.times.length;s++){if(Math.abs(e.times[s]-t)<.001)return s;if(e.times[s]<t&&e.times[s+1]>t){i.set(e.times.slice(0,s+1),0),i[s+1]=t,i.set(e.times.slice(s+1),s+2),a.set(e.values.slice(0,(s+1)*n),0),a.set(o.evaluate(t),(s+1)*n),a.set(e.values.slice((s+1)*n),(s+2)*n),r=s+1;break}}return e.times=i,e.values=a,r},mergeMorphTargetTracks:function(e,t){for(var r=[],n={},i=e.tracks,a=0;a<i.length;++a){var o=i[a],s=THREE.PropertyBinding.parseTrackName(o.name),l=THREE.PropertyBinding.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(THREE.InterpolateLinear)}var u,c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[s.propertyIndex];if(void 0===h)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0!==n[l.uuid]){var d=o.createInterpolant(new o.ValueBufferType(1));u=n[l.uuid];for(m=0;m<u.times.length;m++)u.values[m*c+h]=d.evaluate(u.times[m]);for(m=0;m<o.times.length;m++){var f=this.insertKeyframe(u,o.times[m]);u.values[f*c+h]=o.values[m]}}else{for(var p=new((u=o.clone()).ValueBufferType)(c*u.times.length),m=0;m<u.times.length;m++)p[m*c+h]=u.values[m];u.name=".morphTargetInfluences",u.values=p,n[l.uuid]=u,r.push(u)}}else r.push(o)}return e.tracks=r,e}}},function(e,t,r){"use strict";r.r(t);var n=r(8);THREE.AMFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.AMFLoader.prototype={constructor:THREE.AMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e){for(var t="AMF Material",n=e.attributes.id.textContent,i={r:1,g:1,b:1,a:1},a=null,o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(t=s.textContent):"color"===s.nodeName&&(i=r(s))}return a=new THREE.MeshPhongMaterial({flatShading:!0,color:new THREE.Color(i.r,i.g,i.b),name:t}),1!==i.a&&(a.transparent=!0,a.opacity=i.a),{id:n,material:a}}function r(e){for(var t={r:1,g:1,b:1,a:1},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function i(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,i=r.getElementsByTagName("v2")[0].textContent,a=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(n,i,a)}r=r.nextElementSibling}return t}function a(e){for(var t=[],r=[],n=e.firstElementChild;n;){if("vertex"===n.nodeName)for(var i=n.firstElementChild;i;){if("coordinates"===i.nodeName){var a=i.getElementsByTagName("x")[0].textContent,o=i.getElementsByTagName("y")[0].textContent,s=i.getElementsByTagName("z")[0].textContent;t.push(a,o,s)}else if("normal"===i.nodeName){var l=i.getElementsByTagName("nx")[0].textContent,u=i.getElementsByTagName("ny")[0].textContent,c=i.getElementsByTagName("nz")[0].textContent;r.push(l,u,c)}i=i.nextElementSibling}n=n.nextElementSibling}return{vertices:t,normals:r}}function o(e){for(var t=e.attributes.id.textContent,n={name:"amfobject",meshes:[]},o=null,s=e.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(n.name=s.textContent);else if("color"===s.nodeName)o=r(s);else if("mesh"===s.nodeName){for(var l=s.firstElementChild,u={vertices:[],normals:[],volumes:[],color:o};l;){if("vertices"===l.nodeName){var c=a(l);u.normals=u.normals.concat(c.normals),u.vertices=u.vertices.concat(c.vertices)}else"volume"===l.nodeName&&u.volumes.push(i(l));l=l.nextElementSibling}n.meshes.push(u)}s=s.nextElementSibling}return{id:t,obj:n}}var s,l,u=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var r=null,i=null;console.log("THREE.AMFLoader: Loading Zip");try{r=new n(e)}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: jszip missing and file is compressed."),null}for(i in r.files)if(".amf"===i.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+i),t=new DataView(r.file(i).asArrayBuffer())}var a=THREE.LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(a,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),c="",h="",d=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(u),f={},p={},m=u.documentElement.childNodes;for(s=0;s<m.length;s++){var v=m[s];if("metadata"===v.nodeName)void 0!==v.attributes.type&&("name"===v.attributes.type.value?c=v.textContent:"author"===v.attributes.type.value&&(h=v.textContent));else if("material"===v.nodeName){var g=t(v);f[g.id]=g.material}else if("object"===v.nodeName){var y=o(v);p[y.id]=y.obj}}var _=new THREE.Group,b=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});for(var E in _.name=c,_.userData.author=h,_.userData.loader="AMF",p){var w=p[E],x=w.meshes,T=new THREE.Group;for(T.name=w.name||"",s=0;s<x.length;s++){var S=b,M=x[s],R=new THREE.Float32BufferAttribute(M.vertices,3),A=null;if(M.normals.length&&(A=new THREE.Float32BufferAttribute(M.normals,3)),M.color){var k=M.color;(S=b.clone()).color=new THREE.Color(k.r,k.g,k.b),1!==k.a&&(S.transparent=!0,S.opacity=k.a)}var P=M.volumes;for(l=0;l<P.length;l++){var C=P[l],L=new THREE.BufferGeometry,I=S;L.setIndex(C.triangles),L.addAttribute("position",R.clone()),A&&L.addAttribute("normal",A.clone()),void 0!==f[C.materialId]&&(I=f[C.materialId]),L.scale(d,d,d),T.add(new THREE.Mesh(L,I.clone()))}}_.add(T)}return _}}},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(67),i=r(68),a=r(69);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return j(e).length;default:if(n)return z(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,r);case"utf8":case"utf-8":return M(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return k(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=r;a<s;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return-1}function _(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function b(e,t,r,n){return V(z(t,e.length-r),e,r,n)}function E(e,t,r,n){return V(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return E(e,t,r,n)}function x(e,t,r,n){return V(j(t),e,r,n)}function T(e,t,r,n){return V(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function S(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function M(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=R)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=R));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return u(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return c(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(n,i),c=e.slice(t,r),h=0;h<s;++h)if(u[h]!==c[h]){a=u[h],o=c[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return E(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return x(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var R=4096;function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function k(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function P(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=B(e[a]);return i}function C(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function H(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function D(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,a){return a||D(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function F(e,t,r,n,a){return a||D(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):H(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):H(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:z(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function j(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(5))},function(e,t,r){"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){for(var t,r=u(e),n=r[0],o=r[1],s=new a(function(e,t,r){return 3*(t+r)/4-r}(0,n,o)),l=0,c=o>0?n-4:n,h=0;h<c;h+=4)t=i[e.charCodeAt(h)]<<18|i[e.charCodeAt(h+1)]<<12|i[e.charCodeAt(h+2)]<<6|i[e.charCodeAt(h+3)],s[l++]=t>>16&255,s[l++]=t>>8&255,s[l++]=255&t;2===o&&(t=i[e.charCodeAt(h)]<<2|i[e.charCodeAt(h+1)]>>4,s[l++]=255&t);1===o&&(t=i[e.charCodeAt(h)]<<10|i[e.charCodeAt(h+1)]<<4|i[e.charCodeAt(h+2)]>>2,s[l++]=t>>8&255,s[l++]=255&t);return s},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(c(e,o,o+16383>s?s:o+16383));1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";r.r(t);var n=r(8);THREE.ThreeMFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.availableExtensions=[]},THREE.ThreeMFLoader.prototype={constructor:THREE.ThreeMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){var t=this;function r(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t}function i(e){var t={};t.objectId=e.getAttribute("objectid");var r=e.getAttribute("transform");return r&&(t.transform=a(r)),t}function a(e){var t=[];e.split(" ").forEach(function(e){t.push(parseFloat(e))});var r=new THREE.Matrix4;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function o(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var n=e.getAttribute("pid");n&&(t.pid=n);var a=e.getAttribute("pindex");a&&(t.pindex=a);var o=e.getAttribute("thumbnail");o&&(t.thumbnail=o);var s=e.getAttribute("partnumber");s&&(t.partnumber=s);var l=e.getAttribute("name");l&&(t.name=l);var u=e.querySelector("mesh");u&&(t.mesh=function(e){for(var t={},r=[],n=e.querySelectorAll("vertices vertex"),i=0;i<n.length;i++){var a=n[i],o=a.getAttribute("x"),s=a.getAttribute("y"),l=a.getAttribute("z");r.push(parseFloat(o),parseFloat(s),parseFloat(l))}for(t.vertices=new Float32Array(r.length),i=0;i<r.length;i++)t.vertices[i]=r[i];var u=[],c=[],h=e.querySelectorAll("triangles triangle");for(i=0;i<h.length;i++){var d=h[i],f=d.getAttribute("v1"),p=d.getAttribute("v2"),m=d.getAttribute("v3"),v=d.getAttribute("p1"),g=d.getAttribute("p2"),y=d.getAttribute("p3"),_=d.getAttribute("pid");c.push(parseInt(f,10),parseInt(p,10),parseInt(m,10));var b={};v&&(b.p1=parseInt(v,10)),g&&(b.p2=parseInt(g,10)),y&&(b.p3=parseInt(y,10)),_&&(b.pid=_),0<Object.keys(b).length&&u.push(b)}for(t.triangleProperties=u,t.triangles=new Uint32Array(c.length),i=0;i<c.length;i++)t.triangles[i]=c[i];return t}(u));var c=e.querySelector("components");return c&&(t.components=function(e){for(var t=[],r=e.querySelectorAll("component"),n=0;n<r.length;n++){var a=i(r[n]);t.push(a)}return t}(c)),t}function s(e){var t={},n=e.querySelector("basematerials");n&&(t.basematerials=function(e){for(var t={id:e.getAttribute("id"),basematerials:[]},n=e.querySelectorAll("base"),i=0;i<n.length;i++){var a=r(n[i]);t.basematerials.push(a)}return t}(n)),t.object={};for(var i=e.querySelectorAll("object"),a=0;a<i.length;a++){var s=o(i[a]);t.object[s.id]=s}return t}function l(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=n.textContent)}return t}(r));var n=e.querySelector("resources");n&&(t.resources=s(n));var i=e.querySelector("build");return i&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),n=0;n<r.length;n++){var i=r[n],o={objectId:i.getAttribute("objectid")},s=i.getAttribute("transform");s&&(o.transform=a(s)),t.push(o)}return t}(i)),t}function u(e,t,r,n){var i=new THREE.BufferGeometry;i.setIndex(new THREE.BufferAttribute(e.triangles,1)),i.addAttribute("position",new THREE.BufferAttribute(e.vertices,3));for(var a,o=r.resources.basematerials,s=e.triangleProperties,l=0,u=0,d=-1,f=0,p=s.length;f<p;f++){var m=s[f],v=m.pid;o&&o.id===v&&(-1===d&&(d=m.p1),d===m.p1?u+=3:(i.addGroup(l,u,d),l+=u,u=3,d=m.p1))}if(i.groups.length>0&&function(e){for(var t=e.groups.sort(function(e,t){return e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start}),r=e.index,n=r.itemSize,i=r.array,a=0,o=new i.constructor(i.length),s=0;s<t.length;s++){var l=t[s],u=l.count*n,c=l.start*n,h=i.subarray(c,c+u);o.set(h,a),a+=u}i.set(o);var d=0;for(s=0;s<t.length;s++)(l=t[s]).start=d,d+=l.count;var f=t[0];for(e.groups=[f],s=1;s<t.length;s++)l=t[s],f.materialIndex===l.materialIndex?f.count+=l.count:(f=l,e.groups.push(f))}(i),i.computeBoundingSphere(),o&&o.id===n.pid){var g=n.pindex;a=c(b=o.basematerials[g],t,r,n,h)}if(i.groups.length>0){var y=i.groups;a=[];for(f=0,p=y.length;f<p;f++){var _=y[f],b=o.basematerials[_.materialIndex];a.push(c(b,t,r,n,h))}}return void 0===a&&(a=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0})),new THREE.Mesh(i,a)}function c(e,t,r,n,i){return void 0!==e.build?e.build:(e.build=i(e,t,r,n),e.build)}function h(e){var t=new THREE.MeshPhongMaterial({flatShading:!0});t.name=e.name;var r=e.displaycolor,n=r.substring(0,7);return t.color.setStyle(n),t.color.convertSRGBToLinear(),9===r.length&&(t.opacity=parseInt(r.charAt(7)+r.charAt(8),16)/255),t}function d(e,t,r){for(var n=new THREE.Group,i=0;i<e.length;i++){var a=e[i],o=t[a.objectId];void 0===o&&(f(a.objectId,t,r),o=t[a.objectId]);var s=o.clone(),l=a.transform;l&&s.applyMatrix(l),n.add(s)}return n}function f(e,r,n){var i=n.resources.object[e];if(i.mesh){var a=i.mesh;!function(e,r,n){if(e){for(var i=[],a=Object.keys(e),o=0;o<a.length;o++)for(var s=a[o],l=0;l<t.availableExtensions.length;l++)(u=t.availableExtensions[l]).ns===s&&i.push(u);for(o=0;o<i.length;o++){var u;(u=i[o]).apply(n,e[u.ns],r)}}}(n.extensions,a,n.xml),r[i.id]=c(a,r,n,i,u)}else{var o=i.components;r[i.id]=c(o,r,n,i,d)}}var p=function(e){var t,r,i=null,a=null,o=[],s=[],u=[],c=[],h={},d={};try{i=new n(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: jszip missing and file is compressed."),null}for(a in i.files)a.match(/\_rels\/.rels$/)?t=a:a.match(/^3D\/.*\.model$/)?o.push(a):a.match(/^3D\/Metadata\/.*\.xml$/)?s.push(a):a.match(/^3D\/Textures\/.*/)?u.push(a):a.match(/^3D\/Other\/.*/)&&c.push(a);var f=new Uint8Array(i.file(t).asArrayBuffer());r=function(e){var t=(new DOMParser).parseFromString(e,"application/xml").querySelector("Relationship"),r=t.getAttribute("Target"),n=t.getAttribute("Id"),i=t.getAttribute("Type");return{target:r,id:n,type:i}}(THREE.LoaderUtils.decodeText(f));for(var p=0;p<o.length;p++){var m=o[p],v=new Uint8Array(i.file(m).asArrayBuffer()),g=THREE.LoaderUtils.decodeText(v),y=(new DOMParser).parseFromString(g,"application/xml");"model"!==y.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",m);var _=y.querySelector("model"),b={};for(p=0;p<_.attributes.length;p++){var E=_.attributes[p];E.name.match(/^xmlns:(.+)$/)&&(b[E.value]=RegExp.$1)}var w=l(_);w.xml=_,0<Object.keys(b).length&&(w.extensions=b),h[m]=w}for(p=0;p<u.length;p++){var x=u[p];d[x]=i.file(x).asBinary()}return{rels:r,model:h,printTicket:{},texture:d,other:{}}}(e);return function(e,t,r){var n=new THREE.Group,i=t.target.substring(1);void 0===r.model[i]&&(i="3D/3dmodel.model");for(var a=r.model[i].build,o=0;o<a.length;o++){var s=a[o],l=e[s.objectId],u=s.transform;u&&l.applyMatrix(u),n.add(l)}return n}(function(e){for(var t=e.model,r={},n=Object.keys(t),i=0;i<n.length;i++)for(var a=t[n[i]],o=Object.keys(a.resources.object),s=0;s<o.length;s++)f(o[s],r,a);return r}(p),p.rels,p)},addExtension:function(e){this.availableExtensions.push(e)}},THREE.ThreeMFLoader.MaterialsAndPropertiesExtension={ns:"http://schemas.microsoft.com/3dmanufacturing/material/2015/02",apply:function(e,t,r){for(var n=e.querySelectorAll("colorgroup"),i=0;i<n.length;i++){var a=n[i];if(a.prefix===t){for(var o=a.getAttribute("id"),s=a.querySelectorAll("color"),l=[],u=0;u<s.length;u++){var c=s[u].getAttribute("color");c.match(/#[0-9a-fA-F]{8}/)?l.push(new THREE.Color(c.substring(0,7))):l.push(new THREE.Color(c))}for(var h=[],d=0;d<r.triangleProperties.length;d++){var f=r.triangleProperties[d];if(f.pid===o){var p=l[f.p1],m=l[f.p2||f.p1],v=l[f.p3||f.p1];h.push(p.r,p.g,p.b),h.push(m.r,m.g,m.b),h.push(v.r,v.g,v.b)}}r.colors=new Float32Array(h.length);for(var g=0;g<h.length;g++)r.colors[g]=h[g]}}}}},function(e,t,r){"use strict";r.r(t);var n=r(2),i=r.n(n);THREE.VRMLLoader=function(){if(void 0===i.a)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function t(e){this.lexer=new i.a.Lexer(e)}function r(e){i.a.Parser.call(this,e);var t=this,r=e.Version,n=e.LCurly,a=e.RCurly,o=e.LSquare,s=e.RSquare,l=e.Identifier,u=e.RouteIdentifier,c=e.StringLiteral,h=e.NumberLiteral,d=e.TrueLiteral,f=e.FalseLiteral,p=e.NullLiteral,m=e.DEF,v=e.USE,g=e.ROUTE,y=e.TO,_=e.NodeName;t.RULE("vrml",function(){t.SUBRULE(t.version),t.AT_LEAST_ONE(function(){t.SUBRULE(t.node)}),t.MANY(function(){t.SUBRULE(t.route)})}),t.RULE("version",function(){t.CONSUME(r)}),t.RULE("node",function(){t.OPTION(function(){t.SUBRULE(t.def)}),t.CONSUME(_),t.CONSUME(n),t.MANY(function(){t.SUBRULE(t.field)}),t.CONSUME(a)}),t.RULE("field",function(){t.CONSUME(l),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])}),t.RULE("def",function(){t.CONSUME(m),t.CONSUME(l)}),t.RULE("use",function(){t.CONSUME(v),t.CONSUME(l)}),t.RULE("singleFieldValue",function(){t.AT_LEAST_ONE(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(f)}},{ALT:function(){t.CONSUME(p)}}])})}),t.RULE("multiFieldValue",function(){t.CONSUME(o),t.MANY(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(p)}}])}),t.CONSUME(s)}),t.RULE("route",function(){t.CONSUME(g),t.CONSUME(u),t.CONSUME(y),t.CONSUME2(u)}),this.performSelfAnalysis()}function n(e,t,r){this.a=e,this.b=t,this.c=r,this.normal=new THREE.Vector3}return e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,a){var o={};function s(e){e.DEF&&(o[e.DEF]=e);for(var t=e.fields,r=0,n=t.length;r<n;r++){var i=t[r];if("node"===i.type)for(var a=i.values,l=0,u=a.length;l<u;l++)s(a[l])}}function l(e){return e.USE?(t=e.USE,(r=l(o[t])).isObject3D||r.isMaterial?r.clone():r):void 0!==e.build?e.build:(e.build=function(e){var t,r=e.name;switch(r){case"Group":case"Transform":t=function(e){for(var t=new THREE.Group,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":break;case"children":u(s,t);break;case"rotation":var l=new THREE.Vector3(s[0],s[1],s[2]),c=s[3];t.quaternion.setFromAxisAngle(l,c);break;case"scale":t.scale.set(s[0],s[1],s[2]);break;case"scaleOrientation":break;case"translation":t.position.set(s[0],s[1],s[2]);break;case"bboxCenter":case"bboxSize":break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"Background":t=function(e){for(var t,r,n,i,a=new THREE.Group,o=e.fields,s=0,l=o.length;s<l;s++){var u=o[s],c=u.name,h=u.values;switch(c){case"groundAngle":t=h;break;case"groundColor":r=h;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":n=h;break;case"skyColor":i=h;break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(i){var d=1e4,f=new THREE.SphereBufferGeometry(d,32,16),p=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,depthWrite:!1,depthTest:!1});i.length>3?(k(f,d,n,A(i),!0),p.vertexColors=THREE.VertexColors):p.color.setRGB(i[0],i[1],i[2]);var m=new THREE.Mesh(f,p);a.add(m)}if(r&&r.length>0){var v=new THREE.SphereBufferGeometry(d,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),g=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,vertexColors:THREE.VertexColors,depthWrite:!1,depthTest:!1});k(v,d,t,A(r),!1);var y=new THREE.Mesh(v,g);a.add(y)}return a.renderOrder=-1/0,a}(e);break;case"Shape":t=function(e){for(var t,r,n=e.fields,i=new THREE.MeshBasicMaterial({color:0}),a=0,o=n.length;a<o;a++){var s=n[a],u=s.name,c=s.values;switch(u){case"appearance":null!==c[0]&&(i=l(c[0]));break;case"geometry":null!==c[0]&&(t=l(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}if(t&&t.attributes.position){var h=t._type;if("points"===h){var d=new THREE.PointsMaterial({color:16777215});void 0!==t.attributes.color?d.vertexColors=THREE.VertexColors:i.isMeshPhongMaterial&&d.color.copy(i.emissive),r=new THREE.Points(t,d)}else if("line"===h){var f=new THREE.LineBasicMaterial({color:16777215});void 0!==t.attributes.color?f.vertexColors=THREE.VertexColors:i.isMeshPhongMaterial&&f.color.copy(i.emissive),r=new THREE.LineSegments(t,f)}else void 0!==t._solid&&(i.side=t._solid?THREE.FrontSide:THREE.DoubleSide),void 0!==t.attributes.color&&(i.vertexColors=THREE.VertexColors),r=new THREE.Mesh(t,i)}else(r=new THREE.Object3D).visible=!1;return r}(e);break;case"Appearance":t=function(e){for(var t,r=new THREE.MeshPhongMaterial,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,u=o.values;switch(s){case"material":if(null!==u[0]){var c=l(u[0]);c.diffuseColor&&r.color.copy(c.diffuseColor),c.emissiveColor&&r.emissive.copy(c.emissiveColor),c.shininess&&(r.shininess=c.shininess),c.specularColor&&r.specular.copy(c.specularColor),c.transparency&&(r.opacity=1-c.transparency),c.transparency>0&&(r.transparent=!0)}else r=new THREE.MeshBasicMaterial({color:0});break;case"texture":var h=u[0];null!==h&&"ImageTexture"===h.name&&(r.map=l(h));break;case"textureTransform":null!==u[0]&&(t=l(u[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}r.map&&t&&(r.map.center.copy(t.center),r.map.rotation=t.rotation,r.map.repeat.copy(t.scale),r.map.offset.copy(t.translation));return r}(e);break;case"Material":t=function(e){for(var t={},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new THREE.Color(s[0],s[1],s[2]);break;case"emissiveColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"shininess":t.shininess=s[0];break;case"specularColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"transparency":t.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"ImageTexture":t=function(e){for(var t,r=THREE.RepeatWrapping,n=THREE.RepeatWrapping,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,u=s.values;switch(l){case"url":var c=u[0];c&&(t=P.load(c));break;case"repeatS":!1===u[0]&&(r=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===u[0]&&(n=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"TextureTransform":t=function(e){for(var t={center:new THREE.Vector2,rotation:new THREE.Vector2,scale:new THREE.Vector2,translation:new THREE.Vector2},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":t.center.set(s[0],s[1]);break;case"rotation":t.rotation=s[0];break;case"scale":t.scale.set(s[0],s[1]);break;case"translation":t.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"IndexedFaceSet":t=function(e){for(var t,r,i,a,o,s,u,f,p,y=!0,_=!0,b=!0,x=!0,A=e.fields,k=0,P=A.length;k<P;k++){var C=A[k],L=C.name,I=C.values;switch(L){case"color":var O=I[0];null!==O&&(t=l(O));break;case"coord":var H=I[0];null!==H&&(r=l(H));break;case"normal":var D=I[0];null!==D&&(i=l(D));break;case"texCoord":var N=I[0];null!==N&&(a=l(N));break;case"ccw":y=I[0];break;case"colorIndex":s=I;break;case"colorPerVertex":b=I[0];break;case"convex":break;case"coordIndex":u=I;break;case"creaseAngle":o=I[0];break;case"normalIndex":f=I;break;case"normalPerVertex":x=I[0];break;case"solid":_=I[0];break;case"texCoordIndex":p=I;break;default:console.warn("THREE.VRMLLoader: Unknown field:",L)}}if(void 0===u)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new THREE.BufferGeometry;var F,U,B,z,j=c(u,y);if(t)if(!0===b)if(s&&s.length>0){var V=c(s,y);U=E(j,V,t,3)}else U=T(j,new THREE.Float32BufferAttribute(t,3));else if(s&&s.length>0){var G=d(t,s),W=h(G,u);U=w(j,W)}else{var W=h(t,u);U=w(j,W)}if(i)if(!0===x)if(f&&f.length>0){var X=c(f,y);B=E(j,X,i,3)}else B=T(j,new THREE.Float32BufferAttribute(i,3));else if(f&&f.length>0){var Y=d(i,f),q=h(Y,u);B=w(j,q)}else{var q=h(i,u);B=w(j,q)}else B=function(e,t,r){for(var i=[],a={},o=0,s=e.length;o<s;o+=3){var l=e[o],u=e[o+1],c=e[o+2],h=new n(l,u,c);m.fromArray(t,3*l),v.fromArray(t,3*u),g.fromArray(t,3*c),M.subVectors(g,v),S.subVectors(m,v),M.cross(S),M.normalize(),h.normal.copy(M),void 0===a[l]&&(a[l]=[]),void 0===a[u]&&(a[u]=[]),void 0===a[c]&&(a[c]=[]),a[l].push(h.normal),a[u].push(h.normal),a[c].push(h.normal),i.push(h)}for(var d=[],o=0,s=i.length;o<s;o++){var h=i[o],f=R(a[h.a],h.normal,r),p=R(a[h.b],h.normal,r),y=R(a[h.c],h.normal,r);m.fromArray(t,3*h.a),v.fromArray(t,3*h.b),g.fromArray(t,3*h.c),d.push(f.x,f.y,f.z),d.push(p.x,p.y,p.z),d.push(y.x,y.y,y.z)}return new THREE.Float32BufferAttribute(d,3)}(j,r,o);if(a)if(p&&p.length>0){var Z=c(p,y);z=E(j,Z,a,2)}else z=T(j,new THREE.Float32BufferAttribute(a,2));var J=new THREE.BufferGeometry;F=T(j,new THREE.Float32BufferAttribute(r,3)),J.addAttribute("position",F),J.addAttribute("normal",B),U&&J.addAttribute("color",U);z&&J.addAttribute("uv",z);return J._solid=_,J._type="mesh",J}(e);break;case"IndexedLineSet":t=function(e){for(var t,r,n,i,a,o=!0,s=e.fields,u=0,c=s.length;u<c;u++){var h=s[u],m=h.name,v=h.values;switch(m){case"color":var g=v[0];null!==g&&(t=l(g));break;case"coord":var y=v[0];null!==y&&(r=l(y));break;case"colorIndex":n=v;break;case"colorPerVertex":o=v[0];break;case"coordIndex":i=v;break;default:console.warn("THREE.VRMLLoader: Unknown field:",m)}}var _=f(i);if(t)if(!0===o)if(n.length>0){var b=f(n);a=E(_,b,t,3)}else a=T(_,new THREE.Float32BufferAttribute(t,3));else if(n.length>0){var w=d(t,n),S=p(w,i);a=x(_,S)}else{var S=p(t,i);a=x(_,S)}var M=new THREE.BufferGeometry,R=T(_,new THREE.Float32BufferAttribute(r,3));M.addAttribute("position",R),a&&M.addAttribute("color",a);return M._type="line",M}(e);break;case"PointSet":t=function(e){for(var t,r,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,u=o.values;switch(s){case"color":var c=u[0];null!==c&&(t=l(c));break;case"coord":var h=u[0];null!==h&&(r=l(h));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}var d;(d=new THREE.BufferGeometry).addAttribute("position",new THREE.Float32BufferAttribute(r,3)),t&&d.addAttribute("color",new THREE.Float32BufferAttribute(t,3));return d._type="points",d}(e);break;case"Box":t=function(e){for(var t=new THREE.Vector3(2,2,2),r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"size":t.x=s[0],t.y=s[1],t.z=s[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.BoxBufferGeometry(t.x,t.y,t.z)}(e);break;case"Cone":t=function(e){for(var t=1,r=2,n=!1,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,u=s.values;switch(l){case"bottom":n=!u[0];break;case"bottomRadius":t=u[0];break;case"height":r=u[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return new THREE.ConeBufferGeometry(t,r,16,1,n)}(e);break;case"Cylinder":t=function(e){for(var t=1,r=2,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,l=o.values;switch(s){case"bottom":break;case"radius":t=l[0];break;case"height":r=l[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new THREE.CylinderBufferGeometry(t,t,r,16,1)}(e);break;case"Sphere":t=function(e){for(var t=1,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"radius":t=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.SphereBufferGeometry(t,16,16)}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":t=function(e){return e.fields[0].values}(e);break;case"Anchor":case"Billboard":case"Collision":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"WorldInfo":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"ElevationGrid":case"Extrusion":case"Text":case"FontStyle":case"MovieTexture":case"PixelTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",r)}return t}(e),e.build);var t,r}function u(e,t){for(var r=0,n=e.length;r<n;r++){var i=l(e[r]);i instanceof THREE.Object3D&&t.add(i)}}function c(e,t){for(var r=[],n=0,i=0,a=e.length;i<a;i++){var o=e[n],s=e[i+(t?1:2)],l=e[i+(t?2:1)];r.push(o,s,l),(-1===e[i+3]||i+3>=a)&&(n=(i+=3)+1)}return r}function h(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],u=e[o+2];r.push(s,l,u),(-1===t[i+3]||i+3>=a)&&(i+=3,n++)}return r}function d(e,t){for(var r=[],n=0,i=t.length;n<i;n++){var a=3*t[n],o=e[a],s=e[a+1],l=e[a+2];r.push(o,s,l)}return r}function f(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=e[r+1];t.push(i,a),(-1===e[r+2]||r+2>=n)&&(r+=2)}return t}function p(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],u=e[o+2];r.push(s,l,u),(-1===t[i+2]||i+2>=a)&&(i+=2,n++)}return r}var m=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector2,_=new THREE.Vector2,b=new THREE.Vector2;function E(e,t,r,n){for(var i=[],a=0,o=e.length;a<o;a+=3){var s=t[a],l=t[a+1],u=t[a+2];2===n?(y.fromArray(r,s*n),_.fromArray(r,l*n),b.fromArray(r,u*n),i.push(y.x,y.y),i.push(_.x,_.y),i.push(b.x,b.y)):(m.fromArray(r,s*n),v.fromArray(r,l*n),g.fromArray(r,u*n),i.push(m.x,m.y,m.z),i.push(v.x,v.y,v.z),i.push(g.x,g.y,g.z))}return new THREE.Float32BufferAttribute(i,n)}function w(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=3,i++)m.fromArray(t,3*i),r.push(m.x,m.y,m.z),r.push(m.x,m.y,m.z),r.push(m.x,m.y,m.z);return new THREE.Float32BufferAttribute(r,3)}function x(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=2,i++)m.fromArray(t,3*i),r.push(m.x,m.y,m.z),r.push(m.x,m.y,m.z);return new THREE.Float32BufferAttribute(r,3)}function T(e,t){for(var r=t.array,n=t.itemSize,i=new r.constructor(e.length*n),a=0,o=0,s=0,l=e.length;s<l;s++){a=e[s]*n;for(var u=0;u<n;u++)i[o++]=r[a++]}return new THREE.Float32BufferAttribute(i,n)}var S=new THREE.Vector3,M=new THREE.Vector3;function R(e,t,r){for(var n=t.clone(),i=0,a=e.length;i<a;i++)e[i].angleTo(t)<r&&n.add(e[i]);return n.normalize()}function A(e){for(var t=[],r=0,n=e.length;r<n;r+=3)t.push(new THREE.Color(e[r],e[r+1],e[r+2]));return t}function k(e,t,r,n,i){for(var a=!0===i?1:-1,o=[],s={},l={},u=0;u<r.length;u++){var c={x:a*(Math.cos(r[u])*t),y:a*(Math.sin(r[u])*t)};o.push(c)}for(var h=e.index,d=e.attributes.position,f=new THREE.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),p=new THREE.Vector3,m=new THREE.Color,v=0;v<h.count;v++){var g=h.getX(v);p.fromBufferAttribute(d,g);for(var y=0;y<n.length;y++)if(0===y?(s.x=0,s.y=!0===i?t:-1*t):(s.x=o[y-1].x,s.y=o[y-1].y),void 0!==(l=o[y]))if(!0===(!0===i?p.y<=s.y&&p.y>l.y:p.y>=s.y&&p.y<l.y)){var _=n[y],b=n[y+1],E=Math.abs(p.y-s.y)/(s.y-l.y);m.copy(_).lerp(b,E),f.setXYZ(g,m.r,m.g,m.b)}else{var w=n[!0===i?n.length-1:0];f.setXYZ(g,w.r,w.g,w.b)}}e.addAttribute("color",f)}var P=new THREE.TextureLoader(this.manager);P.setPath(this.resourcePath||a).setCrossOrigin(this.crossOrigin);var C=function(e){var n=function(){for(var e=i.a.createToken,t=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),r=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:t}),n=e({name:"Version",pattern:/#VRML.*/,longer_alt:r}),a=e({name:"NodeName",pattern:new RegExp(["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"].join("|")),longer_alt:r}),o=e({name:"DEF",pattern:/DEF/,longer_alt:r}),s=e({name:"USE",pattern:/USE/,longer_alt:r}),l=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:r}),u=e({name:"TO",pattern:/TO/,longer_alt:r}),c=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/}),h=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),d=e({name:"TrueLiteral",pattern:/TRUE/}),f=e({name:"FalseLiteral",pattern:/FALSE/}),p=e({name:"NullLiteral",pattern:/NULL/}),m=e({name:"LSquare",pattern:/\[/}),v=e({name:"RSquare",pattern:/]/}),g=e({name:"LCurly",pattern:/{/}),y=e({name:"RCurly",pattern:/}/}),_=e({name:"Comment",pattern:/#.*/,group:i.a.Lexer.SKIPPED}),b=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:i.a.Lexer.SKIPPED}),a,o,s,l,u,d,f,p,n,r,t,c,h,m,v,g,y,_],E={},w=0,x=b.length;w<x;w++){var T=b[w];E[T.name]=T}return{tokens:b,tokenVocabulary:E}}(),a=new t(n.tokens),o=new r(n.tokenVocabulary),s=function(e){function t(){e.call(this),this.validateVisitor()}function r(e,t){var r={type:null,values:[]};if(t.node){r.type="node";for(var n=0,i=t.node.length;n<i;n++){var a=t.node[n];r.values.push(e.visit(a))}}if(t.use){r.type="use";for(var n=0,i=t.use.length;n<i;n++){var o=t.use[n];r.values.push(e.visit(o))}}if(t.StringLiteral){r.type="string";for(var n=0,i=t.StringLiteral.length;n<i;n++){var s=t.StringLiteral[n];r.values.push(s.image.replace(/'|"/g,""))}}if(t.NumberLiteral){r.type="number";for(var n=0,i=t.NumberLiteral.length;n<i;n++){var l=t.NumberLiteral[n];r.values.push(parseFloat(l.image))}}if(t.TrueLiteral){r.type="boolean";for(var n=0,i=t.TrueLiteral.length;n<i;n++){var u=t.TrueLiteral[n];"TRUE"===u.image&&r.values.push(!0)}}if(t.FalseLiteral){r.type="boolean";for(var n=0,i=t.FalseLiteral.length;n<i;n++){var c=t.FalseLiteral[n];"FALSE"===c.image&&r.values.push(!1)}}return t.NullLiteral&&(r.type="null",t.NullLiteral.forEach(function(){r.values.push(null)})),r}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){for(var t={version:this.visit(e.version),nodes:[],routes:[]},r=0,n=e.node.length;r<n;r++){var i=e.node[r];t.nodes.push(this.visit(i))}if(e.route)for(r=0,n=e.route.length;r<n;r++){var a=e.route[r];t.routes.push(this.visit(a))}return t},version:function(e){return e.Version[0].image},node:function(e){var t={name:e.NodeName[0].image,fields:[]};if(e.field)for(var r=0,n=e.field.length;r<n;r++){var i=e.field[r];t.fields.push(this.visit(i))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){var t,r={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(t=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(t=this.visit(e.multiFieldValue[0])),r.type=t.type,r.values=t.values,r},def:function(e){return e.Identifier[0].image},use:function(e){return{USE:e.Identifier[0].image}},singleFieldValue:function(e){return r(this,e)},multiFieldValue:function(e){return r(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(o.getBaseCstVisitorConstructor()),l=a.lex(e);o.input=l.tokens;var u=o.vrml();if(o.errors.length>0)throw console.error(o.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return s.visit(u)}(e);if(-1===C.version.indexOf("V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){for(var t=e.nodes,r=new THREE.Scene,n=0,i=t.length;n<i;n++)s(t[n]);for(n=0,i=t.length;n<i;n++){var a=l(t[n]);a instanceof THREE.Object3D&&r.add(a)}return r}(C)}},t.prototype={constructor:t,lex:function(e){var t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}},r.prototype=Object.create(i.a.Parser.prototype),r.prototype.constructor=r,e}()},function(e,t,r){"use strict";r.r(t);var n=r(18);THREE.FBXLoader=function(){var e,t,r;function i(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function a(e){this.textureLoader=e}function o(){}function s(){}function l(){}function u(){}function c(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function d(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}i.prototype={constructor:i,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.load(e,function(r){try{t(i.parse(r,a))}catch(t){setTimeout(function(){n&&n(t),i.manager.itemError(e)},0)}},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,r){if(o="Kaydara FBX Binary  \0",(i=t).byteLength>=o.length&&o===E(i,0,o.length))e=(new u).parse(t);else{var n=E(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(t){var n=e[t-1];return e=e.slice(r+t),r++,n}for(var i=0;i<t.length;++i){var a=n(1);if(a===t[i])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(d(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(n));e=(new l).parse(n)}var i,o;return new a(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin)).parse(e)}},a.prototype={constructor:a,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),i=this.parseMaterials(n),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,i),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach(function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).parents.push(a),t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).children.push(o)});return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var a=n[i];if(t[u=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(o||s){var l=this.parseImage(n[i]);r[a.RelativeFilename||a.Filename]=l}}}}for(var u in t){var c=t[u];void 0!==r[c]?t[u]=r[c]:t[u]=t[u].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");if(null===THREE.Loader.Handlers.get(".tga")){var a=new THREE.TGALoader;a.setPath(this.textureLoader.path),THREE.Loader.Handlers.add(/\.tga$/i,a)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var o=new Uint8Array(r);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var i in n){var a=this.parseTexture(n[i],t);r.set(parseInt(i),a)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,i=e.WrapModeV,a=void 0!==n?n.value:0,o=void 0!==i?i.value:0;if(r.wrapS=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.wrapT=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;r.repeat.x=s[0],r.repeat.y=s[1]}return r},loadTexture:function(e,r){var n,i,a=this.textureLoader.path,o=t.get(e.id).children;void 0!==o&&o.length>0&&void 0!==r[o[0].ID]&&(0!==(n=r[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=THREE.Loader.Handlers.get(".tga");null===l?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),i=new THREE.Texture):i=l.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),i=new THREE.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(a),i},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var a=this.parseMaterial(n[i],t);null!==a&&r.set(parseInt(i),a)}}return r},parseMaterial:function(e,r){var n=e.id,i=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!t.has(n))return null;var o,s=this.parseParameters(e,r,n);switch(a.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new THREE.MeshPhongMaterial}return o.setValues(s),o.name=i,o},parseParameters:function(e,r,n){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var a=this;return t.get(n).children.forEach(function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=a.getTexture(r,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(r,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(r,e.ID);break;case"DisplacementColor":i.displacementMap=a.getTexture(r,e.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(r,e.ID);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(r,e.ID);break;case"ReflectionColor":i.envMap=a.getTexture(r,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":i.specularMap=a.getTexture(r,e.ID);break;case"TransparentColor":i.alphaMap=a.getTexture(r,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}}),i},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var l=this.parseSkeleton(s,i);l.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,r[a]=l}else if("BlendShape"===o.attrType){var u={id:a};u.rawTargets=this.parseMorphTargets(s,i),u.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[a]=u}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach(function(e){var n=t[e.ID];if("Cluster"===n.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}}),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var a=e.children[i],o=r[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(s)}return n},parseScene:function(n,i,a){r=new THREE.Group;var o=this.parseModels(n.skeletons,i,a),l=e.Objects.Model,u=this;o.forEach(function(e){var n=l[e.ID];u.setLookAtProperties(e,n),t.get(e.ID).parents.forEach(function(t){var r=o.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&r.add(e)}),this.bindSkeleton(n.skeletons,i,o),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=y(e.userData.transformData);e.applyMatrix(t)}});var c=(new s).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=c,r=r.children[0]),r.animations=c},parseModels:function(r,n,i){var a=new Map,o=e.Objects.Model;for(var s in o){var l=parseInt(s),u=o[s],c=t.get(l),h=this.buildSkeleton(c,r,l,u.attrName);if(!h){switch(u.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,n,i);break;case"NurbsCurve":h=this.createCurve(c,n);break;case"LimbNode":case"Root":h=new THREE.Bone;break;case"Null":default:h=new THREE.Group}h.name=THREE.PropertyBinding.sanitizeNodeName(u.attrName),h.ID=l}this.getTransformData(h,u),a.set(l,h)}return a},buildSkeleton:function(e,t,r,n){var i=null;return e.parents.forEach(function(e){for(var a in t){var o=t[a];o.rawBones.forEach(function(t,a){if(t.ID===e.ID){var s=i;(i=new THREE.Bone).matrixWorld.copy(t.transformLink),i.name=THREE.PropertyBinding.sanitizeNodeName(n),i.ID=r,o.bones[a]=i,null!==s&&i.add(s)}})}}),i},createCamera:function(t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new THREE.Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var u=s/l,c=45;void 0!==n.FieldOfView&&(c=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new THREE.PerspectiveCamera(c,u,a,o),null!==h&&r.setFocalLength(h);break;case 1:r=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),r=new THREE.Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new THREE.Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new THREE.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(i){case 0:r=new THREE.PointLight(a,o,s,1);break;case 1:r=new THREE.DirectionalLight(a,o);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.Math.degToRad(n.InnerAngle.value));var u=0;void 0!==n.OuterAngle&&(u=THREE.Math.degToRad(n.OuterAngle.value),u=Math.max(u,1)),r=new THREE.SpotLight(a,o,s,l,u,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),r=new THREE.PointLight(a,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,i=null,a=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(i=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach(function(e){e.vertexColors=THREE.VertexColors}),i.FBX_Deformer?(o.forEach(function(e){e.skinning=!0}),(n=new THREE.SkinnedMesh(i,a)).normalizeSkinWeights()):n=new THREE.Mesh(i,a),n},createCurve:function(e,t){var r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(r,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?_(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,i){"LookAtProperty"in i&&t.get(n.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var a=i.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(a),r.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(a))}}})},bindSkeleton:function(e,r,n){var i=this.parsePoseNodes();for(var a in e){var o=e[a];t.get(parseInt(o.ID)).parents.forEach(function(e){if(r.has(e.ID)){var a=e.ID;t.get(a).parents.forEach(function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])})}})}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach(function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)}):t[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],i=t[1],a=t[2];if(0!==n||0!==i||0!==a){var o=new THREE.Color(n,i,a);r.add(new THREE.AmbientLight(o,1))}}},setupMorphMaterials:function(){var e=this;r.traverse(function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach(function(r,n){e.setupMorphMaterial(t,r,n)}):e.setupMorphMaterial(t,t.material))})},setupMorphMaterial:function(e,t,n){var i=e.uuid,a=t.uuid,o=!1;if(r.traverse(function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach(function(t){t.uuid===a&&e.uuid!==i&&(o=!0)}):e.material.uuid===a&&e.uuid!==i&&(o=!0))}),!0===o){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=this.parseGeometry(o,i[a],r);n.set(parseInt(a),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var i=n.skeletons,a=n.morphTargets,o=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0!==o.length){var s=t.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null),l=t.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null),u=o[0],c={};"RotationOrder"in u&&(c.eulerOrder=_(u.RotationOrder.value)),"InheritType"in u&&(c.inheritType=parseInt(u.InheritType.value)),"GeometricTranslation"in u&&(c.translation=u.GeometricTranslation.value),"GeometricRotation"in u&&(c.rotation=u.GeometricRotation.value),"GeometricScaling"in u&&(c.scale=u.GeometricScaling.value);var h=y(c);return this.genGeometry(r,s,l,h)}},genGeometry:function(e,t,r,n){var i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new THREE.Float32BufferAttribute(o.vertex,3);if(n.applyToBufferAttribute(s),i.addAttribute("position",s),o.colors.length>0&&i.addAttribute("color",new THREE.Float32BufferAttribute(o.colors,3)),t&&(i.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(o.weightsIndices,4)),i.addAttribute("skinWeight",new THREE.Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){var l=new THREE.Float32BufferAttribute(o.normal,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(l),i.addAttribute("normal",l)}if(o.uvs.forEach(function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),i.addAttribute(r,new THREE.Float32BufferAttribute(o.uvs[t],2))}),a.material&&"AllSame"!==a.material.mappingType){var u=o.materialIndex[0],c=0;if(o.materialIndex.forEach(function(e,t){e!==u&&(i.addGroup(c,t-c,u),u=e,c=t)}),i.groups.length>0){var h=i.groups[i.groups.length-1],d=h.start+h.count;d!==o.materialIndex.length&&i.addGroup(d,o.materialIndex.length-d,u)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,r,n),i},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})})})),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,a=[],o=[],s=[],l=[],u=[],c=[],h=this;return e.vertexIndices.forEach(function(d,f){var p=!1;d<0&&(d^=-1,p=!0);var v=[],g=[];if(a.push(3*d,3*d+1,3*d+2),e.color){var y=m(f,r,d,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach(function(e){g.push(e.weight),v.push(e.id)}),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var _=[0,0,0,0],b=[0,0,0,0];g.forEach(function(e,t){var r=e,n=v[t];b.forEach(function(e,t,i){if(r>e){i[t]=r,r=e;var a=_[t];_[t]=n,n=a}})}),v=_,g=b}for(;g.length<4;)g.push(0),v.push(0);for(var E=0;E<4;++E)u.push(g[E]),c.push(v[E])}if(e.normal){y=m(f,r,d,e.normal);o.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var w=m(f,r,d,e.material)[0];e.uv&&e.uv.forEach(function(e,t){var n=m(f,r,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])}),n++,p&&(h.genFace(t,e,a,w,o,s,l,u,c,n),r++,n=0,a=[],o=[],s=[],l=[],u=[],c=[])}),t},genFace:function(e,t,r,n,i,a,o,s,l,u){for(var c=2;c<u;c++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(c-1)]]),e.vertex.push(t.vertexPositions[r[3*(c-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(c-1)+2]]),e.vertex.push(t.vertexPositions[r[3*c]]),e.vertex.push(t.vertexPositions[r[3*c+1]]),e.vertex.push(t.vertexPositions[r[3*c+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(c-1)]),e.vertexWeights.push(s[4*(c-1)+1]),e.vertexWeights.push(s[4*(c-1)+2]),e.vertexWeights.push(s[4*(c-1)+3]),e.vertexWeights.push(s[4*c]),e.vertexWeights.push(s[4*c+1]),e.vertexWeights.push(s[4*c+2]),e.vertexWeights.push(s[4*c+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(c-1)]),e.weightsIndices.push(l[4*(c-1)+1]),e.weightsIndices.push(l[4*(c-1)+2]),e.weightsIndices.push(l[4*(c-1)+3]),e.weightsIndices.push(l[4*c]),e.weightsIndices.push(l[4*c+1]),e.weightsIndices.push(l[4*c+2]),e.weightsIndices.push(l[4*c+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(c-1)]),e.colors.push(a[3*(c-1)+1]),e.colors.push(a[3*(c-1)+2]),e.colors.push(a[3*c]),e.colors.push(a[3*c+1]),e.colors.push(a[3*c+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(c-1)]),e.normal.push(i[3*(c-1)+1]),e.normal.push(i[3*(c-1)+2]),e.normal.push(i[3*c]),e.normal.push(i[3*c+1]),e.normal.push(i[3*c+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(c-1)]),e.uvs[r].push(o[r][2*(c-1)+1]),e.uvs[r].push(o[r][2*c]),e.uvs[r].push(o[r][2*c+1])})},addMorphTargets:function(t,r,n,i){if(null!==n){t.morphAttributes.position=[];var a=this;n.rawTargets.forEach(function(n){var o=e.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(t,r,o,i,n.name)})}},genMorphGeometry:function(e,t,r,n,i){var a=new THREE.BufferGeometry;r.attrName&&(a.name=r.attrName);for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],l=void 0!==r.Vertices?r.Vertices.a:[],u=void 0!==r.Indexes?r.Indexes.a:[],c=0;c<u.length;c++){var h=3*u[c];s[h]+=l[3*c],s[h+1]+=l[3*c+1],s[h+2]+=l[3*c+2]}var d={vertexIndices:o,vertexPositions:s},f=this.genBuffers(d),p=new THREE.Float32BufferAttribute(f.vertex,3);p.name=i||r.attrName,n.applyToBufferAttribute(p),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],a=0;a<n.length;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var r,n,i=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,l=0,u=s.length;l<u;l+=4)o.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){r=i,n=a.length-1-r;for(l=0;l<i;++l)o.push(o[l])}var c=new THREE.NURBSCurve(i,a,o,r,n).getPoints(7*o.length),h=new Float32Array(3*c.length);c.forEach(function(e,t){e.toArray(h,3*t)});var d=new THREE.BufferGeometry;return d.addAttribute("position",new THREE.BufferAttribute(h,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var n=t[r],i=this.addClip(n);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};r.set(a.id,a)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var i in n){var a={id:n[i].id,times:n[i].KeyTime.a.map(f),values:n[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?r.get(s).curves.x=a:l.match(/Y/)?r.get(s).curves.y=a:l.match(/Z/)?r.get(s).curves.z=a:l.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=a)}}},parseAnimationLayers:function(n){var i=e.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],l=t.get(parseInt(o));if(void 0!==l)l.children.forEach(function(i,a){if(n.has(i.ID)){var o=n.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a])if(void 0!==(f=t.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID)){var l=e.Objects.Model[f.toString()],u={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse(function(e){e.ID===l.id&&(u.transform=e.matrix,e.userData.transformData&&(u.eulerOrder=e.userData.transformData.eulerOrder))}),u.transform||(u.transform=new THREE.Matrix4),"PreRotation"in l&&(u.preRotation=l.PreRotation.value),"PostRotation"in l&&(u.postRotation=l.PostRotation.value),s[a]=u}s[a]&&(s[a][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===s[a]){var c=t.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,h=t.get(c).parents[0].ID,d=t.get(h).parents[0].ID,f=t.get(d).parents[0].ID;l=e.Objects.Model[f],u={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),morphName:e.Objects.Deformer[c].attrName};s[a]=u}s[a][o.attr]=o}}}),a.set(parseInt(o),s)}return a},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,i={};for(var a in n){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);i[a]={name:n[a].attrName,layer:s}}return i},addClip:function(e){var t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(r,n,i),r=r.toArray(),n=(new THREE.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,r,n){var i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,r);return new THREE.VectorKeyframeTrack(e+"."+n,i,a)},generateRotationTrack:function(e,t,r,n,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.Math.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,r);void 0!==n&&((n=n.map(THREE.Math.degToRad)).push(a),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(THREE.Math.degToRad)).push(a),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).inverse());for(var l=new THREE.Quaternion,u=new THREE.Euler,c=[],h=0;h<s.length;h+=3)u.set(s[h],s[h+1],s[h+2],a),l.setFromEuler(u),void 0!==n&&l.premultiply(n),void 0!==i&&l.multiply(i),l.toArray(c,h/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,c)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),i=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,r){return r.indexOf(e)==t})},getKeyframeTrackValues:function(e,t,r){var n=r,i=[],a=-1,o=-1,s=-1;return e.forEach(function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var r=t.x.values[a];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==o){var l=t.y.values[o];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==s){var u=t.z.values[s];i.push(u),n[2]=u}else i.push(n[2])}),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){for(var a=i/180,o=n/a,s=r+o,l=e.times[t-1],u=(e.times[t]-l)/a,c=l+u,h=[],d=[];c<e.times[t];)h.push(c),c+=u,d.push(s),s+=o;e.times=w(e.times,t,h),e.values=w(e.values,t,d)}}}},l.prototype={constructor:l,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,n){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in o?("PoseNode"===r?o.PoseNode.push(i):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=i)):"number"==typeof a.id?(o[r]={},o[r][a.id]=i):"Properties70"!==r&&(o[r]="PoseNode"===r?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){var o=i.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),u=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[s,l],u=u.map(function(e){return e.trim().replace(/^"/,"")})),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=i),n in a&&Array.isArray(a[n])?a[n].push(i):"a"!==n?a[n]=i:a.a=i,this.setCurrentProp(a,n),"a"===n&&","!==i.slice(-1)&&(a.a=b(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=n[0],a=n[1],o=n[2],s=n[3],l=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},u.prototype={constructor:u,parse:function(e){var t=new c(e);t.skip(23);var r=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var n=new h;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),a=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(a);if(0===n)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,r,d)}return r.propertyList=s,"number"==typeof u&&(r.id=u),""!==c&&(r.attrName=c),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach(function(e,t){0!==t&&i.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach(function(e){t[e]=r[e]})}else if("Properties70"===e&&"P"===r.name){var a,o=r.propertyList[0],s=r.propertyList[1],l=r.propertyList[2],u=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[o]={type:s,type2:l,flag:u,value:a}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}void 0===n.Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new c(new n.Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var p=[];function m(e,t,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var a=i*n.dataSize,o=a+n.dataSize;return function(e,t,r,n){for(var i=r,a=0;i<n;i++,a++)e[a]=t[i];return e}(p,n.buffer,a,o)}var v=new THREE.Euler,g=new THREE.Vector3;function y(e){var t,r=new THREE.Matrix4,n=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,u=new THREE.Matrix4,c=new THREE.Matrix4,h=new THREE.Matrix4,d=new THREE.Matrix4,f=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(g.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(v.fromArray(t)));e.rotation&&((t=e.rotation.map(THREE.Math.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(v.fromArray(t)));e.postRotation&&((t=e.postRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(v.fromArray(t)));e.scale&&o.scale(g.fromArray(e.scale)),e.scalingOffset&&l.setPosition(g.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(g.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(g.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(g.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var p=n.multiply(i).multiply(a),m=new THREE.Matrix4;h.extractRotation(m);var y,_,b,E,w=new THREE.Matrix4;if(w.copyPosition(h),b=w.getInverse(w).multiply(h),_=m.getInverse(m).multiply(b),y=o,0===f)E=m.multiply(p).multiply(_).multiply(y);else if(1===f)E=m.multiply(_).multiply(p).multiply(y);else{var x=(new THREE.Matrix4).copy(o),T=_.multiply(x.getInverse(x));E=m.multiply(p).multiply(T).multiply(y)}var S=r.multiply(u).multiply(c).multiply(n).multiply(i).multiply(a).multiply(c.getInverse(c)).multiply(l).multiply(s).multiply(o).multiply(s.getInverse(s)),M=(new THREE.Matrix4).copyPosition(S),R=h.multiply(M);return d.copyPosition(R),S=d.multiply(E)}function _(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map(function(e){return parseFloat(e)})}function E(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function w(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return i}()},function(e,t,r){"use strict";r.r(t);var n=r(35);THREE.NRRDLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.NRRDLoader.prototype={constructor:THREE.NRRDLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){var t=e,r=0,i=new Int8Array(new Int16Array([1]).buffer)[0]>0,a=!0,o={};var s=function(e,n){null==n&&(n=1);var o=1,s=Uint8Array;switch(e){case"uchar":break;case"schar":s=Int8Array;break;case"ushort":s=Uint16Array,o=2;break;case"sshort":s=Int16Array,o=2;break;case"uint":s=Uint32Array,o=4;break;case"sint":s=Int32Array,o=4;break;case"float":s=Float32Array,o=4;break;case"complex":case"double":s=Float64Array,o=8}var l=new s(t.slice(r,r+=n*o));return i!=a&&(l=function(e,t){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=0;n<e.byteLength;n+=t)for(var i=n+t-1,a=n;i>a;i--,a++){var o=r[a];r[a]=r[i],r[i]=o}return e}(l,o)),1==n?l[0]:l}("uchar",e.byteLength),l=s.length,u=null,c=0;for(f=1;f<l;f++)if(10==s[f-1]&&10==s[f]){u=this.parseChars(s,0,f-2),c=f+1;break}!function(e){var t,r,n,i,a,s,l,u,c;for(u=0,c=(s=e.split(/\r?\n/)).length;u<c;u++)(a=s[u]).match(/NRRD\d+/)?o.isNrrd=!0:a.match(/^#/)||(l=a.match(/(.*):(.*)/))&&(r=l[1].trim(),t=l[2].trim(),(n=THREE.NRRDLoader.prototype.fieldFunctions[r])?n.call(o,t):o[r]=t);if(!o.isNrrd)throw new Error("Not an NRRD file");if("bz2"===o.encoding||"bzip2"===o.encoding)throw new Error("Bzip is not supported");if(!o.vectors&&(o.vectors=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],o.spacings))for(i=0;i<=2;i++)isNaN(o.spacings[i])||o.vectors[i].multiplyScalar(o.spacings[i])}(u);t=s.subarray(c);if("gzip"===o.encoding||"gz"===o.encoding){var h=new n.Zlib.Gunzip(new Uint8Array(t));t=h.decompress()}else if("ascii"===o.encoding||"text"===o.encoding||"txt"===o.encoding||"hex"===o.encoding)t=function(e,t,r){var n,i="";t=t||0,r=r||e.length;var a=o.sizes.reduce(function(e,t){return e*t},1),s=10;"hex"===o.encoding&&(s=16);var l=new o.__array(a),u=0,c=parseInt;o.__array!==Float32Array&&o.__array!==Float64Array||(c=parseFloat);for(var h=t;h<r;h++)((n=e[h])<9||n>13)&&32!==n?i+=String.fromCharCode(n):(""!==i&&(l[u]=c(i,s),u++),i="");return""!==i&&(l[u]=c(i,s),u++),l}(t);else if("raw"===o.encoding){for(var d=new Uint8Array(t.length),f=0;f<t.length;f++)d[f]=t[f];t=d}t=t.buffer;var p=new THREE.Volume;p.header=o,p.data=new o.__array(t);var m=p.computeMinMax(),v=m[0],g=m[1];p.windowLow=v,p.windowHigh=g,p.dimensions=[o.sizes[0],o.sizes[1],o.sizes[2]],p.xLength=p.dimensions[0],p.yLength=p.dimensions[1],p.zLength=p.dimensions[2];var y=new THREE.Vector3(o.vectors[0][0],o.vectors[0][1],o.vectors[0][2]).length(),_=new THREE.Vector3(o.vectors[1][0],o.vectors[1][1],o.vectors[1][2]).length(),b=new THREE.Vector3(o.vectors[2][0],o.vectors[2][1],o.vectors[2][2]).length();p.spacing=[y,_,b],p.matrix=new THREE.Matrix4;var E=1,w=1;if("left-posterior-superior"==o.space?(E=-1,w=-1):"left-anterior-superior"===o.space&&(E=-1),o.vectors){var x=o.vectors;p.matrix.set(E*x[0][0],E*x[1][0],E*x[2][0],0,w*x[0][1],w*x[1][1],w*x[2][1],0,1*x[0][2],1*x[1][2],1*x[2][2],0,0,0,0,1)}else p.matrix.set(E,0,0,0,0,w,0,0,0,0,1,0,0,0,0,1);return p.inverseMatrix=new THREE.Matrix4,p.inverseMatrix.getInverse(p.matrix),p.RASDimensions=new THREE.Vector3(p.xLength,p.yLength,p.zLength).applyMatrix4(p.matrix).round().toArray().map(Math.abs),p.lowerThreshold===-1/0&&(p.lowerThreshold=v),p.upperThreshold===1/0&&(p.upperThreshold=g),p},parseChars:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var n="",i=0;for(i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n},fieldFunctions:{type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){var t;return this.sizes=function(){var r,n,i,a;for(a=[],r=0,n=(i=e.split(/\s+/)).length;r<n;r++)t=i[r],a.push(parseInt(t,10));return a}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,r,n;return r=e.match(/\(.*?\)/g),this.vectors=function(){var e,i,a;for(a=[],e=0,i=r.length;e<i;e++)n=r[e],a.push(function(){var e,r,i,a;for(a=[],e=0,r=(i=n.slice(1,-1).split(/,/)).length;e<r;e++)t=i[e],a.push(parseFloat(t));return a}());return a}()},spacings:function(e){var t,r;return r=e.split(/\s+/),this.spacings=function(){var e,n,i=[];for(e=0,n=r.length;e<n;e++)t=r[e],i.push(parseFloat(t));return i}()}}}},function(module,exports){THREE.Volume=function(e,t,r,n,i){if(arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(r)||1,n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(i);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(i);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(i);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(i);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(i);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32":case"uint32_t":this.data=new Uint32Array(i);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in THREE.Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(i);break;case"Float64":case"float64":case"double":this.data=new Float64Array(i);break;default:this.data=new Uint8Array(i)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in THREE.Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new THREE.Matrix3,this.matrix.identity();var a=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return a},set:function(e){a=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}});var o=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}}),this.sliceList=[];var s=this;Object.defineProperty(this,"window",{get:function(){return s.windowHigh-s.windowLow},set:function(e){var t=(s.windowHigh+s.windowLow)/2;s.windowHigh=t+e/2,s.windowLow=t-e/2}}),Object.defineProperty(this,"level",{get:function(){return(s.windowHigh+s.windowLow)/2},set:function(e){var t=(s.windowHigh+s.windowLow)/2;s.windowHigh+=e-t,s.windowLow+=e-t}})},THREE.Volume.prototype={constructor:THREE.Volume,getData:function(e,t,r){return this.data[r*this.xLength*this.yLength+t*this.xLength+e]},access:function(e,t,r){return r*this.xLength*this.yLength+t*this.xLength+e},reverseAccess:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),r=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-r*this.xLength,r,t]},map:function(e,t){var r=this.data.length;t=t||this;for(var n=0;n<r;n++)this.data[n]=e.call(t,this.data[n],n,this.data);return this},extractPerpendicularPlane:function(axis,RASIndex){var iLength,jLength,sliceAccess,planeMatrix=(new THREE.Matrix4).identity(),volume=this,planeWidth,planeHeight,firstSpacing,secondSpacing,positionOffset,IJKIndex,maxIndex,axisInIJK=new THREE.Vector3,firstDirection=new THREE.Vector3,secondDirection=new THREE.Vector3,dimensions=new THREE.Vector3(this.xLength,this.yLength,this.zLength);switch(axis){case"x":axisInIJK.set(1,0,0),firstDirection.set(0,0,-1),secondDirection.set(0,-1,0),firstSpacing=this.spacing[2],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(RASIndex,0,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationY(Math.PI/2)),positionOffset=(volume.RASDimensions[0]-1)/2,planeMatrix.setPosition(new THREE.Vector3(RASIndex-positionOffset,0,0)),maxIndex=volume.RASDimensions[0]-1;break;case"y":axisInIJK.set(0,1,0),firstDirection.set(1,0,0),secondDirection.set(0,0,1),firstSpacing=this.spacing[0],secondSpacing=this.spacing[2],IJKIndex=new THREE.Vector3(0,RASIndex,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationX(-Math.PI/2)),positionOffset=(volume.RASDimensions[1]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,RASIndex-positionOffset,0)),maxIndex=volume.RASDimensions[1]-1;break;case"z":axisInIJK.set(0,0,1),firstDirection.set(1,0,0),secondDirection.set(0,-1,0),firstSpacing=this.spacing[0],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(0,0,RASIndex),positionOffset=(volume.RASDimensions[2]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,0,RASIndex-positionOffset)),maxIndex=volume.RASDimensions[2]-1;break;default:throw"wrong axis"}firstDirection.applyMatrix4(volume.inverseMatrix).normalize(),firstDirection.argVar="i",secondDirection.applyMatrix4(volume.inverseMatrix).normalize(),secondDirection.argVar="j",axisInIJK.applyMatrix4(volume.inverseMatrix).normalize(),iLength=Math.floor(Math.abs(firstDirection.dot(dimensions))),jLength=Math.floor(Math.abs(secondDirection.dot(dimensions))),planeWidth=Math.abs(iLength*firstSpacing),planeHeight=Math.abs(jLength*secondSpacing),IJKIndex=Math.abs(Math.round(IJKIndex.applyMatrix4(volume.inverseMatrix).dot(axisInIJK)));var base=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],iDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[0]))>.9}),jDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[1]))>.9}),kDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[2]))>.9}),argumentsWithInversion=["volume.xLength-1-","volume.yLength-1-","volume.zLength-1-"],argArray=[iDirection,jDirection,kDirection].map(function(e,t){return(e.dot(base[t])>0?"":argumentsWithInversion[t])+(e===axisInIJK?"IJKIndex":e.argVar)}),argString=argArray.join(",");return sliceAccess=eval("(function sliceAccess (i,j) {return volume.access( "+argString+");})"),{iLength:iLength,jLength:jLength,sliceAccess:sliceAccess,matrix:planeMatrix,planeWidth:planeWidth,planeHeight:planeHeight,maxIndex:maxIndex}},extractSlice:function(e,t){var r=new THREE.VolumeSlice(this,t,e);return this.sliceList.push(r),r},repaintAllSlices:function(){return this.sliceList.forEach(function(e){e.repaint()}),this},computeMinMax:function(){var e=1/0,t=-1/0,r=this.data.length,n=0;for(n=0;n<r;n++)if(!isNaN(this.data[n])){var i=this.data[n];e=Math.min(e,i),t=Math.max(t,i)}return this.min=e,this.max=t,[e,t]}}},function(e,t){THREE.VolumeSlice=function(e,t,r){var n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new THREE.Texture(this.canvas);i.minFilter=THREE.LinearFilter,i.wrapS=i.wrapT=THREE.ClampToEdgeWrapping;var a=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide,transparent:!0});this.mesh=new THREE.Mesh(this.geometry,a),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()},THREE.VolumeSlice.prototype={constructor:THREE.VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,i=this.canvasBuffer,a=this.ctxBuffer,o=a.getImageData(0,0,e,t),s=o.data,l=n.data,u=n.upperThreshold,c=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,f=0;if("label"===n.dataType)for(var p=0;p<t;p++)for(var m=0;m<e;m++){var v=l[r(m,p)];v=v>=this.colorMap.length?v%this.colorMap.length+1:v;var g=this.colorMap[v];s[4*f]=g>>24&255,s[4*f+1]=g>>16&255,s[4*f+2]=g>>8&255,s[4*f+3]=255&g,f++}else for(p=0;p<t;p++)for(m=0;m<e;m++){var y=l[r(m,p)],_=255;_=u>=y&&c<=y?_:0,y=(y=Math.floor(255*(y-h)/(d-h)))>255?255:y<0?0:0|y,s[4*f]=y,s[4*f+1]=y,s[4*f+2]=y,s[4*f+3]=_,f++}a.putImageData(o,0,0),this.ctx.drawImage(i,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new THREE.PlaneBufferGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}}},function(e,t){THREE.UnpackDepthRGBAShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")}},function(e,t){var r,n,i;THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},n=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize(new THREE.Vector2);e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,r,n=this.renderer.getRenderTarget(),i=!1,a=this.passes.length;for(r=0;r<a;r++)if(!1!==(t=this.passes[r]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(t instanceof THREE.MaskPass?i=!0:t instanceof THREE.ClearMaskPass&&(i=!1))}this.renderer.setRenderTarget(n)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.Pass.FullScreenQuad=(r=new THREE.OrthographicCamera(-1,1,1,-1,0,1),n=new THREE.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new THREE.Mesh(n,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{render:function(e){e.render(this._mesh,r)}}),i)},function(e,t){THREE.RenderPass=function(e,t,r,n,i){THREE.Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,r){var n,i,a=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(n=e.getClearColor().getHex(),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(n,i),this.scene.overrideMaterial=null,e.autoClear=a}})},function(e,t){THREE.MaskPass=function(e,t){THREE.Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.MaskPass,render:function(e,t,r){var n,i,a=e.context,o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(n=0,i=1):(n=1,i=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,n,4294967295),o.buffers.stencil.setClear(i),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP)}}),THREE.ClearMaskPass=function(){THREE.Pass.call(this),this.needsSwap=!1},THREE.ClearMaskPass.prototype=Object.create(THREE.Pass.prototype),Object.assign(THREE.ClearMaskPass.prototype,{render:function(e){e.state.buffers.stencil.setTest(!1)}})},function(e,t){THREE.OutlinePass=function(e,t,r,n){this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,THREE.Pass.call(this),this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=THREE.DoubleSide,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===THREE.CopyShader&&console.error("THREE.OutlinePass relies on THREE.CopyShader");var s=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4},THREE.OutlinePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(r,n)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function r(e){e.isMesh&&t.push(e)}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(r)}this.renderScene.traverse(function(r){if(r.isMesh||r.isLine||r.isSprite){for(var n=!1,i=0;i<t.length;i++)if(t[i].id===r.id){n=!0;break}if(!n){var a=r.visible;e&&!r.bVisible||(r.visible=e),r.bVisible=a}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,r,n,i){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,i&&e.context.disable(e.context.STENCIL_TEST),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new THREE.Vector2(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new THREE.Vector2(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.context.enable(e.context.STENCIL_TEST),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:new THREE.Matrix4}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\t\t\t\t}"})},getOverlayMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),THREE.OutlinePass.BlurDirectionX=new THREE.Vector2(1,0),THREE.OutlinePass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.ShaderPass=function(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}})},function(e,t){THREE.UnrealBloomPass=function(e,t,r,n){THREE.Pass.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(a,o,i);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new THREE.WebGLRenderTarget(a,o,i);u.texture.name="UnrealBloomPass.v"+s,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),a=Math.round(a/2),o=Math.round(o/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var c=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");var d=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.basic=new THREE.MeshBasicMaterial,this.fsQuad=new THREE.Pass.FullScreenQuad(null)},THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new THREE.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,i){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0),THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.GlitchPass=function(e){THREE.Pass.call(this),void 0===THREE.DigitalGlitch&&console.error("THREE.GlitchPass relies on THREE.DigitalGlitch");var t=THREE.DigitalGlitch;this.uniforms=THREE.UniformsUtils.clone(t.uniforms),null==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()},THREE.GlitchPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.GlitchPass,render:function(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=THREE.Math.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=THREE.Math.randFloat(-1,1),this.uniforms.seed_y.value=THREE.Math.randFloat(-1,1),this.uniforms.distortion_x.value=THREE.Math.randFloat(0,1),this.uniforms.distortion_y.value=THREE.Math.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=THREE.Math.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=THREE.Math.randFloat(0,1),this.uniforms.distortion_y.value=THREE.Math.randFloat(0,1),this.uniforms.seed_x.value=THREE.Math.randFloat(-.3,.3),this.uniforms.seed_y.value=THREE.Math.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},generateTrigger:function(){this.randX=THREE.Math.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),r=e*e,n=0;n<r;n++){var i=THREE.Math.randFloat(0,1);t[3*n+0]=i,t[3*n+1]=i,t[3*n+2]=i}var a=new THREE.DataTexture(t,e,e,THREE.RGBFormat,THREE.FloatType);return a.needsUpdate=!0,a}})},function(e,t){THREE.SSAOPass=function(e,t,r,n){THREE.Pass.call(this),this.width=void 0!==r?r:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this.generateSampleKernel(),this.generateRandomKernelRotations();var i=new THREE.DepthTexture;i.type=THREE.UnsignedShortType,i.minFilter=THREE.NearestFilter,i.maxFilter=THREE.NearestFilter,this.beautyRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthTexture:i,depthBuffer:!0}),this.normalRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),this.ssaoRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===THREE.SSAOShader&&console.error("THREE.SSAOPass: The pass relies on THREE.SSAOShader."),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOShader.uniforms),vertexShader:THREE.SSAOShader.vertexShader,fragmentShader:THREE.SSAOShader.fragmentShader,blending:THREE.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.normalMaterial=new THREE.MeshNormalMaterial,this.normalMaterial.blending=THREE.NoBlending,this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOBlurShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOBlurShader.uniforms),vertexShader:THREE.SSAOBlurShader.vertexShader,fragmentShader:THREE.SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAODepthShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAODepthShader.uniforms),vertexShader:THREE.SSAODepthShader.vertexShader,fragmentShader:THREE.SSAODepthShader.fragmentShader,blending:THREE.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.CopyShader.uniforms),vertexShader:THREE.CopyShader.vertexShader,fragmentShader:THREE.CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:THREE.DstColorFactor,blendDst:THREE.ZeroFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.DstAlphaFactor,blendDstAlpha:THREE.ZeroFactor,blendEquationAlpha:THREE.AddEquation}),this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.originalClearColor=new THREE.Color},THREE.SSAOPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.SSAOPass,dispose:function(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.quad.geometry.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose()},render:function(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case THREE.SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}},renderPass:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},renderOverride:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},setSize:function(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.blurMaterial.uniforms.resolution.value.set(e,t)},generateSampleKernel:function(){for(var e=this.kernelSize,t=this.kernel,r=0;r<e;r++){var n=new THREE.Vector3;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();var i=r/e;i=THREE.Math.lerp(.1,1,i*i),n.multiplyScalar(i),t.push(n)}},generateRandomKernelRotations:function(){void 0===THREE.SimplexNoise&&console.error("THREE.SSAOPass: The pass relies on THREE.SimplexNoise.");for(var e=new THREE.SimplexNoise,t=new Float32Array(64),r=0;r<16;r++){var n=4*r,i=2*Math.random()-1,a=2*Math.random()-1,o=e.noise3d(i,a,0);t[n]=o,t[n+1]=o,t[n+2]=o,t[n+3]=1}this.noiseTexture=new THREE.DataTexture(t,4,4,THREE.RGBAFormat,THREE.FloatType),this.noiseTexture.wrapS=THREE.RepeatWrapping,this.noiseTexture.wrapT=THREE.RepeatWrapping,this.noiseTexture.needsUpdate=!0}}),THREE.SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5}},function(e,t){THREE.BokehPass=function(e,t,r){THREE.Pass.call(this);var n=r.width||window.innerWidth||1,i=r.height||window.innerHeight||1,a=r.vignetting||0;this.scene=e,this.camera=t,this.mouse=new THREE.Vector2,this.width=n,this.height=i;var o=THREE.BokehDepthShader,s=THREE.UniformsUtils.clone(o.uniforms);this.materialDepth=new THREE.ShaderMaterial({uniforms:s,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),s.mNear.value=t.near,s.mFar.value=t.far,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(n/-2,n/2,i/2,i/-2,-1e4,1e4),this.camera2.position.z=100,this.scene2.add(this.camera2);var l={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureDepth=new THREE.WebGLRenderTarget(n,i,l),this.rtTextureColor=new THREE.WebGLRenderTarget(n,i,l);var u=3,c=4,h=THREE.BokehShader,d=THREE.UniformsUtils.clone(h.uniforms);d.textureWidth.value=n,d.textureHeight.value=i,d.shaderFocus.value=1,d.vignetting.value=a,this.materialBokeh=new THREE.ShaderMaterial({uniforms:d,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{RINGS:u,SAMPLES:c}}),this.materialBokeh.uniforms.tColor.value=this.rtTextureColor.texture,this.materialBokeh.uniforms.tDepth.value=this.rtTextureDepth.texture;var f=new THREE.Mesh(new THREE.PlaneBufferGeometry(n,i),this.materialBokeh);f.position.z=-500,this.scene2.add(f)},THREE.BokehPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.BokehPass,render:function(e,t,r,n,i){var a=this.scene,o=this.camera,s=this.materialBokeh.uniforms,l=this.materialDepth.uniforms,u=.5,c=.5;u=.5*this.mouse.x+.5,c=.5*this.mouse.y+.5,s.focusCoords.value.set(u,c),s.znear.value=o.near,s.zfar.value=o.far,l.mNear.value=o.near,l.mFar.value=o.far,e.setRenderTarget(this.rtTextureColor),e.clear(),e.render(a,o),a.overrideMaterial=this.materialDepth,e.setRenderTarget(this.rtTextureDepth),e.clear(),e.render(a,o),a.overrideMaterial=null,this.renderToScreen?e.render(this.scene2,this.camera2):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene2,this.camera2))}})},function(e,t){THREE.BokehShader={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:1},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if ( depthblur ) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","/*unboxstart*/","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","/*unboxend*/","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n")},THREE.BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")}},function(e,t){THREE.BleachBypassShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")}},function(e,t){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t){THREE.DotScreenShader={uniforms:{tDiffuse:{value:null},tSize:{value:new THREE.Vector2(256,256)},center:{value:new THREE.Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")}},function(e,t){THREE.FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")}},function(e,t){THREE.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new THREE.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var r,n,i,a,o=2*Math.ceil(3*e)+1;for(o>25&&(o=25),a=.5*(o-1),n=new Array(o),i=0,r=0;r<o;++r)n[r]=t(r-a,e),i+=n[r];for(r=0;r<o;++r)n[r]/=i;return n}}},function(e,t){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(e,t){THREE.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")}},function(e,t){THREE.DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")}},function(e,t){THREE.SSAOShader={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new THREE.Vector2},cameraProjectionMatrix:{value:new THREE.Matrix4},cameraInverseProjectionMatrix:{value:new THREE.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},THREE.SSAODepthShader={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},THREE.SSAOBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")}},function(e,t){THREE.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")}},function(e,t){THREE.AnaglyphEffect=function(e,t,r){this.colorMatrixLeft=(new THREE.Matrix3).fromArray([1.0671679973602295,-.0016435992438346148,.0001777536963345483,-.028107794001698494,-.00019593400065787137,-.0002875397040043026,-.04279090091586113,15809757314855233e-21,-.00024287120322696865]),this.colorMatrixRight=(new THREE.Matrix3).fromArray([-.0355340838432312,-.06440307199954987,.018319187685847282,-.10269022732973099,.8079727292060852,-.04835830628871918,.0001224992738571018,-.009558862075209618,.567823588848114]);var n=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=new THREE.Scene,a=new THREE.StereoCamera,o={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};void 0===t&&(t=512),void 0===r&&(r=512);var s=new THREE.WebGLRenderTarget(t,r,o),l=new THREE.WebGLRenderTarget(t,r,o),u=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:s.texture},mapRight:{value:l.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),c=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),u);i.add(c),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();s.setSize(t*n,r*n),l.setSize(t*n,r*n)},this.render=function(t,r){var o=e.getRenderTarget();t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),a.update(r),e.setRenderTarget(s),e.clear(),e.render(t,a.cameraL),e.setRenderTarget(l),e.clear(),e.render(t,a.cameraR),e.setRenderTarget(null),e.render(i,n),e.setRenderTarget(o)},this.dispose=function(){s&&s.dispose(),l&&l.dispose(),c&&c.geometry.dispose(),u&&u.dispose()}}},function(e,t){THREE.StereoEffect=function(e){var t=new THREE.StereoCamera;t.aspect=.5;var r=new THREE.Vector2;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,r){e.setSize(t,r)},this.render=function(n,i){n.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),t.update(i),e.getSize(r),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,r.width/2,r.height),e.setViewport(0,0,r.width/2,r.height),e.render(n,t.cameraL),e.setScissor(r.width/2,0,r.width/2,r.height),e.setViewport(r.width/2,0,r.width/2,r.height),e.render(n,t.cameraR),e.setScissorTest(!1)}}},function(e,t){THREE.ParallaxBarrierEffect=function(e){var t=new THREE.OrthographicCamera(-1,1,1,-1,0,1),r=new THREE.Scene,n=new THREE.StereoCamera,i={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},a=new THREE.WebGLRenderTarget(512,512,i),o=new THREE.WebGLRenderTarget(512,512,i),s=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:a.texture},mapRight:{value:o.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),l=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),s);r.add(l),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();a.setSize(t*n,r*n),o.setSize(t*n,r*n)},this.render=function(i,s){i.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),n.update(s),e.setRenderTarget(a),e.clear(),e.render(i,n.cameraL),e.setRenderTarget(o),e.clear(),e.render(i,n.cameraR),e.setRenderTarget(null),e.render(r,t)}}},function(e,t){THREE.TypedArrayUtils={},
/**
 * In-place quicksort for typed arrays (e.g. for Float32Array)
 * provides fast sorting
 * useful e.g. for a custom shader and/or BufferGeometry
 *
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * Complexity: http://bigocheatsheet.com/ see Quicksort
 *
 * Example:
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * eleSize: 3 //because of (x, y, z)
 * orderElement: 0 //order according to x
 */
THREE.TypedArrayUtils.quicksortIP=function(e,t,r){for(var n,i,a=[],o=-1,s=0,l=e.length/t-1,u=0,c=0,h=0,d=function(r,n){for(r*=t,n*=t,h=0;h<t;h++)u=e[r+h],e[r+h]=e[n+h],e[n+h]=u},f=new Float32Array(t),p=new Float32Array(t);;)if(l-s<=25){for(i=s+1;i<=l;i++){for(c=0;c<t;c++)f[c]=e[i*t+c];for(n=i-1;n>=s&&e[n*t+r]>f[r];){for(c=0;c<t;c++)e[(n+1)*t+c]=e[n*t+c];n--}for(c=0;c<t;c++)e[(n+1)*t+c]=f[c]}if(-1==o)break;l=a[o--],s=a[o--]}else{for(i=l,d(s+l>>1,n=s+1),e[s*t+r]>e[l*t+r]&&d(s,l),e[n*t+r]>e[l*t+r]&&d(n,l),e[s*t+r]>e[n*t+r]&&d(s,n),c=0;c<t;c++)p[c]=e[n*t+c];for(;;){do{n++}while(e[n*t+r]<p[r]);do{i--}while(e[i*t+r]>p[r]);if(i<n)break;d(n,i)}for(c=0;c<t;c++)e[(s+1)*t+c]=e[i*t+c],e[i*t+c]=p[c];l-n+1>=i-s?(a[++o]=n,a[++o]=l,l=i-1):(a[++o]=s,a[++o]=i-1,s=n)}return e},
/**
 * k-d Tree for typed arrays (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 * useful e.g. for a custom shader and/or BufferGeometry, saves tons of memory
 * has no insert and remove, only buildup and neares neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * Requires typed array quicksort
 *
 * Example:
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){	return Math.pow(a[0] - b[0], 2) +  Math.pow(a[1] - b[1], 2) +  Math.pow(a[2] - b[2], 2); }  //Manhatten distance
 * eleSize: 3 //because of (x, y, z)
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * If you want to further minimize memory usage, remove Node.depth and replace in search algorithm with a traversal to root node (see comments at THREE.TypedArrayUtils.Kdtree.prototype.Node)
 */
THREE.TypedArrayUtils.Kdtree=function(e,t,r){var n=this,i=0,a=function(e,t){return e.subarray(t*r,t*r+r)};this.root=function e(t,o,s,l){var u,c,h=o%r,d=t.length/r;return o>i&&(i=o),0===d?null:1===d?new n.Node(a(t,0),o,s,l):(THREE.TypedArrayUtils.quicksortIP(t,r,h),u=Math.floor(d/2),(c=new n.Node(a(t,u),o,s,u+l)).left=e(t.subarray(0,u*r),o+1,c,l),c.right=e(t.subarray((u+1)*r,t.length),o+1,c,l+u+1),c)}(e,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(e,i,a){var o,s,l;if(l=new THREE.TypedArrayUtils.Kdtree.BinaryHeap(function(e){return-e[1]}),a)for(o=0;o<i;o+=1)l.push([null,a]);for(function n(a){var o,s,u,c,h=a.depth%r,d=t(e,a.obj),f=[];function p(e,t){l.push([e,t]),l.size()>i&&l.pop()}for(c=0;c<r;c+=1)c===a.depth%r?f[c]=e[c]:f[c]=a.obj[c];s=t(f,a.obj),null!==a.right||null!==a.left?(n(o=null===a.right?a.left:null===a.left?a.right:e[h]<a.obj[h]?a.left:a.right),(l.size()<i||d<l.peek()[1])&&p(a,d),(l.size()<i||Math.abs(s)<l.peek()[1])&&null!==(u=o===a.left?a.right:a.left)&&n(u)):(l.size()<i||d<l.peek()[1])&&p(a,d)}(n.root),s=[],o=0;o<i;o+=1)l.content[o][0]&&s.push([l.content[o][0],l.content[o][1]]);return s}},THREE.TypedArrayUtils.Kdtree.prototype.Node=function(e,t,r,n){this.obj=e,this.left=null,this.right=null,this.parent=r,this.depth=t,this.pos=n},THREE.TypedArrayUtils.Kdtree.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},THREE.TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,r=0;r<t;r++)if(this.content[r]==e){var n=this.content.pop();return void(r!=t-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var r=Math.floor((e+1)/2)-1,n=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[r]=t,this.content[e]=n,e=r}},sinkDown:function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=2*(e+1),a=i-1,o=null;if(a<t){var s=this.content[a],l=this.scoreFunction(s);l<n&&(o=a)}if(i<t){var u=this.content[i];this.scoreFunction(u)<(null===o?n:l)&&(o=i)}if(null===o)break;this.content[e]=this.content[o],this.content[o]=r,e=o}}}},function(e,t){THREE.BufferGeometryUtils={computeTangents:function(e){var t=e.index,r=e.attributes;if(null!==t&&void 0!==r.position&&void 0!==r.normal&&void 0!==r.uv){var n=t.array,i=r.position.array,a=r.normal.array,o=r.uv.array,s=i.length/3;void 0===r.tangent&&e.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*s),4));for(var l=r.tangent.array,u=[],c=[],h=0;h<s;h++)u[h]=new THREE.Vector3,c[h]=new THREE.Vector3;var d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector3,_=new THREE.Vector3,b=e.groups;0===b.length&&(b=[{start:0,count:n.length}]);h=0;for(var E=b.length;h<E;++h)for(var w=L=(C=b[h]).start,x=L+C.count;w<x;w+=3)I(n[w+0],n[w+1],n[w+2]);var T,S,M,R=new THREE.Vector3,A=new THREE.Vector3,k=new THREE.Vector3,P=new THREE.Vector3;for(h=0,E=b.length;h<E;++h){var C,L;for(w=L=(C=b[h]).start,x=L+C.count;w<x;w+=3)O(n[w+0]),O(n[w+1]),O(n[w+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function I(e,t,r){d.fromArray(i,3*e),f.fromArray(i,3*t),p.fromArray(i,3*r),m.fromArray(o,2*e),v.fromArray(o,2*t),g.fromArray(o,2*r);var n=f.x-d.x,a=p.x-d.x,s=f.y-d.y,l=p.y-d.y,h=f.z-d.z,b=p.z-d.z,E=v.x-m.x,w=g.x-m.x,x=v.y-m.y,T=g.y-m.y,S=1/(E*T-w*x);y.set((T*n-x*a)*S,(T*s-x*l)*S,(T*h-x*b)*S),_.set((E*a-w*n)*S,(E*l-w*s)*S,(E*b-w*h)*S),u[e].add(y),u[t].add(y),u[r].add(y),c[e].add(_),c[t].add(_),c[r].add(_)}function O(e){k.fromArray(a,3*e),P.copy(k),S=u[e],R.copy(S),R.sub(k.multiplyScalar(k.dot(S))).normalize(),A.crossVectors(P,S),M=A.dot(c[e]),T=M<0?-1:1,l[4*e]=R.x,l[4*e+1]=R.y,l[4*e+2]=R.z,l[4*e+3]=T}},mergeBufferGeometries:function(e,t){for(var r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=new THREE.BufferGeometry,l=0,u=0;u<e.length;++u){var c=e[u];if(r!==(null!==c.index))return null;for(var h in c.attributes){if(!n.has(h))return null;void 0===a[h]&&(a[h]=[]),a[h].push(c.attributes[h])}for(var h in c.morphAttributes){if(!i.has(h))return null;void 0===o[h]&&(o[h]=[]),o[h].push(c.morphAttributes[h])}if(s.userData.mergedUserData=s.userData.mergedUserData||[],s.userData.mergedUserData.push(c.userData),t){var d;if(r)d=c.index.count;else{if(void 0===c.attributes.position)return null;d=c.attributes.position.count}s.addGroup(l,d,u),l+=d}}if(r){var f=0,p=[];for(u=0;u<e.length;++u){for(var m=e[u].index,v=0;v<m.count;++v)p.push(m.getX(v)+f);f+=e[u].attributes.position.count}s.setIndex(p)}for(var h in a){var g=this.mergeBufferAttributes(a[h]);if(!g)return null;s.addAttribute(h,g)}for(var h in o){var y=o[h][0].length;if(0===y)break;s.morphAttributes=s.morphAttributes||{},s.morphAttributes[h]=[];for(u=0;u<y;++u){var _=[];for(v=0;v<o[h].length;++v)_.push(o[h][v][u]);var b=this.mergeBufferAttributes(_);if(!b)return null;s.morphAttributes[h].push(b)}}return s},mergeBufferAttributes:function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.BufferAttribute(s,r,n)},interleaveAttributes:function(e){for(var t,r=0,n=0,i=0,a=e.length;i<a;++i){var o=e[i];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;r+=o.array.length,n+=o.itemSize}var s=new THREE.InterleavedBuffer(new t(r),n),l=0,u=[],c=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"],d=0;for(a=e.length;d<a;d++){var f=(o=e[d]).itemSize,p=o.count,m=new THREE.InterleavedBufferAttribute(s,f,l,o.normalized);u.push(m),l+=f;for(var v=0;v<p;v++)for(var g=0;g<f;g++)m[h[g]](v,o[c[g]](v))}return u},estimateBytesUsed:function(e){var t=0;for(var r in e.attributes){var n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}var i=e.getIndex();return t+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var r={},n=e.getIndex(),i=e.getAttribute("position"),a=n?n.count:i.count,o=0,s=Object.keys(e.attributes),l={},u={},c=[],h=["getX","getY","getZ","getW"],d=0,f=s.length;d<f;d++){l[_=s[d]]=[],(x=e.morphAttributes[_])&&(u[_]=new Array(x.length).fill().map(()=>[]))}var p=Math.log10(1/t),m=Math.pow(10,p);for(d=0;d<a;d++){var v=n?n.getX(d):d,g="",y=0;for(f=s.length;y<f;y++)for(var _=s[y],b=(w=e.getAttribute(_)).itemSize,E=0;E<b;E++)g+=`${~~(w[h[E]](v)*m)},`;if(g in r)c.push(r[g]);else{for(y=0,f=s.length;y<f;y++){_=s[y];var w=e.getAttribute(_),x=e.morphAttributes[_],T=(b=w.itemSize,l[_]),S=u[_];for(E=0;E<b;E++){var M=h[E];if(T.push(w[M](v)),x)for(var R=0,A=x.length;R<A;R++)S[R].push(x[R][M](v))}}r[g]=o,c.push(o),o++}}const k=e.clone();for(d=0,f=s.length;d<f;d++){_=s[d];var P=e.getAttribute(_),C=new P.array.constructor(l[_]);if(P.isInterleavedBufferAttribute?w=new THREE.BufferAttribute(C,P.itemSize,P.itemSize):(w=e.getAttribute(_).clone()).setArray(C),k.addAttribute(_,w),_ in u)for(y=0;y<u[_].length;y++){var L=e.morphAttributes[_][y].clone();L.setArray(new L.array.constructor(u[_][y])),k.morphAttributes[_][y]=L}}var I=Uint8Array;c.length>=Math.pow(2,8)&&(I=Uint16Array),c.length>=Math.pow(2,16)&&(I=Uint32Array);var O=new I(c);c=null;return null===n?c=new THREE.BufferAttribute(O,1):(c=e.getIndex().clone()).setArray(O),k.setIndex(c),k}}},function(e,t){THREE.VolumeRenderShader1={uniforms:{u_size:{value:new THREE.Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new THREE.Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["varying vec4 v_nearpos;","varying vec4 v_farpos;","varying vec3 v_position;","mat4 inversemat(mat4 m) {","float","a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],","a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],","a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],","a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],","b00 = a00 * a11 - a01 * a10,","b01 = a00 * a12 - a02 * a10,","b02 = a00 * a13 - a03 * a10,","b03 = a01 * a12 - a02 * a11,","b04 = a01 * a13 - a03 * a11,","b05 = a02 * a13 - a03 * a12,","b06 = a20 * a31 - a21 * a30,","b07 = a20 * a32 - a22 * a30,","b08 = a20 * a33 - a23 * a30,","b09 = a21 * a32 - a22 * a31,","b10 = a21 * a33 - a23 * a31,","b11 = a22 * a33 - a23 * a32,","det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;","return mat4(","a11 * b11 - a12 * b10 + a13 * b09,","a02 * b10 - a01 * b11 - a03 * b09,","a31 * b05 - a32 * b04 + a33 * b03,","a22 * b04 - a21 * b05 - a23 * b03,","a12 * b08 - a10 * b11 - a13 * b07,","a00 * b11 - a02 * b08 + a03 * b07,","a32 * b02 - a30 * b05 - a33 * b01,","a20 * b05 - a22 * b02 + a23 * b01,","a10 * b10 - a11 * b08 + a13 * b06,","a01 * b08 - a00 * b10 - a03 * b06,","a30 * b04 - a31 * b02 + a33 * b00,","a21 * b02 - a20 * b04 - a23 * b00,","a11 * b07 - a10 * b09 - a12 * b06,","a00 * b09 - a01 * b07 + a02 * b06,","a31 * b01 - a30 * b03 - a32 * b00,","a20 * b03 - a21 * b01 + a22 * b00) / det;","}","void main() {","mat4 viewtransformf = viewMatrix;","mat4 viewtransformi = inversemat(viewMatrix);","vec4 position4 = vec4(position, 1.0);","vec4 pos_in_cam = viewtransformf * position4;","pos_in_cam.z = -pos_in_cam.w;","v_nearpos = viewtransformi * pos_in_cam;","pos_in_cam.z = pos_in_cam.w;","v_farpos = viewtransformi * pos_in_cam;","v_position = position;","gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","}"].join("\n"),fragmentShader:["precision highp float;","precision mediump sampler3D;","uniform vec3 u_size;","uniform int u_renderstyle;","uniform float u_renderthreshold;","uniform vec2 u_clim;","uniform sampler3D u_data;","uniform sampler2D u_cmdata;","varying vec3 v_position;","varying vec4 v_nearpos;","varying vec4 v_farpos;","const int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3","const int REFINEMENT_STEPS = 4;","const float relative_step_size = 1.0;","const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","const float shininess = 40.0;","void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","float sample1(vec3 texcoords);","vec4 apply_colormap(float val);","vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","void main() {","vec3 farpos = v_farpos.xyz / v_farpos.w;","vec3 nearpos = v_nearpos.xyz / v_nearpos.w;","vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","float distance = dot(nearpos - v_position, view_ray);","distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","(u_size.x - 0.5 - v_position.x) / view_ray.x));","distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","(u_size.y - 0.5 - v_position.y) / view_ray.y));","distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","(u_size.z - 0.5 - v_position.z) / view_ray.z));","vec3 front = v_position + view_ray * distance;","int nsteps = int(-distance / relative_step_size + 0.5);","if ( nsteps < 1 ) discard;","vec3 step = ((v_position - front) / u_size) / float(nsteps);","vec3 start_loc = front / u_size;","if (u_renderstyle == 0)","cast_mip(start_loc, step, nsteps, view_ray);","else if (u_renderstyle == 1)","cast_iso(start_loc, step, nsteps, view_ray);","if (gl_FragColor.a < 0.05) discard;","}","float sample1(vec3 texcoords) {","/* Sample float value from a 3D texture. Assumes intensity data. */","return texture(u_data, texcoords.xyz).r;","}","vec4 apply_colormap(float val) {","val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","return texture2D(u_cmdata, vec2(val, 0.5));","}","void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","float max_val = -1e6;","int max_i = 100;","vec3 loc = start_loc;","for (int iter=0; iter<MAX_STEPS; iter++) {","if (iter >= nsteps) break;","float val = sample1(loc);","if (val > max_val) {","max_val = val;","max_i = iter;","}","loc += step;","}","vec3 iloc = start_loc + step * (float(max_i) - 0.5);","vec3 istep = step / float(REFINEMENT_STEPS);","for (int i=0; i<REFINEMENT_STEPS; i++) {","max_val = max(max_val, sample1(iloc));","iloc += istep;","}","gl_FragColor = apply_colormap(max_val);","}","void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","gl_FragColor = vec4(0.0);\t// init transparent","vec4 color3 = vec4(0.0);\t// final color","vec3 dstep = 1.5 / u_size;\t// step to sample derivative","vec3 loc = start_loc;","float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","for (int iter=0; iter<MAX_STEPS; iter++) {","if (iter >= nsteps)","break;","float val = sample1(loc);","if (val > low_threshold) {","vec3 iloc = loc - 0.5 * step;","vec3 istep = step / float(REFINEMENT_STEPS);","for (int i=0; i<REFINEMENT_STEPS; i++) {","val = sample1(iloc);","if (val > u_renderthreshold) {","gl_FragColor = add_lighting(val, iloc, dstep, view_ray);","return;","}","iloc += istep;","}","}","loc += step;","}","}","vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","{","vec3 V = normalize(view_ray);","vec3 N;","float val1, val2;","val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","N[0] = val1 - val2;","val = max(max(val1, val2), val);","val1 = sample1(loc + vec3(0.0, -step[1], 0.0));","val2 = sample1(loc + vec3(0.0, +step[1], 0.0));","N[1] = val1 - val2;","val = max(max(val1, val2), val);","val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","N[2] = val1 - val2;","val = max(max(val1, val2), val);","float gm = length(N); // gradient magnitude","N = normalize(N);","float Nselect = float(dot(N, V) > 0.0);","N = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;","vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","for (int i=0; i<1; i++)","{","vec3 L = normalize(view_ray);\t//lightDirs[i];","float lightEnabled = float( length(L) > 0.0 );","L = normalize(L + (1.0 - lightEnabled));","float lambertTerm = clamp(dot(N, L), 0.0, 1.0);","vec3 H = normalize(L+V); // Halfway vector","float specularTerm = pow(max(dot(H, N), 0.0), shininess);","float mask1 = lightEnabled;","ambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;","diffuse_color +=\tmask1 * lambertTerm;","specular_color += mask1 * specularTerm * specular_color;","}","vec4 final_color;","vec4 color = apply_colormap(val);","final_color = color * (ambient_color + diffuse_color) + specular_color;","final_color.a = color.a;","return final_color;","}"].join("\n")}},function(e,t){THREE.GodRaysDepthMaskShader={uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},THREE.GodRaysGenerateShader={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","\tvec2 delta = vSunPositionScreenSpace - vUv;","\tfloat dist = length( delta );","\tvec2 stepv = fStepSize * delta / dist;","\tfloat iters = dist/fStepSize;","\tvec2 uv = vUv.xy;","\tfloat col = 0.0;","\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tgl_FragColor = vec4( col/TAPS_PER_PASS );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysCombineShader={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysFakeSunShader={uniforms:{vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)},fAspect:{value:1},sunColor:{value:new THREE.Color(16772608)},bgColor:{value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","\tvec2 diff = vUv - vSunPositionScreenSpace;","\tdiff.x *= fAspect;","\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","\tprop = 0.35 * pow( 1.0 - prop, 3.0 );","\tgl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","\tgl_FragColor.w = 1.0;","}"].join("\n")}},function(e,t){THREE.DragControls=function(e,t,r){if(e instanceof THREE.Camera){console.warn("THREE.DragControls: Constructor now expects ( objects, camera, domElement )");var n=e;e=t,t=n}var i=new THREE.Plane,a=new THREE.Raycaster,o=new THREE.Vector2,s=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Matrix4,h=null,d=null,f=this;function p(){r.addEventListener("mousemove",v,!1),r.addEventListener("mousedown",g,!1),r.addEventListener("mouseup",y,!1),r.addEventListener("mouseleave",y,!1),r.addEventListener("touchmove",_,!1),r.addEventListener("touchstart",b,!1),r.addEventListener("touchend",E,!1)}function m(){r.removeEventListener("mousemove",v,!1),r.removeEventListener("mousedown",g,!1),r.removeEventListener("mouseup",y,!1),r.removeEventListener("mouseleave",y,!1),r.removeEventListener("touchmove",_,!1),r.removeEventListener("touchstart",b,!1),r.removeEventListener("touchend",E,!1)}function v(n){if(!1!==f.enabled){n.preventDefault();var p=r.getBoundingClientRect();if(o.x=(n.clientX-p.left)/p.width*2-1,o.y=-(n.clientY-p.top)/p.height*2+1,a.setFromCamera(o,t),h&&f.enabled)return a.ray.intersectPlane(i,l)&&h.position.copy(l.sub(s).applyMatrix4(c)),void f.dispatchEvent({type:"drag",object:h});a.setFromCamera(o,t);var m=a.intersectObjects(e);if(m.length>0){var v=m[0].object;i.setFromNormalAndCoplanarPoint(t.getWorldDirection(i.normal),u.setFromMatrixPosition(v.matrixWorld)),d!==v&&(f.dispatchEvent({type:"hoveron",object:v}),r.style.cursor="pointer",d=v)}else null!==d&&(f.dispatchEvent({type:"hoveroff",object:d}),r.style.cursor="auto",d=null)}}function g(n){if(!1!==f.enabled){n.preventDefault(),a.setFromCamera(o,t);var d=[];e.forEach(e=>{e.traverse(e=>{e.isMesh&&d.push(e)})});var p=a.intersectObjects(d);p.length>0&&(h=p[0].object,a.ray.intersectPlane(i,l)&&(c.getInverse(h.parent.matrixWorld),s.copy(l).sub(u.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",f.dispatchEvent({type:"dragstart",object:h}))}}function y(e){!1!==f.enabled&&(e.preventDefault(),h&&(f.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor=d?"pointer":"auto")}function _(e){if(!1!==f.enabled){e.preventDefault(),e=e.changedTouches[0];var n=r.getBoundingClientRect();return o.x=(e.clientX-n.left)/n.width*2-1,o.y=-(e.clientY-n.top)/n.height*2+1,a.setFromCamera(o,t),h&&f.enabled?(a.ray.intersectPlane(i,l)&&h.position.copy(l.sub(s).applyMatrix4(c)),void f.dispatchEvent({type:"drag",object:h})):void 0}}function b(n){if(!1!==f.enabled){n.preventDefault(),n=n.changedTouches[0];var d=r.getBoundingClientRect();o.x=(n.clientX-d.left)/d.width*2-1,o.y=-(n.clientY-d.top)/d.height*2+1,a.setFromCamera(o,t);var p=a.intersectObjects(e);p.length>0&&(h=p[0].object,i.setFromNormalAndCoplanarPoint(t.getWorldDirection(i.normal),u.setFromMatrixPosition(h.matrixWorld)),a.ray.intersectPlane(i,l)&&(c.getInverse(h.parent.matrixWorld),s.copy(l).sub(u.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",f.dispatchEvent({type:"dragstart",object:h}))}}function E(e){!1!==f.enabled&&(e.preventDefault(),h&&(f.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor="auto")}p(),this.enabled=!0,this.activate=p,this.deactivate=m,this.dispose=function(){m()},this.setObjects=function(){console.error("THREE.DragControls: setObjects() has been removed.")},this.on=function(e,t){console.warn("THREE.DragControls: on() has been deprecated. Use addEventListener() instead."),f.addEventListener(e,t)},this.off=function(e,t){console.warn("THREE.DragControls: off() has been deprecated. Use removeEventListener() instead."),f.removeEventListener(e,t)},this.notify=function(e){console.error("THREE.DragControls: notify() has been deprecated. Use dispatchEvent() instead."),f.dispatchEvent({type:e})}},THREE.DragControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.DragControls.prototype.constructor=THREE.DragControls},function(e,t){THREE.TransformControls=function(e,t){THREE.Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var r=new THREE.TransformControlsGizmo;this.add(r);var n=new THREE.TransformControlsPlane;this.add(n);var i=this;U("camera",e),U("object",void 0),U("enabled",!0),U("axis",null),U("mode","translate"),U("translationSnap",null),U("rotationSnap",null),U("space","world"),U("size",1),U("dragging",!1),U("showX",!0),U("showY",!0),U("showZ",!0);var a={type:"change"},o={type:"mouseDown"},s={type:"mouseUp",mode:i.mode},l={type:"objectChange"},u=new THREE.Raycaster,c=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Quaternion,f={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},p=new THREE.Vector3,m=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector3,_=new THREE.Vector3,b=0,E=new THREE.Vector3,w=new THREE.Quaternion,x=new THREE.Vector3,T=new THREE.Vector3,S=new THREE.Quaternion,M=new THREE.Quaternion,R=new THREE.Vector3,A=new THREE.Vector3,k=new THREE.Quaternion,P=new THREE.Vector3,C=new THREE.Vector3,L=new THREE.Quaternion,I=new THREE.Quaternion,O=new THREE.Vector3,H=new THREE.Vector3,D=new THREE.Vector3,N=new THREE.Quaternion,F=new THREE.Vector3;function U(e,t){var o=t;Object.defineProperty(i,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,n[e]=t,r[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(a))}}),i[e]=t,n[e]=t,r[e]=t}function B(e){var r=e.changedTouches?e.changedTouches[0]:e,n=t.getBoundingClientRect();return{x:(r.clientX-n.left)/n.width*2-1,y:-(r.clientY-n.top)/n.height*2+1,button:e.button}}function z(e){i.enabled&&i.pointerHover(B(e))}function j(e){i.enabled&&(document.addEventListener("mousemove",V,!1),i.pointerHover(B(e)),i.pointerDown(B(e)))}function V(e){i.enabled&&i.pointerMove(B(e))}function G(e){i.enabled&&(document.removeEventListener("mousemove",V,!1),i.pointerUp(B(e)))}U("worldPosition",C),U("worldPositionStart",A),U("worldQuaternion",L),U("worldQuaternionStart",k),U("cameraPosition",E),U("cameraQuaternion",w),U("pointStart",p),U("pointEnd",m),U("rotationAxis",g),U("rotationAngle",b),U("eye",H),t.addEventListener("mousedown",j,!1),t.addEventListener("touchstart",j,!1),t.addEventListener("mousemove",z,!1),t.addEventListener("touchmove",z,!1),t.addEventListener("touchmove",V,!1),document.addEventListener("mouseup",G,!1),t.addEventListener("touchend",G,!1),t.addEventListener("touchcancel",G,!1),t.addEventListener("touchleave",G,!1),this.dispose=function(){t.removeEventListener("mousedown",j),t.removeEventListener("touchstart",j),t.removeEventListener("mousemove",z),document.removeEventListener("mousemove",V),t.removeEventListener("touchmove",z),t.removeEventListener("touchmove",V),document.removeEventListener("mouseup",G),t.removeEventListener("touchend",G),t.removeEventListener("touchcancel",G),t.removeEventListener("touchleave",G),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(T,S,R),this.object.matrixWorld.decompose(C,L,O),M.copy(S).inverse(),I.copy(L).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(E,w,x),this.camera instanceof THREE.PerspectiveCamera?H.copy(E).sub(C).normalize():this.camera instanceof THREE.OrthographicCamera&&H.copy(E).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var t=u.intersectObjects(r.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){u.setFromCamera(e,this.camera);var t=u.intersectObjects([n],!0)[0]||!1;if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),D.copy(this.object.position),N.copy(this.object.quaternion),F.copy(this.object.scale),this.object.matrixWorld.decompose(A,k,P),p.copy(t.point).sub(A)}this.dragging=!0,o.mode=this.mode,this.dispatchEvent(o)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,i=this.object,o=this.space;if("scale"===r?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var s=u.intersectObjects([n],!0)[0]||!1;if(!1!==s){if(m.copy(s.point).sub(A),"translate"===r)v.copy(m).sub(p),"local"===o&&"XYZ"!==t&&v.applyQuaternion(I),-1===t.indexOf("X")&&(v.x=0),-1===t.indexOf("Y")&&(v.y=0),-1===t.indexOf("Z")&&(v.z=0),"local"===o&&"XYZ"!==t?v.applyQuaternion(N).divide(R):v.applyQuaternion(M).divide(R),i.position.copy(v).add(D),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(d.copy(N).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(N)),"world"===o&&(i.parent&&i.position.add(c.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(c.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var E=m.length()/p.length();m.dot(p)<0&&(E*=-1),h.set(E,E,E)}else c.copy(p),h.copy(m),c.applyQuaternion(I),h.applyQuaternion(I),h.divide(c),-1===t.search("X")&&(h.x=1),-1===t.search("Y")&&(h.y=1),-1===t.search("Z")&&(h.z=1);i.scale.copy(F).multiply(h)}else if("rotate"===r){v.copy(m).sub(p);var w=20/C.distanceTo(c.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(g.copy(H),b=m.angleTo(p),y.copy(p).normalize(),_.copy(m).normalize(),b*=_.cross(y).dot(H)<0?1:-1):"XYZE"===t?(g.copy(v).cross(H).normalize(),b=v.dot(c.copy(g).cross(this.eye))*w):"X"!==t&&"Y"!==t&&"Z"!==t||(g.copy(f[t]),c.copy(f[t]),"local"===o&&c.applyQuaternion(L),b=v.dot(c.cross(H).normalize())*w),this.rotationSnap&&(b=Math.round(b/this.rotationSnap)*this.rotationSnap),this.rotationAngle=b,"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(N),i.quaternion.multiply(d.setFromAxisAngle(g,b)).normalize()):(g.applyQuaternion(M),i.quaternion.copy(d.setFromAxisAngle(g,b)),i.quaternion.multiply(N).normalize())}this.dispatchEvent(a),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return i.mode},this.setMode=function(e){i.mode=e},this.setTranslationSnap=function(e){i.translationSnap=e},this.setRotationSnap=function(e){i.rotationSnap=e},this.setSize=function(e){i.size=e},this.setSpace=function(e){i.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var n=e.clone();n.opacity=.33;var i=e.clone();i.color.set(16711680);var a=e.clone();a.color.set(65280);var o=e.clone();o.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var u=s.clone();u.color.set(65535);var c=s.clone();c.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var d=t.clone();d.color.set(65280);var f=t.clone();f.color.set(255);var p=t.clone();p.color.set(65535);var m=t.clone();m.color.set(16711935);var v=t.clone();v.color.set(16776960);var g=t.clone();g.color.set(7895160);var y=v.clone();y.opacity=.25;var _=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),b=new THREE.BoxBufferGeometry(.125,.125,.125),E=new THREE.BufferGeometry;E.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var w,x=function(e,t){for(var r=new THREE.BufferGeometry,n=[],i=0;i<=64*t;++i)n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return r.addAttribute("position",new THREE.Float32BufferAttribute(n,3)),r},T={X:[[new THREE.Mesh(_,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(_,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(E,h)]],Y:[[new THREE.Mesh(_,a),[0,1,0],null,null,"fwd"],[new THREE.Mesh(_,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(E,d),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(_,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(_,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(E,f),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(E,v),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(E,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(E,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(E,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(E,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},S={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),r)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},M={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new THREE.Line((w=new THREE.BufferGeometry,w.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),w),n),null,null,null,"helper"]],X:[[new THREE.Line(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={X:[[new THREE.Line(x(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(x(1,.5),d),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(x(1,.5),f),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(x(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(x(1,1),g),null,[0,Math.PI/2,0]]]},A={AXIS:[[new THREE.Line(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},k={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),r)]]},P={X:[[new THREE.Mesh(b,i),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(E,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(b,a),[0,.8,0]],[new THREE.Line(E,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(b,o),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(E,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(b,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(E,v),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(E,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(b,u),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(E,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(b,c),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(E,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(E,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},C={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(b,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(b,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(b,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},L={X:[[new THREE.Line(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I=function(e){var t=new THREE.Object3D;for(var r in e)for(var n=e[r].length;n--;){var i=e[r][n][0].clone(),a=e[r][n][1],o=e[r][n][2],s=e[r][n][3],l=e[r][n][4];i.name=r,i.tag=l,a&&i.position.set(a[0],a[1],a[2]),o&&i.rotation.set(o[0],o[1],o[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();var u=i.geometry.clone();u.applyMatrix(i.matrix),i.geometry=u,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t},O=new THREE.Vector3(0,0,0),H=new THREE.Euler,D=new THREE.Vector3(0,1,0),N=new THREE.Vector3(0,0,0),F=new THREE.Matrix4,U=new THREE.Quaternion,B=new THREE.Quaternion,z=new THREE.Quaternion,j=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),G=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=I(T)),this.add(this.gizmo.rotate=I(R)),this.add(this.gizmo.scale=I(P)),this.add(this.picker.translate=I(S)),this.add(this.picker.rotate=I(k)),this.add(this.picker.scale=I(C)),this.add(this.helper.translate=I(M)),this.add(this.helper.rotate=I(A)),this.add(this.helper.scale=I(L)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:z;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var n=0;n<r.length;n++){var i=r[n];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);var a=this.worldPosition.distanceTo(this.cameraPosition);if(i.scale.set(1,1,1).multiplyScalar(a*this.size/7),"helper"!==i.tag){if(i.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==i.name&&"XYZX"!==i.name||Math.abs(D.copy(j).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"!==i.name&&"XYZY"!==i.name||Math.abs(D.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"!==i.name&&"XYZZ"!==i.name||Math.abs(D.copy(G).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(D.copy(G).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(D.copy(j).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(D.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),-1!==i.name.search("X")&&(D.copy(j).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.x*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Y")&&(D.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.y*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Z")&&(D.copy(G).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.z*=-1:"bwd"===i.tag&&(i.visible=!1))}else"rotate"===this.mode&&(B.copy(t),D.copy(this.eye).applyQuaternion(U.copy(t).inverse()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(F.lookAt(this.eye,N,V)),"X"===i.name&&(U.setFromAxisAngle(j,Math.atan2(-D.y,D.z)),U.multiplyQuaternions(B,U),i.quaternion.copy(U)),"Y"===i.name&&(U.setFromAxisAngle(V,Math.atan2(D.x,D.z)),U.multiplyQuaternions(B,U),i.quaternion.copy(U)),"Z"===i.name&&(U.setFromAxisAngle(G,Math.atan2(D.y,D.x)),U.multiplyQuaternions(B,U),i.quaternion.copy(U)));i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._opacity=i.material._opacity||i.material.opacity,i.material._color=i.material._color||i.material.color.clone(),i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled?this.axis&&(i.name===this.axis?(i.material.opacity=1,i.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some(function(e){return i.name===e})?(i.material.opacity=1,i.material.color.lerp(new THREE.Color(1,1,1),.5)):(i.material.opacity*=.25,i.material.color.lerp(new THREE.Color(1,1,1),.5))):(i.material.opacity*=.5,i.material.color.lerp(new THREE.Color(1,1,1),.5))}else i.visible=!1,"AXIS"===i.name?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,"X"===this.axis&&(U.setFromEuler(H.set(0,0,0)),i.quaternion.copy(t).multiply(U),Math.abs(D.copy(j).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(U.setFromEuler(H.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(U),Math.abs(D.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(U.setFromEuler(H.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(U),Math.abs(D.copy(G).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(U.setFromEuler(H.set(0,Math.PI/2,0)),D.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(F.lookAt(N,D,V)),i.quaternion.multiply(U),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),O.applyQuaternion(this.worldQuaternionStart.clone().inverse()),i.scale.copy(O),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),r.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),a.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(e),i.copy(e).cross(a);break;case"Y":a.copy(this.eye).cross(t),i.copy(t).cross(a);break;case"Z":a.copy(this.eye).cross(r),i.copy(r).cross(a);break;case"XY":i.copy(r);break;case"YZ":i.copy(e);break;case"XZ":a.copy(r),i.copy(t);break;case"XYZ":case"E":i.set(0,0,0)}break;case"rotate":default:i.set(0,0,0)}0===i.length()?this.quaternion.copy(this.cameraQuaternion):(o.lookAt(n.set(0,0,0),i,a),this.quaternion.setFromRotationMatrix(o)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0})},function(e,t){THREE.GPUComputationRenderer=function(e,t,r){this.variables=[],this.currentTextureIndex=0;var n=new THREE.Scene,i=new THREE.Camera;i.position.z=1;var a={passThruTexture:{value:null}},o=u("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),s=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),o);function l(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function u(e,t){t=t||{};var r=new THREE.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return l(r),r}n.add(s),this.addVariable=function(e,t,r){var n={name:e,initialValueTexture:r,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!r.extensions.get("OES_texture_float")&&!r.capabilities.isWebGL2)return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var n=0;n<this.variables.length;n++){var i=this.variables[n];i.renderTargets[0]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.renderTexture(i.initialValueTexture,i.renderTargets[0]),this.renderTexture(i.initialValueTexture,i.renderTargets[1]);var a=i.material,o=a.uniforms;if(null!==i.dependencies)for(var s=0;s<i.dependencies.length;s++){var l=i.dependencies[s];if(l.name!==i.name){for(var u=!1,c=0;c<this.variables.length;c++)if(l.name===this.variables[c].name){u=!0;break}if(!u)return"Variable dependency not found. Variable="+i.name+", dependency="+l.name}o[l.name]={value:null},a.fragmentShader="\nuniform sampler2D "+l.name+";\n"+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,r=0,n=this.variables.length;r<n;r++){var i=this.variables[r];if(null!==i.dependencies)for(var a=i.material.uniforms,o=0,s=i.dependencies.length;o<s;o++){var l=i.dependencies[o];a[l.name].value=l.renderTargets[e].texture}this.doRenderTarget(i.material,i.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=l,this.createShaderMaterial=u,this.createRenderTarget=function(r,n,i,a,o,s){return r=r||e,n=n||t,i=i||THREE.ClampToEdgeWrapping,a=a||THREE.ClampToEdgeWrapping,o=o||THREE.NearestFilter,s=s||THREE.NearestFilter,new THREE.WebGLRenderTarget(r,n,{wrapS:i,wrapT:a,minFilter:o,magFilter:s,format:THREE.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?THREE.HalfFloatType:THREE.FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var r=new Float32Array(e*t*4),n=new THREE.DataTexture(r,e,t,THREE.RGBAFormat,THREE.FloatType);return n.needsUpdate=!0,n},this.renderTexture=function(e,t){a.passThruTexture.value=e,this.doRenderTarget(o,t),a.passThruTexture.value=null},this.doRenderTarget=function(e,t){var a=r.getRenderTarget();s.material=e,r.setRenderTarget(t),r.render(n,i),s.material=o,r.setRenderTarget(a)}}},function(e,t){THREE.ImprovedNoise=function(){for(var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;t<256;t++)e[256+t]=e[t];function r(e){return e*e*e*(e*(6*e-15)+10)}function n(e,t,r){return t+e*(r-t)}function i(e,t,r,n){var i=15&e,a=i<8?t:r,o=i<4?r:12==i||14==i?t:n;return(0==(1&i)?a:-a)+(0==(2&i)?o:-o)}return{noise:function(t,a,o){var s=Math.floor(t),l=Math.floor(a),u=Math.floor(o),c=255&s,h=255&l,d=255&u,f=(t-=s)-1,p=(a-=l)-1,m=(o-=u)-1,v=r(t),g=r(a),y=r(o),_=e[c]+h,b=e[_]+d,E=e[_+1]+d,w=e[c+1]+h,x=e[w]+d,T=e[w+1]+d;return n(y,n(g,n(v,i(e[b],t,a,o),i(e[x],f,a,o)),n(v,i(e[E],t,p,o),i(e[T],f,p,o))),n(g,n(v,i(e[b+1],t,a,m),i(e[x+1],f,a,o-1)),n(v,i(e[E+1],t,p,m),i(e[T+1],f,p,m))))}}}},function(e,t){THREE.SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]},THREE.SimplexNoise.prototype.dot=function(e,t,r){return e[0]*t+e[1]*r},THREE.SimplexNoise.prototype.dot3=function(e,t,r,n){return e[0]*t+e[1]*r+e[2]*n},THREE.SimplexNoise.prototype.dot4=function(e,t,r,n,i){return e[0]*t+e[1]*r+e[2]*n+e[3]*i},THREE.SimplexNoise.prototype.noise=function(e,t){var r,n,i=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+i),o=Math.floor(t+i),s=(3-Math.sqrt(3))/6,l=(a+o)*s,u=e-(a-l),c=t-(o-l);u>c?(r=1,n=0):(r=0,n=1);var h=u-r+s,d=c-n+s,f=u-1+2*s,p=c-1+2*s,m=255&a,v=255&o,g=this.perm[m+this.perm[v]]%12,y=this.perm[m+r+this.perm[v+n]]%12,_=this.perm[m+1+this.perm[v+1]]%12,b=.5-u*u-c*c,E=.5-h*h-d*d,w=.5-f*f-p*p;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[g],u,c))+(E<0?0:(E*=E)*E*this.dot(this.grad3[y],h,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[_],f,p)))},THREE.SimplexNoise.prototype.noise3d=function(e,t,r){var n,i,a,o,s,l,u=(e+t+r)*(1/3),c=Math.floor(e+u),h=Math.floor(t+u),d=Math.floor(r+u),f=1/6,p=(c+h+d)*f,m=e-(c-p),v=t-(h-p),g=r-(d-p);m>=v?v>=g?(n=1,i=0,a=0,o=1,s=1,l=0):m>=g?(n=1,i=0,a=0,o=1,s=0,l=1):(n=0,i=0,a=1,o=1,s=0,l=1):v<g?(n=0,i=0,a=1,o=0,s=1,l=1):m<g?(n=0,i=1,a=0,o=0,s=1,l=1):(n=0,i=1,a=0,o=1,s=1,l=0);var y=m-n+f,_=v-i+f,b=g-a+f,E=m-o+2*f,w=v-s+2*f,x=g-l+2*f,T=m-1+.5,S=v-1+.5,M=g-1+.5,R=255&c,A=255&h,k=255&d,P=this.perm[R+this.perm[A+this.perm[k]]]%12,C=this.perm[R+n+this.perm[A+i+this.perm[k+a]]]%12,L=this.perm[R+o+this.perm[A+s+this.perm[k+l]]]%12,I=this.perm[R+1+this.perm[A+1+this.perm[k+1]]]%12,O=.6-m*m-v*v-g*g,H=.6-y*y-_*_-b*b,D=.6-E*E-w*w-x*x,N=.6-T*T-S*S-M*M;return 32*((O<0?0:(O*=O)*O*this.dot3(this.grad3[P],m,v,g))+(H<0?0:(H*=H)*H*this.dot3(this.grad3[C],y,_,b))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[L],E,w,x))+(N<0?0:(N*=N)*N*this.dot3(this.grad3[I],T,S,M)))},THREE.SimplexNoise.prototype.noise4d=function(e,t,r,n){var i,a,o,s,l,u,c,h,d,f,p,m,v=this.grad4,g=this.simplex,y=this.perm,_=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,E=(e+t+r+n)*_,w=Math.floor(e+E),x=Math.floor(t+E),T=Math.floor(r+E),S=Math.floor(n+E),M=(w+x+T+S)*b,R=e-(w-M),A=t-(x-M),k=r-(T-M),P=n-(S-M),C=(R>A?32:0)+(R>k?16:0)+(A>k?8:0)+(R>P?4:0)+(A>P?2:0)+(k>P?1:0),L=R-(i=g[C][0]>=3?1:0)+b,I=A-(a=g[C][1]>=3?1:0)+b,O=k-(o=g[C][2]>=3?1:0)+b,H=P-(s=g[C][3]>=3?1:0)+b,D=R-(l=g[C][0]>=2?1:0)+2*b,N=A-(u=g[C][1]>=2?1:0)+2*b,F=k-(c=g[C][2]>=2?1:0)+2*b,U=P-(h=g[C][3]>=2?1:0)+2*b,B=R-(d=g[C][0]>=1?1:0)+3*b,z=A-(f=g[C][1]>=1?1:0)+3*b,j=k-(p=g[C][2]>=1?1:0)+3*b,V=P-(m=g[C][3]>=1?1:0)+3*b,G=R-1+4*b,W=A-1+4*b,X=k-1+4*b,Y=P-1+4*b,q=255&w,Z=255&x,J=255&T,K=255&S,Q=y[q+y[Z+y[J+y[K]]]]%32,$=y[q+i+y[Z+a+y[J+o+y[K+s]]]]%32,ee=y[q+l+y[Z+u+y[J+c+y[K+h]]]]%32,te=y[q+d+y[Z+f+y[J+p+y[K+m]]]]%32,re=y[q+1+y[Z+1+y[J+1+y[K+1]]]]%32,ne=.6-R*R-A*A-k*k-P*P,ie=.6-L*L-I*I-O*O-H*H,ae=.6-D*D-N*N-F*F-U*U,oe=.6-B*B-z*z-j*j-V*V,se=.6-G*G-W*W-X*X-Y*Y;return 27*((ne<0?0:(ne*=ne)*ne*this.dot4(v[Q],R,A,k,P))+(ie<0?0:(ie*=ie)*ie*this.dot4(v[$],L,I,O,H))+(ae<0?0:(ae*=ae)*ae*this.dot4(v[ee],D,N,F,U))+(oe<0?0:(oe*=oe)*oe*this.dot4(v[te],B,z,j,V))+(se<0?0:(se*=se)*se*this.dot4(v[re],G,W,X,Y)))}},function(e,t){THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function r(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}function n(e,t){var r,n,i,a=t.position.distanceTo(e.position),o=0,s=[],l=e.faces.length;for(r=0;r<l;r++)(n=e.faces[r]).hasVertex(t)&&s.push(n);for(r=0;r<l;r++){var u=1;n=e.faces[r];for(var c=0;c<s.length;c++){i=s[c];var h=n.normal.dot(i.normal);u=Math.min(u,(1.001-h)/2)}o=Math.max(o,u)}return s.length<2&&(o=1),a*o+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var r=n(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}function a(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){r(e.neighbors.pop().neighbors,e)}r(t,e)}function o(e,t){r(t,e),e.v1&&r(e.v1.faces,e),e.v2&&r(e.v2.faces,e),e.v3&&r(e.v3.faces,e);for(var n,i,a=[e.v1,e.v2,e.v3],o=0;o<3;o++)i=a[(o+1)%3],(n=a[o])&&i&&(n.removeIfNonNeighbor(i),i.removeIfNonNeighbor(n))}function s(e,t,r,n){if(n){var s,l=[];for(s=0;s<r.neighbors.length;s++)l.push(r.neighbors[s]);for(s=r.faces.length-1;s>=0;s--)r.faces[s].hasVertex(n)&&o(r.faces[s],t);for(s=r.faces.length-1;s>=0;s--)r.faces[s].replaceVertex(r,n);for(a(r,e),s=0;s<l.length;s++)i(l[s])}else a(r,e)}function l(e){for(var t=e[0],r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}function u(e,t,r,n,i,a){this.a=n,this.b=i,this.c=a,this.v1=e,this.v2=t,this.v3=r,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function c(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}u.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position,i=this.v3.position;e.subVectors(i,n),t.subVectors(r,n),e.cross(t).normalize(),this.normal.copy(e)},u.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},u.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),r(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},c.prototype.addUniqueNeighbor=function(e){!function(e,t){-1===e.indexOf(t)&&e.push(t)}(this.neighbors,e)},c.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(e))return;t.splice(n,1)}},THREE.SimplifyModifier.prototype.modify=function(e,t){e.isBufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var r,n,a,o=e.vertices,h=e.faces,d=[],f=[];for(r=0,n=o.length;r<n;r++){var p=new c(o[r],r);d.push(p)}for(r=0,n=h.length;r<n;r++){var m=(x=h[r]).a,v=x.b,g=x.c,y=new u(d[m],d[v],d[g],m,v,g);f.push(y)}for(r=0,n=d.length;r<n;r++)i(d[r]);for(var _=t;_--;){if(!(a=l(d))){console.log("THREE.SimplifyModifier: No next vertex");break}s(d,f,a,a.collapseNeighbor)}var b=new THREE.BufferGeometry,E=[],w=[];for(r=0;r<d.length;r++){p=d[r].position;E.push(p.x,p.y,p.z)}for(r=0;r<f.length;r++){var x=f[r];m=d.indexOf(x.v1),v=d.indexOf(x.v2),g=d.indexOf(x.v3);w.push(m,v,g)}return b.addAttribute("position",new THREE.Float32BufferAttribute(E,3)),b.setIndex(w),b}}()},function(e,t){THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){(e=e.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this.smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e},function(){var e=["a","b","c"];function t(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function r(e,t,r,n,i,a){var o,s=Math.min(e,t),l=Math.max(e,t),u=s+"_"+l;u in n?o=n[u]:(o={a:r[s],b:r[l],newEdge:null,faces:[]},n[u]=o);o.faces.push(i),a[e].edges.push(o),a[t].edges.push(o)}function n(e,t,r,n,i){e.push(new THREE.Face3(t,r,n,void 0,void 0,i))}function i(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function a(e,t,r,n){e.push([t.clone(),r.clone(),n.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(o){var s,l,u,c,h,d,f,p,m,v,g,y,_,b,E=new THREE.Vector3,w=[];s=o.vertices,l=o.faces;var x,T,S,M,R,A,k,P,C,L,I,O,H,D,N=void 0!==(u=o.faceVertexUvs[0])&&u.length>0;for(f in function(e,t,n,i){var a,o,s;for(a=0,o=e.length;a<o;a++)n[a]={edges:[]};for(a=0,o=t.length;a<o;a++)r((s=t[a]).a,s.b,e,i,s,n),r(s.b,s.c,e,i,s,n),r(s.c,s.a,e,i,s,n)}(s,l,g=new Array(s.length),y={}),_=[],y){for(T=y[f],S=new THREE.Vector3,R=3/8,A=1/8,2!=(k=T.faces.length)&&(R=.5,A=0),S.addVectors(T.a,T.b).multiplyScalar(R),E.set(0,0,0),m=0;m<k;m++){for(M=T.faces[m],v=0;v<3&&((x=s[M[e[v]]])===T.a||x===T.b);v++);E.add(x)}E.multiplyScalar(A),S.add(E),T.newEdge=_.length,_.push(S)}for(b=[],f=0,p=s.length;f<p;f++){for(H=s[f],3==(d=(O=g[f].edges).length)?P=3/16:d>3&&(P=3/(8*d)),C=1-d*P,L=P,d<=2&&2==d&&(C=.75,L=1/8),D=H.clone().multiplyScalar(C),E.set(0,0,0),m=0;m<d;m++)x=(I=O[m]).a!==H?I.a:I.b,E.add(x);E.multiplyScalar(L),D.add(E),b.push(D)}c=b.concat(_);var F,U,B,z,j,V,G,W=b.length;h=[];var X=new THREE.Vector2,Y=new THREE.Vector2,q=new THREE.Vector2;for(f=0,p=l.length;f<p;f++)n(h,F=t((M=l[f]).a,M.b,y).newEdge+W,U=t(M.b,M.c,y).newEdge+W,B=t(M.c,M.a,y).newEdge+W,M.materialIndex),n(h,M.a,F,B,M.materialIndex),n(h,M.b,U,F,M.materialIndex),n(h,M.c,B,U,M.materialIndex),N&&(j=(z=u[f])[0],V=z[1],G=z[2],X.set(i(j.x,V.x),i(j.y,V.y)),Y.set(i(V.x,G.x),i(V.y,G.y)),q.set(i(j.x,G.x),i(j.y,G.y)),a(w,X,Y,q),a(w,j,X,q),a(w,V,Y,X),a(w,G,q,Y));o.vertices=c,o.faces=h,N&&(o.faceVertexUvs[0]=w)}}()},function(e,t){THREE.LensFlare=function(){THREE.Group.call(this),this.type="LensFlare",this.positionScreen=new THREE.Vector3,this.flareVisible=!1;var e=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.needsUpdate=!0;var t=new THREE.DataTexture(new Uint8Array(1024),16,16,THREE.RGBAFormat);t.minFilter=THREE.NearestFilter,t.magFilter=THREE.NearestFilter,t.needsUpdate=!0;var r=THREE.LensFlare.Shader,n=new THREE.RawShaderMaterial({uniforms:r.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthWrite:!1}),i=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),n);i.frustumCulled=!1;var a=new THREE.Vector2,o=new THREE.Vector2,s=new THREE.Box2,l=0;this.update=function(r,n,c){if(r instanceof THREE.WebGLRenderer){var h=r.info.render.frame;if(l!==h){l=h;var d=c.w/c.z,f=.5*c.z,p=.5*c.w,m=16/c.w;a.set(m*d,m),s.min.set(c.x,c.y),s.max.set(c.x+(c.z-16),c.y+(c.w-16)),this.positionScreen.setFromMatrixPosition(this.matrixWorld),this.positionScreen.applyMatrix4(n.matrixWorldInverse),this.positionScreen.applyMatrix4(n.projectionMatrix),o.x=c.x+this.positionScreen.x*f+f-8,o.y=c.y+this.positionScreen.y*p+p-8,!0===s.containsPoint(o)?(this.flareVisible=!0,r.copyFramebufferToTexture(o,e),i.material.uniforms.renderType.value=0,i.material.uniforms.scale.value=a,i.material.uniforms.screenPosition.value=this.positionScreen,i.material.depthTest=!0,r.render(i,n),r.copyFramebufferToTexture(o,t),i.material.uniforms.renderType.value=1,i.material.uniforms.map.value=e,i.material.depthTest=!1,r.render(i,n),function(){for(var e=2*-u.positionScreen.x,t=2*-u.positionScreen.y,r=0,n=u.children.length;r<n;r++){var i=u.children[r];i.flarePosition.x=u.positionScreen.x+e*i.flareDistance,i.flarePosition.y=u.positionScreen.y+t*i.flareDistance}}()):this.flareVisible=!1}}};var u=this;this.getOcclusionMap=function(){return t},this.dispose=function(){i.material.dispose(),e.dispose(),t.dispose()}},THREE.LensFlare.prototype=Object.create(THREE.Group.prototype),THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.isLensFlare=!0,THREE.LensFlare.Shader={uniforms:{renderType:{value:0},map:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform lowp int renderType;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else {","\t\tgl_FragColor = texture2D( map, vUV );","\t}","}"].join("\n")},THREE.LensFlareElement=function(e,t,r,n,i,a){THREE.Mesh.call(this),this.type="LensFlareElement",this.frustumCulled=!1,this.renderOrder=1/0,this.flareTexture=e,this.flareSize=t||1,this.flareDistance=r||0,this.flareBlending=i||THREE.AdditiveBlending,this.flareColor=n||new THREE.Color(16777215),this.flareOpacity=a||1,this.flarePosition=new THREE.Vector3,this.flareRotation=0,this.geometry=new THREE.PlaneBufferGeometry(2,2);var o=THREE.LensFlareElement.Shader;this.material=new THREE.RawShaderMaterial({uniforms:o.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:this.flareBlending,transparent:!0,depthWrite:!1});var s=new THREE.Vector2,l=new THREE.Vector4;this.onBeforeRender=function(e,t,r,n,i,a){var o=this.parent;if(null!==o){e.getCurrentViewport(l),o.update(e,r,l);var u=this.flareSize/l.w,c=l.w/l.z;s.set(u*c,u),this.material.uniforms.map.value=this.flareTexture,this.material.uniforms.occlusionMap.value=o.getOcclusionMap(),this.material.uniforms.opacity.value=this.flareOpacity,this.material.uniforms.color.value=this.flareColor,this.material.uniforms.scale.value=s,this.material.uniforms.rotation.value=this.flareRotation,this.material.uniforms.screenPosition.value=this.flarePosition,!1===o.flareVisible&&(this.material.uniforms.opacity.value=0)}else console.error("THREE.LensFlareElement: LensFlareElement not assigned to a LensFlare. Rendering not possible.")},this.dispose=function(){this.material.dispose()}},THREE.LensFlareElement.prototype=Object.create(THREE.Mesh.prototype),THREE.LensFlareElement.prototype.constructor=THREE.LensFlareElement,THREE.LensFlareElement.prototype.isLensFlareElement=!0,THREE.LensFlareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},opacity:{value:1},color:{value:null},scale:{value:null},rotation:{value:0},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );"," visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tvVisibility *= 1.0 - visibility.a / 9.0;","\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= opacity * vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")}},function(e,t){THREE.PhysicsRenderer=function(e,t,r){this.checkCompatibility(r),this.renderer=r,this.size=e||128,this.resolution=new THREE.Vector2(this.size,this.size),this.rt_1=new THREE.WebGLRenderTarget(this.size,this.size,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType,stencilBuffer:!1}),this.rt_2=this.rt_1.clone(),this.rt_3=this.rt_1.clone(),this.counter=0,this.texturePass=this.createTexturePassProgram(),this.simulatePass=this.createSimulatePassProgram(t),this.boundTextures=[],this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2)),this.scene.add(this.mesh)},THREE.PhysicsRenderer.prototype.checkCompatibility=function(e){var t=e.context;null!==t.getExtension("OES_texture_float")?0!==t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)||this.onError("Vertex Shader Textures don't work"):this.onError("No Float Textures")},THREE.PhysicsRenderer.prototype.onError=function(e){console.log(e)},THREE.PhysicsRenderer.prototype.createDebugScene=function(){var e=new THREE.Object3D;e.position.z=0;var t,r=new THREE.PlaneBufferGeometry(100,100);return(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_1}))).position.set(-105,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_2}))).position.set(0,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_3}))).position.set(105,0,0),e.add(t),e},THREE.PhysicsRenderer.prototype.removeDebugScene=function(e){e.remove(this.debugScene)},THREE.PhysicsRenderer.prototype.addDebugScene=function(e){e.add(this.debugScene)},THREE.PhysicsRenderer.prototype.createTexturePassProgram=function(){return new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:null}},vertexShader:this.VSPass,fragmentShader:this.FSPass})},THREE.PhysicsRenderer.prototype.createSimulatePassProgram=function(e){var t={t_oPos:{type:"t",value:null},t_pos:{type:"t",value:null},resolution:{type:"v2",value:this.resolution}};return new THREE.ShaderMaterial({uniforms:t,vertexShader:this.VSPass,fragmentShader:e})},THREE.PhysicsRenderer.prototype.update=function(){var e=this.counter%3;0==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_1.texture,this.simulatePass.uniforms.t_pos.value=this.rt_2.texture,this.pass(this.simulatePass,this.rt_3),this.ooOutput=this.rt_1.texture,this.oOutput=this.rt_2.texture,this.output=this.rt_3.texture):1==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_2.texture,this.simulatePass.uniforms.t_pos.value=this.rt_3.texture,this.pass(this.simulatePass,this.rt_1),this.ooOutput=this.rt_2.texture,this.oOutput=this.rt_3.texture,this.output=this.rt_1.texture):2==e&&(this.simulatePass.uniforms.t_oPos.value=this.rt_3.texture,this.simulatePass.uniforms.t_pos.value=this.rt_1.texture,this.pass(this.simulatePass,this.rt_2),this.ooOutput=this.rt_3.texture,this.oOutput=this.rt_1.texture,this.output=this.rt_2.texture),this.counter++,this.bindTextures()},THREE.PhysicsRenderer.prototype.render=function(e,t,r){this.renderer.setRenderTarget(r),this.renderer.render(e,t)},THREE.PhysicsRenderer.prototype.pass=function(e,t){this.mesh.material=e,this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.out=function(e){this.mesh.material=e.material,this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.setUniforms=function(e){for(var t in e)this.simulatePass.uniforms[t]=e[t];this.simulatePass.uniforms.t_pos={type:"t",value:null},this.simulatePass.uniforms.t_oPos={type:"t",value:null},this.simulatePass.uniforms.resolution={type:"v2",value:this.resolution}},THREE.PhysicsRenderer.prototype.setUniform=function(e,t){this.simulatePass.uniforms[e]=t},THREE.PhysicsRenderer.prototype.reset=function(e){this.texture=e,this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,this.rt_1),this.pass(this.texturePass,this.rt_2),this.pass(this.texturePass,this.rt_3)},THREE.PhysicsRenderer.prototype.passTexture=function(e,t){this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,t)},THREE.PhysicsRenderer.prototype.resetRand=function(e,t,r,n){e=e||100,t=t||0,r=r||0,n=n||0;for(var i=new Float32Array(this.size*this.size*4),a=0;a<i.length;a+=4)i[a+0]=t+(Math.random()-.5)*e,i[a+1]=r+(Math.random()-.5)*e,i[a+2]=n+(Math.random()-.5)*e,i[a+3]=100;var o=new THREE.DataTexture(i,this.size,this.size,THREE.RGBAFormat,THREE.FloatType);o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.needsUpdate=!0,this.reset(o)},THREE.PhysicsRenderer.prototype.addBoundTexture=function(e,t){this.boundTextures.push([e,t])},THREE.PhysicsRenderer.prototype.bindTextures=function(){for(var e=0;e<this.boundTextures.length;e++){var t=this.boundTextures[e][0],r=this.boundTextures[e][1];t.value=this[r]}},THREE.PhysicsRenderer.prototype.VSPass=["varying vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = vec4( position, 1.0 );","}"].join("\n"),THREE.PhysicsRenderer.prototype.FSPass=["uniform sampler2D texture;","varying vec2 vUv;","void main() {","  vec4 c = texture2D( texture , vUv );","  gl_FragColor = c;","}"].join("\n")},function(e,t){THREE.MirrorRenderer=function(e,t,r,n){function i(e,t){return void 0!==e?e:t}THREE.Object3D.call(this),this.name="mirror_"+this.id,n=n||{},this.matrixNeedsUpdate=!0;var a=i(n.textureWidth,512),o=i(n.textureHeight,512);this.clipBias=i(n.clipBias,0),this.renderer=e,this.scene=r,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4,t instanceof THREE.PerspectiveCamera?this.camera=t:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mesh=new THREE.Object3D,this.texture=new THREE.WebGLRenderTarget(a,o),this.tempTexture=new THREE.WebGLRenderTarget(a,o),THREE.Math.isPowerOfTwo(a)&&THREE.Math.isPowerOfTwo(o)||(this.texture.texture.generateMipmaps=!1,this.tempTexture.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()},THREE.MirrorRenderer.prototype=Object.create(THREE.Object3D.prototype),THREE.MirrorRenderer.prototype.renderWithMirror=function(e){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var t=e.camera;e.camera=this.mirrorCamera,e.render(!0),e.material.uniforms.mirrorSampler.value=e.tempTexture.texture,this.render(),this.matrixNeedsUpdate=!0,e.material.uniforms.mirrorSampler.value=e.texture.texture,e.camera=t,e.updateTextureMatrix()},THREE.MirrorRenderer.prototype.updateTextureMatrix=function(){function e(e){return e?e<0?-1:1:0}null!=this.parent&&(this.mesh=this.parent),this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal=new THREE.Vector3(0,1,0).applyEuler(this.mesh.rotation);var t=new THREE.Vector3(0,0,1).applyEuler(this.camera.rotation);if(this.normal.dot(t)<0){var r=new THREE.Vector3(0,0,1).applyEuler(this.mesh.rotation);this.normal.reflect(r)}var n=this.mesh.position.clone().sub(this.cameraWorldPosition);n.reflect(this.normal).negate(),n.add(this.mesh.position),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mesh.position.clone().sub(this.lookAtPosition);i.reflect(this.normal).negate(),i.add(this.mesh.position),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(n),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(i),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mesh.position),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var a=new THREE.Vector4,o=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+o.elements[8])/o.elements[0],a.y=(e(this.clipPlane.y)+o.elements[9])/o.elements[5],a.z=-1,a.w=(1+o.elements[10])/o.elements[14];var s=new THREE.Vector4;s=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),o.elements[2]=s.x,o.elements[6]=s.y,o.elements[10]=s.z+1-this.clipBias,o.elements[14]=s.w;var l=new THREE.Vector3;l.setFromMatrixPosition(this.camera.matrixWorld),this.eye=l},THREE.MirrorRenderer.prototype.render=function(e){if(this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0,void 0!==this.scene&&this.scene instanceof THREE.Scene){var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.setRenderTarget(t),this.renderer.clear(),this.renderer.render(this.scene,this.mirrorCamera)}}},function(e,t){THREE.ShaderLib.ocean_sim_vertex={vertexShader:["varying vec2 vUV;","void main (void) {","vUV = position.xy * 0.5 + 0.5;","gl_Position = vec4(position, 1.0);","}"].join("\n")},THREE.ShaderLib.ocean_subtransform={uniforms:{u_input:{value:null},u_transformSize:{value:512},u_subtransformSize:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","uniform sampler2D u_input;","uniform float u_transformSize;","uniform float u_subtransformSize;","varying vec2 vUV;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","void main (void) {","#ifdef HORIZONTAL","float index = vUV.x * u_transformSize - 0.5;","#else","float index = vUV.y * u_transformSize - 0.5;","#endif","float evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);","#ifdef HORIZONTAL","vec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","#else","vec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;","#endif","float twiddleArgument = -2.0 * PI * (index / u_subtransformSize);","vec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));","vec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);","vec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);","gl_FragColor = vec4(outputA, outputB);","}"].join("\n")},THREE.ShaderLib.ocean_initial_spectrum={uniforms:{u_wind:{value:new THREE.Vector2(10,10)},u_resolution:{value:512},u_size:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","const float CM = 0.23;","uniform vec2 u_wind;","uniform float u_resolution;","uniform float u_size;","float square (float x) {","return x * x;","}","float omega (float k) {","return sqrt(G * k * (1.0 + square(k / KM)));","}","float tanh_ (float x) {","return (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 K = (2.0 * PI * vec2(n, m)) / u_size;","float k = length(K);","float l_wind = length(u_wind);","float Omega = 0.84;","float kp = G * square(Omega / l_wind);","float c = omega(k) / k;","float cp = omega(kp) / kp;","float Lpm = exp(-1.25 * square(kp / k));","float gamma = 1.7;","float sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));","float Gamma = exp(-square(sqrt(k / kp) - 1.0) / 2.0 * square(sigma));","float Jp = pow(gamma, Gamma);","float Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));","float alphap = 0.006 * sqrt(Omega);","float Bl = 0.5 * alphap * cp / c * Fp;","float z0 = 0.000037 * square(l_wind) / G * pow(l_wind / cp, 0.9);","float uStar = 0.41 * l_wind / log(10.0 / z0);","float alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));","float Fm = exp(-0.25 * square(k / KM - 1.0));","float Bh = 0.5 * alpham * CM / c * Fm * Lpm;","float a0 = log(2.0) / 4.0;","float am = 0.13 * uStar / CM;","float Delta = tanh_(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));","float cosPhi = dot(normalize(u_wind), normalize(K));","float S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));","float dk = 2.0 * PI / u_size;","float h = sqrt(S / 2.0) * dk;","if (K.x == 0.0 && K.y == 0.0) {","h = 0.0;","}","gl_FragColor = vec4(h, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_phase={uniforms:{u_phases:{value:null},u_deltaTime:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform sampler2D u_phases;","uniform float u_deltaTime;","uniform float u_resolution;","uniform float u_size;","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","float deltaTime = 1.0 / 60.0;","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","float deltaPhase = omega(length(waveVector)) * u_deltaTime;","phase = mod(phase + deltaPhase, 2.0 * PI);","gl_FragColor = vec4(phase, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_spectrum={uniforms:{u_size:{value:null},u_resolution:{value:null},u_choppiness:{value:null},u_phases:{value:null},u_initialSpectrum:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform float u_size;","uniform float u_resolution;","uniform float u_choppiness;","uniform sampler2D u_phases;","uniform sampler2D u_initialSpectrum;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","vec2 multiplyByI (vec2 z) {","return vec2(-z[1], z[0]);","}","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","vec2 phaseVector = vec2(cos(phase), sin(phase));","vec2 h0 = texture2D(u_initialSpectrum, vUV).rg;","vec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;","h0Star.y *= -1.0;","vec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));","vec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;","vec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;","if (waveVector.x == 0.0 && waveVector.y == 0.0) {","h = vec2(0.0);","hX = vec2(0.0);","hZ = vec2(0.0);","}","gl_FragColor = vec4(hX + multiplyByI(h), hZ);","}"].join("\n")},THREE.ShaderLib.ocean_normals={uniforms:{u_displacementMap:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","varying vec2 vUV;","uniform sampler2D u_displacementMap;","uniform float u_resolution;","uniform float u_size;","void main (void) {","float texel = 1.0 / u_resolution;","float texelSize = u_size / u_resolution;","vec3 center = texture2D(u_displacementMap, vUV).rgb;","vec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;","vec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;","vec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;","vec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;","vec3 topRight = cross(right, top);","vec3 topLeft = cross(top, left);","vec3 bottomLeft = cross(left, bottom);","vec3 bottomRight = cross(bottom, right);","gl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);","}"].join("\n")},THREE.ShaderChunk.screenplane_pars_vertex=["const float infinite = 150000.0;","const float screenScale = 1.2;","const vec3 groundNormal = vec3( 0.0, 1.0, 0.0 );","varying vec3 vCamPosition;","vec3 interceptPlane( in vec3 source, in vec3 dir, in vec3 normal, float height )","{","\tfloat distance = ( - height - dot( normal, source ) ) / dot( normal, dir );","\tif( distance < 0.0 )","\t\treturn source + dir * distance;","\telse ","\t\treturn - ( vec3( source.x, height, source.z ) + vec3( dir.x, height, dir.z ) * infinite );","}","mat3 getRotation()","{","\treturn mat3( ","\t\tviewMatrix[0].xyz,","\t\tviewMatrix[1].xyz,","\t\tviewMatrix[2].xyz","\t);","}","vec3 getCameraPos( in mat3 rotation )","{","\treturn - viewMatrix[3].xyz * rotation;","}","vec2 getImagePlan()","{","\tfloat focal = projectionMatrix[0].x;","\tfloat aspect = projectionMatrix[1].y;","\treturn vec2( ( uv.x - 0.5 ) * screenScale * aspect, ( uv.y - 0.5 ) * screenScale * focal );","}","vec3 getCamRay( in mat3 rotation, in vec2 screenUV )","{","\treturn vec3( screenUV.x, screenUV.y, projectionMatrix[0].x ) * rotation;","}","vec3 computeProjectedPosition()","{","\tmat3 cameraRotation = getRotation();","\tvec3 camPosition = getCameraPos( cameraRotation );","\tvCamPosition = camPosition;","\tvec2 screenUV = getImagePlan();","\tvec3 ray = getCamRay( cameraRotation, screenUV );","\tvec3 finalPos = interceptPlane( camPosition, ray, groundNormal, -u_groundHeight );","\tfloat distance = length( finalPos );","\tif( distance > infinite )","\t\tfinalPos *= infinite / distance;","\treturn finalPos;","}"].join("\n"),THREE.ShaderChunk.screenplane_vertex=["vec4 screenPlaneWorldPosition = vec4( computeProjectedPosition(), 1.0 );"].join("\n"),THREE.ShaderChunk.screenplane_pars_fragment=["varying vec3 vCamPosition;"].join("\n"),THREE.ShaderChunk.oceanfft_pars_vertex=["uniform sampler2D u_displacementMap;","uniform float u_geometrySize;","uniform float u_size;"].join("\n"),THREE.ShaderChunk.oceanfft_vertex=["vec3 displacement = texture2D( u_displacementMap, worldPosition.xz * 0.002 ).rgb * ( u_geometrySize / u_size );","vec4 oceanfftWorldPosition = worldPosition + vec4( displacement, 0.0 );"].join("\n"),THREE.ShaderLib.ocean_main={uniforms:{u_displacementMap:{value:null},u_reflection:{value:null},u_normalMap:{value:null},u_geometrySize:{value:null},u_size:{value:null},u_mirrorMatrix:{value:null},u_oceanColor:{value:null},u_sunDirection:{value:null},u_exposure:{value:null},u_groundHeight:{value:null}},vertexShader:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vec4 worldPosition = screenPlaneWorldPosition;",THREE.ShaderChunk.oceanfft_vertex,"vWorldPosition = oceanfftWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * oceanfftWorldPosition;","gl_Position = projectionMatrix * viewMatrix * oceanfftWorldPosition;","}"].join("\n"),vertexShaderNoTexLookup:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vWorldPosition = screenPlaneWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * screenPlaneWorldPosition;","gl_Position = projectionMatrix * viewMatrix * screenPlaneWorldPosition;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform sampler2D u_reflection;","uniform sampler2D u_normalMap;","uniform vec3 u_oceanColor;","uniform vec3 u_sunDirection;","uniform float u_exposure;","vec3 hdr (vec3 color, float exposure) {","return 1.0 - exp(-color * exposure);","}",THREE.ShaderChunk.screenplane_pars_fragment,"void main (void) {","vec3 normal = texture2D( u_normalMap, vWorldPosition.xz * 0.002 ).rgb;","vec3 view = normalize( vCamPosition - vWorldPosition );","vec3 reflection = normalize( reflect( -u_sunDirection, normal ) );","float specularFactor = pow( max( 0.0, dot( view, reflection ) ), 500.0 ) * 20.0;","vec3 distortion = 200.0 * normal * vec3( 1.0, 0.0, 0.1 );","vec3 reflectionColor = texture2DProj( u_reflection, vReflectCoordinates.xyz + distortion ).xyz;","float distanceRatio = min( 1.0, log( 1.0 / length( vCamPosition - vWorldPosition ) * 3000.0 + 1.0 ) );","distanceRatio *= distanceRatio;","distanceRatio = distanceRatio * 0.7 + 0.3;","normal = ( distanceRatio * normal + vec3( 0.0, 1.0 - distanceRatio, 0.0 ) ) * 0.5;","normal /= length( normal );","float fresnel = pow( 1.0 - dot( normal, view ), 2.0 );","float skyFactor = ( fresnel + 0.2 ) * 10.0;","vec3 waterColor = ( 1.0 - fresnel ) * u_oceanColor;","vec3 color = ( skyFactor + specularFactor + waterColor ) * reflectionColor + waterColor * 0.5 ;","color = hdr( color, u_exposure );","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")}},function(e,t,r){"use strict";window.ThreeBSP=function(){var e;return(e=function(e){this.matrix=new THREE.Matrix4,this.create(e)}).prototype.subtract=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.union=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),(r=new e(r)).matrix=this.matrix,r},e.prototype.intersect=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),n.clipTo(r),n.invert(),r.clipTo(n),n.clipTo(r),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.create=function(t){if(t instanceof THREE.Geometry)this.fromGeometry(t);else if(t instanceof THREE.BufferGeometry)this.fromBufferGeometry(t);else{if(!(t instanceof THREE.Mesh)){if(t instanceof e.Node)return this.tree=t,this;throw new Error("ThreeBSP: is unable to create a BSP for the given input")}this.fromMesh(t)}},e.prototype.fromGeometry=function(t){var r,n,i,a,o,s,l,u=[];for(r=0,n=t.faces.length;r<n;r++)i=t.faces[r],o=t.faceVertexUvs[0][r],l=new e.Polygon,a=t.vertices[i.a],s=o?new THREE.Vector2(o[0].x,o[0].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[0],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.b],s=o?new THREE.Vector2(o[1].x,o[1].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[1],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.c],s=o?new THREE.Vector2(o[2].x,o[2].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[2],s)).applyMatrix4(this.matrix),l.vertices.push(a),l.calculateProperties(),u.push(l);this.tree=new e.Node(u)},e.prototype.fromIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m=t.index.array,v=t.attributes.position.array,g=t.attributes.normal.array,y=t.attributes.uv.array,_=[];for(r=0,n=m.length;r<n;r+=3){for(o=new e.Polygon,s=0;s<3;s++)u=(l=3*(i=m[r+s]))+1,c=l+2,d=(h=2*i)+1,f=g?new THREE.Vector3(g[l],g[u],g[c]):null,p=y?new THREE.Vector2(y[h],y[d]):null,(a=new e.Vertex(v[l],v[u],v[c],f,p)).applyMatrix4(this.matrix),o.vertices.push(a);o.calculateProperties(),_.push(o)}this.tree=new e.Node(_)},e.prototype.fromNonIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l=t.attributes.position.array,u=t.attributes.normal.array,c=t.attributes.uv.array,h=[];for(r=0,n=l.length;r<n;r+=9)a=new e.Polygon,o=u?new THREE.Vector3(u[r],u[r+1],u[r+2]):null,s=c?new THREE.Vector2(c[r],c[r+1]):null,(i=new e.Vertex(l[r],l[r+1],l[r+2],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=u?new THREE.Vector3(u[r+3],u[r+4],u[r+5]):null,s=c?new THREE.Vector2(c[r+2],c[r+3]):null,(i=new e.Vertex(l[r+3],l[r+4],l[r+5],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=u?new THREE.Vector3(u[r+6],u[r+7],u[r+8]):null,s=c?new THREE.Vector2(c[r+4],c[r+5]):null,(i=new e.Vertex(l[r+6],l[r+7],l[r+8])).applyMatrix4(this.matrix),a.vertices.push(i),a.calculateProperties(),h.push(a);this.tree=new e.Node(h)},e.prototype.fromBufferGeometry=function(e){null===e.index?this.fromNonIndexedBufferGeometry(e):this.fromIndexedBufferGeometry(e)},e.prototype.fromMesh=function(e){var t=e.geometry;e.updateMatrix(),this.matrix=e.matrix.clone(),this.create(t)},e.prototype.toGeometry=function(){var e,t,r,n,i,a,o,s,l,u,c=(new THREE.Matrix4).getInverse(this.matrix),h=new THREE.Geometry,d=this.tree.allPolygons(),f=d.length,p={};for(e=0;e<f;e++)for(n=(r=d[e]).vertices.length,t=2;t<n;t++)u=[],s=r.vertices[0],u.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(c),void 0!==p[s.x+","+s.y+","+s.z]?i=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),i=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t-1],u.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(c),void 0!==p[s.x+","+s.y+","+s.z]?a=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),a=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t],u.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(c),void 0!==p[s.x+","+s.y+","+s.z]?o=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),o=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),l=new THREE.Face3(i,a,o,new THREE.Vector3(r.normal.x,r.normal.y,r.normal.z)),h.faces.push(l),h.faceVertexUvs[0].push(u);return h},e.prototype.toBufferGeometry=function(){var e,t,r,n,i,a,o,s,l=(new THREE.Matrix4).getInverse(this.matrix),u=new THREE.BufferGeometry,c=[],h=[],d=[],f=[],p=this.tree.allPolygons(),m=p.length,v={},g=0;for(e=0;e<m;e++)for(n=(r=p[e]).vertices.length,t=2;t<n;t++)[],(s=r.vertices[0]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?i=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),i=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),(s=r.vertices[t-1]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?a=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),a=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),(s=r.vertices[t]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?o=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),o=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),c.push(i,a,o);return u.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(f),2)),u.addAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3)),u.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(d),3)),u.setIndex(new THREE.BufferAttribute(new Uint32Array(c),1)),u},e.prototype.toMesh=function(e){var t=this.toGeometry(),r=new THREE.Mesh(t,e);return r.position.setFromMatrixPosition(this.matrix),r.rotation.setFromRotationMatrix(this.matrix),r},(e.Polygon=function(e,t,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=void 0}).prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],r=this.vertices[2];return this.normal=t.clone().subtract(e).cross(r.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this},e.Polygon.prototype.clone=function(){var t,r,n=new e.Polygon;for(t=0,r=this.vertices.length;t<r;t++)n.vertices.push(this.vertices[t].clone());return n.calculateProperties(),n},e.Polygon.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},e.Polygon.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:t>1e-5?1:0},e.Polygon.prototype.classifySide=function(e){var t,r,n,i=0,a=0,o=e.vertices.length;for(t=0;t<o;t++)r=e.vertices[t],1===(n=this.classifyVertex(r))?i++:2===n&&a++;return i>0&&0===a?1:0===i&&a>0?2:0===i&&0===a?0:3},e.Polygon.prototype.splitPolygon=function(t,r,n,i,a){var o=this.classifySide(t);if(0===o)(this.normal.dot(t.normal)>0?r:n).push(t);else if(1===o)i.push(t);else if(2===o)a.push(t);else{var s,l,u,c,h,d,f,p,m,v=[],g=[];for(l=0,s=t.vertices.length;l<s;l++)u=(l+1)%s,d=t.vertices[l],f=t.vertices[u],c=this.classifyVertex(d),h=this.classifyVertex(f),2!=c&&v.push(d),1!=c&&g.push(d),3==(c|h)&&(p=(this.w-this.normal.dot(d))/this.normal.dot(f.clone().subtract(d)),m=d.interpolate(f,p),v.push(m),g.push(m));v.length>=3&&i.push(new e.Polygon(v).calculateProperties()),g.length>=3&&a.push(new e.Polygon(g).calculateProperties())}},(e.Vertex=function(e,t,r,n,i){this.x=e,this.y=t,this.z=r,this.normal=n||new THREE.Vector3,this.uv=i||new THREE.Vector2}).prototype.clone=function(){return new e.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},e.Vertex.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.Vertex.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.Vertex.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.Vertex.prototype.cross=function(e){var t=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-r*e.x,this},e.Vertex.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},e.Vertex.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.Vertex.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this},e.Vertex.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},e.Vertex.prototype.applyMatrix4=function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this},(e.Node=function(t){var r,n,i=[],a=[];if(this.polygons=[],this.front=this.back=void 0,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front=new e.Node(i)),a.length>0&&(this.back=new e.Node(a))}}).isConvex=function(e){var t,r;for(t=0;t<e.length;t++)for(r=0;r<e.length;r++)if(t!==r&&2!==e[t].classifySide(e[r]))return!1;return!0},e.Node.prototype.build=function(t){var r,n,i=[],a=[];for(this.divider||(this.divider=t[0].clone()),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front||(this.front=new e.Node),this.front.build(i)),a.length>0&&(this.back||(this.back=new e.Node),this.back.build(a))},e.Node.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.Node.prototype.clone=function(){var t=new e.Node;return t.divider=this.divider.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t},e.Node.prototype.invert=function(){var e,t,r;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),r=this.front,this.front=this.back,this.back=r,this},e.Node.prototype.clipPolygons=function(e){var t,r,n,i;if(!this.divider)return e.slice();for(n=[],i=[],t=0,r=e.length;t<r;t++)this.divider.splitPolygon(e[t],n,i,n,i);return this.front&&(n=this.front.clipPolygons(n)),i=this.back?this.back.clipPolygons(i):[],n.concat(i)},e.Node.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e}()},function(e,t){const r=/\bvoid\s+main\s*\(\s*\)\s*{/g;function n(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){let r=THREE.ShaderChunk[t];return r?n(r):e})}const i=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}return e};let a=0;const o=Date.now(),s=new WeakMap;function l(e,t){return"uniforms"===e?void 0:t}THREE.createDerivedMaterial=function(e,t){const u=function(e){return JSON.stringify(e,l)}(t);let c=s.get(e);if(c||(c=Object.create(null),s.set(e,c)),c[u])return c[u].clone();const h=++a,d=`_derivedShaders${h}`,f=`_onBeforeCompile${h}`;let p,m;function v(a){e.onBeforeCompile.call(this,a);const{vertex:s,fragment:l}=this[d]||(this[d]={vertex:{},fragment:{}});if(s.source!==a.vertexShader||l.source!==a.fragmentShader){const e=function({vertexShader:e,fragmentShader:t},i,a){let{vertexDefs:o,vertexTransform:s,vertexMainIntro:l,fragmentDefs:u,fragmentDiffuseTransform:c,fragmentMainIntro:h,fragmentColorTransform:d,timeUniform:f}=i;if(f){const e=`\nuniform float ${f};\n`;o=(o||"")+e,u=(u||"")+e}(o||s||l)&&(s&&(e=n(e),o=`\n        ${o||""}\n        void vertexTransform_${a}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n          ${s}\n        }\n      `,e=e.replace(/\b(position|normal|uv)\b/g,(e,t,r,n)=>/\battribute\s+vec3\s+$/.test(n.substr(0,r))?t:`_${t}_${a}`),l=`\n        vec3 _position_${a} = vec3(position);\n        vec3 _normal_${a} = vec3(normal);\n        vec2 _uv_${a} = vec2(uv);\n        vertexTransform_${a}(_position_${a}, _normal_${a}, _uv_${a});\n        ${l||""}\n      `),e=e.replace(r,`${o||""}\n\n$&\n\n${l||""}`));(u||c||h||d)&&(t=n(t),c&&(u=`\n        ${u||""}\n        void fragmentDiffuseTransform_${a}(inout vec3 diffuse) {\n          ${c}\n        }\n      `,t=t.replace(/\b(diffuse)\b/g,(e,t,r,n)=>/\buniform\s+vec3\s+$/.test(n.substr(0,r))?t:`_${t}_${a}`),h=`\n        vec3 _diffuse_${a} = diffuse;\n        fragmentDiffuseTransform_${a}(_diffuse_${a});\n        ${h||""}\n      `),t=t.replace(r,`\n      ${u||""}\n      void threejsMain_${a}() {\n      ${h||""}\n    `),t+=`\n      void main() {\n        threejsMain_${a}();\n        ${d||""}\n      }\n    `);return{vertexShader:e,fragmentShader:t}}(a,t,h);s.source=a.vertexShader,s.result=e.vertexShader,l.source=a.fragmentShader,l.result=e.fragmentShader}a.vertexShader=s.result,a.fragmentShader=l.result,i(a.uniforms,this.uniforms),t.timeUniform&&(a.uniforms[t.timeUniform]={get value(){return Date.now()-o}}),this[f]&&this[f](a)}function g(){e.constructor.apply(this,arguments),this._listeners=void 0}g.prototype=Object.create(e,{constructor:{value:g},isDerivedMaterial:{value:!0},baseMaterial:{value:e},onBeforeCompile:{get:()=>v,set(e){this[f]=e}},copy:{value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(this.extensions=t.extensions,this.defines=i({},t.defines),this.uniforms=THREE.UniformsUtils.clone(t.uniforms)),this}},getDepthMaterial:{value:function(){let r=this._depthMaterial;return r||(m||((m=createDerivedMaterial(e.isDerivedMaterial?e.getDepthMaterial():new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking}),t)).defines.IS_DEPTH_MATERIAL=""),r=this._depthMaterial=m.clone()),r}},getDistanceMaterial:{value:function(){let r=this._distanceMaterial;return r||(p||((p=createDerivedMaterial(e.isDerivedMaterial?e.getDistanceMaterial():new THREE.MeshDistanceMaterial,t)).defines.IS_DISTANCE_MATERIAL=""),r=this._distanceMaterial=p.clone()),r}},dispose:{value(){const{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}});const y=new g;return y.copy(e),y.uniforms=i(THREE.UniformsUtils.clone(e.uniforms||{}),t.uniforms),y.defines=i({},e.defines,t.defines),y.defines.DERIVED_MATERIAL=h,y.extensions=i({},e.extensions,t.extensions),c[u]=y,y.clone()};const u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};THREE.getShadersForMaterial=function(e){let t=u[e.type];return t?THREE.ShaderLib[t]:e},THREE.getShaderUniformTypes=function(e){let t,r=/\buniform\s+(int|float|vec[234])\s+([A-Za-z_][\w]*)/g,n=Object.create(null);for(;null!==(t=r.exec(e));)n[t[2]]=t[1];return n}},function(e,t){THREE.OrthographicTrackballControls=function(e,t){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=!0,a=n.NONE,o=n.NONE,s=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector2,h=new THREE.Vector2,d=0,f=0,p=new THREE.Vector2,m=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var v={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var _,b,E,w,x,T,S=(_=new THREE.Vector2,function(e,t){return _.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),_}),M=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,a){n.set((i-.5*r.screen.width-r.screen.left)/r.radius,(.5*r.screen.height+r.screen.top-a)/r.radius,0);var o=n.length();return r.noRoll?o<Math.SQRT1_2?n.z=Math.sqrt(1-o*o):n.z=.5/o:o>1?n.normalize():n.z=Math.sqrt(1-o*o),s.copy(r.object.position).sub(r.target),e.copy(r.object.up).setLength(n.y),e.add(t.copy(r.object.up).cross(s).setLength(n.x)),e.add(s.setLength(n.z)),e}}();function R(e){!1!==r.enabled&&(window.removeEventListener("keydown",R),o=a,a===n.NONE&&(e.keyCode!==r.keys[n.ROTATE]||r.noRotate?e.keyCode!==r.keys[n.ZOOM]||r.noZoom?e.keyCode!==r.keys[n.PAN]||r.noPan||(a=n.PAN):a=n.ZOOM:a=n.ROTATE))}function A(e){!1!==r.enabled&&(a=o,window.addEventListener("keydown",R,!1))}function k(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a===n.NONE&&(a=e.button),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||(p.copy(S(e.pageX,e.pageY)),m.copy(p)):(c.copy(S(e.pageX,e.pageY)),h.copy(c)):(l.copy(M(e.pageX,e.pageY)),u.copy(l)),document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",C,!1),r.dispatchEvent(g))}function P(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||m.copy(S(e.pageX,e.pageY)):h.copy(S(e.pageX,e.pageY)):u.copy(M(e.pageX,e.pageY)))}function C(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a=n.NONE,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",C),r.dispatchEvent(y))}function L(e){if(!1!==r.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),c.y+=.01*t,r.dispatchEvent(g),r.dispatchEvent(y)}}function I(e){if(!1!==r.enabled){switch(e.touches.length){case 1:a=n.TOUCH_ROTATE,l.copy(M(e.touches[0].pageX,e.touches[0].pageY)),u.copy(l);break;case 2:a=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;f=d=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;p.copy(S(o,s)),m.copy(p);break;default:a=n.NONE}r.dispatchEvent(g)}}function O(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:u.copy(M(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;f=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(S(o,s));break;default:a=n.NONE}}function H(e){if(!1!==r.enabled){switch(e.touches.length){case 1:u.copy(M(e.touches[0].pageX,e.touches[0].pageY)),l.copy(u);break;case 2:d=f=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(S(t,i)),p.copy(m)}a=n.NONE,r.dispatchEvent(y)}}function D(e){e.preventDefault()}this.rotateCamera=(b=new THREE.Vector3,E=new THREE.Quaternion,function(){var e=Math.acos(l.dot(u)/l.length()/u.length());e&&(b.crossVectors(l,u).normalize(),e*=r.rotateSpeed,E.setFromAxisAngle(b,-e),s.applyQuaternion(E),r.object.up.applyQuaternion(E),u.applyQuaternion(E),r.staticMoving?l.copy(u):(E.setFromAxisAngle(b,e*(r.dynamicDampingFactor-1)),l.applyQuaternion(E)),i=!0)}),this.zoomCamera=function(){if(a===n.TOUCH_ZOOM_PAN){var e=f/d;d=f,r.object.zoom*=e,i=!0}else{e=1+(h.y-c.y)*r.zoomSpeed;Math.abs(e-1)>1e-6&&e>0&&(r.object.zoom/=e,r.staticMoving?c.copy(h):c.y+=(h.y-c.y)*this.dynamicDampingFactor,i=!0)}},this.panCamera=(w=new THREE.Vector2,x=new THREE.Vector3,T=new THREE.Vector3,function(){if(w.copy(m).sub(p),w.lengthSq()){var e=(r.object.right-r.object.left)/r.object.zoom,t=(r.object.top-r.object.bottom)/r.object.zoom;w.x*=e*r.panSpeed,w.y*=t*r.panSpeed,T.copy(s).cross(r.object.up).setLength(w.x),T.add(x.copy(r.object.up).setLength(w.y)),r.object.position.add(T),r.target.add(T),r.staticMoving?p.copy(m):p.add(w.subVectors(m,p).multiplyScalar(r.dynamicDampingFactor)),i=!0}}),this.update=function(){s.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||(r.zoomCamera(),i&&r.object.updateProjectionMatrix()),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,s),r.object.lookAt(r.target),i&&(r.dispatchEvent(v),i=!1)},this.reset=function(){a=n.NONE,o=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),s.subVectors(r.object.position,r.target),r.object.left=r.left0,r.object.right=r.right0,r.object.top=r.top0,r.object.bottom=r.bottom0,r.object.lookAt(r.target),r.dispatchEvent(v),i=!1},this.disableEvents=function(){this.domElement.removeEventListener("contextmenu",D,!1),this.domElement.removeEventListener("mousedown",k,!1),this.domElement.removeEventListener("wheel",L,!1),this.domElement.removeEventListener("MozMousePixelScroll",L,!1),this.domElement.removeEventListener("touchstart",I,!1),this.domElement.removeEventListener("touchend",H,!1),this.domElement.removeEventListener("touchmove",O,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",C,!1),window.removeEventListener("keydown",R,!1),window.removeEventListener("keyup",A,!1)},this.dispose=this.disableEvents,this.enableEvents=function(){this.domElement.addEventListener("contextmenu",D,!1),this.domElement.addEventListener("mousedown",k,!1),this.domElement.addEventListener("wheel",L,!1),this.domElement.addEventListener("MozMousePixelScroll",L,!1),this.domElement.addEventListener("touchstart",I,!1),this.domElement.addEventListener("touchend",H,!1),this.domElement.addEventListener("touchmove",O,!1),window.addEventListener("keydown",R,!1),window.addEventListener("keyup",A,!1)},this.enableEvents(),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls},function(e,t,r){"use strict";var n=r(119),i=r(1),a=r(23),o=r(13),s=r(24),l=Object.prototype.toString,u=0,c=-1,h=0,d=8;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==u)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=n.deflateSetDictionary(this.strm,p))!==u)throw new Error(o[r]);this._dict_set=!0}}function p(e,t){var r=new f(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}f.prototype.push=function(e,t){var r,o,s=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(c),s.next_out=0,s.avail_out=c),1!==(r=n.deflate(s,o))&&r!==u)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===u):2!==o||(this.onEnd(u),s.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=f,t.deflate=p,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},function(e,t,r){"use strict";var n,i=r(1),a=r(120),o=r(21),s=r(22),l=r(13),u=0,c=1,h=3,d=4,f=5,p=0,m=1,v=-2,g=-3,y=-5,_=-1,b=1,E=2,w=3,x=4,T=0,S=2,M=8,R=9,A=15,k=8,P=286,C=30,L=19,I=2*P+1,O=15,H=3,D=258,N=D+H+1,F=32,U=42,B=69,z=73,j=91,V=103,G=113,W=666,X=1,Y=2,q=3,Z=4,J=3;function K(e,t){return e.msg=l[t],t}function Q(e){return(e<<1)-(e>4?9:0)}function $(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function te(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function re(e,t){e.pending_buf[e.pending++]=t}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-N?e.strstart-(e.w_size-N):0,u=e.window,c=e.w_mask,h=e.prev,d=e.strstart+D,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===f&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<d);if(n=D-(d-a),a=d-D,n>o){if(e.match_start=t,o=n,n>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=h[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function ae(e){var t,r,n,a,l,u,c,h,d,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-N)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=p?n-p:0}while(--r);t=r=p;do{n=e.prev[--t],e.prev[t]=n>=p?n-p:0}while(--r);a+=p}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,h=e.strstart+e.lookahead,d=a,f=void 0,(f=u.avail_in)>d&&(f=d),r=0===f?0:(u.avail_in-=f,i.arraySet(c,u.input,u.next_in,f,h),1===u.state.wrap?u.adler=o(u.adler,c,f,h):2===u.state.wrap&&(u.adler=s(u.adler,c,f,h)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=H)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+H-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<H)););}while(e.lookahead<N&&0!==e.strm.avail_in)}function oe(e,t){for(var r,n;;){if(e.lookahead<N){if(ae(e),e.lookahead<N&&t===u)return X;if(0===e.lookahead)break}if(r=0,e.lookahead>=H&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-N&&(e.match_length=ie(e,r)),e.match_length>=H)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-H),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=H){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=e.strstart<H-1?e.strstart:H-1,t===d?(te(e,!0),0===e.strm.avail_out?q:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:Y}function se(e,t){for(var r,n,i;;){if(e.lookahead<N){if(ae(e),e.lookahead<N&&t===u)return X;if(0===e.lookahead)break}if(r=0,e.lookahead>=H&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=H-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-N&&(e.match_length=ie(e,r),e.match_length<=5&&(e.strategy===b||e.match_length===H&&e.strstart-e.match_start>4096)&&(e.match_length=H-1)),e.prev_length>=H&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-H,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-H),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=H-1,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return X}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return X}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<H-1?e.strstart:H-1,t===d?(te(e,!0),0===e.strm.avail_out?q:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:Y}function le(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function ue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*I),this.dyn_dtree=new i.Buf16(2*(2*C+1)),this.bl_tree=new i.Buf16(2*(2*L+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(O+1),this.heap=new i.Buf16(2*P+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*P+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ce(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=S,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?U:G,e.adler=2===t.wrap?0:1,t.last_flush=u,a._tr_init(t),p):K(e,v)}function he(e){var t,r=ce(e);return r===p&&((t=e.state).window_size=2*t.w_size,$(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=H-1,t.match_available=0,t.ins_h=0),r}function de(e,t,r,n,a,o){if(!e)return v;var s=1;if(t===_&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>R||r!==M||n<8||n>15||t<0||t>9||o<0||o>x)return K(e,v);8===n&&(n=9);var l=new ue;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+H-1)/H),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,he(e)}n=[new le(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===u)return X;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,te(e,!1),0===e.strm.avail_out))return X;if(e.strstart-e.block_start>=e.w_size-N&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?q:Z):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),X)}),new le(4,4,8,4,oe),new le(4,5,16,8,oe),new le(4,6,32,32,oe),new le(4,4,16,16,se),new le(8,16,32,32,se),new le(8,16,128,128,se),new le(8,32,128,256,se),new le(32,128,258,1024,se),new le(32,258,258,4096,se)],t.deflateInit=function(e,t){return de(e,t,M,A,k,T)},t.deflateInit2=de,t.deflateReset=he,t.deflateResetKeep=ce,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?v:(e.state.gzhead=t,p):v},t.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||t>f||t<0)return e?K(e,v):v;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===W&&t!==d)return K(e,0===e.avail_out?y:v);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===U)if(2===i.wrap)e.adler=0,re(i,31),re(i,139),re(i,8),i.gzhead?(re(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),re(i,255&i.gzhead.time),re(i,i.gzhead.time>>8&255),re(i,i.gzhead.time>>16&255),re(i,i.gzhead.time>>24&255),re(i,9===i.level?2:i.strategy>=E||i.level<2?4:0),re(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(re(i,255&i.gzhead.extra.length),re(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=B):(re(i,0),re(i,0),re(i,0),re(i,0),re(i,0),re(i,9===i.level?2:i.strategy>=E||i.level<2?4:0),re(i,J),i.status=G);else{var g=M+(i.w_bits-8<<4)<<8;g|=(i.strategy>=E||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(g|=F),g+=31-g%31,i.status=G,ne(i,g),0!==i.strstart&&(ne(i,e.adler>>>16),ne(i,65535&e.adler)),e.adler=1}if(i.status===B)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)re(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=z)}else i.status=z;if(i.status===z)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,re(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=j)}else i.status=j;if(i.status===j)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,re(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=V)}else i.status=V;if(i.status===V&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(re(i,255&e.adler),re(i,e.adler>>8&255),e.adler=0,i.status=G)):i.status=G),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&Q(t)<=Q(r)&&t!==d)return K(e,y);if(i.status===W&&0!==e.avail_in)return K(e,y);if(0!==e.avail_in||0!==i.lookahead||t!==u&&i.status!==W){var _=i.strategy===E?function(e,t){for(var r;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===u)return X;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?q:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:Y}(i,t):i.strategy===w?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=D){if(ae(e),e.lookahead<=D&&t===u)return X;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=H&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+D;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=D-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=H?(r=a._tr_tally(e,1,e.match_length-H),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?q:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:Y}(i,t):n[i.level].func(i,t);if(_!==q&&_!==Z||(i.status=W),_===X||_===q)return 0===e.avail_out&&(i.last_flush=-1),p;if(_===Y&&(t===c?a._tr_align(i):t!==f&&(a._tr_stored_block(i,0,0,!1),t===h&&($(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,p}return t!==d?p:i.wrap<=0?m:(2===i.wrap?(re(i,255&e.adler),re(i,e.adler>>8&255),re(i,e.adler>>16&255),re(i,e.adler>>24&255),re(i,255&e.total_in),re(i,e.total_in>>8&255),re(i,e.total_in>>16&255),re(i,e.total_in>>24&255)):(ne(i,e.adler>>>16),ne(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:m)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==U&&t!==B&&t!==z&&t!==j&&t!==V&&t!==G&&t!==W?K(e,v):(e.state=null,t===G?K(e,g):p):v},t.deflateSetDictionary=function(e,t){var r,n,a,s,l,u,c,h,d=t.length;if(!e||!e.state)return v;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==U||r.lookahead)return v;for(1===s&&(e.adler=o(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===s&&($(r.head),r.strstart=0,r.block_start=0,r.insert=0),h=new i.Buf8(r.w_size),i.arraySet(h,t,d-r.w_size,r.w_size,0),t=h,d=r.w_size),l=e.avail_in,u=e.next_in,c=e.input,e.avail_in=d,e.next_in=0,e.input=t,ae(r);r.lookahead>=H;){n=r.strstart,a=r.lookahead-(H-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+H-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=H-1,ae(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=H-1,r.match_available=0,e.next_in=u,e.input=c,e.avail_in=l,r.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";var n=r(1),i=4,a=0,o=1,s=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var u=0,c=1,h=2,d=29,f=256,p=f+1+d,m=30,v=19,g=2*p+1,y=15,_=16,b=7,E=256,w=16,x=17,T=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(p+2));l(k);var P=new Array(2*m);l(P);var C=new Array(512);l(C);var L=new Array(256);l(L);var I=new Array(d);l(I);var O,H,D,N=new Array(m);function F(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function U(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function B(e){return e<256?C[e]:C[256+(e>>>7)]}function z(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function j(e,t,r){e.bi_valid>_-r?(e.bi_buf|=t<<e.bi_valid&65535,z(e,e.bi_buf),e.bi_buf=t>>_-e.bi_valid,e.bi_valid+=r-_):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function V(e,t,r){j(e,r[2*t],r[2*t+1])}function G(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function W(e,t,r){var n,i,a=new Array(y+1),o=0;for(n=1;n<=y;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=G(a[s]++,s))}}function X(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*E]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Y(e){e.bi_valid>8?z(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function q(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function Z(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&q(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!q(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function J(e,t,r){var n,i,a,o,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?V(e,i,t):(V(e,(a=L[i])+f+1,t),0!==(o=S[a])&&j(e,i-=I[a],o),V(e,a=B(--n),r),0!==(o=M[a])&&j(e,n-=N[a],o))}while(s<e.last_lit);V(e,E,t)}function K(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=g,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)Z(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Z(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,Z(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=y;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<g;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>p&&(a=p,m++),l[2*n+1]=a,n>u||(e.bl_count[a]++,o=0,n>=f&&(o=d[n-f]),s=l[2*n],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(c[2*n+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),W(a,u,e.bl_count)}function Q(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*w]++):s<=10?e.bl_tree[2*x]++:e.bl_tree[2*T]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function $(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<l&&i===o)){if(s<u)do{V(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(V(e,i,e.bl_tree),s--),V(e,w,e.bl_tree),j(e,s-3,2)):s<=10?(V(e,x,e.bl_tree),j(e,s-3,3)):(V(e,T,e.bl_tree),j(e,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}}l(N);var ee=!1;function te(e,t,r,i){j(e,(u<<1)+(i?1:0),3),function(e,t,r,i){Y(e),i&&(z(e,r),z(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}t._tr_init=function(e){ee||(function(){var e,t,r,n,i,a=new Array(y+1);for(r=0,n=0;n<d-1;n++)for(I[n]=r,e=0;e<1<<S[n];e++)L[r++]=n;for(L[r-1]=n,i=0,n=0;n<16;n++)for(N[n]=i,e=0;e<1<<M[n];e++)C[i++]=n;for(i>>=7;n<m;n++)for(N[n]=i<<7,e=0;e<1<<M[n]-7;e++)C[256+i++]=n;for(t=0;t<=y;t++)a[t]=0;for(e=0;e<=143;)k[2*e+1]=8,e++,a[8]++;for(;e<=255;)k[2*e+1]=9,e++,a[9]++;for(;e<=279;)k[2*e+1]=7,e++,a[7]++;for(;e<=287;)k[2*e+1]=8,e++,a[8]++;for(W(k,p+1,a),e=0;e<m;e++)P[2*e+1]=5,P[2*e]=G(e,5);O=new F(k,S,f+1,p,y),H=new F(P,M,0,m,y),D=new F(new Array(0),R,0,v,b)}(),ee=!0),e.l_desc=new U(e.dyn_ltree,O),e.d_desc=new U(e.dyn_dtree,H),e.bl_desc=new U(e.bl_tree,D),e.bi_buf=0,e.bi_valid=0,X(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,r,n){var l,u,d=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return o;return a}(e)),K(e,e.l_desc),K(e,e.d_desc),d=function(e){var t;for(Q(e,e.dyn_ltree,e.l_desc.max_code),Q(e,e.dyn_dtree,e.d_desc.max_code),K(e,e.bl_desc),t=v-1;t>=3&&0===e.bl_tree[2*A[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),l=e.opt_len+3+7>>>3,(u=e.static_len+3+7>>>3)<=l&&(l=u)):l=u=r+5,r+4<=l&&-1!==t?te(e,t,r,n):e.strategy===i||u===l?(j(e,(c<<1)+(n?1:0),3),J(e,k,P)):(j(e,(h<<1)+(n?1:0),3),function(e,t,r,n){var i;for(j(e,t-257,5),j(e,r-1,5),j(e,n-4,4),i=0;i<n;i++)j(e,e.bl_tree[2*A[i]+1],3);$(e,e.dyn_ltree,t-1),$(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),J(e,e.dyn_ltree,e.dyn_dtree)),X(e),n&&Y(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(L[r]+f+1)]++,e.dyn_dtree[2*B(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){j(e,c<<1,3),V(e,E,k),function(e){16===e.bi_valid?(z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var n=r(122),i=r(1),a=r(23),o=r(25),s=r(13),l=r(24),u=r(125),c=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(s[r]);if(this.header=new u,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[r])}function d(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}h.prototype.push=function(e,t){var r,s,l,u,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=a.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(r=n.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===o.Z_BUF_ERROR&&!0===m&&(r=o.Z_OK,m=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&r!==o.Z_STREAM_END&&(0!==d.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),u=d.next_out-l,h=a.buf2string(d.output,l),d.next_out=u,d.avail_out=f-u,u&&i.arraySet(d.output,d.output,l,u,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,r){"use strict";var n=r(1),i=r(21),a=r(22),o=r(123),s=r(124),l=0,u=1,c=2,h=4,d=5,f=6,p=0,m=1,v=2,g=-2,y=-3,_=-4,b=-5,E=8,w=1,x=2,T=3,S=4,M=5,R=6,A=7,k=8,P=9,C=10,L=11,I=12,O=13,H=14,D=15,N=16,F=17,U=18,B=19,z=20,j=21,V=22,G=23,W=24,X=25,Y=26,q=27,Z=28,J=29,K=30,Q=31,$=32,ee=852,te=592,re=15;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ae(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,p):g}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ae(e)):g}function se(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?g:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,oe(e))):g}function le(e,t){var r,n;return e?(n=new ie,e.state=n,n.window=null,(r=se(e,t))!==p&&(e.state=null),r):g}var ue,ce,he=!0;function de(e){if(he){var t;for(ue=new n.Buf32(512),ce=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(u,e.lens,0,288,ue,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(c,e.lens,0,32,ce,0,e.work,{bits:5}),he=!1}e.lencode=ue,e.lenbits=9,e.distcode=ce,e.distbits=5}function fe(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=oe,t.inflateReset2=se,t.inflateResetKeep=ae,t.inflateInit=function(e){return le(e,re)},t.inflateInit2=le,t.inflate=function(e,t){var r,ee,te,re,ie,ae,oe,se,le,ue,ce,he,pe,me,ve,ge,ye,_e,be,Ee,we,xe,Te,Se,Me=0,Re=new n.Buf8(4),Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return g;(r=e.state).mode===I&&(r.mode=O),ie=e.next_out,te=e.output,oe=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,se=r.hold,le=r.bits,ue=ae,ce=oe,xe=p;e:for(;;)switch(r.mode){case w:if(0===r.wrap){r.mode=O;break}for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(2&r.wrap&&35615===se){r.check=0,Re[0]=255&se,Re[1]=se>>>8&255,r.check=a(r.check,Re,2,0),se=0,le=0,r.mode=x;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",r.mode=K;break}if((15&se)!==E){e.msg="unknown compression method",r.mode=K;break}if(le-=4,we=8+(15&(se>>>=4)),0===r.wbits)r.wbits=we;else if(we>r.wbits){e.msg="invalid window size",r.mode=K;break}r.dmax=1<<we,e.adler=r.check=1,r.mode=512&se?C:I,se=0,le=0;break;case x:for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(r.flags=se,(255&r.flags)!==E){e.msg="unknown compression method",r.mode=K;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=K;break}r.head&&(r.head.text=se>>8&1),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,r.check=a(r.check,Re,2,0)),se=0,le=0,r.mode=T;case T:for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.head&&(r.head.time=se),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,Re[2]=se>>>16&255,Re[3]=se>>>24&255,r.check=a(r.check,Re,4,0)),se=0,le=0,r.mode=S;case S:for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.head&&(r.head.xflags=255&se,r.head.os=se>>8),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,r.check=a(r.check,Re,2,0)),se=0,le=0,r.mode=M;case M:if(1024&r.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.length=se,r.head&&(r.head.extra_len=se),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,r.check=a(r.check,Re,2,0)),se=0,le=0}else r.head&&(r.head.extra=null);r.mode=R;case R:if(1024&r.flags&&((he=r.length)>ae&&(he=ae),he&&(r.head&&(we=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,ee,re,he,we)),512&r.flags&&(r.check=a(r.check,ee,he,re)),ae-=he,re+=he,r.length-=he),r.length))break e;r.length=0,r.mode=A;case A:if(2048&r.flags){if(0===ae)break e;he=0;do{we=ee[re+he++],r.head&&we&&r.length<65536&&(r.head.name+=String.fromCharCode(we))}while(we&&he<ae);if(512&r.flags&&(r.check=a(r.check,ee,he,re)),ae-=he,re+=he,we)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=k;case k:if(4096&r.flags){if(0===ae)break e;he=0;do{we=ee[re+he++],r.head&&we&&r.length<65536&&(r.head.comment+=String.fromCharCode(we))}while(we&&he<ae);if(512&r.flags&&(r.check=a(r.check,ee,he,re)),ae-=he,re+=he,we)break e}else r.head&&(r.head.comment=null);r.mode=P;case P:if(512&r.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(se!==(65535&r.check)){e.msg="header crc mismatch",r.mode=K;break}se=0,le=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=I;break;case C:for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}e.adler=r.check=ne(se),se=0,le=0,r.mode=L;case L:if(0===r.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,v;e.adler=r.check=1,r.mode=I;case I:if(t===d||t===f)break e;case O:if(r.last){se>>>=7&le,le-=7&le,r.mode=q;break}for(;le<3;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}switch(r.last=1&se,le-=1,3&(se>>>=1)){case 0:r.mode=H;break;case 1:if(de(r),r.mode=z,t===f){se>>>=2,le-=2;break e}break;case 2:r.mode=F;break;case 3:e.msg="invalid block type",r.mode=K}se>>>=2,le-=2;break;case H:for(se>>>=7&le,le-=7&le;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",r.mode=K;break}if(r.length=65535&se,se=0,le=0,r.mode=D,t===f)break e;case D:r.mode=N;case N:if(he=r.length){if(he>ae&&(he=ae),he>oe&&(he=oe),0===he)break e;n.arraySet(te,ee,re,he,ie),ae-=he,re+=he,oe-=he,ie+=he,r.length-=he;break}r.mode=I;break;case F:for(;le<14;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(r.nlen=257+(31&se),se>>>=5,le-=5,r.ndist=1+(31&se),se>>>=5,le-=5,r.ncode=4+(15&se),se>>>=4,le-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=K;break}r.have=0,r.mode=U;case U:for(;r.have<r.ncode;){for(;le<3;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.lens[Ae[r.have++]]=7&se,se>>>=3,le-=3}for(;r.have<19;)r.lens[Ae[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Te={bits:r.lenbits},xe=s(l,r.lens,0,19,r.lencode,0,r.work,Te),r.lenbits=Te.bits,xe){e.msg="invalid code lengths set",r.mode=K;break}r.have=0,r.mode=B;case B:for(;r.have<r.nlen+r.ndist;){for(;ge=(Me=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,ye=65535&Me,!((ve=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(ye<16)se>>>=ve,le-=ve,r.lens[r.have++]=ye;else{if(16===ye){for(Se=ve+2;le<Se;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(se>>>=ve,le-=ve,0===r.have){e.msg="invalid bit length repeat",r.mode=K;break}we=r.lens[r.have-1],he=3+(3&se),se>>>=2,le-=2}else if(17===ye){for(Se=ve+3;le<Se;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}le-=ve,we=0,he=3+(7&(se>>>=ve)),se>>>=3,le-=3}else{for(Se=ve+7;le<Se;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}le-=ve,we=0,he=11+(127&(se>>>=ve)),se>>>=7,le-=7}if(r.have+he>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=K;break}for(;he--;)r.lens[r.have++]=we}}if(r.mode===K)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=K;break}if(r.lenbits=9,Te={bits:r.lenbits},xe=s(u,r.lens,0,r.nlen,r.lencode,0,r.work,Te),r.lenbits=Te.bits,xe){e.msg="invalid literal/lengths set",r.mode=K;break}if(r.distbits=6,r.distcode=r.distdyn,Te={bits:r.distbits},xe=s(c,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Te),r.distbits=Te.bits,xe){e.msg="invalid distances set",r.mode=K;break}if(r.mode=z,t===f)break e;case z:r.mode=j;case j:if(ae>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,o(e,ce),ie=e.next_out,te=e.output,oe=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,se=r.hold,le=r.bits,r.mode===I&&(r.back=-1);break}for(r.back=0;ge=(Me=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,ye=65535&Me,!((ve=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(ge&&0==(240&ge)){for(_e=ve,be=ge,Ee=ye;ge=(Me=r.lencode[Ee+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Me,!(_e+(ve=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}se>>>=_e,le-=_e,r.back+=_e}if(se>>>=ve,le-=ve,r.back+=ve,r.length=ye,0===ge){r.mode=Y;break}if(32&ge){r.back=-1,r.mode=I;break}if(64&ge){e.msg="invalid literal/length code",r.mode=K;break}r.extra=15&ge,r.mode=V;case V:if(r.extra){for(Se=r.extra;le<Se;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.length+=se&(1<<r.extra)-1,se>>>=r.extra,le-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=G;case G:for(;ge=(Me=r.distcode[se&(1<<r.distbits)-1])>>>16&255,ye=65535&Me,!((ve=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(0==(240&ge)){for(_e=ve,be=ge,Ee=ye;ge=(Me=r.distcode[Ee+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Me,!(_e+(ve=Me>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}se>>>=_e,le-=_e,r.back+=_e}if(se>>>=ve,le-=ve,r.back+=ve,64&ge){e.msg="invalid distance code",r.mode=K;break}r.offset=ye,r.extra=15&ge,r.mode=W;case W:if(r.extra){for(Se=r.extra;le<Se;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}r.offset+=se&(1<<r.extra)-1,se>>>=r.extra,le-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=K;break}r.mode=X;case X:if(0===oe)break e;if(he=ce-oe,r.offset>he){if((he=r.offset-he)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=K;break}he>r.wnext?(he-=r.wnext,pe=r.wsize-he):pe=r.wnext-he,he>r.length&&(he=r.length),me=r.window}else me=te,pe=ie-r.offset,he=r.length;he>oe&&(he=oe),oe-=he,r.length-=he;do{te[ie++]=me[pe++]}while(--he);0===r.length&&(r.mode=j);break;case Y:if(0===oe)break e;te[ie++]=r.length,oe--,r.mode=j;break;case q:if(r.wrap){for(;le<32;){if(0===ae)break e;ae--,se|=ee[re++]<<le,le+=8}if(ce-=oe,e.total_out+=ce,r.total+=ce,ce&&(e.adler=r.check=r.flags?a(r.check,te,ce,ie-ce):i(r.check,te,ce,ie-ce)),ce=oe,(r.flags?se:ne(se))!==r.check){e.msg="incorrect data check",r.mode=K;break}se=0,le=0}r.mode=Z;case Z:if(r.wrap&&r.flags){for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8}if(se!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=K;break}se=0,le=0}r.mode=J;case J:xe=m;break e;case K:xe=y;break e;case Q:return _;case $:default:return g}return e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,(r.wsize||ce!==e.avail_out&&r.mode<K&&(r.mode<q||t!==h))&&fe(e,e.output,e.next_out,ce-e.avail_out)?(r.mode=Q,_):(ue-=e.avail_in,ce-=e.avail_out,e.total_in+=ue,e.total_out+=ce,r.total+=ce,r.wrap&&ce&&(e.adler=r.check=r.flags?a(r.check,te,ce,e.next_out-ce):i(r.check,te,ce,e.next_out-ce)),e.data_type=r.bits+(r.last?64:0)+(r.mode===I?128:0)+(r.mode===z||r.mode===D?256:0),(0===ue&&0===ce||t===h)&&xe===p&&(xe=b),xe)},t.inflateEnd=function(e){if(!e||!e.state)return g;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?g:(r.head=t,t.done=!1,p):g},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==L?g:r.mode===L&&i(1,t,n,0)!==r.check?y:fe(e,t,n,n)?(r.mode=Q,_):(r.havedict=1,p):g},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,v,g,y,_,b,E,w,x,T,S,M;r=e.state,n=e.next_in,S=e.input,i=n+(e.avail_in-5),a=e.next_out,M=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,d=r.window,f=r.hold,p=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(f+=S[n++]<<p,p+=8,f+=S[n++]<<p,p+=8),_=m[f&g];t:for(;;){if(f>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))M[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&_,(b&=15)&&(p<b&&(f+=S[n++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=S[n++]<<p,p+=8,f+=S[n++]<<p,p+=8),_=v[f&y];r:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=v[(65535&_)+(f&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=S[n++]<<p,(p+=8)<b&&(f+=S[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=0,T=d,0===h){if(x+=u-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}else if(h<b){if(x+=u+h-b,(b-=h)<E){E-=b;do{M[a++]=d[x++]}while(--b);if(x=0,h<E){E-=b=h;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}}else if(x+=h-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}for(;E>2;)M[a++]=T[x++],M[a++]=T[x++],M[a++]=T[x++],E-=3;E&&(M[a++]=T[x++],E>1&&(M[a++]=T[x++]))}else{x=a-w;do{M[a++]=M[x++],M[a++]=M[x++],M[a++]=M[x++],E-=3}while(E>2);E&&(M[a++]=M[x++],E>1&&(M[a++]=M[x++]))}break}}break}}while(n<i&&a<s);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=p}},function(e,t,r){"use strict";var n=r(1),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,u,c,h,d){var f,p,m,v,g,y,_,b,E,w=d.bits,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=null,O=0,H=new n.Buf16(16),D=new n.Buf16(16),N=null,F=0;for(x=0;x<=15;x++)H[x]=0;for(T=0;T<l;T++)H[t[r+T]]++;for(R=w,M=15;M>=1&&0===H[M];M--);if(R>M&&(R=M),0===M)return u[c++]=20971520,u[c++]=20971520,d.bits=1,0;for(S=1;S<M&&0===H[S];S++);for(R<S&&(R=S),P=1,x=1;x<=15;x++)if(P<<=1,(P-=H[x])<0)return-1;if(P>0&&(0===e||1!==M))return-1;for(D[1]=0,x=1;x<15;x++)D[x+1]=D[x]+H[x];for(T=0;T<l;T++)0!==t[r+T]&&(h[D[t[r+T]]++]=T);if(0===e?(I=N=h,y=19):1===e?(I=i,O-=257,N=a,F-=257,y=256):(I=o,N=s,y=-1),L=0,T=0,x=S,g=c,A=R,k=0,m=-1,v=(C=1<<R)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){_=x-k,h[T]<y?(b=0,E=h[T]):h[T]>y?(b=N[F+h[T]],E=I[O+h[T]]):(b=96,E=0),f=1<<x-k,S=p=1<<A;do{u[g+(L>>k)+(p-=f)]=_<<24|b<<16|E|0}while(0!==p);for(f=1<<x-1;L&f;)f>>=1;if(0!==f?(L&=f-1,L+=f):L=0,T++,0==--H[x]){if(x===M)break;x=t[r+h[T]]}if(x>R&&(L&v)!==m){for(0===k&&(k=R),g+=S,P=1<<(A=x-k);A+k<M&&!((P-=H[A+k])<=0);)A++,P<<=1;if(C+=1<<A,1===e&&C>852||2===e&&C>592)return 1;u[m=L&v]=R<<24|A<<16|g-c|0}}return 0!==L&&(u[g+L]=x-k<<24|64<<16|0),d.bits=R,0}},function(e,t,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){"use strict";var n=r(127),i=r(128),a=r(129),o=r(26),s=r(130),l=r(133),u=r(16),c=r(134),h=r(135),d=127;e.exports=function(e){var t,r,f,p,m,v,g;if(r=e<0||1/e===i?"1":"0",e===n||e===i)return r+(p=u("1",8))+(f=u("0",23));if(e!=e)return r+(p=u("1",8))+(f="1"+u("0",22));if(0===e)return r+(p=u("0",8))+(f=u("0",23));if(v=(e=a(e))-(m=o(e)),m=c(m),v=h(v),m)p=m.length-1;else{for(g=0;g<v.length;g++)if("1"===v[g]){t=g+1;break}p=-t}return f=m+v,p<0?(p<=-d&&(t=d-1),f=f.substring(t)):f=f.substring(1),p=c(p+d),r+(p=l(p,8,"0"))+(f=s(f,23,"0").substring(0,23))}},function(e,t,r){"use strict";var n=new Float32Array(1);new Uint32Array(n.buffer)[0]=2139095040,e.exports=n[0]},function(e,t,r){"use strict";var n=new Float32Array(1);new Uint32Array(n.buffer)[0]=4286578688,e.exports=n[0]},function(e,t,r){"use strict";e.exports=function(e){return e<0?-e:0===e?0:e}},function(e,t,r){"use strict";var n=r(14),i=r(15),a=r(27),o=r(16),s=9007199254740991;e.exports=function(e,t,r){var l,u;if(!n(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(!n(u=r))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+u+"`.");if(0===u.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else u=" ";if(t>s)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(l=(t-e.length)/u.length)<=0?e:(l=a(l),e+o(u,l))}},function(e,t,r){"use strict";var n=r(132);e.exports=function(e){return n(e)&&e%1==0}},function(e,t,r){"use strict";e.exports=function(e){return("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))&&e.valueOf()==e.valueOf()}},function(e,t,r){"use strict";var n=r(14),i=r(15),a=r(27),o=r(16),s=9007199254740991;e.exports=function(e,t,r){var l,u;if(!n(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(!n(u=r))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+u+"`.");if(0===u.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else u=" ";if(t>s)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(l=(t-e.length)/u.length)<=0?e:(l=a(l),o(u,l)+e)}},function(e,t,r){"use strict";var n=r(26);e.exports=function(e){for(var t,r="";e>0;)r=(t=e/2)===(e=n(t))?"0"+r:"1"+r;return r}},function(e,t,r){"use strict";var n=149,i=24;e.exports=function(e){var t,r,a,o;if(t="",0===e)return t;for(o=n,a=0;a<n&&((r=2*e)>=1?(e=r-1,t+="1",o===n&&(o=a)):(e=r,t+="0"),!(1===r||a-o>i));a++);return t}},function(e,t){},function(e,t,r){(function(e){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var t="",i=!1,a=arguments.length-1;a>=-1&&!i;a--){var o=a>=0?arguments[a]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,i="/"===o.charAt(0))}return(i?"/":"")+(t=r(n(t.split("/"),function(e){return!!e}),!i).join("/"))||"."},t.normalize=function(e){var a=t.isAbsolute(e),o="/"===i(e,-1);return(e=r(n(e.split("/"),function(e){return!!e}),!a).join("/"))||a||(e="."),e&&o&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=n(e.split("/")),a=n(r.split("/")),o=Math.min(i.length,a.length),s=o,l=0;l<o;l++)if(i[l]!==a[l]){s=l;break}var u=[];for(l=s;l<i.length;l++)u.push("..");return(u=u.concat(a.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,i=!0,a=e.length-1;a>=1;--a)if(47===(t=e.charCodeAt(a))){if(!i){n=a;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"/":e.slice(0,n)},t.basename=function(e,t){var r=function(e){"string"!=typeof e&&(e+="");var t,r=0,n=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){r=t+1;break}}else-1===n&&(i=!1,n=t+1);return-1===n?"":e.slice(r,n)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,r=0,n=-1,i=!0,a=0,o=e.length-1;o>=0;--o){var s=e.charCodeAt(o);if(47!==s)-1===n&&(i=!1,n=o+1),46===s?-1===t?t=o:1!==a&&(a=1):-1!==t&&(a=-1);else if(!i){r=o+1;break}}return-1===t||-1===n||0===a||1===a&&t===n-1&&t===r+1?"":e.slice(t,n)};var i="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,r(6))},function(e,t,r){
/*! dicom-parser - 1.8.2 - 2018-12-05 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */
e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=79)}([function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(73),i=r(72),a=r(38);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=r;a<s;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return-1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function _(e,t,r,n){return j(B(t,e.length-r),e,r,n)}function b(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return b(e,t,r,n)}function w(e,t,r,n){return j(z(t),e,r,n)}function x(e,t,r,n){return j(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function T(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function S(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=M)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=M));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return u(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return c(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,r);case"utf8":case"utf-8":return S(this,t,r);case"ascii":return R(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return T(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var a=i-n,o=r-t,s=Math.min(a,o),u=this.slice(n,i),c=e.slice(t,r),h=0;h<s;++h)if(u[h]!==c[h]){a=u[h],o=c[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":return b(this,e,t,r);case"latin1":case"binary":return E(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var M=4096;function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function k(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=U(e[a]);return i}function P(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function C(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function I(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function O(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function H(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,n,a){return a||H(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function N(e,t,r,n,a){return a||H(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):O(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):O(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return N(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return N(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:B(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function z(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(0))},function(e,t,r){"use strict";var n=r(10),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=h;var a=r(6);a.inherits=r(5);var o=r(35),s=r(18);a.inherits(h,o);for(var l=i(s.prototype),u=0;u<l.length;u++){var c=l[u];h.prototype[c]||(h.prototype[c]=s.prototype[c])}function h(e){if(!(this instanceof h))return new h(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||n.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!c){var e=s(d);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,r=e.readUint16();return"x"+("00000000"+(t+r).toString(16)).substr(-8)}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){(function(e){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,r(1).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(14);function a(e,t){return void 0!==e.parser?e.parser:t}var o=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=r,this.elements=n}return n(e,[{key:"uint16",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readUint16(this.byteArray,r.dataOffset+2*t)}},{key:"int16",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readInt16(this.byteArray,r.dataOffset+2*t)}},{key:"uint32",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readUint32(this.byteArray,r.dataOffset+4*t)}},{key:"int32",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readInt32(this.byteArray,r.dataOffset+4*t)}},{key:"float",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readFloat(this.byteArray,r.dataOffset+4*t)}},{key:"double",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readDouble(this.byteArray,r.dataOffset+8*t)}},{key:"numStringValues",value:function(e){var t=this.elements[e];if(t&&t.length>0){var r=(0,i.readFixedString)(this.byteArray,t.dataOffset,t.length).match(/\\/g);return null===r?1:r.length+1}}},{key:"string",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){var n=(0,i.readFixedString)(this.byteArray,r.dataOffset,r.length);return t>=0?n.split("\\")[t].trim():n.trim()}}},{key:"text",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){var n=(0,i.readFixedString)(this.byteArray,r.dataOffset,r.length);return t>=0?n.split("\\")[t].replace(/ +$/,""):n.replace(/ +$/,"")}}},{key:"floatString",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){t=void 0!==t?t:0;var n=this.string(e,t);if(void 0!==n)return parseFloat(n)}}},{key:"intString",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){t=void 0!==t?t:0;var n=this.string(e,t);if(void 0!==n)return parseInt(n)}}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var r=a(t,this.byteArrayParser).readUint16,n=this.byteArray,i=t.dataOffset;return"x"+("00000000"+(256*r(n,i)*256+r(n,i+2)).toString(16)).substr(-8)}}}]),e}();t.default=o},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t,r){var n=r(1),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,r)});case 3:return t.nextTick(function(){e.call(null,r,n)});case 4:return t.nextTick(function(){e.call(null,r,n,i)});default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick(function(){e.apply(null,a)})}}}:e.exports=t}).call(this,r(3))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,r,n){if(void 0!==e&&t instanceof e)return t.slice(r,r+n);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+r,n);throw"dicomParser.from: unknown type for byteArray"}}).call(this,r(1).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(11),o=(n=a)&&n.__esModule?n:{default:n},s=r(14),l=function(){function t(r,n,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==0&&n instanceof e==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=r,this.byteArray=n,this.position=i||0,this.warnings=[]}return i(t,[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var r=(0,o.default)(this.byteArray,this.position,e);return this.position+=e,new t(this.byteArrayParser,r)}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=(0,s.readFixedString)(this.byteArray,this.position,e);return this.position+=e,t}}]),t}();t.default=l}).call(this,r(1).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:(0,a.default)(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return t};var n,i=r(4),a=(n=i)&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFixedString=function(e,t,r){if(r<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+r>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var n,i="",a=0;a<r;a++){if(0===(n=e[t+a]))return t+=r,i;i+=String.fromCharCode(n)}return i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var l={tag:(0,o.default)(e),vr:e.readFixedString(2)};return 2===u(l.vr)?(l.length=e.readUint16(),l.dataOffset=e.position):(e.seek(2),l.length=e.readUint32(),l.dataOffset=e.position),4294967295===l.length&&(l.hadUndefinedLength=!0),l.tag===r?l:"SQ"===l.vr?((0,s.default)(e,l,t),l):4294967295===l.length?"x7fe00010"===l.tag?((0,n.default)(e,l,t),l):"UN"===l.vr?((0,i.default)(e,l),l):((0,a.default)(e,l),l):(e.seek(l.length),l)};var n=l(r(42)),i=l(r(41)),a=l(r(24)),o=l(r(4)),s=l(r(40));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDicomDataSetExplicit=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?t.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var a=e.elements;t.position<r;){var o=(0,n.default)(t,e.warnings,i.untilTag);if(a[o.tag]=o,o.tag===i.untilTag)return}if(t.position>r)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?e.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;t.position<r;){var o=(0,i.default)(t,n.untilTag,n.vrCallback);if(a[o.tag]=o,o.tag===n.untilTag)return}};var n=a(r(15)),i=a(r(23));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s,u){if(s=s||1,u=u||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===s)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(r>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(s<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(r+s>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var c=new i.default(e.byteArrayParser,e.byteArray,t.dataOffset),h=(0,a.default)(c);if("xfffee000"!==h.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";c.seek(h.length);var d=c.position;if(1===s)return(0,o.default)(c.byteArray,d+u[r].offset+8,u[r].length);for(var f=l(u,r,s),p=(0,n.default)(c.byteArray,f),m=0,v=r;v<r+s;v++)for(var g=d+u[v].offset+8,y=0;y<u[v].length;y++)p[m++]=c.byteArray[g++];return p};var n=s(r(22)),i=s(r(12)),a=s(r(13)),o=s(r(11));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,r){for(var n=0,i=t;i<t+r;i++)n+=e[i].length;return n}},function(e,t,r){"use strict";(function(t,n,i){var a=r(10);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(void 0),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?n:a.nextTick;y.WritableState=g;var u=r(6);u.inherits=r(5);var c,h={deprecate:r(61)},d=r(34),f=r(9).Buffer,p=i.Uint8Array||function(){},m=r(33);function v(){}function g(e,t){s=s||r(2),e=e||{};var n=t instanceof s;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(u||0===u)?u:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===e.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(a.nextTick(i,n),a.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),T(e,t))}(e,r,n,t,i);else{var o=w(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||E(e,r),n?l(b,e,r,o,i):b(e,r,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function y(e){if(s=s||r(2),!(c.call(y,this)||this instanceof s))return new y(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function _(e,t,r,n,i,a,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function b(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),T(e,t)}function E(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var s=0,l=!0;r;)i[s]=r,r.isBuf||(l=!1),r=r.next,s+=1;i.allBuffers=l,_(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,h=r.callback;if(_(e,t,!1,t.objectMode?1:u.length,u,c,h),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),T(e,t)})}function T(e,t){var r=w(t);return r&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(x,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}u.inherits(y,d),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:h.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===y&&e&&e._writableState instanceof g}})):c=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,r){var n,i=this._writableState,o=!1,s=!i.objectMode&&(n=e,f.isBuffer(n)||n instanceof p);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=v),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),a.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(n,o),i=!1),i}(this,i,e,r))&&(i.pendingcb++,o=function(e,t,r,n,i,a){if(!r){var o=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r)),t}(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,s,n,i,a);return l}(this,i,s,e,t,r)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||E(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},y.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,T(e,t),r&&(t.finished?a.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,r(3),r(63).setImmediate,r(0))},function(e,t,r){(t=e.exports=r(35)).Stream=t,t.Readable=t,t.Writable=r(18),t.Duplex=r(2),t.Transform=r(31),t.PassThrough=r(60)},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,o,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(i(r))for(s=Array.prototype.slice.call(arguments,1),o=(u=r.slice()).length,l=0;l<o;l++)u[l].apply(this,s);return!0},r.prototype.addListener=function(e,t){var o;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var r,a,o,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,a=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){a=s;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var r=e[t]+(e[t+1]<<8);return 32768&r&&(r=r-65535-1),r},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r[4]=e[t+4],r[5]=e[t+5],r[6]=e[t+6],r[7]=e[t+7],new Float64Array(r.buffer)[0]}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,r){if(void 0!==e&&t instanceof e)return e.alloc(r);if(t instanceof Uint8Array)return new Uint8Array(r);throw"dicomParser.alloc: unknown type for byteArray"}}).call(this,r(1).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var o={tag:(0,a.default)(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===o.length&&(o.hadUndefinedLength=!0),o.tag===t?o:s(o,e,r)?((0,i.default)(e,o),o):o.hadUndefinedLength?((0,n.default)(e,o),o):(e.seek(o.length),o)};var n=o(r(24)),i=o(r(39)),a=o(r(4));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e,t,r){if(void 0!==r)return"SQ"===r(e.tag);if(t.position+4<=t.byteArray.length){var n=(0,a.default)(t);return t.seek(-4),"xfffee000"===n||"xfffee0dd"===n}return t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;){var n=e.readUint16();if(65534===n){var i=e.readUint16();if(57357===i){var a=e.readUint32();return 0!==a&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};t.isStringVr=function(e){return n[e]},t.isPrivateTag=function(e){return parseInt(e[4],10)%2==1},t.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n,i){if(n=n||t.basicOffsetTable,i=i||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===n.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(r<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(r>=n.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=n[r],u=o(i,l);if(void 0===u)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var c=s(r,n,i,u);return(0,a.default)(e,t,u,c,i)};var n,i=r(17),a=(n=i)&&n.__esModule?n:{default:n},o=function(e,t){for(var r=0;r<e.length;r++)if(e[r].offset===t)return r},s=function(e,t,r,n){if(e===t.length-1)return r.length-n;for(var i=t[e+1],a=n+1;a<r.length;a++)if(r[a].offset===i)return a-n;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}},function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,r){(function(e,n){var i=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,o=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),l=n[r];r<a;l=n[++r])m(l)||!b(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(r,i){if(y(e.process))return function(){return t.deprecate(r,i).apply(this,arguments)};if(!0===n.noDeprecation)return r;var a=!1;return function(){if(!a){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?console.trace(i):console.error(i),a=!0}return r.apply(this,arguments)}};var a,o={};function s(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,e,n.depth)}function l(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function u(e,t){return e}function c(e,r,n){if(e.customInspect&&r&&x(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return g(i)||(i=c(e,i,n)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return v(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,r);if(a)return a;var o=Object.keys(r),s=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),w(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(r);if(0===o.length){if(x(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(_(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return e.stylize(Date.prototype.toString.call(r),"date");if(w(r))return h(r)}var u,b="",T=!1,S=["{","}"];return f(r)&&(T=!0,S=["[","]"]),x(r)&&(b=" [Function"+(r.name?": "+r.name:"")+"]"),_(r)&&(b=" "+RegExp.prototype.toString.call(r)),E(r)&&(b=" "+Date.prototype.toUTCString.call(r)),w(r)&&(b=" "+h(r)),0!==o.length||T&&0!=r.length?n<0?_(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=T?function(e,t,r,n,i){for(var a=[],o=0,s=t.length;o<s;++o)R(t,String(o))?a.push(d(e,t,r,n,String(o),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(d(e,t,r,n,i,!0))}),a}(e,r,n,s,o):o.map(function(t){return d(e,r,n,s,t,T)}),e.seen.pop(),function(e,t,r){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(u,b,S)):S[0]+b+S[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),R(n,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(r)?c(e,l.value,null):c(e,l.value,r-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function v(e){return"number"==typeof e}function g(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===T(e)}function b(e){return"object"==typeof e&&null!==e}function E(e){return b(e)&&"[object Date]"===T(e)}function w(e){return b(e)&&("[object Error]"===T(e)||e instanceof Error)}function x(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(a)&&(a=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var r=n.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=_,t.isObject=b,t.isDate=E,t.isError=w,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(54);var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,r;console.log("%s - %s",(e=new Date,r=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":"),[e.getDate(),M[e.getMonth()],r].join(" ")),t.format.apply(t,arguments))},t.inherits=r(53),t._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,r(0),r(3))},function(e,t,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=r(29),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function c(e){return!i(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var h=e.exports=g,d=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(a.isFunction(e)){if(l)return e.name;var t=e.toString().match(d);return t&&t[1]}}function p(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(l||!a.isFunction(e))return a.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function v(e,t,r,n,i){throw new h.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function g(e,t){e||v(e,!0,t,"==",h.ok)}function y(e,t,r,o){if(e===t)return!0;if(i(e)&&i(t))return 0===n(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(c(e)&&c(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var l=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return-1!==l&&l===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=_(e),o=_(t);if(i&&!o||!i&&o)return!1;if(i)return e=s.call(e),t=s.call(t),y(e,t,r);var l,u,c=w(e),h=w(t);if(c.length!==h.length)return!1;for(c.sort(),h.sort(),u=c.length-1;u>=0;u--)if(c[u]!==h[u])return!1;for(u=c.length-1;u>=0;u--)if(l=c[u],!y(e[l],t[l],r,n))return!1;return!0}(e,t,r,o))}return r?e===t:e==t}function _(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function b(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function E(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&v(i,r,"Missing expected exception"+n);var o="string"==typeof n,s=!e&&a.isError(i),l=!e&&i&&!r;if((s&&o&&b(i,r)||l)&&v(i,r,"Got unwanted exception"+n),e&&i&&r&&!b(i,r)||!e&&i)throw i}h.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(m(this.actual),128)+" "+this.operator+" "+p(m(this.expected),128),this.generatedMessage=!0);var t=e.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,i=f(t),a=n.indexOf("\n"+i);if(a>=0){var o=n.indexOf("\n",a+1);n=n.substring(o+1)}this.stack=n}}},a.inherits(h.AssertionError,Error),h.fail=v,h.ok=g,h.equal=function(e,t,r){e!=t&&v(e,t,r,"==",h.equal)},h.notEqual=function(e,t,r){e==t&&v(e,t,r,"!=",h.notEqual)},h.deepEqual=function(e,t,r){y(e,t,!1)||v(e,t,r,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(e,t,r){y(e,t,!0)||v(e,t,r,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(e,t,r){y(e,t,!1)&&v(e,t,r,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function e(t,r,n){y(t,r,!0)&&v(t,r,n,"notDeepStrictEqual",e)},h.strictEqual=function(e,t,r){e!==t&&v(e,t,r,"===",h.strictEqual)},h.notStrictEqual=function(e,t,r){e===t&&v(e,t,r,"!==",h.notStrictEqual)},h.throws=function(e,t,r){E(!0,e,t,r)},h.doesNotThrow=function(e,t,r){E(!1,e,t,r)},h.ifError=function(e){if(e)throw e};var w=Object.keys||function(e){var t=[];for(var r in e)o.call(e,r)&&t.push(r);return t}}).call(this,r(0))},function(e,t,r){"use strict";e.exports=a;var n=r(2),i=r(6);function a(e){if(!(this instanceof a))return new a(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush(function(t,r){s(e,t,r)}):s(this,null,null)}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=r(5),i.inherits(a,n),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},function(e,t,r){"use strict";var n=r(9).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=h,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�".repeat(r);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�".repeat(r+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�".repeat(r+2)}}(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�".repeat(this.lastTotal-this.lastNeed):t},a.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r?0:(i=o(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r?0:(i=o(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){"use strict";var n=r(10);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,a=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return a||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){e.exports=r(20).EventEmitter},function(e,t,r){"use strict";(function(t,n){var i=r(10);e.exports=_;var a,o=r(38);_.ReadableState=y,r(20).EventEmitter;var s=function(e,t){return e.listeners(t).length},l=r(34),u=r(9).Buffer,c=t.Uint8Array||function(){},h=r(6);h.inherits=r(5);var d=r(66),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,m=r(65),v=r(33);h.inherits(_,l);var g=["error","close","destroy","pause","resume"];function y(e,t){a=a||r(2),e=e||{};var n=t instanceof a;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=r(32).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function _(e){if(a=a||r(2),!(this instanceof _))return new _(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function b(e,t,r,n,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,T(e)}}(e,o)):(i||(a=function(e,t){var r,n;return n=t,u.isBuffer(n)||n instanceof c||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),n?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):E(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?E(e,o,t,!1):M(e,o)):E(e,o,t,!1))):n||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function E(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&T(e)),M(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=v.destroy,_.prototype._undestroy=v.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),b(this,e,t,!1,r)},_.prototype.unshift=function(e){return b(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return p||(p=r(32).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var w=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=w?e=w:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(S,e):S(e))}function S(e){f("emit readable"),e.emit("readable"),P(e)}function M(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(R,e,t))}function R(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function A(e){f("readable nexttick read 0"),e.read(0)}function k(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),P(e),t.flowing&&!t.reading&&e.read(0)}function P(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function C(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;for(e-=i.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(o===a.length?i+=a:i+=a.slice(0,e),0==(e-=o)){o===a.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=u.allocUnsafe(e),n=t.head,i=1;for(n.data.copy(r),e-=n.data.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(a.copy(r,r.length-e,0,o),0==(e-=o)){o===a.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(o));break}++i}return t.length-=i,r}(e,t),n}(e,t.buffer,t.decoder),r);var r}function L(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function O(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}_.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?L(this):T(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&L(this),null;var n,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(r,t))),null===(n=e>0?C(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&L(this)),null!==n&&this.emit("data",n),n},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var r=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var l=t&&!1===t.end||e===n.stdout||e===n.stderr?y:u;function u(){f("onend"),e.end()}a.endEmitted?i.nextTick(l):r.once("end",l),e.on("unpipe",function t(n,i){f("onunpipe"),n===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",v),e.removeListener("finish",g),e.removeListener("drain",c),e.removeListener("error",m),e.removeListener("unpipe",t),r.removeListener("end",u),r.removeListener("end",y),r.removeListener("data",p),h=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||c())});var c=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,P(e))}}(r);e.on("drain",c);var h=!1,d=!1;function p(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==O(a.pipes,e))&&!h&&(f("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,d=!0),r.pause())}function m(t){f("onerror",t),y(),e.removeListener("error",m),0===s(e,"error")&&e.emit("error",t)}function v(){e.removeListener("finish",g),y()}function g(){f("onfinish"),e.removeListener("close",v),y()}function y(){f("unpipe"),r.unpipe(e)}return r.on("data",p),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",m),e.once("close",v),e.once("finish",g),e.emit("pipe",r),a.flowing||(f("pipe resume"),r.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,r);return this}var o=O(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},_.prototype.on=function(e,t){var r=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&T(this):i.nextTick(A,this))}return r},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(k,e,t))}(this,e)),this},_.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(f("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){f("wrapped data"),r.decoder&&(i=r.decoder.write(i)),(!r.objectMode||null!=i)&&(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<g.length;a++)e.on(g[a],this.emit.bind(this,g[a]));return this._read=function(t){f("wrapped _read",t),n&&(n=!1,e.resume())},this},_._fromList=C}).call(this,r(0),r(3))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var r=new n.default(a.default,e);return function(){!function(){if(r.seek(128),"DICM"!==r.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var e=[],t={};r.position<r.byteArray.length;){var n=r.position,s=(0,o.default)(r,e);if(s.tag>"x0002ffff"){r.position=n;break}s.parser=a.default,t[s.tag]=s}var l=new i.default(r.byteArrayParser,r.byteArray,t);return l.warnings=r.warnings,l.position=r.position,l}()};var n=s(r(12)),i=s(r(7)),a=s(r(21)),o=s(r(15));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var r=(e[t]<<8)+e[t+1];return 32768&r&&(r=r-65535-1),r},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[3]=e[t],r[2]=e[t+1],r[1]=e[t+2],r[0]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[7]=e[t],r[6]=e[t+1],r[5]=e[t+2],r[4]=e[t+3],r[3]=e[t+4],r[2]=e[t+5],r[1]=e[t+6],r[0]=e[t+7],new Float64Array(r.buffer)[0]}}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var n=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===n)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,r);t.items.push(i)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}(e,t,r):function(e,t,r){for(var n=t.dataOffset+t.length;e.position<n;){var i=u(e,r);t.items.push(i)}}(e,t,r)};var n=l(r(7)),i=l(r(23)),a=l(r(13)),o=l(r(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var r=(0,a.default)(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=(0,i.default)(e,void 0,t);if(r[a.tag]=a,"xfffee00d"===a.tag)return new n.default(e.byteArrayParser,e.byteArray,r)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new n.default(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new n.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetImplicit(r.dataSet,e,e.position+r.length,{vrCallback:t})),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var n=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===n)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,r);t.items.push(i)}r.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}(e,t,r):function(e,t,r){for(var n=t.dataOffset+t.length;e.position<n;){var i=u(e,r);t.items.push(i)}}(e,t,r)};var n=l(r(7)),i=l(r(15)),a=l(r(13)),o=l(r(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var r=(0,a.default)(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=(0,i.default)(e,t);if(r[a.tag]=a,"xfffee00d"===a.tag)return new n.default(e.byteArrayParser,e.byteArray,r)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new n.default(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new n.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetExplicit(r.dataSet,e,e.position+r.length)),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;){var n=e.readUint16();if(65534===n){var i=e.readUint16();if(57565===i){var a=e.readUint32();return 0!==a&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==(0,a.default)(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var n=e.readUint32()/4,i=0;i<n;i++){var o=e.readUint32();t.basicOffsetTable.push(o)}for(var s=e.position;e.position<e.byteArray.length;){var l=(0,a.default)(e),u=e.readUint32();if("xfffee0dd"===l)return e.seek(u),void(t.length=e.position-t.dataOffset);if("xfffee000"!==l)return r&&r.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),u>e.byteArray.length-e.position&&(u=e.byteArray.length-e.position),t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u)}r&&r.push("pixel data element "+t.tag+" missing sequence delimiter tag xfffee0dd")};var n,i=r(4),a=(n=i)&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,i=t.vr,a=t.tag;function o(t,r){for(var n="",i=0;i<t;i++)0!==i&&(n+="/"),n+=r.call(e,a,i).toString();return n}if(!0===n.isStringVr(i))r=e.string(a);else{if("AT"===i){var s=e.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"===i?r=o(t.length/2,e.uint16):"SS"===i?r=o(t.length/2,e.int16):"UL"===i?r=o(t.length/4,e.uint32):"SL"===i?r=o(t.length/4,e.int32):"FD"===i?r=o(t.length/8,e.double):"FL"===i&&(r=o(t.length/4,e.float))}return r};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(25))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(o||(o=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?(0,n.default)(e,t,r):(0,i.default)(e,t,0,t.fragments.length)};var n=a(r(26)),i=a(r(17));function a(e){return e&&e.__esModule?e:{default:e}}var o=!1},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){"use strict";var n=r(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,u,c,h,d){var f,p,m,v,g,y,_,b,E,w=d.bits,x=0,T=0,S=0,M=0,R=0,A=0,k=0,P=0,C=0,L=0,I=null,O=0,H=new n.Buf16(16),D=new n.Buf16(16),N=null,F=0;for(x=0;x<=15;x++)H[x]=0;for(T=0;T<l;T++)H[t[r+T]]++;for(R=w,M=15;M>=1&&0===H[M];M--);if(R>M&&(R=M),0===M)return u[c++]=20971520,u[c++]=20971520,d.bits=1,0;for(S=1;S<M&&0===H[S];S++);for(R<S&&(R=S),P=1,x=1;x<=15;x++)if(P<<=1,(P-=H[x])<0)return-1;if(P>0&&(0===e||1!==M))return-1;for(D[1]=0,x=1;x<15;x++)D[x+1]=D[x]+H[x];for(T=0;T<l;T++)0!==t[r+T]&&(h[D[t[r+T]]++]=T);if(0===e?(I=N=h,y=19):1===e?(I=i,O-=257,N=a,F-=257,y=256):(I=o,N=s,y=-1),L=0,T=0,x=S,g=c,A=R,k=0,m=-1,v=(C=1<<R)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){_=x-k,h[T]<y?(b=0,E=h[T]):h[T]>y?(b=N[F+h[T]],E=I[O+h[T]]):(b=96,E=0),f=1<<x-k,S=p=1<<A;do{u[g+(L>>k)+(p-=f)]=_<<24|b<<16|E|0}while(0!==p);for(f=1<<x-1;L&f;)f>>=1;if(0!==f?(L&=f-1,L+=f):L=0,T++,0==--H[x]){if(x===M)break;x=t[r+h[T]]}if(x>R&&(L&v)!==m){for(0===k&&(k=R),g+=S,P=1<<(A=x-k);A+k<M&&!((P-=H[A+k])<=0);)A++,P<<=1;if(C+=1<<A,1===e&&C>852||2===e&&C>592)return 1;u[m=L&v]=R<<24|A<<16|g-c|0}}return 0!==L&&(u[g+L]=x-k<<24|64<<16|0),d.bits=R,0}},function(e,t,r){"use strict";e.exports=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,v,g,y,_,b,E,w,x,T,S,M;r=e.state,n=e.next_in,S=e.input,i=n+(e.avail_in-5),a=e.next_out,M=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,d=r.window,f=r.hold,p=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(f+=S[n++]<<p,p+=8,f+=S[n++]<<p,p+=8),_=m[f&g];t:for(;;){if(f>>>=b=_>>>24,p-=b,0==(b=_>>>16&255))M[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&_,(b&=15)&&(p<b&&(f+=S[n++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=S[n++]<<p,p+=8,f+=S[n++]<<p,p+=8),_=v[f&y];r:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=v[(65535&_)+(f&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=S[n++]<<p,(p+=8)<b&&(f+=S[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=0,T=d,0===h){if(x+=u-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}else if(h<b){if(x+=u+h-b,(b-=h)<E){E-=b;do{M[a++]=d[x++]}while(--b);if(x=0,h<E){E-=b=h;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}}}else if(x+=h-b,b<E){E-=b;do{M[a++]=d[x++]}while(--b);x=a-w,T=M}for(;E>2;)M[a++]=T[x++],M[a++]=T[x++],M[a++]=T[x++],E-=3;E&&(M[a++]=T[x++],E>1&&(M[a++]=T[x++]))}else{x=a-w;do{M[a++]=M[x++],M[a++]=M[x++],M[a++]=M[x++],E-=3}while(E>2);E&&(M[a++]=M[x++],E>1&&(M[a++]=M[x++]))}break}}break}}while(n<i&&a<s);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=p}},function(e,t,r){"use strict";var n=r(8),i=r(28),a=r(27),o=r(47),s=r(46),l=1,u=2,c=0,h=-2,d=1,f=12,p=30,m=852,v=592;function g(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function y(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=d,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(m),t.distcode=t.distdyn=new n.Buf32(v),t.sane=1,t.back=-1,c):h}function _(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,y(e)):h}function b(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,_(e))):h}function E(e,t){var r,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,(r=b(e,t))!==c&&(e.state=null),r):h}var w,x,T=!0;function S(e){if(T){var t;for(w=new n.Buf32(512),x=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(l,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,x,0,e.work,{bits:5}),T=!1}e.lencode=w,e.lenbits=9,e.distcode=x,e.distbits=5}function M(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=_,t.inflateReset2=b,t.inflateResetKeep=y,t.inflateInit=function(e){return E(e,15)},t.inflateInit2=E,t.inflate=function(e,t){var r,m,v,y,_,b,E,w,x,T,R,A,k,P,C,L,I,O,H,D,N,F,U,B,z=0,j=new n.Buf8(4),V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;(r=e.state).mode===f&&(r.mode=13),_=e.next_out,v=e.output,E=e.avail_out,y=e.next_in,m=e.input,b=e.avail_in,w=r.hold,x=r.bits,T=b,R=E,F=c;e:for(;;)switch(r.mode){case d:if(0===r.wrap){r.mode=13;break}for(;x<16;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(2&r.wrap&&35615===w){r.check=0,j[0]=255&w,j[1]=w>>>8&255,r.check=a(r.check,j,2,0),w=0,x=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&w)<<8)+(w>>8))%31){e.msg="incorrect header check",r.mode=p;break}if(8!=(15&w)){e.msg="unknown compression method",r.mode=p;break}if(x-=4,N=8+(15&(w>>>=4)),0===r.wbits)r.wbits=N;else if(N>r.wbits){e.msg="invalid window size",r.mode=p;break}r.dmax=1<<N,e.adler=r.check=1,r.mode=512&w?10:f,w=0,x=0;break;case 2:for(;x<16;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(r.flags=w,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=p;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=p;break}r.head&&(r.head.text=w>>8&1),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,r.check=a(r.check,j,2,0)),w=0,x=0,r.mode=3;case 3:for(;x<32;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}r.head&&(r.head.time=w),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,j[2]=w>>>16&255,j[3]=w>>>24&255,r.check=a(r.check,j,4,0)),w=0,x=0,r.mode=4;case 4:for(;x<16;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}r.head&&(r.head.xflags=255&w,r.head.os=w>>8),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,r.check=a(r.check,j,2,0)),w=0,x=0,r.mode=5;case 5:if(1024&r.flags){for(;x<16;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}r.length=w,r.head&&(r.head.extra_len=w),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,r.check=a(r.check,j,2,0)),w=0,x=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((A=r.length)>b&&(A=b),A&&(r.head&&(N=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,m,y,A,N)),512&r.flags&&(r.check=a(r.check,m,A,y)),b-=A,y+=A,r.length-=A),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===b)break e;A=0;do{N=m[y+A++],r.head&&N&&r.length<65536&&(r.head.name+=String.fromCharCode(N))}while(N&&A<b);if(512&r.flags&&(r.check=a(r.check,m,A,y)),b-=A,y+=A,N)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===b)break e;A=0;do{N=m[y+A++],r.head&&N&&r.length<65536&&(r.head.comment+=String.fromCharCode(N))}while(N&&A<b);if(512&r.flags&&(r.check=a(r.check,m,A,y)),b-=A,y+=A,N)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;x<16;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(w!==(65535&r.check)){e.msg="header crc mismatch",r.mode=p;break}w=0,x=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=f;break;case 10:for(;x<32;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}e.adler=r.check=g(w),w=0,x=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=_,e.avail_out=E,e.next_in=y,e.avail_in=b,r.hold=w,r.bits=x,2;e.adler=r.check=1,r.mode=f;case f:if(5===t||6===t)break e;case 13:if(r.last){w>>>=7&x,x-=7&x,r.mode=27;break}for(;x<3;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}switch(r.last=1&w,x-=1,3&(w>>>=1)){case 0:r.mode=14;break;case 1:if(S(r),r.mode=20,6===t){w>>>=2,x-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=p}w>>>=2,x-=2;break;case 14:for(w>>>=7&x,x-=7&x;x<32;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if((65535&w)!=(w>>>16^65535)){e.msg="invalid stored block lengths",r.mode=p;break}if(r.length=65535&w,w=0,x=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(A=r.length){if(A>b&&(A=b),A>E&&(A=E),0===A)break e;n.arraySet(v,m,y,A,_),b-=A,y+=A,E-=A,_+=A,r.length-=A;break}r.mode=f;break;case 17:for(;x<14;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(r.nlen=257+(31&w),w>>>=5,x-=5,r.ndist=1+(31&w),w>>>=5,x-=5,r.ncode=4+(15&w),w>>>=4,x-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=p;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;x<3;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}r.lens[V[r.have++]]=7&w,w>>>=3,x-=3}for(;r.have<19;)r.lens[V[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,U={bits:r.lenbits},F=s(0,r.lens,0,19,r.lencode,0,r.work,U),r.lenbits=U.bits,F){e.msg="invalid code lengths set",r.mode=p;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;L=(z=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,I=65535&z,!((C=z>>>24)<=x);){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(I<16)w>>>=C,x-=C,r.lens[r.have++]=I;else{if(16===I){for(B=C+2;x<B;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(w>>>=C,x-=C,0===r.have){e.msg="invalid bit length repeat",r.mode=p;break}N=r.lens[r.have-1],A=3+(3&w),w>>>=2,x-=2}else if(17===I){for(B=C+3;x<B;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}x-=C,N=0,A=3+(7&(w>>>=C)),w>>>=3,x-=3}else{for(B=C+7;x<B;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}x-=C,N=0,A=11+(127&(w>>>=C)),w>>>=7,x-=7}if(r.have+A>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=p;break}for(;A--;)r.lens[r.have++]=N}}if(r.mode===p)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=p;break}if(r.lenbits=9,U={bits:r.lenbits},F=s(l,r.lens,0,r.nlen,r.lencode,0,r.work,U),r.lenbits=U.bits,F){e.msg="invalid literal/lengths set",r.mode=p;break}if(r.distbits=6,r.distcode=r.distdyn,U={bits:r.distbits},F=s(u,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,U),r.distbits=U.bits,F){e.msg="invalid distances set",r.mode=p;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(b>=6&&E>=258){e.next_out=_,e.avail_out=E,e.next_in=y,e.avail_in=b,r.hold=w,r.bits=x,o(e,R),_=e.next_out,v=e.output,E=e.avail_out,y=e.next_in,m=e.input,b=e.avail_in,w=r.hold,x=r.bits,r.mode===f&&(r.back=-1);break}for(r.back=0;L=(z=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,I=65535&z,!((C=z>>>24)<=x);){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(L&&0==(240&L)){for(O=C,H=L,D=I;L=(z=r.lencode[D+((w&(1<<O+H)-1)>>O)])>>>16&255,I=65535&z,!(O+(C=z>>>24)<=x);){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}w>>>=O,x-=O,r.back+=O}if(w>>>=C,x-=C,r.back+=C,r.length=I,0===L){r.mode=26;break}if(32&L){r.back=-1,r.mode=f;break}if(64&L){e.msg="invalid literal/length code",r.mode=p;break}r.extra=15&L,r.mode=22;case 22:if(r.extra){for(B=r.extra;x<B;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}r.length+=w&(1<<r.extra)-1,w>>>=r.extra,x-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;L=(z=r.distcode[w&(1<<r.distbits)-1])>>>16&255,I=65535&z,!((C=z>>>24)<=x);){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(0==(240&L)){for(O=C,H=L,D=I;L=(z=r.distcode[D+((w&(1<<O+H)-1)>>O)])>>>16&255,I=65535&z,!(O+(C=z>>>24)<=x);){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}w>>>=O,x-=O,r.back+=O}if(w>>>=C,x-=C,r.back+=C,64&L){e.msg="invalid distance code",r.mode=p;break}r.offset=I,r.extra=15&L,r.mode=24;case 24:if(r.extra){for(B=r.extra;x<B;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}r.offset+=w&(1<<r.extra)-1,w>>>=r.extra,x-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=p;break}r.mode=25;case 25:if(0===E)break e;if(A=R-E,r.offset>A){if((A=r.offset-A)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=p;break}A>r.wnext?(A-=r.wnext,k=r.wsize-A):k=r.wnext-A,A>r.length&&(A=r.length),P=r.window}else P=v,k=_-r.offset,A=r.length;A>E&&(A=E),E-=A,r.length-=A;do{v[_++]=P[k++]}while(--A);0===r.length&&(r.mode=21);break;case 26:if(0===E)break e;v[_++]=r.length,E--,r.mode=21;break;case 27:if(r.wrap){for(;x<32;){if(0===b)break e;b--,w|=m[y++]<<x,x+=8}if(R-=E,e.total_out+=R,r.total+=R,R&&(e.adler=r.check=r.flags?a(r.check,v,R,_-R):i(r.check,v,R,_-R)),R=E,(r.flags?w:g(w))!==r.check){e.msg="incorrect data check",r.mode=p;break}w=0,x=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;x<32;){if(0===b)break e;b--,w+=m[y++]<<x,x+=8}if(w!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=p;break}w=0,x=0}r.mode=29;case 29:F=1;break e;case p:F=-3;break e;case 31:return-4;case 32:default:return h}return e.next_out=_,e.avail_out=E,e.next_in=y,e.avail_in=b,r.hold=w,r.bits=x,(r.wsize||R!==e.avail_out&&r.mode<p&&(r.mode<27||4!==t))&&M(e,e.output,e.next_out,R-e.avail_out)?(r.mode=31,-4):(T-=e.avail_in,R-=e.avail_out,e.total_in+=T,e.total_out+=R,r.total+=R,r.wrap&&R&&(e.adler=r.check=r.flags?a(r.check,v,R,e.next_out-R):i(r.check,v,R,e.next_out-R)),e.data_type=r.bits+(r.last?64:0)+(r.mode===f?128:0)+(20===r.mode||15===r.mode?256:0),(0===T&&0===R||4===t)&&F===c&&(F=-5),F)},t.inflateEnd=function(e){if(!e||!e.state)return h;var t=e.state;return t.window&&(t.window=null),e.state=null,c},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?h:(r.head=t,t.done=!1,c):h},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?h:11===r.mode&&i(1,t,n,0)!==r.check?-3:M(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,c):h},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){"use strict";var n=r(8);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=0,o=256,s=o+1+29,l=30,u=19,c=2*s+1,h=15,d=16,f=256,p=16,m=17,v=18,g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=new Array(2*(s+2));i(E);var w=new Array(2*l);i(w);var x=new Array(512);i(x);var T=new Array(256);i(T);var S=new Array(29);i(S);var M,R,A,k=new Array(l);function P(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function C(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function L(e){return e<256?x[e]:x[256+(e>>>7)]}function I(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function O(e,t,r){e.bi_valid>d-r?(e.bi_buf|=t<<e.bi_valid&65535,I(e,e.bi_buf),e.bi_buf=t>>d-e.bi_valid,e.bi_valid+=r-d):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function H(e,t,r){O(e,r[2*t],r[2*t+1])}function D(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function N(e,t,r){var n,i,a=new Array(h+1),o=0;for(n=1;n<=h;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=D(a[s]++,s))}}function F(e){var t;for(t=0;t<s;t++)e.dyn_ltree[2*t]=0;for(t=0;t<l;t++)e.dyn_dtree[2*t]=0;for(t=0;t<u;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*f]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function U(e){e.bi_valid>8?I(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function B(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function z(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&B(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!B(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function j(e,t,r){var n,i,a,s,l=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===n?H(e,i,t):(H(e,(a=T[i])+o+1,t),0!==(s=g[a])&&O(e,i-=S[a],s),H(e,a=L(--n),r),0!==(s=y[a])&&O(e,n-=k[a],s))}while(l<e.last_lit);H(e,f,t)}function V(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=c,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)z(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],z(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,z(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,u=t.max_code,d=t.stat_desc.static_tree,f=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,v=t.stat_desc.max_length,g=0;for(a=0;a<=h;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<c;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>v&&(a=v,g++),l[2*n+1]=a,n>u||(e.bl_count[a]++,o=0,n>=m&&(o=p[n-m]),s=l[2*n],e.opt_len+=s*(a+o),f&&(e.static_len+=s*(d[2*n+1]+o)));if(0!==g){do{for(a=v-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[v]--,g-=2}while(g>0);for(a=v;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),N(a,u,e.bl_count)}function G(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*p]++):s<=10?e.bl_tree[2*m]++:e.bl_tree[2*v]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function W(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<l&&i===o)){if(s<u)do{H(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(H(e,i,e.bl_tree),s--),H(e,p,e.bl_tree),O(e,s-3,2)):s<=10?(H(e,m,e.bl_tree),O(e,s-3,3)):(H(e,v,e.bl_tree),O(e,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}}i(k);var X=!1;function Y(e,t,r,i){O(e,(a<<1)+(i?1:0),3),function(e,t,r,i){U(e),I(e,r),I(e,~r),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r)}t._tr_init=function(e){X||(function(){var e,t,r,n,i,a=new Array(h+1);for(r=0,n=0;n<28;n++)for(S[n]=r,e=0;e<1<<g[n];e++)T[r++]=n;for(T[r-1]=n,i=0,n=0;n<16;n++)for(k[n]=i,e=0;e<1<<y[n];e++)x[i++]=n;for(i>>=7;n<l;n++)for(k[n]=i<<7,e=0;e<1<<y[n]-7;e++)x[256+i++]=n;for(t=0;t<=h;t++)a[t]=0;for(e=0;e<=143;)E[2*e+1]=8,e++,a[8]++;for(;e<=255;)E[2*e+1]=9,e++,a[9]++;for(;e<=279;)E[2*e+1]=7,e++,a[7]++;for(;e<=287;)E[2*e+1]=8,e++,a[8]++;for(N(E,s+1,a),e=0;e<l;e++)w[2*e+1]=5,w[2*e]=D(e,5);M=new P(E,g,o+1,s,h),R=new P(w,y,0,l,h),A=new P(new Array(0),_,0,u,7)}(),X=!0),e.l_desc=new C(e.dyn_ltree,M),e.d_desc=new C(e.dyn_dtree,R),e.bl_desc=new C(e.bl_tree,A),e.bi_buf=0,e.bi_valid=0,F(e)},t._tr_stored_block=Y,t._tr_flush_block=function(e,t,r,n){var i,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<o;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),V(e,e.l_desc),V(e,e.d_desc),s=function(e){var t;for(G(e,e.dyn_ltree,e.l_desc.max_code),G(e,e.dyn_dtree,e.d_desc.max_code),V(e,e.bl_desc),t=u-1;t>=3&&0===e.bl_tree[2*b[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?Y(e,t,r,n):4===e.strategy||a===i?(O(e,2+(n?1:0),3),j(e,E,w)):(O(e,4+(n?1:0),3),function(e,t,r,n){var i;for(O(e,t-257,5),O(e,r-1,5),O(e,n-4,4),i=0;i<n;i++)O(e,e.bl_tree[2*b[i]+1],3);W(e,e.dyn_ltree,t-1),W(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),j(e,e.dyn_ltree,e.dyn_dtree)),F(e),n&&U(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(T[r]+o+1)]++,e.dyn_dtree[2*L(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){O(e,2,3),H(e,f,E),function(e){16===e.bi_valid?(I(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var n,i=r(8),a=r(50),o=r(28),s=r(27),l=r(49),u=0,c=4,h=0,d=-2,f=-1,p=1,m=4,v=2,g=8,y=9,_=286,b=30,E=19,w=2*_+1,x=15,T=3,S=258,M=S+T+1,R=42,A=103,k=113,P=666,C=1,L=2,I=3,O=4;function H(e,t){return e.msg=l[t],t}function D(e){return(e<<1)-(e>4?9:0)}function N(e){for(var t=e.length;--t>=0;)e[t]=0}function F(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function U(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,F(e.strm)}function B(e,t){e.pending_buf[e.pending++]=t}function z(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function j(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-M?e.strstart-(e.w_size-M):0,u=e.window,c=e.w_mask,h=e.prev,d=e.strstart+S,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===f&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<d);if(n=S-(d-a),a=d-S,n>o){if(e.match_start=t,o=n,n>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=h[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function V(e){var t,r,n,a,l,u,c,h,d,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-M)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=p?n-p:0}while(--r);t=r=p;do{n=e.prev[--t],e.prev[t]=n>=p?n-p:0}while(--r);a+=p}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,h=e.strstart+e.lookahead,d=a,f=void 0,(f=u.avail_in)>d&&(f=d),r=0===f?0:(u.avail_in-=f,i.arraySet(c,u.input,u.next_in,f,h),1===u.state.wrap?u.adler=o(u.adler,c,f,h):2===u.state.wrap&&(u.adler=s(u.adler,c,f,h)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=T)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+T-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<T)););}while(e.lookahead<M&&0!==e.strm.avail_in)}function G(e,t){for(var r,n;;){if(e.lookahead<M){if(V(e),e.lookahead<M&&t===u)return C;if(0===e.lookahead)break}if(r=0,e.lookahead>=T&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-M&&(e.match_length=j(e,r)),e.match_length>=T)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-T),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=T){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(U(e,!1),0===e.strm.avail_out))return C}return e.insert=e.strstart<T-1?e.strstart:T-1,t===c?(U(e,!0),0===e.strm.avail_out?I:O):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?C:L}function W(e,t){for(var r,n,i;;){if(e.lookahead<M){if(V(e),e.lookahead<M&&t===u)return C;if(0===e.lookahead)break}if(r=0,e.lookahead>=T&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=T-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-M&&(e.match_length=j(e,r),e.match_length<=5&&(e.strategy===p||e.match_length===T&&e.strstart-e.match_start>4096)&&(e.match_length=T-1)),e.prev_length>=T&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-T,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-T),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+T-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=T-1,e.strstart++,n&&(U(e,!1),0===e.strm.avail_out))return C}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&U(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return C}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<T-1?e.strstart:T-1,t===c?(U(e,!0),0===e.strm.avail_out?I:O):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?C:L}function X(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function Y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=v,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?R:k,e.adler=2===t.wrap?0:1,t.last_flush=u,a._tr_init(t),h):H(e,d)}function q(e){var t,r=Y(e);return r===h&&((t=e.state).window_size=2*t.w_size,N(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=T-1,t.match_available=0,t.ins_h=0),r}function Z(e,t,r,n,a,o){if(!e)return d;var s=1;if(t===f&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>y||r!==g||n<8||n>15||t<0||t>9||o<0||o>m)return H(e,d);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*w),this.dyn_dtree=new i.Buf16(2*(2*b+1)),this.bl_tree=new i.Buf16(2*(2*E+1)),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(x+1),this.heap=new i.Buf16(2*_+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*_+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+T-1)/T),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,q(e)}n=[new X(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(V(e),0===e.lookahead&&t===u)return C;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,U(e,!1),0===e.strm.avail_out))return C;if(e.strstart-e.block_start>=e.w_size-M&&(U(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===c?(U(e,!0),0===e.strm.avail_out?I:O):(e.strstart>e.block_start&&(U(e,!1),e.strm.avail_out),C)}),new X(4,4,8,4,G),new X(4,5,16,8,G),new X(4,6,32,32,G),new X(4,4,16,16,W),new X(8,16,32,32,W),new X(8,16,128,128,W),new X(8,32,128,256,W),new X(32,128,258,1024,W),new X(32,258,258,4096,W)],t.deflateInit=function(e,t){return Z(e,t,g,15,8,0)},t.deflateInit2=Z,t.deflateReset=q,t.deflateResetKeep=Y,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?d:(e.state.gzhead=t,h):d},t.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||t>5||t<0)return e?H(e,d):d;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===P&&t!==c)return H(e,0===e.avail_out?-5:d);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===R)if(2===i.wrap)e.adler=0,B(i,31),B(i,139),B(i,8),i.gzhead?(B(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),B(i,255&i.gzhead.time),B(i,i.gzhead.time>>8&255),B(i,i.gzhead.time>>16&255),B(i,i.gzhead.time>>24&255),B(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),B(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(B(i,255&i.gzhead.extra.length),B(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(B(i,0),B(i,0),B(i,0),B(i,0),B(i,0),B(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),B(i,3),i.status=k);else{var f=g+(i.w_bits-8<<4)<<8;f|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(f|=32),f+=31-f%31,i.status=k,z(i,f),0!==i.strstart&&(z(i,e.adler>>>16),z(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),F(e),o=i.pending,i.pending!==i.pending_buf_size));)B(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),F(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,B(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),F(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,B(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=A)}else i.status=A;if(i.status===A&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&F(e),i.pending+2<=i.pending_buf_size&&(B(i,255&e.adler),B(i,e.adler>>8&255),e.adler=0,i.status=k)):i.status=k),0!==i.pending){if(F(e),0===e.avail_out)return i.last_flush=-1,h}else if(0===e.avail_in&&D(t)<=D(r)&&t!==c)return H(e,-5);if(i.status===P&&0!==e.avail_in)return H(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==u&&i.status!==P){var p=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(V(e),0===e.lookahead)){if(t===u)return C;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(U(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===c?(U(e,!0),0===e.strm.avail_out?I:O):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?C:L}(i,t):3===i.strategy?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=S){if(V(e),e.lookahead<=S&&t===u)return C;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=T&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+S;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=S-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=T?(r=a._tr_tally(e,1,e.match_length-T),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(U(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===c?(U(e,!0),0===e.strm.avail_out?I:O):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?C:L}(i,t):n[i.level].func(i,t);if(p!==I&&p!==O||(i.status=P),p===C||p===I)return 0===e.avail_out&&(i.last_flush=-1),h;if(p===L&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(N(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),F(e),0===e.avail_out))return i.last_flush=-1,h}return t!==c?h:i.wrap<=0?1:(2===i.wrap?(B(i,255&e.adler),B(i,e.adler>>8&255),B(i,e.adler>>16&255),B(i,e.adler>>24&255),B(i,255&e.total_in),B(i,e.total_in>>8&255),B(i,e.total_in>>16&255),B(i,e.total_in>>24&255)):(z(i,e.adler>>>16),z(i,65535&e.adler)),F(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?h:1)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==R&&69!==t&&73!==t&&91!==t&&t!==A&&t!==k&&t!==P?H(e,d):(e.state=null,t===k?H(e,-3):h):d},t.deflateSetDictionary=function(e,t){var r,n,a,s,l,u,c,f,p=t.length;if(!e||!e.state)return d;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==R||r.lookahead)return d;for(1===s&&(e.adler=o(e.adler,t,p,0)),r.wrap=0,p>=r.w_size&&(0===s&&(N(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new i.Buf8(r.w_size),i.arraySet(f,t,p-r.w_size,r.w_size,0),t=f,p=r.w_size),l=e.avail_in,u=e.next_in,c=e.input,e.avail_in=p,e.next_in=0,e.input=t,V(r);r.lookahead>=T;){n=r.strstart,a=r.lookahead-(T-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+T-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=T-1,V(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=T-1,r.match_available=0,e.next_in=u,e.input=c,e.avail_in=l,r.wrap=s,h},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,r){"use strict";(function(e,n){var i=r(30),a=r(52),o=r(51),s=r(48),l=r(45);for(var u in l)t[u]=l[u];function c(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},c.prototype.write=function(e,t,r,n,i,a,o){return this._write(!0,e,t,r,n,i,a,o)},c.prototype.writeSync=function(e,t,r,n,i,a,o){return this._write(!1,e,t,r,n,i,a,o)},c.prototype._write=function(r,a,o,s,l,u,c,h){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==t.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==t.Z_NO_FLUSH&&a!==t.Z_PARTIAL_FLUSH&&a!==t.Z_SYNC_FLUSH&&a!==t.Z_FULL_FLUSH&&a!==t.Z_FINISH&&a!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),l=0,s=0),this.strm.avail_in=l,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=h,this.strm.output=u,this.strm.next_out=c,this.flush=a,!r)return this._process(),this._checkError()?this._afterSync():void 0;var d=this;return n.nextTick(function(){d._process(),d._after()}),this},c.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},c.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},c.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(e,r,n,a,o){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(r>=-1&&r<=9,"invalid compression level"),i(n>=1&&n<=9,"invalid memlevel"),i(a===t.Z_FILTERED||a===t.Z_HUFFMAN_ONLY||a===t.Z_RLE||a===t.Z_FIXED||a===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(r,e,n,a,o),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(e,r,n,i,l){switch(this.level=e,this.windowBits=r,this.memLevel=n,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=c}).call(this,r(1).Buffer,r(3))},function(e,t,r){e.exports=r(19).PassThrough},function(e,t,r){e.exports=r(19).Transform},function(e,t,r){e.exports=r(2)},function(e,t,r){e.exports=r(18)},function(e,t,r){"use strict";e.exports=a;var n=r(31),i=r(6);function a(e){if(!(this instanceof a))return new a(e);n.call(this,e)}i.inherits=r(5),i.inherits(a,n),a.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){(function(t){function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,r(0))},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,a,o,s,l=1,u={},c=!1,h=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){p(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),n=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data)},n=function(e){a.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,n=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(p,0,e)},d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return u[l]=i,n(l),l++},d.clearImmediate=f}function f(e){delete u[e]}function p(e){if(c)setTimeout(p,0,e);else{var t=u[e];if(t){c=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{f(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(0),r(3))},function(e,t,r){(function(e){var n=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(62),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(0))},function(e,t){},function(e,t,r){"use strict";var n=r(9).Buffer,i=r(64);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,a=n.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,r=a,i=s,t.copy(r,i),s+=o.data.length,o=o.next;return a},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,r){e.exports=i;var n=r(20).EventEmitter;function i(){n.call(this)}r(5)(i,n),i.Readable=r(19),i.Writable=r(59),i.Duplex=r(58),i.Transform=r(57),i.PassThrough=r(56),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===n.listenerCount(this,"error"))throw e}function c(){r.removeListener("data",i),e.removeListener("drain",a),r.removeListener("end",s),r.removeListener("close",l),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",c),r.removeListener("close",c),e.removeListener("close",c)}return r.on("error",u),e.on("error",u),r.on("end",c),r.on("close",c),e.on("close",c),e.emit("pipe",r),e}},function(e,t,r){"use strict";(function(e){var n=r(1).Buffer,i=r(67).Transform,a=r(55),o=r(29),s=r(30).ok,l=r(1).kMaxLength,u="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var c=Object.keys(a),h=0;h<c.length;h++){var d=c[h];d.match(/^Z/)&&Object.defineProperty(t,d,{enumerable:!0,value:a[d],writable:!1})}for(var f={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=Object.keys(f),m=0;m<p.length;m++){var v=p[m];f[f[v]]=v}function g(e,t,r){var i=[],a=0;function o(){for(var t;null!==(t=e.read());)i.push(t),a+=t.length;e.once("readable",o)}function s(){var t,o=null;a>=l?o=new RangeError(u):t=n.concat(i,a),i=[],e.close(),r(o,t)}e.on("error",function(t){e.removeListener("end",s),e.removeListener("readable",o),r(t)}),e.on("end",s),e.end(t),o()}function y(e,t){if("string"==typeof t&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError("Not a string or buffer");var r=e._finishFlushFlag;return e._processChunk(t,r)}function _(e){if(!(this instanceof _))return new _(e);R.call(this,e,a.DEFLATE)}function b(e){if(!(this instanceof b))return new b(e);R.call(this,e,a.INFLATE)}function E(e){if(!(this instanceof E))return new E(e);R.call(this,e,a.GZIP)}function w(e){if(!(this instanceof w))return new w(e);R.call(this,e,a.GUNZIP)}function x(e){if(!(this instanceof x))return new x(e);R.call(this,e,a.DEFLATERAW)}function T(e){if(!(this instanceof T))return new T(e);R.call(this,e,a.INFLATERAW)}function S(e){if(!(this instanceof S))return new S(e);R.call(this,e,a.UNZIP)}function M(e){return e===a.Z_NO_FLUSH||e===a.Z_PARTIAL_FLUSH||e===a.Z_SYNC_FLUSH||e===a.Z_FULL_FLUSH||e===a.Z_FINISH||e===a.Z_BLOCK}function R(e,r){var o=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!M(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!M(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:a.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!n.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(r);var s=this;this._hadError=!1,this._handle.onerror=function(e,r){A(s),s._hadError=!0;var n=new Error(e);n.errno=r,n.code=t.codes[r],s.emit("error",n)};var l=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(l=e.level);var u=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(u=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,l,e.memLevel||t.Z_DEFAULT_MEMLEVEL,u,e.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=u,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!o._handle},configurable:!0,enumerable:!0})}function A(t,r){r&&e.nextTick(r),t._handle&&(t._handle.close(),t._handle=null)}function k(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(f),writable:!1}),t.Deflate=_,t.Inflate=b,t.Gzip=E,t.Gunzip=w,t.DeflateRaw=x,t.InflateRaw=T,t.Unzip=S,t.createDeflate=function(e){return new _(e)},t.createInflate=function(e){return new b(e)},t.createDeflateRaw=function(e){return new x(e)},t.createInflateRaw=function(e){return new T(e)},t.createGzip=function(e){return new E(e)},t.createGunzip=function(e){return new w(e)},t.createUnzip=function(e){return new S(e)},t.deflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),g(new _(t),e,r)},t.deflateSync=function(e,t){return y(new _(t),e)},t.gzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),g(new E(t),e,r)},t.gzipSync=function(e,t){return y(new E(t),e)},t.deflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),g(new x(t),e,r)},t.deflateRawSync=function(e,t){return y(new x(t),e)},t.unzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),g(new S(t),e,r)},t.unzipSync=function(e,t){return y(new S(t),e)},t.inflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),g(new b(t),e,r)},t.inflateSync=function(e,t){return y(new b(t),e)},t.gunzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),g(new w(t),e,r)},t.gunzipSync=function(e,t){return y(new w(t),e)},t.inflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),g(new T(t),e,r)},t.inflateRawSync=function(e,t){return y(new T(t),e)},o.inherits(R,i),R.prototype.params=function(r,n,i){if(r<t.Z_MIN_LEVEL||r>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+r);if(n!=t.Z_FILTERED&&n!=t.Z_HUFFMAN_ONLY&&n!=t.Z_RLE&&n!=t.Z_FIXED&&n!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==r||this._strategy!==n){var o=this;this.flush(a.Z_SYNC_FLUSH,function(){s(o._handle,"zlib binding closed"),o._handle.params(r,n),o._hadError||(o._level=r,o._strategy=n,i&&i())})}else e.nextTick(i)},R.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},R.prototype._flush=function(e){this._transform(n.alloc(0),"",e)},R.prototype.flush=function(t,r){var i=this,o=this._writableState;("function"==typeof t||void 0===t&&!r)&&(r=t,t=a.Z_FULL_FLUSH),o.ended?r&&e.nextTick(r):o.ending?r&&this.once("end",r):o.needDrain?r&&this.once("drain",function(){return i.flush(t,r)}):(this._flushFlag=t,this.write(n.alloc(0),"",r))},R.prototype.close=function(t){A(this,t),e.nextTick(k,this)},R.prototype._transform=function(e,t,r){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);return null===e||n.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(e,i,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},R.prototype._processChunk=function(e,t,r){var i=e&&e.length,a=this._chunkSize-this._offset,o=0,c=this,h="function"==typeof r;if(!h){var d,f=[],p=0;this.on("error",function(e){d=e}),s(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,a)}while(!this._hadError&&y(m[0],m[1]));if(this._hadError)throw d;if(p>=l)throw A(this),new RangeError(u);var v=n.concat(f,p);return A(this),v}s(this._handle,"zlib binding closed");var g=this._handle.write(t,e,o,i,this._buffer,this._offset,a);function y(l,u){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var d=a-u;if(s(d>=0,"have should not go down"),d>0){var m=c._buffer.slice(c._offset,c._offset+d);c._offset+=d,h?c.push(m):(f.push(m),p+=m.length)}if((0===u||c._offset>=c._chunkSize)&&(a=c._chunkSize,c._offset=0,c._buffer=n.allocUnsafe(c._chunkSize)),0===u){if(o+=i-l,i=l,!h)return!0;var v=c._handle.write(t,e,o,i,c._buffer,c._offset,c._chunkSize);return v.callback=y,void(v.buffer=e)}if(!h)return!1;r()}}g.buffer=e,g.callback=y},o.inherits(_,R),o.inherits(b,R),o.inherits(E,R),o.inherits(w,R),o.inherits(x,R),o.inherits(T,R),o.inherits(S,R)}).call(this,r(3))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,d){if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return f=(0,l.default)(t,d),p=function(l){var f=function(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var r=e.elements.x00020010;return c.readFixedString(t,r.dataOffset,r.length)}(l),p=function(e){return"1.2.840.10008.1.2"!==e}(f),m=function(o,l){if("1.2.840.10008.1.2.1.99"===o){if(d&&d.inflater){var c=d.inflater(t,l);return new a.default(s.default,c,0)}if(void 0!==e&&this.module!==e){var h=r(68),f=(0,u.default)(t,l,t.length-l),p=h.inflateRawSync(f),m=(0,n.default)(t,p.length+l);return t.copy(m,0,0,l),p.copy(m,l),new a.default(s.default,m,0)}if("undefined"!=typeof pako){var v=t.slice(l),g=pako.inflateRaw(v),y=(0,n.default)(t,g.length+l);return y.set(t.slice(0,l),0),y.set(g,l),new a.default(s.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===o?new a.default(i.default,t,l):new a.default(s.default,t,l)}(f,l.position),v=new o.default(m.byteArrayParser,m.byteArray,{});v.warnings=m.warnings;try{p?h.parseDicomDataSetExplicit(v,m,m.byteArray.length,d):h.parseDicomDataSetImplicit(v,m,m.byteArray.length,d)}catch(e){var g={exception:e,dataSet:v};throw g}return v}(f),function(e,t){for(var r in e.elements)e.elements.hasOwnProperty(r)&&(t.elements[r]=e.elements[r]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(f,p);var f,p};var n=f(r(22)),i=f(r(37)),a=f(r(12)),o=f(r(7)),s=f(r(21)),l=f(r(36)),u=f(r(11)),c=d(r(14)),h=d(r(16));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}}).call(this,r(69)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.8.2"},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*m}},function(e,t,r){"use strict";t.byteLength=function(e){return 3*e.length/4-u(e)},t.toByteArray=function(e){var t,r,n,o,s,l=e.length;o=u(e),s=new a(3*l/4-o),r=o>0?l-4:l;var c=0;for(t=0;t<r;t+=4)n=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[c++]=n>>16&255,s[c++]=n>>8&255,s[c++]=255&n;return 2===o?(n=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[c++]=255&n):1===o&&(n=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[c++]=n>>8&255,s[c++]=255&n),s},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a="",o=[],s=0,l=r-i;s<l;s+=16383)o.push(c(e,s,s+16383>l?l:s+16383));return 1===i?(t=e[r-1],a+=n[t>>2],a+=n[t<<4&63],a+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],a+=n[t>>10],a+=n[t>>4&63],a+=n[t<<2&63],a+="="),o.push(a),o.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function c(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t,r){"use strict";function n(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function i(e,t,r){var i=t.fragments[r];return!(!n(e,i.position+i.length-2)&&!n(e,i.position+i.length-3))}function a(e,t,r){for(var n=r;n<t.fragments.length;n++)if(i(e,t,n))return n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r&&r.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";r=r||t.fragments;for(var n=[],i=0;;){n.push(t.fragments[i].offset);var o=a(e,t,i);if(void 0===o||o===t.fragments.length-1)return n;i=o+1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";r=r||{omitPrivateAttibutes:!0,maxElementLength:128};var n={};for(var i in t.elements){var s=t.elements[i];if(!0!==r.omitPrivateAttibutes||!o.isPrivateTag(i))if(s.items){for(var l=[],u=0;u<s.items.length;u++)l.push(e(s.items[u].dataSet,r));n[i]=l}else{var c;c=void 0,s.length<r.maxElementLength&&(c=(0,a.default)(t,s)),n[i]=void 0!==c?c:{dataOffset:s.dataOffset,length:s.length}}}return n};var n,i=r(43),a=(n=i)&&n.__esModule?n:{default:n},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(25))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&8===e.length){var r=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);if(t&&!0!==function(e,t,r){return!isNaN(r)&&t>0&&t<=12&&e>0&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,r)}(i,n,r))throw"invalid DA '"+e+"'";return{year:r,month:n,day:i}}if(t)throw"invalid DA '"+e+"'"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.length>=2){var r=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,a=e.length>=8?parseInt(e.substring(7,13),10):void 0;if(t&&(isNaN(r)||void 0!==n&&isNaN(n)||void 0!==i&&isNaN(i)||void 0!==a&&isNaN(a)||r<0||r>23||n&&(n<0||n>59)||i&&(i<0||i>59)||a&&(a<0||a>999999)))throw"invalid TM '"+e+"'";return{hours:r,minutes:n,seconds:i,fractionalSeconds:a}}if(t)throw"invalid TM '"+e+"'"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var n=r(25),i=u(r(77)),a=u(r(76)),o=u(r(43)),s=u(r(75)),l=u(r(74));function u(e){return e&&e.__esModule?e:{default:e}}t.isStringVr=n.isStringVr,t.isPrivateTag=n.isPrivateTag,t.parsePN=n.parsePN,t.parseTM=i.default,t.parseDA=a.default,t.explicitElementToString=o.default,t.explicitDataSetToJS=s.default,t.createJPEGBasicOffsetTable=l.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readTag=t.readSequenceItem=t.readSequenceItemsImplicit=t.readSequenceItemsExplicit=t.readPart10Header=t.readEncapsulatedPixelDataFromFragments=t.readEncapsulatedPixelData=t.readEncapsulatedImageFrame=t.readDicomElementImplicit=t.readDicomElementExplicit=t.parseDicom=t.littleEndianByteArrayParser=t.findItemDelimitationItemAndSetElementLength=t.findEndOfEncapsulatedElement=t.findAndSetUNElementLength=t.DataSet=t.sharedCopy=t.ByteStream=t.bigEndianByteArrayParser=t.version=t.alloc=t.readFixedString=t.parseDicomDataSetImplicit=t.parseDicomDataSetExplicit=t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var n=r(78),i=r(16),a=r(14),o=R(r(22)),s=R(r(71)),l=R(r(37)),u=R(r(12)),c=R(r(11)),h=R(r(7)),d=R(r(41)),f=R(r(42)),p=R(r(24)),m=R(r(21)),v=R(r(70)),g=R(r(15)),y=R(r(23)),_=R(r(26)),b=R(r(44)),E=R(r(17)),w=R(r(36)),x=R(r(40)),T=R(r(39)),S=R(r(13)),M=R(r(4));function R(e){return e&&e.__esModule?e:{default:e}}var A={isStringVr:n.isStringVr,isPrivateTag:n.isPrivateTag,parsePN:n.parsePN,parseTM:n.parseTM,parseDA:n.parseDA,explicitElementToString:n.explicitElementToString,explicitDataSetToJS:n.explicitDataSetToJS,createJPEGBasicOffsetTable:n.createJPEGBasicOffsetTable,parseDicomDataSetExplicit:i.parseDicomDataSetExplicit,parseDicomDataSetImplicit:i.parseDicomDataSetImplicit,readFixedString:a.readFixedString,alloc:o.default,version:s.default,bigEndianByteArrayParser:l.default,ByteStream:u.default,sharedCopy:c.default,DataSet:h.default,findAndSetUNElementLength:d.default,findEndOfEncapsulatedElement:f.default,findItemDelimitationItemAndSetElementLength:p.default,littleEndianByteArrayParser:m.default,parseDicom:v.default,readDicomElementExplicit:g.default,readDicomElementImplicit:y.default,readEncapsulatedImageFrame:_.default,readEncapsulatedPixelData:b.default,readEncapsulatedPixelDataFromFragments:E.default,readPart10Header:w.default,readSequenceItemsExplicit:x.default,readSequenceItemsImplicit:T.default,readSequenceItem:S.default,readTag:M.default};t.isStringVr=n.isStringVr,t.isPrivateTag=n.isPrivateTag,t.parsePN=n.parsePN,t.parseTM=n.parseTM,t.parseDA=n.parseDA,t.explicitElementToString=n.explicitElementToString,t.explicitDataSetToJS=n.explicitDataSetToJS,t.createJPEGBasicOffsetTable=n.createJPEGBasicOffsetTable,t.parseDicomDataSetExplicit=i.parseDicomDataSetExplicit,t.parseDicomDataSetImplicit=i.parseDicomDataSetImplicit,t.readFixedString=a.readFixedString,t.alloc=o.default,t.version=s.default,t.bigEndianByteArrayParser=l.default,t.ByteStream=u.default,t.sharedCopy=c.default,t.DataSet=h.default,t.findAndSetUNElementLength=d.default,t.findEndOfEncapsulatedElement=f.default,t.findItemDelimitationItemAndSetElementLength=p.default,t.littleEndianByteArrayParser=m.default,t.parseDicom=v.default,t.readDicomElementExplicit=g.default,t.readDicomElementImplicit=y.default,t.readEncapsulatedImageFrame=_.default,t.readEncapsulatedPixelData=b.default,t.readEncapsulatedPixelDataFromFragments=E.default,t.readPart10Header=w.default,t.readSequenceItemsExplicit=x.default,t.readSequenceItemsImplicit=T.default,t.readSequenceItem=S.default,t.readTag=M.default,t.default=A}])},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||r(28),n.lossless.DataStream=n.lossless.DataStream||r(3),n.lossless.Decoder=n.lossless.Decoder||r(140),n.lossless.FrameHeader=n.lossless.FrameHeader||r(33),n.lossless.HuffmanTable=n.lossless.HuffmanTable||r(29),n.lossless.QuantizationTable=n.lossless.QuantizationTable||r(30),n.lossless.ScanComponent=n.lossless.ScanComponent||r(32),n.lossless.ScanHeader=n.lossless.ScanHeader||r(31),n.lossless.Utils=n.lossless.Utils||r(7),"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";var n,i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||r(3),i.lossless.HuffmanTable=i.lossless.HuffmanTable||r(29),i.lossless.QuantizationTable=i.lossless.QuantizationTable||r(30),i.lossless.ScanHeader=i.lossless.ScanHeader||r(31),i.lossless.FrameHeader=i.lossless.FrameHeader||r(33),i.lossless.Utils=i.lossless.Utils||r(7),i.lossless.Decoder=i.lossless.Decoder||function(e,t){this.buffer=e,this.frame=new i.lossless.FrameHeader,this.huffTable=new i.lossless.HuffmanTable,this.quantTable=new i.lossless.QuantizationTable,this.scan=new i.lossless.ScanHeader,this.DU=i.lossless.Utils.createArray(10,4,64),this.HuffTab=i.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=i.lossless.Utils.createArray(10,1),this.dcTab=i.lossless.Utils.createArray(10,1),this.qTab=i.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,void 0!==t&&(this.numBytes=t)},i.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],i.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],i.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,i.lossless.Decoder.MSB=2147483648,i.lossless.Decoder.RESTART_MARKER_BEGIN=65488,i.lossless.Decoder.RESTART_MARKER_END=65495,i.lossless.Decoder.prototype.decompress=function(e,t,r){return this.decode(e,t,r).buffer},i.lossless.Decoder.prototype.decode=function(e,t,r,n){var a,o,s,l,u=0,c=[],h=[],d=[];if(void 0!==e&&(this.buffer=e),void 0!==n&&(this.numBytes=n),this.stream=new i.lossless.DataStream(this.buffer,t,r),this.buffer=null,this.xLoc=0,this.yLoc=0,65496!==(a=this.stream.get16()))throw new Error("Not a JPEG file");for(a=this.stream.get16();a>>4!=4092||65476===a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (decode)")}a=this.stream.get16()}if(a<65472||a>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),a=this.stream.get16();do{for(;65498!==a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}a=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,o=0;o<this.numComp;o+=1)s=this.scanComps[o].scanCompSel,this.qTab[o]=this.quantTables[this.components[s].quantTableSel],this.nBlock[o]=this.components[s].vSamp*this.components[s].hSamp,this.dcTab[o]=this.HuffTab[this.scanComps[o].dcTabSel][0],this.acTab[o]=this.HuffTab[this.scanComps[o].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,1==this.numBytes?this.outputData=new Uint8Array(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)):this.outputData=new Uint16Array(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),u+=1;;){for(h[0]=0,d[0]=0,o=0;o<10;o+=1)c[o]=1<<this.precision-1;if(0===this.restartInterval){for(a=this.decodeUnit(c,h,d);0===a&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(c),a=this.decodeUnit(c,h,d);break}for(l=0;l<this.restartInterval&&(this.restarting=0==l,a=this.decodeUnit(c,h,d),this.output(c),0===a);l+=1);if(0===a&&(0!==this.markerIndex?(a=65280|this.marker,this.markerIndex=0):a=this.stream.get16()),!(a>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&a<=i.lossless.Decoder.RESTART_MARKER_END))break}65500===a&&1===u&&(this.readNumber(),a=this.stream.get16())}while(65497!==a&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===u);return this.outputData},i.lossless.Decoder.prototype.decodeUnit=function(e,t,r){return 1==this.numComp?this.decodeSingle(e,t,r):3==this.numComp?this.decodeRGB(e,t,r):-1},i.lossless.Decoder.prototype.select1=function(e){return this.getPreviousX(e)},i.lossless.Decoder.prototype.select2=function(e){return this.getPreviousY(e)},i.lossless.Decoder.prototype.select3=function(e){return this.getPreviousXY(e)},i.lossless.Decoder.prototype.select4=function(e){return this.getPreviousX(e)+this.getPreviousY(e)-this.getPreviousXY(e)},i.lossless.Decoder.prototype.select5=function(e){return this.getPreviousX(e)+(this.getPreviousY(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select6=function(e){return this.getPreviousY(e)+(this.getPreviousX(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select7=function(e){return(this.getPreviousX(e)+this.getPreviousY(e))/2},i.lossless.Decoder.prototype.decodeRGB=function(e,t,r){var n,a,o,s,l,u,c,h;for(e[0]=this.selector(0),e[1]=this.selector(1),e[2]=this.selector(2),l=0;l<this.numComp;l+=1)for(s=this.qTab[l],a=this.acTab[l],o=this.dcTab[l],u=0;u<this.nBlock[l];u+=1){for(c=0;c<this.IDCT_Source.length;c+=1)this.IDCT_Source[c]=0;if((n=this.getHuffmanValue(o,t,r))>=65280)return n;for(e[l]=this.IDCT_Source[0]=e[l]+this.getn(r,n,t,r),this.IDCT_Source[0]*=s[0],h=1;h<64;h+=1){if((n=this.getHuffmanValue(a,t,r))>=65280)return n;if(h+=n>>4,0==(15&n)){if(n>>4==0)break}else this.IDCT_Source[i.lossless.Decoder.IDCT_P[h]]=this.getn(r,15&n,t,r)*s[h]}}return 0},i.lossless.Decoder.prototype.decodeSingle=function(e,t,r){var n,a,o,s;for(this.restarting?(this.restarting=!1,e[0]=1<<this.frame.precision-1):e[0]=this.selector(),a=0;a<this.nBlock[0];a+=1){if((n=this.getHuffmanValue(this.dcTab[0],t,r))>=65280)return n;if((s=(o=this.getn(e,n,t,r))>>8)>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&s<=i.lossless.Decoder.RESTART_MARKER_END)return s;e[0]+=o}return 0},i.lossless.Decoder.prototype.getHuffmanValue=function(e,t,r){var n,a;if(65535,r[0]<8?(t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a):r[0]-=8,0!=((n=e[t[0]>>r[0]])&i.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;t[0]&=65535>>16-r[0],t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a,n=e[256*(255&n)+(t[0]>>r[0])],r[0]+=8}if(r[0]+=8-(n>>8),r[0]<0)throw new Error("index="+r[0]+" temp="+t[0]+" code="+n+" in HuffmanValue()");return r[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(t[0]&=65535>>16-r[0],255&n)},i.lossless.Decoder.prototype.getn=function(e,t,r,n){var i,a;if(1,-1,65535,0===t)return 0;if(16===t)return e[0]>=0?-32768:32768;if(n[0]-=t,n[0]>=0){if(n[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;i=r[0]>>n[0],r[0]&=65535>>16-n[0]}else{if(r[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),r[0]|=a,n[0]+=8,n[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;r[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),r[0]|=a,n[0]+=8}if(n[0]<0)throw new Error("index="+n[0]+" in getn()");if(n[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;i=r[0]>>n[0],r[0]&=65535>>16-n[0]}return i<1<<t-1&&(i+=1+(-1<<t)),i},i.lossless.Decoder.prototype.getPreviousX=function(e){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,e):this.yLoc>0?this.getPreviousY(e):1<<this.frame.precision-1},i.lossless.Decoder.prototype.getPreviousXY=function(e){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,e):this.getPreviousY(e)},i.lossless.Decoder.prototype.getPreviousY=function(e){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,e):this.getPreviousX(e)},i.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},i.lossless.Decoder.prototype.outputSingle=function(e){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&e[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.outputRGB=function(e){var t=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(t,e[0],0),this.setter(t,e[1],1),this.setter(t,e[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.setValue8=function(e,t){this.outputData[e]=t},i.lossless.Decoder.prototype.getValue8=function(e){return this.outputData[e]},(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0])?(i.lossless.Decoder.prototype.setValue16=i.lossless.Decoder.prototype.setValue8,i.lossless.Decoder.prototype.getValue16=i.lossless.Decoder.prototype.getValue8):(i.lossless.Decoder.prototype.setValue16=function(e,t){this.outputData[e]=(255&t)<<8|t>>8&255},i.lossless.Decoder.prototype.getValue16=function(e){var t=this.outputData[e];return(255&t)<<8|t>>8&255}),i.lossless.Decoder.prototype.setValueRGB=function(e,t,r){this.outputData[3*e+r]=t},i.lossless.Decoder.prototype.getValueRGB=function(e,t){return this.outputData[3*e+t]},i.lossless.Decoder.prototype.readApp=function(){var e=0,t=this.stream.get16();for(e+=2;e<t;)this.stream.get8(),e+=1;return t},i.lossless.Decoder.prototype.readComment=function(){var e,t="",r=0;for(e=this.stream.get16(),r+=2;r<e;)t+=this.stream.get8(),r+=1;return t},i.lossless.Decoder.prototype.readNumber=function(){if(4!==this.stream.get16())throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()},"undefined"!==typeof e&&e.exports&&(e.exports=i.lossless.Decoder)},function(e,t){var r={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},n=function(){"use strict";var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,n=799,i=3406,a=2276,o=1567,s=3784,l=5793,u=2896;function c(){}function h(e,t){for(var r,n,i=0,a=[],o=16;o>0&&!e[o-1];)o--;a.push({children:[],index:0});var s,l=a[0];for(r=0;r<o;r++){for(n=0;n<e[r];n++){for((l=a.pop()).children[l.index]=t[i];l.index>0;)l=a.pop();for(l.index++,a.push(l);a.length<=r;)a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s;i++}r+1<o&&(a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s)}return a[0].children}function d(e,t,r){return 64*((e.blocksPerLine+1)*t+r)}function f(t,r,n,i,a,o,s,l,u){n.precision,n.samplesPerLine,n.scanLines;var c=n.mcusPerLine,h=n.progressive,f=(n.maxH,n.maxV,r),p=0,m=0;function v(){if(m>0)return p>>--m&1;if(255==(p=t[r++])){var e=t[r++];if(e)throw"unexpected marker: "+(p<<8|e).toString(16)}return m=7,p>>>7}function g(e){for(var t,r=e;null!==(t=v());){if("number"==typeof(r=r[t]))return r;if("object"!=typeof r)throw"invalid huffman sequence"}return null}function y(e){for(var t=0;e>0;){var r=v();if(null===r)return;t=t<<1|r,e--}return t}function _(e){var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var b=0;var E,w=0;function x(e,t,r,n,i){var a=r%c;t(e,d(e,(r/c|0)*e.v+n,a*e.h+i))}function T(e,t,r){t(e,d(e,r/e.blocksPerLine|0,r%e.blocksPerLine))}var S,M,R,A,k,P,C=i.length;P=h?0===o?0===l?function(e,t){var r=g(e.huffmanTableDC),n=0===r?0:_(r)<<u;e.blockData[t]=e.pred+=n}:function(e,t){e.blockData[t]|=v()<<u}:0===l?function(t,r){if(b>0)b--;else for(var n=o,i=s;n<=i;){var a=g(t.huffmanTableAC),l=15&a,c=a>>4;if(0!==l){var h=e[n+=c];t.blockData[r+h]=_(l)*(1<<u),n++}else{if(c<15){b=y(c)+(1<<c)-1;break}n+=16}}}:function(t,r){for(var n=o,i=s,a=0;n<=i;){var l=e[n];switch(w){case 0:var c=g(t.huffmanTableAC),h=15&c;if(a=c>>4,0===h)a<15?(b=y(a)+(1<<a),w=4):(a=16,w=1);else{if(1!==h)throw"invalid ACn encoding";E=_(h),w=a?2:3}continue;case 1:case 2:t.blockData[r+l]?t.blockData[r+l]+=v()<<u:0==--a&&(w=2==w?3:0);break;case 3:t.blockData[r+l]?t.blockData[r+l]+=v()<<u:(t.blockData[r+l]=E<<u,w=0);break;case 4:t.blockData[r+l]&&(t.blockData[r+l]+=v()<<u)}n++}4===w&&0==--b&&(w=0)}:function(t,r){var n=g(t.huffmanTableDC),i=0===n?0:_(n);t.blockData[r]=t.pred+=i;for(var a=1;a<64;){var o=g(t.huffmanTableAC),s=15&o,l=o>>4;if(0!==s){var u=e[a+=l];t.blockData[r+u]=_(s),a++}else{if(l<15)break;a+=16}}};var L,I,O,H,D=0;for(I=1==C?i[0].blocksPerLine*i[0].blocksPerColumn:c*n.mcusPerColumn,a||(a=I);D<I;){for(M=0;M<C;M++)i[M].pred=0;if(b=0,1==C)for(S=i[0],k=0;k<a;k++)T(S,P,D),D++;else for(k=0;k<a;k++){for(M=0;M<C;M++)for(O=(S=i[M]).h,H=S.v,R=0;R<H;R++)for(A=0;A<O;A++)x(S,P,D,R,A);D++}if(m=0,(L=t[r]<<8|t[r+1])<=65280)throw"marker was not found";if(!(L>=65488&&L<=65495))break;r+=2}return r-f}function p(e,r,c){var h,d,f,p,m,v,g,y,_,b,E=e.quantizationTable;for(b=0;b<64;b++)c[b]=e.blockData[r+b]*E[b];for(b=0;b<8;++b){var w=8*b;0!==c[1+w]||0!==c[2+w]||0!==c[3+w]||0!==c[4+w]||0!==c[5+w]||0!==c[6+w]||0!==c[7+w]?(h=l*c[0+w]+128>>8,d=l*c[4+w]+128>>8,f=c[2+w],p=c[6+w],m=u*(c[1+w]-c[7+w])+128>>8,y=u*(c[1+w]+c[7+w])+128>>8,v=c[3+w]<<4,g=c[5+w]<<4,_=h-d+1>>1,h=h+d+1>>1,d=_,_=f*s+p*o+128>>8,f=f*o-p*s+128>>8,p=_,_=m-g+1>>1,m=m+g+1>>1,g=_,_=y+v+1>>1,v=y-v+1>>1,y=_,_=h-p+1>>1,h=h+p+1>>1,p=_,_=d-f+1>>1,d=d+f+1>>1,f=_,_=m*a+y*i+2048>>12,m=m*i-y*a+2048>>12,y=_,_=v*n+g*t+2048>>12,v=v*t-g*n+2048>>12,g=_,c[0+w]=h+y,c[7+w]=h-y,c[1+w]=d+g,c[6+w]=d-g,c[2+w]=f+v,c[5+w]=f-v,c[3+w]=p+m,c[4+w]=p-m):(_=l*c[0+w]+512>>10,c[0+w]=_,c[1+w]=_,c[2+w]=_,c[3+w]=_,c[4+w]=_,c[5+w]=_,c[6+w]=_,c[7+w]=_)}for(b=0;b<8;++b){var x=b;0!==c[8+x]||0!==c[16+x]||0!==c[24+x]||0!==c[32+x]||0!==c[40+x]||0!==c[48+x]||0!==c[56+x]?(h=l*c[0+x]+2048>>12,d=l*c[32+x]+2048>>12,f=c[16+x],p=c[48+x],m=u*(c[8+x]-c[56+x])+2048>>12,y=u*(c[8+x]+c[56+x])+2048>>12,v=c[24+x],g=c[40+x],_=h-d+1>>1,h=h+d+1>>1,d=_,_=f*s+p*o+2048>>12,f=f*o-p*s+2048>>12,p=_,_=m-g+1>>1,m=m+g+1>>1,g=_,_=y+v+1>>1,v=y-v+1>>1,y=_,_=h-p+1>>1,h=h+p+1>>1,p=_,_=d-f+1>>1,d=d+f+1>>1,f=_,_=m*a+y*i+2048>>12,m=m*i-y*a+2048>>12,y=_,_=v*n+g*t+2048>>12,v=v*t-g*n+2048>>12,g=_,c[0+x]=h+y,c[56+x]=h-y,c[8+x]=d+g,c[48+x]=d-g,c[16+x]=f+v,c[40+x]=f-v,c[24+x]=p+m,c[32+x]=p-m):(_=l*c[b+0]+8192>>14,c[0+x]=_,c[8+x]=_,c[16+x]=_,c[24+x]=_,c[32+x]=_,c[40+x]=_,c[48+x]=_,c[56+x]=_)}for(b=0;b<64;++b){var T=r+b,S=c[b];S=S<=-2056/e.bitConversion?0:S>=2024/e.bitConversion?255/e.bitConversion:S+2056/e.bitConversion>>4,e.blockData[T]=S}}function m(e,t){for(var r=t.blocksPerLine,n=t.blocksPerColumn,i=new Int32Array(64),a=0;a<n;a++)for(var o=0;o<r;o++){p(t,d(t,a,o),i)}return t.blockData}function v(e){return e<=0?0:e>=255?255:0|e}return c.prototype={load:function(e){var t=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(e.indexOf("data:")>-1){for(var r=e.indexOf("base64,")+7,n=atob(e.substring(r)),i=new Uint8Array(n.length),a=n.length-1;a>=0;a--)i[a]=n.charCodeAt(a);t(n)}else{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){var e=new Uint8Array(o.response);t(e)}.bind(this),o.send(null)}},parse:function(t){function n(){var e=t[l]<<8|t[l+1];return l+=2,e}function i(){var e=n(),r=t.subarray(l,l+e-2);return l+=r.length,r}function a(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),r=Math.ceil(e.scanLines/8/e.maxV),n=0;n<e.components.length;n++){W=e.components[n];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*W.h/e.maxH),a=Math.ceil(Math.ceil(e.scanLines/8)*W.v/e.maxV),o=t*W.h,s=64*(r*W.v)*(o+1);W.blockData=new Int16Array(s),W.blocksPerLine=i,W.blocksPerColumn=a}e.mcusPerLine=t,e.mcusPerColumn=r}var o,s,l=0,u=(t.length,null),c=null,d=[],p=[],v=[],g=n();if(65496!=g)throw"SOI not found";for(g=n();65497!=g;){var y,_;switch(g){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var b=i();65504===g&&74===b[0]&&70===b[1]&&73===b[2]&&70===b[3]&&0===b[4]&&(u={version:{major:b[5],minor:b[6]},densityUnits:b[7],xDensity:b[8]<<8|b[9],yDensity:b[10]<<8|b[11],thumbWidth:b[12],thumbHeight:b[13],thumbData:b.subarray(14,14+3*b[12]*b[13])}),65518===g&&65===b[0]&&100===b[1]&&111===b[2]&&98===b[3]&&101===b[4]&&0===b[5]&&(c={version:b[6],flags0:b[7]<<8|b[8],flags1:b[9]<<8|b[10],transformCode:b[11]});break;case 65499:for(var E=n()+l-2;l<E;){var w=t[l++],x=new Int32Array(64);if(w>>4==0)for(y=0;y<64;y++){x[e[y]]=t[l++]}else{if(w>>4!=1)throw"DQT: invalid table spec";for(y=0;y<64;y++){x[e[y]]=n()}}d[15&w]=x}break;case 65472:case 65473:case 65474:if(o)throw"Only single frame JPEGs supported";n(),(o={}).extended=65473===g,o.progressive=65474===g,o.precision=t[l++],o.scanLines=n(),o.samplesPerLine=n(),o.components=[],o.componentIds={};var T,S=t[l++],M=0,R=0;for(G=0;G<S;G++){T=t[l];var A=t[l+1]>>4,k=15&t[l+1];M<A&&(M=A),R<k&&(R=k);var P=t[l+2];_=o.components.push({h:A,v:k,quantizationTable:d[P],quantizationTableId:P,bitConversion:255/((1<<o.precision)-1)}),o.componentIds[T]=_-1,l+=3}o.maxH=M,o.maxV=R,a(o);break;case 65476:var C=n();for(G=2;G<C;){var L=t[l++],I=new Uint8Array(16),O=0;for(y=0;y<16;y++,l++)O+=I[y]=t[l];var H=new Uint8Array(O);for(y=0;y<O;y++,l++)H[y]=t[l];G+=17+O,(L>>4==0?v:p)[15&L]=h(I,H)}break;case 65501:n(),s=n();break;case 65498:n();var D=t[l++],N=[];for(G=0;G<D;G++){var F=o.componentIds[t[l++]];W=o.components[F];var U=t[l++];W.huffmanTableDC=v[U>>4],W.huffmanTableAC=p[15&U],N.push(W)}var B=t[l++],z=t[l++],j=t[l++],V=f(t,l,o,N,s,B,z,j>>4,15&j);l+=V;break;default:if(255==t[l-3]&&t[l-2]>=192&&t[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+g.toString(16)}g=n()}switch(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=u,this.adobe=c,this.components=[],o.components.length){case 1:this.colorspace=r.Grayscale;break;case 3:this.adobe?this.colorspace=r.AdobeRGB:this.colorspace=r.RGB;break;case 4:this.colorspace=r.CYMK;break;default:this.colorspace=r.Unknown}for(var G=0;G<o.components.length;G++){var W;(W=o.components[G]).quantizationTable||null===W.quantizationTableId||(W.quantizationTable=d[W.quantizationTableId]),this.components.push({output:m(0,W),scaleX:W.h/o.maxH,scaleY:W.v/o.maxV,blocksPerLine:W.blocksPerLine,blocksPerColumn:W.blocksPerColumn,bitConversion:W.bitConversion})}},getData16:function(e,t){if(1!==this.components.length)throw"Unsupported color mode";var r,n,i,a,o,s,l=this.width/e,u=this.height/t,c=0,h=this.components.length,f=new Uint16Array(e*t*h),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(s=0;s<h;s++){for(var m,v,g,y=(r=this.components[s]).blocksPerLine,_=r.blocksPerColumn,b=y<<3,E=0,w=0;w<_;w++)for(var x=w<<3,T=0;T<y;T++){var S=d(r,w,T),M=(c=0,T<<3);for(m=0;m<8;m++){E=(x+m)*b;for(v=0;v<8;v++)p[E+M+v]=r.output[S+c++]}}for(n=r.scaleX*l,i=r.scaleY*u,c=s,o=0;o<t;o++)for(a=0;a<e;a++)g=(0|o*i)*b+(0|a*n),f[c]=p[g],c+=h}return f},getData:function(e,t){var r,n,i,a,o,s,l,u,c,h,f,p,m,g,y,_=this.width/e,b=this.height/t,E=0,w=this.components.length,x=e*t*w,T=new Uint8Array(x),S=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(s=0;s<w;s++){for(var M,R,A,k=(r=this.components[s]).blocksPerLine,P=r.blocksPerColumn,C=k<<3,L=0,I=0;I<P;I++)for(var O=I<<3,H=0;H<k;H++){var D=d(r,I,H),N=(E=0,H<<3);for(M=0;M<8;M++){L=(O+M)*C;for(R=0;R<8;R++)S[L+N+R]=r.output[D+E++]*r.bitConversion}}for(n=r.scaleX*_,i=r.scaleY*b,E=s,o=0;o<t;o++)for(a=0;a<e;a++)A=(0|o*i)*C+(0|a*n),T[E]=S[A],E+=w}switch(w){case 1:case 2:break;case 3:if(y=!0,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(s=0;s<x;s+=w)l=T[s],u=T[s+1],p=v(l-179.456+1.402*(c=T[s+2])),m=v(l+135.459-.344*u-.714*c),g=v(l-226.816+1.772*u),T[s]=p,T[s+1]=m,T[s+2]=g;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(y=!1,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(s=0;s<x;s+=w)l=T[s],u=T[s+1],h=v(434.456-l-1.402*(c=T[s+2])),f=v(119.541-l+.344*u+.714*c),l=v(481.816-l-1.772*u),T[s]=h,T[s+1]=f,T[s+2]=l;break;default:throw"Unsupported color mode"}return T}},c}();"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";
/*! image-JPEG2000 - v0.3.1 - 2015-08-26 | https://github.com/OHIF/image-JPEG2000 */var n=function(){var e={LL:0,LH:1,HL:1,HH:2};function t(){this.failOnCorruptedImage=!1}function r(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function n(e,t){for(var r,n=e.SIZ,i=[],a=Math.ceil((n.Xsiz-n.XTOsiz)/n.XTsiz),o=Math.ceil((n.Ysiz-n.YTOsiz)/n.YTsiz),s=0;s<o;s++)for(var l=0;l<a;l++)(r={}).tx0=Math.max(n.XTOsiz+l*n.XTsiz,n.XOsiz),r.ty0=Math.max(n.YTOsiz+s*n.YTsiz,n.YOsiz),r.tx1=Math.min(n.XTOsiz+(l+1)*n.XTsiz,n.Xsiz),r.ty1=Math.min(n.YTOsiz+(s+1)*n.YTsiz,n.Ysiz),r.width=r.tx1-r.tx0,r.height=r.ty1-r.ty0,r.components=[],i.push(r);e.tiles=i;for(var u=0,c=n.Csiz;u<c;u++)for(var h=t[u],d=0,f=i.length;d<f;d++){var p={};r=i[d],p.tcx0=Math.ceil(r.tx0/h.XRsiz),p.tcy0=Math.ceil(r.ty0/h.YRsiz),p.tcx1=Math.ceil(r.tx1/h.XRsiz),p.tcy1=Math.ceil(r.ty1/h.YRsiz),p.width=p.tcx1-p.tcx0,p.height=p.tcy1-p.tcy0,r.components[u]=p}}function a(e,t,r){var n=t.codingStyleParameters,i={};return n.entropyCoderWithCustomPrecincts?(i.PPx=n.precinctsSizes[r].PPx,i.PPy=n.precinctsSizes[r].PPy):(i.PPx=15,i.PPy=15),i.xcb_=r>0?Math.min(n.xcb,i.PPx-1):Math.min(n.xcb,i.PPx),i.ycb_=r>0?Math.min(n.ycb,i.PPy-1):Math.min(n.ycb,i.PPy),i}function l(e,t,r){var n=1<<r.PPx,i=1<<r.PPy,a=0===t.resLevel,o=1<<r.PPx+(a?0:-1),s=1<<r.PPy+(a?0:-1),l=t.trx1>t.trx0?Math.ceil(t.trx1/n)-Math.floor(t.trx0/n):0,u=t.try1>t.try0?Math.ceil(t.try1/i)-Math.floor(t.try0/i):0,c=l*u;t.precinctParameters={precinctWidth:n,precinctHeight:i,numprecinctswide:l,numprecinctshigh:u,numprecincts:c,precinctWidthInSubband:o,precinctHeightInSubband:s}}function u(e,t,r){var n,i,a,o,s=r.xcb_,l=r.ycb_,u=1<<s,c=1<<l,h=t.tbx0>>s,d=t.tby0>>l,f=t.tbx1+u-1>>s,p=t.tby1+c-1>>l,m=t.resolution.precinctParameters,v=[],g=[];for(i=d;i<p;i++)for(n=h;n<f;n++){if((a={cbx:n,cby:i,tbx0:u*n,tby0:c*i,tbx1:u*(n+1),tby1:c*(i+1)}).tbx0_=Math.max(t.tbx0,a.tbx0),a.tby0_=Math.max(t.tby0,a.tby0),a.tbx1_=Math.min(t.tbx1,a.tbx1),a.tby1_=Math.min(t.tby1,a.tby1),o=Math.floor((a.tbx0_-t.tbx0)/m.precinctWidthInSubband)+Math.floor((a.tby0_-t.tby0)/m.precinctHeightInSubband)*m.numprecinctswide,a.precinctNumber=o,a.subbandType=t.type,a.Lblock=3,!(a.tbx1_<=a.tbx0_||a.tby1_<=a.tby0_)){v.push(a);var y=g[o];void 0!==y?(n<y.cbxMin?y.cbxMin=n:n>y.cbxMax&&(y.cbxMax=n),i<y.cbyMin?y.cbxMin=i:i>y.cbyMax&&(y.cbyMax=i)):g[o]=y={cbxMin:n,cbyMin:i,cbxMax:n,cbyMax:i},a.precinct=y}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:l,numcodeblockwide:f-h+1,numcodeblockhigh:p-d+1},t.codeblocks=v,t.precincts=g}function c(e,t,r){for(var n=[],i=e.subbands,a=0,o=i.length;a<o;a++)for(var s=i[a].codeblocks,l=0,u=s.length;l<u;l++){var c=s[l];c.precinctNumber===t&&n.push(c)}return{layerNumber:r,codeblocks:n}}function h(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;s<a;s++)o=Math.max(o,n.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,u=0,h=0,d=0;this.nextPacket=function(){for(;l<i;l++){for(;u<=o;u++){for(;h<a;h++){var e=n.components[h];if(!(u>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[u],r=t.precinctParameters.numprecincts;d<r;){var s=c(t,d,l);return d++,s}d=0}}h=0}u=0}}}function d(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;s<a;s++)o=Math.max(o,n.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,u=0,h=0,d=0;this.nextPacket=function(){for(;l<=o;l++){for(;u<i;u++){for(;h<a;h++){var e=n.components[h];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],r=t.precinctParameters.numprecincts;d<r;){var s=c(t,d,u);return d++,s}d=0}}h=0}u=0}}}function f(e){var t,r,n,i,a=e.SIZ,o=e.currentTile.index,s=e.tiles[o],l=s.codingStyleDefaultParameters.layersCount,u=a.Csiz,h=0;for(n=0;n<u;n++){var d=s.components[n];h=Math.max(h,d.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(h+1);for(r=0;r<=h;++r){var p=0;for(n=0;n<u;++n){var m=s.components[n].resolutions;r<m.length&&(p=Math.max(p,m[r].precinctParameters.numprecincts))}f[r]=p}t=0,r=0,n=0,i=0,this.nextPacket=function(){for(;r<=h;r++){for(;i<f[r];i++){for(;n<u;n++){var e=s.components[n];if(!(r>e.codingStyleParameters.decompositionLevelsCount)){var a=e.resolutions[r],o=a.precinctParameters.numprecincts;if(!(i>=o)){for(;t<l;){var d=c(a,i,t);return t++,d}t=0}}}n=0}i=0}}}function p(e){var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(n),s=o,l=0,u=0,h=0,d=0,f=0;this.nextPacket=function(){for(;f<s.maxNumHigh;f++){for(;d<s.maxNumWide;d++){for(;h<a;h++){for(var e=n.components[h],t=e.codingStyleParameters.decompositionLevelsCount;u<=t;u++){var r=e.resolutions[u],p=o.components[h].resolutions[u],m=_(d,f,p,s,r);if(null!==m){for(;l<i;){var v=c(r,m,l);return l++,v}l=0}}u=0}h=0}d=0}}}function y(e){var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(n),s=0,l=0,u=0,h=0,d=0;this.nextPacket=function(){for(;u<a;++u){for(var e=n.components[u],t=o.components[u],r=e.codingStyleParameters.decompositionLevelsCount;d<t.maxNumHigh;d++){for(;h<t.maxNumWide;h++){for(;l<=r;l++){var f=e.resolutions[l],p=t.resolutions[l],m=_(h,d,p,t,f);if(null!==m){for(;s<i;){var v=c(f,m,s);return s++,v}s=0}}l=0}h=0}d=0}}}function _(e,t,r,n,i){var a=e*n.minWidth,o=t*n.minHeight;if(a%r.width!=0||o%r.height!=0)return null;var s=o/r.width*i.precinctParameters.numprecinctswide;return a/r.height+s}function b(e){for(var t=e.components.length,r=Number.MAX_VALUE,n=Number.MAX_VALUE,i=0,a=0,o=new Array(t),s=0;s<t;s++){for(var l=e.components[s],u=l.codingStyleParameters.decompositionLevelsCount,c=new Array(u+1),h=Number.MAX_VALUE,d=Number.MAX_VALUE,f=0,p=0,m=1,v=u;v>=0;--v){var g=l.resolutions[v],y=m*g.precinctParameters.precinctWidth,_=m*g.precinctParameters.precinctHeight;h=Math.min(h,y),d=Math.min(d,_),f=Math.max(f,g.precinctParameters.numprecinctswide),p=Math.max(p,g.precinctParameters.numprecinctshigh),c[v]={width:y,height:_},m<<=1}r=Math.min(r,h),n=Math.min(n,d),i=Math.max(i,f),a=Math.max(a,p),o[s]={resolutions:c,minWidth:h,minHeight:d,maxNumWide:f,maxNumHigh:p}}return{components:o,minWidth:r,minHeight:n,maxNumWide:i,maxNumHigh:a}}function E(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=t.Csiz,o=0;o<i;o++){for(var s=n.components[o],c=s.codingStyleParameters.decompositionLevelsCount,m=[],v=[],g=0;g<=c;g++){var _,b=a(0,s,g),E={},w=1<<c-g;if(E.trx0=Math.ceil(s.tcx0/w),E.try0=Math.ceil(s.tcy0/w),E.trx1=Math.ceil(s.tcx1/w),E.try1=Math.ceil(s.tcy1/w),E.resLevel=g,l(0,E,b),m.push(E),0===g)(_={}).type="LL",_.tbx0=Math.ceil(s.tcx0/w),_.tby0=Math.ceil(s.tcy0/w),_.tbx1=Math.ceil(s.tcx1/w),_.tby1=Math.ceil(s.tcy1/w),_.resolution=E,u(0,_,b),v.push(_),E.subbands=[_];else{var x=1<<c-g+1,T=[];(_={}).type="HL",_.tbx0=Math.ceil(s.tcx0/x-.5),_.tby0=Math.ceil(s.tcy0/x),_.tbx1=Math.ceil(s.tcx1/x-.5),_.tby1=Math.ceil(s.tcy1/x),_.resolution=E,u(0,_,b),v.push(_),T.push(_),(_={}).type="LH",_.tbx0=Math.ceil(s.tcx0/x),_.tby0=Math.ceil(s.tcy0/x-.5),_.tbx1=Math.ceil(s.tcx1/x),_.tby1=Math.ceil(s.tcy1/x-.5),_.resolution=E,u(0,_,b),v.push(_),T.push(_),(_={}).type="HH",_.tbx0=Math.ceil(s.tcx0/x-.5),_.tby0=Math.ceil(s.tcy0/x-.5),_.tbx1=Math.ceil(s.tcx1/x-.5),_.tby1=Math.ceil(s.tcy1/x-.5),_.resolution=E,u(0,_,b),v.push(_),T.push(_),E.subbands=T}}s.resolutions=m,s.subbands=v}var S=n.codingStyleDefaultParameters.progressionOrder;switch(S){case 0:n.packetsIterator=new h(e);break;case 1:n.packetsIterator=new d(e);break;case 2:n.packetsIterator=new f(e);break;case 3:n.packetsIterator=new p(e);break;case 4:n.packetsIterator=new y(e);break;default:throw new Error("JPX Error: Unsupported progression order "+S)}}function w(e,t,r,n){var i,a=0,o=0,s=!1;function l(e){for(;o<e;){if(r+a>=t.length)throw new Error("Unexpected EOF");var n=t[r+a];a++,s?(i=i<<7|n,o+=7,s=!1):(i=i<<8|n,o+=8),255===n&&(s=!0)}return i>>>(o-=e)&(1<<e)-1}function u(e){return 255===t[r+a-1]&&t[r+a]===e?(c(1),!0):255===t[r+a]&&t[r+a+1]===e&&(c(2),!0)}function c(e){a+=e}function h(){o=0,s&&(a++,s=!1)}function d(){if(0===l(1))return 1;if(0===l(1))return 2;var e=l(2);return e<3?e+3:(e=l(5))<31?e+6:(e=l(7))+37}for(var f=e.currentTile.index,p=e.tiles[f],v=e.COD.sopMarkerUsed,g=e.COD.ephMarkerUsed,y=p.packetsIterator;a<n;)try{h(),v&&u(145)&&c(4);var _=y.nextPacket();if(void 0===_)return;if(!l(1))continue;for(var b,E=_.layerNumber,w=[],x=0,T=_.codeblocks.length;x<T;x++){var S=(b=_.codeblocks[x]).precinct,A=b.cbx-S.cbxMin,k=b.cby-S.cbyMin,P=!1,C=!1;if(void 0!==b.included)P=!!l(1);else{var L,I;if(void 0!==(S=b.precinct).inclusionTree)L=S.inclusionTree;else{var O=S.cbxMax-S.cbxMin+1,H=S.cbyMax-S.cbyMin+1;L=new R(O,H),I=new M(O,H),S.inclusionTree=L,S.zeroBitPlanesTree=I}for(L.reset(A,k,E);;){if(a>=t.length)return;if(L.isAboveThreshold())break;if(L.isKnown())L.nextLevel();else if(l(1)){if(L.setKnown(),L.isLeaf()){b.included=!0,P=C=!0;break}L.nextLevel()}else L.incrementValue()}}if(P){if(C){for((I=S.zeroBitPlanesTree).reset(A,k);;){if(a>=t.length)return;if(l(1)){if(!I.nextLevel())break}else I.incrementValue()}b.zeroBitPlanes=I.value}for(var D=d();l(1);)b.Lblock++;var N=m(D),F=l((D<1<<N?N-1:N)+b.Lblock);w.push({codeblock:b,codingpasses:D,dataLength:F})}}for(h(),g&&u(146);w.length>0;){var U=w.shift();void 0===(b=U.codeblock).data&&(b.data=[]),b.data.push({data:t,start:r+a,end:r+a+U.dataLength,codingpasses:U.codingpasses}),a+=U.dataLength}}catch(e){return}return a}function x(e,t,r,n,a,o,s,l){for(var u=n.tbx0,c=n.tby0,h=n.tbx1-n.tbx0,d=n.codeblocks,f="H"===n.type.charAt(0)?1:0,p="H"===n.type.charAt(1)?t:0,m=0,v=d.length;m<v;++m){var g=d[m],y=g.tbx1_-g.tbx0_,_=g.tby1_-g.tby0_;if(0!==y&&0!==_&&void 0!==g.data){var b,E;b=new A(y,_,g.subbandType,g.zeroBitPlanes,o),E=2;var w,x,T,S=g.data,M=0,R=0;for(w=0,x=S.length;w<x;w++)M+=(T=S[w]).end-T.start,R+=T.codingpasses;var k=new Int16Array(M),P=0;for(w=0,x=S.length;w<x;w++){var C=(T=S[w]).data.subarray(T.start,T.end);k.set(C,P),P+=C.length}var L=new i(k,0,M);for(b.setDecoder(L),w=0;w<R;w++){switch(E){case 0:b.runSignificancePropogationPass();break;case 1:b.runMagnitudeRefinementPass();break;case 2:b.runCleanupPass(),l&&b.checkSegmentationSymbol()}E=(E+1)%3}var I,O,H,D=g.tbx0_-u+(g.tby0_-c)*h,N=b.coefficentsSign,F=b.coefficentsMagnitude,U=b.bitsDecoded,B=s?0:.5;P=0;var z="LL"!==n.type;for(w=0;w<_;w++){var j=2*(D/h|0)*(t-h)+f+p;for(I=0;I<y;I++){if(0!==(O=F[P])){O=(O+B)*a,0!==N[P]&&(O=-O),H=U[P];var V=z?j+(D<<1):D;e[V]=s&&H>=o?O:O*(1<<o-H)}D++,P++}D+=h-y}}}}function T(t,r,n){for(var i=r.components[n],a=i.codingStyleParameters,o=i.quantizationParameters,s=a.decompositionLevelsCount,l=o.SPqcds,u=o.scalarExpounded,c=o.guardBits,h=a.segmentationSymbolUsed,d=t.components[n].precision,f=a.reversibleTransformation,p=f?new C:new P,m=[],v=0,g=0;g<=s;g++){for(var y=i.resolutions[g],_=y.trx1-y.trx0,b=y.try1-y.try0,E=new Float32Array(_*b),w=0,T=y.subbands.length;w<T;w++){var S,M;u?(S=l[v].mu,M=l[v].epsilon,v++):(S=l[0].mu,M=l[0].epsilon+(g>0?1-g:0));var R=y.subbands[w],A=e[R.type];x(E,_,0,R,f?1:Math.pow(2,d+A-M)*(1+S/2048),c+M-1,f,h)}m.push({width:_,height:b,items:E})}var k=p.calculate(m,i.tcx0,i.tcy0);return{left:i.tcx0,top:i.tcy0,width:k.width,height:k.height,items:k.items}}function S(e,t){for(var r=e.SIZ.Csiz,n=e.tiles[t],i=0;i<r;i++){var a=n.components[i],o=void 0!==e.currentTile.QCC[i]?e.currentTile.QCC[i]:e.currentTile.QCD;a.quantizationParameters=o;var s=void 0!==e.currentTile.COC[i]?e.currentTile.COC[i]:e.currentTile.COD;a.codingStyleParameters=s}n.codingStyleDefaultParameters=e.currentTile.COD}t.prototype={parse:function(e){if(65359!==v(e,0))for(var t=0,r=e.length;t<r;){var n=8,i=g(e,t),a=g(e,t+4);if(t+=n,1===i&&(i=4294967296*g(e,t)+g(e,t+4),t+=8,n+=8),0===i&&(i=r-t+n),i<n)throw new Error("JPX Error: Invalid box field size");var l=i-n,u=!0;switch(a){case 1785737832:u=!1;break;case 1668246642:var c=e[t];e[t+1],e[t+2];if(1===c){var h=g(e,t+3);switch(h){case 16:case 17:case 18:break;default:s("Unknown colorspace "+h)}}else 2===c&&o("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,t,t+l);break;case 1783636e3:218793738!==g(e,t)&&s("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:s("Unsupported header type "+a+" ("+String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)+")")}u&&(t+=l)}else this.parseCodestream(e,0,e.length)},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){if(65361===(t<<8|(t=e.getByte()))){e.skip(4);var r=e.getInt32()>>>0,n=e.getInt32()>>>0,i=e.getInt32()>>>0,a=e.getInt32()>>>0;e.skip(16);var o=e.getUint16();return this.width=r-i,this.height=n-a,this.componentsCount=o,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,t,i){var a={};try{for(var o=!1,l=t;l+1<i;){var u=v(e,l);l+=2;var c,h,d,f,p,m,y=0;switch(u){case 65359:a.mainHeader=!0;break;case 65497:break;case 65361:y=v(e,l);var _={};_.Xsiz=g(e,l+4),_.Ysiz=g(e,l+8),_.XOsiz=g(e,l+12),_.YOsiz=g(e,l+16),_.XTsiz=g(e,l+20),_.YTsiz=g(e,l+24),_.XTOsiz=g(e,l+28),_.YTOsiz=g(e,l+32);var b=v(e,l+36);_.Csiz=b;var x=[];c=l+38;for(var M=0;M<b;M++){var R={precision:1+(127&e[c]),isSigned:!!(128&e[c]),XRsiz:e[c+1],YRsiz:e[c+1]};r(R,_),x.push(R)}a.SIZ=_,a.components=x,n(a,x),a.QCC=[],a.COC=[];break;case 65372:y=v(e,l);var A={};switch(c=l+2,31&(h=e[c++])){case 0:f=8,p=!0;break;case 1:f=16,p=!1;break;case 2:f=16,p=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(A.noQuantization=8===f,A.scalarExpounded=p,A.guardBits=h>>5,d=[];c<y+l;){var k={};8===f?(k.epsilon=e[c++]>>3,k.mu=0):(k.epsilon=e[c]>>3,k.mu=(7&e[c])<<8|e[c+1],c+=2),d.push(k)}A.SPqcds=d,a.mainHeader?a.QCD=A:(a.currentTile.QCD=A,a.currentTile.QCC=[]);break;case 65373:y=v(e,l);var P,C={};switch(c=l+2,a.SIZ.Csiz<257?P=e[c++]:(P=v(e,c),c+=2),31&(h=e[c++])){case 0:f=8,p=!0;break;case 1:f=16,p=!1;break;case 2:f=16,p=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(C.noQuantization=8===f,C.scalarExpounded=p,C.guardBits=h>>5,d=[];c<y+l;)k={},8===f?(k.epsilon=e[c++]>>3,k.mu=0):(k.epsilon=e[c]>>3,k.mu=(7&e[c])<<8|e[c+1],c+=2),d.push(k);C.SPqcds=d,a.mainHeader?a.QCC[P]=C:a.currentTile.QCC[P]=C;break;case 65362:y=v(e,l);var L={};c=l+2;var I=e[c++];L.entropyCoderWithCustomPrecincts=!!(1&I),L.sopMarkerUsed=!!(2&I),L.ephMarkerUsed=!!(4&I),L.progressionOrder=e[c++],L.layersCount=v(e,c),c+=2,L.multipleComponentTransform=e[c++],L.decompositionLevelsCount=e[c++],L.xcb=2+(15&e[c++]),L.ycb=2+(15&e[c++]);var O=e[c++];if(L.selectiveArithmeticCodingBypass=!!(1&O),L.resetContextProbabilities=!!(2&O),L.terminationOnEachCodingPass=!!(4&O),L.verticalyStripe=!!(8&O),L.predictableTermination=!!(16&O),L.segmentationSymbolUsed=!!(32&O),L.reversibleTransformation=e[c++],L.entropyCoderWithCustomPrecincts){for(var H=[];c<y+l;){var D=e[c++];H.push({PPx:15&D,PPy:D>>4})}L.precinctsSizes=H}var N=[];if(L.selectiveArithmeticCodingBypass&&N.push("selectiveArithmeticCodingBypass"),L.resetContextProbabilities&&N.push("resetContextProbabilities"),L.terminationOnEachCodingPass&&N.push("terminationOnEachCodingPass"),L.verticalyStripe&&N.push("verticalyStripe"),L.predictableTermination&&N.push("predictableTermination"),N.length>0)throw o=!0,new Error("JPX Error: Unsupported COD options ("+N.join(", ")+")");a.mainHeader?a.COD=L:(a.currentTile.COD=L,a.currentTile.COC=[]);break;case 65424:y=v(e,l),(m={}).index=v(e,l+2),m.length=g(e,l+4),m.dataEnd=m.length+l-2,m.partIndex=e[l+8],m.partsCount=e[l+9],a.mainHeader=!1,0===m.partIndex&&(m.COD=a.COD,m.COC=a.COC.slice(0),m.QCD=a.QCD,m.QCC=a.QCC.slice(0)),a.currentTile=m;break;case 65427:0===(m=a.currentTile).partIndex&&(S(a,m.index),E(a)),w(a,e,l,y=m.dataEnd-l);break;case 65365:case 65367:case 65368:case 65380:y=v(e,l);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+u.toString(16))}l+=y}}catch(e){if(o||this.failOnCorruptedImage)throw e;s("Trying to recover from "+e.message)}this.tiles=function(e){for(var t=e.SIZ,r=e.components,n=t.Csiz,i=[],a=0,o=e.tiles.length;a<o;a++){var s,l=e.tiles[a],u=[];for(s=0;s<n;s++)u[s]=T(e,l,s);var c=u[0],h=r[0].isSigned;if(h)var d=new Int16Array(c.items.length*n);else var d=new Uint16Array(c.items.length*n);var f,p,m,v,g,y,_,b,E,w,x,S,M,R,A,k={left:c.left,top:c.top,width:c.width,height:c.height,items:d},P=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var C=4===n,L=u[0].items,I=u[1].items,O=u[2].items,H=C?u[3].items:null;f=r[0].precision-8,p=.5+(128<<f),v=-(g=.5*(m=255*(1<<f)));var D=l.components[0],N=n-3;if(_=L.length,D.codingStyleParameters.reversibleTransformation)for(y=0;y<_;y++,P+=N)b=L[y]+p,E=I[y],w=O[y],x=(S=b-(w+E>>2))+w,M=S+E,d[P++]=x<=0?0:x>=m?255:x>>f,d[P++]=S<=0?0:S>=m?255:S>>f,d[P++]=M<=0?0:M>=m?255:M>>f;else for(y=0;y<_;y++,P+=N)b=L[y]+p,E=I[y],w=O[y],x=b+1.402*w,S=b-.34413*E-.71414*w,M=b+1.772*E,d[P++]=x<=0?0:x>=m?255:x>>f,d[P++]=S<=0?0:S>=m?255:S>>f,d[P++]=M<=0?0:M>=m?255:M>>f;if(C)for(y=0,P=3;y<_;y++,P+=4)R=H[y],d[P]=R<=v?0:R>=g?255:R+p>>f}else for(s=0;s<n;s++)if(8===r[s].precision){var F=u[s].items;for(f=r[s].precision-8,p=.5+(128<<f),v=-(m=127.5*(1<<f)),P=s,y=0,_=F.length;y<_;y++)A=F[y],d[P]=A<=v?0:A>=m?255:A+p>>f,P+=n}else{var h=r[s].isSigned,F=u[s].items;if(h)for(P=s,y=0,_=F.length;y<_;y++)d[P]=F[y],P+=n;else{f=r[s].precision-8,p=.5+(128<<f);var U=Math.pow(2,r[s].precision)-1;for(P=s,y=0,_=F.length;y<_;y++)A=F[y],d[P]=Math.max(Math.min(A+p,U),0),P+=n}}i.push(k)}return i}(a),this.width=a.SIZ.Xsiz-a.SIZ.XOsiz,this.height=a.SIZ.Ysiz-a.SIZ.YOsiz,this.componentsCount=a.SIZ.Csiz}};var M=function(){function e(e,t){var r=m(Math.max(e,t))+1;this.levels=[];for(var n=0;n<r;n++){var i={width:e,height:t,items:[]};this.levels.push(i),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t){for(var r,n=0,i=0;n<this.levels.length;){var a=e+t*(r=this.levels[n]).width;if(void 0!==r.items[a]){i=r.items[a];break}r.index=a,e>>=1,t>>=1,n++}n--,(r=this.levels[n]).items[r.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];return--e<0?(this.value=r,!1):(this.currentLevel=e,(t=this.levels[e]).items[t.index]=r,!0)}},e}(),R=function(){function e(e,t){var r=m(Math.max(e,t))+1;this.levels=[];for(var n=0;n<r;n++){for(var i=new Uint8Array(e*t),a=new Uint8Array(e*t),o=0,s=i.length;o<s;o++)i[o]=0,a[o]=0;var l={width:e,height:t,items:i,status:a};this.levels.push(l),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t,r){this.currentStopValue=r;for(var n=0;n<this.levels.length;){var i=this.levels[n],a=e+t*i.width;i.index=a,e>>=1,t>>=1,n++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var e=this.currentLevel;if(--e<0)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var e=this.currentLevel,t=this.levels[e];return t.items[t.index]>this.currentStopValue},isKnown:function(){var e=this.currentLevel,t=this.levels[e];return t.status[t.index]>0},setKnown:function(){var e=this.currentLevel,t=this.levels[e];t.status[t.index]=1}},e}(),A=function(){var e=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),t=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),r=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);function n(n,i,a,o,s){this.width=n,this.height=i,this.contextLabelTable="HH"===a?r:"HL"===a?t:e;var l=n*i;this.neighborsSignificance=new Uint8Array(l),this.coefficentsSign=new Uint8Array(l),this.coefficentsMagnitude=s>14?new Uint32Array(l):s>6?new Uint16Array(l):new Uint8Array(l),this.processingFlags=new Uint8Array(l);var u=new Uint8Array(l);if(0!==o)for(var c=0;c<l;c++)u[c]=o;this.bitsDecoded=u,this.reset()}return n.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[17]=92,this.contexts[18]=6},setNeighborsSignificance:function(e,t,r){var n,i=this.neighborsSignificance,a=this.width,o=this.height,s=t>0,l=t+1<a;e>0&&(n=r-a,s&&(i[n-1]+=16),l&&(i[n+1]+=16),i[n]+=4),e+1<o&&(n=r+a,s&&(i[n-1]+=16),l&&(i[n+1]+=16),i[n]+=4),s&&(i[r-1]+=1),l&&(i[r+1]+=1),i[r]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,r=this.height,n=this.coefficentsMagnitude,i=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,s=this.contexts,l=this.contextLabelTable,u=this.bitsDecoded,c=0;c<r;c+=4)for(var h=0;h<t;h++)for(var d=c*t+h,f=0;f<4;f++,d+=t){var p=c+f;if(p>=r)break;if(o[d]&=-2,!n[d]&&a[d]){var m=l[a[d]];if(e.readBit(s,m)){var v=this.decodeSignBit(p,h,d);i[d]=v,n[d]=1,this.setNeighborsSignificance(p,h,d),o[d]|=2}u[d]++,o[d]|=1}}},decodeSignBit:function(e,t,r){var n,i,a,o,s,l,u=this.width,c=this.height,h=this.coefficentsMagnitude,d=this.coefficentsSign;o=t>0&&0!==h[r-1],t+1<u&&0!==h[r+1]?(a=d[r+1],n=o?1-a-(i=d[r-1]):1-a-a):n=o?1-(i=d[r-1])-i:0;var f=3*n;return o=e>0&&0!==h[r-u],e+1<c&&0!==h[r+u]?(a=d[r+u],n=o?1-a-(i=d[r-u])+f:1-a-a+f):n=o?1-(i=d[r-u])-i+f:f,n>=0?(s=9+n,l=this.decoder.readBit(this.contexts,s)):(s=9-n,l=1^this.decoder.readBit(this.contexts,s)),l},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,r=this.width,n=this.height,i=this.coefficentsMagnitude,a=this.neighborsSignificance,o=this.contexts,s=this.bitsDecoded,l=this.processingFlags,u=r*n,c=4*r,h=0;h<u;h=e){e=Math.min(u,h+c);for(var d=0;d<r;d++)for(var f=h+d;f<e;f+=r)if(i[f]&&0==(1&l[f])){var p=16;if(0!=(2&l[f]))l[f]^=2,p=0===(127&a[f])?15:14;var m=t.readBit(o,p);i[f]=i[f]<<1|m,s[f]++,l[f]|=1}}},runCleanupPass:function(){for(var e,t=this.decoder,r=this.width,n=this.height,i=this.neighborsSignificance,a=this.coefficentsMagnitude,o=this.coefficentsSign,s=this.contexts,l=this.contextLabelTable,u=this.bitsDecoded,c=this.processingFlags,h=r,d=2*r,f=3*r,p=0;p<n;p=e){e=Math.min(p+4,n);for(var m=p*r,v=p+3<n,g=0;g<r;g++){var y,_=m+g,b=0,E=_,w=p;if(v&&0===c[_]&&0===c[_+h]&&0===c[_+d]&&0===c[_+f]&&0===i[_]&&0===i[_+h]&&0===i[_+d]&&0===i[_+f]){if(!t.readBit(s,18)){u[_]++,u[_+h]++,u[_+d]++,u[_+f]++;continue}0!==(b=t.readBit(s,17)<<1|t.readBit(s,17))&&(w=p+b,E+=b*r),y=this.decodeSignBit(w,g,E),o[E]=y,a[E]=1,this.setNeighborsSignificance(w,g,E),c[E]|=2,E=_;for(var x=p;x<=w;x++,E+=r)u[E]++;b++}for(w=p+b;w<e;w++,E+=r)if(!a[E]&&0==(1&c[E])){var T=l[i[E]];1===t.readBit(s,T)&&(y=this.decodeSignBit(w,g,E),o[E]=y,a[E]=1,this.setNeighborsSignificance(w,g,E),c[E]|=2),u[E]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,t=this.contexts;if(10!==(e.readBit(t,17)<<3|e.readBit(t,17)<<2|e.readBit(t,17)<<1|e.readBit(t,17)))throw new Error("JPX Error: Invalid segmentation symbol")}},n}(),k=function(){function e(){}return e.prototype.calculate=function(e,t,r){for(var n=e[0],i=1,a=e.length;i<a;i++)n=this.iterate(n,e[i],t,r);return n},e.prototype.extend=function(e,t,r){var n=t-1,i=t+1,a=t+r-2,o=t+r;e[n--]=e[i++],e[o++]=e[a--],e[n--]=e[i++],e[o++]=e[a--],e[n--]=e[i++],e[o++]=e[a--],e[n]=e[i],e[o]=e[a]},e.prototype.iterate=function(e,t,r,n){var i,a,o,s,l,u,c=e.width,h=e.height,d=e.items,f=t.width,p=t.height,m=t.items;for(o=0,i=0;i<h;i++)for(s=2*i*f,a=0;a<c;a++,o++,s+=2)m[s]=d[o];d=e.items=null;var v=new Float32Array(f+8);if(1===f){if(0!=(1&r))for(u=0,o=0;u<p;u++,o+=f)m[o]*=.5}else for(u=0,o=0;u<p;u++,o+=f)v.set(m.subarray(o,o+f),4),this.extend(v,4,f),this.filter(v,4,f),m.set(v.subarray(4,4+f),o);var g=16,y=[];for(i=0;i<g;i++)y.push(new Float32Array(p+8));var _,b=0;if(e=4+p,1===p){if(0!=(1&n))for(l=0;l<f;l++)m[l]*=.5}else for(l=0;l<f;l++){if(0===b){for(g=Math.min(f-l,g),o=l,s=4;s<e;o+=f,s++)for(_=0;_<g;_++)y[_][s]=m[o+_];b=g}var E=y[--b];if(this.extend(E,4,p),this.filter(E,4,p),0===b)for(o=l-g+1,s=4;s<e;o+=f,s++)for(_=0;_<g;_++)m[o+_]=y[_][s]}return{width:f,height:p,items:m}},e}(),P=function(){function e(){k.call(this)}return e.prototype=Object.create(k.prototype),e.prototype.filter=function(e,t,r){var n,i,a,o,s=r>>1,l=-1.586134342059924,u=-.052980118572961,c=.882911075530934,h=.443506852043971,d=1.230174104914001;for(n=(t|=0)-3,i=s+4;i--;n+=2)e[n]*=.8128930661159609;for(a=h*e[(n=t-2)-1],i=s+3;i--&&(o=h*e[n+1],e[n]=d*e[n]-a-o,i--);n+=2)a=h*e[(n+=2)+1],e[n]=d*e[n]-a-o;for(a=c*e[(n=t-1)-1],i=s+2;i--&&(o=c*e[n+1],e[n]-=a+o,i--);n+=2)a=c*e[(n+=2)+1],e[n]-=a+o;for(a=u*e[(n=t)-1],i=s+1;i--&&(o=u*e[n+1],e[n]-=a+o,i--);n+=2)a=u*e[(n+=2)+1],e[n]-=a+o;if(0!==s)for(a=l*e[(n=t+1)-1],i=s;i--&&(o=l*e[n+1],e[n]-=a+o,i--);n+=2)a=l*e[(n+=2)+1],e[n]-=a+o},e}(),C=function(){function e(){k.call(this)}return e.prototype=Object.create(k.prototype),e.prototype.filter=function(e,t,r){var n,i,a=r>>1;for(n=t|=0,i=a+1;i--;n+=2)e[n]-=e[n-1]+e[n+1]+2>>2;for(n=t+1,i=a;i--;n+=2)e[n]+=e[n-1]+e[n+1]>>1},e}();return t}(),i=function(){var e=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];function t(e,t,r){this.data=e,this.bp=t,this.dataEnd=r,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}return t.prototype={byteIn:function(){var e=this.data,t=this.bp;255===e[t]?e[t+1]>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t);this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(t,r){var n,i=t[r]>>1,a=1&t[r],o=e[i],s=o.qe,l=this.a-s;if(this.chigh<s)l<s?(l=s,n=a,i=o.nmps):(l=s,n=1^a,1===o.switchFlag&&(a=n),i=o.nlps);else{if(this.chigh-=s,0!=(32768&l))return this.a=l,a;l<s?(n=1^a,1===o.switchFlag&&(a=n),i=o.nlps):(n=a,i=o.nmps)}do{0===this.ct&&this.byteIn(),l<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&l));return this.a=l,t[r]=i<<1|a,n}},t}(),a="undefined"==typeof window?this:window;a.PDFJS||(a.PDFJS={}),a.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};function o(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function s(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}var l;PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},PDFJS.UnsupportedManager=(l=[],{listen:function(e){l.push(e)},notify:function(e){s('Unsupported feature "'+e+'"');for(var t=0,r=l.length;t<r;t++)l[t](e)}});function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!1}),r}PDFJS.isValidUrl=function(e,t){if(!e)return!1;var r=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);if(!r)return t;switch(r=r[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}},PDFJS.shadow=u;PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};var c=function(){function e(e,t){this.name="PasswordException",this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.PasswordException=c;var h=function(){function e(e,t){this.name="UnknownErrorException",this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=h;var d=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=d;var f=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=f;var p=function(){function e(e,t){this.name="UnexpectedResponseException",this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=p;(function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e})(),function(){function e(e,t){this.begin=e,this.end=t,this.message="Missing data ["+e+", "+t+")"}e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e}(),function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e}();function m(e){for(var t=1,r=0;e>t;)t<<=1,r++;return r}function v(e,t){return e[t]<<8|e[t+1]}function g(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return u(PDFJS,"isLittleEndian",((e=new Uint8Array(2))[0]=1,1===new Uint16Array(e.buffer)[0]));var e}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return u(PDFJS,"hasCanvasTypedArrays",((e=document.createElement("canvas")).width=e.height=1,void 0!==e.getContext("2d").createImageData(1,1).data.buffer));var e}});!function(){function e(n,i){this.buffer=n,this.byteLength=n.length,this.length=void 0===i?this.byteLength>>2:i,function(n){for(;t<n;)Object.defineProperty(e.prototype,t,r(t)),t++}(this.length)}e.prototype=Object.create(null);var t=0;function r(e){return{get:function(){var t=this.buffer,r=e<<2;return(t[r]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24)>>>0},set:function(t){var r=this.buffer,n=e<<2;r[n]=255&t,r[n+1]=t>>8&255,r[n+2]=t>>16&255,r[n+3]=t>>>24&255}}}}();var y=PDFJS.Util=function(){function e(){}var t=["rgb(",0,",",0,",",0,")"];return e.makeCssRgb=function(e,r,n){return t[1]=e,t[3]=r,t[5]=n,t.join("")},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]},e.applyInverseTransform=function(e,t){var r=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/r,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/r]},e.getAxialAlignedBoundingBox=function(t,r){var n=e.applyTransform(t,r),i=e.applyTransform(t.slice(2,4),r),a=e.applyTransform([t[0],t[3]],r),o=e.applyTransform([t[2],t[1]],r);return[Math.min(n[0],i[0],a[0],o[0]),Math.min(n[1],i[1],a[1],o[1]),Math.max(n[0],i[0],a[0],o[0]),Math.max(n[1],i[1],a[1],o[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=[e[0],e[2],e[1],e[3]],r=e[0]*t[0]+e[1]*t[2],n=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(r+a)/2,s=Math.sqrt((r+a)*(r+a)-4*(r*a-i*n))/2,l=o+s||1,u=o-s||1;return[Math.sqrt(l),Math.sqrt(u)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,r){function n(e,t){return e-t}var i=[t[0],t[2],r[0],r[2]].sort(n),a=[t[1],t[3],r[1],r[3]].sort(n),o=[];return t=e.normalizeRect(t),r=e.normalizeRect(r),(i[0]===t[0]&&i[1]===r[0]||i[0]===r[0]&&i[1]===t[0])&&(o[0]=i[1],o[2]=i[2],(a[0]===t[1]&&a[1]===r[1]||a[0]===r[1]&&a[1]===t[1])&&(o[1]=a[1],o[3]=a[2],o))},e.sign=function(e){return e<0?-1:1},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var r in t)e[r]=t[r]},e.getInheritableProperty=function(e,t){for(;e&&!e.has(t);)e=e.get("Parent");return e?e.get(t):null},e.inherit=function(e,t,r){for(var n in e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r)e.prototype[n]=r[n]},e.loadScript=function(e,t){var r=document.createElement("script"),n=!1;r.setAttribute("src",e),t&&(r.onload=function(){n||t(),n=!0}),document.getElementsByTagName("head")[0].appendChild(r)},e}();PDFJS.PageViewport=function(){function e(e,t,r,n,i,a){this.viewBox=e,this.scale=t,this.rotation=r,this.offsetX=n,this.offsetY=i;var o,s,l,u,c,h,d,f,p=(e[2]+e[0])/2,m=(e[3]+e[1])/2;switch(r=(r%=360)<0?r+360:r){case 180:o=-1,s=0,l=0,u=1;break;case 90:o=0,s=1,l=1,u=0;break;case 270:o=0,s=-1,l=-1,u=0;break;default:o=1,s=0,l=0,u=-1}a&&(l=-l,u=-u),0===o?(c=Math.abs(m-e[1])*t+n,h=Math.abs(p-e[0])*t+i,d=Math.abs(e[3]-e[1])*t,f=Math.abs(e[2]-e[0])*t):(c=Math.abs(p-e[0])*t+n,h=Math.abs(m-e[1])*t+i,d=Math.abs(e[2]-e[0])*t,f=Math.abs(e[3]-e[1])*t),this.transform=[o*t,s*t,l*t,u*t,c-o*t*p-l*t*m,h-s*t*p-u*t*m],this.width=d,this.height=f,this.fontScale=t}return e.prototype={clone:function(t){var r="scale"in(t=t||{})?t.scale:this.scale,n="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),r,n,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return y.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=y.applyTransform([e[0],e[1]],this.transform),r=y.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],r[0],r[1]]},convertToPdfPoint:function(e,t){return y.applyInverseTransform([e,t],this.transform)}},e}();function _(){var e={};return e.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),e}PDFJS.createPromiseCapability=_,function(){if(a.Promise)return"function"!=typeof a.Promise.all&&(a.Promise.all=function(e){var t,r,n=0,i=[],o=new a.Promise(function(e,n){t=e,r=n});return e.forEach(function(e,a){n++,e.then(function(e){i[a]=e,0===--n&&t(i)},r)}),0===n&&t(i),o}),"function"!=typeof a.Promise.resolve&&(a.Promise.resolve=function(e){return new a.Promise(function(t){t(e)})}),"function"!=typeof a.Promise.reject&&(a.Promise.reject=function(e){return new a.Promise(function(t,r){r(e)})}),void("function"!=typeof a.Promise.prototype.catch&&(a.Promise.prototype.catch=function(e){return a.Promise.prototype.then(void 0,e)}));var e=0,t=2,r={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(t){t._status!==e&&(this.handlers=this.handlers.concat(t._handlers),t._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=Date.now()+1;this.handlers.length>0;){var r=this.handlers.shift(),n=r.thisPromise._status,i=r.thisPromise._value;try{1===n?"function"==typeof r.onResolve&&(i=r.onResolve(i)):"function"==typeof r.onReject&&(i=r.onReject(i),n=1,r.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(r.thisPromise))}catch(e){n=t,i=e}if(r.nextPromise._updateStatus(n,i),Date.now()>=e)break}this.handlers.length>0?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(e){e._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===e&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var e=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(e-this.unhandledRejections[t].time>500){var r=this.unhandledRejections[t].promise._value,n="Unhandled rejection: "+r;r.stack&&(n+="\n"+r.stack),s(n),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};function n(t){this._status=e,this._handlers=[];try{t.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(e){this._reject(e)}}n.all=function(e){var r,i,a=new n(function(e,t){r=e,i=t}),o=e.length,s=[];if(0===o)return r(s),a;function l(e){a._status!==t&&(s=[],i(e))}for(var u=0,c=e.length;u<c;++u){var h=e[u],d=function(e){return function(n){a._status!==t&&(s[e]=n,0===--o&&r(s))}}(u);n.isPromise(h)?h.then(d,l):d(h)}return a},n.isPromise=function(e){return e&&"function"==typeof e.then},n.resolve=function(e){return new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,r){r(e)})},n.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(e,i){1!==this._status&&this._status!==t&&(1===e&&n.isPromise(i)?i.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,t)):(this._status=e,this._value=i,e===t&&0===this._handlers.length&&(this._unhandledRejection=!0,r.addUnhandledRejection(this)),r.scheduleHandlers(this)))},_resolve:function(e){this._updateStatus(1,e)},_reject:function(e){this._updateStatus(t,e)},then:function(e,t){var i=new n(function(e,t){this.resolve=e,this.reject=t});return this._handlers.push({thisPromise:this,onResolve:e,onReject:t,nextPromise:i}),r.scheduleHandlers(this),i},catch:function(e){return this.then(void 0,e)}},a.Promise=n}();var b;!function(){function e(e,t,r){for(;e.length<r;)e+=t;return e}function t(){this.started={},this.times=[],this.enabled=!0}t.prototype={time:function(e){this.enabled&&(e in this.started&&s("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||s("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t,r,n=this.times,i="",a=0;for(t=0,r=n.length;t<r;++t){var o=n[t].name;o.length>a&&(a=o.length)}for(t=0,r=n.length;t<r;++t){var s=n[t],l=s.end-s.start;i+=e(s.name," ",a)+" "+l+"ms\n"}return i}}}();PDFJS.createBlob=function(e,t){if("undefined"!=typeof Blob)return new Blob([e],{type:t});var r=new MozBlobBuilder;return r.append(e),r.getBlob(t)},PDFJS.createObjectURL=(b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",function(e,t){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var r=PDFJS.createBlob(e,t);return URL.createObjectURL(r)}for(var n="data:"+t+";base64,",i=0,a=e.length;i<a;i+=3){var o=255&e[i],s=255&e[i+1],l=255&e[i+2];n+=b[o>>2]+b[(3&o)<<4|s>>4]+b[i+1<a?(15&s)<<2|l>>6:64]+b[i+2<a?63&l:64]}return n}),"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";var n=n||{};n.Utils=n.Utils||r(17),n.NIFTI1=n.NIFTI1||r(34),n.NIFTI2=n.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},n.NIFTI2.MAGIC_COOKIE=540,n.NIFTI2.MAGIC_NUMBER_LOCATION=4,n.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],n.NIFTI2.prototype.readHeader=function(e){var t,r,i,a,o=new DataView(e),s=n.Utils.getIntAt(o,0,this.littleEndian);if(s!==n.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,s=n.Utils.getIntAt(o,0,this.littleEndian)),s!==n.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=n.Utils.getShortAt(o,12,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(o,14,this.littleEndian),t=0;t<8;t+=1)a=16+8*t,this.dims[t]=n.Utils.getLongAt(o,a,this.littleEndian);for(this.intent_p1=n.Utils.getDoubleAt(o,80,this.littleEndian),this.intent_p2=n.Utils.getDoubleAt(o,88,this.littleEndian),this.intent_p3=n.Utils.getDoubleAt(o,96,this.littleEndian),t=0;t<8;t+=1)a=104+8*t,this.pixDims[t]=n.Utils.getDoubleAt(o,a,this.littleEndian);for(this.vox_offset=n.Utils.getLongAt(o,168,this.littleEndian),this.scl_slope=n.Utils.getDoubleAt(o,176,this.littleEndian),this.scl_inter=n.Utils.getDoubleAt(o,184,this.littleEndian),this.cal_max=n.Utils.getDoubleAt(o,192,this.littleEndian),this.cal_min=n.Utils.getDoubleAt(o,200,this.littleEndian),this.slice_duration=n.Utils.getDoubleAt(o,208,this.littleEndian),this.toffset=n.Utils.getDoubleAt(o,216,this.littleEndian),this.slice_start=n.Utils.getLongAt(o,224,this.littleEndian),this.slice_end=n.Utils.getLongAt(o,232,this.littleEndian),this.description=n.Utils.getStringAt(o,240,320),this.aux_file=n.Utils.getStringAt(o,320,344),this.qform_code=n.Utils.getIntAt(o,344,this.littleEndian),this.sform_code=n.Utils.getIntAt(o,348,this.littleEndian),this.quatern_b=n.Utils.getDoubleAt(o,352,this.littleEndian),this.quatern_c=n.Utils.getDoubleAt(o,360,this.littleEndian),this.quatern_d=n.Utils.getDoubleAt(o,368,this.littleEndian),this.qoffset_x=n.Utils.getDoubleAt(o,376,this.littleEndian),this.qoffset_y=n.Utils.getDoubleAt(o,384,this.littleEndian),this.qoffset_z=n.Utils.getDoubleAt(o,392,this.littleEndian),r=0;r<3;r+=1)for(i=0;i<4;i+=1)a=400+8*(4*r+i),this.affine[r][i]=n.Utils.getDoubleAt(o,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=n.Utils.getIntAt(o,496,this.littleEndian),this.xyzt_units=n.Utils.getIntAt(o,500,this.littleEndian),this.intent_code=n.Utils.getIntAt(o,504,this.littleEndian),this.intent_name=n.Utils.getStringAt(o,508,524),this.dim_info=n.Utils.getByteAt(o,524),o.byteLength>n.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(o,540),this.extensionFlag[1]=n.Utils.getByteAt(o,541),this.extensionFlag[2]=n.Utils.getByteAt(o,542),this.extensionFlag[3]=n.Utils.getByteAt(o,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(o),this.extensionCode=this.getExtensionCode(o)))},n.NIFTI2.prototype.toFormattedString=function(){var e=n.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",t+='Intent Name: "'+this.intent_name+'"\n',t+="Dim Info = "+this.dim_info+"\n"},n.NIFTI2.prototype.getExtensionLocation=function(){return n.NIFTI2.MAGIC_COOKIE+4},n.NIFTI2.prototype.getExtensionSize=n.NIFTI1.prototype.getExtensionSize,n.NIFTI2.prototype.getExtensionCode=n.NIFTI1.prototype.getExtensionCode,n.NIFTI2.prototype.getDatatypeCodeString=n.NIFTI1.prototype.getDatatypeCodeString,n.NIFTI2.prototype.getTransformCodeString=n.NIFTI1.prototype.getTransformCodeString,n.NIFTI2.prototype.getUnitsCodeString=n.NIFTI1.prototype.getUnitsCodeString,n.NIFTI2.prototype.getQformMat=n.NIFTI1.prototype.getQformMat,n.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,n.NIFTI2.prototype.convertNiftiSFormToNEMA=n.NIFTI1.prototype.convertNiftiSFormToNEMA,n.NIFTI2.prototype.nifti_mat33_mul=n.NIFTI1.prototype.nifti_mat33_mul,n.NIFTI2.prototype.nifti_mat33_determ=n.NIFTI1.prototype.nifti_mat33_determ,"undefined"!==typeof e&&e.exports&&(e.exports=n.NIFTI2)},function(e,t,r){"use strict";var n=r(145),i=/[ \f\t\v]*\r?\n/,a=/^NRRD\d{4}$/,o=/^([^:]*)(:[ =])(.*)$/,s=/^LIST(?: (\d+))?$/;function l(e,t,r,i){var a,o,s=(o=e)in h?h[o]:o;switch(e){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":a=s+": "+t;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":n("number"==typeof t||t instanceof Number,"Field "+e+" should at least contain a number!"),a=s+": "+t;break;case"min":case"max":case"oldMin":case"oldMax":n("number"==typeof t||t instanceof Number,"Field "+e+" should contain a number!"),a=s+": "+t;break;case"spaceOrigin":n(t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach(function(t){n("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),a=s+": ("+t.join(",")+")";break;case"labels":case"units":case"spaceUnits":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){n("string"==typeof t||t instanceof String,"Field "+e+" should be a list of numbers!")}),a=s+": "+t.map(g).join(" ");break;case"sizes":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){n("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),a=s+": "+t.join(" ");break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){n("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),a=s+": "+t.join(" ");break;case"spaceDirections":n(void 0!==t.length&&t.length===r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){n(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){n("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")})}),a=s+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"measurementFrame":n(void 0!==t.length&&t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach(function(t){n(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){n("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")})}),a=s+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"type":case"encoding":case"endian":n("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),a=s+": "+t;break;case"dataFile":t.length||t.files&&"subdim"in t||(a=s+": "+function(e){if("string"==typeof e||e instanceof String)return e;if("format"in e&&"min"in e&&"max"in e&&"step"in e)return"subdim"in e?e.format+" "+e.min+" "+e.max+" "+e.step+" "+e.subdim:e.format+" "+e.min+" "+e.max+" "+e.step;throw new Error("Unrecognized data file format!")}(t));break;case"centers":case"kinds":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),a=s+": "+t.map(R).join(" ");break;default:console.warn("Unrecognized NRRD field: "+e+", skipping.")}return a}function u(e,t){switch(e){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":t=f(t);break;case"min":case"max":case"oldMin":case"oldMax":t=p(t);break;case"spaceOrigin":t=m(t);break;case"labels":case"units":case"spaceUnits":t=_(t,v);break;case"sizes":t=_(t,f);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":t=_(t,p);break;case"spaceDirections":case"measurementFrame":t=_(t,m);break;case"type":t=b(t);break;case"encoding":t=E(t);break;case"endian":t=w(t);break;case"dataFile":r=t,t=(n=x.exec(r))?5==n.length&&n[4]?{format:r.substring(0,n.index),min:f(n[1]),max:f(n[2]),step:f(n[3]),subdim:f(n[4])}:{format:r.substring(0,n.index),min:f(n[1]),max:f(n[2]),step:f(n[3])}:r;break;case"centers":t=_(t,T);break;case"kinds":t=_(t,M);break;case"space":t=function(e){switch(e.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+e),e}}(t);break;default:console.warn("Unrecognized NRRD field: "+e)}var r,n;return t}e.exports.serialize=function(e){var t,r,n,i,a,o,s,u,c,h,d=1,f={},p=[];for(i in e)f[i]=e[i];if(void 0===f.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===f.dimension&&(f.dimension=f.sizes.length),f.data instanceof Int8Array?a="int8":f.data instanceof Uint8Array?a="uint8":f.data instanceof Int16Array?a="int16":f.data instanceof Uint16Array?a="uint16":f.data instanceof Int32Array?a="int32":f.data instanceof Uint32Array?a="uint32":f.data instanceof Float32Array?a="float":f.data instanceof Float64Array&&(a="double"),void 0===f.type&&void 0!==a)f.type=a;else{if(void 0===f.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof f.type||f.type instanceof String)&&(f.type=b(f.type))}void 0===f.encoding?f.encoding="raw":("string"==typeof f.encoding||f.encoding instanceof String)&&(f.encoding=E(f.encoding)),f.data&&"block"!=f.type&&"int8"!=f.type&&"uint8"!=f.type&&"ascii"!=f.encoding?f.endian=C:"block"==f.type||"int8"==f.type||"uint8"==f.type||"ascii"==f.encoding?f.endian=void 0:("string"==typeof f.endian||f.endian instanceof String)&&(f.endian=w(f.endian));var m=void 0;if(void 0!==f.spaceDimension)m=f.spaceDimension;else if(void 0!==f.space)switch(f.space){case"right-anterior-superior":case"RAS":m=3;break;case"left-anterior-superior":case"LAS":m=3;break;case"left-posterior-superior":case"LPS":m=3;break;case"right-anterior-superior-time":case"RAST":m=4;break;case"left-anterior-superior-time":case"LAST":m=4;break;case"left-posterior-superior-time":case"LPST":m=4;break;case"scanner-xyz":m=3;break;case"scanner-xyz-time":m=4;break;case"3D-right-handed":case"3D-left-handed":m=3;break;case"3D-right-handed-time":case"3D-left-handed-time":m=4;break;default:console.warn("Unrecognized space: "+f.space)}for(O(f),t=0;t<f.sizes.length;t++){if(f.sizes[t]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");d*=f.sizes[t]}if(f.data){if(f.data.length<d)throw new Error("Missing data to serialize!")}else if(f.buffer){if("raw"==f.encoding&&(o="block"==f.type&&void 0!==f.blockSize?f.blockSize:I(f.type),f.buffer.byteLength<d*o))throw new Error("Missing data to serialize!")}else if(!f.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(f.data)switch(f.encoding){case"raw":s=f.type==a&&f.endian==C?f.data.buffer.slice(f.data.byteOffset,f.data.byteOffset+f.data.byteLength):f.endian==C?(s=H(f.data,f.type)).buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):function(e,t,r){var n,i,a,o=I(t),s=new ArrayBuffer(e.length*o);switch(r){case"big":i=!1;break;case"little":i=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+r)}switch(a=new DataView(s),t){case"int8":for(n=0;n<e.length;n++)a.setInt8(n,e[n],i);return s;case"uint8":for(n=0;n<e.length;n++)a.setUint8(n,e[n],i);return s;case"int16":for(n=0;n<e.length;n++)a.setInt16(2*n,e[n],i);return s;case"uint16":for(n=0;n<e.length;n++)a.setUint16(2*n,e[n],i);return s;case"int32":for(n=0;n<e.length;n++)a.setInt32(4*n,e[n],i);return s;case"uint32":for(n=0;n<e.length;n++)a.setUint32(4*n,e[n],i);return s;case"float":for(n=0;n<e.length;n++)a.setFloat32(4*n,e[n],i);return s;case"double":for(n=0;n<e.length;n++)a.setFloat64(8*n,e[n],i);return s;default:return void console.warn("Cannot serialize NRRD type: "+t+".")}}(f.data,f.type,f.endian);break;case"ascii":s=f.type==a?D(f.data):D(H(f.data,f.type));break;default:throw new Error("Unsupported NRRD encoding: "+f.encoding)}else f.buffer&&(s=f.buffer);p.push("NRRD0005"),p.push("# Generated by nrrd-js");var v=["dimension","spaceDimension","space"];for(t=0;t<v.length;t++)void 0!==f[i=v[t]]&&void 0!==(c=l(i,f[i],f.dimension,m))&&p.push(c);for(i in f)void 0!==f[i]&&(v.indexOf(i)>=0||void 0!==(c=l(i,f[i],f.dimension,m))&&p.push(c));if(f.keys)for(i in f.keys){if(i.indexOf(":=")>=0)throw new Error("The combination ':=' is not allowed in an NRRD key!");p.push(i+":="+f[i].replace("\\","\\\\").replace("\n","\\n"))}if(f.dataFile&&f.dataFile.length?(p.push("data file: LIST"),Array.prototype.push.apply(p,f.dataFile)):f.dataFile&&f.dataFile.files&&"subdim"in f.dataFile&&(p.push("data file: LIST "+f.dataFile.subdim),Array.prototype.push.apply(p,f.dataFile.files)),!s||"dataFile"in f)for(p.push(""),h=p.join("\n"),r=new ArrayBuffer(h.length),n=new Uint8Array(r),t=0;t<h.length;t++)n[t]=h.charCodeAt(t);else{for(p.push(""),p.push(""),h=p.join("\n"),r=new ArrayBuffer(h.length+s.byteLength),n=new Uint8Array(r),t=0;t<h.length;t++)n[t]=h.charCodeAt(t);u=new Uint8Array(s),n.set(u,h.length)}return r},e.exports.parse=function(e){var t,r,n,l,c,h,m={data:void 0,buffer:void 0,keys:{},version:void 0},v=new Uint8Array(e);for(v.buffer!==e&&(e=v.buffer),t=2;t<v.length;)if(10==v[t]){if(10==v[t-1]||13==v[t-1]&&10==v[t-2]){n=t+1;break}t++}else 13==v[t]?t++:t+=2;if(void 0===n?r=String.fromCharCode.apply(null,v):(r=String.fromCharCode.apply(null,v.subarray(0,n)),m.buffer=e.slice(n)),l=(l=r.split(i)).filter(function(e){return e.length>0&&"#"!=e[0]}),!a.test(l[0]))throw new Error("File is not an NRRD file!");for(m.version=parseInt(l[0].substring(4,8),10),m.version>5&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),t=1;t<l.length;t++)if(c=o.exec(l[t]))if(": "==c[2])c[1]=d(c[1]),"dataFile"==c[1]&&(h=s.exec(c[3]))?(2==h.length&&h[1]?m[c[1]]={files:l.slice(t+1),subdim:f(h[1])}:m[c[1]]=l.slice(t+1),l.length=t):m[c[1]]=u(c[1],c[3]);else{if(":="!=c[2])throw new Error("Logic error in NRRD parser.");m.keys[c[1]]=c[3].split("\\\\").map(function(e){return e.replace("\\n","\n")}).join("\\")}else console.warn("Unrecognized line in NRRD header: "+l[t]);if(O(m),"dataFile"in m)console.warn("No support for external data yet!");else switch(m.encoding){case"raw":m.data=function(e,t,r,n){var i,a,o,s=1;for(i=0;i<r.length;i++){if(r[i]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");s*=r[i]}if("block"==t)return e.slice(0,s*n.blockSize);if("int8"==t||"uint8"==t||n.endian==C)switch(t){case"int8":return l(1),new Int8Array(e.slice(0,s));case"uint8":return l(1),new Uint8Array(e.slice(0,s));case"int16":return l(2),new Int16Array(e.slice(0,2*s));case"uint16":return l(2),new Uint16Array(e.slice(0,2*s));case"int32":return l(4),new Int32Array(e.slice(0,4*s));case"uint32":return l(4),new Uint32Array(e.slice(0,4*s));case"float":return l(4),new Float32Array(e.slice(0,4*s));case"double":return l(8),new Float64Array(e.slice(0,8*s));default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}else{switch(n.endian){case"big":!1;break;case"little":!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+n.endian)}switch(o=new DataView(e),t){case"int8":for(a=new Int8Array(s),i=0;i<s;i++)a[i]=o.getInt8(i);return a;case"uint8":for(a=new Uint8Array(s),i=0;i<s;i++)a[i]=o.getUint8(i);return a;case"int16":for(a=new Int16Array(s),i=0;i<s;i++)a[i]=o.getInt16(2*i);return a;case"uint16":for(a=new Uint16Array(s),i=0;i<s;i++)a[i]=o.getUint16(2*i);return a;case"int32":for(a=new Int32Array(s),i=0;i<s;i++)a[i]=o.getInt32(4*i);return a;case"uint32":for(a=new Uint32Array(s),i=0;i<s;i++)a[i]=o.getUint32(4*i);return a;case"float":for(a=new Float32Array(s),i=0;i<s;i++)a[i]=o.getFloat32(4*i);return a;case"double":for(a=new Float64Array(s),i=0;i<s;i++)a[i]=o.getFloat64(8*i);return a;default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}}function l(t){if(e.byteLength<s*t)throw new Error("NRRD file does not contain enough data!")}}(m.buffer,m.type,m.sizes,{endian:m.endian,blockSize:m.blockSize});break;case"ascii":m.data=function(e,t,r){var n,i,a,o,s=1;for(n=0;n<r.length;n++){if(r[n]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");s*=r[n]}if(i=new Uint8Array(e),a=String.fromCharCode.apply(null,i),(o=a.split(L)).length<s)throw new Error("Not enough data in NRRD file!");o.length>s&&(""===o[0]&&(o=o.slice(1)),o=o.slice(0,s));switch(t){case"int8":return new Int8Array(o.map(f));case"uint8":return new Uint8Array(o.map(f));case"int16":return new Int16Array(o.map(f));case"uint16":return new Uint16Array(o.map(f));case"int32":return new Int32Array(o.map(f));case"uint32":return new Uint32Array(o.map(f));case"float":return new Float32Array(o.map(p));case"double":return new Float64Array(o.map(p));default:return void console.warn("Unsupported NRRD type: "+t+".")}}(m.buffer,m.type,m.sizes);break;default:console.warn("Unsupported NRRD encoding: "+m.encoding)}return m};var c={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},h=function(){var e,t={};for(e in c)t[c[e]]=e;return t}();function d(e){return(e=e.toLowerCase())in c?c[e]:e}function f(e){var t=parseInt(e,10);if(Number.isNaN(t))throw new Error("Malformed NRRD integer: "+e);return t}function p(e){if((e=e.toLowerCase()).indexOf("nan")>=0)return NaN;if(e.indexOf("-inf")>=0)return-1/0;if(e.indexOf("inf")>=0)return 1/0;var t=parseFloat(e);if(Number.isNaN(t))throw new Error("Malformed NRRD float: "+e);return t}function m(e){if("none"==e)return null;if(e.length<2||"("!==e[0]||")"!==e[e.length-1])throw new Error("Malformed NRRD vector: "+e);return e.slice(1,-1).split(",").map(p)}function v(e){if(length<2||'"'!=e[0]||'"'!=e[e.length-1])throw new Error("Invalid NRRD quoted string: "+e);return e.slice(1,-1).replace('\\"','"')}function g(e){return'"'+e.replace('"','\\"')+'"'}var y=/[ \t]+/;function _(e,t){return e.split(y).map(t)}function b(e){switch(e.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+e),e}}function E(e){switch(e.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+e),e}}function w(e){switch(e.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+e),e}}var x=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/;function T(e){switch(e.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+e),e}}var S={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null};function M(e){var t=e.toLowerCase();return t in S?S[t]:(console.warn("Unrecognized NRRD kind: "+e),e)}function R(e){return null===e?"???":e}var A,k,P,C=(A=new ArrayBuffer(4),k=new Uint32Array(A),P=new Uint8Array(A),k[0]=16909060,1==P[0]&&2==P[1]&&3==P[2]&&4==P[3]?"big":4==P[0]&&3==P[1]&&2==P[2]&&1==P[3]?"little":void console.warn("Unrecognized system endianness!"));var L=/[ \t\n\r\v\f]+/;function I(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":return 4;case"int64":case"uint64":return 8;case"float":return 4;case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+e)}}function O(e){if(void 0===e.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===e.type)throw new Error("Type missing from NRRD file!");if(void 0===e.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===e.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=e.type&&"int8"!=e.type&&"uint8"!=e.type&&"ascii"!=e.encoding&&void 0===e.endian)throw new Error("Endianness missing from NRRD file!");if("block"==e.type&&void 0===e.blockSize)throw new Error("Missing block size in NRRD file!");if(0===e.dimension)throw new Error("Zero-dimensional NRRD file?");if(e.dimension!=e.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(e.spacings&&e.dimension!=e.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(e.thicknesses&&e.dimension!=e.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(e.axisMins&&e.dimension!=e.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(e.axisMaxs&&e.dimension!=e.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");if(e.centers&&e.dimension!=e.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(e.labels&&e.dimension!=e.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(e.units&&e.dimension!=e.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(e.kinds&&e.dimension!=e.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if(!(void 0!==e.data&&0!==e.data.length||void 0!==e.buffer&&0!==e.buffer.byteLength||void 0!==e.dataFile))throw new Error("NRRD file has neither inline or external data!")}function H(e,t){switch(t){case"int8":return new Int8Array(e);case"uint8":return new Uint8Array(e);case"int16":return new Int16Array(e);case"uint16":return new Uint16Array(e);case"int32":return new Int32Array(e);case"uint32":return new Uint32Array(e);case"float":return new Float32Array(e);case"double":return new Float64Array(e);default:throw new Error("Cannot cast to NRRD type: "+t)}}function D(e){var t,r,n,i,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=""+e[t];for(r=a.join(" "),n=new ArrayBuffer(r.length),i=new Uint8Array(n),t=0;t<i.length;t++)i[t]=r.charCodeAt(t);return n}},function(e,t,r){"use strict";(function(t){var n=r(146);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function i(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function a(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=r(147),s=Object.prototype.hasOwnProperty,l=Array.prototype.slice,u="foo"===function(){}.name;function c(e){return Object.prototype.toString.call(e)}function h(e){return!a(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var d=e.exports=y,f=/\s*function\s+([^\(\s]*)\s*/;function p(e){if(o.isFunction(e)){if(u)return e.name;var t=e.toString().match(f);return t&&t[1]}}function m(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function v(e){if(u||!o.isFunction(e))return o.inspect(e);var t=p(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,r,n,i){throw new d.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function y(e,t){e||g(e,!0,t,"==",d.ok)}function _(e,t,r,n){if(e===t)return!0;if(a(e)&&a(t))return 0===i(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(h(e)&&h(t)&&c(e)===c(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(a(e)!==a(t))return!1;var s=(n=n||{actual:[],expected:[]}).actual.indexOf(e);return-1!==s&&s===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=b(e),a=b(t);if(i&&!a||!i&&a)return!1;if(i)return e=l.call(e),t=l.call(t),_(e,t,r);var s,u,c=x(e),h=x(t);if(c.length!==h.length)return!1;for(c.sort(),h.sort(),u=c.length-1;u>=0;u--)if(c[u]!==h[u])return!1;for(u=c.length-1;u>=0;u--)if(s=c[u],!_(e[s],t[s],r,n))return!1;return!0}(e,t,r,n))}return r?e===t:e==t}function b(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function E(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function w(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&g(i,r,"Missing expected exception"+n);var a="string"==typeof n,s=!e&&i&&!r;if((!e&&o.isError(i)&&a&&E(i,r)||s)&&g(i,r,"Got unwanted exception"+n),e&&i&&r&&!E(i,r)||!e&&i)throw i}d.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return m(v(e.actual),128)+" "+e.operator+" "+m(v(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,i=p(t),a=n.indexOf("\n"+i);if(a>=0){var o=n.indexOf("\n",a+1);n=n.substring(o+1)}this.stack=n}}},o.inherits(d.AssertionError,Error),d.fail=g,d.ok=y,d.equal=function(e,t,r){e!=t&&g(e,t,r,"==",d.equal)},d.notEqual=function(e,t,r){e==t&&g(e,t,r,"!=",d.notEqual)},d.deepEqual=function(e,t,r){_(e,t,!1)||g(e,t,r,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(e,t,r){_(e,t,!0)||g(e,t,r,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(e,t,r){_(e,t,!1)&&g(e,t,r,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function e(t,r,n){_(t,r,!0)&&g(t,r,n,"notDeepStrictEqual",e)},d.strictEqual=function(e,t,r){e!==t&&g(e,t,r,"===",d.strictEqual)},d.notStrictEqual=function(e,t,r){e===t&&g(e,t,r,"!==",d.notStrictEqual)},d.throws=function(e,t,r){w(!0,e,t,r)},d.doesNotThrow=function(e,t,r){w(!1,e,t,r)},d.ifError=function(e){if(e)throw e},d.strict=n(function e(t,r){t||g(t,!0,r,"==",e)},d,{equal:d.strictEqual,deepEqual:d.deepStrictEqual,notEqual:d.notStrictEqual,notDeepEqual:d.notDeepStrictEqual}),d.strict.strict=d.strict;var x=Object.keys||function(e){var t=[];for(var r in e)s.call(e,r)&&t.push(r);return t}}).call(this,r(5))},function(e,t,r){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,s,l=o(e),u=1;u<arguments.length;u++){for(var c in r=Object(arguments[u]))i.call(r,c)&&(l[c]=r[c]);if(n){s=n(r);for(var h=0;h<s.length;h++)a.call(r,s[h])&&(l[s[h]]=r[s[h]])}}return l}},function(e,t,r){(function(e){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},i=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,o=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),l=n[r];r<a;l=n[++r])m(l)||!b(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(r,n){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var a,o={};function s(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,e,n.depth)}function l(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function u(e,t){return e}function c(e,r,n){if(e.customInspect&&r&&x(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return g(i)||(i=c(e,i,n)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(v(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,r);if(a)return a;var o=Object.keys(r),s=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),w(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(r);if(0===o.length){if(x(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(_(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return e.stylize(Date.prototype.toString.call(r),"date");if(w(r))return h(r)}var u,b="",T=!1,S=["{","}"];(f(r)&&(T=!0,S=["[","]"]),x(r))&&(b=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(b=" "+RegExp.prototype.toString.call(r)),E(r)&&(b=" "+Date.prototype.toUTCString.call(r)),w(r)&&(b=" "+h(r)),0!==o.length||T&&0!=r.length?n<0?_(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=T?function(e,t,r,n,i){for(var a=[],o=0,s=t.length;o<s;++o)A(t,String(o))?a.push(d(e,t,r,n,String(o),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(d(e,t,r,n,i,!0))}),a}(e,r,n,s,o):o.map(function(t){return d(e,r,n,s,t,T)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,b,S)):S[0]+b+S[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),A(n,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(r)?c(e,l.value,null):c(e,l.value,r-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function v(e){return"number"==typeof e}function g(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===T(e)}function b(e){return"object"==typeof e&&null!==e}function E(e){return b(e)&&"[object Date]"===T(e)}function w(e){return b(e)&&("[object Error]"===T(e)||e instanceof Error)}function x(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(r){if(y(a)&&(a=e.env.NODE_DEBUG||""),r=r.toUpperCase(),!o[r])if(new RegExp("\\b"+r+"\\b","i").test(a)){var n=e.pid;o[r]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",r,n,e)}}else o[r]=function(){};return o[r]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=_,t.isObject=b,t.isDate=E,t.isError=w,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(148);var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),M[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",R(),t.format.apply(t,arguments))},t.inherits=r(149),t._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var k="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(k&&e[k]){var t;if("function"!=typeof(t=e[k]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise(function(e,n){t=e,r=n}),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push(function(e,n){e?r(e):t(n)});try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),k&&Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=k,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};t.apply(this,r).then(function(t){e.nextTick(o,null,t)},function(t){e.nextTick(P,t,o)})}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.defineProperties(r,n(t)),r}}).call(this,r(6))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"Octree",function(){return me}),r.d(n,"World",function(){return ye}),r.d(n,"HeroAnimator",function(){return be}),r.d(n,"HeroController",function(){return Ee}),r.d(n,"KeyInputControl",function(){return je}),r.d(n,"TPSCameraControl",function(){return qe});var i=r(0);window.THREE=i,r(40),r(41),r(42),r(43),r(44),r(45),r(46),r(47),r(48),r(49),r(50),r(51),r(52),r(53),r(54),r(55),r(56),r(57),r(58),r(59),r(60),r(61),r(62),r(63),r(64),r(65),r(70),r(71),r(72),r(73),r(74),r(75),r(76),r(77),r(78),r(79),r(80),r(81),r(82),r(83),r(84),r(85),r(86),r(87),r(88),r(89),r(90),r(91),r(92),r(93),r(94),r(95),r(96),r(97),r(98),r(99),r(100),r(101),r(102),r(103),r(104),r(105),r(106),r(107),r(108),r(109),r(110),r(111),r(112),r(113),r(114),r(115),r(116),r(117);var a,o,s,l,u,c,h,d,f,p,m,v,g,y,_,b={tabIndices:{viewWorks:"1",gameWorks:"1",natureWorks:"1",sketcher:"4"},zIndices:{viewWorks:"0",natureWorks:"0",sketcher:"2",colorSelector:"3",matcaps:"4"},renderer:null,scene:null,camera:null,appWorks:null,shaders:null,sunLight:null,TEXTURE_MAPS:["map","matcap","alphaMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","specularMap","envMap","lightMap","aoMap","emissiveMap","gradientMap"],WORLD_SIZE:1e3,GRID_SPACING:5,GROUND_HEIGHT:0,WATER_HEIGHT:0,WATER_COLOR:7695,OCEAN_COLOR:27028,FOG_COLOR:14014425,SUN_COLOR:16777215},E=r(9);b.clock=new THREE.Clock,b.getDeltaTime=function(){return b.clock.getDelta()},b.getCurrentTime=function(){return b.clock.getElapsedTime()},b.humanFileSize=function(e,t,r,n,i){return(t=Math,r=t.log,1e3,i=r(e)/r(1e3)|0,e/t.pow(1e3,i)).toFixed(2)+" "+(i?"KMGTPEZY"[--i]+"B":"Bytes")},b.isDeviceMobile=function(){var e=!1;return/Mobi|Android|webOS|Tablet|iPad|iPhone|iPod|Windows Phone|BlackBerry|BB10|Opera Mini/i.test(navigator.userAgent)&&(e=!0),e},b.isDeviceLandscape=function(){return 90===window.orientation||-90===window.orientation},b.isDeviceTouch=function(){return"ontouchend"in window},b.isDeviceWindowsOS=function(){return navigator.platform.toUpperCase().indexOf("WIN32")>=0},b.isDeviceMacOS=function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0},b.isDeviceiOS=function(){return/iPad|iPhone|iPod/g.test(navigator.userAgent)&&!window.MSStream},b.isWebGL1Available=function(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},b.isWebGL2Available=function(){var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))},b.isWebGL1=function(){var e=b.appWorks.renderer.context;return void 0!==e&&e instanceof window.WebGLRenderingContext},b.isWebGL2=function(){var e=b.appWorks.renderer.context;return void 0!==e&&e instanceof window.WebGL2RenderingContext},b.getWebGLInfo=function(){var e=[],t="WebGL1: "+(b.isWebGL1Available()?"available":"unavailable");e.push(t);var r="WebGL2: "+(b.isWebGL2Available()?"available":"unavailable");e.push(r);var n=b.appWorks.renderer.context.getSupportedExtensions();return e=e.concat(n)},b.isWebGLExtensionAvailable=function(e){return b.appWorks.renderer.context.getSupportedExtensions().indexOf(e)>=0},Number.prototype.format=function(){return this.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},String.prototype.trunc=function(e,t){if(this.length<=e)return(" "+this).slice(1);var r=this.substr(0,e);return(t?r.substr(0,r.lastIndexOf(" ")+1):r)+"..."},Array.prototype.clone=function(){return this.map(e=>Array.isArray(e)?e.clone():e)},Array.prototype.sum=function(){return this.reduce(function(e,t){return e+Number(t)},0)},Array.prototype.average=function(){return this.sum()/(this.length||1)},Array.prototype.zero=function(e){for(var t=0;t<e;t++)this[t]=0;return this},Array.prototype.scale=function(e){return this.map((t,r)=>e*t)},Array.prototype.add=function(e){return this.map((t,r)=>t+e[r])},Array.prototype.sub=function(e){return this.map((t,r)=>t-e[r])},Array.prototype.mul=function(e){return this.map((t,r)=>t*e[r])},Array.prototype.div=function(e){return this.map((t,r)=>t/e[r])},Array.prototype.dot=function(e){return this.map((t,r)=>t*e[r]).reduce((e,t)=>e+t)},Array.prototype.norm2=function(){return Math.sqrt(this.map((e,t)=>e*e).reduce((e,t)=>e+t))},Array.prototype.transpose=function(){var e=this;return e[0].map(function(t,r){return e.map(function(e,t){return e[r]})})},Array.prototype.mmultiply=function(e){return this.map(function(t,r){return e.transpose().map(function(e,r){return t.dot(e)})})},Array.prototype.sortNumbers=function(e){return"ascending"===(e=e||"ascending")?this.sort((e,t)=>e-t):"descending"===e&&this.sort((e,t)=>t-e),this},Array.prototype.minX=function(){return this.reduce((e,t)=>t.x<e?t.x:e,this[0].x)},Array.prototype.maxX=function(){return this.reduce((e,t)=>t.x>e?t.x:e,this[0].x)},Array.prototype.minY=function(){return this.reduce((e,t)=>t.y<e?t.y:e,this[0].y)},Array.prototype.maxY=function(){return this.reduce((e,t)=>t.y>e?t.y:e,this[0].y)},Array.prototype.minZ=function(){return this.reduce((e,t)=>t.z<e?t.z:e,this[0].z)},Array.prototype.maxZ=function(){return this.reduce((e,t)=>t.z>e?t.z:e,this[0].z)},Array.prototype.min=function(){return this.reduce((e,t)=>t<e?t:e,this[0])},Array.prototype.max=function(){return this.reduce((e,t)=>t>e?t:e,this[0])},b.concatTypedArrays=function(e,...t){const r=new e(t.reduce((e,t)=>e+t.length,0));return t.reduce((e,t)=>(r.set(t,e),e+t.length),0),r},b.fromTypedArray=function(e){return[].slice.call(e)},b.fillArray=function(e,t){for(var r=[],n=t;n--;)r[n]=e;return r},b.flattenArray=function(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?b.flattenArray(t):t)},[])},b.flattenVector2s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y)}return t},b.flattenVector3s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z)}return t},b.flattenVector4s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z,i.w)}return t},b.mergeArray3=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],a.z=e[o][2],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)+"_"+Math.round(a.z*t)]&&(n[r]=o,i.push([e[o][0],e[o][1],e[o][2]]));return i.slice(0)},b.mergeArray2=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)]&&(n[r]=o,i.push([e[o][0],e[o][1]]));return i.slice(0)},b.mergeArray=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o],void 0===n[r=Math.round(a.x*t)]&&(n[r]=o,i.push(e[o]));return i.slice(0)},b.mergeVertices=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n,i={},a=0,o=e.length;a<o;a++)r=e[a],void 0===i[n=Math.round(r.x*t)+"_"+Math.round(r.y*t)+"_"+Math.round(r.z*t)]&&(i[n]=a,this.push(e[a]));return e.length-this.length},b.toHexValue=function(e,t){return t?"0x"+b.toHexValue(e).toString(16):new THREE.Color(e).getHex()},b.toHexStyle=function(e){return"#"+new THREE.Color(e).getHexString()},b.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},b.mix=function(e,t,r){return e*(1-r)+t*r},b.lerp=function(e,t,r){return e*(1-r)+t*r},b.smoothstep=function(e,t,r){return r<=e?0:r>=t?1:(r=(r-e)/(t-e))*r*(3-2*r)},b.randInt=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},b.randFloat=function(e,t){return e+Math.random()*(t-e)},b.randFloatSpread=function(e,t){return e+t*(Math.random()-.5)},b.linearRand=function(e,t){return b.randFloat(e,t)},b.gaussRand=function(e,t){var r,n,i;do{r=(n=b.randFloat(-1,1))*n+(i=b.randFloat(-1,1))*i}while(r>1);return i*t*t*Math.sqrt(-2*Math.log(r)/r)+e},b.diskRand=(a=new THREE.Vector2,function(e){var t;do{a.x=b.randFloat(-e,e),a.y=b.randFloat(-e,e),t=a.length()}while(t>e);return a}),b.ballRand=function(){var e=new THREE.Vector3;return function(t){var r;do{e.x=b.randFloat(-t,t),e.y=b.randFloat(-t,t),e.z=b.randFloat(-t,t),r=e.length()}while(r>t);return e}}(),b.circularRand=function(){var e=new THREE.Vector2;return function(t){var r=b.randFloat(0,6.283185307179586);return e.x=t*Math.cos(r),e.y=t*Math.sin(r),e}}(),b.sphericalRand=function(){var e=new THREE.Vector3;return function(t){var r=b.randFloat(-1,1),n=b.randFloat(0,6.283185307179586),i=Math.sqrt(1-r*r),a=i*Math.cos(n),o=i*Math.sin(n);return e.x=a*t,e.y=o*t,e.z=r*t,e}}(),b.createMathRandom=function(e){return(e=>()=>((e=Math.imul(741103597,e))>>>0)/2**32)(function(e){for(var t=0,r=1779033703^e.length;t<e.length;t++)r=(r=Math.imul(r^e.charCodeAt(t),3432918353))<<13|r>>>19;return function(){return r=Math.imul(r^r>>>16,2246822507),r=Math.imul(r^r>>>13,3266489909),(r^=r>>>16)>>>0}}(e.toString())())},b.createRandFloat=function(e){var t=void 0!==e?b.createMathRandom(e):Math.random;return function(e,r){return e+t()*(r-e)}},b.createFbmNoise=function(e){var t=void 0!==(e=e||{}).octaves?e.octaves:4,r=void 0!==e.persistence?e.persistence:.5;switch(void 0!==e.noiseType?e.noiseType:"simplex3d"){case"perlin3d":var n=(new THREE.ImprovedNoise).noise;break;default:var i=new THREE.SimplexNoise;n=i.noise3d.bind(i)}for(var a=new Array(t),o=new Array(t),s=0,l=0;l<t;l++)a[l]=Math.pow(r,l),o[l]=Math.pow(2,l),s+=a[l];return s=1/s,function(e,r,i){for(var o=0,l=0;l<t;l++){var u=1<<l;o+=a[l]*n(e*u,r*u,i*u)}return o*s}},b.triggerWindowResize=function(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}},b.isCtrlKeyDown=function(e){return b.isDeviceMacOS()?e.metaKey:e.ctrlKey},b.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},b.createImageDropZone=function(e,t){return null==e&&((e=document.createElement("img")).style.width="50px",e.style.height="50px",e.style.border="1px solid white"),e.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},!1),e.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();var r=new FileReader;r.addEventListener("load",function(e){var r=new Image;r.onload=function(){t(r)},r.src=e.currentTarget.result},!1),r.readAsDataURL(e.dataTransfer.files[0])},!1),e},b.setDraggable=function(e){var t=0,r=0,n=0,i=0,a=e.children[0];function o(e){(e=e||window.event).preventDefault(),n=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(a){(a=a||window.event).preventDefault(),t=n-a.clientX,r=i-a.clientY,n=a.clientX,i=a.clientY,e.style.top=e.offsetTop-r+"px",e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null}a?a.onmousedown=o:e.onmousedown=o},b.createProgressbar=function(){if(!(e=document.getElementById("progress-box"))){var e;(e=document.createElement("div")).id="progress-box",e.innerHTML='\n        <div>\n            <div>Loading...</div>\n            <div class="progress">\n                <div id="progressbar"></div>\n            </div>\n        </div>\n    ',document.body.appendChild(e);var t=document.createElement("style");t.id="progress-style",t.innerHTML="\n        #progress-box {\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            font-size: x-large;\n            font-family: sans-serif;\n        }\n        #progress-box>div>div {\n            padding: 2px;\n        }\n        .progress {\n            width: 50vw;\n            border: 1px solid black;\n        }\n        #progressbar {\n            width: 0;\n            transition: width ease-out .5s;\n            height: 1em;\n            background-color: #888;\n            background-image: linear-gradient(\n                -45deg, \n                rgba(255, 255, 255, .5) 25%, \n                transparent 25%, \n                transparent 50%, \n                rgba(255, 255, 255, .5) 50%, \n                rgba(255, 255, 255, .5) 75%, \n                transparent 75%, \n                transparent\n            );\n            background-size: 50px 50px;\n            animation: progressanim 2s linear infinite;\n        }\n    ",document.head.appendChild(t)}},b.getProgressbar=function(){return document.getElementById("progressbar")},b.updateProgressbar=function(e,t,r){void 0===r&&(r=b.getProgressbar()),r.style.width=`${e/t*100|0}%`},b.hideProgressbar=function(){document.getElementById("progress-box").style.display="none"},b.showProgressbar=function(){document.getElementById("progress-box").style.display=""},b.errorProgressbar=function(e){console.warn(e)},b.removeProgressbar=function(){var e=document.getElementById("progress-box");void 0!==e&&document.body.removeChild(e);var t=document.getElementById("progress-style");void 0!==t&&document.head.removeChild(t)},b.getDistancePerPixel=function(){var e=b.appWorks.camera;return e.position.length()*Math.tan(e.fov/2*THREE.Math.DEG2RAD)*2*e.aspect/b.appWorks.width},b.getMouseScreenCoords=(o=new THREE.Vector2,function(e){return e.changedTouches?(o.x=e.changedTouches[0].clientX,o.y=e.changedTouches[0].clientY):(o.x=e.clientX,o.y=e.clientY),o}),b.toggleLightHelpers=function(e){b.appWorks.sceneHelpers.children.forEach(function(t){(t instanceof THREE.PointLightHelper||t instanceof THREE.SpotLightHelper||t instanceof THREE.DirectionalLightHelper||t instanceof THREE.HemisphereLightHelper)&&(t.visible=void 0!==e?e:!t.visible)})},b.createSpritesHUD=function(e,t,r,n,i){var a;a=e.isTexture?new THREE.SpriteMaterial({map:e,transparent:!0,depthTest:!1}):!0===e.isSpriteMaterial?e:new THREE.SpriteMaterial({color:16777215,transparent:!0,depthTest:!1});var o=new THREE.Sprite(a);o.center.set(.5,.5),o.scale.set(n,i,1),o.name="spritesHUD";var s=b.appWorks.cameraHUD;return o.position.x=s.left+n/2+t,o.position.y=s.bottom+i/2+r,o},b.createTextHUD=function(e,t,r,n,i,a){!1===Array.isArray(e)&&(e=[e]);t=t||0,r=r||0;var o,s=-1;e.forEach((e,t)=>{e.length>s&&(s=e.length,o=t)});var l=document.createElement("canvas"),u=l.getContext("2d");u.font="Normal 20px Arial",l.width=u.measureText(e[o]).width,u.font="Normal 20px Arial";var c=1.2*u.measureText("M").width;l.height=c*e.length*1.2;n=n||l.width,i=i||l.height;var h=new THREE.CanvasTexture(u.canvas),d=new THREE.MeshBasicMaterial({map:h,transparent:!0,depthTest:!1}),f=new THREE.PlaneBufferGeometry(n,i),p=new THREE.Mesh(f,d);p.name="textHUD";var m=b.appWorks.cameraHUD;p.position.x=m.left+n/2+t,p.position.y=m.bottom+i/2+r,!0===a&&(p.userData.context2D=u,p.userData.texts=e,p.userData.lineHeight=c),u.font="Normal 20px Arial",u.textAlign="left",u.fillStyle="rgba(255,255,255,1.0)",u.clear();r=c;return e.forEach(e=>{u.fillText(e,0,r),r+=c}),h.needsUpdate=!0,p},b.createRenderTargetHUD=function(e,t,r,n,i,a){t=t||0,r=r||0,n=n||b.appWorks.width,i=i||b.appWorks.height;var o=e.clone(),s=new THREE.Scene;s.add(o),s.add(b.createHemisphereLight()),s.background=b.appWorks.scene.background;var l=b.appWorks.camera.clone();b.fitCameraToObject(o,l);var u=new THREE.WebGLRenderTarget(b.appWorks.width,b.appWorks.height),c=b.appWorks.renderer;c.setRenderTarget(u),c.render(s,l);var h=new THREE.MeshBasicMaterial({map:u.texture}),d=new THREE.PlaneBufferGeometry(n,i),f=new THREE.Mesh(d,h);f.name="renderTargetHUD";var p=b.appWorks.cameraHUD;return f.position.x=p.left+n/2+t,f.position.y=p.bottom+i/2+r,!0===a&&(f.userData.renderTarget=u,f.userData.rtScene=s,f.userData.rtCamera=l),f},THREE.AmbientLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.PointLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.SpotLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.DirectionalLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.HemisphereLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.PerspectiveCamera.prototype.getMousePosition=function(e,t,r,n){n=void 0!==n&&n;void 0===r&&(r=new THREE.Vector3);var i=Math.tan(.5*this.fov*THREE.Math.DEG2RAD)/this.zoom,a=b.lerp(this.near,this.far,t),o=a*i,s=this.aspect*o;return r.set(e.x*s,e.y*o,-a),!0===n&&this.localToWorld(r),r},THREE.Object3D.prototype.getColorDepthRT=(s=window.innerWidth,l=window.innerHeight,u=new THREE.WebGLRenderTarget(s,l,{stencilBuffer:!1,depthBuffer:!0,depthTexture:new THREE.DepthTexture}),c=new THREE.WebGLRenderTarget(s,l,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.FloatType}),h=new THREE.Scene,d=new THREE.OrthographicCamera(-1,1,1,-1,0,1),f=new THREE.ShaderMaterial({uniforms:{cameraNear:{value:null},cameraFar:{value:null},tDiffuse:{value:null},tDepth:{value:null}},vertexShader:"\n            varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n            }\n        ",fragmentShader:"\n            #include <packing>\n            varying vec2 vUv;\n            uniform sampler2D tDiffuse;\n            uniform sampler2D tDepth;\n            uniform float cameraNear;\n            uniform float cameraFar;\n            \n            float getOrthographicDepth( sampler2D depthTex, vec2 uv ) {\n            #ifdef RAYMARCH\n                return texture2D( depthTex, uv ).r;\n            #else\n                float fragCoordZ = texture2D( depthTex, uv ).r;\n                float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n                return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n            #endif\n            }\n            void main() {\n                gl_FragColor.rgb = texture2D( tDiffuse, vUv ).rgb;\n                gl_FragColor.a = getOrthographicDepth( tDepth, vUv );\n            }\n        "}),p=new THREE.PlaneBufferGeometry(2,2),h.add(new THREE.Mesh(p,f)),function(e){var t=b.appWorks,r=t.renderer;if(!r.extensions.get("WEBGL_depth_texture"))return alert("WEBGL_depth_texture: not supported in WebGL2..."),null;this.isRaymarch&&(f.defines={RAYMARCH:""});var n=t.scene;e=void 0!==e?e:t.camera,n.traverse(e=>{e.isLight||0!==e.children.length||(e.visible=!1)}),this.visible=!0,r.setRenderTarget(u),r.clear(),r.render(n,e);var i=f.uniforms;return i.cameraNear.value=e.near,i.cameraFar.value=e.far,i.tDiffuse.value=u.texture,i.tDepth.value=u.depthTexture,r.setRenderTarget(c),r.clear(),r.render(h,d),c}),THREE.Object3D.prototype.readColorDepthRTCube=function(){var e=new THREE.Vector3,t=[];t.push(new THREE.Vector3(-1,0,0)),t.push(new THREE.Vector3(1,0,0)),t.push(new THREE.Vector3(0,-1,0)),t.push(new THREE.Vector3(0,1,0)),t.push(new THREE.Vector3(0,0,-1)),t.push(new THREE.Vector3(0,0,1));var r=new THREE.PerspectiveCamera;return function(n,i){var a=b.appWorks.renderer;if(a.extensions.get("WEBGL_depth_texture")){r.copy(b.appWorks.camera),b.fitCameraToObject(this,r,!1);for(var o=Math.tan(.5*r.fov*THREE.Math.DEG2RAD)/r.zoom,s=.5*b.getObjectSize(this)/o*1.25,l={x:0,y:0},u=b.appWorks.dom.getBoundingClientRect(),c=new Float32Array(u.width*u.height*4),h=0;h<t.length;h++){r.position.subVectors(this.position,t[h].multiplyScalar(s)),r.lookAt(this.position);var d=this.getColorDepthRT(r);a.readRenderTargetPixels(d,0,0,u.width,u.height,c);for(var f=0,p=0;p<u.height;p++){l.y=2/(u.height-1)*p-1;for(var m=0;m<u.width;m++)l.x=2/(u.width-1)*m-1,c[f+3]<.99&&(r.getMousePosition(l,c[f+3],e,!0),n.push(e.x,e.y,e.z),i.push(c[f],c[f+1],c[f+2])),f+=4}}}else alert("WEBGL_depth_texture: not supported...")}}(),THREE.Object3D.prototype.readColorDepthRT=function(e,t){var r=b.appWorks.renderer,n=b.appWorks.camera;if(r.extensions.get("WEBGL_depth_texture")){var i={x:0,y:0},a=new THREE.Vector3,o=b.appWorks.dom.getBoundingClientRect(),s=new Float32Array(o.width*o.height*4),l=this.getColorDepthRT(n);r.readRenderTargetPixels(l,0,0,o.width,o.height,s);for(var u=0,c=0;c<o.height;c++){i.y=2/(o.height-1)*c-1;for(var h=0;h<o.width;h++)i.x=2/(o.width-1)*h-1,s[u+3]<.99&&(n.getMousePosition(i,s[u+3],a,!0),e.push(a.x,a.y,a.z),t.push(s[u],s[u+1],s[u+2])),u+=4}}else alert("WEBGL_depth_texture: not supported...")},THREE.Object3D.prototype.clonedToPoints=function(e,t){e=void 0!==e?e:.05;var r=[],n=[];(t=void 0===t||t)?this.readColorDepthRTCube(r,n):this.readColorDepthRT(r,n);var i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.Float32BufferAttribute(r,3)),i.addAttribute("color",new THREE.Float32BufferAttribute(n,3));var a=new THREE.PointsMaterial({size:e,vertexColors:THREE.VertexColors}),o=new THREE.Points(i,a);return o.name="clonedToPoints",o},THREE.Object3D.prototype.clonedToVoxels=function(e,t){e=void 0!==e?e:200;var r=[],n=[];(t=void 0===t||t)?this.readColorDepthRTCube(r,n):this.readColorDepthRT(r,n);var i,a,o,s,l,u,c,h,d,f=b.computeBoundingBox(this),p=f.getSize(new THREE.Vector3);s=l=u=Math.max(p.x,p.y,p.z)/e,i=f.min.x,a=f.min.y,o=f.min.z;for(var m,v={},g=[],y=[],_=0,E=r.length;_<E;_+=3)void 0===v[m=(c=~~((r[_]-i)/s))+"_"+(h=~~((r[_+1]-a)/l))+"_"+(d=~~((r[_+2]-o)/u))]&&(v[m]=!0,g.push(i+(c+.5)*s,a+(h+.5)*l,o+(d+.5)*u),y.push(n[_],n[_+1],n[_+2]));var w=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[s,l,u]},material:{type:"MeshBasicMaterial"}}),x=b.createInstancedMeshes(w,{positions:g,colors:y});return x.name="clonedToVoxels",x},THREE.Object3D.prototype.rayIntersect=function(e,t){var r=b.appWorks,n=r.renderer,i=r.camera,a=r.raycaster;if(n.extensions.get("WEBGL_depth_texture")){e=void 0!==e?e:r.mouseUpPosition;var o=new THREE.Vector2,s=r.dom.getBoundingClientRect();o.x=(.5*e.x+.5)*s.width,o.y=(.5*e.y+.5)*s.height;var l=this.getColorDepthRT(),u=new Float32Array(4);n.readRenderTargetPixels(l,o.x,o.y,1,1,u);var c=new THREE.Vector3;i.getMousePosition(e,u[3],c);var h=c.length();a.ray.at(h,c),t.push({distance:h,point:c,object:this})}else alert("WEBGL_depth_texture: not supported...")},THREE.Object3D.prototype.getObjectsByProperty=function(e,t,r,n){void 0===n&&(n=[]);var i=this[e];void 0!==i&&i[t]===r&&n.push(this);for(var a=0,o=this.children.length;a<o;a++){this.children[a].getObjectsByProperty(e,t,r,n)}return n},THREE.Object3D.prototype.getObjectsByType=function(e,t){void 0===t&&(t=[]),this.type===e&&t.push(this);for(var r=0,n=this.children.length;r<n;r++){this.children[r].getObjectsByType(e,t)}return t},THREE.BufferGeometryUtils.mergeInstancedBufferAttribute=function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.InstancedBufferAttribute(s,r,n)},b.getObjectName=function(e,t){t=void 0!==t?t:"";if(Array.isArray(e)){for(var r=[],n=0;n<e.length;n++)r.push(""===e[n].name?t:e[n].name);return r.join(", ").trunc(20)}return(void 0===e.name?t:e.name).trunc(20)},b.getObjectSize=(m=new THREE.Vector3,function(e){return b.computeBoundingBox(e).getSize(m),Math.max(m.x,m.y,m.z)}),b.resizeObject=function(e,t){if(t){var r=b.getObjectSize(e);e.scale.setScalar(t/r)}},b.transformObject=function(e,t,r,n){t&&e.position.set(t.x,t.y,t.z),r&&e.rotation.set(r.x,r.y,r.z),n&&e.scale.set(n.x,n.y,n.z),e.updateMatrix()},b.copyTransform=function(e,t){var r=t.position,n=t.rotation,i=t.scale;b.transformObject(e,r,n,i)},b.cloneObject=function(e){return void 0!==e.userData.type?new b[e.userData.type](e):e.clone()},b.underWaterBackground=function(){void 0!==b.appWorks.underWaterPass&&(b.appWorks.underWaterPass.enabled=!0),b.appWorks.createSceneBackground("underWater"),b.scene.fog||b.appWorks.createSceneFog({type:"exp2",color:594516,density:.004}),b.renderer.toneMappingExposure=.7},b.filmGrainBackground=function(){var e=b.appWorks.width,t=b.appWorks.height,r={aspect:b.camera.aspect,aspectCorrection:!0,grainScale:1.5/Math.min(e,t),color1:16777215,color2:3487029,noiseAlpha:.75};(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg",function(e){b.imageProcessing(e,"FilmGrainShader",r,function(e){b.scene.background=e})})},b.redColors=(v=[16752762,16416882,15308410,15761536,13458524,14423100,11674146,16711680,9109504,8388608,16737095,16729344,14381203],function(e){return v[e%v.length]}),b.greenColors=(g=[8190976,8388352,3329330,65280,2263842,32768,25600,11403055,10145074,65407,64154,9498256,10025880,9419919,3978097,2142890,3050327,526336,5597999,7048739],function(e){return g[e%g.length]}),b.blueColors=(y=[4744096,2839678,2832470,1383252,128,1388926,1383309,160,8386,16834,2446535,1403335,2842846,2049532,2844140,3174143,1411583,6723839,3914239],function(e){return y[e%y.length]}),b.randomColors=function(e){if((e=e||{}).colors)return e.colors;var t,r,n,i=void 0!==e.numInstances?Math.floor(e.numInstances):1,a=void 0!==e.colorMode?e.colorMode:"none",o=new THREE.Color,s=[];if("0"===a)for(var l=0;l<i;l++)t=Math.random(),r=Math.random(),n=Math.random(),o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("1"===a)for(l=0;l<i;l++)t=Math.random(),r=.5,n=.5,o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("2"===a)for(l=0;l<i;l++)t=Math.random(),r=1,n=.5,o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("reds"===a)for(l=0;l<i;l++)o.setHex(b.redColors(l)),s.push(o.r,o.g,o.b);else if("greens"===a)for(l=0;l<i;l++)o.setHex(b.greenColors(l)),s.push(o.r,o.g,o.b);else if("blues"===a)for(l=0;l<i;l++)o.setHex(b.blueColors(l)),s.push(o.r,o.g,o.b);return s},b.cameraAutoView=function(e){if((e=e||{}).isWorking)return"stop"!==_;if("circle"===(_=e.viewMode||"circle")){var t=e.radius||20,r=new THREE.CircleBufferGeometry(t,32),n=new THREE.Mesh(r);n.name="cameraPath",n.visible=!1,b.add(n),n.add(b.camera),n.update=function(){this.rotation.y+=.003}}else if("stop"===_){var i=b.camera.parent;i&&"cameraPath"===i.name&&(i.remove(b.camera),b.camera.parent=null)}},b.fitCameraToObject=function(e,t,r){if(e){t=void 0!==t?t:b.appWorks.camera,r=void 0===r||r;var n=new THREE.Vector3,i=new THREE.Vector3,a=b.computeBoundingBox(e);a.getSize(i);var o=e.position.clone();!0===r?(a.getCenter(n),o.sub(n),n.set(0,0,0)):n.copy(o);var s=t.fov*THREE.Math.DEG2RAD,l=Math.max(i.x,i.y,i.z),u=Math.abs(l/2/Math.tan(s/2));if(u*=1.25,t===b.appWorks.camera){var c=b.appWorks.controls;c instanceof THREE.OrbitControls?(c.reset(),c.maxDistance=100*u,c.saveState()):c instanceof THREE.TrackballControls&&(c.reset(),c.maxDistance=100*u)}var h=t.position.clone();h.normalize().multiplyScalar(u),t.lookAt(n);var d=u/100,f=100*u;if(b.appWorks.history&&t===b.appWorks.camera){var p=[];r&&p.push(new b.SetPositionCommand(e,o)),p.push(new b.SetPositionCommand(t,h)),p.push(new b.SetValueCommand(t,"near",d)),p.push(new b.SetValueCommand(t,"far",f)),b.appWorks.multiCmds(p)}else r&&e.position.copy(o),t.position.copy(h),t.near=d,t.far=f;t.updateProjectionMatrix()}},b.welcomeObject=function(e){if(e.traverse(function(e){e.isMesh&&(e.frustumCulled=!1,e.castShadow=!0,e.receiveShadow=!0)}),"natureWorks"===b.appWorks.appName)b.fitCameraToObject(e);else if("viewWorks"===b.appWorks.appName&&(b.resizeObject(e,1),b.fitCameraToObject(e),b.appWorks.selectObject=e,void 0===b.appWorks.showroom)){var t=b.createShowroom(e);b.appWorks.showroom=t,b.scene.add(t)}},b.nextShowroom=function(e,t){if("background"===t){(n=e.getObjectByName("raymarch"))&&e.remove(n),i=((i=e.activeBackground)+1)%e.backgrounds.length,e.activeBackground=i;var r=e.backgrounds[i];r.isMesh?(b.scene.background=null,e.add(r)):b.scene.background=r}if("floor"===t){var n,i;(n=e.getObjectByName("floor"))&&e.remove(n),i=((i=e.activeFloor)+1)%e.floors.length,e.activeFloor=i;var a=e.floors[i];e.add(a)}},b.createShowroom=function(e){var t=new THREE.Object3D;t.name="showroom",t.activeBackground=-1,t.backgrounds=[];var r=["arctic","burlesque","denim","mercury","neo","origin","rouge","slate"];r.forEach(e=>{var r=(new THREE.TextureLoader).load("images/wallpaper/"+e+".jpg");t.backgrounds.push(b.createBackground(r))}),(r=["blueSky","cloud","galaxy","lake","bridge","park"]).forEach(e=>{t.backgrounds.push(b.createBackground(e))}),(r=["cloudsFS","cellsFS","fogFS","sunsetFS"]).forEach(e=>{var r=b.createBackground(e);r.name="raymarch",t.backgrounds.push(r)}),t.backgrounds.push(b.createBackground(12632256)),t.activeFloor=-1,t.floors=[];var n=new THREE.TextureLoader,i=b.computeBoundingBox(e),a=i.min.y,o=i.getSize(new THREE.Vector3),s=4*(o=Math.max(o.x,o.y,o.z));function l(e,t){t=t||8;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}(d=b.createAcrylicCircle(s)).rotation.x=-Math.PI/2,d.position.y=a,d.name="floor",t.floors.push(d);var u=[];u.push({map:n.load("images/rock/crackRockDiffuse.jpg",l),normalMap:n.load("images/rock/crackRockNormal.jpg",l),aoMap:n.load("images/rock/crackRockAO.jpg",l)}),u.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/wallA.png",l),normalMap:n.load("images/pbr/wallN.png",l),aoMap:n.load("images/pbr/wallAO.png",l),roughnessMap:n.load("images/pbr/wallR.png",l)}),u.push({roughness:1,metalness:0,map:n.load("images/pbr/bathroomtileA.png",l),normalMap:n.load("images/pbr/bathroomtileN.png",l),aoMap:n.load("images/pbr/bathroomtileAO.png",l),roughnessMap:n.load("images/pbr/bathroomtileR.png",l)}),u.push({roughness:1,metalness:0,map:n.load("images/pbr/charcoalA.png",l),normalMap:n.load("images/pbr/charcoalN.png",l),roughnessMap:n.load("images/pbr/charcoalR.png",l)}),u.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/grassA.png",l),normalMap:n.load("images/pbr/grassN.png",l),aoMap:n.load("images/pbr/grassAO.png",l),roughnessMap:n.load("images/pbr/grassR.png",l)}),u.push({color:8947848,roughness:.5,metalness:.5,map:n.load("images/pbr/rustIronA.png",e=>l(e,2)),normalMap:n.load("images/pbr/rustIronN.png",e=>l(e,2)),aoMap:n.load("images/pbr/rustIronAO.png",e=>l(e,2)),roughnessMap:n.load("images/pbr/rustIronR.png",e=>l(e,2)),metalnessMap:n.load("images/pbr/rustIronM.png",e=>l(e,2))});for(var c=new THREE.CircleBufferGeometry(s,64),h=0;h<u.length;h++){var d,f=new THREE.MeshStandardMaterial(u[h]);(d=new THREE.Mesh(c,f)).receiveShadow=!0,d.rotation.x=-Math.PI/2,d.position.y=a,d.name="floor",t.floors.push(d)}b.nextShowroom(t,"background"),b.nextShowroom(t,"floor"),b.scene.add(b.createHemisphereLight());var p=b.createDirectionalLight({shadowCameraSize:.5*s});return p.position.set(0,.75*s,.5*s),b.scene.add(p),t},b.manhatten2D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},b.manhatten3D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)},b.createKdTree=function(e,t,r){if(!isTypedArray(e)){var n=e[0];isArray(n)?e=b.flattenArray(e):n instanceof THREE.Vector2?e=b.flattenVector2s(e):n instanceof THREE.Vector3?e=b.flattenVector3s(e):n instanceof THREE.Vector4&&(e=b.flattenVector4s(e)),e=new Float32Array(e)}r=r||2===t?b.manhatten2D:b.manhatten3D;return new THREE.TypedArrayUtils.Kdtree(e,r,t)},b.getKdTreeNearest=function(e,t,r,n){for(var i=e.nearest(t,r,n),a=[],o=0,s=i.length;o<s;o++){var l=i[o],u={};u.position=l[0].obj,u.index=l[0].pos,u.distance=l[1],a.push(u)}return a},b.OctreeHelper=function(e,t){if(!e instanceof E.PointOctree)return null;var r=(t=t||{}).leaves||!1,n=t.color||16777215,i=[],a=[];if(r){a=b.getLeafOctants(e,!0)}else{var o=t.topLevel||0,s=t.bottomLevel||e.getDepth();a=b.getOctantsByLevels(e,o,s)}a.forEach(function(e){var t=new THREE.Box3(e.min,e.max),r=new THREE.Box3Helper(t);r.updateMatrixWorld(!0),r.geometry.applyMatrix(r.matrixWorld),i.push(r.geometry)});var l=THREE.BufferGeometryUtils.mergeBufferGeometries(i),u=new THREE.LineBasicMaterial({color:n});THREE.LineSegments.call(this,l,u),this.name="octreeHelper",i.forEach(function(e){e.dispose()})},b.OctreeHelper.prototype=Object.create(THREE.LineSegments.prototype),b.OctreeHelper.prototype.constructor=b.OctreeHelper,b.getOctantsByLevels=function(e,t,r){for(var n=[];t<=r;){var i=e.findOctantsByLevel(t)[Symbol.iterator]();if(i)for(var a=i.next();!a.done;)n.push(a.value),a=i.next();t++}return n},b.getLeafOctants=function(e,t){var r=[],n=e.leaves(),i=n.next();if(t=t||!0)for(;!i.done;)i.value.points&&r.push(i.value),i=n.next();else for(;!i.done;)r.push(i.value),i=n.next();return r},CanvasRenderingContext2D.prototype.clear=function(e){e&&(this.beginPath(),this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),e&&this.restore()},CanvasRenderingContext2D.prototype.circle=function(e,t,r){return this.beginPath(),this.moveTo(e+r,t),this.arc(e,t,r,0,2*Math.PI),this},CanvasRenderingContext2D.prototype.fillCircle=function(e,t,r,n){return n&&(this.fillStyle=n),this.circle(e,t,r).fill(),this},CanvasRenderingContext2D.prototype.strokeCircle=function(e,t,r,n){return n&&(this.strokeStyle=n),this.circle(e,t,r).stroke(),this},CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,n,i){var a={tl:0,tr:0,bl:0,br:0};if("object"==typeof i)for(var o in i)a[o]=i[o];if("number"==typeof i)for(var o in a)a[o]=i;return this.beginPath(),this.moveTo(e+a.tl,t),this.lineTo(e+r-a.tr,t),this.quadraticCurveTo(e+r,t,e+r,t+a.tr),this.lineTo(e+r,t+n-a.br),this.quadraticCurveTo(e+r,t+n,e+r-a.br,t+n),this.lineTo(e+a.bl,t+n),this.quadraticCurveTo(e,t+n,e,t+n-a.bl),this.lineTo(e,t+a.tl),this.quadraticCurveTo(e,t,e+a.tl,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillRoundRect=function(e,t,r,n,i,a){return a&&(this.fillStyle=a),this.roundRect(e,t,r,n,i).fill(),this},CanvasRenderingContext2D.prototype.strokeRoundRect=function(e,t,r,n,i,a){return a&&(this.strokeStyle=a),this.roundRect(e,t,r,n,i).stroke(),this},CanvasRenderingContext2D.prototype.polygon=function(e,t){t>0&&(e=function(e,t){function r(e,t,r,n,i,a){var o=Math.sqrt(Math.pow(r-e,2)+Math.pow(n-t,2)),s=a?i/o:(o-i)/o;return[e+s*(r-e),t+s*(n-t)]}var n,i,a,o,s,l,u,c,h=e.length,d=new Array(h);for(i=0;i<h;i++)(n=i-1)<0&&(n=h-1),(a=i+1)==h&&(a=0),o=e[n],s=e[i],l=e[a],u=r(o[0],o[1],s[0],s[1],t,!1),c=r(s[0],s[1],l[0],l[1],t,!0),d[i]=[u[0],u[1],s[0],s[1],c[0],c[1]];return d}(e,t)),this.beginPath();for(var r=0,n=e.length;r<n;r++){var i=e[r];0==r?this.moveTo(i[0],i[1]):this.lineTo(i[0],i[1]),t>0&&this.quadraticCurveTo(i[2],i[3],i[4],i[5])}return this.closePath(),this},CanvasRenderingContext2D.prototype.fillPolygon=function(e,t,r){return r&&(this.fillStyle=r),this.polygon(e,t).fill(),this},CanvasRenderingContext2D.prototype.strokePolygon=function(e,t,r){return r&&(this.strokeStyle=r),this.polygon(e,t).stroke(),this},CanvasRenderingContext2D.prototype.speechBubble=function(e,t,r,n,i,a,o,s){e=e||0,r=r||1,n=n||1,i=i||.2*n,a=a||e+r/2,s=s||i;var l,u,c,h=e+r,d=(t=t||0)+n;return(o=o||t+n+i)<t||o>t+n?(l=Math.min(Math.max(e+i,a-s/2),h-i-s),u=Math.min(Math.max(e+i+s,a+s/2),h-i)):(l=Math.min(Math.max(t+i,o-s/2),d-i-s),u=Math.min(Math.max(t+i+s,o+s/2),d-i)),o<t&&(c=2),o>t&&(c=3),a<e&&o>=t&&o<=d&&(c=0),a>e&&o>=t&&o<=d&&(c=1),a>=e&&a<=h&&o>=t&&o<=d&&(c=-1),this.beginPath(),this.moveTo(e+i,t),2==c?(this.lineTo(l,t),this.lineTo(a,o),this.lineTo(u,t),this.lineTo(h-i,t)):this.lineTo(h-i,t),this.quadraticCurveTo(h,t,h,t+i),1==c?(this.lineTo(h,l),this.lineTo(a,o),this.lineTo(h,u),this.lineTo(h,d-i)):this.lineTo(h,d-i),this.quadraticCurveTo(h,d,h-i,d),3==c?(this.lineTo(u,d),this.lineTo(a,o),this.lineTo(l,d),this.lineTo(e+i,d)):this.lineTo(e+i,d),this.quadraticCurveTo(e,d,e,d-i),0==c?(this.lineTo(e,u),this.lineTo(a,o),this.lineTo(e,l),this.lineTo(e,t+i)):this.lineTo(e,t+i),this.quadraticCurveTo(e,t,e+i,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.fillStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).fill(),this},CanvasRenderingContext2D.prototype.strokeSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.strokeStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).stroke(),this},b.createFaceVertexUVs=function(e){!e instanceof THREE.Geometry||(e.faceVertexUvs[0]=[],e.faces.forEach(function(t){var r=["x","y","z"].sort(function(e,r){return Math.abs(t.normal[e])>Math.abs(t.normal[r])}),n=e.vertices[t.a],i=e.vertices[t.b],a=e.vertices[t.c];e.faceVertexUvs[0].push([new THREE.Vector2(n[r[0]],n[r[1]]),new THREE.Vector2(i[r[0]],i[r[1]]),new THREE.Vector2(a[r[0]],a[r[1]])])}),e.uvsNeedUpdate=!0)},b.loadObject3D=function(e){const t=["position","rotation","quaternion","scale"];var r=Array.isArray(e)?e:[e];return r.forEach(e=>{void 0===e.object?e.object={type:"Mesh"}:void 0===e.object.type&&(e.object.type="Mesh")}),function(r){const o=[];return r.forEach(e=>{o.push(function(e){var t=e.object;if(e.url){const t=[n(e.url)];return Promise.all(t).then(t=>(t[0].name=e.url,t[0]))}if("Sprite"===t.type){const t=[a(e.material)];return Promise.all(t).then(e=>new THREE.Sprite(e[0]))}if("Points"===t.type||"Mesh"===t.type||"SkinnedMesh"===t.type||"Line"===t.type||"LineLoop"===t.type||"LineSegments"===t.type){const r=[i(e.geometry),a(e.material)];return Promise.all(r).then(e=>new THREE[t.type](e[0],e[1]))}return Promise.resolve(void 0)}(e))}),Promise.all(o).then(n=>(n.forEach((e,n)=>{var i=r[n].object;Object.keys(i).map(r=>{"type"===r||(-1!==t.indexOf(r)?e[r].fromArray(i[r]):e[r]="userData"===r?JSON.parse(JSON.stringify(i[r])):"customDepthMaterial"===r||"customDistanceMaterial"===r?i[r].clone():i[r])})}),Array.isArray(e)?Promise.resolve(n):Promise.resolve(n[0])))}(r);function n(e){return e?new Promise(t=>{(new THREE.ObjectLoader).load(e,t)}):Promise.resolve(void 0)}function i(e){if(e){if(e instanceof THREE.BufferGeometry||e instanceof THREE.Geometry)return Promise.resolve(e);if(e.parameters)return new Promise(t=>{t(new THREE[e.type](...e.parameters))});if(e.attributes){var t=new THREE.BufferGeometry;return Object.keys(e.attributes).map(r=>{t.addAttribute(r,new THREE.Float32BufferAttribute(e.attributes[r],3))}),e.index&&t.setIndex(e.index),Promise.resolve(t)}return Promise.resolve(void 0)}return Promise.resolve(void 0)}function a(e){if(e){var t;const r={},n=Object.keys(e).map(n=>{if("type"===n)t=e[n];else{if(-1!==b.TEXTURE_MAPS.indexOf(n))return function(e){if(!e)return Promise.resolve(null);return e.isTexture?Promise.resolve(e):"string"==typeof e?new Promise(t=>{(new THREE.TextureLoader).load(e,t)}):Promise.resolve(void 0)}(e[n]).then(e=>{r[n]=e});r[n]=e[n]}});return Promise.all(n).then(()=>new THREE[t](r))}return Promise.resolve(void 0)}};var w=function(){var e=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),t=[new Uint8Array([]),new Uint8Array([0,8,3]),new Uint8Array([0,1,9]),new Uint8Array([1,8,3,9,8,1]),new Uint8Array([1,2,10]),new Uint8Array([0,8,3,1,2,10]),new Uint8Array([9,2,10,0,2,9]),new Uint8Array([2,8,3,2,10,8,10,9,8]),new Uint8Array([3,11,2]),new Uint8Array([0,11,2,8,11,0]),new Uint8Array([1,9,0,2,3,11]),new Uint8Array([1,11,2,1,9,11,9,8,11]),new Uint8Array([3,10,1,11,10,3]),new Uint8Array([0,10,1,0,8,10,8,11,10]),new Uint8Array([3,9,0,3,11,9,11,10,9]),new Uint8Array([9,8,10,10,8,11]),new Uint8Array([4,7,8]),new Uint8Array([4,3,0,7,3,4]),new Uint8Array([0,1,9,8,4,7]),new Uint8Array([4,1,9,4,7,1,7,3,1]),new Uint8Array([1,2,10,8,4,7]),new Uint8Array([3,4,7,3,0,4,1,2,10]),new Uint8Array([9,2,10,9,0,2,8,4,7]),new Uint8Array([2,10,9,2,9,7,2,7,3,7,9,4]),new Uint8Array([8,4,7,3,11,2]),new Uint8Array([11,4,7,11,2,4,2,0,4]),new Uint8Array([9,0,1,8,4,7,2,3,11]),new Uint8Array([4,7,11,9,4,11,9,11,2,9,2,1]),new Uint8Array([3,10,1,3,11,10,7,8,4]),new Uint8Array([1,11,10,1,4,11,1,0,4,7,11,4]),new Uint8Array([4,7,8,9,0,11,9,11,10,11,0,3]),new Uint8Array([4,7,11,4,11,9,9,11,10]),new Uint8Array([9,5,4]),new Uint8Array([9,5,4,0,8,3]),new Uint8Array([0,5,4,1,5,0]),new Uint8Array([8,5,4,8,3,5,3,1,5]),new Uint8Array([1,2,10,9,5,4]),new Uint8Array([3,0,8,1,2,10,4,9,5]),new Uint8Array([5,2,10,5,4,2,4,0,2]),new Uint8Array([2,10,5,3,2,5,3,5,4,3,4,8]),new Uint8Array([9,5,4,2,3,11]),new Uint8Array([0,11,2,0,8,11,4,9,5]),new Uint8Array([0,5,4,0,1,5,2,3,11]),new Uint8Array([2,1,5,2,5,8,2,8,11,4,8,5]),new Uint8Array([10,3,11,10,1,3,9,5,4]),new Uint8Array([4,9,5,0,8,1,8,10,1,8,11,10]),new Uint8Array([5,4,0,5,0,11,5,11,10,11,0,3]),new Uint8Array([5,4,8,5,8,10,10,8,11]),new Uint8Array([9,7,8,5,7,9]),new Uint8Array([9,3,0,9,5,3,5,7,3]),new Uint8Array([0,7,8,0,1,7,1,5,7]),new Uint8Array([1,5,3,3,5,7]),new Uint8Array([9,7,8,9,5,7,10,1,2]),new Uint8Array([10,1,2,9,5,0,5,3,0,5,7,3]),new Uint8Array([8,0,2,8,2,5,8,5,7,10,5,2]),new Uint8Array([2,10,5,2,5,3,3,5,7]),new Uint8Array([7,9,5,7,8,9,3,11,2]),new Uint8Array([9,5,7,9,7,2,9,2,0,2,7,11]),new Uint8Array([2,3,11,0,1,8,1,7,8,1,5,7]),new Uint8Array([11,2,1,11,1,7,7,1,5]),new Uint8Array([9,5,8,8,5,7,10,1,3,10,3,11]),new Uint8Array([5,7,0,5,0,9,7,11,0,1,0,10,11,10,0]),new Uint8Array([11,10,0,11,0,3,10,5,0,8,0,7,5,7,0]),new Uint8Array([11,10,5,7,11,5]),new Uint8Array([10,6,5]),new Uint8Array([0,8,3,5,10,6]),new Uint8Array([9,0,1,5,10,6]),new Uint8Array([1,8,3,1,9,8,5,10,6]),new Uint8Array([1,6,5,2,6,1]),new Uint8Array([1,6,5,1,2,6,3,0,8]),new Uint8Array([9,6,5,9,0,6,0,2,6]),new Uint8Array([5,9,8,5,8,2,5,2,6,3,2,8]),new Uint8Array([2,3,11,10,6,5]),new Uint8Array([11,0,8,11,2,0,10,6,5]),new Uint8Array([0,1,9,2,3,11,5,10,6]),new Uint8Array([5,10,6,1,9,2,9,11,2,9,8,11]),new Uint8Array([6,3,11,6,5,3,5,1,3]),new Uint8Array([0,8,11,0,11,5,0,5,1,5,11,6]),new Uint8Array([3,11,6,0,3,6,0,6,5,0,5,9]),new Uint8Array([6,5,9,6,9,11,11,9,8]),new Uint8Array([5,10,6,4,7,8]),new Uint8Array([4,3,0,4,7,3,6,5,10]),new Uint8Array([1,9,0,5,10,6,8,4,7]),new Uint8Array([10,6,5,1,9,7,1,7,3,7,9,4]),new Uint8Array([6,1,2,6,5,1,4,7,8]),new Uint8Array([1,2,5,5,2,6,3,0,4,3,4,7]),new Uint8Array([8,4,7,9,0,5,0,6,5,0,2,6]),new Uint8Array([7,3,9,7,9,4,3,2,9,5,9,6,2,6,9]),new Uint8Array([3,11,2,7,8,4,10,6,5]),new Uint8Array([5,10,6,4,7,2,4,2,0,2,7,11]),new Uint8Array([0,1,9,4,7,8,2,3,11,5,10,6]),new Uint8Array([9,2,1,9,11,2,9,4,11,7,11,4,5,10,6]),new Uint8Array([8,4,7,3,11,5,3,5,1,5,11,6]),new Uint8Array([5,1,11,5,11,6,1,0,11,7,11,4,0,4,11]),new Uint8Array([0,5,9,0,6,5,0,3,6,11,6,3,8,4,7]),new Uint8Array([6,5,9,6,9,11,4,7,9,7,11,9]),new Uint8Array([10,4,9,6,4,10]),new Uint8Array([4,10,6,4,9,10,0,8,3]),new Uint8Array([10,0,1,10,6,0,6,4,0]),new Uint8Array([8,3,1,8,1,6,8,6,4,6,1,10]),new Uint8Array([1,4,9,1,2,4,2,6,4]),new Uint8Array([3,0,8,1,2,9,2,4,9,2,6,4]),new Uint8Array([0,2,4,4,2,6]),new Uint8Array([8,3,2,8,2,4,4,2,6]),new Uint8Array([10,4,9,10,6,4,11,2,3]),new Uint8Array([0,8,2,2,8,11,4,9,10,4,10,6]),new Uint8Array([3,11,2,0,1,6,0,6,4,6,1,10]),new Uint8Array([6,4,1,6,1,10,4,8,1,2,1,11,8,11,1]),new Uint8Array([9,6,4,9,3,6,9,1,3,11,6,3]),new Uint8Array([8,11,1,8,1,0,11,6,1,9,1,4,6,4,1]),new Uint8Array([3,11,6,3,6,0,0,6,4]),new Uint8Array([6,4,8,11,6,8]),new Uint8Array([7,10,6,7,8,10,8,9,10]),new Uint8Array([0,7,3,0,10,7,0,9,10,6,7,10]),new Uint8Array([10,6,7,1,10,7,1,7,8,1,8,0]),new Uint8Array([10,6,7,10,7,1,1,7,3]),new Uint8Array([1,2,6,1,6,8,1,8,9,8,6,7]),new Uint8Array([2,6,9,2,9,1,6,7,9,0,9,3,7,3,9]),new Uint8Array([7,8,0,7,0,6,6,0,2]),new Uint8Array([7,3,2,6,7,2]),new Uint8Array([2,3,11,10,6,8,10,8,9,8,6,7]),new Uint8Array([2,0,7,2,7,11,0,9,7,6,7,10,9,10,7]),new Uint8Array([1,8,0,1,7,8,1,10,7,6,7,10,2,3,11]),new Uint8Array([11,2,1,11,1,7,10,6,1,6,7,1]),new Uint8Array([8,9,6,8,6,7,9,1,6,11,6,3,1,3,6]),new Uint8Array([0,9,1,11,6,7]),new Uint8Array([7,8,0,7,0,6,3,11,0,11,6,0]),new Uint8Array([7,11,6]),new Uint8Array([7,6,11]),new Uint8Array([3,0,8,11,7,6]),new Uint8Array([0,1,9,11,7,6]),new Uint8Array([8,1,9,8,3,1,11,7,6]),new Uint8Array([10,1,2,6,11,7]),new Uint8Array([1,2,10,3,0,8,6,11,7]),new Uint8Array([2,9,0,2,10,9,6,11,7]),new Uint8Array([6,11,7,2,10,3,10,8,3,10,9,8]),new Uint8Array([7,2,3,6,2,7]),new Uint8Array([7,0,8,7,6,0,6,2,0]),new Uint8Array([2,7,6,2,3,7,0,1,9]),new Uint8Array([1,6,2,1,8,6,1,9,8,8,7,6]),new Uint8Array([10,7,6,10,1,7,1,3,7]),new Uint8Array([10,7,6,1,7,10,1,8,7,1,0,8]),new Uint8Array([0,3,7,0,7,10,0,10,9,6,10,7]),new Uint8Array([7,6,10,7,10,8,8,10,9]),new Uint8Array([6,8,4,11,8,6]),new Uint8Array([3,6,11,3,0,6,0,4,6]),new Uint8Array([8,6,11,8,4,6,9,0,1]),new Uint8Array([9,4,6,9,6,3,9,3,1,11,3,6]),new Uint8Array([6,8,4,6,11,8,2,10,1]),new Uint8Array([1,2,10,3,0,11,0,6,11,0,4,6]),new Uint8Array([4,11,8,4,6,11,0,2,9,2,10,9]),new Uint8Array([10,9,3,10,3,2,9,4,3,11,3,6,4,6,3]),new Uint8Array([8,2,3,8,4,2,4,6,2]),new Uint8Array([0,4,2,4,6,2]),new Uint8Array([1,9,0,2,3,4,2,4,6,4,3,8]),new Uint8Array([1,9,4,1,4,2,2,4,6]),new Uint8Array([8,1,3,8,6,1,8,4,6,6,10,1]),new Uint8Array([10,1,0,10,0,6,6,0,4]),new Uint8Array([4,6,3,4,3,8,6,10,3,0,3,9,10,9,3]),new Uint8Array([10,9,4,6,10,4]),new Uint8Array([4,9,5,7,6,11]),new Uint8Array([0,8,3,4,9,5,11,7,6]),new Uint8Array([5,0,1,5,4,0,7,6,11]),new Uint8Array([11,7,6,8,3,4,3,5,4,3,1,5]),new Uint8Array([9,5,4,10,1,2,7,6,11]),new Uint8Array([6,11,7,1,2,10,0,8,3,4,9,5]),new Uint8Array([7,6,11,5,4,10,4,2,10,4,0,2]),new Uint8Array([3,4,8,3,5,4,3,2,5,10,5,2,11,7,6]),new Uint8Array([7,2,3,7,6,2,5,4,9]),new Uint8Array([9,5,4,0,8,6,0,6,2,6,8,7]),new Uint8Array([3,6,2,3,7,6,1,5,0,5,4,0]),new Uint8Array([6,2,8,6,8,7,2,1,8,4,8,5,1,5,8]),new Uint8Array([9,5,4,10,1,6,1,7,6,1,3,7]),new Uint8Array([1,6,10,1,7,6,1,0,7,8,7,0,9,5,4]),new Uint8Array([4,0,10,4,10,5,0,3,10,6,10,7,3,7,10]),new Uint8Array([7,6,10,7,10,8,5,4,10,4,8,10]),new Uint8Array([6,9,5,6,11,9,11,8,9]),new Uint8Array([3,6,11,0,6,3,0,5,6,0,9,5]),new Uint8Array([0,11,8,0,5,11,0,1,5,5,6,11]),new Uint8Array([6,11,3,6,3,5,5,3,1]),new Uint8Array([1,2,10,9,5,11,9,11,8,11,5,6]),new Uint8Array([0,11,3,0,6,11,0,9,6,5,6,9,1,2,10]),new Uint8Array([11,8,5,11,5,6,8,0,5,10,5,2,0,2,5]),new Uint8Array([6,11,3,6,3,5,2,10,3,10,5,3]),new Uint8Array([5,8,9,5,2,8,5,6,2,3,8,2]),new Uint8Array([9,5,6,9,6,0,0,6,2]),new Uint8Array([1,5,8,1,8,0,5,6,8,3,8,2,6,2,8]),new Uint8Array([1,5,6,2,1,6]),new Uint8Array([1,3,6,1,6,10,3,8,6,5,6,9,8,9,6]),new Uint8Array([10,1,0,10,0,6,9,5,0,5,6,0]),new Uint8Array([0,3,8,5,6,10]),new Uint8Array([10,5,6]),new Uint8Array([11,5,10,7,5,11]),new Uint8Array([11,5,10,11,7,5,8,3,0]),new Uint8Array([5,11,7,5,10,11,1,9,0]),new Uint8Array([10,7,5,10,11,7,9,8,1,8,3,1]),new Uint8Array([11,1,2,11,7,1,7,5,1]),new Uint8Array([0,8,3,1,2,7,1,7,5,7,2,11]),new Uint8Array([9,7,5,9,2,7,9,0,2,2,11,7]),new Uint8Array([7,5,2,7,2,11,5,9,2,3,2,8,9,8,2]),new Uint8Array([2,5,10,2,3,5,3,7,5]),new Uint8Array([8,2,0,8,5,2,8,7,5,10,2,5]),new Uint8Array([9,0,1,5,10,3,5,3,7,3,10,2]),new Uint8Array([9,8,2,9,2,1,8,7,2,10,2,5,7,5,2]),new Uint8Array([1,3,5,3,7,5]),new Uint8Array([0,8,7,0,7,1,1,7,5]),new Uint8Array([9,0,3,9,3,5,5,3,7]),new Uint8Array([9,8,7,5,9,7]),new Uint8Array([5,8,4,5,10,8,10,11,8]),new Uint8Array([5,0,4,5,11,0,5,10,11,11,3,0]),new Uint8Array([0,1,9,8,4,10,8,10,11,10,4,5]),new Uint8Array([10,11,4,10,4,5,11,3,4,9,4,1,3,1,4]),new Uint8Array([2,5,1,2,8,5,2,11,8,4,5,8]),new Uint8Array([0,4,11,0,11,3,4,5,11,2,11,1,5,1,11]),new Uint8Array([0,2,5,0,5,9,2,11,5,4,5,8,11,8,5]),new Uint8Array([9,4,5,2,11,3]),new Uint8Array([2,5,10,3,5,2,3,4,5,3,8,4]),new Uint8Array([5,10,2,5,2,4,4,2,0]),new Uint8Array([3,10,2,3,5,10,3,8,5,4,5,8,0,1,9]),new Uint8Array([5,10,2,5,2,4,1,9,2,9,4,2]),new Uint8Array([8,4,5,8,5,3,3,5,1]),new Uint8Array([0,4,5,1,0,5]),new Uint8Array([8,4,5,8,5,3,9,0,5,0,3,5]),new Uint8Array([9,4,5]),new Uint8Array([4,11,7,4,9,11,9,10,11]),new Uint8Array([0,8,3,4,9,7,9,11,7,9,10,11]),new Uint8Array([1,10,11,1,11,4,1,4,0,7,4,11]),new Uint8Array([3,1,4,3,4,8,1,10,4,7,4,11,10,11,4]),new Uint8Array([4,11,7,9,11,4,9,2,11,9,1,2]),new Uint8Array([9,7,4,9,11,7,9,1,11,2,11,1,0,8,3]),new Uint8Array([11,7,4,11,4,2,2,4,0]),new Uint8Array([11,7,4,11,4,2,8,3,4,3,2,4]),new Uint8Array([2,9,10,2,7,9,2,3,7,7,4,9]),new Uint8Array([9,10,7,9,7,4,10,2,7,8,7,0,2,0,7]),new Uint8Array([3,7,10,3,10,2,7,4,10,1,10,0,4,0,10]),new Uint8Array([1,10,2,8,7,4]),new Uint8Array([4,9,1,4,1,7,7,1,3]),new Uint8Array([4,9,1,4,1,7,0,8,1,8,7,1]),new Uint8Array([4,0,3,7,4,3]),new Uint8Array([4,8,7]),new Uint8Array([9,10,8,10,11,8]),new Uint8Array([3,0,9,3,9,11,11,9,10]),new Uint8Array([0,1,10,0,10,8,8,10,11]),new Uint8Array([3,1,10,11,3,10]),new Uint8Array([1,2,11,1,11,9,9,11,8]),new Uint8Array([3,0,9,3,9,11,1,2,9,2,11,9]),new Uint8Array([0,2,11,8,0,11]),new Uint8Array([3,2,11]),new Uint8Array([2,3,8,2,8,10,10,8,9]),new Uint8Array([9,10,2,0,9,2]),new Uint8Array([2,3,8,2,8,10,0,1,8,1,10,8]),new Uint8Array([1,10,2]),new Uint8Array([1,3,8,9,1,8]),new Uint8Array([0,9,1]),new Uint8Array([0,3,8]),new Uint8Array([])],r=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],n=[new Uint8Array([0,1]),new Uint8Array([1,2]),new Uint8Array([2,3]),new Uint8Array([3,0]),new Uint8Array([4,5]),new Uint8Array([5,6]),new Uint8Array([6,7]),new Uint8Array([7,4]),new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7])],i=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],a=[new Uint8Array([0,2,3,7]),new Uint8Array([0,6,2,7]),new Uint8Array([0,4,6,7]),new Uint8Array([0,6,1,2]),new Uint8Array([0,1,6,4]),new Uint8Array([5,6,1,4])],o=new Int32Array(24),s=new Int32Array(256);!function(){for(var e=0,t=0;t<8;++t)for(var r=1;r<=4;r<<=1){var n=t^r;t<=n&&(o[e++]=t,o[e++]=n)}for(t=0;t<256;++t){var i=0;for(r=0;r<24;r+=2){i|=!!(t&1<<o[r])!==!!(t&1<<o[r+1])?1<<(r>>1):0}s[t]=i}}();var l=new Array(4096);!function(){for(var e=0;e<l.length;++e)l[e]=0}();var u=[],c=function(e,t,r){var n=0;return n+=e[0],n+=u[1]*e[1],r[n+=u[2]*e[2]]};return{marchingCubes:function(i,a,o){u=[1,i[0],i[0]*i[1]],o||(o=[[0,0,0],i]);for(var s=[0,0,0],l=[0,0,0],h=0;h<3;++h)s[h]=(o[1][h]-o[0][h])/i[h],l[h]=o[0][h];var d=[],f=[],p=0,m=new Array(8),v=new Array(12),g=[0,0,0];for(g[2]=0;g[2]<i[2]-1;++g[2],p+=i[0])for(g[1]=0;g[1]<i[1]-1;++g[1],++p)for(g[0]=0;g[0]<i[0]-1;++g[0],++p){var y=0;if("function"==typeof a)for(h=0;h<8;++h){var _=r[h],b=a(s[0]*(g[0]+_[0])+l[0],s[1]*(g[1]+_[1])+l[1],s[2]*(g[2]+_[2])+l[2]);m[h]=b,y|=b>0?1<<h:0}else for(h=0;h<8;++h){_=r[h],b=c([g[0]+_[0],g[1]+_[1],g[2]+_[2]],0,a);m[h]=b,y|=b>0?1<<h:0}var E=e[y];if(0!==E){for(h=0;h<12;++h)if(0!=(E&1<<h)){v[h]=d.length;var w=[0,0,0],x=n[h],T=r[x[0]],S=r[x[1]],M=m[x[0]],R=M-m[x[1]],A=0;Math.abs(R)>1e-6&&(A=M/R);for(var k=0;k<3;++k)w[k]=s[k]*(g[k]+T[k]+A*(S[k]-T[k]))+l[k];d.push(w)}var P=t[y];for(h=0;h<P.length;h+=3)f.push([v[P[h]],v[P[h+1]],v[P[h+2]]])}}return{vertices:d,faces:f}},marchingTetrahedra:function(e,t,r){u=[1,e[0],e[0]*e[1]],r||(r=[[0,0,0],e]);for(var n=[0,0,0],o=[0,0,0],s=0;s<3;++s)n[s]=(r[1][s]-r[0][s])/e[s],o[s]=r[0][s];var l=[],h=[],d=0,f=new Float32Array(8),p=[0,0,0];function m(e,t){var r=f[e],a=f[t],s=i[e],u=i[t],c=[p[0],p[1],p[2]],h=r-a;Math.abs(h)>1e-6&&(h=r/h);for(var d=0;d<3;++d)c[d]=n[d]*(c[d]+s[d]+h*(u[d]-s[d]))+o[d];return l.push(c),l.length-1}for(p[2]=0;p[2]<e[2]-1;++p[2],d+=e[0])for(p[1]=0;p[1]<e[1]-1;++p[1],++d)for(p[0]=0;p[0]<e[0]-1;++p[0],++d){if("function"==typeof t)for(s=0;s<8;++s){var v=i[s];f[s]=t(n[0]*(p[0]+v[0])+o[0],n[1]*(p[1]+v[1])+o[1],n[2]*(p[2]+v[2])+o[2])}else for(s=0;s<8;++s){v=i[s];f[s]=c([p[0]+v[0],p[1]+v[1],p[2]+v[2]],0,t)}for(s=0;s<a.length;++s){var g=a[s],y=0;switch(f[g[0]]<0&&(y|=1),f[g[1]]<0&&(y|=2),f[g[2]]<0&&(y|=4),f[g[3]]<0&&(y|=8),y){case 0:case 15:break;case 14:h.push([m(g[0],g[1]),m(g[0],g[3]),m(g[0],g[2])]);break;case 1:h.push([m(g[0],g[1]),m(g[0],g[2]),m(g[0],g[3])]);break;case 13:h.push([m(g[1],g[0]),m(g[1],g[2]),m(g[1],g[3])]);break;case 2:h.push([m(g[1],g[0]),m(g[1],g[3]),m(g[1],g[2])]);break;case 12:h.push([m(g[1],g[2]),m(g[1],g[3]),m(g[0],g[3]),m(g[0],g[2])]);break;case 3:h.push([m(g[1],g[2]),m(g[0],g[2]),m(g[0],g[3]),m(g[1],g[3])]);break;case 4:h.push([m(g[2],g[0]),m(g[2],g[1]),m(g[2],g[3])]);break;case 11:h.push([m(g[2],g[0]),m(g[2],g[3]),m(g[2],g[1])]);break;case 5:h.push([m(g[0],g[1]),m(g[1],g[2]),m(g[2],g[3]),m(g[0],g[3])]);break;case 10:h.push([m(g[0],g[1]),m(g[0],g[3]),m(g[2],g[3]),m(g[1],g[2])]);break;case 6:h.push([m(g[2],g[3]),m(g[0],g[2]),m(g[0],g[1]),m(g[1],g[3])]);break;case 9:h.push([m(g[2],g[3]),m(g[1],g[3]),m(g[0],g[1]),m(g[0],g[2])]);break;case 7:h.push([m(g[3],g[0]),m(g[3],g[1]),m(g[3],g[2])]);break;case 8:h.push([m(g[3],g[0]),m(g[3],g[2]),m(g[3],g[1])])}}}return{vertices:l,faces:h}},surfaceNets:function(e,t,r){u=[1,e[0],e[0]*e[1]],r||(r=[[0,0,0],e]);for(var n=[0,0,0],i=[0,0,0],a=0;a<3;++a)n[a]=(r[1][a]-r[0][a])/e[a],i[a]=r[0][a];var h=[],d=[],f=[0,0,0],p=[1,e[0]+1,(e[0]+1)*(e[1]+1)],m=[0,0,0,0,0,0,0,0],v=1;if(2*p[2]>l.length){var g=l.length;for(l.length=2*p[2];g<l.length;)l[g++]=0}for(f[2]=0;f[2]<e[2]-1;++f[2],e[0],v^=1,p[2]=-p[2]){var y=1+(e[0]+1)*(1+v*(e[1]+1));for(f[1]=0;f[1]<e[1]-1;++f[1],0,y+=2)for(f[0]=0;f[0]<e[0]-1;++f[0],0,++y){var _=0,b=0;if("function"==typeof t)for(var E=0;E<2;++E)for(var w=0;w<2;++w)for(a=0;a<2;++a,++b){var x=t(n[0]*(f[0]+a)+i[0],n[1]*(f[1]+w)+i[1],n[2]*(f[2]+E)+i[2]);m[b]=x,_|=x<0?1<<b:0}else for(E=0;E<2;++E)for(w=0;w<2;++w)for(a=0;a<2;++a,++b){x=c([f[0]+a,f[1]+w,f[2]+E],0,t);m[b]=x,_|=x<0?1<<b:0}if(0!==_&&255!==_){var T=s[_],S=[0,0,0],M=0;for(a=0;a<12;++a)if(T&1<<a){++M;var R=o[a<<1],A=o[1+(a<<1)],k=m[R],P=k-m[A];if(Math.abs(P)>1e-6){P=k/P;for(w=0,E=1;w<3;++w,E<<=1){var C=R&E,L=A&E;S[w]+=C!==L?C?1-P:P:C?1:0}}}var I=1/M;for(a=0;a<3;++a)S[a]=n[a]*(f[a]+I*S[a])+i[a];l[y]=h.length,h.push(S);for(a=0;a<3;++a)if(T&1<<a){var O=(a+1)%3,H=(a+2)%3;if(0!==f[O]&&0!==f[H]){var D=p[O],N=p[H];1&_?(d.push([l[y],l[y-D],l[y-N]]),d.push([l[y-N],l[y-D],l[y-D-N]])):(d.push([l[y],l[y-N],l[y-D]]),d.push([l[y-D],l[y-N],l[y-D-N]]))}}}}}return{vertices:h,faces:d}}}},x=r(10),T=r.n(x),S=r(36);b.IsosurfaceGeometry=function(e,t,r,n){t=t||[[-1,-1,-1],[1,1,1]],n=n||"surfaceNets";if("number"==typeof(e=e||32)){m=t[1][0]-t[0][0],v=t[1][1]-t[0][1],g=t[1][2]-t[0][2];var i=Math.max(m,v,g)/e;(e=[])[0]=Math.max(~~(m/i),4),e[1]=Math.max(~~(v/i),4),e[2]=Math.max(~~(g/i),4)}THREE.Geometry.call(this);var a,o,s,l=new w;switch(n){case"surfaceNets":a=l.surfaceNets(e,r,t);break;case"marchingCubes":a=l.marchingCubes(e,r,t);break;case"marchingTetrahedra":a=l.marchingTetrahedra(e,r,t)}for(var u=0;u<a.vertices.length;++u)o=a.vertices[u],this.vertices.push(new THREE.Vector3(o[0],o[1],o[2]));for(u=0;u<a.faces.length;++u)3===(s=a.faces[u]).length?this.faces.push(new THREE.Face3(s[0],s[1],s[2])):4===s.length&&(this.faces.push(new THREE.Face3(s[0],s[1],s[2])),this.faces.push(new THREE.Face3(s[0],s[2],s[3])));if(this.mergeVertices(),"function"==typeof r){for(var c,h,d,f,p=.001,m=new THREE.Vector3(p,0,0),v=new THREE.Vector3(0,p,0),g=new THREE.Vector3(0,0,p),y=new THREE.Vector3,_=[],E=(u=0,this.vertices.length);u<E;u++)o=this.vertices[u],c=x(y.addVectors(o,m))-x(y.subVectors(o,m)),h=x(y.addVectors(o,v))-x(y.subVectors(o,v)),d=x(y.addVectors(o,g))-x(y.subVectors(o,g)),f=new THREE.Vector3(c,h,d).normalize(),_.push(f);for(u=0,E=this.faces.length;u<E;u++)(s=this.faces[u]).vertexNormals=[_[s.a],_[s.b],_[s.c]];function x(e){return r(e.x,e.y,e.z)}}else this.computeVertexNormals();b.createFaceVertexUVs(this)},b.IsosurfaceGeometry.prototype=Object.create(THREE.Geometry.prototype),b.IsosurfaceGeometry.prototype.constructor=b.IsosurfaceGeometry,b.DelaunayBufferGeometry=function(e,t){t=(t||"xz").toLowerCase();THREE.BufferGeometry.call(this);var r=null;"xz"===t?r=T.a.from(e.map(e=>[e.x,e.z])):"xy"===t?r=T.a.from(e.map(e=>[e.x,e.y])):"yz"===t&&(r=T.a.from(e.map(e=>[e.y,e.z])));var n=new Uint16Array(r.triangles);this.setIndex(new THREE.BufferAttribute(n,1)),this.setFromPoints(e),this.computeVertexNormals()},b.DelaunayBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),b.DelaunayBufferGeometry.prototype.constructor=b.DelaunayBufferGeometry,b.ConstrainedDelaunayBufferGeometry=function(e,t,r){t=t||[],r=r||[];THREE.BufferGeometry.call(this);var n=0;e.forEach(function(e){e.id=n++});var i=new S.SweepContext(e);t.length>0&&(t.forEach(function(e){e.forEach(function(e){e.id=n++})}),i.addHoles(t)),r.length>0&&(r.forEach(function(e){e.id=n++}),i.addPoints(r)),i.triangulate();var a=i.getTriangles(),o=[];a.forEach(function(e){e.getPoints().forEach(function(e){o.push(e.id)})}),this.setIndex(new THREE.Uint16BufferAttribute(o,1));var s=e.concat(t,r);s=b.flattenArray(s),this.setFromPoints(s),this.computeVertexNormals()},b.ConstrainedDelaunayBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),b.ConstrainedDelaunayBufferGeometry.prototype.constructor=b.ConstrainedDelaunayBufferGeometry,b.simplifyGeometry=function(e,t){t=t||.5;if(e.isGeometry||e.isBufferGeometry){e=b.toGeometry(e);var r=Math.floor(e.vertices.length*t);return(e=(new THREE.SimplifyModifier).modify(e,r)).computeVertexNormals(),e}},b.subdivideGeometry=function(e,t){t=t||1;if(e.isGeometry||e.isBufferGeometry)return e=new THREE.SubdivisionModifier(t).modify(e)},b.RingGeometry=function(e,t,r,n,i,a){THREE.Geometry.call(this),this.type="JamieRingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,l=[],u=e,c=(t-e)/(n=void 0!==n?Math.max(1,n):1);for(o=0;o<n+1;o++){for(s=0;s<r+1;s++){var h=new THREE.Vector3,d=i+s/r*a;h.x=u*Math.cos(d),h.z=u*Math.sin(d),this.vertices.push(h),l.push(new THREE.Vector2(s/r,o/n))}u+=c}var f=new THREE.Vector3(1,0,0);for(o=0;o<n;o++){var p=o*(r+1);for(s=0;s<r;s++){var m=d=s+p,v=d+r+1,g=d+r+2;this.faces.push(new THREE.Face3(m,v,g,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[v].clone(),l[g].clone()]),m=d,v=d+r+2,g=d+1,this.faces.push(new THREE.Face3(m,v,g,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[v].clone(),l[g].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,u)},b.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),b.RingGeometry.prototype.constructor=b.RingGeometry,b.computeChildVertexFaceAmount=function(e){var t=0,r=0,n=0;return e.traverse(function(e){if(t++,e.isMesh){var i=1;e instanceof b.InstancedMesh&&(i=e.numInstances);var a=e.geometry;a.isGeometry?(r+=a.vertices.length,n+=a.faces.length):a.isBufferGeometry&&(r+=a.attributes.position.count*i,null!==a.index?n+=a.index.count/3*i:n+=a.attributes.position.count/3*i)}}),{objects:t,vertices:r,faces:n}},b.computeMassProperties=function(e){var t=0,r=0;return e.traverse(function(e){if(e.isMesh){var i=function(e){var t=0,r=0,i=new THREE.Triangle,a=e.geometry;if(a.isGeometry){if(a.faces.length<1)return{area:0,volume:0};var o=a.vertices;a.faces.forEach(function(e){t+=i.set(o[e.a],o[e.b],o[e.c]).getArea(),r+=n(o[e.a],o[e.b],o[e.c])})}else if(a.isBufferGeometry){var s=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3;if(a.index){if(a.index.count<3)return{area:0,volume:0};for(var c,h,d,f=a.attributes.position.array,p=a.index.array,m=0,v=a.index.count;m<v;m+=3)c=p[m+0],h=p[m+1],d=p[m+2],s.set(f[3*c],f[3*c+1],f[3*c+2]),l.set(f[3*h],f[3*h+1],f[3*h+2]),u.set(f[3*d],f[3*d+1],f[3*d+2]),t+=i.set(s,l,u).getArea(),r+=n(s,l,u)}else{if(a.attributes.position.count<3)return{area:0,volume:0};for(var f=a.attributes.position.array,g=3*a.attributes.position.count,m=0;m<g;m+=9)s.set(f[m+0],f[m+1],f[m+2]),l.set(f[m+3],f[m+4],f[m+5]),u.set(f[m+6],f[m+7],f[m+8]),t+=i.set(s,l,u).getArea(),r+=n(s,l,u)}}if(e instanceof b.InstancedMesh){var y=e.numInstances;return{area:t*y,volume:r*y}}return{area:t,volume:r}}(e);t+=i.area,r+=i.volume}}),{area:t,volume:r};function n(e,t,r){return(-(r.x*t.y*e.z)+t.x*r.y*e.z+r.x*e.y*t.z-e.x*r.y*t.z-t.x*e.y*r.z+e.x*t.y*r.z)/6}},b.computeBoundingBox=function(e){return(new THREE.Box3).setFromObject(e)},b.computeBoundingSphere=function(){var e,t,r,n=new THREE.Vector3;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)n.copy(o[t]),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}else if(a.isBufferGeometry){var s;if(void 0!==(s=a.attributes.instancePosition?a.attributes.instancePosition:a.attributes.position))for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}}return function(t){return e=[],t.updateMatrixWorld(!0),t.traverse(i),e.length>0?(new THREE.Sphere).setFromPoints(e):void 0}}(),b.isEmptyGeometry=function(e){return!(e.isGeometry&&e.vertices.length>0)&&!(e.isBufferGeometry&&e.attributes.position.count>0)},b.translateGeometry=function(e,t){if(t.isVector3){var r=(new THREE.Matrix4).makeTranslation(t.x,t.y,t.z);e.applyMatrix(r)}},b.rotateGeometry=function(e,t,r){if(0!==r){var n=new THREE.Matrix4;switch(t.toLowerCase()){case"x":n.makeRotationX(r);break;case"y":n.makeRotationY(r);break;case"z":n.makeRotationZ(r);break;default:return}e.applyMatrix(n)}},b.toNonIndexedBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry?t=(new THREE.BufferGeometry).fromGeometry(e):e instanceof THREE.BufferGeometry&&null!==e.index&&(t=e.toNonIndexed()),t},b.toBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry&&(t=(new THREE.BufferGeometry).fromGeometry(e)),t},b.toGeometry=function(e){return e instanceof THREE.BufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)).mergeVertices(),e},b.rectangularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.width?e.width:1,n=void 0!==e.height?e.height:1,i=void 0!==e.numWidth?Math.floor(e.numWidth):1,a=void 0!==e.numHeight?Math.floor(e.numHeight):1,o=[];function s(e,t,r,n,i,a,s){var l,u,c,h,d=a<=1?1:n/(a-1),f=s<=1?1:i/(s-1),p=a<=1?0:n/2,m=s<=1?0:i/2,v=new THREE.Vector3;for(u=0;u<s;u++)for(h=u*f-m,l=0;l<a;l++)c=l*d-p,v[e]=c,v[t]=h,v[r]=0,o.push(v.x,v.y,v.z)}return"x"===t?s("y","z",t,r,n,i,a):"y"===t?s("z","x",t,r,n,i,a):"z"===t&&s("x","y",t,r,n,i,a),o},b.circularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.radiusStart?e.radiusStart:1,n=void 0!==e.radiusLength?e.radiusLength:r+1,i=void 0!==e.numRadius?Math.floor(e.numRadius):1,a=void 0!==e.angleStart?e.angleStart:0,o=void 0!==e.angleLength?e.angleLength:2*Math.PI,s=void 0!==e.numAngle?Math.floor(e.numAngle):4,l=[];function u(e,t,u){var c,h,d,f,p=i<=1?1:n/(i-1),m=s<=1?1:o/(s-1);o===2*Math.PI&&(m=o/s);var v=new THREE.Vector3;for(c=0;c<i;c++)for(d=c*p+r,h=0;h<s;h++)f=h*m+a,v[e]=d*Math.cos(f),v[t]=d*Math.sin(f),v[u]=0,l.push(v.x,v.y,v.z)}return"x"===t?u("y","z",t):"y"===t?u("z","x",t):"z"===t&&u("x","y",t),l},b.structuredPositions=function(e){return(e=e||{}).positions?e.positions:"rectangular"===e.pattern?b.rectangularPositions(e):"circular"===e.pattern?b.circularPositions(e):[]},b.scatteredPositions=function(e){if((e=e||{}).positions)return{positions:e.positions,rotations:e.rotations,scales:e.scales};for(var t,r,n,i=void 0!==e.seed?b.createRandFloat(e.seed):b.randFloat,a=.5*b.WORLD_SIZE,o=e.pmin||[-a,-a,-a],s=e.pmax||[a,a,a],l=e.rmin||[0,0,0],u=e.rmax||[0,0,0],c=e.smin||[1,1,1],h=e.smax||[1,1,1],d=void 0!==e.numInstances?Math.floor(e.numInstances):1,f=[],p=[],m=[],v=0;v<d;v++)t=i(o[0],s[0]),r=i(o[1],s[1]),n=i(o[2],s[2]),f.push(t,r,n),t=i(l[0],u[0]),r=i(l[1],u[1]),n=i(l[2],u[2]),p.push(t,r,n),t=i(c[0],h[0]),r=i(c[1],h[1]),n=i(c[2],h[2]),m.push(t,r,n);return{positions:f,rotations:p,scales:m}},b.createNoiseHeightGeometry=function(e,t,r,n,i){e=e||500,t=t||500;var a=(i=i||50)/88,o=function(e,t){for(var r=e*t,n=1,i=Math.random(),a=new Uint8Array(r),o=new THREE.ImprovedNoise,s=0;s<4;s++){for(var l=0;l<r;l++){var u=l%e,c=~~(l/e);a[l]+=Math.abs(o.noise(u/n,c/n,i)*n)}n*=5}return a}(r=r||256,n=n||256),s=new THREE.PlaneBufferGeometry(e,t,r-1,n-1);s.rotateX(-Math.PI/2);for(var l=s.attributes.position.array,u=0,c=0,h=l.length/3;u<h;u++,c+=3)l[c+1]=o[u]*a;return s.computeVertexNormals(),s},b.ShaderChunk=b.ShaderChunk||{},b.ShaderChunk.intersectBox="\nvoid intersectBox(vec3 rayOrigin, vec3 rayDirection, vec3 boxMin, vec3 boxMax, out float tNear, out float tFar, out bool intersect) {\n    vec3 invRay = vec3(1.0) / rayDirection;\n    vec3 tBot = invRay * (boxMin - rayOrigin);\n    vec3 tTop = invRay * (boxMax - rayOrigin);\n    vec3 tMin = min(tTop, tBot);\n    vec3 tMax = max(tTop, tBot);\n    tNear = max( tMin.x, max(tMin.y, tMin.z) );\n    tFar  = min( tMax.x, min(tMax.y, tMax.z) );\n    intersect = tFar > tNear;\n}",b.ShaderChunk.phongShading="\nvec3 phongShading(vec3 ka, vec3 kd, vec3 ks, float shininess, vec3 p, vec3 eye, vec3 lp, vec3 lc, vec3 n) {\n// lp: light position\n// lc: light color\n    float len;\n    vec3 l = lp - p;  len = length(l); l = len > 0.0 ? l / len : l;\n    float dotLN = dot(l,n);\n    if( dotLN < 0.0 ) return ka;\n\n    vec3 v = eye - p; len = length(v); v = len > 0.0 ? v / len : v;\n    vec3 r = reflect(-l,n); len = length(r); r = len > 0.0 ? r / len : r;    \n    float dotRV = dot(r,v);\n    if( dotRV < 0.0 ) return ka + lc * (kd * dotLN);\n\n    dotRV = pow( dotRV, shininess );\n    return ka + lc * (kd * dotLN + ks * dotRV);\n}",b.ShaderChunk.texture3d="\nvoid texture3d(in ivec3 dataCoordinates, out vec4 dataValue, out int offset) {\n    float textureSizeF = float(uTextureSize);\n    int voxelsPerTexture = uTextureSize*uTextureSize;\n    int index = dataCoordinates.x + dataCoordinates.y * uDataDimensions.x + dataCoordinates.z * uDataDimensions.y * uDataDimensions.x;\n    int packedIndex = index/uPackedPerPixel;\n    offset = index - uPackedPerPixel*packedIndex;\n    int textureIndex = packedIndex/voxelsPerTexture;\n    int inTextureIndex = packedIndex - voxelsPerTexture*textureIndex;\n    int rowIndex = inTextureIndex/uTextureSize;\n    float rowIndexF = float(rowIndex);\n    float colIndexF = float(inTextureIndex - uTextureSize * rowIndex);\n    vec2 uv = vec2(0.0);\n    uv.x = (0.5 + colIndexF) / textureSizeF;\n    uv.y = 1.0 - (0.5 + rowIndexF) / textureSizeF;\n    float textureIndexF = float(textureIndex);\n#if MAX_TEX3D_IMAGES == 7\n    dataValue = vec4(0.0) + \n    step( abs( textureIndexF - 0.0 ), 0.0 ) * texture2D(uTextureContainer[0], uv) +\n    step( abs( textureIndexF - 1.0 ), 0.0 ) * texture2D(uTextureContainer[1], uv) +\n    step( abs( textureIndexF - 2.0 ), 0.0 ) * texture2D(uTextureContainer[2], uv) +\n    step( abs( textureIndexF - 3.0 ), 0.0 ) * texture2D(uTextureContainer[3], uv) +\n    step( abs( textureIndexF - 4.0 ), 0.0 ) * texture2D(uTextureContainer[4], uv) +\n    step( abs( textureIndexF - 5.0 ), 0.0 ) * texture2D(uTextureContainer[5], uv) +\n    step( abs( textureIndexF - 6.0 ), 0.0 ) * texture2D(uTextureContainer[6], uv);\n#endif\n#if MAX_TEX3D_IMAGES == 14\n    dataValue = vec4(0.0) + \n    step( abs( textureIndexF - 0.0 ), 0.0 ) * texture2D(uTextureContainer[0], uv) +\n    step( abs( textureIndexF - 1.0 ), 0.0 ) * texture2D(uTextureContainer[1], uv) +\n    step( abs( textureIndexF - 2.0 ), 0.0 ) * texture2D(uTextureContainer[2], uv) +\n    step( abs( textureIndexF - 3.0 ), 0.0 ) * texture2D(uTextureContainer[3], uv) +\n    step( abs( textureIndexF - 4.0 ), 0.0 ) * texture2D(uTextureContainer[4], uv) +\n    step( abs( textureIndexF - 5.0 ), 0.0 ) * texture2D(uTextureContainer[5], uv) +\n    step( abs( textureIndexF - 6.0 ), 0.0 ) * texture2D(uTextureContainer[6], uv) +\n    step( abs( textureIndexF - 7.0 ), 0.0 ) * texture2D(uTextureContainer[7], uv) +\n    step( abs( textureIndexF - 8.0 ), 0.0 ) * texture2D(uTextureContainer[8], uv) +\n    step( abs( textureIndexF - 9.0 ), 0.0 ) * texture2D(uTextureContainer[9], uv) +\n    step( abs( textureIndexF - 10.0 ), 0.0 ) * texture2D(uTextureContainer[10], uv) +\n    step( abs( textureIndexF - 11.0 ), 0.0 ) * texture2D(uTextureContainer[11], uv) +\n    step( abs( textureIndexF - 12.0 ), 0.0 ) * texture2D(uTextureContainer[12], uv) +\n    step( abs( textureIndexF - 13.0 ), 0.0 ) * texture2D(uTextureContainer[13], uv);\n#endif\n}",b.ShaderChunk.unpack="\nvoid uInt8(in float r, out float value) {\n    value = r * 255.0;\n}\nvoid uInt16(in float r, in float a, out float value) {\n    value = r * 255.0 + a * 255.0 * 256.0;\n}\nvoid uInt32(in float r, in float g, in float b, in float a, out float value) {\n    value = r * 255.0 + g * 255.0 * 256.0 + b * 255.0 * 256.0 * 256.0 + a * 255.0 * 256.0 * 256.0 * 256.0;\n}\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value) {\n    // 1) create arrays containing bits for rgba values (between 0 and 255)\n    value = r * 255.0;\n    int bytemeR[8];\n    bytemeR[0] = int(floor(value / 128.0)); value -= float(bytemeR[0] * 128);\n    bytemeR[1] = int(floor(value / 64.0)); value -= float(bytemeR[1] * 64);\n    bytemeR[2] = int(floor(value / 32.0)); value -= float(bytemeR[2] * 32);\n    bytemeR[3] = int(floor(value / 16.0)); value -= float(bytemeR[3] * 16);\n    bytemeR[4] = int(floor(value / 8.0)); value -= float(bytemeR[4] * 8);\n    bytemeR[5] = int(floor(value / 4.0)); value -= float(bytemeR[5] * 4);\n    bytemeR[6] = int(floor(value / 2.0)); value -= float(bytemeR[6] * 2);\n    bytemeR[7] = int(floor(value)); value = g * 255.0;\n    int bytemeG[8];\n    bytemeG[0] = int(floor(value / 128.0)); value -= float(bytemeG[0] * 128);\n    bytemeG[1] = int(floor(value / 64.0)); value -= float(bytemeG[1] * 64);\n    bytemeG[2] = int(floor(value / 32.0)); value -= float(bytemeG[2] * 32);\n    bytemeG[3] = int(floor(value / 16.0)); value -= float(bytemeG[3] * 16);\n    bytemeG[4] = int(floor(value / 8.0)); value -= float(bytemeG[4] * 8);\n    bytemeG[5] = int(floor(value / 4.0)); value -= float(bytemeG[5] * 4);\n    bytemeG[6] = int(floor(value / 2.0)); value -= float(bytemeG[6] * 2);\n    bytemeG[7] = int(floor(value)); value = b * 255.0;\n    int bytemeB[8];\n    bytemeB[0] = int(floor(value / 128.0)); value -= float(bytemeB[0] * 128);\n    bytemeB[1] = int(floor(value / 64.0)); value -= float(bytemeB[1] * 64);\n    bytemeB[2] = int(floor(value / 32.0)); value -= float(bytemeB[2] * 32);\n    bytemeB[3] = int(floor(value / 16.0)); value -= float(bytemeB[3] * 16);\n    bytemeB[4] = int(floor(value / 8.0)); value -= float(bytemeB[4] * 8);\n    bytemeB[5] = int(floor(value / 4.0)); value -= float(bytemeB[5] * 4);\n    bytemeB[6] = int(floor(value / 2.0)); value -= float(bytemeB[6] * 2);\n    bytemeB[7] = int(floor(value)); value = a * 255.0;\n    int bytemeA[8];\n    bytemeA[0] = int(floor(value / 128.0)); value -= float(bytemeA[0] * 128);\n    bytemeA[1] = int(floor(value / 64.0)); value -= float(bytemeA[1] * 64);\n    bytemeA[2] = int(floor(value / 32.0)); value -= float(bytemeA[2] * 32);\n    bytemeA[3] = int(floor(value / 16.0)); value -= float(bytemeA[3] * 16);\n    bytemeA[4] = int(floor(value / 8.0)); value -= float(bytemeA[4] * 8);\n    bytemeA[5] = int(floor(value / 4.0)); value -= float(bytemeA[5] * 4);\n    bytemeA[6] = int(floor(value / 2.0)); value -= float(bytemeA[6] * 2);\n    bytemeA[7] = int(floor(value));\n    // 2) compute float32 value from bit arrays\n    int issigned = 1 - 2 * bytemeR[0]; //issigned = int(pow(-1., float(bytemeR[0])));\n    int exponent = 0;\n    exponent += bytemeR[1] * int(pow(2.0, 7.0));\n    exponent += bytemeR[2] * int(pow(2.0, 6.0));\n    exponent += bytemeR[3] * int(pow(2.0, 5.0));\n    exponent += bytemeR[4] * int(pow(2.0, 4.0));\n    exponent += bytemeR[5] * int(pow(2.0, 3.0));\n    exponent += bytemeR[6] * int(pow(2.0, 2.0));\n    exponent += bytemeR[7] * int(pow(2.0, 1.0));\n    exponent += bytemeG[0];\n    float fraction = 0.0;\n    fraction  = float(bytemeG[1]) * pow(2.0, -1.0);\n    fraction += float(bytemeG[2]) * pow(2.0, -2.0);\n    fraction += float(bytemeG[3]) * pow(2.0, -3.0);\n    fraction += float(bytemeG[4]) * pow(2.0, -4.0);\n    fraction += float(bytemeG[5]) * pow(2.0, -5.0);\n    fraction += float(bytemeG[6]) * pow(2.0, -6.0);\n    fraction += float(bytemeG[7]) * pow(2.0, -7.0);//\n    fraction += float(bytemeB[0]) * pow(2.0, -8.0);\n    fraction += float(bytemeB[1]) * pow(2.0, -9.0);\n    fraction += float(bytemeB[2]) * pow(2.0, -10.0);\n    fraction += float(bytemeB[3]) * pow(2.0, -11.0);\n    fraction += float(bytemeB[4]) * pow(2.0, -12.0);\n    fraction += float(bytemeB[5]) * pow(2.0, -13.0);\n    fraction += float(bytemeB[6]) * pow(2.0, -14.0);\n    fraction += float(bytemeB[7]) * pow(2.0, -15.0);//\n    fraction += float(bytemeA[0]) * pow(2.0, -16.0);\n    fraction += float(bytemeA[1]) * pow(2.0, -17.0);\n    fraction += float(bytemeA[2]) * pow(2.0, -18.0);\n    fraction += float(bytemeA[3]) * pow(2.0, -19.0);\n    fraction += float(bytemeA[4]) * pow(2.0, -20.0);\n    fraction += float(bytemeA[5]) * pow(2.0, -21.0);\n    fraction += float(bytemeA[6]) * pow(2.0, -22.0);\n    fraction += float(bytemeA[7]) * pow(2.0, -23.0);//\n    value = float(issigned) * pow(2.0, float(exponent - 127)) * (1.0 + fraction);\n}\nvoid unpack(in vec4 packedData, in int offset, out vec4 unpackedData) {\n#if defined( BITS_ALLOCATED_8 )\n    float floatedOffset = float(offset);\n    float floatedOffsetSquared = floatedOffset * floatedOffset;\n    uInt8( step( floatedOffsetSquared, 0.0 ) * packedData.r +\n           step( floatedOffsetSquared - 2.0 * floatedOffset + 1.0, 0.0 ) * packedData.g +\n           step( floatedOffsetSquared - 2.0 * 2.0 *  floatedOffset + 4.0, 0.0 ) * packedData.b +\n           step( floatedOffsetSquared - 2.0 * 3.0 *  floatedOffset + 9.0, 0.0 ) * packedData.a, unpackedData.x );\n#elif defined( BITS_ALLOCATED_16 )\n    float floatedOffset = float(offset);\n    uInt16( packedData.r * (1.0 - floatedOffset) + packedData.b * floatedOffset, packedData.g * (1.0 - floatedOffset) + packedData.a * floatedOffset, unpackedData.x);\n#elif defined( BITS_ALLOCATED_32 )\n    uInt32( packedData.r, packedData.g, packedData.b, packedData.a, unpackedData.x );\n#elif defined( BITS_ALLOCATED_32F )\n    uFloat32( packedData.r, packedData.g, packedData.b, packedData.a, unpackedData.x );\n#else\n    unpackedData = packedData;\n#endif\n}",b.ShaderChunk.interpolation="\nvoid interpolationIdentity(in vec3 currentVoxel, out vec4 dataValue) {\n    vec3 rcurrentVoxel = floor(currentVoxel + 0.5);\n    ivec3 voxel = ivec3(int(rcurrentVoxel.x), int(rcurrentVoxel.y), int(rcurrentVoxel.z));\n    vec4 tmp = vec4(0.0);\n    int offset = 0;\n    texture3d(voxel, tmp, offset);\n    unpack(tmp, offset, dataValue);\n}\nvoid trilinearInterpolation( in vec3 normalizedPosition, out vec4 interpolatedValue, in vec4 v000, in vec4 v100, in vec4 v001, in vec4 v101, in vec4 v010, in vec4 v110, in vec4 v011, in vec4 v111) {\n    vec4 c00 = v000 * ( 1.0 - normalizedPosition.x ) + v100 * normalizedPosition.x;\n    vec4 c01 = v001 * ( 1.0 - normalizedPosition.x ) + v101 * normalizedPosition.x;\n    vec4 c10 = v010 * ( 1.0 - normalizedPosition.x ) + v110 * normalizedPosition.x;\n    vec4 c11 = v011 * ( 1.0 - normalizedPosition.x ) + v111 * normalizedPosition.x;\n    vec4 c0 = c00 * ( 1.0 - normalizedPosition.y) + c10 * normalizedPosition.y;\n    vec4 c1 = c01 * ( 1.0 - normalizedPosition.y) + c11 * normalizedPosition.y;\n    vec4 c = c0 * ( 1.0 - normalizedPosition.z) + c1 * normalizedPosition.z;\n    interpolatedValue = c;\n}\nvoid interpolationTrilinear(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient) {\n    vec3 lower_bound = floor(currentVoxel);\n    lower_bound = max(vec3(0.0), lower_bound);\n    vec3 higher_bound = lower_bound + vec3(1.0);\n    vec3 normalizedPosition = currentVoxel - lower_bound;\n    normalizedPosition = max(vec3(0.0), normalizedPosition);\n    vec4 interpolatedValue = vec4(0.0);\n    vec4 v000 = vec4(0.0);\n    vec3 c000 = vec3(lower_bound.x, lower_bound.y, lower_bound.z);\n    interpolationIdentity(c000, v000);\n    vec4 v100 = vec4(0.0);\n    vec3 c100 = vec3(higher_bound.x, lower_bound.y, lower_bound.z);\n    interpolationIdentity(c100, v100);\n    vec4 v001 = vec4(0.0);\n    vec3 c001 = vec3(lower_bound.x, lower_bound.y, higher_bound.z);\n    interpolationIdentity(c001, v001);\n    vec4 v101 = vec4(0.0);\n    vec3 c101 = vec3(higher_bound.x, lower_bound.y, higher_bound.z);\n    interpolationIdentity(c101, v101);\n    vec4 v010 = vec4(0.0);\n    vec3 c010 = vec3(lower_bound.x, higher_bound.y, lower_bound.z);\n    interpolationIdentity(c010, v010);\n    vec4 v110 = vec4(0.0);\n    vec3 c110 = vec3(higher_bound.x, higher_bound.y, lower_bound.z);\n    interpolationIdentity(c110, v110);\n    vec4 v011 = vec4(0.0);\n    vec3 c011 = vec3(lower_bound.x, higher_bound.y, higher_bound.z);\n    interpolationIdentity(c011, v011);\n    vec4 v111 = vec4(0.0);\n    vec3 c111 = vec3(higher_bound.x, higher_bound.y, higher_bound.z);\n    interpolationIdentity(c111, v111);\n    // compute interpolation at position\n    trilinearInterpolation(normalizedPosition, interpolatedValue, v000, v100, v001, v101, v010, v110, v011, v111);\n    dataValue = interpolatedValue;\n    // compute gradient\n    float gradientStep = 0.005;\n    // x axis\n    vec3 g100 = vec3(1.0, 0.0, 0.0);\n    vec3 ng100 = normalizedPosition + g100 * gradientStep;\n    ng100.x = min(1.0, ng100.x);\n    vec4 vg100 = vec4(0.0);\n    trilinearInterpolation(ng100, vg100, v000, v100, v001, v101, v010, v110, v011, v111);\n    vec3 go100 = -g100;\n    vec3 ngo100 = normalizedPosition + go100 * gradientStep;\n    ngo100.x = max(0.0, ngo100.x);\n    vec4 vgo100 = vec4(0.0);\n    trilinearInterpolation(ngo100, vgo100, v000, v100, v001, v101, v010, v110, v011, v111);\n    gradient.x = (g100.x * vg100.x + go100.x * vgo100.x);\n    // y axis\n    vec3 g010 = vec3(0.0, 1.0, 0.0);\n    vec3 ng010 = normalizedPosition + g010 * gradientStep;\n    ng010.y = min(1.0, ng010.y);\n    vec4 vg010 = vec4(0.0);\n    trilinearInterpolation(ng010, vg010, v000, v100, v001, v101, v010, v110, v011, v111);\n    vec3 go010 = -g010;\n    vec3 ngo010 = normalizedPosition + go010 * gradientStep;\n    ngo010.y = max(0.0, ngo010.y);\n    vec4 vgo010 = vec4(0.0);\n    trilinearInterpolation(ngo010, vgo010, v000, v100, v001, v101, v010, v110, v011, v111);\n    gradient.y = (g010.y * vg010.x + go010.y * vgo010.x);\n    // z axis\n    vec3 g001 = vec3(0.0, 0.0, 1.0);\n    vec3 ng001 = normalizedPosition + g001 * gradientStep;\n    ng001.z = min(1.0, ng001.z);\n    vec4 vg001 = vec4(0.0);\n    trilinearInterpolation(ng001, vg001, v000, v100, v001, v101, v010, v110, v011, v111);\n    vec3 go001 = -g001;\n    vec3 ngo001 = normalizedPosition + go001 * gradientStep;\n    ngo001.z = max(0.0, ngo001.z);\n    vec4 vgo001 = vec4(0.0);\n    trilinearInterpolation(ngo001, vgo001, v000, v100, v001, v101, v010, v110, v011, v111);\n    gradient.z = (g001.z * vg001.x + go001.z * vgo001.x);\n    // normalize gradient\n    float gradientMagnitude = length(gradient);\n    if (gradientMagnitude > 0.0) {\n        gradient = -(1.0 / gradientMagnitude) * gradient;\n    }\n}\nvoid interpolation(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient) {\n    if( uInterpolation == 0 )\n        interpolationIdentity(currentVoxel, dataValue);\n    else\n        interpolationTrilinear(currentVoxel, dataValue, gradient);\n}",b.ShaderChunk.getIntensity="\nvoid getIntensity(in vec3 dataCoordinates, out float intensity, out vec3 gradient) {\n    vec4 dataValue = vec4(0.0);\n    interpolation(dataCoordinates, dataValue, gradient);\n    intensity = dataValue.r;\n    intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}",b.MedicalSliceShader={uniforms:{uTextureSize:{value:0},uTextureContainer:{value:[]},uDataDimensions:{value:[0,0,0]},uWorldToData:{value:null},uWindowCenterWidth:{value:[0,0]},uLowerUpperThreshold:{value:[0,0]},uRescaleSlopeIntercept:{value:[0,0]},uNumberOfChannels:{value:1},uBitsAllocated:{value:8},uInvert:{value:0},uLut:{value:0},uTextureLUT:{value:null},uLutSegmentation:{value:0},uTextureLUTSegmentation:{value:null},uPixelType:{value:0},uPackedPerPixel:{value:1},uInterpolation:{value:1},uCanvasWidth:{value:0},uCanvasHeight:{value:0},uBorderColor:{value:[1,0,.5]},uBorderWidth:{value:2},uBorderMargin:{value:2},uBorderDashLength:{value:10},uOpacity:{value:1},uSpacing:{value:0},uThickness:{value:0},uThicknessMethod:{value:0}},vertexShader:"\nvarying vec3 vPos;\nvarying vec3 vNormal;\nvoid main() {\n    vNormal = normal;\n    vPos = (modelMatrix * vec4( position, 1.0 )).xyz;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( position, 1.0 ));\n}",fragmentShader:`\nuniform int uTextureSize;\nuniform sampler2D uTextureContainer[14];\nuniform ivec3 uDataDimensions;\nuniform mat4 uWorldToData;\nuniform float uWindowCenterWidth[2];\nuniform float uLowerUpperThreshold[2];\nuniform float uRescaleSlopeIntercept[2];\nuniform int uNumberOfChannels;\nuniform int uBitsAllocated;\nuniform int uInvert;\nuniform int uLut;\nuniform sampler2D uTextureLUT;\nuniform int uLutSegmentation;\nuniform sampler2D uTextureLUTSegmentation;\nuniform int uPixelType;\nuniform int uPackedPerPixel;\nuniform int uInterpolation;\nuniform float uCanvasWidth;\nuniform float uCanvasHeight;\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform float uBorderMargin;\nuniform float uBorderDashLength;\nuniform float uOpacity;\nuniform float uSpacing;\nuniform float uThickness;\nuniform int uThicknessMethod;\nvarying vec3 vPos;\nvarying vec3 vNormal;\n${b.ShaderChunk.texture3d}\n${b.ShaderChunk.unpack}\n${b.ShaderChunk.interpolation}\nvoid main() {\n    if( uCanvasWidth > 0.0 &&\n    ((gl_FragCoord.x > uBorderMargin && (gl_FragCoord.x - uBorderMargin) < uBorderWidth) ||\n    (gl_FragCoord.x < (uCanvasWidth - uBorderMargin) && (gl_FragCoord.x + uBorderMargin) > (uCanvasWidth - uBorderWidth) ))) {\n        float valueY = mod(gl_FragCoord.y, 2.0 * uBorderDashLength);\n        if( valueY < uBorderDashLength && gl_FragCoord.y > uBorderMargin && gl_FragCoord.y < (uCanvasHeight - uBorderMargin) ) {\n            gl_FragColor = vec4(uBorderColor, 1.0);\n            return;\n        }\n    }\n    if( uCanvasHeight > 0.0 &&\n    ((gl_FragCoord.y > uBorderMargin && (gl_FragCoord.y - uBorderMargin) < uBorderWidth) ||\n    (gl_FragCoord.y < (uCanvasHeight - uBorderMargin) && (gl_FragCoord.y + uBorderMargin) > (uCanvasHeight - uBorderWidth) ))) {\n        float valueX = mod(gl_FragCoord.x, 2.0 * uBorderDashLength);\n        if( valueX < uBorderDashLength && gl_FragCoord.x > uBorderMargin && gl_FragCoord.x < (uCanvasWidth - uBorderMargin) ) {\n            gl_FragColor = vec4(uBorderColor, 1.0);\n            return;\n        }\n    }\n\n    // get texture coordinates of current pixel\n    vec4 dataValue = vec4(0.0);\n    vec3 gradient = vec3(1.0); // gradient calculations will be skipped if it is equal to vec3(1.0)\n    float steps = floor(uThickness / uSpacing + 0.5);\n\n    if( steps > 1.0 ) {\n        vec3 origin = vPos - uThickness * 0.5 * vNormal;\n        vec4 dataValueAcc = vec4(0.0);\n        for( float step = 0.0; step < 128.0; step++ ) {\n            if ( step >= steps ) {\n                break;\n            }\n            vec4 dataCoordinates = uWorldToData * vec4(origin + step * uSpacing * vNormal, 1.0);\n            interpolation(dataCoordinates.xyz, dataValueAcc, gradient);\n            if (step == 0.0) {\n                dataValue.r = dataValueAcc.r;\n                continue;\n            }\n            if (uThicknessMethod == 0) {\n                dataValue.r = max(dataValueAcc.r, dataValue.r);\n            }\n            if (uThicknessMethod == 1) {\n                dataValue.r += dataValueAcc.r;\n            }\n            if (uThicknessMethod == 2) {\n                dataValue.r = min(dataValueAcc.r, dataValue.r);\n            }\n        }\n        if (uThicknessMethod == 1) {\n            dataValue.r /= steps;\n        }\n    }\n    else {\n        vec4 dataCoordinates = uWorldToData * vec4(vPos, 1.0);\n        interpolation(dataCoordinates.xyz, dataValue, gradient);\n    }\n\n    if( uNumberOfChannels == 1 ) {\n        // rescale/slope\n        float realIntensity = dataValue.r * uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n        // threshold\n        if (realIntensity < uLowerUpperThreshold[0] || realIntensity > uLowerUpperThreshold[1]) {\n            discard;\n        }\n\n        // normalize\n        float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n        float normalizedIntensity = ( realIntensity - windowMin ) / uWindowCenterWidth[1];\n        dataValue.r = dataValue.g = dataValue.b = normalizedIntensity;\n        dataValue.a = 1.0;\n\n        // apply LUT\n        if(uLut == 1) {\n            dataValue = texture2D( uTextureLUT, vec2( normalizedIntensity, 1.0) );\n        }\n\n        // apply segmentation\n        if(uLutSegmentation == 1) {\n            float textureWidth = 256.0;\n            float textureHeight = 128.0;\n            // float min = 0.0;\n            int adjustedIntensity = int(floor(realIntensity + 0.5));\n\n            // get row and column in the texture\n            int colIndex = int(mod(float(adjustedIntensity), textureWidth));\n            int rowIndex = int(floor(float(adjustedIntensity)/textureWidth));\n\n            float texWidth = 1.0/textureWidth;\n            float texHeight = 1.0/textureHeight;\n\n            // map row and column to uv\n            vec2 uv = vec2(0.0);\n            uv.x = 0.5 * texWidth + (texWidth * float(colIndex));\n            uv.y = 1.0 - (0.5 * texHeight + float(rowIndex) * texHeight);\n            dataValue = texture2D( uTextureLUTSegmentation, uv );\n        }\n    }\n\n    if( uInvert == 1 ) {\n        dataValue.xyz = vec3(1.0) - dataValue.xyz;\n    }\n\n    dataValue.a = dataValue.a * uOpacity;\n    gl_FragColor = dataValue;\n}`},b.MedicalVolumeShader={uniforms:{uTextureSize:{value:0},uTextureContainer:{value:[]},uDataDimensions:{value:[0,0,0]},uWorldToData:{value:null},uDataToWorld:{value:null},uWindowCenterWidth:{value:[0,0]},uRescaleSlopeIntercept:{value:[0,0]},uNumberOfChannels:{value:1},uBitsAllocated:{value:8},uInvert:{value:0},uLut:{value:0},uTextureLUT:{value:null},uPixelType:{value:0},uPackedPerPixel:{value:1},uInterpolation:{value:1},uWorldBBox:{value:[0,0,0,0,0,0]},uSteps:{value:256},uAlphaCorrection:{value:.5},uFrequence:{value:0},uAmplitude:{value:0},uShading:{value:1},uAmbient:{value:.1},uAmbientColor:{value:[1,1,0]},uSampleColorToAmbient:{value:1},uSpecular:{value:1},uSpecularColor:{value:[1,1,1]},uDiffuse:{value:.3},uDiffuseColor:{value:[1,1,0]},uSampleColorToDiffuse:{value:1},uShininess:{value:5},uLightPosition:{value:[0,0,0]},uLightPositionInCamera:{value:1},uLightColor:{value:[.8,.8,.8]},uAlgorithm:{value:0},uCameraNear:{value:0},uCameraFar:{value:0}},vertexShader:"\nvarying vec3 vPos;\nvoid main() {\n    vPos = position;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( position, 1.0 ));\n}",fragmentShader:`\nuniform int uTextureSize;\nuniform sampler2D uTextureContainer[14];\nuniform ivec3 uDataDimensions;\nuniform mat4 uWorldToData;\nuniform mat4 uDataToWorld;\nuniform float uWindowCenterWidth[2];\nuniform float uRescaleSlopeIntercept[2];\nuniform int uNumberOfChannels;\nuniform int uBitsAllocated;\nuniform int uInvert;\nuniform int uLut;\nuniform sampler2D uTextureLUT;\nuniform int uPixelType;\nuniform int uPackedPerPixel;\nuniform int uInterpolation;\nuniform float uWorldBBox[6];\nuniform int uSteps;\nuniform float uAlphaCorrection;\nuniform float uFrequence;\nuniform float uAmplitude;\nuniform int uShading;\nuniform float uAmbient;\nuniform vec3 uAmbientColor;\nuniform int uSampleColorToAmbient;\nuniform float uSpecular;\nuniform vec3 uSpecularColor;\nuniform float uDiffuse;\nuniform vec3 uDiffuseColor;\nuniform int uSampleColorToDiffuse;\nuniform float uShininess;\nuniform vec3 uLightPosition;\nuniform int uLightPositionInCamera;\nuniform vec3 uLightColor;\nuniform int uAlgorithm;\nuniform float uCameraNear;\nuniform float uCameraFar;\nvarying vec3 vPos;\n${b.ShaderChunk.intersectBox}\n${b.ShaderChunk.phongShading}\n${b.ShaderChunk.texture3d}\n${b.ShaderChunk.unpack}\n${b.ShaderChunk.interpolation}\n${b.ShaderChunk.getIntensity}\nfloat getFragDepth( vec3 fragPosW ) {\n    vec4 fragPosV = viewMatrix * vec4(fragPosW, 1.0);\n    float fragDepth = uCameraFar * (uCameraNear + fragPosV.z) / ((uCameraFar - uCameraNear) * fragPosV.z);\n    return fragDepth;\n}\nvoid main() {\n    const int maxSteps = 1024;\n\n    vec3 ro = cameraPosition;\n    vec3 rd = normalize(vPos - ro);\n    vec3 lightPos = uLightPositionInCamera == 1 ? cameraPosition : uLightPosition;\n\n    vec3 AABBMin = vec3(uWorldBBox[0], uWorldBBox[2], uWorldBBox[4]);\n    vec3 AABBMax = vec3(uWorldBBox[1], uWorldBBox[3], uWorldBBox[5]);\n\n    float tNear, tFar;\n    bool intersect = false;\n    intersectBox(ro, rd, AABBMin, AABBMax, tNear, tFar, intersect);\n    if( intersect == false ) discard;\n    tNear = max( tNear, 0.0 );\n\n    // kill fragment near AABB boundary to improve speed (added by jamie)\n    vec3 box = AABBMax - AABBMin;\n    float boxSize = min( box.x, min( box.y, box.z ) );\n    if( tFar - tNear < boxSize*0.2 ) discard;\n\n    float dt = (tFar - tNear) / float(uSteps);\n    float t = tNear;\n    vec3 p = ro + rd * t;\n    vec3 dp = rd * dt;\n\n    float alphaScale = dt * uAlphaCorrection;\n    float maxIntensity = 0.0;  // mip volume rendering\n    vec4 colorSum = vec4(0.0); // accumulated color\n    float alphaSum = 0.0;      // accumulated alpha\n\n    vec4 dataCoordinatesRaw, color;\n    float intensity, alpha, gradlength;\n    vec3 transformed, gradient, ambient, diffuse, specular;\n\n    float fragNull = 1.0;\n\n    for( int i = 0; i < maxSteps; i++ )\n    {\n        transformed = p; // transformPoint(p, uAmplitude, uFrequence);\n\n        dataCoordinatesRaw = uWorldToData * vec4(transformed, 1.0);\n        intensity = 0.0;\n        gradient = vec3(0.0);\n        getIntensity( dataCoordinatesRaw.xyz, intensity, gradient );\n\n        // create fragment (added by jamie)\n        if( fragNull * uCameraFar * intensity > 0.0 ) {\n            gl_FragDepth = getFragDepth( transformed );\n            fragNull = 0.0;\n        }\n\n        gradient = vec3( uDataToWorld * vec4(gradient, 0.0) );\n        gradlength = length( gradient );\n        gradient = gradlength > 0.0 ? gradient / gradlength : gradient;\n\n        if( uLut == 1 ) {\n            color = texture2D( uTextureLUT, vec2(intensity, 1.0) ); // 256 colors\n            alpha = color.a;\n        }\n        else {\n            color.r = color.g = color.b = intensity;\n            alpha = intensity;\n        }\n\n        if (uAlgorithm == 0 && uShading == 1 && uInterpolation != 0) {\n            ambient = (uSampleColorToAmbient == 1 ? color.rgb : uAmbientColor) * uAmbient;\n            diffuse = (uSampleColorToDiffuse == 1 ? color.rgb : uDiffuseColor) * uDiffuse;\n            specular = uSpecularColor * uSpecular;\n            color.rgb += phongShading( ambient, diffuse, specular, uShininess, p, ro, lightPos, uLightColor, gradient );\n        }\n\n        alpha = 1.0 - pow( (1.0 - alpha), alphaScale );\n\n        // front-to-back composition\n        alpha *= (1.0 - alphaSum);\n        colorSum += alpha * color;\n        alphaSum += alpha;\n\n        t += dt;\n        p += dp;\n\n        if( t > tFar || (uAlgorithm == 0 && alphaSum >= 0.95) ) break;\n\n        if( uAlgorithm == 1 && (intensity >= maxIntensity) ) {\n            maxIntensity = intensity;\n            colorSum = color;\n            alphaSum = 1.0;\n        }\n    }\n    gl_FragColor = vec4( colorSum.rgb, alphaSum );\n}`},b.GodRaysPass=function(e,t,r,n){THREE.Pass.call(this),this.scene=e,this.camera=t,this.width=r||512,this.height=n||512;var i=t.far;this.sunPosition=new THREE.Vector3(0,.5*i,-i),this.materialDepth=new THREE.MeshDepthMaterial,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(-.5,.5,.5,-.5,-i,i),this.camera2.position.z=i/100,this.scene2.add(this.camera2);var a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureColors=new THREE.WebGLRenderTarget(r,n,a),this.rtTextureDepth=new THREE.WebGLRenderTarget(r,n,a),this.rtTextureDepthMask=new THREE.WebGLRenderTarget(r,n,a),this.rtResolutionMultiplier=.25;var o=r*this.rtResolutionMultiplier,s=n*this.rtResolutionMultiplier;this.rtTextureGodRays1=new THREE.WebGLRenderTarget(o,s,a),this.rtTextureGodRays2=new THREE.WebGLRenderTarget(o,s,a),void 0!==THREE.GodRaysDepthMaskShader&&void 0!==THREE.GodRaysGenerateShader&&void 0!==THREE.GodRaysCombineShader&&void 0!==THREE.GodRaysFakeSunShader||console.error("JAMIE.GodRaysPass: The pass relies on GodRaysShader.js.");var l=THREE.GodRaysDepthMaskShader;this.godrayMaskUniforms=THREE.UniformsUtils.clone(l.uniforms),this.materialGodraysDepthMask=new THREE.ShaderMaterial({uniforms:this.godrayMaskUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader});var u=THREE.GodRaysGenerateShader;this.godrayGenUniforms=THREE.UniformsUtils.clone(u.uniforms),this.materialGodraysGenerate=new THREE.ShaderMaterial({uniforms:this.godrayGenUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader});var c=THREE.GodRaysCombineShader;this.godrayCombineUniforms=THREE.UniformsUtils.clone(c.uniforms),this.materialGodraysCombine=new THREE.ShaderMaterial({uniforms:this.godrayCombineUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader});var h=THREE.GodRaysFakeSunShader;this.godraysFakeSunUniforms=THREE.UniformsUtils.clone(h.uniforms),this.materialGodraysFakeSun=new THREE.ShaderMaterial({uniforms:this.godraysFakeSunUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.godraysFakeSunUniforms.bgColor.value.setHex(0),this.godraysFakeSunUniforms.sunColor.value.setHex(b.SUN_COLOR),this.godrayCombineUniforms.fGodRayIntensity.value=.5;var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),this.materialGodraysGenerate);d.position.z=-.99*t.far,this.scene2.add(d)},b.GodRaysPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:b.GodRaysPass,dispose:function(){this.rtTextureColors.dispose(),this.rtTextureDepth.dispose(),this.rtTextureDepthMask.dispose(),this.rtTextureGodRays1.dispose(),this.rtTextureGodRays2.dispose(),this.materialGodraysDepthMask.dispose(),this.materialGodraysGenerate.dispose(),this.materialGodraysCombine.dispose(),this.materialGodraysFakeSun.dispose(),this.quad.geometry.dispose(),this.materialDepth.dispose()},setSize:function(e,t){this.rtTextureColors.setSize(e,t),this.rtTextureDepth.setSize(e,t),this.rtTextureDepthMask.setSize(e,t);var r=e*this.rtResolutionMultiplier,n=t*this.rtResolutionMultiplier;this.rtTextureGodRays1.setSize(r,n),this.rtTextureGodRays2.setSize(r,n)},render:function(e,t,r,n,i){var a=this.scene,o=this.camera,s=this.width,l=this.height,u=this.sunPosition,c=new THREE.Vector3;c.copy(u).project(o),c.x=(c.x+1)/2,c.y=(c.y+1)/2,this.godrayGenUniforms.vSunPositionScreenSpace.value.x=c.x,this.godrayGenUniforms.vSunPositionScreenSpace.value.y=c.y,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.x=c.x,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.y=c.y,e.setRenderTarget(this.rtTextureColors),e.clear(!0,!0,!1);var h=.74*l,d=.74*l;c.x*=s,c.y*=l,e.setScissor(c.x-d/2,c.y-h/2,d,h),e.setScissorTest(!0),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.scene2.overrideMaterial=this.materialGodraysFakeSun,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureColors),e.setScissorTest(!1),a.overrideMaterial=null,this.rendererRender(e,a,o,this.rtTextureColors),a.overrideMaterial=this.materialDepth,this.rendererRender(e,a,o,this.rtTextureDepth,!0),this.godrayMaskUniforms.tInput.value=this.rtTextureDepth.texture,this.scene2.overrideMaterial=this.materialGodraysDepthMask,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureDepthMask);this.filterGodRays(e,this.rtTextureDepthMask.texture,this.rtTextureGodRays2,this.getStepSize(.4,4,1)),this.filterGodRays(e,this.rtTextureGodRays2.texture,this.rtTextureGodRays1,this.getStepSize(.4,4,2)),this.filterGodRays(e,this.rtTextureGodRays1.texture,this.rtTextureGodRays2,this.getStepSize(.4,4,3)),this.godrayCombineUniforms.tColors.value=this.rtTextureColors.texture,this.godrayCombineUniforms.tGodRays.value=this.rtTextureGodRays2.texture,this.scene2.overrideMaterial=this.materialGodraysCombine,this.rendererRender(e,this.scene2,this.camera2,this.renderToScreen?null:t),this.scene2.overrideMaterial=null},getStepSize:function(e,t,r){return e*Math.pow(t,-r)},filterGodRays:function(e,t,r,n){this.godrayGenUniforms.fStepSize.value=n,this.godrayGenUniforms.tInput.value=t,this.scene2.overrideMaterial=this.materialGodraysGenerate,this.rendererRender(e,this.scene2,this.camera2,r),this.scene2.overrideMaterial=null},rendererRender:function(e,t,r,n,i){e.setRenderTarget(n),i&&e.clear(),e.render(t,r)}});var M=r(4);THREE.ShaderChunk.begin_vertex=["#ifndef INSTANCE_TRANSFORM","vec3 transformed = vec3( position );","#else","#ifndef INSTANCE_MATRIX","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","vec3 transformed = ( _instanceMatrix * vec4( position , 1. )).xyz;","#endif"].join("\n"),THREE.ShaderChunk.color_fragment=["#ifdef USE_COLOR","diffuseColor.rgb *= vColor;","#endif","#if defined(INSTANCE_COLOR)","diffuseColor.rgb *= vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_pars_fragment=["#ifdef USE_COLOR","varying vec3 vColor;","#endif","#if defined( INSTANCE_COLOR )","varying vec3 vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_vertex=["#ifdef USE_COLOR","vColor.xyz = color.xyz;","#endif","#if defined( INSTANCE_COLOR ) && defined( INSTANCE_TRANSFORM )","vInstanceColor = instanceColor;","#endif"].join("\n"),THREE.ShaderChunk.defaultnormal_vertex=["#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","#ifndef INSTANCE_TRANSFORM","vec3 transformedNormal = normalMatrix * objectNormal;","#else","#ifndef INSTANCE_MATRIX ","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","#ifndef INSTANCE_UNIFORM","vec3 transformedNormal =  transposeMat3( inversemat( mat3( modelViewMatrix * _instanceMatrix ) ) ) * objectNormal ;","#else","vec3 transformedNormal = ( modelViewMatrix * _instanceMatrix * vec4( objectNormal , 0.0 ) ).xyz;","#endif","#endif"].join("\n"),THREE.ShaderChunk.uv_pars_vertex=["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )","varying vec2 vUv;","uniform mat3 uvTransform;","#endif","#ifdef INSTANCE_TRANSFORM","mat3 inversemat(mat3 m) {","float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];","float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];","float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];","float b01 = a22 * a11 - a12 * a21;","float b11 = -a22 * a10 + a12 * a20;","float b21 = a21 * a10 - a11 * a20;","float det = a00 * b01 + a01 * b11 + a02 * b21;","return mat3(b01, (-a22 * a01 + a02 * a21), ( a12 * a01 - a02 * a11),","b11, ( a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),","b21, (-a21 * a00 + a01 * a20), ( a11 * a00 - a01 * a10)) / det;","}","attribute vec3 instancePosition;","attribute vec4 instanceQuaternion;","attribute vec3 instanceScale;","#if defined( INSTANCE_COLOR )","attribute vec3 instanceColor;","varying vec3 vInstanceColor;","#endif","mat4 getInstanceMatrix(){","vec4 q = instanceQuaternion;","vec3 s = instanceScale;","vec3 v = instancePosition;","vec3 q2 = q.xyz + q.xyz;","vec3 a = q.xxx * q2.xyz;","vec3 b = q.yyz * q2.yzz;","vec3 c = q.www * q2.xyz;","vec3 r0 = vec3( 1.0 - (b.x + b.z) , a.y + c.z , a.z - c.y ) * s.xxx;","vec3 r1 = vec3( a.y - c.z , 1.0 - (a.x + b.z) , b.y + c.x ) * s.yyy;","vec3 r2 = vec3( a.z + c.y , b.y - c.x , 1.0 - (a.x + b.x) ) * s.zzz;","return mat4(","r0 , 0.0,","r1 , 0.0,","r2 , 0.0,","v  , 1.0",");","}","#endif"].join("\n"),b.DEPTH_MATERIAL=new THREE.MeshDepthMaterial,b.DEPTH_MATERIAL.depthPacking=THREE.RGBADepthPacking,b.DEPTH_MATERIAL.clipping=!0,b.DEPTH_MATERIAL.defines={INSTANCE_TRANSFORM:""},b.DISTANCE_MATERIAL=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:"",INSTANCE_TRANSFORM:""},uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.distanceRGBA.uniforms),vertexShader:THREE.ShaderLib.distanceRGBA.vertexShader,fragmentShader:THREE.ShaderLib.distanceRGBA.fragmentShader,clipping:!0}),b.InstancedMesh=function(e,t,r,n,i,a){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i,a),this.isInstancedMesh=!0,this.userData.type="InstancedMesh"},b.InstancedMesh.prototype=Object.create(THREE.Mesh.prototype),b.InstancedMesh.prototype.constructor=b.InstancedMesh,b.InstancedMesh.prototype.create=function(e,t,r,n,i,a){THREE.Mesh.call(this,(new THREE.InstancedBufferGeometry).copy(e)),this.numInstances=void 0!==r?r:1,this.dynamic=void 0!==n&&n,this.colors=void 0!==i&&i,this.uniformScale=void 0===a||a,this._setAttributes(),this.material=t.clone(),this.customDepthMaterial=b.DEPTH_MATERIAL,this.customDistanceMaterial=b.DISTANCE_MATERIAL,this.frustumCulled=!1,this.name="instancedMesh";var o=this.userData;o.numInstances=this.numInstances,o.dynamic=this.dynamic,o.colors=this.colors,o.uniformScale=this.uniformScale},Object.defineProperties(b.InstancedMesh.prototype,{material:{set:function(e){(e=e.clone()).defines?(e.defines.INSTANCE_TRANSFORM="",this.uniformScale?e.defines.INSTANCE_UNIFORM="":delete e.defines.INSTANCE_UNIFORM,this.colors?e.defines.INSTANCE_COLOR="":delete e.defines.INSTANCE_COLOR):(e.defines={INSTANCE_TRANSFORM:""},this.uniformScale&&(e.defines.INSTANCE_UNIFORM=""),this.colors&&(e.defines.INSTANCE_COLOR="")),this._material=e},get:function(){return this._material}},numInstances:{set:function(e){this._numInstances=e},get:function(){return this._numInstances}},geometry:{set:function(e){this._geometry=e},get:function(){return this._geometry}}}),b.InstancedMesh.prototype.setPositionAt=function(e,t){this.geometry.attributes.instancePosition.setXYZ(e,t.x,t.y,t.z)},b.InstancedMesh.prototype.setQuaternionAt=function(e,t){this.geometry.attributes.instanceQuaternion.setXYZW(e,t.x,t.y,t.z,t.w)},b.InstancedMesh.prototype.setScaleAt=function(e,t){this.geometry.attributes.instanceScale.setXYZ(e,t.x,t.y,t.z)},b.InstancedMesh.prototype.setColorAt=function(e,t){this.colors?this.geometry.attributes.instanceColor.setXYZ(e,Math.floor(255*t.r),Math.floor(255*t.g),Math.floor(255*t.b)):console.warn("JAMIE.InstancedMesh: color not enabled")},b.InstancedMesh.prototype.getPositionAt=function(e,t){var r=this.geometry.attributes.instancePosition.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},b.InstancedMesh.prototype.getQuaternionAt=function(e,t){var r=this.geometry.attributes.instanceQuaternion.array;return e<<=2,t?t.set(r[e++],r[e++],r[e++],r[e]):new THREE.Quaternion(r[e++],r[e++],r[e++],r[e])},b.InstancedMesh.prototype.getScaleAt=function(e,t){var r=this.geometry.attributes.instanceScale.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},b.InstancedMesh.prototype.getColorAt=function(e,t){if(!this.colors)return console.warn("JAMIE.InstancedMesh: color not enabled"),!1;var r=this.geometry.attributes.instanceColor.array;return e*=3,t?t.setRGB(r[e++]*(1/255),r[e++]*(1/255),r[e]*(1/255)):new THREE.Vector3(r[e++],r[e++],r[e]).multiplyScalar(1/255)},b.InstancedMesh.prototype.needsUpdate=function(e){switch(e){case"position":this.geometry.attributes.instancePosition.needsUpdate=!0;break;case"quaternion":this.geometry.attributes.instanceQuaternion.needsUpdate=!0;break;case"scale":this.geometry.attributes.instanceScale.needsUpdate=!0;break;case"colors":this.geometry.attributes.instanceColor.needsUpdate=!0;break;default:this.geometry.attributes.instancePosition.needsUpdate=!0,this.geometry.attributes.instanceQuaternion.needsUpdate=!0,this.geometry.attributes.instanceScale.needsUpdate=!0,this.colors&&(this.geometry.attributes.instanceColor.needsUpdate=!0)}},b.InstancedMesh.prototype._setAttributes=function(){this.geometry.addAttribute("instancePosition",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0)),this.geometry.addAttribute("instanceQuaternion",new THREE.InstancedBufferAttribute(new Float32Array(4*this.numInstances),4,!0)),this.geometry.addAttribute("instanceScale",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0)),this.geometry.attributes.instancePosition.dynamic=this.dynamic,this.geometry.attributes.instanceQuaternion.dynamic=this.dynamic,this.geometry.attributes.instanceScale.dynamic=this.dynamic,this.colors&&(this.geometry.addAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Uint8Array(3*this.numInstances),3,!0)),this.geometry.attributes.instanceColor.normalized=!0,this.geometry.attributes.instanceColor.dynamic=this.dynamic)},b.InstancedMesh.prototype.fromObject=function(e){var t=e.geometry.clone();delete t.attributes.instanceColor,delete t.attributes.instancePosition,delete t.attributes.instanceQuaternion,delete t.attributes.instanceScale;var r=e.userData;this.create(t,e.material,r.numInstances,r.dynamic,r.colors,r.uniformScale);var n=this.geometry.attributes,i=e.geometry.attributes;n.instancePosition.copy(i.instancePosition),n.instanceQuaternion.copy(i.instanceQuaternion),n.instanceScale.copy(i.instanceScale),i.instanceColor&&n.instanceColor.copy(i.instanceColor)},b.InstancedMesh.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},b.InstancedMesh.prototype.clone=function(){var e=new b.InstancedMesh(this);return b.copyTransform(e,this),e},b.InstancedMesh.prototype.split=function(e){for(var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3,a=new THREE.Color,o=this.material,s=this.geometry.attributes,l=s.instancePosition,u=s.instanceQuaternion,c=s.instanceScale,h=s.instanceColor,d=l.count,f=0;f<d;f++){r.fromArray(l.array,3*f),n.fromArray(u.array,4*f),i.fromArray(c.array,3*f);var p=new THREE.BufferGeometry;for(var m in s){var v=s[m];!0!==v.isInstancedBufferAttribute&&p.addAttribute(m,v.clone())}var g=o;h&&(a.fromArray(h.array,3*f),a.multiplyScalar(1/255),(g=o.clone()).color.copy(a));var y=new THREE.Mesh(p,g);y.position.copy(r),y.quaternion.copy(n),y.scale.copy(i),t.push(y)}e&&e(t)},b.InstancedMesh.prototype.increaseInstances=function(e){!1===Array.isArray(e)&&(e=[e]);var t=this.geometry.attributes;for(var r in t){var n=t[r];if(!0===n.isInstancedBufferAttribute){var i=[];i.push(n),e.forEach(e=>{i.push(e.geometry.attributes[r])}),t[r]=THREE.BufferGeometryUtils.mergeInstancedBufferAttribute(i),t[r].needsUpdate=!0}}e.forEach(e=>{this.numInstances+=e.geometry.attributes.instancePosition.count}),this.userData.numInstances=this.numInstances},b.createStructuredMesh=function(e,t){t=t||{};var r=b.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=b.structuredPositions(t),a=i.length/3;if(0!==a){t.numInstances=a;var o=b.randomColors(t);o&&0!==o.length||(o=void 0);var s=new b.InstancedMesh(r,n,a,!1,!!o,!0);s.name="structuredMesh",s.frustumCulled=!1,b.copyTransform(s,e);for(var l=new THREE.Vector3,u=new THREE.Quaternion(0,0,0,1),c=new THREE.Vector3(1,1,1),h=new THREE.Color,d=0,f=0;d<a;d++,f+=3)l.fromArray(i,f),s.setPositionAt(d,l),s.setQuaternionAt(d,u),s.setScaleAt(d,c),void 0!==o&&(h.fromArray(o,f),s.setColorAt(d,h));return s}},b.createScatteredMesh=function(e,t){t=t||{};var r=b.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=b.scatteredPositions(t),a=i.positions,o=i.rotations,s=i.scales,l=a.length/3;if(0!==l){var u=b.randomColors(t);u&&0!==u.length||(u=void 0);var c=new b.InstancedMesh(r,n,l,!1,!!u,!0);c.name="scatteredMesh",c.frustumCulled=!1,b.copyTransform(c,e);for(var h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Euler,p=new THREE.Quaternion(0,0,0,1),m=new THREE.Vector3(1,1,1),v=new THREE.Color,g=0,y=0;g<l;g++,y+=3)h.fromArray(a,y),void 0!==o&&(d.fromArray(o,y),f.setFromVector3(d),p.setFromEuler(f)),void 0!==s&&m.fromArray(s,y),c.setPositionAt(g,h),c.setQuaternionAt(g,p),c.setScaleAt(g,m),void 0!==u&&(v.fromArray(u,y),c.setColorAt(g,v));return c}},b.createInstancedMeshes=function(e,t){t=t||{};!1===Array.isArray(e)&&(e=[e]);for(var r,n=[],i=0,a=e.length;i<a;i++)r=void 0!==t.pattern?b.createStructuredMesh(e[i],t):b.createScatteredMesh(e[i],t),n.push(r);return 1===n.length?n[0]:n},b.createInstancedObject=function(e,t){if(void 0===t.seed&&(t.seed=e.id),!0===e.isMesh)return b.createInstancedMeshes(e,t);var r=new THREE.Object3D;r.name=e.name;for(var n=e.children,i=0,a=n.length;i<a;i++){var o=b.createInstancedObject(n[i],t);r.add(o)}return b.copyTransform(r,e),r},b.CSGBoolean=function(e,t,r){t=t||"union";var n=new ThreeBSP(e),i=new ThreeBSP(r);"union"===t||"+"===t?n=n.union(i):"intersect"===t||"*"===t?n=n.intersect(i):"subtract"!==t&&"-"!==t||(n=n.subtract(i));var a=null;return e instanceof THREE.Mesh?a=n.toMesh(null):e instanceof THREE.BufferGeometry?a=n.toNonIndexedBufferGeometry():e instanceof THREE.Geometry&&(a=n.toGeometry()),a},b.union=function(e,t){return b.CSGBoolean(e,"+",t)},b.intersect=function(e,t){return b.CSGBoolean(e,"*",t)},b.subtract=function(e,t){return b.CSGBoolean(e,"-",t)},b.createWireframe=function(e,t,r){var n;t=void 0!==t?t:0,r=void 0!==r&&r;(i=e.material).polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=1,i.needsUpdate=!0,n=r?new THREE.EdgesGeometry(e.geometry):new THREE.WireframeGeometry(e.geometry);var i=new THREE.LineBasicMaterial({color:t,linewidth:2});return new THREE.LineSegments(n,i)},b.createVertexPoints=function(e,t,r,n){var i=b.getObjectSize(e);t=t||i/100,r=r||16777215,n=n||!0;return new THREE.Points(e.geometry,new THREE.PointsMaterial({map:(new THREE.TextureLoader).load("images/sprites/ball.png"),size:t,color:r,depthTest:n,transparent:!0}))},b.TextSprite=function(e,t){t=t||{};var r={};r.string=e||"",r.height=t.textHeight||.5,r.widthScale=t.textWidthScale||1,r.color=t.textColor||"#ffffff",r.align=t.textAlign||"center",r.baseline=t.textBaseline||"middle",this.text=r;var n={};n.style=t.fontStyle||"normal",n.variant=t.fontVariant||"normal",n.weight=t.fontWeight||"normal",n.size=t.fontSize||"64px",n.family=t.fontFamily||"Karla, sans-serif",this.font=n;var i=document.createElement("canvas");i.height=parseInt(n.size),i.width=i.height*r.string.length;var a=i.getContext("2d");a.font=n.style+" "+n.variant+" "+n.weight+" "+n.size+" "+n.family,a.textAlign=r.align,a.textBaseline=r.baseline,a.fillStyle=b.toHexStyle(r.color),a.fillText(r.string,i.width/2,i.height/2),this.ctx=a;var o=new THREE.CanvasTexture(this.ctx.canvas),s=new THREE.SpriteMaterial({color:16777215,map:o});THREE.Sprite.call(this,s),this.type="TextSprite";var l=r.height*r.string.length*r.widthScale;this.scale.set(l,r.height,1)},b.TextSprite.prototype=Object.assign(Object.create(THREE.Sprite.prototype),{constructor:b.TextSprite,isTextSprite:!0,copy:function(e){return THREE.Sprite.prototype.copy.call(this,e),this.text=JSON.parse(JSON.stringify(e.text)),this.font=JSON.parse(JSON.stringify(e.font)),this.ctx.drawImage(e.ctx.canvas,0,0),this},clone:function(){return new this.constructor(this.text.string).copy(this)},updateText:function(e){var t=this.ctx.canvas,r=this.ctx,n=this.text,i=this.font;n.string=e||"",t.height=parseInt(i.size),t.width=t.height*n.string.length,r.font=i.style+" "+i.variant+" "+i.weight+" "+i.size+" "+i.family,r.textAlign=n.align,r.textBaseline=n.baseline,r.fillStyle=b.toHexStyle(n.color),r.fillText(n.string,t.width/2,t.height/2);var a=n.height*n.string.length*n.widthScale;this.scale.set(a,n.height,1),this.material.map.needsUpdate=!0}}),b.createTextSprite=function(e,t){return new b.TextSprite(e,t)},b.addTextMesh=function(e,t){e=e||"text",(t=t||{}).position=t.position||{x:0,y:0,z:0},t.color=t.color||16777215,t.height=t.height||1,t.thickRatio=t.thickRatio||.25,t.alignment=t.alignment||1,t.rotSpeed=t.rotSpeed||0,t.fontFile=t.fontFile||"fonts/gentilis_regular.typeface.json",(new THREE.FontLoader).load(t.fontFile,function(r){var n=new THREE.MeshPhongMaterial({color:t.color,specular:t.color}),i=new THREE.TextBufferGeometry(e,{font:r,size:100,height:100*t.thickRatio,curveSegments:12,bevelEnabled:!0,bevelThickness:2,bevelSize:5,bevelSegments:3});i.computeBoundingBox();var a=(i.boundingBox.max.x-i.boundingBox.min.x)*t.alignment/2,o=(new THREE.Matrix4).makeTranslation(-a,0,0);i.applyMatrix(o);var s=new THREE.Mesh(i,n);s.scale.setScalar(t.height/100),s.position.set(t.position.x,t.position.y,t.position.z),s.castShadow=!0,s.receiveShadow=!0,s.name=e,0!==t.rotSpeed&&(s.update=function(e,r){this.rotation.y+=t.rotSpeed*e}),b.add(s)})},b.createPrimitive=function(e){var t=new THREE[e.geometry.type](...e.geometry.parameters),r=e.material.type;delete e.material.type;var n=new THREE[r](e.material);e.material.type=n.type;var i=new THREE.Mesh(t,n),a=t.type.replace("Buffer","").replace("Geometry",""),o=n.type.replace("Mesh","").replace("Material","");return i.name=a+o,i.frustumCulled=!1,i.castShadow=!0,i.receiveShadow=!0,i},b.createCheckerboard=function(e,t){e=void 0!==e?e:100,t=void 0!==t?t:5;var r=(new THREE.TextureLoader).load("images/grid2x2.png",r=>{r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping,r.repeat.set(e/(2*t),e/(2*t))}),n=b.createPrimitive({geometry:{type:"PlaneBufferGeometry",parameters:[e,e]},material:{type:"MeshPhongMaterial",map:r}});return n.rotation.x=-Math.PI/2,n},b.tweenObject=function(e,t,r){var n=void 0!==(r=r||{}).duration?r.duration:1e3,i=new M.Tween(e).to(t,n);return void 0!==r.easing&&i.easing(r.easing),void 0!==r.interpolation&&i.interpolation(r.interpolation),void 0!==r.repeat&&i.repeat(r.repeat),void 0!==r.repeatDelay&&i.repeatDelay(r.repeatDelay),!0===r.yoyo&&i.yoyo(r.yoyo),void 0!==r.update&&i.onUpdate(e=>{r.update(e)}),void 0!==r.complete&&i.onComplete(e=>{r.complete(e)}),void 0!==r.start?i.start(r.start+(r.delay||0)):void 0!==r.delay&&i.delay(r.delay),i},b.tweenObjects=function(e,t,r){var n=new M.Group,i=r.delay,a=r.delay||0;return e.forEach((e,i)=>{void 0!==r.objectDelay&&(r.delay=a+i*r.objectDelay),n.add(b.tweenObject(e,t[i],r))}),r.delay=i,n},b.GridLOD=function(e){THREE.Object3D.apply(this),this.previousLodResolution=0,this.create(e,!1),this.name="gridLOD",this.frustumCulled=!1},b.GridLOD.prototype=Object.create(THREE.Object3D.prototype),b.GridLOD.prototype.constructor=Object.create(b.GridLOD),b.GridLOD.prototype.controlLODParameters=function(e,t){function r(e,t){return void 0!==e?e:t}void 0===e&&(e={}),(t=r(t,!1))?(this.lodResolution=r(e.resolution,this.lodResolution),this.lodLevels=r(e.levels,this.lodLevels),this.lodScale=r(e.scale,this.lodScale),this.lodMorphingLevels=r(e.morphingLevels,this.lodMorphingLevels),this.lodMaterial=r(e.material,this.lodMaterial)):(this.lodResolution=r(e.resolution,64),this.lodLevels=r(e.levels,8),this.lodScale=r(e.scale,1),this.lodMorphingLevels=r(e.morphingLevels,2),this.lodMaterial=r(e.material,void 0)),this.lodLevels=Math.max(1,Math.round(this.lodLevels)),this.lodScale=Math.max(1,this.lodScale),this.lodResolution=Math.max(1,this.lodResolution),this.lodResolution=Math.pow(2,Math.round(Math.log2(this.lodResolution))),this.lodMorphingLevels=Math.max(0,Math.min(2,Math.round(this.lodMorphingLevels))),this.previousLodResolution=this.lodResolution},b.GridLOD.prototype.createLODMaterial=function(){var e=b.GridLODShader,t=THREE.UniformsUtils.clone(e.uniforms);return t.u_resolution={value:this.lodResolution},t.u_level={value:this.lodLevels},t.u_scale={value:this.lodScale},t.u_morphingLevels={value:this.lodMorphingLevels},t.u_usePlaneParameters={value:0},t.u_planeUp={value:new THREE.Vector3(0,1,0)},t.u_planeAt={value:new THREE.Vector3(0,0,1)},t.u_planePoint={value:new THREE.Vector3(0,0,0)},t.u_planeDistance={value:0},new THREE.ShaderMaterial({uniforms:t,vertexShader:e.buildVertexShader("lod"),fragmentShader:e.fragmentShader,side:THREE.DoubleSide,wireframe:!1})},b.GridLOD.prototype.create=function(e,t){var r=this.previousLodResolution;if(this.controlLODParameters(e,t),!1===t&&(this.lodMaterial=this.createLODMaterial()),r!==this.lodResolution){for(this.gridGeometry=this.createLODGeometry(this.lodResolution),this.gridOutsideGeometry=this.createLODGeometry(this.lodResolution,!0);this.children.length>0;)this.remove(this.children[0]);this.lodMaterial.uniforms.u_resolution.value=this.lodResolution;for(var n=this.lodScale,i=0;i<this.lodLevels;i++){var a=0===i?this.gridGeometry:this.gridOutsideGeometry;this.add(this.createLODMesh(a,this.lodMaterial,n,i)),n*=2}}},b.GridLOD.prototype.createLODMesh=function(e,t,r,n){var i=t.clone();return i.uniforms.u_scale.value=r,i.uniforms.u_level.value=n,new THREE.Mesh(e,i)},b.GridLOD.prototype.createLODGeometry=function(e,t){function r(e,t){return void 0!==e?e:t}e=r(e,64),t=r(t,!1);var n=new THREE.BufferGeometry,i=Math.round(.5*e),a=(e+2)*(e+2)*2,o=new Float32Array(3*((e+3)*(e+3))),s=new(o.length/3>65535?Uint32Array:Uint16Array)(3*a);n.setIndex(new THREE.BufferAttribute(s,1)),n.addAttribute("position",new THREE.BufferAttribute(o,3));for(var l=0,u=-i-1;u<=i+1;u++)for(var c=-i-1;c<=i+1;c++)o[l]=u/e,o[l+1]=0,o[l+2]=c/e,l+=3;l=0;var h=e+3,d=e/4,f=3*d;for(u=0;u<=e+1;u++){var p=u,m=u+1,v=u>d&&u<=f;for(c=0;c<=e+1;c++){var g=c+1;if(!(t&&v&&(c>d&&c<=f))){var y=h*p+g,_=h*m+g,b=h*m+c,E=h*p+c;s[l]=y,s[l+1]=_,s[l+2]=E,s[l+3]=E,s[l+4]=_,s[l+5]=b,l+=6}}}return n},b.GridLOD.prototype.setLODScale=function(e){this.lodScale=e,this.controlLODParameters({},!0);var t=this.lodScale;this.children.forEach(e=>{e.material.uniforms.u_scale.value=t,t*=2})},b.GridLOD.prototype.setMorphingLevels=function(e){this.lodMorphingLevels=e,this.controlLODParameters({},!0),e=this.lodMorphingLevels,this.children.forEach(t=>{t.material.uniforms.u_morphingLevels.value=e})},b.GridLOD.prototype.setMaterialValue=function(e,t){this.lodMaterial[e]=t,this.children.forEach(r=>{r.material[e]=t})},b.GridLOD.prototype.setUniformValue=function(e,t){this.lodMaterial.uniforms[e].value=t,this.children.forEach(r=>{r.material.uniforms[e].value=t})},b.GridLOD.prototype.getUniformValue=function(e){return this.lodMaterial.uniforms[e].value},b.GridLOD.prototype.createParentCamera=function(){return this.parent instanceof THREE.PerspectiveCamera?this.parent:(this.parent=b.camera.clone(),this.parent.add(this),this.parent)},b.GridLOD.prototype.update=function(e,t){!0===this.getUniformValue("u_animate")&&this.setUniformValue("u_time",t)},b.createGridLOD=function(e,t,r,n){return new b.GridLOD({resolution:e,levels:t,scale:r,morphingLevels:n})},b.TerrainLOD=function(e,t,r,n,i){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i),this.userData.type="TerrainLOD"},b.TerrainLOD.prototype=Object.create(THREE.Object3D.prototype),b.TerrainLOD.prototype.constructor=b.TerrainLOD,b.TerrainLOD.prototype.create=function(e,t,r,n,i){THREE.Object3D.call(this),this.name="terrainLOD",this.frustumCulled=!1;var a=0,o=1,s=2,l=4,u=8,c=new THREE.TextureLoader;this.diffuse1=c.load("images/terrain/rockyTerrainGrass.jpg"),this.diffuse2=c.load("images/terrain/rockyTerrainDirt.jpg"),this.diffuse1.wrapS=this.diffuse1.wrapT=THREE.RepeatWrapping,this.diffuse2.wrapS=this.diffuse2.wrapT=THREE.RepeatWrapping;var h=this.userData;h.landscape=void 0!==e?e:"GIANT",h.worldWidth=void 0!==t?t:1024,h.levels=void 0!==r?r:4,h.resolution=void 0!==n?n:64,h.maxHeight=void 0!==i?i:.1*b.WORLD_SIZE,h.globalOffset=new THREE.Vector3(0,0,0),this.heightMap=this.getHeightMap(h.worldWidth,h.landscape),this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,h.resolution,h.resolution),this.tileGeometry.translate(.5,.5,0);var d=h.worldWidth/Math.pow(2,h.levels);this.createTile(-d,-d,d,a),this.createTile(-d,0,d,a),this.createTile(0,0,d,a),this.createTile(0,-d,d,a);for(var f=d;f<h.worldWidth;f*=2)this.createTile(-2*f,-2*f,f,l|s),this.createTile(-2*f,-f,f,s),this.createTile(-2*f,0,f,s),this.createTile(-2*f,f,f,o|s),this.createTile(-f,-2*f,f,l),this.createTile(-f,f,f,o),this.createTile(0,-2*f,f,l),this.createTile(0,f,f,o),this.createTile(f,-2*f,f,l|u),this.createTile(f,-f,f,u),this.createTile(f,0,f,u),this.createTile(f,f,f,o|u)},b.TerrainLOD.prototype.createTile=function(e,t,r,n){var i=this.createTileMaterial(new THREE.Vector2(e,t),r,n),a=new THREE.Mesh(this.tileGeometry,i);a.rotation.x=-Math.PI/2,a.frustumCulled=!1,a.castShadow=!1,a.receiveShadow=!0,this.add(a)},b.TerrainLOD.prototype.createTileMaterial=function(e,t,r){var n=this.userData,i=b.TerrainLODShader,a=THREE.UniformsUtils.clone(i.uniforms);a.tDiffuse1.value=this.diffuse1,a.tDiffuse2.value=this.diffuse2,a.worldWidth.value=parseFloat(n.worldWidth),a.tileResolution.value=parseFloat(n.resolution),a.edgeMorph.value=r,a.globalOffset.value=n.globalOffset,a.tileOffset.value=e,a.heightMap.value=this.heightMap,a.tileScale.value=parseFloat(t),a.maxHeight.value=n.maxHeight,a.winterSnow.value=!1,a.summerGreen.value=!1;var o={};b.isWebGL2()&&(o.texture2DLod="textureLod");var s=new THREE.ShaderMaterial({defines:o,uniforms:a,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,lights:!0,fog:void 0!==b.scene.fog});return s.extensions={derivatives:!0,shaderTextureLOD:!0},s},b.TerrainLOD.prototype.getHeightMap=function(e,t){var r,n,i,a,o,s,l=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0];var n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0,s=0;s<5;s++){var l=Math.abs(t(n.x,n.y));i+=a*l/(1+(o+=l)*o*o),a*=.5,n.multiplyScalar(2).applyMatrix3(r)}return Math.pow(i,1)}}(),u=(r=new THREE.SimplexNoise,n=r.noise.bind(r),i=new THREE.Vector3(100,100,0),a=new THREE.Vector3,function(e){a.copy(e);for(var t=0,r=.5,o=0;o<5;o++)t+=r*Math.abs(n(a.x,a.y)),a.multiplyScalar(2).add(i),r*=.5;return Math.pow(.5*t+.5,2)}),c=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<2;o++)i+=a*Math.abs(t(n.x,n.y)),n.multiplyScalar(2).add(r),a*=.5;return Math.pow(i,1.5)}}(),h=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<5;o++){var s=1-Math.abs(t(n.x,n.y));i+=a*(s*s),n.multiplyScalar(2).add(r),a*=.5}return Math.pow(i,2)}}(),d=function(){var e=new THREE.Vector3;return function(t){var r=h(e.copy(t).multiplyScalar(9)),n=u(e.copy(t).multiplyScalar(2)),i=c(e.copy(t)),a=(i+=.25*i)/100;return b.mix(n,r,b.smoothstep(.45,.55,a))}}(),f=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3,n=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0],n.elements=[1.3623,1.7531,0,-1.7131,1.4623,0,0,0,0];var i=new THREE.Vector3,a=new THREE.Vector3;function o(e){i.copy(e);var n=0;return n+=.5*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.02).applyMatrix3(r),n+=.25*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.03).applyMatrix3(r),n+=.125*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.01).applyMatrix3(r),(n+=.0625*Math.abs(t(i.x,i.y)))/.9375}return function(e){i.copy(e).multiplyScalar(5),a.copy(i).multiplyScalar(.25);var t=.75*o(a)+.25;t*=2*t;for(var r=0,s=0;s<5;s++)r+=t*o(i),t=.5*-t,i.applyMatrix3(n);a.copy(i).multiplyScalar(.002);var l=o(a);return r+=Math.pow(Math.abs(l),10),Math.pow(r,2)}}(),p=function(){function e(e){return Math.abs(function(e){return e-parseInt(e)}(e)-.5)}function t(t){return e(t.x+e(1.5*(t.y-.25)))+e(t.y-e(1.5*(t.x+.5)))}function r(e){return.25+.25*Math.cos(6.2831853*e)}function n(e){return r(e.x+r(1.5*(e.y-.25)))+r(e.y-r(1.5*(e.x+.5)))}var i=new THREE.Vector3,a=new THREE.Vector3;return function(e){i.copy(e).multiplyScalar(2);var r=.66*n(a.copy(i).divideScalar(2))+.34*n(a.copy(i));return.75*(r=.75*function(e){return(e=Math.max((e-.3)/.7,0))*e*(3-2*e)}(r)+.15*t(a.copy(i))+.1*t(a.copy(i).multiplyScalar(4)))}}(),m=(o=b.createFbmNoise({octaves:4,persistence:.5,noiseType:"simplex3d"}),function(e){return Math.abs(o(e.x,e.y,1))}),v=function(){var e=new THREE.ImprovedNoise,t=new THREE.Vector3;return function(r){t.copy(r);for(var n=0,i=.5,a=0;a<4;a++)n+=i*Math.abs(e.noise(t.x,t.y,0))*2.5,t.multiplyScalar(2),i*=.5;return Math.pow(n,2)}}();e=void 0!==e?e:1024;switch(t=void 0!==t?t:"GIANT"){case"BADLAND":s=l;break;case"MOUNTAIN":s=u;break;case"DOME":s=c;break;case"RIDGE":s=h;break;case"DESIGN":s=d;break;case"GIANT":s=f;break;case"TRIANGLE":s=p;break;case"GREAT":s=m;break;case"HUGE":s=v;break;default:s=f}var g=0,y=256,_=new THREE.Vector3,E=new Uint8Array(e*e);"GIANT"===t&&(y=512);for(var w=0;w<e;w++)for(var x=0;x<e;x++)_.x=x/y,_.y=w/y,E[g++]=256*s(_);var T=new THREE.DataTexture(E,e,e,THREE.AlphaFormat);return T.wrapS=THREE.MirroredRepeatWrapping,T.wrapT=THREE.MirroredRepeatWrapping,T.magFilter=THREE.NearestFilter,T.minFilter=THREE.NearestFilter,T.generateMipmaps=!0,T.needsUpdate=!0,T},b.TerrainLOD.prototype.fromObject=function(e){var t=e.userData;this.create(t.landscape,t.worldWidth,t.levels,t.resolution,t.maxHeight)},b.TerrainLOD.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},b.TerrainLOD.prototype.clone=function(){var e=new b.TerrainLOD(this);return b.copyTransform(e,this),e},b.TerrainLOD.prototype.updateVisible=function(e){b.appWorks.setValue(this,"visible",e)},b.TerrainLOD.prototype.updateResolution=function(e){this.userData.resolution=e,this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,e,e);var t=new THREE.Matrix4;t.makeTranslation(.5,.5,0),this.tileGeometry.applyMatrix(t),this.children.forEach(t=>{t.material.uniforms.tileResolution=parseFloat(e)})},b.TerrainLOD.prototype.updateMaxHeight=function(e){this.userData.maxHeight=e,this.children.forEach(t=>{t.material.uniforms.maxHeight=e})},b.createTerrainLOD=function(e,t,r,n,i){return new b.TerrainLOD(e,t,r,n,i)},b.createHeightMapTerrain=function(e,t){var r=void 0!==t.highZoneFile?t.highZoneFile:"images/terrain/rockyTerrainGrass.jpg",n=void 0!==t.lowZoneFile?t.lowZoneFile:"images/terrain/rockyTerrainDirt.jpg",i=void 0!==t.worldWidth?t.worldWidth:1024,a=void 0!==t.resolution?t.resolution:1024,o=void 0!==t.tileOffset?t.tileOffset:new THREE.Vector2(0,0),s=void 0!==t.tileScale?t.tileScale:i,l=void 0!==t.maxHeight?t.maxHeight:.05*b.WORLD_SIZE,u=new THREE.PlaneBufferGeometry(1,1,a,a);u.translate(.5,.5,0);var c=function(t,i,a,o,s){var l=new THREE.TextureLoader,u=l.load(e);u.magFilter=THREE.LinearFilter,u.minFilter=THREE.LinearMipMapLinearFilter,u.generateMipmaps=!0,u.needsUpdate=!0;var c=l.load(r),h=l.load(n),d=b.TerrainLODShader,f=THREE.UniformsUtils.clone(d.uniforms);f.tDiffuse1.value=c,f.tDiffuse2.value=h,f.worldWidth.value=parseFloat(t),f.tileResolution.value=parseFloat(i),f.edgeMorph.value=0,f.globalOffset.value=new THREE.Vector3(0,0,0),f.tileOffset.value=a,f.heightMap.value=u,f.tileScale.value=parseFloat(o),f.maxHeight.value=s,f.winterSnow.value=!1,f.summerGreen.value=!0;var p={};b.isWebGL2()?p.texture2DLodEXT="textureLod":p.texture2DLodEXT="texture2DLod";var m=new THREE.ShaderMaterial({defines:p,uniforms:f,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,lights:!0,fog:void 0!==b.scene.fog});return m.extensions={derivatives:!0,shaderTextureLOD:!0},m}(i,a,o,s,l),h=new THREE.Mesh(u,c);return h.rotation.x=-Math.PI/2,h.position.x-=i/2,h.position.z+=i/2,h.frustumCulled=!1,h.castShadow=!1,h.receiveShadow=!0,h.name="heightMapTerrain",h},b.Config=function(e){e=e||"appWorks";var t={language:"English",theme:"css/ui.teal.css",autosave:!1,cameraFov:50,cameraNear:.01,cameraFar:1e4,cameraPosition:[0,0,50],translationSnap:5,rotationSnap:15,background:12632256,axesHelperLength:5,gridHelperSize:500,gridHelperSpacing:5,gridHelperColor:4210752,logo:"images/leaf.png"};if(void 0===window.localStorage[e])window.localStorage[e]=JSON.stringify(t);else{var r=JSON.parse(window.localStorage[e]);for(var n in r)t[n]=r[n]}var i,a=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;return{getSettings:function(e){return t[e]},setSettings:function(){for(var r=0,n=arguments.length;r<n;r+=2)t[arguments[r]]=arguments[r+1];try{window.localStorage[e]=JSON.stringify(t)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||alert("Data Storage Limits : \nThe data size for your settings is too large to be stored.")}console.log("["+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+"]","Saved settings to LocalStorage.")},clearSettings:function(){delete window.localStorage[e]},initDatabase:function(t){if(void 0!==a){var r=a.open(e,1);r.onupgradeneeded=function(e){var t=e.target.result;!1===t.objectStoreNames.contains("states")&&t.createObjectStore("states")},r.onsuccess=function(e){i=e.target.result,t()},r.onerror=function(e){console.error(">> Error: init IndexedDB...",e)}}else console.warn(">> Warning: IndexedDB not available.")},getDatabase:function(e){if(void 0!==a){var t=i.transaction(["states"],"readwrite").objectStore("states").get(0);t.onsuccess=function(t){e(t.target.result)},t.onerror=function(e){console.error(">> Error: get from IndexedDB...",e)}}else console.warn(">> Warning: IndexedDB not available.")},setDatabase:function(e,t){if(void 0!==a){var r=performance.now(),n=i.transaction(["states"],"readwrite").objectStore("states").put(e,0);n.onsuccess=function(e){var t=(performance.now()-r).toFixed(2);console.log("["+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+"]","Saved to IndexedDB ("+t+" ms)")},n.onerror=function(e){console.error(">> Error: set to IndexedDB...",e.target.error.message)}}else console.warn(">> Warning: IndexedDB not available.")},clearDatabase:function(){if(void 0!==a){if(void 0!==i){var e=i.transaction(["states"],"readwrite").objectStore("states").clear();e.onsuccess=function(e){console.log("["+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+"]","Cleared IndexedDB.")},e.onerror=function(e){console.error(">> Error: clear IndexedDB...",e)}}}else console.warn(">> Warning: IndexedDB not available.")}}},b.Command=function(e){this.id=-1,this.inMemory=!1,this.updatable=!1,this.type="",this.name="",void 0!==e&&(b.Command.appWorks=e),this.appWorks=b.Command.appWorks},b.Command.prototype.toJSON=function(){var e={};return e.type=this.type,e.id=this.id,e.name=this.name,e},b.Command.prototype.fromJSON=function(e){this.inMemory=!0,this.type=e.type,this.id=e.id,this.name=e.name},b.AddObjectCommand=function(e){b.Command.call(this),this.type="AddObjectCommand",this.object=e,void 0!==e&&(this.name="Add Object: "+e.name)},b.AddObjectCommand.prototype={execute:function(){this.appWorks.addObject(this.object),this.appWorks.select(this.object)},undo:function(){this.appWorks.removeObject(this.object),this.appWorks.deselect()},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.object=this.object.toJSON(),e},fromJSON:function(e){if(b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.object.object.uuid),void 0===this.object){var t=new THREE.ObjectLoader;this.object=t.parse(e.object)}}},b.RemoveObjectCommand=function(e){b.Command.call(this),this.type="RemoveObjectCommand",this.name="Remove Object",this.object=e,this.parent=void 0!==e?e.parent:void 0,void 0!==this.parent&&(this.index=this.parent.children.indexOf(this.object))},b.RemoveObjectCommand.prototype={execute:function(){var e=this.appWorks;this.object.traverse(function(t){e.removeHelper(t)}),this.parent.remove(this.object),this.appWorks.deselect(),this.appWorks.signals.objectRemoved.dispatch(this.object),this.appWorks.signals.sceneGraphChanged.dispatch()},undo:function(){var e=this.appWorks;this.object.traverse(function(t){e.addHelper(t)}),this.parent.children.splice(this.index,0,this.object),this.object.parent=this.parent,this.appWorks.select(this.object),this.appWorks.signals.objectAdded.dispatch(this.object),this.appWorks.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.object=this.object.toJSON(),e.index=this.index,e.parentUuid=this.parent.uuid,e},fromJSON:function(e){if(b.Command.prototype.fromJSON.call(this,e),this.parent=this.appWorks.objectByUuid(e.parentUuid),void 0===this.parent&&(this.parent=this.appWorks.scene),this.index=e.index,this.object=this.appWorks.objectByUuid(e.object.object.uuid),void 0===this.object){var t=new THREE.ObjectLoader;this.object=t.parse(e.object)}}},b.MoveObjectCommand=function(e,t,r){b.Command.call(this),this.type="MoveObjectCommand",this.name="Move Object",this.object=e,this.oldParent=void 0!==e?e.parent:void 0,this.oldIndex=void 0!==this.oldParent?this.oldParent.children.indexOf(this.object):void 0,this.newParent=t,this.newIndex=void 0!==r?void 0!==t?t.children.indexOf(r):void 0:void 0!==t?t.children.length:void 0,this.oldParent===this.newParent&&this.newIndex>this.oldIndex&&this.newIndex--,this.newBefore=r},b.MoveObjectCommand.prototype={execute:function(){this.oldParent.remove(this.object),this.newParent.children.splice(this.newIndex,0,this.object),this.object.parent=this.newParent,this.appWorks.signals.sceneGraphChanged.dispatch()},undo:function(){this.newParent.remove(this.object),this.oldParent.children.splice(this.oldIndex,0,this.object),this.object.parent=this.oldParent,this.appWorks.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.newParentUuid=this.newParent.uuid,e.oldParentUuid=this.oldParent.uuid,e.newIndex=this.newIndex,e.oldIndex=this.oldIndex,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.oldParent=this.appWorks.objectByUuid(e.oldParentUuid),void 0===this.oldParent&&(this.oldParent=this.appWorks.scene),this.newParent=this.appWorks.objectByUuid(e.newParentUuid),void 0===this.newParent&&(this.newParent=this.appWorks.scene),this.newIndex=e.newIndex,this.oldIndex=e.oldIndex}},b.SetPositionCommand=function(e,t,r){b.Command.call(this),this.type="SetPositionCommand",this.name="Set Position",this.updatable=!0,this.object=e,void 0!==e&&void 0!==t&&(this.oldPosition=e.position.clone(),this.newPosition=t.clone()),void 0!==r&&(this.oldPosition=r.clone())},b.SetPositionCommand.prototype={execute:function(){this.object.position.copy(this.newPosition),this.object.updateMatrixWorld(!0),this.appWorks.signals.objectChanged.dispatch(this.object)},undo:function(){this.object.position.copy(this.oldPosition),this.object.updateMatrixWorld(!0),this.appWorks.signals.objectChanged.dispatch(this.object)},update:function(e){this.newPosition.copy(e.newPosition)},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldPosition=this.oldPosition.toArray(),e.newPosition=this.newPosition.toArray(),e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.oldPosition=(new THREE.Vector3).fromArray(e.oldPosition),this.newPosition=(new THREE.Vector3).fromArray(e.newPosition)}},b.SetRotationCommand=function(e,t,r){b.Command.call(this),this.type="SetRotationCommand",this.name="Set Rotation",this.updatable=!0,this.object=e,void 0!==e&&void 0!==t&&(this.oldRotation=e.rotation.clone(),this.newRotation=t.clone()),void 0!==r&&(this.oldRotation=r.clone())},b.SetRotationCommand.prototype={execute:function(){this.object.rotation.copy(this.newRotation),this.object.updateMatrixWorld(!0),this.appWorks.signals.objectChanged.dispatch(this.object)},undo:function(){this.object.rotation.copy(this.oldRotation),this.object.updateMatrixWorld(!0),this.appWorks.signals.objectChanged.dispatch(this.object)},update:function(e){this.newRotation.copy(e.newRotation)},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldRotation=this.oldRotation.toArray(),e.newRotation=this.newRotation.toArray(),e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.oldRotation=(new THREE.Euler).fromArray(e.oldRotation),this.newRotation=(new THREE.Euler).fromArray(e.newRotation)}},b.SetScaleCommand=function(e,t,r){b.Command.call(this),this.type="SetScaleCommand",this.name="Set Scale",this.updatable=!0,this.object=e,void 0!==e&&void 0!==t&&(this.oldScale=e.scale.clone(),this.newScale=t.clone()),void 0!==r&&(this.oldScale=r.clone())},b.SetScaleCommand.prototype={execute:function(){this.object.scale.copy(this.newScale),this.object.updateMatrixWorld(!0),this.appWorks.signals.objectChanged.dispatch(this.object)},undo:function(){this.object.scale.copy(this.oldScale),this.object.updateMatrixWorld(!0),this.appWorks.signals.objectChanged.dispatch(this.object)},update:function(e){this.newScale.copy(e.newScale)},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldScale=this.oldScale.toArray(),e.newScale=this.newScale.toArray(),e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.oldScale=(new THREE.Vector3).fromArray(e.oldScale),this.newScale=(new THREE.Vector3).fromArray(e.newScale)}},b.SetGeometryCommand=function(e,t){b.Command.call(this),this.type="SetGeometryCommand",this.name="Set Geometry",this.updatable=!0,this.object=e,this.oldGeometry=void 0!==e?e.geometry:void 0,this.newGeometry=t},b.SetGeometryCommand.prototype={execute:function(){this.object.geometry.dispose(),this.object.geometry=this.newGeometry,this.object.geometry.computeBoundingSphere(),this.appWorks.signals.geometryChanged.dispatch(this.object),this.appWorks.signals.sceneGraphChanged.dispatch()},undo:function(){this.object.geometry.dispose(),this.object.geometry=this.oldGeometry,this.object.geometry.computeBoundingSphere(),this.appWorks.signals.geometryChanged.dispatch(this.object),this.appWorks.signals.sceneGraphChanged.dispatch()},update:function(e){this.newGeometry=e.newGeometry},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldGeometry=this.object.geometry.toJSON(),e.newGeometry=this.newGeometry.toJSON(),e},fromJSON:function(e){function t(e){return(new THREE.ObjectLoader).parseGeometries([e])[e.uuid]}b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.oldGeometry=t(e.oldGeometry),this.newGeometry=t(e.newGeometry)}},b.SetGeometryValueCommand=function(e,t,r){b.Command.call(this),this.type="SetGeometryValueCommand",this.name="Set Geometry."+t,this.object=e,this.attributeName=t,this.oldValue=void 0!==e?e.geometry[t]:void 0,this.newValue=r},b.SetGeometryValueCommand.prototype={execute:function(){this.object.geometry[this.attributeName]=this.newValue,this.appWorks.signals.objectChanged.dispatch(this.object),this.appWorks.signals.geometryChanged.dispatch(),this.appWorks.signals.sceneGraphChanged.dispatch()},undo:function(){this.object.geometry[this.attributeName]=this.oldValue,this.appWorks.signals.objectChanged.dispatch(this.object),this.appWorks.signals.geometryChanged.dispatch(),this.appWorks.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}},b.SetMaterialCommand=function(e,t,r){b.Command.call(this),this.type="SetMaterialCommand",this.name="New Material",this.object=e,this.materialSlot=r,this.oldMaterial=this.appWorks.getObjectMaterial(e,r),this.newMaterial=t},b.SetMaterialCommand.prototype={execute:function(){this.appWorks.setObjectMaterial(this.object,this.materialSlot,this.newMaterial),this.appWorks.signals.materialChanged.dispatch(this.newMaterial)},undo:function(){this.appWorks.setObjectMaterial(this.object,this.materialSlot,this.oldMaterial),this.appWorks.signals.materialChanged.dispatch(this.oldMaterial)},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldMaterial=this.oldMaterial.toJSON(),e.newMaterial=this.newMaterial.toJSON(),e},fromJSON:function(e){function t(e){var t=new THREE.ObjectLoader,r=t.parseImages(e.images),n=t.parseTextures(e.textures,r);return t.parseMaterials([e],n)[e.uuid]}b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.oldMaterial=t(e.oldMaterial),this.newMaterial=t(e.newMaterial)}},b.SetMaterialValueCommand=function(e,t,r,n){b.Command.call(this),this.type="SetMaterialValueCommand",this.name="Set Material."+t,this.updatable=!0,this.object=e,this.material=this.appWorks.getObjectMaterial(e,n),this.oldValue=void 0!==this.material?this.material[t]:void 0,this.newValue=r,this.attributeName=t},b.SetMaterialValueCommand.prototype={execute:function(){this.material[this.attributeName]=this.newValue,this.material.needsUpdate=!0,this.appWorks.signals.objectChanged.dispatch(this.object),this.appWorks.signals.materialChanged.dispatch(this.material)},undo:function(){this.material[this.attributeName]=this.oldValue,this.material.needsUpdate=!0,this.appWorks.signals.objectChanged.dispatch(this.object),this.appWorks.signals.materialChanged.dispatch(this.material)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.appWorks.objectByUuid(e.objectUuid)}},b.SetMaterialColorCommand=function(e,t,r,n){b.Command.call(this),this.type="SetMaterialColorCommand",this.name="Set Material."+t,this.updatable=!0,this.object=e,this.material=this.appWorks.getObjectMaterial(e,n),this.oldValue=void 0!==this.material?this.material[t].getHex():void 0,this.newValue=r,this.attributeName=t},b.SetMaterialColorCommand.prototype={execute:function(){this.material[this.attributeName].setHex(this.newValue),this.appWorks.signals.materialChanged.dispatch(this.material)},undo:function(){this.material[this.attributeName].setHex(this.oldValue),this.appWorks.signals.materialChanged.dispatch(this.material)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}},b.SetMaterialMapCommand=function(e,t,r,n){b.Command.call(this),this.type="SetMaterialMapCommand",this.name="Set Material."+t,this.object=e,this.material=this.appWorks.getObjectMaterial(e,n),this.oldMap=void 0!==e?this.material[t]:void 0,this.newMap=r,this.mapName=t},b.SetMaterialMapCommand.prototype={execute:function(){this.material[this.mapName]=this.newMap,this.material.needsUpdate=!0,this.appWorks.signals.materialChanged.dispatch(this.material)},undo:function(){this.material[this.mapName]=this.oldMap,this.material.needsUpdate=!0,this.appWorks.signals.materialChanged.dispatch(this.material)},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.mapName=this.mapName,e.newMap=t(this.newMap),e.oldMap=t(this.oldMap),e;function t(e){if(null==e)return null;var t={geometries:{},materials:{},textures:{},images:{}},r=e.toJSON(t),n=function(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}(t.images);return n.length>0&&(r.images=n),r.sourceFile=e.sourceFile,r}},fromJSON:function(e){function t(e){var t=null;if(null!==e){var r=new THREE.ObjectLoader,n=r.parseImages(e.images);(t=r.parseTextures([e],n)[e.uuid]).sourceFile=e.sourceFile}return t}b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.mapName=e.mapName,this.oldMap=t(e.oldMap),this.newMap=t(e.newMap)}},b.SetUuidCommand=function(e,t){b.Command.call(this),this.type="SetUuidCommand",this.name="Update UUID",this.object=e,this.oldUuid=void 0!==e?e.uuid:void 0,this.newUuid=t},b.SetUuidCommand.prototype={execute:function(){this.object.uuid=this.newUuid,this.appWorks.signals.objectChanged.dispatch(this.object),this.appWorks.signals.sceneGraphChanged.dispatch()},undo:function(){this.object.uuid=this.oldUuid,this.appWorks.signals.objectChanged.dispatch(this.object),this.appWorks.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.oldUuid=this.oldUuid,e.newUuid=this.newUuid,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.oldUuid=e.oldUuid,this.newUuid=e.newUuid,this.object=this.appWorks.objectByUuid(e.oldUuid),void 0===this.object&&(this.object=this.appWorks.objectByUuid(e.newUuid))}},b.SetValueCommand=function(e,t,r){b.Command.call(this),this.type="SetValueCommand",this.name="Set "+t,this.updatable=!0,this.object=e,this.attributeName=t,this.oldValue=void 0!==e?e[t]:void 0,this.newValue=r},b.SetValueCommand.prototype={execute:function(){this.object[this.attributeName]=this.newValue,this.appWorks.signals.objectChanged.dispatch(this.object)},undo:function(){this.object[this.attributeName]=this.oldValue,this.appWorks.signals.objectChanged.dispatch(this.object)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.appWorks.objectByUuid(e.objectUuid)}},b.SetColorCommand=function(e,t,r){b.Command.call(this),this.type="SetColorCommand",this.name="Set "+t,this.updatable=!0,this.object=e,this.attributeName=t,this.oldValue=void 0!==e?this.object[this.attributeName].getHex():void 0,this.newValue=r},b.SetColorCommand.prototype={execute:function(){this.object[this.attributeName].setHex(this.newValue),this.appWorks.signals.objectChanged.dispatch(this.object)},undo:function(){this.object[this.attributeName].setHex(this.oldValue),this.appWorks.signals.objectChanged.dispatch(this.object)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=b.Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e),this.object=this.appWorks.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}},b.SetSceneCommand=function(e){if(b.Command.call(this),this.type="SetSceneCommand",this.name="Set Scene",this.cmdArray=[],void 0!==e)for(e.background&&this.cmdArray.push(new b.SetValueCommand(this.appWorks.scene,"background",e.background.clone())),e.fog&&this.cmdArray.push(new b.SetValueCommand(this.appWorks.scene,"fog",e.fog.clone())),this.cmdArray.push(new b.SetUuidCommand(this.appWorks.scene,e.uuid)),this.cmdArray.push(new b.SetValueCommand(this.appWorks.scene,"name",e.name)),this.cmdArray.push(new b.SetValueCommand(this.appWorks.scene,"userData",JSON.parse(JSON.stringify(e.userData))));e.children.length>0;){var t=e.children.pop();"natureWorks"===b.appWorks.appName&&(t=b.cloneObject(t)),this.cmdArray.push(new b.AddObjectCommand(t))}},b.SetSceneCommand.prototype={execute:function(){this.appWorks.signals.sceneGraphChanged.active=!1;for(var e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.appWorks.signals.sceneGraphChanged.active=!0,this.appWorks.signals.sceneGraphChanged.dispatch()},undo:function(){this.appWorks.signals.sceneGraphChanged.active=!1;for(var e=this.cmdArray.length-1;e>=0;e--)this.cmdArray[e].undo();this.appWorks.signals.sceneGraphChanged.active=!0,this.appWorks.signals.sceneGraphChanged.dispatch()},toJSON:function(){for(var e=b.Command.prototype.toJSON.call(this),t=[],r=0;r<this.cmdArray.length;r++)t.push(this.cmdArray[r].toJSON());return e.cmds=t,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e);for(var t=e.cmds,r=0;r<t.length;r++){var n=new b[t[r].type];n.fromJSON(t[r]),this.cmdArray.push(n)}}},b.MultiCmdsCommand=function(e){b.Command.call(this),this.type="MultiCmdsCommand",this.name="Multiple Changes",this.cmdArray=void 0!==e?e:[]},b.MultiCmdsCommand.prototype={execute:function(){this.appWorks.signals.sceneGraphChanged.active=!1;for(var e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.appWorks.signals.sceneGraphChanged.active=!0,this.appWorks.signals.sceneGraphChanged.dispatch()},undo:function(){this.appWorks.signals.sceneGraphChanged.active=!1;for(var e=this.cmdArray.length-1;e>=0;e--)this.cmdArray[e].undo();this.appWorks.signals.sceneGraphChanged.active=!0,this.appWorks.signals.sceneGraphChanged.dispatch()},toJSON:function(){for(var e=b.Command.prototype.toJSON.call(this),t=[],r=0;r<this.cmdArray.length;r++)t.push(this.cmdArray[r].toJSON());return e.cmds=t,e},fromJSON:function(e){b.Command.prototype.fromJSON.call(this,e);for(var t=e.cmds,r=0;r<t.length;r++){var n=new b[t[r].type];n.fromJSON(t[r]),this.cmdArray.push(n)}}},b.History=function(e){this.appWorks=e,this.undos=[],this.redos=[],this.lastCmdTime=new Date,this.idCounter=0,this.historyDisabled=!1,this.config=e.config,b.Command(e);var t=this;this.appWorks.signals.startPlayer.add(function(){t.historyDisabled=!0}),this.appWorks.signals.stopPlayer.add(function(){t.historyDisabled=!1})},b.History.prototype={execute:function(e,t){var r=this.undos[this.undos.length-1],n=(new Date).getTime()-this.lastCmdTime.getTime(),i=r&&r.updatable&&e.updatable&&r.object===e.object&&r.type===e.type&&r.attributeName===e.attributeName;i&&"SetScriptValueCommand"===e.type?(r.update(e),e=r):i&&n<500?(r.update(e),e=r):(this.undos.push(e),e.id=++this.idCounter),e.name=void 0!==t?t:e.name,e.execute(),e.inMemory=!0,this.config.getSettings("history")&&(e.json=e.toJSON()),this.lastCmdTime=new Date,this.redos=[],this.appWorks.signals.historyChanged.dispatch(e)},undo:function(){if(!this.historyDisabled){var e=void 0;return this.undos.length>0&&!1===(e=this.undos.pop()).inMemory&&e.fromJSON(e.json),void 0!==e&&(e.undo(),this.redos.push(e),this.appWorks.signals.historyChanged.dispatch(e)),e}alert("Undo/Redo disabled while the scene is playing.")},redo:function(){if(!this.historyDisabled){var e=void 0;return this.redos.length>0&&!1===(e=this.redos.pop()).inMemory&&e.fromJSON(e.json),void 0!==e&&(e.execute(),this.undos.push(e),this.appWorks.signals.historyChanged.dispatch(e)),e}alert("Undo/Redo disabled while the scene is playing.")},toJSON:function(){var e={undos:[],redos:[]};if(!this.config.getSettings("history"))return e;for(var t=0;t<this.undos.length;t++)this.undos[t].hasOwnProperty("json")&&e.undos.push(this.undos[t].json);for(t=0;t<this.redos.length;t++)this.redos[t].hasOwnProperty("json")&&e.redos.push(this.redos[t].json);return e},fromJSON:function(e){if(void 0!==e){for(var t=0;t<e.undos.length;t++){var r=e.undos[t];(n=new b[r.type]).json=r,n.id=r.id,n.name=r.name,this.undos.push(n),this.idCounter=r.id>this.idCounter?r.id:this.idCounter}for(t=0;t<e.redos.length;t++){var n;r=e.redos[t];(n=new b[r.type]).json=r,n.id=r.id,n.name=r.name,this.redos.push(n),this.idCounter=r.id>this.idCounter?r.id:this.idCounter}this.appWorks.signals.historyChanged.dispatch(this.undos[this.undos.length-1])}},clear:function(){this.undos=[],this.redos=[],this.idCounter=0,this.appWorks.signals.historyChanged.dispatch()},goToState:function(e){if(this.historyDisabled)alert("Undo/Redo disabled while the scene is playing.");else{this.appWorks.signals.sceneGraphChanged.active=!1,this.appWorks.signals.historyChanged.active=!1;var t=this.undos.length>0?this.undos[this.undos.length-1]:void 0;if(void 0===t||e>t.id)for(t=this.redo();void 0!==t&&e>t.id;)t=this.redo();else for(;void 0!==(t=this.undos[this.undos.length-1])&&e!==t.id;)this.undo();this.appWorks.signals.sceneGraphChanged.active=!0,this.appWorks.signals.historyChanged.active=!0,this.appWorks.signals.sceneGraphChanged.dispatch(),this.appWorks.signals.historyChanged.dispatch(t)}},enableSerialization:function(e){this.goToState(-1),this.appWorks.signals.sceneGraphChanged.active=!1,this.appWorks.signals.historyChanged.active=!1;for(var t=this.redo();void 0!==t;)t.hasOwnProperty("json")||(t.json=t.toJSON()),t=this.redo();this.appWorks.signals.sceneGraphChanged.active=!0,this.appWorks.signals.historyChanged.active=!0,this.goToState(e)}};var R=r(37),A=r(19),k=r(38);b.ViewWorks=function(e){var t=this;e=e||{};if(this.appName=e.appName||"viewWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=b.tabIndices[this.dom.id],this.dom.style.position="absolute",this.dom.style.left="0px",this.dom.style.width="100%",this.dom.style.height="100%",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight,b.isWebGL2Available()){var r=document.createElement("canvas"),n=r.getContext("webgl2");this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:r,context:n,alpha:!0,powerPreference:"high-performance"})}else this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance"});this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName;var i=(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg");this.scene.background=b.createBackground(i);var a=e.cameraFov||50,o=e.cameraNear||.01,s=e.cameraFar||1e4,l=e.cameraPosition||[0,0,50];function u(){requestAnimationFrame(u),function(){var e=b.getDeltaTime(),r=b.getCurrentTime();t.animation.update(e),t.scene.traverse(function(t){t.update&&t.update(e,r)});var n=t.controls;!n.enabled||!0!==n.autoRotate&&!0!==n.enableDamping||n.update()}(),t.renderer.render(t.scene,t.camera)}function c(e){switch(e.stopPropagation(),e.keyCode){case 8:e.preventDefault();case 27:t.controls.enabled=!0;break;case 49:b.nextShowroom(t.showroom,"background");break;case 50:b.nextShowroom(t.showroom,"floor");break;case 79:if(t.animation&&t.selectObject){var r=t.selectObject.activeAction;r.paused=!r.paused}break;case 80:t.animation&&t.selectObject&&t.playNextAction(t.selectObject)}}this.camera=new THREE.PerspectiveCamera(a,this.width/this.height,o,s),this.camera.position.set(l[0],l[1],l[2]),this.camera.lookAt(this.scene.position),this.camera.name="camera",this.controls=b.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new b.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},this.selectObject=null,this.fileExplorer=new b.FileExplorer(this),window.addEventListener("resize",function(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.width=t.widthRatio*e,t.height=t.heightRatio*r,t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.renderer.setSize(t.width,t.height)},!1),this.dom.addEventListener("click",function(e){t.dom.focus()},!1),this.dom.addEventListener("keydown",c,!1),this.renderScene=function(){u()},this.onKeyDown=function(e){c(e)},b.renderer=this.renderer,b.scene=this.scene,b.camera=this.camera,b.appWorks=this,function(){var e=document.createElement("div");e.id="infobutton",e.innerHTML='            <img src="images/info.png" border="0" />\n        ',e.style.cssText="            text-align: left;\n            margin: 0 0 0 0;\n            z-index: 13;\n            position: absolute;\n            display: block;\n            padding: 8px;\n        ",e.addEventListener("click",function(e){var t=document.getElementById("infoPanel").style;t.display="block"==t.display?"none":"block"}),document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.createElement("div");t.id="infoPanel",t.innerHTML='            <b>ViewWorks - 3D model viewer</b>\n            <p>\n            To upload your model,<br>\n            <b>drag and drop your file or folder onto this ViewWorks.</b><br><br>\n            Supported file formats<br>\n            JSON, OBJ(+MTL), STL, PLY, DAE(COLLADA), GLTF, GLB, AMF, 3MF, WRL(VRML), FBX<br>\n            </p>\n            (C) <a href="https://www.nova-graphix.com/" target="_blank" style="color: #ffa500; text-decoration: none;">NovaGraphix, Co.</a>, 2018.\n        ',t.style.cssText="            text-align: left;\n            font-size: 80%;\n            margin: 0.5em 0em 0em 0.4em;\n            z-index: 12;\n            position: absolute;\n            display: none;\n            color: #fff;\n            background: #121212;\n            opacity: 0.8;\n            border-radius: 20px;\n            padding: 32px;\n        ",document.getElementById("novaGraphix").parentNode.appendChild(t)}()},b.GameWorks=function(e){var t=this;e=e||{};if(this.appName=e.appName||"gameWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=b.tabIndices[this.dom.id],this.dom.style.position="absolute",this.dom.style.left="0px",this.dom.style.width="100%",this.dom.style.height="100%",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight,b.isWebGL2Available()){var r=document.createElement("canvas"),n=r.getContext("webgl2");this.renderer=new THREE.WebGLRenderer({canvas:r,context:n,alpha:!0,powerPreference:"high-performance"})}else this.renderer=new THREE.WebGLRenderer({alpha:!0,powerPreference:"high-performance"});this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName,this.scene.background=new THREE.Color(12632256);var i,a,o=e.cameraFov||50,s=e.cameraNear||.01,l=e.cameraFar||1e4,u=e.cameraPosition||[0,0,50];function c(){requestAnimationFrame(c),function(){var e=b.getDeltaTime(),r=b.getCurrentTime();t.stats&&t.stats.update();t.animation.update(e),t.scene.traverse(function(t){t.update&&t.update(e,r)}),t.sceneHUD.traverse(function(t){t.update&&t.update(e,r)});var n=t.controls;n.enabled&&(n instanceof THREE.OrbitControls?!0!==n.autoRotate&&!0!==n.enableDamping||n.update():n.update(e))}(),h()}function h(){if(t.effect)t.effect.render(t.scene,t.camera);else{if(void 0!==t.underWaterPass&&t.underWaterPass.enabled)for(var e=0;e<4;e++)t.underWaterPass.values[e].uniforms.time.value+=Math.random();t.composer.render()}}function d(e){var r=t.dom.getBoundingClientRect(),n=b.getMouseScreenCoords(e);return n.x=(n.x-r.left)/r.width*2-1,n.y=-(n.y-r.top)/r.height*2+1,n}function f(e,r){return t.raycaster.setFromCamera(e,t.camera),t.raycaster.intersectObjects(r,!0)}function p(){var e=t.getIntersectObject(t.xinfo);e&&("picker"===e.name?t.select(e.userData.object):event.ctrlKey?t.select(e,"multiple"):event.altKey?t.select(e,"ancestor"):t.select(e),h())}function m(e){t.mouseUpPosition.copy(d(e)),p(),document.removeEventListener("mouseup",m,!1)}function v(e){e.preventDefault(),i&&(clearTimeout(i),a=!1),t.mouseUpPosition.copy(d(e)),p(),document.removeEventListener("touchend",v,!1)}function g(e){t.mouseUpPosition.copy(t.mouseDownPosition),onContextMenu(e)}this.camera=new THREE.PerspectiveCamera(o,this.width/this.height,s,l),this.camera.position.set(u[0],u[1],u[2]),this.camera.lookAt(this.scene.position),this.camera.name="camera",this.controls=b.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new b.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},b.isDeviceMobile()||(this.stats=new A,this.stats.dom.style.cssText="position:absolute; bottom:0px; right:0px",this.dom.appendChild(this.stats.dom)),this.raycaster=new THREE.Raycaster,this.selectObject=null,this.selectObjects=[],this.selectables=[],this.mouseMovePosition=new THREE.Vector2,this.mouseDownPosition=new THREE.Vector2,this.mouseUpPosition=new THREE.Vector2,this.mouseDoubleClickPosition=new THREE.Vector2,this.playAudio=function(e){this.sound&&this.sound.unload(),this.sound=b.playAudio(e,this.camera)},this.playAudio(e.audioFiles),this.sceneHUD=new THREE.Scene,this.cameraHUD=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,100.1),this.cameraHUD.position.z=50.1,function(e){var e=e||{};t.composer=new THREE.EffectComposer(t.renderer),t.composer.setSize(t.width,t.height),t.renderPass=new THREE.RenderPass(t.scene,t.camera),t.renderPass.clear=!0,t.renderPass.clearDepth=!1,t.composer.addPass(t.renderPass),t.renderPass3=new THREE.RenderPass(t.sceneHUD,t.cameraHUD),t.renderPass3.clear=!1,t.renderPass3.clearDepth=!1,t.composer.addPass(t.renderPass3),t.bleachShader=new THREE.ShaderPass(THREE.BleachBypassShader),t.composer.addPass(t.bleachShader),t.bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(t.width,t.height),2.5,.45,.88),t.composer.addPass(t.bloomPass),t.dotScreenShader=new THREE.ShaderPass(THREE.DotScreenShader),t.dotScreenShader.uniforms.scale.value=4,t.composer.addPass(t.dotScreenShader),t.glitchPass=new THREE.GlitchPass(0),t.composer.addPass(t.glitchPass),t.sepiaShader=new THREE.ShaderPass(THREE.SepiaShader),t.composer.addPass(t.sepiaShader),t.outlinePass=new THREE.OutlinePass(new THREE.Vector2(t.width,t.height),t.scene,t.camera),t.composer.addPass(t.outlinePass),(new THREE.TextureLoader).load("images/tri_pattern.jpg",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t.outlinePass.patternTexture=e}),e.FXAAEnabled=!0,t.FXAAShader=new THREE.ShaderPass(THREE.FXAAShader),t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height),t.composer.addPass(t.FXAAShader),t.ssaoPass=new THREE.SSAOPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.ssaoPass),t.godRaysPass=new b.GodRaysPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.godRaysPass),t.bokehPass=new THREE.BokehPass(t.scene,t.camera,{width:t.width,height:t.height,vignetting:1}),t.composer.addPass(t.bokehPass),t.vignetteShader=new THREE.ShaderPass(THREE.VignetteShader),t.composer.addPass(t.vignetteShader),t.copyShader=new THREE.ShaderPass(THREE.CopyShader),t.copyShader.renderToScreen=!0,t.composer.addPass(t.copyShader),t.bleachShader.enabled=e.bleachEnabled||!1,t.bloomPass.enabled=e.bloomEnabled||!1,t.dotScreenShader.enabled=e.dotScreenEnabled||!1,t.glitchPass.enabled=e.glitchEnabled||!1,t.sepiaShader.enabled=e.sepiaEnabled||!1,t.outlinePass.enabled=e.outlineEnabled||!1,t.FXAAShader.enabled=e.FXAAEnabled||!1,t.ssaoPass.enabled=e.ssaoEnabled||!1,t.godRaysPass.enabled=e.godRaysEnabled||!1,t.bokehPass.enabled=e.bokehEnabled||!1,t.vignetteShader.enabled=e.vignetteEnabled||!1}(e),this.cameraEffect=function(e){void 0!==this.effect&&this.effect instanceof THREE.AnaglyphEffect&&this.effect.dispose(),this.effect=b.createCameraEffect(e,this.renderer),this.effect&&this.effect.setSize(this.width,this.height)},this.cameraEffect(e.effectType),window.addEventListener("orientationchange",function(){[t.widthRatio,t.heightRatio]=[t.heightRatio,t.widthRatio]},!1),window.addEventListener("resize",function(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.width=t.widthRatio*e,t.height=t.heightRatio*r,t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),function(){if(t.sceneHUD&&t.cameraHUD){var e=t.cameraHUD,r=e.right,n=e.top,i=t.width/2,a=t.height/2;e.left=-i,e.right=i,e.top=a,e.bottom=-a,e.updateProjectionMatrix(),t.sceneHUD.children.forEach(e=>{var t=e.position;t.x*=1+(i-r)/Math.abs(t.x),t.y*=1+(a-n)/Math.abs(t.y)})}}(),t.FXAAShader.enabled&&t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height);t.renderer.setSize(t.width,t.height),t.composer.setSize(t.width,t.height),t.effect&&t.effect.setSize(t.width,t.height);t.scene.getObjectsByType("FireParticles").forEach(function(e){e.setNearPlaneHeight()})},!1),this.dom.addEventListener("click",function(e){t.dom.focus()},!1),this.dom.addEventListener("dblclick",function(e){t.mouseDoubleClickPosition.copy(d(e));var r=t.getIntersectObject("mouseDoubleClick");r&&t.focus(r)},!1),this.dom.addEventListener("mousemove",function(e){t.mouseMovePosition.copy(d(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!1),this.dom.addEventListener("mousedown",function(e){t.mouseDownPosition.copy(d(e)),document.addEventListener("mouseup",m,!1)},!1),this.dom.addEventListener("touchmove",function(e){e.preventDefault(),i&&clearTimeout(i);t.mouseMovePosition.copy(d(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!0),this.dom.addEventListener("touchstart",function(e){t.guiContextMenu&&t.guiContextMenu.setDisplay("none");if(e.preventDefault(),a)return;i=setTimeout(g,500,e),a=!0,t.mouseDownPosition.copy(d(e)),document.addEventListener("touchend",v,!1)},!1),this.dom.addEventListener("keydown",function(e){switch(e.keyCode){case 66:b.demoApplication();break;case 191:b.gamePlay()}},!1),this.dom.addEventListener("keyup",function(e){},!1),this.renderScene=function(){c()},this.getIntersectObject=function(e){if("string"==typeof e){var t;if("mouseDown"===e)t=this.mouseDownPosition;else if("mouseUp"===e)t=this.mouseUpPosition;else{if("mouseDoubleClick"!==e)return null;t=this.mouseDoubleClickPosition}return(r=f(t,this.selectables)).length>0?r[0].object:null}var r;return this.mouseDownPosition.equals(this.mouseUpPosition)&&(r=f(this.mouseUpPosition,this.selectables)).length>0?(void 0!==e&&(e.object=r[0].object,e.distance=r[0].distance,e.point=r[0].point,e.uv=r[0].uv),r[0].object):null},b.renderer=this.renderer,b.scene=this.scene,b.camera=this.camera,b.appWorks=this},b.DesignWorks=function(e){var t=this;e=e||{};this.appName=e.appName||"designWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=b.tabIndices[this.dom.id],this.dom.style.position="absolute",this.dom.style.left="0px",this.dom.style.width="100%",this.dom.style.height="100%",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight;var r,n=R.Signal;this.signals={startPlayer:new n,stopPlayer:new n,appWorksCleared:new n,autoSaveStarted:new n,autoSaveFinished:new n,themeChanged:new n,transformModeChanged:new n,snapChanged:new n,spaceChanged:new n,sceneBackgroundChanged:new n,sceneFogChanged:new n,sceneGraphChanged:new n,cameraChanged:new n,geometryChanged:new n,objectSelected:new n,objectFocused:new n,objectsSelected:new n,objectAdded:new n,objectChanged:new n,objectRemoved:new n,helperAdded:new n,helperChanged:new n,helperRemoved:new n,materialChanged:new n,windowResize:new n,axesHelperChanged:new n,gridHelperChanged:new n,refreshSidebarObject3D:new n,historyChanged:new n},(r=t.signals).startPlayer.add(function(){t.history.historyDisabled=!0}),r.stopPlayer.add(function(){t.history.historyDisabled=!1}),r.themeChanged.add(function(){}),r.sceneBackgroundChanged.add(function(e){t.config.setSettings("background",e)}),r.sceneFogChanged.add(function(e){t.createSceneFog(e),E()}),r.axesHelperChanged.add(function(e){b.dispose(t.axesHelper),t.axesHelper=g(e),t.sceneHelpers.add(t.axesHelper),E()}),r.gridHelperChanged.add(function(e,r,n){b.dispose(t.gridHelper),t.gridHelper=y(e,r,n),t.sceneHelpers.add(t.gridHelper),E()}),r.geometryChanged.add(function(e){E()}),r.materialChanged.add(function(e){E()}),r.objectAdded.add(function(e){var r=t.selectables;e.traverse(function(e){r.push(e)})}),r.objectRemoved.add(function(e){e===t.transformControls.object&&t.transformControls.detach();var r=t.selectables;e.traverse(function(e){r.splice(r.indexOf(e),1)})}),r.objectChanged.add(function(e){e instanceof THREE.PerspectiveCamera&&e.updateProjectionMatrix(),!e.helper||e.helper instanceof THREE.SkeletonHelper||(e.helper.update(),r.helperChanged.dispatch(e.helper)),E()}),r.objectsSelected.add(function(e){if(Array.isArray(e)){if(1===e.length){var r=e[0];if(null===r.parent)return;var n=t.transformControls.enabled;t.transformControls.detach(),t.transformControls.attach(r),t.transformControls.visible=n,t.transformControls.enabled=n}if(t.outlinePass.enabled){var i=t.outlinePass;i.selectedObjects=[],e.forEach(function(e){e.traverse(function(e){0===e.children.length&&i.selectedObjects.push(e)})})}}}),r.objectFocused.add(function(e){var r=new THREE.Vector3;e&&r.copy(e.position),t.controls instanceof THREE.OrbitControls||t.controls instanceof THREE.TrackballControls?(t.controls.target.copy(r),t.controls.update()):t.controls instanceof THREE.FirstPersonControls&&(t.controls.lookAt(r),t.controls.update(b.getDeltaTime()))}),r.helperAdded.add(function(e){var r=e.getObjectByName("picker");t.selectables.push(r)}),r.helperChanged.add(function(e){var t=e.light;t&&(e.visible=t.visible)}),r.helperRemoved.add(function(e){var r=t.selectables,n=e.getObjectByName("picker");r.splice(r.indexOf(n),1)}),r.cameraChanged.add(function(e){e&&(t.config.setSettings("cameraFov",e.fov),t.config.setSettings("cameraNear",e.near),t.config.setSettings("cameraFar",e.far)),E()}),r.historyChanged.add(function(){var e=t.history;e.undos.length,e.redos.length}),r.appWorksCleared.add(function(){t.select(null),t.focus(),E()}),r.autoSaveStarted.add(function(){}),r.autoSaveFinished.add(function(){}),r.transformModeChanged.add(function(e){t.transformControls.setMode(e)}),r.snapChanged.add(function(e){t.transformControls.setTranslationSnap(e)}),r.spaceChanged.add(function(e){t.transformControls.setSpace(e)}),r.windowResize.add(function(){w(),E()}),this.config=new b.Config(this.appName),this.config.initDatabase(function(){var e;function r(){!1!==t.config.getSettings("autosave")&&(clearTimeout(e),e=setTimeout(function(){t.signals.autoSaveStarted.dispatch(),e=setTimeout(function(){t.config.setDatabase(t.toJSON()),t.signals.autoSaveFinished.dispatch()},100)},1e3))}t.config.getDatabase(function(e){void 0!==e&&t.fromJSON(e)});var n=t.signals;n.geometryChanged.add(r),n.materialChanged.add(r),n.objectAdded.add(r),n.objectChanged.add(r),n.objectRemoved.add(r),n.sceneBackgroundChanged.add(r),n.sceneFogChanged.add(r),n.sceneGraphChanged.add(r),n.historyChanged.add(r)}),this.history=new b.History(this),this.renderer=new THREE.WebGLRenderer({alpha:!0,powerPreference:"high-performance"}),this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName,this.createSceneFog=function(e){this.scene.fog=b.createFog(e)},this.createSceneFog(e.fog),this.createSceneBackground=function(e){e=void 0!==e?e:this.config.getSettings("background");this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.background=b.createBackground(e)},this.createSceneBackground(e.background);var i,a,o,s,l,u,c,h,d,f=e.cameraFov||this.config.getSettings("cameraFov"),p=e.cameraNear||this.config.getSettings("cameraNear"),m=e.cameraFar||this.config.getSettings("cameraFar"),v=e.cameraPosition||this.config.getSettings("cameraPosition");function g(e){e=e||t.config.getSettings("axesHelperLength");var r=new THREE.Vector3(0,0,0),n=new THREE.Vector3(1,0,0),i=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),o=new THREE.ArrowHelper(n,r,e,16711680);o.name="xaxis";var s=new THREE.ArrowHelper(i,r,e,65280);s.name="yaxis";var l=new THREE.ArrowHelper(a,r,e,255);l.name="zaxis";var u=new THREE.Object3D;return u.add(o),u.add(s),u.add(l),u.name="axesHelper",u}function y(e,r,n){e=e||t.config.getSettings("gridHelperSize"),r=r||t.config.getSettings("gridHelperSpacing"),n=n||t.config.getSettings("gridHelperColor");e=~~(e/r),e*=r;var i=new THREE.GridHelper(e,e/r,16729156,n);i.position.y=0,i.name="gridHelper";for(var a=.05*r,o=e/2,s=[],l=-o;l<=o;l+=r)s.push(l.toFixed(2));return s.forEach(function(e){var t=b.createTextSprite(e,{textHeight:a,fontWeight:"bold"}),r=t.clone();t.position.set(parseFloat(e),a/2,0),r.position.set(0,a/2,parseFloat(e)),i.add(t),i.add(r)}),i}function _(){requestAnimationFrame(_),function(){var e=b.getDeltaTime(),r=b.getCurrentTime();t.stats&&t.stats.update();t.animation.update(e),t.scene.traverse(function(t){t.update&&t.update(e,r)}),t.sceneHUD.traverse(function(t){t.update&&t.update(e,r)});var n=t.controls;n.enabled&&(n instanceof THREE.OrbitControls?!0!==n.autoRotate&&!0!==n.enableDamping||n.update():n instanceof THREE.TrackballControls?n.update():t.controls instanceof THREE.FirstPersonControls&&n.update(e))}(),E()}function E(){if(t.effect)t.effect.render(t.scene,t.camera);else{if(void 0!==t.underWaterPass&&t.underWaterPass.enabled)for(var e=0;e<4;e++)t.underWaterPass.values[e].uniforms.time.value+=Math.random();t.composer&&t.composer.render()}}function w(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.width=t.widthRatio*e,t.height=t.heightRatio*r,t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),function(){if(!t.sceneHUD||!t.cameraHUD)return;var e=t.cameraHUD,r=e.right,n=e.top,i=t.width/2,a=t.height/2;e.left=-i,e.right=i,e.top=a,e.bottom=-a,e.updateProjectionMatrix(),t.sceneHUD.children.forEach(e=>{var t=e.position;t.x*=1+(i-r)/Math.abs(t.x),t.y*=1+(a-n)/Math.abs(t.y)})}(),t.FXAAShader.enabled&&t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height),t.renderer.setSize(t.width,t.height),t.composer&&t.composer.setSize(t.width,t.height),t.effect&&t.effect.setSize(t.width,t.height),t.controls.enabled&&(t.controls instanceof THREE.OrbitControls||t.controls.handleResize()),t.scene.getObjectsByType("FireParticles").forEach(function(e){e.setNearPlaneHeight()})}function x(e){var r=t.dom.getBoundingClientRect(),n=b.getMouseScreenCoords(e);return n.x=(n.x-r.left)/r.width*2-1,n.y=-(n.y-r.top)/r.height*2+1,n}function T(e,r){return t.raycaster.setFromCamera(e,t.camera),t.raycaster.intersectObjects(r,!0)}function S(){var e=t.getIntersectObject(t.xinfo);e&&("picker"===e.name?t.select(e.userData.object):event.ctrlKey?t.select(e,"multiple"):event.altKey?t.select(e,"ancestor"):t.select(e),E())}function M(e){t.mouseUpPosition.copy(x(e)),S(),document.removeEventListener("mouseup",M,!1)}function k(e){e.preventDefault(),h&&(clearTimeout(h),d=!1),t.mouseUpPosition.copy(x(e)),S(),document.removeEventListener("touchend",k,!1)}function P(e){t.mouseUpPosition.copy(t.mouseDownPosition),C(e)}function C(e){t.guiContextMenu&&(t.getIntersectObject()&&t.guiContextMenu.toggle(e))}function L(e){"medicalWorks"===t.appName&&b.MedicalKeyboard(e),e.preventDefault(),e.stopPropagation();var r=b.isCtrlKeyDown(e);if(r&&90===e.keyCode)t.undo();else if(r&&89===e.keyCode)t.redo();else switch(e.keyCode){case 8:e.preventDefault();case 46:var n=t.selectObject;n&&n.parent&&t.remove(n);break;case 18:break;case 27:t.controls.enabled=!0;break;case 49:b.filmGrainBackground();break;case 50:break;case 66:b.demoApplication();break;case 67:t.controls instanceof THREE.OrbitControls?t.controls=b.createCameraControls("FirstPersonControls"):t.controls instanceof THREE.FirstPersonControls&&(t.controls=b.createCameraControls("OrbitControls"));break;case 70:b.demoLoadFiles();break;case 72:b.add(b.createHemisphereLight());break;case 73:b.cameraAutoView({isWorking:!0})?b.cameraAutoView({viewMode:"stop"}):b.cameraAutoView({viewMode:"circle"});break;case 76:b.toggleLightHelpers();break;case 77:void 0!==t.sound&&(t.sound.playing()?t.sound.pause():t.sound.play());break;case 78:b.add(b.createSky()),b.add(b.createSunLight());break;case 79:if(t.animation&&t.selectObject){var i=t.selectObject.activeAction;i.paused=!i.paused}break;case 80:t.animation&&t.selectObject&&t.playNextAction(t.selectObject);break;case 86:b.demoRaymarchToPoints();break;case 112:t.appGUI&&t.appGUI.toggle(t.guiSceneGraph.dom);break;case 113:t.appGUI&&t.appGUI.toggle();break;case 114:t.dragControls.enabled=!t.dragControls.enabled;break;case 115:t.transformControls.visible=!t.transformControls.visible,t.transformControls.enabled=!t.transformControls.enabled;break;case 116:t.guiSidebar&&t.guiSidebar.select(t.guiStrings.getKey("menubar/edit/scene"),"inclusive");break;case 117:b.screenCapture();break;case 118:break;case 119:t.selectObject&&t.focus(t.selectObject);break;case 120:t.config.clearSettings(),console.log('>> clear the "window.localStorage"...');break;case 121:t.config.clearDatabase(),console.log('>> clear the "window.indexedDB"...');break;case 191:b.gamePlay();break;case 81:t.transformControls.setSpace("local"===t.transformControls.space?"world":"local");break;case 17:t.transformControls.setTranslationSnap(t.config.getSettings("translationSnap")),t.transformControls.setRotationSnap(THREE.Math.degToRad(t.config.getSettings("rotationSnap")));break;case 87:t.transformControls.setMode("translate");break;case 69:t.transformControls.setMode("rotate");break;case 82:t.transformControls.setMode("scale");break;case 187:case 107:t.transformControls.setSize(t.transformControls.size+.1);break;case 189:case 109:t.transformControls.setSize(Math.max(t.transformControls.size-.1,.1));break;case 88:t.transformControls.showX=!t.transformControls.showX;break;case 89:t.transformControls.showY=!t.transformControls.showY;break;case 90:t.transformControls.showZ=!t.transformControls.showZ;break;case 32:t.transformControls.visible=!t.transformControls.visible,t.transformControls.enabled=!t.transformControls.enabled}}this.defaultCamera=new THREE.PerspectiveCamera(f,this.width/this.height,p,m),this.defaultCamera.position.set(v[0],v[1],v[2]),this.defaultCamera.lookAt(this.scene.position),this.defaultCamera.name="camera",this.camera=this.defaultCamera.clone(),this.controls=b.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new b.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},b.isDeviceMobile()||(this.stats=new A,this.stats.dom.style.cssText="position:absolute; bottom:0px; right:0px",this.dom.appendChild(this.stats.dom)),this.raycaster=new THREE.Raycaster,this.selectObject=null,this.selectObjects=[],this.selectables=[],this.mouseMovePosition=new THREE.Vector2,this.mouseDownPosition=new THREE.Vector2,this.mouseUpPosition=new THREE.Vector2,this.mouseDoubleClickPosition=new THREE.Vector2,this.playAudio=function(e){this.sound&&this.sound.unload(),this.sound=b.playAudio(e)},this.playAudio(e.audioFiles),this.sceneHelpers=new THREE.Scene,this.axesHelper=g(),this.axesHelper.visible=e.axesVisible||!1,this.sceneHelpers.add(this.axesHelper),this.gridHelper=y(),this.gridHelper.visible=e.gridVisible||!1,this.sceneHelpers.add(this.gridHelper),this.sceneHUD=new THREE.Scene,this.cameraHUD=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,100.1),this.cameraHUD.position.z=50.1,function(e){var e=e||{};t.composer=new THREE.EffectComposer(t.renderer),t.composer.setSize(t.width,t.height),t.renderPass=new THREE.RenderPass(t.scene,t.camera),t.renderPass.clear=!0,t.renderPass.clearDepth=!1,t.composer.addPass(t.renderPass),t.sceneHelpers.children.length>0&&(t.renderPass2=new THREE.RenderPass(t.sceneHelpers,t.camera),t.renderPass2.clear=!1,t.renderPass2.clearDepth=!1,t.composer.addPass(t.renderPass2));t.renderPass3=new THREE.RenderPass(t.sceneHUD,t.cameraHUD),t.renderPass3.clear=!1,t.renderPass3.clearDepth=!1,t.composer.addPass(t.renderPass3),t.bleachShader=new THREE.ShaderPass(THREE.BleachBypassShader),t.composer.addPass(t.bleachShader),t.bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(t.width,t.height),2.5,.45,.88),t.composer.addPass(t.bloomPass),t.dotScreenShader=new THREE.ShaderPass(THREE.DotScreenShader),t.dotScreenShader.uniforms.scale.value=4,t.composer.addPass(t.dotScreenShader),t.glitchPass=new THREE.GlitchPass(0),t.composer.addPass(t.glitchPass),t.sepiaShader=new THREE.ShaderPass(THREE.SepiaShader),t.composer.addPass(t.sepiaShader),t.outlinePass=new THREE.OutlinePass(new THREE.Vector2(t.width,t.height),t.scene,t.camera),t.composer.addPass(t.outlinePass),(new THREE.TextureLoader).load("images/tri_pattern.jpg",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t.outlinePass.patternTexture=e}),e.FXAAEnabled=!0,t.FXAAShader=new THREE.ShaderPass(THREE.FXAAShader),t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height),t.composer.addPass(t.FXAAShader),t.ssaoPass=new THREE.SSAOPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.ssaoPass),t.godRaysPass=new b.GodRaysPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.godRaysPass),t.bokehPass=new THREE.BokehPass(t.scene,t.camera,{width:t.width,height:t.height,vignetting:1}),t.composer.addPass(t.bokehPass),t.vignetteShader=new THREE.ShaderPass(THREE.VignetteShader),t.composer.addPass(t.vignetteShader),t.copyShader=new THREE.ShaderPass(THREE.CopyShader),t.copyShader.renderToScreen=!0,t.composer.addPass(t.copyShader),t.bleachShader.enabled=e.bleachEnabled||!1,t.bloomPass.enabled=e.bloomEnabled||!1,t.dotScreenShader.enabled=e.dotScreenEnabled||!1,t.glitchPass.enabled=e.glitchEnabled||!1,t.sepiaShader.enabled=e.sepiaEnabled||!1,t.outlinePass.enabled=e.outlineEnabled||!1,t.FXAAShader.enabled=e.FXAAEnabled||!1,t.ssaoPass.enabled=e.ssaoEnabled||!1,t.godRaysPass.enabled=e.godRaysEnabled||!1,t.bokehPass.enabled=e.bokehEnabled||!1,t.vignetteShader.enabled=e.vignetteEnabled||!1}(e),this.cameraEffect=function(e){void 0!==this.effect&&this.effect instanceof THREE.AnaglyphEffect&&this.effect.dispose(),this.effect=b.createCameraEffect(e,this.renderer),this.effect&&this.effect.setSize(this.width,this.height)},this.cameraEffect(e.effectType),this.fileExplorer=new b.FileExplorer(this),this.dragControls=(i=this.scene.children,a=this.camera,o=this.renderer,s=null,(l=new THREE.DragControls(i,a,o.domElement)).enabled=!1,l.addEventListener("dragstart",function(e){if(this.enabled){var r=e.object;s=r.position.clone(),t.controls.enabled=!1,t.select(r)}}),l.addEventListener("dragend",function(e){if(this.enabled){var r=e.object;void 0!==r&&(s.equals(r.position)||t.setPosition(r,r.position,s)),t.controls.enabled=!0}}),l),this.transformControls=function(e,r){var n=null,i=null,a=null,o=new THREE.TransformControls(e,r.domElement);return o.visible=!0,o.enabled=!0,o.addEventListener("change",function(){var e=o.object;e&&e.helper&&!e.helper instanceof THREE.SkeletonHelper&&e.helper.update()}),o.addEventListener("mouseDown",function(){var e=o.object;n=e.position.clone(),i=e.rotation.clone(),a=e.scale.clone(),t.controls.enabled=!1}),o.addEventListener("mouseUp",function(){var e=o.object;if(void 0!==e)switch(o.getMode()){case"translate":n.equals(e.position)||t.setPosition(e,e.position,n);break;case"rotate":i.equals(e.rotation)||t.setRotation(e,e.rotation,i);break;case"scale":a.equals(e.scale)||t.setScale(e,e.scale,a)}t.controls.enabled=!0}),o}(this.camera,this.renderer),this.transformControls.setSize(.5),this.sceneHelpers.add(this.transformControls),window.addEventListener("orientationchange",function(){[t.widthRatio,t.heightRatio]=[t.heightRatio,t.widthRatio]},!1),window.addEventListener("resize",w,!1),this.dom.addEventListener("click",function(e){t.dom.focus()},!1),this.dom.addEventListener("dblclick",function(e){t.mouseDoubleClickPosition.copy(x(e));var r=t.getIntersectObject("mouseDoubleClick");r&&t.focus(r)},!1),this.dom.addEventListener("mousemove",function(e){t.mouseMovePosition.copy(x(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!1),this.dom.addEventListener("mousedown",function(e){t.mouseDownPosition.copy(x(e)),document.addEventListener("mouseup",M,!1)},!1),this.dom.addEventListener("touchmove",function(e){e.preventDefault(),h&&clearTimeout(h);t.mouseMovePosition.copy(x(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!0),this.dom.addEventListener("touchstart",function(e){t.guiContextMenu&&t.guiContextMenu.setDisplay("none");if(e.preventDefault(),d)return;h=setTimeout(P,500,e),d=!0,t.mouseDownPosition.copy(x(e)),document.addEventListener("touchend",k,!1)},!1),this.dom.addEventListener("keydown",L,!1),this.dom.addEventListener("keyup",function(e){switch(e.preventDefault(),e.stopPropagation(),e.keyCode){case 17:t.transformControls.setTranslationSnap(null),t.transformControls.setRotationSnap(null),t.controls.enabled=!0}},!1),this.dom.addEventListener("contextmenu",C,!1),this.renderScene=function(){_()},this.onKeyDown=function(e){L(e)},this.getBoundingBox=function(){return b.computeBoundingBox(this.scene)},this.getMousePosition=function(e){return x(e)},this.getIntersectObject=function(e){if("string"==typeof e){var t;if("mouseDown"===e)t=this.mouseDownPosition;else if("mouseUp"===e)t=this.mouseUpPosition;else{if("mouseDoubleClick"!==e)return null;t=this.mouseDoubleClickPosition}return(r=T(t,this.selectables)).length>0?r[0].object:null}var r;return this.mouseDownPosition.equals(this.mouseUpPosition)&&(r=T(this.mouseUpPosition,this.selectables)).length>0?(void 0!==e&&(e.object=r[0].object,e.distance=r[0].distance,e.point=r[0].point,e.uv=r[0].uv),r[0].object):null},this.select=function(e,r){if(e){var n=e;if("ancestor"===r)e.traverseAncestors(function(e){e.parent===t.scene&&(n=e)}),this.selectObjects=[n];else if("multiple"===r){var i=this.selectObjects.indexOf(n);-1===i?this.selectObjects.push(n):this.selectObjects.splice(i,1)}else this.selectObjects=[n];this.selectObject=n,this.signals.objectSelected.dispatch(n),this.signals.objectsSelected.dispatch(this.selectObjects)}else this.selectObject=null,this.selectObjects=[],this.signals.objectSelected.dispatch(null),this.signals.objectsSelected.dispatch(this.selectObjects)},this.selectById=function(e,t){e!==this.camera.id?this.select(this.scene.getObjectById(e,!0),t):this.select(this.camera,t)},this.selectByUuid=function(e,t){this.scene.traverse(function(r){r.uuid===e&&this.select(r,t)})},this.deselect=function(){this.selectObject=null},this.focus=function(e){this.signals.objectFocused.dispatch(e)},this.focusById=function(e){this.focus(this.scene.getObjectById(e,!0))},this.objectByUuid=function(e){return this.scene.getObjectByProperty("uuid",e)},this.addObject=function(e){e.traverse(function(e){t.addHelper(e)}),this.scene.add(e),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},this.removeObject=function(e){null!==e.parent&&(e.traverse(function(e){t.removeHelper(e)}),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch())},this.addHelper=(u=new THREE.SphereBufferGeometry(2,4,2),c=new THREE.MeshBasicMaterial({color:16711680,visible:!1}),function(e){if(!b.isDeviceMobile()){var t;if(e instanceof THREE.Camera)(t=new THREE.CameraHelper(e)).name="cameraHelper";else if(e instanceof THREE.PointLight)(t=new THREE.PointLightHelper(e,1)).name="pointLightHelper";else if(e instanceof THREE.DirectionalLight)(t=new THREE.DirectionalLightHelper(e,1)).name="directionalLightHelper","SunLight"===e.userData.type&&(t.visible=!1);else if(e instanceof THREE.SpotLight)(t=new THREE.SpotLightHelper(e)).name="spotLightHelper";else if(e instanceof THREE.HemisphereLight)(t=new THREE.HemisphereLightHelper(e,1)).name="hemisphereLightHelper";else{if(!(e instanceof THREE.SkinnedMesh))return;(t=new THREE.SkeletonHelper(e)).name="skeletonHelper"}var r=new THREE.Mesh(u,c);r.name="picker",r.userData.object=e,t.add(r),e.helper=t,this.sceneHelpers.add(t),this.signals.helperAdded.dispatch(t)}}),this.removeHelper=function(e){var t=e.helper;void 0!==t&&(t.parent.remove(t),this.signals.helperRemoved.dispatch(t))},this.getObjectMaterial=function(e,t){var r=void 0;return e&&(r=e.material,Array.isArray(r)&&(r=r[t])),r},this.setObjectMaterial=function(e,t,r){Array.isArray(e.material)?e.material[t]=r:e.material=r},this.clear=function(){this.history.clear(),this.config.clearDatabase(),this.camera.copy(this.defaultCamera);for(var e=this.scene.children;e.length>0;)this.removeObject(e[0]);this.deselect(),this.signals.appWorksCleared.dispatch(),this.signals.windowResize.dispatch()},this.fromJSON=function(e){var t=new THREE.ObjectLoader;if(void 0!==e.scene){var r=t.parse(e.camera);this.camera.copy(r),this.camera.aspect=this.defaultCamera.aspect,this.camera.updateProjectionMatrix(),this.history.fromJSON(e.history),this.setScene(t.parse(e.scene))}else this.setScene(t.parse(e))},this.toJSON=function(){return{metadata:{},camera:this.camera.toJSON(),scene:this.scene.toJSON(),history:this.history.toJSON()}},this.execute=function(e,t){this.history.execute(e,t)},this.undo=function(){this.history.undo()},this.redo=function(){this.history.redo()},this.add=function(e){this.execute(new b.AddObjectCommand(e))},this.remove=function(e){this.execute(new b.RemoveObjectCommand(e))},this.replace=function(e,t){var r=[];r.push(new b.RemoveObjectCommand(e)),r.push(new b.AddObjectCommand(t)),this.multiCmds(r)},this.move=function(e,t,r){e.parent?this.execute(new b.MoveObjectCommand(e,t,r)):Alert("The object cannot be moved to the new parent")},this.moveTo=function(e,t,r){this.add(e),this.move(e,t,r)},this.setPosition=function(e,t,r){this.execute(new b.SetPositionCommand(e,t,r))},this.setRotation=function(e,t,r){this.execute(new b.SetRotationCommand(e,t,r))},this.setScale=function(e,t,r){this.execute(new b.SetScaleCommand(e,t,r))},this.setGeometry=function(e,t){this.execute(new b.SetGeometryCommand(e,t))},this.setGeometryValue=function(e,t,r){this.execute(new b.SetGeometryValueCommand(e,t,r))},this.setMaterial=function(e,t,r){this.execute(new b.SetMaterialCommand(e,t,r))},this.setMaterialValue=function(e,t,r,n){this.execute(new b.SetMaterialValueCommand(e,t,r,n))},this.setMaterialColor=function(e,t,r,n){this.execute(new b.SetMaterialColorCommand(e,t,r,n))},this.setMaterialMap=function(e,t,r,n){this.execute(new b.SetMaterialMapCommand(e,t,r,n))},this.setUuid=function(e,t){this.execute(new b.SetUuidCommand(e,t))},this.setValue=function(e,t,r){this.execute(new b.SetValueCommand(e,t,r))},this.setColor=function(e,t,r){this.execute(new b.SetColorCommand(e,t,r))},this.setScene=function(e){this.execute(new b.SetSceneCommand(e))},this.multiCmds=function(e){this.execute(new b.MultiCmdsCommand(e))},b.renderer=this.renderer,b.scene=this.scene,b.camera=this.camera,b.appWorks=this,"medicalWorks"===this.appName&&b.demoMedicalQuadViewport()},b.createBackground=function(e){if(e.isTexture)return e;if("number"==typeof e)return new THREE.Color(e);if("string"==typeof e)return"FS"===e.substr(-2,2)?function(e){var t=new THREE.Vector2;b.renderer.getSize(t);var r=b.BackgroundShader;(s=THREE.UniformsUtils.clone(r.uniforms)).resolution.value=t;var n=r.vertexShader,i=r[e],a=b.isWebGL1()?{gl_FragDepth:"gl_FragDepthEXT"}:{},o=new THREE.ShaderMaterial({defines:a,uniforms:s,vertexShader:n,fragmentShader:i});if("cloudsFS"===e){var s=o.uniforms,l=new THREE.TextureLoader,u=l.load("images/raymarch/rgbaNoise256.png",function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping});s.textureMaps.value.push(u)}o.extensions={derivatives:!0,fragDepth:!0,drawBuffers:!0,shaderTextureLOD:!0};var c=new THREE.PlaneBufferGeometry(2,2);return(e=new THREE.Mesh(c,o)).name="backgroundMesh",e.frustumCulled=!1,e.update=function(e,r){b.renderer.getSize(t);var n=this.material.uniforms;n.time.value=r,n.resolution.value=t},e}(e):function(e){var t=".jpg",r="images/background/"+e+"/";switch(e){case"cloud":case"galaxy":case"redSky":case"smallLake":t=".png";break;default:t=".jpg"}var n=["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t];return(new THREE.CubeTextureLoader).setPath(r).load(n)}(e)},b.createBackgroundPMREM=function(e,t){t=void 0!==t?t:b.renderer;var r=new THREE.PMREMGenerator(e);r.update(t);var n=new THREE.PMREMCubeUVPacker(r.cubeLods);return n.update(t),n.CubeUVRenderTarget?n.CubeUVRenderTarget.texture:null},b.createFog=function(e){var t=void 0!==(e=e||{}).color?e.color:b.FOG_COLOR;if("linear"===e.type){var r=void 0!==e.near?e.near:this.camera.near,n=void 0!==e.far?e.far:this.camera.far;return new THREE.Fog(t,r,n)}if("exp2"===e.type){var i=void 0!==e.density?e.density:.001;return new THREE.FogExp2(t,i)}return null},b.createCameraControls=function(e,t,r){var n;e=void 0!==e?e:"OrbitControls",t=void 0!==t?t:b.appWorks.camera,r=void 0!==r?r:b.appWorks.renderer.domElement;return b.appWorks&&b.appWorks.controls&&b.appWorks.controls.dispose(),"TrackballControls"===e?((n=new THREE.TrackballControls(t,r)).rotateSpeed=2,n.zoomSpeed=1,n.panSpeed=.4,n.staticMoving=!1,n.dynamicDampingFactor=.2,n.enabled=!0):"FirstPersonControls"===e?((n=new THREE.FirstPersonControls(t,r)).movementSpeed=100,n.lookSpeed=.05,n.lookVertical=!0,n.activeLook=!0,n.constrainVertical=!0,n.verticalMin=1.1,n.verticalMax=2.2,n.enabled=!0):((n=new THREE.OrbitControls(t,r)).enablePan=!0,n.enableZoom=!0,n.enableDamping=!0,n.screenSpacePanning=!0,n.dampingFactor=.1,n.panSpeed=.1,n.rotateSpeed=.07,n.enabled=!0),n},b.playAudio=function(e,t){if(!(Array.isArray(e)&&e.length>0))return null;var r=new k.Howl({src:[e[0]],autoplay:!0,loop:!0,volume:.5,onend:function(){e.shift(),e.length>0&&b.playAudio(e)}});return r.play(),r},b.createCameraEffect=function(e,t){e=void 0!==e?e:"NoEffect",t=void 0!==t?t:b.renderer;return"AnaglyphEffect"===e?new THREE.AnaglyphEffect(t):"StereoEffect"===e?new THREE.StereoEffect(t):"ParallaxBarrierEffect"===e?new THREE.ParallaxBarrierEffect(t):null},b.Animation=function(e){e=void 0!==e?e:b.scene;this.mixer=new THREE.AnimationMixer(e),this.update=function(e){this.mixer.update(e)},this.addAnimation=function(e,t){t.length>0&&(e.animations=t)},this.createActions=function(e){var t={},r=e.animations;if(void 0!==r){for(var n of r)t[n.name]=this.mixer.clipAction(n,e),e.activeAction||(e.activeAction=t[n.name]);return t}},this.playAction=function(e,t,r){if(e.animations&&0!==e.animations.length){var n=(r=r||{}).duration||1,i=r.loopMode||THREE.LoopRepeat,a=r.repetitions||1/0,o=r.combine||"crossFade";e=void 0!==e?e:b.appWorks.selectObject,t=void 0!==t?t:e.animations[0];if("crossFade"==o){var s=e.activeAction,l=this.mixer.clipAction(t,e);return l?(l.enabled=!0,l.setLoop(i,a),s?(s.enabled=!0,s.crossFadeTo(l,n).play()):l.play(),e.activeAction=l,l):void 0}if("overlap"===o){var u=this.mixer.clipAction(t,e);return u.play(),e.activeAction=u,u}}},this.playNextAction=function(e){var t=(e=void 0!==e?e:b.appWorks.selectObject).animations;if(void 0!==t){var r=-1;if(e.activeAction){var n=e.activeAction.getClip();r=t.indexOf(n)}var i=t[r=~~((r+1)%t.length)];e.activeAction=this.playAction(e,i),console.log('>> playAction: "'+i.name+'"')}},this.stopAction=function(e,t){if(e&&t)(r=this.mixer.clipAction(t,e)).enabled=!0,r.stop();else if(e&&!t){var r;(r=e.activeAction)&&(r.enabled=!0,r.stop())}},this.stopAllActions=function(){this.mixer.stopAllAction()}},b.loadJSON=function(e){function t(t,r){var n,i=new THREE.LegacyJSONLoader(e.manager).parse(t,r),a=i.geometry;if(a instanceof THREE.Geometry&&(a.morphTargets.length>0||a.skinIndices.length>0)){a=b.toNonIndexedBufferGeometry(i.geometry);var o=i.geometry.animations;o&&(a.animations=o)}var s=i.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach(function(e){e.vertexColors=r})}(a,s),a instanceof THREE.BufferGeometry&&a.attributes.skinIndex){n=new THREE.SkinnedMesh(a,s);for(var l=[],u=t.bones,c=0,h=u.length;c<h;c++){var d=(new THREE.Vector3).fromArray(u[c].pos),f=(new THREE.Quaternion).fromArray(u[c].rotq),p=new THREE.Bone;p.position.copy(d),p.quaternion.copy(f),p.name=u[c].name,l.push(p)}var m=new THREE.Skeleton(l);n.bind(m)}else n=new THREE.Mesh(a,s);return a.animations&&(s.forEach(function(e){e.morphTargets=!0}),a.animations.length>0&&(n.animations=a.animations)),n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,n}function r(r,n){var i;switch(void 0===r.metadata&&(r.metadata={type:"Geometry"}),void 0===r.metadata.type&&(r.metadata.type="Geometry"),void 0!==r.metadata.formatVersion&&(r.metadata.version=r.metadata.formatVersion),r.metadata.type.toLowerCase()){case"buffergeometry":i=function(t){var r=new THREE.BufferGeometryLoader(e.manager).parse(t);return mesh=new THREE.Mesh(r),mesh.castShadow=!0,mesh.receiveShadow=!0,mesh.name=e.url,mesh}(r);break;case"geometry":i=t(r,n);break;case"object":i=function(t,r){var n=new THREE.ObjectLoader(e.manager);n.setPath(r),n.setResourcePath(r);var i=n.parse(t);return i instanceof THREE.Scene?(b.appWorks.setScene(i),i.name=e.url):(i.castShadow=!0,i.receiveShadow=!0,i.name=e.url),i}(r,n)}e.callback&&e.callback(i)}var n=e.basePath||"models/";new THREE.FileLoader(e.manager).load(e.url,function(e){r(JSON.parse(e),n)})},b.loadOBJ=function(e){var t=e.obj||null,r=e.mtl||null,n=e.basePath||"";function i(t,r,n){var i=new THREE.OBJLoader(e.manager);i.setPath(t),n&&i.setMaterials(n),i.load(r,function(n){n.traverse(function(e){e instanceof THREE.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)}),n.name=t+r,e.callback&&e.callback(n)},function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}},function(e){console.log("OBJLoader: error happened")})}if(r){var a=new THREE.MTLLoader(e.manager);a.setPath(n),a.load(r,function(e){e.preload(),i(n,t,e)})}else i(n,t)},b.loadSTL=function(e){new THREE.STLLoader(e.manager).load(e.url,function(t){!function(t){var r;r=t.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var n=new THREE.Mesh(t,r);n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,e.callback&&e.callback(n)}(t)})},b.loadPLY=function(e){new THREE.PLYLoader(e.manager).load(e.url,function(t){!function(t){t.computeVertexNormals();var r=new THREE.Mesh(t,new THREE.MeshStandardMaterial);r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},b.loadDAE=function(e){new THREE.ColladaLoader(e.manager).load(e.url,function(t){!function(t){var r=t.scene;t.animations.length>0&&(r.animations=t.animations),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},b.loadGLB=function(e){THREE.DRACOLoader.setDecoderPath("js/draco/gltf/");var t=new THREE.GLTFLoader(e.manager);t.setDRACOLoader(new THREE.DRACOLoader(e.manager)),t.load(e.url,function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=b.scene.background;i&&i.isCubeTexture&&r.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)},void 0,function(e){console.error(e)})},b.loadGLTF=function(e){new THREE.GLTFLoader(e.manager).load(e.url,function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=b.scene.background;i&&i.isCubeTexture&&r.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)},void 0,function(e){console.error(e)})},b.loadAMF=function(e){new THREE.AMFLoader(e.manager).load(e.url,function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},b.load3MF=function(e){var t=new THREE.ThreeMFLoader(e.manager);t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),t.load(e.url,function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},b.loadWRL=function(e){new THREE.VRMLLoader(e.manager).load(e.url,function(t){!function(t){t.traverse(function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))}),t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},b.loadFBX=function(e){var t=new THREE.FBXLoader(e.manager),r=e.basePath||"";t.setPath(r),t.setResourcePath(r),t.load(e.url,function(t){!function(t){var r=t;r.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},b.loadMedical=function(e){var t=new b.MedicalLoader,r=e.basePath||"";t.setPath(r),t.load(e.url,function(t){!function(t){let r=new b.MedicalVolume(t);Array.isArray(e.url)&&e.url.length>0?r.name=e.url[0]:r.name="medicalVolume";let n=new b.LookupTables;n.lut="default",r.lutTexture=n.texture,r.lut=!0;let i=t.worldCenter();b.appWorks.camera.lookAt(i),b.appWorks.controls.target.copy(i),e.callback&&e.callback(r)}(t)})},b.FileExplorer=function(e){e=e||b.appWorks;var t=this;function r(e,t){return"number"==typeof t?parseFloat(t.toFixed(6)):t}this.basePath="models/",this.openFile=function(){this.fileInput.click()},this.saveAsFile=function(e){this.fileOutput.fileExtension=e,this.fileOutput.click()},this.fileOutput=document.createElement("div"),this.fileOutput.addEventListener("click",function(){var e=t.fileOutput.fileExtension;t.saveFile("model."+e)}),this.saveFile=function(r){var n,i=r.split(".").pop().toLowerCase();switch("natureWorks"===e.appName?((n=new THREE.Object3D).name=e.appName,e.scene.children.forEach(function(e){n.add(b.cloneObject(e))})):n=e.scene,i){case"json":!function(e,r){t.saveObject(e,r)}(n,r);break;case"obj":!function(e,t){var t=t||"model.obj";a((new THREE.OBJExporter).parse(e),t)}(n,r);break;case"dae":!function(e,t){var t=t||"scene.dae";(new THREE.ColladaExporter).parse(e,function(e){a(e.data,t)})}(n,r);break;case"glb":!function(e,t){var t=t||"scene.glb";(new THREE.GLTFExporter).parse(e,function(e){o(e,t)},{binary:!0,forceIndices:!0,forcePowerOfTwoTextures:!0})}(n,r);break;case"gltf":!function(e,t){var t=t||"scene.gltf";(new THREE.GLTFExporter).parse(e,function(e){a(JSON.stringify(e,null,2),t)})}(n,r);break;case"stl":!function(e,t,r){var t=t||"model.stl",n=new THREE.STLExporter;!0===r?a(n.parse(e),t):o(n.parse(e,{binary:!0}),t)}(n,r);break;case"ply":!function(e,t){var t=t||"model.ply";a((new THREE.PLYExporter).parse(e),t)}(n,r);break;default:alert('The file type "'+i+'" is not supported.')}},this.saveGeometry=function(e,t){t=t||"geometry.json";var n=e.toJSON();try{n=(n=JSON.stringify(n,r,"\t")).replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){n=JSON.stringify(n)}a(n,t)},this.saveObject=function(e,t){t=t||"object.json";var n=e.toJSON();try{n=(n=JSON.stringify(n,r,"\t")).replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){n=JSON.stringify(n)}a(n,t)};var n=document.createElement("a");function i(e,t){n.href=URL.createObjectURL(e),n.download=t||"data.json",n.dispatchEvent(new MouseEvent("click"))}function a(e,t){i(new Blob([e],{type:"text/plain"}),t)}function o(e,t){i(new Blob([e],{type:"application/octet-stream"}),t)}var s=document.createElement("input");s.type="file",s.multiple=!0,s.style.display="none",this.fileInput=s,s.addEventListener("change",function(e){const r=[].slice.call(s.files);if(r[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void u(e);const n=new Map;r.forEach(e=>n.set(e.name,e)),t.loadFiles(n)});var l=e.dom;function u(e){b.MedicalLoadFiles(e,e=>{let t=new b.MedicalVolume(e);t.name="medicalVolume";let r=new b.LookupTables;r.lut="default",t.lutTexture=r.texture,t.lut=!0;let n=e.worldCenter();b.appWorks.camera.lookAt(n),b.appWorks.controls.target.copy(n),b.add(t)})}l.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),l.classList.add("dragover")}),l.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),l.classList.remove("dragover")}),l.addEventListener("drop",function(e){if(e.stopPropagation(),e.preventDefault(),e.dataTransfer.files[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void u(e);let r;if(e.dataTransfer.items)r=[].slice.call(e.dataTransfer.items).map(e=>e.webkitGetAsEntry());else if(1===(e.dataTransfer.files||[]).length){const r=e.dataTransfer.files[0];return"application/zip"===r.type?void alert("zip file: not supported"):void t.loadFiles(new Map([[r.name,r]]))}r||alert("Required drag & drop is not supported in this browser."),1===r.length&&r[0].name.match(/\.zip$/)?alert("zip file: not supported"):function e(r,n){const i=n.pop();if(!i)return void t.loadFiles(r);if(i.isFile)i.file(t=>{r.set(i.fullPath,t),e(r,n)},()=>console.error("Could not load file: %s",i.fullPath));else if(i.isDirectory){const t=i.createReader(),a=i=>{i.length?(n=n.concat(i),t.readEntries(a)):e(r,n)};t.readEntries(a)}else console.warn("Unknown asset type: "+i.fullPath),e(r,n)}(new Map,r)},!1),this.loadFiles=function(e){for(var r of e.values())console.log("Loading:",r.name,"("+b.humanFileSize(r.size)+")");var n;let i,a;Array.from(e).forEach(([e,t])=>{t.name.match(/\.(js|json|obj|stl|ply|dae|gltf|glb|amf|3mf|wrl|fbx)$/i)&&(i=t,a=e.replace(t.name,""),n=t.name.split(".").pop().toLowerCase())}),i||console.warn("No asset found.");const o="string"==typeof i?i:URL.createObjectURL(i),s=THREE.LoaderUtils.extractUrlBase(o);return new Promise((r,l)=>{const u=[],c=new THREE.LoadingManager;switch(c.onStart=()=>{b.createProgressbar()},c.onProgress=(e,t,r)=>{b.updateProgressbar(t,r)},c.onLoad=()=>{b.hideProgressbar()},c.onError=e=>{b.errorProgressbar("There was an error loading "+e)},c.setURLModifier((t,r)=>{const n=a+t.replace(s,"").replace(/^(\.?\/)/,"");if(e.has(n)){const t=e.get(n),r=URL.createObjectURL(t);return u.push(r),r}return(r||"")+t}),n){case"js":case"json":!function(e,n){function a(e,t,r){var n,i=new THREE.LegacyJSONLoader(t),a=i.parse(e,r),o=a.geometry;if(o instanceof THREE.Geometry&&(o.morphTargets.length>0||o.skinIndices.length>0)){o=b.toNonIndexedBufferGeometry(a.geometry);var s=a.geometry.animations;s&&(o.animations=s)}var l=a.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach(function(e){e.vertexColors=r})}(o,l),o instanceof THREE.BufferGeometry&&o.attributes.skinIndex){n=new THREE.SkinnedMesh(o,l);for(var u=[],c=e.bones,h=0,f=c.length;h<f;h++){var p=(new THREE.Vector3).fromArray(c[h].pos),m=(new THREE.Quaternion).fromArray(c[h].rotq),v=new THREE.Bone;v.position.copy(p),v.quaternion.copy(m),v.name=c[h].name,u.push(v)}var g=new THREE.Skeleton(u);n.bind(g)}else n=new THREE.Mesh(o,l);return o.animations&&(l.forEach(function(e){e.morphTargets=!0}),o.animations.length>0&&(n.animations=o.animations)),d(n),n}function o(e,t,r){switch(void 0===e.metadata&&(e.metadata={type:"Geometry"}),void 0===e.metadata.type&&(e.metadata.type="Geometry"),void 0!==e.metadata.formatVersion&&(e.metadata.version=e.metadata.formatVersion),e.metadata.type.toLowerCase()){case"buffergeometry":(function(e,t){var r=new THREE.BufferGeometryLoader(t).parse(e);return mesh=new THREE.Mesh(r),d(mesh),mesh})(e,t);break;case"geometry":a(e,t,r);break;case"object":(function(e,t,r){var n=new THREE.ObjectLoader(t);n.setPath(r),n.setResourcePath(r);var a=n.parse(e);a instanceof THREE.Scene?(b.appWorks.setScene(a),a.name=i.name):"natureWorks"===b.appWorks.appName&&a.children.length>0?a.children.forEach(function(e){b.add(b.cloneObject(e))}):d(a);return a})(e,t,r)}}new THREE.FileLoader(n).load(e,e=>{var i=JSON.parse(e);o(i,n,t.basePath),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"obj":!function(t,n){var i;for(var a of e.values())if(a.name.match(/\.(mtl|MTL)$/)){i=a;break}function o(e){var i=new THREE.OBJLoader(n);e&&i.setMaterials(e),i.load(t,e=>{d(e),u.forEach(URL.revokeObjectURL),r(e)},h,l)}!function(e){if(void 0!==e){const i=URL.createObjectURL(e);var t=new THREE.MTLLoader(n);t.load(i,e=>{e.preload(),o(e),r(e)},h,l)}else o()}(i)}(o,c);break;case"stl":!function(e,t){new THREE.STLLoader(t).load(e,e=>{var t;t=e.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var n=new THREE.Mesh(e,t);d(n),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"ply":!function(e,t){new THREE.PLYLoader(t).load(e,e=>{e.computeVertexNormals();var t=new THREE.Mesh(e,new THREE.MeshStandardMaterial);d(t),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"dae":!function(e,t){new THREE.ColladaLoader(t).load(e,e=>{var t=e.scene;e.animations.length>0&&(t.animations=e.animations),d(t),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"gltf":case"glb":!function(e,t){THREE.DRACOLoader.setDecoderPath("js/draco/gltf/");const n=new THREE.GLTFLoader(t);n.setCrossOrigin("anonymous"),n.setDRACOLoader(new THREE.DRACOLoader),n.load(e,e=>{var t=e.scene||e.scenes[0],n=e.animations||[],i=b.scene.background;i&&i.isCubeTexture&&t.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(t.animations=n),d(t),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"amf":!function(e,t){new THREE.AMFLoader(t).load(e,e=>{d(e),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"3mf":!function(e,t){var n=new THREE.ThreeMFLoader(t);n.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),n.load(e,e=>{d(e),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"wrl":!function(e,t){new THREE.VRMLLoader(t).load(e,e=>{e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))}),d(e),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;case"fbx":!function(e,t){new THREE.FBXLoader(t).load(e,e=>{e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),d(e),u.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,c);break;default:alert("Unsupported file format ("+n+").")}function h(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}}function d(e){e.name=i.name,b.add(e),b.welcomeObject(e)}})}},b.HGTLoader=function(){this.loadTile=function(e,t,r){var n=this,i=new THREE.TextureLoader;i.crossOrigin=!0;i.load("https://maps.googleapis.com/maps/api/staticmap?center="+e+","+t+"&zoom="+r+"&size=512x512&scale=2&maptype=satellite&key=AIzaSyA1qxvvl1sFBFLj5rx4cXHJ_1soxQ_GMpw",function(i){var a=new THREE.PlaneBufferGeometry(20,20,128,128),o=new THREE.MeshPhongMaterial({map:i,shading:THREE.SmoothShading});n.heightMapping(a,e,t,r);var s=new THREE.Mesh(a,o);s.rotation.x=-Math.PI/2,s.frustumCulled=!1,s.castShadow=!1,s.receiveShadow=!0,s.name="SRTM.hgt",b.add(s)})},this.heightMapping=function(e,t,r,n){var i=e.attributes.position,a=Math.sqrt(i.count),o=i.array,s=20/(Math.abs(40075160*Math.cos(t*(Math.PI/180)))/Math.pow(2,n-1)),l=360/Math.pow(2,n-1),u=Math.abs(360*Math.cos(t*(Math.PI/180))/Math.pow(2,n-1)),c=t-u/2,h=t+u/2;console.log(c);var d=r-l/2,f=r+l/2;console.log(l),console.log(u);var p=Math.abs(Math.floor(1201*l)),m=Math.abs(Math.floor(1201*u));console.log(p,m);var v=a/p,g=a/m;console.log(g,v);var y,_,b=1200-Math.abs(1200*(h-Math.floor(h))),E=Math.abs(1200*(d-Math.floor(d))),w=1200-Math.abs(1200*(c-Math.floor(c))),x=Math.abs(1200*(f-Math.floor(f)));console.log(b,E);for(var T=Math.floor(h);T>=Math.floor(c);T--)for(var S=Math.floor(d);S<=Math.floor(f);S++){y=T>0?"N"+Math.abs(Math.floor(T)):"S"+Math.abs(Math.floor(T)),_=S>0?S<100?"E0"+Math.abs(Math.floor(S)):"E"+Math.abs(Math.floor(S)):S>=-99?"W0"+Math.abs(Math.floor(S)):"W"+Math.abs(Math.floor(S));var M=0,R=0,A=1200,k=1200;T==Math.floor(c)&&(A=w),T==Math.floor(h)&&(M=b),S==Math.floor(d)&&(R=E),S==Math.floor(f)&&(k=x);var P=Math.floor(h)-T,C=S-Math.floor(d),L=0;P>0&&(L=1201-b+1201*(P-1));var I=0;C>0&&(I=1201-E+1201*(C-1));var O=new XMLHttpRequest;O.start_row=M,O.start_column=R,O.end_row=A,O.end_column=k,O.passed_rows=L,O.passed_columns=I;var H=Math.round(L/m*a),D=Math.round((L+A-M)/m*a);D=Math.min(D,500);var N=Math.round(I/p*a),F=Math.round((I+k-R)/p*a);F=Math.min(F,500),O.filename="models/hgt/"+y+_+".hgt",O.start_i=H,O.end_i=D,O.start_j=N,O.end_j=F,O.open("GET","models/hgt/"+y+_+".hgt",!0),O.responseType="arraybuffer",O.onload=function(t){var r=this.response;if(2884802==r.byteLength){new Int16Array(r);var n=new DataView(r),l=0,u=0;console.log(this.filename),console.log(this.start_row,this.start_column),console.log("Vertex rows:",this.start_i,this.end_i),console.log("Vertex columns:",this.start_j,this.end_j),console.log("Passed rows/columns:",this.passed_rows,this.passed_columns);for(var c=this.start_i;c<=this.end_i;c++){l=c/g;for(var h=this.start_j;h<=this.end_j;h++){u=h/v;var d=0,f=0;l>=this.passed_rows&&(d=(b+l)%1201),u>=this.passed_columns&&(f=(E+u)%1201),f=Math.min(1200,f),d=Math.min(1200,d);var p,m,y,_,w=f-Math.round(f),x=d-Math.round(d);d=Math.round(d),f=Math.round(f),c==this.start_i&&console.log("Start vertex row "+this.start_i+" at file row "+d),h==this.start_j&&console.log("Start vertex column "+this.start_j+" at file column "+f),c==this.end_i&&console.log("End vertex row "+this.end_i+" at file row "+d),h==this.end_j&&console.log("End vertex column "+this.end_j+" at file column "+f),p=Math.floor(1201*d+f),m=f<1200?Math.floor(1201*d+f+1):Math.floor(1201*d+f),y=d<1200?Math.floor(1201*(d+1)+f):Math.floor(1201*d+f),_=d<1200&&f<1200?Math.floor(1201*(d+1)+f+1):Math.floor(1201*d+f);var T=n.getInt16(2*p,!1),S=n.getInt16(2*m,!1),M=(1-w)*(1-x)*T+(1-w)*x*n.getInt16(2*y,!1)+w*(1-x)*S+w*x*n.getInt16(2*_,!1);o[3*(c*a+h)+2]=M*s}}i.needsUpdate=!0,e.computeVertexNormals()}},O.send(null)}}},b.WidgetCSS='\n.widget-handle {\n    position: absolute;\n    border: 1px solid;\n    border-radius: 50%;\n    width: 10px;\n    height: 10px;\n    margin: -6px; /* border + width / 2 */\n    z-index: 1; /* 3 */\n}\n.widget-line {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    margin-top: -0.5px; /* height / 2 */\n}\n.widget-dashline {\n    position: absolute;\n    border-top: 1px dashed;\n    margin-top: -0.5px; /* border / 2 */\n}\n.widget-line::before,\n.widget-dashline::before { /* for dragging */\n    content: " ";\n    position: absolute;\n    height: 12px;\n    left: 0;\n    right: 0;\n    margin-top: -6px;\n}\n.widget-rectangle {\n    position: absolute;\n    border: 1px solid;\n    margin: -1px; /* border */\n}\n// .widget-rectangle-helper {\n//     position: absolute;\n//     border: 1px dashed;\n//     margin: -1px; /* border */\n// }\n// .widget-ellipse {\n//     position: absolute;\n//     border: 1px solid;\n//     border-radius: 50%;\n//     margin: -1px; /* border */\n//     // z-index: 2;\n// }\n.widget-label {\n    position: absolute;\n    border: 1px solid;\n    border-radius: 6px; /* jamie */\n    background-color: rgba(0, 0, 0, 0.7);\n    color: rgb(255, 255, 255);\n    padding: 4px;\n    z-index: 1; /* 3 */\n}\n::selection {\n    background: rgba(0,0,0,0);\n}',b.WidgetBase=function(e,t,r){if(r=r||{},THREE.Object3D.call(this),this.name="widgetBase",this._widgetType="Base",this._params=r,!0===r.hideMesh&&(this.visible=!1),null===document.getElementById("medical-widgets")){const e=document.createElement("style");e.id="medical-widgets",e.innerHTML=b.WidgetCSS,document.head.appendChild(e)}this._enabled=!0,this._selected=!1,this._hovered=!0,this._active=!0,this._colors={default:"#0000ff",active:"#ffff00",hover:"#ff0000",select:"#008000",text:"#ffffff",error:"#ff7f50"},this._color=this._colors.default,this._dragged=!1,this._displayed=!0,this._targetMesh=e,this._controls=t,this._camera=t.object,this._container=t.domElement,this._worldPosition=new THREE.Vector3,r.worldPosition?this._worldPosition.copy(r.worldPosition):null!==this._targetMesh&&this._worldPosition.setFromMatrixPosition(this._targetMesh.matrixWorld),this._xaxis=new THREE.Vector3(1,0,0),this._yaxis=new THREE.Vector3(0,1,0)},b.WidgetBase.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:b.WidgetBase,isWidgetBase:!0,initOffsets(){const e=this._container.getBoundingClientRect(),t=document.body,r=document.documentElement,n=window.pageYOffset||r.scrollTop||t.scrollTop,i=window.pageXOffset||r.scrollLeft||t.scrollLeft,a=r.clientTop||t.clientTop||0,o=r.clientLeft||t.clientLeft||0;this._offsets={top:Math.round(e.top+n-a),left:Math.round(e.left+i-o)}},getMouseOffsets(e){return{x:(e.clientX-this._offsets.left)/this._container.offsetWidth*2-1,y:-(e.clientY-this._offsets.top)/this._container.offsetHeight*2+1,screenX:e.clientX-this._offsets.left,screenY:e.clientY-this._offsets.top}},getArea(e){let t=0,r=e.length-1;for(let n=0;n<e.length;n++)t+=(e[r].x+e[n].x)*(e[r].y-e[n].y),r=n;return Math.abs(t/2)},getRegionByXY(e,t){let r=null;return e.some((e,n)=>{if(t.x>=e.x0&&t.x<=e.x1&&t.y>=e.y0&&t.y<=e.y1)return r=n,!0}),r},getPointInRegion:(e,t)=>e?new THREE.Vector2((t.x-e.x0-(e.axisX||0))*e.deltaX,(t.y-e.y0-(e.axisY||0))*e.deltaY):null,getUsPoint(e,t){return this.getPointInRegion(e[this.getRegionByXY(e,t)],t)},getUsDistance(e,t){const r=this._params.ultrasoundRegions||[];if(r.length<1)return null;const n=this.getRegionByXY(r,e),i=this.getRegionByXY(r,t);return null===n||null===i||n!==i||"cm"!==r[n].unitsX||"cm"!==r[n].unitsY?null:this.getPointInRegion(r[n],e).distanceTo(this.getPointInRegion(r[n],t))},getDistanceData(e,t,r){let n=null,i=null;if(r)n=e.distanceTo(t)*r;else if(this._params.ultrasoundRegions&&this._params.lps2IJK){const r=this.getUsDistance(b.MedicalUtils.worldToData(this._params.lps2IJK,e),b.MedicalUtils.worldToData(this._params.lps2IJK,t));null!==r?(n=10*r,i="mm"):(n=e.distanceTo(t),i=this._params.pixelSpacing?"mm":"units")}else n=e.distanceTo(t);return{distance:n,units:i}},getLineData(e,t){const r=t.clone().sub(e),n=t.clone().add(e).multiplyScalar(.5),i=r.length(),a=r.angleTo(this._xaxis);return{line:r,length:i,transformX:n.x-i/2,transformY:n.y,transformAngle:e.y<t.y?a:-a,center:n}},getRectData(e,t){const r=t.clone().sub(e),n=r.clone().projectOnVector(this._yaxis),i=e.clone().min(t);return{width:r.clone().projectOnVector(this._xaxis).length(),height:n.length(),transformX:i.x,transformY:i.y,paddingVector:n.clone().normalize()}},adjustLabelTransform(e,t,r){let n=Math.round(t.x-(r?0:e.offsetWidth/2)),i=Math.round(t.y-(r?0:e.offsetHeight/2));return new THREE.Vector2(n,i)},worldToScreen(e){const t=e.clone();return t.project(this._camera),t.x=Math.round((t.x+1)*this._container.offsetWidth/2),t.y=Math.round((1-t.y)*this._container.offsetHeight/2),t.z=0,t},update(){console.log("update() should be overloaded!")},updateColor(){this._active?this._color=this._colors.active:this._hovered?this._color=this._colors.hover:this._selected?this._color=this._colors.select:this._color=this._colors.default},setDefaultColor(e){this._colors.default=e,this._handles&&this._handles.forEach(t=>t._colors.default=e),this.update()},show(){this.showDOM(),this.showMesh(),this.update(),this._displayed=!0},hide(){this.hideDOM(),this.hideMesh(),this._displayed=!1},hideDOM(){console.log("hideDOM() should be overloaded!")},showDOM(){console.log("showDOM() should be overloaded!")},hideMesh(){this.visible=!1},showMesh(){!0!==this._params.hideMesh&&(this.visible=!0)},free(){this._camera=null,this._container=null,this._controls=null,this._params=null,this._targetMesh=null}}),Object.defineProperties(b.WidgetBase.prototype,{widgetType:{get:function(){return this._widgetType}},targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._worldPosition.copy(e),this.update()}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},selected:{get:function(){return this._selected},set:function(e){this._selected=e,this.update()}},hovered:{get:function(){return this._hovered},set:function(e){this._hovered=e,this.update()}},dragged:{get:function(){return this._dragged},set:function(e){this._dragged=e,this.update()}},displayed:{get:function(){return this._displayed},set:function(e){this._displayed=e,this.update()}},active:{get:function(){return this._active},set:function(e){this._active=e,this.update()}},color:{get:function(){return this._color},set:function(e){this._color=e,this.update()}}}),b.WidgetHandle=function(e,t,r){r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetHandle",this._widgetType="Handle",this._plane={position:new THREE.Vector3,direction:new THREE.Vector3},this._offset=new THREE.Vector3,this._raycaster=new THREE.Raycaster,this._active=!1,this._hovered=!1,this._tracking=!1,this._mouse=new THREE.Vector2,this._initialized=!1,this._dom=null,this._domHovered=!1,this._screenPosition=this.worldToScreen(this._worldPosition),this.create(),this.initOffsets(),this.onResize=this.onResize.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},b.WidgetHandle.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetHandle,isWidgetHandle:!0,addEventListeners(){window.addEventListener("resize",this.onResize),this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)},removeEventListeners(){window.removeEventListener("resize",this.onResize),this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)},onResize(){this.initOffsets()},onHover(e){e&&this.hoverDom(e),this._hovered=this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){const t=this.getMouseOffsets(e);if(this._mouse.set(t.x,t.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._hovered){if(this._active=!0,this._controls.enabled=!1,this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._offset.copy(e[0].point).sub(this._worldPosition)}else{this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()),this._raycaster.ray.position=this._raycaster.ray.origin;let e=b.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._offset.copy(e).sub(this._plane.position)}this.update()}},onMove(e,t){const r=this.getMouseOffsets(e);if(this._mouse.set(r.x,r.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._active||t)if(this._dragged=!0,null!==this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._worldPosition.copy(e[0].point.sub(this._offset))}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection())),this._raycaster.ray.position=this._raycaster.ray.origin;let e=b.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._worldPosition.copy(e.sub(this._offset))}else this.onHover(null);this.update()},onEnd(){!0!==this._tracking&&(!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected),this._initialized=!0,this._active=!1,this._dragged=!1,this._controls.enabled=!0,this.update())},create(){this.createDOM()},createDOM(){this._dom=document.createElement("div"),this._dom.className="widget-handle",this._dom.style.transform=`translate3D(${this._screenPosition.x}px, ${this._screenPosition.y}px, 0)`,this.updateDOMColor(),this._container.appendChild(this._dom)},update(){this.updateColor(),this._screenPosition=this.worldToScreen(this._worldPosition),this.updateDOMColor(),this.updateDOMPosition()},updateWorldPosition(){let e=this._screenPosition,t=this._container.offsetWidth,r=this._container.offsetHeight,n={};if(n.x=2*e.x/t-1,n.y=-2*e.y/r+1,this._raycaster.setFromCamera(n,this._camera),this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._worldPosition.copy(e[0].point)}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection())),this._raycaster.ray.position=this._raycaster.ray.origin;let e=b.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._worldPosition.copy(e)}},updateDOMColor(){this._dom.style.backgroundColor=this._color},updateDOMPosition(){this._dom&&(this._dom.style.transform=`translate3D(${this._screenPosition.x}px, ${this._screenPosition.y}px, 0)`)},free(){this.removeEventListeners(),this._container.removeChild(this._dom)},hideDOM(){this._dom.style.display="none"},showDOM(){this._dom.style.display=""}}),Object.defineProperties(b.WidgetHandle.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this.updateWorldPosition(),this.update()}},screenPosition:{get:function(){return this._screenPosition},set:function(e){this._screenPosition=e}},active:{get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}},tracking:{get:function(){return this._tracking},set:function(e){this._tracking=e,this.update()}}}),b.WidgetVoxelProbe=function(e,t,r){r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetVoxelProbe",this._widgetType="VoxelProbe",this._stack=r.stack,this._container.style.cursor="pointer",this._controls.enabled=!1,this._initialized=!1,this._active=!0,this._moving=!0,this._domHovered=!1,this._label=null,this._handle=new b.WidgetHandle(e,t,r),this.add(this._handle),this._moveHandle=new b.WidgetHandle(e,t,r),this.add(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},b.WidgetVoxelProbe.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetVoxelProbe,isWidgetVoxelProbe:!0,addEventListeners(){this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)},removeEventListeners(){this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)},onStart(e){this._moveHandle.onMove(e,!0),this._handle.onStart(e),this._active=this._handle.active||this._domHovered,this._domHovered&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handle.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}else this.onHover(null);this._handle.onMove(e),this.update()},onEnd(){this._handle.onEnd(),!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handle.selected=this._selected),this._initialized=!0,this._active=this._handle.active,this._dragged=!1,this._moving=!1,this.update()},onHover(e){e&&this.hoverDom(e),this._hovered=this._handle.hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},create(){this.createVoxel(),this.createDOM()},createVoxel(){this._voxel=new b.MedicalVoxel,this._voxel.id=this.id},createDOM(){this._label=document.createElement("div"),this._label.className="widget-label";let e=document.createElement("div"),t=document.createElement("div");t.className="lpsPosition",e.appendChild(t);let r=document.createElement("div");r.className="ijkPosition",e.appendChild(r);let n=document.createElement("div");n.className="value",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},update(){this.updateColor(),this._handle.update(),this._worldPosition.copy(this._handle.worldPosition),this.updateVoxel(),this.updateDOM()},updateVoxel(){this._voxel.worldCoordinates=this._worldPosition,this._voxel.dataCoordinates=b.MedicalUtils.worldToData(this._stack.lps2IJK,this._worldPosition);let e=b.MedicalUtils.getPixelData(this._stack,this._voxel.dataCoordinates);this._voxel.value=e===this._stack.numberOfChannels>1?"NA":b.MedicalUtils.rescaleSlopeIntercept(e,this._stack.rescaleSlope,this._stack.rescaleIntercept).toFixed()},updateDOM(){const e=this._label.querySelector(".lpsPosition"),t=this._label.querySelector(".ijkPosition"),r=this._label.querySelector(".value");e.innerHTML=`LPS: \n            ${this._voxel.worldCoordinates.x.toFixed(2)}, \n            ${this._voxel.worldCoordinates.y.toFixed(2)}, \n            ${this._voxel.worldCoordinates.z.toFixed(2)}`,t.innerHTML=`IJK: \n            ${this._voxel.dataCoordinates.x}, \n            ${this._voxel.dataCoordinates.y}, \n            ${this._voxel.dataCoordinates.z}`,r.innerHTML=`Value: ${this._voxel.value}`,this.updateDOMColor();const n=this.adjustLabelTransform(this._label,this._handle.screenPosition,!0);this._label.style.transform=`translate3D(${n.x}px, ${n.y}px, 0)`},updateDOMColor(){this._label.style.borderColor=this._color},free(){this.removeEventListeners(),this.remove(this._handle),this._handle.free(),this.remove(this._moveHandle),this._moveHandle.free(),this._container.removeChild(this._label),this._stack=null,this._voxel=null},hideDOM(){this._label.style.display="none",this._handle.hideDOM()},showDOM(){this._label.style.display="",this._handle.showDOM()}}),Object.defineProperties(b.WidgetVoxelProbe.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handle.targetMesh=e,this._moveHandle.targetMesh=e,this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handle.worldPosition.copy(e),this._moveHandle.worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},active:{get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}}}),b.WidgetRuler=function(e,t,r){let n;r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetRuler",this._widgetType="Ruler",this._calibrationFactor=r.calibrationFactor||null,this._distance=null,this._units=this._calibrationFactor||r.pixelSpacing?"mm":"units",this._moving=!1,this._domHovered=!1,this._line=null,this._label=null,this._handles=[];for(let i=0;i<2;i++)n=new b.WidgetHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new b.WidgetHandle(e,t,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},b.WidgetRuler.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetRuler,isWidgetRuler:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.update())},create(){this.createDOM()},createDOM(){this._line=document.createElement("div"),this._line.className="widget-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="widget-label",this._container.appendChild(this._label),this.updateDOMColor()},hideDOM(){this._line.style.display="none",this._label.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update();const e=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor);this._distance=e.distance,e.units&&(this._units=e.units),this.updateDOM()},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px","units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the distance in mm"),this._label.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${this._units}`;let t=Math.abs(e.transformAngle);t>Math.PI/2&&(t=Math.PI-t);const r=Math.tan(t)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(t)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-t)+15,n=e.line.normalize().multiplyScalar(r),i=e.length>2*r?this._handles[1].screenPosition.clone().sub(n):this._handles[1].screenPosition.clone().add(n),a=this.adjustLabelTransform(this._label,i);this._label.style.transform=`translate3D(${a.x}px, ${a.y}px, 0)`},updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label)},getMeasurements(){return{distance:this._distance,units:this._units}}}),Object.defineProperties(b.WidgetRuler.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="mm",this.update()}}}),b.WidgetBiRuler=function(e,t,r){let n;r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetBiRuler",this._widgetType="BiRuler",this._calibrationFactor=r.calibrationFactor||null,this._distance=null,this._distance2=null,this._units=this._calibrationFactor||r.pixelSpacing?"mm":"units",this._line=null,this._label=null,this._line2=null,this._label2=null,this._dashline=null,this._handles=[];for(let i=0;i<3;i++)n=new b.WidgetHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0,this.create(),this.onMove=this.onMove.bind(this),this.addEventListeners()},b.WidgetBiRuler.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetBiRuler,isWidgetBiRuler:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove)},onStart(e){this._handles.forEach(t=>t.onStart(e)),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this.update()},onMove(e){this._active?this._dragged=!0:(this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered,this._container.style.cursor=this._hovered?"pointer":"default"),this._handles.forEach(t=>t.onMove(e)),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=!1,this.update())},create(){this.createDOM()},createDOM(){this._line=document.createElement("div"),this._line.className="widget-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="widget-label",this._container.appendChild(this._label),this._line2=document.createElement("div"),this._line2.className="widget-line",this._container.appendChild(this._line2),this._label2=document.createElement("div"),this._label2.className="widget-label",this._container.appendChild(this._label2),this._dashline=document.createElement("div"),this._dashline.className="widget-dashline",this._container.appendChild(this._dashline),this.updateDOMColor()},hideDOM(){this._line.style.display="none",this._label.style.display="none",this._line2.style.display="none",this._label2.style.display="none",this._dashline.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._label.style.display="",this._line2.style.display="",this._label2.style.display="",this._dashline.style.display="",this._handles.forEach(e=>e.showDOM())},update(){this.updateColor(),this._handles.forEach(e=>e.update()),this.updateDOM()},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=this.getLineData(this._handles[0].screenPosition,this._handles[2].screenPosition);this._line2.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0) rotate(${t.transformAngle}rad)`,this._line2.style.width=t.length+"px";const r=this._handles[0].worldPosition.clone().add(this._handles[1].worldPosition).multiplyScalar(.5),n=this._handles[0].worldPosition.clone().add(this._handles[2].worldPosition).multiplyScalar(.5),i=this.getLineData(this.worldToScreen(r),this.worldToScreen(n));this._dashline.style.transform=`translate3D(${i.transformX}px, ${i.transformY}px, 0) rotate(${i.transformAngle}rad)`,this._dashline.style.width=i.length+"px";const a=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor),o=this.getDistanceData(this._handles[0].worldPosition,this._handles[2].worldPosition,this._calibrationFactor),s="Calibration is required to display the distance in mm";this._distance=a.distance,this._distance2=o.distance,a.units&&o.units&&a.units===o.units?this._units=a.units:(a.units||(a.units=this._units),o.units||(o.units=this._units)),"units"!==a.units||this._label.hasAttribute("title")?"units"!==a.units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",s),this._label.style.color=this._colors.error),"units"!==o.units||this._label2.hasAttribute("title")?"units"!==o.units&&this._label2.hasAttribute("title")&&(this._label2.removeAttribute("title"),this._label2.style.color=this._colors.text):(this._label2.setAttribute("title",s),this._label2.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${a.units}`,this._label2.innerHTML=`${this._distance2.toFixed(2)} ${o.units}`;let l=Math.abs(e.transformAngle);l>Math.PI/2&&(l=Math.PI-l);const u=Math.tan(l)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(l)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-l)+15,c=e.line.normalize().multiplyScalar(u),h=e.length>2*u?this._handles[1].screenPosition.clone().sub(c):this._handles[1].screenPosition.clone().add(c),d=this.adjustLabelTransform(this._label,h);this._label.style.transform=`translate3D(${d.x}px, ${d.y}px, 0)`;let f=Math.abs(t.transformAngle);f>Math.PI/2&&(f=Math.PI-f);const p=Math.tan(f)<this._label2.offsetHeight/this._label2.offsetWidth?this._label2.offsetWidth/2/Math.cos(f)+15:this._label2.offsetHeight/2/Math.cos(Math.PI/2-f)+15,m=t.line.normalize().multiplyScalar(p),v=t.length>2*p?this._handles[2].screenPosition.clone().sub(m):this._handles[2].screenPosition.clone().add(m),g=this.adjustLabelTransform(this._label2,v);this._label2.style.transform=`translate3D(${g.x}px, ${g.y}px, 0)`},updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color,this._line2.style.backgroundColor=this._color,this._label2.style.borderColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label),this._container.removeChild(this._line2),this._container.removeChild(this._label2),this._container.removeChild(this._dashline)},getDistances(){return[this._distance,this._distance2]}}),Object.defineProperties(b.WidgetBiRuler.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach(t=>t.worldPosition.copy(e)),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="mm",this.update()}},shotestDistance:{get:function(){return this._distance<this._distance2?this._distance:this._distance2}},longestDistance:{get:function(){return this._distance>this._distance2?this._distance:this._distance2}}}),b.WidgetAngle=function(e,t,r){let n;r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetAngle",this._widgetType="Angle",this._opangle=null,this._moving=!1,this._domHovered=!1,this._defaultAngle=!0,this._line=null,this._line2=null,this._label=null,this._handles=[];for(let i=0;i<3;i++)n=new b.WidgetHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0,this._moveHandle=new b.WidgetHandle(e,t,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},b.WidgetAngle.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetAngle,isWidgetAngle:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._line2.addEventListener("mouseenter",this.onHover),this._line2.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._line2.removeEventListener("mouseenter",this.onHover),this._line2.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._handles[2].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._domHovered,!this._domHovered||this._handles[1].tracking||this._handles[2].tracking||(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this._handles[2].onMove(e),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||!this._handles[1].tracking&&this._handles[2].tracking&&this._handles[1].screenPosition.distanceTo(this._handles[2].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=this._handles[2].tracking,this._moving=!1,this.update())},create(){this.createDOM()},createDOM(){this._line=document.createElement("div"),this._line.className="widget-line",this._container.appendChild(this._line),this._line2=document.createElement("div"),this._line2.className="widget-line",this._container.appendChild(this._line2),this._label=document.createElement("div"),this._label.className="widget-label",this._container.appendChild(this._label),this.updateDOMColor()},hideDOM(){this._line.style.display="none",this._line2.style.display="none",this._label.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._line2.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM(),this._handles[2].showDOM()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this._handles[2].update(),this._opangle=180*this._handles[1].worldPosition.clone().sub(this._handles[0].worldPosition).angleTo(this._handles[1].worldPosition.clone().sub(this._handles[2].worldPosition))/Math.PI||0,this._opangle=this._defaultAngle?this._opangle:360-this._opangle,this.updateDOM()},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[1].screenPosition,this._handles[0].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=this.getLineData(this._handles[1].screenPosition,this._handles[2].screenPosition);this._line2.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0) rotate(${t.transformAngle}rad)`,this._line2.style.width=t.length+"px",this._label.innerHTML=`${this._opangle.toFixed(2)}&deg;`;let r=e.line.clone().add(t.line).normalize().negate(),n=r.angleTo(new THREE.Vector3(1,0,0));n>Math.PI/2&&(n=Math.PI-n);const i=Math.tan(n)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(n)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-n)+15,a=this._handles[1].screenPosition.clone().add(r.multiplyScalar(i)),o=this.adjustLabelTransform(this._label,a);this._label.style.transform=`translate3D(${o.x}px, ${o.y}px, 0)`},updateDOMColor(){this._line.style.backgroundColor=this._color,this._line2.style.backgroundColor=this._color,this._label.style.borderColor=this._color},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._line2),this._container.removeChild(this._label)},toggleDefaultAngle(){this._defaultAngle=!this._defaultAngle}}),Object.defineProperties(b.WidgetAngle.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._handles[2].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},angle:{get:function(){return this._opangle}}}),b.WidgetRectangle=function(e,t,r){let n;r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetRectangle",this._widgetType="Rectangle",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units",this._moving=!1,this._domHovered=!1,this._mesh=null,this._rectangle=null,this._label=null,this._handles=[];for(let i=0;i<2;i++)n=new b.WidgetHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new b.WidgetHandle(e,t,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners(),this._newPos1=new THREE.Vector3,this._newPos2=new THREE.Vector3},b.WidgetRectangle.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetRectangle,isWidgetRectangle:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._rectangle.addEventListener("mouseenter",this.onHover),this._rectangle.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._rectangle.removeEventListener("mouseenter",this.onHover),this._rectangle.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}),this.updateRoI(!0)}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.updateRoI(),this.update())},hideDOM(){this._handles.forEach(e=>e.hideDOM()),this._rectangle.style.display="none",this._label.style.display="none"},showDOM(){this._handles[0].showDOM(),this._handles[1].showDOM(),this._rectangle.style.display="",this._label.style.display=""},create(){this.createMesh(),this.createDOM()},createMesh(){let e=new THREE.PlaneGeometry(1,1),t=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2});this._mesh=new THREE.Mesh(e,t),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},createDOM(){this._rectangle=document.createElement("div"),this._rectangle.className="widget-rectangle",this._container.appendChild(this._rectangle),this._label=document.createElement("div"),this._label.className="widget-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let r=document.createElement("div");r.className="max-min",e.appendChild(r);let n=document.createElement("div");n.className="area",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()},updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)},updateMeshPosition(){if(this._mesh){let e=this._mesh.geometry;const t=this._newPos1.subVectors(this._handles[1].worldPosition,this._handles[0].worldPosition).projectOnVector(this._camera.up);e.vertices[0].copy(this._handles[0].worldPosition),e.vertices[1].copy(this._newPos2.addVectors(this._handles[0].worldPosition,t)),e.vertices[2].copy(this._newPos2.subVectors(this._handles[1].worldPosition,t)),e.vertices[3].copy(this._handles[1].worldPosition),e.verticesNeedUpdate=!0,e.computeBoundingSphere()}},updateRoI(e){const t=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min");if(e)return t.innerHTML="",void(r.innerHTML="");const n=b.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==n?(t.innerHTML=`Mean: ${n.mean.toFixed(1)} / SD: ${n.sd.toFixed(1)}`,r.innerHTML=`Max: ${n.max.toFixed()} / Min: ${n.min.toFixed()}`):(t.innerHTML="",r.innerHTML="")},updateDOMColor(){this._rectangle.style.borderColor=this._color,this._label.style.borderColor=this._color},updateDOM(){this.updateDOMColor();const e=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=b.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(e&&e.length>0&&this._stack.lps2IJK){const t=this.getRegionByXY(e,b.MedicalUtils.worldToData(this._stack.lps2IJK,this._handles[0].worldPosition)),r=this.getRegionByXY(e,b.MedicalUtils.worldToData(this._stack.lps2IJK,this._handles[1].worldPosition));null!==t&&null!==r&&t===r&&"cm"===e[t].unitsX&&"cm"===e[t].unitsY?(this._area*=Math.pow(e[t].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);"units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the area in cm²"),this._label.style.color=this._colors.error),this._label.querySelector(".area").innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`;const t=this.getRectData(this._handles[0].screenPosition,this._handles[1].screenPosition),r=this.adjustLabelTransform(this._label,this._handles[1].screenPosition.clone().add(t.paddingVector.multiplyScalar(15+this._label.offsetHeight/2)));this._rectangle.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)`,this._rectangle.style.width=t.width+"px",this._rectangle.style.height=t.height+"px",this._label.style.transform="translate3D("+r.x+"px,"+r.y+"px, 0)"},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._rectangle),this._container.removeChild(this._label),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._stack=null},getMeasurements(){return{area:this._area,units:this._units}}}),Object.defineProperties(b.WidgetRectangle.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update(),this.updateRoI()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}}),b.WidgetPolygon=function(e,t,r){r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetPolygon",this._widgetType="Polygon",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._newHandleRequired=!0,this._moving=!1,this._domHovered=!1,this._material=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];let n=new b.WidgetHandle(e,t,r);this.add(n),this._handles.push(n),this._moveHandle=new b.WidgetHandle(e,t,r),this.add(this._moveHandle),this._moveHandle.hide(),this.onRightClick=this.onRightClick.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()},b.WidgetPolygon.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetPolygon,isWidgetPolygon:!0,addEventListeners(){this._container.addEventListener("rightclick",this.onRightClick),this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("rightclick",this.onRightClick),this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e);let t=!1;this._handles.forEach(e=>t=t||e.hovered),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){let t=!1;this._handles.forEach(r=>{r.onStart(e),t=t||r.active}),this._initialized&&(this._moveHandle.onMove(e,!0),this._active=t||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update())},onMove(e){let t=!1;if(this.active)if(this._dragged=!0,this._newHandleRequired&&!this._initialized){this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let e=new b.WidgetHandle(this._targetMesh,this._controls,this._params);e.hovered=!0,e.active=!0,e.tracking=!0,this.add(e),this._handles.push(e),this.createLine(),this._newHandleRequired=!1}else{const t=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(e,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}this._handles.forEach(r=>{r.onMove(e),t=t||r.hovered}),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.update()},onEnd(){let e=this._handles.length,t=!1;!this._initialized&&e>1&&this._handles[e-2].screenPosition.distanceTo(this._handles[e-1].screenPosition)<10||(this._handles.forEach(e=>{e.onEnd(),t=t||e.active}),this._initialized?(this._dragged&&(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach(e=>e.selected=this._selected)),this._active=t||this._handles[e-1].active,this._dragged=!1,this._moving=!1,this.update()):this._newHandleRequired=!0)},onRightClick(){let e=this._handles.length;e<3||this._initialized||e>1&&this._handles[e-2].screenPosition.distanceTo(this._handles[e-1].screenPosition)<10||(this._handles[e-1].tracking=!1,this._handles.forEach(e=>e.onEnd()),this._active=!1,this._dragged=!1,this._moving=!1,this._initialized=!0,this.updateMesh(),this.updateDOMContent(),this.update())},create(){this.createMaterial(),this.createDOM()},createMaterial(){this._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2})},createDOM(){this.createLine(),this._label=document.createElement("div"),this._label.className="widget-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let r=document.createElement("div");r.className="max-min",e.appendChild(r);let n=document.createElement("div");n.className="area",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},createLine(){const e=document.createElement("div");e.className="widget-line",e.addEventListener("mouseenter",this.onHover),e.addEventListener("mouseleave",this.onHover),this._lines.push(e),this._container.appendChild(e)},hideDOM(){this._handles.forEach(e=>e.hideDOM()),this._lines.forEach(e=>e.style.display="none"),this._label.style.display="none"},showDOM(){this._handles.forEach(e=>e.showDOM()),this._lines.forEach(e=>e.style.display=""),this._label.style.display=""},update(){this.updateColor(),this._handles.forEach(e=>e.update()),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()},updateMesh(){let e=[];this._handles.forEach(t=>e.push(t.worldPosition));let t,r,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=b.MedicalUtils.centerOfMass(e);n.crossVectors(i.subVectors(e[0],o),a.subVectors(e[1],o)),i.subVectors(e[0],o).normalize(),a.crossVectors(i,n).normalize();let s=new THREE.Shape,l=new Float32Array(3*(e.length+1));n.subVectors(e[0],o),t=i.dot(n),r=a.dot(n),s.moveTo(t,r),l.set(e[0].toArray(),0);for(let u=1;u<e.length;u++)n.subVectors(e[u],o),t=i.dot(n),r=a.dot(n),s.lineTo(t,r),l.set(e[u].toArray(),3*u);n.subVectors(e[0],o),t=i.dot(n),r=a.dot(n),s.lineTo(t,r),l.set(e[0].toArray(),3*e.length);let u=new THREE.ShapeBufferGeometry(s,e.length);u.addAttribute("position",new THREE.BufferAttribute(l,3)),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose()),this._mesh=new THREE.Mesh(u,this._material),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)},updateMeshPosition(){},updateDOMColor(){this._lines.forEach(e=>e.style.backgroundColor=this._color),this._label.style.borderColor=this._color},updateDOMContent(e){const t=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min"),n=this._label.querySelector(".area");if(e)return t.innerHTML="",r.innerHTML="",void(n.innerHTML="");const i=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=b.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(i&&i.length>0&&this._stack.lps2IJK){let e,t,r=!0;this._handles.forEach(n=>{(null===(e=this.getRegionByXY(i,b.MedicalUtils.worldToData(this._stack.lps2IJK,n.worldPosition)))||"cm"!==i[e].unitsX||void 0!==t&&t!==e)&&(r=!1),t=e}),r?(this._area*=Math.pow(i[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let a="units"===this._units?"Calibration is required to display the area in cm². ":"";""===a||this._label.hasAttribute("title")?""===a&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",a),this._label.style.color=this._colors.error);const o=b.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==o?(t.innerHTML=`Mean: ${o.mean.toFixed(1)} / SD: ${o.sd.toFixed(1)}`,r.innerHTML=`Max: ${o.max.toFixed()} / Min: ${o.min.toFixed()}`):(t.innerHTML="",r.innerHTML=""),n.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`},updateDOMPosition(){let e=null;this._lines.forEach((t,r)=>{const n=this.getLineData(this._handles[r].screenPosition,this._handles[r+1===this._handles.length?0:r+1].screenPosition);t.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0) rotate(${n.transformAngle}rad)`,t.style.width=n.length+"px",(null===e||e.y<this._handles[r].screenPosition.y)&&(e=this._handles[r].screenPosition.clone())}),this._initialized&&(e.y+=15+this._label.offsetHeight/2,e=this.adjustLabelTransform(this._label,e),this._label.style.transform=`translate3D(${e.x}px, ${e.y}px, 0)`)},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach(e=>{e.removeEventListener("mouseenter",this.onHover),e.removeEventListener("mouseleave",this.onHover),this._container.removeChild(e)}),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null),this._stack=null},getMeasurements(){return{area:this._area,units:this._units}}}),Object.defineProperties(b.WidgetPolygon.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this._moveHandle.targetMesh=e,this.updateMesh(),this.updateDOMContent(),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach(t=>t.worldPosition.copy(e)),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}}),b.WidgetFreehand=function(e,t,r){r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetFreehand",this._widgetType="Freehand",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._moving=!1,this._domHovered=!1,this._material=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];let n=new b.WidgetHandle(e,t,r);this.add(n),this._handles.push(n),this._moveHandle=new b.WidgetHandle(e,t,r),this.add(this._moveHandle),this._moveHandle.hide(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()},b.WidgetFreehand.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetFreehand,isWidgetFreehand:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e);let t=!1;this._handles.forEach(e=>t=t||e.hovered),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){let t=!1;this._moveHandle.onMove(e,!0),this._handles.forEach(r=>{r.onStart(e),t=t||r.active}),this._active=t||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){let t=!1;if(this.active)if(this._dragged=!0,this._initialized){const t=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(e,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}else{this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let e=new b.WidgetHandle(this._targetMesh,this._controls,this._params);e.hovered=!0,e.active=!0,e.tracking=!0,this.add(e),this._handles.push(e),this.createLine()}this._handles.forEach(r=>{r.onMove(e),t=t||r.hovered}),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.active&&this._handles.length>2&&this.pushPopHandle(),this.update()},onEnd(){if(this._handles.length<3)return;let e=!1;this._handles.slice(0,-1).forEach(t=>{t.onEnd(),e=e||t.active}),this._dragged||!this._handles[this._handles.length-1].tracking?(this._handles[this._handles.length-1].tracking=!1,this._handles[this._handles.length-1].onEnd()):this._handles[this._handles.length-1].tracking=!1,this._lines.length<this._handles.length&&this.createLine(),!this._dragged&&this._initialized||(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach(e=>e.selected=this._selected)),this._active=e||this._handles[this._handles.length-1].active,this._dragged=!1,this._moving=!1,this._initialized=!0,this.update()},create(){this.createMaterial(),this.createDOM()},createMaterial(){this._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2})},createDOM(){this._label=document.createElement("div"),this._label.className="widget-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let r=document.createElement("div");r.className="max-min",e.appendChild(r);let n=document.createElement("div");n.className="area",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},createLine(){const e=document.createElement("div");e.className="widget-line",e.addEventListener("mouseenter",this.onHover),e.addEventListener("mouseleave",this.onHover),this._lines.push(e),this._container.appendChild(e)},hideDOM(){this._handles.forEach(e=>e.hideDOM()),this._lines.forEach(e=>e.style.display="none"),this._label.style.display="none"},showDOM(){this._handles.forEach(e=>e.showDOM()),this._lines.forEach(e=>e.style.display=""),this._label.style.display=""},update(){this.updateColor(),this._handles.forEach(e=>e.update()),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()},updateMesh(){let e=[];this._handles.forEach(t=>e.push(t.worldPosition));let t,r,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=b.MedicalUtils.centerOfMass(e);n.crossVectors(i.subVectors(e[0],o),a.subVectors(e[1],o)),i.subVectors(e[0],o).normalize(),a.crossVectors(i,n).normalize();let s=new THREE.Shape,l=new Float32Array(3*(e.length+1));n.subVectors(e[0],o),t=i.dot(n),r=a.dot(n),s.moveTo(t,r),l.set(e[0].toArray(),0);for(let u=1;u<e.length;u++)n.subVectors(e[u],o),t=i.dot(n),r=a.dot(n),s.lineTo(t,r),l.set(e[u].toArray(),3*u);n.subVectors(e[0],o),t=i.dot(n),r=a.dot(n),s.lineTo(t,r),l.set(e[0].toArray(),3*e.length);let u=new THREE.ShapeBufferGeometry(s,e.length);u.addAttribute("position",new THREE.BufferAttribute(l,3)),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose()),this._mesh=new THREE.Mesh(u,this._material),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)},updateMeshPosition(){},isPointOnLine(e,t,r){let n=new THREE.Vector3;return n.crossVectors(e.clone().sub(r),t.clone().sub(r)),!n.length()},pushPopHandle(){let e=this._handles[this._handles.length-3],t=this._handles[this._handles.length-2],r=this._handles[this._handles.length-1],n=this.isPointOnLine(e.worldPosition,t.worldPosition,r.worldPosition);return(n||e.screenPosition.distanceTo(r.screenPosition)<25)&&(this.remove(t),t.free(),this._handles[this._handles.length-2]=r,this._handles.pop(),this._container.removeChild(this._lines.pop())),n},updateDOMColor(){this._handles.length>=2&&this._lines.forEach(e=>e.style.backgroundColor=this._color),this._label.style.borderColor=this._color},updateDOMContent(e){const t=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min"),n=this._label.querySelector(".area");if(e)return t.innerHTML="",r.innerHTML="",void(n.innerHTML="");const i=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=b.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(i&&i.length>0&&this._stack.lps2IJK){let e,t,r=!0;this._handles.forEach(n=>{(null===(e=this.getRegionByXY(i,b.MedicalUtils.worldToData(this._stack.lps2IJK,n.worldPosition)))||"cm"!==i[e].unitsX||void 0!==t&&t!==e)&&(r=!1),t=e}),r?(this._area*=Math.pow(i[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let a="units"===this._units?"Calibration is required to display the area in cm². ":"";""===a||this._label.hasAttribute("title")?""===a&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",a),this._label.style.color=this._colors.error);const o=b.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==o?(t.innerHTML=`Mean: ${o.mean.toFixed(1)} / SD: ${o.sd.toFixed(1)}`,r.innerHTML=`Max: ${o.max.toFixed()} / Min: ${o.min.toFixed()}`):(t.innerHTML="",r.innerHTML=""),n.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`},updateDOMPosition(){if(this._handles.length<2)return;let e=null;this._lines.forEach((t,r)=>{const n=this.getLineData(this._handles[r].screenPosition,this._handles[r+1===this._handles.length?0:r+1].screenPosition);t.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0) rotate(${n.transformAngle}rad)`,t.style.width=n.length+"px",(null===e||e.y<this._handles[r].screenPosition.y)&&(e=this._handles[r].screenPosition.clone())}),this._initialized&&(e.y+=15+this._label.offsetHeight/2,e=this.adjustLabelTransform(this._label,e),this._label.style.transform=`translate3D(${e.x}px, ${e.y}px, 0)`)},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach(e=>{e.removeEventListener("mouseenter",this.onHover),e.removeEventListener("mouseleave",this.onHover),this._container.removeChild(e)}),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null),this._stack=null},getMeasurements(){return{area:this._area,units:this._units}}}),Object.defineProperties(b.WidgetFreehand.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this._moveHandle.targetMesh=e,this.updateMesh(),this.updateDOMContent(),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach(t=>t._worldPosition.copy(e)),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}}),b.WidgetAnnotation=function(e,t,r){let n;r=r||{},b.WidgetBase.call(this,e,t,r),this.name="widgetAnnotation",this._widgetType="Annotation",this._initialized=!1,this._movinglabel=null,this._labelmoved=!1,this._labelhovered=!1,this._manuallabeldisplay=!1,this._meshline=null,this._meshCone=null,this._line=null,this._dashline=null,this._label=null,this._labeltext=null,this._labelOffset=new THREE.Vector3,this._mouseLabelOffset=new THREE.Vector3,this._handles=[];for(let i=0;i<2;i++)n=new b.WidgetHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this.create(),this.initOffsets(),this.onMove=this.onMove.bind(this),this.onHoverlabel=this.onHoverlabel.bind(this),this.notonHoverlabel=this.notonHoverlabel.bind(this),this.changeLabelText=this.changeLabelText.bind(this),this.addEventListeners()},b.WidgetAnnotation.prototype=Object.assign(Object.create(b.WidgetBase.prototype),{constructor:b.WidgetAnnotation,isWidgetAnnotation:!0,addEventListeners(){this._label.addEventListener("mouseenter",this.onHoverlabel),this._label.addEventListener("mouseleave",this.notonHoverlabel),this._label.addEventListener("dblclick",this.changeLabelText),this._container.addEventListener("wheel",this.onMove)},removeEventListeners(){this._label.removeEventListener("mouseenter",this.onHoverlabel),this._label.removeEventListener("mouseleave",this.notonHoverlabel),this._label.removeEventListener("dblclick",this.changeLabelText),this._container.removeEventListener("wheel",this.onMove)},onHoverlabel(){this._labelhovered=!0,this._container.style.cursor="pointer"},notonHoverlabel(){this._labelhovered=!1,this._container.style.cursor="default"},onStart(e){if(this._labelhovered){const t=this.getMouseOffsets(e,this._container),r=this._handles[1].screenPosition.clone().sub(this._labelOffset);this._mouseLabelOffset=new THREE.Vector3(t.screenX-r.x,t.screenY-r.y,0),this._movinglabel=!0,this._labelmoved=!0}this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._labelhovered,this.update()},onMove(e){if(this._movinglabel){const t=this.getMouseOffsets(e,this._container);this._labelOffset=new THREE.Vector3(this._handles[1].screenPosition.x-t.screenX+this._mouseLabelOffset.x,this._handles[1].screenPosition.y-t.screenY+this._mouseLabelOffset.y,0),this._controls.enabled=!1}this._active&&(this._dragged=!0),this._handles[0].onMove(e),this._handles[1].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._labelhovered,this.update()},onEnd(){this._handles[0].onEnd(),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handles[0].selected=this._selected,this._handles[1].selected=this._selected),this._initialized||(this._labelOffset=this._handles[1].screenPosition.clone().sub(this._handles[0].screenPosition).multiplyScalar(.5),this.setLabelText(),this._initialized=!0),this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._movinglabel=!1,this.update()},setLabelText(){for(;!this._labeltext;)this._labeltext=prompt("Please enter the annotation text","");this.displayLabel()},changeLabelText(e){e.stopPropagation();let t=this._labeltext;this._labeltext=prompt("Please enter a new annotation text",this._label.innerHTML),null===this._labeltext&&(this._labeltext=t),this.displayLabel()},displayLabel(){this._label.innerHTML="string"==typeof this._labeltext&&this._labeltext.length>0?this._labeltext:"",this._label.style.display="",this._dashline.style.display="",this._label.style.transform=`translate3D(\n        ${this._handles[1].screenPosition.x-this._labelOffset.x-this._label.offsetWidth/2}px,\n        ${this._handles[1].screenPosition.y-this._labelOffset.y-this._label.offsetHeight/2-this._container.offsetHeight}px, 0)`},create(){this.createMesh(),this.createDOM()},createMesh(){let e=new THREE.LineBasicMaterial,t=new THREE.Geometry;t.vertices.push(this._handles[0].worldPosition),t.vertices.push(this._handles[1].worldPosition),this._meshline=new THREE.Line(t,e),this._meshline.visible=!0,this.add(this._meshline),(t=new THREE.CylinderGeometry(0,2,10)).translate(0,-5,0),t.rotateX(-Math.PI/2),this._meshCone=new THREE.Mesh(t,e),this._meshCone.visible=!0,this.add(this._meshCone),this.updateMeshColor()},createDOM(){this._line=document.createElement("div"),this._line.className="widget-line",this._container.appendChild(this._line),this._dashline=document.createElement("div"),this._dashline.className="widget-dashline",this._dashline.style.display="none",this._container.appendChild(this._dashline),this._label=document.createElement("div"),this._label.className="widget-label",this._label.style.display="none",this._container.appendChild(this._label),this.updateDOMColor()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()},updateMeshColor(){this._meshline&&this._meshline.material.color.set(this._color)},updateMeshPosition(){this._meshline&&(this._meshline.geometry.verticesNeedUpdate=!0),this._meshCone&&(this._meshCone.position.copy(this._handles[1].worldPosition),this._meshCone.lookAt(this._handles[0].worldPosition))},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=e.line.multiplyScalar(.5),r=this._handles[1].screenPosition.clone().sub(this._labelmoved?this._labelOffset:t),n=this.adjustLabelTransform(this._label,r);this._label.style.transform=`translate3D(${n.x}px, ${n.y}px, 0)`,this._manuallabeldisplay&&this.displayLabel();let i=this.getLineData(this._handles[0].screenPosition,r),a=this.getLineData(e.center,r),o=this.getLineData(this._handles[1].screenPosition,r);i.length>a.length&&(i=a),i.length>o.length&&(i=o),this._dashline.style.transform=`translate3D(${i.transformX}px, ${i.transformY}px, 0) rotate(${i.transformAngle}rad)`,this._dashline.style.width=i.length+"px"},updateDOMColor(){this._line.style.backgroundColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color,this._label.style.borderColor=this._color},hideDOM(){this._line.style.display="none",this._dashline.style.display="none",this._label.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._dashline.style.display="",this._label.style.display="",this._handles.forEach(e=>e.showDOM())},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._dashline),this._container.removeChild(this._label),this.remove(this._meshline),this._meshline.geometry.dispose(),this._meshline.material.dispose(),this._meshline=null,this.remove(this._meshCone),this._meshCone.geometry.dispose(),this._meshCone=null}}),Object.defineProperties(b.WidgetAnnotation.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}}}),b.WidgetEvent={medical:null,raycaster:new THREE.Raycaster,widgets:[],onMouseDown:function(e){if(!b.isCtrlKeyDown(e))return;let t=b.WidgetEvent.medical,r=b.WidgetEvent.raycaster,n=b.WidgetEvent.widgets,i=parseInt(this.id),a=t.children[i],o=a.children[0];if(!o.isMedicalSlicer)return;let s=a.userData.camera,l=a.userData.controls;for(let t=0,r=n.length;t<r;t++){let r=n[t];if(r.hovered)return void r.onStart(e)}this.style.cursor="default";let u=this.getBoundingClientRect(),c={x:(e.clientX-u.left)/u.width*2-1,y:-(e.clientY-u.top)/u.height*2+1};r.setFromCamera(c,s);let h=r.intersectObject(o.slice);if(0===h.length)return;if(n.length>0){let e=n[n.length-1];if(e._active||e._dragged)return}let d=o.stack,f=null;f=new b.WidgetRectangle(o.slice,l,{frameIndex:o.index,stack:d,worldPosition:h[0].point}),n.push(f),o.add(f)},onMouseUp:function(e){if(!b.isCtrlKeyDown(e))return;let t=b.WidgetEvent.widgets;if(2===e.button)for(let e=0,r=t.length;e<r;e++){let r=t[e];r.isWidgetPolygon&&r._active&&this.dispatchEvent(new CustomEvent("rightclick"))}for(let r=0,n=t.length;r<n;r++){let n=t[r];if(n.active)return void n.onEnd(e)}},onMouseMove:function(e){if(!b.isCtrlKeyDown(e))return;let t=b.WidgetEvent.widgets,r="default";for(let n=0,i=t.length;n<i;n++){let i=t[n];i.onMove(e),i.hovered&&(r="pointer")}this.style.cursor=r}};var P=r(39),C=r.n(P);class L extends C.a{constructor(e=null,t=null){super(),this._loaded=-1,this._totalLoaded=-1,this._parsed=-1,this._totalParsed=-1,this._data=[],this._container=e,this._progressBar=null,this._container&&t&&t.onStart&&(this._progressBar=t,this._progressBar.onStart())}free(){this._data=[],this._container=null,this._progressBar&&this._progressBar.onLoad()}fetch(e,t){return new Promise((r,n)=>{const i=new XMLHttpRequest;i.open("GET",e),i.crossOrigin=!0,i.responseType="arraybuffer",i.onloadstart=t=>{this.emit("fetch-start",{file:e,time:new Date})},i.onload=t=>{if(200===i.status||0===i.status){this._loaded=t.loaded,this._totalLoaded=t.total,this._progressBar&&this._progressBar.onProgress(e,this._loaded,this._totalLoaded);let n=i.response,a={url:e,buffer:n};this.emit("fetch-success",{file:e,time:new Date,totalLoaded:t.total}),r(a)}else n(i.statusText)},i.onerror=()=>{this.emit("fetch-error",{file:e,time:new Date}),n(i.statusText)},i.onabort=t=>{this.emit("fetch-abort",{file:e,time:new Date}),n(i.statusText||"Aborted")},i.ontimeout=()=>{this.emit("fetch-timeout",{file:e,time:new Date}),n(i.statusText)},i.onprogress=t=>{this._loaded=t.loaded,this._totalLoaded=t.total,this.emit("fetch-progress",{file:e,total:t.total,loaded:t.loaded,time:new Date}),this._progressBar&&this._progressBar.onProgress(e,this._loaded,this._totalLoaded)},i.onloadend=t=>{this.emit("fetch-end",{file:e,time:new Date})},t instanceof Map&&t.set(e,i),i.send()})}parse(e){return new Promise((t,r)=>{t(e)})}loadSequenceGroup(e,t){const r=[];return e.forEach(e=>{r.push(this.fetch(e,t))}),Promise.all(r).then(e=>this.parse(e)).then(e=>(this._data.push(e),e)).catch(function(e){"Aborted"!==e&&(window.console.log("oops... something went wrong..."),window.console.log(e))})}loadSequence(e,t){return this.fetch(e,t).then(e=>this.parse(e)).then(e=>(this._data.push(e),e)).catch(function(e){"Aborted"!==e&&(window.console.log("oops... something went wrong..."),window.console.log(e))})}load(e,t){Array.isArray(e)||(e=[e]),this.emit("load-start",{files:e,time:new Date});const r=[];return e.forEach(e=>{Array.isArray(e)?r.push(this.loadSequenceGroup(e,t)):r.push(this.loadSequence(e,t))}),Promise.all(r)}set data(e){this._data=e}get data(){return this._data}}class I{constructor(){this._id=-1}mergeModels(e,t){if(!this._validateModelArray(e)||!this._validateModelArray(t))return window.console.log("invalid inputs provided."),!1;for(let r=0,n=t.length;r<n;r++)for(let n=0,i=e.length;n<i&&!e[n].merge(t[r]);n++)n===e.length-1&&e.push(t[r]);return!0}merge(e){return!!this.validate(e)&&this._id===e._id}validate(e){return!(!e||null===e||"function"!=typeof e.merge)}_validateModelArray(e){if(null===e||Array!==e.constructor)return window.console.log("invalid model array provided."),!1;for(let t=0;t<e.length;t++)if(!e[t]||null===e[t]||"function"!=typeof e[t].validate||!e[t].validate(e[t]))return!1;return!0}}class O extends I{constructor(){super(),this._concatenationUID=-1,this._seriesInstanceUID=-1,this._transferSyntaxUID="",this._seriesNumber=-1,this._seriesDescription="",this._seriesDate="",this._studyDescription="",this._studyDate="",this._accessionNumber=-1,this._modality="Modality not set",this._dimensionIndexSequence=[],this._numberOfFrames=0,this._numberOfChannels=1,this._rawHeader=null,this._patientID="",this._patientName="",this._patientAge="",this._patientBirthdate="",this._patientSex="",this._segmentationType=null,this._segmentationSegments=[],this._stack=[]}validate(e){return!!(super.validate(e)&&"function"==typeof e.mergeSeries&&e.hasOwnProperty("_seriesInstanceUID")&&e.hasOwnProperty("_numberOfFrames")&&e.hasOwnProperty("_numberOfChannels")&&e.hasOwnProperty("_stack")&&void 0!==e._stack&&Array===e._stack.constructor)}merge(e){return!!this.validate(e)&&(this._seriesInstanceUID===e.seriesInstanceUID&&(e.stack[0]&&(0===this._stack[0]._numberOfFrames&&this._stack[0].computeNumberOfFrames(),this._stack[0].computeCosines(),0===e.stack[0]._numberOfFrames&&e.stack[0].computeNumberOfFrames(),e.stack[0].computeCosines()),this.mergeModels(this._stack,e.stack)))}mergeSeries(e){let t=[this];return this.mergeModels(t,e),t}set seriesInstanceUID(e){this._seriesInstanceUID=e}get seriesInstanceUID(){return this._seriesInstanceUID}set transferSyntaxUID(e){this._transferSyntaxUID=e}get transferSyntaxUID(){return this._transferSyntaxUID}get transferSyntaxUIDLabel(){switch(this._transferSyntaxUID){case"1.2.840.10008.1.2.4.90":return"JPEG 2000 Lossless";case"1.2.840.10008.1.2.4.91":return"JPEG 2000 Lossy";case"1.2.840.10008.1.2.4.57":return"JPEG Lossless, Nonhierarchical (Processes 14)";case"1.2.840.10008.1.2.4.70":return"JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])";case"1.2.840.10008.1.2.4.50":return"JPEG Baseline lossy process 1 (8 bit)";case"1.2.840.10008.1.2.4.51":return"JPEG Baseline lossy process 2 & 4 (12 bit)";case"1.2.840.10008.1.2":return"Implicit VR Little Endian";case"1.2.840.10008.1.2.1":return"Explicit VR Little Endian";case"1.2.840.10008.1.2.2":return"Explicit VR Big Endian";default:return`Unknown transfersyntax: ${this._transferSyntaxUID}`}}set studyDate(e){this._studyDate=e}get studyDate(){return this._studyDate}set studyDescription(e){this._studyDescription=e}get studyDescription(){return this._studyDescription}set seriesDate(e){this._seriesDate=e}get seriesDate(){return this._seriesDate}set seriesDescription(e){this._seriesDescription=e}get seriesDescription(){return this._seriesDescription}set rawHeader(e){this._rawHeader=e}get rawHeader(){return this._rawHeader}set patientID(e){this._patientID=e}get patientID(){return this._patientID}set patientName(e){this._patientName=e}get patientName(){return this._patientName}set patientAge(e){this._patientAge=e}get patientAge(){return this._patientAge}set patientBirthdate(e){this._patientBirthdate=e}get patientBirthdate(){return this._patientBirthdate}set patientSex(e){this._patientSex=e}get patientSex(){return this._patientSex}set numberOfFrames(e){this._numberOfFrames=e}get numberOfFrames(){return this._numberOfFrames}set numberOfChannels(e){this._numberOfChannels=e}get numberOfChannels(){return this._numberOfChannels}set stack(e){this._stack=e}get stack(){return this._stack}set modality(e){this._modality=e}get modality(){return this._modality}set segmentationType(e){this._segmentationType=e}get segmentationType(){return this._segmentationType}set segmentationSegments(e){this._segmentationSegments=e}get segmentationSegments(){return this._segmentationSegments}}const H=r(126);var D=new i.Vector3,N=new i.Vector3,F=new i.Matrix4,U=new i.Matrix4;function B(e=50,t=0,r=0){if(!(e>=0&&e<=100))return null;const[n,i,a]=this.cielab2XYZ(e,t,r);return this.xyz2RGB(n,i,a)}function z(e=[]){let t=[65535,-32768],r=e.length;for(let n=0;n<r;n++){let r=e[n];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}function j(e,t,r){return e*t+r}class V extends I{constructor(){super(),this._uid=null,this._stackID=-1,this._frame=[],this._numberOfFrames=0,this._rows=0,this._columns=0,this._numberOfChannels=1,this._bitsAllocated=8,this._pixelType=0,this._pixelRepresentation=0,this._rawData=[],this._textureSize=4096,this._textureType=0,this._textureUnits=7,this._textures=[],this._windowCenter=0,this._windowWidth=0,this._rescaleSlope=1,this._rescaleIntercept=0,this._minMax=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this._regMatrix=new i.Matrix4,this._ijk2LPS=new i.Matrix4,this._lps2IJK=new i.Matrix4,this._aabb2LPS=new i.Matrix4,this._lps2AABB=new i.Matrix4,this._dimensionsIJK=new i.Vector3,this._halfDimensionsIJK=new i.Vector3,this._spacing=new i.Vector3(1,1,1),this._spacingBetweenSlices=0,this._sliceThickness=0,this._origin=new i.Vector3,this._rightHanded=!0,this._xCosine=new i.Vector3(1,0,0),this._yCosine=new i.Vector3(0,1,0),this._zCosine=new i.Vector3(0,0,1),this._prepared=!1,this._packed=!1,this._packedPerPixel=1,this._modality="Modality not set",this._segmentationType=null,this._segmentationSegments=[],this._segmentationDefaultColor=[63,174,128],this._frameSegment=[],this._segmentationLUT=[],this._segmentationLUTO=[],this._invert=!1}prepareSegmentation(){this._frameSegment=this._frame;let e=[];this.computeCosines(),this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort);let t=-1;for(let r=0;r<this._frame.length;r++){if(e[t]&&e[t]._dist==this._frame[r]._dist)for(let n=0;n<e[t]._rows*e[t]._columns;n++)e[t]._pixelData[n]+=this._frame[r].pixelData[n]*this._frame[r]._referencedSegmentNumber;else{e.push(this._frame[r]),t++;for(let n=0;n<e[t]._rows*e[t]._columns;n++)e[t]._pixelData[n]*=this._frame[r]._referencedSegmentNumber}e[t].minMax=z(e[t]._pixelData)}let r={},n=0,i=this._segmentationSegments;for(let e=0;e<i.length;e++){let t=i[e];n=Math.max(n,parseInt(t.segmentNumber,10));let a=t.recommendedDisplayCIELab;r[t.segmentNumber]=null===a?this._segmentationDefaultColor:B(...a)}for(let e=0;e<=n;e++){let t=e/n,i=e?1:0,a=[0,0,0];r.hasOwnProperty(e.toString())&&(a=r[e.toString()]),a[0]/=255,a[1]/=255,a[2]/=255,this._segmentationLUT.push([t,...a]),this._segmentationLUTO.push([t,i])}this._frame=e}prepare(){"SEG"===this._modality&&this.prepareSegmentation(),this.computeNumberOfFrames(),this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK.set(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK.set(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this._numberOfFrames>1&&this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin.fromArray(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB();const e=Math.floor(this._frame.length/2),t=this._frame[e];this._rescaleSlope=t.rescaleSlope||1,this._rescaleIntercept=t.rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=j(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=j(this._minMax[1],this._rescaleSlope,this._rescaleIntercept),this._windowWidth=t.windowWidth||this._minMax[1]-this._minMax[0],this._windowCenter=t.windowCenter||this._minMax[0]+this._windowWidth/2,this._bitsAllocated=t.bitsAllocated,this._prepared=!0}packEchos(){let e=[];for(let t=0;t<this._frame.length;t+=4){let r=this._frame[t];for(let e=0;e<this._rows*this._columns;e++){for(let n=1;n<4;n++)r.pixelData[e]+=this._frame[t+n].pixelData[e];r.pixelData[e]/=4}e.push(r)}this._frame=e,this._numberOfFrames=this._frame.length,this._dimensionsIJK.set(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK.set(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)}computeNumberOfFrames(){if(!(this._frame&&this._frame.length>0))return window.console.warn("_frame doesn't contain anything...."),window.console.warn(this._frame),!1;this._numberOfFrames=this._frame.length}computeCosines(){if(this._frame&&this._frame[0]){let e=this._frame[0].cosines();this._xCosine.copy(e[0]),this._yCosine.copy(e[1]),this._zCosine.copy(e[2])}}orderFrames(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):this._frame[0].imagePosition?window.console.warn("warning: unexpected case found..."):window.console.warn("warning: You have null imagePosition...")}computeSpacing(){this.xySpacing(),this.zSpacing()}zSpacing(){this._numberOfFrames>1&&(this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame[1].dist!==this._frame[0].dist?(this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist):this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].sliceThickness&&(this._spacing.z=this._frame[0].sliceThickness))),0===this._spacing.z&&(this._spacing.z=1)}xySpacing(){if(this._frame&&this._frame[0]){let e=this._frame[0].spacingXY();this._spacing.x=e[0],this._spacing.y=e[1]}}computeMinMaxIntensities(){for(let e=0;e<this._frame.length;e++){let t=this._frame[e].minMax[0];Number.isNaN(t)||(this._minMax[0]=Math.min(this._minMax[0],t));let r=this._frame[e].minMax[1];Number.isNaN(r)||(this._minMax[1]=Math.max(this._minMax[1],r))}}computeIJK2LPS(){this._ijk2LPS.copy(function(e,t,r,n,a,o=new i.Matrix4){return F.set(e.x*n.y,t.x*n.x,r.x*n.z,a.x,e.y*n.y,t.y*n.x,r.y*n.z,a.y,e.z*n.y,t.z*n.x,r.z*n.z,a.z,0,0,0,1),F.premultiply(o),F}(this._xCosine,this._yCosine,this._zCosine,this._spacing,this._origin,this._regMatrix)),this._lps2IJK.getInverse(this._ijk2LPS)}computeLPS2AABB(){var e,t,r,n;this._aabb2LPS.copy((e=this._xCosine,t=this._yCosine,r=this._zCosine,n=this._origin,U.set(e.x,t.x,r.x,n.x,e.y,t.y,r.y,n.y,e.z,t.z,r.z,n.z,0,0,0,1),U)),this._lps2AABB.getInverse(this._aabb2LPS)}merge(e){return!!(this._stackID===e.stackID&&1===this._numberOfFrames&&1===e._numberOfFrames&&this._frame[0].columns===e.frame[0].columns&&this._frame[0].rows===e.frame[0].rows&&this._xCosine.equals(e.xCosine)&&this._yCosine.equals(e.yCosine)&&this._zCosine.equals(e.zCosine))&&this.mergeModels(this._frame,e.frame)}pack(){const e=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;(8===this._bitsAllocated&&1===this._numberOfChannels||1===this._bitsAllocated)&&(this._packedPerPixel=4),16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);const t=this._textureSize*this._textureSize;let r=Math.ceil(e/(t*this._packedPerPixel)),n=0,i=this._packedPerPixel*t;i>e&&(i=e),this._textureUnits<r&&(console.warn("Insufficient number of supported textures. Some frames will not be packed."),r=this._textureUnits);for(let a=0;a<r;a++){const r=this._packTo8Bits(this._numberOfChannels,this._frame,this._textureSize,n,i);this._textureType=r.textureType,this._rawData.push(r.data),n+=this._packedPerPixel*t,(i+=this._packedPerPixel*t)>e&&(i=e)}this._packed=!0,this._prepareTexture()}_prepareTexture(){let e=window.THREE;this._textures=[];for(let t=0;t<this._rawData.length;t++){let r=new e.DataTexture(this._rawData[t],this._textureSize,this._textureSize,this._textureType,e.UnsignedByteType,e.UVMapping,e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.NearestFilter,e.NearestFilter);r.needsUpdate=!0,r.flipY=!0,this._textures.push(r)}}_packTo8Bits(e,t,r,n,a){const o={textureType:null,data:null},s=t[0].bitsAllocated,l=t[0].pixelType;let u=0;this._minMax[0]<0&&(u-=this._minMax[0]);let c=0,h=0,d=0;const f=t[0].rows*t[0].columns;if(8===s&&1===e||1===s){let e=new Uint8Array(r*r*4),s=0,l=0;for(let r=n;r<a;r++){d=r%f;let n=t[h=~~(r/f)].pixelData[d]+u;Number.isNaN(n)||(e[4*s+l]=n),c++,s=Math.floor(c/4),l=c%4}o.textureType=i.RGBAFormat,o.data=e}else if(16===s&&1===e){let e=new Uint8Array(r*r*4),s=0,l=0;for(let r=n;r<a;r++){d=r%f;let n=t[h=~~(r/f)].pixelData[d]+u;Number.isNaN(n)||(e[4*s+2*l]=255&n,e[4*s+2*l+1]=n>>>8&255),c++,s=Math.floor(c/2),l=c%2}o.textureType=i.RGBAFormat,o.data=e}else if(32===s&&1===e&&0===l){let e=new Uint8Array(r*r*4);for(let r=n;r<a;r++){d=r%f;let n=t[h=~~(r/f)].pixelData[d]+u;Number.isNaN(n)||(e[4*c]=255&n,e[4*c+1]=n>>>8&255,e[4*c+2]=n>>>16&255,e[4*c+3]=n>>>24&255),c++}o.textureType=i.RGBAFormat,o.data=e}else if(32===s&&1===e&&1===l){let e=new Uint8Array(r*r*4);for(let r=n;r<a;r++){d=r%f;let n=t[h=~~(r/f)].pixelData[d]+u;if(!Number.isNaN(n)){let t=H(n).match(/.{1,8}/g);e[4*c]=parseInt(t[0],2),e[4*c+1]=parseInt(t[1],2),e[4*c+2]=parseInt(t[2],2),e[4*c+3]=parseInt(t[3],2)}c++}o.textureType=i.RGBAFormat,o.data=e}else if(8===s&&3===e){let e=new Uint8Array(r*r*3);for(let r=n;r<a;r++)h=~~(r/f),d=r%f,e[3*c]=t[h].pixelData[3*d],e[3*c+1]=t[h].pixelData[3*d+1],e[3*c+2]=t[h].pixelData[3*d+2],c++;o.textureType=i.RGBFormat,o.data=e}return o}worldCenter(){return this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS)}worldBoundingBox(){let e=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];const t=this._dimensionsIJK;var r=new i.Vector3;for(let n=0;n<=t.x;n+=t.x)for(let i=0;i<=t.y;i+=t.y)for(let a=0;a<=t.z;a+=t.z)r.set(n,i,a).applyMatrix4(this._ijk2LPS),e[0]=Math.min(e[0],r.x),e[1]=Math.max(e[1],r.x),e[2]=Math.min(e[2],r.y),e[3]=Math.max(e[3],r.y),e[4]=Math.min(e[4],r.z),e[5]=Math.max(e[5],r.z);return e}worldSliceOrientation(){function e(e){let t=Math.abs(e.x),r=Math.abs(e.y),n=t,i=0;return n<r&&(n=r,i=1),n<Math.abs(e.z)&&(i=2),i}return[e(this._xCosine),e(this._yCosine),e(this._zCosine)]}AABBox(){let e=D.set(0,0,0).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),t=N.copy(this._dimensionsIJK).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB);return new i.Vector3(Math.abs(e.x-t.x),Math.abs(e.y-t.y),Math.abs(e.z-t.z))}centerAABBox(){let e=this.worldCenter();return e.applyMatrix4(this._lps2AABB),e}static indexInDimensions(e,t){return e.x>=0&&e.y>=0&&e.z>=0&&e.x<t.x&&e.y<t.y&&e.z<t.z}_orderFrameOnDimensionIndicesArraySort(e,t){if("dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e.dimensionIndexValues)&&"dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues))for(let r=0;r<e.dimensionIndexValues.length;r++){if(parseInt(e.dimensionIndexValues[r],10)>parseInt(t.dimensionIndexValues[r],10))return 1;if(parseInt(e.dimensionIndexValues[r],10)<parseInt(t.dimensionIndexValues[r],10))return-1}else window.console.warn("One of the frames doesn't have a dimensionIndexValues array."),window.console.warn(e),window.console.warn(t);return 0}_computeDistanceArrayMap(e,t){return t.imagePosition&&(t.dist=t.imagePosition[0]*e.x+t.imagePosition[1]*e.y+t.imagePosition[2]*e.z),t}_sortDistanceArraySort(e,t){return e.dist-t.dist}_sortInstanceNumberArraySort(e,t){return e.instanceNumber-t.instanceNumber}_sortSopInstanceUIDArraySort(e,t){return e.sopInstanceUID-t.sopInstanceUID}set numberOfChannels(e){this._numberOfChannels=e}get numberOfChannels(){return this._numberOfChannels}set frame(e){this._frame=e}get frame(){return this._frame}set prepared(e){this._prepared=e}get prepared(){return this._prepared}set packed(e){this._packed=e}get packed(){return this._packed}set packedPerPixel(e){this._packedPerPixel=e}get packedPerPixel(){return this._packedPerPixel}set dimensionsIJK(e){this._dimensionsIJK=e}get dimensionsIJK(){return this._dimensionsIJK}set halfDimensionsIJK(e){this._halfDimensionsIJK=e}get halfDimensionsIJK(){return this._halfDimensionsIJK}set regMatrix(e){this._regMatrix=e}get regMatrix(){return this._regMatrix}set ijk2LPS(e){this._ijk2LPS=e}get ijk2LPS(){return this._ijk2LPS}set lps2IJK(e){this._lps2IJK=e}get lps2IJK(){return this._lps2IJK}set lps2AABB(e){this._lps2AABB=e}get lps2AABB(){return this._lps2AABB}set textureSize(e){this._textureSize=e}get textureSize(){return this._textureSize}set textureUnits(e){this._textureUnits=e}get textureUnits(){return this._textureUnits}set textureType(e){this._textureType=e}get textureType(){return this._textureType}set bitsAllocated(e){this._bitsAllocated=e}get bitsAllocated(){return this._bitsAllocated}set rawData(e){this._rawData=e}get rawData(){return this._rawData}get windowWidth(){return this._windowWidth}set windowWidth(e){this._windowWidth=e}get windowCenter(){return this._windowCenter}set windowCenter(e){this._windowCenter=e}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(e){this._rescaleSlope=e}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(e){this._rescaleIntercept=e}get xCosine(){return this._xCosine}set xCosine(e){this._xCosine=e}get yCosine(){return this._yCosine}set yCosine(e){this._yCosine=e}get zCosine(){return this._zCosine}set zCosine(e){this._zCosine=e}get minMax(){return this._minMax}set minMax(e){this._minMax=e}get stackID(){return this._stackID}set stackID(e){this._stackID=e}get pixelType(){return this._pixelType}set pixelType(e){this._pixelType=e}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(e){this._pixelRepresentation=e}set invert(e){this._invert=e}get invert(){return this._invert}set modality(e){this._modality=e}get modality(){return this._modality}get rightHanded(){return this._rightHanded}set rightHanded(e){this._rightHanded=e}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(e){this._spacingBetweenSlices=e}set segmentationSegments(e){this._segmentationSegments=e}get segmentationSegments(){return this._segmentationSegments}set segmentationType(e){this._segmentationType=e}get segmentationType(){return this._segmentationType}set segmentationLUT(e){this._segmentationLUT=e}get segmentationLUT(){return this._segmentationLUT}set segmentationLUTO(e){this._segmentationLUTO=e}get segmentationLUTO(){return this._segmentationLUTO}}class G extends I{constructor(){super(),this._sopInstanceUID=null,this._url=null,this._stackID=-1,this._invert=!1,this._frameTime=null,this._ultrasoundRegions=[],this._rows=0,this._columns=0,this._dimensionIndexValues=[],this._imagePosition=null,this._imageOrientation=null,this._rightHanded=!0,this._sliceThickness=1,this._spacingBetweenSlices=null,this._pixelPaddingValue=null,this._pixelRepresentation=0,this._pixelType=0,this._pixelSpacing=null,this._pixelAspectRatio=null,this._pixelData=null,this._instanceNumber=null,this._windowCenter=null,this._windowWidth=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._bitsAllocated=8,this._numberOfChannels=1,this._minMax=null,this._dist=null,this._index=-1,this._referencedSegmentNumber=-1}validate(e){return!!(super.validate(e)&&"function"==typeof e.cosines&&"function"==typeof e.spacingXY&&e.hasOwnProperty("_sopInstanceUID")&&e.hasOwnProperty("_dimensionIndexValues")&&e.hasOwnProperty("_imageOrientation")&&e.hasOwnProperty("_imagePosition"))}merge(e){return!!this.validate(e)&&!!(this._compareArrays(this._dimensionIndexValues,e.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,e.imageOrientation)&&this._compareArrays(this._imagePosition,e.imagePosition)&&this._instanceNumber===e.instanceNumber&&this._sopInstanceUID===e.sopInstanceUID)}cosines(){let e=[new i.Vector3(1,0,0),new i.Vector3(0,1,0),new i.Vector3(0,0,1)];return this._imageOrientation&&6===this._imageOrientation.length?(e[0].set(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),e[1].set(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]),e[0].lengthSq()>0&&e[1].lengthSq()>0&&e[2].crossVectors(e[0],e[1]).normalize()):(window.console.log("No valid image orientation for frame"),window.console.log(this),window.console.log("Returning default orientation.")),this._rightHanded||e[2].negate(),e}spacingXY(){let e=[1,1];return this.pixelSpacing?(e[0]=this.pixelSpacing[0],e[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(e[0]=1,e[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),e}getPixelData(e,t){return e>=0&&e<this._columns&&t>=0&&t<this._rows?this.pixelData[e+this._columns*t]:null}setPixelData(e,t,r){this.pixelData[e+this._columns*t]=r}getImageDataUrl(){const e=document.createElement("canvas");e.width=this._columns,e.height=this._rows;const t=e.getContext("2d"),r=t.createImageData(e.width,e.height);return r.data.set(this._frameToCanvas()),t.putImageData(r,0,0),e.toDataURL()}_frameToCanvas(){const e=this._columns*this._rows,t={invert:this._invert,min:this._minMax[0],padding:this._pixelPaddingValue};let r=new Uint8Array(4*e);if(null!==t.padding){t.min=this._minMax[1];for(let e=0,r=this._pixelData.length;e<r;e++)this._pixelData[e]!==t.padding&&(t.min=Math.min(t.min,this._pixelData[e]))}if(this._windowWidth&&null!==this._windowCenter){const e=this._rescaleIntercept||0,r=this._rescaleSlope||1;t.min=Math.max((this._windowCenter-this._windowWidth/2-e)/r,t.min),t.max=Math.min((this._windowCenter+this._windowWidth/2-e)/r,this._minMax[1])}else t.max=this._minMax[1];if(t.range=t.max-t.min||255,1===this._numberOfChannels)for(let n=0;n<e;n++){const e=this._pixelTo8Bit(this._pixelData[n],t);r[4*n]=e,r[4*n+1]=e,r[4*n+2]=e,r[4*n+3]=255}else if(3===this._numberOfChannels)for(let n=0;n<e;n++)r[4*n]=this._pixelTo8Bit(this._pixelData[3*n],t),r[4*n+1]=this._pixelTo8Bit(this._pixelData[3*n+1],t),r[4*n+2]=this._pixelTo8Bit(this._pixelData[3*n+2],t),r[4*n+3]=255;return r}_pixelTo8Bit(e,t){let r=e<=t.min||e===t.padding?0:255;return e>t.min&&e<t.max&&(r=Math.round(255*(e-t.min)/t.range)),Number.isNaN(r)?0:t.invert?255-r:r}_compareArrays(e,t){return e===t||!(!e||!t||e.join()!==t.join())}get frameTime(){return this._frameTime}set frameTime(e){this._frameTime=e}get ultrasoundRegions(){return this._ultrasoundRegions}set ultrasoundRegions(e){this._ultrasoundRegions=e}get rows(){return this._rows}set rows(e){this._rows=e}get columns(){return this._columns}set columns(e){this._columns=e}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(e){this._spacingBetweenSlices=e}get sliceThickness(){return this._sliceThickness}set sliceThickness(e){this._sliceThickness=e}get imagePosition(){return this._imagePosition}set imagePosition(e){this._imagePosition=e}get imageOrientation(){return this._imageOrientation}set imageOrientation(e){this._imageOrientation=e}get windowWidth(){return this._windowWidth}set windowWidth(e){this._windowWidth=e}get windowCenter(){return this._windowCenter}set windowCenter(e){this._windowCenter=e}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(e){this._rescaleSlope=e}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(e){this._rescaleIntercept=e}get bitsAllocated(){return this._bitsAllocated}set bitsAllocated(e){this._bitsAllocated=e}get dist(){return this._dist}set dist(e){this._dist=e}get pixelSpacing(){return this._pixelSpacing}set pixelSpacing(e){this._pixelSpacing=e}get pixelAspectRatio(){return this._pixelAspectRatio}set pixelAspectRatio(e){this._pixelAspectRatio=e}get minMax(){return this._minMax}set minMax(e){this._minMax=e}get dimensionIndexValues(){return this._dimensionIndexValues}set dimensionIndexValues(e){this._dimensionIndexValues=e}get instanceNumber(){return this._instanceNumber}set instanceNumber(e){this._instanceNumber=e}get pixelData(){return this._pixelData}set pixelData(e){this._pixelData=e}set sopInstanceUID(e){this._sopInstanceUID=e}get sopInstanceUID(){return this._sopInstanceUID}get pixelPaddingValue(){return this._pixelPaddingValue}set pixelPaddingValue(e){this._pixelPaddingValue=e}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(e){this._pixelRepresentation=e}get pixelType(){return this._pixelType}set pixelType(e){this._pixelType=e}get url(){return this._url}set url(e){this._url=e}get referencedSegmentNumber(){return this._referencedSegmentNumber}set referencedSegmentNumber(e){this._referencedSegmentNumber=e}get rightHanded(){return this._rightHanded}set rightHanded(e){this._rightHanded=e}get index(){return this._index}set index(e){this._index=e}get invert(){return this._invert}set invert(e){this._invert=e}get numberOfChannels(){return this._numberOfChannels}set numberOfChannels(e){this._numberOfChannels=e}}class W{constructor(){this._rightHanded=!0}pixelRepresentation(){return 0}pixelPaddingValue(e=0){return null}modality(){return"unknown"}segmentationType(){return"unknown"}segmentationSegments(){return[]}referencedSegmentNumber(e){return-1}rightHanded(){return this._rightHanded}spacingBetweenSlices(){return null}numberOfChannels(){return 1}sliceThickness(){return null}dimensionIndexValues(e=0){return null}instanceNumber(e=0){return e}windowCenter(e=0){return null}windowWidth(e=0){return null}rescaleSlope(e=0){return 1}rescaleIntercept(e=0){return 0}ultrasoundRegions(e=0){return[]}frameTime(e=0){return null}_decompressUncompressed(){}_swap16(e){return(255&e)<<8|e>>8&255}_swap32(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}invert(){return!1}transferSyntaxUID(){return"no value provided"}studyDate(){return"no value provided"}studyDescription(){return"no value provided"}seriesDate(){return"no value provided"}seriesDescription(){return"no value provided"}rawHeader(){return"no value provided"}patientID(){return"no value provided"}patientName(){return"no value provided"}patientAge(){return"no value provided"}patientBirthdate(){return"no value provided"}patientSex(){return"no value provided"}minMaxPixelData(e=[]){let t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],r=e.length;for(let n=0;n<r;n++){let r=e[n];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}}var X=r(20);const Y=function(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){const r=t,n=e.rows*e.columns,i=new ArrayBuffer(n*e.samplesPerPixel),a=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let l=0;const u=a.getInt32(0,!0);for(let e=0;e<u;++e){l=e*n;let t=a.getInt32(4*(e+1),!0),i=a.getInt32(4*(e+2),!0);0===i&&(i=r.length);const c=n*u;for(;t<i;){const e=o[t++];if(e>=0&&e<=127)for(let r=0;r<e+1&&l<c;++r)s[l]=o[t++],l++;else if(e<=-1&&e>=-127){const r=o[t++];for(let t=0;t<1-e&&l<c;++t)s[l]=r,l++}}}return e.pixelData=new Uint8Array(i),e}(e,t):function(e,t){const r=t,n=e.rows*e.columns,i=new ArrayBuffer(n*e.samplesPerPixel),a=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let l=0;const u=a.getInt32(0,!0);for(let t=0;t<u;++t){l=t;let i=a.getInt32(4*(t+1),!0),c=a.getInt32(4*(t+2),!0);0===c&&(c=r.length);const h=n*u;for(;i<c;){const t=o[i++];if(t>=0&&t<=127)for(let r=0;r<t+1&&l<h;++r)s[l]=o[i++],l+=e.samplesPerPixel;else if(t<=-1&&t>=-127){const r=o[i++];for(let n=0;n<1-t&&l<h;++n)s[l]=r,l+=e.samplesPerPixel}}}return e.pixelData=new Uint8Array(i),e}(e,t);if(16===e.bitsAllocated)return function(e,t){const r=t,n=e.rows*e.columns,i=new ArrayBuffer(n*e.samplesPerPixel*2),a=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i),l=a.getInt32(0,!0);for(let e=0;e<l;++e){let t=0;const i=0===e?1:0;let l=a.getInt32(4*(e+1),!0),u=a.getInt32(4*(e+2),!0);for(0===u&&(u=r.length);l<u;){const e=o[l++];if(e>=0&&e<=127)for(let r=0;r<e+1&&t<n;++r)s[2*t+i]=o[l++],t++;else if(e<=-1&&e>=-127){const r=o[l++];for(let a=0;a<1-e&&t<n;++a)s[2*t+i]=r,t++}}}return 0===e.pixelRepresentation?e.pixelData=new Uint16Array(i):e.pixelData=new Int16Array(i),e}(e,t);throw new Error("unsupported pixel format for RLE")};let q,Z=r(138),J=r(139),K=r(141),Q=r(142);function $(e){let t=Number(e);if(t!=t){const r=(e.match(/\./g)||[]).length;if(1===(e.match(/\,/g)||[]).length&&r<2){const n=0===r?".":"",i=e.replace(/,/g,n);t=Number(i)}t!=t&&(console.error(`String could not be converted to number (${e}). Setting value to "1.0".`),t=1)}return t}class ee extends W{constructor(e,t){super(),this._id=t,this._arrayBuffer=e.buffer;let r=new Uint8Array(this._arrayBuffer);this._dataSet=null;try{this._dataSet=Z.parseDicom(r)}catch(e){throw console.log(e),new Error("parsers.dicom could not parse the file")}}seriesInstanceUID(){return this._dataSet.string("x0020000e")}studyInstanceUID(){return this._dataSet.string("x0020000d")}modality(){return this._dataSet.string("x00080060")}segmentationType(){return this._dataSet.string("x00620001")}segmentationSegments(){let e=[],t=this._dataSet.elements.x00620002;if(!t)return e;for(let r=0;r<t.items.length;r++){let n=this._recommendedDisplayCIELab(t.items[r]),i=this._segmentationCode(t.items[r]),a=t.items[r].dataSet.uint16("x00620004"),o=t.items[r].dataSet.string("x00620005"),s=t.items[r].dataSet.string("x00620008");e.push({recommendedDisplayCIELab:n,segmentationCodeDesignator:i.segmentationCodeDesignator,segmentationCodeValue:i.segmentationCodeValue,segmentationCodeMeaning:i.segmentationCodeMeaning,segmentNumber:a,segmentLabel:o,segmentAlgorithmType:s})}return e}_segmentationCode(e){let t="unknown",r="unknown",n="unknown",i=e.dataSet.elements.x00082218;return i&&i.items&&i.items.length>0&&(t=i.items[0].dataSet.string("x00080102"),r=i.items[0].dataSet.string("x00080100"),n=i.items[0].dataSet.string("x00080104")),{segmentationCodeDesignator:t,segmentationCodeValue:r,segmentationCodeMeaning:n}}_recommendedDisplayCIELab(e){if(!e.dataSet.elements.x0062000d)return null;let t=e.dataSet.elements.x0062000d.dataOffset,r=e.dataSet.elements.x0062000d.length,n=e.dataSet.byteArray.slice(t,t+r),i=new Uint16Array(r/2);for(let e=0;e<r/2;e++)i[e]=(n[2*e+1]<<8)+n[2*e];return[i[0]/65535*100,i[1]/65535*255-128,i[2]/65535*255-128]}rawHeader(){return this._dataSet}sopInstanceUID(e=0){return this._findStringEverywhere("x2005140f","x00080018",e)}transferSyntaxUID(){return this._dataSet.string("x00020010")}studyDate(){return this._dataSet.string("x00080020")}studyDescription(){return this._dataSet.string("x00081030")}seriesDate(){return this._dataSet.string("x00080021")}seriesDescription(){return this._dataSet.string("x0008103e")}patientName(){return this._dataSet.string("x00100010")}patientID(){return this._dataSet.string("x00100020")}patientBirthdate(){return this._dataSet.string("x00100030")}patientSex(){return this._dataSet.string("x00100040")}patientAge(){return this._dataSet.string("x00101010")}photometricInterpretation(){return this._dataSet.string("x00280004")}planarConfiguration(){let e=this._dataSet.uint16("x00280006");return void 0===e&&(e=null),e}samplesPerPixel(){return this._dataSet.uint16("x00280002")}numberOfFrames(){let e=this._dataSet.intString("x00280008");return void 0===e&&(e=null),e}numberOfChannels(){let e=1,t=this.photometricInterpretation();return"RGB"!==t&&"PALETTE COLOR"!==t&&"YBR_FULL"!==t&&"YBR_FULL_422"!==t&&"YBR_PARTIAL_422"!==t&&"YBR_PARTIAL_420"!==t&&"YBR_RCT"!==t||(e=3),e}invert(){return"MONOCHROME1"===this.photometricInterpretation()}imageOrientation(e=0){let t=this._findStringEverywhere("x00209116","x00200037",e);return t&&(t=t.split("\\").map($)),t}referencedSegmentNumber(e=0){let t=-1,r=this._findInGroupSequence("x52009230","x0062000a",e);return null!==r&&(t=r.uint16("x0062000b")),t}pixelAspectRatio(){let e=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return void 0===e[0]&&(e=null),e}imagePosition(e=0){let t=this._findStringEverywhere("x00209113","x00200032",e);return t&&(t=t.split("\\").map($)),t}instanceNumber(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r)if(r.items[e].dataSet.elements.x2005140f){t=r.items[e].dataSet.elements.x2005140f.items[0].dataSet.intString("x00200013")}else void 0===(t=this._dataSet.intString("x00200013"))&&(t=null);else void 0===(t=this._dataSet.intString("x00200013"))&&(t=null);return t}pixelSpacing(e=0){let t=this._findStringEverywhere("x00289110","x00280030",e);if(null===t&&void 0===(t=this._dataSet.string("x00181164"))&&(t=null),t){const e=t.split("\\");2!==e.length?(console.error(`DICOM spacing format is not supported (could not split string on "\\"): ${t}`),t=null):t=e.map($)}return t}ultrasoundRegions(e=0){const t=this._dataSet.elements.x00186011;if(!t||!t.items)return[];const r=[];return t.items.forEach(e=>{r.push({x0:e.dataSet.uint32("x00186018"),y0:e.dataSet.uint32("x0018601a"),x1:e.dataSet.uint32("x0018601c"),y1:e.dataSet.uint32("x0018601e"),axisX:e.dataSet.int32("x00186020")||null,axisY:e.dataSet.int32("x00186022")||null,unitsX:this._getUnitsName(e.dataSet.uint16("x00186024")),unitsY:this._getUnitsName(e.dataSet.uint16("x00186026")),deltaX:e.dataSet.double("x0018602c"),deltaY:e.dataSet.double("x0018602e")})}),r}frameTime(e=0){let t,r=this._dataSet.uint16("x00280009",1),n=this._dataSet.intString("x00082144");return"number"==typeof r&&(r=r.toString(16),t=this._dataSet.floatString("x0018"+r)),void 0===t&&"number"==typeof n&&(t=1e3/n),void 0===t&&(t=null),t}rows(e=0){let t=this._dataSet.uint16("x00280010");return void 0===t&&(t=null),t}columns(e=0){let t=this._dataSet.uint16("x00280011");return void 0===t&&(t=null),t}pixelType(e=0){return 0}pixelRepresentation(e=0){return this._dataSet.uint16("x00280103")}pixelPaddingValue(e=0){let t=this._dataSet.int16("x00280120");return void 0===t&&(t=null),t}bitsAllocated(e=0){return this._dataSet.uint16("x00280100")}highBit(e=0){return this._dataSet.uint16("x00280102")}rescaleIntercept(e=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",e)}rescaleSlope(e=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",e)}windowCenter(e=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",e)}windowWidth(e=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",e)}sliceThickness(e=0){return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",e)}spacingBetweenSlices(e=0){let t=this._dataSet.floatString("x00180088");return void 0===t&&(t=null),t}dimensionIndexValues(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r){let n=r.items[e].dataSet.elements.x00209111;if(null!=n){let e=(n=n.items[0].dataSet).elements.x00209157;if(null!=e){let r=e.length/4;t=[];for(let e=0;e<r;e++)t.push(n.uint32("x00209157",e))}}}return t}inStackPositionNumber(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r){t=r.items[e].dataSet.elements.x00209111.items[0].dataSet.uint32("x00209057")}else t=null;return t}stackID(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r){t=r.items[e].dataSet.elements.x00209111.items[0].dataSet.intString("x00209056")}else t=null;return t}extractPixelData(e=0){let t=this._decodePixelData(e);return this.numberOfChannels()>1?this._convertColorSpace(t):t}_findInGroupSequence(e,t,r){let n=this._dataSet.elements[e];if(void 0!==n){let e=n.items[r].dataSet.elements[t];if(void 0!==e)return e.items[0].dataSet}return null}_findStringInGroupSequence(e,t,r,n){let i=this._findInGroupSequence(e,t,n);return null!==i?i.string(r):null}_findStringInFrameGroupSequence(e,t,r){return this._findStringInGroupSequence("x52009229",e,t,0)||this._findStringInGroupSequence("x52009230",e,t,r)}_findStringEverywhere(e,t,r){let n=this._findStringInFrameGroupSequence(e,t,r);if(null===n){const e="x00540022";n=this._findStringInSequence(e,t)}return null===n&&(n=this._dataSet.string(t)),void 0===n&&(n=null),n}_findStringInSequence(e,t,r){const n=this._dataSet.elements[e];let i;return n&&(i=n.items[0].dataSet.string(t)),void 0===i&&(i=null),i}_findFloatStringInGroupSequence(e,t,r,n){let i=this._dataSet.floatString(r);return void 0===i&&null!==(i=this._findInGroupSequence(e,t,n))?i.floatString(r):i}_findFloatStringInFrameGroupSequence(e,t,r){return this._findFloatStringInGroupSequence("x52009229",e,t,0)||this._findFloatStringInGroupSequence("x52009230",e,t,r)}_decodePixelData(e=0){let t=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t)return this._decodeJ2K(e);if("1.2.840.10008.1.2.5"===t)return this._decodeRLE(e);if("1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t)return this._decodeJPEGLossless(e);if("1.2.840.10008.1.2.4.50"===t||"1.2.840.10008.1.2.4.51"===t)return this._decodeJPEGBaseline(e);if("1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t)return this._decodeUncompressed(e);if("1.2.840.10008.1.2.2"===t){let t=this._decodeUncompressed(e);return this._swapFrame(t)}throw{error:`no decoder for transfer syntax ${t}`}}framesAreFragmented(){return this._dataSet.intString("x00280008")!==this._dataSet.elements.x7fe00010.fragments.length}getEncapsulatedImageFrame(e){return this._dataSet.elements.x7fe00010&&this._dataSet.elements.x7fe00010.basicOffsetTable.length?Z.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,e):this.framesAreFragmented()?Z.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,e,Z.createJPEGBasicOffsetTable(this._dataSet,this._dataSet.elements.x7fe00010)):Z.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,e)}_decodeJpx(e=0){const t=new Q;if(t.parse(this.getEncapsulatedImageFrame(e)),1!==t.componentsCount)throw new Error("JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected");if(1!==t.tiles.length)throw new Error("JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected");return t.tiles[0].items}_decodeOpenJPEG(e=0){const t=this.getEncapsulatedImageFrame(e),r=this.bitsAllocated(e)<=8?1:2,n=1===this.pixelRepresentation(e),i=q._malloc(t.length);q.writeArrayToMemory(t,i);const a=q._malloc(4),o=q._malloc(4),s=q._malloc(4),l=q._malloc(4),u=q._malloc(4),c=q.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[i,t.length,a,o,s,l,u]),h=q.getValue(a,"*");if(0!==c)return console.log("[opj_decode] decoding failed!"),q._free(i),q._free(h),q._free(s),q._free(l),q._free(o),void q._free(u);const d=q.getValue(s,"i32")*q.getValue(l,"i32")*q.getValue(u,"i32"),f=new Int32Array(q.HEAP32.buffer,h,d);let p;if(1===r)if(Uint8Array.from)p=Uint8Array.from(f);else{p=new Uint8Array(d);for(let e=0;e<d;e++)p[e]=f[e]}else if(n)if(Int16Array.from)p=Int16Array.from(f);else{p=new Int16Array(d);for(let e=0;e<d;e++)p[e]=f[e]}else if(Uint16Array.from)p=Uint16Array.from(f);else{p=new Uint16Array(d);for(let e=0;e<d;e++)p[e]=f[e]}return q._free(i),q._free(a),q._free(h),q._free(o),q._free(s),q._free(l),q._free(u),p}_decodeJ2K(e=0){return void 0===X?this._decodeJpx(e):q||(q=X())&&q._jp2_decode?this._decodeOpenJPEG(e):this._decodeJpx(e)}_decodeRLE(e=0){const t=this.bitsAllocated(e),r=this.planarConfiguration(),n=this.columns(),i=this.rows(),a=this.samplesPerPixel(e),o={pixelRepresentation:this.pixelRepresentation(e),bitsAllocated:t,planarConfiguration:r,columns:n,rows:i,samplesPerPixel:a},s=Z.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,e);return Y(o,s).pixelData}_decodeJPEGLossless(e=0){let t=this.getEncapsulatedImageFrame(e),r=this.pixelRepresentation(e),n=this.bitsAllocated(e)<=8?1:2,i=(new J.lossless.Decoder).decode(t.buffer,t.byteOffset,t.length,n);return 0===r?2===n?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)}_decodeJPEGBaseline(e=0){let t=this.getEncapsulatedImageFrame(e),r=this.rows(e),n=this.columns(e),i=this.bitsAllocated(e),a=new K;return a.parse(t),8===i?a.getData(n,r):16===i?a.getData16(n,r):void 0}_decodeUncompressed(e=0){let t=this.pixelRepresentation(e),r=this.bitsAllocated(e),n=this._dataSet.elements.x7fe00010.dataOffset,i=this.numberOfChannels(),a=this.rows(e)*this.columns(e)*i,o=0,s=this._dataSet.byteArray.buffer;if(0===t&&8===r)return o=n+e*a,new Uint8Array(s,o,a);if(0===t&&16===r)return o=n+e*a*2,new Uint16Array(s,o,a);if(1===t&&16===r)return o=n+e*a*2,new Int16Array(s,o,a);if(0===t&&32===r)return o=n+e*a*4,new Uint32Array(s,o,a);if(0===t&&1===r){let t=new ArrayBuffer(a),r=new Uint8Array(t);o=n+e*a;let i=0,l=e*a,u=e*a+a,c=Math.floor(l/8),h=l-8*c,d=Math.ceil(u/8),f=new Uint8Array(s,n);for(let e=c;e<=d;e++){for(;h<8;){switch(h){case 0:r[i]=1&f[e];break;case 1:r[i]=f[e]>>>1&1;break;case 2:r[i]=f[e]>>>2&1;break;case 3:r[i]=f[e]>>>3&1;break;case 4:r[i]=f[e]>>>4&1;break;case 5:r[i]=f[e]>>>5&1;break;case 6:r[i]=f[e]>>>6&1;break;case 7:r[i]=f[e]>>>7&1}if(h++,++i>=a)return r}h=0}}}_interpretAsRGB(e){return-1!==["RGB","YBR_RCT","YBR_ICT","YBR_FULL_422"].indexOf(e)}_convertColorSpace(e){let t=null,r=this.photometricInterpretation(),n=this.planarConfiguration();const i=this._interpretAsRGB(r);if(i&&0===n)t=e;else if(i&&1===n){if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array)){throw new Error(`unsuported typed array: ${e}`)}t=new Uint16Array(e.length)}let r=e.length/3,n=0,i=0,a=r,o=2*r;for(let s=0;s<r;s++)t[n++]=e[i++],t[n++]=e[a++],t[n++]=e[o++]}else{if("YBR_FULL"!==r){throw new Error(`photometric interpolation not supported: ${r}`)}{if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array)){throw new Error(`unsuported typed array: ${e}`)}t=new Uint16Array(e.length)}let r=e.length/3,n=0,i=0;for(let a=0;a<r;a++){let r=e[n++],a=e[n++],o=e[n++];t[i++]=r+1.402*(o-128),t[i++]=r-.34414*(a-128)-.71414*(o-128),t[i++]=r+1.772*(a-128)}}}return t}_swapFrame(e){let t=this.bitsAllocated();if(16===t)for(let t=0;t<e.length;t++)e[t]=this._swap16(e[t]);else if(32===t)for(let t=0;t<e.length;t++)e[t]=this._swap32(e[t]);return e}_getUnitsName(e){const t={0:"none",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm2",9:"cm2/sec",10:"cm3",11:"cm3/sec",12:"degrees"};return t.hasOwnProperty(e)?t[e]:"none"}}class te extends W{constructor(e,t){super(),this._id=t,this._url=e.url,this._header={},this._buffer=null;try{(new TextDecoder).decode(e.mhdBuffer).split("\n").forEach(e=>{let t=e.split("=");2===t.length&&(this._header[t[0].trim()]=t[1].trim())}),this._header.DimSize=this._header.DimSize.split(" "),this._header.ElementSpacing=this._header.ElementSpacing.split(" "),this._header.TransformMatrix=this._header.TransformMatrix.split(" "),this._header.Offset=this._header.Offset.split(" "),this._buffer=e.rawBuffer}catch(e){window.console.log("ooops... :(")}}rightHanded(){let e=this._header.AnatomicalOrientation;return this._rightHanded="RAS"===e||"RPI"===e||"LPS"===e||"LAI"===e,this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return parseInt(this._header.DimSize[2],10)}sopInstanceUID(e=0){return e}rows(e=0){return parseInt(this._header.DimSize[1],10)}columns(e=0){return parseInt(this._header.DimSize[0],10)}pixelType(e=0){let t=0;return"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(t=1),t}bitsAllocated(e=0){let t=1;return"MET_UCHAR"===this._header.ElementType||"MET_CHAR"===this._header.ElementType?t=8:"MET_USHORT"===this._header.ElementType||"MET_SHORT"===this._header.ElementType?t=16:"MET_UINT"!==this._header.ElementType&&"MET_INT"!==this._header.ElementType&&"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(t=32),t}pixelSpacing(e=0){return[parseFloat(this._header.ElementSpacing[1],10),parseFloat(this._header.ElementSpacing[0],10),parseFloat(this._header.ElementSpacing[2],10)]}imageOrientation(e=0){let t=this._header.AnatomicalOrientation.match(/L/)?-1:1,r=this._header.AnatomicalOrientation.match(/P/)?-1:1,n=new i.Vector3(parseFloat(this._header.TransformMatrix[0])*t,parseFloat(this._header.TransformMatrix[1])*r,parseFloat(this._header.TransformMatrix[2]));n.normalize();let a=new i.Vector3(parseFloat(this._header.TransformMatrix[3])*t,parseFloat(this._header.TransformMatrix[4])*r,parseFloat(this._header.TransformMatrix[5]));return a.normalize(),[n.x,n.y,n.z,a.x,a.y,a.z]}imagePosition(e=0){return[parseFloat(this._header.Offset[0]),parseFloat(this._header.Offset[1]),parseFloat(this._header.Offset[2])]}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this._buffer,r=this.numberOfChannels(),n=this.rows(e)*this.columns(e)*r;this.rightHanded()||(e=this.numberOfFrames()-1-e);let i=e*n;return"MET_CHAR"===this._header.ElementType?new Int8Array(t,i,n):"MET_UCHAR"===this._header.ElementType?new Uint8Array(t,i,n):"MET_SHORT"===this._header.ElementType?(i*=2,new Int16Array(t,i,n)):"MET_USHORT"===this._header.ElementType?(i*=2,new Uint16Array(t,i,n)):"MET_INT"===this._header.ElementType?(i*=4,new Int32Array(t,i,n)):"MET_UINT"===this._header.ElementType?(i*=4,new Uint32Array(t,i,n)):"MET_FLOAT"===this._header.ElementType?(i*=4,new Float32Array(t,i,n)):void 0}}var re=r(11),ne=r.n(re);class ie extends W{constructor(e,t){if(super(),this._id=t,this._arrayBuffer=e.buffer,this._url=e.url,this._dataSet=null,this._niftiHeader=null,this._niftiImage=null,this._ordered=!0,this._orderedData=null,this._qfac=1,!ne.a.isNIFTI(this._arrayBuffer)){throw new Error("parsers.nifti could not parse the file")}this._dataSet=ne.a.readHeader(this._arrayBuffer),this._niftiImage=ne.a.readImage(this._dataSet,this._arrayBuffer)}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.dims[3]}numberOfChannels(){let e=1;return this._dataSet.dims[0]>=5?(e=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?e=3:2304===this._dataSet.datatypeCode&&(e=4),e}sopInstanceUID(e=0){return e}rows(e=0){return this._dataSet.dims[2]}columns(e=0){return this._dataSet.dims[1]}pixelType(e=0){let t=0;return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(t=1),t}bitsAllocated(e=0){return this._dataSet.numBitsPerVoxel}pixelSpacing(e=0){return[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]}sliceThickness(){return null}imageOrientation(e=0){if(this._dataSet.qform_code>0){let e=0,t=this._dataSet.quatern_b,r=this._dataSet.quatern_c,n=this._dataSet.quatern_d;return(e=1-(t*t+r*r+n*n))<1e-7?(t*=e=1/Math.sqrt(t*t+r*r+n*n),r*=e,n*=e,e=0):e=Math.sqrt(e),this._dataSet.pixDims[0]<0&&(this._rightHanded=!1),[-(e*e+t*t-r*r-n*n),-2*(t*r+e*n),2*(t*n-e*r),-2*(t*r-e*n),-(e*e+r*r-t*t-n*n),2*(r*n+e*t)]}if(this._dataSet.sform_code>0){return[...[-this._dataSet.affine[0][0],-this._dataSet.affine[0][1],this._dataSet.affine[0][2]],...[-this._dataSet.affine[1][0],-this._dataSet.affine[1][1],this._dataSet.affine[0][2]]]}return this._dataSet.qform_code,[1,0,0,0,1,0]}imagePosition(e=0){return[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]}dimensionIndexValues(e=0){return null}instanceNumber(e=0){return e}windowCenter(e=0){return null}windowWidth(e=0){return null}rescaleSlope(e=0){return this._dataSet.scl_slope}rescaleIntercept(e=0){return this._dataSet.scl_inter}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this.numberOfChannels(),r=this.rows(e)*this.columns(e)*t,n=e*r,i=this._niftiImage;if(this._ordered||null!==this._orderedData||this._reorderData(),null!==this._orderedData)return this._orderedData.slice(n,n+r);if(2===this._dataSet.datatypeCode)return new Uint8Array(i,n,r);if(256===this._dataSet.datatypeCode)return new Int8Array(i,n,r);if(512===this._dataSet.datatypeCode)return n*=2,new Uint16Array(i,n,r);if(4===this._dataSet.datatypeCode)return n*=2,new Int16Array(i,n,r);if(8===this._dataSet.datatypeCode)return n*=4,new Int32Array(i,n,r);if(16===this._dataSet.datatypeCode){n*=4;const e=new Float32Array(i,n,r);for(let t=0;t<e.length;t++)e[t]!==1/0&&e[t]!==-1/0||(e[t]=0);return e}window.console.warn(`Unknown data type: datatypeCode : ${this._dataSet.datatypeCode}`)}_reorderData(){let e=this.numberOfChannels(),t=this.rows()*this.columns()*e,r=this._niftiImage,n=t*this.numberOfFrames(),i=null;this._orderedData=null,2===this._dataSet.datatypeCode?(i=new Uint8Array(r,0,n),this._orderedData=new Uint8Array(i.length)):256===this._dataSet.datatypeCode?(i=new Int8Array(r,0,n),this._orderedData=new Int8Array(i.length)):512===this._dataSet.datatypeCode?(i=new Uint16Array(r,0,n),this._orderedData=new Uint16Array(i.length)):4===this._dataSet.datatypeCode?(i=new Int16Array(r,0,n),this._orderedData=new Int16Array(i.length)):16===this._dataSet.datatypeCode&&(i=new Float32Array(r,0,n),this._orderedData=new Float32Array(i.length));let a=i.length/3,o=0,s=0,l=a,u=2*a;for(let e=0;e<a;e++)this._orderedData[o++]=i[s++],this._orderedData[o++]=i[l++],this._orderedData[o++]=i[u++];this._ordered=!0}}let ae=r(12),oe=r(144);class se extends W{constructor(e,t){super(),this._id=t,this._arrayBuffer=e.buffer,this._url=e.url,this._dataSet=null,this._unpackedData=null;try{this._dataSet=oe.parse(this._arrayBuffer)}catch(e){window.console.log("ooops... :(")}}rightHanded(){return this._dataSet.space&&(this._dataSet.space.match(/^right-anterior-superior/)||this._dataSet.space.match(/^left-posterior-superior/)?this._rightHanded=!0:this._rightHanded=!1),this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.sizes[2]}numberOfChannels(){return 1}sopInstanceUID(e=0){return e}rows(e=0){return this._dataSet.sizes[1]}columns(e=0){return this._dataSet.sizes[0]}pixelType(e=0){let t=0;return"float"===this._dataSet.type&&(t=1),t}bitsAllocated(e=0){let t=1;return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?t=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?t=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(t=32),t}pixelSpacing(e=0){if(this._dataSet.spaceDirections){const e=new i.Vector3(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2]),t=new i.Vector3(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),r=new i.Vector3(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[e.length(),t.length(),r.length()]}return[1,1,1]}imageOrientation(e=0){if(this._dataSet.space){let e=this._dataSet.space.match(/right/)?-1:1,t=this._dataSet.space.match(/anterior/)?-1:1,r=new i.Vector3(this._dataSet.spaceDirections[0][0]*e,this._dataSet.spaceDirections[0][1]*t,this._dataSet.spaceDirections[0][2]);r.normalize();let n=new i.Vector3(this._dataSet.spaceDirections[1][0]*e,this._dataSet.spaceDirections[1][1]*t,this._dataSet.spaceDirections[1][2]);return n.normalize(),[r.x,r.y,r.z,n.x,n.y,n.z]}return[1,0,0,0,1,0]}imagePosition(e=0){return this._dataSet.spaceOrigin?[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]:[0,0,0]}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this._dataSet.buffer;const r=this.numberOfChannels(),n=this.rows(e)*this.columns(e)*r;this.rightHanded()||(e=this.numberOfFrames()-1-e);let i=e*n;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){let e=ae.inflate(this._dataSet.buffer);this._unpackedData=e.buffer,t=this._unpackedData}else"gzip"===this._dataSet.encoding&&(t=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?new Int8Array(t,i,n):"uint8"===this._dataSet.type?new Uint8Array(t,i,n):"int16"===this._dataSet.type||"short"===this._dataSet.type?(i*=2,new Int16Array(t,i,n)):"uint16"===this._dataSet.type?(i*=2,new Uint16Array(t,i,n)):"int32"===this._dataSet.type?(i*=4,new Int32Array(t,i,n)):"uint32"===this._dataSet.type?(i*=4,new Uint32Array(t,i,n)):"float"===this._dataSet.type?(i*=4,new Float32Array(t,i,n)):void 0}}class le extends W{constructor(e,t){if(super(),this._id=t,this._url=e.url,this._buffer=null,this._bufferPos=0,this._dataPos=0,this._pixelData=null,this._version=1,this._width=0,this._height=0,this._depth=0,this._nframes=0,this._type=le.MRI_UCHAR,this._dof=0,this._goodRASFlag=0,this._spacingXYZ=[1,1,1],this._Xras=[-1,0,0],this._Yras=[0,0,-1],this._Zras=[0,1,0],this._Cras=[0,0,0],this._tr=0,this._flipAngle=0,this._te=0,this._ti=0,this._fov=0,this._tags=[],this._origin=[0,0,0],this._imageOrient=[0,0,0,0,0,0],this._buffer=e.buffer,this._version=this._readInt(),this._swapEndian=!1,1==this._version);else{if(16777216!=this._version){throw new Error("MGH/MGZ parser: Unknown Endian.  Version reports: "+this._version)}this._swapEndian=!0,this._version=this._swap32(this._version)}this._width=this._readInt(),this._height=this._readInt(),this._depth=this._readInt(),this._nframes=this._readInt(),this._type=this._readInt(),this._dof=this._readInt(),this._goodRASFlag=this._readShort(),this._spacingXYZ=this._readFloat(3),this._Xras=this._readFloat(3),this._Yras=this._readFloat(3),this._Zras=this._readFloat(3),this._Cras=this._readFloat(3),this._bufferPos=284;let r=this._width*this._height*this._depth*this._nframes;this._width,this._height,this._depth;switch(this._type){case le.MRI_UCHAR:this._pixelData=this._readUChar(r);break;case le.MRI_INT:this._pixelData=this._readInt(r);break;case le.MRI_FLOAT:this._pixelData=this._readFloat(r);break;case le.MRI_SHORT:this._pixelData=this._readShort(r);break;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}this._tr=this._readFloat(1),this._flipAngle=this._readFloat(1),this._te=this._readFloat(1),this._ti=this._readFloat(1),this._fov=this._readFloat(1);let n=new TextDecoder,a=this._tagReadStart();for(;null!=a[0];){let e=a[0],t=a[1],r=void 0;switch(e){case le.TAG_OLD_MGH_XFORM:case le.TAG_MGH_XFORM:r=this._readChar(t);break;default:r=this._readChar(t)}r=n.decode(r),this._tags.push({tagType:e,tagValue:r}),a=this._tagReadStart()}const o=(new i.Vector3).fromArray(this._Xras),s=(new i.Vector3).fromArray(this._Yras),l=(new i.Vector3).crossVectors(o,s),u=(new i.Vector3).fromArray(this._Zras);l.angleTo(u)>Math.PI/2&&(this._rightHanded=!1),this._imageOrient=[-this._Xras[0],-this._Xras[1],this._Xras[2],-this._Yras[0],-this._Yras[1],this._Yras[2]];let c=this._width/2,h=this._height/2,d=this._depth/2;for(let e=0;e<3;++e)this._origin[e]=this._Cras[e]-(this._Xras[e]*this._spacingXYZ[0]*c+this._Yras[e]*this._spacingXYZ[1]*h+this._Zras[e]*this._spacingXYZ[2]*d);this._origin=[-this._origin[0],-this._origin[1],this._origin[2]]}seriesInstanceUID(){return this._url}numberOfFrames(){return this._depth}sopInstanceUID(e=0){return e}rows(e=0){return this._width}columns(e=0){return this._height}pixelType(e=0){switch(this._type){case le.MRI_UCHAR:case le.MRI_INT:case le.MRI_SHORT:return 0;case le.MRI_FLOAT:return 1;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}bitsAllocated(e=0){switch(this._type){case le.MRI_UCHAR:return 8;case le.MRI_SHORT:return 16;case le.MRI_INT:case le.MRI_FLOAT:return 32;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}pixelSpacing(e=0){return this._spacingXYZ}imageOrientation(e=0){return this._imageOrient}imagePosition(e=0){return this._origin}extractPixelData(e=0){let t=this._width*this._height;return this._pixelData.slice(e*t,(e+1)*t)}_readInt(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*e));this._bufferPos+=4*e;let r=void 0;if(1==e)r=t.getInt32(0,this._swapEndian);else{r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.getInt32(4*n,this._swapEndian)}return r}_readShort(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+2*e));this._bufferPos+=2*e;let r=void 0;if(1==e)r=t.getInt16(0,this._swapEndian);else{r=new Int16Array(e);for(let n=0;n<e;n++)r[n]=t.getInt16(2*n,this._swapEndian)}return r}_readLong(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+8*e));this._bufferPos+=8*e;let r=new Uint16Array(e);for(let n=0;n<e;n++){let e=0,i=0;this._swapendian?e=4:i=4;let a=t.getInt32(8*n+e,this._swapEndian),o=t.getInt32(8*n+i,this._swapEndian);0!=a&&(console.log("Unable to read Int64 with high word: "+a+"low word: "+o),o=void 0),r[n]=o}return 0==e?void 0:1==e?r[0]:r}_readChar(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+e));this._bufferPos+=e;let r=void 0;if(1==e)r=t.getInt8(0,this._swapEndian);else{r=new Int8Array(e);for(let n=0;n<e;n++)r[n]=t.getInt8(n,this._swapEndian)}return r}_readUChar(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+e));this._bufferPos+=e;let r=void 0;if(1==e)r=t.getUint8(0,this._swapEndian);else{r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=t.getUint8(n,this._swapEndian)}return r}_readFloat(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*e));this._bufferPos+=4*e;let r=void 0;if(1==e)r=t.getFloat32(0,this._swapEndian);else{r=new Float32Array(e);for(let n=0;n<e;n++)r[n]=t.getFloat32(4*n,this._swapEndian)}return r}_tagReadStart(){if(this._bufferPos>=this._buffer.byteLength)return[void 0,void 0];let e=this._readInt(),t=void 0;switch(e){case le.TAG_OLD_MGH_XFORM:t=this._readInt(),t-=1;break;case le.TAG_OLD_SURF_GEOM:case le.TAG_OLD_USEREALRAS:case le.TAG_OLD_COLORTABLE:t=0;break;default:t=this._readLong()}return null==t&&(e=void 0),[e,t]}}le.MRI_UCHAR=0,le.MRI_INT=1,le.MRI_LONG=2,le.MRI_FLOAT=3,le.MRI_SHORT=4,le.MRI_BITMAP=5,le.MRI_TENSOR=6,le.MRI_FLOAT_COMPLEX=7,le.MRI_DOUBLE_COMPLEX=8,le.MRI_RGB=9,le.TAG_OLD_COLORTABLE=1,le.TAG_OLD_USEREALRAS=2,le.TAG_CMDLINE=3,le.TAG_USEREALRAS=4,le.TAG_COLORTABLE=5,le.TAG_GCAMORPH_GEOM=10,le.TAG_GCAMORPH_TYPE=11,le.TAG_GCAMORPH_LABELS=12,le.TAG_OLD_SURF_GEOM=20,le.TAG_SURF_GEOM=21,le.TAG_OLD_MGH_XFORM=30,le.TAG_MGH_XFORM=31,le.TAG_GROUP_AVG_SURFACE_AREA=32,le.TAG_AUTO_ALIGN=33,le.TAG_SCALAR_DOUBLE=40,le.TAG_PEDIR=41,le.TAG_MRI_FRAME=42,le.TAG_FIELDSTRENGTH=43;const ue=r(12);var ce={};function he(e,t,r,n){var i=void 0,a=void 0,o=void 0,s=void 0,l=(new THREE.Vector3).addVectors(n.max,n.min).multiplyScalar(.5),u=(new THREE.Vector3).subVectors(n.max,l),c=(new THREE.Vector3).subVectors(e,l),h=(new THREE.Vector3).subVectors(t,l),d=(new THREE.Vector3).subVectors(r,l),f=(new THREE.Vector3).subVectors(h,c),p=(new THREE.Vector3).subVectors(d,h),m=(new THREE.Vector3).subVectors(c,d),v=new THREE.Vector3(0,-f.z,f.y),g=new THREE.Vector3(0,-p.z,p.y),y=new THREE.Vector3(0,-m.z,m.y),_=new THREE.Vector3(f.z,0,-f.x),b=new THREE.Vector3(p.z,0,-p.x),E=new THREE.Vector3(m.z,0,-m.x),w=new THREE.Vector3(-f.y,f.x,0),x=new THREE.Vector3(-p.y,p.x,0),T=new THREE.Vector3(-m.y,m.x,0);if(i=c.dot(v),a=h.dot(v),o=d.dot(v),s=u.y*Math.abs(f.z)+u.z*Math.abs(f.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(g),a=h.dot(g),o=d.dot(g),s=u.y*Math.abs(p.z)+u.z*Math.abs(p.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(y),a=h.dot(y),o=d.dot(y),s=u.y*Math.abs(m.z)+u.z*Math.abs(m.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(_),a=h.dot(_),o=d.dot(_),s=u.x*Math.abs(f.z)+u.z*Math.abs(f.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(b),a=h.dot(b),o=d.dot(b),s=u.x*Math.abs(p.z)+u.z*Math.abs(p.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(E),a=h.dot(E),o=d.dot(E),s=u.x*Math.abs(m.z)+u.z*Math.abs(m.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(w),a=h.dot(w),o=d.dot(w),s=u.x*Math.abs(f.y)+u.y*Math.abs(f.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(x),a=h.dot(x),o=d.dot(x),s=u.x*Math.abs(p.y)+u.y*Math.abs(p.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(T),a=h.dot(T),o=d.dot(T),s=u.x*Math.abs(m.y)+u.y*Math.abs(m.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(Math.max(c.x,h.x,d.x)<-u.x||Math.min(c.x,h.x,d.x)>u.x)return!1;if(Math.max(c.y,h.y,d.y)<-u.y||Math.min(c.y,h.y,d.y)>u.y)return!1;if(Math.max(c.z,h.z,d.z)<-u.z||Math.min(c.z,h.z,d.z)>u.z)return!1;var S=new THREE.Plane;return S.normal=(new THREE.Vector3).copy(p).cross(f).normalize(),S.constant=S.normal.dot(e),function(e,t){var r=(new THREE.Vector3).addVectors(e.max,e.min).multiplyScalar(.5),n=(new THREE.Vector3).subVectors(e.max,r),i=n.x*Math.abs(t.normal.x)+n.y*Math.abs(t.normal.y)+n.z*Math.abs(t.normal.z),a=t.normal.dot(r)-t.constant;return Math.abs(a)<=i}(n,S)}function de(e,t){var r=0;return e.center.x<t.min.x&&(r+=(t.min.x-e.center.x)*(t.min.x-e.center.x)),e.center.x>t.max.x&&(r+=(e.center.x-t.max.x)*(e.center.x-t.max.x)),e.center.y<t.min.y&&(r+=(t.min.y-e.center.y)*(t.min.y-e.center.y)),e.center.y>t.max.y&&(r+=(e.center.y-t.max.y)*(e.center.y-t.max.y)),e.center.z<t.min.z&&(r+=(t.min.z-e.center.z)*(t.min.z-e.center.z)),e.center.z>t.max.z&&(r+=(e.center.z-t.max.z)*(e.center.z-t.max.z)),r<=e.radius*e.radius}function fe(e,t,r,n,i){var a=(new THREE.Vector3).subVectors(t,e.center),o=(new THREE.Vector3).subVectors(r,e.center),s=(new THREE.Vector3).subVectors(n,e.center),l=e.radius*e.radius,u=(new THREE.Vector3).crossVectors(o.clone().sub(a),s.clone().sub(a)),c=a.dot(u),h=u.dot(u);if(c*c>l*h)return!1;var d=a.dot(a),f=a.dot(o),p=a.dot(s),m=o.dot(o),v=o.dot(s),g=s.dot(s);if(d>l&f>d&p>d||m>l&f>m&v>m||g>l&p>g&v>g)return!1;var y=(new THREE.Vector3).subVectors(o,a),_=(new THREE.Vector3).subVectors(s,o),b=(new THREE.Vector3).subVectors(a,s),E=f-d,w=v-m,x=p-g,T=y.dot(y),S=_.dot(_),M=b.dot(b),R=(new THREE.Vector3).subVectors(a.multiplyScalar(T),y.multiplyScalar(E)),A=(new THREE.Vector3).subVectors(o.multiplyScalar(S),_.multiplyScalar(w)),k=(new THREE.Vector3).subVectors(s.multiplyScalar(M),b.multiplyScalar(x)),P=(new THREE.Vector3).subVectors(s.multiplyScalar(T),R),C=(new THREE.Vector3).subVectors(a.multiplyScalar(S),A),L=(new THREE.Vector3).subVectors(o.multiplyScalar(M),k);if(R.dot(R)>l*T*T&&R.dot(P)>=0||A.dot(A)>l*S*S&&A.dot(C)>=0||k.dot(k)>l*M*M&&k.dot(L)>=0)return!1;var I=Math.sqrt(c*c/h)-e.radius-1,O=new THREE.Vector3(-i.x,-i.y,-i.z);return{distance:I,contactPoint:e.center.clone().add(O.multiplyScalar(I))}}function pe(e,t,r,n,i){var a=n.clone().sub(r),o=i.clone().sub(r),s=e.clone().sub(t),l=a.clone().cross(o),u=s.dot(l);if(u<=0)return!1;var c=e.clone().sub(r),h=c.dot(l);if(h<0)return 0;if(h>u)return 0;var d=s.clone().cross(c),f=o.dot(d);if(f<0||f>u)return 0;var p=-1*a.clone().dot(d);if(p<0||f+p>u)return 0;var m=1/u;h*=m;var v=1-(f*=m)-(p*=m),g=r.clone().multiplyScalar(v),y=n.clone().multiplyScalar(f),_=i.clone().multiplyScalar(p);return{contactPoint:g.clone().add(y).add(_)}}function me(e,t,r){this.min=e,this.max=t,this.maxDepth=r,this.nodes=[];for(var n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=0;o<this.maxDepth;o++){this.nodes.push([]);var s=Math.pow(2,o),l=Math.pow(4,o);n.subVectors(this.max,this.min).divideScalar(s);for(var u=0,c=Math.pow(8,o);u<c;u++){var h=u%s,d=~~(u/l),f=~~(u/s)%s,p=this.min.x+h*n.x,m=this.min.y+d*n.y,v=this.min.z+f*n.z;i.set(p,m,v),a.copy(i).add(n);var g=me.getMortonNumber(h,d,f);this.nodes[o][g]=new ve(this,o,g,i,a)}}}function ve(e,t,r,n,i){this.tree=e,this.depth=t,this.mortonNumber=r,this.min=new THREE.Vector3(n.x,n.y,n.z),this.max=new THREE.Vector3(i.x,i.y,i.z),this.trianglePool=[]}ce.LoadersVolume=class extends L{parse(e){return this.emit("parse-start",{file:e.url,time:new Date}),new Promise((t,r)=>{setTimeout(()=>{t(new Promise((t,r)=>{let n=e;if(Array.isArray(n)||(n=[n]),n.forEach(e=>{this._preprocess(e)}),1===n.length)n=n[0];else{let e=n.filter(this._filterByExtension.bind(null,"MHD")),t=n.filter(this._filterByExtension.bind(null,"RAW"));2===n.length&&1===e.length&&1===t.length&&(n.url=e[0].url,n.extension=e[0].extension,n.mhdBuffer=e[0].buffer,n.rawBuffer=t[0].buffer)}let i=this._parser(n.extension);i||(this.emit("parse-error",{file:e.url,time:new Date,error:n.filename+"can not be parsed."}),r(n.filename+" can not be parsed."));let a=null;try{a=new i(n,0)}catch(t){console.warn(t),this.emit("parse-error",{file:e.url,time:new Date,error:t}),r(t)}let o=new O;o.rawHeader=a.rawHeader(),o.seriesInstanceUID=a.seriesInstanceUID(),o.transferSyntaxUID=a.transferSyntaxUID(),o.seriesDate=a.seriesDate(),o.seriesDescription=a.seriesDescription(),o.studyDate=a.studyDate(),o.studyDescription=a.studyDescription(),o.numberOfFrames=a.numberOfFrames(),o.numberOfFrames||(o.numberOfFrames=1),o.numberOfChannels=a.numberOfChannels(),o.modality=a.modality(),"SEG"===o.modality&&(o.segmentationType=a.segmentationType(),o.segmentationSegments=a.segmentationSegments()),o.patientID=a.patientID(),o.patientName=a.patientName(),o.patientAge=a.patientAge(),o.patientBirthdate=a.patientBirthdate(),o.patientSex=a.patientSex();let s=new V;s.numberOfChannels=a.numberOfChannels(),s.pixelRepresentation=a.pixelRepresentation(),s.pixelType=a.pixelType(),s.invert=a.invert(),s.spacingBetweenSlices=a.spacingBetweenSlices(),s.modality=o.modality,"SEG"===s.modality&&(s.segmentationType=o.segmentationType,s.segmentationSegments=o.segmentationSegments),o.stack.push(s),setTimeout(this.parseFrameClosure(o,s,e.url,0,a,t,r),0)}))},10)})}parseFrameClosure(e,t,r,n,i,a,o){return()=>{this.parseFrame(e,t,r,n,i,a,o)}}parseFrame(e,t,r,n,i,a,o){let s=new G;s.sopInstanceUID=i.sopInstanceUID(n),s.url=r,s.index=n,s.invert=t.invert,s.frameTime=i.frameTime(n),s.ultrasoundRegions=i.ultrasoundRegions(n),s.rows=i.rows(n),s.columns=i.columns(n),s.numberOfChannels=t.numberOfChannels,s.pixelPaddingValue=i.pixelPaddingValue(n),s.pixelRepresentation=t.pixelRepresentation,s.pixelType=t.pixelType,s.pixelData=i.extractPixelData(n),s.pixelSpacing=i.pixelSpacing(n),s.spacingBetweenSlices=i.spacingBetweenSlices(n),s.sliceThickness=i.sliceThickness(n),s.imageOrientation=i.imageOrientation(n),s.rightHanded=i.rightHanded(),t.rightHanded=s.rightHanded,null===s.imageOrientation&&(s.imageOrientation=[1,0,0,0,1,0]),s.imagePosition=i.imagePosition(n),s.dimensionIndexValues=i.dimensionIndexValues(n),s.bitsAllocated=i.bitsAllocated(n),s.instanceNumber=i.instanceNumber(n),s.windowCenter=i.windowCenter(n),s.windowWidth=i.windowWidth(n),s.rescaleSlope=i.rescaleSlope(n),s.rescaleIntercept=i.rescaleIntercept(n),s.minMax=i.minMaxPixelData(s.pixelData),"SEG"===e.modality&&(s.referencedSegmentNumber=i.referencedSegmentNumber(n)),t.frame.push(s),this._parsed=n+1,this._totalParsed=e.numberOfFrames,this.emit("parsing",{file:r,total:this._totalParsed,parsed:this._parsed,time:new Date}),this._parsed===this._totalParsed?(this.emit("parse-success",{file:r,total:this._totalParsed,parsed:this._parsed,time:new Date}),a(e)):setTimeout(this.parseFrameClosure(e,t,r,this._parsed,i,a,o),0)}_parser(e){let t=null;switch(e.toUpperCase()){case"NII":case"NII_":t=ie;break;case"DCM":case"DIC":case"DICOM":case"IMA":case"":t=ee;break;case"MHD":t=te;break;case"NRRD":t=se;break;case"MGH":case"MGZ":t=le;break;default:return console.warn("unsupported extension: "+e),!1}return t}_parseUrl(e){const t=new URL(e,"http://fix.me"),r={filename:t.searchParams.get("filename"),extension:"",pathname:t.pathname,query:t.search};r.filename||(r.filename=r.pathname.split("/").pop());const n=r.filename.split(".");return r.extension=n.length>1?n.pop():"dicom",(!isNaN(r.extension)||-1!==["asp","aspx","go","gs","hs","jsp","js","php","pl","py","rb","htm","html"].indexOf(r.extension)||r.query&&r.query.includes("contentType=application%2Fdicom"))&&(r.extension="dicom"),r}_preprocess(e){const t=this._parseUrl(e.url);if(e.filename=t.filename,e.extension=t.extension,e.pathname=t.pathname,e.query=t.query,"gz"===e.extension?(e.gzcompressed=!0,e.extension=e.filename.split(".gz").shift().split(".").pop()):"mgz"===e.extension?(e.gzcompressed=!0,e.extension="mgh"):"zraw"===e.extension?(e.gzcompressed=!0,e.extension="raw"):e.gzcompressed=!1,e.gzcompressed){let t=ue.inflate(e.buffer);e.buffer=t.buffer}}_filterByExtension(e,t){return t.extension.toUpperCase()===e.toUpperCase()}},b.MedicalIntersects={aabbPlane:function(e,t){let r=[],n=new THREE.Matrix4;n.getInverse(e.toAABB);let i=t.direction.clone().applyMatrix4(e.toAABB),a=new THREE.Vector3(0,0,0).applyMatrix4(e.toAABB),o=this.posdir(t.position.clone().applyMatrix4(e.toAABB),new THREE.Vector3(i.x-a.x,i.y-a.y,i.z-a.z).normalize()),s=b.MedicalUtils.bbox(e.center,e.halfDimensions),l={x:new THREE.Vector3(1,0,0),y:new THREE.Vector3(0,1,0),z:new THREE.Vector3(0,0,1)},u=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),l.x);this.rayPlaneInBBox(u,o,s,r),u.direction=l.y,this.rayPlaneInBBox(u,o,s,r),u.direction=l.z,this.rayPlaneInBBox(u,o,s,r);let c=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z+e.halfDimensions.z),l.x);this.rayPlaneInBBox(c,o,s,r),c.direction=l.y,this.rayPlaneInBBox(c,o,s,r),c.direction=l.z,this.rayPlaneInBBox(c,o,s,r);let h=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),l.y);this.rayPlaneInBBox(h,o,s,r),h.direction=l.z,this.rayPlaneInBBox(h,o,s,r);let d=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z-e.halfDimensions.z),l.x);this.rayPlaneInBBox(d,o,s,r),d.direction=l.z,this.rayPlaneInBBox(d,o,s,r);let f=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z+e.halfDimensions.z),l.x);return this.rayPlaneInBBox(f,o,s,r),f.direction=l.y,this.rayPlaneInBBox(f,o,s,r),r.map(function(e){return e.applyMatrix4(n)}),r},rayPlane:function(e,t){if(0!==e.direction.dot(t.direction)){let r=(t.direction.x*(t.position.x-e.position.x)+t.direction.y*(t.position.y-e.position.y)+t.direction.z*(t.position.z-e.position.z))/(t.direction.x*e.direction.x+t.direction.y*e.direction.y+t.direction.z*e.direction.z);return new THREE.Vector3(e.position.x+r*e.direction.x,e.position.y+r*e.direction.y,e.position.z+r*e.direction.z)}return null},rayPlaneInBBox:function(e,t,r,n){let i=this.rayPlane(e,t);i&&this.inBBox(i,r)&&(n.find(this.findIntersection(i))||n.push(i))},findIntersection:function(e){return function(t,r,n){return e.x===t.x&&e.y===t.y&&e.z===t.z}},inBBox:function(e,t){return!!(e&&e.x>=t.min.x-1e-4&&e.y>=t.min.y-1e-4&&e.z>=t.min.z-1e-4&&e.x<=t.max.x+1e-4&&e.y<=t.max.y+1e-4&&e.z<=t.max.z+1e-4)},posdir:function(e,t){return{position:e,direction:t}}},b.MedicalUtils={raycaster:new THREE.Raycaster,box3:new THREE.Box3,minPos:new THREE.Vector3,maxPos:new THREE.Vector3,bbox:function(e,t){if(!(t.x>=0&&t.y>=0&&t.z>=0))return window.console.log("halfDimensions must be >= 0."),window.console.log(t),!1;return{min:e.clone().sub(t),max:e.clone().add(t)}},parseUrl:function(e){const t=new URL(e,"http://fix.me"),r={filename:t.searchParams.get("filename"),extension:"",pathname:t.pathname,query:t.search};r.filename||(r.filename=r.pathname.split("/").pop());const n=r.filename.split(".");r.extension=n.length>1?n.pop():"dicom";return(!isNaN(r.extension)||-1!==["asp","aspx","go","gs","hs","jsp","js","php","pl","py","rb","htm","html"].indexOf(r.extension)||r.query&&r.query.includes("contentType=application%2Fdicom"))&&(r.extension="dicom"),r},worldToData:function(e,t){let r=(new THREE.Vector3).copy(t).applyMatrix4(e);return r.addScalar(.5).floor(),r},getPixelData:function(e,t){return t.z>=0&&t.z<e._frame.length?e._frame[t.z].getPixelData(t.x,t.y):null},setPixelData:function(e,t,r){return t.z>=0&&t.z<e._frame.length&&e._frame[t.z].setPixelData(t.x,t.y,r),null},rescaleSlopeIntercept:function(e,t,r){return e*t+r},centerOfMass:function(e){let t=new THREE.Vector3(0,0,0);for(let r=0;r<e.length;r++)t.x+=e[r].x,t.y+=e[r].y,t.z+=e[r].z;return t.divideScalar(e.length),t},orderIntersections:function(e,t){let r,n,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=this.centerOfMass(e);a.subVectors(e[0],s).normalize(),o.crossVectors(a,t).normalize();let l=[];for(let t=0;t<e.length;t++){let u=e[t];i.subVectors(e[t],s),r=a.dot(i),n=o.dot(i),u.uv={u:r,v:n},u.angle=Math.atan2(n,r)*(180/Math.PI),l.push(u)}l.sort(function(e,t){return e.angle-t.angle});let u=[l[0]];for(let e=1;e<l.length;e++)Math.abs(l[e-1].angle-l[e].angle)>1e-4&&u.push(l[e]);return u},getRoI:function(e,t,r){if(t.isCamera)return console.warn("warning: controls required instead of camera in getRoI()"),null;e.geometry.computeBoundingBox();const n=t.object,i=this.box3.setFromObject(e),a=this.minPos.copy(i.min).project(n),o=this.maxPos.copy(i.max).project(n),s=t.domElement.offsetWidth,l=t.domElement.offsetHeight,u=this.raycaster,c=[];a.x=Math.round((a.x+1)*s/2),a.y=Math.round((1-a.y)*l/2),o.x=Math.round((o.x+1)*s/2),o.y=Math.round((1-o.y)*l/2),[a.x,o.x]=[Math.min(a.x,o.x),Math.max(a.x,o.x)],[a.y,o.y]=[Math.min(a.y,o.y),Math.max(a.y,o.y)];let h=[],d=null,f={};for(let t=a.x;t<=o.x;t++)for(let i=a.y;i<=o.y;i++)f.x=t/s*2-1,f.y=-i/l*2+1,u.setFromCamera(f,n),0!==(h=u.intersectObject(e)).length&&null!==(d=this.getPixelData(r,this.worldToData(r.lps2IJK,h[0].point)))&&1===r.numberOfChannels&&c.push(this.rescaleSlopeIntercept(d,r.rescaleSlope,r.rescaleIntercept));if(0===c.length)return null;const p=c.reduce((e,t)=>e+t)/c.length;return{min:c.reduce((e,t)=>e<t?e:t),max:c.reduce((e,t)=>e>t?e:t),mean:p,sd:Math.sqrt(c.reduce((e,t)=>e+Math.pow(t-p,2),0)/c.length)}},getGeometryArea:function(e){let t=0,r=new THREE.Triangle;if(e.isGeometry){if(e.faces.length<1)return 0;let n=e.vertices;e.faces.forEach(function(e){t+=r.set(n[e.a],n[e.b],n[e.c]).getArea()})}else if(e.isBufferGeometry){let h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;if(e.index){if(e.index.count<3)return 0;for(var n,i,a,o=e.attributes.position.array,s=e.index.array,l=0,u=e.index.count;l<u;l+=3)n=s[l+0],i=s[l+1],a=s[l+2],h.set(o[3*n],o[3*n+1],o[3*n+2]),d.set(o[3*i],o[3*i+1],o[3*i+2]),f.set(o[3*a],o[3*a+1],o[3*a+2]),t+=r.set(h,d,f).getArea()}else{if(e.attributes.position.count<3)return 0;o=e.attributes.position.array;var c=3*e.attributes.position.count;for(l=0;l<c;l+=9)h.set(o[l+0],o[l+1],o[l+2]),d.set(o[l+3],o[l+4],o[l+5]),f.set(o[l+6],o[l+7],o[l+8]),t+=r.set(h,d,f).getArea()}}return t},sliceGeometry:function(e,t,r,n,i){void 0===i&&(i=new THREE.Matrix4);let a={halfDimensions:e,center:t,toAABB:i},o={position:r,direction:n},s=b.MedicalIntersects.aabbPlane(a,o);s.length<3&&console.log("warning: sliceGeometry has less than 3 intersections between AABB and Plane...");let l=this.orderIntersections(s,n),u=new THREE.Shape;const c=new Float32Array(3*(l.length+1));u.moveTo(l[0].uv.u,l[0].uv.v),c.set(l[0].toArray(),0);for(let e=1;e<l.length;e++)u.lineTo(l[e].uv.u,l[e].uv.v),c.set(l[e].toArray(),3*e);u.lineTo(l[0].uv.u,l[0].uv.v),c.set(l[0].toArray(),3*l.length);let h=new THREE.ShapeBufferGeometry(u,l.length);return h.addAttribute("position",new THREE.BufferAttribute(c,3)),h}},b.MedicalVoxel=function(){this.id=-1,this.worldCoordinates=null,this.dataCoordinates=null,this.screenCoordinates=null,this.value=null},b.SliceMesh=function(e,t,r,n,i){t=t||0,r=r||new THREE.Vector3(0,0,0),n=n||new THREE.Vector3(0,0,1),i=i||"IJK",THREE.Mesh.call(this),this.name="sliceMesh",this._stack=e,this._halfDimensions=null,this._spacing=1,this._thickness=0,this._thicknessMethod=0,this._opacity=1,this._invert=this._stack.invert,this._lut=!1,this._interpolation=1,this._windowWidth=null,this._windowCenter=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._lowerThreshold=null,this._upperThreshold=null,this._lutTexture=null,this._intensityAuto=!0,this._index=t,this._planePosition=r,this._planeDirection=n,this._center=new THREE.Vector3,this._aaBBspace=i,this._canvasWidth=0,this._canvasHeight=0,this._uniforms=null,this._init(),this._create()},b.SliceMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:b.SliceMesh,isSliceMesh:!0,_init(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aaBBspace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center.set(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new THREE.Matrix4;else{let e=this._stack.AABBox();this._halfDimensions=e.clone().multiplyScalar(.5),this._center.copy(this._stack.centerAABBox()),this._toAABB=this._stack.lps2AABB}},_create(){this._stack&&this._stack.prepared&&this._stack.packed&&(this._createGeometry(),this._createMaterial(),this.getIntensityFactors(),this.updateIntensityFactorsUniforms(),"IJK"===this._aaBBspace&&(this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1),this.matrixAutoUpdate=!0,this.applyMatrix(this._stack.ijk2LPS)))},_createGeometry(){this.geometry=b.MedicalUtils.sliceGeometry(this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB);let e=this.parent;e&&e._updateSliceBorder()},_createMaterial(){this.material.isShaderMaterial||(this._uniforms=THREE.UniformsUtils.clone(b.MedicalSliceShader.uniforms),this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uSpacing.value=this._spacing,this._uniforms.uThickness.value=this._thickness,this._uniforms.uThicknessMethod.value=this._thicknessMethod,this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._stack._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._createShaderMaterial({side:THREE.DoubleSide,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}))},_createShaderMaterial(e){let t=b.MedicalSliceShader,r={},n=this._uniforms.uTextureContainer.value.length;if(r.MAX_TEX3D_IMAGES=n>7?14:7,1===this._uniforms.uNumberOfChannels.value){let e=this._uniforms.uBitsAllocated.value.toString(),t=this._uniforms.uPixelType.value.toString();r[e="1"===e||"8"===e?"BITS_ALLOCATED_8":"16"===e?"BITS_ALLOCATED_16":"32"===e&&"0"===t?"BITS_ALLOCATED_32":"32"===e&&"0"!==t?"BITS_ALLOCATED_32F":"BITS_ALLOCATED_IDENTITY"]=""}let i={defines:r,uniforms:this._uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},a=Object.assign(e,i);this.material=new THREE.ShaderMaterial(a),this._uniforms=this.material.uniforms},getIntensityFactor(e){this["_"+e]=this._stack[e],this._intensityAuto&&this._stack.frame[this._index]&&this._stack.frame[this._index][e]&&(this["_"+e]=this._stack.frame[this._index][e])},getIntensityFactors(){this.getIntensityFactor("windowCenter"),this.getIntensityFactor("windowWidth"),this.getIntensityFactor("rescaleSlope"),this.getIntensityFactor("rescaleIntercept"),null===this._upperThreshold&&(this._upperThreshold=this._stack._minMax[1]),null===this._lowerThreshold&&(this._lowerThreshold=this._stack._minMax[0])},updateIntensityFactorsUniforms(){let e=Math.abs(this._stack._minMax[0]);this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[e+this._windowCenter,this._windowWidth],this._uniforms.uLowerUpperThreshold.value=[e+this._lowerThreshold,e+this._upperThreshold]},_update(){this.geometry.dispose(),this._create()},dispose(){this._uniforms=null,this.geometry.dispose(),this.material.dispose(),this._stack=null},cartesianEquation(){if(!this._geometry||!this._geometry.attributes||!this._geometry.attributes.position||this._geometry.attributes.position.count<3)return new THREE.Vector4;let e=this._geometry.attributes.position.array,t=this._stack.ijk2LPS,r=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3;r.fromArray(e,0).applyMatrix4(t),n.fromArray(e,3).applyMatrix4(t),i.fromArray(e,6).applyMatrix4(t);let s=a.subVectors(i,n).cross(o.subVectors(r,n)).normalize();return new THREE.Vector4(s.x,s.y,s.z,-s.dot(r))}}),Object.defineProperties(b.SliceMesh.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},spacing:{get:function(){return this._spacing},set:function(e){this._spacing=e,this._uniforms.uSpacing.value=this._spacing}},thickness:{get:function(){return this._thickness},set:function(e){this._thickness=e,this._uniforms.uThickness.value=this._thickness}},thicknessMethod:{get:function(){return this._thicknessMethod},set:function(e){this._thicknessMethod=e,this._uniforms.uThicknessMethod.value=this._thicknessMethod}},opacity:{get:function(){return this._opacity},set:function(e){this._opacity=e,this._uniforms.uOpacity.value=this._opacity}},invert:{get:function(){return this._invert},set:function(e){this._invert=e,this._uniforms.uInvert.value=!0===this._invert?1:0}},lut:{get:function(){return this._lut},set:function(e){this._lut=e,!1===this._lut?this._uniforms.uLut.value=0:this._uniforms.uLut.value=1}},lutTexture:{get:function(){return this._lutTexture},set:function(e){this._lutTexture=e,this._uniforms.uTextureLUT.value=this._lutTexture,this.updateIntensityFactorsUniforms()}},interpolation:{get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation}},windowWidth:{get:function(){return this._windowWidth},set:function(e){this._windowWidth=e,this.updateIntensityFactorsUniforms()}},windowCenter:{get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this.updateIntensityFactorsUniforms()}},rescaleSlope:{get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e,this.updateIntensityFactorsUniforms()}},rescaleIntercept:{get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e,this.updateIntensityFactorsUniforms()}},upperThreshold:{get:function(){return this._upperThreshold},set:function(e){this._upperThreshold=e,this.updateIntensityFactorsUniforms()}},lowerThreshold:{get:function(){return this._lowerThreshold},set:function(e){this._lowerThreshold=e,this.updateIntensityFactorsUniforms()}},intensityAuto:{get:function(){return this._intensityAuto},set:function(e){this._intensityAuto=e,this.getIntensityFactors(),this.updateIntensityFactorsUniforms()}},index:{get:function(){return this._index},set:function(e){this._index!==e&&(this._index=e,this._update())}},planePosition:{get:function(){return this._planePosition},set:function(e){this._planePosition.equals(e)||(this._planePosition.copy(e),this._update())}},planeDirection:{get:function(){return this._planeDirection},set:function(e){this._planeDirection.equals(e)||(this._planeDirection.copy(e),this._update())}},center:{get:function(){return this._center},set:function(e){this._center=e}},aabbSpace:{get:function(){return this._aaBBspace},set:function(e){this._aaBBspace=e,this._init()}},canvasWidth:{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._uniforms.uCanvasWidth.value=this._canvasWidth}},canvasHeight:{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._uniforms.uCanvasHeight.value=this._canvasHeight}}}),b.MedicalSlicer=function(e){THREE.Object3D.call(this),this.name="medicalSlicer",this._stack=e,this._bBox=null,this._slice=null,this._border=null,this._orientation=2,this._index=0,this._autoWindowLevel=!1,this._outOfBounds=!1,this._orientationMaxIndex=0,this._orientationSpacing=0,this._canvasWidth=0,this._canvasHeight=0,this._create()},b.MedicalSlicer.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:b.MedicalSlicer,isMedicalSlicer:!0,_create(){this._prepareStack(),this._createStackBBox(),this._createSliceMesh(),this._createSliceBorder(),this._computeOrientationMaxIndex(),this._computeOrientationSpacing()},_computeOrientationSpacing(){let e=this._stack._spacing;switch(this._orientation){case 0:this._orientationSpacing=e.y;break;case 1:this._orientationSpacing=e.x;break;case 2:this._orientationSpacing=e.z;break;default:this._orientationSpacing=0}},_computeOrientationMaxIndex(){let e=this._stack.dimensionsIJK;switch(this._orientation){case 0:this._orientationMaxIndex=e.x-1;break;case 1:this._orientationMaxIndex=e.y-1;break;case 2:this._orientationMaxIndex=e.z-1;break;default:this._orientationMaxIndex=0}},_computeIndexOutOfBounds(){this._computeOrientationMaxIndex(),this._outOfBounds=this._index>=this._orientationMaxIndex||this._index<0},_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()},_createStackBBox(){this._bBox=function(e,t){var r=e.dimensionsIJK,n=e.halfDimensionsIJK,i=new THREE.Vector3(-.5,-.5,-.5),a=new THREE.BoxBufferGeometry(r.x,r.y,r.z);a.applyMatrix((new THREE.Matrix4).makeTranslation(n.x+i.x,n.y+i.y,n.z+i.z));var o=new THREE.Mesh(a,null);o.applyMatrix(e.ijk2LPS);var s=new THREE.BoxHelper(o,t||16777215);return s.update=function(e){void 0===e&&THREE.BoxHelper.prototype.update.call(this)},s}(this._stack),this.add(this._bBox)},_createSliceMesh(){this._index=this._getSliceIndex(.5);let e=this._getSlicePosition(),t=this._getSliceDirection();this._slice=new b.SliceMesh(this._stack,this._index,e,t),this.add(this._slice)},_createSliceBorder(){var e,t,r,n;this._border=(e=this._slice,r=new THREE.LineBasicMaterial({color:t||16711680,linewidth:1}),n=new THREE.Line(e.geometry,r),"IJK"===e.aabbSpace&&n.applyMatrix(e.stack.ijk2LPS),n),this.add(this._border)},_updateSliceBorder(){if("IJK"===this._slice.aabbSpace){let e=this._border;e.geometry=this._slice.geometry,e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.matrixAutoUpdate=!0,e.applyMatrix(this._slice.stack.ijk2LPS)}},_getSliceIndex(e){e=void 0!==e?e:.5;let t=this._stack.dimensionsIJK,r=0;switch(this._orientation){case 0:r=Math.floor(t.x*e);break;case 1:r=Math.floor(t.y*e);break;case 2:r=Math.floor(t.z*e)}return r},_getSlicePosition(){let e=this._stack.halfDimensionsIJK,t=new THREE.Vector3(0,0,0);switch(this._orientation){case 0:t.set(this._index,Math.floor(e.y),Math.floor(e.z));break;case 1:t.set(Math.floor(e.x),this._index,Math.floor(e.z));break;case 2:t.set(Math.floor(e.x),Math.floor(e.y),this._index)}return t},_getSliceDirection(){let e=new THREE.Vector3(0,0,1);switch(this._orientation){case 0:e.set(1,0,0);break;case 1:e.set(0,1,0);break;case 2:e.set(0,0,1)}return e}}),Object.defineProperties(b.MedicalSlicer.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},bbox:{get:function(){return this._bBox}},slice:{get:function(){return this._slice}},border:{get:function(){return this._border}},index:{get:function(){return this._index},set:function(e){this._index!==e&&(this._index=e,this._slice._index=e,this._slice.planePosition=this._getSlicePosition(),this._computeIndexOutOfBounds())}},orientation:{get:function(){return this._orientation},set:function(e){this._orientation!==e&&(this._orientation=e,this._index=this._getSliceIndex(.5),this._computeOrientationMaxIndex(),this._computeOrientationSpacing(),this._slice.spacing=Math.abs(this._orientationSpacing),this._slice.thickness=this._slice.spacing,this._slice.planeDirection=this._getSliceDirection())}},outOfBounds:{get:function(){return this._outOfBounds},set:function(e){this._outOfBounds=e}},orientationMaxIndex:{get:function(){return this._orientationMaxIndex},set:function(e){this._orientationMaxIndex=e}},orientationSpacing:{get:function(){return this._orientationSpacing},set:function(e){this._orientationSpacing=e}},canvasWidth:{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._slice.canvasWidth=this._canvasWidth}},canvasHeight:{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._slice.canvasHeight=this._canvasHeight}},bboxColor:{get:function(){return this._bBox.material.color},set:function(e){this._bBox.material.color=new THREE.Color(e)}},borderColor:{get:function(){return this._border.material.color},set:function(e){this._border.material.color=new THREE.Color(e)}}}),b.MedicalVolume=function(e){THREE.Mesh.call(this),this.name="medicalVolume",this._stack=e,this._uniforms=null,this._algorithm=0,this._alphaCorrection=.5,this._interpolation=1,this._shading=1,this._shininess=10,this._steps=256,this._offset=0,this._windowCenter=0,this._windowWidth=1,this._create()},b.MedicalVolume.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:b.MedicalVolume,isMedicalVolume:!0,_create(){this._prepareStack(),this._createGeometry(),this._createMaterial()},_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack(),this._offset=Math.min(0,this._stack._minMax[0]),this._windowCenter=this._stack.windowCenter,this._windowWidth=.8*this._stack.windowWidth},_createGeometry(){let e=this._stack.worldBoundingBox(),t=this._stack.worldCenter();this.geometry=new THREE.BoxBufferGeometry(e[1]-e[0],e[3]-e[2],e[5]-e[4]).translate(t.x,t.y,t.z)},_createMaterial(){this.material.isShaderMaterial||(this._uniforms=THREE.UniformsUtils.clone(b.MedicalVolumeShader.uniforms),this._uniforms.uWorldBBox.value=this._stack.worldBoundingBox(),this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._stack._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uDataToWorld.value=(new THREE.Matrix4).getInverse(this._stack.lps2IJK),this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uWindowCenterWidth.value=[this._windowCenter-this._offset,this._windowWidth],this._uniforms.uRescaleSlopeIntercept.value=[this._stack.rescaleSlope,this._stack.rescaleIntercept],this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uAlphaCorrection.value=this._alphaCorrection,this._uniforms.uInterpolation.value=this._interpolation,this._uniforms.uShading.value=this._shading,this._uniforms.uShininess.value=this._shininess,this._uniforms.uSteps.value=this._steps,this._uniforms.uAlgorithm.value=this._algorithm,this._createShaderMaterial({side:THREE.BackSide,transparent:!0}))},_createShaderMaterial(e){let t=b.MedicalVolumeShader,r={};b.isWebGL1()&&(r.gl_FragDepth="gl_FragDepthEXT");let n=this._uniforms.uTextureContainer.value.length;if(r.MAX_TEX3D_IMAGES=n>7?14:7,1===this._uniforms.uNumberOfChannels.value){let e=this._uniforms.uBitsAllocated.value.toString(),t=this._uniforms.uPixelType.value.toString();r[e="1"===e||"8"===e?"BITS_ALLOCATED_8":"16"===e?"BITS_ALLOCATED_16":"32"===e&&"0"===t?"BITS_ALLOCATED_32":"32"===e&&"0"!==t?"BITS_ALLOCATED_32F":"BITS_ALLOCATED_IDENTITY"]=""}let i={defines:r,uniforms:this._uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},a=Object.assign(e,i);this.material=new THREE.ShaderMaterial(a),this.material.extensions={fragDepth:!0},this._uniforms=this.material.uniforms},_update(){this.geometry.dispose(),this._create()},dispose(){this._uniforms=null,this.geometry.dispose(),this.material.dispose(),this._stack=null}}),Object.defineProperties(b.MedicalVolume.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},uniforms:{get:function(){return this._uniforms},set:function(e){this._uniforms=e}},windowCenter:{get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this._uniforms.uWindowCenterWidth.value[0]=this._windowCenter-this._offset}},windowWidth:{get:function(){return this._windowWidth},set:function(e){this._windowWidth=Math.max(1,e),this._uniforms.uWindowCenterWidth.value[1]=this._windowWidth}},steps:{get:function(){return this._steps},set:function(e){this._steps=e,this._uniforms.uSteps.value=this._steps}},alphaCorrection:{get:function(){return this._alphaCorrection},set:function(e){this._alphaCorrection=e,this._uniforms.uAlphaCorrection.value=this._alphaCorrection}},interpolation:{get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation}},shading:{get:function(){return this._shading},set:function(e){this._shading=e,this._uniforms.uShading.value=this._shading}},shininess:{get:function(){return this._shininess},set:function(e){this._shininess=e,this._uniforms.uShininess.value=this._shininess}},algorithm:{get:function(){return this._algorithm},set:function(e){this._algorithm=e,this._uniforms.uAlgorithm.value=this._algorithm}},lut:{get:function(){return this._lut},set:function(e){this._uniforms.uLut.value=!1===e?0:1}},lutTexture:{get:function(){return this._uniforms.uTextureLUT.value},set:function(e){this._uniforms.uTextureLUT.value&&this._uniforms.uTextureLUT.value.dispose(),this._uniforms.uTextureLUT.value=e}}}),b.MedicalIsosurface=function(e,t,r,n){t=t||128,r=r||4,n=n||"IJK",THREE.Mesh.call(this),this.name="medicalIsosurface",this._stack=e,this._isoLevel=t,this._stride=r,this._aaBBspace=n,this._create()},b.MedicalIsosurface.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:b.MedicalIsosurface,isMedicalIsosurface:!0,_create(){this._prepareStack(),this._createGeometry(),this._createMaterial(),"IJK"===this._aaBBspace&&(this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1),this.matrixAutoUpdate=!0,this.applyMatrix(this._stack.ijk2LPS))},_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()},_createGeometry(){for(var e=this._isoLevel,t=this._stride,r=this._stack.dimensionsIJK,n=r.x,i=r.y,a=r.z,o=1+~~((n-1)/t),s=1+~~((i-1)/t),l=1+~~((a-1)/t),u=(n-1)%t,c=(i-1)%t,h=(a-1)%t,d=[],f=this._stack.frame,p=0;p<a;p+=t){for(var m=[],v=0;v<i;v+=t)for(var g=n*v,y=0;y<n;y+=t)m.push(f[p].pixelData[g+y]);m=Int8Array.from(m,t=>t-e),d.push(m)}d=b.concatTypedArrays(Int8Array,...d);var _=[o,s,l],E=[[0,0,0],[n-u,i-c,a-h]];this.geometry=new b.IsosurfaceGeometry(_,E,d)},_createMaterial(){this.material.isMeshLambertMaterial||(this.material=new THREE.MeshLambertMaterial)},_update(){this.geometry.dispose(),this._create()}}),Object.defineProperties(b.MedicalIsosurface.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},isoLevel:{get:function(){return this._isoLevel},set:function(e){this._isoLevel=e,this._update()}},stride:{get:function(){return this._stride},set:function(e){this._stride=e,this._update()}}}),b.LookupTables=function(e,t,r,n,i,a){THREE.Object3D.call(this),this.name="lookupTables",this._dom=void 0===e?document.createElement("div"):"string"==typeof e?document.getElementById(e):e,this._lut=t||"default",this._color=n||[[0,0,0,0],[1,1,1,1]],this._lutO=r||"linear",this._opacity=i||[[0,0],[1,1]],this._discrete=a||!1,this._presetLuts=b.LookupTables.presetLuts(),this._presetLutsO=b.LookupTables.presetLutsO(),this._canvasBg=null,this._canvas=null,this.initCanvas(),this.paintCanvas()},b.LookupTables.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:b.LookupTables,isLookupTables:!0,initCanvas(){let e=document.createElement("div");e.style.cssText="position: relative; height: 16px; width: 256px; border: 1px solid #f9f9f9;",this._canvas=this.createCanvas(),this._canvas.style.cssText="position: absolute;",e.appendChild(this._canvas),this._dom.appendChild(e)},createCanvas(){let e=document.createElement("canvas");return e.width=256,e.height=16,e.style.width="256px",e.style.height="16px",e},paintCanvas(){let e=this._canvas.getContext("2d");if(e.clearRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="source-over",this._discrete){e.lineWidth=2*this._canvas.height;for(let t=0;t<this._color.length;t++){let r=this._color[t][0],n=t<this._color.length-1?this._color[t+1][0]:1,i=t>0?this._color[t-1][0]:0,a=i+(r-i)/2,o=r+(n-r)/2,s=this._color[t],l=this._opacity[t]?this._opacity[t][1]:1;e.beginPath(),e.strokeStyle=`rgba( ${Math.round(255*s[1])}, ${Math.round(255*s[2])}, ${Math.round(255*s[3])}, ${l})`,e.moveTo(a*this._canvas.width,0),e.lineTo(o*this._canvas.width,0),e.stroke(),e.closePath()}}else{let t=e.createLinearGradient(0,0,this._canvas.width,0);for(let e=0;e<this._color.length;e++)t.addColorStop(this._color[e][0],`rgba( ${Math.round(255*this._color[e][1])}, ${Math.round(255*this._color[e][2])}, ${Math.round(255*this._color[e][3])}, 1)`);e.fillStyle=t,e.fillRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="destination-in";let r=e.createLinearGradient(0,0,this._canvas.width,0);for(let e=0;e<this._opacity.length;e++)r.addColorStop(this._opacity[e][0],"rgba(255, 255, 255, "+this._opacity[e][1]+")");e.fillStyle=r,e.fillRect(0,0,this._canvas.width,this._canvas.height)}},lutsAvailable(e){let t="color"===(e=e||"color")?this._presetLuts:this._presetLutsO;return Object.keys(t)}}),Object.defineProperties(b.LookupTables.prototype,{texture:{get:function(){let e=new THREE.CanvasTexture(this._canvas);return e.mapping=THREE.UVMapping,e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=e.minFilter=THREE.NearestFilter,e.premultiplyAlpha=!0,e.needsUpdate=!0,e}},lut:{get:function(){return this._lut},set:function(e){this._lut!==e&&(this._lut=e,this._color=this._presetLuts[e],this.paintCanvas())}},presetLuts:{get:function(){return this._presetLuts},set:function(e){this._presetLuts=e}},lutO:{get:function(){return this._lutO},set:function(e){this._lutO!==e&&(this._lutO=e,this._opacity=this._presetLutsO[e],this.paintCanvas())}},presetLutsO:{get:function(){return this._presetLutsO},set:function(e){this._presetLutsO=e}},discrete:{get:function(){return this._discrete},set:function(e){this._discrete!==e&&(this._discrete=e,this.paintCanvas())}}}),b.LookupTables.presetLuts=function(){return{default:[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]],red:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]],green:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]],blue:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]],walking_dead:[[0,.1,1,1],[1,1,1,1]],random:[[0,0,0,0],[.27,.18,.18,.18],[.41,1,1,1],[.7,1,0,0],[1,1,1,1]],muscle_bone:[[0,0,0,0],[.00392156862745098,.00784313725490196,0,0],[.00784313725490196,.0196078431372549,0,0],[.011764705882352941,.03137254901960784,0,0],[.01568627450980392,.0392156862745098,0,.00392156862745098],[.0196078431372549,.050980392156862744,.00392156862745098,.00392156862745098],[.023529411764705882,.06274509803921569,.00392156862745098,.00392156862745098],[.027450980392156862,.07058823529411765,.00392156862745098,.00784313725490196],[.03137254901960784,.08235294117647059,.00392156862745098,.00784313725490196],[.03529411764705882,.09411764705882353,.00784313725490196,.00784313725490196],[.0392156862745098,.10196078431372549,.00784313725490196,.00784313725490196],[.043137254901960784,.11372549019607843,.00784313725490196,.011764705882352941],[.047058823529411764,.12549019607843137,.00784313725490196,.011764705882352941],[.050980392156862744,.13333333333333333,.011764705882352941,.011764705882352941],[.054901960784313725,.1450980392156863,.011764705882352941,.01568627450980392],[.058823529411764705,.1568627450980392,.011764705882352941,.01568627450980392],[.06274509803921569,.16470588235294117,.011764705882352941,.01568627450980392],[.06666666666666667,.17647058823529413,.011764705882352941,.0196078431372549],[.07058823529411765,.18823529411764706,.01568627450980392,.0196078431372549],[.07450980392156863,.2,.01568627450980392,.0196078431372549],[.0784313725490196,.20784313725490197,.01568627450980392,.0196078431372549],[.08235294117647059,.2196078431372549,.01568627450980392,.023529411764705882],[.08627450980392157,.23137254901960785,.0196078431372549,.023529411764705882],[.09019607843137255,.23921568627450981,.0196078431372549,.023529411764705882],[.09411764705882353,.25098039215686274,.0196078431372549,.027450980392156862],[.09803921568627451,.2627450980392157,.0196078431372549,.027450980392156862],[.10196078431372549,.27058823529411763,.023529411764705882,.027450980392156862],[.10588235294117647,.2823529411764706,.023529411764705882,.027450980392156862],[.10980392156862745,.29411764705882354,.023529411764705882,.03137254901960784],[.11372549019607843,.30196078431372547,.023529411764705882,.03137254901960784],[.11764705882352941,.3137254901960784,.023529411764705882,.03137254901960784],[.12156862745098039,.3254901960784314,.027450980392156862,.03529411764705882],[.12549019607843137,.3333333333333333,.027450980392156862,.03529411764705882],[.12941176470588237,.34509803921568627,.027450980392156862,.03529411764705882],[.13333333333333333,.3568627450980392,.027450980392156862,.0392156862745098],[.13725490196078433,.36470588235294116,.03137254901960784,.0392156862745098],[.1411764705882353,.3764705882352941,.03137254901960784,.0392156862745098],[.1450980392156863,.38823529411764707,.03137254901960784,.0392156862745098],[.14901960784313725,.4,.03137254901960784,.043137254901960784],[.15294117647058825,.40784313725490196,.03529411764705882,.043137254901960784],[.1568627450980392,.4196078431372549,.03529411764705882,.043137254901960784],[.1607843137254902,.43137254901960786,.03529411764705882,.047058823529411764],[.16470588235294117,.4392156862745098,.03529411764705882,.047058823529411764],[.16862745098039217,.45098039215686275,.03529411764705882,.047058823529411764],[.17254901960784313,.4627450980392157,.0392156862745098,.047058823529411764],[.17647058823529413,.47058823529411764,.0392156862745098,.050980392156862744],[.1803921568627451,.4823529411764706,.0392156862745098,.050980392156862744],[.1843137254901961,.49411764705882355,.0392156862745098,.050980392156862744],[.18823529411764706,.5019607843137255,.043137254901960784,.054901960784313725],[.19215686274509805,.5137254901960784,.043137254901960784,.054901960784313725],[.19607843137254902,.5254901960784314,.043137254901960784,.054901960784313725],[.2,.5333333333333333,.043137254901960784,.058823529411764705],[.20392156862745098,.5450980392156862,.047058823529411764,.058823529411764705],[.20784313725490197,.5568627450980392,.047058823529411764,.058823529411764705],[.21176470588235294,.5647058823529412,.047058823529411764,.058823529411764705],[.21568627450980393,.5764705882352941,.047058823529411764,.06274509803921569],[.2196078431372549,.5882352941176471,.047058823529411764,.06274509803921569],[.2235294117647059,.6,.050980392156862744,.06274509803921569],[.22745098039215686,.6078431372549019,.050980392156862744,.06666666666666667],[.23137254901960785,.6196078431372549,.050980392156862744,.06666666666666667],[.23529411764705882,.6313725490196078,.050980392156862744,.06666666666666667],[.23921568627450981,.6392156862745098,.054901960784313725,.06666666666666667],[.24313725490196078,.6509803921568628,.054901960784313725,.07058823529411765],[.24705882352941178,.6627450980392157,.054901960784313725,.07058823529411765],[.25098039215686274,.6705882352941176,.054901960784313725,.07058823529411765],[.2549019607843137,.6823529411764706,.058823529411764705,.07450980392156863],[.25882352941176473,.6941176470588235,.058823529411764705,.07450980392156863],[.2627450980392157,.7019607843137254,.058823529411764705,.07450980392156863],[.26666666666666666,.7137254901960784,.058823529411764705,.0784313725490196],[.27058823529411763,.7254901960784313,.058823529411764705,.0784313725490196],[.27450980392156865,.7333333333333333,.06274509803921569,.0784313725490196],[.2784313725490196,.7450980392156863,.06274509803921569,.0784313725490196],[.2823529411764706,.7568627450980392,.06274509803921569,.08235294117647059],[.28627450980392155,.7647058823529411,.06274509803921569,.08235294117647059],[.2901960784313726,.7764705882352941,.06666666666666667,.08235294117647059],[.29411764705882354,.788235294117647,.06666666666666667,.08627450980392157],[.2980392156862745,.8,.06666666666666667,.08627450980392157],[.30196078431372547,.807843137254902,.06666666666666667,.08627450980392157],[.3058823529411765,.8196078431372549,.07058823529411765,.08627450980392157],[.30980392156862746,.8313725490196079,.07058823529411765,.09019607843137255],[.3137254901960784,.8392156862745098,.07058823529411765,.09019607843137255],[.3176470588235294,.8509803921568627,.07058823529411765,.09019607843137255],[.3215686274509804,.8627450980392157,.07058823529411765,.09411764705882353],[.3254901960784314,.8705882352941177,.07450980392156863,.09411764705882353],[.32941176470588235,.8823529411764706,.07450980392156863,.09411764705882353],[.3333333333333333,.8941176470588236,.07450980392156863,.09803921568627451],[.33725490196078434,.9019607843137255,.07450980392156863,.09803921568627451],[.3411764705882353,.9137254901960784,.0784313725490196,.09803921568627451],[.34509803921568627,.9254901960784314,.0784313725490196,.09803921568627451],[.34901960784313724,.9333333333333333,.0784313725490196,.10196078431372549],[.35294117647058826,.9450980392156862,.0784313725490196,.10196078431372549],[.3568627450980392,.9568627450980393,.08235294117647059,.10196078431372549],[.3607843137254902,.9647058823529412,.08235294117647059,.10588235294117647],[.36470588235294116,.9764705882352941,.08235294117647059,.10588235294117647],[.3686274509803922,.9882352941176471,.08235294117647059,.10588235294117647],[.37254901960784315,1,.08235294117647059,.10588235294117647],[.3764705882352941,1,.09411764705882353,.10588235294117647],[.3803921568627451,1,.10588235294117647,.10588235294117647],[.3843137254901961,1,.11764705882352941,.10196078431372549],[.38823529411764707,1,.12941176470588237,.10196078431372549],[.39215686274509803,1,.1411764705882353,.10196078431372549],[.396078431372549,1,.15294117647058825,.09803921568627451],[.4,1,.16470588235294117,.09803921568627451],[.403921568627451,1,.17647058823529413,.09803921568627451],[.40784313725490196,1,.18823529411764706,.09411764705882353],[.4117647058823529,1,.2,.09411764705882353],[.41568627450980394,1,.21176470588235294,.09411764705882353],[.4196078431372549,1,.2235294117647059,.09019607843137255],[.4235294117647059,1,.23529411764705882,.09019607843137255],[.42745098039215684,1,.24705882352941178,.08627450980392157],[.43137254901960786,1,.25882352941176473,.08627450980392157],[.43529411764705883,1,.27058823529411763,.08627450980392157],[.4392156862745098,1,.2823529411764706,.08235294117647059],[.44313725490196076,1,.29411764705882354,.08235294117647059],[.4470588235294118,1,.3058823529411765,.08235294117647059],[.45098039215686275,1,.3176470588235294,.0784313725490196],[.4549019607843137,1,.32941176470588235,.0784313725490196],[.4588235294117647,1,.3411764705882353,.0784313725490196],[.4627450980392157,1,.35294117647058826,.07450980392156863],[.4666666666666667,1,.36470588235294116,.07450980392156863],[.47058823529411764,1,.3764705882352941,.07450980392156863],[.4745098039215686,1,.38823529411764707,.07058823529411765],[.47843137254901963,1,.4,.07058823529411765],[.4823529411764706,1,.4117647058823529,.07058823529411765],[.48627450980392156,1,.4235294117647059,.06666666666666667],[.49019607843137253,1,.43529411764705883,.06666666666666667],[.49411764705882355,1,.4470588235294118,.06274509803921569],[.4980392156862745,1,.4588235294117647,.06274509803921569],[.5019607843137255,1,.47058823529411764,.06274509803921569],[.5058823529411764,1,.4823529411764706,.058823529411764705],[.5098039215686274,1,.49411764705882355,.058823529411764705],[.5137254901960784,1,.5058823529411764,.058823529411764705],[.5176470588235295,1,.5137254901960784,.054901960784313725],[.5215686274509804,1,.5254901960784314,.054901960784313725],[.5254901960784314,1,.5372549019607843,.054901960784313725],[.5294117647058824,1,.5490196078431373,.050980392156862744],[.5333333333333333,1,.5607843137254902,.050980392156862744],[.5372549019607843,1,.5725490196078431,.050980392156862744],[.5411764705882353,1,.5843137254901961,.047058823529411764],[.5450980392156862,1,.596078431372549,.047058823529411764],[.5490196078431373,1,.6078431372549019,.043137254901960784],[.5529411764705883,1,.6196078431372549,.043137254901960784],[.5568627450980392,1,.6313725490196078,.043137254901960784],[.5607843137254902,1,.6431372549019608,.0392156862745098],[.5647058823529412,1,.6549019607843137,.0392156862745098],[.5686274509803921,1,.6666666666666666,.0392156862745098],[.5725490196078431,1,.6784313725490196,.03529411764705882],[.5764705882352941,1,.6901960784313725,.03529411764705882],[.5803921568627451,1,.6941176470588235,.0392156862745098],[.5843137254901961,1,.7019607843137254,.0392156862745098],[.5882352941176471,1,.7058823529411765,.043137254901960784],[.592156862745098,1,.7098039215686275,.043137254901960784],[.596078431372549,1,.7137254901960784,.047058823529411764],[.6,1,.7176470588235294,.047058823529411764],[.6039215686274509,1,.7254901960784313,.050980392156862744],[.6078431372549019,1,.7294117647058823,.050980392156862744],[.611764705882353,1,.7333333333333333,.054901960784313725],[.615686274509804,1,.7372549019607844,.058823529411764705],[.6196078431372549,1,.7411764705882353,.058823529411764705],[.6235294117647059,1,.7490196078431373,.06274509803921569],[.6274509803921569,1,.7529411764705882,.06274509803921569],[.6313725490196078,1,.7568627450980392,.06666666666666667],[.6352941176470588,1,.7607843137254902,.06666666666666667],[.6392156862745098,1,.7647058823529411,.07058823529411765],[.6431372549019608,1,.7725490196078432,.07058823529411765],[.6470588235294118,1,.7764705882352941,.07450980392156863],[.6509803921568628,1,.7803921568627451,.07450980392156863],[.6549019607843137,1,.7843137254901961,.0784313725490196],[.6588235294117647,1,.788235294117647,.08235294117647059],[.6627450980392157,1,.796078431372549,.08235294117647059],[.6666666666666666,1,.8,.08627450980392157],[.6705882352941176,1,.803921568627451,.08627450980392157],[.6745098039215687,1,.807843137254902,.09019607843137255],[.6784313725490196,1,.8117647058823529,.09019607843137255],[.6823529411764706,1,.8196078431372549,.09411764705882353],[.6862745098039216,1,.8235294117647058,.09411764705882353],[.6901960784313725,1,.8274509803921568,.09803921568627451],[.6941176470588235,1,.8313725490196079,.10196078431372549],[.6980392156862745,1,.8352941176470589,.10196078431372549],[.7019607843137254,1,.8431372549019608,.10588235294117647],[.7058823529411765,1,.8470588235294118,.10588235294117647],[.7098039215686275,1,.8509803921568627,.10980392156862745],[.7137254901960784,1,.8549019607843137,.10980392156862745],[.7176470588235294,1,.8627450980392157,.11372549019607843],[.7215686274509804,1,.8666666666666667,.11372549019607843],[.7254901960784313,1,.8705882352941177,.11764705882352941],[.7294117647058823,1,.8745098039215686,.12156862745098039],[.7333333333333333,1,.8784313725490196,.12156862745098039],[.7372549019607844,1,.8862745098039215,.12549019607843137],[.7411764705882353,1,.8901960784313725,.12549019607843137],[.7450980392156863,1,.8941176470588236,.12941176470588237],[.7490196078431373,1,.8980392156862745,.12941176470588237],[.7529411764705882,1,.9019607843137255,.13333333333333333],[.7568627450980392,1,.9098039215686274,.13333333333333333],[.7607843137254902,1,.9137254901960784,.13725490196078433],[.7647058823529411,1,.9176470588235294,.1411764705882353],[.7686274509803922,1,.9215686274509803,.1411764705882353],[.7725490196078432,1,.9254901960784314,.1450980392156863],[.7764705882352941,1,.9333333333333333,.1450980392156863],[.7803921568627451,1,.9372549019607843,.14901960784313725],[.7843137254901961,1,.9411764705882353,.14901960784313725],[.788235294117647,1,.9450980392156862,.15294117647058825],[.792156862745098,1,.9450980392156862,.16862745098039217],[.796078431372549,1,.9490196078431372,.1843137254901961],[.8,1,.9490196078431372,.2],[.803921568627451,1,.9490196078431372,.21568627450980393],[.807843137254902,1,.9490196078431372,.22745098039215686],[.8117647058823529,1,.9529411764705882,.24313725490196078],[.8156862745098039,1,.9529411764705882,.25882352941176473],[.8196078431372549,1,.9529411764705882,.27450980392156865],[.8235294117647058,1,.9529411764705882,.2901960784313726],[.8274509803921568,1,.9568627450980393,.3058823529411765],[.8313725490196079,1,.9568627450980393,.3215686274509804],[.8352941176470589,1,.9568627450980393,.33725490196078434],[.8392156862745098,1,.9568627450980393,.35294117647058826],[.8431372549019608,1,.9607843137254902,.3686274509803922],[.8470588235294118,1,.9607843137254902,.3843137254901961],[.8509803921568627,1,.9607843137254902,.4],[.8549019607843137,1,.9607843137254902,.4117647058823529],[.8588235294117647,1,.9647058823529412,.42745098039215684],[.8627450980392157,1,.9647058823529412,.44313725490196076],[.8666666666666667,1,.9647058823529412,.4588235294117647],[.8705882352941177,1,.9647058823529412,.4745098039215686],[.8745098039215686,1,.9686274509803922,.49019607843137253],[.8784313725490196,1,.9686274509803922,.5058823529411764],[.8823529411764706,1,.9686274509803922,.5215686274509804],[.8862745098039215,1,.9686274509803922,.5372549019607843],[.8901960784313725,1,.9725490196078431,.5529411764705883],[.8941176470588236,1,.9725490196078431,.5686274509803921],[.8980392156862745,1,.9725490196078431,.5843137254901961],[.9019607843137255,1,.9725490196078431,.6],[.9058823529411765,1,.9725490196078431,.611764705882353],[.9098039215686274,1,.9764705882352941,.6274509803921569],[.9137254901960784,1,.9764705882352941,.6431372549019608],[.9176470588235294,1,.9764705882352941,.6588235294117647],[.9215686274509803,1,.9764705882352941,.6745098039215687],[.9254901960784314,1,.9803921568627451,.6901960784313725],[.9294117647058824,1,.9803921568627451,.7058823529411765],[.9333333333333333,1,.9803921568627451,.7215686274509804],[.9372549019607843,1,.9803921568627451,.7372549019607844],[.9411764705882353,1,.984313725490196,.7529411764705882],[.9450980392156862,1,.984313725490196,.7686274509803922],[.9490196078431372,1,.984313725490196,.7843137254901961],[.9529411764705882,1,.984313725490196,.8],[.9568627450980393,1,.9882352941176471,.8117647058823529],[.9607843137254902,1,.9882352941176471,.8274509803921568],[.9647058823529412,1,.9882352941176471,.8431372549019608],[.9686274509803922,1,.9882352941176471,.8588235294117647],[.9725490196078431,1,.9921568627450981,.8745098039215686],[.9764705882352941,1,.9921568627450981,.8901960784313725],[.9803921568627451,1,.9921568627450981,.9058823529411765],[.984313725490196,1,.9921568627450981,.9215686274509803],[.9882352941176471,1,.996078431372549,.9372549019607843],[.9921568627450981,1,.996078431372549,.9529411764705882],[.996078431372549,1,.996078431372549,.9686274509803922],[1,1,.996078431372549,.984313725490196]]}},b.LookupTables.presetLutsO=function(){return{linear:[[0,0],[1,1]],lowpass:[[0,.8],[.2,.6],[.3,.1],[1,0]],bandpass:[[0,0],[.4,.8],[.6,.8],[1,0]],highpass:[[0,0],[.7,.1],[.8,.6],[1,.8]],flat:[[0,.7],[1,1]],random:[[0,0],[.38,0],[.55,1],[.72,1],[1,.05]],linear_full:[[0,0],[.00392156862745098,.00392156862745098],[.00784313725490196,.00784313725490196],[.011764705882352941,.011764705882352941],[.01568627450980392,.01568627450980392],[.0196078431372549,.0196078431372549],[.023529411764705882,.023529411764705882],[.027450980392156862,.027450980392156862],[.03137254901960784,.03137254901960784],[.03529411764705882,.03529411764705882],[.0392156862745098,.0392156862745098],[.043137254901960784,.043137254901960784],[.047058823529411764,.047058823529411764],[.050980392156862744,.050980392156862744],[.054901960784313725,.054901960784313725],[.058823529411764705,.058823529411764705],[.06274509803921569,.06274509803921569],[.06666666666666667,.06666666666666667],[.07058823529411765,.07058823529411765],[.07450980392156863,.07450980392156863],[.0784313725490196,.0784313725490196],[.08235294117647059,.08235294117647059],[.08627450980392157,.08627450980392157],[.09019607843137255,.09019607843137255],[.09411764705882353,.09411764705882353],[.09803921568627451,.09803921568627451],[.10196078431372549,.10196078431372549],[.10588235294117647,.10588235294117647],[.10980392156862745,.10980392156862745],[.11372549019607843,.11372549019607843],[.11764705882352941,.11764705882352941],[.12156862745098039,.12156862745098039],[.12549019607843137,.12549019607843137],[.12941176470588237,.12941176470588237],[.13333333333333333,.13333333333333333],[.13725490196078433,.13725490196078433],[.1411764705882353,.1411764705882353],[.1450980392156863,.1450980392156863],[.14901960784313725,.14901960784313725],[.15294117647058825,.15294117647058825],[.1568627450980392,.1568627450980392],[.1607843137254902,.1607843137254902],[.16470588235294117,.16470588235294117],[.16862745098039217,.16862745098039217],[.17254901960784313,.17254901960784313],[.17647058823529413,.17647058823529413],[.1803921568627451,.1803921568627451],[.1843137254901961,.1843137254901961],[.18823529411764706,.18823529411764706],[.19215686274509805,.19215686274509805],[.19607843137254902,.19607843137254902],[.2,.2],[.20392156862745098,.20392156862745098],[.20784313725490197,.20784313725490197],[.21176470588235294,.21176470588235294],[.21568627450980393,.21568627450980393],[.2196078431372549,.2196078431372549],[.2235294117647059,.2235294117647059],[.22745098039215686,.22745098039215686],[.23137254901960785,.23137254901960785],[.23529411764705882,.23529411764705882],[.23921568627450981,.23921568627450981],[.24313725490196078,.24313725490196078],[.24705882352941178,.24705882352941178],[.25098039215686274,.25098039215686274],[.2549019607843137,.2549019607843137],[.25882352941176473,.25882352941176473],[.2627450980392157,.2627450980392157],[.26666666666666666,.26666666666666666],[.27058823529411763,.27058823529411763],[.27450980392156865,.27450980392156865],[.2784313725490196,.2784313725490196],[.2823529411764706,.2823529411764706],[.28627450980392155,.28627450980392155],[.2901960784313726,.2901960784313726],[.29411764705882354,.29411764705882354],[.2980392156862745,.2980392156862745],[.30196078431372547,.30196078431372547],[.3058823529411765,.3058823529411765],[.30980392156862746,.30980392156862746],[.3137254901960784,.3137254901960784],[.3176470588235294,.3176470588235294],[.3215686274509804,.3215686274509804],[.3254901960784314,.3254901960784314],[.32941176470588235,.32941176470588235],[.3333333333333333,.3333333333333333],[.33725490196078434,.33725490196078434],[.3411764705882353,.3411764705882353],[.34509803921568627,.34509803921568627],[.34901960784313724,.34901960784313724],[.35294117647058826,.35294117647058826],[.3568627450980392,.3568627450980392],[.3607843137254902,.3607843137254902],[.36470588235294116,.36470588235294116],[.3686274509803922,.3686274509803922],[.37254901960784315,.37254901960784315],[.3764705882352941,.3764705882352941],[.3803921568627451,.3803921568627451],[.3843137254901961,.3843137254901961],[.38823529411764707,.38823529411764707],[.39215686274509803,.39215686274509803],[.396078431372549,.396078431372549],[.4,.4],[.403921568627451,.403921568627451],[.40784313725490196,.40784313725490196],[.4117647058823529,.4117647058823529],[.41568627450980394,.41568627450980394],[.4196078431372549,.4196078431372549],[.4235294117647059,.4235294117647059],[.42745098039215684,.42745098039215684],[.43137254901960786,.43137254901960786],[.43529411764705883,.43529411764705883],[.4392156862745098,.4392156862745098],[.44313725490196076,.44313725490196076],[.4470588235294118,.4470588235294118],[.45098039215686275,.45098039215686275],[.4549019607843137,.4549019607843137],[.4588235294117647,.4588235294117647],[.4627450980392157,.4627450980392157],[.4666666666666667,.4666666666666667],[.47058823529411764,.47058823529411764],[.4745098039215686,.4745098039215686],[.47843137254901963,.47843137254901963],[.4823529411764706,.4823529411764706],[.48627450980392156,.48627450980392156],[.49019607843137253,.49019607843137253],[.49411764705882355,.49411764705882355],[.4980392156862745,.4980392156862745],[.5019607843137255,.5019607843137255],[.5058823529411764,.5058823529411764],[.5098039215686274,.5098039215686274],[.5137254901960784,.5137254901960784],[.5176470588235295,.5176470588235295],[.5215686274509804,.5215686274509804],[.5254901960784314,.5254901960784314],[.5294117647058824,.5294117647058824],[.5333333333333333,.5333333333333333],[.5372549019607843,.5372549019607843],[.5411764705882353,.5411764705882353],[.5450980392156862,.5450980392156862],[.5490196078431373,.5490196078431373],[.5529411764705883,.5529411764705883],[.5568627450980392,.5568627450980392],[.5607843137254902,.5607843137254902],[.5647058823529412,.5647058823529412],[.5686274509803921,.5686274509803921],[.5725490196078431,.5725490196078431],[.5764705882352941,.5764705882352941],[.5803921568627451,.5803921568627451],[.5843137254901961,.5843137254901961],[.5882352941176471,.5882352941176471],[.592156862745098,.592156862745098],[.596078431372549,.596078431372549],[.6,.6],[.6039215686274509,.6039215686274509],[.6078431372549019,.6078431372549019],[.611764705882353,.611764705882353],[.615686274509804,.615686274509804],[.6196078431372549,.6196078431372549],[.6235294117647059,.6235294117647059],[.6274509803921569,.6274509803921569],[.6313725490196078,.6313725490196078],[.6352941176470588,.6352941176470588],[.6392156862745098,.6392156862745098],[.6431372549019608,.6431372549019608],[.6470588235294118,.6470588235294118],[.6509803921568628,.6509803921568628],[.6549019607843137,.6549019607843137],[.6588235294117647,.6588235294117647],[.6627450980392157,.6627450980392157],[.6666666666666666,.6666666666666666],[.6705882352941176,.6705882352941176],[.6745098039215687,.6745098039215687],[.6784313725490196,.6784313725490196],[.6823529411764706,.6823529411764706],[.6862745098039216,.6862745098039216],[.6901960784313725,.6901960784313725],[.6941176470588235,.6941176470588235],[.6980392156862745,.6980392156862745],[.7019607843137254,.7019607843137254],[.7058823529411765,.7058823529411765],[.7098039215686275,.7098039215686275],[.7137254901960784,.7137254901960784],[.7176470588235294,.7176470588235294],[.7215686274509804,.7215686274509804],[.7254901960784313,.7254901960784313],[.7294117647058823,.7294117647058823],[.7333333333333333,.7333333333333333],[.7372549019607844,.7372549019607844],[.7411764705882353,.7411764705882353],[.7450980392156863,.7450980392156863],[.7490196078431373,.7490196078431373],[.7529411764705882,.7529411764705882],[.7568627450980392,.7568627450980392],[.7607843137254902,.7607843137254902],[.7647058823529411,.7647058823529411],[.7686274509803922,.7686274509803922],[.7725490196078432,.7725490196078432],[.7764705882352941,.7764705882352941],[.7803921568627451,.7803921568627451],[.7843137254901961,.7843137254901961],[.788235294117647,.788235294117647],[.792156862745098,.792156862745098],[.796078431372549,.796078431372549],[.8,.8],[.803921568627451,.803921568627451],[.807843137254902,.807843137254902],[.8117647058823529,.8117647058823529],[.8156862745098039,.8156862745098039],[.8196078431372549,.8196078431372549],[.8235294117647058,.8235294117647058],[.8274509803921568,.8274509803921568],[.8313725490196079,.8313725490196079],[.8352941176470589,.8352941176470589],[.8392156862745098,.8392156862745098],[.8431372549019608,.8431372549019608],[.8470588235294118,.8470588235294118],[.8509803921568627,.8509803921568627],[.8549019607843137,.8549019607843137],[.8588235294117647,.8588235294117647],[.8627450980392157,.8627450980392157],[.8666666666666667,.8666666666666667],[.8705882352941177,.8705882352941177],[.8745098039215686,.8745098039215686],[.8784313725490196,.8784313725490196],[.8823529411764706,.8823529411764706],[.8862745098039215,.8862745098039215],[.8901960784313725,.8901960784313725],[.8941176470588236,.8941176470588236],[.8980392156862745,.8980392156862745],[.9019607843137255,.9019607843137255],[.9058823529411765,.9058823529411765],[.9098039215686274,.9098039215686274],[.9137254901960784,.9137254901960784],[.9176470588235294,.9176470588235294],[.9215686274509803,.9215686274509803],[.9254901960784314,.9254901960784314],[.9294117647058824,.9294117647058824],[.9333333333333333,.9333333333333333],[.9372549019607843,.9372549019607843],[.9411764705882353,.9411764705882353],[.9450980392156862,.9450980392156862],[.9490196078431372,.9490196078431372],[.9529411764705882,.9529411764705882],[.9568627450980393,.9568627450980393],[.9607843137254902,.9607843137254902],[.9647058823529412,.9647058823529412],[.9686274509803922,.9686274509803922],[.9725490196078431,.9725490196078431],[.9764705882352941,.9764705882352941],[.9803921568627451,.9803921568627451],[.984313725490196,.984313725490196],[.9882352941176471,.9882352941176471],[.9921568627450981,.9921568627450981],[.996078431372549,.996078431372549],[1,1]]}},b.MedicalLoader=function(){this.progressBar={},this.progressBar.onStart=()=>{b.createProgressbar()},this.progressBar.onProgress=(e,t,r)=>{b.updateProgressbar(t,r)},this.progressBar.onLoad=()=>{b.hideProgressbar()},this.progressBar.onError=e=>{b.errorProgressbar("There was an error loading "+e)}},b.MedicalLoader.prototype={constructor:b.MedicalLoader,load:function(e,t){e=!0===Array.isArray(e)?e:[e],"string"==typeof this.path&&(e=e.map(e=>this.path+e));let r=new ce.LoadersVolume(b.appWorks.dom,this.progressBar),n=[];e.forEach(e=>{n.push(r.load(e))}),Promise.all(n).then(()=>{let e=r.data[0].mergeSeries(r.data)[0].stack[0];r.free(),t(e)}).catch(e=>{console.log("Error: loading failed in JAMIE.MedicalLoader()..."),console.log(e)})},setPath:function(e){return this.path=e,this}},b.MedicalLoadFiles=function(e,t){let r={onStart:()=>{b.createProgressbar()},onProgress:(e,t,r)=>{b.updateProgressbar(t,r)},onLoad:()=>{b.hideProgressbar()},onError:e=>{b.errorProgressbar("There was an error loading "+e)}},n=new ce.LoadersVolume(b.appWorks.dom,r),i=[];function a(e,t){return t.extension.toUpperCase()===e.toUpperCase()}function o(e,t){return Promise.resolve().then(function(){return new Promise((r,n)=>{let i=new FileReader;i.addEventListener("load",e=>{r(e.target.result)}),i.readAsArrayBuffer(t[e])})}).then(r=>n.parse({url:t[e].name,buffer:r})).then(e=>{i.push(e)}).catch(e=>{console.log(e)})}const s=[],l=[],u=[];var c=e.dataTransfer?e.dataTransfer.files:e.target.files;for(let e=0;e<c.length;e++){let t=b.MedicalUtils.parseUrl(c[e].name);"MHD"===t.extension.toUpperCase()||"RAW"===t.extension.toUpperCase()||"ZRAW"===t.extension.toUpperCase()?u.push({file:c[e],extension:t.extension.toUpperCase()}):l.push(c[e])}if(2===u.length){const e=u.filter(a.bind(null,"MHD")),t=u.filter(a.bind(null,"RAW")),r=u.filter(a.bind(null,"ZRAW"));1!==e.length||1!==t.length&&1!==r.length||s.push(function(e){const t=[];for(let r=0;r<e.length;r++)t.push(new Promise((t,n)=>{const i=new FileReader;i.addEventListener("load",e=>{t(e.target.result)}),i.readAsArrayBuffer(e[r].file)}).then(t=>({url:e[r].file.name,buffer:t})));return Promise.all(t).then(e=>n.parse(e)).then(e=>{i.push(e)}).catch(e=>{console.log(e)})}(u))}for(let e=0;e<l.length;e++)s.push(o(e,l));Promise.all(s).then(()=>{n.free();let e=i[0].mergeSeries(i)[0].stack[0];t(e)}).catch(e=>{console.log(e)})},b.MedicalKeyboard=function(e){8===e.keyCode&&e.preventDefault();var t,r,n=b.appWorks.scene;if((t=n.getObjectByName("quadViewport"))&&((r=t.objectClicked)&&r.isMedicalSlicer))switch(e.keyCode){case 38:!function(e){e.index<e.orientationMaxIndex&&(e.index+=1)}(r),i(r);break;case 40:!function(e){e.index>0&&(e.index-=1)}(r),i(r);break;case 46:a(r)}if((t=n.getObjectByName("slicesViewport"))&&((r=t.objectClicked)&&r.isMedicalSlicer))switch(e.keyCode){case 46:a(r)}function i(e){e.children.forEach(t=>{t.isWidgetBase&&(t.targetMesh=e.slice)})}function a(e){for(let t=0,r=e.children.length;t<r;t++){let r=e.children[t];if(r.hovered){b.remove(r);let e=b.WidgetEvent.widgets,t=e.indexOf(r);return e.splice(t,1),void r.free()}}}},b.MedicalQuadViewport=function(e){e.prepared||e.prepare(),e.packed||e.pack();var[t,r,n]=e.worldSliceOrientation(),i=new b.MedicalSlicer(e);i.name="iSlicer",i.orientation=t,i.bbox.visible=!1,i.borderColor=16776960;var a=new b.MedicalSlicer(e);a.name="jSlicer",a.orientation=r,a.bbox.visible=!1,a.borderColor=65280;var o=new b.MedicalSlicer(e);o.name="kSlicer",o.orientation=n,o.bbox.visible=!1,o.borderColor=16711680;var s=new b.MedicalVolume(e);let l=document.createElement("div"),u=new b.LookupTables(l);u.lut="random",s.lutTexture=u.texture,s.lut=!0;var c=e.worldCenter(),h=e.worldBoundingBox(),d=Math.max(h[1]-h[0],h[3]-h[2],h[5]-h[4]);d*=1.2;var f=b.appWorks;f.composer=null,f.renderer.setClearColor(1184274,1),f.renderer.setScissorTest(!0);var p=f.width,m=f.height,v=~~(p/2),g=~~(m/2),y=new THREE.Object3D;y.name="quadViewport",y.objectClicked=null,y.elementDblClicked=null,y.elements=[],b.add(y),b.WidgetEvent.medical=y;var _=document.createElement("div");_.id="quadViewport",_.style.cssText=`position:absolute; top:0px; width:${p}px; height:${m}px; overflow:hidden; z-index:0;`,f.dom.appendChild(_);for(var E="\n        z-index: 1;\n        color: #fff;\n        font-size: 16px;\n        position: absolute;\n        padding: 4px;\n        border-radius: 50%;\n        width: 18px;\n        height: 18px;\n        text-align: center;\n        vertical-align: middle;\n        line-height: 18px;\n        background-color: rgba(0, 0, 0, 0.3);\n    ",w=`<div class="scene" style="width: ${v}px; height: ${g}px;"></div>\n        <div id="leftLabel" style="${E}"></div>\n        <div id="rightLabel" style="${E}"></div>\n        <div id="topLabel" style="${E}"></div>\n        <div id="bottomLabel" style="${E}"></div>`,x={0:["L","R","A","P"],2:["A","P","S","I"],3:["R","L","S","I"]},t=0;t<4;t++){var T=new THREE.Scene;switch(T.name="scene"+t,t){case 0:T.add(o);break;case 1:T.add(s),T.children.push(o),T.children.push(i),T.children.push(a);break;case 2:T.add(i);break;case 3:T.add(a)}var S=document.createElement("div");S.style.cssText="position: relative; display: inline-block; margin-bottom: -4px; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",S.innerHTML=w,H(S,t),_.appendChild(S);var M,R=S.querySelector(".scene");if(R.id=t,T.userData.element=R,y.elements.push(R),1===t){var A=(L=R.getBoundingClientRect()).width/L.height,k=.1,P=10*d,C=new THREE.PerspectiveCamera(50,A,k,P);T.userData.camera=C,C.up.set(0,0,1),C.position.copy(c),C.position.y-=d,C.lookAt(c),s.uniforms.uCameraNear.value=C.near,s.uniforms.uCameraFar.value=C.far}else{A=(L=R.getBoundingClientRect()).width/L.height,k=.1,P=2*d;var L,I=d,O=d*A;C=new THREE.OrthographicCamera(-O/2,O/2,I/2,-I/2,k,P);switch(T.userData.camera=C,t){case 0:C.up.set(0,-1,0),C.position.copy(c),C.position.z+=d;break;case 2:C.up.set(0,0,1),C.position.copy(c),C.position.x+=d;break;case 3:C.up.set(0,0,1),C.position.copy(c),C.position.y-=d}C.lookAt(c)}if(1===t)(M=new THREE.TrackballControls(C,R)).target.copy(c),M.panSpeed=.3,M.rotateSpeed=2,M.zoomSpeed=1.2,M.dynamicDampingFactor=.3,T.userData.controls=M;else(M=new THREE.OrthographicTrackballControls(C,R)).target.copy(c),M.panSpeed=.3,M.rotateSpeed=1,M.zoomSpeed=1.2,M.dynamicDampingFactor=.3,M.noRotate=!0,T.userData.controls=M;R.addEventListener("mouseenter",D,!1),R.addEventListener("mouseleave",N,!1),R.addEventListener("click",F,!1),R.addEventListener("dblclick",U,!1),R.addEventListener("mousedown",b.WidgetEvent.onMouseDown,!1),R.addEventListener("mouseup",b.WidgetEvent.onMouseUp,!1),R.addEventListener("mousemove",b.WidgetEvent.onMouseMove,!1),window.addEventListener("resize",B,!1),y.add(T)}function H(e,t){let r;if(1===t)return(r=e.querySelector("#leftLabel")).remove(),(r=e.querySelector("#rightLabel")).remove(),(r=e.querySelector("#topLabel")).remove(),void(r=e.querySelector("#bottomLabel")).remove();(r=e.querySelector("#leftLabel")).style.left="0",r.style.top="50%",r.textContent=x[t][0],(r=e.querySelector("#rightLabel")).style.right="0",r.style.top="50%",r.textContent=x[t][1],(r=e.querySelector("#topLabel")).style.top="0",r.style.left="50%",r.textContent=x[t][2],(r=e.querySelector("#bottomLabel")).style.bottom="0",r.style.left="50%",r.textContent=x[t][3]}function D(e){let t=z(this);y.objectClicked=t}function N(e){y.objectClicked=null}function F(e){let t=z(this);y.objectClicked=t}function U(e){y.elementDblClicked!==this?(y.elements.forEach(e=>{e.style.display="none"}),j(this,p,m),y.elementDblClicked=this):(y.elements.forEach(e=>{j(e,v,g)}),y.elementDblClicked=null),b.WidgetEvent.widgets.length>0&&b.triggerWindowResize()}function B(){if(p=f.width,m=f.height,v=~~(p/2),g=~~(m/2),_.style.width=p+"px",_.style.height=m+"px",y.elementDblClicked){j(y.elementDblClicked,p,m)}else y.elements.forEach(e=>{j(e,v,g)})}function z(e){let t=parseInt(e.id);return y.children[t].children[0]}function j(e,t,r){e.style.display="",e.style.width=t+"px",e.style.height=r+"px",function(e,t){if(e.isPerspectiveCamera)e.aspect=t,e.updateProjectionMatrix();else{let r=d,n=d*t;e.left=-n/2,e.right=n/2,e.top=r/2,e.bottom=-r/2,e.updateProjectionMatrix()}}(function(e){let t=parseInt(e.id);return y.children[t].userData.camera}(e),t/r)}y.update=function(e,t){var r=b.appWorks.renderer;r.domElement.style.transform=`translateY(${window.scrollY}px)`,y.children.forEach(function(n,i){n.traverse(r=>{r.update&&r.update(e,t)});var a=n.userData.element.getBoundingClientRect();if(!(a.bottom<0||a.top>r.domElement.clientHeight||a.right<0||a.left>r.domElement.clientWidth)){var o=a.width,s=a.height,l=a.left,u=r.domElement.clientHeight-a.bottom;r.setViewport(l,u,o,s),r.setScissor(l,u,o,s);var c=n.userData.camera;n.userData.controls.update(),r.render(n,c)}})}},b.MedicalSlicesViewport=function(e,t){t=void 0!==t?t:2;e.prepared||e.prepare(),e.packed||e.pack();var r,n,[i,a,o]=e.worldSliceOrientation(),s=e.dimensionsIJK,l=e.worldCenter(),u=e.worldBoundingBox(),c=Math.max(u[1]-u[0],u[3]-u[2],u[5]-u[4]),h=200,d=200;switch(t){case 0:r=i;break;case 1:r=a;break;case 2:r=o}switch(r){case 0:n=s.x-1;break;case 1:n=s.y-1;break;case 2:n=s.z-1}var f=new THREE.Vector3,p=new THREE.Vector3;switch(t){case 0:f.set(0,0,1),p.copy(l),p.x+=c;break;case 1:f.set(0,0,1),p.copy(l),p.y-=c;break;case 2:f.set(0,-1,0),p.copy(l),p.z+=c}var m=b.appWorks;m.composer=null,m.renderer.setClearColor(1184274,1),m.renderer.setScissorTest(!0);var v=m.width,g=m.height,y=new THREE.Object3D;y.name="slicesViewport",y.objectClicked=null,y.elementDblClicked=null,y.elements=[],b.add(y),b.WidgetEvent.medical=y,document.body.style.backgroundColor="black";var _=document.createElement("div");_.id="slicesViewport",_.style.cssText=`position:absolute; top:0px; width:${v}px; height:${g}px; text-align:center; overflow:auto; z-index:0;`,m.dom.appendChild(_);for(var E=`<div class="scene" style="width: ${h}px; height: ${d}px;"></div>`,i=0;i<=n;i++){var w=new THREE.Scene;w.name="scene"+i;var x=new b.MedicalSlicer(e);x.name="slicer"+i,x.bbox.visible=!1,x.border.visible=!1,x.orientation=r,x.index=i,w.add(x);var T=document.createElement("div");T.style.cssText="display: inline-block; margin-bottom: -4px; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",T.innerHTML=E,_.appendChild(T);var S=T.querySelector(".scene");S.id=i,w.userData.element=S,y.elements.push(S);var M=S.getBoundingClientRect(),R=M.width/M.height,A=2*c,k=c,P=c*R,C=new THREE.OrthographicCamera(-P/2,P/2,k/2,-k/2,.1,A);w.userData.camera=C,C.up.copy(f),C.position.copy(p),C.lookAt(l);var L=new THREE.OrthographicTrackballControls(C,S);L.target.copy(l),L.panSpeed=.3,L.rotateSpeed=1,L.zoomSpeed=1.2,L.dynamicDampingFactor=.3,L.noRotate=!0,L.enabled=!1,w.userData.controls=L,S.addEventListener("mouseenter",I,!1),S.addEventListener("mouseleave",O,!1),S.addEventListener("click",H,!1),S.addEventListener("dblclick",D,!1),S.addEventListener("mousedown",b.WidgetEvent.onMouseDown,!1),S.addEventListener("mouseup",b.WidgetEvent.onMouseUp,!1),S.addEventListener("mousemove",b.WidgetEvent.onMouseMove,!1),window.addEventListener("resize",N,!1),y.add(w)}function I(e){let t=F(this);y.objectClicked=t}function O(e){y.objectClicked=null}function H(e){let t=F(this);y.objectClicked=t}function D(e){if(y.elementDblClicked!==this){y.elements.forEach(e=>{e.style.display="none"}),B(this,v,g),U(this).enabled=!0,y.elementDblClicked=this}else{y.elements.forEach(e=>{e.style.display=""}),B(this,h,d,1),U(this).enabled=!1,y.elementDblClicked=null}b.WidgetEvent.widgets.length>0&&b.triggerWindowResize()}function N(){if(v=m.width,g=m.height,_.style.width=v+"px",_.style.height=g+"px",y.elementDblClicked){B(y.elementDblClicked,v,g)}}function F(e){let t=parseInt(e.id);return y.children[t].children[0]}function U(e){let t=parseInt(e.id);return y.children[t].userData.controls}function B(e,t,r,n){e.style.display="",e.style.width=t+"px",e.style.height=r+"px",function(e,t,r){let n=c,i=c*t;e.left=-i/2,e.right=i/2,e.top=n/2,e.bottom=-n/2,void 0!==r&&(e.zoom=r),e.updateProjectionMatrix()}(function(e){let t=parseInt(e.id);return y.children[t].userData.camera}(e),t/r,n)}y.update=function(e,t){var r=b.appWorks.renderer;r.domElement.style.transform=`translateY(${window.scrollY}px)`,y.children.forEach(function(n,i){n.traverse(r=>{r.update&&r.update(e,t)});var a=n.userData.element.getBoundingClientRect();if(!(a.bottom<0||a.top>r.domElement.clientHeight||a.right<0||a.left>r.domElement.clientWidth)){var o=a.width,s=a.height,l=a.left,u=r.domElement.clientHeight-a.bottom;r.setViewport(l,u,o,s),r.setScissor(l,u,o,s);var c=n.userData.camera;n.userData.controls.update(),r.render(n,c)}})}},Object.assign(me.prototype,{isOctree:!0,importMesh:function(e){var t=this;function r(e){e.geometry=JAMIE.toGeometry(e.geometry),e.geometry.mergeVertices(),e.updateMatrix();var r=e.id,n=e.geometry.clone();n.applyMatrix(e.matrix),n.computeVertexNormals(),n.computeFaceNormals();for(var i=n.faces,a=n.vertices,o=0,s=i.length;o<s;o++){var l=new ge(a[i[o].a],a[i[o].b],a[i[o].c],i[o].normal,r);t.addFace(l)}}e.isInstancedMesh?e.split(e=>{e.forEach(e=>{r(e)})}):r(e)},addFace:function(e){for(var t=[],r=this.nodes[0].slice(0),n=0,i=this.maxDepth;n<i;n++){for(var a=0,o=r.length;a<o;a++){var s=r[a];he(e.a,e.b,e.c,s)&&(s.trianglePool.push(e),n+1!==this.maxDepth&&(t=t.concat(s.getChildNodes())))}if(0===t.length)break;r=t.slice(0),t.length=0}},removeMesh:function(e){this.nodes.forEach(function(t){t.forEach(function(t){var r=[];t.trianglePool.forEach(function(t){t.meshId!==e&&r.push(t)}),t.trianglePool=r})})},getIntersectedNodes:function(e,t){var r=[],n=[];if(!de(e,this))return[];for(var i=this.nodes[0].slice(0),a=0,o=t;a<o;a++){for(var s=0,l=i.length;s<l;s++){var u=i[s];if(de(e,u))a+1===t?0!==u.trianglePool.length&&n.push(u):r=r.concat(u.getChildNodes())}i=r.slice(0),r.length=0}return n}}),me.separate3Bit=function(e){return e=2396745&((e=798915&((e=61455&(e|e<<8))|e<<4))|e<<2)},me.getMortonNumber=function(e,t,r){return me.separate3Bit(e)|me.separate3Bit(t)<<1|me.separate3Bit(r)<<2},me.uniqTrianglesfromNodes=function(e){var t=[],r=!1;if(0===e.length)return[];if(1===e.length)return e[0].trianglePool.slice(0);for(var n=0,i=e.length;n<i;n++)for(var a=0,o=e[n].trianglePool.length;a<o;a++){for(var s=0,l=t.length;s<l;s++)e[n].trianglePool[a]===t[s]&&(r=!0);r||t.push(e[n].trianglePool[a]),r=!1}return t},Object.assign(ve.prototype,{isOctreeNode:!0,getParentNode:function(){if(0===this.depth)return null;this.tree.nodes[this.depth][this.mortonNumber>>3]},getChildNodes:function(){if(this.tree.maxDepth===this.depth)return null;var e=this.mortonNumber<<3;return[this.tree.nodes[this.depth+1][e],this.tree.nodes[this.depth+1][e+1],this.tree.nodes[this.depth+1][e+2],this.tree.nodes[this.depth+1][e+3],this.tree.nodes[this.depth+1][e+4],this.tree.nodes[this.depth+1][e+5],this.tree.nodes[this.depth+1][e+6],this.tree.nodes[this.depth+1][e+7]]}});var ge=function(e,t,r,n,i){this.a=e.clone(),this.b=t.clone(),this.c=r.clone(),this.normal=n.clone(),this.meshId=i};function ye(){this.colliderPool=[],this.playerPool=[]}Object.assign(ye.prototype,{isWorld:!0,add:function(e){e.isOctree?this.colliderPool.push(e):e.isHeroController&&(this.playerPool.push(e),e.world=this)},step:function(e){for(var t=0,r=this.playerPool.length;t<r;t++){for(var n,i=this.playerPool[t],a=0,o=this.colliderPool.length;a<o;a++){var s=this.colliderPool[a],l=new THREE.Sphere(i.center,i.radius+i.groundPadding),u=s.getIntersectedNodes(l,s.maxDepth);if((n=me.uniqTrianglesfromNodes(u)).length>0)break}i.collisionCandidate=n,i.update(e)}}});var _e=10;Math.PI;function be(e,t){var r,n,i=this;this.player=e,this.controller=t,this.explosionPoints=(r=Array(150).fill(0),(n=JAMIE.createPoints(r,{map:(new THREE.TextureLoader).load("images/sprites/ball.png"),color:16711680,size:.2})).name="game.explosionPoints",n.visible=!1,n.explosionPower=1.06,n.wasExplosion=!1,n.isExplosion=!1,JAMIE.add(n),n.explode=function(e){var t=i.controller.radius;this.position.x=e.x,this.position.y=e.y+t,this.position.z=e.z;for(var r=new THREE.Vector3,n=this.geometry.attributes.position,a=0,o=n.count;a<o;a++)r.fromBufferAttribute(n,a),r.x=JAMIE.randFloat(-.4,.4),r.y=JAMIE.randFloat(-.4,.4),r.z=JAMIE.randFloat(-.4,.4),n.setXYZ(a,r.x,r.y,r.z);this.explosionPower=1.2,this.visible=!0},n.update=function(e,t){this.visible&&(this.scale.setScalar(this.explosionPower),this.explosionPower>.5?this.explosionPower-=.008:this.visible=!1)},n)}function Ee(e,t){this.object=e,this.center=this.object.position.clone(),this.radius=t,this.groundPadding=.5,this.maxSlopeGradient=Math.cos(50*THREE.Math.DEG2RAD),this.isGrounded=!1,this.isOnSlope=!1,this.isIdling=!1,this.isRunning=!1,this.isJumping=!1,this.direction=0,this.movementSpeed=_e,this.velocity=new THREE.Vector3(0,-10,0),this.currentJumpPower=0,this.jumpStartTime=0,this.groundHeight=0,this.groundNormal=new THREE.Vector3,this.collisionCandidate,this.contactInfo=[]}Object.assign(be.prototype,{isHeroAnimator:!0,play:function(e){if(JAMIE.appWorks&&JAMIE.appWorks.playAction(this.player,e,{duration:.3}),"Explode"===e){var t=this;this.controller.contactInfo.forEach(function(e){var r=JAMIE.scene.getObjectById(e.face.meshId);if(r){var n=t.explosionPoints;"game.terrain"===r.name?!1===n.isExplosion?(n.wasExplosion=!1,n.isExplosion=!1):(n.wasExplosion=!0,n.isExplosion=!1):!1===n.isExplosion?(n.wasExplosion=!1,n.isExplosion=!0,n&&n.explode(e.contactPoint)):(n.wasExplosion=!0,n.isExplosion=!0)}else console.warn(">> warning: collision detection but cannot find the intersected faces...")})}},update:function(e,t){this.explosionPoints.update()}}),Ee.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:Ee,isHeroController:!0,printAnimState:function(e){console.log("--- "+e+" ---"),console.log("Ground: "+wasGrounded+" ==> "+this.isGrounded),console.log("Slope : "+wasOnSlope+" ==> "+this.isOnSlope),console.log("Idle  : "+wasIdling+" ==> "+this.isIdling),console.log("Run   : "+wasRunning+" ==> "+this.isRunning),console.log("Jump  : "+wasJumping+" ==> "+this.isJumping)},events:function(){var e,t,r,n,i=!0;return function(){if(i)return i=!1,e=this.isGrounded,t=this.isOnSlope,this.isIdling,r=this.isRunning,void(n=this.isJumping);r||this.isRunning||!this.isGrounded||this.isIdling?!r&&this.isRunning&&!this.isJumping&&this.isGrounded||!e&&this.isGrounded&&this.isRunning||t&&!this.isOnSlope&&this.isRunning&&this.isGrounded?(this.isIdling=!1,this.movementSpeed>_e?this.dispatchEvent({type:"startRunning"}):this.dispatchEvent({type:"startWalking"})):!n&&this.isJumping?(this.isIdling=!1,this.dispatchEvent({type:"startJumping"})):!t&&this.isOnSlope?this.dispatchEvent({type:"startSliding"}):!e||this.isGrounded||this.isJumping||this.dispatchEvent({type:"startFalling"}):(this.isIdling=!0,this.dispatchEvent({type:"startIdling"})),!e&&this.isGrounded,e=this.isGrounded,t=this.isOnSlope,this.isIdling,r=this.isRunning,n=this.isJumping}}(),update:function(e){this.isGrounded=!1,this.isOnSlope=!1,this.groundHeight=-1/0,this.groundNormal.set(0,1,0),this.updateGrounding(),this.updateJumping(),this.updatePosition(e),this.collisionDetection(),this.solvePosition(),this.updateVelocity(),this.events()},updateVelocity:function(){var e=-Math.cos(this.direction),t=-Math.sin(this.direction),r=!1;if(this.velocity.set(t*this.movementSpeed*this.isRunning,-20,e*this.movementSpeed*this.isRunning),0!==this.contactInfo.length||this.isJumping){if(!this.isGrounded||this.isOnSlope||this.isJumping)if(this.isOnSlope){var n=20/(1-this.groundNormal.y)*.2;this.velocity.x=this.groundNormal.x*n,this.velocity.y=-20,this.velocity.z=this.groundNormal.z*n}else this.isGrounded||this.isOnSlope||!this.isJumping||(this.velocity.y=20*this.currentJumpPower);else this.velocity.y=0;for(var i=new THREE.Vector2(t,e),a=Math.atan2(-i.y,-i.x),o=0,s=this.contactInfo.length;o<s;o++){var l=this.contactInfo[o].face.normal;if(!(this.maxSlopeGradient<l.y||this.isOnSlope)){!r&&l.y<0&&(r=!0);var u=new THREE.Vector2(l.x,l.z).normalize(),c=Math.atan2(u.y,u.x);Math.abs(a-c)>=.5*Math.PI&&Math.abs(a-c)<=1.5*Math.PI||(u.set(i.dot(u)*u.x,i.dot(u)*u.y),i.sub(u),this.velocity.x=i.x*this.movementSpeed*this.isRunning,this.velocity.z=i.y*this.movementSpeed*this.isRunning)}}r&&(this.velocity.y=Math.min(0,this.velocity.y),this.isJumping=!1)}},updateGrounding:function(){for(var e=void 0,t=void 0,r=this.collisionCandidate,n=new THREE.Vector3(this.center.x,this.center.y+this.radius,this.center.z),i=new THREE.Vector3(this.center.x,this.center.y-1e10,this.center.z),a=0,o=r.length;a<o;a++)(t=pe(n,i,r[a].a,r[a].b,r[a].c))&&!e?(e=t).face=r[a]:t&&t.contactPoint.y>e.contactPoint.y&&((e=t).face=r[a]);if(e){this.groundHeight=e.contactPoint.y,this.groundNormal.copy(e.face.normal);var s=n.y,l=this.center.y-this.radius-this.groundPadding;if(this.isJumping&&0<this.currentJumpPower)return this.isOnSlope=!1,void(this.isGrounded=!1);this.isGrounded=l<=this.groundHeight&&this.groundHeight<=s,this.isOnSlope=this.groundNormal.y<=this.maxSlopeGradient,this.isGrounded&&(this.isJumping=!1)}},updatePosition:function(e){var t=this.groundHeight+this.radius,r=this.center.x+this.velocity.x*e,n=this.center.y+this.velocity.y*e,i=this.center.z+this.velocity.z*e;this.center.set(r,this.isGrounded?t:n,i)},collisionDetection:function(){var e=this.collisionCandidate;this.contactInfo.length=0;for(var t=0,r=e.length;t<r;t++){var n=fe(this,e[t].a,e[t].b,e[t].c,e[t].normal);n&&(n.face=e[t],this.contactInfo.push(n))}},solvePosition:function(){var e,t,r=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3;if(0!==this.contactInfo.length){for(var s=0,l=this.contactInfo.length;s<l;s++)if(e=this.contactInfo[s].face,t=this.contactInfo[s].face.normal,!(this.maxSlopeGradient<t.y)){var u=this.maxSlopeGradient<=e.normal.y&&e.normal.y<1;if(this.isJumping&&0>=this.currentJumpPower&&u&&(this.isJumping=!1,this.isGrounded=!0),this.isGrounded||this.isOnSlope){r.copy(t).multiplyScalar(-this.radius).add(this.center),i.set(t.x,0,t.z).normalize();var c=(e.a.dot(t)-(t.x*r.x+t.y*r.y+t.z*r.z))/(t.x*i.x+t.y*i.y+t.z*i.z);n.copy(i).multiplyScalar(c).add(r),a.subVectors(n,r),Math.abs(o.x)>Math.abs(a.x)&&(o.x+=a.x),Math.abs(o.z)>Math.abs(a.z)&&(o.z+=a.z)}else;}this.center.add(o),this.object.position.copy(this.center)}else this.object.position.copy(this.center)},setDirection:function(){},jump:function(){this.isJumping||!this.isGrounded||this.isOnSlope||(this.jumpStartTime=Date.now(),this.currentJumpPower=1,this.isJumping=!0)},run:function(){!this.isJumping&&this.isGrounded&&(this.movementSpeed===_e?this.movementSpeed=_e+10:this.movementSpeed=_e)},updateJumping:function(){if(this.isJumping){var e=(Date.now()-this.jumpStartTime)/1e3;this.currentJumpPower=Math.cos(Math.min(e,1)*Math.PI)}}});var we=87,xe=38,Te=83,Se=40,Me=65,Re=37,Ae=68,ke=39,Pe=32,Ce=18,Le=21,Ie=Math.PI/180,Oe=0*Ie,He=45*Ie,De=90*Ie,Ne=135*Ie,Fe=180*Ie,Ue=225*Ie,Be=270*Ie,ze=315*Ie;function je(e){this.dom=e||document.body,this.isDisabled=!1,this.isUp=!1,this.isDown=!1,this.isLeft=!1,this.isRight=!1,this.isMoveKeyHolded=!1,this.frontAngle=0,this._keydownListener=function(e){if(this.isDisabled)return;switch(e.keyCode){case we:case xe:this.isUp=!0;break;case Te:case Se:this.isDown=!0;break;case Me:case Re:this.isLeft=!0;break;case Ae:case ke:this.isRight=!0;break;case Pe:this.jump();break;case Ce:case Le:e.preventDefault(),this.run();break;default:return}var t=this.frontAngle;this.updateAngle(),t!==this.frontAngle&&this.dispatchEvent({type:"movekeychange"});(this.isUp||this.isDown||this.isLeft||this.isRight)&&!this.isMoveKeyHolded&&(this.isMoveKeyHolded=!0,this.dispatchEvent({type:"movekeyon"}))}.bind(this),this._keyupListener=function(e){if(this.isDisabled)return;switch(e.keyCode){case we:case xe:this.isUp=!1;break;case Te:case Se:this.isDown=!1;break;case Me:case Re:this.isLeft=!1;break;case Ae:case ke:this.isRight=!1;break;case Pe:break;default:return}var t=this.frontAngle;this.updateAngle(),t!==this.frontAngle&&this.dispatchEvent({type:"movekeychange"});this.isUp||this.isDown||this.isLeft||this.isRight||e.keyCode!==we&&e.keyCode!==xe&&e.keyCode!==Te&&e.keyCode!==Se&&e.keyCode!==Me&&e.keyCode!==Re&&e.keyCode!==Ae&&e.keyCode!==ke||(this.isMoveKeyHolded=!1,this.dispatchEvent({type:"movekeyoff"}))}.bind(this),this._blurListener=function(){this.isUp=!1,this.isDown=!1,this.isLeft=!1,this.isRight=!1,this.isMoveKeyHolded&&(this.isMoveKeyHolded=!1,this.dispatchEvent({type:"movekeyoff"}))}.bind(this),this.dom.addEventListener("keydown",this._keydownListener,!1),this.dom.addEventListener("keyup",this._keyupListener,!1),this.dom.addEventListener("blur",this._blurListener,!1)}je.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:je,isKeyInputControl:!0,jump:function(){this.dispatchEvent({type:"jumpkeypress"})},run:function(){this.dispatchEvent({type:"runkeypress"})},updateAngle:function(){var e=this.isUp,t=this.isDown,r=this.isLeft,n=this.isRight;!e||r||t||n?e&&r&&!t&&!n?this.frontAngle=He:e||!r||t||n?!e&&r&&t&&!n?this.frontAngle=Ne:e||r||!t||n?!e&&!r&&t&&n?this.frontAngle=Ue:e||r||t||!n?e&&!r&&!t&&n&&(this.frontAngle=ze):this.frontAngle=Be:this.frontAngle=Fe:this.frontAngle=De:this.frontAngle=Oe}});var Ve=2*Math.PI,Ge=Math.PI/2,We=new THREE.Matrix4,Xe=new THREE.Matrix4,Ye=new THREE.Matrix4;function qe(e,t,r){r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.camera=e,this.trackObject=t,this.dom=r.dom||document.body,this.offset=r.offset||new THREE.Vector3(0,0,0),this.radius=r.radius||10,this.minRadius=r.minRadius||1,this.maxRadius=r.maxRadius||80,this.rigidObjects=r.rigidObjects||[],this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.mouseAccelerationX=void 0!==r.mouseAccelerationX?r.mouseAccelerationX:100,this.mouseAccelerationY=void 0!==r.mouseAccelerationY?r.mouseAccelerationY:30,this._pointerStart={x:0,y:0},this._pointerLast={x:0,y:0},this.setNearPlainCornersWithPadding(),this.update(),this._mousedownListener=function(e){e.button===THREE.MOUSE.LEFT&&(this.dispatchEvent({type:"mousedown"}),this._pointerStart.x=e.clientX,this._pointerStart.y=e.clientY,this._pointerLast.x=this.lon,this._pointerLast.y=this.lat,this.dom.removeEventListener("mousemove",this._mousedragListener,!1),this.dom.addEventListener("mousemove",this._mousedragListener,!1))}.bind(this),this._mouseupListener=function(){event.button===THREE.MOUSE.LEFT&&(this.dispatchEvent({type:"mouseup"}),this.dom.removeEventListener("mousemove",this._mousedragListener,!1))}.bind(this),this._mousedragListener=function(e){if(e.button===THREE.MOUSE.LEFT){var t=this.dom.offsetWidth,r=this.dom.offsetHeight,n=(this._pointerStart.x-e.clientX)/t*2,i=(this._pointerStart.y-e.clientY)/r*2;this.setLatLon(this._pointerLast.y+i*this.mouseAccelerationY,this._pointerLast.x+n*this.mouseAccelerationX)}}.bind(this),this._scrollListener=function(e){e.preventDefault(),e.wheelDeltaY?this.radius-=.05*e.wheelDeltaY/5:e.wheelDelta?this.radius-=.05*e.wheelDelta/5:e.detail&&(this.radius+=e.detail/5);this.radius=Math.max(this.radius,this.minRadius),this.radius=Math.min(this.radius,this.maxRadius)}.bind(this),this.dom.addEventListener("mousedown",this._mousedownListener,!1),this.dom.addEventListener("mouseup",this._mouseupListener,!1),this.dom.addEventListener("wheel",this._scrollListener,!0),this.dom.addEventListener("DOMMouseScroll",this._scrollListener,!0)}qe.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:qe,isTPSCameraControl:!0,handleResize:function(){},update:function(){this._center=new THREE.Vector3(this.trackObject.matrixWorld.elements[12]+this.offset.x,this.trackObject.matrixWorld.elements[13]+this.offset.y,this.trackObject.matrixWorld.elements[14]+this.offset.z);var e=new THREE.Vector3(Math.cos(this.phi)*Math.cos(this.theta+Ge),Math.sin(this.phi),Math.cos(this.phi)*Math.sin(this.theta+Ge)),t=this.collisionTest(e.clone().normalize());e.multiplyScalar(t),e.add(this._center),this.camera.position.copy(e),90===this.lat?this.camera.up.set(Math.cos(this.theta+Math.PI),0,Math.sin(this.theta+Math.PI)):-90===this.lat?this.camera.up.set(Math.cos(this.theta),0,Math.sin(this.theta)):this.camera.up.set(0,1,0),this.camera.lookAt(this._center),this.dispatchEvent({type:"updated"})},getFrontAngle:function(){return Ve+this.theta},setNearPlainCornersWithPadding:function(){var e=this.camera.near,t=.5*this.camera.fov,r=Math.tan(t*THREE.Math.DEG2RAD)*e,n=r*this.camera.aspect;this.nearPlainCornersWithPadding=[new THREE.Vector3(-n-e,-r-e,0),new THREE.Vector3(n+e,-r-e,0),new THREE.Vector3(n+e,r+e,0),new THREE.Vector3(-n-e,r+e,0)]},setLatLon:function(e,t){this.lat=e>90?90:e<-90?-90:e,this.lon=t<0?360+t%360:t%360,this.phi=this.lat*THREE.Math.DEG2RAD,this.theta=-this.lon*THREE.Math.DEG2RAD},collisionTest:function(e){var t=this.radius;Xe.makeRotationX(this.phi),Ye.makeRotationY(this.theta),We.multiplyMatrices(Xe,Ye);for(var r=0;r<4;r++){var n=this.nearPlainCornersWithPadding[r].clone();n.applyMatrix4(We);var i=new THREE.Vector3(this._center.x+n.x,this._center.y+n.y,this._center.z+n.z),a=new THREE.Raycaster(i,e,this.camera.near,this.radius).intersectObjects(this.rigidObjects);0!==a.length&&a[0].distance<t&&(t=a[0].distance)}return t}});var Ze={Element:function(e){this.dom=e}};Ze.Element.prototype={add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof Ze.Element?this.dom.appendChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof Ze.Element?this.dom.removeChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},clear:function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)},setId:function(e){return this.dom.id=e,this},setClass:function(e){return this.dom.className=e,this},setStyle:function(e,t){for(var r=0;r<t.length;r++)this.dom.style[e]=t[r];return this},setDisabled:function(e){return this.dom.disabled=e,this},setTextContent:function(e){return this.dom.textContent=e,this}};["position","left","top","right","bottom","width","height","maxHeight","display","overflow","border","borderLeft","borderTop","borderRight","borderBottom","borderRadius","borderColor","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","verticalAlign","textAlign","textDecoration","textTransform","textShadow","cursor","zIndex","transform","transition","lineHeight","visibility","textIndent","wordBreak","boxShadow"].forEach(function(e){var t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);Ze.Element.prototype[t]=function(){return this.setStyle(e,arguments),this}});["KeyDown","KeyUp","MouseDown","MouseUp","MouseEnter","MouseLeave","MouseOver","MouseOut","Click","DblClick","Change","Input"].forEach(function(e){var t="on"+e;Ze.Element.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this),!1),this}}),Ze.Span=function(){return Ze.Element.call(this),this.dom=document.createElement("span"),this},Ze.Span.prototype=Object.create(Ze.Element.prototype),Ze.Span.prototype.constructor=Ze.Span,Ze.Div=function(){return Ze.Element.call(this),this.dom=document.createElement("div"),this},Ze.Div.prototype=Object.create(Ze.Element.prototype),Ze.Div.prototype.constructor=Ze.Div,Ze.Row=function(){Ze.Element.call(this);var e=document.createElement("div");return e.className="Row",this.dom=e,this},Ze.Row.prototype=Object.create(Ze.Element.prototype),Ze.Row.prototype.constructor=Ze.Row,Ze.Column=function(){Ze.Element.call(this);var e=document.createElement("div");return e.className="Column",this.dom=e,this},Ze.Column.prototype=Object.create(Ze.Element.prototype),Ze.Column.prototype.constructor=Ze.Column,Ze.Panel=function(){Ze.Element.call(this);var e=document.createElement("div");return e.className="Panel",this.dom=e,this},Ze.Panel.prototype=Object.create(Ze.Element.prototype),Ze.Panel.prototype.constructor=Ze.Panel,Ze.Text=function(e){Ze.Element.call(this);var t=document.createElement("span");return t.className="Text",t.style.cursor="default",t.style.display="inline-block",t.style.verticalAlign="middle",this.dom=t,this.setValue(e),this},Ze.Text.prototype=Object.create(Ze.Element.prototype),Ze.Text.prototype.constructor=Ze.Text,Ze.Text.prototype.getValue=function(){return this.dom.textContent},Ze.Text.prototype.setValue=function(e){return void 0!==e&&(this.dom.textContent=e),this},Ze.Input=function(e){Ze.Element.call(this);var t=document.createElement("input");return t.className="Input",t.style.padding="2px",t.style.border="1px solid transparent",t.addEventListener("keydown",function(e){e.stopPropagation()},!1),this.dom=t,this.setValue(e),this},Ze.Input.prototype=Object.create(Ze.Element.prototype),Ze.Input.prototype.constructor=Ze.Input,Ze.Input.prototype.getValue=function(){return this.dom.value},Ze.Input.prototype.setValue=function(e){return this.dom.value=e,this},Ze.TextArea=function(){Ze.Element.call(this);var e=document.createElement("textarea");return e.className="TextArea",e.style.padding="2px",e.spellcheck=!1,e.addEventListener("keydown",function(t){if(t.stopPropagation(),9===t.keyCode){t.preventDefault();var r=e.selectionStart;e.value=e.value.substring(0,r)+"\t"+e.value.substring(r),e.selectionStart=r+1,e.selectionEnd=e.selectionStart}},!1),this.dom=e,this},Ze.TextArea.prototype=Object.create(Ze.Element.prototype),Ze.TextArea.prototype.constructor=Ze.TextArea,Ze.TextArea.prototype.getValue=function(){return this.dom.value},Ze.TextArea.prototype.setValue=function(e){return this.dom.value=e,this},Ze.Select=function(){Ze.Element.call(this);var e=document.createElement("select");return e.className="Select",e.style.padding="2px",this.dom=e,this},Ze.Select.prototype=Object.create(Ze.Element.prototype),Ze.Select.prototype.constructor=Ze.Select,Ze.Select.prototype.setMultiple=function(e){return this.dom.multiple=e,this},Ze.Select.prototype.setOptions=function(e){for(var t=this.dom.value;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var r in e){var n=document.createElement("option");n.value=r,n.innerHTML=e[r],this.dom.appendChild(n)}return this.dom.value=t,this},Ze.Select.prototype.getValue=function(){return this.dom.value},Ze.Select.prototype.setValue=function(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this},Ze.Checkbox=function(e){Ze.Element.call(this);var t=document.createElement("input");return t.className="Checkbox",t.type="checkbox",this.dom=t,this.setValue(e),this},Ze.Checkbox.prototype=Object.create(Ze.Element.prototype),Ze.Checkbox.prototype.constructor=Ze.Checkbox,Ze.Checkbox.prototype.getValue=function(){return this.dom.checked},Ze.Checkbox.prototype.setValue=function(e){return void 0!==e&&(this.dom.checked=e),this},Ze.Color=function(){Ze.Element.call(this);var e=document.createElement("input");e.className="Color",e.style.width="64px",e.style.height="17px",e.style.border="0px",e.style.padding="2px",e.style.backgroundColor="transparent";try{e.type="color",e.value="#ffffff"}catch(e){}return this.dom=e,this},Ze.Color.prototype=Object.create(Ze.Element.prototype),Ze.Color.prototype.constructor=Ze.Color,Ze.Color.prototype.getValue=function(){return this.dom.value},Ze.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},Ze.Color.prototype.setValue=function(e){return this.dom.value=e,this},Ze.Color.prototype.setHexValue=function(e){return this.dom.value="#"+("000000"+e.toString(16)).slice(-6),this},Ze.Number=function(e){Ze.Element.call(this);var t=this,r=document.createElement("input");r.className="Number",r.value="0.00",r.addEventListener("keydown",function(e){e.stopPropagation(),13===e.keyCode&&r.blur()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.unit="",this.dom=r,this.setValue(e);var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var u=a+i/(e.shiftKey?5:50)*t.step;l!==(u=Math.min(t.max,Math.max(t.min,u)))&&(t.setValue(u),r.dispatchEvent(n)),s=[e.clientX,e.clientY]}function u(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",u,!1),Math.abs(i)<2&&(r.focus(),r.select())}function c(e){var l=t.value;o=[e.touches[0].pageX,e.touches[0].pageY],i+=o[0]-s[0]-(o[1]-s[1]);var u=a+i/(e.shiftKey?5:50)*t.step;l!==(u=Math.min(t.max,Math.max(t.min,u)))&&(t.setValue(u),r.dispatchEvent(n)),s=[e.touches[0].pageX,e.touches[0].pageY]}function h(e){0===e.touches.length&&(document.removeEventListener("touchmove",c,!1),document.removeEventListener("touchend",h,!1))}function d(e){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}return d(),r.addEventListener("mousedown",function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1)},!1),r.addEventListener("touchstart",function(e){1===e.touches.length&&(i=0,a=t.value,s=[e.touches[0].pageX,e.touches[0].pageY],document.addEventListener("touchmove",c,!1),document.addEventListener("touchend",h,!1))},!1),r.addEventListener("change",function(e){t.setValue(r.value)},!1),r.addEventListener("focus",function(e){r.style.backgroundColor="",r.style.cursor=""},!1),r.addEventListener("blur",d,!1),this},Ze.Number.prototype=Object.create(Ze.Element.prototype),Ze.Number.prototype.constructor=Ze.Number,Ze.Number.prototype.getValue=function(){return this.value},Ze.Number.prototype.setValue=function(e){return void 0!==e&&((e=parseFloat(e))<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,this.dom.value=e.toFixed(this.precision),""!==this.unit&&(this.dom.value+=" "+this.unit)),this},Ze.Number.prototype.setPrecision=function(e){return this.precision=e,this},Ze.Number.prototype.setStep=function(e){return this.step=e,this},Ze.Number.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},Ze.Number.prototype.setUnit=function(e){return this.unit=e,this},Ze.Integer=function(e){Ze.Element.call(this);var t=this,r=document.createElement("input");r.className="Number",r.value="0",r.addEventListener("keydown",function(e){e.stopPropagation()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.step=1,this.dom=r,this.setValue(e);var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var u=a+i/(e.shiftKey?5:50)*t.step;l!==(u=0|Math.min(t.max,Math.max(t.min,u)))&&(t.setValue(u),r.dispatchEvent(n)),s=[e.clientX,e.clientY]}function u(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",u,!1),Math.abs(i)<2&&(r.focus(),r.select())}function c(e){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}return c(),r.addEventListener("mousedown",function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1)},!1),r.addEventListener("change",function(e){t.setValue(r.value)},!1),r.addEventListener("focus",function(e){r.style.backgroundColor="",r.style.cursor=""},!1),r.addEventListener("blur",c,!1),this},Ze.Integer.prototype=Object.create(Ze.Element.prototype),Ze.Integer.prototype.constructor=Ze.Integer,Ze.Integer.prototype.getValue=function(){return this.value},Ze.Integer.prototype.setValue=function(e){return void 0!==e&&(e=parseInt(e),this.value=e,this.dom.value=e),this},Ze.Integer.prototype.setStep=function(e){return this.step=parseInt(e),this},Ze.Integer.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},Ze.Break=function(){Ze.Element.call(this);var e=document.createElement("br");return e.className="Break",this.dom=e,this},Ze.Break.prototype=Object.create(Ze.Element.prototype),Ze.Break.prototype.constructor=Ze.Break,Ze.HorizontalRule=function(){Ze.Element.call(this);var e=document.createElement("hr");return e.className="HorizontalRule",this.dom=e,this},Ze.HorizontalRule.prototype=Object.create(Ze.Element.prototype),Ze.HorizontalRule.prototype.constructor=Ze.HorizontalRule,Ze.Button=function(e){Ze.Element.call(this);var t=document.createElement("button");return t.className="Button",this.dom=t,this.dom.textContent=e,this},Ze.Button.prototype=Object.create(Ze.Element.prototype),Ze.Button.prototype.constructor=Ze.Button,Ze.Button.prototype.setLabel=function(e){return this.dom.textContent=e,this},Ze.TabbedPanel=function(){Ze.Element.call(this);var e=document.createElement("div");return this.dom=e,this.setClass("TabbedPanel"),this.tabs=[],this.panels=[],this.tabsDiv=new Ze.Div,this.tabsDiv.setClass("Tabs"),this.panelsDiv=new Ze.Div,this.panelsDiv.setClass("Panels"),this.add(this.tabsDiv),this.add(this.panelsDiv),this.selected="",this},Ze.TabbedPanel.prototype=Object.create(Ze.Element.prototype),Ze.TabbedPanel.prototype.constructor=Ze.TabbedPanel,Ze.TabbedPanel.prototype.select=function(e){var t,r,n=this;return this.selected&&this.selected.length&&(t=this.tabs.find(function(e){return e.dom.id===n.selected}),r=this.panels.find(function(e){return e.dom.id===n.selected}),t&&t.removeClass("selected"),r&&r.setDisplay("none")),t=this.tabs.find(function(t){return t.dom.id===e}),r=this.panels.find(function(t){return t.dom.id===e}),t&&t.addClass("selected"),r&&r.setDisplay(""),this.selected=e,this},Ze.TabbedPanel.prototype.addTab=function(e,t,r){var n=new Ze.TabbedPanel.Tab(t,this);n.setId(e),this.tabs.push(n),this.tabsDiv.add(n);var i=new Ze.Div;i.setId(e),i.add(r),i.setDisplay("none"),this.panels.push(i),this.panelsDiv.add(i),this.select(e)},Ze.TabbedPanel.Tab=function(e,t){Ze.Text.call(this,e),this.parent=t,this.setClass("Tab");var r=this;return this.dom.addEventListener("click",function(e){r.parent.select(r.dom.id)}),this},Ze.TabbedPanel.Tab.prototype=Object.create(Ze.Text.prototype),Ze.TabbedPanel.Tab.prototype.constructor=Ze.TabbedPanel.Tab,Ze.Listbox=function(){Ze.Element.call(this);var e=document.createElement("div");return e.className="Listbox",e.tabIndex=0,this.dom=e,this.items=[],this.listitems=[],this.selectedIndex=0,this.selectedValue=null,this},Ze.Listbox.prototype=Object.create(Ze.Element.prototype),Ze.Listbox.prototype.constructor=Ze.Listbox,Ze.Listbox.prototype.setItems=function(e){Array.isArray(e)&&(this.items=e),this.render()},Ze.Listbox.prototype.render=function(){for(;this.listitems.length;){(t=this.listitems[0]).dom.remove(),this.listitems.splice(0,1)}for(var e=0;e<this.items.length;e++){var t=this.items[e],r=new Ze.Listbox.ListboxItem(this);r.setId(t.id||`Listbox-${e}`),r.setTextContent(t.name||t.type),this.add(r)}},Ze.Listbox.prototype.add=function(){var e=Array.from(arguments);this.listitems=this.listitems.concat(e),Ze.Element.prototype.add.apply(this,e)},Ze.Listbox.prototype.selectIndex=function(e){e>=0&&e<this.items.length&&this.setValue(this.listitems[e].getId()),this.selectedIndex=e},Ze.Listbox.prototype.getValue=function(){return this.selectedValue},Ze.Listbox.prototype.setValue=function(e){for(var t=0;t<this.listitems.length;t++){var r=this.listitems[t];r.getId()===e?r.addClass("active"):r.removeClass("active")}this.selectedValue=e;var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0),this.dom.dispatchEvent(n)},Ze.Listbox.ListboxItem=function(e){Ze.Element.call(this);var t=document.createElement("div");t.className="ListboxItem",this.parent=e,this.dom=t;var r=this;return t.addEventListener("click",function(){r.parent&&r.parent.setValue(r.getId())},!1),this},Ze.Listbox.ListboxItem.prototype=Object.create(Ze.Element.prototype),Ze.Listbox.ListboxItem.prototype.constructor=Ze.Listbox.ListboxItem,Ze.Image=function(e){Ze.Element.call(this);var t=document.createElement("img");return t.className="Image",t.src=e,this.dom=t,this},Ze.Image.prototype=Object.create(Ze.Element.prototype),Ze.Image.prototype.constructor=Ze.Image,Ze.Tooltip=function(e){Ze.Element.call(this);var t=document.createElement("span");return t.setAttribute("data-tooltip",e),t.setAttribute("data-tooltip-position","top"),this.dom=t,this},Ze.Tooltip.prototype=Object.create(Ze.Element.prototype),Ze.Tooltip.prototype.constructor=Ze.Tooltip,Ze.Modal=function(){var e=this,t=document.createElement("div");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.display="none",t.style.alignItems="center",t.style.justifyContent="center",t.addEventListener("click",function(t){e.hide()}),this.dom=t,this.container=new Ze.Panel,this.container.dom.style.width="200px",this.container.dom.style.padding="20px",this.container.dom.style.backgroundColor="#ffffff",this.container.dom.style.boxShadow="0px 5px 10px rgba(0,0,0,0.5)",this.add(this.container),this},Ze.Modal.prototype=Object.create(Ze.Element.prototype),Ze.Modal.prototype.constructor=Ze.Modal,Ze.Modal.prototype.show=function(e){return this.container.clear(),this.container.add(e),this.dom.style.display="flex",this},Ze.Modal.prototype.hide=function(){return this.dom.style.display="none",this},Ze.Texture=function(e){Ze.Element.call(this);var t=this,r=document.createElement("span"),n=document.createElement("form"),i=document.createElement("input");i.type="file",i.addEventListener("change",function(e){o(e.target.files[0])}),n.appendChild(i);var a=document.createElement("canvas");function o(r){if(r.type.match("image.*")){var i=new FileReader;"image/targa"===r.type?(i.addEventListener("load",function(n){var i=(new THREE.TGALoader).parse(n.target.result),a=new THREE.CanvasTexture(i,e);a.sourceFile=r.name,t.setValue(a),t.onChangeCallback&&t.onChangeCallback(a)},!1),i.readAsArrayBuffer(r)):(i.addEventListener("load",function(n){var i=document.createElement("img");i.addEventListener("load",function(n){var i=new THREE.Texture(this,e);i.sourceFile=r.name,i.format="image/jpeg"===r.type?THREE.RGBFormat:THREE.RGBAFormat,i.needsUpdate=!0,t.setValue(i),t.onChangeCallback&&t.onChangeCallback(i)},!1),i.src=n.target.result},!1),i.readAsDataURL(r))}n.reset()}return a.width=50,a.height=50,a.style.cursor="pointer",a.style.marginRight="5px",a.style.border="1px solid #888",a.addEventListener("click",function(e){i.click()},!1),a.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),a.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),o(e.dataTransfer.files[0])},!1),r.appendChild(a),this.dom=r,this.texture=null,this.onChangeCallback=null,this},Ze.Texture.prototype=Object.create(Ze.Element.prototype),Ze.Texture.prototype.constructor=Ze.Texture,Ze.Texture.prototype.getValue=function(){return this.texture},Ze.Texture.prototype.setValue=function(e){var t=this.dom.children[0],r=t.getContext("2d");if(null!==e){var n=e.isCubeTexture?e.image[0]:e.image;if(void 0!==n&&n.width>0){t.title=e.sourceFile;var i=t.width/n.width;r.drawImage(n,0,0,n.width*i,n.height*i)}else t.title=e.sourceFile+" (error)",r.clearRect(0,0,t.width,t.height)}else t.title="empty",null!==r&&r.clearRect(0,0,t.width,t.height);this.texture=e},Ze.Texture.prototype.setEncoding=function(e){var t=this.getValue();return null!==t&&(t.encoding=e),this},Ze.Texture.prototype.onChange=function(e){return this.onChangeCallback=e,this},Ze.Tree=function(e){Ze.Element.call(this);var t=this;this.appWorks=e;var r=document.createElement("div");return r.className="Tree",r.tabIndex=0,r.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 40:e.preventDefault(),e.stopPropagation()}},!1),r.addEventListener("keyup",function(e){switch(e.keyCode){case 38:t.selectIndex(t.selectedIndex-1);break;case 40:t.selectIndex(t.selectedIndex+1)}},!1),this.dom=r,this.items=[],this.selectedIndex=-1,this},Ze.Tree.prototype=Object.create(Ze.Element.prototype),Ze.Tree.prototype.constructor=Ze.Tree,Ze.Tree.prototype.selectIndex=function(e){e>=0&&e<this.items.length&&(this.selectedIndex=e,this.appWorks.selectById(parseInt(this.items[e].id)))},Ze.Tree.prototype.clean=function(e,t){for(var r=this.items,n=0,i=r.length;n<i;n++)r[n].classList.toggle(e,t)},Ze.Tree.prototype.toggle=function(e,t,r){e.forEach(function(e){var n=document.getElementById(e);n&&n.classList.toggle(t,r)})},Ze.Tree.prototype.setInnerHTML=function(e){for(var t=this.appWorks;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);this.dom.innerHTML=e;for(var r,n,i,a=this.dom.getElementsByClassName("box"),o=0;o<a.length;o++){(w=a[o]).addEventListener("click",function(e){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("check-box")})}function s(e){e.stopPropagation();var r=void 0;e.ctrlKey?r="multiple":e.altKey&&(r="ancestor"),t.selectById(parseInt(this.id),r)}function l(e){e.stopPropagation(),e.preventDefault(),t.selectById(parseInt(this.id)),t.guiContextMenu.toggle(e)}function u(e){e.preventDefault(),r&&clearTimeout(r),t.mouseMovePosition.copy(t.getMousePosition(e))}function c(e){e.preventDefault(),n||(t.selectById(parseInt(this.id)),r=setTimeout(d,500,e),n=!0,t.mouseDownPosition.copy(t.getMousePosition(e)),document.addEventListener("touchend",h,!1))}function h(e){r&&(clearTimeout(r),n=!1),t.mouseUpPosition.copy(t.getMousePosition(e)),document.removeEventListener("touchend",h,!1)}function d(e){e.stopPropagation(),e.preventDefault(),t.guiContextMenu.toggle(e)}function f(e){i=this,e.stopPropagation()}function p(e){e.dataTransfer.setData("text","foo"),e.stopPropagation()}function m(e){if(this!==i){var t=e.offsetY/this.clientHeight;this.className=t<.25?"dragTop":t>.75?"dragBottom":"drag",e.preventDefault()}}function v(){this!==i&&(this.className="")}function g(e){if(this!==i){this.className="";var r=t.scene,n=r.getObjectById(parseInt(i.id));if(void 0!==n){var a=e.offsetY/this.clientHeight;if(a<.25)y(n,(o=r.getObjectById(parseInt(this.id))).parent,o);else if(a>.75){var o;y(n,(o=r.getObjectById(parseInt(this.nextSibling.id))).parent,o)}else{y(n,r.getObjectById(parseInt(this.id)))}e.stopPropagation()}}}function y(e,r,n){if(null!==r){null===n&&(n=void 0);var i=!1;e.traverse(function(e){e===r&&(i=!0)}),i||t.move(e,r,n)}}var _=this.dom.getElementsByTagName("li");this.items=_;var b=this.appWorks.scene.id.toString(),E=this.appWorks.camera.id.toString();for(o=0;o<_.length;o++){var w;(w=_[o]).className="",w.addEventListener("click",s,!1),w.addEventListener("contextmenu",l,!1),w.addEventListener("touchmove",u,!0),w.addEventListener("touchstart",c,!1),w.id===b||w.id===E?w.draggable=!1:(w.draggable=!0,w.addEventListener("drag",f,!1),w.addEventListener("dragstart",p,!1),w.addEventListener("dragover",m,!1),w.addEventListener("dragleave",v,!1),w.addEventListener("drop",g,!1))}var x=t.selectObjects.map(function(e){return e.id.toString()});this.clean("selected",!1),this.toggle(x,"selected",!0);x=[];return t.scene.traverse(function(e){!1===e.visible&&x.push(e.id.toString())}),this.clean("translucent",!1),this.toggle(x,"translucent",!0),this},Ze.Boolean=function(e,t){Ze.Span.call(this),this.setMarginRight("10px"),this.checkbox=new Ze.Checkbox(e),this.text=new Ze.Text(t).setMarginLeft("3px"),this.add(this.checkbox),this.add(this.text)},Ze.Boolean.prototype=Object.create(Ze.Span.prototype),Ze.Boolean.prototype.constructor=Ze.Boolean,Ze.Boolean.prototype.getValue=function(){return this.checkbox.getValue()},Ze.Boolean.prototype.setValue=function(e){return this.checkbox.setValue(e)},window.MW=n,b.demoFallingLeaves=function(e,t){e=void 0!==e?e:"images/leaf.png",t=void 0!==t?t:1e4;for(var r=new b.InstancedMesh(new THREE.PlaneBufferGeometry(.1,.1),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(e),side:THREE.DoubleSide,transparent:!0,opacity:.99,depthWrite:!1}),t,!0,!0,!0),n=2*Math.PI,i=new THREE.Vector3,a=new THREE.Euler,o=new THREE.Quaternion,s=new THREE.Vector3,l=new THREE.Color,u=0;u<t;u++){i.set(50*(Math.random()-.5),50*(Math.random()-.5)+25,50*(Math.random()-.5)),a.set(0,Math.random()*n,0),o.setFromEuler(a);var c=1+Math.random();s.set(c,c,c),l.setHSL(1,Math.random(),.5),r.setPositionAt(u,i),r.setQuaternionAt(u,o),r.setScaleAt(u,s),r.setColorAt(u,l)}r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,b.add(r),r.update=function(e,t){for(var r=.1*e,n=new THREE.Vector3,i=new THREE.Euler,a=new THREE.Quaternion,o=new THREE.Vector3,s=0;s<this.numInstances;s++)this.getPositionAt(s,n),n.y<.01?n.x<-25?(n.x=50*(Math.random()-.5),n.y=50*(Math.random()-.5)+25,n.z=50*(Math.random()-.5)):(n.x-=5*r,n.z+=5*r*(Math.random()-.5),this.getQuaternionAt(s,a),i.setFromQuaternion(a),i.x=-Math.PI/2,i.y=0,a.setFromEuler(i),this.setQuaternionAt(s,a)):n.y-=5*r,this.setPositionAt(s,n),this.getQuaternionAt(s,a),this.getScaleAt(s,o),i.setFromQuaternion(a),i.x+=o.x*r,i.z+=o.z*r,a.setFromEuler(i),this.setQuaternionAt(s,a);this.needsUpdate("position"),this.needsUpdate("quaternion"),this.rotation.y=.1*Math.sin(.5*t)}},b.demoNatureWorks2018=function(){var e=b.scene,t=b.camera;b.appWorks.playAudio(["audio/NatureWorks.mp3"]),b.appWorks.bloomPass.enabled=!0,e.getObjectsByType("AmbientLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("PointLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("SpotLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("DirectionalLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("HemisphereLight").forEach(function(e){e.visible=!1}),b.demoTerrains();var r=b.sunLight;r.updateMotion("constant"),b.addTextMesh("www.natureworks.solutions",{position:{x:-3.5,y:1.1,z:0},color:2236962,height:.25,alignment:0,fontFile:"fonts/optimer_regular.typeface.json"});var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(.85,.85),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("images/leaf.png"),side:THREE.DoubleSide,transparent:!0,opacity:.99,depthWrite:!1}));n.position.x-=4,n.position.y+=.5,b.add(n);b.addTextMesh("N",{position:{x:-3,y:0,z:0},color:16716032,rotSpeed:0}),b.addTextMesh("ature",{position:{x:-1,y:0,z:0},color:8947848}),b.addTextMesh("W",{position:{x:4.2-3,y:0,z:0},color:4607,rotSpeed:.6}),b.addTextMesh("orks",{position:{x:5.9-3,y:0,z:0},color:8947848}),b.demoFallingLeaves("images/leaf.png",5e3);for(var i=[],a=0;a<6;a++){var o=Math.PI*a/4,s=7*Math.cos(o),l=5*Math.sin(2*o);l=Math.max(l,1);var u=9*Math.sin(o);i.push(new THREE.Vector3(s,l,u))}var c=new THREE.CatmullRomCurve3(i,!0),h=new THREE.Line((new THREE.BufferGeometry).setFromPoints(c.getPoints(20)),new THREE.LineBasicMaterial({color:16777215}));h.visible=!1,b.add(h),h.update=function(e,r){var n=r%40/40;t.position.copy(c.getPoint(n))};var d=new THREE.Object3D;d.stage=1,b.add(d),d.update=function(e,t){10<t&&1===this.stage?(b.demoFallingLeaves("images/leaf.png",5e3),this.stage++):20<t&&2===this.stage?(b.demoFallingLeaves("images/leaves/leaf1.png",1e4),this.stage++):40<t&&3===this.stage&&(b.demoFallingLeaves("images/leaves/leaf3.png",1e4),this.stage++,r.updateMotion("static"),r.updatePosition(.49))}},b.demoBasicPrimitives=function(){var e=(new THREE.TextureLoader).load("images/uv_grid_opengl.jpg"),t=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshBasicMaterial",map:e}}),r=b.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[5,5,10,32]},material:{type:"MeshBasicMaterial",map:e}}),n=b.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshBasicMaterial",map:e}}),i=b.createPrimitive({geometry:{type:"TorusBufferGeometry",parameters:[5,1.5,128,32]},material:{type:"MeshBasicMaterial",map:e}}),a=b.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.5,128,32]},material:{type:"MeshBasicMaterial",map:e}});t.position.y=0,r.position.y=10,n.position.y=20,i.position.y=30,a.position.y=40,b.add(t),b.add(r),b.add(n),b.add(i),b.add(a)},b.demoText=function(){b.addTextMesh("[NatureWorks]",{color:4521745,height:2.5,position:{x:0,y:18,z:-5}}),b.addTextMesh("Jamie.js",{position:new THREE.Vector3(0,5,0),color:13311,height:2,thickRatio:.2}),b.addTextMesh("www.nova-graphix.com",{position:{x:1.5,y:-5,z:0},color:16716168,height:1.5,thickRatio:.5})},b.demoSprite=function(){var e=new THREE.Sprite(new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load("images/jamieElly1024.png"),color:16777215,fog:!0}));e.position.z=8,e.scale.set(5,5,5),e.name="demoSprite",b.add(e)},b.demoBox=function(){var e=new THREE.TextureLoader,t=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",color:15990754,map:e.load("images/ground/stonewall.png"),normalMap:e.load("images/ground/stonewall_n.png"),specularMap:e.load("images/ground/stonewall_s.png")}});t.position.x=-15,t.name="demoBox",t.update=function(e,t){this.rotation.x+=.1*e,this.rotation.y+=.2*e,this.rotation.z+=.5*e},b.add(t)},b.demoSpheres=function(){var e,t;(t=b.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16711680,specular:2236962,shininess:150,transparent:!0,opacity:.5}})).name="demoSphere_transparent",b.add(t),(e=b.scene.background.clone()).mapping=THREE.CubeRefractionMapping,e.needsUpdate=!0,(t=b.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16777215,specular:2236962,shininess:150,envMap:e}})).position.z=10,t.name="demoSphere_refraction",b.add(t),(e=b.scene.background).mapping=THREE.CubeReflectionMapping,e.needsUpdate=!0,(t=b.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16777215,specular:2236962,shininess:150,envMap:e}})).position.z=20,t.name="demoSphere_reflection",b.add(t)},b.demoPBRSpheres=function(){for(var e=new THREE.SphereBufferGeometry(.8,32,16),t=new THREE.Vector3(0,0,-22),r=0;r<=1;r+=.2){for(var n=0;n<=1;n+=.2)for(var i=0;i<=1;i+=.2){var a=(new THREE.Color).setHSL(r,.5,.5*i+.1),o=new THREE.MeshStandardMaterial({color:a,metalness:n,roughness:1-r,bumpScale:1});0;var s=new THREE.Mesh(e,o);s.position.x=10*r-5+t.x,s.position.y=10*n-5+t.y,s.position.z=10*i-5+t.z,s.castShadow=!0,s.name="demoPBRSpheres",b.add(s)}0}},b.demoTorusKnot=function(){var e=(new THREE.TextureLoader).load("images/roughness_map.jpg",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.anisotropy=4,e.repeat.set(9,2)}),t=b.createPrimitive({geometry:{type:"TorusKnotGeometry",parameters:[18,8,128,32]},material:{type:"MeshStandardMaterial",color:16777215,metalness:1,roughness:0,bumpScale:-.05,transparent:!0,opacity:.9,map:e,roughnessMap:e,bumpMap:e,envMap:b.scene.background}});t.scale.set(.2,.2,.2),t.position.z=-10,t.castShadow=!0,t.receiveShadow=!0,t.name="demoTorusKnot",b.add(t)},b.demoTeapot=function(){b.loadOBJ({obj:"teapot.obj",basePath:"models/obj/",callback:function(e){var t=e.children[0];void 0!==t.material&&t.material.dispose();var r=b.ToonShader,n=THREE.UniformsUtils.clone(r.uniforms);n.uMaterialColor.value=(new THREE.Color).setHSL(.34,.68,.7),n.uDirLightPos.value=new THREE.Vector3(100,100,-100),n.uDirLightColor.value=new THREE.Color(16777215),t.material=new THREE.ShaderMaterial({uniforms:n,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),b.resizeObject(t,20),b.add(e),t.position.x+=15,t.castShadow=!0,t.receiveShadow=!0,t.name="demoTeapot"}})},b.demoNoise=function(){var e=b.NoiseShader,t=THREE.UniformsUtils.clone(e.uniforms);t.scale.value=20;var r=new THREE.Mesh(new THREE.SphereBufferGeometry(5,32,16),new THREE.ShaderMaterial({uniforms:t,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}));r.position.set(17.5,0,-10),r.castShadow=!0,r.receiveShadow=!0,r.name="demoNoise",b.add(r)},b.demoDecal=function(){var e=new THREE.BoxBufferGeometry(10,10,10),t=new THREE.TextureLoader,r=t.load("images/decal/decal-diffuse.png"),n=t.load("images/decal/decal-normal.jpg"),i=b.scene.background;i.mapping=THREE.CubeReflectionMapping,i.needsUpdate=!0;var a=new THREE.MeshPhongMaterial({map:r,normalMap:n,envMap:i,alphaTest:.5}),o=new THREE.Mesh(e,a);o.position.set(-15,0,15),o.castShadow=!0,o.receiveShadow=!0,o.name="demoDecal",b.add(o)},b.demoPrimitives=function(){b.demoBasicPrimitives(),b.demoSprite(),b.demoBox(),b.demoPBRSpheres(),b.demoTorusKnot(),b.demoTeapot(),b.demoNoise(),b.demoDecal()},b.demoReflectionSpheres=function(){for(var e=b.camera.near,t=b.camera.far,r=0;r<50;r++){var n=new THREE.Mesh;n.cubeCamera=new THREE.CubeCamera(e,t,256);var i=200*(Math.random()-.5),a=200*(Math.random()-.5),o=200*(Math.random()-.5),s=10*(Math.random()+.5),l=new THREE.SphereBufferGeometry(s,32,16),u=new THREE.MeshBasicMaterial({envMap:n.cubeCamera.renderTarget.texture});n.geometry=l,n.material=u,n.position.set(i,a,o),n.castShadow=!0,n.receiveShadow=!0,n.name="demoReflectionSpheres",n.cubeCamera.position.copy(n.position),n.update=function(e,t){this.visible=!1,this.cubeCamera.update(b.renderer,b.scene),this.visible=!0},b.add(n)}},b.demoRefractionSpheres=function(){for(var e=b.camera.near,t=b.camera.far,r=0;r<20;r++){var n=new THREE.Mesh;n.cubeCamera=new THREE.CubeCamera(e,t,256);var i=150*(Math.random()-.5),a=150*(Math.random()-.5),o=150*(Math.random()-.5),s=10*(Math.random()+.5),l=new THREE.SphereBufferGeometry(s,32,16),u=new THREE.MeshBasicMaterial({envMap:n.cubeCamera.renderTarget.texture,refractionRatio:.99});u.envMap.mapping=THREE.CubeRefractionMapping,n.geometry=l,n.material=u,n.position.set(i,a,o),n.castShadow=!0,n.receiveShadow=!0,n.name="demoRefractionSpheres",n.cubeCamera.position.copy(n.position),n.update=function(e,t){this.visible=!1,this.cubeCamera.update(b.renderer,b.scene),this.visible=!0},b.add(n)}},b.demoReflectRefractSpheres=function(){b.demoReflectionSpheres(),b.demoRefractionSpheres()},b.demoPointSpriteColors=function(){for(var e=[],t=new THREE.Geometry,r=(new THREE.TextureLoader).load("images/sprites/ball.png"),n=0;n<5e4;n++){var i=new THREE.Vector3;i.x=1e4*(Math.random()-.5),i.y=1e4*(Math.random()-.5),i.z=1e4*(Math.random()-.5),t.vertices.push(i),e[n]=new THREE.Color(16777215),e[n].setHSL((i.x+500)/1e3,1,.5)}t.colors=e;var a=new THREE.PointsMaterial({size:85,map:r,vertexColors:THREE.VertexColors,alphaTest:.5,transparent:!0});a.color.setHSL(1,1,.6);var o=new THREE.Points(t,a);o.name="demoPointSpriteColors",o.update=function(e,t){var r=360*(1+.2*t)%360/360;this.material.color.setHSL(r,1,.6),this.rotation.x+=.1*e,this.rotation.y+=.2*e,this.rotation.z+=.3*e},b.add(o)},b.demoInstancedBox=function(){var e=new THREE.TextureLoader,t=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[2,2,2]},material:{type:"MeshPhongMaterial",color:15990754,specular:1118481,shininess:30,map:e.load("images/ground/stonewall.png"),normalMap:e.load("images/ground/stonewall_n.png"),specularMap:e.load("images/ground/stonewall_s.png")}}),r=b.createInstancedMeshes(t,{pmin:[-100,-100,-100],pmax:[100,100,100],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"1"});r.name="demoInstancedBox",r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.update=function(){var e=new THREE.Euler,t=new THREE.Quaternion,r=new THREE.Vector3;return function(n,i){for(var a=2*n,o=0;o<this.numInstances;o++)this.getQuaternionAt(o,t),this.getScaleAt(o,r),e.setFromQuaternion(t),e.x+=r.x*a,e.z+=r.z*a,t.setFromEuler(e),this.setQuaternionAt(o,t);this.needsUpdate("quaternion")}}(),b.add(r)},b.demoInstancedBox2=function(){var e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[1,1,1]},material:{type:"MeshPhongMaterial",map:(new THREE.TextureLoader).load("images/crate.gif")}}),t=b.createInstancedMeshes(e,{pmin:[-50,-50,-50],pmax:[50,50,50],smin:[.5,.5,.5],smax:[2,2,2],numInstances:1e4,colorMode:"0"});t.name="demoInstancedBox2",t.frustumCulled=!1,t.castShadow=!0,t.receiveShadow=!0;for(var r=t.geometry,n=new THREE.Vector4,i=[],a=[],o=0;o<t.numInstances;o++)n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),n.normalize(),i.push(n.x,n.y,n.z,n.w),n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),n.normalize(),a.push(n.x,n.y,n.z,n.w);r.addAttribute("orientStart",new THREE.InstancedBufferAttribute(new Float32Array(i),4)),r.addAttribute("orientEnd",new THREE.InstancedBufferAttribute(new Float32Array(a),4)),t.material.onBeforeCompile=function(e){e.uniforms.time={value:0},e.vertexShader=e.vertexShader.replace("#include <clipping_planes_pars_vertex>\n","#include <clipping_planes_pars_vertex>\nuniform float time;\nattribute vec4 orientStart;\nattribute vec4 orientEnd;\nvec3 animatePosition( vec3 position )\n{\nfloat sineTime = sin(time * 0.5);\nvec3 animated = instanceScale * position;\nanimated = instancePosition * max( abs( sineTime * 2.0 + 1.0 ), 0.5 ) + animated;\nvec4 orient = normalize( mix( orientStart, orientEnd, sineTime ) );\nvec3 vcV = cross( orient.xyz, animated );\nanimated = vcV * ( 2.0 * orient.w ) + ( cross( orient.xyz, vcV ) * 2.0 + animated );\nreturn animated;\n}\n"),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","vec3 position = animatePosition( position );\n#include <begin_vertex>"),this.shader=e},t.update=function(e,t){t*=.1,this.rotation.y=t,this.material.shader.uniforms.time.value=2*t},b.add(t)},b.demoInstancedFish=function(){b.loadOBJ({obj:"fish.obj",mtl:"fish.mtl",basePath:"models/obj/fish/",callback:function(e){b.add(e),b.underWaterBackground();if(void 0!==e){var t=e.children[0];b.translateGeometry(t.geometry,{x:2.585,y:0,z:0}),t.material.transparent=!0,t.material.fog=!0;var r=new b.InstancedMesh(t.geometry,t.material,5e3,!0,!1,!0);r.material.onBeforeCompile=function(e){e.uniforms.time={value:0},e.uniforms.fishSpeed={value:.5+.5*Math.random()},e.uniforms.fishLength={value:18},e.vertexShader="uniform float time;\nuniform float fishSpeed;\nuniform float fishLength;\n"+b.ShaderChunk.fishAnimation+"\n"+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","vec3 position = fishAnimation( position );\n#include <begin_vertex>"),e.fragmentShader=e.fragmentShader.replace("gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","gl_FragColor.rgb = mix( gl_FragColor.rgb*(1.0-fogFactor), fogColor, fogFactor );"),r.material.shader=e};for(var n,i=new THREE.Vector3,a=new THREE.Euler,o=new THREE.Quaternion,s=new THREE.Vector3,l=2*Math.PI,u=[],c=0;c<5e3;c++)i.set(500*(Math.random()-.5),500*(Math.random()-.5)-250,500*(Math.random()-.5)),a.set(0,Math.random()*l,0),o.setFromEuler(a),u.push(a.y),n=2+1.5*Math.random(),s.set(n,n,n),r.setPositionAt(c,i),r.setQuaternionAt(c,o),r.setScaleAt(c,s);r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,r.name="demoInstancedFish",b.add(r),r.update=function(e,t){this.material.shader&&(this.material.shader.uniforms.time.value=t);for(var r=10*e,n=new THREE.Vector3,i=0;i<this.numInstances;i++){this.getPositionAt(i,n);var a=u[i];n.x<-250?n.x=250:n.x>250?n.x=-250:n.x+=r*Math.sin(a),n.z<-250?n.z=250:n.z>250?n.z=-250:n.z+=r*Math.cos(a),this.setPositionAt(i,n)}this.needsUpdate("position")}}}})},b.demoViewportCamera=function(){var e=new THREE.Object3D;e.name="multiViews";var t=b.camera.position.length();e.views=[],e.views.push({left:.5,bottom:.5,width:.5,height:.5,eye:[t,t,t],up:[0,1,0],camera:null},{left:0,bottom:.5,width:.5,height:.5,eye:[0,t,0],up:[0,1,-1],camera:null},{left:0,bottom:0,width:.5,height:.5,eye:[0,0,t],up:[0,1,0],camera:null},{left:.5,bottom:0,width:.5,height:.5,eye:[t,0,0],up:[0,1,0],camera:null},{left:0,bottom:0,width:.01,height:.01,eye:[t,t,t],up:[0,1,0],camera:null});for(var r=0,n=e.views.length;r<n;r++){var i=e.views[r];i.camera=new THREE.PerspectiveCamera(b.camera.fov,window.innerWidth/window.innerHeight,b.camera.near,b.camera.far),i.camera.position.fromArray(i.eye),i.camera.up.fromArray(i.up)}e.update=function(t,r){var n=window.innerWidth,i=window.innerHeight,a=b.renderer,o=b.appWorks.mouseMovePosition;a.setClearColor(0),a.setScissorTest(!0);for(var s=0,l=e.views.length;s<l;s++){var u=e.views[s],c=Math.floor(n*u.left),h=Math.floor(i*u.bottom),d=Math.floor(n*u.width),f=Math.floor(i*u.height);a.setViewport(c,h,d,f),a.setScissor(c,h,d,f),u.camera.lookAt(b.scene.position),u.camera.aspect=d/f,u.camera.updateProjectionMatrix(),a.render(b.scene,u.camera)}var p=o.x>0?o.y>0?0:3:o.y>0?1:2,m=b.appWorks.controls;m.object=e.views[p].camera,m.update()},b.add(e)},b.demoViewportScene=function(){b.appWorks.composer=null,b.appWorks.renderer.setClearColor(14540253),b.appWorks.renderer.setScissorTest(!0);var e=b.appWorks.width,t=b.appWorks.height,r=new THREE.Object3D;r.name="viewportScene";var n=[new THREE.BoxBufferGeometry(1,1,1),new THREE.SphereBufferGeometry(.5,12,8),new THREE.DodecahedronBufferGeometry(.5),new THREE.CylinderBufferGeometry(.5,.5,1,12)],i=new Ze.Div;i.setPosition("absolute"),i.setTop("0px"),i.setWidth(e+"px"),i.setHeight(t+"px"),i.setOverflow("auto"),i.setZIndex("0"),b.appWorks.dom.appendChild(i.dom);var a=(new Ze.Panel).setColor("#000080").setTextAlign("center").setFontSize("20px");a.dom.style.fontFamily="Arial, Helvetica, sans-serif",a.dom.style.fontVariant="small-caps",i.add(a);var o=new Ze.Row;o.setMargin("0.5em 0 0 0"),o.setTextShadow("1px 1px 2px #888"),o.add(new Ze.Text("2019 NovaGraphix, Co. All rights reserved.")),a.add(o);var s=new Ze.Row,l=document.createElement("a");l.setAttribute("href","https://www.nova-graphix.com/"),l.innerHTML="https://www.nova-graphix.com/",s.dom.appendChild(l),a.add(s);for(var u='        <div class="scene" style="width: 200px; height: 200px;"></div>\n        <div class="description" style="color: #111; font-family: \'Karla\', sans-serif; font-size: 1.2em; width: 200px; margin-top: 0.5em;">\n            Scene $\n        </div>\n    ',c=0;c<40;c++){var h=new THREE.Scene,d=(new Ze.Div).setClass("scene-item");d.dom.style.cssText="display: inline-block; margin: 0.5em; padding: 0.5em; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",d.dom.innerHTML=u.replace("$",c),i.add(d);var f=d.dom.querySelector(".scene");h.userData.element=f;var p=f.getBoundingClientRect(),m=p.width/p.height,v=new THREE.PerspectiveCamera(50,m,.1,50);v.position.z=2,h.userData.camera=v;var g=new THREE.OrbitControls(v,f);g.minDistance=1,g.maxDistance=7.5,g.enablePan=!0,g.enableZoom=!0,g.enableDamping=!0,g.screenSpacePanning=!0,g.dampingFactor=.1,g.panSpeed=.1,g.rotateSpeed=.07,g.enabled=!0,h.userData.controls=g;var y=n[n.length*Math.random()|0],_=new THREE.MeshStandardMaterial({color:(new THREE.Color).setHSL(Math.random(),1,.5),roughness:.5,metalness:0,flatShading:!0}),E=new THREE.Mesh(y,_);E.update=function(e,t){this.rotation.y=t},h.add(E),h.add(new THREE.HemisphereLight(11184810,4473924));var w=new THREE.DirectionalLight(16777215,.5);w.position.set(1,1,1),h.add(w),r.add(h)}b.add(r),r.update=function(e,t){var n=b.renderer;n.domElement.style.transform=`translateY(${window.scrollY}px)`,r.children.forEach(function(r){r.traverse(r=>{r.update&&r.update(e,t)});var i=r.userData.element.getBoundingClientRect();if(!(i.bottom<0||i.top>n.domElement.clientHeight||i.right<0||i.left>n.domElement.clientWidth)){var a=i.width,o=i.height,s=i.left,l=n.domElement.clientHeight-i.bottom;n.setViewport(s,l,a,o),n.setScissor(s,l,a,o);var u=r.userData.camera;n.render(r,u)}})}},b.demoVideoTexture=function(){var e=document.createElement("video");e.width=window.innerWidth,e.height=window.innerHeight,e.loop=!0,e.muted=!0,e.src="video/EllyUSOpen2017.mp4",e.play();var t,r=new THREE.PlaneBufferGeometry(178,100);(t=new THREE.VideoTexture(e)).minFilter=THREE.LinearFilter,t.format=THREE.RGBFormat;var n,i=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide});(n=new THREE.Mesh(r,i)).name="demoVideoTexture",b.add(n)},b.demoTerrains=function(){var e=b.createSunLight(.49);e.userData.motion="variable",b.add(e),b.add(b.createSky());var t=b.createTerrain({resolution:256,height:100,landscape:5,waterDepth:20,waterColor:b.OCEAN_COLOR});b.add(t);var r=b.createWater({alpha:.9});b.add(r),b.add(b.createCloudDome(1024)),b.camera.position.set(0,5,100),b.camera.lookAt(b.scene.position)},b.demoMinecraft=function(){var e=b.appWorks.scene;if(0===b.scene.getObjectsByType("HemisphereLight").length&&b.add(b.createHemisphereLight()),0===b.scene.getObjectsByType("DirectionalLight").length){var t=b.createDirectionalLight({color:16777215,intensity:2});t.position.set(1,1,.5),b.add(t)}e.fog&&(e.fog.density=4e-4);var r=new THREE.TextureLoader,n=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/grass.png")}),i=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/grass_dirt.png")}),a=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/dirt.png")}),o=new THREE.PlaneBufferGeometry(1,1).rotateY(Math.PI/2).translate(.5,0,0),s=new THREE.PlaneBufferGeometry(1,1).rotateY(-Math.PI/2).translate(-.5,0,0),l=new THREE.PlaneBufferGeometry(1,1).rotateX(-Math.PI/2).translate(0,.5,0),u=new THREE.PlaneBufferGeometry(1,1).rotateX(Math.PI/2).translate(0,-.5,0),c=new THREE.PlaneBufferGeometry(1,1).translate(0,0,.5),h=new THREE.PlaneBufferGeometry(1,1).rotateY(Math.PI).translate(0,0,-.5),d=new THREE.Object3D;d.add(new THREE.Mesh(o,i)),d.add(new THREE.Mesh(s,i)),d.add(new THREE.Mesh(c,i)),d.add(new THREE.Mesh(h,i)),d.add(new THREE.Mesh(l,n)),d.add(new THREE.Mesh(u,a));var f=512,p=512;b.isDeviceMobile()&&(f=p=256);var m=function(e,t){for(var r=function(e,t){var r,n,i=2,a=100*Math.random(),o=e*t,s=new THREE.ImprovedNoise,l=[];l.zero(o);for(var u=0;u<4;u++){for(var c=0;c<o;c++)r=c%e,n=c/e|0,l[c]+=s.noise(r/i,n/i,a)*i;i*=4}return l}(e=Math.floor(e),t=Math.floor(t)),n=e/2,i=t/2,a=[],o=0;o<t;o++)for(var s=0;s<e;s++){var l=.2*r[s+o*e]|0;a.push(s-n,l,o-i)}return a}(f,p),v=b.createInstancedObject(d,{positions:m});v.name="demoMinecraft",b.add(v),void 0===e.getObjectsByProperty("userData","type","Water")[0]&&b.add(b.createWater());var g=b.createGlowingParticles({amount:1e3,width:f,height:f/4,depth:p,motion:"random"});g.position.y+=f/8,b.add(g),b.appWorks.createSceneBackground("cloud")},b.demoSponzaAnimals=function(){var e=new THREE.LoadingManager;e.onStart=()=>{b.createProgressbar()},e.onProgress=(e,t,r)=>{b.updateProgressbar(t,r)},e.onLoad=()=>{b.hideProgressbar()},e.onError=e=>{b.errorProgressbar("There was an error loading "+e)},b.loadOBJ({obj:"sponza.obj",mtl:"sponza.mtl",basePath:"models/obj/sponza/",manager:e,callback:function(e){b.add(e)}});var t=new THREE.Vector3(0,.5*-Math.PI,0),r=new THREE.Vector3;b.loadJSON({url:"models/json/cow.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(-240,0,0)),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/elk.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(-180,0,0)),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/flamingo.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(-120,40,0)),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/fox.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(-60,0,0)),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/horse.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(0,0,0)),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/monster.js",basePath:"models/json/",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(60,0,-30),t),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/parrot.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(120,40,0)),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/sittingBox.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(180,0,0)),b.add(e),b.appWorks.playAction(e)}}),b.loadJSON({url:"models/json/stork.js",manager:e,callback:function(e){b.resizeObject(e,100),b.transformObject(e,r.set(240,40,0)),b.add(e),b.appWorks.playAction(e)}})},b.demoForest=function(){function e(e,t){t=t||32;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}if(b.isDeviceMobile()){var t=50,r=50;(h=new THREE.PlaneBufferGeometry(t,r)).addAttribute("uv2",new THREE.BufferAttribute(h.attributes.uv.array,2));var n=new THREE.TextureLoader,i=new THREE.MeshStandardMaterial({color:8947848,roughness:1,metalness:0,map:n.load("images/terrain/dirtGrassTerrainD6.jpg",e),bumpMap:n.load("images/terrain/dirtGrassTerrainB.jpg",e),aoMap:n.load("images/terrain/dirtGrassTerrainAO.jpg",e)});(d=new THREE.Mesh(h,i)).name="ground",d.rotation.x=-Math.PI/2,b.add(d);var a=2,o=b.createGrassTufts(1e3,t,a,r,1188864,"images/grass/grass01.png");b.add(o);o=b.createGrassTufts(1e3,t,a,r,735232,"images/grass/grass02.png");b.add(o);a=2;var s=b.createFlowerTufts(100,t,a,r,null,"images/grass/flowers01.png");b.add(s);s=b.createFlowerTufts(100,t,a,r,null,"images/grass/flowers02.png");b.add(s);a=1.5;var l=b.createGrassQuads(100,t,a,r);b.add(l);var u=5401389,c=b.createProcTrees(t,r,10,"small",u);b.add(c);c=b.createProcTrees(t,r,25,"middleDense",u);b.add(c);u=9498256,c=b.createProcTrees(t,r,25,"middle",u);b.add(c);c=b.createProcTrees(t,r,10,"large",u);b.add(c),b.add(b.createAmbientLight()),b.add(b.createSunLight()),b.add(b.createSky()),b.appWorks.godRaysPass.enabled=!0,b.appWorks.createSceneFog({type:"exp2",color:b.FOG_COLOR,density:.01}),b.camera.lookAt(b.scene.position)}else{var h;t=250,r=250;(h=new THREE.PlaneBufferGeometry(t,r)).addAttribute("uv2",new THREE.BufferAttribute(h.attributes.uv.array,2));var d;n=new THREE.TextureLoader,i=new THREE.MeshStandardMaterial({color:8947848,roughness:1,metalness:0,map:n.load("images/terrain/dirtGrassTerrainD6.jpg",e),bumpMap:n.load("images/terrain/dirtGrassTerrainB.jpg",e),aoMap:n.load("images/terrain/dirtGrassTerrainAO.jpg",e)});(d=new THREE.Mesh(h,i)).name="ground",d.rotation.x=-Math.PI/2,b.add(d);a=2,o=b.createGrassTufts(1e4,t,a,r,1188864,"images/grass/grass01.png");b.add(o);o=b.createGrassTufts(1e4,t,a,r,735232,"images/grass/grass02.png");b.add(o);a=2,s=b.createFlowerTufts(1e3,t,a,r,null,"images/grass/flowers01.png");b.add(s);s=b.createFlowerTufts(1e3,t,a,r,null,"images/grass/flowers02.png");b.add(s);a=1.5,l=b.createGrassQuads(1e3,t,a,r);b.add(l);u=5401389,c=b.createProcTrees(t,r,100,"small",u);b.add(c);c=b.createProcTrees(t,r,250,"middleDense",u);b.add(c);u=9498256,c=b.createProcTrees(t,r,250,"middle",u);b.add(c);c=b.createProcTrees(t,r,100,"large",u);b.add(c),b.add(b.createAmbientLight()),b.add(b.createSunLight()),b.add(b.createSky()),b.appWorks.godRaysPass.enabled=!0,b.appWorks.createSceneFog({type:"exp2",color:b.FOG_COLOR,density:.003}),b.camera.lookAt(b.scene.position)}},b.demoLoadFiles=function(){b.loadGLTF({url:"models/gltf/cartoon_small_city/scene.gltf",callback:function(e){b.fitCameraToObject(e),b.add(e)}})},b.demoEarthSystem=function(){var e=b.appWorks.scene,t={earth:{radius:.18,orbitRadius:4.5,orbitPeriod:365,rotPeriod:1,inclination:0},moon:{radius:.04,orbitRadius:.75,orbitPeriod:30,rotPeriod:30,inclination:0}};e.earthData=t;var r=new THREE.TextureLoader,n=new THREE.SphereBufferGeometry(1,32,32),i=new THREE.Object3D;i.name="demoEarthPivot",b.add(i),i.scale.setScalar(100),b.scene.add(b.createHemisphereLight({skyColor:(new THREE.Color).setHSL(.6,1,.6),groundColor:(new THREE.Color).setHSL(.095,1,.75),intensity:1}));var a=new THREE.MeshPhongMaterial({map:r.load("images/planets/earth_texture.jpg"),bumpScale:.5,bumpMap:r.load("images/planets/earthbump.jpg"),specular:new THREE.Color("grey"),specularMap:r.load("images/planets/earthspec.jpg")}),o=new THREE.Mesh(n,a);o.scale.setScalar(t.earth.radius),o.name="demoEarth",i.add(o),i.position.copy(o.position);a=new THREE.MeshPhongMaterial({map:r.load("images/planets/earthcloudmap.jpg"),alphaMap:r.load("images/planets/earthcloudmaptrans.jpg"),opacity:.8,transparent:!0,depthWrite:!1});var s=new THREE.Mesh(n,a);s.scale.setScalar(1.02),s.name="demoEarthCloud",o.add(s);var l=new THREE.Object3D;l.position.copy(o.position),l.rotation.x=t.moon.inclination*THREE.Math.DEG2RAD,i.add(l);a=new THREE.MeshPhongMaterial({map:r.load("images/planets/moonmap.jpg"),bumpMap:r.load("images/planets/moonbump.jpg"),bumpScale:.02});var u=new THREE.Mesh(n,a);u.scale.setScalar(t.moon.radius),u.position.x=t.moon.orbitRadius,u.name="demoMoon",l.add(u);var c=new THREE.EllipseCurve(0,0,t.moon.orbitRadius/t.earth.radius,t.moon.orbitRadius/t.earth.radius).getPoints(70),h=(n=(new THREE.BufferGeometry).setFromPoints(c),a=new THREE.LineBasicMaterial({color:2236962}),new THREE.Line(n,a));h.rotation.x=-Math.PI/2,h.rotation.x+=t.moon.inclination*THREE.Math.DEG2RAD,o.add(h),i.update=function(t,r){var n=.2*r*(2*Math.PI),i=e.earthData,a=i.earth.orbitPeriod,o=n/i.earth.rotPeriod;this.children[0].rotation.y=o,this.children[0].children[0].rotation.y=-o/2;a=n/i.moon.orbitPeriod,o=n/i.moon.rotPeriod;this.children[1].rotation.y=a,this.children[1].children[0].rotation.y=o},b.appWorks.createSceneBackground("galaxy")},b.demoSolarSystem=function(){var e=b.appWorks.scene,t={sun:{radius:1,orbitRadius:0,orbitPeriod:0,rotPeriod:0,inclination:0},mercury:{radius:.1,orbitRadius:2.25,orbitPeriod:88,rotPeriod:59,inclination:7},venus:{radius:.18,orbitRadius:3,orbitPeriod:225,rotPeriod:-243,inclination:3.9},earth:{radius:.18,orbitRadius:4.5,orbitPeriod:365,rotPeriod:1,inclination:0},moon:{radius:.04,orbitRadius:.75,orbitPeriod:30,rotPeriod:30,inclination:0},mars:{radius:.3,orbitRadius:5.25,orbitPeriod:697,rotPeriod:1.017,inclination:1.85},jupiter:{radius:.6,orbitRadius:7.5,orbitPeriod:4234,rotPeriod:.417,inclination:1.3},saturn:{radius:.5,orbitRadius:10.5,orbitPeriod:10753,rotPeriod:.433,inclination:2.49},uranus:{radius:.3,orbitRadius:12.75,orbitPeriod:30660,rotPeriod:.708,inclination:.77},neptune:{radius:.3,orbitRadius:13.5,orbitPeriod:60225,rotPeriod:.833,inclination:1.77},pluto:{radius:.05,orbitRadius:15,orbitPeriod:90520,rotPeriod:6.4,inclination:17.2}};e.solarData=t;for(var r=["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune","pluto"],n=0;n<r.length;n++)t[r[n]].rotPeriod*=40;var i=new THREE.TextureLoader,a=new THREE.SphereBufferGeometry(1,32,32),o=new THREE.MeshBasicMaterial({map:i.load("images/planets/sunmap.jpg"),transparent:!0,depthWrite:!1}),s=new THREE.Mesh(a,o);s.scale.setScalar(t.sun.radius),s.position.x=t.sun.orbitRadius,s.name="demoSun",b.add(s),s.scale.setScalar(20);var l=b.createPointLightFlare({color:15915482,intensity:2,flareSize:2500});l.position.copy(s.position),b.scene.add(l);var u=b.appWorks.camera,c=u.position.length();l.update=function(e,t){var r=u.position.length(),n=l.children[0].children[0],i=c/r;n.flareSize=2500*i,n.flareRotation+=.005,n.flareOpacity=Math.min(.5+i,1)},(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.mercury.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/mercurymap.jpg"),bumpMap:i.load("images/planets/mercurybump.jpg"),bumpScale:.5});var h=new THREE.Mesh(a,o);h.scale.setScalar(t.mercury.radius),h.position.x=t.mercury.orbitRadius,h.name="demoMercury",S.add(h),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.venus.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/venusmap.jpg"),bumpMap:i.load("images/planets/venusbump.jpg"),bumpScale:.5});var d=new THREE.Mesh(a,o);d.scale.setScalar(t.venus.radius),d.position.x=t.venus.orbitRadius,d.name="demoVenus",S.add(d),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.earth.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/earthmap.jpg"),bumpScale:.5,bumpMap:i.load("images/planets/earthbump.jpg"),specular:new THREE.Color("grey"),specularMap:i.load("images/planets/earthspec.jpg")});var f=new THREE.Mesh(a,o);f.scale.setScalar(t.earth.radius),f.position.x=t.earth.orbitRadius,f.name="demoEarth",S.add(f);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/earthcloudmap.jpg"),alphaMap:i.load("images/planets/earthcloudmaptrans.jpg"),opacity:.8,transparent:!0,depthWrite:!1});var p=new THREE.Mesh(a,o);p.scale.setScalar(1.02),p.position.x=0,p.name="demoEarthCloud",f.add(p);var m=new THREE.Object3D;m.position.copy(f.position),m.rotation.x=t.moon.inclination*THREE.Math.DEG2RAD,S.add(m);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/moonmap.jpg"),bumpMap:i.load("images/planets/moonbump.jpg"),bumpScale:.5});var v=new THREE.Mesh(a,o);v.scale.setScalar(t.moon.radius),v.position.x=t.moon.orbitRadius,v.name="demoMoon",m.add(v),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.mars.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/marsmap.jpg"),bumpMap:i.load("images/planets/marsbump.jpg"),bumpScale:.5});var g=new THREE.Mesh(a,o);g.scale.setScalar(t.mars.radius),g.position.x=t.mars.orbitRadius,g.name="demoMars",S.add(g),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.jupiter.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/jupitermap.jpg")});var y=new THREE.Mesh(a,o);y.scale.setScalar(t.jupiter.radius),y.position.x=t.jupiter.orbitRadius,y.name="demoJupiter",S.add(y),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.saturn.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/saturnmap.jpg")});var _=new THREE.Mesh(a,o);_.scale.setScalar(t.saturn.radius),_.position.x=t.saturn.orbitRadius,_.name="demoSaturn",S.add(_);var E=new b.RingGeometry(1.2,2,64,5),w=(o=new THREE.MeshBasicMaterial({map:i.load("images/planets/saturnringmap.jpg"),side:THREE.DoubleSide,transparent:!0,opacity:.8}),new THREE.Mesh(E,o));w.position.x=0,w.name="demoSaturnRing",_.add(w),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.uranus.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/uranusmap.jpg")});var x=new THREE.Mesh(a,o);x.scale.setScalar(t.uranus.radius),x.position.x=t.uranus.orbitRadius,x.name="demoUranus",S.add(x);E=new b.RingGeometry(1.1,1.5,64,5),o=new THREE.MeshBasicMaterial({map:i.load("images/planets/uranusringmap.jpg"),side:THREE.DoubleSide,transparent:!0,opacity:.6});var T=new THREE.Mesh(E,o);T.position.x=0,T.name="demoUranusRing",x.add(T),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.neptune.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/neptunemap.jpg")});var S,M=new THREE.Mesh(a,o);M.scale.setScalar(t.neptune.radius),M.position.x=t.neptune.orbitRadius,M.name="demoNeptune",S.add(M),(S=new THREE.Object3D).position.copy(s.position),S.rotation.x=t.pluto.inclination*THREE.Math.DEG2RAD,s.add(S);o=new THREE.MeshPhongMaterial({map:i.load("images/planets/plutomap.jpg"),bumpMap:i.load("images/planets/plutobump.jpg"),bumpScale:.5});var R=new THREE.Mesh(a,o);R.scale.setScalar(t.pluto.radius),R.position.x=t.pluto.orbitRadius,R.name="demoPluto",S.add(R);for(n=0;n<r.length;n++){var A=new THREE.EllipseCurve(0,0,t[r[n]].orbitRadius,t[r[n]].orbitRadius).getPoints(50+20*n);a=(new THREE.BufferGeometry).setFromPoints(A),o=new THREE.LineBasicMaterial({color:1118481});(k=new THREE.Line(a,o)).rotation.x=-Math.PI/2,k.rotation.x+=t[r[n]].inclination*THREE.Math.DEG2RAD,s.add(k)}var k,P,C,L;A=new THREE.EllipseCurve(0,0,t.moon.orbitRadius/t.earth.radius,t.moon.orbitRadius/t.earth.radius).getPoints(50),a=(new THREE.BufferGeometry).setFromPoints(A),o=new THREE.LineBasicMaterial({color:2236962});(k=new THREE.Line(a,o)).rotation.x=-Math.PI/2,k.rotation.x+=t.moon.inclination*THREE.Math.DEG2RAD,f.add(k),s.update=function(t,r){for(var n=20*r*(2*Math.PI),i=e.solarData,a=["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune","pluto"],o=0;o<a.length;o++)if(2===o){var s=n/i.earth.orbitPeriod,l=n/i.earth.rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l,this.children[o].children[0].children[0].rotation.y=-l/2;s=n/i.moon.orbitPeriod,l=n/i.moon.rotPeriod;this.children[o].children[1].rotation.y=s,this.children[o].children[1].children[0].rotation.y=l}else if(5===o||6===o){s=n/i[a[o]].orbitPeriod,l=n/i[a[o]].rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l,this.children[o].children[0].children[0].rotation.y=l}else{s=n/i[a[o]].orbitPeriod,l=n/i[a[o]].rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l}},b.appWorks.createSceneBackground("galaxy"),b.isDeviceMobile()||(P=b.appWorks.cameraHUD,C=0,L=2*b.appWorks.cameraHUD.top-100,s.traverse(e=>{function r(e){return-1!==e.name.indexOf("Ring")}if(e.isMesh){var e=e.clone();if(e.parent=null,e.children=[],e.name=e.name.substr(4),e.position.x=P.left+50+C,e.position.y=P.bottom+50+L,e.position.z=0,r(e)&&(e.rotation.x+=Math.PI/2),e.scale.setScalar(1),b.resizeObject(e,100),"Sun"!==e.name&&!r(e)){var n=40*Math.PI,i="EarthCloud"===e.name?t.earth:t[e.name.toLowerCase()];e.update=function(t,r){e.rotation.y=r*n/i.rotPeriod}}b.appWorks.sceneHUD.add(e);var a=20;(r(e)||function(e){return-1!==e.name.indexOf("Cloud")}(e))&&(a=0);var o=b.createTextHUD(e.name,C+a,L-20);o.scale.setScalar(.8),b.appWorks.sceneHUD.add(o),C+=100}}),b.appWorks.sceneHUD.add(b.createHemisphereLight()))},b.demoUnderWater=function(){b.scene.add(b.createHemisphereLight()),b.underWaterBackground();var e=Math.PI/2,t={sharks:{height:20,heightRange:2,radius:48,radiusRange:4,count:5,speed:.05,object:null,createFish:b.createFishShark},hammerSharks:{height:20,heightRange:2,radius:36,radiusRange:4,count:6,speed:.07,object:null,createFish:b.createFishHammerShark},tunas:{height:15,heightRange:4,radius:30,radiusRange:8,count:50,speed:.1,object:null,createFish:b.createFishTuna},snappers:{height:15,heightRange:5,radius:42,radiusRange:6,count:100,speed:.2,object:null,createFish:b.createFishSnapper},mackerels:{height:30,heightRange:10,radius:48,radiusRange:8,count:200,speed:.2,object:null,createFish:b.createFishMackerel}},r=new THREE.Object3D;for(var n in b.add(r),t){var i=t[n];i.object=new THREE.Object3D,i.object.name="fishes";for(var a=0;a<i.count;a++){var o=i.createFish(),s=b.circularRand(i.radius),l=Math.atan(s.y/s.x);o.rotation.y+=s.x>0?l+e:l-e;var u=i.heightRange*(Math.random()-.5),c=i.radiusRange*(Math.random()-.5);o.position.x=s.y+c*Math.sin(l),o.position.y=i.height+u,o.position.z=s.x+c*Math.cos(l),i.object.add(o)}r.add(i.object)}r.update=function(e,t){r.traverse(function(r){"fishes"===r.name&&(r.children.forEach(function(e){e.position.y+=.05*Math.sin(a+t)}),r.rotation.y+=i.speed*e)})};for(a=0;a<20;a++){o=b.createBrokenArchColumn(),s=b.circularRand(60),l=Math.atan(s.y/s.x);o.rotation.y+=l,o.position.set(s.y,0,s.x),r.add(o)}for(a=0;a<10;a++){o=b.createRuinColumn(),s=b.circularRand(60*(.5*Math.random()+.5)),l=Math.atan(s.y/s.x);o.rotation.y+=l,o.position.set(s.y,0,s.x),r.add(o)}for(var h=0;h<2;h++)for(a=0;a<30;a++){var d=15*(.5+.5*Math.random());o=b.createSeaweed(h,3,d),s=b.diskRand(60);o.position.set(s.y,d/2,s.x),r.add(o)}s=new THREE.Vector3;var f=new THREE.Euler,p=new THREE.Quaternion,m=new THREE.Vector3,v=new THREE.Color,g=2*Math.PI,y=b.createCoral(),_=new b.InstancedMesh(y.geometry,y.material,100,!1,!0,!1);for(a=0;a<100;a++)s.set(96*(Math.random()-.5),0,96*(Math.random()-.5)),f.set(0,Math.random()*g,0),p.setFromEuler(f),m.setScalar(.4+Math.random()),v.setHSL(Math.random(),1,.5),_.setPositionAt(a,s),_.setQuaternionAt(a,p),_.setScaleAt(a,m),_.setColorAt(a,v);_.castShadow=!0,_.receiveShadow=!0,_.frustumCulled=!1,_.name="instCoral",r.add(_);for(h=0;h<2;h++){y=b.createCoralReef(h),_=new b.InstancedMesh(y.geometry,y.material,100,!1,!0,!1);for(a=0;a<100;a++)s.set(96*(Math.random()-.5),0,96*(Math.random()-.5)),f.set(0,Math.random()*g,0),p.setFromEuler(f),m.setScalar(1.5+Math.random()),v.setHSL(Math.random(),Math.random(),Math.random()),_.setPositionAt(a,s),_.setQuaternionAt(a,p),_.setScaleAt(a,m),_.setColorAt(a,v);_.castShadow=!0,_.receiveShadow=!0,_.frustumCulled=!1,_.name="instCoralReef"+h,r.add(_)}(o=b.createRock(0)).position.set(-10,0,-10),r.add(o),(o=b.createRock(1)).position.set(30,0,30),r.add(o),(o=b.createRock(2)).position.set(-20,0,20),r.add(o);o=b.createAquaFloor(64.5);r.add(o);(o=b.createAquaGlobeBase(64.5,25)).position.y-=12.5,r.add(o),(o=b.createAquaGlobeOuter(66.9)).position.y+=16.5,r.add(o);c=.36;var E,w=100;u=60;(E=b.createSpriteBubbles(c,w,3,u,3,"verticalMotion")).position.set(12,0,-18),r.add(E),(E=b.createSpriteBubbles(c,w,3,u,3,"verticalMotion")).position.set(-18,0,-18),r.add(E),(E=b.createSpriteBubbles(c,w,3,u,3,"verticalMotion")).position.set(-12,0,12),r.add(E),(E=b.createSpriteBubbles(c,w,3,u,3,"verticalMotion")).position.set(6,0,18),r.add(E)},b.demoFishSchools=function(){b.scene.add(b.createHemisphereLight()),b.underWaterBackground();var e=appWorks.camera.far,t=b.createBoids({resolution:64,boidName:"fishShark",bounds:new THREE.Vector3(e/4,e/8,e/4),speedLimit:2});t.position.y=0,b.add(t)},b.demoRaymarch=function(){b.raymarchFish()},b.demoKdTree=function(){var e=b.appWorks;e.controls=b.createCameraControls("FirstPersonControls");var t=Math.pow(500,2);t=Math.sqrt(3*t);var r=(new THREE.TextureLoader).load("images/crate.gif");r.minFilter=THREE.LinearMipMapLinearFilter,r.magFilter=THREE.LinearFilter;var n=new THREE.ShaderMaterial({uniforms:{tex:{type:"t",value:r},size:{type:"f",value:4}},vertexShader:["uniform float size;","attribute float alpha;","varying float vAlpha;","void main() {","vAlpha = alpha;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = size * ( 300.0 / -mvPosition.z );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["tex;","varying float vAlpha;","void main() {","gl_FragColor = texture2D( tex, gl_PointCoord );","gl_FragColor.b = mix( gl_FragColor.b, 1.0, vAlpha );","}"].join("\n"),transparent:!0}),i=new Float32Array(15e5),a=new Float32Array(5e5),o=new THREE.BufferGeometry;o.addAttribute("position",new THREE.BufferAttribute(i,3)),o.addAttribute("alpha",new THREE.BufferAttribute(a,1));for(var s=0;s<5e5;s++)i[3*s+0]=500*(Math.random()-.5),i[3*s+1]=500*(Math.random()-.5),i[3*s+2]=500*(Math.random()-.5),a[s]=0;var l=new THREE.Points(o,n);b.add(l);var u=performance.now();l.kdtree=b.createKdTree(i,3);var c=performance.now()-u;console.log(">> time (creating kdtree) = "+c.toFixed(2)+" (ms)"),l.update=function(r,n){for(var i=0;i<5e5;i++)a[i]=0;var s=e.camera.position,l=b.getKdTreeNearest(this.kdtree,[s.x,s.y,s.z],100),u=new THREE.Frustum,c=new THREE.Matrix4;c.multiplyMatrices(e.camera.projectionMatrix,e.camera.matrixWorldInverse),u.setFromMatrix(c);for(var h=0,d=l.length;h<d;h++){var f=l[h],p=(new THREE.Vector3).fromArray(f.position);if(u.containsPoint(p)){var m=f.index,v=f.distance;a[m]=1-v/t}}o.attributes.alpha.needsUpdate=!0}},b.demoOctree=function(){var e=new THREE.Points(new THREE.TorusKnotBufferGeometry(10,4,64,64),new THREE.PointsMaterial({color:16711680,size:2,sizeAttenuation:!1}));b.add(e);var t=new THREE.Box3;t.setFromObject(e);for(var r=new E.PointOctree(t.min,t.max,0,15,8),n=e.geometry.attributes.position.array,i=new THREE.Vector3,a=0,o=n.length;a<o;a+=3)r.put(i.fromArray(n,a),e);console.log(">> octree point count: ",r.pointCount),console.log(">> octree depth: ",r.getDepth());var s=new THREE.Vector3;b.getLeafOctants(r).forEach(function(e){s.copy(e.getCenter()),console.log(s)});var l=new b.OctreeHelper(r,{topLevel:0,bottomLevel:4,occupied:!0});b.add(l)},b.demoIsosurface=function(){var e=new THREE.MeshPhongMaterial({color:11184810,side:THREE.DoubleSide}),t=(new THREE.ImprovedNoise,function(e,t,r){var n=e*e+t*t+r*r;return Math.pow(e,4)+Math.pow(t,4)+Math.pow(r,4)+n*n*0+-1.5*n+1}),r=[[-2.4,-2.4,-2.4],[2.4,2.4,2.4]],n=performance.now(),i=new b.IsosurfaceGeometry(50,r,t),a=performance.now()-n;console.log(">> time (creating isosurface) = "+a.toFixed(2)+" (ms)");var o=new THREE.Mesh(i,e);b.add(o);var s=b.createWireframe(o,0,!0);o.add(s);var l=b.createVertexPoints(o,.05);o.add(l)},b.demoEditImage=function(){b.imageFileToData("images/jamieElly1024.png",function(e){b.invertImage(e);var t=new THREE.Texture(e);t.needsUpdate=!0;var r=new THREE.PlaneBufferGeometry(10,10),n=new THREE.MeshPhongMaterial({map:t}),i=new THREE.Mesh(r,n);b.scene.add(i)})},b.demoEditImage2=function(){b.imageFileToData("images/sprites/snowflake5.png",function(e){for(var t=e.data,r=0;r<t.length;r+=4){0===t[r]+t[r+1]+t[r+2]&&(t[r+3]=0)}b.imageDataToFile(e,"snowflake5.png")})},b.demoFrankeTestRBF=function(){function e(e,t,r,n){var i=0;if(1===e)a=Math.pow(9*t-2,2),o=Math.pow(9*r-2,2),s=Math.pow(9*n-2,2),i=.75*Math.exp(-(a+o+s)/4),a=Math.pow(9*t+1,2),o=Math.pow(9*r+1,1),s=Math.pow(9*n+1,1),i+=.75*Math.exp(-(a/49+o/10+s/10)),a=Math.pow(9*t-7,2),o=Math.pow(9*r-3,2),s=Math.pow(9*n-5,2),i+=.5*Math.exp(-(a+o+s)/4),a=Math.pow(9*t-4,2),o=Math.pow(9*r-7,2),s=Math.pow(9*n-5,2),i-=.2*Math.exp(-(a+o+s));else if(2===e)i=(Math.tanh(9*n-9*t-9*r)+1)/9;else if(3===e)i=(1.25+Math.cos(5.4*r))*Math.cos(6*n)/(6+6*Math.pow(3*t-1,2));else if(4===e){a=Math.pow(t-.5,2),o=Math.pow(r-.5,2),s=Math.pow(n-.5,2),i=Math.exp(-81/16*(a+o+s))/3}else if(6===e){var a,o,s;a=Math.pow(t-.5,2),o=Math.pow(r-.5,2),s=Math.pow(n-.5,2),i=Math.sqrt(64-81*(a+o+s))/9-.5}return i}for(var t=[1,2,3,4,6],r=["grid","random"],n=["interpolate","approximate"],i=[7,10,15],a=[343,1e3,3375],o=["linear","cubic","thinPlate","gaussian","multiquadric","wendland31"],s=0;s<r.length;s++)for(var l=0;l<n.length;l++)for(var u=0;u<a.length;u++)for(var c=0;c<o.length;c++){var h,d={funcID:t[4],distributeType:r[s],constructType:n[l],ndataGrid:i[u],ndataRandom:a[u],rbf:o[c],linearTerm:!0,approxPct:.2,rbf0:"linear",rbf1:"linear",rbf2:"linear"};console.log("==========================================="),console.log(">> funcID          = "+d.funcID),console.log(">> distribute type = "+d.distributeType),console.log(">> construct type  = "+d.constructType),console.log(">> data size       = "+d.ndataRandom),console.log(">> RBF             = "+d.rbf),"grid"===d.distributeType&&(h=~~(Math.pow(d.ndataGrid,3)*d.approxPct)),"random"===d.distributeType&&(h=~~(d.ndataRandom*d.approxPct));var f=[],p=[];if("grid"===d.distributeType)for(var m=1/((R=d.ndataGrid)-1),v=0,g=0;v<R;v++,g+=m)for(var y=0,_=0;y<R;y++,_+=m)for(var E=0,w=0;E<R;E++,w+=m)f.push([w,_,g]),p.push(e(d.funcID,w,_,g));if("random"===d.distributeType){for(E=0;E<d.ndataRandom;E++){w=Math.random(),_=Math.random(),g=Math.random();f[E]=[w,_,g]}E=0;for(var x=(f=b.mergeArray3(f)).length;E<x;E++){w=f[E][0],_=f[E][1],g=f[E][2];p[E]=e(d.funcID,w,_,g)}}var T,S=performance.now();switch(d.constructType){case"interpolate":T=b.interpolateRBF(f,p,{rbf:d.rbf});break;case"approximate":T=b.approximateRBF(h,f,p,{rbf:d.rbf});break;case"multilevel":T=b.multiLevelRBF(f,p,{rbf0:d.rbf0,rbf1:d.rbf1,rbf2:d.rbf2})}var M=performance.now()-S;console.log(">> time (creating RBF)   = "+M.toFixed(2)+" (ms)");var R,A=0,k=0,P=0,C=1/0,L=-1/0;for(m=1/((R=21)-1),v=0,g=0;v<R;v++,g+=m)for(y=0,_=0;y<R;y++,_+=m)for(E=0,w=0;E<R;E++,w+=m){S=performance.now();var I=T([w,_,g]);P+=M=performance.now()-S;var O=e(d.funcID,w,_,g);A+=Math.pow(O-I[0],2),C=Math.min(C,O),L=Math.max(L,O),k++}A=Math.sqrt(A/k),A/=L-C,console.log(">> time (evaluating RBF) = "+(P/k).toFixed(4)+" (ms)"),console.log(">> RMS error (21 x 21 x 21) = "+A.toFixed(7))}},b.demoImageRBF=function(){(new THREE.TextureLoader).load("images/dummy/lena_24.bmp",function(e){var t=b.imageElementToData(e.image),r=e.image.width,n=e.image.height,i=r*n;console.log(">> image = "+i);var a,o=!0,s="linear",l="random",u="interpolate",c=32,h=2e3,d=.2,f="linear",p="linear",m="linear";console.log(">> RBF = "+s+", linearTerm = "+o),console.log(">> data distribution = "+l),console.log(">> construction type = "+u),"multilevel"===u&&console.log(">> multilevel[0,1,2] = "+f+", "+p+", "+m),"grid"===l&&(a=~~(Math.pow(c,2)*d)),"random"===l&&(a=~~(h*d));var v=[],g=[];if("grid"===l)for(var y=c,_=1/(y-1),E=0,w=0;E<y;E++,w+=_)for(var x=0,T=0;x<y;x++,T+=_){v.push([T,w]);var S=b.getPixelColor(t,T,w);g.push([S.r,S.g,S.b])}if("random"===l){for(x=0;x<h;x++){T=b.randInt(0,r-1),w=b.randInt(0,n-1);v[x]=[T,w]}x=0;for(var M=(v=b.mergeArray2(v)).length;x<M;x++){T=v[x][0],w=v[x][1],S=b.getPixelColor(t,T,w);g[x]=[S.r,S.g,S.b]}}"interpolate"===u&&(console.log(">> xdata   = "+v.length),console.log(">> xdata/image = "+(v.length/i*100).toFixed(2)+" (%)")),"approximate"===u&&(console.log(">> centers = "+a),console.log(">> xdata   = "+v.length),console.log(">> centers/xdata = "+(a/v.length*100).toFixed(2)+" (%)"),console.log(">> centers/image = "+(a/i*100).toFixed(2)+" (%)"));var R,A=performance.now();switch(u){case"interpolate":R=b.interpolateRBF(v,g,{rbf:s,linearTerm:o});break;case"approximate":R=b.approximateRBF(a,v,g,{rbf:s,linearTerm:o});break;case"multilevel":R=b.multiLevelRBF(v,g,{rbf0:f,rbf1:p,rbf2:m,linearTerm:o})}var k=performance.now()-A;console.log(">> time (creating RBF) = "+k.toFixed(2)+" (ms)");var P=[0,0,0],C=0;for(x=0;x<v.length;x++){T=v[x][0],w=v[x][1];A=performance.now();S=R([T,w]);C+=k=performance.now()-A,P[0]+=Math.pow(g[x][0]-S[0],2),P[1]+=Math.pow(g[x][1]-S[1],2),P[2]+=Math.pow(g[x][2]-S[2],2)}for(x=0;x<3;x++)P[x]=Math.sqrt(P[x]/v.length),P[x]=P[x]/255*100;var L=(P[0]+P[1]+P[2])/3;console.log(">> RMS error (sample xdata) = "+L.toFixed(2)+" (%)");for(P=[0,0,0],C=0,w=0;w<n;w++)for(T=0;T<r;T++){A=performance.now();S=R([T,w]);C+=k=performance.now()-A;var I=b.getPixelColor(t,T,w);P[0]+=Math.pow(I.r-S[0],2),P[1]+=Math.pow(I.g-S[1],2),P[2]+=Math.pow(I.b-S[2],2),S[0]=~~S[0],S[1]=~~S[1],S[2]=~~S[2],S[3]=255,b.setPixelColor(S,t,T,w)}for(x=0;x<3;x++)P[x]=Math.sqrt(P[x]/(r*n)),P[x]=P[x]/255*100;L=(P[0]+P[1]+P[2])/3;console.log(">> RMS error (whole image) = "+L.toFixed(2)+" (%)"),console.log(">> time (creating image) = "+C.toFixed(2)+" (ms)"),(e=new THREE.Texture(t)).needsUpdate=!0;var O=new THREE.Mesh(new THREE.PlaneBufferGeometry(10,10),new THREE.MeshBasicMaterial({map:e}));b.add(O)})},b.demoSurfaceRBF=function(){b.loadSTL({url:"models/dummy/bunny.stl",callback:function(e){b.add(e),e.material=new THREE.MeshNormalMaterial({flatShading:!0,side:THREE.DoubleSide});var t={rbf:"linear",maxPoints:256,resolution:32},r=b.toNonIndexedBufferGeometry(e.geometry),n=r.attributes.position.array,i=r.attributes.normal.array,a=performance.now(),o=new b.SurfaceRBF(n,i,t),s=performance.now()-a;console.log(">> time (creating surfaceRBF) = "+s.toFixed(2)+" (ms)");var l=new THREE.Box3,u=new THREE.Vector3;l.setFromObject(e),l.getSize(u),u.multiplyScalar(.1),l.expandByVector(u);var c=[[l.min.x,l.min.y,l.min.z],[l.max.x,l.max.y,l.max.z]],h=(a=performance.now(),new b.IsosurfaceGeometry(t.resolution,c,function(e,t,r){return o([e,t,r])[0]}));s=performance.now()-a;console.log(">> time (creating isosurface) = "+s.toFixed(2)+" (ms)");var d=new THREE.Mesh(h,e.material);if(b.add(d),"models/dummy/bunny.stl"===e.name||"models/dummy/shoelast.stl"===e.name||"models/dummy/foot.stl"===e.name){var f=new THREE.Vector3(-Math.PI/2,0,0),p=new THREE.Vector3(20,0,0);b.resizeObject(e,20),b.transformObject(e,p,f),b.resizeObject(d,20),b.transformObject(d,null,f)}}})},b.demoTexturedSurfaceRBF=function(){function e(e){if(b.add(e),e instanceof THREE.Scene){var t=new THREE.TextureLoader;(m=e.children[0]).material=new THREE.MeshPhongMaterial({specular:1118481,map:t.load("models/LeePerrySmith/Map-COL.jpg"),specularMap:t.load("models/LeePerrySmith/Map-SPEC.jpg"),normalMap:t.load("models/LeePerrySmith/Infinite-Level_02_Tangent_SmoothUV.jpg"),shininess:25}),e=m}else if(e instanceof THREE.Group){e=m=e.children[0]}var r={rbf:"wendland31",maxPoints:16,resolution:64},n=b.toNonIndexedBufferGeometry(e.geometry),i=n.attributes.position.array,a=n.attributes.normal.array,o=n.attributes.uv.array,s=performance.now(),l=new b.TexturedSurfaceRBF(i,a,o,r),u=performance.now()-s;console.log(">> time (creating texturedSurfaceRBF) = "+u.toFixed(2)+" (ms)");var c=new THREE.Box3,h=new THREE.Vector3;c.setFromObject(e),c.getSize(h),h.multiplyScalar(.1),c.expandByVector(h);var d=[[c.min.x,c.min.y,c.min.z],[c.max.x,c.max.y,c.max.z]],f=(s=performance.now(),new b.IsosurfaceGeometry(r.resolution,d,function(e,t,r){return l([e,t,r])[0]}));u=performance.now()-s;function p(e){var t=l([e.x,e.y,e.z]);return[t[1],t[2]]}console.log(">> time (creating isosurface) = "+u.toFixed(2)+" (ms)"),f.faceVertexUvs[0]=[],f.faces.forEach(function(e){var t=p(f.vertices[e.a]),r=p(f.vertices[e.b]),n=p(f.vertices[e.c]);f.faceVertexUvs[0].push([new THREE.Vector2(t[0],t[1]),new THREE.Vector2(r[0],r[1]),new THREE.Vector2(n[0],n[1])])}),f.uvsNeedUpdate=!0;var m=new THREE.Mesh(f,e.material);b.add(m)}b.loadOBJ({obj:"troll.obj",mtl:"troll.mtl",basePath:"models/obj/troll/",callback:e(object)}),b.loadGLTF({url:"models/LeePerrySmith/LeePerrySmith.glb",callback:e(object)}),b.loadOBJ({obj:"cyborg.obj",mtl:"cyborg.mtl",basePath:"models/obj/cyborg/",callback:e(object)})},b.demoQuadricSurfaces=function(){b.loadSTL({url:"models/dummy/woman.stl",callback:function(e){b.add(e),e.material=new THREE.MeshNormalMaterial({flatShading:!0,side:THREE.DoubleSide});var t={maxPoints:16,resolution:64},r=b.toNonIndexedBufferGeometry(e.geometry),n=r.attributes.position.array,i=r.attributes.normal.array,a=performance.now(),o=new b.QuadricSurfaces(n,i,t),s=performance.now()-a;console.log(">> time (creating quadricSurfaces) = "+s.toFixed(2)+" (ms)");var l=new THREE.Box3,u=new THREE.Vector3;l.setFromObject(e),l.getSize(u),u.multiplyScalar(.1),l.expandByVector(u);var c=[[l.min.x,l.min.y,l.min.z],[l.max.x,l.max.y,l.max.z]],h=(a=performance.now(),new b.IsosurfaceGeometry(t.resolution,c,function(e,t,r){return o([e,t,r])[0]}));s=performance.now()-a;console.log(">> time (creating isosurface) = "+s.toFixed(2)+" (ms)");var d=new THREE.Mesh(h,e.material);b.add(d)}})},b.demoUnconstrainedDelaunay=function(){for(var e=100,t=100,r=100,n=[],i=new THREE.ImprovedNoise,a=0;a<1e3;a++){var o=b.randFloat(-e,e),s=b.randFloat(-t,t),l=b.randFloat(-r,r);s=10*i.noise(o,s,l),n.push(new THREE.Vector3(o,s,l))}var u=new b.DelaunayBufferGeometry(n,"xz"),c=(new THREE.Geometry).fromBufferGeometry(u);for(a=0;a<c.faces.length;a++)c.faces[a].color.setHex(16777215*Math.random());var h=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,side:THREE.DoubleSide}),d=new THREE.Mesh(c,h);b.add(d)},b.demoConstrainedDelaunay=function(){var e=[280.35714,648.79075,286.78571,662.8979,263.28607,661.17871,262.31092,671.41548,250.53571,677.00504,250.53571,683.43361,256.42857,685.21933,297.14286,669.50504,289.28571,649.50504,285,631.6479,285,608.79075,292.85714,585.21932,306.42857,563.79075,323.57143,548.79075,339.28571,545.21932,357.85714,547.36218,375,550.21932,391.42857,568.07647,404.28571,588.79075,413.57143,612.36218,417.14286,628.07647,438.57143,619.1479,438.03572,618.96932,437.5,609.50504,426.96429,609.86218,424.64286,615.57647,419.82143,615.04075,420.35714,605.04075,428.39286,598.43361,437.85714,599.68361,443.57143,613.79075,450.71429,610.21933,431.42857,575.21932,405.71429,550.21932,372.85714,534.50504,349.28571,531.6479,346.42857,521.6479,346.42857,511.6479,350.71429,496.6479,367.85714,476.6479,377.14286,460.93361,385.71429,445.21932,388.57143,404.50504,360,352.36218,337.14286,325.93361,330.71429,334.50504,347.14286,354.50504,337.85714,370.21932,333.57143,359.50504,319.28571,353.07647,312.85714,366.6479,350.71429,387.36218,368.57143,408.07647,375.71429,431.6479,372.14286,454.50504,366.42857,462.36218,352.85714,462.36218,336.42857,456.6479,332.85714,438.79075,338.57143,423.79075,338.57143,411.6479,327.85714,405.93361,320.71429,407.36218,315.71429,423.07647,314.28571,440.21932,325,447.71932,324.82143,460.93361,317.85714,470.57647,304.28571,483.79075,287.14286,491.29075,263.03571,498.61218,251.60714,503.07647,251.25,533.61218,260.71429,533.61218,272.85714,528.43361,286.07143,518.61218,297.32143,508.25504,297.85714,507.36218,298.39286,506.46932,307.14286,496.6479,312.67857,491.6479,317.32143,503.07647,322.5,514.1479,325.53571,521.11218,327.14286,525.75504,326.96429,535.04075,311.78571,540.04075,291.07143,552.71932,274.82143,568.43361,259.10714,592.8979,254.28571,604.50504,251.07143,621.11218,250.53571,649.1479,268.1955,654.36208],t=[];t[0]=[325,437,320,423,329,413,332,423],t[1]=[320.72342,480,338.90617,465.96863,347.99754,480.61584,329.8148,510.41534,339.91632,480.11077,334.86556,478.09046];for(var r=[],n=0;n<e.length;n+=2){var i=new THREE.Vector3(e[n],e[n+1],0);r.push(i)}for(var a=[],o=0;o<t.length;o++){a[o]=[];for(n=0;n<t[o].length;n+=2){i=new THREE.Vector3(t[o][n],t[o][n+1],0);a[o].push(i)}}var s=new b.ConstrainedDelaunayBufferGeometry(r,a),l=(new THREE.Geometry).fromBufferGeometry(s);for(n=0;n<l.faces.length;n++)l.faces[n].color.setHex(16777215*Math.random());l.center();var u=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,side:THREE.DoubleSide}),c=new THREE.Mesh(l,u);b.add(c)},b.demoCSGBoolean=function(){var e=(new Date).getTime(),t=new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load("images/rock/roughRockD.png")}),r=new THREE.Mesh(new THREE.BoxBufferGeometry(3,3,3)),n=new THREE.Mesh(new THREE.SphereBufferGeometry(1.8,64,32)),i=b.union(r,n);i.material=t;var a=b.intersect(r,n);a.material=t;var o=b.subtract(r,n);o.material=t,i.position.x=-5,o.position.x=5,b.add(i),b.add(a),b.add(o);var s=(new Date).getTime();console.log("CSG time: "+(s-e)+" ms")},b.demoSimplifyMesh=function(){(new THREE.GLTFLoader).load("models/LeePerrySmith/LeePerrySmith.glb",function(e){var t=e.scene.children[0];t.position.x=-3,t.rotation.y=Math.PI/2,b.add(t);var r=t.clone();r.geometry=b.simplifyGeometry(r.geometry,.875),r.position.x=3,r.rotation.y=-Math.PI/2,b.add(r);var n=b.createWireframe(t);t.add(n);n=b.createWireframe(r);r.add(n)})},b.demoSubdivideMesh=function(){(new THREE.GLTFLoader).load("models/LeePerrySmith/LeePerrySmith.glb",function(e){var t=e.scene.children[0];t.position.x=-3,t.rotation.y=Math.PI/2,b.add(t);var r=t.clone();r.geometry=b.subdivideGeometry(r.geometry,1),r.position.x=3,r.rotation.y=-Math.PI/2,b.add(r);var n=b.createWireframe(t);t.add(n);n=b.createWireframe(r);r.add(n)})},b.demoCanvasDrawing=function(){var e;(e=b.createTextSprite("가나다라마바사아자차카타파하",{textHeight:1,textColor:16711680,textWidthScale:1})).position.set(0,7,0),b.add(e),(e=b.createTextSprite("abcdefghijklmnopqrstuvwxyz!@#$%^&*()")).position.set(0,8,0),b.add(e);var t=document.createElement("canvas"),r=t.getContext("2d");t.height=256,t.width=256;var n=[[0,0],[100,50],[200,0],[250,200],[50,150]];r.fillPolygon(n,30,"yellow");for(var i=0;i<n.length;i++)n[i][0]+=10;r.strokePolygon(n,30,"red"),r.fillRoundRect(128,128,64,64,10,"#D2691E"),r.strokeRoundRect(144,144,64,64,10,"#00008B"),r.fillRect(5,5,20,20),r.strokeRect(128,5,20,20),r.fillCircle(64,192,30,"red"),r.strokeCircle(128,192,30,"#4B0082"),b.add(b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshBasicMaterial",map:new THREE.CanvasTexture(t)}}))},b.demoAnimations=function(){b.loadGLB({url:"models/gltf/RobotExpressive/RobotExpressive.glb",callback:function(e){var t=b.createSpotLight({target:e});t.position.set(0,10,0),b.add(t),b.add(e)}})},b.demoParticles=function(){var e=b.Particles.examples.fountain;e.positionBase=new THREE.Vector3(0,1,0),e.positionSpread=new THREE.Vector3(1,0,1),e.velocityBase=new THREE.Vector3(0,16,0),e.velocitySpread=new THREE.Vector3(10,2,10),e.accelerationBase=new THREE.Vector3(0,-10,0),e.sizeTween.values[0]=.01,e.sizeTween.values[1]=1,e.emitterDeathAge=5;var t=b.createParticles(e);b.add(t)},b.demoImageSpritesHUD=function(){(new THREE.TextureLoader).load("images/sprites/metalBall.png",e=>{var t=e.image.width,r=e.image.height,n=b.createSpritesHUD(e,0,0,t,r);b.appWorks.sceneHUD.add(n);n=b.createSpritesHUD(n.material,0+t,0,t,r);b.appWorks.sceneHUD.add(n);n=b.createSpritesHUD(n.material,0+2*t,0,t,r);b.appWorks.sceneHUD.add(n)})},b.demoCanvasTextHUD=function(){var e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial"}});b.add(e),e.update=function(e,t){this.rotation.x+=.01,this.rotation.y-=.02,this.rotation.z+=.03};var t=[],r=b.computeMassProperties(e);t.push("surface area: "+r.area.toFixed(2)),t.push("volume size: "+r.volume.toFixed(2)),t.push("rot [x:-9.9, y:-9.9, z:-9.9]");var n=b.createTextHUD(t,10,0,null,null,!0);b.appWorks.sceneHUD.add(n),n.update=function(t,r){var n=this.userData.context2D,i=this.userData.texts,a=this.userData.lineHeight,o=2*Math.PI,s="rot [x:"+(e.rotation.x%o).toFixed(1)+", y:"+(e.rotation.y%o).toFixed(1)+", z:"+(e.rotation.z%o).toFixed(1)+"]";i[2]=s,n.clear();var l=a;i.forEach(e=>{n.fillText(e,0,l),l+=a}),this.material.map.needsUpdate=!0}},b.demoRenderTargetHUD=function(){var e=b.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.6,128,32]},material:{type:"MeshPhongMaterial"}});b.add(e),e.update=function(e,t){this.rotation.x+=.01,this.rotation.y-=.02,this.rotation.z+=.03};var t=2*b.appWorks.cameraHUD.top-200,r=b.createRenderTargetHUD(e,0,t,200,200,!0);b.appWorks.sceneHUD.add(r),r.update=function(t,r){var n=this.userData.renderTarget,i=this.userData.rtScene,a=this.userData.rtCamera;i.children[0].rotation.copy(e.rotation);var o=b.appWorks.renderer;o.setRenderTarget(n),o.render(i,a)}},b.demoNatureTextures=function(){var e,t=new THREE.TextureLoader;(e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",map:t.load("images/rock/crackRockDiffuse.jpg"),normalMap:t.load("images/rock/crackRockNormal.jpg"),aoMap:t.load("images/rock/crackRockAO.jpg")}})).name="demoCrackRocks",b.add(e),(e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:.2,metalness:.8,map:t.load("images/metal/metalPanelsDiffuse8.jpg"),normalMap:t.load("images/metal/metalPanelsNormal.jpg"),aoMap:t.load("images/metal/metalPanelsAO.jpg")}})).name="demoMetalPanels",b.add(e),(e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:1,metalness:0,map:t.load("images/terrain/wasteLandDiffuse6.jpg"),normalMap:t.load("images/terrain/wasteLandNormal.jpg"),aoMap:t.load("images/terrain/wasteLandAO.jpg")}})).name="demoWasteLand",b.add(e),(e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:1,metalness:0,map:t.load("images/terrain/dirtGrassTerrainD6.jpg"),normalMap:t.load("images/terrain/dirtGrassTerrainN.jpg"),aoMap:t.load("images/terrain/dirtGrassTerrainAO.jpg")}})).name="demoDirtGrassTerrain",b.add(e),(e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",map:t.load("images/fish/caviarDiffuse4.jpg"),normalMap:t.load("images/fish/caviarNormal.jpg"),aoMap:t.load("images/fish/caviarAO.jpg")}})).name="demoCaviar",b.add(e)},b.demoImageProcessing=function(){b.imageFileProcessing("images/jamieElly1024.png","EdgeDetection2Shader",{edgeFunc:"trueColorEdge",showImage:!0,saveImage:!0})},b.demoSketcher=function(){var e=b.appWorks.width,t=b.appWorks.height,r=new b.Sketcher({width:e,height:t});b.appWorks.dom.appendChild(r.dom)},b.demoMatcaps=function(){var e=b.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.6,128,32]},material:{type:"MeshPhongMaterial"}});b.add(e),b.scene.add(b.createHemisphereLight());var t=b.getObjectSize(e),r=function(e){var t=(e=e||100)/2,r=new THREE.Object3D;r.name="pbrWalls";var n=new THREE.PlaneBufferGeometry(.9*e,.9*e),i=new THREE.Reflector(n,{clipBias:.003,textureWidth:~~(b.appWorks.width*window.devicePixelRatio),textureHeight:~~(b.appWorks.height*window.devicePixelRatio),color:8952217,recursion:1});i.position.y=t,i.position.z=.99*-t,r.add(i);var n=new THREE.PlaneBufferGeometry(1.001*e,1.001*e);function a(e,t){var t=t||4;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}var o=new THREE.TextureLoader,s=new THREE.MeshStandardMaterial({color:11184810,roughness:1,metalness:0,map:o.load("images/pbr/wallA.png",a),normalMap:o.load("images/pbr/wallN.png",a),aoMap:o.load("images/pbr/wallAO.png",a),roughnessMap:o.load("images/pbr/wallR.png",a)}),l=new THREE.Mesh(n,s);l.position.y=e,l.rotateX(Math.PI/2),r.add(l);var u=new THREE.Mesh(n,s);u.rotateX(-Math.PI/2),r.add(u);var c=new THREE.Mesh(n,s);c.position.z=t,c.position.y=t,c.rotateY(Math.PI),r.add(c);var h=new THREE.Mesh(n,s);h.position.z=-t,h.position.y=t,r.add(h);var d=new THREE.Mesh(n,s);d.position.x=t,d.position.y=t,d.rotateY(-Math.PI/2),r.add(d);var f=new THREE.Mesh(n,s);return f.position.x=-t,f.position.y=t,f.rotateY(Math.PI/2),r.add(f),r}(4*t);r.position.y=-4*t/2,b.add(r),b.appWorks.select(e),b.appWorks.guiMatcaps.setDisplay(""),b.appWorks.guiNormalMaps.setDisplay("")},b.demoLighting=function(){var e=b.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,10/6,128,32]},material:{type:"MeshPhongMaterial"}});b.scene.add(e),b.fitCameraToObject(e);var t=b.createSunsetLights();b.scene.add(t)},b.demoArenaRows=function(){var e;(e=b.createArenaRow({radius:.5,numSections:30,conesPerSection:5,heightMin:.1,heightMax:.15,radiusMin:.05,radiusMax:.05})).scale.setScalar(20),b.scene.add(e),(e=b.createArenaRow({radius:.45,numSections:20,conesPerSection:2,heightMin:.05,heightMax:.075,radiusMin:.025,radiusMax:.05})).scale.setScalar(20),b.scene.add(e)},b.demoInstancedMeshes=function(){var e,t=(new THREE.TextureLoader).load("images/matcaps3/00023.jpg"),r=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshMatcapMaterial",matcap:t}}),n=b.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[2.5,32,16]},material:{type:"MeshMatcapMaterial",matcap:t}}),i=b.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[1.5,1.5,5,32]},material:{type:"MeshMatcapMaterial",matcap:t}}),a={pattern:"circular",axis:"y",radiusStart:50,radiusLength:450,numRadius:100,angleStart:0,angleLength:2*Math.PI,numAngle:100,colorMode:"0"},o={pmin:[0,-500,-500],pmax:[0,500,500],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"2"},s=b.createInstancedMeshes(r,{pattern:"rectangular",axis:"z",width:1e3,height:1e3,numWidth:100,numHeight:100,colorMode:"1"}),l=b.createInstancedMeshes(n,a),u=b.createInstancedMeshes(i,o);s.update=function(e,t){this.rotation.y=.1*t},l.update=(e=10,function(t,r){(this.position.y>200||this.position.y<-200)&&(e*=-1),this.position.y+=t*e,this.rotation.y=.1*r}),u.update=function(e,t){this.rotation.y=.1*t},b.add(s),b.add(l),b.add(u)},b.demoInstancedObject=function(){var e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshPhongMaterial"}}),t=b.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[2.5,32,16]},material:{type:"MeshPhongMaterial"}}),r=b.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[1.5,1.5,5,32]},material:{type:"MeshPhongMaterial"}}),n=new THREE.Object3D;n.add(e,t,r),n.position.y=10;var i=b.createInstancedObject(n,{pmin:[-500,0,-500],pmax:[500,0,500],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"1"});b.add(i)},b.demoImgBase64ToFile=function(e){b.loadImageBase64(e,function(e){var t=b.imageElementToData(e);b.imageDataToFile(t,"image.png")})},b.demoWebBrowserInfo=function(){console.log("# Navigator Info"),console.log(window.navigator),console.log("# Device Info");var e=[];e.push("isMobile: "+b.isDeviceMobile()),e.push("isLandscape: "+b.isDeviceLandscape()),e.push("isTouch: "+b.isDeviceTouch()),e.push("isWindowsOS: "+b.isDeviceWindowsOS()),e.push("isMacOS: "+b.isDeviceMacOS()),e.push("width class: "+(window.innerWidth<600?"extra small":window.innerWidth<768?"small":window.innerWidth<992?"medium":window.innerWidth<1200?"large":"extra large")),console.log(e.join("\n")),console.log("# WebGL Info"),console.log(b.getWebGLInfo().join("\n"))},b.demoLoadObject3D=function(){for(var e=[],t=0;t<1024;t++){var r=b.randFloat(-10,10),n=b.randFloat(-10,10),i=b.randFloat(-10,10);e.push(r,n,i)}var a=[];for(t=0;t<1024;t++){var o=b.randFloat(0,1),s=b.randFloat(0,1),l=b.randFloat(0,1);a.push(o,s,l)}b.loadObject3D({object:{type:"Points",name:"points"},geometry:{type:"BufferGeometry",attributes:{position:e,color:a}},material:{type:"PointsMaterial",map:"images/sprites/metalBall.png",color:16777215,size:1,transparent:!0,depthTest:!1,vertexColors:THREE.VertexColors}}).then(e=>{b.add(e)})},b.demoTweenBox=function(){b.add(b.createHemisphereLight());var e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",map:(new THREE.TextureLoader).load("images/crate.gif")}});b.add(e);for(var t=b.getCurrentTime(),r=e,n=0;n<3;n++){let e=0===n?r:r.clone();0!==n&&b.add(e),e.tweens=b.tweenObjects([e.position,e.rotation,e.scale,e.material.color],[{y:20},{y:Math.PI/2},{x:2,y:2,z:2},{r:n/2,g:n/2,b:0}],{duration:3e3,easing:M.Easing.Elastic.InOut,repeat:1/0,yoyo:!0,start:1e3*t,delay:200*n}),e.update=function(t,r){e.tweens.update(1e3*r)}}},b.demoTweenBuildings=function(){b.loadOBJ({obj:"buildings.obj",basePath:"models/obj/",callback:function(e){b.appWorks.scene.background=b.createBackground("redSky"),b.appWorks.scene.fog=b.createFog({type:"exp2",color:b.FOG_COLOR,density:.0093});const t=b.createAmbientLight({color:10488330,intensity:.05});b.scene.add(t);const r=b.createSpotLight({color:16711680,intensity:.2});r.position.set(100,150,100),b.scene.add(r);const n=b.createPointLight({color:16777215,intensity:.4});n.position.set(16,100,-68),b.scene.add(n);var i=new THREE.Object3D,a=[],o=e.children.map(e=>(e.scale.setScalar(.01),e.position.set(0,0,0),e.frustumCulled=!1,e.receiveShadow=!1,e.castShadow=!1,e));for(var s=new THREE.MeshPhysicalMaterial({color:16777215,metalness:.58,roughness:.18}),l=0;l<40;l++)for(var u=0;u<40;u++){const e=o[b.randInt(0,o.length-1)].clone();e.material=s,e.scale.y=Math.random()*(.008+.01),e.position.x=3*l,e.position.z=3*u,i.add(e),a.push(e)}b.add(i),i.position.set(-60,0,-60);var c=b.getCurrentTime();a.sort((e,t)=>e.position.lengthSq()-t.position.lengthSq());var h=a.length;a.forEach((e,t)=>{e.position.y=.5,e.tween=b.tweenObject(e.position,{y:-.5},{duration:2500,easing:M.Easing.Sinusoidal.InOut,repeat:1/0,yoyo:!0,start:1e3*c,delay:t/(h-1)*2500*2}),e.update=function(t,r){e.tween.update(1e3*r)}})}})},b.demoTweenInstancedMesh=function(){var e=b.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[4.5,4.5,10,32]},material:{type:"MeshMatcapMaterial",matcap:(new THREE.TextureLoader).load("images/matcapMetal.jpg")}}),t=b.createInstancedMeshes(e,{pattern:"rectangular",axis:"y",width:1e3,height:1e3,numWidth:100,numHeight:100});b.add(t);for(var r,n,i=b.getCurrentTime(),a=t.numInstances,o=new THREE.Vector3,s=2*Math.PI,l=[],u=[],c=0;c<a;c++)t.getPositionAt(c,o),l.push({x:o.x,y:o.y,z:o.z,w:c}),r=~~(c/100),n=c%100,u.push({y:o.y+20*Math.sin(r/99*s)*Math.cos(n/99*s)});t.tweens=b.tweenObjects(l,u,{duration:1e3,repeat:1/0,yoyo:!0,start:1e3*i,objectDelay:.5,update:function(e){o.set(e.x,e.y,e.z),t.setPositionAt(e.w,o)}}),t.update=function(e,r){t.tweens.update(1e3*r),t.needsUpdate("position")}},b.demoTerrainLOD=function(){b.add(b.createHemisphereLight());var e=b.createWater();e.position.y=5.3,b.add(e);var t=b.camera;t.position.set(-143,59.6,-132.3),t.rotation.set(-155.8*THREE.DEG2RAD,-44.6*THREE.DEG2RAD,-162.5*THREE.DEG2RAD),t.updateProjectionMatrix();var r=b.createTerrainLOD("GIANT",1024,4,64,100);b.add(r)},b.demoHeightMapTerrain=function(){var e=b.createDirectionalLight();e.position.set(0,10,0),b.add(e);var t=b.createWater();t.position.y=3.5,b.add(t);var r=b.camera;r.position.set(-467.7,48.5,511.6),r.rotation.set(-5.42*THREE.DEG2RAD,-42.31*THREE.DEG2RAD,-3.65*THREE.DEG2RAD),r.updateProjectionMatrix();var n=b.createHeightMapTerrain("images/terrain/heightmapCA.png",{worldWidth:1024,resolution:1024});b.add(n)},b.demoLoadHeightMaps=function(){(new b.HGTLoader).loadTile(28.661402,-17.872627,12)},b.demoLoadNRRD=function(){function e(){b.renderer.render(b.scene,b.camera)}var t=512,r=window.innerWidth/window.innerHeight,n=new THREE.OrthographicCamera(-t*r/2,t*r/2,256,-256,1,1e3);n.position.set(0,0,128),n.up.set(0,0,1),b.appWorks.camera=n,b.camera=n;var i=new THREE.OrbitControls(n,b.renderer.domElement);i.addEventListener("change",e),i.target.set(64,64,128),i.minZoom=.5,i.maxZoom=4,i.update(),b.appWorks.controls=i,(new THREE.NRRDLoader).load("models/nrrd/stent.nrrd",function(t){var r=new THREE.DataTexture3D(t.data,t.xLength,t.yLength,t.zLength);r.format=THREE.RedFormat,r.type=THREE.FloatType,r.minFilter=r.magFilter=THREE.LinearFilter,r.unpackAlignment=1;var n=new THREE.TextureLoader,i={viridis:n.load("images/medical/cm_viridis.png",e),gray:n.load("images/medical/cm_gray.png",e)},a=0,o=1,s="iso",l=.15,u="viridis",c=THREE.VolumeRenderShader1,h=THREE.UniformsUtils.clone(c.uniforms);h.u_data.value=r,h.u_size.value.set(t.xLength,t.yLength,t.zLength),h.u_clim.value.set(a,o),h.u_renderstyle.value="mip"==s?0:1,h.u_renderthreshold.value=l,h.u_cmdata.value=i[u];var d=new THREE.ShaderMaterial({uniforms:h,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,side:THREE.BackSide}),f=new THREE.BoxBufferGeometry(t.xLength,t.yLength,t.zLength);f.translate(t.xLength/2-.5,t.yLength/2-.5,t.zLength/2-.5);var p=new THREE.Mesh(f,d);b.add(p)})},b.demoSelectFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="select_files" name="files[]" multiple />\n        <output id="select_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("select_files").addEventListener("change",function(e){for(var t,r=e.target.files,n=[],i=0;t=r[i];i++)t.name.match(/\.(jpg|png)$/)&&n.push("<li><strong>",b.escapeHTML(t.name),"</strong> (",t.type||"n/a",") - ",b.humanFileSize(t.size),", last modified: ",t.lastModifiedDate?t.lastModifiedDate.toLocaleDateString():"n/a","</li>");document.getElementById("select_result").innerHTML="<ul>"+n.join("")+"</ul>"},!1)},b.demoDropFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <div id="drop_zone" style="\n            margin: 10px 5px 0 0;\n            border: 2px dashed #bbb;\n            -moz-border-radius: 5px;\n            -webkit-border-radius: 5px;\n            border-radius: 5px;\n            padding: 25px;\n            text-align: center;\n            font: 20pt bold \'Vollkorn\';\n            color: #bbb;\n        ">Drop files here</div>\n        <output id="drop_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.getElementById("drop_zone");t.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),t.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault();for(var t,r=e.dataTransfer.files,n=[],i=0;t=r[i];i++)n.push("<li><strong>",b.escapeHTML(t.name),"</strong> (",t.type||"n/a",") - ",b.humanFileSize(t.size),", last modified: ",t.lastModifiedDate?t.lastModifiedDate.toLocaleDateString():"n/a","</li>");document.getElementById("drop_result").innerHTML="<ul>"+n.join("")+"</ul>"},!1)},b.demoReadFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="read_files" name="files[]" multiple /><br>\n        <output id="read_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("read_files").addEventListener("change",function(e){for(var t,r=e.target.files,n=0;t=r[n];n++)if(t.type.match("image.*")){var i=new FileReader;i.onload=function(e){return function(t){var r=document.createElement("span");r.innerHTML=['<img class="thumb" style="height: 75px; border: 1px solid #000; margin: 10px 5px 0 0;" src="',t.target.result,'" title="',b.escapeHTML(e.name),'"/>'].join(""),document.getElementById("read_result").insertBefore(r,null)}}(t),i.readAsDataURL(t)}},!1)},b.demoProgressFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="progress_files" name="file" />\n        <button onclick="JAMIE.abortRead();">Cancel reading</button>\n        <div id="progress_bar"><div class="percent">0%</div></div>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.getElementById("progress_bar");t.style.cssText="        margin: 10px 0;\n        padding: 3px;\n        border: 1px solid #000;\n        font-size: 14px;\n        clear: both;\n        opacity: 0;\n        -moz-transition: opacity 1s linear;\n        -o-transition: opacity 1s linear;\n        -webkit-transition: opacity 1s linear;\n    ";var r,n=document.querySelector(".percent");n.style.cssText="        background-color: #99ccff;\n        height: auto;\n        width: 0;\n    ",b.abortRead=function(){r.abort()},document.getElementById("progress_files").addEventListener("change",function(e){n.style.width="0%",n.textContent="0%",(r=new FileReader).onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:alert("File not found!");break;case e.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case e.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}},r.onprogress=function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);t<100&&(n.style.width=t+"%",n.textContent=t+"%")}},r.onabort=function(e){alert("File read canceled")},r.onloadstart=function(e){t.style.opacity="1.0"},r.onload=function(e){n.style.width="100%",n.textContent="100%",setTimeout(function(){t.style.opacity="0.0"},2e3)},r.readAsBinaryString(e.target.files[0])},!1)},b.demo3DFileTo2DImage=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="select_files" name="files[]" multiple />\n        <output id="select_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("select_files").addEventListener("change",function(e){for(var t=e.target.files,r=[],n=0;i=t[n];n++)i.name.match(/\.(glb|GLB)$/)&&r.push("<li><strong>",b.escapeHTML(i.name),"</strong> (",i.type||"n/a",") - ",b.humanFileSize(i.size),", last modified: ",i.lastModifiedDate?i.lastModifiedDate.toLocaleDateString():"n/a","</li>");var i;for(document.getElementById("select_result").innerHTML="<ul>"+r.join("")+"</ul>",n=0;i=t[n];n++){var a=b.escapeHTML(i.name);b.loadGLB({url:"dummy/"+a,callback:function(e){b.add(e),a=(a=(a=e.name).split("/")[1]).split(".")[0],a+=".jpg",b.welcomeObject(e),b.screenCapture(a,!1),b.remove(e)}})}},!1)},b.demoEditImageFile=function(){b.imageFileToData("images/grid2x2.png",e=>{for(var t=e.width,r=e.height,n=e.data,i=t*r,a=0;a<i;a++){0===n[4*a+0]&&(n[4*a+0]=115,n[4*a+1]=115,n[4*a+2]=115)}b.imageDataToFile(e,"outputFile.png")})},b.demoCaptureToAnimatedGIF=function(){function e(e){var t=b.camera,r=t.position.x,n=t.position.z,i=Math.sqrt(r*r+n*n);t.position.x=i*Math.sin(e*THREE.DEG2RAD),t.position.z=i*Math.cos(e*THREE.DEG2RAD)}e(30),b.screenCapture(!1),e(0),b.screenCapture(!1),e(-30),b.screenCapture(!1)},b.demoSplitInstMesh=function(){b.appWorks.scene.background=b.createBackground("redSky"),b.scene.add(b.createHemisphereLight());var e=b.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshPhongMaterial"}});b.createInstancedMeshes(e,{pattern:"rectangular",axis:"z",width:100,height:100,numWidth:10,numHeight:10,colorMode:"1"}).split(e=>{e.forEach(e=>{b.add(e)})})},b.demoSpeechBubble=function(){var e=b.createTextSprite("Welcome to Jamie World",{textColor:4210752,textHeight:.5,fontWeight:"bold"});e.position.z=.001,e.name="speechText";var t=new THREE.Vector3;b.computeBoundingBox(e).getSize(t);var r=256*t.x,n=256*t.y,i=.2*n,a=r/2,o=n+i,s=4*i,l=document.createElement("canvas"),u=l.getContext("2d");l.width=a>r?a:r,l.height=o>n?o:n,u.lineWidth="2",u.fillSpeechBubble(0,0,r,n,i,a,o,s,"#fff");var c=new THREE.SpriteMaterial({color:16777215,map:new THREE.CanvasTexture(u.canvas),transparent:!0,opacity:.5,depthTest:!1}),h=new THREE.Sprite(c);h.scale.set(.7*t.x,1.5*t.y,1),h.name="speechBubble";var d=new THREE.Object3D;d.name="speech",d.add(e,h),b.add(d)},b.demoProgressbar=function(){const e=new THREE.LoadingManager;e.onStart=()=>{b.createProgressbar()},e.onProgress=(e,t,r)=>{b.updateProgressbar(t,r)},e.onLoad=()=>{b.hideProgressbar()},e.onError=e=>{b.errorProgressbar("There was an error loading "+e)};THREE.DRACOLoader.setDecoderPath("js/draco/gltf/");const t=new THREE.GLTFLoader(e);t.setCrossOrigin("anonymous"),t.setDRACOLoader(new THREE.DRACOLoader),["models/gltf/BarramundiFish.glb","models/gltf/ferrari.glb","models/gltf/Flamingo.glb","models/gltf/Horse.glb","models/gltf/Parrot.glb","models/gltf/PrimaryIonDrive.glb","models/gltf/Soldier.glb","models/gltf/Stork.glb"].forEach(e=>{t.load(e,e=>{var t=e.scene||e.scenes[0],r=e.animations;r&&(t.animations=r),b.add(t)})})},b.demoShowAppInfo=function(){var e=document.createElement("div");e.id="infobutton",e.innerHTML='        <img src="images/info.png" border="0" />\n    ',e.style.cssText="        text-align: left;\n        margin: 0 0 0 0;\n        z-index: 13;\n        position: absolute;\n        display: block;\n        padding: 8px;\n    ",e.addEventListener("click",function(e){var t=document.getElementById("infoPanel").style;t.display="block"==t.display?"none":"block"}),document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.createElement("div");t.id="infoPanel",t.innerHTML='        <b>ViewWorks - 3D model viewer</b>\n        <p>\n        To upload your model,<br>\n        <b>drag and drop your file or folder onto this ViewWorks.</b><br><br>\n        Supported file formats<br>\n        JSON, OBJ(+MTL), STL, PLY, DAE(COLLADA), GLTF, GLB, AMF, 3MF, WRL(VRML), FBX<br>\n        </p>\n        (C) <a href="https://www.nova-graphix.com/" target="_blank" style="color: #ffa500; text-decoration: none;">NovaGraphix, Co.</a>, 2018.\n    ',t.style.cssText="        text-align: left;\n        font-size: 80%;\n        margin: 0.5em 0em 0em 0.4em;\n        z-index: 12;\n        position: absolute;\n        display: none;\n        color: #fff;\n        background: #121212;\n        opacity: 0.8;\n        border-radius: 20px;\n        padding: 32px;\n    ",document.getElementById("novaGraphix").parentNode.appendChild(t)},b.demoTrees=function(){var e=b.createProcTree(.7,5,0,.99,4,2.4,.1);e.children[1].material.color=new THREE.Color(6493697),e.position.x=-5,b.add(e),(e=b.createProcTree(1,10,0,.9,5,2.4,.139)).children[1].material.color=new THREE.Color(65280),e.position.x=0,b.add(e),(e=b.createProcTree(1.2,20,0,.85,4.8,4.7,.14)).children[1].material.color=new THREE.Color(16762114),e.position.x=5,b.add(e),(e=b.createProcTree(1.5,30,0,.99,4.8,7,.4)).children[1].material.color=new THREE.Color(16776960),e.position.x=10,b.add(e)},b.demoPrintInfo=function(){},b.demoObjectToPoints=function(){new Promise(e=>{b.add(b.createHemisphereLight());var t=b.createNoiseHeightGeometry(1e3,1e3,256,256,100),r=new THREE.TextureLoader,n=new THREE.MeshLambertMaterial({map:r.load("images/rock/roughRockD.png")}),i=new THREE.Mesh(t,n);i.name="sampleMesh",b.add(i),setTimeout(()=>e(i),500)}).then(e=>{b.add(e.clonedToPoints(.05))})},b.demoRaymarchToPoints=function(){var e=b.appWorks.selectObject;e&&e.isRaymarch&&b.add(e.clonedToPoints(.05,!1))},b.demoApplication=function(){b.demoMedicalQuadViewport()},b.demoTerrainWaterCaustics=function(){var e=b.createDirectionalLight({intensity:.2});e.position.x=-100,e.position.y=60,b.add(e);var t=b.createTerrain({height:100,waterDepth:20,waterColor:b.OCEAN_COLOR,caustics:!0});b.add(t);var r=b.createWater({waterColor:b.OCEAN_COLOR,terrain:t,caustics:!0});b.add(r)},b.demoSceneEffect=function(){var e=b.createSceneEffectMesh({side:THREE.DoubleSide,caustics:!0,causticColor:b.OCEAN_COLOR});b.add(e)},b.createSceneEffectMesh=function(e){var t=(e=e||{}).color||16777215,r=e.opacity||1,n=e.side||THREE.DoubleSide,i=e.resolution||512,a=e.causticColor||b.OCEAN_COLOR,o=e.caustics||void 0,s=e.geometry||new THREE.PlaneBufferGeometry(b.WORLD_SIZE,b.WORLD_SIZE,i-1,i-1),l={};void 0!==o&&(l.CAUSTICS="");var u={time:{value:0},color:{value:new THREE.Color(t)},opacity:{value:r},tSceneMap:{value:null},causticColor:{value:new THREE.Color(a)}},c=new THREE.ShaderMaterial({defines:l,uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,u]),transparent:!0,side:n,fog:!0,vertexShader:"\n            #include <fog_pars_vertex>\n            varying vec2 vUv;\n            varying vec4 vClipPos;\n            void main() {\n                vUv = uv;\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 ); // used in fog_vertex\n                gl_Position = projectionMatrix * mvPosition;\n                vClipPos = gl_Position;\n                #include <fog_vertex>\n            }\n        ",fragmentShader:`\n            #include <common>\n\t\t    #include <fog_pars_fragment>\n            uniform float time;\n            uniform vec3 color;\n            uniform float opacity;\n            uniform sampler2D tSceneMap;\n            varying vec2 vUv;\n            varying vec4 vClipPos;\n            ${b.ShaderChunk.clipToScreenPos}\n        #ifdef CAUSTICS\n            uniform vec3 causticColor;\n            ${b.ShaderChunk.caustics}\n        #endif\n            void main() {\n                vec3 sceneColor = color;\n                sceneColor *= texture2D( tSceneMap, clipToScreenPos( vClipPos ) ).rgb;\n            #ifdef CAUSTICS\n                sceneColor = mix( sceneColor, caustics( vUv, 8.0, causticColor ), 0.5 );\n            #endif\n                gl_FragColor = vec4( sceneColor, opacity );\n                #include <tonemapping_fragment>\n\t\t        #include <fog_fragment>\n            }\n        `}),h=new THREE.WebGLRenderTarget(i,i,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat});c.uniforms.tSceneMap.value=h.texture;var d=new THREE.Mesh(s,c);return d.name="sceneEffectMesh",d.frustumCulled=!1,d.castShadow=!1,d.receiveShadow=!0,d.rotation.x=-Math.PI/2,d.update=function(e,t){var r=b.appWorks.renderer;this.visible=!1,r.setRenderTarget(h),r.clear(),r.render(b.appWorks.scene,b.appWorks.camera),this.visible=!0,this.material.uniforms.time.value=t},d},b.demoWaterSimulation=function(){var e=new THREE.Scene,t=new THREE.OrthographicCamera(-1,1,1,-1,.01,2.01);t.position.z=1.01,e.add(t);var r=new THREE.WebGLRenderTarget(256,256,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat});r.texture.generateMipmaps=!1,r.texture.wrapS=THREE.RepeatWrapping,r.texture.wrapT=THREE.RepeatWrapping;var n=new THREE.ShaderMaterial({uniforms:{time:{value:0}},vertexShader:"\n            varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                // gl_Position = vec4( position, 1.0 );\n            }\n        ",fragmentShader:"\n            uniform float time;\n            varying vec2 vUv;\n            #define PI 3.14159265359\n            float rand(in float x) {\n                return fract(sin(dot(vec2(x+47.49,38.2467/(x+2.3)), vec2(12.9898, 78.233)))*(43758.5453));\n            }\n            vec2 randomDirection(in float x) {\n                float theta = rand(x) * 2.0 * PI;\n                return vec2( cos(theta), sin(theta) );\n            }\n            void calc_normal(in vec2 uv, out vec3 N)\n            {\n                N = vec3(0.0, 0.0, 1.0);\n                for (int i = 0; i < 50; i++) {\n                    // wave parameters\n                    float wavelength = rand(time+float(i)) * 0.5 + 0.3;\n                    float steepness = 5.0 * ( rand(time+float(i+1)) * 2.0 + 1.0);\n                    float speed = 0.05 * sqrt(PI/wavelength);\n                    float kAmpOverLen = 0.03;\n                    vec2 wave_dir = floor( randomDirection(time+float(i+2)) * 6.0 ) / 2.0 * wavelength;\n                    //\n                    float A = wavelength * kAmpOverLen;  // Amplitude\n                    float omega = 2.0 * PI / wavelength; // Frequency\n                    float phi = speed * omega;           // Phase\n                    float k = steepness;\n                    float term = omega * dot(wave_dir, uv) + phi * time;\n                    float C = cos(term);\n                    float S = sin(term);\n                    float val = pow(0.5 * (S + 1.0), k - 1.0) * C;\n                    val = omega * A * k * val;\n                    N += vec3( val*wave_dir, 0.0 );\n                }\n                N = normalize(N); \n            }\n            void main() {\n                vec3 N;\n                calc_normal(vUv, N);\n                N = (N * 0.5) + 0.5;\n                gl_FragColor = vec4(N, 1.0);\n            }\n        "}),i=new THREE.ShaderMaterial({uniforms:{time:{value:0},normalmap:{value:r.texture}},vertexShader:"\n            uniform float time;\n            varying vec2 texcoord;\n            varying vec3 lightv;\n            varying vec3 viewv;\n            #define PI 3.14159265359\n            float rand(in float x) {\n                return fract(sin(dot(vec2(x+47.49,38.2467/(x+2.3)), vec2(12.9898, 78.233)))*(43758.5453));\n            }\n            vec2 randomDirection(in float x) {\n                float theta = rand(x) * 2.0 * PI;\n                return vec2( cos(theta), sin(theta) );\n            }\n            void wave_function(in float waves[24], in float time, in vec3 pos, out vec3 P, out vec3 N, out vec3 B, out vec3 T)\n            {\n                P = pos;\n                for (int i = 0; i < 24; i += 6) {\n                    float A = waves[i] * waves[i+3];         // Amplitude\n                    float omega = 2.0 * PI / waves[i];       // Frequency\n                    float phi = waves[i+2] * omega;          // Phase\n                    float Qi = waves[i+1]/(omega * A * 4.0); // Steepness\n                    float term = omega * dot(vec2(waves[i+4], waves[i+5]), vec2(pos.x, pos.z)) + phi * time;\n                    float C = cos(term);\n                    float S = sin(term);\n                    P += vec3(Qi * A * waves[i+4] * C, A * S, Qi * A * waves[i+5] * C);\n                }\n                B = vec3(0.0);\n                T = vec3(0.0);\n                N = vec3(0.0);\n                for (int i = 0; i < 24; i += 6) {\n                    float A = waves[i] * waves[i+3];         // Amplitude\n                    float omega = 2.0 * PI / waves[i];       // Frequency\n                    float phi = waves[i+2] * omega;          // Phase\n                    float Qi = waves[i+1]/(omega * A * 4.0); // Steepness\n                    float WA = omega * A;\n                    float term = omega * dot(vec2(waves[i+4], waves[i+5]), vec2(P.x, P.z)) + phi * time;\n                    // float C = cos(term)/6.0;\n                    float C = cos(term);\n                    float S = sin(term);\n                    B += vec3 (Qi * waves[i+4] * waves[i+4] * WA * S, Qi * waves[i+4] * waves[i+5] * WA * S, waves[i+4] * WA * C);\n                    T += vec3 (Qi * waves[i+4] * waves[i+5] * WA * S, Qi * waves[i+5] * waves[i+5] * WA * S, waves[i+5] * WA * C);\n                    N += vec3 (waves[i+4] * WA * C, waves[i+5] * WA * C, Qi * WA * S);\n                }\n                B = normalize(vec3(1.0 - B.x, -B.y, B.z));\n                T = normalize(vec3(-T.x, 1.0 - T.y, T.z));\n                N = normalize(vec3(-N.x, -N.y, 1.0 - N.z));\n            }\n            void main(void)\n            {\n                vec3 P, N, B, T;\n                // wave parameters\n                float wavelength = 10.0;\n                float steepness = 0.8;\n                float speed = 0.15;\n                float kAmpOverLen = 0.02;\n                vec2 wave_dir;\n                float waves[24];\n                for(int i = 0; i < 24; i += 6) {\n                    wave_dir = randomDirection(time+float(i));\n                    waves[i]   = rand(time+float(i+1)) * (2.0 * wavelength - 0.7 * wavelength) + 0.7 * wavelength;\n                    waves[i+1] = steepness;\n                    waves[i+2] = sqrt(9.81 * 2.0*PI/wavelength) * wavelength * speed;\n                    waves[i+3] = kAmpOverLen;\n                    waves[i+4] = wave_dir.x;\n                    waves[i+5] = wave_dir.y;\n                }\n                // light\n                vec3 light = vec3(0.0, 100.0, 0.0);\n                // waved position\n                wave_function( waves, time, position, P, N, B, T );\n                lightv = vec3( dot(light, B), dot(light, T), dot(light, N) );\n                lightv = normalMatrix * lightv;//\n                lightv = normalize( lightv );\n                vec3 pos = (modelViewMatrix * vec4(P.xyz, 1.0)).xyz;\n                viewv = vec3( dot(pos, B), dot(pos, T), dot(pos, N) );\n                viewv = normalMatrix * viewv;//\n                viewv = normalize( viewv );\n                texcoord = vec2(P.x, P.z) * 0.5 + 0.5;\n                gl_Position = projectionMatrix * vec4(pos, 1.0);\n            }\n        ",fragmentShader:"\n            normalmap;\n            varying vec2 texcoord;\n            varying vec3 lightv;\n            varying vec3 viewv;\n            void main() {\n                vec3 N = texture2D( normalmap, texcoord*0.125 ).xyz * 2.0 - 1.0;\n                N = normalize(N);\n                vec3 specular = vec3(1.0) * pow( clamp( dot( reflect(normalize(lightv), N ), viewv ), 0.0, 1.0), 50.0 );\n                vec3 oceanblue = vec3(0.0, 0.0, 0.2);\n                vec3 skyblue = vec3(0.39, 0.52, 0.93) * 0.9;\n                const float R_0 = 0.4;\n                float fresnel = R_0 + (1.0 - R_0) * pow( 1.0 - dot(-normalize(viewv), N), 5.0 );\n                fresnel = max( 0.0, min(fresnel, 1.0) );\n                gl_FragColor = vec4( mix(oceanblue, skyblue, fresnel) + specular, 1.0 );\n            }\n        "}),a=new THREE.PlaneBufferGeometry(2,2),o=new THREE.Mesh(a,n);e.add(o);var s=new THREE.PlaneBufferGeometry(300,300,255,255);s.rotateX(-Math.PI/2);var l=new THREE.Mesh(s,i);b.add(l),l.update=function(n,i){var a=1e-6*i;o.material.uniforms.time.value=a;var s=b.appWorks.renderer;s.setRenderTarget(r),s.render(e,t),this.material.uniforms.time.value=a}},b.demoMedicalSlicer=function(){{let e=new b.MedicalLoader;e.setPath("https://cdn.rawgit.com/FNNDSC/data/master/dicom/adi_brain/");let t=["36444280","36444294","36444308","36444322","36444336","36444350","36444364","36444378","36444392","36444406","36748256","36444434","36444448","36444462","36444476","36444490","36444504","36444518","36444532","36746856","36746870","36746884","36746898","36746912","36746926","36746940","36746954","36746968","36746982","36746996","36747010","36747024","36748200","36748214","36748228","36748270","36748284","36748298","36748312","36748326","36748340","36748354","36748368","36748382","36748396","36748410","36748424","36748438","36748452","36748466","36748480","36748494","36748508","36748522","36748242"];e.load(t,e=>{var t=b.appWorks.scene,r=b.appWorks.camera,n=b.appWorks.controls;let i=new b.MedicalSlicer(e);t.add(i);i.update=function(e,t){this.index+=1,!0===this.outOfBounds&&(this.orientation=(this.orientation+1)%3,this.index=0)};let a=e.worldCenter();r.lookAt(a),n.target.copy(a)})}},b.demoMedicalVolume=function(){(new b.MedicalLoader).load(["https://rawgit.com/FNNDSC/data/master/mgh/orig.mgz"],e=>{var t=b.appWorks.scene,r=b.appWorks.camera,n=b.appWorks.controls;let i=new b.MedicalVolume(e);t.add(i);let a=document.createElement("div");a.style.cssText="position: fixed; bottom: 10px; left: 50%; transform: translate(-50%,0); z-index: 1;",b.appWorks.dom.appendChild(a);let o=new b.LookupTables(a);{i.lut=!0;let e=o.lutsAvailable("color"),t=o.lutsAvailable("opacity");var s=e.concat(t),l=-1;i.update=function(e,t){let r=.5*t,n=Math.floor(r%17);n!==l&&(console.log("lut used: "+s[n]),n<10?o.lut=s[n]:o.lutO=s[n],i.lutTexture=o.texture,l=n)}}let u=e.worldCenter();r.lookAt(u),n.target.copy(u)})},b.demoMedicalIsosurface=function(){(new b.MedicalLoader).load(["https://rawgit.com/FNNDSC/data/master/mgh/orig.mgz"],e=>{var t=b.appWorks.scene,r=b.appWorks.camera,n=b.appWorks.controls,i=new b.MedicalIsosurface(e);t.add(i);var a=e.worldCenter();r.lookAt(a),n.target.copy(a)})},b.demoMedicalQuadViewport=function(){(new b.MedicalLoader).load(["https://rawgit.com/FNNDSC/data/master/mgh/orig.mgz"],e=>{b.MedicalQuadViewport(e)})},b.demoMedicalSlicesViewport=function(){(new b.MedicalLoader).load(["https://rawgit.com/FNNDSC/data/master/mgh/orig.mgz"],e=>{b.MedicalSlicesViewport(e)})},b.createViewWorks=function(e){return b.viewWorks=new b.ViewWorks(e),b.viewWorks.renderScene(),b.viewWorks},b.createGameWorks=function(e){return b.gameWorks=new b.GameWorks(e),b.gameWorks.renderScene(),b.gameWorks},b.createNatureWorks=function(e){return(e=e||{}).appName=e.appName||"natureWorks",b.natureWorks=new b.DesignWorks(e),b.natureWorks.renderScene(),b.natureWorks},b.createMedicalWorks=function(e){return(e=e||{}).appName=e.appName||"medicalWorks",b.medicalWorks=new b.DesignWorks(e),b.medicalWorks.renderScene(),b.medicalWorks},b.add=function(e){b.appWorks.history?b.appWorks.add(e):b.scene.add(e)},b.remove=function(e){b.appWorks.history?b.appWorks.remove(e):e.parent&&e.parent.remove(e)},b.dispose=function(e){e&&(e.parent&&e.parent.remove(e),e.traverse(function(e){if(e.isMesh){e.geometry.dispose();var t=e.material;(Array.isArray(t)?t:[t]).forEach(function(e){e.dispose()})}}))},window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,window.JAMIE=b}]);