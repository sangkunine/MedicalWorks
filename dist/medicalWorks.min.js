!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=225)}([function(e,t,r){!function(e){"use strict";function t(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}});for(var r=[],n=0;n<256;n++)r[n]=(n<16?"0":"")+n.toString(16);var i,a={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(r[255&e]+r[e>>8&255]+r[e>>16&255]+r[e>>24&255]+"-"+r[255&t]+r[t>>8&255]+"-"+r[t>>16&15|64]+r[t>>24&255]+"-"+r[63&n|128]+r[n>>8&255]+"-"+r[n>>16&255]+r[n>>24&255]+r[255&i]+r[i>>8&255]+r[i>>16&255]+r[i>>24&255]).toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*a.DEG2RAD},radToDeg:function(e){return e*a.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,r,n,i){var a=Math.cos,o=Math.sin,s=a(r/2),l=o(r/2),u=a((t+n)/2),c=o((t+n)/2),h=a((t-n)/2),d=o((t-n)/2),f=a((n-t)/2),p=o((n-t)/2);"XYX"===i?e.set(s*c,l*h,l*d,s*u):"YZY"===i?e.set(l*d,s*c,l*h,s*u):"ZXZ"===i?e.set(l*h,l*d,s*c,s*u):"XZX"===i?e.set(s*c,l*p,l*f,s*u):"YXY"===i?e.set(l*f,s*c,l*p,s*u):"ZYZ"===i?e.set(l*p,l*f,s*c,s*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function o(e,t){this.x=e||0,this.y=t||0}function s(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(o.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(o.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}}),Object.assign(s.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=n,u[2]=o,u[3]=t,u[4]=i,u[5]=s,u[6]=r,u[7]=a,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},extractBasis:function(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],f=r[8],p=n[0],m=n[3],g=n[6],v=n[1],y=n[4],_=n[7],b=n[2],E=n[5],w=n[8];return i[0]=a*p+o*v+s*b,i[3]=a*m+o*y+s*E,i[6]=a*g+o*_+s*w,i[1]=l*p+u*v+c*b,i[4]=l*m+u*y+c*E,i[7]=l*g+u*_+c*w,i[2]=h*p+d*v+f*b,i[5]=h*m+d*y+f*E,i[8]=h*g+d*_+f*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-r*i*u+r*o*s+n*i*l-n*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],f=d*l-u*h,p=u*c-d*s,m=h*s-l*c,g=i*f+a*p+o*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return n[0]=f*y,n[1]=(o*h-d*a)*y,n[2]=(u*a-o*l)*y,n[3]=p*y,n[4]=(d*i-o*c)*y,n[5]=(o*s-u*i)*y,n[6]=m*y,n[7]=(a*c-h*i)*y,n[8]=(l*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*a+l*o)+a+e,-n*l,n*s,-n*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],u=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*u,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*u,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var l={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===i&&(i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),i.width=e.width,i.height=e.height;var r=i.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=i}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},u=0;function c(e,t,r,n,i,l,h,d,f,p){Object.defineProperty(this,"id",{value:u++}),this.uuid=a.generateUUID(),this.name="",this.image=void 0!==e?e:c.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:c.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:1001,this.wrapT=void 0!==n?n:1001,this.magFilter=void 0!==i?i:1006,this.minFilter=void 0!==l?l:1008,this.anisotropy=void 0!==f?f:1,this.format=void 0!==h?h:1023,this.internalFormat=null,this.type=void 0!==d?d:1009,this.offset=new o(0,0),this.repeat=new o(1,1),this.center=new o(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new s,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==p?p:3e3,this.version=0,this.onUpdate=null}function h(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function d(e,t,r){this.width=e,this.height=t,this.scissor=new h(0,0,e,t),this.scissorTest=!1,this.viewport=new h(0,0,e,t),r=r||{},this.texture=new c(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:1006,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function f(e,t,r){d.call(this,e,t,r),this.samples=4}function p(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}c.DEFAULT_IMAGE=void 0,c.DEFAULT_MAPPING=300,c.prototype=Object.assign(Object.create(t.prototype),{constructor:c,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(this.isDataTexture&&(n=document.createElement("canvas").getContext("2d").getImageData(0,0,n.width,n.height)),void 0===n.uuid&&(n.uuid=a.generateUUID()),!t&&void 0===e.images[n.uuid]){var i;if(Array.isArray(n)){i=[];for(var o=0,s=n.length;o<s;o++)i.push(l.getDataURL(n[o]))}else i=l.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(c.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(h.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(h.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,a=e.elements,o=a[0],s=a[4],l=a[8],u=a[1],c=a[5],h=a[9],d=a[2],f=a[6],p=a[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(o+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,g=(c+1)/2,v=(p+1)/2,y=(s+u)/4,_=(l+d)/4,b=(h+f)/4;return m>g&&m>v?m<.01?(r=0,n=.707106781,i=.707106781):(n=y/(r=Math.sqrt(m)),i=_/r):g>v?g<.01?(r=.707106781,n=0,i=.707106781):(r=y/(n=Math.sqrt(g)),i=b/n):v<.01?(r=.707106781,n=.707106781,i=0):(r=_/(i=Math.sqrt(v)),n=b/i),this.set(r,n,i,t),this}var E=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(E)<.001&&(E=1),this.x=(f-h)/E,this.y=(l-d)/E,this.z=(u-s)/E,this.w=Math.acos((o+c+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),d.prototype=Object.assign(Object.create(t.prototype),{constructor:d,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),f.prototype=Object.assign(Object.create(d.prototype),{constructor:f,isWebGLMultisampleRenderTarget:!0,copy:function(e){return d.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(p,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,a,o){var s=r[n+0],l=r[n+1],u=r[n+2],c=r[n+3],h=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(c!==p||s!==h||l!==d||u!==f){var m=1-o,g=s*h+l*d+u*f+c*p,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,g*v);m=Math.sin(m*b)/_,o=Math.sin(o*b)/_}var E=o*v;if(s=s*m+h*E,l=l*m+d*E,u=u*m+f*E,c=c*m+p*E,m===1-o){var w=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=w,l*=w,u*=w,c*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}}),Object.defineProperties(p.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(p.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(r/2),u=o(n/2),c=o(i/2),h=s(r/2),d=s(n/2),f=s(i/2);return"XYZ"===a?(this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f):"YXZ"===a?(this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f):"ZXY"===a?(this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f):"ZYX"===a?(this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f):"YZX"===a?(this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f):"XZY"===a&&(this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],u=r[2],c=r[6],h=r[10],d=n+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(a-u)*t,this._z=(o-i)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+u)/t):s>h?(t=2*Math.sqrt(1+s-n-h),this._w=(a-u)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-n-s),this._w=(o-i)/t,this._x=(a+u)/t,this._y=(l+c)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(a.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var n=Math.min(1,t/r);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=r*u+a*o+n*l-i*s,this._y=n*u+a*s+i*o-r*l,this._z=i*u+a*l+r*s-n*o,this._w=a*u-r*o-n*s-i*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*r+t*this._x,this._y=l*n+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var m=new v,g=new p;function v(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(v.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(g.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(g.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,u=s*r+o*t-i*n,c=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+u*-o-c*-a,this.y=u*s+h*-a+c*-i-l*-o,this.z=c*s+h*-o+l*-a-u*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this},projectOnVector:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)},projectOnPlane:function(e){return m.copy(this).projectOnVector(e),this.sub(m)},reflect:function(e){return this.sub(m.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(a.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var y=new v,_=new M,b=new v(0,0,0),E=new v(1,1,1),w=new v,x=new v,T=new v;function M(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(M.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,a,o,s,l,u,c,h,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new M).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,r=e.elements,n=1/y.setFromMatrixColumn(e,0).length(),i=1/y.setFromMatrixColumn(e,1).length(),a=1/y.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),l=Math.sin(n),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=a*u,d=a*c,f=o*u,p=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-o*s,t[2]=p-h*l,t[6]=f+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m+y*o,t[4]=v*o-g,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=g*o-v,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order)m=s*u,g=s*c,v=l*u,y=l*c,t[0]=m-y*o,t[4]=-a*c,t[8]=v+g*o,t[1]=g+v*o,t[5]=a*u,t[9]=y-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s;else if("ZYX"===e.order)h=a*u,d=a*c,f=o*u,p=o*c,t[0]=s*u,t[4]=f*l-d,t[8]=h*l+p,t[1]=s*c,t[5]=p*l+h,t[9]=d*l-f,t[2]=-l,t[6]=o*s,t[10]=a*s;else if("YZX"===e.order){var _=a*s,b=a*l,E=o*s,w=o*l;t[0]=s*u,t[4]=w-_*c,t[8]=E*c+b,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=b*c+E,t[10]=_-w*c}else"XZY"===e.order&&(_=a*s,b=a*l,E=o*s,w=o*l,t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=_*c+w,t[5]=a*u,t[9]=b*c-E,t[2]=E*c-b,t[6]=o*u,t[10]=w*c+_);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(b,e,E)},lookAt:function(e,t,r){var n=this.elements;return T.subVectors(e,t),0===T.lengthSq()&&(T.z=1),T.normalize(),w.crossVectors(r,T),0===w.lengthSq()&&(1===Math.abs(r.z)?T.x+=1e-4:T.z+=1e-4,T.normalize(),w.crossVectors(r,T)),w.normalize(),x.crossVectors(T,w),n[0]=w.x,n[4]=x.x,n[8]=T.x,n[1]=w.y,n[5]=x.y,n[9]=T.y,n[2]=w.z,n[6]=x.z,n[10]=T.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],f=r[2],p=r[6],m=r[10],g=r[14],v=r[3],y=r[7],_=r[11],b=r[15],E=n[0],w=n[4],x=n[8],T=n[12],M=n[1],S=n[5],A=n[9],R=n[13],k=n[2],P=n[6],L=n[10],C=n[14],I=n[3],H=n[7],O=n[11],D=n[15];return i[0]=a*E+o*M+s*k+l*I,i[4]=a*w+o*S+s*P+l*H,i[8]=a*x+o*A+s*L+l*O,i[12]=a*T+o*R+s*C+l*D,i[1]=u*E+c*M+h*k+d*I,i[5]=u*w+c*S+h*P+d*H,i[9]=u*x+c*A+h*L+d*O,i[13]=u*T+c*R+h*C+d*D,i[2]=f*E+p*M+m*k+g*I,i[6]=f*w+p*S+m*P+g*H,i[10]=f*x+p*A+m*L+g*O,i[14]=f*T+p*R+m*C+g*D,i[3]=v*E+y*M+_*k+b*I,i[7]=v*w+y*S+_*P+b*H,i[11]=v*x+y*A+_*L+b*O,i[15]=v*T+y*R+_*C+b*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*s*c-n*l*c-i*o*h+r*l*h+n*o*d-r*s*d)+e[7]*(+t*s*d-t*l*h+i*a*h-n*a*d+n*l*u-i*s*u)+e[11]*(+t*l*c-t*o*d-i*a*c+r*a*d+i*o*u-r*l*u)+e[15]*(-n*o*u-t*s*c+t*o*h+n*a*c-r*a*h+r*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],h=n[7],d=n[8],f=n[9],p=n[10],m=n[11],g=n[12],v=n[13],y=n[14],_=n[15],b=f*y*h-v*p*h+v*c*m-u*y*m-f*c*_+u*p*_,E=g*p*h-d*y*h-g*c*m+l*y*m+d*c*_-l*p*_,w=d*v*h-g*f*h+g*u*m-l*v*m-d*u*_+l*f*_,x=g*f*c-d*v*c-g*u*p+l*v*p+d*u*y-l*f*y,T=i*b+a*E+o*w+s*x;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var S=1/T;return r[0]=b*S,r[1]=(v*p*s-f*y*s-v*o*m+a*y*m+f*o*_-a*p*_)*S,r[2]=(u*y*s-v*c*s+v*o*h-a*y*h-u*o*_+a*c*_)*S,r[3]=(f*c*s-u*p*s-f*o*h+a*p*h+u*o*m-a*c*m)*S,r[4]=E*S,r[5]=(d*y*s-g*p*s+g*o*m-i*y*m-d*o*_+i*p*_)*S,r[6]=(g*c*s-l*y*s-g*o*h+i*y*h+l*o*_-i*c*_)*S,r[7]=(l*p*s-d*c*s+d*o*h-i*p*h-l*o*m+i*c*m)*S,r[8]=w*S,r[9]=(g*f*s-d*v*s-g*a*m+i*v*m+d*a*_-i*f*_)*S,r[10]=(l*v*s-g*u*s+g*a*h-i*v*h-l*a*_+i*u*_)*S,r[11]=(d*u*s-l*f*s-d*a*h+i*f*h+l*a*m-i*u*m)*S,r[12]=x*S,r[13]=(d*v*o-g*f*o+g*a*p-i*v*p-d*a*y+i*f*y)*S,r[14]=(g*u*o-l*v*o-g*a*c+i*v*c+l*a*y-i*u*y)*S,r[15]=(l*f*o-d*u*o+d*a*c-i*f*c-l*a*p+i*u*p)*S,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,u=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,u*o+r,u*s-n*a,0,l*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,u=a+a,c=o+o,h=i*l,d=i*u,f=i*c,p=a*u,m=a*c,g=o*c,v=s*l,y=s*u,_=s*c,b=r.x,E=r.y,w=r.z;return n[0]=(1-(p+g))*b,n[1]=(d+_)*b,n[2]=(f-y)*b,n[3]=0,n[4]=(d-_)*E,n[5]=(1-(h+g))*E,n[6]=(m+v)*E,n[7]=0,n[8]=(f+y)*w,n[9]=(m-v)*w,n[10]=(1-(h+p))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(e,t,r){var n=this.elements,i=y.set(n[0],n[1],n[2]).length(),a=y.set(n[4],n[5],n[6]).length(),o=y.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],_.copy(this);var s=1/i,l=1/a,u=1/o;return _.elements[0]*=s,_.elements[1]*=s,_.elements[2]*=s,_.elements[4]*=l,_.elements[5]*=l,_.elements[6]*=l,_.elements[8]*=u,_.elements[9]*=u,_.elements[10]*=u,t.setFromRotationMatrix(_),r.x=i,r.y=a,r.z=o,this},makePerspective:function(e,t,r,n,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(r-n),u=(t+e)/(t-e),c=(r+n)/(r-n),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),u=1/(a-i),c=(t+e)*s,h=(r+n)*l,d=(a+i)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var S=new M,A=new p;function R(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||R.DefaultOrder}function k(){this.mask=1}R.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],R.DefaultOrder="XYZ",Object.defineProperties(R.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(R.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=a.clamp,i=e.elements,o=i[0],s=i[4],l=i[8],u=i[1],c=i[5],h=i[9],d=i[2],f=i[6],p=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(f,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-d,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===t?(this._y=Math.asin(-n(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===t?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(l,p))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-h,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,r){return S.makeRotationFromQuaternion(e),this.setFromRotationMatrix(S,t,r)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return A.setFromEuler(this),this.setFromQuaternion(A,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new v(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(k.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var P=0,L=new v,C=new p,I=new M,H=new v,O=new v,D=new v,F=new p,N=new v(1,0,0),U=new v(0,1,0),B=new v(0,0,1),z={type:"added"},j={type:"removed"};function V(){Object.defineProperty(this,"id",{value:P++}),this.uuid=a.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=V.DefaultUp.clone();var e=new v,t=new R,r=new p,n=new v(1,1,1);t._onChange((function(){r.setFromEuler(t,!1)})),r._onChange((function(){t.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new M},normalMatrix:{value:new s}}),this.matrix=new M,this.matrixWorld=new M,this.matrixAutoUpdate=V.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new k,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function G(){V.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}V.DefaultUp=new v(0,1,0),V.DefaultMatrixAutoUpdate=!0,V.prototype=Object.assign(Object.create(t.prototype),{constructor:V,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return C.setFromAxisAngle(e,t),this.quaternion.multiply(C),this},rotateOnWorldAxis:function(e,t){return C.setFromAxisAngle(e,t),this.quaternion.premultiply(C),this},rotateX:function(e){return this.rotateOnAxis(N,e)},rotateY:function(e){return this.rotateOnAxis(U,e)},rotateZ:function(e){return this.rotateOnAxis(B,e)},translateOnAxis:function(e,t){return L.copy(e).applyQuaternion(this.quaternion),this.position.add(L.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(N,e)},translateY:function(e){return this.translateOnAxis(U,e)},translateZ:function(e){return this.translateOnAxis(B,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(I.getInverse(this.matrixWorld))},lookAt:function(e,t,r){e.isVector3?H.copy(e):H.set(e,t,r);var n=this.parent;this.updateWorldMatrix(!0,!1),O.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?I.lookAt(O,H,this.up):I.lookAt(H,O,this.up),this.quaternion.setFromRotationMatrix(I),n&&(I.extractRotation(n.matrixWorld),C.setFromRotationMatrix(I),this.quaternion.premultiply(C.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(z)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent(j)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),I.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),I.multiply(e.parent.matrixWorld)),e.applyMatrix4(I),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new v),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new p),this.updateMatrixWorld(!0),this.matrixWorld.decompose(O,e,D),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new v),this.updateMatrixWorld(!0),this.matrixWorld.decompose(O,F,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new v),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,i=0,a=n.length;i<a;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];i(e.shapes,u)}else i(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(i(e.materials,this.material[s]));n.material=c}else n.material=i(e.materials,this.material);if(this.children.length>0)for(n.children=[],s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(e).object);if(t){var h=m(e.geometries),d=m(e.materials),f=m(e.textures),p=m(e.images);o=m(e.shapes),h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),f.length>0&&(r.textures=f),p.length>0&&(r.images=p),o.length>0&&(r.shapes=o)}return r.object=n,r;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}}),G.prototype=Object.assign(Object.create(V.prototype),{constructor:G,isScene:!0,copy:function(e,t){return V.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=V.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var W=[new v,new v,new v,new v,new v,new v,new v,new v],X=new v,Y=new ie,q=new v,Z=new v,K=new v,Q=new v,J=new v,$=new v,ee=new v,te=new v,re=new v,ne=new v;function ie(e,t){this.min=void 0!==e?e:new v(1/0,1/0,1/0),this.max=void 0!==t?t:new v(-1/0,-1/0,-1/0)}function ae(e,t,r,n,i){var a,o;for(a=0,o=e.length-3;a<=o;a+=3){ne.fromArray(e,a);var s=i.x*Math.abs(ne.x)+i.y*Math.abs(ne.y)+i.z*Math.abs(ne.z),l=t.dot(ne),u=r.dot(ne),c=n.dot(ne);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}Object.assign(ie.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<r&&(r=c),h<n&&(n=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<r&&(r=c),h<n&&(n=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=X.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new v),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new v),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Y.copy(t.boundingBox),Y.applyMatrix4(e.matrixWorld),this.union(Y));for(var r=e.children,n=0,i=r.length;n<i;n++)this.expandByObject(r[n]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new v),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,X),X.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(ee),te.subVectors(this.max,ee),q.subVectors(e.a,ee),Z.subVectors(e.b,ee),K.subVectors(e.c,ee),Q.subVectors(Z,q),J.subVectors(K,Z),$.subVectors(q,K);var t=[0,-Q.z,Q.y,0,-J.z,J.y,0,-$.z,$.y,Q.z,0,-Q.x,J.z,0,-J.x,$.z,0,-$.x,-Q.y,Q.x,0,-J.y,J.x,0,-$.y,$.x,0];return!!ae(t,q,Z,K,te)&&!!ae(t=[1,0,0,0,1,0,0,0,1],q,Z,K,te)&&(re.crossVectors(Q,J),ae(t=[re.x,re.y,re.z],q,Z,K,te))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new v),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return X.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(X).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(W[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),W[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),W[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),W[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),W[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),W[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),W[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),W[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(W)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var oe=new ie;function se(e,t){this.center=void 0!==e?e:new v,this.radius=void 0!==t?t:0}Object.assign(se.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var r=this.center;void 0!==t?r.copy(t):oe.setFromPoints(e).getCenter(r);for(var n=0,i=0,a=e.length;i<a;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new v),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new ie),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var le=new v,ue=new v,ce=new v,he=new v,de=new v,fe=new v,pe=new v;function me(e,t){this.origin=void 0!==e?e:new v,this.direction=void 0!==t?t:new v(0,0,-1)}Object.assign(me.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new v),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,le)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new v),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=le.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(le.copy(this.direction).multiplyScalar(t).add(this.origin),le.distanceToSquared(e))},distanceSqToSegment:function(e,t,r,n){ue.copy(e).add(t).multiplyScalar(.5),ce.copy(t).sub(e).normalize(),he.copy(this.origin).sub(ue);var i,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(ce),c=he.dot(this.direction),h=-he.dot(ce),d=he.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(a=u*c-h,s=l*f,(i=u*h-c)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(i*=p)*(i+u*(a*=p)+2*c)+a*(u*i+a+2*h)+d}else a=l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+d;else a=-l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+d;else a<=-s?o=-(i=Math.max(0,-(-u*l+c)))*i+(a=i>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d:a<=s?(i=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):o=-(i=Math.max(0,-(u*l+c)))*i+(a=i>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d;else a=u>0?-l:l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+d;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(ce).multiplyScalar(a).add(ue),o},intersectSphere:function(e,t){le.subVectors(e.center,this.origin);var r=le.dot(this.direction),n=le.dot(le)-r*r,i=e.radius*e.radius;if(n>i)return null;var a=Math.sqrt(i-n),o=r-a,s=r+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,n,i,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,le)},intersectTriangle:function(e,t,r,n,i){de.subVectors(t,e),fe.subVectors(r,e),pe.crossVectors(de,fe);var a,o=this.direction.dot(pe);if(o>0){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}he.subVectors(this.origin,e);var s=a*this.direction.dot(fe.crossVectors(he,fe));if(s<0)return null;var l=a*this.direction.dot(de.cross(he));if(l<0)return null;if(s+l>o)return null;var u=-a*he.dot(pe);return u<0?null:this.at(u/o,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var ge=new v,ve=new v,ye=new s;function _e(e,t){this.normal=void 0!==e?e:new v(1,0,0),this.constant=void 0!==t?t:0}Object.assign(_e.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,r){var n=ge.subVectors(r,t).cross(ve.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new v),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new v);var r=e.delta(ge),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||i>1?void 0:t.copy(r).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new v),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var r=t||ye.getNormalMatrix(e),n=this.coplanarPoint(ge).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var be=new v,Ee=new v,we=new v,xe=new v,Te=new v,Me=new v,Se=new v,Ae=new v,Re=new v,ke=new v;function Pe(e,t,r){this.a=void 0!==e?e:new v,this.b=void 0!==t?t:new v,this.c=void 0!==r?r:new v}Object.assign(Pe,{getNormal:function(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new v),n.subVectors(r,t),be.subVectors(e,t),n.cross(be);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)},getBarycoord:function(e,t,r,n,i){be.subVectors(n,t),Ee.subVectors(r,t),we.subVectors(e,t);var a=be.dot(be),o=be.dot(Ee),s=be.dot(we),l=Ee.dot(Ee),u=Ee.dot(we),c=a*l-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new v),0===c)return i.set(-2,-1,-1);var h=1/c,d=(l*s-o*u)*h,f=(a*u-o*s)*h;return i.set(1-d-f,f,d)},containsPoint:function(e,t,r,n){return Pe.getBarycoord(e,t,r,n,xe),xe.x>=0&&xe.y>=0&&xe.x+xe.y<=1},getUV:function(e,t,r,n,i,a,o,s){return this.getBarycoord(e,t,r,n,xe),s.set(0,0),s.addScaledVector(i,xe.x),s.addScaledVector(a,xe.y),s.addScaledVector(o,xe.z),s},isFrontFacing:function(e,t,r,n){return be.subVectors(r,t),Ee.subVectors(e,t),be.cross(Ee).dot(n)<0}}),Object.assign(Pe.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return be.subVectors(this.c,this.b),Ee.subVectors(this.a,this.b),.5*be.cross(Ee).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new v),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Pe.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new _e),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Pe.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,n,i){return Pe.getUV(e,this.a,this.b,this.c,t,r,n,i)},containsPoint:function(e){return Pe.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Pe.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new v);var r,n,i=this.a,a=this.b,o=this.c;Te.subVectors(a,i),Me.subVectors(o,i),Ae.subVectors(e,i);var s=Te.dot(Ae),l=Me.dot(Ae);if(s<=0&&l<=0)return t.copy(i);Re.subVectors(e,a);var u=Te.dot(Re),c=Me.dot(Re);if(u>=0&&c<=u)return t.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return r=s/(s-u),t.copy(i).addScaledVector(Te,r);ke.subVectors(e,o);var d=Te.dot(ke),f=Me.dot(ke);if(f>=0&&d<=f)return t.copy(o);var p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return n=l/(l-f),t.copy(i).addScaledVector(Me,n);var m=u*f-d*c;if(m<=0&&c-u>=0&&d-f>=0)return Se.subVectors(o,a),n=(c-u)/(c-u+(d-f)),t.copy(a).addScaledVector(Se,n);var g=1/(m+p+h);return r=p*g,n=h*g,t.copy(i).addScaledVector(Te,r).addScaledVector(Me,n)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Le={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ce={h:0,s:0,l:0},Ie={h:0,s:0,l:0};function He(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function Oe(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function De(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Fe(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function Ne(e,t,r,n,i,a){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new v,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new He,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}Object.assign(He.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=a.euclideanModulo(e,1),t=a.clamp(t,0,1),r=a.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=Oe(i,n,e+1/3),this.g=Oe(i,n,e),this.b=Oe(i,n,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=r[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=Le[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=De(e.r),this.g=De(e.g),this.b=De(e.b),this},copyLinearToSRGB:function(e){return this.r=Fe(e.r),this.g=Fe(e.g),this.b=Fe(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),l=(s+o)/2;if(s===o)t=0,r=0;else{var u=o-s;switch(r=l<=.5?u/(o+s):u/(2-o-s),o){case n:t=(i-a)/u+(i<a?6:0);break;case i:t=(a-n)/u+2;break;case a:t=(n-i)/u+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){return this.getHSL(Ce),Ce.h+=e,Ce.s+=t,Ce.l+=r,this.setHSL(Ce.h,Ce.s,Ce.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Ce),e.getHSL(Ie);var r=a.lerp(Ce.h,Ie.h,t),n=a.lerp(Ce.s,Ie.s,t),i=a.lerp(Ce.l,Ie.l,t);return this.setHSL(r,n,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),He.NAMES=Le,Object.assign(Ne.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Ue=0;function Be(){Object.defineProperty(this,"id",{value:Ue++}),this.uuid=a.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function ze(e){Be.call(this),this.type="MeshBasicMaterial",this.color=new He(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Be.prototype=Object.assign(Object.create(t.prototype),{constructor:Be,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),0!==this.side&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),a=n(e.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Be.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),ze.prototype=Object.create(Be.prototype),ze.prototype.constructor=ze,ze.prototype.isMeshBasicMaterial=!0,ze.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var je=new v;function Ve(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Ge(e,t,r){Ve.call(this,new Int8Array(e),t,r)}function We(e,t,r){Ve.call(this,new Uint8Array(e),t,r)}function Xe(e,t,r){Ve.call(this,new Uint8ClampedArray(e),t,r)}function Ye(e,t,r){Ve.call(this,new Int16Array(e),t,r)}function qe(e,t,r){Ve.call(this,new Uint16Array(e),t,r)}function Ze(e,t,r){Ve.call(this,new Int32Array(e),t,r)}function Ke(e,t,r){Ve.call(this,new Uint32Array(e),t,r)}function Qe(e,t,r){Ve.call(this,new Float32Array(e),t,r)}function Je(e,t,r){Ve.call(this,new Float64Array(e),t,r)}function $e(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function et(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}Object.defineProperty(Ve.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ve.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new He),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new o),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new v),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new h),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},applyMatrix3:function(e){for(var t=0,r=this.count;t<r;t++)je.x=this.getX(t),je.y=this.getY(t),je.z=this.getZ(t),je.applyMatrix3(e),this.setXYZ(t,je.x,je.y,je.z);return this},applyMatrix4:function(e){for(var t=0,r=this.count;t<r;t++)je.x=this.getX(t),je.y=this.getY(t),je.z=this.getZ(t),je.applyMatrix4(e),this.setXYZ(t,je.x,je.y,je.z);return this},applyNormalMatrix:function(e){for(var t=0,r=this.count;t<r;t++)je.x=this.getX(t),je.y=this.getY(t),je.z=this.getZ(t),je.applyNormalMatrix(e),this.setXYZ(t,je.x,je.y,je.z);return this},transformDirection:function(e){for(var t=0,r=this.count;t<r;t++)je.x=this.getX(t),je.y=this.getY(t),je.z=this.getZ(t),je.transformDirection(e),this.setXYZ(t,je.x,je.y,je.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Ge.prototype=Object.create(Ve.prototype),Ge.prototype.constructor=Ge,We.prototype=Object.create(Ve.prototype),We.prototype.constructor=We,Xe.prototype=Object.create(Ve.prototype),Xe.prototype.constructor=Xe,Ye.prototype=Object.create(Ve.prototype),Ye.prototype.constructor=Ye,qe.prototype=Object.create(Ve.prototype),qe.prototype.constructor=qe,Ze.prototype=Object.create(Ve.prototype),Ze.prototype.constructor=Ze,Ke.prototype=Object.create(Ve.prototype),Ke.prototype.constructor=Ke,Qe.prototype=Object.create(Ve.prototype),Qe.prototype.constructor=Qe,Je.prototype=Object.create(Ve.prototype),Je.prototype.constructor=Je,Object.assign($e.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,r.push(t)),t={start:3*a,materialIndex:n})}void 0!==t&&(t.count=3*a-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,l=e.morphTargets,u=l.length;if(u>0){t=[];for(var c=0;c<u;c++)t[c]={name:l[c].name,data:[]};this.morphTargets.position=t}var h,d=e.morphNormals,f=d.length;if(f>0){for(h=[],c=0;c<f;c++)h[c]={name:d[c].name,data:[]};this.morphTargets.normal=h}var p=e.skinIndices,m=e.skinWeights,g=p.length===n.length,v=m.length===n.length;for(n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),c=0;c<r.length;c++){var y=r[c];this.vertices.push(n[y.a],n[y.b],n[y.c]);var _=y.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var b=y.normal;this.normals.push(b,b,b)}var E,w=y.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var x=y.color;this.colors.push(x,x,x)}!0===a&&(void 0!==(E=i[0][c])?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new o,new o,new o))),!0===s&&(void 0!==(E=i[1][c])?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new o,new o,new o)));for(var T=0;T<u;T++){var M=l[T].vertices;t[T].data.push(M[y.a],M[y.b],M[y.c])}for(T=0;T<f;T++){var S=d[T].vertexNormals[c];h[T].data.push(S.a,S.b,S.c)}g&&this.skinIndices.push(p[y.a],p[y.b],p[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var tt=1,rt=new M,nt=new V,it=new v,at=new ie,ot=new ie,st=new v;function lt(){Object.defineProperty(this,"id",{value:tt+=2}),this.uuid=a.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}lt.prototype=Object.assign(Object.create(t.prototype),{constructor:lt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(et(e)>65535?Ke:qe)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new s).getNormalMatrix(e);r.applyNormalMatrix(n),r.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return rt.makeRotationX(e),this.applyMatrix4(rt),this},rotateY:function(e){return rt.makeRotationY(e),this.applyMatrix4(rt),this},rotateZ:function(e){return rt.makeRotationZ(e),this.applyMatrix4(rt),this},translate:function(e,t,r){return rt.makeTranslation(e,t,r),this.applyMatrix4(rt),this},scale:function(e,t,r){return rt.makeScale(e,t,r),this.applyMatrix4(rt),this},lookAt:function(e){return nt.lookAt(e),nt.updateMatrix(),this.applyMatrix4(nt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(it).negate(),this.translate(it.x,it.y,it.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new Qe(3*t.vertices.length,3),n=new Qe(3*t.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Qe(t.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Qe(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new $e).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Ve(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Ve(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.setAttribute("color",new Ve(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Ve(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Ve(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],u=0,c=l.length;u<c;u++){var h=l[u],d=new Qe(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var f=new Qe(4*e.skinIndices.length,4);this.setAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new Qe(4*e.skinWeights.length,4);this.setAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ie);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){var i=t[r];at.setFromBufferAttribute(i),this.morphTargetsRelative?(st.addVectors(this.boundingBox.min,at.min),this.boundingBox.expandByPoint(st),st.addVectors(this.boundingBox.max,at.max),this.boundingBox.expandByPoint(st)):(this.boundingBox.expandByPoint(at.min),this.boundingBox.expandByPoint(at.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new se);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var r=this.boundingSphere.center;if(at.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var a=t[n];ot.setFromBufferAttribute(a),this.morphTargetsRelative?(st.addVectors(at.min,ot.min),at.expandByPoint(st),st.addVectors(at.max,ot.max),at.expandByPoint(st)):(at.expandByPoint(ot.min),at.expandByPoint(ot.max))}at.getCenter(r);var o=0;for(n=0,i=e.count;n<i;n++)st.fromBufferAttribute(e,n),o=Math.max(o,r.distanceToSquared(st));if(t)for(n=0,i=t.length;n<i;n++){a=t[n];for(var s=this.morphTargetsRelative,l=0,u=a.count;l<u;l++)st.fromBufferAttribute(a,l),s&&(it.fromBufferAttribute(e,l),st.add(it)),o=Math.max(o,r.distanceToSquared(st))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new Ve(new Float32Array(r.length),3));else for(var n=t.normal.array,i=0,a=n.length;i<a;i++)n[i]=0;var o,s,l,u=t.normal.array,c=new v,h=new v,d=new v,f=new v,p=new v;if(e){var m=e.array;for(i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],c.fromArray(r,o),h.fromArray(r,s),d.fromArray(r,l),f.subVectors(d,h),p.subVectors(c,h),f.cross(p),u[o]+=f.x,u[o+1]+=f.y,u[o+2]+=f.z,u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z}else for(i=0,a=r.length;i<a;i+=9)c.fromArray(r,i),h.fromArray(r,i+3),d.fromArray(r,i+6),f.subVectors(d,h),p.subVectors(c,h),f.cross(p),u[i]=f.x,u[i+1]=f.y,u[i+2]=f.z,u[i+3]=f.x,u[i+4]=f.y,u[i+5]=f.z,u[i+6]=f.x,u[i+7]=f.y,u[i+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n].array,a=e.attributes[n],o=a.array,s=a.itemSize*t,l=Math.min(o.length,i.length-s),u=0,c=s;u<l;u++,c++)i[c]=o[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)st.x=e.getX(t),st.y=e.getY(t),st.z=e.getZ(t),st.normalize(),e.setXYZ(t,st.x,st.y,st.z)},toNonIndexed:function(){function e(e,t){for(var r=e.array,n=e.itemSize,i=new r.constructor(t.length*n),a=0,o=0,s=0,l=t.length;s<l;s++){a=t[s]*n;for(var u=0;u<n;u++)i[o++]=r[a++]}return new Ve(i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new lt,r=this.index.array,n=this.attributes;for(var i in n){var a=e(n[i],r);t.setAttribute(i,a)}var o=this.morphAttributes;for(i in o){for(var s=[],l=o[i],u=0,c=l.length;u<c;u++)a=e(l[u],r),s.push(a);t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,d=(u=0,h.length);u<d;u++){var f=h[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var a=(d=i[r]).toJSON();""!==d.name&&(a.name=d.name),e.data.attributes[r]=a}var o={},s=!1;for(var r in this.morphAttributes){for(var l=this.morphAttributes[r],u=[],c=0,h=l.length;c<h;c++){var d;a=(d=l[c]).toJSON(),""!==d.name&&(a.name=d.name),u.push(a)}u.length>0&&(o[r]=u,s=!0)}s&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);var f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));var p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e},clone:function(){return(new lt).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var a=e.attributes;for(t in a){var o=a[t];this.setAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[],u=s[t];for(r=0,n=u.length;r<n;r++)l.push(u[r].clone());this.morphAttributes[t]=l}this.morphTargetsRelative=e.morphTargetsRelative;var c=e.groups;for(r=0,n=c.length;r<n;r++){var h=c[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ut=new M,ct=new me,ht=new se,dt=new v,ft=new v,pt=new v,mt=new v,gt=new v,vt=new v,yt=new v,_t=new v,bt=new v,Et=new o,wt=new o,xt=new o,Tt=new v,Mt=new v;function St(e,t){V.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new lt,this.material=void 0!==t?t:new ze,this.updateMorphTargets()}function At(e,t,r,n,i,a,o,s){if(null===(1===t.side?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,2!==t.side,s)))return null;Mt.copy(s),Mt.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(Mt);return l<r.near||l>r.far?null:{distance:l,point:Mt.clone(),object:e}}function Rt(e,t,r,n,i,a,s,l,u,c,h,d){dt.fromBufferAttribute(i,c),ft.fromBufferAttribute(i,h),pt.fromBufferAttribute(i,d);var f=e.morphTargetInfluences;if(t.morphTargets&&a&&f){yt.set(0,0,0),_t.set(0,0,0),bt.set(0,0,0);for(var p=0,m=a.length;p<m;p++){var g=f[p],v=a[p];0!==g&&(mt.fromBufferAttribute(v,c),gt.fromBufferAttribute(v,h),vt.fromBufferAttribute(v,d),s?(yt.addScaledVector(mt,g),_t.addScaledVector(gt,g),bt.addScaledVector(vt,g)):(yt.addScaledVector(mt.sub(dt),g),_t.addScaledVector(gt.sub(ft),g),bt.addScaledVector(vt.sub(pt),g)))}dt.add(yt),ft.add(_t),pt.add(bt)}var y=At(e,t,r,n,dt,ft,pt,Tt);if(y){l&&(Et.fromBufferAttribute(l,c),wt.fromBufferAttribute(l,h),xt.fromBufferAttribute(l,d),y.uv=Pe.getUV(Tt,dt,ft,pt,Et,wt,xt,new o)),u&&(Et.fromBufferAttribute(u,c),wt.fromBufferAttribute(u,h),xt.fromBufferAttribute(u,d),y.uv2=Pe.getUV(Tt,dt,ft,pt,Et,wt,xt,new o));var _=new Ne(c,h,d);Pe.getNormal(dt,ft,pt,_.normal),y.face=_}return y}St.prototype=Object.assign(Object.create(V.prototype),{constructor:St,isMesh:!0,copy:function(e){return V.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var r,n=this.geometry,i=this.material,a=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),ht.copy(n.boundingSphere),ht.applyMatrix4(a),!1!==e.ray.intersectsSphere(ht)&&(ut.getInverse(a),ct.copy(e.ray).applyMatrix4(ut),null===n.boundingBox||!1!==ct.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var s,l,u,c,h,d,f,p,m,g=n.index,v=n.attributes.position,y=n.morphAttributes.position,_=n.morphTargetsRelative,b=n.attributes.uv,E=n.attributes.uv2,w=n.groups,x=n.drawRange;if(null!==g)if(Array.isArray(i))for(c=0,d=w.length;c<d;c++)for(m=i[(p=w[c]).materialIndex],h=Math.max(p.start,x.start),f=Math.min(p.start+p.count,x.start+x.count);h<f;h+=3)s=g.getX(h),l=g.getX(h+1),u=g.getX(h+2),(r=Rt(this,m,e,ct,v,y,_,b,E,s,l,u))&&(r.faceIndex=Math.floor(h/3),r.face.materialIndex=p.materialIndex,t.push(r));else for(c=Math.max(0,x.start),d=Math.min(g.count,x.start+x.count);c<d;c+=3)s=g.getX(c),l=g.getX(c+1),u=g.getX(c+2),(r=Rt(this,i,e,ct,v,y,_,b,E,s,l,u))&&(r.faceIndex=Math.floor(c/3),t.push(r));else if(void 0!==v)if(Array.isArray(i))for(c=0,d=w.length;c<d;c++)for(m=i[(p=w[c]).materialIndex],h=Math.max(p.start,x.start),f=Math.min(p.start+p.count,x.start+x.count);h<f;h+=3)(r=Rt(this,m,e,ct,v,y,_,b,E,s=h,l=h+1,u=h+2))&&(r.faceIndex=Math.floor(h/3),r.face.materialIndex=p.materialIndex,t.push(r));else for(c=Math.max(0,x.start),d=Math.min(v.count,x.start+x.count);c<d;c+=3)(r=Rt(this,i,e,ct,v,y,_,b,E,s=c,l=c+1,u=c+2))&&(r.faceIndex=Math.floor(c/3),t.push(r))}else if(n.isGeometry){var T,M,S,A,R=Array.isArray(i),k=n.vertices,P=n.faces,L=n.faceVertexUvs[0];L.length>0&&(A=L);for(var C=0,I=P.length;C<I;C++){var H=P[C],O=R?i[H.materialIndex]:i;if(void 0!==O&&(T=k[H.a],M=k[H.b],S=k[H.c],r=At(this,O,e,ct,T,M,S,Tt))){if(A&&A[C]){var D=A[C];Et.copy(D[0]),wt.copy(D[1]),xt.copy(D[2]),r.uv=Pe.getUV(Tt,T,M,S,Et,wt,xt,new o)}r.face=H,r.faceIndex=C,t.push(r)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var kt=0,Pt=new M,Lt=new V,Ct=new v;function It(){Object.defineProperty(this,"id",{value:kt+=2}),this.uuid=a.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}It.prototype=Object.assign(Object.create(t.prototype),{constructor:It,isGeometry:!0,applyMatrix4:function(e){for(var t=(new s).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(e);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(t).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Pt.makeRotationX(e),this.applyMatrix4(Pt),this},rotateY:function(e){return Pt.makeRotationY(e),this.applyMatrix4(Pt),this},rotateZ:function(e){return Pt.makeRotationZ(e),this.applyMatrix4(Pt),this},translate:function(e,t,r){return Pt.makeTranslation(e,t,r),this.applyMatrix4(Pt),this},scale:function(e,t,r){return Pt.makeScale(e,t,r),this.applyMatrix4(Pt),this},lookAt:function(e){return Lt.lookAt(e),Lt.updateMatrix(),this.applyMatrix4(Lt.matrix),this},fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,l=void 0!==n.uv?n.uv.array:void 0,u=void 0!==n.uv2?n.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.length;c+=3)t.vertices.push((new v).fromArray(i,c)),void 0!==s&&t.colors.push((new He).fromArray(s,c));function h(e,r,n,i){var c=void 0===s?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],h=new Ne(e,r,n,void 0===a?[]:[(new v).fromArray(a,3*e),(new v).fromArray(a,3*r),(new v).fromArray(a,3*n)],c,i);t.faces.push(h),void 0!==l&&t.faceVertexUvs[0].push([(new o).fromArray(l,2*e),(new o).fromArray(l,2*r),(new o).fromArray(l,2*n)]),void 0!==u&&t.faceVertexUvs[1].push([(new o).fromArray(u,2*e),(new o).fromArray(u,2*r),(new o).fromArray(u,2*n)])}var d=e.groups;if(d.length>0)for(c=0;c<d.length;c++)for(var f=d[c],p=f.start,m=p,g=p+f.count;m<g;m+=3)void 0!==r?h(r[m],r[m+1],r[m+2],f.materialIndex):h(m,m+1,m+2,f.materialIndex);else if(void 0!==r)for(c=0;c<r.length;c+=3)h(r[c],r[c+1],r[c+2]);else for(c=0;c<i.length/3;c+=3)h(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ct).negate(),this.translate(Ct.x,Ct.y,Ct.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new M;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){for(var e=new v,t=new v,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)o[t]=new v;if(e){var s,l,u,c=new v,h=new v;for(n=0,i=this.faces.length;n<i;n++)a=this.faces[n],s=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],c.subVectors(u,l),h.subVectors(s,l),c.cross(h),o[a.a].add(c),o[a.b].add(c),o[a.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)o[(a=this.faces[n]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)o[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var d=(a=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var a=new It;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new v,u={a:new v,b:new v,c:new v},o.push(l),s.push(u)}var l,u,c=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=c.faceNormals[r],u=c.vertexNormals[r],l.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ie),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new se),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=e.vertices,l=this.faces,u=e.faces,c=this.colors,h=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new s).getNormalMatrix(t));for(var d=0,f=o.length;d<f;d++){var p=o[d].clone();void 0!==t&&p.applyMatrix4(t),a.push(p)}for(d=0,f=h.length;d<f;d++)c.push(h[d].clone());for(d=0,f=u.length;d<f;d++){var m,g,v,y=u[d],_=y.vertexNormals,b=y.vertexColors;(m=new Ne(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==n&&m.normal.applyMatrix3(n).normalize();for(var E=0,w=_.length;E<w;E++)g=_[E].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),m.vertexNormals.push(g);for(m.color.copy(y.color),E=0,w=b.length;E<w;E++)v=b[E],m.vertexColors.push(v.clone());m.materialIndex=y.materialIndex+r,l.push(m)}for(d=0,f=e.faceVertexUvs.length;d<f;d++){var x=e.faceVertexUvs[d];for(void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]),E=0,w=x.length;E<w;E++){for(var T=x[E],M=[],S=0,A=T.length;S<A;S++)M.push(T[S].clone());this.faceVertexUvs[d].push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,a,o,s,l={},u=[],c=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=r,u.push(this.vertices[r]),c[r]=u.length-1):c[r]=c[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],a=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var p=d[r];for(this.faces.splice(p,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(p,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new v(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];for(a&&a.length===t&&(n=[]),o&&o.length===t&&(i=[]),r=0;r<t;r++){var s=e[r]._id;n&&n.push(a[s]),i&&i.push(o[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}var o=[],s=[],l={},u=[],c={},h=[],d={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,g=f.vertexNormals.length>0,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,_=0;if(_=x(_,0,0),_=x(_,1,!0),_=x(_,2,!1),_=x(_,3,p),_=x(_,4,m),_=x(_,5,g),_=x(_,6,v),_=x(_,7,y),o.push(_),o.push(f.a,f.b,f.c),o.push(f.materialIndex),p){var b=this.faceVertexUvs[0][i];o.push(S(b[0]),S(b[1]),S(b[2]))}if(m&&o.push(T(f.normal)),g){var E=f.vertexNormals;o.push(T(E[0]),T(E[1]),T(E[2]))}if(v&&o.push(M(f.color)),y){var w=f.vertexColors;o.push(M(w[0]),M(w[1]),M(w[2]))}}function x(e,t,r){return r?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function S(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=n,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new It).copy(this)},copy:function(e){var t,r,n,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var u=e.faces;for(t=0,r=u.length;t<r;t++)this.faces.push(u[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=c.length;n<i;n++){var h=c[n],d=[];for(a=0,o=h.length;a<o;a++){var f=h[a];d.push(f.clone())}this.faceVertexUvs[t].push(d)}}var p=e.morphTargets;for(t=0,r=p.length;t<r;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],n=0,i=p[t].vertices.length;n<i;n++)m.vertices.push(p[t].vertices[n].clone());if(void 0!==p[t].normals)for(m.normals=[],n=0,i=p[t].normals.length;n<i;n++)m.normals.push(p[t].normals[n].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,r=g.length;t<r;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],n=0,i=g[t].vertexNormals.length;n<i;n++){var y=g[t].vertexNormals[n],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),v.vertexNormals.push(_)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],n=0,i=g[t].faceNormals.length;n<i;n++)v.faceNormals.push(g[t].faceNormals[n].clone());this.morphNormals.push(v)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var E=e.skinIndices;for(t=0,r=E.length;t<r;t++)this.skinIndices.push(E[t].clone());var w=e.lineDistances;for(t=0,r=w.length;t<r;t++)this.lineDistances.push(w[t]);var x=e.boundingBox;null!==x&&(this.boundingBox=x.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ht=function(e){function t(t,r,n,i,a,o){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:i,heightSegments:a,depthSegments:o},this.fromBufferGeometry(new Ot(t,r,n,i,a,o)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ot=function(e){function t(t,r,n,i,a,o){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:i,heightSegments:a,depthSegments:o};var s=this;t=t||1,r=r||1,n=n||1,i=Math.floor(i)||1,a=Math.floor(a)||1,o=Math.floor(o)||1;var l=[],u=[],c=[],h=[],d=0,f=0;function p(e,t,r,n,i,a,o,p,m,g,y){var _,b,E=a/m,w=o/g,x=a/2,T=o/2,M=p/2,S=m+1,A=g+1,R=0,k=0,P=new v;for(b=0;b<A;b++){var L=b*w-T;for(_=0;_<S;_++){var C=_*E-x;P[e]=C*n,P[t]=L*i,P[r]=M,u.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[r]=p>0?1:-1,c.push(P.x,P.y,P.z),h.push(_/m),h.push(1-b/g),R+=1}}for(b=0;b<g;b++)for(_=0;_<m;_++){var I=d+_+S*b,H=d+_+S*(b+1),O=d+(_+1)+S*(b+1),D=d+(_+1)+S*b;l.push(I,H,D),l.push(H,O,D),k+=6}s.addGroup(f,k,y),f+=k,d+=R}p("z","y","x",-1,-1,n,r,t,o,a,0),p("z","y","x",1,-1,n,r,-t,o,a,1),p("x","z","y",1,1,t,n,r,i,o,2),p("x","z","y",1,-1,t,n,-r,i,o,3),p("x","y","z",1,-1,t,r,n,i,a,4),p("x","y","z",-1,-1,t,r,-n,i,a,5),this.setIndex(l),this.setAttribute("position",new Qe(u,3)),this.setAttribute("normal",new Qe(c,3)),this.setAttribute("uv",new Qe(h,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(lt);function Dt(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}function Ft(e){for(var t={},r=0;r<e.length;r++){var n=Dt(e[r]);for(var i in n)t[i]=n[i]}return t}var Nt={clone:Dt,merge:Ft};function Ut(e){Be.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Bt(){V.call(this),this.type="Camera",this.matrixWorldInverse=new M,this.projectionMatrix=new M,this.projectionMatrixInverse=new M}function zt(e,t,r,n){Bt.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function jt(e,t,r,n){V.call(this),this.type="CubeCamera";var i=new zt(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new v(1,0,0)),this.add(i);var a=new zt(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new v(-1,0,0)),this.add(a);var o=new zt(90,1,e,t);o.up.set(0,0,1),o.lookAt(new v(0,1,0)),this.add(o);var s=new zt(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new v(0,-1,0)),this.add(s);var l=new zt(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new v(0,0,1)),this.add(l);var u=new zt(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new v(0,0,-1)),this.add(u),n=n||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new Vt(r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),n=this.renderTarget,c=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=c,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(r)},this.clear=function(e,t,r,n){for(var i=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,r,n);e.setRenderTarget(i)}}function Vt(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),d.call(this,e,e,t)}function Gt(e,t,r,n,i,a,o,s,l,u,h,d){c.call(this,null,a,o,s,l,u,n,i,h,d),this.image={data:e||null,width:t||1,height:r||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==u?u:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Ut.prototype=Object.create(Be.prototype),Ut.prototype.constructor=Ut,Ut.prototype.isShaderMaterial=!0,Ut.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Dt(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Ut.prototype.toJSON=function(e){var t=Be.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var a in this.extensions)!0===this.extensions[a]&&(i[a]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},Bt.prototype=Object.assign(Object.create(V.prototype),{constructor:Bt,isCamera:!0,copy:function(e,t){return V.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new v),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){V.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){V.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),zt.prototype=Object.assign(Object.create(Bt.prototype),{constructor:zt,isPerspectiveCamera:!0,copy:function(e,t){return Bt.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*a.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*a.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*a.RAD2DEG*Math.atan(Math.tan(.5*a.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*a.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,l=o.fullHeight;i+=o.offsetX*n/s,t-=o.offsetY*r/l,n*=o.width/s,r*=o.height/l}var u=this.filmOffset;0!==u&&(i+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=V.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),jt.prototype=Object.create(V.prototype),jt.prototype.constructor=jt,Vt.prototype=Object.create(d.prototype),Vt.prototype.constructor=Vt,Vt.prototype.isWebGLCubeRenderTarget=!0,Vt.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new G,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new Ut({type:"CubemapFromEquirect",uniforms:Dt(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;var a=new St(new Ot(5,5,5),i);r.add(a);var o=new jt(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(e,r),a.geometry.dispose(),a.material.dispose(),this},Gt.prototype=Object.create(c.prototype),Gt.prototype.constructor=Gt,Gt.prototype.isDataTexture=!0;var Wt=new se,Xt=new v;function Yt(e,t,r,n,i,a){this.planes=[void 0!==e?e:new _e,void 0!==t?t:new _e,void 0!==r?r:new _e,void 0!==n?n:new _e,void 0!==i?i:new _e,void 0!==a?a:new _e]}Object.assign(Yt.prototype,{set:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromProjectionMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],f=r[10],p=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(o-n,c-s,p-h,y-m).normalize(),t[1].setComponents(o+n,c+s,p+h,y+m).normalize(),t[2].setComponents(o+i,c+l,p+d,y+g).normalize(),t[3].setComponents(o-i,c-l,p-d,y-g).normalize(),t[4].setComponents(o-a,c-u,p-f,y-v).normalize(),t[5].setComponents(o+a,c+u,p+f,y+v).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Wt.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Wt)},intersectsSprite:function(e){return Wt.center.set(0,0,0),Wt.radius=.7071067811865476,Wt.applyMatrix4(e.matrixWorld),this.intersectsSphere(Wt)},intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(Xt.x=n.normal.x>0?e.max.x:e.min.x,Xt.y=n.normal.y>0?e.max.y:e.min.y,Xt.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Xt)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var qt={common:{diffuse:{value:new He(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new s},uv2Transform:{value:new s},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new o(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new He(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new He(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new s}},sprite:{diffuse:{value:new He(15658734)},opacity:{value:1},center:{value:new o(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new s}}};function Zt(){var e=null,t=!1,r=null;function n(i,a){!1!==t&&(r(i,a),e.requestAnimationFrame(n))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function Kt(e,t){var r=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var r=n.get(t);r&&(e.deleteBuffer(r.buffer),n.delete(t))},update:function(t,i){t.isInterleavedBufferAttribute&&(t=t.data);var a=n.get(t);void 0===a?n.set(t,function(t,r){var n=t.array,i=t.usage,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,n,i),t.onUploadCallback();var o=5126;return n instanceof Float32Array?o=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?o=5123:n instanceof Int16Array?o=5122:n instanceof Uint32Array?o=5125:n instanceof Int32Array?o=5124:n instanceof Int8Array?o=5120:n instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,i)):a.version<t.version&&(function(t,n,i){var a=n.array,o=n.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(r?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(a.buffer,t,i),a.version=t.version)}}}function Qt(e,t,r,n){It.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Jt(e,t,r,n)),this.mergeVertices()}function Jt(e,t,r,n){lt.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(r)||1,u=Math.floor(n)||1,c=l+1,h=u+1,d=e/l,f=t/u,p=[],m=[],g=[],v=[];for(a=0;a<h;a++){var y=a*f-s;for(i=0;i<c;i++){var _=i*d-o;m.push(_,-y,0),g.push(0,0,1),v.push(i/l),v.push(1-a/u)}}for(a=0;a<u;a++)for(i=0;i<l;i++){var b=i+c*a,E=i+c*(a+1),w=i+1+c*(a+1),x=i+1+c*a;p.push(b,E,x),p.push(E,w,x)}this.setIndex(p),this.setAttribute("position",new Qe(m,3)),this.setAttribute("normal",new Qe(g,3)),this.setAttribute("uv",new Qe(v,2))}Qt.prototype=Object.create(It.prototype),Qt.prototype.constructor=Qt,Jt.prototype=Object.create(lt.prototype),Jt.prototype.constructor=Jt;var $t={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP ) && ! defined( TOON )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP ) && ! defined( TOON )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP ) && ! defined( TOON )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},er={basic:{uniforms:Ft([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.fog]),vertexShader:$t.meshbasic_vert,fragmentShader:$t.meshbasic_frag},lambert:{uniforms:Ft([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.fog,qt.lights,{emissive:{value:new He(0)}}]),vertexShader:$t.meshlambert_vert,fragmentShader:$t.meshlambert_frag},phong:{uniforms:Ft([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,qt.lights,{emissive:{value:new He(0)},specular:{value:new He(1118481)},shininess:{value:30}}]),vertexShader:$t.meshphong_vert,fragmentShader:$t.meshphong_frag},standard:{uniforms:Ft([qt.common,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.roughnessmap,qt.metalnessmap,qt.fog,qt.lights,{emissive:{value:new He(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:$t.meshphysical_vert,fragmentShader:$t.meshphysical_frag},toon:{uniforms:Ft([qt.common,qt.specularmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.gradientmap,qt.fog,qt.lights,{emissive:{value:new He(0)},specular:{value:new He(1118481)},shininess:{value:30}}]),vertexShader:$t.meshtoon_vert,fragmentShader:$t.meshtoon_frag},matcap:{uniforms:Ft([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,{matcap:{value:null}}]),vertexShader:$t.meshmatcap_vert,fragmentShader:$t.meshmatcap_frag},points:{uniforms:Ft([qt.points,qt.fog]),vertexShader:$t.points_vert,fragmentShader:$t.points_frag},dashed:{uniforms:Ft([qt.common,qt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:$t.linedashed_vert,fragmentShader:$t.linedashed_frag},depth:{uniforms:Ft([qt.common,qt.displacementmap]),vertexShader:$t.depth_vert,fragmentShader:$t.depth_frag},normal:{uniforms:Ft([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,{opacity:{value:1}}]),vertexShader:$t.normal_vert,fragmentShader:$t.normal_frag},sprite:{uniforms:Ft([qt.sprite,qt.fog]),vertexShader:$t.sprite_vert,fragmentShader:$t.sprite_frag},background:{uniforms:{uvTransform:{value:new s},t2D:{value:null}},vertexShader:$t.background_vert,fragmentShader:$t.background_frag},cube:{uniforms:Ft([qt.envmap,{opacity:{value:1}}]),vertexShader:$t.cube_vert,fragmentShader:$t.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:$t.equirect_vert,fragmentShader:$t.equirect_frag},distanceRGBA:{uniforms:Ft([qt.common,qt.displacementmap,{referencePosition:{value:new v},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:$t.distanceRGBA_vert,fragmentShader:$t.distanceRGBA_frag},shadow:{uniforms:Ft([qt.lights,qt.fog,{color:{value:new He(0)},opacity:{value:1}}]),vertexShader:$t.shadow_vert,fragmentShader:$t.shadow_frag}};function tr(e,t,r,n){var i,a,o=new He(0),s=0,l=null,u=0,c=null;function h(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),h(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){h(o,s=e)},render:function(t,n,d,f){var p=n.background,m=e.xr,g=m.getSession&&m.getSession();if(g&&"additive"===g.environmentBlendMode&&(p=null),null===p?h(o,s):p&&p.isColor&&(h(p,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.isWebGLCubeRenderTarget||306===p.mapping)){void 0===a&&((a=new St(new Ot(1,1,1),new Ut({type:"BackgroundCubeMaterial",uniforms:Dt(er.cube.uniforms),vertexShader:er.cube.vertexShader,fragmentShader:er.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a));var v=p.isWebGLCubeRenderTarget?p.texture:p;a.material.uniforms.envMap.value=v,a.material.uniforms.flipEnvMap.value=v.isCubeTexture?-1:1,l===p&&u===v.version&&c===e.toneMapping||(a.material.needsUpdate=!0,l=p,u=v.version,c=e.toneMapping),t.unshift(a,a.geometry,a.material,0,0,null)}else p&&p.isTexture&&(void 0===i&&((i=new St(new Jt(2,2),new Ut({type:"BackgroundMaterial",uniforms:Dt(er.background.uniforms),vertexShader:er.background.vertexShader,fragmentShader:er.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),i.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&u===p.version&&c===e.toneMapping||(i.material.needsUpdate=!0,l=p,u=p.version,c=e.toneMapping),t.unshift(i,i.geometry,i.material,0,0,null))}}}function rr(e,t,r,n){var i,a=n.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,n){e.drawArrays(i,t,n),r.update(n,i)},this.renderInstances=function(n,o,s,l){if(0!==l){var u,c;if(a)u=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](i,o,s,l),r.update(s,i,l)}}}function nr(e,t,r){var n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=c>0,y=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:a?e.getParameter(36183):0}}function ir(){var e=this,t=null,r=0,n=!1,i=!1,a=new _e,o=new s,l={value:null,needsUpdate:!1};function u(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(t,r,n,i){var s=null!==t?t.length:0,u=null;if(0!==s){if(u=l.value,!0!==i||null===u){var c=n+4*s,h=r.matrixWorldInverse;o.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,f=n;d!==s;++d,f+=4)a.copy(t[d]).applyMatrix4(h,o),a.normal.toArray(u,f),u[f+3]=a.constant}l.value=u,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||0!==r||n;return n=i,t=c(e,a,0),r=e.length,o},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,u()},this.setState=function(e,a,o,s,h,d){if(!n||null===e||0===e.length||i&&!o)i?c(null):u();else{var f=i?0:r,p=4*f,m=h.clippingState||null;l.value=m,m=c(e,s,p,d);for(var g=0;g!==p;++g)m[g]=t[g];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=f}}}function ar(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}function or(e,t,r){var n=new WeakMap,i=new WeakMap;function a(e){var o=e.target,s=n.get(o);for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",a),n.delete(o);var u=i.get(s);u&&(t.remove(u),i.delete(s)),r.memory.geometries--}function o(e){var r=[],n=e.index,a=e.attributes.position,o=0;if(null!==n){var s=n.array;o=n.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],d=s[l+2];r.push(c,h,h,d,d,c)}}else for(s=a.array,o=a.version,l=0,u=s.length/3-1;l<u;l+=3)c=l+0,h=l+1,d=l+2,r.push(c,h,h,d,d,c);var f=new(et(r)>65535?Ke:qe)(r,1);f.version=o,t.update(f,34963);var p=i.get(e);p&&t.remove(p),i.set(e,f)}return{get:function(e,t){var i=n.get(t);return i||(t.addEventListener("dispose",a),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new lt).setFromObject(e)),i=t._bufferGeometry),n.set(t,i),r.memory.geometries++,i)},update:function(e){var r=e.index,n=e.attributes;for(var i in null!==r&&t.update(r,34963),n)t.update(n[i],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var r=e.index;null!==r&&t.version<r.version&&o(e)}else o(e);return i.get(e)}}}function sr(e,t,r,n){var i,a,o,s=n.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,n){e.drawElements(i,n,a,t*o),r.update(n,i)},this.renderInstances=function(n,l,u,c){if(0!==c){var h,d;if(s)h=e,d="drawElementsInstanced";else if(d="drawElementsInstancedANGLE",null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](i,u,a,l*o,c),r.update(u,i,c)}}}function lr(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,n){switch(n=n||1,t.calls++,r){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function ur(e,t){return Math.abs(t[1])-Math.abs(e[1])}function cr(e){var t={},r=new Float32Array(8);return{update:function(n,i,a,o){var s=n.morphTargetInfluences,l=void 0===s?0:s.length,u=t[i.id];if(void 0===u){u=[];for(var c=0;c<l;c++)u[c]=[c,0];t[i.id]=u}var h=a.morphTargets&&i.morphAttributes.position,d=a.morphNormals&&i.morphAttributes.normal;for(c=0;c<l;c++)0!==(p=u[c])[1]&&(h&&i.deleteAttribute("morphTarget"+c),d&&i.deleteAttribute("morphNormal"+c));for(c=0;c<l;c++)(p=u[c])[0]=c,p[1]=s[c];u.sort(ur);var f=0;for(c=0;c<8;c++){var p;if(p=u[c]){var m=p[0],g=p[1];if(g){h&&i.setAttribute("morphTarget"+c,h[m]),d&&i.setAttribute("morphNormal"+c,d[m]),r[c]=g,f+=g;continue}}r[c]=0}var v=i.morphTargetsRelative?1:1-f;o.getUniforms().setValue(e,"morphTargetBaseInfluence",v),o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function hr(e,t,r,n){var i=new WeakMap;return{update:function(e){var a=n.render.frame,o=e.geometry,s=t.get(e,o);return i.get(s)!==a&&(o.isGeometry&&s.updateFromObject(e),t.update(s),i.set(s,a)),e.isInstancedMesh&&r.update(e.instanceMatrix,34962),s},dispose:function(){i=new WeakMap}}}function dr(e,t,r,n,i,a,o,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:301,o=void 0!==o?o:1022,c.call(this,e,t,r,n,i,a,o,s,l,u),this.flipY=!1}function fr(e,t,r,n){c.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function pr(e,t,r,n){c.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}er.physical={uniforms:Ft([er.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new He(0)},clearcoatNormalScale:{value:new o(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:$t.meshphysical_vert,fragmentShader:$t.meshphysical_frag},dr.prototype=Object.create(c.prototype),dr.prototype.constructor=dr,dr.prototype.isCubeTexture=!0,Object.defineProperty(dr.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),fr.prototype=Object.create(c.prototype),fr.prototype.constructor=fr,fr.prototype.isDataTexture2DArray=!0,pr.prototype=Object.create(c.prototype),pr.prototype.constructor=pr,pr.prototype.isDataTexture3D=!0;var mr=new c,gr=new fr,vr=new pr,yr=new dr,_r=[],br=[],Er=new Float32Array(16),wr=new Float32Array(9),xr=new Float32Array(4);function Tr(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,a=_r[i];if(void 0===a&&(a=new Float32Array(i),_r[i]=a),0!==t){n.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(a,s)}return a}function Mr(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Sr(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function Ar(e,t){var r=br[t];void 0===r&&(r=new Int32Array(t),br[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function Rr(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function kr(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Mr(r,t))return;e.uniform2fv(this.addr,t),Sr(r,t)}}function Pr(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(Mr(r,t))return;e.uniform3fv(this.addr,t),Sr(r,t)}}function Lr(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Mr(r,t))return;e.uniform4fv(this.addr,t),Sr(r,t)}}function Cr(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Mr(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Sr(r,t)}else{if(Mr(r,n))return;xr.set(n),e.uniformMatrix2fv(this.addr,!1,xr),Sr(r,n)}}function Ir(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Mr(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Sr(r,t)}else{if(Mr(r,n))return;wr.set(n),e.uniformMatrix3fv(this.addr,!1,wr),Sr(r,n)}}function Hr(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Mr(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Sr(r,t)}else{if(Mr(r,n))return;Er.set(n),e.uniformMatrix4fv(this.addr,!1,Er),Sr(r,n)}}function Or(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(t||mr,i)}function Dr(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||gr,i)}function Fr(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||vr,i)}function Nr(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(t||yr,i)}function Ur(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Br(e,t){var r=this.cache;Mr(r,t)||(e.uniform2iv(this.addr,t),Sr(r,t))}function zr(e,t){var r=this.cache;Mr(r,t)||(e.uniform3iv(this.addr,t),Sr(r,t))}function jr(e,t){var r=this.cache;Mr(r,t)||(e.uniform4iv(this.addr,t),Sr(r,t))}function Vr(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function Gr(e,t){e.uniform1fv(this.addr,t)}function Wr(e,t){e.uniform1iv(this.addr,t)}function Xr(e,t){e.uniform2iv(this.addr,t)}function Yr(e,t){e.uniform3iv(this.addr,t)}function qr(e,t){e.uniform4iv(this.addr,t)}function Zr(e,t){var r=Tr(t,this.size,2);e.uniform2fv(this.addr,r)}function Kr(e,t){var r=Tr(t,this.size,3);e.uniform3fv(this.addr,r)}function Qr(e,t){var r=Tr(t,this.size,4);e.uniform4fv(this.addr,r)}function Jr(e,t){var r=Tr(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function $r(e,t){var r=Tr(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function en(e,t){var r=Tr(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function tn(e,t,r){var n=t.length,i=Ar(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTexture2D(t[a]||mr,i[a])}function rn(e,t,r){var n=t.length,i=Ar(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTextureCube(t[a]||yr,i[a])}function nn(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Rr;case 35664:return kr;case 35665:return Pr;case 35666:return Lr;case 35674:return Cr;case 35675:return Ir;case 35676:return Hr;case 5124:case 35670:return Ur;case 35667:case 35671:return Br;case 35668:case 35672:return zr;case 35669:case 35673:return jr;case 5125:return Vr;case 35678:case 36198:case 36298:case 36306:case 35682:return Or;case 35679:case 36299:case 36307:return Fr;case 35680:case 36300:case 36308:case 36293:return Nr;case 36289:case 36303:case 36311:case 36292:return Dr}}(t.type)}function an(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Gr;case 35664:return Zr;case 35665:return Kr;case 35666:return Qr;case 35674:return Jr;case 35675:return $r;case 35676:return en;case 5124:case 35670:return Wr;case 35667:case 35671:return Xr;case 35668:case 35672:return Yr;case 35669:case 35673:return qr;case 35678:case 36198:case 36298:case 36306:case 35682:return tn;case 35680:case 36300:case 36308:case 36293:return rn}}(t.type)}function on(e){this.id=e,this.seq=[],this.map={}}an.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Sr(t,e)},on.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,a=n.length;i!==a;++i){var o=n[i];o.setValue(e,t[o.id],r)}};var sn=/([\w\d_]+)(\])?(\[|\.)?/g;function ln(e,t){e.seq.push(t),e.map[t.id]=t}function un(e,t,r){var n=e.name,i=n.length;for(sn.lastIndex=0;;){var a=sn.exec(n),o=sn.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===i){ln(r,void 0===u?new nn(s,e,t):new an(s,e,t));break}var c=r.map[s];void 0===c&&ln(r,c=new on(s)),r=c}}function cn(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),n=0;n<r;++n){var i=e.getActiveUniform(t,n);un(i,e.getUniformLocation(t,i.name),this)}}function hn(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}cn.prototype.setValue=function(e,t,r,n){var i=this.map[t];void 0!==i&&i.setValue(e,r,n)},cn.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},cn.upload=function(e,t,r,n){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=r[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,n)}},cn.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var a=e[n];a.id in t&&r.push(a)}return r};var dn=0;function fn(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function pn(e,t,r){var n=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return n&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(e.getShaderSource(t))}function mn(e,t){var r=fn(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function gn(e,t){var r;switch(t){case 1:r="Linear";break;case 2:r="Reinhard";break;case 3:r="Uncharted2";break;case 4:r="OptimizedCineon";break;case 5:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function vn(e){return""!==e}function yn(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function _n(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var bn=/^[ \t]*#include +<([\w\d./]+)>/gm;function En(e){return e.replace(bn,wn)}function wn(e,t){var r=$t[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return En(r)}var xn=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Tn(e){return e.replace(xn,Mn)}function Mn(e,t,r,n){for(var i="",a=parseInt(t);a<parseInt(r);a++)i+=n.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function Sn(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function An(e,t,r){var n,i,a,o,s,l=e.getContext(),u=r.defines,c=r.vertexShader,h=r.fragmentShader,d=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(r),f=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:t="ENVMAP_TYPE_EQUIREC";break;case 305:t="ENVMAP_TYPE_SPHERE"}return t}(r),p=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 304:t="ENVMAP_MODE_REFRACTION"}return t}(r),m=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(r),g=e.gammaFactor>0?e.gammaFactor:1,v=r.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(vn).join("\n")}(r),y=function(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(u),_=l.createProgram();if(r.isRawShaderMaterial?((n=[y].filter(vn).join("\n")).length>0&&(n+="\n"),(i=[v,y].filter(vn).join("\n")).length>0&&(i+="\n")):(n=[Sn(r),"#define SHADER_NAME "+r.shaderName,y,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+p:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+d:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(vn).join("\n"),i=[v,Sn(r),"#define SHADER_NAME "+r.shaderName,y,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+f:"",r.envMap?"#define "+p:"",r.envMap?"#define "+m:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+d:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==r.toneMapping?"#define TONE_MAPPING":"",0!==r.toneMapping?$t.tonemapping_pars_fragment:"",0!==r.toneMapping?gn("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?$t.encodings_pars_fragment:"",r.mapEncoding?mn("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?mn("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?mn("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?mn("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?mn("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?(a="linearToOutputTexel",o=r.outputEncoding,s=fn(o),"vec4 "+a+"( vec4 value ) { return LinearTo"+s[0]+s[1]+"; }"):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(vn).join("\n")),c=_n(c=yn(c=En(c),r),r),h=_n(h=yn(h=En(h),r),r),c=Tn(c),h=Tn(h),r.isWebGL2&&!r.isRawShaderMaterial){var b=!1,E=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==c.match(E)&&null!==h.match(E)&&(b=!0,c=c.replace(E,""),h=h.replace(E,"")),n=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,i=["#version 300 es\n","#define varying in",b?"":"out highp vec4 pc_fragColor;",b?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i}var w,x,T=i+h,M=hn(l,35633,n+c),S=hn(l,35632,T);if(l.attachShader(_,M),l.attachShader(_,S),void 0!==r.index0AttributeName?l.bindAttribLocation(_,0,r.index0AttributeName):!0===r.morphTargets&&l.bindAttribLocation(_,0,"position"),l.linkProgram(_),e.debug.checkShaderErrors){var A=l.getProgramInfoLog(_).trim(),R=l.getShaderInfoLog(M).trim(),k=l.getShaderInfoLog(S).trim(),P=!0,L=!0;if(!1===l.getProgramParameter(_,35714)){P=!1;var C=pn(l,M,"vertex"),I=pn(l,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(_,35715),"gl.getProgramInfoLog",A,C,I)}else""!==A?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A):""!==R&&""!==k||(L=!1);L&&(this.diagnostics={runnable:P,programLog:A,vertexShader:{log:R,prefix:n},fragmentShader:{log:k,prefix:i}})}return l.detachShader(_,M),l.detachShader(_,S),l.deleteShader(M),l.deleteShader(S),this.getUniforms=function(){return void 0===w&&(w=new cn(l,_)),w},this.getAttributes=function(){return void 0===x&&(x=function(e,t){for(var r={},n=e.getProgramParameter(t,35721),i=0;i<n;i++){var a=e.getActiveAttrib(t,i).name;r[a]=e.getAttribLocation(t,a)}return r}(l,_)),x},this.destroy=function(){l.deleteProgram(_),this.program=void 0},this.name=r.shaderName,this.id=dn++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=M,this.fragmentShader=S,this}function Rn(e,t,r){var n=[],i=r.isWebGL2,a=r.logarithmicDepthBuffer,o=r.floatVertexTextures,s=r.precision,l=r.maxVertexUniforms,u=r.vertexTextures,c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function d(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=3e3,t}this.getParameters=function(n,h,f,p,m,g,v){var y=p.fog,_=n.isMeshStandardMaterial?p.environment:null,b=n.envMap||_,E=c[n.type],w=v.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(o)return 1024;var r=l,n=Math.floor((r-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(v):0;null!==n.precision&&(s=r.getMaxPrecision(n.precision))!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",s,"instead.");var x=function(e,t){var r;if(t){var n=er[t];r={name:e.type,uniforms:Nt.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}}else r={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return r}(n,E);n.onBeforeCompile(x,e);var T=e.getRenderTarget();return{isWebGL2:i,shaderID:E,shaderName:x.name,uniforms:x.uniforms,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,defines:n.defines,isRawShaderMaterial:n.isRawShaderMaterial,isShaderMaterial:n.isShaderMaterial,precision:s,instancing:!0===v.isInstancedMesh,supportsVertexTextures:u,outputEncoding:null!==T?d(T.texture):e.outputEncoding,map:!!n.map,mapEncoding:d(n.map),matcap:!!n.matcap,matcapEncoding:d(n.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:d(b),envMapCubeUV:!!b&&(306===b.mapping||307===b.mapping),lightMap:!!n.lightMap,lightMapEncoding:d(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:d(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:1===n.normalMapType,tangentSpaceNormalMap:0===n.normalMapType,clearcoatNormalMap:!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,sheen:!!n.sheen,combine:n.combine,vertexTangents:n.normalMap&&n.vertexTangents,vertexColors:n.vertexColors,vertexUvs:!!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||n.displacementMap),uvsVertexOnly:!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||!n.displacementMap),fog:!!y,useFog:n.fog,fogExp2:y&&y.isFogExp2,flatShading:n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:a,skinning:n.skinning&&w>0,maxBones:w,useVertexTexture:o,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:g,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:2===n.side,flipSided:1===n.side,depthPacking:void 0!==n.depthPacking&&n.depthPacking,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawbuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:i||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:i||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:n.onBeforeCompile}},this.getProgramCacheKey=function(t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);if(void 0===t.isRawShaderMaterial){for(var i=0;i<h.length;i++)r.push(t[h[i]]);r.push(e.outputEncoding),r.push(e.gammaFactor)}return r.push(t.onBeforeCompile.toString()),r.join()},this.acquireProgram=function(t,r){for(var i,a=0,o=n.length;a<o;a++){var s=n[a];if(s.cacheKey===r){++(i=s).usedTimes;break}}return void 0===i&&(i=new An(e,r,t),n.push(i)),i},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function kn(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}}function Pn(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ln(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Cn(){var e=[],t=0,r=[],n=[],i={id:-1};function a(r,n,a,o,s,l){var u=e[t];return void 0===u?(u={id:r.id,object:r,geometry:n,material:a,program:a.program||i,groupOrder:o,renderOrder:r.renderOrder,z:s,group:l},e[t]=u):(u.id=r.id,u.object=r,u.geometry=n,u.material=a,u.program=a.program||i,u.groupOrder=o,u.renderOrder=r.renderOrder,u.z=s,u.group=l),t++,u}return{opaque:r,transparent:n,init:function(){t=0,r.length=0,n.length=0},push:function(e,t,i,o,s,l){var u=a(e,t,i,o,s,l);(!0===i.transparent?n:r).push(u)},unshift:function(e,t,i,o,s,l){var u=a(e,t,i,o,s,l);(!0===i.transparent?n:r).unshift(u)},finish:function(){for(var r=t,n=e.length;r<n;r++){var i=e[r];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Pn),n.length>1&&n.sort(t||Ln)}}}function In(){var e=new WeakMap;function t(r){var n=r.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(r,n){var i,a=e.get(r);return void 0===a?(i=new Cn,e.set(r,new WeakMap),e.get(r).set(n,i),r.addEventListener("dispose",t)):void 0===(i=a.get(n))&&(i=new Cn,a.set(n,i)),i},dispose:function(){e=new WeakMap}}}function Hn(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new v,color:new He};break;case"SpotLight":r={position:new v,direction:new v,color:new He,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new v,color:new He,distance:0,decay:0};break;case"HemisphereLight":r={direction:new v,skyColor:new He,groundColor:new He};break;case"RectAreaLight":r={color:new He,position:new v,halfWidth:new v,halfHeight:new v}}return e[t.id]=r,r}}}var On=0;function Dn(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Fn(){for(var e,t=new Hn,r=(e={},{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new o,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)n.probe.push(new v);var a=new v,s=new M,l=new M;return{setup:function(e,i,o){for(var u=0,c=0,h=0,d=0;d<9;d++)n.probe[d].set(0,0,0);var f=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=o.matrixWorldInverse;e.sort(Dn),d=0;for(var w=e.length;d<w;d++){var x=e[d],T=x.color,M=x.intensity,S=x.distance,A=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)u+=T.r*M,c+=T.g*M,h+=T.b*M;else if(x.isLightProbe)for(var R=0;R<9;R++)n.probe[R].addScaledVector(x.sh.coefficients[R],M);else if(x.isDirectionalLight){if((L=t.get(x)).color.copy(x.color).multiplyScalar(x.intensity),L.direction.setFromMatrixPosition(x.matrixWorld),a.setFromMatrixPosition(x.target.matrixWorld),L.direction.sub(a),L.direction.transformDirection(E),x.castShadow){var k=x.shadow;(P=r.get(x)).shadowBias=k.bias,P.shadowRadius=k.radius,P.shadowMapSize=k.mapSize,n.directionalShadow[f]=P,n.directionalShadowMap[f]=A,n.directionalShadowMatrix[f]=x.shadow.matrix,y++}n.directional[f]=L,f++}else if(x.isSpotLight)(L=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),L.position.applyMatrix4(E),L.color.copy(T).multiplyScalar(M),L.distance=S,L.direction.setFromMatrixPosition(x.matrixWorld),a.setFromMatrixPosition(x.target.matrixWorld),L.direction.sub(a),L.direction.transformDirection(E),L.coneCos=Math.cos(x.angle),L.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),L.decay=x.decay,x.castShadow&&(k=x.shadow,(P=r.get(x)).shadowBias=k.bias,P.shadowRadius=k.radius,P.shadowMapSize=k.mapSize,n.spotShadow[m]=P,n.spotShadowMap[m]=A,n.spotShadowMatrix[m]=x.shadow.matrix,b++),n.spot[m]=L,m++;else if(x.isRectAreaLight)(L=t.get(x)).color.copy(T).multiplyScalar(M),L.position.setFromMatrixPosition(x.matrixWorld),L.position.applyMatrix4(E),l.identity(),s.copy(x.matrixWorld),s.premultiply(E),l.extractRotation(s),L.halfWidth.set(.5*x.width,0,0),L.halfHeight.set(0,.5*x.height,0),L.halfWidth.applyMatrix4(l),L.halfHeight.applyMatrix4(l),n.rectArea[g]=L,g++;else if(x.isPointLight){var P;if((L=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),L.position.applyMatrix4(E),L.color.copy(x.color).multiplyScalar(x.intensity),L.distance=x.distance,L.decay=x.decay,x.castShadow)k=x.shadow,(P=r.get(x)).shadowBias=k.bias,P.shadowRadius=k.radius,P.shadowMapSize=k.mapSize,P.shadowCameraNear=k.camera.near,P.shadowCameraFar=k.camera.far,n.pointShadow[p]=P,n.pointShadowMap[p]=A,n.pointShadowMatrix[p]=x.shadow.matrix,_++;n.point[p]=L,p++}else if(x.isHemisphereLight){var L;(L=t.get(x)).direction.setFromMatrixPosition(x.matrixWorld),L.direction.transformDirection(E),L.direction.normalize(),L.skyColor.copy(x.color).multiplyScalar(M),L.groundColor.copy(x.groundColor).multiplyScalar(M),n.hemi[v]=L,v++}}n.ambient[0]=u,n.ambient[1]=c,n.ambient[2]=h;var C=n.hash;C.directionalLength===f&&C.pointLength===p&&C.spotLength===m&&C.rectAreaLength===g&&C.hemiLength===v&&C.numDirectionalShadows===y&&C.numPointShadows===_&&C.numSpotShadows===b||(n.directional.length=f,n.spot.length=m,n.rectArea.length=g,n.point.length=p,n.hemi.length=v,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=_,n.pointShadowMap.length=_,n.spotShadow.length=b,n.spotShadowMap.length=b,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=_,n.spotShadowMatrix.length=b,C.directionalLength=f,C.pointLength=p,C.spotLength=m,C.rectAreaLength=g,C.hemiLength=v,C.numDirectionalShadows=y,C.numPointShadows=_,C.numSpotShadows=b,n.version=On++)},state:n}}function Nn(){var e=new Fn,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(n){e.setup(t,r,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function Un(){var e=new WeakMap;function t(r){var n=r.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(r,n){var i;return!1===e.has(r)?(i=new Nn,e.set(r,new WeakMap),e.get(r).set(n,i),r.addEventListener("dispose",t)):!1===e.get(r).has(n)?(i=new Nn,e.get(r).set(n,i)):i=e.get(r).get(n),i},dispose:function(){e=new WeakMap}}}function Bn(e){Be.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function zn(e){Be.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new v,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function jn(e,t,r){var n=new Yt,i=new o,a=new o,s=new h,l=[],u=[],c={},f={0:1,1:0,2:2},p=new Ut({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new o},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),m=p.clone();m.defines.HORIZONAL_PASS=1;var g=new lt;g.setAttribute("position",new Ve(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new St(g,p),y=this;function _(r,n){var i=t.update(v);p.uniforms.shadow_pass.value=r.map.texture,p.uniforms.resolution.value=r.mapSize,p.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(n,null,i,p,v,null),m.uniforms.shadow_pass.value=r.mapPass.texture,m.uniforms.resolution.value=r.mapSize,m.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(n,null,i,m,v,null)}function b(e,t,r){var n=e<<0|t<<1|r<<2,i=l[n];return void 0===i&&(i=new Bn({depthPacking:3201,morphTargets:e,skinning:t}),l[n]=i),i}function E(e,t,r){var n=e<<0|t<<1|r<<2,i=u[n];return void 0===i&&(i=new zn({morphTargets:e,skinning:t}),u[n]=i),i}function w(t,r,n,i,a,o){var s=t.geometry,l=null,u=b,h=t.customDepthMaterial;if(!0===n.isPointLight&&(u=E,h=t.customDistanceMaterial),void 0===h){var d=!1;!0===r.morphTargets&&(!0===s.isBufferGeometry?d=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(d=s.morphTargets&&s.morphTargets.length>0));var p=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=u(d,p,!0===t.isInstancedMesh)}else l=h;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var m=l.uuid,g=r.uuid,v=c[m];void 0===v&&(v={},c[m]=v);var y=v[g];void 0===y&&(y=l.clone(),v[g]=y),l=y}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=3===o?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:f[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===n.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(n.matrixWorld),l.nearDistance=i,l.farDistance=a),l}function x(r,i,a,o,s){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&3===s)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var l=t.update(r),u=r.material;if(Array.isArray(u))for(var c=l.groups,h=0,d=c.length;h<d;h++){var f=c[h],p=u[f.materialIndex];if(p&&p.visible){var m=w(r,p,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,m,r,f)}}else u.visible&&(m=w(r,u,o,a.near,a.far,s),e.renderBufferDirect(a,null,l,m,r,null))}for(var g=r.children,v=0,y=g.length;v<y;v++)x(g[v],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,o,l){if(!1!==y.enabled&&(!1!==y.autoUpdate||!1!==y.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.state;f.setBlending(0),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var p=0,m=t.length;p<m;p++){var g=t[p],v=g.shadow;if(void 0!==v){i.copy(v.mapSize);var b=v.getFrameExtents();if(i.multiply(b),a.copy(v.mapSize),(i.x>r||i.y>r)&&(console.warn("THREE.WebGLShadowMap:",g,"has shadow exceeding max texture size, reducing"),i.x>r&&(a.x=Math.floor(r/b.x),i.x=a.x*b.x,v.mapSize.x=a.x),i.y>r&&(a.y=Math.floor(r/b.y),i.y=a.y*b.y,v.mapSize.y=a.y)),null===v.map&&!v.isPointLightShadow&&3===this.type){var E={minFilter:1006,magFilter:1006,format:1023};v.map=new d(i.x,i.y,E),v.map.texture.name=g.name+".shadowMap",v.mapPass=new d(i.x,i.y,E),v.camera.updateProjectionMatrix()}null===v.map&&(E={minFilter:1003,magFilter:1003,format:1023},v.map=new d(i.x,i.y,E),v.map.texture.name=g.name+".shadowMap",v.camera.updateProjectionMatrix()),e.setRenderTarget(v.map),e.clear();for(var w=v.getViewportCount(),T=0;T<w;T++){var M=v.getViewport(T);s.set(a.x*M.x,a.y*M.y,a.x*M.z,a.y*M.w),f.viewport(s),v.updateMatrices(g,T),n=v.getFrustum(),x(o,l,v.camera,g,this.type)}v.isPointLightShadow||3!==this.type||_(v,l)}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}y.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function Vn(e,t,r){var n=r.isWebGL2,i=new function(){var t=!1,r=new h,n=null,i=new h(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,a,o,s){!0===s&&(t*=o,n*=o,a*=o),r.set(t,n,a,o),!1===i.equals(r)&&(e.clearColor(t,n,a,o),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},a=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(e){e?U(2929):B(2929)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},o=new function(){var t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?U(2960):B(2960))},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,o){n===t&&i===r&&a===o||(e.stencilFunc(t,r,o),n=t,i=r,a=o)},setOp:function(t,r,n){o===t&&s===r&&l===n||(e.stencilOp(t,r,n),o=t,s=r,l=n)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null}}},s=e.getParameter(34921),l=new Uint8Array(s),u=new Uint8Array(s),c=new Uint8Array(s),d={},f=null,p=null,m=null,g=null,v=null,y=null,_=null,b=null,E=null,w=!1,x=null,T=null,M=null,S=null,A=null,R=e.getParameter(35661),k=!1,P=0,L=e.getParameter(7938);-1!==L.indexOf("WebGL")?(P=parseFloat(/^WebGL\ ([0-9])/.exec(L)[1]),k=P>=1):-1!==L.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(L)[1]),k=P>=2);var C=null,I={},H=new h,O=new h;function D(t,r,n){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<n;o++)e.texImage2D(r+o,0,6408,1,1,0,6408,5121,i);return a}var F={};function N(r,i){l[r]=1,0===u[r]&&(e.enableVertexAttribArray(r),u[r]=1),c[r]!==i&&((n?e:t.get("ANGLE_instanced_arrays"))[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),c[r]=i)}function U(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function B(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}F[3553]=D(3553,3553,1),F[34067]=D(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),U(2929),a.setFunc(3),W(!1),X(1),U(2884),G(0);var z={100:32774,101:32778,102:32779};if(n)z[103]=32775,z[104]=32776;else{var j=t.get("EXT_blend_minmax");null!==j&&(z[103]=j.MIN_EXT,z[104]=j.MAX_EXT)}var V={};function G(t,r,n,i,a,o,s,l){if(0!==t){if(p||(U(3042),p=!0),5===t)a=a||r,o=o||n,s=s||i,r===g&&a===_||(e.blendEquationSeparate(z[r],z[a]),g=r,_=a),n===v&&i===y&&o===b&&s===E||(e.blendFuncSeparate(V[n],V[i],V[o],V[s]),v=n,y=i,b=o,E=s),m=t,w=null;else if(t!==m||l!==w){if(100===g&&100===_||(e.blendEquation(32774),g=100,_=100),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,b=null,E=null,m=t,w=l}}else p&&(B(3042),p=!1)}function W(t){x!==t&&(t?e.frontFace(2304):e.frontFace(2305),x=t)}function X(t){0!==t?(U(2884),t!==T&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):B(2884),T=t}function Y(t,r,n){t?(U(32823),S===r&&A===n||(e.polygonOffset(r,n),S=r,A=n)):B(32823)}function q(t){void 0===t&&(t=33984+R-1),C!==t&&(e.activeTexture(t),C=t)}return V[200]=0,V[201]=1,V[202]=768,V[204]=770,V[210]=776,V[208]=774,V[206]=772,V[203]=769,V[205]=771,V[209]=775,V[207]=773,{buffers:{color:i,depth:a,stencil:o},initAttributes:function(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function(e){N(e,0)},enableAttributeAndDivisor:N,disableUnusedAttributes:function(){for(var t=0,r=u.length;t!==r;++t)u[t]!==l[t]&&(e.disableVertexAttribArray(t),u[t]=0)},enable:U,disable:B,useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:G,setMaterial:function(e,t){2===e.side?B(2884):U(2884);var r=1===e.side;t&&(r=!r),W(r),1===e.blending&&!1===e.transparent?G(0):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),i.setMask(e.colorWrite);var n=e.stencilWrite;o.setTest(n),n&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Y(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:W,setCullFace:X,setLineWidth:function(t){t!==M&&(k&&e.lineWidth(t),M=t)},setPolygonOffset:Y,setScissorTest:function(e){e?U(3089):B(3089)},activeTexture:q,bindTexture:function(t,r){null===C&&q();var n=I[C];void 0===n&&(n={type:void 0,texture:void 0},I[C]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||F[t]),n.type=t,n.texture=r)},unbindTexture:function(){var t=I[C];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===H.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),H.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){for(var t=0;t<u.length;t++)1===u[t]&&(e.disableVertexAttribArray(t),u[t]=0);d={},C=null,I={},f=null,m=null,x=null,T=null,i.reset(),a.reset(),o.reset()}}}function Gn(e,t,r,n,i,o,s){var l,u=i.isWebGL2,c=i.maxTextures,h=i.maxCubemapSize,d=i.maxTextureSize,f=i.maxSamples,p=new WeakMap,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,r,n){var i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?a.floorPowerOfTwo:Math.floor,s=o(i*e.width),u=o(i*e.height);void 0===l&&(l=g(s,u));var c=r?g(s,u):l;return c.width=s,c.height=u,c.getContext("2d").drawImage(e,0,0,s,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+u+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return a.isPowerOfTwo(e.width)&&a.isPowerOfTwo(e.height)}function _(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function b(t,r,i,a){e.generateMipmap(t),n.get(r).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function E(r,n,i){if(!1===u)return n;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}var a=n;return 6403===n&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===n&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===n&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325===a||33326===a||34842===a||34836===a?t.get("EXT_color_buffer_float"):34843!==a&&34837!==a||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),a}function w(e){return 1003===e||1004===e||1005===e?9728:9729}function x(t){var r=t.target;r.removeEventListener("dispose",x),function(t){var r=n.get(t);void 0!==r.__webglInit&&(e.deleteTexture(r.__webglTexture),n.remove(t))}(r),r.isVideoTexture&&p.delete(r),s.memory.textures--}function T(t){var r=t.target;r.removeEventListener("dispose",T),function(t){var r=n.get(t),i=n.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(var a=0;a<6;a++)e.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[a]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}}(r),s.memory.textures--}var M=0;function S(e,t){var i=n.get(e);if(e.isVideoTexture&&function(e){var t=s.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void I(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,i.__webglTexture)}function A(t,i){if(6===t.image.length){var a=n.get(t);if(t.version>0&&a.__version!==t.version){C(a,t),r.activeTexture(33984+i),r.bindTexture(34067,a.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),l=t.image[0]&&t.image[0].isDataTexture,c=[],d=0;d<6;d++)c[d]=s||l?l?t.image[d].image:t.image[d]:v(t.image[d],!1,!0,h);var f,p=c[0],m=y(p)||u,g=o.convert(t.format),w=o.convert(t.type),x=E(t.internalFormat,g,w);if(L(34067,t,m),s){for(d=0;d<6;d++){f=c[d].mipmaps;for(var T=0;T<f.length;T++){var M=f[T];1023!==t.format&&1022!==t.format?null!==g?r.compressedTexImage2D(34069+d,T,x,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+d,T,x,M.width,M.height,0,g,w,M.data)}}a.__maxMipLevel=f.length-1}else{for(f=t.mipmaps,d=0;d<6;d++)if(l)for(r.texImage2D(34069+d,0,x,c[d].width,c[d].height,0,g,w,c[d].data),T=0;T<f.length;T++){var S=(M=f[T]).image[d].image;r.texImage2D(34069+d,T+1,x,S.width,S.height,0,g,w,S.data)}else for(r.texImage2D(34069+d,0,x,g,w,c[d]),T=0;T<f.length;T++)M=f[T],r.texImage2D(34069+d,T+1,x,g,w,M.image[d]);a.__maxMipLevel=f.length}_(t,m)&&b(34067,t,p.width,p.height),a.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(33984+i),r.bindTexture(34067,a.__webglTexture)}}function R(e,t){r.activeTexture(33984+t),r.bindTexture(34067,n.get(e).__webglTexture)}var k={1e3:10497,1001:33071,1002:33648},P={};function L(r,a,o){o?(e.texParameteri(r,10242,k[a.wrapS]),e.texParameteri(r,10243,k[a.wrapT]),32879!==r&&35866!==r||e.texParameteri(r,32882,k[a.wrapR]),e.texParameteri(r,10240,P[a.magFilter]),e.texParameteri(r,10241,P[a.minFilter])):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),32879!==r&&35866!==r||e.texParameteri(r,32882,33071),1001===a.wrapS&&1001===a.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,w(a.magFilter)),e.texParameteri(r,10241,w(a.minFilter)),1003!==a.minFilter&&1006!==a.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(1015===a.type&&null===t.get("OES_texture_float_linear"))return;if(1016===a.type&&null===(u||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function C(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",x),t.__webglTexture=e.createTexture(),s.memory.textures++)}function I(t,n,i){var a=3553;n.isDataTexture2DArray&&(a=35866),n.isDataTexture3D&&(a=32879),C(t,n),r.activeTexture(33984+i),r.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);var s=function(e){return!u&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(n)&&!1===y(n.image),l=v(n.image,s,!1,d),c=y(l)||u,h=o.convert(n.format),f=o.convert(n.type),p=E(n.internalFormat,h,f);L(a,n,c);var m,g=n.mipmaps;if(n.isDepthTexture){if(p=6402,1015===n.type){if(!1===u)throw new Error("Float Depth Texture only supported in WebGL2.0");p=36012}else u&&(p=33189);1026===n.format&&6402===p&&1012!==n.type&&1014!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=1012,f=o.convert(n.type)),1027===n.format&&(p=34041,1020!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=1020,f=o.convert(n.type))),r.texImage2D(3553,0,p,l.width,l.height,0,h,f,null)}else if(n.isDataTexture)if(g.length>0&&c){for(var w=0,x=g.length;w<x;w++)m=g[w],r.texImage2D(3553,w,p,m.width,m.height,0,h,f,m.data);n.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else r.texImage2D(3553,0,p,l.width,l.height,0,h,f,l.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(w=0,x=g.length;w<x;w++)m=g[w],1023!==n.format&&1022!==n.format?null!==h?r.compressedTexImage2D(3553,w,p,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,w,p,m.width,m.height,0,h,f,m.data);t.__maxMipLevel=g.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,p,l.width,l.height,l.depth,0,h,f,l.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,p,l.width,l.height,l.depth,0,h,f,l.data),t.__maxMipLevel=0;else if(g.length>0&&c){for(w=0,x=g.length;w<x;w++)m=g[w],r.texImage2D(3553,w,p,h,f,m);n.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else r.texImage2D(3553,0,p,h,f,l),t.__maxMipLevel=0;_(n,c)&&b(a,n,l.width,l.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function H(t,i,a,s){var l=o.convert(i.texture.format),u=o.convert(i.texture.type),c=E(i.texture.internalFormat,l,u);r.texImage2D(s,0,c,i.width,i.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,n.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function O(t,r,n){if(e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){if(n){var i=F(r);e.renderbufferStorageMultisample(36161,i,33189,r.width,r.height)}else e.renderbufferStorage(36161,33189,r.width,r.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(r.depthBuffer&&r.stencilBuffer)n?(i=F(r),e.renderbufferStorageMultisample(36161,i,35056,r.width,r.height)):e.renderbufferStorage(36161,34041,r.width,r.height),e.framebufferRenderbuffer(36160,33306,36161,t);else{var a=o.convert(r.texture.format),s=o.convert(r.texture.type),l=E(r.texture.internalFormat,a,s);n?(i=F(r),e.renderbufferStorageMultisample(36161,i,l,r.width,r.height)):e.renderbufferStorage(36161,l,r.width,r.height)}e.bindRenderbuffer(36161,null)}function D(t){var r=n.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),S(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(1026===r.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==r.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,t)}else if(i){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=e.createRenderbuffer(),O(r.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),O(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function F(e){return u&&e.isWebGLMultisampleRenderTarget?Math.min(f,e.samples):0}P[1003]=9728,P[1004]=9984,P[1005]=9986,P[1006]=9729,P[1007]=9985,P[1008]=9987;var N=!1,U=!1;this.allocateTextureUnit=function(){var e=M;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?I(i,e,t):(r.activeTexture(33984+t),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?I(i,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=A,this.setTextureCubeDynamic=R,this.setupRenderTarget=function(t){var i=n.get(t),a=n.get(t.texture);t.addEventListener("dispose",T),a.__webglTexture=e.createTexture(),s.memory.textures++;var l=!0===t.isWebGLCubeRenderTarget,c=!0===t.isWebGLMultisampleRenderTarget,h=y(t)||u;if(l){i.__webglFramebuffer=[];for(var d=0;d<6;d++)i.__webglFramebuffer[d]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),c)if(u){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);var f=o.convert(t.texture.format),p=o.convert(t.texture.type),m=E(t.texture.internalFormat,f,p),g=F(t);e.renderbufferStorageMultisample(36161,g,m,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),O(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){for(r.bindTexture(34067,a.__webglTexture),L(34067,t.texture,h),d=0;d<6;d++)H(i.__webglFramebuffer[d],t,36064,34069+d);_(t.texture,h)&&b(34067,t.texture,t.width,t.height),r.bindTexture(34067,null)}else r.bindTexture(3553,a.__webglTexture),L(3553,t.texture,h),H(i.__webglFramebuffer,t,36064,3553),_(t.texture,h)&&b(3553,t.texture,t.width,t.height),r.bindTexture(3553,null);t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(_(t,y(e)||u)){var i=e.isWebGLCubeRenderTarget?34067:3553,a=n.get(t).__webglTexture;r.bindTexture(i,a),b(i,t,e.width,e.height),r.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(u){var r=n.get(t);e.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,r.__webglFramebuffer);var i=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024),e.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?A(e,t):R(e,t)}}function Wn(e,t,r){var n=r.isWebGL2;return{convert:function(e){var r;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e)return n?5131:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(r=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return r.COMPRESSED_RGB8_ETC2;if(37496===e)return r.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(r=t.get("WEBGL_compressed_texture_astc"))?e:null:1020===e?n?34042:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Xn(e){zt.call(this),this.cameras=e||[]}function Yn(){V.call(this),this.type="Group"}function qn(e,t){var r=this,n=null,i=1,a=null,o="local-floor",s=null,l=[],u=new Map,c=new zt;c.layers.enable(1),c.viewport=new h;var d=new zt;d.layers.enable(2),d.viewport=new h;var f=new Xn([c,d]);f.layers.enable(1),f.layers.enable(2);var p=null,m=null;function g(e){var t=u.get(e.inputSource);t&&(t.targetRay&&t.targetRay.dispatchEvent({type:e.type}),t.grip&&t.grip.dispatchEvent({type:e.type}))}function y(){u.forEach((function(e,t){e.targetRay&&(e.targetRay.dispatchEvent({type:"disconnected",data:t}),e.targetRay.visible=!1),e.grip&&(e.grip.dispatchEvent({type:"disconnected",data:t}),e.grip.visible=!1)})),u.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),M.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function _(e){a=e,M.setContext(n),M.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}function b(e){for(var t=n.inputSources,r=0;r<l.length;r++)u.set(t[r],l[r]);for(r=0;r<e.removed.length;r++){var i=e.removed[r];(a=u.get(i))&&(a.targetRay&&a.targetRay.dispatchEvent({type:"disconnected",data:i}),a.grip&&a.grip.dispatchEvent({type:"disconnected",data:i}),u.delete(i))}for(r=0;r<e.added.length;r++){var a;i=e.added[r],(a=u.get(i))&&(a.targetRay&&a.targetRay.dispatchEvent({type:"connected",data:i}),a.grip&&a.grip.dispatchEvent({type:"connected",data:i}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=l[e];return void 0===t&&(t={},l[e]=t),void 0===t.targetRay&&(t.targetRay=new Yn,t.targetRay.matrixAutoUpdate=!1,t.targetRay.visible=!1),t.targetRay},this.getControllerGrip=function(e){var t=l[e];return void 0===t&&(t={},l[e]=t),void 0===t.grip&&(t.grip=new Yn,t.grip.matrixAutoUpdate=!1,t.grip.visible=!1),t.grip},this.setFramebufferScaleFactor=function(e){i=e,1==r.isPresenting&&console.warn("WebXRManager: Cannot change framebuffer scale while presenting VR content")},this.setReferenceSpaceType=function(e){o=e},this.getReferenceSpace=function(){return a},this.getSession=function(){return n},this.setSession=function(e){if(null!==(n=e)){n.addEventListener("select",g),n.addEventListener("selectstart",g),n.addEventListener("selectend",g),n.addEventListener("squeeze",g),n.addEventListener("squeezestart",g),n.addEventListener("squeezeend",g),n.addEventListener("end",y);var r=t.getContextAttributes(),a={antialias:r.antialias,alpha:r.alpha,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:i},s=new XRWebGLLayer(n,t,a);n.updateRenderState({baseLayer:s}),n.requestReferenceSpace(o).then(_),n.addEventListener("inputsourceschange",b)}};var E=new v,w=new v;function x(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){f.near=d.near=c.near=e.near,f.far=d.far=c.far=e.far,p===f.near&&m===f.far||(n.updateRenderState({depthNear:f.near,depthFar:f.far}),p=f.near,m=f.far);var t=e.parent,r=f.cameras;x(f,t);for(var i=0;i<r.length;i++)x(r[i],t);e.matrixWorld.copy(f.matrixWorld);for(var a=e.children,o=(i=0,a.length);i<o;i++)a[i].updateMatrixWorld(!0);return function(e,t,r){E.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(r.matrixWorld);var n=E.distanceTo(w),i=t.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,f=o*h,p=n/(-c+h),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=o+p,v=s+p,y=d-m,_=f+(n-m),b=l*s/v*g,x=u*s/v*g;e.projectionMatrix.makePerspective(y,_,b,x,g,v)}(f,c,d),f};var T=null,M=new Zt;M.setAnimationLoop((function(t,r){if(null!==(s=r.getViewerPose(a))){var i=s.views,o=n.renderState.baseLayer;e.setFramebuffer(o.framebuffer);for(var u=0;u<i.length;u++){var c=i[u],h=o.getViewport(c),d=f.cameras[u];d.matrix.fromArray(c.transform.matrix),d.projectionMatrix.fromArray(c.projectionMatrix),d.viewport.set(h.x,h.y,h.width,h.height),0===u&&f.matrix.copy(d.matrix)}}var p=n.inputSources;for(u=0;u<l.length;u++){var m=l[u],g=p[u],v=null,y=null;g&&(m.targetRay&&null!==(v=r.getPose(g.targetRaySpace,a))&&(m.targetRay.matrix.fromArray(v.transform.matrix),m.targetRay.matrix.decompose(m.targetRay.position,m.targetRay.rotation,m.targetRay.scale)),m.grip&&g.gripSpace&&null!==(y=r.getPose(g.gripSpace,a))&&(m.grip.matrix.fromArray(y.transform.matrix),m.grip.matrix.decompose(m.grip.position,m.grip.rotation,m.grip.scale))),m.targetRay&&(m.targetRay.visible=null!==v),m.grip&&(m.grip.visible=null!==y)}T&&T(t,r)})),this.setAnimationLoop=function(e){T=e},this.dispose=function(){}}function Zn(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,u=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,d=void 0!==e.powerPreference?e.powerPreference:"default",f=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,p=null,m=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var g,y,_,b,E,w,x,T,S,A,R,k,P,L,C,I,H,O,D=this,F=!1,N=null,U=0,B=0,z=null,j=null,V=-1,W={geometry:null,program:null,wireframe:!1},X=null,Y=null,q=new h,Z=new h,K=null,Q=t.width,J=t.height,$=1,ee=null,te=null,re=new h(0,0,Q,J),ne=new h(0,0,Q,J),ie=!1,ae=new Yt,oe=new ir,se=!1,le=!1,ue=new M,ce=new v;function he(){return null===z?$:1}try{var de={alpha:n,depth:i,stencil:s,antialias:l,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:d,failIfMajorPerformanceCaveat:f,xrCompatible:!0};if(t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",ve,!1),null===(g=r||t.getContext("webgl",de)||t.getContext("experimental-webgl",de)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===g.getShaderPrecisionFormat&&(g.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function fe(){y=new ar(g),!1===(_=new nr(g,y,e)).isWebGL2&&(y.get("WEBGL_depth_texture"),y.get("OES_texture_float"),y.get("OES_texture_half_float"),y.get("OES_texture_half_float_linear"),y.get("OES_standard_derivatives"),y.get("OES_element_index_uint"),y.get("ANGLE_instanced_arrays")),y.get("OES_texture_float_linear"),O=new Wn(g,y,_),(b=new Vn(g,y,_)).scissor(Z.copy(ne).multiplyScalar($).floor()),b.viewport(q.copy(re).multiplyScalar($).floor()),E=new lr(g),w=new kn,x=new Gn(g,y,b,w,_,O,E),T=new Kt(g,_),S=new or(g,T,E),A=new hr(g,S,T,E),C=new cr(g),R=new Rn(D,y,_),k=new In,P=new Un,L=new tr(D,b,A,u),I=new rr(g,y,E,_),H=new sr(g,y,E,_),E.programs=R.programs,D.capabilities=_,D.extensions=y,D.properties=w,D.renderLists=k,D.state=b,D.info=E}fe();var pe=new qn(D,g);this.xr=pe;var me=new jn(D,A,_.maxTextureSize);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),F=!0}function ve(){console.log("THREE.WebGLRenderer: Context Restored."),F=!1,fe()}function ye(e){var t=e.target;t.removeEventListener("dispose",ye),function(e){_e(e),w.remove(e)}(t)}function _e(e){var t=w.get(e).program;e.program=void 0,void 0!==t&&R.releaseProgram(t)}this.shadowMap=me,this.getContext=function(){return g},this.getContextAttributes=function(){return g.getContextAttributes()},this.forceContextLoss=function(){var e=y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return $},this.setPixelRatio=function(e){void 0!==e&&($=e,this.setSize(Q,J,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new o),e.set(Q,J)},this.setSize=function(e,r,n){pe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Q=e,J=r,t.width=Math.floor(e*$),t.height=Math.floor(r*$),!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new o),e.set(Q*$,J*$).floor()},this.setDrawingBufferSize=function(e,r,n){Q=e,J=r,$=n,t.width=Math.floor(e*n),t.height=Math.floor(r*n),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new h),e.copy(q)},this.getViewport=function(e){return e.copy(re)},this.setViewport=function(e,t,r,n){e.isVector4?re.set(e.x,e.y,e.z,e.w):re.set(e,t,r,n),b.viewport(q.copy(re).multiplyScalar($).floor())},this.getScissor=function(e){return e.copy(ne)},this.setScissor=function(e,t,r,n){e.isVector4?ne.set(e.x,e.y,e.z,e.w):ne.set(e,t,r,n),b.scissor(Z.copy(ne).multiplyScalar($).floor())},this.getScissorTest=function(){return ie},this.setScissorTest=function(e){b.setScissorTest(ie=e)},this.setOpaqueSort=function(e){ee=e},this.setTransparentSort=function(e){te=e},this.getClearColor=function(){return L.getClearColor()},this.setClearColor=function(){L.setClearColor.apply(L,arguments)},this.getClearAlpha=function(){return L.getClearAlpha()},this.setClearAlpha=function(){L.setClearAlpha.apply(L,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===r||r)&&(n|=1024),g.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",ve,!1),k.dispose(),P.dispose(),w.dispose(),A.dispose(),pe.dispose(),we.stop()},this.renderBufferImmediate=function(e,t){b.initAttributes();var r=w.get(e);e.hasPositions&&!r.position&&(r.position=g.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=g.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=g.createBuffer()),e.hasColors&&!r.color&&(r.color=g.createBuffer());var n=t.getAttributes();e.hasPositions&&(g.bindBuffer(34962,r.position),g.bufferData(34962,e.positionArray,35048),b.enableAttribute(n.position),g.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(g.bindBuffer(34962,r.normal),g.bufferData(34962,e.normalArray,35048),b.enableAttribute(n.normal),g.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(g.bindBuffer(34962,r.uv),g.bufferData(34962,e.uvArray,35048),b.enableAttribute(n.uv),g.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(g.bindBuffer(34962,r.color),g.bufferData(34962,e.colorArray,35048),b.enableAttribute(n.color),g.vertexAttribPointer(n.color,3,5126,!1,0,0)),b.disableUnusedAttributes(),g.drawArrays(4,0,e.count),e.count=0};var be=new G;this.renderBufferDirect=function(e,t,r,n,i,a){null===t&&(t=be);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=Ae(e,t,n,i);b.setMaterial(n,o);var l=!1;W.geometry===r.id&&W.program===s.id&&W.wireframe===(!0===n.wireframe)||(W.geometry=r.id,W.program=s.id,W.wireframe=!0===n.wireframe,l=!0),(n.morphTargets||n.morphNormals)&&(C.update(i,r,n,s),l=!0);var u=r.index,c=r.attributes.position;if(null===u){if(void 0===c||0===c.count)return}else if(0===u.count)return;var h,d=1;!0===n.wireframe&&(u=S.getWireframeAttribute(r),d=2);var f=I;null!==u&&(h=T.get(u),(f=H).setIndex(h)),l&&(function(e,t,r,n){if(!1!==_.isWebGL2||!e.isInstancedMesh&&!t.isInstancedBufferGeometry||null!==y.get("ANGLE_instanced_arrays")){b.initAttributes();var i=t.attributes,a=n.getAttributes(),o=r.defaultAttributeValues;for(var s in a){var l=a[s];if(l>=0){var u=i[s];if(void 0!==u){var c=u.normalized,h=u.itemSize;if(void 0===(w=T.get(u)))continue;var d=w.buffer,f=w.type,p=w.bytesPerElement;if(u.isInterleavedBufferAttribute){var m=u.data,v=m.stride,E=u.offset;m&&m.isInstancedInterleavedBuffer?(b.enableAttributeAndDivisor(l,m.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=m.meshPerAttribute*m.count)):b.enableAttribute(l),g.bindBuffer(34962,d),g.vertexAttribPointer(l,h,f,c,v*p,E*p)}else u.isInstancedBufferAttribute?(b.enableAttributeAndDivisor(l,u.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=u.meshPerAttribute*u.count)):b.enableAttribute(l),g.bindBuffer(34962,d),g.vertexAttribPointer(l,h,f,c,0,0)}else if("instanceMatrix"===s){var w;if(void 0===(w=T.get(e.instanceMatrix)))continue;d=w.buffer,f=w.type,b.enableAttributeAndDivisor(l+0,1),b.enableAttributeAndDivisor(l+1,1),b.enableAttributeAndDivisor(l+2,1),b.enableAttributeAndDivisor(l+3,1),g.bindBuffer(34962,d),g.vertexAttribPointer(l+0,4,f,!1,64,0),g.vertexAttribPointer(l+1,4,f,!1,64,16),g.vertexAttribPointer(l+2,4,f,!1,64,32),g.vertexAttribPointer(l+3,4,f,!1,64,48)}else if(void 0!==o){var x=o[s];if(void 0!==x)switch(x.length){case 2:g.vertexAttrib2fv(l,x);break;case 3:g.vertexAttrib3fv(l,x);break;case 4:g.vertexAttrib4fv(l,x);break;default:g.vertexAttrib1fv(l,x)}}}}b.disableUnusedAttributes()}}(i,r,n,s),null!==u&&g.bindBuffer(34963,h.buffer));var p=null!==u?u.count:c.count,m=r.drawRange.start*d,v=r.drawRange.count*d,E=null!==a?a.start*d:0,w=null!==a?a.count*d:1/0,x=Math.max(m,E),M=Math.min(p,m+v,E+w)-1,A=Math.max(0,M-x+1);if(0!==A){if(i.isMesh)!0===n.wireframe?(b.setLineWidth(n.wireframeLinewidth*he()),f.setMode(1)):f.setMode(4);else if(i.isLine){var R=n.linewidth;void 0===R&&(R=1),b.setLineWidth(R*he()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);i.isInstancedMesh?f.renderInstances(r,x,A,i.count):r.isInstancedBufferGeometry?f.renderInstances(r,x,A,r.maxInstancedCount):f.render(x,A)}},this.compile=function(e,t){(m=P.get(e,t)).init(),e.traverse((function(e){e.isLight&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(t);var r={};e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)t.material[n].uuid in r==0&&(Se(t.material[n],e,t),r[t.material[n].uuid]=!0);else t.material.uuid in r==0&&(Se(t.material,e,t),r[t.material.uuid]=!0)}))};var Ee=null,we=new Zt;function xe(e,t,r,n){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ae.intersectsSprite(e)){n&&ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue);var i=A.update(e);(a=e.material).visible&&p.push(e,i,a,r,ce.z,null)}}else if(e.isImmediateRenderObject)n&&ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue),p.push(e,null,e.material,r,ce.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==E.render.frame&&(e.skeleton.update(),e.skeleton.frame=E.render.frame),!e.frustumCulled||ae.intersectsObject(e))){n&&ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue),i=A.update(e);var a=e.material;if(Array.isArray(a))for(var o=i.groups,s=0,l=o.length;s<l;s++){var u=o[s],c=a[u.materialIndex];c&&c.visible&&p.push(e,i,c,r,ce.z,u)}else a.visible&&p.push(e,i,a,r,ce.z,null)}var h=e.children;for(s=0,l=h.length;s<l;s++)xe(h[s],t,r,n)}}function Te(e,t,r,n){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,u=void 0===n?o.material:n,c=o.group;if(r.isArrayCamera){Y=r;for(var h=r.cameras,d=0,f=h.length;d<f;d++){var p=h[d];s.layers.test(p.layers)&&(b.viewport(q.copy(p.viewport)),m.setupLights(p),Me(s,t,p,l,u,c))}}else Y=null,Me(s,t,r,l,u,c)}}function Me(e,t,r,n,i,a){if(e.onBeforeRender(D,t,r,n,i,a),m=P.get(t,Y||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Ae(r,t,i,e);b.setMaterial(i),W.geometry=null,W.program=null,W.wireframe=!1,function(e,t){e.render((function(e){D.renderBufferImmediate(e,t)}))}(e,o)}else D.renderBufferDirect(r,t,n,i,e,a);e.onAfterRender(D,t,r,n,i,a),m=P.get(t,Y||r)}function Se(e,t,r){var n=w.get(e),i=m.state.lights,a=m.state.shadowsArray,o=i.state.version,s=R.getParameters(e,i.state,a,t,oe.numPlanes,oe.numIntersection,r),l=R.getProgramCacheKey(s),u=n.program,c=!0;if(void 0===u)e.addEventListener("dispose",ye);else if(u.cacheKey!==l)_e(e);else if(n.lightsStateVersion!==o)n.lightsStateVersion=o,c=!1;else{if(void 0!==s.shaderID)return;c=!1}c&&(u=R.acquireProgram(s,l),n.program=u,n.uniforms=s.uniforms,n.environment=e.isMeshStandardMaterial?t.environment:null,n.outputEncoding=D.outputEncoding,e.program=u);var h=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var d=0;d<D.maxMorphTargets;d++)h["morphTarget"+d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,d=0;d<D.maxMorphNormals;d++)h["morphNormal"+d]>=0&&e.numSupportedMorphNormals++;var f=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=oe.numPlanes,n.numIntersection=oe.numIntersection,f.clippingPlanes=oe.uniform),n.fog=t.fog,n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(f.ambientLightColor.value=i.state.ambient,f.lightProbe.value=i.state.probe,f.directionalLights.value=i.state.directional,f.directionalLightShadows.value=i.state.directionalShadow,f.spotLights.value=i.state.spot,f.spotLightShadows.value=i.state.spotShadow,f.rectAreaLights.value=i.state.rectArea,f.pointLights.value=i.state.point,f.pointLightShadows.value=i.state.pointShadow,f.hemisphereLights.value=i.state.hemi,f.directionalShadowMap.value=i.state.directionalShadowMap,f.directionalShadowMatrix.value=i.state.directionalShadowMatrix,f.spotShadowMap.value=i.state.spotShadowMap,f.spotShadowMatrix.value=i.state.spotShadowMatrix,f.pointShadowMap.value=i.state.pointShadowMap,f.pointShadowMatrix.value=i.state.pointShadowMatrix);var p=n.program.getUniforms(),g=cn.seqWithValue(p.seq,f);n.uniformsList=g}function Ae(e,t,r,n){x.resetTextureUnits();var i=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=w.get(r),l=m.state.lights;if(se&&(le||e!==X)){var u=e===X&&r.id===V;oe.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,s,u)}r.version===s.__version?void 0===s.program||r.fog&&s.fog!==i||s.environment!==o||s.needsLights&&s.lightsStateVersion!==l.state.version?Se(r,t,n):void 0===s.numClippingPlanes||s.numClippingPlanes===oe.numPlanes&&s.numIntersection===oe.numIntersection?s.outputEncoding!==D.outputEncoding&&Se(r,t,n):Se(r,t,n):(Se(r,t,n),s.__version=r.version);var c,h,d=!1,f=!1,p=!1,v=s.program,y=v.getUniforms(),E=s.uniforms;if(b.useProgram(v.program)&&(d=!0,f=!0,p=!0),r.id!==V&&(V=r.id,f=!0),d||X!==e){if(y.setValue(g,"projectionMatrix",e.projectionMatrix),_.logarithmicDepthBuffer&&y.setValue(g,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),X!==e&&(X=e,f=!0,p=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var T=y.map.cameraPosition;void 0!==T&&T.setValue(g,ce.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&y.setValue(g,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&y.setValue(g,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){y.setOptional(g,n,"bindMatrix"),y.setOptional(g,n,"bindMatrixInverse");var M=n.skeleton;if(M){var S=M.bones;if(_.floatVertexTextures){if(void 0===M.boneTexture){var A=Math.sqrt(4*S.length);A=a.ceilPowerOfTwo(A),A=Math.max(A,4);var R=new Float32Array(A*A*4);R.set(M.boneMatrices);var k=new Gt(R,A,A,1023,1015);M.boneMatrices=R,M.boneTexture=k,M.boneTextureSize=A}y.setValue(g,"boneTexture",M.boneTexture,x),y.setValue(g,"boneTextureSize",M.boneTextureSize)}else y.setOptional(g,M,"boneMatrices")}}return(f||s.receiveShadow!==n.receiveShadow)&&(s.receiveShadow=n.receiveShadow,y.setValue(g,"receiveShadow",n.receiveShadow)),f&&(y.setValue(g,"toneMappingExposure",D.toneMappingExposure),y.setValue(g,"toneMappingWhitePoint",D.toneMappingWhitePoint),s.needsLights&&(h=p,(c=E).ambientLightColor.needsUpdate=h,c.lightProbe.needsUpdate=h,c.directionalLights.needsUpdate=h,c.directionalLightShadows.needsUpdate=h,c.pointLights.needsUpdate=h,c.pointLightShadows.needsUpdate=h,c.spotLights.needsUpdate=h,c.spotLightShadows.needsUpdate=h,c.rectAreaLights.needsUpdate=h,c.hemisphereLights.needsUpdate=h),i&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(E,i),r.isMeshBasicMaterial?Re(E,r):r.isMeshLambertMaterial?(Re(E,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(E,r)):r.isMeshToonMaterial?(Re(E,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isMeshPhongMaterial?(Re(E,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isMeshStandardMaterial?(Re(E,r,o),r.isMeshPhysicalMaterial?function(e,t,r){ke(e,t,r),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()),e.transparency.value=t.transparency}(E,r,o):ke(E,r,o)):r.isMeshMatcapMaterial?(Re(E,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isMeshDepthMaterial?(Re(E,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isMeshDistanceMaterial?(Re(E,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(E,r)):r.isMeshNormalMaterial?(Re(E,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(E,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(E,r)):r.isPointsMaterial?function(e,t){var r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*$,e.scale.value=.5*J,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(E,r):r.isSpriteMaterial?function(e,t){var r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(E,r):r.isShadowMaterial&&(E.color.value.copy(r.color),E.opacity.value=r.opacity),void 0!==E.ltc_1&&(E.ltc_1.value=qt.LTC_1),void 0!==E.ltc_2&&(E.ltc_2.value=qt.LTC_2),cn.upload(g,s.uniformsList,E,x),r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(cn.upload(g,s.uniformsList,E,x),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&y.setValue(g,"center",n.center),y.setValue(g,"modelViewMatrix",n.modelViewMatrix),y.setValue(g,"normalMatrix",n.normalMatrix),y.setValue(g,"modelMatrix",n.matrixWorld),v}function Re(e,t,r){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var n,i,a=t.envMap||r;a&&(e.envMap.value=a,e.flipEnvMap.value=a.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=w.get(a).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix)),t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function ke(e,t,r){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||r)&&(e.envMapIntensity.value=t.envMapIntensity)}we.setAnimationLoop((function(e){pe.isPresenting||Ee&&Ee(e)})),"undefined"!=typeof window&&we.setContext(window),this.setAnimationLoop=function(e){Ee=e,pe.setAnimationLoop(e),we.start()},this.render=function(e,t){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),t&&t.isCamera){if(!F){W.geometry=null,W.program=null,W.wireframe=!1,V=-1,X=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),pe.enabled&&pe.isPresenting&&(t=pe.getCamera(t)),(m=P.get(e,t)).init(),e.onBeforeRender(D,e,t,r||z),ue.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ae.setFromProjectionMatrix(ue),le=this.localClippingEnabled,se=oe.init(this.clippingPlanes,le,t),(p=k.get(e,t)).init(),xe(e,t,0,D.sortObjects),p.finish(),!0===D.sortObjects&&p.sort(ee,te),se&&oe.beginShadows();var i=m.state.shadowsArray;me.render(i,e,t),m.setupLights(t),se&&oe.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),L.render(p,e,t,n);var a=p.opaque,o=p.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&Te(a,e,t,s),o.length&&Te(o,e,t,s)}else a.length&&Te(a,e,t),o.length&&Te(o,e,t);e.onAfterRender(D,e,t),null!==z&&(x.updateRenderTargetMipmap(z),x.updateMultisampleRenderTarget(z)),b.buffers.depth.setTest(!0),b.buffers.depth.setMask(!0),b.buffers.color.setMask(!0),b.setPolygonOffset(!1),p=null,m=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){N!==e&&null===z&&g.bindFramebuffer(36160,e),N=e},this.getActiveCubeFace=function(){return U},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return z},this.setRenderTarget=function(e,t,r){z=e,U=t,B=r,e&&void 0===w.get(e).__webglFramebuffer&&x.setupRenderTarget(e);var n=N,i=!1;if(e){var a=w.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=a[t||0],i=!0):n=e.isWebGLMultisampleRenderTarget?w.get(e).__webglMultisampledFramebuffer:a,q.copy(e.viewport),Z.copy(e.scissor),K=e.scissorTest}else q.copy(re).multiplyScalar($).floor(),Z.copy(ne).multiplyScalar($).floor(),K=ie;if(j!==n&&(g.bindFramebuffer(36160,n),j=n),b.viewport(q),b.scissor(Z),b.setScissorTest(K),i){var o=w.get(e.texture);g.framebufferTexture2D(36160,36064,34069+(t||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,n,i,a,o){if(e&&e.isWebGLRenderTarget){var s=w.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){var l=!1;s!==j&&(g.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(1023!==c&&O.convert(c)!==g.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===h||O.convert(h)===g.getParameter(35738)||1015===h&&(_.isWebGL2||y.get("OES_texture_float")||y.get("WEBGL_color_buffer_float"))||1016===h&&(_.isWebGL2?y.get("EXT_color_buffer_float"):y.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===g.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&g.readPixels(t,r,n,i,O.convert(c),O.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&g.bindFramebuffer(36160,j)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){void 0===r&&(r=0);var n=Math.pow(2,-r),i=Math.floor(t.image.width*n),a=Math.floor(t.image.height*n),o=O.convert(t.format);x.setTexture2D(t,0),g.copyTexImage2D(3553,r,o,e.x,e.y,i,a,0),b.unbindTexture()},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,a=t.image.height,o=O.convert(r.format),s=O.convert(r.type);x.setTexture2D(r,0),t.isDataTexture?g.texSubImage2D(3553,n||0,e.x,e.y,i,a,o,s,t.image.data):g.texSubImage2D(3553,n||0,e.x,e.y,o,s,t.image),b.unbindTexture()},this.initTexture=function(e){x.setTexture2D(e,0),b.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Kn(e,t){this.name="",this.color=new He(e),this.density=void 0!==t?t:25e-5}function Qn(e,t,r){this.name="",this.color=new He(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function Jn(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}Bn.prototype=Object.create(Be.prototype),Bn.prototype.constructor=Bn,Bn.prototype.isMeshDepthMaterial=!0,Bn.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},zn.prototype=Object.create(Be.prototype),zn.prototype.constructor=zn,zn.prototype.isMeshDistanceMaterial=!0,zn.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Xn.prototype=Object.assign(Object.create(zt.prototype),{constructor:Xn,isArrayCamera:!0}),Yn.prototype=Object.assign(Object.create(V.prototype),{constructor:Yn,isGroup:!0}),Object.assign(qn.prototype,t.prototype),Object.assign(Kn.prototype,{isFogExp2:!0,clone:function(){return new Kn(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Qn.prototype,{isFog:!0,clone:function(){return new Qn(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Jn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Jn.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var $n,ei=new v;function ti(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function ri(e){Be.call(this),this.type="SpriteMaterial",this.color=new He(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(ti.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(ti.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,r=this.data.count;t<r;t++)ei.x=this.getX(t),ei.y=this.getY(t),ei.z=this.getZ(t),ei.applyMatrix4(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),ri.prototype=Object.create(Be.prototype),ri.prototype.constructor=ri,ri.prototype.isSpriteMaterial=!0,ri.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var ni=new v,ii=new v,ai=new v,oi=new o,si=new o,li=new M,ui=new v,ci=new v,hi=new v,di=new o,fi=new o,pi=new o;function mi(e){if(V.call(this),this.type="Sprite",void 0===$n){$n=new lt;var t=new Jn(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);$n.setIndex([0,1,2,0,2,3]),$n.setAttribute("position",new ti(t,3,0,!1)),$n.setAttribute("uv",new ti(t,2,3,!1))}this.geometry=$n,this.material=void 0!==e?e:new ri,this.center=new o(.5,.5)}function gi(e,t,r,n,i,a){oi.subVectors(e,r).addScalar(.5).multiply(n),void 0!==i?(si.x=a*oi.x-i*oi.y,si.y=i*oi.x+a*oi.y):si.copy(oi),e.copy(t),e.x+=si.x,e.y+=si.y,e.applyMatrix4(li)}mi.prototype=Object.assign(Object.create(V.prototype),{constructor:mi,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ii.setFromMatrixScale(this.matrixWorld),li.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ai.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ii.multiplyScalar(-ai.z);var r,n,i=this.material.rotation;0!==i&&(n=Math.cos(i),r=Math.sin(i));var a=this.center;gi(ui.set(-.5,-.5,0),ai,a,ii,r,n),gi(ci.set(.5,-.5,0),ai,a,ii,r,n),gi(hi.set(.5,.5,0),ai,a,ii,r,n),di.set(0,0),fi.set(1,0),pi.set(1,1);var s=e.ray.intersectTriangle(ui,ci,hi,!1,ni);if(null!==s||(gi(ci.set(-.5,.5,0),ai,a,ii,r,n),fi.set(0,1),null!==(s=e.ray.intersectTriangle(ui,hi,ci,!1,ni)))){var l=e.ray.origin.distanceTo(ni);l<e.near||l>e.far||t.push({distance:l,point:ni.clone(),uv:Pe.getUV(ni,ui,ci,hi,di,fi,pi,new o),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return V.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var vi=new v,yi=new v;function _i(){V.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function bi(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),St.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new M,this.bindMatrixInverse=new M}_i.prototype=Object.assign(Object.create(V.prototype),{constructor:_i,isLOD:!0,copy:function(e){V.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object}return null},raycast:function(e,t){if(this.levels.length>0){vi.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(vi);this.getObjectForDistance(r).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){vi.setFromMatrixPosition(e.matrixWorld),yi.setFromMatrixPosition(this.matrixWorld);var r=vi.distanceTo(yi)/e.zoom;t[0].object.visible=!0;for(var n=1,i=t.length;n<i&&r>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)t[n].object.visible=!1}},toJSON:function(e){var t=V.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var a=r[n];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),bi.prototype=Object.assign(Object.create(St.prototype),{constructor:bi,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new h,t=this.geometry.attributes.skinWeight,r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){St.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ei=new M,wi=new M;function xi(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new M)}}function Ti(){V.call(this),this.type="Bone"}Object.assign(xi.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new M;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:wi;Ei.multiplyMatrices(o,t[i]),Ei.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new xi(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),Ti.prototype=Object.assign(Object.create(V.prototype),{constructor:Ti,isBone:!0});var Mi=new M,Si=new M,Ai=[],Ri=new St;function ki(e,t,r){St.call(this,e,t),this.instanceMatrix=new Ve(new Float32Array(16*r),16),this.count=r,this.frustumCulled=!1}function Pi(e){Be.call(this),this.type="LineBasicMaterial",this.color=new He(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}ki.prototype=Object.assign(Object.create(St.prototype),{constructor:ki,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var r=this.matrixWorld,n=this.count;if(Ri.geometry=this.geometry,Ri.material=this.material,void 0!==Ri.material)for(var i=0;i<n;i++)this.getMatrixAt(i,Mi),Si.multiplyMatrices(r,Mi),Ri.matrixWorld=Si,Ri.raycast(e,Ai),Ai.length>0&&(Ai[0].instanceId=i,Ai[0].object=this,t.push(Ai[0]),Ai.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),Pi.prototype=Object.create(Be.prototype),Pi.prototype.constructor=Pi,Pi.prototype.isLineBasicMaterial=!0,Pi.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var Li=new v,Ci=new v,Ii=new M,Hi=new me,Oi=new se;function Di(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),V.call(this),this.type="Line",this.geometry=void 0!==e?e:new lt,this.material=void 0!==t?t:new Pi}Di.prototype=Object.assign(Object.create(V.prototype),{constructor:Di,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)Li.fromBufferAttribute(t,n-1),Ci.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=Li.distanceTo(Ci);e.setAttribute("lineDistance",new Qe(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;for((r=e.lineDistances)[0]=0,n=1,i=a.length;n<i;n++)r[n]=r[n-1],r[n]+=a[n-1].distanceTo(a[n])}return this},raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,i=e.params.Line.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),Oi.copy(r.boundingSphere),Oi.applyMatrix4(n),Oi.radius+=i,!1!==e.ray.intersectsSphere(Oi)){Ii.getInverse(n),Hi.copy(e.ray).applyMatrix4(Ii);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new v,l=new v,u=new v,c=new v,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var d=r.index,f=r.attributes.position.array;if(null!==d)for(var p=d.array,m=0,g=p.length-1;m<g;m+=h){var y=p[m],_=p[m+1];s.fromArray(f,3*y),l.fromArray(f,3*_),Hi.distanceSqToSegment(s,l,c,u)>o||(c.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(c))<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else for(m=0,g=f.length/3-1;m<g;m+=h)s.fromArray(f,3*m),l.fromArray(f,3*m+3),Hi.distanceSqToSegment(s,l,c,u)>o||(c.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(c))<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else if(r.isGeometry){var b=r.vertices,E=b.length;for(m=0;m<E-1;m+=h){var w;Hi.distanceSqToSegment(b[m],b[m+1],c,u)>o||(c.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(c))<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Fi=new v,Ni=new v;function Ui(e,t){Di.call(this,e,t),this.type="LineSegments"}function Bi(e,t){Di.call(this,e,t),this.type="LineLoop"}function zi(e){Be.call(this),this.type="PointsMaterial",this.color=new He(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Ui.prototype=Object.assign(Object.create(Di.prototype),{constructor:Ui,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[],n=0,i=t.count;n<i;n+=2)Fi.fromBufferAttribute(t,n),Ni.fromBufferAttribute(t,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Fi.distanceTo(Ni);e.setAttribute("lineDistance",new Qe(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;for(r=e.lineDistances,n=0,i=a.length;n<i;n+=2)Fi.copy(a[n]),Ni.copy(a[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Fi.distanceTo(Ni)}return this}}),Bi.prototype=Object.assign(Object.create(Di.prototype),{constructor:Bi,isLineLoop:!0}),zi.prototype=Object.create(Be.prototype),zi.prototype.constructor=zi,zi.prototype.isPointsMaterial=!0,zi.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var ji=new M,Vi=new me,Gi=new se,Wi=new v;function Xi(e,t){V.call(this),this.type="Points",this.geometry=void 0!==e?e:new lt,this.material=void 0!==t?t:new zi,this.updateMorphTargets()}function Yi(e,t,r,n,i,a,o){var s=Vi.distanceSqToPoint(e);if(s<r){var l=new v;Vi.closestPointToPoint(e,l),l.applyMatrix4(n);var u=i.ray.origin.distanceTo(l);if(u<i.near||u>i.far)return;a.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}function qi(e,t,r,n,i,a,o,s,l){c.call(this,e,t,r,n,i,a,o,s,l),this.format=void 0!==o?o:1022,this.minFilter=void 0!==a?a:1006,this.magFilter=void 0!==i?i:1006,this.generateMipmaps=!1}function Zi(e,t,r,n,i,a,o,s,l,u,h,d){c.call(this,null,a,o,s,l,u,n,i,h,d),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Ki(e,t,r,n,i,a,o,s,l){c.call(this,e,t,r,n,i,a,o,s,l),this.needsUpdate=!0}function Qi(e,t,r,n,i,a,o,s,l,u){if(1026!==(u=void 0!==u?u:1026)&&1027!==u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&1026===u&&(r=1012),void 0===r&&1027===u&&(r=1020),c.call(this,null,n,i,a,o,s,u,r,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:1003,this.minFilter=void 0!==s?s:1003,this.flipY=!1,this.generateMipmaps=!1}function Ji(e){lt.call(this),this.type="WireframeGeometry";var t,r,n,i,a,o,s,l,u,c,h=[],d=[0,0],f={},p=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var g=m[t];for(r=0;r<3;r++)s=g[p[r]],l=g[p[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]})}for(u in f)o=f[u],c=e.vertices[o.index1],h.push(c.x,c.y,c.z),c=e.vertices[o.index2],h.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var y,_,b,E,w,x,T;if(c=new v,null!==e.index){for(y=e.attributes.position,_=e.index,0===(b=e.groups).length&&(b=[{start:0,count:_.count,materialIndex:0}]),i=0,a=b.length;i<a;++i)for(t=w=(E=b[i]).start,n=w+E.count;t<n;t+=3)for(r=0;r<3;r++)s=_.getX(t+r),l=_.getX(t+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]});for(u in f)o=f[u],c.fromBufferAttribute(y,o.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(y,o.index2),h.push(c.x,c.y,c.z)}else for(t=0,n=(y=e.attributes.position).count/3;t<n;t++)for(r=0;r<3;r++)x=3*t+r,c.fromBufferAttribute(y,x),h.push(c.x,c.y,c.z),T=3*t+(r+1)%3,c.fromBufferAttribute(y,T),h.push(c.x,c.y,c.z)}this.setAttribute("position",new Qe(h,3))}function $i(e,t,r){It.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new ea(e,t,r)),this.mergeVertices()}function ea(e,t,r){lt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,a=[],o=[],s=[],l=[],u=1e-5,c=new v,h=new v,d=new v,f=new v,p=new v;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=t+1;for(n=0;n<=r;n++){var g=n/r;for(i=0;i<=t;i++){var y=i/t;e(y,g,h),o.push(h.x,h.y,h.z),y-u>=0?(e(y-u,g,d),f.subVectors(h,d)):(e(y+u,g,d),f.subVectors(d,h)),g-u>=0?(e(y,g-u,d),p.subVectors(h,d)):(e(y,g+u,d),p.subVectors(d,h)),c.crossVectors(f,p).normalize(),s.push(c.x,c.y,c.z),l.push(y,g)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var _=n*m+i,b=n*m+i+1,E=(n+1)*m+i+1,w=(n+1)*m+i;a.push(_,b,w),a.push(b,E,w)}this.setIndex(a),this.setAttribute("position",new Qe(o,3)),this.setAttribute("normal",new Qe(s,3)),this.setAttribute("uv",new Qe(l,2))}function ta(e,t,r,n){It.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new ra(e,t,r,n)),this.mergeVertices()}function ra(e,t,r,n){lt.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],a=[];function s(e,t,r,n){var i,a,o=Math.pow(2,n),s=[];for(i=0;i<=o;i++){s[i]=[];var u=e.clone().lerp(r,i/o),c=t.clone().lerp(r,i/o),h=o-i;for(a=0;a<=h;a++)s[i][a]=0===a&&i===o?u:u.clone().lerp(c,a/h)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var d=Math.floor(a/2);a%2==0?(l(s[i][d+1]),l(s[i+1][d]),l(s[i][d])):(l(s[i][d+1]),l(s[i+1][d+1]),l(s[i+1][d]))}}function l(e){i.push(e.x,e.y,e.z)}function u(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function c(e,t,r,n){n<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){for(var r=new v,n=new v,i=new v,a=0;a<t.length;a+=3)u(t[a+0],r),u(t[a+1],n),u(t[a+2],i),s(r,n,i,e)}(n=n||0),function(e){for(var t=new v,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){for(var e=new v,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=h(e)/2/Math.PI+.5,n=(s=e,Math.atan2(-s.y,Math.sqrt(s.x*s.x+s.z*s.z))/Math.PI+.5);a.push(r,1-n)}var s;(function(){for(var e=new v,t=new v,r=new v,n=new v,s=new o,l=new o,u=new o,d=0,f=0;d<i.length;d+=9,f+=6){e.set(i[d+0],i[d+1],i[d+2]),t.set(i[d+3],i[d+4],i[d+5]),r.set(i[d+6],i[d+7],i[d+8]),s.set(a[f+0],a[f+1]),l.set(a[f+2],a[f+3]),u.set(a[f+4],a[f+5]),n.copy(e).add(t).add(r).divideScalar(3);var p=h(n);c(s,f+0,e,p),c(l,f+2,t,p),c(u,f+4,r,p)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],r=a[e+2],n=a[e+4],i=Math.max(t,r,n),o=Math.min(t,r,n);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Qe(i,3)),this.setAttribute("normal",new Qe(i.slice(),3)),this.setAttribute("uv",new Qe(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function na(e,t){It.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ia(e,t)),this.mergeVertices()}function ia(e,t){ra.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function aa(e,t){It.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new oa(e,t)),this.mergeVertices()}function oa(e,t){ra.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function sa(e,t){It.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new la(e,t)),this.mergeVertices()}function la(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];ra.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ua(e,t){It.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ca(e,t)),this.mergeVertices()}function ca(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];ra.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ha(e,t,r,n,i,a){It.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new da(e,t,r,n,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function da(e,t,r,n,i){lt.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var s,l,u=new v,c=new v,h=new o,d=new v,f=[],p=[],m=[],g=[];function y(i){d=e.getPointAt(i/t,d);var o=a.normals[i],s=a.binormals[i];for(l=0;l<=n;l++){var h=l/n*Math.PI*2,m=Math.sin(h),g=-Math.cos(h);c.x=g*o.x+m*s.x,c.y=g*o.y+m*s.y,c.z=g*o.z+m*s.z,c.normalize(),p.push(c.x,c.y,c.z),u.x=d.x+r*c.x,u.y=d.y+r*c.y,u.z=d.z+r*c.z,f.push(u.x,u.y,u.z)}}!function(){for(s=0;s<t;s++)y(s);y(!1===i?t:0),function(){for(s=0;s<=t;s++)for(l=0;l<=n;l++)h.x=s/t,h.y=l/n,m.push(h.x,h.y)}(),function(){for(l=1;l<=t;l++)for(s=1;s<=n;s++){var e=(n+1)*(l-1)+(s-1),r=(n+1)*l+(s-1),i=(n+1)*l+s,a=(n+1)*(l-1)+s;g.push(e,r,a),g.push(r,i,a)}}()}(),this.setIndex(g),this.setAttribute("position",new Qe(f,3)),this.setAttribute("normal",new Qe(p,3)),this.setAttribute("uv",new Qe(m,2))}function fa(e,t,r,n,i,a,o){It.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new pa(e,t,r,n,i,a)),this.mergeVertices()}function pa(e,t,r,n,i,a){lt.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,a=a||3;var o,s,l=[],u=[],c=[],h=[],d=new v,f=new v,p=new v,m=new v,g=new v,y=new v,_=new v;for(o=0;o<=r;++o){var b=o/r*i*Math.PI*2;for(R(b,i,a,e,p),R(b+.01,i,a,e,m),y.subVectors(m,p),_.addVectors(m,p),g.crossVectors(y,_),_.crossVectors(g,y),g.normalize(),_.normalize(),s=0;s<=n;++s){var E=s/n*Math.PI*2,w=-t*Math.cos(E),x=t*Math.sin(E);d.x=p.x+(w*_.x+x*g.x),d.y=p.y+(w*_.y+x*g.y),d.z=p.z+(w*_.z+x*g.z),u.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),c.push(f.x,f.y,f.z),h.push(o/r),h.push(s/n)}}for(s=1;s<=r;s++)for(o=1;o<=n;o++){var T=(n+1)*(s-1)+(o-1),M=(n+1)*s+(o-1),S=(n+1)*s+o,A=(n+1)*(s-1)+o;l.push(T,M,A),l.push(M,S,A)}function R(e,t,r,n,i){var a=Math.cos(e),o=Math.sin(e),s=r/t*e,l=Math.cos(s);i.x=n*(2+l)*.5*a,i.y=n*(2+l)*o*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.setAttribute("position",new Qe(u,3)),this.setAttribute("normal",new Qe(c,3)),this.setAttribute("uv",new Qe(h,2))}function ma(e,t,r,n,i){It.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new ga(e,t,r,n,i)),this.mergeVertices()}function ga(e,t,r,n,i){lt.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var a,o,s=[],l=[],u=[],c=[],h=new v,d=new v,f=new v;for(a=0;a<=r;a++)for(o=0;o<=n;o++){var p=o/n*i,m=a/r*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(p),d.y=(e+t*Math.cos(m))*Math.sin(p),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),f.subVectors(d,h).normalize(),u.push(f.x,f.y,f.z),c.push(o/n),c.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=n;o++){var g=(n+1)*a+o-1,y=(n+1)*(a-1)+o-1,_=(n+1)*(a-1)+o,b=(n+1)*a+o;s.push(g,y,b),s.push(y,_,b)}this.setIndex(s),this.setAttribute("position",new Qe(l,3)),this.setAttribute("normal",new Qe(u,3)),this.setAttribute("uv",new Qe(c,2))}Xi.prototype=Object.assign(Object.create(V.prototype),{constructor:Xi,isPoints:!0,raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,i=e.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),Gi.copy(r.boundingSphere),Gi.applyMatrix4(n),Gi.radius+=i,!1!==e.ray.intersectsSphere(Gi)){ji.getInverse(n),Vi.copy(e.ray).applyMatrix4(ji);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(r.isBufferGeometry){var s=r.index,l=r.attributes.position.array;if(null!==s)for(var u=s.array,c=0,h=u.length;c<h;c++){var d=u[c];Wi.fromArray(l,3*d),Yi(Wi,d,o,n,e,t,this)}else{c=0;for(var f=l.length/3;c<f;c++)Wi.fromArray(l,3*c),Yi(Wi,c,o,n,e,t,this)}}else{var p=r.vertices;for(c=0,f=p.length;c<f;c++)Yi(p[c],c,o,n,e,t,this)}}},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),qi.prototype=Object.assign(Object.create(c.prototype),{constructor:qi,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Zi.prototype=Object.create(c.prototype),Zi.prototype.constructor=Zi,Zi.prototype.isCompressedTexture=!0,Ki.prototype=Object.create(c.prototype),Ki.prototype.constructor=Ki,Ki.prototype.isCanvasTexture=!0,Qi.prototype=Object.create(c.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isDepthTexture=!0,Ji.prototype=Object.create(lt.prototype),Ji.prototype.constructor=Ji,$i.prototype=Object.create(It.prototype),$i.prototype.constructor=$i,ea.prototype=Object.create(lt.prototype),ea.prototype.constructor=ea,ta.prototype=Object.create(It.prototype),ta.prototype.constructor=ta,ra.prototype=Object.create(lt.prototype),ra.prototype.constructor=ra,na.prototype=Object.create(It.prototype),na.prototype.constructor=na,ia.prototype=Object.create(ra.prototype),ia.prototype.constructor=ia,aa.prototype=Object.create(It.prototype),aa.prototype.constructor=aa,oa.prototype=Object.create(ra.prototype),oa.prototype.constructor=oa,sa.prototype=Object.create(It.prototype),sa.prototype.constructor=sa,la.prototype=Object.create(ra.prototype),la.prototype.constructor=la,ua.prototype=Object.create(It.prototype),ua.prototype.constructor=ua,ca.prototype=Object.create(ra.prototype),ca.prototype.constructor=ca,ha.prototype=Object.create(It.prototype),ha.prototype.constructor=ha,da.prototype=Object.create(lt.prototype),da.prototype.constructor=da,da.prototype.toJSON=function(){var e=lt.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},fa.prototype=Object.create(It.prototype),fa.prototype.constructor=fa,pa.prototype=Object.create(lt.prototype),pa.prototype.constructor=pa,ma.prototype=Object.create(It.prototype),ma.prototype.constructor=ma,ga.prototype=Object.create(lt.prototype),ga.prototype.constructor=ga;var va=function(e,t,r){r=r||2;var n,i,a,o,s,l,u,c=t&&t.length,h=c?t[0]*r:e.length,d=ya(e,0,h,r,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,r,n){var i,a,o,s,l,u=[];for(i=0,a=t.length;i<a;i++)o=t[i]*n,s=i<a-1?t[i+1]*n:e.length,(l=ya(e,o,s,n,!1))===l.next&&(l.steiner=!0),u.push(Ra(l));for(u.sort(Ma),i=0;i<u.length;i++)Sa(u[i],r),r=_a(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=a=e[0],i=o=e[1];for(var p=r;p<h;p+=r)(s=e[p])<n&&(n=s),(l=e[p+1])<i&&(i=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-n,o-i))?1/u:0}return ba(d,f,r,n,i,u),f};function ya(e,t,r,n,i){var a,o;if(i===function(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,r,n)>0)for(a=t;a<r;a+=n)o=Da(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=Da(a,e[a],e[a+1],o);return o&&Ca(o,o.next)&&(Fa(o),o=o.next),o}function _a(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!Ca(n,n.next)&&0!==La(n.prev,n,n.next))n=n.next;else{if(Fa(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function ba(e,t,r,n,i,a,o){if(e){!o&&a&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=Aa(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(e,n,i,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?wa(e,n,i,a):Ea(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),Fa(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?ba(e=xa(e,t,r),t,r,n,i,a,2):2===o&&Ta(e,t,r,n,i,a):ba(_a(e),t,r,n,i,a,1);break}}}function Ea(e){var t=e.prev,r=e,n=e.next;if(La(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(ka(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&La(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function wa(e,t,r,n){var i=e.prev,a=e,o=e.next;if(La(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=Aa(s,l,t,r,n),d=Aa(u,c,t,r,n),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&ka(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&La(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&ka(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&La(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&ka(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&La(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&ka(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&La(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function xa(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!Ca(i,a)&&Ia(i,n,n.next,a)&&Ha(i,a)&&Ha(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),Fa(n),Fa(n.next),n=e=a),n=n.next}while(n!==e);return n}function Ta(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Pa(o,s)){var l=Oa(o,s);return o=_a(o,o.next),l=_a(l,l.next),ba(o,t,r,n,i,a),void ba(l,t,r,n,i,a)}s=s.next}o=o.next}while(o!==e)}function Ma(e,t){return e.x-t.x}function Sa(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,u=r,c=r.x,h=r.y,d=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=c&&i!==n.x&&ka(a<h?i:o,a,c,h,a<h?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&Ha(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=Oa(t,e);_a(r,r.next)}}function Aa(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ra(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function ka(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function Pa(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Ia(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&Ha(e,t)&&Ha(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function La(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ca(e,t){return e.x===t.x&&e.y===t.y}function Ia(e,t,r,n){return!!(Ca(e,r)&&Ca(t,n)||Ca(e,n)&&Ca(r,t))||La(e,t,r)>0!=La(e,t,n)>0&&La(r,n,e)>0!=La(r,n,t)>0}function Ha(e,t){return La(e.prev,e,e.next)<0?La(e,t,e.next)>=0&&La(e,e.prev,t)>=0:La(e,t,e.prev)<0||La(e,e.next,t)<0}function Oa(e,t){var r=new Na(e.i,e.x,e.y),n=new Na(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function Da(e,t,r,n){var i=new Na(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Fa(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Na(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Ua={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return Ua.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];Ba(e),za(r,e);var a=e.length;t.forEach(Ba);for(var o=0;o<t.length;o++)n.push(a),a+=t[o].length,za(r,t[o]);var s=va(r,n);for(o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function Ba(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function za(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function ja(e,t){It.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Va(e,t)),this.mergeVertices()}function Va(e,t){lt.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,n=[],i=[],a=0,s=e.length;a<s;a++)l(e[a]);function l(e){var a=[],s=void 0!==t.curveSegments?t.curveSegments:12,l=void 0!==t.steps?t.steps:1,u=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:h-2,f=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3,m=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:Ga;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=t.amount);var y,_,b,E,w,x,T,M,S=!1;m&&(y=m.getSpacedPoints(l),S=!0,c=!1,_=m.computeFrenetFrames(l,!1),b=new v,E=new v,w=new v),c||(p=0,h=0,d=0,f=0);var A=e.extractPoints(s),R=A.shape,k=A.holes;if(!Ua.isClockWise(R))for(R=R.reverse(),T=0,M=k.length;T<M;T++)x=k[T],Ua.isClockWise(x)&&(k[T]=x.reverse());var P=Ua.triangulateShape(R,k),L=R;for(T=0,M=k.length;T<M;T++)x=k[T],R=R.concat(x);function C(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var I,H,O,D,F,N,U=R.length,B=P.length;function z(e,t,r){var n,i,a,s=e.x-t.x,l=e.y-t.y,u=r.x-e.x,c=r.y-e.y,h=s*s+l*l,d=s*c-l*u;if(Math.abs(d)>Number.EPSILON){var f=Math.sqrt(h),p=Math.sqrt(u*u+c*c),m=t.x-l/f,g=t.y+s/f,v=((r.x-c/p-m)*c-(r.y+u/p-g)*u)/(s*c-l*u),y=(n=m+s*v-e.x)*n+(i=g+l*v-e.y)*i;if(y<=2)return new o(n,i);a=Math.sqrt(y/2)}else{var _=!1;s>Number.EPSILON?u>Number.EPSILON&&(_=!0):s<-Number.EPSILON?u<-Number.EPSILON&&(_=!0):Math.sign(l)===Math.sign(c)&&(_=!0),_?(n=-l,i=s,a=Math.sqrt(h)):(n=s,i=l,a=Math.sqrt(h/2))}return new o(n/a,i/a)}for(var j=[],V=0,G=L.length,W=G-1,X=V+1;V<G;V++,W++,X++)W===G&&(W=0),X===G&&(X=0),j[V]=z(L[V],L[W],L[X]);var Y,q,Z=[],K=j.concat();for(T=0,M=k.length;T<M;T++){for(x=k[T],Y=[],V=0,W=(G=x.length)-1,X=V+1;V<G;V++,W++,X++)W===G&&(W=0),X===G&&(X=0),Y[V]=z(x[V],x[W],x[X]);Z.push(Y),K=K.concat(Y)}for(I=0;I<p;I++){for(O=I/p,D=h*Math.cos(O*Math.PI/2),H=d*Math.sin(O*Math.PI/2)+f,V=0,G=L.length;V<G;V++)J((F=C(L[V],j[V],H)).x,F.y,-D);for(T=0,M=k.length;T<M;T++)for(x=k[T],Y=Z[T],V=0,G=x.length;V<G;V++)J((F=C(x[V],Y[V],H)).x,F.y,-D)}for(H=d+f,V=0;V<U;V++)F=c?C(R[V],K[V],H):R[V],S?(E.copy(_.normals[0]).multiplyScalar(F.x),b.copy(_.binormals[0]).multiplyScalar(F.y),w.copy(y[0]).add(E).add(b),J(w.x,w.y,w.z)):J(F.x,F.y,0);for(q=1;q<=l;q++)for(V=0;V<U;V++)F=c?C(R[V],K[V],H):R[V],S?(E.copy(_.normals[q]).multiplyScalar(F.x),b.copy(_.binormals[q]).multiplyScalar(F.y),w.copy(y[q]).add(E).add(b),J(w.x,w.y,w.z)):J(F.x,F.y,u/l*q);for(I=p-1;I>=0;I--){for(O=I/p,D=h*Math.cos(O*Math.PI/2),H=d*Math.sin(O*Math.PI/2)+f,V=0,G=L.length;V<G;V++)J((F=C(L[V],j[V],H)).x,F.y,u+D);for(T=0,M=k.length;T<M;T++)for(x=k[T],Y=Z[T],V=0,G=x.length;V<G;V++)F=C(x[V],Y[V],H),S?J(F.x,F.y+y[l-1].y,y[l-1].x+D):J(F.x,F.y,u+D)}function Q(e,t){var r,n;for(V=e.length;--V>=0;){r=V,(n=V-1)<0&&(n=e.length-1);var i=0,a=l+2*p;for(i=0;i<a;i++){var o=U*i,s=U*(i+1);ee(t+r+o,t+n+o,t+n+s,t+r+s)}}}function J(e,t,r){a.push(e),a.push(t),a.push(r)}function $(e,t,i){te(e),te(t),te(i);var a=n.length/3,o=g.generateTopUV(r,n,a-3,a-2,a-1);re(o[0]),re(o[1]),re(o[2])}function ee(e,t,i,a){te(e),te(t),te(a),te(t),te(i),te(a);var o=n.length/3,s=g.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);re(s[0]),re(s[1]),re(s[3]),re(s[1]),re(s[2]),re(s[3])}function te(e){n.push(a[3*e+0]),n.push(a[3*e+1]),n.push(a[3*e+2])}function re(e){i.push(e.x),i.push(e.y)}!function(){var e=n.length/3;if(c){var t=0,i=U*t;for(V=0;V<B;V++)$((N=P[V])[2]+i,N[1]+i,N[0]+i);for(i=U*(t=l+2*p),V=0;V<B;V++)$((N=P[V])[0]+i,N[1]+i,N[2]+i)}else{for(V=0;V<B;V++)$((N=P[V])[2],N[1],N[0]);for(V=0;V<B;V++)$((N=P[V])[0]+U*l,N[1]+U*l,N[2]+U*l)}r.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;for(Q(L,t),t+=L.length,T=0,M=k.length;T<M;T++)Q(x=k[T],t),t+=x.length;r.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new Qe(n,3)),this.setAttribute("uv",new Qe(i,2)),this.computeVertexNormals()}ja.prototype=Object.create(It.prototype),ja.prototype.constructor=ja,ja.prototype.toJSON=function(){var e=It.prototype.toJSON.call(this);return Wa(this.parameters.shapes,this.parameters.options,e)},Va.prototype=Object.create(lt.prototype),Va.prototype.constructor=Va,Va.prototype.toJSON=function(){var e=lt.prototype.toJSON.call(this);return Wa(this.parameters.shapes,this.parameters.options,e)};var Ga={generateTopUV:function(e,t,r,n,i){var a=t[3*r],s=t[3*r+1],l=t[3*n],u=t[3*n+1],c=t[3*i],h=t[3*i+1];return[new o(a,s),new o(l,u),new o(c,h)]},generateSideWallUV:function(e,t,r,n,i,a){var s=t[3*r],l=t[3*r+1],u=t[3*r+2],c=t[3*n],h=t[3*n+1],d=t[3*n+2],f=t[3*i],p=t[3*i+1],m=t[3*i+2],g=t[3*a],v=t[3*a+1],y=t[3*a+2];return Math.abs(l-h)<.01?[new o(s,1-u),new o(c,1-d),new o(f,1-m),new o(g,1-y)]:[new o(l,1-u),new o(h,1-d),new o(p,1-m),new o(v,1-y)]}};function Wa(e,t,r){if(r.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var a=e[n];r.shapes.push(a.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function Xa(e,t){It.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Ya(e,t)),this.mergeVertices()}function Ya(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new It;var n=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Va.call(this,n,t),this.type="TextBufferGeometry"}function qa(e,t,r,n,i,a,o){It.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Za(e,t,r,n,i,a,o)),this.mergeVertices()}function Za(e,t,r,n,i,a,o){lt.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,u=Math.min(a+o,Math.PI),c=0,h=[],d=new v,f=new v,p=[],m=[],g=[],y=[];for(l=0;l<=r;l++){var _=[],b=l/r,E=0;for(0==l&&0==a?E=.5/t:l==r&&u==Math.PI&&(E=-.5/t),s=0;s<=t;s++){var w=s/t;d.x=-e*Math.cos(n+w*i)*Math.sin(a+b*o),d.y=e*Math.cos(a+b*o),d.z=e*Math.sin(n+w*i)*Math.sin(a+b*o),m.push(d.x,d.y,d.z),f.copy(d).normalize(),g.push(f.x,f.y,f.z),y.push(w+E,1-b),_.push(c++)}h.push(_)}for(l=0;l<r;l++)for(s=0;s<t;s++){var x=h[l][s+1],T=h[l][s],M=h[l+1][s],S=h[l+1][s+1];(0!==l||a>0)&&p.push(x,T,S),(l!==r-1||u<Math.PI)&&p.push(T,M,S)}this.setIndex(p),this.setAttribute("position",new Qe(m,3)),this.setAttribute("normal",new Qe(g,3)),this.setAttribute("uv",new Qe(y,2))}function Ka(e,t,r,n,i,a){It.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new Qa(e,t,r,n,i,a)),this.mergeVertices()}function Qa(e,t,r,n,i,a){lt.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var s,l,u,c=[],h=[],d=[],f=[],p=e,m=(t-e)/(n=void 0!==n?Math.max(1,n):1),g=new v,y=new o;for(l=0;l<=n;l++){for(u=0;u<=r;u++)s=i+u/r*a,g.x=p*Math.cos(s),g.y=p*Math.sin(s),h.push(g.x,g.y,g.z),d.push(0,0,1),y.x=(g.x/t+1)/2,y.y=(g.y/t+1)/2,f.push(y.x,y.y);p+=m}for(l=0;l<n;l++){var _=l*(r+1);for(u=0;u<r;u++){var b=s=u+_,E=s+r+1,w=s+r+2,x=s+1;c.push(b,E,x),c.push(E,w,x)}}this.setIndex(c),this.setAttribute("position",new Qe(h,3)),this.setAttribute("normal",new Qe(d,3)),this.setAttribute("uv",new Qe(f,2))}function Ja(e,t,r,n){It.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new $a(e,t,r,n)),this.mergeVertices()}function $a(e,t,r,n){lt.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=a.clamp(n,0,2*Math.PI);var i,s,l,u=[],c=[],h=[],d=1/t,f=new v,p=new o;for(s=0;s<=t;s++){var m=r+s*d*n,g=Math.sin(m),y=Math.cos(m);for(l=0;l<=e.length-1;l++)f.x=e[l].x*g,f.y=e[l].y,f.z=e[l].x*y,c.push(f.x,f.y,f.z),p.x=s/t,p.y=l/(e.length-1),h.push(p.x,p.y)}for(s=0;s<t;s++)for(l=0;l<e.length-1;l++){var _=i=l+s*e.length,b=i+e.length,E=i+e.length+1,w=i+1;u.push(_,b,w),u.push(b,E,w)}if(this.setIndex(u),this.setAttribute("position",new Qe(c,3)),this.setAttribute("uv",new Qe(h,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,T=new v,M=new v,S=new v;for(i=t*e.length*3,s=0,l=0;s<e.length;s++,l+=3)T.x=x[l+0],T.y=x[l+1],T.z=x[l+2],M.x=x[i+l+0],M.y=x[i+l+1],M.z=x[i+l+2],S.addVectors(T,M).normalize(),x[l+0]=x[i+l+0]=S.x,x[l+1]=x[i+l+1]=S.y,x[l+2]=x[i+l+2]=S.z}}function eo(e,t){It.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new to(e,t)),this.mergeVertices()}function to(e,t){lt.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],a=[],o=0,s=0;if(!1===Array.isArray(e))u(e);else for(var l=0;l<e.length;l++)u(e[l]),this.addGroup(o,s,l),o+=s,s=0;function u(e){var o,l,u,c=n.length/3,h=e.extractPoints(t),d=h.shape,f=h.holes;for(!1===Ua.isClockWise(d)&&(d=d.reverse()),o=0,l=f.length;o<l;o++)u=f[o],!0===Ua.isClockWise(u)&&(f[o]=u.reverse());var p=Ua.triangulateShape(d,f);for(o=0,l=f.length;o<l;o++)u=f[o],d=d.concat(u);for(o=0,l=d.length;o<l;o++){var m=d[o];n.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}for(o=0,l=p.length;o<l;o++){var g=p[o],v=g[0]+c,y=g[1]+c,_=g[2]+c;r.push(v,y,_),s+=3}}this.setIndex(r),this.setAttribute("position",new Qe(n,3)),this.setAttribute("normal",new Qe(i,3)),this.setAttribute("uv",new Qe(a,2))}function ro(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function no(e,t){lt.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,o,s=[],l=Math.cos(a.DEG2RAD*t),u=[0,0],c={},h=["a","b","c"];e.isBufferGeometry?(o=new It).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var d=o.vertices,f=o.faces,p=0,m=f.length;p<m;p++)for(var g=f[p],v=0;v<3;v++)r=g[h[v]],n=g[h[(v+1)%3]],u[0]=Math.min(r,n),u[1]=Math.max(r,n),void 0===c[i=u[0]+","+u[1]]?c[i]={index1:u[0],index2:u[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var y=c[i];if(void 0===y.face2||f[y.face1].normal.dot(f[y.face2].normal)<=l){var _=d[y.index1];s.push(_.x,_.y,_.z),_=d[y.index2],s.push(_.x,_.y,_.z)}}this.setAttribute("position",new Qe(s,3))}function io(e,t,r,n,i,a,o,s){It.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new ao(e,t,r,n,i,a,o,s)),this.mergeVertices()}function ao(e,t,r,n,i,a,s,l){lt.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:l};var u=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,a=void 0!==a&&a,s=void 0!==s?s:0,l=void 0!==l?l:2*Math.PI;var c=[],h=[],d=[],f=[],p=0,m=[],g=r/2,y=0;function _(r){var i,a,m,_=new o,b=new v,E=0,w=!0===r?e:t,x=!0===r?1:-1;for(a=p,i=1;i<=n;i++)h.push(0,g*x,0),d.push(0,x,0),f.push(.5,.5),p++;for(m=p,i=0;i<=n;i++){var T=i/n*l+s,M=Math.cos(T),S=Math.sin(T);b.x=w*S,b.y=g*x,b.z=w*M,h.push(b.x,b.y,b.z),d.push(0,x,0),_.x=.5*M+.5,_.y=.5*S*x+.5,f.push(_.x,_.y),p++}for(i=0;i<n;i++){var A=a+i,R=m+i;!0===r?c.push(R,R+1,A):c.push(R+1,R,A),E+=3}u.addGroup(y,E,!0===r?1:2),y+=E}!function(){var a,o,_=new v,b=new v,E=0,w=(t-e)/r;for(o=0;o<=i;o++){var x=[],T=o/i,M=T*(t-e)+e;for(a=0;a<=n;a++){var S=a/n,A=S*l+s,R=Math.sin(A),k=Math.cos(A);b.x=M*R,b.y=-T*r+g,b.z=M*k,h.push(b.x,b.y,b.z),_.set(R,w,k).normalize(),d.push(_.x,_.y,_.z),f.push(S,1-T),x.push(p++)}m.push(x)}for(a=0;a<n;a++)for(o=0;o<i;o++){var P=m[o][a],L=m[o+1][a],C=m[o+1][a+1],I=m[o][a+1];c.push(P,L,I),c.push(L,C,I),E+=6}u.addGroup(y,E,0),y+=E}(),!1===a&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Qe(h,3)),this.setAttribute("normal",new Qe(d,3)),this.setAttribute("uv",new Qe(f,2))}function oo(e,t,r,n,i,a,o){io.call(this,0,e,t,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function so(e,t,r,n,i,a,o){ao.call(this,0,e,t,r,n,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function lo(e,t,r,n){It.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new uo(e,t,r,n)),this.mergeVertices()}function uo(e,t,r,n){lt.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,a,s=[],l=[],u=[],c=[],h=new v,d=new o;for(l.push(0,0,0),u.push(0,0,1),c.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var f=r+a/t*n;h.x=e*Math.cos(f),h.y=e*Math.sin(f),l.push(h.x,h.y,h.z),u.push(0,0,1),d.x=(l[i]/e+1)/2,d.y=(l[i+1]/e+1)/2,c.push(d.x,d.y)}for(i=1;i<=t;i++)s.push(i,i+1,0);this.setIndex(s),this.setAttribute("position",new Qe(l,3)),this.setAttribute("normal",new Qe(u,3)),this.setAttribute("uv",new Qe(c,2))}Xa.prototype=Object.create(It.prototype),Xa.prototype.constructor=Xa,Ya.prototype=Object.create(Va.prototype),Ya.prototype.constructor=Ya,qa.prototype=Object.create(It.prototype),qa.prototype.constructor=qa,Za.prototype=Object.create(lt.prototype),Za.prototype.constructor=Za,Ka.prototype=Object.create(It.prototype),Ka.prototype.constructor=Ka,Qa.prototype=Object.create(lt.prototype),Qa.prototype.constructor=Qa,Ja.prototype=Object.create(It.prototype),Ja.prototype.constructor=Ja,$a.prototype=Object.create(lt.prototype),$a.prototype.constructor=$a,eo.prototype=Object.create(It.prototype),eo.prototype.constructor=eo,eo.prototype.toJSON=function(){var e=It.prototype.toJSON.call(this);return ro(this.parameters.shapes,e)},to.prototype=Object.create(lt.prototype),to.prototype.constructor=to,to.prototype.toJSON=function(){var e=lt.prototype.toJSON.call(this);return ro(this.parameters.shapes,e)},no.prototype=Object.create(lt.prototype),no.prototype.constructor=no,io.prototype=Object.create(It.prototype),io.prototype.constructor=io,ao.prototype=Object.create(lt.prototype),ao.prototype.constructor=ao,oo.prototype=Object.create(io.prototype),oo.prototype.constructor=oo,so.prototype=Object.create(ao.prototype),so.prototype.constructor=so,lo.prototype=Object.create(It.prototype),lo.prototype.constructor=lo,uo.prototype=Object.create(lt.prototype),uo.prototype.constructor=uo;var co=Object.freeze({__proto__:null,WireframeGeometry:Ji,ParametricGeometry:$i,ParametricBufferGeometry:ea,TetrahedronGeometry:na,TetrahedronBufferGeometry:ia,OctahedronGeometry:aa,OctahedronBufferGeometry:oa,IcosahedronGeometry:sa,IcosahedronBufferGeometry:la,DodecahedronGeometry:ua,DodecahedronBufferGeometry:ca,PolyhedronGeometry:ta,PolyhedronBufferGeometry:ra,TubeGeometry:ha,TubeBufferGeometry:da,TorusKnotGeometry:fa,TorusKnotBufferGeometry:pa,TorusGeometry:ma,TorusBufferGeometry:ga,TextGeometry:Xa,TextBufferGeometry:Ya,SphereGeometry:qa,SphereBufferGeometry:Za,RingGeometry:Ka,RingBufferGeometry:Qa,PlaneGeometry:Qt,PlaneBufferGeometry:Jt,LatheGeometry:Ja,LatheBufferGeometry:$a,ShapeGeometry:eo,ShapeBufferGeometry:to,ExtrudeGeometry:ja,ExtrudeBufferGeometry:Va,EdgesGeometry:no,ConeGeometry:oo,ConeBufferGeometry:so,CylinderGeometry:io,CylinderBufferGeometry:ao,CircleGeometry:lo,CircleBufferGeometry:uo,BoxGeometry:Ht,BoxBufferGeometry:Ot});function ho(e){Be.call(this),this.type="ShadowMaterial",this.color=new He(0),this.transparent=!0,this.setValues(e)}function fo(e){Ut.call(this,e),this.type="RawShaderMaterial"}function po(e){Be.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new He(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new He(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function mo(e){po.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new o(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function go(e){Be.call(this),this.type="MeshPhongMaterial",this.color=new He(16777215),this.specular=new He(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new He(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function vo(e){Be.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new He(16777215),this.specular=new He(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new He(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function yo(e){Be.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function _o(e){Be.call(this),this.type="MeshLambertMaterial",this.color=new He(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new He(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function bo(e){Be.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new He(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Eo(e){Pi.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}ho.prototype=Object.create(Be.prototype),ho.prototype.constructor=ho,ho.prototype.isShadowMaterial=!0,ho.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this},fo.prototype=Object.create(Ut.prototype),fo.prototype.constructor=fo,fo.prototype.isRawShaderMaterial=!0,po.prototype=Object.create(Be.prototype),po.prototype.constructor=po,po.prototype.isMeshStandardMaterial=!0,po.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},mo.prototype=Object.create(po.prototype),mo.prototype.constructor=mo,mo.prototype.isMeshPhysicalMaterial=!0,mo.prototype.copy=function(e){return po.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new He).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},go.prototype=Object.create(Be.prototype),go.prototype.constructor=go,go.prototype.isMeshPhongMaterial=!0,go.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},vo.prototype=Object.create(Be.prototype),vo.prototype.constructor=vo,vo.prototype.isMeshToonMaterial=!0,vo.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},yo.prototype=Object.create(Be.prototype),yo.prototype.constructor=yo,yo.prototype.isMeshNormalMaterial=!0,yo.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},_o.prototype=Object.create(Be.prototype),_o.prototype.constructor=_o,_o.prototype.isMeshLambertMaterial=!0,_o.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},bo.prototype=Object.create(Be.prototype),bo.prototype.constructor=bo,bo.prototype.isMeshMatcapMaterial=!0,bo.prototype.copy=function(e){return Be.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Eo.prototype=Object.create(Pi.prototype),Eo.prototype.constructor=Eo,Eo.prototype.isLineDashedMaterial=!0,Eo.prototype.copy=function(e){return Pi.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var wo=Object.freeze({__proto__:null,ShadowMaterial:ho,SpriteMaterial:ri,RawShaderMaterial:fo,ShaderMaterial:Ut,PointsMaterial:zi,MeshPhysicalMaterial:mo,MeshStandardMaterial:po,MeshPhongMaterial:go,MeshToonMaterial:vo,MeshNormalMaterial:yo,MeshLambertMaterial:_o,MeshDepthMaterial:Bn,MeshDistanceMaterial:zn,MeshBasicMaterial:ze,MeshMatcapMaterial:bo,LineDashedMaterial:Eo,LineBasicMaterial:Pi,Material:Be}),xo={arraySlice:function(e,t,r){return xo.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort((function(t,r){return e[t]-e[r]})),r},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),a=0,o=0;o!==n;++a)for(var s=r[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,r,n){for(var i=1,a=e[0];void 0!==a&&void 0===a[n];)a=e[i++];if(void 0!==a){var o=a[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[n])&&(t.push(a.time),r.push.apply(r,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[n])&&(t.push(a.time),o.toArray(r,r.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[n])&&(t.push(a.time),r.push(o)),a=e[i++]}while(void 0!==a)}},subclip:function(e,t,r,n,i){i=i||30;var a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var l=a.tracks[s],u=l.getValueSize(),c=[],h=[],d=0;d<l.times.length;++d){var f=l.times[d]*i;if(!(f<r||f>=n)){c.push(l.times[d]);for(var p=0;p<u;++p)h.push(l.values[d*u+p])}}0!==c.length&&(l.times=xo.convertArray(c,l.times.constructor),l.values=xo.convertArray(h,l.values.constructor),o.push(l))}a.tracks=o;var m=1/0;for(s=0;s<a.tracks.length;++s)m>a.tracks[s].times[0]&&(m=a.tracks[s].times[0]);for(s=0;s<a.tracks.length;++s)a.tracks[s].shift(-1*m);return a.resetDuration(),a}};function To(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function Mo(e,t,r,n){To.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function So(e,t,r,n){To.call(this,e,t,r,n)}function Ao(e,t,r,n){To.call(this,e,t,r,n)}function Ro(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=xo.convertArray(t,this.TimeBufferType),this.values=xo.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function ko(e,t,r){Ro.call(this,e,t,r)}function Po(e,t,r,n){Ro.call(this,e,t,r,n)}function Lo(e,t,r,n){Ro.call(this,e,t,r,n)}function Co(e,t,r,n){To.call(this,e,t,r,n)}function Io(e,t,r,n){Ro.call(this,e,t,r,n)}function Ho(e,t,r,n){Ro.call(this,e,t,r,n)}function Oo(e,t,r,n){Ro.call(this,e,t,r,n)}function Do(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=a.generateUUID(),this.duration<0&&this.resetDuration()}function Fo(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Lo;case"vector":case"vector2":case"vector3":case"vector4":return Oo;case"color":return Po;case"quaternion":return Io;case"bool":case"boolean":return ko;case"string":return Ho}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],n=[];xo.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(To.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var a;r:{n:if(!(e<n)){for(var o=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===o)break;if(i=n,e<(n=t[++r]))break t}a=t.length;break r}if(e>=i)break e;var s=t[1];for(e<s&&(r=2,i=s),o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===o)break;if(n=i,e>=(i=t[--r-1]))break t}a=r,r=0}for(;r<a;){var l=r+a>>>1;e<t[l]?a=l:r=l+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,a=0;a!==n;++a)t[a]=r[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(To.prototype,{beforeStart_:To.prototype.copySampleValue_,afterEnd_:To.prototype.copySampleValue_}),Mo.prototype=Object.assign(Object.create(To.prototype),{constructor:Mo,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,a=e+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=e,o=2*t-r;break;case 2402:o=t+n[i=n.length-2]-n[i+1];break;default:i=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*r-t;break;case 2402:a=1,s=r+n[1]-n[0];break;default:a=e-1,s=t}var l=.5*(r-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-r),this._offsetPrev=i*u,this._offsetNext=a*u},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(r-t)/(n-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,_=d*m-d*p,b=0;b!==o;++b)i[b]=g*a[u+b]+v*a[l+b]+y*a[s+b]+_*a[c+b];return i}}),So.prototype=Object.assign(Object.create(To.prototype),{constructor:So,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(r-t)/(n-t),c=1-u,h=0;h!==o;++h)i[h]=a[l+h]*c+a[s+h]*u;return i}}),Ao.prototype=Object.assign(Object.create(To.prototype),{constructor:Ao,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ro,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:xo.convertArray(e.times,Array),values:xo.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(Ro.prototype,{constructor:Ro,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Ao(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new So(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Mo(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,a=n-1;i!==n&&r[i]<e;)++i;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==i||a!==n){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=xo.arraySlice(r,i,a),this.values=xo.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==n&&xo.isTypedArray(n)){o=0;for(var l=n.length;o!==l;++o){var u=n[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}}return e},optimize:function(){for(var e=xo.arraySlice(this.times),t=xo.arraySlice(this.values),r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==l[0]))if(n)s=!0;else for(var u=o*r,c=u-r,h=u+r,d=0;d!==r;++d){var f=t[u+d];if(f!==t[c+d]||f!==t[h+d]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];var p=o*r,m=i*r;for(d=0;d!==r;++d)t[m+d]=t[p+d]}++i}}if(a>0){for(e[i]=e[a],p=a*r,m=i*r,d=0;d!==r;++d)t[m+d]=t[p+d];++i}return i!==e.length?(this.times=xo.arraySlice(e,0,i),this.values=xo.arraySlice(t,0,i*r)):(this.times=e,this.values=t),this},clone:function(){var e=xo.arraySlice(this.times,0),t=xo.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}),ko.prototype=Object.assign(Object.create(Ro.prototype),{constructor:ko,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Po.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Po,ValueTypeName:"color"}),Lo.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Lo,ValueTypeName:"number"}),Co.prototype=Object.assign(Object.create(To.prototype),{constructor:Co,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(r-t)/(n-t),u=s+o;s!==u;s+=4)p.slerpFlat(i,0,a,s-o,a,s,l);return i}}),Io.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Io,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Co(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Ho.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Ho,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Oo.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Oo,ValueTypeName:"vector"}),Object.assign(Do,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,a=r.length;i!==a;++i)t.push(Fo(r[i]).scale(n));return new Do(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,a=r.length;i!==a;++i)t.push(Ro.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var u=xo.getKeyframeOrder(s);s=xo.sortedArray(s,1,u),l=xo.sortedArray(l,1,u),n||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new Lo(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/r))}return new Do(e,-1,a)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var u=n[h=l[1]];u||(n[h]=u=[]),u.push(s)}}var c=[];for(var h in n)c.push(Do.CreateFromMorphTargetSequence(h,n[h],t,r));return c},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var a=[],o=[];xo.flattenJSON(r,a,o,n),0!==a.length&&i.push(new e(t,a,o))}},n=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)c[u[h].morphTargets[d]]=-1;for(var f in c){var p=[],m=[];for(d=0;d!==u[h].morphTargets.length;++d){var g=u[h];p.push(g.time),m.push(g.morphTarget===f?1:0)}n.push(new Lo(".morphTargetInfluence["+f+"]",p,m))}a=c.length*(o||1)}else{var v=".bones["+t[l].name+"]";r(Oo,v+".position",u,"pos",n),r(Io,v+".quaternion",u,"rot",n),r(Oo,v+".scale",u,"scl",n)}}return 0===n.length?null:new Do(i,a,n)}}),Object.assign(Do.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Do(this.name,this.duration,e)}});var No={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Uo(e,t,r){var n=this,i=!1,a=0,o=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===i&&void 0!==n.onStart&&n.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,o),a===o&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,r=l.length;t<r;t+=2){var n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}var Bo=new Uo;function zo(e){this.manager=void 0!==e?e:Bo,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(zo.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var jo={};function Vo(e){zo.call(this,e)}function Go(e){zo.call(this,e)}function Wo(e){zo.call(this,e)}function Xo(e){zo.call(this,e)}function Yo(e){zo.call(this,e)}function qo(e){zo.call(this,e)}function Zo(e){zo.call(this,e)}function Ko(){this.type="Curve",this.arcLengthDivisions=200}function Qo(e,t,r,n,i,a,o,s){Ko.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function Jo(e,t,r,n,i,a){Qo.call(this,e,t,r,r,n,i,a),this.type="ArcCurve"}function $o(){var e=0,t=0,r=0,n=0;function i(i,a,o,s){e=i,t=o,r=-3*i+3*a-2*o-s,n=2*i-2*a+o+s}return{initCatmullRom:function(e,t,r,n,a){i(t,r,a*(r-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,a,o,s){var l=(t-e)/a-(r-e)/(a+o)+(r-t)/o,u=(r-t)/o-(n-t)/(o+s)+(n-r)/s;i(t,r,l*=o,u*=o)},calc:function(i){var a=i*i;return e+t*i+r*a+n*(a*i)}}}Vo.prototype=Object.assign(Object.create(zo.prototype),{constructor:Vo,load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=No.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===jo[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],u=o[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),f=0;f<u.length;f++)d[f]=u.charCodeAt(f);c="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var p=new DOMParser;c=p.parseFromString(u,s);break;case"json":c=JSON.parse(u);break;default:c=u}setTimeout((function(){t&&t(c),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{jo[e]=[],jo[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var g in m.open("GET",e,!0),m.addEventListener("load",(function(t){var r=this.response,n=jo[e];if(delete jo[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),No.add(e,r);for(var a=0,o=n.length;a<o;a++)(s=n[a]).onLoad&&s.onLoad(r);i.manager.itemEnd(e)}else{for(a=0,o=n.length;a<o;a++){var s;(s=n[a]).onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),m.addEventListener("progress",(function(t){for(var r=jo[e],n=0,i=r.length;n<i;n++){var a=r[n];a.onProgress&&a.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var r=jo[e];delete jo[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),m.addEventListener("abort",(function(t){var r=jo[e];delete jo[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return i.manager.itemStart(e),m}jo[e].push({onLoad:t,onProgress:r,onError:n})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Go.prototype=Object.assign(Object.create(zo.prototype),{constructor:Go,load:function(e,t,r,n){var i=this,a=new Vo(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(JSON.parse(e)))}),r,n)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var n=Do.parse(e[r]);t.push(n)}return t}}),Wo.prototype=Object.assign(Object.create(zo.prototype),{constructor:Wo,load:function(e,t,r,n){var i=this,a=[],o=new Zi;o.image=a;var s=new Vo(this.manager);function l(l){s.load(e[l],(function(e){var r=i.parse(e,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(u+=1)&&(1===r.mipmapCount&&(o.minFilter=1006),o.format=r.format,o.needsUpdate=!0,t&&t(o))}),r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,c=0,h=e.length;c<h;++c)l(c);else s.load(e,(function(e){var r=i.parse(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){a[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=1006),o.format=r.format,o.needsUpdate=!0,t&&t(o)}),r,n);return o}}),Xo.prototype=Object.assign(Object.create(zo.prototype),{constructor:Xo,load:function(e,t,r,n){var i=this,a=new Gt,o=new Vo(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,(function(e){var r=i.parse(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:1001,a.wrapT=void 0!==r.wrapT?r.wrapT:1001,a.magFilter=void 0!==r.magFilter?r.magFilter:1006,a.minFilter=void 0!==r.minFilter?r.minFilter:1006,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps,a.minFilter=1008),1===r.mipmapCount&&(a.minFilter=1006),a.needsUpdate=!0,t&&t(a,r))}),r,n),a}}),Yo.prototype=Object.assign(Object.create(zo.prototype),{constructor:Yo,load:function(e,t,r,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=No.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),No.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}),qo.prototype=Object.assign(Object.create(zo.prototype),{constructor:qo,load:function(e,t,r,n){var i=new dr,a=new Yo(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(e[r],(function(e){i.images[r]=e,6==++o&&(i.needsUpdate=!0,t&&t(i))}),void 0,n)}for(var l=0;l<e.length;++l)s(l);return i}}),Zo.prototype=Object.assign(Object.create(zo.prototype),{constructor:Zo,load:function(e,t,r,n){var i=new c,a=new Yo(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(r){i.image=r;var n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?1022:1023,i.needsUpdate=!0,void 0!==t&&t(i)}),r,n),i}}),Object.assign(Ko.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),a=0;for(n.push(0),r=1;r<=e;r++)a+=(t=this.getPoint(r/e)).distanceTo(i),n.push(a),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,a=n.length;r=t||e*n[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=n[i=Math.floor(s+(l-s)/2)]-r)<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(a-1);var u=n[i];return(i+(r-u)/(n[i+1]-u))/(a-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,o=new v,s=[],l=[],u=[],c=new v,h=new M;for(r=0;r<=e;r++)n=r/e,s[r]=this.getTangentAt(n),s[r].normalize();l[0]=new v,u[0]=new v;var d=Number.MAX_VALUE,f=Math.abs(s[0].x),p=Math.abs(s[0].y),m=Math.abs(s[0].z);for(f<=d&&(d=f,o.set(1,0,0)),p<=d&&(d=p,o.set(0,1,0)),m<=d&&o.set(0,0,1),c.crossVectors(s[0],o).normalize(),l[0].crossVectors(s[0],c),u[0].crossVectors(s[0],l[0]),r=1;r<=e;r++)l[r]=l[r-1].clone(),u[r]=u[r-1].clone(),c.crossVectors(s[r-1],s[r]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(a.clamp(s[r-1].dot(s[r]),-1,1)),l[r].applyMatrix4(h.makeRotationAxis(c,i))),u[r].crossVectors(s[r],l[r]);if(!0===t)for(i=Math.acos(a.clamp(l[0].dot(l[e]),-1,1)),i/=e,s[0].dot(c.crossVectors(l[0],l[e]))>0&&(i=-i),r=1;r<=e;r++)l[r].applyMatrix4(h.makeRotationAxis(s[r],i*r)),u[r].crossVectors(s[r],l[r]);return{tangents:s,normals:l,binormals:u}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Qo.prototype=Object.create(Ko.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isEllipseCurve=!0,Qo.prototype.getPoint=function(e,t){for(var r=t||new o,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),!0!==this.aClockwise||a||(i===n?i=-n:i-=n);var s=this.aStartAngle+e*i,l=this.aX+this.xRadius*Math.cos(s),u=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=u-this.aY;l=d*c-f*h+this.aX,u=d*h+f*c+this.aY}return r.set(l,u)},Qo.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Qo.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Qo.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Jo.prototype=Object.create(Qo.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isArcCurve=!0;var es=new v,ts=new $o,rs=new $o,ns=new $o;function is(e,t,r,n){Ko.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function as(e,t,r,n,i){var a=.5*(n-t),o=.5*(i-r),s=e*e;return(2*r-2*n+a+o)*(e*s)+(-3*r+3*n-2*a-o)*s+a*e+r}function os(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function ss(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}function ls(e,t,r,n){Ko.call(this),this.type="CubicBezierCurve",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o,this.v3=n||new o}function us(e,t,r,n){Ko.call(this),this.type="CubicBezierCurve3",this.v0=e||new v,this.v1=t||new v,this.v2=r||new v,this.v3=n||new v}function cs(e,t){Ko.call(this),this.type="LineCurve",this.v1=e||new o,this.v2=t||new o}function hs(e,t){Ko.call(this),this.type="LineCurve3",this.v1=e||new v,this.v2=t||new v}function ds(e,t,r){Ko.call(this),this.type="QuadraticBezierCurve",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o}function fs(e,t,r){Ko.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new v,this.v1=t||new v,this.v2=r||new v}function ps(e){Ko.call(this),this.type="SplineCurve",this.points=e||[]}is.prototype=Object.create(Ko.prototype),is.prototype.constructor=is,is.prototype.isCatmullRomCurve3=!0,is.prototype.getPoint=function(e,t){var r,n,i,a,o=t||new v,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e,c=Math.floor(u),h=u-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===h&&c===l-1&&(c=l-2,h=1),this.closed||c>0?r=s[(c-1)%l]:(es.subVectors(s[0],s[1]).add(s[0]),r=es),n=s[c%l],i=s[(c+1)%l],this.closed||c+2<l?a=s[(c+2)%l]:(es.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=es),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(r.distanceToSquared(n),d),p=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(a),d);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),ts.initNonuniformCatmullRom(r.x,n.x,i.x,a.x,f,p,m),rs.initNonuniformCatmullRom(r.y,n.y,i.y,a.y,f,p,m),ns.initNonuniformCatmullRom(r.z,n.z,i.z,a.z,f,p,m)}else"catmullrom"===this.curveType&&(ts.initCatmullRom(r.x,n.x,i.x,a.x,this.tension),rs.initCatmullRom(r.y,n.y,i.y,a.y,this.tension),ns.initCatmullRom(r.z,n.z,i.z,a.z,this.tension));return o.set(ts.calc(h),rs.calc(h),ns.calc(h)),o},is.prototype.copy=function(e){Ko.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},is.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},is.prototype.fromJSON=function(e){Ko.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new v).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ls.prototype=Object.create(Ko.prototype),ls.prototype.constructor=ls,ls.prototype.isCubicBezierCurve=!0,ls.prototype.getPoint=function(e,t){var r=t||new o,n=this.v0,i=this.v1,a=this.v2,s=this.v3;return r.set(ss(e,n.x,i.x,a.x,s.x),ss(e,n.y,i.y,a.y,s.y)),r},ls.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},ls.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},ls.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},us.prototype=Object.create(Ko.prototype),us.prototype.constructor=us,us.prototype.isCubicBezierCurve3=!0,us.prototype.getPoint=function(e,t){var r=t||new v,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(ss(e,n.x,i.x,a.x,o.x),ss(e,n.y,i.y,a.y,o.y),ss(e,n.z,i.z,a.z,o.z)),r},us.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},us.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},us.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},cs.prototype=Object.create(Ko.prototype),cs.prototype.constructor=cs,cs.prototype.isLineCurve=!0,cs.prototype.getPoint=function(e,t){var r=t||new o;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},cs.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},cs.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},cs.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},cs.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},cs.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},hs.prototype=Object.create(Ko.prototype),hs.prototype.constructor=hs,hs.prototype.isLineCurve3=!0,hs.prototype.getPoint=function(e,t){var r=t||new v;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},hs.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},hs.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},hs.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},hs.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ds.prototype=Object.create(Ko.prototype),ds.prototype.constructor=ds,ds.prototype.isQuadraticBezierCurve=!0,ds.prototype.getPoint=function(e,t){var r=t||new o,n=this.v0,i=this.v1,a=this.v2;return r.set(os(e,n.x,i.x,a.x),os(e,n.y,i.y,a.y)),r},ds.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ds.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ds.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},fs.prototype=Object.create(Ko.prototype),fs.prototype.constructor=fs,fs.prototype.isQuadraticBezierCurve3=!0,fs.prototype.getPoint=function(e,t){var r=t||new v,n=this.v0,i=this.v1,a=this.v2;return r.set(os(e,n.x,i.x,a.x),os(e,n.y,i.y,a.y),os(e,n.z,i.z,a.z)),r},fs.prototype.copy=function(e){return Ko.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},fs.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},fs.prototype.fromJSON=function(e){return Ko.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ps.prototype=Object.create(Ko.prototype),ps.prototype.constructor=ps,ps.prototype.isSplineCurve=!0,ps.prototype.getPoint=function(e,t){var r=t||new o,n=this.points,i=(n.length-1)*e,a=Math.floor(i),s=i-a,l=n[0===a?a:a-1],u=n[a],c=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(as(s,l.x,u.x,c.x,h.x),as(s,l.y,u.y,c.y,h.y)),r},ps.prototype.copy=function(e){Ko.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},ps.prototype.toJSON=function(){var e=Ko.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},ps.prototype.fromJSON=function(e){Ko.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new o).fromArray(n))}return this};var ms=Object.freeze({__proto__:null,ArcCurve:Jo,CatmullRomCurve3:is,CubicBezierCurve:ls,CubicBezierCurve3:us,EllipseCurve:Qo,LineCurve:cs,LineCurve3:hs,QuadraticBezierCurve:ds,QuadraticBezierCurve3:fs,SplineCurve:ps});function gs(){Ko.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function vs(e){gs.call(this),this.type="Path",this.currentPoint=new o,e&&this.setFromPoints(e)}function ys(e){vs.call(this,e),this.uuid=a.generateUUID(),this.type="Shape",this.holes=[]}function _s(e,t){V.call(this),this.type="Light",this.color=new He(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function bs(e,t,r){_s.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(V.DefaultUp),this.updateMatrix(),this.groundColor=new He(t)}function Es(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new o(512,512),this.map=null,this.mapPass=null,this.matrix=new M,this._frustum=new Yt,this._frameExtents=new o(1,1),this._viewportCount=1,this._viewports=[new h(0,0,1,1)]}function ws(){Es.call(this,new zt(50,1,.5,500))}function xs(e,t,r,n,i,a){_s.call(this,e,t),this.type="SpotLight",this.position.copy(V.DefaultUp),this.updateMatrix(),this.target=new V,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new ws}function Ts(){Es.call(this,new zt(90,1,.5,500)),this._frameExtents=new o(4,2),this._viewportCount=6,this._viewports=[new h(2,1,1,1),new h(0,1,1,1),new h(3,1,1,1),new h(1,1,1,1),new h(3,0,1,1),new h(1,0,1,1)],this._cubeDirections=[new v(1,0,0),new v(-1,0,0),new v(0,0,1),new v(0,0,-1),new v(0,1,0),new v(0,-1,0)],this._cubeUps=[new v(0,1,0),new v(0,1,0),new v(0,1,0),new v(0,1,0),new v(0,0,1),new v(0,0,-1)]}function Ms(e,t,r,n){_s.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new Ts}function Ss(e,t,r,n,i,a){Bt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function As(){Es.call(this,new Ss(-5,5,5,-5,.5,500))}function Rs(e,t){_s.call(this,e,t),this.type="DirectionalLight",this.position.copy(V.DefaultUp),this.updateMatrix(),this.target=new V,this.shadow=new As}function ks(e,t){_s.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Ps(e,t,r,n){_s.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function Ls(e){zo.call(this,e),this.textures={}}gs.prototype=Object.assign(Object.create(Ko.prototype),{constructor:gs,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new cs(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,a=this.curves[n],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var a=i[n],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];t&&t.equals(u)||(r.push(u),t=u)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){Ko.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Ko.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Ko.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new ms[n.type]).fromJSON(n))}return this}}),vs.prototype=Object.assign(Object.create(gs.prototype),{constructor:vs,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var r=new cs(this.currentPoint.clone(),new o(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,r,n){var i=new ds(this.currentPoint.clone(),new o(e,t),new o(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this},bezierCurveTo:function(e,t,r,n,i,a){var s=new ls(this.currentPoint.clone(),new o(e,t),new o(r,n),new o(i,a));return this.curves.push(s),this.currentPoint.set(i,a),this},splineThru:function(e){var t=new ps([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,r,n,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,r,n,i,a),this},absarc:function(e,t,r,n,i,a){return this.absellipse(e,t,r,r,n,i,a),this},ellipse:function(e,t,r,n,i,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,r,n,i,a,o,s),this},absellipse:function(e,t,r,n,i,a,o,s){var l=new Qo(e,t,r,n,i,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return gs.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=gs.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return gs.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),ys.prototype=Object.assign(Object.create(vs.prototype),{constructor:ys,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){vs.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=vs.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){vs.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new vs).fromJSON(n))}return this}}),_s.prototype=Object.assign(Object.create(V.prototype),{constructor:_s,isLight:!0,copy:function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=V.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),bs.prototype=Object.assign(Object.create(_s.prototype),{constructor:bs,isHemisphereLight:!0,copy:function(e){return _s.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Es.prototype,{_projScreenMatrix:new M,_lightPositionWorld:new v,_lookTarget:new v,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,r=this.matrix,n=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),ws.prototype=Object.assign(Object.create(Es.prototype),{constructor:ws,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,r=2*a.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix()),Es.prototype.updateMatrices.call(this,e)}}),xs.prototype=Object.assign(Object.create(_s.prototype),{constructor:xs,isSpotLight:!0,copy:function(e){return _s.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ts.prototype=Object.assign(Object.create(Es.prototype),{constructor:Ts,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var r=this.camera,n=this.matrix,i=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),r.position.copy(i),a.copy(r.position),a.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(a),r.updateMatrixWorld(),n.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),Ms.prototype=Object.assign(Object.create(_s.prototype),{constructor:Ms,isPointLight:!0,copy:function(e){return _s.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Ss.prototype=Object.assign(Object.create(Bt.prototype),{constructor:Ss,isOrthographicCamera:!0,copy:function(e,t){return Bt.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,a=r+e,o=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=l*this.view.offsetX)+l*this.view.width,s=(o-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=V.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),As.prototype=Object.assign(Object.create(Es.prototype),{constructor:As,isDirectionalLightShadow:!0,updateMatrices:function(e){Es.prototype.updateMatrices.call(this,e)}}),Rs.prototype=Object.assign(Object.create(_s.prototype),{constructor:Rs,isDirectionalLight:!0,copy:function(e){return _s.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ks.prototype=Object.assign(Object.create(_s.prototype),{constructor:ks,isAmbientLight:!0}),Ps.prototype=Object.assign(Object.create(_s.prototype),{constructor:Ps,isRectAreaLight:!0,copy:function(e){return _s.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=_s.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Ls.prototype=Object.assign(Object.create(zo.prototype),{constructor:Ls,load:function(e,t,r,n){var i=this,a=new Vo(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(JSON.parse(e)))}),r,n)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new wo[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new He).setHex(e.sheen)),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.vertexTangents&&(n.vertexTangents=e.vertexTangents),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(n.uniforms[i]={},a.type){case"t":n.uniforms[i].value=r(a.value);break;case"c":n.uniforms[i].value=(new He).setHex(a.value);break;case"v2":n.uniforms[i].value=(new o).fromArray(a.value);break;case"v3":n.uniforms[i].value=(new v).fromArray(a.value);break;case"v4":n.uniforms[i].value=(new h).fromArray(a.value);break;case"m3":n.uniforms[i].value=(new s).fromArray(a.value);case"m4":n.uniforms[i].value=(new M).fromArray(a.value);break;default:n.uniforms[i].value=a.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var l in e.extensions)n.extensions[l]=e.extensions[l];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.matcap&&(n.matcap=r(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var u=e.normalScale;!1===Array.isArray(u)&&(u=[u,u]),n.normalScale=(new o).fromArray(u)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new o).fromArray(e.clearcoatNormalScale)),n},setTextures:function(e){return this.textures=e,this}});var Cs={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function Is(){lt.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Hs(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Ve.call(this,e,t,r),this.meshPerAttribute=n||1}function Os(e){zo.call(this,e)}Is.prototype=Object.assign(Object.create(lt.prototype),{constructor:Is,isInstancedBufferGeometry:!0,copy:function(e){return lt.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=lt.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),Hs.prototype=Object.assign(Object.create(Ve.prototype),{constructor:Hs,isInstancedBufferAttribute:!0,copy:function(e){return Ve.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Ve.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Os.prototype=Object.assign(Object.create(zo.prototype),{constructor:Os,load:function(e,t,r,n){var i=this,a=new Vo(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(JSON.parse(e)))}),r,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new Is:new lt,r=e.data.index;if(void 0!==r){var n=new Ds[r.type](r.array);t.setIndex(new Ve(n,1))}var i=e.data.attributes;for(var a in i){var o=i[a],s=(n=new Ds[o.type](o.array),new(o.isInstancedBufferAttribute?Hs:Ve)(n,o.itemSize,o.normalized));void 0!==o.name&&(s.name=o.name),t.setAttribute(a,s)}var l=e.data.morphAttributes;if(l)for(var a in l){for(var u=l[a],c=[],h=0,d=u.length;h<d;h++)o=u[h],s=new Ve(n=new Ds[o.type](o.array),o.itemSize,o.normalized),void 0!==o.name&&(s.name=o.name),c.push(s);t.morphAttributes[a]=c}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var f=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==f){h=0;for(var p=f.length;h!==p;++h){var m=f[h];t.addGroup(m.start,m.count,m.materialIndex)}}var g=e.data.boundingSphere;if(void 0!==g){var y=new v;void 0!==g.center&&y.fromArray(g.center),t.boundingSphere=new se(y,g.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var Ds={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Fs(e){zo.call(this,e)}Fs.prototype=Object.assign(Object.create(zo.prototype),{constructor:Fs,load:function(e,t,r,n){var i=this,a=""===this.path?Cs.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new Vo(i.manager);o.setPath(this.path),o.load(e,(function(r){var a=null;try{a=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)}),r,n)},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,n,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new ys).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new Os,i=0,a=e.length;i<a;i++){var o,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new co[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new co[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new co[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new co[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new co[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new co[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new co[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new co[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new co[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new co[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new co[s.type]((new ms[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new co[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new co[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,c=s.shapes.length;u<c;u++){var h=t[s.shapes[u]];l.push(h)}o=new co[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,c=s.shapes.length;u<c;u++)h=t[s.shapes[u]],l.push(h);var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new ms[d.type]).fromJSON(d)),o=new co[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(e,t){var r={},n={};if(void 0!==e){var i=new Ls;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===r[c.uuid]&&(r[c.uuid]=i.parse(c)),l.push(r[c.uuid])}n[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=Do.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),t.push(i)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),a.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var a=new Yo(new Uo(t));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=e.length;o<s;o++){var l=e[o],u=l.url;if(Array.isArray(u)){n[l.uuid]=[];for(var c=0,h=u.length;c<h;c++){var d=u[c],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:r.resourcePath+d;n[l.uuid].push(i(f))}}else f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.resourcePath+l.url,n[l.uuid]=i(f)}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new dr(t[s.image]):new c(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,Us)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],Bs),o.wrapT=r(s.wrap[1],Bs)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,zs)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,zs)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n},parseObject:function(e,t,r){var n;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var a=e[n];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(r[a])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new G,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new He(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new Qn(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new Kn(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new zt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new Ss(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new ks(e.color,e.intensity);break;case"DirectionalLight":n=new Rs(e.color,e.intensity);break;case"PointLight":n=new Ms(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new Ps(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new xs(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new bs(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(e.geometry),s=a(e.material);n=o.bones&&o.bones.length>0?new bi(o,s):new St(o,s);break;case"InstancedMesh":o=i(e.geometry),s=a(e.material);var l=e.count,u=e.instanceMatrix;(n=new ki(o,s,l)).instanceMatrix=new Ve(new Float32Array(u.array),16);break;case"LOD":n=new _i;break;case"Line":n=new Di(i(e.geometry),a(e.material),e.mode);break;case"LineLoop":n=new Bi(i(e.geometry),a(e.material));break;case"LineSegments":n=new Ui(i(e.geometry),a(e.material));break;case"PointCloud":case"Points":n=new Xi(i(e.geometry),a(e.material));break;case"Sprite":n=new mi(a(e.material));break;case"Group":n=new Yn;break;default:n=new V}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children)for(var c=e.children,h=0;h<c.length;h++)n.add(this.parseObject(c[h],t,r));if("LOD"===e.type){void 0!==e.autoUpdate&&(n.autoUpdate=e.autoUpdate);for(var d=e.levels,f=0;f<d.length;f++){var p=d[f],m=n.getObjectByProperty("uuid",p.object);void 0!==m&&n.addLevel(m,p.distance)}}return n}});var Ns,Us={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Bs={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},zs={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};function js(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),zo.call(this,e),this.options=void 0}function Vs(){this.type="ShapePath",this.color=new He,this.subPaths=[],this.currentPath=null}function Gs(e){this.type="Font",this.data=e}function Ws(e,t,r,n,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,u,c,h,d,f,p=new Vs;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,v=m.length;g<v;)switch(m[g++]){case"m":o=m[g++]*t+r,s=m[g++]*t+n,p.moveTo(o,s);break;case"l":o=m[g++]*t+r,s=m[g++]*t+n,p.lineTo(o,s);break;case"q":l=m[g++]*t+r,u=m[g++]*t+n,c=m[g++]*t+r,h=m[g++]*t+n,p.quadraticCurveTo(c,h,l,u);break;case"b":l=m[g++]*t+r,u=m[g++]*t+n,c=m[g++]*t+r,h=m[g++]*t+n,d=m[g++]*t+r,f=m[g++]*t+n,p.bezierCurveTo(c,h,d,f,l,u)}return{offsetX:a.ha*t,path:p}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function Xs(e){zo.call(this,e)}js.prototype=Object.assign(Object.create(zo.prototype),{constructor:js,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=No.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)})).then((function(r){No.add(e,r),t&&t(r),i.manager.itemEnd(e)})).catch((function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(Vs.prototype,{moveTo:function(e,t){return this.currentPath=new vs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,r,n){return this.currentPath.quadraticCurveTo(e,t,r,n),this},bezierCurveTo:function(e,t,r,n,i,a){return this.currentPath.bezierCurveTo(e,t,r,n,i,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=new ys;a.curves=i.curves,t.push(a)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,a=0;a<r;i=a++){var o=t[i],s=t[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],l=-l,s=t[i],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=u*(e.x-o.x)-l*(e.y-o.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return n}var i=Ua.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return r(a);var o,s,l,u=[];if(1===a.length)return s=a[0],(l=new ys).curves=s.curves,u.push(l),u;var c=!i(a[0].getPoints());c=e?!c:c;var h,d,f=[],p=[],m=[],g=0;p[g]=void 0,m[g]=[];for(var v=0,y=a.length;v<y;v++)o=i(h=(s=a[v]).getPoints()),(o=e?!o:o)?(!c&&p[g]&&g++,p[g]={s:new ys,p:h},p[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!p[0])return r(a);if(p.length>1){for(var _=!1,b=[],E=0,w=p.length;E<w;E++)f[E]=[];for(E=0,w=p.length;E<w;E++)for(var x=m[E],T=0;T<x.length;T++){for(var M=x[T],S=!0,A=0;A<p.length;A++)n(M.p,p[A].p)&&(E!==A&&b.push({froms:E,tos:A,hole:T}),S?(S=!1,f[A].push(M)):_=!0);S&&f[E].push(M)}b.length>0&&(_||(m=f))}v=0;for(var R=p.length;v<R;v++){l=p[v].s,u.push(l);for(var k=0,P=(d=m[v]).length;k<P;k++)l.holes.push(d[k].h)}return u}}),Object.assign(Gs.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],n=function(e,t,r){for(var n=Array.from?Array.from(e):String(e).split(""),i=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,o=[],s=0,l=0,u=0;u<n.length;u++){var c=n[u];if("\n"===c)s=0,l-=a;else{var h=Ws(c,i,s,l,r);s+=h.offsetX,o.push(h.path)}}return o}(e,t,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),Xs.prototype=Object.assign(Object.create(zo.prototype),{constructor:Xs,load:function(e,t,r,n){var i=this,a=new Vo(this.manager);a.setPath(this.path),a.load(e,(function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)}),r,n)},parse:function(e){return new Gs(e)}});var Ys={getContext:function(){return void 0===Ns&&(Ns=new(window.AudioContext||window.webkitAudioContext)),Ns},setContext:function(e){Ns=e}};function qs(e){zo.call(this,e)}function Zs(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new v)}function Ks(e,t){_s.call(this,void 0,t),this.sh=void 0!==e?e:new Zs}function Qs(e,t,r){Ks.call(this,void 0,r);var n=(new He).set(e),i=(new He).set(t),a=new v(n.r,n.g,n.b),o=new v(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function Js(e,t){Ks.call(this,void 0,t);var r=(new He).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}qs.prototype=Object.assign(Object.create(zo.prototype),{constructor:qs,load:function(e,t,r,n){var i=new Vo(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,(function(e){var r=e.slice(0);Ys.getContext().decodeAudioData(r,(function(e){t(e)}))}),r,n)}}),Object.assign(Zs.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScale(a[1],.488603*n),t.addScale(a[2],.488603*i),t.addScale(a[3],.488603*r),t.addScale(a[4],r*n*1.092548),t.addScale(a[5],n*i*1.092548),t.addScale(a[6],.315392*(3*i*i-1)),t.addScale(a[7],r*i*1.092548),t.addScale(a[8],.546274*(r*r-n*n)),t},getIrradianceAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScale(a[1],1.023328*n),t.addScale(a[2],1.023328*i),t.addScale(a[3],1.023328*r),t.addScale(a[4],.858086*r*n),t.addScale(a[5],.858086*n*i),t.addScale(a[6],.743125*i*i-.247708),t.addScale(a[7],.858086*r*i),t.addScale(a[8],.429043*(r*r-n*n)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(e,t+3*n);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(e,t+3*n);return e}}),Object.assign(Zs,{getBasisAt:function(e,t){var r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}),Ks.prototype=Object.assign(Object.create(_s.prototype),{constructor:Ks,isLightProbe:!0,copy:function(e){return _s.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return _s.prototype.toJSON.call(this,e)}}),Qs.prototype=Object.assign(Object.create(Ks.prototype),{constructor:Qs,isHemisphereLightProbe:!0,copy:function(e){return Ks.prototype.copy.call(this,e),this},toJSON:function(e){return Ks.prototype.toJSON.call(this,e)}}),Js.prototype=Object.assign(Object.create(Ks.prototype),{constructor:Js,isAmbientLightProbe:!0,copy:function(e){return Ks.prototype.copy.call(this,e),this},toJSON:function(e){return Ks.prototype.toJSON.call(this,e)}});var $s=new M,el=new M;function tl(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new zt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new zt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function rl(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(tl.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var r,n,i=e.projectionMatrix.clone(),o=t.eyeSep/2,s=o*t.near/t.focus,l=t.near*Math.tan(a.DEG2RAD*t.fov*.5)/t.zoom;el.elements[12]=-o,$s.elements[12]=o,r=-l*t.aspect+s,n=l*t.aspect+s,i.elements[0]=2*t.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(i),r=-l*t.aspect-s,n=l*t.aspect-s,i.elements[0]=2*t.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(el),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply($s)}}),Object.assign(rl.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var nl=new v,il=new p,al=new v,ol=new v;function sl(){V.call(this),this.type="AudioListener",this.context=Ys.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new rl}function ll(e){V.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}sl.prototype=Object.assign(Object.create(V.prototype),{constructor:sl,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){V.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(nl,il,al),ol.set(0,0,-1).applyQuaternion(il),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(nl.x,n),t.positionY.linearRampToValueAtTime(nl.y,n),t.positionZ.linearRampToValueAtTime(nl.z,n),t.forwardX.linearRampToValueAtTime(ol.x,n),t.forwardY.linearRampToValueAtTime(ol.y,n),t.forwardZ.linearRampToValueAtTime(ol.z,n),t.upX.linearRampToValueAtTime(r.x,n),t.upY.linearRampToValueAtTime(r.y,n),t.upZ.linearRampToValueAtTime(r.z,n)}else t.setPosition(nl.x,nl.y,nl.z),t.setOrientation(ol.x,ol.y,ol.z,r.x,r.y,r.z)}}),ll.prototype=Object.assign(Object.create(V.prototype),{constructor:ll,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var ul=new v,cl=new p,hl=new v,dl=new v;function fl(e){ll.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function pl(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function ml(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}fl.prototype=Object.assign(Object.create(ll.prototype),{constructor:fl,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(e){if(V.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(ul,cl,hl),dl.set(0,0,1).applyQuaternion(cl);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ul.x,r),t.positionY.linearRampToValueAtTime(ul.y,r),t.positionZ.linearRampToValueAtTime(ul.z,r),t.orientationX.linearRampToValueAtTime(dl.x,r),t.orientationY.linearRampToValueAtTime(dl.y,r),t.orientationZ.linearRampToValueAtTime(dl.z,r)}else t.setPosition(ul.x,ul.y,ul.z),t.setOrientation(dl.x,dl.y,dl.z)}}}),Object.assign(pl.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(ml.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==n;++o)r[i+o]=r[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*t;this._mixBufferRegion(r,n,o,1-i,t)}for(var s=t,l=t+t;s!==l;++s)if(r[s]!==r[s+t]){a.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,a=n;i!==a;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(n>=.5)for(var a=0;a!==i;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,n){p.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var a=1-n,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*n}}});var gl=new RegExp("[\\[\\]\\.:\\/]","g"),vl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",yl=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),_l=/(WCOD+)?/.source.replace("WCOD",vl),bl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),El=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),wl=new RegExp("^"+yl+_l+bl+El+"$"),xl=["material","materials","bones"];function Tl(e,t,r){var n=r||Ml.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function Ml(e,t,r){this.path=t,this.parsedPath=r||Ml.parseTrackName(t),this.node=Ml.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Sl(){this.uuid=a.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function Al(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,a=new Array(i),o={endingStart:2400,endingEnd:2400},s=0;s!==i;++s){var l=n[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Rl(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function kl(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Pl(e,t,r){Jn.call(this,e,t),this.meshPerAttribute=r||1}function Ll(e,t,r,n){this.ray=new me(e,t),this.near=r||0,this.far=n||1/0,this.camera=null,this.layers=new k,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Cl(e,t){return e.distance-t.distance}function Il(e,t,r,n){if(e.layers.test(t.layers)&&e.raycast(t,r),!0===n)for(var i=e.children,a=0,o=i.length;a<o;a++)Il(i[a],t,r,!0)}function Hl(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function Ol(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}Object.assign(Tl.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(Ml,{Composite:Tl,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new Ml.Composite(e,t,r):new Ml(e,t,r)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(gl,"")},parseTrackName:function(e){var t=wl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==xl.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var a=n(i.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(Ml.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=Ml.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[n];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Ml.prototype,{_getValue_unbound:Ml.prototype.getValue,_setValue_unbound:Ml.prototype.setValue}),Object.assign(Sl.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,f=n[d];if(void 0===f){f=t++,n[d]=f,e.push(h);for(var p=0,m=s;p!==m;++p)o[p].push(new Ml(h,i[p],a[p]))}else if(f<r){l=e[f];var g=--r,v=e[g];for(n[v.uuid]=f,e[f]=v,n[d]=g,e[g]=h,p=0,m=s;p!==m;++p){var y=o[p],_=y[g],b=y[f];y[f]=_,void 0===b&&(b=new Ml(h,i[p],a[p])),y[g]=b}}else e[f]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=r[l];if(void 0!==u&&u>=t){var c=t++,h=e[c];r[h.uuid]=u,e[u]=h,r[l]=c,e[c]=s;for(var d=0,f=i;d!==f;++d){var p=n[d],m=p[c],g=p[u];p[u]=m,p[c]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o],u=l.uuid,c=n[u];if(void 0!==c)if(delete n[u],c<r){var h=--r,d=e[h],f=e[y=--t];n[d.uuid]=c,e[c]=d,n[f.uuid]=h,e[h]=f,e.pop();for(var p=0,m=a;p!==m;++p){var g=(_=i[p])[h],v=_[y];_[c]=g,_[h]=v,_.pop()}}else{var y;for(n[(f=e[y=--t]).uuid]=c,e[c]=f,e.pop(),p=0,m=a;p!==m;++p){var _;(_=i[p])[c]=_[y],_.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);n=i.length,r[e]=n,a.push(e),o.push(t),i.push(c);for(var h=u,d=s.length;h!==d;++h){var f=s[h];c[h]=new Ml(f,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}),Object.assign(Al.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,a=i/n,o=n/i;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+r,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*r;if(a<0||0===r)return;this._startTime=null,t=r*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;null!==r&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,i=this._loopCount,a=2202===n;if(0===e)return-1===i?t:a&&1==(1&i)?r-t:t;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=r||t<0){var o=Math.floor(t/r);t-=r*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=t;if(a&&1==(1&i))return r-t}return t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=r,this}}),Rl.prototype=Object.assign(Object.create(t.prototype),{constructor:Rl,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,a=e._propertyBindings,o=e._interpolants,s=r.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==i;++c){var h=n[c],d=h.name,f=u[d];if(void 0!==f)a[c]=f;else{if(void 0!==(f=a[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new ml(Ml.create(r,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),a[c]=f}o[c].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],a=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[n]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new So(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Do.findByName(r,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[n];if(void 0!==l)return l;s=o.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new Al(this,i,t);return this._bindAction(u,s),this._addInactiveAction(u,a,n),u},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Do.findByName(r,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o)t[o]._update(n,e,i,a);var s=this._bindings,l=this._nActiveBindings;for(o=0;o!==l;++o)s[o].apply(a);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),kl.prototype.clone=function(){return new kl(void 0===this.value.clone?this.value:this.value.clone())},Pl.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Pl,isInstancedInterleavedBuffer:!0,copy:function(e){return Jn.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Ll.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return Il(e,this,n,t),n.sort(Cl),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,a=e.length;i<a;i++)Il(e[i],this,n,t);return n.sort(Cl),n}}),Object.assign(Hl.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(a.clamp(t/this.radius,-1,1))),this}}),Object.assign(Ol.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}});var Dl=new o;function Fl(e,t){this.min=void 0!==e?e:new o(1/0,1/0),this.max=void 0!==t?t:new o(-1/0,-1/0)}Object.assign(Fl.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=Dl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new o),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new o),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new o),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new o),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Dl.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Nl=new v,Ul=new v;function Bl(e,t){this.start=void 0!==e?e:new v,this.end=void 0!==t?t:new v}function zl(e){V.call(this),this.material=e,this.render=function(){}}Object.assign(Bl.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new v),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new v),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new v),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Nl.subVectors(e,this.start),Ul.subVectors(this.end,this.start);var r=Ul.dot(Ul),n=Ul.dot(Nl)/r;return t&&(n=a.clamp(n,0,1)),n},closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new v),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),zl.prototype=Object.create(V.prototype),zl.prototype.constructor=zl,zl.prototype.isImmediateRenderObject=!0;var jl=new v;function Vl(e,t){V.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new lt,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.setAttribute("position",new Qe(n,3));var l=new Pi({fog:!1});this.cone=new Ui(r,l),this.add(this.cone),this.update()}Vl.prototype=Object.create(V.prototype),Vl.prototype.constructor=Vl,Vl.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Vl.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),jl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(jl),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Gl=new v,Wl=new M,Xl=new M;function Yl(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new lt,n=[],i=[],a=new He(0,0,1),o=new He(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.setAttribute("position",new Qe(n,3)),r.setAttribute("color",new Qe(i,3));var u=new Pi({vertexColors:!0,depthTest:!1,depthWrite:!1,transparent:!0});Ui.call(this,r,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function ql(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new Za(t,4,2),i=new ze({wireframe:!0,fog:!1});St.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Yl.prototype=Object.create(Ui.prototype),Yl.prototype.constructor=Yl,Yl.prototype.isSkeletonHelper=!0,Yl.prototype.updateMatrixWorld=function(e){var t=this.bones,r=this.geometry,n=r.getAttribute("position");Xl.getInverse(this.root.matrixWorld);for(var i=0,a=0;i<t.length;i++){var o=t[i];o.parent&&o.parent.isBone&&(Wl.multiplyMatrices(Xl,o.matrixWorld),Gl.setFromMatrixPosition(Wl),n.setXYZ(a,Gl.x,Gl.y,Gl.z),Wl.multiplyMatrices(Xl,o.parent.matrixWorld),Gl.setFromMatrixPosition(Wl),n.setXYZ(a+1,Gl.x,Gl.y,Gl.z),a+=2)}r.getAttribute("position").needsUpdate=!0,V.prototype.updateMatrixWorld.call(this,e)},ql.prototype=Object.create(St.prototype),ql.prototype.constructor=ql,ql.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ql.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var Zl=new v,Kl=new He,Ql=new He;function Jl(e,t,r){V.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new oa(t);n.rotateY(.5*Math.PI),this.material=new ze({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=!0);var i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.setAttribute("color",new Ve(a,3)),this.add(new St(n,this.material)),this.update()}function $l(e,t,r,n){e=e||10,t=t||10,r=new He(void 0!==r?r:4473924),n=new He(void 0!==n?n:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],l=[],u=0,c=0,h=-o;u<=t;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=u===i?r:n;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var f=new lt;f.setAttribute("position",new Qe(s,3)),f.setAttribute("color",new Qe(l,3));var p=new Pi({vertexColors:!0});Ui.call(this,f,p)}function eu(e,t,r,n,i,a){e=e||10,t=t||16,r=r||8,n=n||64,i=new He(void 0!==i?i:4473924),a=new He(void 0!==a?a:8947848);var o,s,l,u,c,h,d,f=[],p=[];for(u=0;u<=t;u++)l=u/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(o,0,s),d=1&u?i:a,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(u=0;u<=r;u++)for(d=1&u?i:a,h=e-e/r*u,c=0;c<n;c++)l=c/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,f.push(o,0,s),p.push(d.r,d.g,d.b),l=(c+1)/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,f.push(o,0,s),p.push(d.r,d.g,d.b);var m=new lt;m.setAttribute("position",new Qe(f,3)),m.setAttribute("color",new Qe(p,3));var g=new Pi({vertexColors:!0});Ui.call(this,m,g)}Jl.prototype=Object.create(V.prototype),Jl.prototype.constructor=Jl,Jl.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Jl.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Kl.copy(this.light.color),Ql.copy(this.light.groundColor);for(var r=0,n=t.count;r<n;r++){var i=r<n/2?Kl:Ql;t.setXYZ(r,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(Zl.setFromMatrixPosition(this.light.matrixWorld).negate())},$l.prototype=Object.assign(Object.create(Ui.prototype),{constructor:$l,copy:function(e){return Ui.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),eu.prototype=Object.create(Ui.prototype),eu.prototype.constructor=eu;var tu=new v,ru=new v,nu=new v;function iu(e,t,r){V.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new lt;n.setAttribute("position",new Qe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new Pi({fog:!1});this.lightPlane=new Di(n,i),this.add(this.lightPlane),(n=new lt).setAttribute("position",new Qe([0,0,0,0,0,1],3)),this.targetLine=new Di(n,i),this.add(this.targetLine),this.update()}iu.prototype=Object.create(V.prototype),iu.prototype.constructor=iu,iu.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},iu.prototype.update=function(){tu.setFromMatrixPosition(this.light.matrixWorld),ru.setFromMatrixPosition(this.light.target.matrixWorld),nu.subVectors(ru,tu),this.lightPlane.lookAt(ru),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ru),this.targetLine.scale.z=nu.length()};var au=new v,ou=new Bt;function su(e){var t=new lt,r=new Pi({color:16777215,vertexColors:!0}),n=[],i=[],a={},o=new He(16755200),s=new He(16711680),l=new He(43775),u=new He(16777215),c=new He(3355443);function h(e,t,r){d(e,r),d(t,r)}function d(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),t.setAttribute("position",new Qe(n,3)),t.setAttribute("color",new Qe(i,3)),Ui.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function lu(e,t,r,n,i,a,o){au.set(i,a,o).unproject(n);var s=t[e];if(void 0!==s)for(var l=r.getAttribute("position"),u=0,c=s.length;u<c;u++)l.setXYZ(s[u],au.x,au.y,au.z)}su.prototype=Object.create(Ui.prototype),su.prototype.constructor=su,su.prototype.update=function(){var e=this.geometry,t=this.pointMap;ou.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),lu("c",t,e,ou,0,0,-1),lu("t",t,e,ou,0,0,1),lu("n1",t,e,ou,-1,-1,-1),lu("n2",t,e,ou,1,-1,-1),lu("n3",t,e,ou,-1,1,-1),lu("n4",t,e,ou,1,1,-1),lu("f1",t,e,ou,-1,-1,1),lu("f2",t,e,ou,1,-1,1),lu("f3",t,e,ou,-1,1,1),lu("f4",t,e,ou,1,1,1),lu("u1",t,e,ou,.7,1.1,-1),lu("u2",t,e,ou,-.7,1.1,-1),lu("u3",t,e,ou,0,2,-1),lu("cf1",t,e,ou,-1,0,1),lu("cf2",t,e,ou,1,0,1),lu("cf3",t,e,ou,0,-1,1),lu("cf4",t,e,ou,0,1,1),lu("cn1",t,e,ou,-1,0,-1),lu("cn2",t,e,ou,1,0,-1),lu("cn3",t,e,ou,0,-1,-1),lu("cn4",t,e,ou,0,1,-1),e.getAttribute("position").needsUpdate=!0};var uu=new ie;function cu(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new lt;i.setIndex(new Ve(r,1)),i.setAttribute("position",new Ve(n,3)),Ui.call(this,i,new Pi({color:t})),this.matrixAutoUpdate=!1,this.update()}function hu(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new lt;n.setIndex(new Ve(r,1)),n.setAttribute("position",new Qe([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Ui.call(this,n,new Pi({color:t})),this.geometry.computeBoundingSphere()}function du(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new lt;i.setAttribute("position",new Qe([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Di.call(this,i,new Pi({color:n}));var a=new lt;a.setAttribute("position",new Qe([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new St(a,new ze({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}cu.prototype=Object.create(Ui.prototype),cu.prototype.constructor=cu,cu.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&uu.setFromObject(this.object),!uu.isEmpty()){var t=uu.min,r=uu.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=t.x,i[4]=r.y,i[5]=r.z,i[6]=t.x,i[7]=t.y,i[8]=r.z,i[9]=r.x,i[10]=t.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=t.z,i[15]=t.x,i[16]=r.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=r.x,i[22]=t.y,i[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},cu.prototype.setFromObject=function(e){return this.object=e,this.update(),this},cu.prototype.copy=function(e){return Ui.prototype.copy.call(this,e),this.object=e.object,this},cu.prototype.clone=function(){return(new this.constructor).copy(this)},hu.prototype=Object.create(Ui.prototype),hu.prototype.constructor=hu,hu.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),V.prototype.updateMatrixWorld.call(this,e))},du.prototype=Object.create(Di.prototype),du.prototype.constructor=du,du.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),V.prototype.updateMatrixWorld.call(this,e)};var fu,pu,mu=new v;function gu(e,t,r,n,i,a){V.call(this),void 0===e&&(e=new v(0,0,1)),void 0===t&&(t=new v(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===a&&(a=.2*i),void 0===fu&&((fu=new lt).setAttribute("position",new Qe([0,0,0,0,1,0],3)),(pu=new ao(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Di(fu,new Pi({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new St(pu,new ze({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,a)}function vu(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new lt;r.setAttribute("position",new Qe(t,3)),r.setAttribute("color",new Qe([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Pi({vertexColors:!0});Ui.call(this,r,n)}gu.prototype=Object.create(V.prototype),gu.prototype.constructor=gu,gu.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{mu.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(mu,t)}},gu.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},gu.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},gu.prototype.copy=function(e){return V.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},gu.prototype.clone=function(){return(new this.constructor).copy(this)},vu.prototype=Object.create(Ui.prototype),vu.prototype.constructor=vu;var yu,_u,bu,Eu,wu=Math.pow(2,8),xu=[.125,.215,.35,.446,.526,.582],Tu=5+xu.length,Mu={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Su=new Ss,Au=(yu=20,_u=new Float32Array(yu),bu=new v(0,1,0),(Eu=new fo({defines:{n:yu},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:_u},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:bu},inputEncoding:{value:Mu[3e3]},outputEncoding:{value:Mu[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",Eu),Ru=null,ku=null,Pu=function(){for(var e=[],t=[],r=[],n=8,i=0;i<Tu;i++){var a=Math.pow(2,n);t.push(a);var o=1/a;i>4?o=xu[i-8+4-1]:0==i&&(o=0),r.push(o);for(var s=1/(a-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=new Float32Array(108),d=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var m=p%3*2/3-1,g=p>2?0:-1,v=[m,g,0,m+2/3,g,0,m+2/3,g+1,0,m,g,0,m+2/3,g+1,0,m,g+1,0];h.set(v,18*p),d.set(c,12*p);var y=[p,p,p,p,p,p];f.set(y,6*p)}var _=new lt;_.setAttribute("position",new Ve(h,3)),_.setAttribute("uv",new Ve(d,2)),_.setAttribute("faceIndex",new Ve(f,1)),e.push(_),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:r}}(),Lu=Pu._lodPlanes,Cu=Pu._sizeLods,Iu=Pu._sigmas,Hu=null,Ou=null,Du=null,Fu=(1+Math.sqrt(5))/2,Nu=1/Fu,Uu=[new v(1,1,1),new v(-1,1,1),new v(1,1,-1),new v(-1,1,-1),new v(0,Fu,Nu),new v(0,Fu,-Nu),new v(Nu,0,Fu),new v(-Nu,0,Fu),new v(Fu,Nu,0),new v(-Fu,Nu,0)];function Bu(e){Ou=e,Vu(Au)}function zu(e){var t={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:e?e.type:1009,format:e?e.format:1023,encoding:e?e.encoding:3002,depthBuffer:!1,stencilBuffer:!1},r=Gu(t);return r.depthBuffer=!e,Hu=Gu(t),r}function ju(e){Hu.dispose(),Ou.setRenderTarget(Du),e.scissorTest=!1,e.setSize(e.width,e.height)}function Vu(e){var t=new G;t.add(new St(Lu[0],e)),Ou.compile(t,Su)}function Gu(e){var t=new d(3*wu,3*wu,e);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Wu(e,t,r,n,i){e.viewport.set(t,r,n,i),e.scissor.set(t,r,n,i)}function Xu(e){var t=Ou.autoClear;Ou.autoClear=!1;for(var r=1;r<Tu;r++)Yu(e,r-1,r,Math.sqrt(Iu[r]*Iu[r]-Iu[r-1]*Iu[r-1]),Uu[(r-1)%Uu.length]);Ou.autoClear=t}function Yu(e,t,r,n,i){qu(e,Hu,t,r,n,"latitudinal",i),qu(Hu,e,r,r,n,"longitudinal",i)}function qu(e,t,r,n,i,a,o){"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new G;s.add(new St(Lu[n],Au));var l=Au.uniforms,u=Cu[r]-1,c=isFinite(i)?Math.PI/(2*u):2*Math.PI/39,h=i/c,d=isFinite(i)?1+Math.floor(3*h):20;d>20&&console.warn("sigmaRadians, "+i+", is too large and will clip, as it requested "+d+" samples when the maximum is set to 20");for(var f=[],p=0,m=0;m<20;++m){var g=m/h,v=Math.exp(-g*g/2);f.push(v),0==m?p+=v:m<d&&(p+=2*v)}for(m=0;m<f.length;m++)f[m]=f[m]/p;l.envMap.value=e.texture,l.samples.value=d,l.weights.value=f,l.latitudinal.value="latitudinal"===a,o&&(l.poleAxis.value=o),l.dTheta.value=c,l.mipInt.value=8-r,l.inputEncoding.value=Mu[e.texture.encoding],l.outputEncoding.value=Mu[e.texture.encoding];var y=Cu[n];Wu(t,g=3*Math.max(0,wu-2*y),(0===n?0:2*wu)+2*y*(n>4?n-8+4:0),3*y,2*y),Ou.setRenderTarget(t),Ou.render(s,Su)}function Zu(){var e=new fo({uniforms:{envMap:{value:null},texelSize:{value:new o(1,1)},inputEncoding:{value:Mu[3e3]},outputEncoding:{value:Mu[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function Ku(){var e=new fo({uniforms:{envMap:{value:null},inputEncoding:{value:Mu[3e3]},outputEncoding:{value:Mu[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function Qu(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),is.call(this,e),this.type="catmullrom",this.closed=!0}function Ju(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),is.call(this,e),this.type="catmullrom"}function $u(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),is.call(this,e),this.type="catmullrom"}Bu.prototype={constructor:Bu,fromScene:function(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=.1),void 0===n&&(n=100),Du=Ou.getRenderTarget();var i=zu();return function(e,t,r,n){var i=new zt(90,1,t,r),a=[1,1,1,1,-1,1],o=[1,1,-1,-1,-1,1],s=Ou.outputEncoding,l=Ou.toneMapping,u=Ou.toneMappingExposure,c=Ou.getClearColor(),h=Ou.getClearAlpha();Ou.toneMapping=1,Ou.toneMappingExposure=1,Ou.outputEncoding=3e3,e.scale.z*=-1;var d=e.background;if(d&&d.isColor){d.convertSRGBToLinear();var f=Math.max(d.r,d.g,d.b),p=Math.min(Math.max(Math.ceil(Math.log2(f)),-128),127);d=d.multiplyScalar(Math.pow(2,-p));var m=(p+128)/255;Ou.setClearColor(d,m),e.background=null}for(var g=0;g<6;g++){var v=g%3;0==v?(i.up.set(0,a[g],0),i.lookAt(o[g],0,0)):1==v?(i.up.set(0,0,a[g]),i.lookAt(0,o[g],0)):(i.up.set(0,a[g],0),i.lookAt(0,0,o[g])),Wu(n,v*wu,g>2?wu:0,wu,wu),Ou.setRenderTarget(n),Ou.render(e,i)}Ou.toneMapping=l,Ou.toneMappingExposure=u,Ou.outputEncoding=s,Ou.setClearColor(c,h),e.scale.z*=-1}(e,r,n,i),t>0&&Yu(i,0,0,t),Xu(i),ju(i),i},fromEquirectangular:function(e){return e.magFilter=1003,e.minFilter=1003,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){Du=Ou.getRenderTarget();var t=zu(e);return function(e,t){var r=new G;e.isCubeTexture?null==ku&&(ku=Ku()):null==Ru&&(Ru=Zu());var n=e.isCubeTexture?ku:Ru;r.add(new St(Lu[0],n));var i=n.uniforms;i.envMap.value=e,e.isCubeTexture||i.texelSize.value.set(1/e.image.width,1/e.image.height),i.inputEncoding.value=Mu[e.encoding],i.outputEncoding.value=Mu[e.encoding],Wu(t,0,0,3*wu,2*wu),Ou.setRenderTarget(t),Ou.render(r,Su)}(e,t),Xu(t),ju(t),t},compileCubemapShader:function(){null==ku&&Vu(ku=Ku())},compileEquirectangularShader:function(){null==Ru&&Vu(Ru=Zu())},dispose:function(){Au.dispose(),null!=ku&&ku.dispose(),null!=Ru&&Ru.dispose();for(var e=0;e<Lu.length;e++)Lu[e].dispose()}},Ko.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ko.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(gs.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new It,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new v(i.x,i.y,i.z||0))}return t}}),Object.assign(vs.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Qu.prototype=Object.create(is.prototype),Ju.prototype=Object.create(is.prototype),$u.prototype=Object.create(is.prototype),Object.assign($u.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),$l.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Yl.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(zo.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Cs.extractUrlBase(e)}}),zo.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Fs.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Fl.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(ie.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Yt.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Bl.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(a,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),a.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),a.ceilPowerOfTwo(e)}}),Object.assign(s.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(M.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new v).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,a)}}),_e.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},p.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(me.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Pe.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Pe,{barycoordFromPoint:function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Pe.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Pe.getNormal(e,t,r,n)}}),Object.assign(ys.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ja(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new eo(this,e)}}),Object.assign(o.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(v.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(h.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(It.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(V.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(V.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(St.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(St.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(_i.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(xi.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),bi.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ko.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),zt.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(_s.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ve.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(Ve.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(lt.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Ve(arguments[1],arguments[2])))},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(lt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ll.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(Jn.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Jn.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Va.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(kl.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Be.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new He}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(go.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ut.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Zn.prototype,{clearTarget:function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Zn.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}}}),Object.defineProperties(jn.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(d.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(ll.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new qs).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),pl.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},jt.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var ec={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};l.crossOrigin=void 0,l.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Zo;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},l.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new qo;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},l.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},l.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var tc={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"114"}})),e.ACESFilmicToneMapping=5,e.AddEquation=100,e.AddOperation=2,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=ks,e.AmbientLightProbe=Js,e.AnimationClip=Do,e.AnimationLoader=Go,e.AnimationMixer=Rl,e.AnimationObjectGroup=Sl,e.AnimationUtils=xo,e.ArcCurve=Jo,e.ArrayCamera=Xn,e.ArrowHelper=gu,e.Audio=ll,e.AudioAnalyser=pl,e.AudioContext=Ys,e.AudioListener=sl,e.AudioLoader=qs,e.AxesHelper=vu,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new vu(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Xo(e)},e.Bone=Ti,e.BooleanKeyframeTrack=ko,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new cu(e,t)},e.Box2=Fl,e.Box3=ie,e.Box3Helper=hu,e.BoxBufferGeometry=Ot,e.BoxGeometry=Ht,e.BoxHelper=cu,e.BufferAttribute=Ve,e.BufferGeometry=lt,e.BufferGeometryLoader=Os,e.ByteType=1010,e.Cache=No,e.Camera=Bt,e.CameraHelper=su,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=Ki,e.CatmullRomCurve3=is,e.CineonToneMapping=4,e.CircleBufferGeometry=uo,e.CircleGeometry=lo,e.ClampToEdgeWrapping=1001,e.Clock=rl,e.ClosedSplineCurve3=Qu,e.Color=He,e.ColorKeyframeTrack=Po,e.CompressedTexture=Zi,e.CompressedTextureLoader=Wo,e.ConeBufferGeometry=so,e.ConeGeometry=oo,e.CubeCamera=jt,e.CubeGeometry=Ht,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.CubeTexture=dr,e.CubeTextureLoader=qo,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.CubicBezierCurve=ls,e.CubicBezierCurve3=us,e.CubicInterpolant=Mo,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=Ko,e.CurvePath=gs,e.CustomBlending=5,e.CylinderBufferGeometry=ao,e.CylinderGeometry=io,e.Cylindrical=Ol,e.DataTexture=Gt,e.DataTexture2DArray=fr,e.DataTexture3D=pr,e.DataTextureLoader=Xo,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=Bo,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.DepthTexture=Qi,e.DirectionalLight=Rs,e.DirectionalLightHelper=iu,e.DirectionalLightShadow=As,e.DiscreteInterpolant=Ao,e.DodecahedronBufferGeometry=ca,e.DodecahedronGeometry=ua,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ve(e,t).setUsage(35048)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=35048,e.DynamicReadUsage=35049,e.EdgesGeometry=no,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ui(new no(e.geometry),new Pi({color:void 0!==t?t:16777215}))},e.EllipseCurve=Qo,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.Euler=R,e.EventDispatcher=t,e.ExtrudeBufferGeometry=Va,e.ExtrudeGeometry=ja,e.Face3=Ne,e.Face4=function(e,t,r,n,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Ne(e,t,r,i,a,o)},e.FaceColors=1,e.FileLoader=Vo,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Qe(e,t)},e.Float32BufferAttribute=Qe,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Je(e,t)},e.Float64BufferAttribute=Je,e.FloatType=1015,e.Fog=Qn,e.FogExp2=Kn,e.Font=Gs,e.FontLoader=Xs,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=0,e.Frustum=Yt,e.GammaEncoding=3007,e.Geometry=It,e.GeometryUtils=ec,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=$l,e.Group=Yn,e.HalfFloatType=1016,e.HemisphereLight=bs,e.HemisphereLightHelper=Jl,e.HemisphereLightProbe=Qs,e.IcosahedronBufferGeometry=la,e.IcosahedronGeometry=sa,e.ImageBitmapLoader=js,e.ImageLoader=Yo,e.ImageUtils=l,e.ImmediateRenderObject=zl,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=Hs,e.InstancedBufferGeometry=Is,e.InstancedInterleavedBuffer=Pl,e.InstancedMesh=ki,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ye(e,t)},e.Int16BufferAttribute=Ye,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ze(e,t)},e.Int32BufferAttribute=Ze,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ge(e,t)},e.Int8BufferAttribute=Ge,e.IntType=1013,e.InterleavedBuffer=Jn,e.InterleavedBufferAttribute=ti,e.Interpolant=To,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=7680,e.KeyframeTrack=Ro,e.LOD=_i,e.LatheBufferGeometry=$a,e.LatheGeometry=Ja,e.Layers=k,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=_s,e.LightProbe=Ks,e.LightShadow=Es,e.Line=Di,e.Line3=Bl,e.LineBasicMaterial=Pi,e.LineCurve=cs,e.LineCurve3=hs,e.LineDashedMaterial=Eo,e.LineLoop=Bi,e.LinePieces=1,e.LineSegments=Ui,e.LineStrip=0,e.LinearEncoding=3e3,e.LinearFilter=1006,e.LinearInterpolant=So,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=1008,e.LinearMipmapNearestFilter=1007,e.LinearToneMapping=1,e.Loader=zo,e.LoaderUtils=Cs,e.LoadingManager=Uo,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=Be,e.MaterialLoader=Ls,e.Math=a,e.MathUtils=a,e.Matrix3=s,e.Matrix4=M,e.MaxEquation=104,e.Mesh=St,e.MeshBasicMaterial=ze,e.MeshDepthMaterial=Bn,e.MeshDistanceMaterial=zn,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=_o,e.MeshMatcapMaterial=bo,e.MeshNormalMaterial=yo,e.MeshPhongMaterial=go,e.MeshPhysicalMaterial=mo,e.MeshStandardMaterial=po,e.MeshToonMaterial=vo,e.MinEquation=103,e.MirroredRepeatWrapping=1002,e.MixOperation=1,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=1003,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=1005,e.NearestMipmapNearestFilter=1004,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=Lo,e.Object3D=V,e.ObjectLoader=Fs,e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=oa,e.OctahedronGeometry=aa,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=Ss,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=Bu,e.ParametricBufferGeometry=ea,e.ParametricGeometry=$i,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new mi(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new zi(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Xi(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new zi(e)},e.Path=vs,e.PerspectiveCamera=zt,e.Plane=_e,e.PlaneBufferGeometry=Jt,e.PlaneGeometry=Qt,e.PlaneHelper=du,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Xi(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new zi(e)},e.PointLight=Ms,e.PointLightHelper=ql,e.Points=Xi,e.PointsMaterial=zi,e.PolarGridHelper=eu,e.PolyhedronBufferGeometry=ra,e.PolyhedronGeometry=ta,e.PositionalAudio=fl,e.PropertyBinding=Ml,e.PropertyMixer=ml,e.QuadraticBezierCurve=ds,e.QuadraticBezierCurve3=fs,e.Quaternion=p,e.QuaternionKeyframeTrack=Io,e.QuaternionLinearInterpolant=Co,e.REVISION="114",e.RGBADepthPacking=3201,e.RGBAFormat=1023,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_ETC2_EAC_Format=37496,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGBDEncoding=3006,e.RGBEEncoding=3002,e.RGBEFormat=1023,e.RGBFormat=1022,e.RGBIntegerFormat=1032,e.RGBM16Encoding=3005,e.RGBM7Encoding=3004,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=37492,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_S3TC_DXT1_Format=33776,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=fo,e.Ray=me,e.Raycaster=Ll,e.RectAreaLight=Ps,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=1e3,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Qa,e.RingGeometry=Ka,e.SRGB8_ALPHA8_ASTC_10x10_Format=37851,e.SRGB8_ALPHA8_ASTC_10x5_Format=37848,e.SRGB8_ALPHA8_ASTC_10x6_Format=37849,e.SRGB8_ALPHA8_ASTC_10x8_Format=37850,e.SRGB8_ALPHA8_ASTC_12x10_Format=37852,e.SRGB8_ALPHA8_ASTC_12x12_Format=37853,e.SRGB8_ALPHA8_ASTC_4x4_Format=37840,e.SRGB8_ALPHA8_ASTC_5x4_Format=37841,e.SRGB8_ALPHA8_ASTC_5x5_Format=37842,e.SRGB8_ALPHA8_ASTC_6x5_Format=37843,e.SRGB8_ALPHA8_ASTC_6x6_Format=37844,e.SRGB8_ALPHA8_ASTC_8x5_Format=37845,e.SRGB8_ALPHA8_ASTC_8x6_Format=37846,e.SRGB8_ALPHA8_ASTC_8x8_Format=37847,e.Scene=G,e.SceneUtils=tc,e.ShaderChunk=$t,e.ShaderLib=er,e.ShaderMaterial=Ut,e.ShadowMaterial=ho,e.Shape=ys,e.ShapeBufferGeometry=to,e.ShapeGeometry=eo,e.ShapePath=Vs,e.ShapeUtils=Ua,e.ShortType=1011,e.Skeleton=xi,e.SkeletonHelper=Yl,e.SkinnedMesh=bi,e.SmoothShading=2,e.Sphere=se,e.SphereBufferGeometry=Za,e.SphereGeometry=qa,e.Spherical=Hl,e.SphericalHarmonics3=Zs,e.SphericalReflectionMapping=305,e.Spline=$u,e.SplineCurve=ps,e.SplineCurve3=Ju,e.SpotLight=xs,e.SpotLightHelper=Vl,e.SpotLightShadow=ws,e.Sprite=mi,e.SpriteMaterial=ri,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=35044,e.StaticReadUsage=35045,e.StereoCamera=tl,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=Ho,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=ia,e.TetrahedronGeometry=na,e.TextBufferGeometry=Ya,e.TextGeometry=Xa,e.Texture=c,e.TextureLoader=Zo,e.TorusBufferGeometry=ga,e.TorusGeometry=ma,e.TorusKnotBufferGeometry=pa,e.TorusKnotGeometry=fa,e.Triangle=Pe,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=da,e.TubeGeometry=ha,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new qe(e,t)},e.Uint16BufferAttribute=qe,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ke(e,t)},e.Uint32BufferAttribute=Ke,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new We(e,t)},e.Uint8BufferAttribute=We,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Xe(e,t)},e.Uint8ClampedBufferAttribute=Xe,e.Uncharted2ToneMapping=3,e.Uniform=kl,e.UniformsLib=qt,e.UniformsUtils=Nt,e.UnsignedByteType=1009,e.UnsignedInt248Type=1020,e.UnsignedIntType=1014,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedShortType=1012,e.VSMShadowMap=3,e.Vector2=o,e.Vector3=v,e.Vector4=h,e.VectorKeyframeTrack=Oo,e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new v(e,t,r)},e.VertexColors=2,e.VideoTexture=qi,e.WebGLCubeRenderTarget=Vt,e.WebGLMultisampleRenderTarget=f,e.WebGLRenderTarget=d,e.WebGLRenderTargetCube=function(e,t,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Vt(e,r)},e.WebGLRenderer=Zn,e.WebGLUtils=Wn,e.WireframeGeometry=Ji,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ui(new Ji(e.geometry),new Pi({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Vo(e)},e.ZeroCurvatureEnding=2400,e.ZeroFactor=200,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=3001,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){"use strict";(function(e,n){var i=r(13),a=r(15);e.__TYPEDARRAY_POOL||(e.__TYPEDARRAY_POOL={UINT8:a([32,0]),UINT16:a([32,0]),UINT32:a([32,0]),BIGUINT64:a([32,0]),INT8:a([32,0]),INT16:a([32,0]),INT32:a([32,0]),BIGINT64:a([32,0]),FLOAT:a([32,0]),DOUBLE:a([32,0]),DATA:a([32,0]),UINT8C:a([32,0]),BUFFER:a([32,0])});var o="undefined"!=typeof Uint8ClampedArray,s="undefined"!=typeof BigUint64Array,l="undefined"!=typeof BigInt64Array,u=e.__TYPEDARRAY_POOL;u.UINT8C||(u.UINT8C=a([32,0])),u.BIGUINT64||(u.BIGUINT64=a([32,0])),u.BIGINT64||(u.BIGINT64=a([32,0])),u.BUFFER||(u.BUFFER=a([32,0]));var c=u.DATA,h=u.BUFFER;function d(e){if(e){var t=e.length||e.byteLength,r=i.log2(t);c[r].push(e)}}function f(e){e=i.nextPow2(e);var t=i.log2(e),r=c[t];return r.length>0?r.pop():new ArrayBuffer(e)}function p(e){return new Uint8Array(f(e),0,e)}function m(e){return new Uint16Array(f(2*e),0,e)}function g(e){return new Uint32Array(f(4*e),0,e)}function v(e){return new Int8Array(f(e),0,e)}function y(e){return new Int16Array(f(2*e),0,e)}function _(e){return new Int32Array(f(4*e),0,e)}function b(e){return new Float32Array(f(4*e),0,e)}function E(e){return new Float64Array(f(8*e),0,e)}function w(e){return o?new Uint8ClampedArray(f(e),0,e):p(e)}function x(e){return s?new BigUint64Array(f(8*e),0,e):null}function T(e){return l?new BigInt64Array(f(8*e),0,e):null}function M(e){return new DataView(f(e),0,e)}function S(e){e=i.nextPow2(e);var t=i.log2(e),r=h[t];return r.length>0?r.pop():new n(e)}t.free=function(e){if(n.isBuffer(e))h[i.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,r=0|i.log2(t);c[r].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeBigUint64=t.freeInt8=t.freeInt16=t.freeInt32=t.freeBigInt64=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){d(e.buffer)},t.freeArrayBuffer=d,t.freeBuffer=function(e){h[i.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return f(e);switch(t){case"uint8":return p(e);case"uint16":return m(e);case"uint32":return g(e);case"int8":return v(e);case"int16":return y(e);case"int32":return _(e);case"float":case"float32":return b(e);case"double":case"float64":return E(e);case"uint8_clamped":return w(e);case"bigint64":return T(e);case"biguint64":return x(e);case"buffer":return S(e);case"data":case"dataview":return M(e);default:return null}return null},t.mallocArrayBuffer=f,t.mallocUint8=p,t.mallocUint16=m,t.mallocUint32=g,t.mallocInt8=v,t.mallocInt16=y,t.mallocInt32=_,t.mallocFloat32=t.mallocFloat=b,t.mallocFloat64=t.mallocDouble=E,t.mallocUint8Clamped=w,t.mallocBigUint64=x,t.mallocBigInt64=T,t.mallocDataView=M,t.mallocBuffer=S,t.clearCache=function(){for(var e=0;e<32;++e)u.UINT8[e].length=0,u.UINT16[e].length=0,u.UINT32[e].length=0,u.INT8[e].length=0,u.INT16[e].length=0,u.INT32[e].length=0,u.FLOAT[e].length=0,u.DOUBLE[e].length=0,u.BIGUINT64[e].length=0,u.BIGINT64[e].length=0,u.UINT8C[e].length=0,c[e].length=0,h[e].length=0}}).call(this,r(5),r(20).Buffer)},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t,r){(function(t){e.exports=function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=r[o]={exports:{}};t[o][0].call(l.exports,(function(e){var r=t[o][1][e];return i(r||e)}),l,l.exports,e,t,r,n)}return r[o].exports}for(var a=!1,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,a,o,s,l,u="",c=0;c<e.length;)a=(t=e.charCodeAt(c++))>>2,o=(3&t)<<4|(r=e.charCodeAt(c++))>>4,s=(15&r)<<2|(i=e.charCodeAt(c++))>>6,l=63&i,isNaN(r)?s=l=64:isNaN(i)&&(l=64),u=u+n.charAt(a)+n.charAt(o)+n.charAt(s)+n.charAt(l);return u},r.decode=function(e){var t,r,i,a,o,s,l="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)t=n.indexOf(e.charAt(u++))<<2|(a=n.indexOf(e.charAt(u++)))>>4,r=(15&a)<<4|(o=n.indexOf(e.charAt(u++)))>>2,i=(3&o)<<6|(s=n.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!=o&&(l+=String.fromCharCode(r)),64!=s&&(l+=String.fromCharCode(i));return l}},{}],2:[function(e,t){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,r){"use strict";r.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},r.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){"use strict";var r=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==r.getTypeOf(e);void 0===t&&(t=0);var a=0;t^=-1;for(var o=0,s=e.length;s>o;o++)a=i?e[o]:e.charCodeAt(o),t=t>>>8^n[255&(t^a)];return-1^t}},{"./utils":21}],5:[function(e,t){"use strict";function r(){this.data=null,this.length=0,this.index=0}var n=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!1,r.date=null,r.compression=null,r.comment=null},{}],7:[function(e,t,r){"use strict";var n=e("./utils");r.string2binary=function(e){return n.string2binary(e)},r.string2Uint8Array=function(e){return n.transformTo("uint8array",e)},r.uint8Array2String=function(e){return n.transformTo("string",e)},r.string2Blob=function(e){var t=n.transformTo("arraybuffer",e);return n.arrayBuffer2Blob(t)},r.arrayBuffer2Blob=function(e){return n.arrayBuffer2Blob(e)},r.transformTo=function(e,t){return n.transformTo(e,t)},r.getTypeOf=function(e){return n.getTypeOf(e)},r.checkSupport=function(e){return n.checkSupport(e)},r.MAX_VALUE_16BITS=n.MAX_VALUE_16BITS,r.MAX_VALUE_32BITS=n.MAX_VALUE_32BITS,r.pretty=function(e){return n.pretty(e)},r.findCompression=function(e){return n.findCompression(e)},r.isRegExp=function(e){return n.isRegExp(e)}},{"./utils":21}],8:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako");r.uncompressInputType=n?"uint8array":"array",r.compressInputType=n?"uint8array":"array",r.magic="\b\0",r.compress=function(e){return i.deflateRaw(e)},r.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t){"use strict";function r(e,t){return this instanceof r?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(e,t)}var n=e("./base64");r.prototype=e("./object"),r.prototype.load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){"use strict";var r=e("./base64"),n=e("./zipEntries");t.exports=function(e,t){var i,a,o,s;for((t=t||{}).base64&&(e=r.decode(e)),i=(a=new n(e,t)).files,o=0;o<i.length;o++)s=i[o],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:t.createFolders});return a.zipComment.length&&(this.comment=a.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,r){(function(e){"use strict";r.exports=function(t,r){return new e(t,r)},r.exports.test=function(t){return e.isBuffer(t)}}).call(this,void 0!==t?t:void 0)},{}],12:[function(e,t){"use strict";function r(e){this.data=e,this.length=this.data.length,this.index=0}var n=e("./uint8ArrayReader");r.prototype=new n,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t){"use strict";var r=e("./support"),n=e("./utils"),i=e("./crc32"),a=e("./signature"),o=e("./defaults"),s=e("./base64"),l=e("./compressions"),u=e("./compressedObject"),c=e("./nodeBuffer"),h=e("./utf8"),d=e("./stringWriter"),f=e("./uint8ArrayWriter"),p=function(e){if(e._data instanceof u&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},m=function(e){var t=p(e);return"string"===n.getTypeOf(t)?!e.options.binary&&r.nodebuffer?c(t,"utf-8"):e.asBinary():t},g=function(e){var t=p(this);return null==t?"":(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?S.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",S.utf8encode(t))),t)},v=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this._data=t,this.options=r,this._initialMetadata={dir:r.dir,date:r.date}};v.prototype={asText:function(){return g.call(this,!0)},asBinary:function(){return g.call(this,!1)},asNodeBuffer:function(){var e=m(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=m(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var y=function(e,t){var r,n="";for(r=0;t>r;r++)n+=String.fromCharCode(255&e),e>>>=8;return n},_=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},b=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=_(e,o)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},E=function(e,t,r){var i,a=n.getTypeOf(t);if((r=b(r)).createFolders&&(i=w(e))&&x.call(this,i,!0),r.dir||null==t)r.base64=!1,r.binary=!1,t=null;else if("string"===a)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=n.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(a||t instanceof u))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===a&&(t=n.transformTo("uint8array",t))}var o=new v(e,t,r);return this.files[e]=o,o},w=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},x=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t=void 0!==t&&t,this.files[e]||E.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},T=function(e,t){var r,a=new u;return e._data instanceof u?(a.uncompressedSize=e._data.uncompressedSize,a.crc32=e._data.crc32,0===a.uncompressedSize||e.dir?(t=l.STORE,a.compressedContent="",a.crc32=0):e._data.compressionMethod===t.magic?a.compressedContent=e._data.getCompressedContent():(r=e._data.getContent(),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r)))):((!(r=m(e))||0===r.length||e.dir)&&(t=l.STORE,r=""),a.uncompressedSize=r.length,a.crc32=i(r),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r))),a.compressedSize=a.compressedContent.length,a.compressionMethod=t.magic,a},M=function(e,t,r,o){var s,l,u,c,d=(r.compressedContent,n.transformTo("string",h.utf8encode(t.name))),f=t.comment||"",p=n.transformTo("string",h.utf8encode(f)),m=d.length!==t.name.length,g=p.length!==f.length,v=t.options,_="",b="",E="";u=t._initialMetadata.dir!==t.dir?t.dir:v.dir,s=(c=t._initialMetadata.date!==t.date?t.date:v.date).getHours(),s<<=6,s|=c.getMinutes(),s<<=5,s|=c.getSeconds()/2,l=c.getFullYear()-1980,l<<=4,l|=c.getMonth()+1,l<<=5,l|=c.getDate(),m&&(b=y(1,1)+y(i(d),4)+d,_+="up"+y(b.length,2)+b),g&&(E=y(1,1)+y(this.crc32(p),4)+p,_+="uc"+y(E.length,2)+E);var w="";return w+="\n\0",w+=m||g?"\0\b":"\0\0",w+=r.compressionMethod,w+=y(s,2),w+=y(l,2),w+=y(r.crc32,4),w+=y(r.compressedSize,4),w+=y(r.uncompressedSize,4),w+=y(d.length,2),w+=y(_.length,2),{fileRecord:a.LOCAL_FILE_HEADER+w+d+_,dirRecord:a.CENTRAL_FILE_HEADER+"\0"+w+y(p.length,2)+"\0\0\0\0"+(!0===u?"\0\0\0":"\0\0\0\0")+y(o,4)+d+_+p,compressedObject:r}},S={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,n,i,a=[];for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],i=new v(n.name,n._data,_(n.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(r,i)&&a.push(i));return a},file:function(e,t,r){if(1===arguments.length){if(n.isRegExp(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}return this.filter((function(t,r){return!r.dir&&t===e}))[0]||null}return e=this.root+e,E.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=x.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){e=_(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),n.checkSupport(e.type);var t,r,i,o=[],u=0,c=0,h=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var p in this.files)if(this.files.hasOwnProperty(p)){var m=this.files[p],g=m.options.compression||e.compression.toUpperCase(),v=l[g];if(!v)throw new Error(g+" is not a valid compression method !");var b=T.call(this,m,v),E=M.call(this,p,m,b,u);u+=E.fileRecord.length+b.compressedSize,c+=E.dirRecord.length,o.push(E)}i=a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+y(o.length,2)+y(o.length,2)+y(c,4)+y(u,4)+y(h.length,2)+h;var w=e.type.toLowerCase();for(t="uint8array"===w||"arraybuffer"===w||"blob"===w||"nodebuffer"===w?new f(u+c+i.length):new d(u+c+i.length),r=0;r<o.length;r++)t.append(o[r].fileRecord),t.append(o[r].compressedObject.compressedContent);for(r=0;r<o.length;r++)t.append(o[r].dirRecord);t.append(i);var x=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),x);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",x));case"base64":return e.base64?s.encode(x):x;default:return x}},crc32:function(e,t){return i(e,t)},utf8encode:function(e){return n.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=S},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t){"use strict";function r(e,t){this.data=e,t||(this.data=i.string2binary(this.data)),this.length=this.data.length,this.index=0}var n=e("./dataReader"),i=e("./utils");r.prototype=new n,r.prototype.byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,t){"use strict";var r=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":21}],17:[function(e,r,n){(function(e){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==e,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);r.append(t),n.blob=0===r.getBlob("application/zip").size}catch(e){n.blob=!1}}}}).call(this,void 0!==t?t:void 0)},{}],18:[function(e,t){"use strict";function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var n=e("./dataReader");r.prototype=new n,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===n&&this.data[a+3]===i)return a;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t){"use strict";var r=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":21}],20:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),a=e("./nodeBuffer"),o=new Array(256),s=0;256>s;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;o[254]=o[254]=1;var l=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r||0===r?t:r+o[e[r]]>t?r:t},u=function(e){var t,r,i,a,s=e.length,l=new Array(2*s);for(r=0,t=0;s>t;)if(128>(i=e[t++]))l[r++]=i;else if((a=o[i])>4)l[r++]=65533,t+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&s>t;)i=i<<6|63&e[t++],a--;a>1?l[r++]=65533:65536>i?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)};r.utf8encode=function(e){return i.nodebuffer?a(e,"utf-8"):function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t}(e)},r.utf8decode=function(e){if(i.nodebuffer)return n.transformTo("nodebuffer",e).toString("utf-8");for(var t=[],r=0,a=(e=n.transformTo(i.uint8array?"uint8array":"array",e)).length;a>r;){var o=l(e,Math.min(r+65536,a));t.push(i.uint8array?u(e.subarray(r,o)):u(e.slice(r,o))),r=o}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,r){"use strict";function n(e){return e}function i(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function a(e){var t=65536,n=[],i=e.length,a=r.getTypeOf(e),o=0,s=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,u(0))}}catch(e){s=!1}if(!s){for(var l="",c=0;c<e.length;c++)l+=String.fromCharCode(e[c]);return l}for(;i>o&&t>1;)try{n.push("array"===a||"nodebuffer"===a?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,i))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,i)))),o+=t}catch(e){t=Math.floor(t/2)}return n.join("")}function o(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var s=e("./support"),l=e("./compressions"),u=e("./nodeBuffer");r.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},r.arrayBuffer2Blob=function(e){r.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(r){try{var t=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return t.append(e),t.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},r.applyFromCharCode=a;var c={};c.string={string:n,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,u(e.length))}},c.array={string:a,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(e)}},c.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(new Uint8Array(e))}},c.uint8array={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return u(e)}},c.nodebuffer={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:n},r.transformTo=function(e,t){if(t||(t=""),!e)return t;r.checkSupport(e);var n=r.getTypeOf(t);return c[n][e](t)},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&u.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!s[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+(16>(t=e.charCodeAt(r))?"0":"")+t.toString(16).toUpperCase();return n},r.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){"use strict";function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var n=e("./stringReader"),i=e("./nodeBufferReader"),a=e("./uint8ArrayReader"),o=e("./utils"),s=e("./signature"),l=e("./zipEntry"),u=e("./support"),c=e("./object");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=c.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;n>0;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);this.reader="string"!==t||u.uint8array?"nodebuffer"===t?new i(e):new a(o.transformTo("uint8array",e)):new n(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var n=e("./stringReader"),i=e("./utils"),a=e("./compressedObject"),o=e("./object");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,r){return function(){var n=e.index;e.setIndex(t);var i=e.readData(r);return e.setIndex(n),i}},prepareContent:function(e,t,r,n,a){return function(){var e=i.transformTo(n.uncompressInputType,this.getCompressedContent()),t=n.uncompress(e);if(t.length!==a)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(r),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=i.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new a,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=i.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),n=e.readString(r),this.extraFields[t]={id:t,length:r,value:n}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return 1!==t.readInt(1)||o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return 1!==t.readInt(1)||o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,r){"use strict";function n(e,t){var r=new u(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/deflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/messages"),l=e("./zlib/zstream"),u=function(e){this.options=a.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(s[r]);t.header&&i.deflateSetHeader(this.strm,t.header)};u.prototype.push=function(e,t){var r,n,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,s.input="string"==typeof e?o.string2buf(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=i.deflate(s,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;(0===s.avail_out||0===s.avail_in&&4===n)&&this.onData("string"===this.options.to?o.buf2binstring(a.shrinkBuf(s.output,s.next_out)):a.shrinkBuf(s.output,s.next_out))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4!==n||(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=u,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,r){"use strict";function n(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/inflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/constants"),l=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),h=function(e){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,t.windowBits);if(r!==s.Z_OK)throw new Error(l[r]);this.header=new c,i.inflateGetHeader(this.strm,this.header)};h.prototype.push=function(e,t){var r,n,l,u,c,h=this.strm,d=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,h.input="string"==typeof e?o.binstring2buf(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),(r=i.inflate(h,s.Z_NO_FLUSH))!==s.Z_STREAM_END&&r!==s.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0===h.avail_out||r===s.Z_STREAM_END||0===h.avail_in&&n===s.Z_FINISH)&&("string"===this.options.to?(l=o.utf8border(h.output,h.next_out),u=h.next_out-l,c=o.buf2string(h.output,l),h.next_out=u,h.avail_out=d-u,u&&a.arraySet(h.output,h.output,l,u,0),this.onData(c)):this.onData(a.shrinkBuf(h.output,h.next_out)))}while(h.avail_in>0&&r!==s.Z_STREAM_END);return r===s.Z_STREAM_END&&(n=s.Z_FINISH),n!==s.Z_FINISH||(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===s.Z_OK)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===s.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=h,r.inflate=n,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.ungzip=n},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;r>t;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;r>t;t++)a=e[t],o.set(a,i),i+=a.length;return o}},a={arraySet:function(e,t,r,n,i){for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],28:[function(e,t,r){"use strict";function n(e,t){if(65537>t&&(e.subarray&&o||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",n=0;t>n;n++)r+=String.fromCharCode(e[n]);return r}var i=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new i.Buf8(256),l=0;256>l;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,r.string2buf=function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=new i.Buf8(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},r.buf2binstring=function(e){return n(e,e.length)},r.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;n>r;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,i,a,o,l=t||e.length,u=new Array(2*l);for(i=0,r=0;l>r;)if(128>(a=e[r++]))u[i++]=a;else if((o=s[a])>4)u[i++]=65533,r+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&l>r;)a=a<<6|63&e[r++],o--;o>1?u[i++]=65533:65536>a?u[i++]=a:(a-=65536,u[i++]=55296|a>>10&1023,u[i++]=56320|1023&a)}return n(u,i)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r||0===r?t:r+s[e[r]]>t?r:t}},{"./common":27}],29:[function(e,t){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){"use strict";var r=function(){for(var e,t=[],r=0;256>r;r++){e=r;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;o>s;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},{}],32:[function(e,t,r){"use strict";function n(e,t){return e.msg=S[t],t}function i(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(w.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function s(e,t){x._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,w.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=T(e.adler,t,i,r):2===e.state.wrap&&(e.adler=M(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function h(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-te?e.strstart-(e.w_size-te):0,u=e.window,c=e.w_mask,h=e.prev,d=e.strstart+ee,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===f&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&d>a);if(n=ee-(d-a),a=d-ee,n>o){if(e.match_start=t,o=n,n>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=h[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function d(e){var t,r,n,i,a,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-te)){w.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=o?n-o:0}while(--r);t=r=o;do{n=e.prev[--t],e.prev[t]=n>=o?n-o:0}while(--r);i+=o}if(0===e.strm.avail_in)break;if(r=c(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=$)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+$-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<$)););}while(e.lookahead<te&&0!==e.strm.avail_in)}function f(e,t){for(var r,n;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===A)return ce;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r)),e.match_length>=$)if(n=x._tr_tally(e,e.strstart-e.match_start,e.match_length-$),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=$){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=x._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=e.strstart<$-1?e.strstart:$-1,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function p(e,t){for(var r,n,i;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===A)return ce;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=$-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r),e.match_length<=5&&(e.strategy===N||e.match_length===$&&e.strstart-e.match_start>4096)&&(e.match_length=$-1)),e.prev_length>=$&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-$,n=x._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-$),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=$-1,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return ce}else if(e.match_available){if((n=x._tr_tally(e,0,e.window[e.strstart-1]))&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ce}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=x._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<$-1?e.strstart:$-1,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function m(e,t){for(var r,n,i,a,o=e.window;;){if(e.lookahead<=ee){if(d(e),e.lookahead<=ee&&t===A)return ce;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=$&&e.strstart>0&&(n=o[i=e.strstart-1])===o[++i]&&n===o[++i]&&n===o[++i]){a=e.strstart+ee;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&a>i);e.match_length=ee-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=$?(r=x._tr_tally(e,1,e.match_length-$),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=x._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function g(e,t){for(var r;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===A)return ce;break}if(e.match_length=0,r=x._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ce:he}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=G,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new w.Buf16(2*Q),this.dyn_dtree=new w.Buf16(2*(2*Z+1)),this.bl_tree=new w.Buf16(2*(2*K+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new w.Buf16(J+1),this.heap=new w.Buf16(2*q+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new w.Buf16(2*q+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=V,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ne:le,e.adler=2===t.wrap?0:1,t.last_flush=A,x._tr_init(t),C):n(e,H)}function _(e){var t=y(e);return t===C&&function(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=E[e.level].max_lazy,e.good_match=E[e.level].good_length,e.nice_match=E[e.level].nice_length,e.max_chain_length=E[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=$-1,e.match_available=0,e.ins_h=0}(e.state),t}function b(e,t,r,i,a,o){if(!e)return H;var s=1;if(t===F&&(t=6),0>i?(s=0,i=-i):i>15&&(s=2,i-=16),1>a||a>W||r!==G||8>i||i>15||0>t||t>9||0>o||o>z)return n(e,H);8===i&&(i=9);var l=new v;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+$-1)/$),l.window=new w.Buf8(2*l.w_size),l.head=new w.Buf16(l.hash_size),l.prev=new w.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new w.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,_(e)}var E,w=e("../utils/common"),x=e("./trees"),T=e("./adler32"),M=e("./crc32"),S=e("./messages"),A=0,R=1,k=3,P=4,L=5,C=0,I=1,H=-2,O=-3,D=-5,F=-1,N=1,U=2,B=3,z=4,j=0,V=2,G=8,W=9,X=15,Y=8,q=286,Z=30,K=19,Q=2*q+1,J=15,$=3,ee=258,te=ee+$+1,re=32,ne=42,ie=69,ae=73,oe=91,se=103,le=113,ue=666,ce=1,he=2,de=3,fe=4,pe=3,me=function(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i};E=[new me(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===A)return ce;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,s(e,!1),0===e.strm.avail_out))return ce;if(e.strstart-e.block_start>=e.w_size-te&&(s(e,!1),0===e.strm.avail_out))return ce}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):(e.strstart>e.block_start&&(s(e,!1),e.strm.avail_out),ce)})),new me(4,4,8,4,f),new me(4,5,16,8,f),new me(4,6,32,32,f),new me(4,4,16,16,p),new me(8,16,32,32,p),new me(8,16,128,128,p),new me(8,32,128,256,p),new me(32,128,258,1024,p),new me(32,258,258,4096,p)],r.deflateInit=function(e,t){return b(e,t,G,X,Y,j)},r.deflateInit2=b,r.deflateReset=_,r.deflateResetKeep=y,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?H:(e.state.gzhead=t,C):H},r.deflate=function(e,t){var r,s,c,h;if(!e||!e.state||t>L||0>t)return e?n(e,H):H;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ue&&t!==P)return n(e,0===e.avail_out?D:H);if(s.strm=e,r=s.last_flush,s.last_flush=t,s.status===ne)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=M(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=ie):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,pe),s.status=le);else{var d=G+(s.w_bits-8<<4)<<8;d|=(s.strategy>=U||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(d|=re),d+=31-d%31,s.status=le,u(s,d),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(s.status===ie)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=M(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=M(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=ae)}else s.status=ae;if(s.status===ae)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=M(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=M(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.gzindex=0,s.status=oe)}else s.status=oe;if(s.status===oe)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=M(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=M(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.status=se)}else s.status=se;if(s.status===se&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=le)):s.status=le),0!==s.pending){if(o(e),0===e.avail_out)return s.last_flush=-1,C}else if(0===e.avail_in&&i(t)<=i(r)&&t!==P)return n(e,D);if(s.status===ue&&0!==e.avail_in)return n(e,D);if(0!==e.avail_in||0!==s.lookahead||t!==A&&s.status!==ue){var f=s.strategy===U?g(s,t):s.strategy===B?m(s,t):E[s.level].func(s,t);if((f===de||f===fe)&&(s.status=ue),f===ce||f===de)return 0===e.avail_out&&(s.last_flush=-1),C;if(f===he&&(t===R?x._tr_align(s):t!==L&&(x._tr_stored_block(s,0,0,!1),t===k&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(e),0===e.avail_out))return s.last_flush=-1,C}return t!==P?C:s.wrap<=0?I:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),o(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?C:I)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ne&&t!==ie&&t!==ae&&t!==oe&&t!==se&&t!==le&&t!==ue?n(e,H):(e.state=null,t===le?n(e,O):C):H},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(e,t){"use strict";t.exports=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S;r=e.state,n=e.next_in,M=e.input,i=n+(e.avail_in-5),a=e.next_out,S=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,d=r.window,f=r.hold,p=r.bits,m=r.lencode,g=r.distcode,v=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{15>p&&(f+=M[n++]<<p,p+=8,f+=M[n++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=b=_>>>24,p-=b,0==(b=_>>>16&255))S[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&_,(b&=15)&&(b>p&&(f+=M[n++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),15>p&&(f+=M[n++]<<p,p+=8,f+=M[n++]<<p,p+=8),_=g[f&y];r:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&_,(b&=15)>p&&(f+=M[n++]<<p,b>(p+=8)&&(f+=M[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=0,T=d,0===h){if(x+=u-b,E>b){E-=b;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}}else if(b>h){if(x+=u+h-b,E>(b-=h)){E-=b;do{S[a++]=d[x++]}while(--b);if(x=0,E>h){E-=b=h;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}}}else if(x+=h-b,E>b){E-=b;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}for(;E>2;)S[a++]=T[x++],S[a++]=T[x++],S[a++]=T[x++],E-=3;E&&(S[a++]=T[x++],E>1&&(S[a++]=T[x++]))}else{x=a-w;do{S[a++]=S[x++],S[a++]=S[x++],S[a++]=S[x++],E-=3}while(E>2);E&&(S[a++]=S[x++],E>1&&(S[a++]=S[x++]))}break}}break}}while(i>n&&s>a);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=i>n?i-n+5:5-(n-i),e.avail_out=s>a?s-a+257:257-(a-s),r.hold=f,r.bits=p}},{}],35:[function(e,t,r){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=L,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(ue),t.distcode=t.distdyn=new d.Buf32(ce),t.sane=1,t.back=-1,x):S}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):S}function s(e,t){var r,n;return e&&e.state?(n=e.state,0>t?(r=0,t=-t):(r=1+(t>>4),48>t&&(t&=15)),t&&(8>t||t>15)?S:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):S}function l(e,t){var r,n;return e?(n=new i,e.state=n,n.window=null,(r=s(e,t))!==x&&(e.state=null),r):S}function u(e){if(de){var t;for(c=new d.Buf32(512),h=new d.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(g(y,e.lens,0,288,c,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;g(_,e.lens,0,32,h,0,e.work,{bits:5}),de=!1}e.lencode=c,e.lenbits=9,e.distcode=h,e.distbits=5}var c,h,d=e("../utils/common"),f=e("./adler32"),p=e("./crc32"),m=e("./inffast"),g=e("./inftrees"),v=0,y=1,_=2,b=4,E=5,w=6,x=0,T=1,M=2,S=-2,A=-3,R=-4,k=-5,P=8,L=1,C=2,I=3,H=4,O=5,D=6,F=7,N=8,U=9,B=10,z=11,j=12,V=13,G=14,W=15,X=16,Y=17,q=18,Z=19,K=20,Q=21,J=22,$=23,ee=24,te=25,re=26,ne=27,ie=28,ae=29,oe=30,se=31,le=32,ue=852,ce=592,he=15,de=!0;r.inflateReset=o,r.inflateReset2=s,r.inflateResetKeep=a,r.inflateInit=function(e){return l(e,he)},r.inflateInit2=l,r.inflate=function(e,t){var r,i,a,o,s,l,c,h,ue,ce,he,de,fe,pe,me,ge,ve,ye,_e,be,Ee,we,xe,Te,Me=0,Se=new d.Buf8(4),Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return S;(r=e.state).mode===j&&(r.mode=V),s=e.next_out,a=e.output,c=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ue=r.bits,ce=l,he=c,we=x;e:for(;;)switch(r.mode){case L:if(0===r.wrap){r.mode=V;break}for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(2&r.wrap&&35615===h){r.check=0,Se[0]=255&h,Se[1]=h>>>8&255,r.check=p(r.check,Se,2,0),h=0,ue=0,r.mode=C;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",r.mode=oe;break}if((15&h)!==P){e.msg="unknown compression method",r.mode=oe;break}if(ue-=4,Ee=8+(15&(h>>>=4)),0===r.wbits)r.wbits=Ee;else if(Ee>r.wbits){e.msg="invalid window size",r.mode=oe;break}r.dmax=1<<Ee,e.adler=r.check=1,r.mode=512&h?B:j,h=0,ue=0;break;case C:for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(r.flags=h,(255&r.flags)!==P){e.msg="unknown compression method",r.mode=oe;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=oe;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(Se[0]=255&h,Se[1]=h>>>8&255,r.check=p(r.check,Se,2,0)),h=0,ue=0,r.mode=I;case I:for(;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.head&&(r.head.time=h),512&r.flags&&(Se[0]=255&h,Se[1]=h>>>8&255,Se[2]=h>>>16&255,Se[3]=h>>>24&255,r.check=p(r.check,Se,4,0)),h=0,ue=0,r.mode=H;case H:for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(Se[0]=255&h,Se[1]=h>>>8&255,r.check=p(r.check,Se,2,0)),h=0,ue=0,r.mode=O;case O:if(1024&r.flags){for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(Se[0]=255&h,Se[1]=h>>>8&255,r.check=p(r.check,Se,2,0)),h=0,ue=0}else r.head&&(r.head.extra=null);r.mode=D;case D:if(1024&r.flags&&((de=r.length)>l&&(de=l),de&&(r.head&&(Ee=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),d.arraySet(r.head.extra,i,o,de,Ee)),512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,r.length-=de),r.length))break e;r.length=0,r.mode=F;case F:if(2048&r.flags){if(0===l)break e;de=0;do{Ee=i[o+de++],r.head&&Ee&&r.length<65536&&(r.head.name+=String.fromCharCode(Ee))}while(Ee&&l>de);if(512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,Ee)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=N;case N:if(4096&r.flags){if(0===l)break e;de=0;do{Ee=i[o+de++],r.head&&Ee&&r.length<65536&&(r.head.comment+=String.fromCharCode(Ee))}while(Ee&&l>de);if(512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,Ee)break e}else r.head&&(r.head.comment=null);r.mode=U;case U:if(512&r.flags){for(;16>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(h!==(65535&r.check)){e.msg="header crc mismatch",r.mode=oe;break}h=0,ue=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=j;break;case B:for(;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}e.adler=r.check=n(h),h=0,ue=0,r.mode=z;case z:if(0===r.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ue,M;e.adler=r.check=1,r.mode=j;case j:if(t===E||t===w)break e;case V:if(r.last){h>>>=7&ue,ue-=7&ue,r.mode=ne;break}for(;3>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}switch(r.last=1&h,ue-=1,3&(h>>>=1)){case 0:r.mode=G;break;case 1:if(u(r),r.mode=K,t===w){h>>>=2,ue-=2;break e}break;case 2:r.mode=Y;break;case 3:e.msg="invalid block type",r.mode=oe}h>>>=2,ue-=2;break;case G:for(h>>>=7&ue,ue-=7&ue;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",r.mode=oe;break}if(r.length=65535&h,h=0,ue=0,r.mode=W,t===w)break e;case W:r.mode=X;case X:if(de=r.length){if(de>l&&(de=l),de>c&&(de=c),0===de)break e;d.arraySet(a,i,o,de,s),l-=de,o+=de,c-=de,s+=de,r.length-=de;break}r.mode=j;break;case Y:for(;14>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(r.nlen=257+(31&h),h>>>=5,ue-=5,r.ndist=1+(31&h),h>>>=5,ue-=5,r.ncode=4+(15&h),h>>>=4,ue-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=oe;break}r.have=0,r.mode=q;case q:for(;r.have<r.ncode;){for(;3>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.lens[Ae[r.have++]]=7&h,h>>>=3,ue-=3}for(;r.have<19;)r.lens[Ae[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,xe={bits:r.lenbits},we=g(v,r.lens,0,19,r.lencode,0,r.work,xe),r.lenbits=xe.bits,we){e.msg="invalid code lengths set",r.mode=oe;break}r.have=0,r.mode=Z;case Z:for(;r.have<r.nlen+r.ndist;){for(;ge=(Me=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,ve=65535&Me,!(ue>=(me=Me>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(16>ve)h>>>=me,ue-=me,r.lens[r.have++]=ve;else{if(16===ve){for(Te=me+2;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(h>>>=me,ue-=me,0===r.have){e.msg="invalid bit length repeat",r.mode=oe;break}Ee=r.lens[r.have-1],de=3+(3&h),h>>>=2,ue-=2}else if(17===ve){for(Te=me+3;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}ue-=me,Ee=0,de=3+(7&(h>>>=me)),h>>>=3,ue-=3}else{for(Te=me+7;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}ue-=me,Ee=0,de=11+(127&(h>>>=me)),h>>>=7,ue-=7}if(r.have+de>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=oe;break}for(;de--;)r.lens[r.have++]=Ee}}if(r.mode===oe)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=oe;break}if(r.lenbits=9,xe={bits:r.lenbits},we=g(y,r.lens,0,r.nlen,r.lencode,0,r.work,xe),r.lenbits=xe.bits,we){e.msg="invalid literal/lengths set",r.mode=oe;break}if(r.distbits=6,r.distcode=r.distdyn,xe={bits:r.distbits},we=g(_,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,xe),r.distbits=xe.bits,we){e.msg="invalid distances set",r.mode=oe;break}if(r.mode=K,t===w)break e;case K:r.mode=Q;case Q:if(l>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ue,m(e,he),s=e.next_out,a=e.output,c=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ue=r.bits,r.mode===j&&(r.back=-1);break}for(r.back=0;ge=(Me=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,ve=65535&Me,!(ue>=(me=Me>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(ge&&0==(240&ge)){for(ye=me,_e=ge,be=ve;ge=(Me=r.lencode[be+((h&(1<<ye+_e)-1)>>ye)])>>>16&255,ve=65535&Me,!(ue>=ye+(me=Me>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}h>>>=ye,ue-=ye,r.back+=ye}if(h>>>=me,ue-=me,r.back+=me,r.length=ve,0===ge){r.mode=re;break}if(32&ge){r.back=-1,r.mode=j;break}if(64&ge){e.msg="invalid literal/length code",r.mode=oe;break}r.extra=15&ge,r.mode=J;case J:if(r.extra){for(Te=r.extra;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,ue-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=$;case $:for(;ge=(Me=r.distcode[h&(1<<r.distbits)-1])>>>16&255,ve=65535&Me,!(ue>=(me=Me>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(0==(240&ge)){for(ye=me,_e=ge,be=ve;ge=(Me=r.distcode[be+((h&(1<<ye+_e)-1)>>ye)])>>>16&255,ve=65535&Me,!(ue>=ye+(me=Me>>>24));){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}h>>>=ye,ue-=ye,r.back+=ye}if(h>>>=me,ue-=me,r.back+=me,64&ge){e.msg="invalid distance code",r.mode=oe;break}r.offset=ve,r.extra=15&ge,r.mode=ee;case ee:if(r.extra){for(Te=r.extra;Te>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,ue-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=oe;break}r.mode=te;case te:if(0===c)break e;if(de=he-c,r.offset>de){if((de=r.offset-de)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=oe;break}de>r.wnext?(de-=r.wnext,fe=r.wsize-de):fe=r.wnext-de,de>r.length&&(de=r.length),pe=r.window}else pe=a,fe=s-r.offset,de=r.length;de>c&&(de=c),c-=de,r.length-=de;do{a[s++]=pe[fe++]}while(--de);0===r.length&&(r.mode=Q);break;case re:if(0===c)break e;a[s++]=r.length,c--,r.mode=Q;break;case ne:if(r.wrap){for(;32>ue;){if(0===l)break e;l--,h|=i[o++]<<ue,ue+=8}if(he-=c,e.total_out+=he,r.total+=he,he&&(e.adler=r.check=r.flags?p(r.check,a,he,s-he):f(r.check,a,he,s-he)),he=c,(r.flags?h:n(h))!==r.check){e.msg="incorrect data check",r.mode=oe;break}h=0,ue=0}r.mode=ie;case ie:if(r.wrap&&r.flags){for(;32>ue;){if(0===l)break e;l--,h+=i[o++]<<ue,ue+=8}if(h!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=oe;break}h=0,ue=0}r.mode=ae;case ae:we=T;break e;case oe:we=A;break e;case se:return R;case le:default:return S}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ue,(r.wsize||he!==e.avail_out&&r.mode<oe&&(r.mode<ne||t!==b))&&function(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new d.Buf8(a.wsize)),n>=a.wsize?(d.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),d.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(d.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}(e,e.output,e.next_out,he-e.avail_out)?(r.mode=se,R):(ce-=e.avail_in,he-=e.avail_out,e.total_in+=ce,e.total_out+=he,r.total+=he,r.wrap&&he&&(e.adler=r.check=r.flags?p(r.check,a,he,e.next_out-he):f(r.check,a,he,e.next_out-he)),e.data_type=r.bits+(r.last?64:0)+(r.mode===j?128:0)+(r.mode===K||r.mode===W?256:0),(0===ce&&0===he||t===b)&&we===x&&(we=k),we)},r.inflateEnd=function(e){if(!e||!e.state)return S;var t=e.state;return t.window&&(t.window=null),e.state=null,x},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?S:(r.head=t,t.done=!1,x):S},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){"use strict";var r=e("../utils/common"),n=15,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,l,u,c,h,d,f){var p,m,g,v,y,_,b,E,w,x=f.bits,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=null,O=0,D=new r.Buf16(16),F=new r.Buf16(16),N=null,U=0;for(T=0;n>=T;T++)D[T]=0;for(M=0;u>M;M++)D[t[l+M]]++;for(R=x,A=n;A>=1&&0===D[A];A--);if(R>A&&(R=A),0===A)return c[h++]=20971520,c[h++]=20971520,f.bits=1,0;for(S=1;A>S&&0===D[S];S++);for(S>R&&(R=S),L=1,T=1;n>=T;T++)if(L<<=1,0>(L-=D[T]))return-1;if(L>0&&(0===e||1!==A))return-1;for(F[1]=0,T=1;n>T;T++)F[T+1]=F[T]+D[T];for(M=0;u>M;M++)0!==t[l+M]&&(d[F[t[l+M]]++]=M);if(0===e?(H=N=d,_=19):1===e?(H=i,O-=257,N=a,U-=257,_=256):(H=o,N=s,_=-1),I=0,M=0,T=S,y=h,k=R,P=0,g=-1,v=(C=1<<R)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){b=T-P,d[M]<_?(E=0,w=d[M]):d[M]>_?(E=N[U+d[M]],w=H[O+d[M]]):(E=96,w=0),p=1<<T-P,S=m=1<<k;do{c[y+(I>>P)+(m-=p)]=b<<24|E<<16|w|0}while(0!==m);for(p=1<<T-1;I&p;)p>>=1;if(0!==p?(I&=p-1,I+=p):I=0,M++,0==--D[T]){if(T===A)break;T=t[l+d[M]]}if(T>R&&(I&v)!==g){for(0===P&&(P=R),y+=S,L=1<<(k=T-P);A>k+P&&!(0>=(L-=D[k+P]));)k++,L<<=1;if(C+=1<<k,1===e&&C>852||2===e&&C>592)return 1;c[g=I&v]=R<<24|k<<16|y-h|0}}return 0!==I&&(c[y+I]=T-P<<24|64<<16|0),f.bits=R,0}},{"../utils/common":27}],37:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,r){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?X[e]:X[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function o(e,t,r){e.bi_valid>H-r?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>H-e.bi_valid,e.bi_valid+=r-H):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function s(e,t,r){o(e,r[2*t],r[2*t+1])}function l(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function u(e,t,r){var n,i,a=new Array(I+1),o=0;for(n=1;I>=n;n++)a[n]=o=o+r[n-1]<<1;for(i=0;t>=i;i++){var s=e[2*i+1];0!==s&&(e[2*i]=l(a[s]++,s))}}function c(e){var t;for(t=0;k>t;t++)e.dyn_ltree[2*t]=0;for(t=0;P>t;t++)e.dyn_dtree[2*t]=0;for(t=0;L>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*D]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function h(e){e.bi_valid>8?a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function d(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function f(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&d(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!d(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function p(e,t,r){var n,a,l,u,c=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],a=e.pending_buf[e.l_buf+c],c++,0===n?s(e,a,t):(s(e,(l=Y[a])+R+1,t),0!==(u=B[l])&&o(e,a-=q[l],u),s(e,l=i(--n),r),0!==(u=z[l])&&o(e,n-=Z[l],u))}while(c<e.last_lit);s(e,D,t)}function m(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=C,r=0;l>r;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=2>c?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)f(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],f(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,f(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;I>=a;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;C>r;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>p&&(a=p,m++),l[2*n+1]=a,n>u||(e.bl_count[a]++,o=0,n>=f&&(o=d[n-f]),s=l[2*n],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(c[2*n+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),u(a,c,e.bl_count)}function g(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;r>=n;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(u>s?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*F]++):10>=s?e.bl_tree[2*N]++:e.bl_tree[2*U]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function v(e,t,r){var n,i,a=-1,l=t[1],u=0,c=7,h=4;for(0===l&&(c=138,h=3),n=0;r>=n;n++)if(i=l,l=t[2*(n+1)+1],!(++u<c&&i===l)){if(h>u)do{s(e,i,e.bl_tree)}while(0!=--u);else 0!==i?(i!==a&&(s(e,i,e.bl_tree),u--),s(e,F,e.bl_tree),o(e,u-3,2)):10>=u?(s(e,N,e.bl_tree),o(e,u-3,3)):(s(e,U,e.bl_tree),o(e,u-11,7));u=0,a=i,0===l?(c=138,h=3):i===l?(c=6,h=3):(c=7,h=4)}}function y(e,t,r,n){o(e,(T<<1)+(n?1:0),3),function(e,t,r,n){h(e),n&&(a(e,r),a(e,~r)),_.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}var _=e("../utils/common"),b=4,E=0,w=1,x=2,T=0,M=1,S=2,A=29,R=256,k=R+1+A,P=30,L=19,C=2*k+1,I=15,H=16,O=7,D=256,F=16,N=17,U=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(k+2));n(G);var W=new Array(2*P);n(W);var X=new Array(512);n(X);var Y=new Array(256);n(Y);var q=new Array(A);n(q);var Z=new Array(P);n(Z);var K,Q,J,$=function(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length},ee=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},te=!1;r._tr_init=function(e){te||(function(){var e,t,r,n,i,a=new Array(I+1);for(r=0,n=0;A-1>n;n++)for(q[n]=r,e=0;e<1<<B[n];e++)Y[r++]=n;for(Y[r-1]=n,i=0,n=0;16>n;n++)for(Z[n]=i,e=0;e<1<<z[n];e++)X[i++]=n;for(i>>=7;P>n;n++)for(Z[n]=i<<7,e=0;e<1<<z[n]-7;e++)X[256+i++]=n;for(t=0;I>=t;t++)a[t]=0;for(e=0;143>=e;)G[2*e+1]=8,e++,a[8]++;for(;255>=e;)G[2*e+1]=9,e++,a[9]++;for(;279>=e;)G[2*e+1]=7,e++,a[7]++;for(;287>=e;)G[2*e+1]=8,e++,a[8]++;for(u(G,k+1,a),e=0;P>e;e++)W[2*e+1]=5,W[2*e]=l(e,5);K=new $(G,B,R+1,k,I),Q=new $(W,z,0,P,I),J=new $(new Array(0),j,0,L,O)}(),te=!0),e.l_desc=new ee(e.dyn_ltree,K),e.d_desc=new ee(e.dyn_dtree,Q),e.bl_desc=new ee(e.bl_tree,J),e.bi_buf=0,e.bi_valid=0,c(e)},r._tr_stored_block=y,r._tr_flush_block=function(e,t,r,n){var i,a,s=0;e.level>0?(e.strm.data_type===x&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;31>=t;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return E;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return w;for(t=32;R>t;t++)if(0!==e.dyn_ltree[2*t])return w;return E}(e)),m(e,e.l_desc),m(e,e.d_desc),s=function(e){var t;for(g(e,e.dyn_ltree,e.l_desc.max_code),g(e,e.dyn_dtree,e.d_desc.max_code),m(e,e.bl_desc),t=L-1;t>=3&&0===e.bl_tree[2*V[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(i=e.opt_len+3+7>>>3)>=(a=e.static_len+3+7>>>3)&&(i=a)):i=a=r+5,i>=r+4&&-1!==t?y(e,t,r,n):e.strategy===b||a===i?(o(e,(M<<1)+(n?1:0),3),p(e,G,W)):(o(e,(S<<1)+(n?1:0),3),function(e,t,r,n){var i;for(o(e,t-257,5),o(e,r-1,5),o(e,n-4,4),i=0;n>i;i++)o(e,e.bl_tree[2*V[i]+1],3);v(e,e.dyn_ltree,t-1),v(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),p(e,e.dyn_ltree,e.dyn_dtree)),c(e),n&&h(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Y[r]+R+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){o(e,M<<1,3),s(e,D,G),function(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":27}],39:[function(e,t){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9)}).call(this,r(20).Buffer)},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=18)}([function(e,t,r){"use strict";function n(e){return e&&0===e.length}function i(e){return null==e?[]:Object.keys(e)}function a(e){for(var t=[],r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}function o(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.call(null,e[r],r);else{if(!g(e))throw Error("non exhaustive match");var n=i(e);for(r=0;r<n.length;r++){var a=n[r],o=e[a];t.call(null,o,a)}}}function s(e){return void 0===e}function l(e,t){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r}function u(e,t){return l(e,(function(e){return!t(e)}))}function c(e,t){return!!g(e)&&e.hasOwnProperty(t)}function h(e,t){return void 0!==p(e,(function(e){return e===t}))}function d(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}function f(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function p(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(t.call(null,n))return n}}function m(e,t,r){for(var n=Array.isArray(e),o=n?e:a(e),s=n?[]:i(e),l=r,u=0;u<o.length;u++)l=t.call(null,l,o[u],n?u:s[u]);return l}function g(e){return e instanceof Object}function v(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++){var a=t[n];if(!s(a))for(var o=i(a),l=0;l<o.length;l++){var u=o[l];c(e,u)||(e[u]=a[u])}}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.isEmpty=n,t.keys=i,t.values=a,t.mapValues=function(e,t){for(var r=[],n=i(e),a=0;a<n.length;a++){var o=n[a];r.push(t.call(null,e[o],o))}return r},t.map=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t.call(null,e[n],n));return r},t.flatten=function e(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];Array.isArray(i)?r=r.concat(e(i)):r.push(i)}return r},t.first=function(e){return n(e)?void 0:e[0]},t.last=function(e){var t=e&&e.length;return t?e[t-1]:void 0},t.forEach=o,t.isString=function(e){return"string"==typeof e},t.isUndefined=s,t.isFunction=function(e){return e instanceof Function},t.drop=function(e,t){return void 0===t&&(t=1),e.slice(t,e.length)},t.dropRight=function(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)},t.filter=l,t.reject=u,t.pick=function(e,t){for(var r=Object.keys(e),n={},i=0;i<r.length;i++){var a=r[i],o=e[a];t(o)&&(n[a]=o)}return n},t.has=c,t.contains=h,t.cloneArr=d,t.cloneObj=f,t.find=p,t.findAll=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r},t.reduce=m,t.compact=function(e){return u(e,(function(e){return null==e}))},t.uniq=function(e,t){void 0===t&&(t=function(e){return e});var r=[];return m(e,(function(e,n){var i=t(n);return h(r,i)?e:(r.push(i),e.concat(n))}),[])},t.partial=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=[null].concat(t);return Function.bind.apply(e,n)},t.isArray=function(e){return Array.isArray(e)},t.isRegExp=function(e){return e instanceof RegExp},t.isObject=g,t.every=function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r))return!1;return!0},t.difference=function(e,t){return u(e,(function(e){return h(t,e)}))},t.some=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1},t.indexOf=function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1},t.sortBy=function(e,t){var r=d(e);return r.sort((function(e,r){return t(e)-t(r)})),r},t.zipObject=function(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var r={},n=0;n<e.length;n++)r[e[n]]=t[n];return r},t.assign=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var a=t[n],o=i(a),s=0;s<o.length;s++){var l=o[s];e[l]=a[l]}return e},t.assignNoOverwrite=v,t.defaults=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return v.apply(null,[{}].concat(e))},t.groupBy=function(e,t){var r={};return o(e,(function(e){var n=t(e),i=r[n];i?i.push(e):r[n]=[e]})),r},t.merge=function(e,t){for(var r=f(e),n=i(t),a=0;a<n.length;a++){var o=n[a],s=t[o];r[o]=s}return r},t.NOOP=function(){},t.IDENTITY=function(e){return e},t.packArray=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(void 0!==n?n:void 0)}return t},t.PRINT_ERROR=function(e){console&&console.error&&console.error("Error: "+e)},t.PRINT_WARNING=function(e){console&&console.warn&&console.warn("Warning: "+e)},t.isES2015MapSupported=function(){return"function"==typeof Map},t.applyMixins=function(e,t){t.forEach((function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach((function(n){if("constructor"!==n){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(e.prototype,n,i):e.prototype[n]=t.prototype[n]}}))}))},t.toFastProperties=function(e){function t(){}t.prototype=e;var r=new t;function n(){return typeof r.bar}return n(),n(),e}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(2),s=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),a.forEach(this.definition,(function(t){t.accept(e)}))},e}();t.AbstractProduction=s;var l=function(e){function t(t){var r=e.call(this,[])||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(s);t.NonTerminal=l;var u=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.orgText="",a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Rule=u;var c=function(e){function t(t){var r=e.call(this,t.definition)||this;return a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Flat=c;var h=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Option=h;var d=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.RepetitionMandatory=d;var f=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.RepetitionMandatoryWithSeparator=f;var p=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Repetition=p;var m=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.RepetitionWithSeparator=m;var g=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Alternation=g;var v=function(){function e(e){this.idx=1,a.assign(this,a.pick(e,(function(e){return void 0!==e})))}return e.prototype.accept=function(e){e.visit(this)},e}();function y(e){function t(e){return a.map(e,y)}if(e instanceof l)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof c)return{type:"Flat",definition:t(e.definition)};if(e instanceof h)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof d)return{type:"RepetitionMandatory",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof f)return{type:"RepetitionMandatoryWithSeparator",name:e.name,idx:e.idx,separator:y(new v({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof m)return{type:"RepetitionWithSeparator",name:e.name,idx:e.idx,separator:y(new v({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof p)return{type:"Repetition",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof g)return{type:"Alternation",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof v){var r={type:"Terminal",name:o.tokenName(e.terminalType),label:o.tokenLabel(e.terminalType),idx:e.idx},n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=a.isRegExp(n)?n.source:n),r}if(e instanceof u)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}t.Terminal=v,t.serializeGrammar=function(e){return a.map(e,y)},t.serializeProduction=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(15),o=r(7);function s(e){return n.isString(e.LABEL)&&""!==e.LABEL}function l(e){return n.isObject(e)&&e.hasOwnProperty("tokenName")&&n.isString(e.tokenName)?e.tokenName:i.functionName(e)}t.tokenLabel=function(e){return s(e)?e.LABEL:l(e)},t.hasTokenLabel=s,t.tokenName=l;var u="categories",c="label",h="group",d="push_mode",f="pop_mode",p="longer_alt",m="line_breaks",g="start_chars_hint";function v(e){return function(e){var t=e.name,r=e.pattern,a={};if(i.defineNameProp(a,t)||(a.tokenName=t),n.isUndefined(r)||(a.PATTERN=r),n.has(e,"parent"))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return n.has(e,u)&&(a.CATEGORIES=e[u]),o.augmentTokenTypes([a]),n.has(e,c)&&(a.LABEL=e[c]),n.has(e,h)&&(a.GROUP=e[h]),n.has(e,f)&&(a.POP_MODE=e[f]),n.has(e,d)&&(a.PUSH_MODE=e[d]),n.has(e,p)&&(a.LONGER_ALT=e[p]),n.has(e,m)&&(a.LINE_BREAKS=e[m]),n.has(e,g)&&(a.START_CHARS_HINT=e[g]),a}(e)}t.createToken=v,t.EOF=v({name:"EOF",pattern:a.Lexer.NA}),o.augmentTokenTypes([t.EOF]),t.createTokenInstance=function(e,t,r,n,i,a,o,s){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return o.tokenStructuredMatcher(e,t)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=r(0),s=r(26),l=r(2),u=r(23),c=r(16),h=r(10),d=r(24),f=r(25),p=r(31),m=r(32),g=r(34),v=r(35),y=r(36),_=r(37),b=r(38);t.END_OF_FILE=l.createTokenInstance(l.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:h.defaultParserErrorProvider,serializedGrammar:null}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",e[e.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={})),t.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var E=function(){function e(e,r){void 0===r&&(r=t.DEFAULT_PARSER_CONFIG),this.ignoredIssues=t.DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(r),this.initLexerAdapter(),this.initLooksAhead(r),this.initRecognizerEngine(e,r),this.initRecoverable(r),this.initTreeBuilder(r),this.initContentAssist(),this.ignoredIssues=o.has(r,"ignoredIssues")?r.ignoredIssues:t.DEFAULT_PARSER_CONFIG.ignoredIssues,o.toFastProperties(this)}return e.performSelfAnalysis=function(e){e.performSelfAnalysis()},e.prototype.performSelfAnalysis=function(){var t,r=this;this.selfAnalysisDone=!0;var n=a.classNameFromInstance(this),i=this.gastProductionsCache;if(this.serializedGrammar){var l=u.deserializeGrammar(this.serializedGrammar,this.tokensMap);o.forEach(l,(function(e){r.gastProductionsCache.put(e.name,e)}))}var f=d.resolveGrammar({rules:i.values()});if(this.definitionErrors.push.apply(this.definitionErrors,f),o.isEmpty(f)){var p=d.validateGrammar({rules:i.values(),maxLookahead:this.maxLookahead,tokenTypes:o.values(this.tokensMap),ignoredIssues:this.ignoredIssues,errMsgProvider:h.defaultGrammarValidatorErrorProvider,grammarName:n});this.definitionErrors.push.apply(this.definitionErrors,p)}if(o.isEmpty(this.definitionErrors)){var m=s.computeAllProdsFollows(i.values());this.resyncFollows=m}var g=c.analyzeCst(i.values(),this.fullRuleNameToShort);if(this.allRuleNames=g.allRuleNames,!e.DEFER_DEFINITION_ERRORS_HANDLING&&!o.isEmpty(this.definitionErrors))throw t=o.map(this.definitionErrors,(function(e){return e.message})),new Error("Parser Definition Errors detected:\n "+t.join("\n-------------------------------\n"))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();t.Parser=E,o.applyMixins(E,[f.Recoverable,p.LooksAhead,m.TreeBuilder,g.LexerAdapter,y.RecognizerEngine,v.RecognizerApi,_.ErrorHandler,b.ContentAssist]);var w=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!0,e.call(this,r,i)||this}return i(r,e),r}(E);t.CstParser=w;var x=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!1,e.call(this,r,i)||this}return i(r,e),r}(E);t.EmbeddedActionsParser=x},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.classNameFromInstance=function(e){return o(e.constructor)};var i=/^\s*function\s*(\S*)\s*\(/,a="name";function o(e){return e.name||e.toString().match(i)[1]}t.functionName=o,t.defineNameProp=function(e,t){var r=Object.getOwnPropertyDescriptor(e,a);return!(!n.isUndefined(r)&&!r.configurable||(Object.defineProperty(e,a,{enumerable:!1,configurable:!0,writable:!1,value:t}),0))};var s=function(){function e(){this._state={}}return e.prototype.keys=function(){return n.keys(this._state)},e.prototype.values=function(){return n.values(this._state)},e.prototype.put=function(e,t){this._state[e]=t},e.prototype.putAll=function(e){this._state=n.assign(this._state,e._state)},e.prototype.get=function(e){return this._state[e]},e.prototype.containsKey=function(e){return n.has(this._state,e)},e.prototype.clear=function(){this._state={}},e}();t.HashTable=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function e(){}return e.prototype.visit=function(e){if(e instanceof n.NonTerminal)return this.visitNonTerminal(e);if(e instanceof n.Flat)return this.visitFlat(e);if(e instanceof n.Option)return this.visitOption(e);if(e instanceof n.RepetitionMandatory)return this.visitRepetitionMandatory(e);if(e instanceof n.RepetitionMandatoryWithSeparator)return this.visitRepetitionMandatoryWithSeparator(e);if(e instanceof n.RepetitionWithSeparator)return this.visitRepetitionWithSeparator(e);if(e instanceof n.Repetition)return this.visitRepetition(e);if(e instanceof n.Alternation)return this.visitAlternation(e);if(e instanceof n.Terminal)return this.visitTerminal(e);if(e instanceof n.Rule)return this.visitRule(e);throw Error("non exhaustive match")},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();t.GAstVisitor=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i="MismatchedTokenException",a="NoViableAltException",o="EarlyExitException",s="NotAllInputParsedException",l=[i,a,o,s];function u(e,t,r){this.name=i,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function c(e,t,r){this.name=a,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function h(e,t){this.name=s,this.message=e,this.token=t,this.resyncedTokens=[]}function d(e,t,r){this.name=o,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}Object.freeze(l),t.isRecognitionException=function(e){return n.contains(l,e.name)},t.MismatchedTokenException=u,u.prototype=Error.prototype,t.NoViableAltException=c,c.prototype=Error.prototype,t.NotAllInputParsedException=h,h.prototype=Error.prototype,t.EarlyExitException=d,d.prototype=Error.prototype},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(2);function o(e){for(var t=n.cloneArr(e),r=e,i=!0;i;){r=n.compact(n.flatten(n.map(r,(function(e){return e.CATEGORIES}))));var a=n.difference(r,t);t=t.concat(a),n.isEmpty(a)?i=!1:r=a}return t}function s(e){n.forEach(e,(function(e){h(e)||(t.tokenIdxToClass.put(t.tokenShortNameIdx,e),e.tokenTypeIdx=t.tokenShortNameIdx++),d(e)&&!n.isArray(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),d(e)||(e.CATEGORIES=[]),f(e)||(e.categoryMatches=[]),p(e)||(e.categoryMatchesMap={}),m(e)||(e.tokenName=a.tokenName(e))}))}function l(e){n.forEach(e,(function(e){e.categoryMatches=[],n.forEach(e.categoryMatchesMap,(function(r,n){e.categoryMatches.push(t.tokenIdxToClass.get(n).tokenTypeIdx)}))}))}function u(e){n.forEach(e,(function(e){c([],e)}))}function c(e,t){n.forEach(e,(function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0})),n.forEach(t.CATEGORIES,(function(r){var i=e.concat(t);n.contains(i,r)||c(i,r)}))}function h(e){return n.has(e,"tokenTypeIdx")}function d(e){return n.has(e,"CATEGORIES")}function f(e){return n.has(e,"categoryMatches")}function p(e){return n.has(e,"categoryMatchesMap")}function m(e){return n.has(e,"tokenName")}t.tokenStructuredMatcher=function(e,t){var r=e.tokenTypeIdx;return r===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[r]},t.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},t.tokenShortNameIdx=1,t.tokenIdxToClass=new i.HashTable,t.augmentTokenTypes=function(e){var t=o(e);s(t),u(t),l(t),n.forEach(t,(function(e){e.isParent=e.categoryMatches.length>0}))},t.expandCategories=o,t.assignTokenDefaultProps=s,t.assignCategoriesTokensProp=l,t.assignCategoriesMapProp=u,t.singleAssignCategoriesToksMap=c,t.hasShortKeyProperty=h,t.hasCategoriesProperty=d,t.hasExtendingTokensTypesProperty=f,t.hasExtendingTokensTypesMapProperty=p,t.hasTokenNameProperty=m,t.isTokenType=function(e){return n.has(e,"tokenTypeIdx")}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(1),s=r(5),l=r(2);t.isSequenceProd=function(e){return e instanceof o.Flat||e instanceof o.Option||e instanceof o.Repetition||e instanceof o.RepetitionMandatory||e instanceof o.RepetitionMandatoryWithSeparator||e instanceof o.RepetitionWithSeparator||e instanceof o.Terminal||e instanceof o.Rule},t.isOptionalProd=function e(t,r){return void 0===r&&(r=[]),!!(t instanceof o.Option||t instanceof o.Repetition||t instanceof o.RepetitionWithSeparator)||(t instanceof o.Alternation?a.some(t.definition,(function(t){return e(t,r)})):!(t instanceof o.NonTerminal&&a.contains(r,t))&&t instanceof o.AbstractProduction&&(t instanceof o.NonTerminal&&r.push(t),a.every(t.definition,(function(t){return e(t,r)}))))},t.isBranchingProd=function(e){return e instanceof o.Alternation},t.getProductionDslName=function(e){if(e instanceof o.NonTerminal)return"SUBRULE";if(e instanceof o.Option)return"OPTION";if(e instanceof o.Alternation)return"OR";if(e instanceof o.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof o.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof o.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof o.Repetition)return"MANY";if(e instanceof o.Terminal)return"CONSUME";throw Error("non exhaustive match")};var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return i(t,e),t.prototype.visitTerminal=function(e){var t=l.tokenName(e.terminalType)+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(s.GAstVisitor);t.DslMethodsCollectorVisitor=u},function(e,t,r){"use strict";function n(e,t,r){return r|t|e}Object.defineProperty(t,"__esModule",{value:!0}),t.BITS_FOR_METHOD_IDX=4,t.BITS_FOR_OCCURRENCE_IDX=4,t.BITS_FOR_RULE_IDX=24,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_METHOD_IDX,t.OPTION_IDX=2<<t.BITS_FOR_METHOD_IDX,t.MANY_IDX=3<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_METHOD_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_METHOD_IDX,t.getKeyForAutomaticLookahead=n;var i=32-t.BITS_FOR_ALT_IDX;t.getKeyForAltIndex=function(e,t,r,a){var o=a+1<<i;return n(e,t,r)|o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(0),o=r(1),s=r(8),l=r(11),u=r(17),c=r(3);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,r=e.actual;return e.previous,e.ruleName,"Expecting "+(n.hasTokenLabel(t)?"--\x3e "+n.tokenLabel(t)+" <--":"token of type --\x3e "+n.tokenName(t)+" <--")+" but found --\x3e '"+r.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,r=e.actual,i=(e.previous,e.customUserDescription),o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");if(i)return"Expecting: "+i+o;var s=a.reduce(t,(function(e,t){return e.concat(t)}),[]),l=a.map(s,(function(e){return"["+a.map(e,(function(e){return n.tokenLabel(e)})).join(", ")+"]"}));return"Expecting: one of these possible Token sequences:\n"+a.map(l,(function(e,t){return"  "+(t+1)+". "+e})).join("\n")+o},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,r=e.actual,i=e.customUserDescription,o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");return i?"Expecting: "+i+o:"Expecting: expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+a.map(t,(function(e){return"["+a.map(e,(function(e){return n.tokenLabel(e)})).join(",")+"]"})).join(" ,")+">"+o}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var r,i=e.name,l=a.first(t),u=l.idx,c=s.getProductionDslName(l),h=(r=l)instanceof o.Terminal?n.tokenName(r.terminalType):r instanceof o.NonTerminal?r.nonTerminalName:"",d="->"+c+"<- with numerical suffix: ->"+u+"<-\n                  "+(h?"and argument: ->"+h+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+i+"<-.\n                  "+(0===u?"Also note that numerical suffix 0 means "+c+" without any suffix.":"")+"\n                  To fix this make sure each usage of "+c+" "+(h?"with the argument: ->"+h+"<-":"")+"\n                  in the rule ->"+i+"<- has a different occurrence index (0-5), as that combination acts as a unique\n                  position key in the grammar, which is needed by the parsing engine.\n                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return(d=d.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildInvalidNestedRuleNameError:function(e,t){return"Invalid nested rule name: ->"+t.name+"<- inside rule: ->"+e.name+"<-\nit must match the pattern: ->"+l.validNestedRuleName.toString()+"<-.\nNote that this means a nested rule name must start with the '$'(dollar) sign."},buildDuplicateNestedRuleNameError:function(e,t){return"Duplicate nested rule name: ->"+a.first(t).name+"<- inside rule: ->"+e.name+"<-\nA nested name must be unique in the scope of a top level grammar rule."},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=a.map(e.prefixPath,(function(e){return n.tokenLabel(e)})).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nhttps://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=a.map(e.prefixPath,(function(e){return n.tokenLabel(e)})).join(", "),r=0===e.alternation.idx?"":e.alternation.idx,i="Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n",o=u.VERSION.replace(/\./g,"_");return i+"To Resolve this, try one of of the following: \n1. Refactor your grammar to be LL(K) for the current value of k (by default k="+c.DEFAULT_PARSER_CONFIG.maxLookahead+"})\n2. Increase the value of K for your grammar by providing a larger 'maxLookahead' value in the parser's config\n3. This issue can be ignored (if you know what you are doing...), see https://sap.github.io/chevrotain/documentation/"+o+"/interfaces/iparserconfig.html#ignoredissues for more details\n"},buildEmptyRepetitionError:function(e){var t=s.getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"Invalid Grammar Token name: ->"+n.tokenName(e.tokenType)+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+t+" --\x3e "+i.map(e.leftRecursionPath,(function(e){return e.name})).concat([t]).join(" --\x3e ")+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"Invalid grammar rule name: ->"+e.topLevelRule.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof o.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(0),s=r(3),l=r(8),u=r(2),c=r(12),h=r(16),d=r(13),f=r(1),p=r(5);function m(e){return l.getProductionDslName(e)+"_#_"+e.idx+"_#_"+g(e)}function g(e){return e instanceof f.Terminal?u.tokenName(e.terminalType):e instanceof f.NonTerminal?e.nonTerminalName:""}t.validateGrammar=function(e,t,r,n,i,c){var d=a.map(e,(function(e){return function(e,t){var r=new v;e.accept(r);var n=r.allProductions,i=a.groupBy(n,m),o=a.pick(i,(function(e){return e.length>1}));return a.map(a.values(o),(function(r){var n=a.first(r),i=t.buildDuplicateFoundError(e,r),o=l.getProductionDslName(n),u={message:i,type:s.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:o,occurrence:n.idx},c=g(n);return c&&(u.parameter=c),u}))}(e,i)})),f=a.map(e,(function(e){return w(e,e,i)})),p=[],x=[],T=[];o.every(f,o.isEmpty)&&(p=o.map(e,(function(e){return M(e,i)})),x=o.map(e,(function(e){return S(e,t,n,i)})),T=k(e,t,i));var A=function(e,t,r){var n=[],i=o.map(t,(function(e){return u.tokenName(e)}));return o.forEach(e,(function(e){var t=e.name;if(o.contains(i,t)){var a=r.buildNamespaceConflictError(e);n.push({message:a,type:s.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}})),n}(e,r,i),P=a.map(r,(function(e){return b(e,i)})),L=function(e,t){var r=[];return o.forEach(e,(function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.map(n.result,(function(e){return e.orgProd}));r.push(o.map(i,(function(r){return _(e,r,t)})))})),o.flatten(r)}(e,i),C=function(e,t){var r=[];return o.forEach(e,(function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.groupBy(n.result,(function(e){return e.name})),a=o.pick(i,(function(e){return e.length>1}));o.forEach(o.values(a),(function(n){var i=o.map(n,(function(e){return e.orgProd})),a=t.buildDuplicateNestedRuleNameError(e,i);r.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})}))})),r}(e,i),I=o.map(e,(function(e){return R(e,i)})),H=o.map(e,(function(e){return y(e,i)})),O=o.map(e,(function(t){return E(t,e,c,i)}));return a.flatten(d.concat(P,L,C,T,f,p,x,A,I,H,O))},t.identifyProductionForDuplicates=m;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function y(e,r){var n=[],i=e.name;return i.match(t.validTermsPattern)||n.push({message:r.buildInvalidRuleNameError({topLevelRule:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:i}),n}function _(e,r,n){var i,a=[];return r.name.match(t.validNestedRuleName)||(i=n.buildInvalidNestedRuleNameError(e,r),a.push({message:i,type:s.ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:e.name})),a}function b(e,r){var n=[];return u.tokenName(e).match(t.validTermsPattern)||n.push({message:r.buildTokenNameError({tokenType:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_TOKEN_NAME}),n}function E(e,t,r,n){var i=[];if(o.reduce(t,(function(t,r){return r.name===e.name?t+1:t}),0)>1){var a=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function w(e,t,r,n){void 0===n&&(n=[]);var i=[],o=x(t.definition);if(a.isEmpty(o))return[];var l=e.name;a.contains(o,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:s.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:l});var u=a.difference(o,n.concat([e])),c=a.map(u,(function(t){var i=a.cloneArr(n);return i.push(t),w(e,t,r,i)}));return i.concat(a.flatten(c))}function x(e){var t=[];if(a.isEmpty(e))return t;var r=a.first(e);if(r instanceof f.NonTerminal)t.push(r.referencedRule);else if(r instanceof f.Flat||r instanceof f.Option||r instanceof f.RepetitionMandatory||r instanceof f.RepetitionMandatoryWithSeparator||r instanceof f.RepetitionWithSeparator||r instanceof f.Repetition)t=t.concat(x(r.definition));else if(r instanceof f.Alternation)t=a.flatten(a.map(r.definition,(function(e){return x(e.definition)})));else if(!(r instanceof f.Terminal))throw Error("non exhaustive match");var n=l.isOptionalProd(r),i=e.length>1;if(n&&i){var o=a.drop(e);return t.concat(x(o))}return t}t.OccurrenceValidationCollector=v,t.validTermsPattern=/^[a-zA-Z_]\w*$/,t.validNestedRuleName=new RegExp(t.validTermsPattern.source.replace("^","^\\$")),t.validateRuleName=y,t.validateNestedRuleName=_,t.validateTokenName=b,t.validateRuleDoesNotAlreadyExist=E,t.validateRuleIsOverridden=function(e,t,r){var n,i=[];return a.contains(t,e)||(n="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+r+"<-as it is not defined in any of the super grammars ",i.push({message:n,type:s.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),i},t.validateNoLeftRecursion=w,t.getFirstNoneTerminal=x;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return i(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(p.GAstVisitor);function M(e,t){var r=new T;e.accept(r);var n=r.alternations;return a.reduce(n,(function(r,n){var i=a.dropRight(n.definition),o=a.map(i,(function(r,i){var o=d.nextPossibleTokensAfter([r],[],null,1);return a.isEmpty(o)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:n,emptyChoiceIdx:i}),type:s.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:n.idx,alternative:i+1}:null}));return r.concat(a.compact(o))}),[])}function S(e,t,r,n){var i=new T;e.accept(i);var u=i.alternations,h=r[e.name];return h&&(u=o.reject(u,(function(e){return h[l.getProductionDslName(e)+(0===e.idx?"":e.idx)]}))),a.reduce(u,(function(r,i){var l=i.idx,u=c.getLookaheadPathsForOr(l,e,t),h=function(e,t,r,n){var i=[],l=o.reduce(e,(function(t,r,n){return o.forEach(r,(function(r){var a=[n];o.forEach(e,(function(e,t){n!==t&&c.containsPath(e,r)&&a.push(t)})),a.length>1&&!c.containsPath(i,r)&&(i.push(r),t.push({alts:a,path:r}))})),t}),[]);return a.map(l,(function(e){var i=o.map(e.alts,(function(e){return e+1}));return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:[e.alts]}}))}(u,i,e,n),d=P(u,i,e,n);return r.concat(h,d)}),[])}t.validateEmptyOrAlternative=M,t.validateAmbiguousAlternationAlternatives=S;var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function R(e,t){var r=new T;e.accept(r);var n=r.alternations;return a.reduce(n,(function(r,n){return n.definition.length>255&&r.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:n}),type:s.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:n.idx}),r}),[])}function k(e,t,r){var n=[];return o.forEach(e,(function(e){var i=new A;e.accept(i);var a=i.allProductions;o.forEach(a,(function(i){var a=c.getProdType(i),l=i.idx,u=c.getLookaheadPathsForOptionalProd(l,e,a,t)[0];if(o.isEmpty(o.flatten(u))){var h=r.buildEmptyRepetitionError({topLevelRule:e,repetition:i});n.push({message:h,type:s.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}}))})),n}function P(e,t,r,n){var i=[],a=o.reduce(e,(function(e,t,r){var n=o.map(t,(function(e){return{idx:r,path:e}}));return e.concat(n)}),[]);return o.forEach(a,(function(e){var l=e.idx,u=e.path,h=o.findAll(a,(function(e){return e.idx<l&&c.isStrictPrefixOfPath(e.path,u)})),d=o.map(h,(function(e){var i=[e.idx+1,l+1],a=0===t.idx?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:a,alternatives:i}}));i=i.concat(d)})),i}t.RepetionCollector=A,t.validateTooManyAlts=R,t.validateSomeNonEmptyLookaheadPath=k,t.checkPrefixAlternativesAmbiguities=P},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r(0),s=r(13),l=r(14),u=r(7),c=r(1),h=r(5);!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(a=t.PROD_TYPE||(t.PROD_TYPE={})),t.getProdType=function(e){if(e instanceof c.Option)return a.OPTION;if(e instanceof c.Repetition)return a.REPETITION;if(e instanceof c.RepetitionMandatory)return a.REPETITION_MANDATORY;if(e instanceof c.RepetitionMandatoryWithSeparator)return a.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof c.RepetitionWithSeparator)return a.REPETITION_WITH_SEPARATOR;if(e instanceof c.Alternation)return a.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,r,n,i,a){var o=m(e,t,r);return a(o,n,y(o)?u.tokenStructuredMatcherNoCategories:u.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,r,n,i,a){var o=g(e,t,i,r),s=y(o)?u.tokenStructuredMatcherNoCategories:u.tokenStructuredMatcher;return a(o[0],s,n)},t.buildAlternativesLookAheadFunc=function(e,t,r,n){var i=e.length,a=o.every(e,(function(e){return o.every(e,(function(e){return 1===e.length}))}));if(t)return function(t){for(var n=o.map(t,(function(e){return e.GATE})),a=0;a<i;a++){var s=e[a],l=s.length,u=n[a];if(void 0===u||!1!==u.call(this))e:for(var c=0;c<l;c++){for(var h=s[c],d=h.length,f=0;f<d;f++){var p=this.LA(f+1);if(!1===r(p,h[f]))continue e}return a}}};if(a&&!n){var s=o.map(e,(function(e){return o.flatten(e)})),l=o.reduce(s,(function(e,t,r){return o.forEach(t,(function(t){o.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),o.forEach(t.categoryMatches,(function(t){o.has(e,t)||(e[t]=r)}))})),e}),[]);return function(){var e=this.LA(1);return l[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var n=e[t],a=n.length;e:for(var o=0;o<a;o++){for(var s=n[o],l=s.length,u=0;u<l;u++){var c=this.LA(u+1);if(!1===r(c,s[u]))continue e}return t}}}},t.buildSingleAlternativeLookaheadFunction=function(e,t,r){var n=o.every(e,(function(e){return 1===e.length})),i=e.length;if(n&&!r){var a=o.flatten(e);if(1===a.length&&o.isEmpty(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var l=o.reduce(a,(function(e,t,r){return e[t.tokenTypeIdx]=!0,o.forEach(t.categoryMatches,(function(t){e[t]=!0})),e}),[]);return function(){var e=this.LA(1);return!0===l[e.tokenTypeIdx]}}return function(){e:for(var r=0;r<i;r++){for(var n=e[r],a=n.length,o=0;o<a;o++){var s=this.LA(o+1);if(!1===t(s,n[o]))continue e}return!0}return!1}};var d=function(e){function t(t,r,n){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,r,n){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=r.concat(n),!0)},t.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,a.OPTION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,a.REPETITION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t}(l.RestWalker),f=function(e){function t(t,r){var n=e.call(this)||this;return n.targetOccurrence=t,n.targetProdType=r,n.result=[],n}return i(t,e),t.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,a.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,a.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,a.ALTERNATION)},t}(h.GAstVisitor);function p(e,t){function r(e,t){return o.reduce(e,(function(e,r,n){if(n!==t){var i=o.map(r,(function(e){return e.partialPath}));return e.concat(i)}return e}),[])}function n(e,t){return void 0===o.find(e,(function(e){return o.every(t,(function(t,r){return(n=t)===(i=e[r])||n&&i&&(n.categoryMatchesMap[i.tokenTypeIdx]||i.categoryMatchesMap[n.tokenTypeIdx]);var n,i}))}))}function i(e){for(var t=[],r=0;r<e;r++)t.push([]);return t}for(var a=o.map(e,(function(e){return s.possiblePathsFrom([e],1)})),l=i(a.length),u=a,c=1;c<=t;c++){var h=u;u=i(h.length);for(var d=0;d<h.length;d++)for(var f=h[d],p=r(h,d),m=0;m<f.length;m++){var g=f[m].partialPath,y=f[m].suffixDef;if(n(p,g)||o.isEmpty(y)||g.length===t){var _=l[d];v(_,g)||_.push(g)}else{var b=s.possiblePathsFrom(y,c+1,g);u[d]=u[d].concat(b)}}}return l}function m(e,t,r){var n=new f(e,a.ALTERNATION);return t.accept(n),p(n.result,r)}function g(e,t,r,n){var i=new f(e,r);t.accept(i);var a=i.result,o=new d(t,e,r).startWalking();return p([new c.Flat({definition:a}),new c.Flat({definition:o})],n)}function v(e,t){return void 0!==o.find(e,(function(e){return t.length===e.length&&o.every(t,(function(t,r){return t===e[r]||e[r].categoryMatchesMap[t.tokenTypeIdx]}))}))}function y(e){return o.every(e,(function(e){return o.every(e,(function(e){return o.every(e,(function(e){return o.isEmpty(e.categoryMatches)}))}))}))}t.lookAheadSequenceFromAlternatives=p,t.getLookaheadPathsForOr=m,t.getLookaheadPathsForOptionalProd=g,t.containsPath=v,t.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&o.every(e,(function(e,r){var n=t[r];return e===n||n.categoryMatchesMap[e.tokenTypeIdx]}))},t.areTokenCategoriesNotUsed=y},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(0),s=r(2),l=r(21),u=r(1),c=function(e){function t(t,r){var n=e.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return i(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=o.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=o.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,r){void 0===r&&(r=[]),this.found||e.prototype.walk.call(this,t,r)},t.prototype.walkProdRef=function(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var n=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,n)}},t.prototype.updateExpectedNext=function(){o.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(a.RestWalker);t.AbstractNextPossibleTokensWalker=c;var h=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=s.tokenName(n.path.lastTok),n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return i(t,e),t.prototype.walkTerminal=function(e,t,r){if(this.isAtEndOfPath&&s.tokenName(e.terminalType)===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var n=t.concat(r),i=new u.Flat({definition:n});this.possibleTokTypes=l.first(i),this.found=!0}},t}(c);t.NextAfterTokenWalker=h;var d=function(e){function t(t,r){var n=e.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(a.RestWalker);t.AbstractNextTerminalAfterProductionWalker=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkMany.call(this,t,r,n)},t}(d);t.NextTerminalAfterManyWalker=f;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkManySep.call(this,t,r,n)},t}(d);t.NextTerminalAfterManySepWalker=p;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOne.call(this,t,r,n)},t}(d);t.NextTerminalAfterAtLeastOneWalker=m;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,r,n)},t}(d);function v(e,t,r,n){var i=o.cloneArr(r);i.push(e.name);var a=o.cloneArr(n);return a.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:a}}t.NextTerminalAfterAtLeastOneSepWalker=g,t.possiblePathsFrom=function e(t,r,n){void 0===n&&(n=[]),n=o.cloneArr(n);var i=[],a=0;function s(s){var l=e(s.concat(o.drop(t,a+1)),r,n);return i.concat(l)}for(;n.length<r&&a<t.length;){var l=t[a];if(l instanceof u.Flat)return s(l.definition);if(l instanceof u.NonTerminal)return s(l.definition);if(l instanceof u.Option)i=s(l.definition);else{if(l instanceof u.RepetitionMandatory)return s(c=l.definition.concat([new u.Repetition({definition:l.definition})]));if(l instanceof u.RepetitionMandatoryWithSeparator)return s(c=[new u.Flat({definition:l.definition}),new u.Repetition({definition:[new u.Terminal({terminalType:l.separator})].concat(l.definition)})]);if(l instanceof u.RepetitionWithSeparator){var c=l.definition.concat([new u.Repetition({definition:[new u.Terminal({terminalType:l.separator})].concat(l.definition)})]);i=s(c)}else if(l instanceof u.Repetition)c=l.definition.concat([new u.Repetition({definition:l.definition})]),i=s(c);else{if(l instanceof u.Alternation)return o.forEach(l.definition,(function(e){i=s(e.definition)})),i;if(!(l instanceof u.Terminal))throw Error("non exhaustive match");n.push(l.terminalType)}}a++}return i.push({partialPath:n,suffixDef:o.drop(t,a)}),i},t.nextPossibleTokensAfter=function(e,t,r,n){var i=["EXIT_NONE_TERMINAL"],a=!1,s=t.length,l=s-n-1,c=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!o.isEmpty(h);){var d=h.pop();if("EXIT_ALTERNATIVE"!==d){var f=d.def,p=d.idx,m=d.ruleStack,g=d.occurrenceStack;if(!o.isEmpty(f)){var y=f[0];if("EXIT_NONE_TERMINAL"===y){var _={idx:p,def:o.drop(f),ruleStack:o.dropRight(m),occurrenceStack:o.dropRight(g)};h.push(_)}else if(y instanceof u.Terminal)if(p<s-1){var b=p+1;r(t[b],y.terminalType)&&(_={idx:b,def:o.drop(f),ruleStack:m,occurrenceStack:g},h.push(_))}else{if(p!==s-1)throw Error("non exhaustive match");c.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:g}),a=!0}else if(y instanceof u.NonTerminal){var E=o.cloneArr(m);E.push(y.nonTerminalName);var w=o.cloneArr(g);w.push(y.idx),_={idx:p,def:y.definition.concat(i,o.drop(f)),ruleStack:E,occurrenceStack:w},h.push(_)}else if(y instanceof u.Option){var x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:g};h.push(x),h.push("EXIT_ALTERNATIVE");var T={idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:g};h.push(T)}else if(y instanceof u.RepetitionMandatory){var M=new u.Repetition({definition:y.definition,idx:y.idx});_={idx:p,def:y.definition.concat([M],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(_)}else if(y instanceof u.RepetitionMandatoryWithSeparator){var S=new u.Terminal({terminalType:y.separator});M=new u.Repetition({definition:[S].concat(y.definition),idx:y.idx}),_={idx:p,def:y.definition.concat([M],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(_)}else if(y instanceof u.RepetitionWithSeparator){x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:g},h.push(x),h.push("EXIT_ALTERNATIVE"),S=new u.Terminal({terminalType:y.separator});var A=new u.Repetition({definition:[S].concat(y.definition),idx:y.idx});T={idx:p,def:y.definition.concat([A],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(T)}else if(y instanceof u.Repetition)x={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:g},h.push(x),h.push("EXIT_ALTERNATIVE"),A=new u.Repetition({definition:y.definition,idx:y.idx}),T={idx:p,def:y.definition.concat([A],o.drop(f)),ruleStack:m,occurrenceStack:g},h.push(T);else if(y instanceof u.Alternation)for(var R=y.definition.length-1;R>=0;R--){var k={idx:p,def:y.definition[R].definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:g};h.push(k),h.push("EXIT_ALTERNATIVE")}else if(y instanceof u.Flat)h.push({idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:g});else{if(!(y instanceof u.Rule))throw Error("non exhaustive match");h.push(v(y,p,m,g))}}}else a&&o.last(h).idx<=l&&h.pop()}return c}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=function(){function e(){}return e.prototype.walk=function(e,t){var r=this;void 0===t&&(t=[]),n.forEach(e.definition,(function(a,o){var s=n.drop(e.definition,o+1);if(a instanceof i.NonTerminal)r.walkProdRef(a,s,t);else if(a instanceof i.Terminal)r.walkTerminal(a,s,t);else if(a instanceof i.Flat)r.walkFlat(a,s,t);else if(a instanceof i.Option)r.walkOption(a,s,t);else if(a instanceof i.RepetitionMandatory)r.walkAtLeastOne(a,s,t);else if(a instanceof i.RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(a,s,t);else if(a instanceof i.RepetitionWithSeparator)r.walkManySep(a,s,t);else if(a instanceof i.Repetition)r.walkMany(a,s,t);else{if(!(a instanceof i.Alternation))throw Error("non exhaustive match");r.walkOr(a,s,t)}}))},e.prototype.walkTerminal=function(e,t,r){},e.prototype.walkProdRef=function(e,t,r){},e.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkAtLeastOne=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkAtLeastOneSep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkMany=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkManySep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkOr=function(e,t,r){var a=this,o=t.concat(r);n.forEach(e.definition,(function(e){var t=new i.Flat({definition:[e]});a.walk(t,o)}))},e}();function o(e,t,r){return[new i.Option({definition:[new i.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}t.RestWalker=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(27),i=r(0),a=r(7),o=r(20);!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var s={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:o.defaultLexerErrorProvider};Object.freeze(s);var l=function(){function e(e,t){var r=this;if(void 0===t&&(t=s),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");if(this.config=i.merge(s,t),this.config.lineTerminatorsPattern===s.lineTerminatorsPattern)this.config.lineTerminatorsPattern=n.LineTerminatorOptimizedTester;else if(this.config.lineTerminatorCharacters===s.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking);var o,l=!0;i.isArray(e)?((o={modes:{}}).modes[n.DEFAULT_MODE]=i.cloneArr(e),o[n.DEFAULT_MODE]=n.DEFAULT_MODE):(l=!1,o=i.cloneObj(e)),this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(n.performRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(n.performWarningRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),o.modes=o.modes?o.modes:{},i.forEach(o.modes,(function(e,t){o.modes[t]=i.reject(e,(function(e){return i.isUndefined(e)}))}));var u=i.keys(o.modes);if(i.forEach(o.modes,(function(e,o){if(r.modes.push(o),r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(n.validatePatterns(e,u)),i.isEmpty(r.lexerDefinitionErrors)){a.augmentTokenTypes(e);var s=n.analyzeTokenTypes(e,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode});r.patternIdxToConfig[o]=s.patternIdxToConfig,r.charCodeToPatternIdxToConfig[o]=s.charCodeToPatternIdxToConfig,r.emptyGroups=i.merge(r.emptyGroups,s.emptyGroups),r.hasCustom=s.hasCustom||r.hasCustom,r.canModeBeOptimized[o]=s.canBeOptimized}})),this.defaultMode=o.defaultMode,!i.isEmpty(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){var c=i.map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+c)}if(i.forEach(this.lexerDefinitionWarning,(function(e){i.PRINT_WARNING(e.message)})),n.SUPPORT_STICKY?(this.chopInput=i.IDENTITY,this.match=this.matchWithTest):(this.updateLastIndex=i.NOOP,this.match=this.matchWithExec),l&&(this.handleModes=i.NOOP),!1===this.trackStartLines&&(this.computeNewColumn=i.IDENTITY),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=i.NOOP),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+this.config.positionTracking+'"');this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?this.addToken=this.addTokenUsingPush:this.addToken=this.addTokenUsingMemberAccess;var h=i.reduce(this.canModeBeOptimized,(function(e,t,r){return!1===t&&e.push(r),e}),[]);if(t.ensureOptimizations&&!i.isEmpty(h))throw Error("Lexer Modes: < "+h.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!i.isEmpty(this.lexerDefinitionErrors)){var r=i.map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+r)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var r,a,o,s,l,u,c,h,d,f,p,m,g=this,v=e,y=v.length,_=0,b=0,E=this.hasCustom?0:Math.floor(e.length/10),w=new Array(E),x=[],T=this.trackStartLines?1:void 0,M=this.trackStartLines?1:void 0,S=n.cloneEmptyGroups(this.emptyGroups),A=this.trackStartLines,R=this.config.lineTerminatorsPattern,k=0,P=[],L=[],C=[],I=[];Object.freeze(I);var H,O=void 0,D=function(e){if(1===C.length&&void 0===e.tokenType.PUSH_MODE){var t=g.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);x.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{C.pop();var r=i.last(C);P=g.patternIdxToConfig[r],L=g.charCodeToPatternIdxToConfig[r],k=P.length;var n=g.canModeBeOptimized[r]&&!1===g.config.safeMode;O=L&&n?function(e){var t=L[e];return void 0===t?I:t}:function(){return P}}};function F(e){C.push(e),L=this.charCodeToPatternIdxToConfig[e],P=this.patternIdxToConfig[e],k=P.length,k=P.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;O=L&&t?function(e){var t=L[e];return void 0===t?I:t}:function(){return P}}for(F.call(this,t);_<y;){l=null;var N=v.charCodeAt(_),U=O(N),B=U.length;for(r=0;r<B;r++){var z=(H=U[r]).pattern;if(!1!==(Q=H.short)?N===Q&&(l=z):!0===H.isCustom?l=null!==(m=z.exec(v,_,w,S))?m[0]:m:(this.updateLastIndex(z,_),l=this.match(z,e,_)),null!==l){if(void 0!==(s=H.longerAlt)){var j=P[s],V=j.pattern;!0===j.isCustom?o=null!==(m=V.exec(v,_,w,S))?m[0]:m:(this.updateLastIndex(V,_),o=this.match(V,e,_)),o&&o.length>l.length&&(l=o,H=j)}break}}if(null!==l){if(u=l.length,void 0!==(c=H.group)&&(h=H.tokenTypeIdx,d=this.createTokenInstance(l,_,h,H.tokenType,T,M,u),!1===c?b=this.addToken(w,b,d):S[c].push(d)),e=this.chopInput(e,u),_+=u,M=this.computeNewColumn(M,u),!0===A&&!0===H.canLineTerminator){var G=0,W=void 0,X=void 0;R.lastIndex=0;do{!0===(W=R.test(l))&&(X=R.lastIndex-1,G++)}while(W);0!==G&&(T+=G,M=u-X,this.updateTokenEndLineColumnLocation(d,c,X,G,T,M,u))}this.handleModes(H,D,F,d)}else{for(var Y=_,q=T,Z=M,K=!1;!K&&_<y;)for(v.charCodeAt(_),e=this.chopInput(e,1),_++,a=0;a<k;a++){var Q,J=P[a];if(z=J.pattern,!1!==(Q=J.short)?v.charCodeAt(_)===Q&&(K=!0):!0===J.isCustom?K=null!==z.exec(v,_,w,S):(this.updateLastIndex(z,_),K=null!==z.exec(e)),!0===K)break}f=_-Y,p=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Y,f,q,Z),x.push({offset:Y,line:q,column:Z,length:f,message:p})}}return this.hasCustom||(w.length=b),{tokens:w,groups:S,errors:x}},e.prototype.handleModes=function(e,t,r,n){if(!0===e.pop){var i=e.push;t(n),void 0!==i&&r.call(this,i)}else void 0!==e.push&&r.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var s,l;void 0!==t&&(l=(s=r===o-1)?-1:0,1===n&&!0===s||(e.endLine=i+l,e.endColumn=a-1-l))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},e.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},e.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},e.prototype.addToken=function(e,t,r){return 666},e.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},e.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,++t},e.prototype.match=function(e,t,r){return null},e.prototype.matchWithTest=function(e,t,r){return!0===e.test(t)?t.substring(r,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var r=e.exec(t);return null!==r?r[0]:r},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();t.Lexer=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(4),s=r(9),l=r(1),u=r(5);t.addTerminalToCst=function(e,t,r){void 0===e.children[r]?e.children[r]=[t]:e.children[r].push(t)},t.addNoneTerminalToCst=function(e,t,r){void 0===e.children[t]?e.children[t]=[r]:e.children[t].push(r)};var c=function(e){function t(t){var r=e.call(this)||this;return r.result=[],r.ruleIdx=t,r}return i(t,e),t.prototype.collectNamedDSLMethod=function(e,t,r){if(!a.isUndefined(e.name)){var n=void 0;if(e instanceof l.Option||e instanceof l.Repetition||e instanceof l.RepetitionMandatory||e instanceof l.Alternation)n=new t({definition:e.definition,idx:e.idx});else{if(!(e instanceof l.RepetitionMandatoryWithSeparator||e instanceof l.RepetitionWithSeparator))throw Error("non exhaustive match");n=new t({definition:e.definition,idx:e.idx,separator:e.separator})}var i=[n],o=s.getKeyForAutomaticLookahead(this.ruleIdx,r,e.idx);this.result.push({def:i,key:o,name:e.name,orgProd:e})}},t.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,l.Option,s.OPTION_IDX)},t.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,l.Repetition,s.MANY_IDX)},t.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatory,s.AT_LEAST_ONE_IDX)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatoryWithSeparator,s.AT_LEAST_ONE_SEP_IDX)},t.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionWithSeparator,s.MANY_SEP_IDX)},t.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,l.Alternation,s.OR_IDX);var r=e.definition.length>1;a.forEach(e.definition,(function(n,i){if(!a.isUndefined(n.name)){var o=n.definition;o=r?[new l.Option({definition:n.definition})]:n.definition;var u=s.getKeyForAltIndex(t.ruleIdx,s.OR_IDX,e.idx,i);t.result.push({def:o,key:u,name:n.name,orgProd:n})}}))},t}(u.GAstVisitor);t.NamedDSLMethodsCollectorVisitor=c,t.analyzeCst=function(e,t){var r={dictDef:new o.HashTable,allRuleNames:[]};return a.forEach(e,(function(e){var n=t.get(e.name);r.allRuleNames.push(e.name);var i=new c(n);e.accept(i),a.forEach(i.result,(function(t){t.def,t.key;var n=t.name;r.allRuleNames.push(e.name+n)}))})),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="4.6.0"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(15),a=r(2),o=r(6),s=r(17),l=r(10),u=r(39),c=r(5),h=r(1),d=r(24),f=r(40),p=r(20),m={};m.VERSION=s.VERSION,m.Parser=n.Parser,m.CstParser=n.CstParser,m.EmbeddedActionsParser=n.EmbeddedActionsParser,m.ParserDefinitionErrorType=n.ParserDefinitionErrorType,m.Lexer=i.Lexer,m.LexerDefinitionErrorType=i.LexerDefinitionErrorType,m.EOF=a.EOF,m.tokenName=a.tokenName,m.tokenLabel=a.tokenLabel,m.tokenMatcher=a.tokenMatcher,m.createToken=a.createToken,m.createTokenInstance=a.createTokenInstance,m.EMPTY_ALT=n.EMPTY_ALT,m.defaultParserErrorProvider=l.defaultParserErrorProvider,m.isRecognitionException=o.isRecognitionException,m.EarlyExitException=o.EarlyExitException,m.MismatchedTokenException=o.MismatchedTokenException,m.NotAllInputParsedException=o.NotAllInputParsedException,m.NoViableAltException=o.NoViableAltException,m.defaultLexerErrorProvider=p.defaultLexerErrorProvider,m.Flat=h.Flat,m.Repetition=h.Repetition,m.RepetitionWithSeparator=h.RepetitionWithSeparator,m.RepetitionMandatory=h.RepetitionMandatory,m.RepetitionMandatoryWithSeparator=h.RepetitionMandatoryWithSeparator,m.Option=h.Option,m.Alternation=h.Alternation,m.NonTerminal=h.NonTerminal,m.Terminal=h.Terminal,m.Rule=h.Rule,m.GAstVisitor=c.GAstVisitor,m.serializeGrammar=h.serializeGrammar,m.serializeProduction=h.serializeProduction,m.resolveGrammar=d.resolveGrammar,m.defaultGrammarResolverErrorProvider=l.defaultGrammarResolverErrorProvider,m.validateGrammar=d.validateGrammar,m.defaultGrammarValidatorErrorProvider=l.defaultGrammarValidatorErrorProvider,m.assignOccurrenceIndices=d.assignOccurrenceIndices,m.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")},m.createSyntaxDiagramsCode=u.createSyntaxDiagramsCode,m.generateParserFactory=f.generateParserFactory,m.generateParserModule=f.generateParserModule,e.exports=m},function(e,t,r){var n,i;"undefined"!=typeof self&&self,void 0===(i="function"==typeof(n=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var r={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(r,"global");break;case"i":s(r,"ignoreCase");break;case"m":s(r,"multiLine");break;case"u":s(r,"unicode");break;case"y":s(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:"Alternative",value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}l(e);var t=this.disjunction();return this.consumeChar(")"),{type:e,value:t}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":t=this.isDigit()?{atLeast:r,atMost:this.integerIncludingZero()}:{atLeast:r,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;l(t)}if(!0!==e||void 0!==t)return l(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t},e.prototype.atom=function(){var e;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),l(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){return{type:"GroupBackReference",value:this.positiveInteger()}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=u;break;case"D":e=u,t=!0;break;case"s":e=h;break;case"S":e=h,t=!0;break;case"w":e=c;break;case"W":e=c,t=!0}return l(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\v")}return l(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){return{type:"Character",value:a(this.popChar())}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:a(this.popChar())}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var r=this.classAtom();if("Character"===r.type&&this.isRangeDash()){this.consumeChar("-");var n=this.classAtom();if("Character"===n.type){if(n.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:n.value})}else o(r.value,e),e.push(a("-")),o(n.value,e)}else o(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++}var t=this.disjunction();this.consumeChar(")");var r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===i.test(e))throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===n.test(e))throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",n=0;n<e;n++){var i=this.popChar();if(!1===r.test(i))throw Error("Expecting a HexDecimal digits");t+=i}return{type:"Character",value:parseInt(t,16)}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t,r=/[0-9a-fA-F]/,n=/[0-9]/,i=/[1-9]/;function a(e){return e.charCodeAt(0)}function o(e,t){void 0!==e.length?e.forEach((function(e){t.push(e)})):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function l(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var u=[];for(t=a("0");t<=a("9");t++)u.push(t);var c=[a("_")].concat(u);for(t=a("a");t<=a("z");t++)c.push(t);for(t=a("A");t<=a("Z");t++)c.push(t);var h=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\v"),a("\t"),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a("\u2028"),a("\u2029"),a(" "),a(" "),a("　"),a("\ufeff")];function d(){}return d.prototype.visitChildren=function(e){for(var t in e){var r=e[t];e.hasOwnProperty(t)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach((function(e){this.visit(e)}),this))}},d.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},d.prototype.visitPattern=function(e){},d.prototype.visitFlags=function(e){},d.prototype.visitDisjunction=function(e){},d.prototype.visitAlternative=function(e){},d.prototype.visitStartAnchor=function(e){},d.prototype.visitEndAnchor=function(e){},d.prototype.visitWordBoundary=function(e){},d.prototype.visitNonWordBoundary=function(e){},d.prototype.visitLookahead=function(e){},d.prototype.visitNegativeLookahead=function(e){},d.prototype.visitCharacter=function(e){},d.prototype.visitSet=function(e){},d.prototype.visitGroup=function(e){},d.prototype.visitGroupBackReference=function(e){},d.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:d,VERSION:"0.4.0"}})?n.apply(t,[]):n)||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,r,n,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+r+" characters."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=r(8);function o(e){if(e instanceof i.NonTerminal)return o(e.referencedRule);if(e instanceof i.Terminal)return u(e);if(a.isSequenceProd(e))return s(e);if(a.isBranchingProd(e))return l(e);throw Error("non exhaustive match")}function s(e){for(var t,r=[],i=e.definition,s=0,l=i.length>s,u=!0;l&&u;)t=i[s],u=a.isOptionalProd(t),r=r.concat(o(t)),s+=1,l=i.length>s;return n.uniq(r)}function l(e){var t=n.map(e.definition,(function(e){return o(e)}));return n.uniq(n.flatten(t))}function u(e){return[e.terminalType]}t.first=o,t.firstForSequence=s,t.firstForBranching=l,t.firstForTerminal=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN="_~IN~_"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(29),a=r(0),o=r(1);!function(e){e[e.OPTION=0]="OPTION",e[e.OR=1]="OR",e[e.MANY=2]="MANY",e[e.MANY_SEP=3]="MANY_SEP",e[e.AT_LEAST_ONE=4]="AT_LEAST_ONE",e[e.AT_LEAST_ONE_SEP=5]="AT_LEAST_ONE_SEP",e[e.REF=6]="REF",e[e.TERMINAL=7]="TERMINAL",e[e.FLAT=8]="FLAT"}(n=t.ProdType||(t.ProdType={}));var s=/(?:\s*{\s*NAME\s*:\s*["'`]([\w$]*)["'`])?/,l=new RegExp(s.source.replace("{","").replace(")?","\\s*,)?")),u=/\.\s*CONSUME(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,c=new RegExp(u.source,"g"),h=/\.\s*SUBRULE(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,d=new RegExp(h.source,"g"),f=/\.\s*OPTION(\d+)?\s*\(/,p=new RegExp(f.source+s.source),m=new RegExp(f.source,"g"),g=/\.\s*MANY(\d+)?\s*\(/,v=new RegExp(g.source+s.source),y=new RegExp(g.source,"g"),_=/\s*SEP\s*:\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,b=new RegExp(/\.\s*MANY_SEP(\d+)?\s*\(\s*{/.source+l.source+_.source),E=new RegExp(b.source,"g"),w=new RegExp(/\.\s*AT_LEAST_ONE_SEP(\d+)?\s*\(\s*{/.source+l.source+_.source),x=new RegExp(w.source,"g"),T=/\.\s*AT_LEAST_ONE(\d+)?\s*\(/,M=new RegExp(T.source+s.source),S=new RegExp(T.source,"g"),A=/\.\s*OR(\d+)?\s*\(/,R=new RegExp(A.source+s.source),k=new RegExp(A.source,"g"),P=new RegExp(l.source+/\s*(ALT)\s*:/.source),L=new RegExp(P.source,"g");function C(e,r,i){switch(e.type){case n.AT_LEAST_ONE:return function(e,t,r){return I(M,new o.RepetitionMandatory({definition:[]}),e,t,r)}(e,r,i);case n.AT_LEAST_ONE_SEP:return function(e,t,r){return H(e,t,o.RepetitionMandatoryWithSeparator,w,r)}(e,r,i);case n.MANY_SEP:return function(e,t,r){return H(e,t,o.RepetitionWithSeparator,b,r)}(e,r,i);case n.MANY:return function(e,t,r){return I(v,new o.Repetition({definition:[]}),e,t,r)}(e,r,i);case n.OPTION:return function(e,t,r){return I(p,new o.Option({definition:[]}),e,t,r)}(e,r,i);case n.OR:return function(e,t,r){return I(R,new o.Alternation({definition:[]}),e,t,r)}(e,r,i);case n.FLAT:return function(e,t,r){var n=new o.Flat({definition:[]}),i=P.exec(e.text)[1];return a.isUndefined(i)||(n.name=i),O(n,e.range,t,r)}(e,r,i);case n.REF:return function(e){var t=h.exec(e.text),r=void 0===t[1]?0:parseInt(t[1],10),n=t[2];return new o.NonTerminal({nonTerminalName:n,idx:r})}(e);case n.TERMINAL:return function(e,r){var n=u.exec(e.text),i=void 0===n[1]?0:parseInt(n[1],10),a=n[2],s=t.terminalNameToConstructor[a];if(!s)throw Error("Terminal Token name: <"+a+"> not found in rule: <"+r+">  \n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#TERMINAL_NAME_NOT_FOUND\n\tFor Further details.");return new o.Terminal({terminalType:s,idx:i})}(e,i);default:throw Error("non exhaustive match")}}function I(e,t,r,n,i){var o=e.exec(r.text),s=void 0===o[1];t.idx=s?0:parseInt(o[1],10);var l=o[2];return a.isUndefined(l)||(t.name=l),O(t,r.range,n,i)}function H(e,r,n,i,o){var s=i.exec(e.text),l=void 0===s[1]?0:parseInt(s[1],10),u=s[3],c=t.terminalNameToConstructor[u];if(!c)throw Error("Separator Terminal Token name: "+u+" not found");var h=new n({definition:[],separator:c,idx:l}),d=s[2];return a.isUndefined(d)||(h.name=d),O(h,e.range,r,o)}function O(e,t,r,n){var i=D(t,r),o=a.sortBy(i,(function(e){return e.range.start})),s=[];return a.forEach(o,(function(e){s.push(C(e,r,n))})),e.definition=s,e}function D(e,t){return a.filter(t,(function(r){var n=e.strictlyContainsRange(r.range),i=a.every(t,(function(t){var n=t.range.strictlyContainsRange(r.range),i=t.range.isStrictlyContainedInRange(e);return!(n&&i)}));return n&&i}))}t.terminalNameToConstructor={},t.buildTopProduction=function(e,r,n){t.terminalNameToConstructor=n;var a=G(V(z("  "+e)));return function(e,t,r,n){return O(new o.Rule({name:e,definition:[],orgText:n}),t,r,e)}(r,new i.Range(0,e.length+2),a,e)},t.buildProdGast=C,t.getDirectlyContainedRanges=D;var F=/\/\/.*/g,N=/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\//g,U=/(NAME\s*:\s*)?"([^\\"]|\\([bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/g,B=/(NAME\s*:\s*)?'([^\\']|\\([bfnrtv'\\\/]|u[0-9a-fA-F]{4}))*'/g;function z(e){return e.replace(F,"").replace(N,"")}function j(e,t){return void 0!==t?e:""}function V(e){return e.replace(U,j).replace(B,j)}function G(e){var t=W(e),r=X(e),n=Y(e),i=q(e),a=Z(e),o=K(e),s=Q(e),l=J(e);return[].concat(t,r,n,i,a,o,s,l)}function W(e){return re(e,n.TERMINAL,c)}function X(e){return re(e,n.REF,d)}function Y(e){return ne(e,n.AT_LEAST_ONE,S)}function q(e){return ne(e,n.AT_LEAST_ONE_SEP,x)}function Z(e){return ne(e,n.MANY,y)}function K(e){return ne(e,n.MANY_SEP,E)}function Q(e){return ne(e,n.OPTION,m)}function J(e){var t=ne(e,n.OR,k),r=te(t);return t.concat(r)}t.removeComments=z,t.removeStringLiterals=V,t.createRanges=G,t.createTerminalRanges=W,t.createRefsRanges=X,t.createAtLeastOneRanges=Y,t.createAtLeastOneSepRanges=q,t.createManyRanges=Z,t.createManySepRanges=K,t.createOptionRanges=Q,t.createOrRanges=J;var $=a.partial(ae,"{","}"),ee=a.partial(ae,"(",")");function te(e){var t=[];return a.forEach(e,(function(e){var r=ie(e.text,n.FLAT,L,$),i=e.range.start;a.forEach(r,(function(e){e.range.start+=i,e.range.end+=i})),t=t.concat(r)})),a.uniq(t,(function(e){return e.type+"~"+e.range.start+"~"+e.range.end+"~"+e.text}))}function re(e,t,r){for(var n,a=[];n=r.exec(e);){var o=n.index,s=r.lastIndex,l=new i.Range(o,s),u=n[0];a.push({range:l,text:u,type:t})}return a}function ne(e,t,r){return ie(e,t,r,ee)}function ie(e,t,r,n){for(var a,o=[];a=r.exec(e);){var s=a.index,l=n(s+a[0].length,e),u=new i.Range(s,l),c=e.substr(s,l-s+1);o.push({range:u,text:c,type:t})}return o}function ae(e,t,r,n){for(var i=[1],o=-1;!a.isEmpty(i)&&o+r<n.length;){o++;var s=n.charAt(r+o);s===e?i.push(1):s===t&&i.pop()}if(a.isEmpty(i))return o+r;throw new Error("INVALID INPUT TEXT, UNTERMINATED PARENTHESIS")}function oe(e,t){return a.map(e,(function(e){return se(e,t)}))}function se(e,t){switch(e.type){case"NonTerminal":return new o.NonTerminal({nonTerminalName:e.name,idx:e.idx});case"Flat":return new o.Flat({name:e.name,definition:oe(e.definition,t)});case"Option":return new o.Option({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatory":return new o.RepetitionMandatory({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatoryWithSeparator":return new o.RepetitionMandatoryWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"RepetitionWithSeparator":return new o.RepetitionWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"Repetition":return new o.Repetition({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Alternation":return new o.Alternation({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Terminal":return new o.Terminal({terminalType:t[e.name],idx:e.idx});case"Rule":return new o.Rule({name:e.name,orgText:e.orgText,definition:oe(e.definition,t)})}}t.createOrPartRanges=te,t.findClosingOffset=ae,t.deserializeGrammar=oe,t.deserializeProduction=se},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(30),o=r(11),s=r(10),l=r(8);t.resolveGrammar=function(e){e=n.defaults(e,{errMsgProvider:s.defaultGrammarResolverErrorProvider});var t=new i.HashTable;return n.forEach(e.rules,(function(e){t.put(e.name,e)})),a.resolveGrammar(t,e.errMsgProvider)},t.validateGrammar=function(e){return e=n.defaults(e,{errMsgProvider:s.defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),o.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)},t.assignOccurrenceIndices=function(e){n.forEach(e.rules,(function(e){var t=new l.DslMethodsCollectorVisitor;e.accept(t),n.forEach(t.dslMethods,(function(e){n.forEach(e,(function(e,t){e.idx=t+1}))}))}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(6),o=r(22),s=r(4),l=r(3);function u(e){this.name=t.IN_RULE_RECOVERY_EXCEPTION,this.message=e}t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",t.InRuleRecoveryException=u,u.prototype=Error.prototype;var c=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap=new s.HashTable,this.resyncFollows=new s.HashTable,this.recoveryEnabled=i.has(e,"recoveryEnabled")?e.recoveryEnabled:l.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=h)},e.prototype.getTokenToInsert=function(e){var t=n.createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var o=this,s=this.findReSyncTokenType(),l=this.exportLexerState(),u=[],c=!1,h=this.LA(1),d=this.LA(1),f=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:h,previous:e,ruleName:o.getCurrRuleFullName()}),r=new a.MismatchedTokenException(t,h,o.LA(0));r.resyncedTokens=i.dropRight(u),o.SAVE_ERROR(r)};!c;){if(this.tokenMatcher(d,n))return void f();if(r.call(this))return f(),void e.apply(this,t);this.tokenMatcher(d,s)?c=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,u))}this.importLexerState(l)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t){return void 0!==e&&void 0!==t&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new u("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if(i.isEmpty(t))return!1;var n=this.LA(1);return void 0!==i.find(t,(function(e){return r.tokenMatcher(n,e)}))},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return i.contains(r,e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(i.contains(e,n))return n;t=this.LA(r),r++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return t.EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,r=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(r=i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_STACK[t]})),n=i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_OCCURRENCE_STACK[t]}))),i.map(r,(function(i,a){return 0===a?t.EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(i),idxInCallingRule:n[a],inRule:e.shortRuleNameToFullName(r[a-1])}}))},e.prototype.flattenFollowSet=function(){var e=this,t=i.map(this.buildFullFollowKeyStack(),(function(t){return e.getFollowSetFromFollowKey(t)}));return i.flatten(t)},e.prototype.getFollowSetFromFollowKey=function(e){if(e===t.EOF_FOLLOW_KEY)return[n.EOF];var r=e.ruleName+e.idxInCallingRule+o.IN+e.inRule;return this.resyncFollows.get(r)},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,n.EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return i.dropRight(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)?i.map(this.RULE_STACK,(function(t){return e.shortRuleNameToFullName(t)})):i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])}))},e}();function h(e,t,r,i,a,o){var s=this.getKeyForAutomaticLookahead(i,a),l=this.firstAfterRepMap.get(s);if(void 0===l){var u=this.getCurrRuleFullName();l=new o(this.getGAstProductions().get(u),a).startWalking(),this.firstAfterRepMap.put(s,l)}var c=l.token,h=l.occurrence,d=l.isEndOfRule;1===this.RULE_STACK.length&&d&&void 0===c&&(c=n.EOF,h=1),this.shouldInRepetitionRecoveryBeTried(c,h)&&this.tryInRepetitionRecovery(e,t,r,c)}t.Recoverable=c,t.attemptInRepetitionRecovery=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(4),s=r(21),l=r(0),u=r(22),c=r(2),h=r(1),d=function(e){function t(t){var r=e.call(this)||this;return r.topProd=t,r.follows=new o.HashTable,r}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,r){},t.prototype.walkProdRef=function(e,t,r){var n=f(e.referencedRule,e.idx)+this.topProd.name,i=t.concat(r),a=new h.Flat({definition:i}),o=s.first(a);this.follows.put(n,o)},t}(a.RestWalker);function f(e,t){return e.name+t+u.IN}t.ResyncFollowsWalker=d,t.computeAllProdsFollows=function(e){var t=new o.HashTable;return l.forEach(e,(function(e){var r=new d(e).startWalking();t.putAll(r)})),t},t.buildBetweenProdsFollowPrefix=f,t.buildInProdFollowPrefix=function(e){return c.tokenName(e.terminalType)+e.idx+u.IN}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(2),s=r(15),l=r(0),u=r(28),c=new a.RegExpParser,h="PATTERN";function d(e){var t=l.filter(e,(function(e){return!l.has(e,h)}));return{errors:l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- missing static 'PATTERN' property",type:s.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}})),valid:l.difference(e,t)}}function f(e){var t=l.filter(e,(function(e){var t=e[h];return!(l.isRegExp(t)||l.isFunction(t)||l.has(t,"exec")||l.isString(t))}));return{errors:l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:s.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}})),valid:l.difference(e,t)}}t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,t.disableSticky=function(){t.SUPPORT_STICKY=!1},t.enableSticky=function(){t.SUPPORT_STICKY=!0},t.analyzeTokenTypes=function(e,r){r=l.defaults(r,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"]});var n=l.reject(e,(function(e){return e[h]===s.Lexer.NA})),i=!1,a=l.map(n,(function(e){var t=e[h];if(l.isRegExp(t)){var n=t.source;return 1===n.length&&"^"!==n&&"$"!==n&&"."!==n?n:2!==n.length||"\\"!==n[0]||l.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],n[1])?r.useSticky?M(t):T(t):n[1]}if(l.isFunction(t))return i=!0,{exec:t};if(l.has(t,"exec"))return i=!0,t;if("string"==typeof t){if(1===t.length)return t;var a=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(a);return r.useSticky?M(o):T(o)}throw Error("non exhaustive match")})),c=l.map(n,(function(e){return e.tokenTypeIdx})),d=l.map(n,(function(e){var t=e.GROUP;if(t!==s.Lexer.SKIPPED){if(l.isString(t))return t;if(l.isUndefined(t))return!1;throw Error("non exhaustive match")}})),f=l.map(n,(function(e){var t=e.LONGER_ALT;if(t)return l.indexOf(n,t)})),p=l.map(n,(function(e){return e.PUSH_MODE})),m=l.map(n,(function(e){return l.has(e,"POP_MODE")})),g=P(r.lineTerminatorCharacters),v=l.map(n,(function(e){return!1}));"onlyOffset"!==r.positionTracking&&(v=l.map(n,(function(e){return l.has(e,"LINE_BREAKS")?e.LINE_BREAKS:!1===R(e,g)?u.canMatchCharCode(g,e.PATTERN):void 0})));var y=l.map(n,S),_=l.map(a,A),b=l.reduce(n,(function(e,t){var r=t.GROUP;return l.isString(r)&&r!==s.Lexer.SKIPPED&&(e[r]=[]),e}),{}),E=l.map(a,(function(e,t){return{pattern:a[t],longerAlt:f[t],canLineTerminator:v[t],isCustom:y[t],short:_[t],group:d[t],push:p[t],pop:m[t],tokenTypeIdx:c[t],tokenType:n[t]}}));function w(e,t,r){void 0===e[t]&&(e[t]=[]),e[t].push(r)}var x=!0,k=[];return r.safeMode||(k=l.reduce(n,(function(e,t,n){if("string"==typeof t.PATTERN){var i=t.PATTERN.charCodeAt(0);w(e,i,E[n])}else if(l.isArray(t.START_CHARS_HINT))l.forEach(t.START_CHARS_HINT,(function(t){var r="string"==typeof t?t.charCodeAt(0):t;w(e,r,E[n])}));else if(l.isRegExp(t.PATTERN))if(t.PATTERN.unicode)x=!1,r.ensureOptimizations&&l.PRINT_ERROR(u.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var a=u.getStartCodes(t.PATTERN,r.ensureOptimizations);l.isEmpty(a)&&(x=!1),l.forEach(a,(function(t){w(e,t,E[n])}))}else r.ensureOptimizations&&l.PRINT_ERROR(u.failedOptimizationPrefixMsg+"\tTokenType: <"+o.tokenName(t)+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),x=!1;return e}),[])),x&&k.length<65536&&(k=l.packArray(k)),{emptyGroups:b,patternIdxToConfig:E,charCodeToPatternIdxToConfig:k,hasCustom:i,canBeOptimized:x}},t.validatePatterns=function(e,t){var r=[],n=d(e);r=r.concat(n.errors);var i=f(n.valid),a=i.valid;return(r=(r=(r=(r=r.concat(i.errors)).concat(function(e){var t=[],r=l.filter(e,(function(e){return l.isRegExp(e[h])}));return(t=(t=(t=(t=t.concat(m(r))).concat(y(r))).concat(_(r))).concat(b(r))).concat(g(r))}(a))).concat(E(a))).concat(w(a,t))).concat(x(a))},t.findMissingPatterns=d,t.findInvalidPatterns=f;var p=/[^\\][\$]/;function m(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,(function(e){var r=e[h];try{var n=c.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return p.test(r.source)}}));return l.map(r,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function g(e){var t=l.filter(e,(function(e){return e[h].test("")}));return l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' must not match an empty string",type:s.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}}))}t.findEndOfInputAnchor=m,t.findEmptyMatchRegExps=g;var v=/[^\\[][\^]|^\^/;function y(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,(function(e){var r=e[h];try{var n=c.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return v.test(r.source)}}));return l.map(r,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function _(e){var t=l.filter(e,(function(e){var t=e[h];return t instanceof RegExp&&(t.multiline||t.global)}));return l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:s.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}}))}function b(e){var t=[],r=l.map(e,(function(r){return l.reduce(e,(function(e,n){return r.PATTERN.source!==n.PATTERN.source||l.contains(t,n)||n.PATTERN===s.Lexer.NA||(t.push(n),e.push(n)),e}),[])}));r=l.compact(r);var n=l.filter(r,(function(e){return e.length>1}));return l.map(n,(function(e){var t=l.map(e,(function(e){return o.tokenName(e)}));return{message:"The same RegExp pattern ->"+l.first(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:s.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}}))}function E(e){var t=l.filter(e,(function(e){if(!l.has(e,"GROUP"))return!1;var t=e.GROUP;return t!==s.Lexer.SKIPPED&&t!==s.Lexer.NA&&!l.isString(t)}));return l.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:s.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}}))}function w(e,t){var r=l.filter(e,(function(e){return void 0!==e.PUSH_MODE&&!l.contains(t,e.PUSH_MODE)}));return l.map(r,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:s.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}}))}function x(e){var t=[],r=l.reduce(e,(function(e,t,r){var n,i=t.PATTERN;return i===s.Lexer.NA||(l.isString(i)?e.push({str:i,idx:r,tokenType:t}):l.isRegExp(i)&&(n=i,void 0===l.find([".","\\","[","]","|","^","$","(",")","?","*","+","{"],(function(e){return-1!==n.source.indexOf(e)})))&&e.push({str:i.source,idx:r,tokenType:t})),e}),[]);return l.forEach(e,(function(e,n){l.forEach(r,(function(r){var i=r.str,a=r.idx,u=r.tokenType;if(n<a&&function(e,t){if(l.isRegExp(t)){var r=t.exec(e);return null!==r&&0===r.index}if(l.isFunction(t))return t(e,0,[],{});if(l.has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(i,e.PATTERN)){var c="Token: ->"+o.tokenName(u)+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+o.tokenName(e)+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:c,type:s.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,u]})}}))})),t}function T(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function M(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function S(e){var t=e.PATTERN;if(l.isRegExp(t))return!1;if(l.isFunction(t))return!0;if(l.has(t,"exec"))return!0;if(l.isString(t))return!1;throw Error("non exhaustive match")}function A(e){return!(!l.isString(e)||1!==e.length)&&e.charCodeAt(0)}function R(e,t){if(l.has(e,"LINE_BREAKS"))return!1;if(l.isRegExp(e.PATTERN)){try{u.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(l.isString(e.PATTERN))return!1;if(S(e))return{issue:s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function k(e,t){if(t.issue===s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function P(e){return l.map(e,(function(e){return l.isString(e)&&e.length>0?e.charCodeAt(0):e}))}t.findStartOfInputAnchor=y,t.findUnsupportedFlags=_,t.findDuplicatePatterns=b,t.findInvalidGroupType=E,t.findModesThatDoNotExist=w,t.findUnreachablePatterns=x,t.addStartOfInput=T,t.addStickyFlag=M,t.performRuntimeChecks=function(e,r,n){var i=[];return l.has(e,t.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),l.has(e,t.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),l.has(e,t.MODES)&&l.has(e,t.DEFAULT_MODE)&&!l.has(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a "+t.DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),l.has(e,t.MODES)&&l.forEach(e.modes,(function(e,t){l.forEach(e,(function(e,r){l.isUndefined(e)&&i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+r+">\n",type:s.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})}))})),i},t.performWarningRuntimeChecks=function(e,t,r){var n=[],i=!1,a=l.compact(l.flatten(l.mapValues(e.modes,(function(e){return e})))),o=l.reject(a,(function(e){return e[h]===s.Lexer.NA})),c=P(r);return t&&l.forEach(o,(function(e){var t=R(e,c);if(!1!==t){var r={message:k(e,t),type:t.issue,tokenType:e};n.push(r)}else l.has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):u.canMatchCharCode(c,e.PATTERN)&&(i=!0)})),t&&!i&&n.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:s.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),n},t.cloneEmptyGroups=function(e){var t={},r=l.keys(e);return l.forEach(r,(function(r){var n=e[r];if(!l.isArray(n))throw Error("non exhaustive match");t[r]=[]})),t},t.isCustomPattern=S,t.isShortPattern=A,t.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,r=this.lastIndex;r<t;r++){var n=e.charCodeAt(r);if(10===n)return this.lastIndex=r+1,!0;if(13===n)return 10===e.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0},t.buildLineBreakIssueMessage=k},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(0),s=new a.RegExpParser,l="Complement Sets are not supported for first char optimization";function u(e){switch(e.type){case"Disjunction":return o.flatten(o.map(e.value,u));case"Alternative":for(var t=[],r=e.value,n=0;n<r.length;n++){var i=r[n];if(!o.contains(["GroupBackReference","Lookahead","NegativeLookahead","StartAnchor","EndAnchor","WordBoundary","NonWordBoundary"],i.type)){var a=i;switch(a.type){case"Character":t.push(a.value);break;case"Set":if(!0===a.complement)throw Error(l);o.forEach(a.value,(function(e){if("number"==typeof e)t.push(e);else for(var r=e,n=r.from;n<=r.to;n++)t.push(n)}));break;case"Group":var s=u(a.value);o.forEach(s,(function(e){return t.push(e)}));break;default:throw Error("Non Exhaustive Match")}var c=void 0!==a.quantifier&&0===a.quantifier.atLeast;if("Group"===a.type&&!1===d(a)||"Group"!==a.type&&!1===c)break}}return t;default:throw Error("non exhaustive match!")}}function c(e){var t=[];return o.forEach(e,(function(e){t.push(e);var r=String.fromCharCode(e);r.toUpperCase()!==r?t.push(r.toUpperCase().charCodeAt(0)):r.toLowerCase()!==r&&t.push(r.toLowerCase().charCodeAt(0))})),t}function h(e,t){return o.find(e.value,(function(e){if("number"==typeof e)return o.contains(t,e);var r=e;return void 0!==o.find(t,(function(e){return r.from<=e&&e<=r.to}))}))}function d(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(o.isArray(e.value)?o.every(e.value,d):d(e.value))}t.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',t.getStartCodes=function(e,r){void 0===r&&(r=!1);try{var n=s.pattern(e.toString()),i=u(n.value);return n.flags.ignoreCase&&(i=c(i)),i}catch(n){if(n.message===l)r&&o.PRINT_WARNING(t.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var h="";r&&(h="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),o.PRINT_ERROR(t.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+a.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+h)}}return[]},t.firstChar=u,t.applyIgnoreCase=c;var f=function(e){function t(t){var r=e.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return i(t,e),t.prototype.visitChildren=function(t){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)},t.prototype.visitCharacter=function(e){o.contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===h(e,this.targetCharCodes)&&(this.found=!0):void 0!==h(e,this.targetCharCodes)&&(this.found=!0)},t}(a.BaseRegExpVisitor);t.canMatchCharCode=function(e,t){if(t instanceof RegExp){var r=s.pattern(t.toString()),n=new f(e);return n.visit(r),n.found}return void 0!==o.find(t,(function(t){return o.contains(e,t.charCodeAt(0))}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){if(this.start=e,this.end=t,!i(e,t))throw new Error("INVALID RANGE")}return e.prototype.contains=function(e){return this.start<=e&&this.end>=e},e.prototype.containsRange=function(e){return this.start<=e.start&&this.end>=e.end},e.prototype.isContainedInRange=function(e){return e.containsRange(this)},e.prototype.strictlyContainsRange=function(e){return this.start<e.start&&this.end>e.end},e.prototype.isStrictlyContainedInRange=function(e){return e.strictlyContainsRange(this)},e}();function i(e,t){return!(e<0||t<e)}t.Range=n,t.isValidRange=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),o=r(0),s=r(5);t.resolveGrammar=function(e,t){var r=new l(e,t);return r.resolveRefs(),r.errors};var l=function(e){function t(t,r){var n=e.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return i(t,e),t.prototype.resolveRefs=function(){var e=this;o.forEach(this.nameToTopRule.values(),(function(t){e.currTopLevel=t,t.accept(e)}))},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule.get(e.nonTerminalName);if(t)e.referencedRule=t;else{var r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:a.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(s.GAstVisitor);t.GastRefResolverVisitor=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(0),a=r(3),o=r(9),s=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=i.has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:a.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=i.has(e,"maxLookahead")?e.maxLookahead:a.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=i.isES2015MapSupported()?new Map:[],i.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.lookAheadBuilderForOptional=function(e,t,r){return n.buildSingleAlternativeLookaheadFunction(e,t,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,r,i){return n.buildAlternativesLookAheadFunc(e,t,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return o.getKeyForAutomaticLookahead(r,e,t)},e.prototype.getLookaheadFuncForOr=function(e,t){var r=this.getKeyForAutomaticLookahead(o.OR_IDX,e),a=this.getLaFuncFromCache(r);if(void 0===a){var s=this.getCurrRuleFullName(),l=this.getGAstProductions().get(s),u=i.some(t,(function(e){return i.isFunction(e.GATE)}));return a=n.buildLookaheadFuncForOr(e,l,this.maxLookahead,u,this.dynamicTokensEnabled,this.lookAheadBuilderForAlternatives),this.setLaFuncCache(r,a),a}return a},e.prototype.getLookaheadFuncForOption=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.OPTION)},e.prototype.getLookaheadFuncForMany=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION)},e.prototype.getLookaheadFuncForManySep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.getLookaheadFuncForAtLeastOne=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY)},e.prototype.getLookaheadFuncForAtLeastOneSep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.getLookaheadFuncFor=function(e,t,r,i){var a=this.getLaFuncFromCache(e);if(void 0===a){var o=this.getCurrRuleFullName(),s=this.getGAstProductions().get(o);return a=n.buildLookaheadFuncForOptionalProd(t,s,r,this.dynamicTokensEnabled,i,this.lookAheadBuilderForOptional),this.setLaFuncCache(e,a),a}return a},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();t.LooksAhead=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16),i=r(0),a=r(33),o=r(9),s=r(3),l=function(){function e(){}return e.prototype.initTreeBuilder=function(e){this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=i.has(e,"outputCst")?e.outputCst:s.DEFAULT_PARSER_CONFIG.outputCst,this.outputCst||(this.cstInvocationStateUpdate=i.NOOP,this.cstFinallyStateUpdate=i.NOOP,this.cstPostTerminal=i.NOOP,this.cstPostNonTerminal=i.NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst)},e.prototype.cstNestedInvocationStateUpdate=function(e,t){this.CST_STACK.push({name:e,fullName:this.shortRuleNameToFull.get(this.getLastExplicitRuleShortName())+e,children:{}})},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1),this.CST_STACK.push({name:e,children:{}})},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];n.addTerminalToCst(r,t,e)},e.prototype.cstPostNonTerminal=function(e,t){n.addNoneTerminalToCst(this.CST_STACK[this.CST_STACK.length-1],t,e)},e.prototype.getBaseCstVisitorConstructor=function(){if(i.isUndefined(this.baseCstVisitorConstructor)){var e=a.createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(i.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=a.createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var r;return void 0!==e.NAME?(r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r):void 0},e.prototype.nestedAltBeforeClause=function(e,t,r,n){var i,a=this.getLastExplicitRuleShortName(),s=o.getKeyForAltIndex(a,r,t,n);return void 0!==e.NAME?(i=e.NAME,this.nestedRuleInvocationStateUpdate(i,s),{shortName:s,nestedName:i}):void 0},e.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,i=r[r.length-1];this.nestedRuleFinallyStateUpdate();var a=r[r.length-1];n.addNoneTerminalToCst(a,t,i)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}();t.TreeBuilder=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(0),a=r(4),o=r(11);function s(e,t){for(var r=i.keys(e),n=r.length,a=0;a<n;a++)for(var o=e[r[a]],s=o.length,l=0;l<s;l++){var u=o[l];void 0===u.tokenTypeIdx&&(void 0!==u.fullName?this[u.fullName](u.children,t):this[u.name](u.children,t))}}function l(e,t){var r=u(e,t),n=h(e,t);return r.concat(n)}function u(e,t){var r=i.map(t,(function(t){if(!i.isFunction(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+a.functionName(e.constructor)+" CST Visitor.",type:n.MISSING_METHOD,methodName:t}}));return i.compact(r)}t.defaultVisit=s,t.createBaseSemanticVisitorConstructor=function(e,t){var r=function(){};return a.defineNameProp(r,e+"BaseSemantics"),(r.prototype={visit:function(e,t){if(i.isArray(e)&&(e=e[0]),!i.isUndefined(e))return void 0!==e.fullName?this[e.fullName](e.children,t):this[e.name](e.children,t)},validateVisitor:function(){var e=l(this,t);if(!i.isEmpty(e)){var r=i.map(e,(function(e){return e.msg}));throw Error("Errors Detected in CST Visitor <"+a.functionName(this.constructor)+">:\n\t"+r.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=r,r._RULE_NAMES=t,r},t.createBaseVisitorConstructorWithDefaults=function(e,t,r){var n=function(){};a.defineNameProp(n,e+"BaseSemanticsWithDefaults");var o=Object.create(r.prototype);return i.forEach(t,(function(e){o[e]=s})),(n.prototype=o).constructor=n,n},function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(n=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={})),t.validateVisitor=l,t.validateMissingCstMethods=u;var c=["constructor","visit","validateVisitor"];function h(e,t){var r=[];for(var s in e)o.validTermsPattern.test(s)&&i.isFunction(e[s])&&!i.contains(c,s)&&!i.contains(t,s)&&r.push({msg:"Redundant visitor method: <"+s+"> on "+a.functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+o.validTermsPattern.source+"/.",type:n.REDUNDANT_METHOD,methodName:s});return r}t.validateRedundantMethods=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):n.END_OF_FILE},e.prototype.LA=function(e){return this.currIdx+e<0||this.tokVectorLength<=this.currIdx+e?n.END_OF_FILE:this.tokVector[this.currIdx+e]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();t.LexerAdapter=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(6),a=r(3),o=r(10),s=r(23),l=r(11),u=r(1),c=function(){function e(){}return e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,r){if(void 0===r&&(r=a.DEFAULT_RULE_CONFIG),n.contains(this.definedRulesNames,e)){var i={message:o.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}if(this.definedRulesNames.push(e),!this.gastProductionsCache.containsKey(e)&&!this.serializedGrammar){var l=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,l)}var u=this.defineRule(e,t,r);return this[e]=u,u},e.prototype.OVERRIDE_RULE=function(e,t,r){void 0===r&&(r=a.DEFAULT_RULE_CONFIG);var n=[];if(n=n.concat(l.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n),!this.serializedGrammar){var i=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,i)}var o=this.defineRule(e,t,r);return this[e]=o,o},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(i.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return u.serializeGrammar(this.gastProductionsCache.values())},e}();t.RecognizerApi=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(9),a=r(6),o=r(12),s=r(13),l=r(3),u=r(25),c=r(2),h=r(7),d=r(4),f=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=d.classNameFromInstance(this),this.shortRuleNameToFull=new d.HashTable,this.fullRuleNameToShort=new d.HashTable,this.ruleShortNameIdx=256,this.tokenMatcher=h.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache=new d.HashTable,this.serializedGrammar=n.has(t,"serializedGrammar")?t.serializedGrammar:l.DEFAULT_PARSER_CONFIG.serializedGrammar,n.isArray(e)){if(n.isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(n.isArray(e))this.tokensMap=n.reduce(e,(function(e,t){return e[c.tokenName(t)]=t,e}),{});else if(n.has(e,"modes")&&n.every(n.flatten(n.values(e.modes)),h.isTokenType)){var r=n.flatten(n.values(e.modes)),i=n.uniq(r);this.tokensMap=n.reduce(i,(function(e,t){return e[c.tokenName(t)]=t,e}),{})}else{if(!n.isObject(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=n.cloneObj(e)}this.tokensMap.EOF=c.EOF;var a=n.every(n.values(e),(function(e){return n.isEmpty(e.categoryMatches)}));this.tokenMatcher=a?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,h.augmentTokenTypes(n.values(this.tokensMap))},e.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var o,s=n.has(r,"resyncEnabled")?r.resyncEnabled:l.DEFAULT_RULE_CONFIG.resyncEnabled,u=n.has(r,"recoveryValueFunc")?r.recoveryValueFunc:l.DEFAULT_RULE_CONFIG.recoveryValueFunc,c=this.ruleShortNameIdx<<i.BITS_FOR_METHOD_IDX+i.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull.put(c,e),this.fullRuleNameToShort.put(e,c),(o=function(r,n){return void 0===r&&(r=0),this.ruleInvocationStateUpdate(c,e,r),function(e){try{return!0===this.outputCst?(t.apply(this,e),this.CST_STACK[this.CST_STACK.length-1]):t.apply(this,e)}catch(e){var r=1===this.RULE_STACK.length,n=s&&!this.isBackTracking()&&this.recoveryEnabled;if(a.isRecognitionException(e)){if(n){var i,o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))return e.resyncedTokens=this.reSyncTo(o),this.outputCst?((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i):u();throw this.outputCst&&((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,e.partialCstResult=i),e}if(r)return this.moveToTerminatedState(),u();throw e}throw e}finally{this.ruleFinallyStateUpdate()}}.call(this,n)}).ruleName=e,o},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,r){var n,i,a=this,o=this.getLookaheadFuncForOption(r,t);if(void 0!==e.DEF){if(n=e.DEF,void 0!==(i=e.GATE)){var s=o;o=function(){return i.call(a)&&s.call(a)}}}else n=e;if(!0===o.call(this))return n.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var n,a,l=this,u=this.getLookaheadFuncForAtLeastOne(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var c=u;u=function(){return a.call(l)&&c.call(l)}}}else n=t;if(!0!==u.call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var h=this.doSingleRepetition(n);!0===u.call(this)&&!0===h;)h=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],u,i.AT_LEAST_ONE_IDX,e,s.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,l=t.SEP;if(!0!==this.getLookaheadFuncForAtLeastOneSep(r,e).call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);a.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),l)};!0===this.tokenMatcher(this.LA(1),l);)this.CONSUME(l),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,l,u,a,s.NextTerminalAfterAtLeastOneSepWalker],u,i.AT_LEAST_ONE_SEP_IDX,e,s.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var n,a,o=this,l=this.getLookaheadFuncForMany(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var u=l;l=function(){return a.call(o)&&u.call(o)}}}else n=t;for(var c=!0;!0===l.call(this)&&!0===c;)c=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],l,i.MANY_IDX,e,s.NextTerminalAfterManyWalker)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,o=t.SEP;if(!0===this.getLookaheadFuncForManySep(r,e).call(this)){a.call(this);for(var l=function(){return n.tokenMatcher(n.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,l,a,s.NextTerminalAfterManySepWalker],l,i.MANY_SEP_IDX,e,s.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,n,a){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,a],r,i.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,t){var r=n.isArray(e)?e:e.DEF,i=this.getLookaheadFuncForOr(t,r).call(this,r);if(void 0!==i)return r[i].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OR_IDX,t),a=this.nestedRuleBeforeClause(e,r);try{var o=n.isArray(e)?e:e.DEF,s=this.getLookaheadFuncForOr(t,o).call(this,o);if(void 0!==s){var l=o[s],u=this.nestedAltBeforeClause(l,t,i.OR_IDX,s);try{return l.ALT.call(this)}finally{void 0!==u&&this.nestedRuleFinallyClause(u.shortName,u.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{void 0!==a&&this.nestedRuleFinallyClause(r,a)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new a.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,r){var n;try{var i=void 0!==r?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),n}catch(t){throw a.isRecognitionException(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),delete t.partialCstResult),t}},e.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);if(!0!==this.tokenMatcher(i,e)){var o,s=this.LA(0);throw o=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:i,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new a.MismatchedTokenException(o,i,s))}this.consumeToken(),n=i}catch(r){if(!this.recoveryEnabled||"MismatchedTokenException"!==r.name||this.isBackTracking())throw r;var l=this.getFollowsForInRuleRecovery(e,t);try{n=this.tryInRuleRecovery(e,l)}catch(e){throw e.name===u.IN_RULE_RECOVERY_EXCEPTION?r:e}}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:e.tokenName,n),n},e.prototype.saveRecogState=function(){var e=this.errors,t=n.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return!n.isEmpty(this.isBackTrackingStack)},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull.get(e)},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull.get(e)},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),c.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();t.RecognizerEngine=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=r(0),a=r(12),o=r(3),s=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=i.defaults(e.errorMessageProvider,o.DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(n.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return i.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,r){for(var i=this.getCurrRuleFullName(),o=this.getGAstProductions().get(i),s=a.getLookaheadPathsForOptionalProd(e,o,t,this.maxLookahead)[0],l=[],u=1;u<this.maxLookahead;u++)l.push(this.LA(u));var c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:l,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new n.EarlyExitException(c,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),i=this.getGAstProductions().get(r),o=a.getLookaheadPathsForOr(e,i,this.maxLookahead),s=[],l=1;l<=this.maxLookahead;l++)s.push(this.LA(l));var u=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:u,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new n.NoViableAltException(c,this.LA(1),u))},e}();t.ErrorHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),i=r(0),a=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache.get(e);if(i.isUndefined(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return n.nextPossibleTokensAfter([r],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=i.first(e.ruleStack),r=this.getGAstProductions().get(t);return new n.NextAfterTokenWalker(r,e).startWalking()},e}();t.ContentAssist=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(17);t.createSyntaxDiagramsCode=function(e,t){var r=void 0===t?{}:t,i=r.resourceBase,a=void 0===i?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/":i,o=r.css;return"\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n\n<link rel='stylesheet' href='"+(void 0===o?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/diagrams.css":o)+"'>\n\n<script src='"+a+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+a+"src/diagrams_builder.js'><\/script>\n<script src='"+a+"src/diagrams_behavior.js'><\/script>\n<script src='"+a+'src/main.js\'><\/script>\n\n<div id="diagrams" align="center"></div>    \n\n<script>\n    window.serializedGrammar = '+JSON.stringify(e,null,"  ")+';\n<\/script>\n\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(41);t.generateParserFactory=function(e){var t=n.genWrapperFunction({name:e.name,rules:e.rules}),i=new Function("tokenVocabulary","config","chevrotain",t);return function(t){return i(e.tokenVocabulary,t,r(18))}},t.generateParserModule=function(e){return n.genUmdModule({name:e.name,rules:e.rules})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),a=r(1),o="\n";function s(e){return"\nfunction "+e.name+"(tokenVocabulary, config) {\n    // invoke super constructor\n    // No support for embedded actions currently, so we can 'hardcode'\n    // The use of CstParser.\n    chevrotain.CstParser.call(this, tokenVocabulary, config)\n\n    const $ = this\n\n    "+l(e.rules)+"\n\n    // very important to call this after all the rules have been defined.\n    // otherwise the parser may not work correctly as it will lack information\n    // derived during the self analysis phase.\n    this.performSelfAnalysis(this)\n}\n\n// inheritance as implemented in javascript in the previous decade... :(\n"+e.name+".prototype = Object.create(chevrotain.CstParser.prototype)\n"+e.name+".prototype.constructor = "+e.name+"    \n    "}function l(e){return n.map(e,(function(e){return u(e,1)})).join("\n")}function u(e,t){var r=v(t,'$.RULE("'+e.name+'", function() {')+o;return(r+=g(e.definition,t+1))+(v(t+1,"})")+o)}function c(e,t){var r=i.tokenName(e.terminalType);return v(t,"$.CONSUME"+e.idx+"(this.tokensMap."+r+")"+o)}function h(e,t){return v(t,"$.SUBRULE"+e.idx+"($."+e.nonTerminalName+")"+o)}function d(e,t){var r=v(t,"$.OR"+e.idx+"([")+o;return(r+=n.map(e.definition,(function(e){return f(e,t+1)})).join(",\n"))+(o+v(t,"])\n"))}function f(e,t){var r=v(t,"{")+o;return e.name&&(r+=v(t+1,'NAME: "'+e.name+'",')+o),r+=v(t+1,"ALT: function() {")+o,r+=g(e.definition,t+1),(r+=v(t+1,"}")+o)+v(t,"}")}function p(e,t,r){var n=v(r,"$."+(e+t.idx)+"(");return t.name||t.separator?(n+="{\n",t.name&&(n+=v(r+1,'NAME: "'+t.name+'"')+","+o),t.separator&&(n+=v(r+1,"SEP: this.tokensMap."+i.tokenName(t.separator))+","+o),n+="DEF: "+m(t.definition,r+2)+o,n+=v(r,"}")+o):n+=m(t.definition,r+1),n+(v(r,")")+o)}function m(e,t){var r="function() {\n";return(r+=g(e,t))+(v(t,"}")+o)}function g(e,t){var r="";return n.forEach(e,(function(e){r+=function(e,t){if(e instanceof a.NonTerminal)return h(e,t);if(e instanceof a.Option)return p("OPTION",e,t);if(e instanceof a.RepetitionMandatory)return p("AT_LEAST_ONE",e,t);if(e instanceof a.RepetitionMandatoryWithSeparator)return p("AT_LEAST_ONE_SEP",e,t);if(e instanceof a.RepetitionWithSeparator)return p("MANY_SEP",e,t);if(e instanceof a.Repetition)return p("MANY",e,t);if(e instanceof a.Alternation)return d(e,t);if(e instanceof a.Terminal)return c(e,t);if(e instanceof a.Flat)return g(e.definition,t);throw Error("non exhaustive match")}(e,t+1)})),r}function v(e,t){return Array(4*e+1).join(" ")+t}t.genUmdModule=function(e){return"\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['chevrotain'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('chevrotain'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(root.b);\n    }\n}(typeof self !== 'undefined' ? self : this, function (chevrotain) {\n\n"+s(e)+"\n    \nreturn {\n    "+e.name+": "+e.name+" \n}\n}));\n"},t.genWrapperFunction=function(e){return"    \n"+s(e)+"\nreturn new "+e.name+"(tokenVocabulary, config)    \n"},t.genClass=s,t.genAllRules=l,t.genRule=u,t.genTerminal=c,t.genNonTerminal=h,t.genAlternation=d,t.genSingleAlt=f}])},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=r(12);t.compareCoord=n.compareCoord,t.saturateAbs=n.saturateAbs,t.EPSILON=n.EPSILON,t.POSITIVE_INFINITY=n.POSITIVE_INFINITY,t.NEGATIVE_INFINITY=n.NEGATIVE_INFINITY;var i=r(153);t.DynamicVolume=i.DynamicVolume,t.StaticVolume=i.StaticVolume;var a=r(32);t.StencilIterator=a.StencilIterator,t.beginStencil=a.beginStencil;var o=r(154);t.MultiIterator=o.MultiIterator,t.beginMulti=o.beginMulti},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||function(e,t,r){this.buffer=void 0===t&&void 0===r?new Uint8Array(e):new Uint8Array(e,t,r),this.index=0},n.lossless.DataStream.prototype.get16=function(){var e=(this.buffer[this.index]<<8)+this.buffer[this.index+1];return this.index+=2,e},n.lossless.DataStream.prototype.get8=function(){var e=this.buffer[this.index];return this.index+=1,e},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.DataStream)},function(e,t,r){"use strict";var n,i,a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r,s){"object"===o(t)&&void 0!==e?s(t):(i=[t],void 0===(a="function"==typeof(n=s)?n.apply(t,i):n)||(e.exports=a))}(0,(function(e){var t=Math.round,r=Math.abs,n=Math.min,i=Math.max,a=Math.sqrt;function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function u(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e,t,r){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(e,t,r){var n,i,o,s,l,u,c,h,d,f,p,m=t.params.Points.threshold;for(l=0,c=e.length;l<c;++l)if(null!==(f=(d=e[l]).points))for(u=0,h=f.length;u<h;++u)p=f[u],(s=t.ray.distanceSqToPoint(p))<m*m&&(n=t.ray.closestPointToPoint(p,new R),(i=t.ray.origin.distanceTo(n))>=t.near&&i<=t.far&&(o=a(s),r.push(new N(i,o,n,d.data[u]))))}function v(e,t,r,n,i,a){var o=0;return e>t&&e>r?(i<e&&(o|=2),a<e&&(o|=1)):t>r?(n<t&&(o|=4),a<t&&(o|=1)):(n<r&&(o|=4),i<r&&(o|=2)),o}function y(e,t,r,n){var i,a=0;return t<r?(i=t,a=0):(i=r,a=1),n<i&&(a=2),B[e][a]}function _(e,t,r){var a,o,s,l,u,c,h,d,f,p=j.min.set(0,0,0),m=j.max.subVectors(e.max,e.min),g=e.getDimensions(V.min),v=V.max.copy(g).multiplyScalar(.5),y=G.origin.copy(t.origin),_=G.direction.copy(t.direction);return y.sub(e.getCenter(z)).add(v),r.value=0,0>_.x&&(y.x=g.x-y.x,_.x=-_.x,r.value|=4),0>_.y&&(y.y=g.y-y.y,_.y=-_.y,r.value|=2),0>_.z&&(y.z=g.z-y.z,_.z=-_.z,r.value|=1),a=1/_.x,o=1/_.y,s=1/_.z,l=(p.x-y.x)*a,u=(m.x-y.x)*a,c=(p.y-y.y)*o,h=(m.y-y.y)*o,d=(p.z-y.z)*s,f=(m.z-y.z)*s,i(i(l,c),d)<n(n(u,h),f)?[l,c,d,u,h,f]:null}function b(e,t,r,n,i,a,o,s){if(0<=i&&0<=a&&0<=o){var l=e.children;if(null===l)s.push(e);else{var u=.5*(t+i),c=.5*(r+a),h=.5*(n+o),d=W.value,f=v(t,r,n,u,c,h);do{0===f?(b(l[d],t,r,n,u,c,h,s),f=y(f,u,c,h)):1===f?(b(l[1^d],t,r,h,u,c,o,s),f=y(f,u,c,o)):2===f?(b(l[2^d],t,c,n,u,a,h,s),f=y(f,u,a,h)):3===f?(b(l[3^d],t,c,h,u,a,o,s),f=y(f,u,a,o)):4===f?(b(l[4^d],u,r,n,i,c,h,s),f=y(f,i,c,h)):5===f?(b(l[5^d],u,r,h,i,c,o,s),f=y(f,i,c,o)):6===f?(b(l[6^d],u,c,n,i,a,h,s),f=y(f,i,a,h)):7===f&&(b(l[7^d],u,c,h,i,a,o,s),f=8)}while(8>f)}}}function E(e){var t,r,n=e.children,i=0;if(null!==n)for(t=0,r=n.length;t<r;++t)i+=E(n[t]);else null!==e.points&&(i=e.points.length);return i}function w(e,t,r,n,i){var a,o,s=n.children,l=!1,u=!1;if(n.contains(e,r.bias)){if(null===s){if(null===n.points)n.points=[],n.data=[];else for(a=0,o=n.points.length;!l&&a<o;++a)l=n.points[a].equals(e);l?(n.data[a-1]=t,u=!0):n.points.length<r.maxPoints||i===r.maxDepth?(n.points.push(e.clone()),n.data.push(t),++r.pointCount,u=!0):(n.split(),n.redistribute(r.bias),s=n.children)}if(null!==s)for(++i,a=0,o=s.length;!u&&a<o;++a)u=w(e,t,r,s[a],i)}return u}function x(e,t,r,n){var i,a,o,s,l,u=r.children,c=null;if(r.contains(e,t.bias))if(null!==u)for(i=0,a=u.length;null===c&&i<a;++i)c=x(e,t,u[i],r);else if(null!==r.points)for(o=r.points,s=r.data,i=0,a=o.length;i<a;++i)if(o[i].equals(e)){l=a-1,c=s[i],i<l&&(o[i]=o[l],s[i]=s[l]),o.pop(),s.pop(),--t.pointCount,null!==n&&E(n)<=t.maxPoints&&n.merge();break}return c}function T(e,t,r,n){var i,a,o=null,s=t;if(null!==n.children){var l,u,c=n.children.map((function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}})).sort((function(e,t){return e.distance-t.distance}));for(i=0,a=c.length;i<a&&(!(l=c[i].octant).contains(e,s)||(null===(u=T(e,s,r,l))||(o=u,0!==(s=u.distance))));++i);}else if(null!==n.points){var h,d=n.points,f=-1;for(i=0,a=d.length;i<a;++i)if(d[i].equals(e)){if(!r){s=0,f=i;break}}else(h=e.distanceTo(d[i]))<s&&(s=h,f=i);0<=f&&(o={point:d[f],data:n.data[f],distance:s})}return o}function M(e,t,r,n,i){var a,o,s,l=n.children;if(null!==l)for(a=0,o=l.length;a<o;++a)(s=l[a]).contains(e,t)&&M(e,t,r,s,i);else if(null!==n.points){var u,c=n.points;for(a=0,o=c.length;a<o;++a)(u=c[a]).equals(e)?!r&&i.push({point:u.clone(),data:n.data[a]}):u.distanceToSquared(e)<=t*t&&i.push({point:u.clone(),data:n.data[a]})}}var S=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],A=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],R=function(){var e=Math.cos,o=Math.sin;function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;s(this,l),this.x=e,this.y=t,this.z=r}return u(l,[{key:"set",value:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(t,r,n){var i=o(r)*t;return this.x=i*o(n),this.y=e(r)*t,this.z=i*e(n),this}},{key:"setFromCylindrical",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(t,r,n){return this.x=t*o(r),this.y=n,this.z=t*e(r),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,u=s*r+o*t-i*n,c=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+u*-o-c*-a,this.y=u*s+h*-a+c*-i-l*-o,this.z=c*s+h*-o+l*-a-u*-i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,r=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,r,n),this}},{key:"angleTo",value:function(e){var t=Math.acos,r=this.dot(e)/a(this.lengthSquared()*e.lengthSquared());return t(n(i(r,-1),1))}},{key:"manhattanLength",value:function(){return r(this.x)+r(this.y)+r(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return a(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return r(this.x-e.x)+r(this.y-e.y)+r(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}},{key:"distanceTo",value:function(e){return a(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=n(this.x,e.x),this.y=n(this.y,e.y),this.z=n(this.z,e.z),this}},{key:"max",value:function(e){return this.x=i(this.x,e.x),this.y=i(this.y,e.y),this.z=i(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=i(e.x,n(t.x,this.x)),this.y=i(e.y,n(t.y,this.y)),this.z=i(e.z,n(t.z,this.z)),this}},{key:"floor",value:function(){var e=Math.floor;return this.x=e(this.x),this.y=e(this.y),this.z=e(this.z),this}},{key:"ceil",value:function(){var e=Math.ceil;return this.x=e(this.x),this.y=e(this.y),this.z=e(this.z),this}},{key:"round",value:function(){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),l}(),k=new R,P=[new R,new R,new R,new R,new R,new R,new R,new R],L=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R(1/0,1/0,1/0),r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R(-1/0,-1/0,-1/0);s(this,e),this.min=t,this.max=r}return u(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,r;for(this.min.set(0,0,0),this.max.set(0,0,0),t=0,r=e.length;t<r;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var r=k.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return k.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,r=this.max;return this.isEmpty()||(P[0].set(t.x,t.y,t.z).applyMatrix4(e),P[1].set(t.x,t.y,r.z).applyMatrix4(e),P[2].set(t.x,r.y,t.z).applyMatrix4(e),P[3].set(t.x,r.y,r.z).applyMatrix4(e),P[4].set(r.x,t.y,t.z).applyMatrix4(e),P[5].set(r.x,t.y,r.z).applyMatrix4(e),P[6].set(r.x,r.y,t.z).applyMatrix4(e),P[7].set(r.x,r.y,r.z).applyMatrix4(e),this.setFromPoints(P)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,r=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=r.x&&e.y<=r.y&&e.z<=r.z}},{key:"containsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=r.x&&t.y<=n.y&&i.y<=r.y&&t.z<=n.z&&i.z<=r.z}},{key:"intersectsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&n.x<=r.x&&n.y<=r.y&&n.z<=r.z}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,k).distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,r;return 0<e.normal.x?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),C=[new R,new R,new R,new R],I=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;s(this,e),this.origin=t,this.direction=r}return u(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,C[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,r=t.subVectors(e,this.origin).dot(this.direction);return 0<=r?t.copy(this.direction).multiplyScalar(r).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=C[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):C[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return a(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction),r=0===t?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null}},{key:"distanceSquaredToSegment",value:function(e,t,a,o){var s,l,u,c,h,d=C[0].copy(e).add(t).multiplyScalar(.5),f=C[1].copy(t).sub(e).normalize(),p=C[2].copy(this.origin).sub(d),m=.5*e.distanceTo(t),g=-this.direction.dot(f),v=p.dot(this.direction),y=-p.dot(f),_=p.lengthSq(),b=r(1-g*g);return 0<b?(l=g*v-y,u=m*b,0<=(s=g*y-v)?l>=-u?l<=u?h=(s*=c=1/b)*(s+g*(l*=c)+2*v)+l*(g*s+l+2*y)+_:h=-(s=i(0,-(g*(l=m)+v)))*s+l*(l+2*y)+_:h=-(s=i(0,-(g*(l=-m)+v)))*s+l*(l+2*y)+_:l<=-u?h=-(s=i(0,-(-g*m+v)))*s+(l=0<s?-m:n(i(-m,-y),m))*(l+2*y)+_:l<=u?(s=0,h=(l=n(i(-m,-y),m))*(l+2*y)+_):h=-(s=i(0,-(g*m+v)))*s+(l=0<s?m:n(i(-m,-y),m))*(l+2*y)+_):h=-(s=i(0,-(g*(l=0<g?-m:m)+v)))*s+l*(l+2*y)+_,void 0!==a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),void 0!==o&&o.copy(f).multiplyScalar(l).add(d),h}},{key:"intersectSphere",value:function(e){var t,r,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,o=C[0].subVectors(e.center,this.origin),s=o.dot(this.direction),l=o.dot(o)-s*s,u=e.radius*e.radius,c=null;return l<=u&&(n=s+(t=a(u-l)),(0<=(r=s-t)||0<=n)&&(c=0>r?this.at(n,i):this.at(r,i))),c}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"intersectPlane",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t,r,n,i,a,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,l=this.origin,u=this.direction,c=e.min,h=e.max,d=1/u.x,f=1/u.y,p=1/u.z,m=null;return 0<=d?(t=(c.x-l.x)*d,r=(h.x-l.x)*d):(t=(h.x-l.x)*d,r=(c.x-l.x)*d),0<=f?(n=(c.y-l.y)*f,i=(h.y-l.y)*f):(n=(h.y-l.y)*f,i=(c.y-l.y)*f),t<=i&&n<=r&&((n>t||t!=t)&&(t=n),(i<r||r!=r)&&(r=i),0<=p?(a=(c.z-l.z)*p,o=(h.z-l.z)*p):(a=(h.z-l.z)*p,o=(c.z-l.z)*p),t<=o&&a<=r&&((a>t||t!=t)&&(t=a),(o<r||r!=r)&&(r=o),0<=r&&(m=this.at(0<=t?t:r,s)))),m}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,C[0])}},{key:"intersectTriangle",value:function(e,t,r,n,i){var a,o,s,l,u,c=this.direction,h=C[0],d=C[1],f=C[2],p=C[3],m=null;return d.subVectors(t,e),f.subVectors(r,e),p.crossVectors(d,f),0===(a=c.dot(p))||n&&0<a||(0<a?o=1:(o=-1,a=-a),h.subVectors(this.origin,e),0<=(s=o*c.dot(f.crossVectors(h,f)))&&(0<=(l=o*c.dot(d.cross(h)))&&s+l<=a&&(0<=(u=-o*h.dot(p))&&(m=this.at(u/a,i))))),m}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),H=new R,O=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;s(this,e),this.min=t,this.size=r,this.children=null}return u(e,[{key:"getCenter",value:function(e){return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(e){return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e,t,r=this.min,n=this.getCenter(H),i=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=A[e],a[e]=new this.constructor(new R(0===t[0]?r.x:n.x,0===t[1]?r.y:n.y,0===t[2]?r.z:n.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),D=new R,F=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;s(this,e),this.min=t,this.max=r,this.children=null}return u(e,[{key:"getCenter",value:function(e){return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(e){return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e,t,r=this.min,n=this.max,i=this.getCenter(D),a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=A[e],a[e]=new this.constructor(new R(0===t[0]?r.x:i.x,0===t[1]?r.y:i.y,0===t[2]?r.z:i.z),new R(0===t[0]?i.x:n.x,0===t[1]?i.y:n.y,0===t[2]?i.z:n.z))}}]),e}(),N=function e(t,r,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;s(this,e),this.distance=t,this.distanceToRay=r,this.point=n,this.object=i},U=function e(){s(this,e),this.value=0},B=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],z=new R,j=new L,V=new L,G=new I,W=new U,X=function(){function e(){s(this,e)}return u(e,null,[{key:"intersectOctree",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],n=_(e,t,W);null!==n&&b.apply(void 0,[e.root].concat(m(n),[r]))}}]),e}(),Y=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,r=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];s(this,e),this.value=t,this.done=r}return u(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),q=new L,Z=function(){function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;s(this,e),this.octree=t,this.region=r,this.cull=null!==r,this.result=new Y,this.trace=null,this.indices=null,this.reset()}return u(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(q.min=e.min,q.max=e.max,(!this.cull||this.region.intersectsBox(q))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e,t,r,n=this.cull,i=this.region,a=this.indices,o=this.trace,s=null,l=o.length-1;null===s&&0<=l;)if(e=a[l]++,t=o[l].children,8>e)if(null!==t){if(r=t[e],n&&(q.min=r.min,q.max=r.max,!i.intersectsBox(q)))continue;o.push(r),a.push(0),++l}else s=o.pop(),a.pop();else o.pop(),a.pop(),--l;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),K=new L,Q=function(){function e(t){s(this,e),this.root=t}return u(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"cull",value:function(e){var t=[];return function e(t,r,n){var i,a,o=t.children;if(K.min=t.min,K.max=t.max,r.intersectsBox(K))if(null!==o)for(i=0,a=o.length;i<a;++i)e(o[i],r,n);else n.push(t)}(this.root,e,t),t}},{key:"getDepth",value:function(){return function e(t){var r,n,i,a=t.children,o=0;if(null!==a)for(r=0,n=a.length;r<n;++r)(i=1+e(a[r]))>o&&(o=i);return o}(this.root)}},{key:"findNodesByLevel",value:function(e){var t=[];return function e(t,r,n,i){var a,o,s=t.children;if(n===r)i.push(t);else if(null!==s)for(++n,a=0,o=s.length;a<o;++a)e(s[a],r,n,i)}(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return X.intersectOctree(this,e.ray,t),t}},{key:"leaves",value:function(e){return new Z(this,e)}},{key:Symbol.iterator,value:function(){return new Z(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),J=new R,$=function(e){function t(e,r){var n;return s(this,t),(n=f(this,h(t).call(this,e,r))).points=null,n.data=null,n}return c(t,e),u(t,[{key:"distanceToSquared",value:function(e){return J.copy(e).clamp(this.min,this.max).sub(e).lengthSquared()}},{key:"distanceToCenterSquared",value:function(e){var t=this.getCenter(J),r=e.x-t.x,n=e.y-t.x,i=e.z-t.z;return r*r+n*n+i*i}},{key:"contains",value:function(e,t){var r=this.min,n=this.max;return e.x>=r.x-t&&e.y>=r.y-t&&e.z>=r.z-t&&e.x<=n.x+t&&e.y<=n.y+t&&e.z<=n.z+t}},{key:"redistribute",value:function(e){var t,r,n,i,a,o,s,l=this.children,u=this.points,c=this.data;if(null!==l&&null!==u){for(t=0,n=u.length;t<n;++t)for(o=u[t],s=c[t],r=0,i=l.length;r<i;++r)if((a=l[r]).contains(o,e)){null===a.points&&(a.points=[],a.data=[]),a.points.push(o),a.data.push(s);break}this.points=null,this.data=null}}},{key:"merge",value:function(){var e=this.children;if(null!==e){var t,r,n,i=[],a=[];for(t=0,r=e.length;t<r;++t)null!==(n=e[t]).points&&(i=i.concat(n.points),a=a.concat(n.data));this.children=null,this.points=i,this.data=a}}}]),t}(F),ee=function(e){function r(e,n){var a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,u=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return s(this,r),(a=f(this,h(r).call(this,new $(e,n)))).bias=i(0,o),a.maxPoints=i(1,t(l)),a.maxDepth=i(0,t(u)),a.pointCount=0,a}return c(r,e),u(r,[{key:"countPoints",value:function(e){return E(e)}},{key:"insert",value:function(e,t){return w(e,t,this,this.root,0)}},{key:"remove",value:function(e){return x(e,this,this.root,null)}},{key:"get",value:function(e){return function e(t,r,n){var i,a,o,s=n.children,l=null;if(n.contains(t,r.bias))if(null!==s)for(i=0,a=s.length;null===l&&i<a;++i)l=e(t,r,s[i]);else if(null!==n.points)for(i=0,a=(o=n.points).length;null===l&&i<a;++i)t.equals(o[i])&&(l=n.data[i]);return l}(e,this,this.root)}},{key:"move",value:function(e,t){return function e(t,r,n,i,a,o){var s,l,u,c=i.children,h=null;if(i.contains(t,n.bias))if(i.contains(r,n.bias)){if(null!==c)for(++o,s=0,l=c.length;null===h&&s<l;++s)h=e(t,r,n,c[s],i,o);else if(null!==i.points)for(s=0,l=(u=i.points).length;s<l;++s)if(t.equals(u[s])){u[s].copy(r),h=i.data[s];break}}else w(r,h=x(t,n,i,a),n,a,o-1);return h}(e,t,this,this.root,null,0)}},{key:"findNearestPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=T(e,t,r,this.root);return null!==n&&(n.point=n.point.clone()),n}},{key:"findPoints",value:function(e,t){var r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=[];return M(e,t,r,this.root,n),n}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=p(h(r.prototype),"raycast",this).call(this,e);return 0<n.length&&g(n,e,t),t}}]),r}(Q);e.CubicOctant=O,e.Flags=U,e.Octant=F,e.Octree=Q,e.OctreeIterator=Z,e.OctreeRaycaster=X,e.PointOctant=$,e.PointOctree=ee,e.RayPointIntersection=N,e.edges=S,e.findEntryOctant=v,e.findNextOctant=y,e.intersectOctree=_,e.layout=A,e.testPoints=g,Object.defineProperty(e,"__esModule",{value:!0})}))},function(e,t,r){(function(r){var n,i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:o.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[r[n]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a,o=new i;o.Group=i,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof self&&void 0!==r&&r.hrtime?o.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?o.now=self.performance.now.bind(self.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,n;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,n=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,n):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?i+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=i+(a-i)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],n):t>1?a(e[r],e[r-1],r-n):a(e[i],e[i+1>r?r:i+1],n-i)},Bezier:function(e,t){for(var r=0,n=e.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=n;s++)r+=i(1-t,n-s)*i(t,s)*e[s]*a(n,s);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(i=Math.floor(n=r*(1+t))),a(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(a(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):a(e[i?i-1:0],e[i],e[r<i+1?r:i+1],e[r<i+2?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=o.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(a=[1],function(e){var t=1;if(a[e])return a[e];for(var r=e;r>1;r--)t*=r;return a[e]=t,t}),CatmullRom:function(e,t,r,n,i){var a=.5*(r-e),o=.5*(n-t),s=i*i;return(2*t-2*r+a+o)*(i*s)+(-3*t+3*r-2*a-o)*s+a*i+t}}},void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}).call(this,r(16))},function(e,t,r){(function(t){var r="undefined"!=typeof Float64Array;function n(e,t){return e[0]-t[0]}function i(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(n);var i=new Array(r.length);for(e=0;e<i.length;++e)i[e]=r[e][1];return i}function a(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var n="generic"===e;if(-1===t){var a="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(a)()}if(0===t){a="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",a)(o[e][0])}a=["'use strict'"];var s=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}(t),l=s.map((function(e){return"i"+e})),u="this.offset+"+s.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),c=s.map((function(e){return"b"+e})).join(","),h=s.map((function(e){return"c"+e})).join(",");a.push("function "+r+"(a,"+c+","+h+",d){this.data=a","this.shape=["+c+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),a.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+s.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),t<4?(a.push("function "+r+"_order(){"),2===t?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+r+"_set("+l.join(",")+",v){"),n?a.push("return this.data.set("+u+",v)}"):a.push("return this.data["+u+"]=v}"),a.push("proto.get=function "+r+"_get("+l.join(",")+"){"),n?a.push("return this.data.get("+u+")}"):a.push("return this.data["+u+"]}"),a.push("proto.index=function "+r+"_index(",l.join(),"){return "+u+"}"),a.push("proto.hi=function "+r+"_hi("+l.join(",")+"){return new "+r+"(this.data,"+s.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+s.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=s.map((function(e){return"a"+e+"=this.shape["+e+"]"})),f=s.map((function(e){return"c"+e+"=this.stride["+e+"]"}));a.push("proto.lo=function "+r+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+f.join(","));for(var p=0;p<t;++p)a.push("if(typeof i"+p+"==='number'&&i"+p+">=0){d=i"+p+"|0;b+=c"+p+"*d;a"+p+"-=d}");a.push("return new "+r+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"c"+e})).join(",")+",b)}"),a.push("proto.step=function "+r+"_step("+l.join(",")+"){var "+s.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+s.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(p=0;p<t;++p)a.push("if(typeof i"+p+"==='number'){d=i"+p+"|0;if(d<0){c+=b"+p+"*(a"+p+"-1);a"+p+"=ceil(-a"+p+"/d)}else{a"+p+"=ceil(a"+p+"/d)}b"+p+"*=d}");a.push("return new "+r+"(this.data,"+s.map((function(e){return"a"+e})).join(",")+","+s.map((function(e){return"b"+e})).join(",")+",c)}");var m=new Array(t),g=new Array(t);for(p=0;p<t;++p)m[p]="a[i"+p+"]",g[p]="b[i"+p+"]";a.push("proto.transpose=function "+r+"_transpose("+l+"){"+l.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+m.join(",")+","+g.join(",")+",this.offset)}"),a.push("proto.pick=function "+r+"_pick("+l+"){var a=[],b=[],c=this.offset");for(p=0;p<t;++p)a.push("if(typeof i"+p+"==='number'&&i"+p+">=0){c=(c+this.stride["+p+"]*i"+p+")|0}else{a.push(this.shape["+p+"]);b.push(this.stride["+p+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+s.map((function(e){return"shape["+e+"]"})).join(",")+","+s.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(o[e],i)}var o={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,n,i,s){if(void 0===e)return(0,o.array[0])([]);"number"==typeof e&&(e=[e]),void 0===n&&(n=[e.length]);var l=n.length;if(void 0===i){i=new Array(l);for(var u=l-1,c=1;u>=0;--u)i[u]=c,c*=n[u]}if(void 0===s){s=0;for(u=0;u<l;++u)i[u]<0&&(s-=(n[u]-1)*i[u])}for(var h=function(e){if(t.isBuffer(e))return"buffer";if(r)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),d=o[h];d.length<=l+1;)d.push(a(h,d.length-1));return(0,d[l+1])(e,n,i,s)}}).call(this,r(20).Buffer)},function(e,t){(function(){"use strict";var e=void 0,t=this;function r(r,n){var i,a=r.split("."),o=t;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===e?o=o[i]?o[i]:o[i]={}:o[i]=n}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e){var t,r,i,a,o,s,l,u,c,h,d=e.length,f=0,p=Number.POSITIVE_INFINITY;for(u=0;u<d;++u)e[u]>f&&(f=e[u]),e[u]<p&&(p=e[u]);for(t=1<<f,r=new(n?Uint32Array:Array)(t),i=1,a=0,o=2;i<=f;){for(u=0;u<d;++u)if(e[u]===i){for(s=0,l=a,c=0;c<i;++c)s=s<<1|1&l,l>>=1;for(h=i<<16|u,c=s;c<t;c+=o)r[c]=h;++a}++i,a<<=1,o<<=1}return[r,f,p]}function a(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=n?new Uint8Array(e):e,this.m=!1,this.i=s,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case o:this.b=32768,this.c=new(n?Uint8Array:Array)(32768+this.h+258);break;case s:this.b=0,this.c=new(n?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var o=0,s=1,l={t:o,s:s};a.prototype.k=function(){for(;!this.m;){var t=A(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var r=this.input,a=this.a,l=this.c,u=this.b,c=r.length,h=e,f=l.length,p=e;if(this.d=this.f=0,a+1>=c)throw Error("invalid uncompressed block header: LEN");if(h=r[a++]|r[a++]<<8,a+1>=c)throw Error("invalid uncompressed block header: NLEN");if(h===~(r[a++]|r[a++]<<8))throw Error("invalid uncompressed block header: length verify");if(a+h>r.length)throw Error("input buffer is broken");switch(this.i){case o:for(;u+h>l.length;){if(h-=p=f-u,n)l.set(r.subarray(a,a+p),u),u+=p,a+=p;else for(;p--;)l[u++]=r[a++];this.b=u,l=this.e(),u=this.b}break;case s:for(;u+h>l.length;)l=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(n)l.set(r.subarray(a,a+h),u),u+=h,a+=h;else for(;h--;)l[u++]=r[a++];this.a=a,this.b=u,this.c=l;break;case 1:this.j(T,S);break;case 2:var m,g,v,y,_=A(this,5)+257,b=A(this,5)+1,E=A(this,4)+4,w=new(n?Uint8Array:Array)(d.length),x=e,M=e,k=e,P=e,L=e;for(L=0;L<E;++L)w[d[L]]=A(this,3);if(!n)for(L=E,E=w.length;L<E;++L)w[d[L]]=0;for(m=i(w),x=new(n?Uint8Array:Array)(_+b),L=0,y=_+b;L<y;)switch(M=R(this,m),M){case 16:for(P=3+A(this,2);P--;)x[L++]=k;break;case 17:for(P=3+A(this,3);P--;)x[L++]=0;k=0;break;case 18:for(P=11+A(this,7);P--;)x[L++]=0;k=0;break;default:k=x[L++]=M}g=i(n?x.subarray(0,_):x.slice(0,_)),v=i(n?x.subarray(_):x.slice(_)),this.j(g,v);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var u,c,h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=n?new Uint16Array(h):h,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],p=n?new Uint16Array(f):f,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],g=n?new Uint8Array(m):m,v=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],y=n?new Uint16Array(v):v,_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=n?new Uint8Array(_):_,E=new(n?Uint8Array:Array)(288);for(u=0,c=E.length;u<c;++u)E[u]=143>=u?8:255>=u?9:279>=u?7:8;var w,x,T=i(E),M=new(n?Uint8Array:Array)(30);for(w=0,x=M.length;w<x;++w)M[w]=5;var S=i(M);function A(e,t){for(var r,n=e.f,i=e.d,a=e.input,o=e.a,s=a.length;i<t;){if(o>=s)throw Error("input buffer is broken");n|=a[o++]<<i,i+=8}return r=n&(1<<t)-1,e.f=n>>>t,e.d=i-t,e.a=o,r}function R(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.a,l=o.length,u=t[0],c=t[1];a<c&&!(s>=l);)i|=o[s++]<<a,a+=8;if((n=(r=u[i&(1<<c)-1])>>>16)>a)throw Error("invalid code length: "+n);return e.f=i>>n,e.d=a-n,e.a=s,65535&r}function k(e,t){var r,n;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),r=e[this.a++],n=e[this.a++],15&r){case P:this.method=P;break;default:throw Error("unsupported compression method")}if(0!=((r<<8)+n)%31)throw Error("invalid fcheck flag:"+((r<<8)+n)%31);if(32&n)throw Error("fdict flag is not supported");this.q=new a(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}a.prototype.j=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length-258;256!==(i=R(this,e));)if(256>i)n>=l&&(this.b=n,r=this.e(),n=this.b),r[n++]=i;else for(s=p[a=i-257],0<g[a]&&(s+=A(this,g[a])),i=R(this,t),o=y[i],0<b[i]&&(o+=A(this,b[i])),n>=l&&(this.b=n,r=this.e(),n=this.b);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.w=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length;256!==(i=R(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=p[a=i-257],0<g[a]&&(s+=A(this,g[a])),i=R(this,t),o=y[i],0<b[i]&&(o+=A(this,b[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.e=function(){var e,t,r=new(n?Uint8Array:Array)(this.b-32768),i=this.b-32768,a=this.c;if(n)r.set(a.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=a[e+32768];if(this.g.push(r),this.l+=r.length,n)a.set(a.subarray(i,i+32768));else for(e=0;32768>e;++e)a[e]=a[i+e];return this.b=32768,a},a.prototype.z=function(e){var t,r,i,a=this.input.length/this.a+1|0,o=this.input,s=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),2>a?r=(i=(o.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+i:s.length<<1:r=s.length*a,n?(t=new Uint8Array(r)).set(s):t=s,this.c=t},a.prototype.n=function(){var e,t,r,i,a,o=0,s=this.c,l=this.g,u=new(n?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return n?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,r=l.length;t<r;++t)for(i=0,a=(e=l[t]).length;i<a;++i)u[o++]=e[i];for(t=32768,r=this.b;t<r;++t)u[o++]=s[t];return this.g=[],this.buffer=u},a.prototype.v=function(){var e,t=this.b;return n?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},k.prototype.k=function(){var e,t,r=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;var n=e;if("string"==typeof n){var i,a,o=n.split("");for(i=0,a=o.length;i<a;i++)o[i]=(255&o[i].charCodeAt(0))>>>0;n=o}for(var s,l=1,u=0,c=n.length,h=0;0<c;){c-=s=1024<c?1024:c;do{u+=l+=n[h++]}while(--s);l%=65521,u%=65521}if(t!==(u<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return e};var P=8;r("Zlib.Inflate",k),r("Zlib.Inflate.prototype.decompress",k.prototype.k);var L,C,I,H,O={ADAPTIVE:l.s,BLOCK:l.t};if(Object.keys)L=Object.keys(O);else for(C in L=[],I=0,O)L[I++]=C;for(I=0,H=L.length;I<H;++I)r("Zlib.Inflate.BufferType."+(C=L[I]),O[C])}).call(this)},function(e,t,r){"use strict";t.compareCoord=new Function("ra","rb",["for(var i=2;i>=0;--i) {","var d=ra[i]-rb[i];","if(d){return d;}","}","return 0;"].join("\n")),t.saturateAbs=new Function("x",["if(x >= 0.0) {","if(x <= 1.0) {","return x;","}","} else if(x >= -1.0) {","return -x;","}","return 1.0;"].join("\n")),t.EPSILON=1e-6,t.POSITIVE_INFINITY=1<<30,t.NEGATIVE_INFINITY=-(1<<30)},function(e,t,r){"use strict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1||!e)},t.log2=function(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=n,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var i=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(i),t.reverse=function(e){return i[255&e]<<24|i[e>>>8&255]<<16|i[e>>>16&255]<<8|i[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,r){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},function(e,t){t.vertexNormals=function(e,t,r){for(var n=t.length,i=new Array(n),a=void 0===r?1e-6:r,o=0;o<n;++o)i[o]=[0,0,0];for(o=0;o<e.length;++o)for(var s=e[o],l=0,u=s[s.length-1],c=s[0],h=0;h<s.length;++h){l=u,u=c,c=s[(h+1)%s.length];for(var d=t[l],f=t[u],p=t[c],m=new Array(3),g=0,v=new Array(3),y=0,_=0;_<3;++_)m[_]=d[_]-f[_],g+=m[_]*m[_],v[_]=p[_]-f[_],y+=v[_]*v[_];if(g*y>a){var b=i[u],E=1/Math.sqrt(g*y);for(_=0;_<3;++_){var w=(_+1)%3,x=(_+2)%3;b[_]+=E*(v[w]*m[x]-v[x]*m[w])}}}for(o=0;o<n;++o){b=i[o];var T=0;for(_=0;_<3;++_)T+=b[_]*b[_];if(T>a)for(E=1/Math.sqrt(T),_=0;_<3;++_)b[_]*=E;else for(_=0;_<3;++_)b[_]=0}return i},t.faceNormals=function(e,t,r){for(var n=e.length,i=new Array(n),a=void 0===r?1e-6:r,o=0;o<n;++o){for(var s=e[o],l=new Array(3),u=0;u<3;++u)l[u]=t[s[u]];var c=new Array(3),h=new Array(3);for(u=0;u<3;++u)c[u]=l[1][u]-l[0][u],h[u]=l[2][u]-l[0][u];var d=new Array(3),f=0;for(u=0;u<3;++u){var p=(u+1)%3,m=(u+2)%3;d[u]=c[p]*h[m]-c[m]*h[p],f+=d[u]*d[u]}f=f>a?1/Math.sqrt(f):0;for(u=0;u<3;++u)d[u]*=f;i[o]=d}return i},t.angleNormals=function(e,t){function r(e,t,r){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(r,2))}function n(e,t,r){return Math.atan2(t,e-r)}function i(e,t,r,n,i){e[0]+=t*r,e[1]+=t*n,e[2]+=t*i}for(var a=t.length,o=e.length,s=new Array(a),l=0;l<a;++l)s[l]=[0,0,0];for(l=0;l<o;++l){var u=e[l],c=t[u[0]],h=t[u[1]],d=t[u[2]],f=c[0]-h[0],p=c[1]-h[1],m=c[2]-h[2],g=r(f,p,m),v=h[0]-d[0],y=h[1]-d[1],_=h[2]-d[2],b=r(v,y,_),E=r(d[0]-c[0],d[1]-c[1],d[2]-c[2]);if(!(Math.min(g,b,E)<1e-6)){var w=.5*(g+b+E),x=Math.sqrt((w-g)*(w-b)*(w-E)/w),T=p*_-m*y,M=m*v-f*_,S=f*y-p*v,A=r(T,M,S);T/=A,M/=A,S/=A,i(s[u[0]],n(w,x,b),T,M,S),i(s[u[1]],n(w,x,E),T,M,S),i(s[u[2]],n(w,x,g),T,M,S)}}for(l=0;l<a;++l){var R=s[l],k=Math.sqrt(Math.pow(R[0],2)+Math.pow(R[1],2)+Math.pow(R[2],2));k<1e-8?(R[0]=1,R[1]=0,R[2]=0):(R[0]/=k,R[1]/=k,R[2]/=k)}return s}},function(e,t,r){"use strict";e.exports=function(e,t){switch(void 0===t&&(t=0),typeof e){case"number":if(e>0)return function(e,t){var r,n;for(r=new Array(e),n=0;n<e;++n)r[n]=t;return r}(0|e,t);break;case"object":if("number"==typeof e.length)return function e(t,r,n){var i=0|t[n];if(i<=0)return[];var a,o=new Array(i);if(n===t.length-1)for(a=0;a<i;++a)o[a]=r;else for(a=0;a<i;++a)o[a]=e(t,r,n+1);return o}(e,t,0)}return[]}},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!c){var e=s(d);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.Utils=n.lossless.Utils||{},n.lossless.Utils.createArray=function(e){var t=new Array(e||0),r=e;if(arguments.length>1)for(var i=Array.prototype.slice.call(arguments,1);r--;)t[e-1-r]=n.lossless.Utils.createArray.apply(this,i);return t},n.lossless.Utils.makeCRCTable=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},n.lossless.Utils.crc32=function(e){for(var t=new Uint8Array(e.buffer),r=n.lossless.Utils.crcTable||(n.lossless.Utils.crcTable=n.lossless.Utils.makeCRCTable()),i=-1,a=0;a<t.length;a++)i=i>>>8^r[255&(i^t[a])];return(-1^i)>>>0},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.Utils)},function(e,t,r){e.exports=function(){"use strict";var e=Math.pow(2,-52),t=function(t){var o=t.length>>1;if(o>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;var s=2*o-5,l=this.triangles=new Uint32Array(3*s),u=this.halfedges=new Int32Array(3*s);this._hashSize=Math.ceil(Math.sqrt(o));for(var c=this.hullPrev=new Uint32Array(o),h=this.hullNext=new Uint32Array(o),d=this.hullTri=new Uint32Array(o),f=new Int32Array(this._hashSize).fill(-1),p=new Uint32Array(o),m=1/0,g=1/0,v=-1/0,y=-1/0,_=0;_<o;_++){var b=t[2*_],E=t[2*_+1];b<m&&(m=b),E<g&&(g=E),b>v&&(v=b),E>y&&(y=E),p[_]=_}for(var w,x,T,M=(m+v)/2,S=(g+y)/2,A=1/0,R=0;R<o;R++){var k=r(M,S,t[2*R],t[2*R+1]);k<A&&(w=R,A=k)}var P=t[2*w],L=t[2*w+1];A=1/0;for(var C=0;C<o;C++)if(C!==w){var I=r(P,L,t[2*C],t[2*C+1]);I<A&&I>0&&(x=C,A=I)}for(var H=t[2*x],O=t[2*x+1],D=1/0,F=0;F<o;F++)if(F!==w&&F!==x){var N=i(P,L,H,O,t[2*F],t[2*F+1]);N<D&&(T=F,D=N)}var U=t[2*T],B=t[2*T+1];if(D===1/0)throw new Error("No Delaunay triangulation exists for this input.");if(n(P,L,H,O,U,B)){var z=x,j=H,V=O;x=T,H=U,O=B,T=z,U=j,B=V}var G=function(e,t,r,n,i,a){var o=r-e,s=n-t,l=i-e,u=a-t,c=o*o+s*s,h=l*l+u*u,d=.5/(o*u-s*l);return{x:e+(u*c-s*h)*d,y:t+(o*h-l*c)*d}}(P,L,H,O,U,B);this._cx=G.x,this._cy=G.y;for(var W=new Float64Array(o),X=0;X<o;X++)W[X]=r(t[2*X],t[2*X+1],G.x,G.y);!function e(t,r,n,i){if(i-n<=20)for(var o=n+1;o<=i;o++){for(var s=t[o],l=r[s],u=o-1;u>=n&&r[t[u]]>l;)t[u+1]=t[u--];t[u+1]=s}else{var c=n+1,h=i;a(t,n+i>>1,c),r[t[n]]>r[t[i]]&&a(t,n,i),r[t[c]]>r[t[i]]&&a(t,c,i),r[t[n]]>r[t[c]]&&a(t,n,c);for(var d=t[c],f=r[d];;){do{c++}while(r[t[c]]<f);do{h--}while(r[t[h]]>f);if(h<c)break;a(t,c,h)}t[n+1]=t[h],t[h]=d,i-c+1>=h-n?(e(t,r,c,i),e(t,r,n,h-1)):(e(t,r,n,h-1),e(t,r,c,i))}}(p,W,0,o-1),this.hullStart=w;var Y=3;h[w]=c[T]=x,h[x]=c[w]=T,h[T]=c[x]=w,d[w]=0,d[x]=1,d[T]=2,f[this._hashKey(P,L)]=w,f[this._hashKey(H,O)]=x,f[this._hashKey(U,B)]=T,this.trianglesLen=0,this._addTriangle(w,x,T,-1,-1,-1);for(var q=0,Z=void 0,K=void 0;q<p.length;q++){var Q=p[q],J=t[2*Q],$=t[2*Q+1];if(!(q>0&&Math.abs(J-Z)<=e&&Math.abs($-K)<=e)&&(Z=J,K=$,Q!==w&&Q!==x&&Q!==T)){for(var ee=0,te=0,re=this._hashKey(J,$);te<this._hashSize&&(-1===(ee=f[(re+te)%this._hashSize])||ee===h[ee]);te++);for(var ne=ee=c[ee],ie=void 0;ie=h[ne],!n(J,$,t[2*ne],t[2*ne+1],t[2*ie],t[2*ie+1]);)if((ne=ie)===ee){ne=-1;break}if(-1!==ne){var ae=this._addTriangle(ne,Q,h[ne],-1,-1,d[ne]);d[Q]=this._legalize(ae+2),d[ne]=ae,Y++;for(var oe=h[ne];ie=h[oe],n(J,$,t[2*oe],t[2*oe+1],t[2*ie],t[2*ie+1]);)ae=this._addTriangle(oe,Q,ie,d[Q],-1,d[oe]),d[Q]=this._legalize(ae+2),h[oe]=oe,Y--,oe=ie;if(ne===ee)for(;n(J,$,t[2*(ie=c[ne])],t[2*ie+1],t[2*ne],t[2*ne+1]);)ae=this._addTriangle(ie,Q,ne,-1,d[ne],d[ie]),this._legalize(ae+2),d[ie]=ae,h[ne]=ne,Y--,ne=ie;this.hullStart=c[Q]=ne,h[ne]=c[oe]=Q,h[Q]=oe,f[this._hashKey(J,$)]=Q,f[this._hashKey(t[2*ne],t[2*ne+1])]=ne}}}this.hull=new Uint32Array(Y);for(var se=0,le=this.hullStart;se<Y;se++)this.hull[se]=le,le=h[le];this.hullPrev=this.hullNext=this.hullTri=null,this.triangles=l.subarray(0,this.trianglesLen),this.halfedges=u.subarray(0,this.trianglesLen)};function r(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}function n(e,t,r,n,i,a){return(n-t)*(i-r)-(r-e)*(a-n)<0}function i(e,t,r,n,i,a){var o=r-e,s=n-t,l=i-e,u=a-t,c=o*o+s*s,h=l*l+u*u,d=.5/(o*u-s*l),f=(u*c-s*h)*d,p=(o*h-l*c)*d;return f*f+p*p}function a(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function o(e){return e[0]}function s(e){return e[1]}return t.from=function(e,r,n){void 0===r&&(r=o),void 0===n&&(n=s);for(var i=e.length,a=new Float64Array(2*i),l=0;l<i;l++){var u=e[l];a[2*l]=r(u),a[2*l+1]=n(u)}return new t(a)},t.prototype._hashKey=function(e,t){return Math.floor((r=e-this._cx,n=t-this._cy,i=r/(Math.abs(r)+Math.abs(n)),(n>0?3-i:1+i)/4*this._hashSize))%this._hashSize;var r,n,i},t.prototype._legalize=function(e){var t=this.triangles,r=this.coords,n=this.halfedges,i=n[e],a=e-e%3,o=i-i%3,s=a+(e+1)%3,l=a+(e+2)%3,u=o+(i+2)%3;if(-1===i)return l;var c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S=t[l],A=t[e],R=t[s],k=t[u];if(c=r[2*S],h=r[2*S+1],d=r[2*A],f=r[2*A+1],p=r[2*R],m=r[2*R+1],(y=c-(g=r[2*k]))*((E=f-(v=r[2*k+1]))*(M=(w=p-g)*w+(x=m-v)*x)-(T=(b=d-g)*b+E*E)*x)-(_=h-v)*(b*M-T*w)+(y*y+_*_)*(b*x-E*w)<0){t[e]=k,t[i]=S;var P=n[u];if(-1===P){var L=this.hullStart;do{if(this.hullTri[L]===u){this.hullTri[L]=e;break}L=this.hullNext[L]}while(L!==this.hullStart)}this._link(e,P),this._link(i,n[l]),this._link(l,u);var C=o+(i+1)%3;return this._legalize(e),this._legalize(C)}return l},t.prototype._link=function(e,t){this.halfedges[e]=t,-1!==t&&(this.halfedges[t]=e)},t.prototype._addTriangle=function(e,t,r,n,i,a){var o=this.trianglesLen;return this.triangles[o]=e,this.triangles[o+1]=t,this.triangles[o+2]=r,this._link(o,n),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o},t}()},function(e,t,r){"use strict";var n=n||{};n.NIFTI1=n.NIFTI1||r(60),n.NIFTI2=n.NIFTI2||r(218),n.Utils=n.Utils||r(31);var i=i||r(26);n.isNIFTI1=function(e){var t,r,i,a;return!(e.byteLength<n.NIFTI1.STANDARD_HEADER_SIZE)&&((t=new DataView(e))&&(r=t.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION)),i=t.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(r!==n.NIFTI1.MAGIC_NUMBER[0]||i!==n.NIFTI1.MAGIC_NUMBER[1]||a!==n.NIFTI1.MAGIC_NUMBER[2]))},n.isNIFTI2=function(e){var t,r,i,a;return!(e.byteLength<n.NIFTI1.STANDARD_HEADER_SIZE)&&(r=(t=new DataView(e)).getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION),i=t.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(r!==n.NIFTI2.MAGIC_NUMBER[0]||i!==n.NIFTI2.MAGIC_NUMBER[1]||a!==n.NIFTI2.MAGIC_NUMBER[2]))},n.isNIFTI=function(e){return n.isNIFTI1(e)||n.isNIFTI2(e)},n.isCompressed=function(e){var t,r,i;if(e){if(r=(t=new DataView(e)).getUint8(0),i=t.getUint8(1),r===n.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(i===n.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},n.decompress=function(e){return i.inflate(e).buffer},n.readHeader=function(e){var t=null;return n.isCompressed(e)&&(e=n.decompress(e)),n.isNIFTI1(e)?t=new n.NIFTI1:n.isNIFTI2(e)&&(t=new n.NIFTI2),t?t.readHeader(e):console.error("That file does not appear to be NIFTI!"),t},n.hasExtension=function(e){return 0!=e.extensionFlag[0]},n.readImage=function(e,t){var r=e.vox_offset,n=1,i=1;e.dims[4]&&(n=e.dims[4]),e.dims[5]&&(i=e.dims[5]);var a=e.dims[1]*e.dims[2]*e.dims[3]*n*i*(e.numBitsPerVoxel/8);return t.slice(r,r+a)},n.readExtension=function(e,t){var r=e.getExtensionLocation(),n=e.extensionSize;return t.slice(r,r+n)},n.readExtensionData=function(e,t){var r=e.getExtensionLocation(),n=e.extensionSize;return t.slice(r+8,r+n-8)},"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";(function(e){var n=r(91),i=r(92),a=r(93);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,r);case"utf8":case"utf-8":return S(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return R(this,t,r);case"base64":return M(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=r;a<s;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return-1}function _(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function b(e,t,r,n){return j(B(t,e.length-r),e,r,n)}function E(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return E(e,t,r,n)}function x(e,t,r,n){return j(z(t),e,r,n)}function T(e,t,r,n){return j(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function M(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function S(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return u(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return c(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(n,i),c=e.slice(t,r),h=0;h<s;++h)if(u[h]!==c[h]){a=u[h],o=c[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return E(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return x(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function k(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=U(e[a]);return i}function P(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function I(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function H(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function O(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,n,a){return a||O(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function F(e,t,r,n,a){return a||O(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):H(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):H(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:B(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function z(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(5))},function(e,t,r){"use strict";var n=r(22),i=r(39),a=r(40),o=r(163);function s(e,t){for(var r=new Array(e.length-1),n=1;n<e.length;++n)for(var i=r[n-1]=new Array(e.length-1),a=0,o=0;a<e.length;++a)a!==t&&(i[o++]=e[n][a]);return r}function l(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var t=e.length>>1;return["sum(",l(e.slice(0,t)),",",l(e.slice(t)),")"].join("")}function u(e){if(2===e.length)return[["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("")];for(var t=[],r=0;r<e.length;++r)t.push(["scale(",l(u(s(e,r))),",",(n=r,1&n?"-":""),e[0][r],")"].join(""));return t;var n}function c(e){for(var t=[],r=[],c=function(e){for(var t=new Array(e),r=0;r<e;++r){t[r]=new Array(e);for(var n=0;n<e;++n)t[r][n]=["m",n,"[",e-r-1,"]"].join("")}return t}(e),h=[],d=0;d<e;++d)0==(1&d)?t.push.apply(t,u(s(c,d))):r.push.apply(r,u(s(c,d))),h.push("m"+d);var f=l(t),p=l(r),m="orientation"+e+"Exact",g=["function ",m,"(",h.join(),"){var p=",f,",n=",p,",d=sub(p,n);return d[d.length-1];};return ",m].join("");return new Function("sum","prod","scale","sub",g)(i,n,a,o)}var h=c(3),d=c(4),f=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,r){var n,i=(e[1]-r[1])*(t[0]-r[0]),a=(e[0]-r[0])*(t[1]-r[1]),o=i-a;if(i>0){if(a<=0)return o;n=i+a}else{if(!(i<0))return o;if(a>=0)return o;n=-(i+a)}var s=33306690738754716e-32*n;return o>=s||o<=-s?o:h(e,t,r)},function(e,t,r,n){var i=e[0]-n[0],a=t[0]-n[0],o=r[0]-n[0],s=e[1]-n[1],l=t[1]-n[1],u=r[1]-n[1],c=e[2]-n[2],h=t[2]-n[2],f=r[2]-n[2],p=a*u,m=o*l,g=o*s,v=i*u,y=i*l,_=a*s,b=c*(p-m)+h*(g-v)+f*(y-_),E=7771561172376103e-31*((Math.abs(p)+Math.abs(m))*Math.abs(c)+(Math.abs(g)+Math.abs(v))*Math.abs(h)+(Math.abs(y)+Math.abs(_))*Math.abs(f));return b>E||-b>E?b:d(e,t,r,n)}];function p(e){var t=f[e.length];return t||(t=f[e.length]=c(e.length)),t.apply(void 0,e)}!function(){for(;f.length<=5;)f.push(c(f.length));for(var t=[],r=["slow"],n=0;n<=5;++n)t.push("a"+n),r.push("o"+n);var i=["function getOrientation(",t.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(n=2;n<=5;++n)i.push("case ",n,":return o",n,"(",t.slice(0,n).join(),");");i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),r.push(i.join(""));var a=Function.apply(void 0,r);for(e.exports=a.apply(void 0,[p].concat(f)),n=0;n<=5;++n)e.exports[n]=f[n]}()},function(e,t,r){"use strict";e.exports=function(e,t,r){var i=e*t,a=n*e,o=a-(a-e),s=e-o,l=n*t,u=l-(l-t),c=t-u,h=s*c-(i-o*u-s*u-o*c);if(r)return r[0]=h,r[1]=i,r;return[h,i]};var n=+(Math.pow(2,27)+1)},function(e,t){function r(e){var t=1023&e;return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&(t|t<<16))|t<<8))|t<<4))|t<<2)}function n(e,t,n){return r(e)|r(t)<<1|r(n)<<2}function i(e,t){this.coeffs=e,this.children=t}function a(e,t,r,n){this.bounds=e,this.coeff=t,this.root=r,this.depth=n}function o(){return new i([0,0,0,0,0,0,0],[null,null,null,null,null,null,null,null])}var s={HaarNode:i,HaarTree:a,createEmptyNode:o,createEmptyTree:function(e,t){return new a(e,0,o(),t)}};function l(e,t,r,i,a){var o=30-a,s=this.x=t<<o,l=this.y=r<<o,u=this.z=i<<o;this.c0=n(s>>20,l>>20,u>>20),this.c1=n(s>>10,l>>10,u>>10),this.c2=n(s,l,u),this.w=e,this.l=a}var u=[];function c(e){!function e(t,r,n,i,a,o){if(t)for(var s=t.coeffs,c=s[0],h=s[1],d=s[2],f=s[3],p=s[4],m=s[5],g=s[6],v=t.children,y=n<<1,_=i<<1,b=a<<1,E=0,w=0;w<2;++w)for(var x=0;x<2;++x)for(var T=0;T<2;++T,++E){var M=1-2*T,S=1-2*x,A=1-2*w,R=M*c+S*h+M*S*d+A*f+M*A*p+S*A*m+M*S*A*g;e(v[E],r+R,y+T,_+x,b+w,o+1)}else u.push(new l(r,n,i,a,o))}(e.root,e.coeff,0,0,0,0);var t=u.slice();return u.length=0,t}var h=32;function d(e,t,r,n){this.c0=e,this.c1=t,this.c2=r,this.children=n}function f(e,t){this.root=e,this.cells=t}function p(e,t){return Math.floor((t-e)/33)}function m(e){return 0|Math.min(Math.max(e,0),(1<<30)-1)}var g={create:function(e){return new f(function t(r,n){if(n-r<=h)return null;for(var i=p(r,n),a=new Array(h),o=new Array(h),s=new Array(h),l=new Array(33),u=0;u<h;++u){var c=r+i*u,f=r+i*(u+1),m=e[f];a[u]=m.c0,o[u]=m.c1,s[u]=m.c2,l[u]=t(c,f)}return l[h]=t(r+i*h,n),new d(a,o,s,l)}(0,e.length),e)},search:function(e,t,r,i){for(var a=m(t),o=m(r),s=m(i),l=n(a>>20,o>>20,s>>20),u=n(a>>10,o>>10,s>>10),c=n(a,o,s),d=e.cells,f=0,g=d.length,v=e.root;v;){var y,_=p(f,g),b=v.c0,E=v.c1,w=v.c2,x=v.children;for(y=0;y<h;++y){if((b[y]-l||E[y]-u||w[y]-c)>0)break}y<h&&(g=f+(y+1)*_),f+=y*_,v=x[y]}for(var T=f+1;T<g;++T){var M=d[T],S=1<<30-M.l;if(M.x<=a&&a<M.x+S&&M.y<=o&&o<M.y+S&&M.z<=s&&s<M.z+S)return T}return f}};function v(e,t){var r,n=t||{};if(!e||!e.length)throw new Error("haar-rasterize: must specify positions");var i=(r="bounds"in n?function(e){var t=.5*Math.max(e[1][0]-e[0][0],e[1][1]-e[0][1],e[1][2]-e[0][2]),r=.5*(e[0][0]+e[1][0]),n=.5*(e[0][1]+e[1][1]),i=.5*(e[0][2]+e[1][2]);return[[r-t,n-t,i-t],[r+t,n+t,i+t]]}(n.bounds):function(e){var t,r=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(t=0;t<e.length;++t)for(var i=e[t],a=0;a<3;++a)r[a]=Math.min(i[a],r[a]),n[a]=Math.max(i[a],n[a]);var o=Math.max(n[0]-r[0],n[1]-r[1],n[2]-r[2]);for(t=0;t<3;++t){var s=.5*(r[t]+n[t]);r[t]=s-o,n[t]=s+o}return[r,n]}(e))[1][0]-r[0][0],a=0|n.depth;if(a||(a=n.resolution?Math.ceil(Math.log2(i/n.resolution)):8),!a)throw new Error("haar-rasterize: invalid depth");return s.createEmptyTree(r,a)}function y(e,t,r){this.tree=e,this.bounds=t,this.depth=r}var o=s.createEmptyNode,_=[];var b=[];function E(e,t,r){if(t<=e+6)return _.length;var n,i,a,o;b.length=0;for(var s=_.length,l=e,u=t-3;l<t;l+=3){var c=_[l+r],h=_[u+r];if(c<=.5!=h<=.5){for(((i=(.5-h)/(c-h))<0||i>1)&&(i=.5),a=1-i,n=0;n<3;++n)o=a*_[u+n]+i*_[l+n],_.push(o),b.push(o);_[_.length-3+r]=1,b[b.length-3+r]=0}if(c<.5){for(n=0;n<3;++n)_.push(_[l+n]);_[_.length-3+r]=2*c}else if(c>.5){for(n=0;n<3;++n)b.push(_[l+n]);b[b.length-3+r]=2*(c-.5)}else{for(n=0;n<3;++n)_.push(_[l+n]),b.push(_[l+n]);_[_.length-3+r]=1,b[b.length-3+r]=0}u=l}var d=_.length;if(s>=d+6&&(d=_.length=s),b.length>6)for(var f=0;f<b.length;++f)_.push(b[f]);return d}function w(e,t,r,n){if(r[0]=r[1]=r[2]=n[0]=n[1]=n[2]=0,!(e>=t)){for(var i=_[e],a=_[e+1],o=_[e+2],s=e+6;s<t;s+=3){var l=_[s-3],u=_[s-2],c=_[s-1],h=_[s],d=_[s+1],f=_[s+2],p=l-i,m=u-a,g=c-o,v=h-i,y=d-a,b=f-o,E=m*b-g*y,w=g*v-p*b,x=p*y-m*v,T=i+l+h,M=a+u+d,S=o+c+f;r[0]+=E,r[1]+=w,r[2]+=x,n[0]+=T*E,n[1]+=M*w,n[2]+=S*x}for(var A=0;A<3;++A)r[A]/=16,n[A]/=48}}var x=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],T=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];function M(e,t,r,n){var i=_.length,a=E(t,r,0),s=_.length,l=_.length,u=E(i,a,1),c=_.length,h=_.length,d=E(a,s,1),f=_.length,p=_.length,m=E(l,u,2),g=_.length,v=_.length,y=E(u,c,2),b=_.length,S=_.length,A=E(h,d,2),R=_.length,k=_.length,P=E(d,f,2),L=_.length;w(p,m,x[0],T[0]),w(S,A,x[1],T[1]),w(v,y,x[2],T[2]),w(k,P,x[3],T[3]),w(m,g,x[4],T[4]),w(A,R,x[5],T[5]),w(y,b,x[6],T[6]),w(P,L,x[7],T[7]);var C=x,I=T,H=e.coeffs;if(H[0]+=I[0][0]+C[1][0]-I[1][0]+I[2][0]+C[3][0]-I[3][0]+I[4][0]+C[5][0]-I[5][0]+I[6][0]+C[7][0]-I[7][0],H[1]+=I[0][1]+I[1][1]+C[2][1]-I[2][1]+C[3][1]-I[3][1]+I[4][1]+I[5][1]+C[6][1]-I[6][1]+C[7][1]-I[7][1],H[2]+=.5*(I[0][0]+I[0][1]+C[1][0]-I[1][0]-I[1][1]-I[2][0]+C[2][1]-I[2][1]+I[3][0]-C[3][0]+I[3][1]-C[3][1]+I[4][0]+I[4][1]+C[5][0]-I[5][0]-I[5][1]-I[6][0]+C[6][1]-I[6][1]+I[7][0]-C[7][0]+I[7][1]-C[7][1]),H[3]+=I[0][2]+I[1][2]+I[2][2]+I[3][2]+C[4][2]-I[4][2]+C[5][2]-I[5][2]+C[6][2]-I[6][2]+C[7][2]-I[7][2],H[4]+=.5*(I[0][0]+I[0][2]+C[1][0]-I[1][0]-I[1][2]+I[2][0]+I[2][2]+C[3][0]-I[3][0]-I[3][2]-I[4][0]+C[4][2]-I[4][2]+I[5][0]-C[5][0]+I[5][2]-C[5][2]-I[6][0]+C[6][2]-I[6][2]+I[7][0]-C[7][0]+I[7][2]-C[7][2]),H[5]+=.5*(I[0][1]+I[0][2]+I[1][1]+I[1][2]+C[2][1]-I[2][1]-I[2][2]+C[3][1]-I[3][1]-I[3][2]-I[4][1]+C[4][2]-I[4][2]-I[5][1]+C[5][2]-I[5][2]+I[6][1]-C[6][1]+I[6][2]-C[6][2]+I[7][1]-C[7][1]+I[7][2]-C[7][2]),H[6]+=1/3*(I[0][0]+I[0][1]+I[0][2]+C[1][0]-I[1][0]-I[1][1]-I[1][2]-I[2][0]+C[2][1]-I[2][1]-I[2][2]+I[3][0]-C[3][0]+I[3][1]-C[3][1]+I[3][2]+-I[4][0]-I[4][1]+C[4][2]-I[4][2]+I[5][0]-C[5][0]+I[5][1]+I[5][2]-C[5][2]+I[6][0]+I[6][1]-C[6][1]+I[6][2]-C[6][2]+C[7][0]-I[7][0]+C[7][1]-I[7][1]+C[7][2]-I[7][2]),n>1){var O=e.children;p<m&&M(O[0]||(O[0]=o()),p,m,n-1),S<A&&M(O[1]||(O[1]=o()),S,A,n-1),v<y&&M(O[2]||(O[2]=o()),v,y,n-1),k<P&&M(O[3]||(O[3]=o()),k,P,n-1),m<g&&M(O[4]||(O[4]=o()),m,g,n-1),A<R&&M(O[5]||(O[5]=o()),A,R,n-1),y<b&&M(O[6]||(O[6]=o()),y,b,n-1),P<L&&M(O[7]||(O[7]=o()),P,L,n-1)}_.length=i}t.rasterize=function(e,t,r){if(!e)throw new Error("haar-rasterize-cells: missing cells");var n=v(t,r);return function(e,t,r,n){var i,a,o,s,l,u,c,h,d,f,p,m,g=e.bounds,v=g[0],y=g[1][0]-v[0];for(i=0;i<t.length;++i){var b=t[i];if(3===b.length){for(_.length=0,a=0;a<3;++a){var E=r[b[a]];for(o=0;o<3;++o)_.push((E[o]-v[o])/y)}e.coeff+=(s=void 0,l=void 0,u=void 0,c=void 0,h=void 0,d=void 0,f=void 0,p=void 0,m=void 0,s=_[0],l=_[1],u=_[2],c=_[3],h=_[4],d=_[5],f=_[6],p=_[7],m=_[8],(s*(h*m-d*p)+l*(d*f-c*m)+u*(c*p-h*f))/6),M(e.root,0,9,n)}}}(n,e,t,n.depth),function(e){var t=c(e);return new y(g.create(t),e.bounds,e.depth)}(n)},t.sample=function(e,t,r,n){var i=e.bounds,a=i[0][0],o=i[0][1],s=i[0][2],l=i[1][0],u=i[1][1],c=i[1][2],h=0|Math.round((t-a)/(l-a)*(1<<30)),d=0|Math.round((r-o)/(u-o)*(1<<30)),f=0|Math.round((n-s)/(c-s)*(1<<30)),p=g.search(e.tree,h,d,f);return p?p.w:0};var S=g.search;function A(e,t){this.opp=e,this.idx=t}function R(e,t,r,n,i,a,o){for(var s=a.adj,l=0;l<s.length;++l)if(s[l].opp===o)return s[l].idx;var u=e.length;a.adj.push(new A(o,u)),o.adj.push(new A(a,u));var c=a.w,h=o.w,d=-h/(c-h),f=1-d;return e.push([(f*o.x+d*a.x)*t+r,(f*o.y+d*a.y)*t+n,(f*o.z+d*a.z)*t+i]),u}function k(e,t,r,n){this.x=e,this.y=t,this.z=r,this.w=0,this.l=n,this.adj=[],this.steiner=[]}function P(e,t,r,n){for(var i=0,a=e.length-1;i<a;){var o=i+a>>1,s=e[o],l=s.x-t||s.y-r||s.z-n;if(l>0)a=o-1;else{if(!(l<0))return s;i=o+1}}var u=e[i];return u.x===t&&u.y===r&&u.z===n?u:null}function L(e,t,r,n,i){for(var a=(t.x>>1)+(r.x>>1),o=(t.y>>1)+(r.y>>1),s=(t.z>>1)+(r.z>>1),l=t.steiner,u=0;u<l.length;++u){var c=l[u];if(c.x===a&&c.y===o&&c.z===s)return c}var h=new k(a,o,s,t.l);return h.w=O(e,a,o,s,i)-n,t.steiner.push(h),r.steiner.push(h),h}function C(e,t,r,n,i,a,o){for(var s=0|Math.floor(.25*(t.x+r.x+n.x+i.x)),l=0|Math.floor(.25*(t.y+r.y+n.y+i.y)),u=0|Math.floor(.25*(t.z+r.z+n.z+i.z)),c=t.steiner,h=0;h<c.length;++h){var d=c[h];if(d.x===s&&d.y===l&&d.z===u)return d}var f=new k(s,l,u,t.l);return f.w=.5*(a+o),t.steiner.push(f),r.steiner.push(f),n.steiner.push(f),i.steiner.push(f),f}function I(e,t,r,n,i,a,o,s,l,u){var c,h,d,f;switch(o.w<0|(s.w<0)<<1|(l.w<0)<<2|(u.w<0)<<3){case 0:break;case 1:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,o,l),d=R(e,r,n,i,a,o,u),t.push([c,h,d]);break;case 2:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,s,l),d=R(e,r,n,i,a,s,u),t.push([h,c,d]);break;case 3:c=R(e,r,n,i,a,o,l),h=R(e,r,n,i,a,o,u),d=R(e,r,n,i,a,s,l),f=R(e,r,n,i,a,s,u),t.push([d,c,h]),t.push([f,d,h]);break;case 4:c=R(e,r,n,i,a,o,l),h=R(e,r,n,i,a,s,l),d=R(e,r,n,i,a,l,u),t.push([c,h,d]);break;case 5:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,o,u),d=R(e,r,n,i,a,s,l),f=R(e,r,n,i,a,l,u),t.push([c,d,h]),t.push([d,f,h]);break;case 6:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,o,l),d=R(e,r,n,i,a,s,u),f=R(e,r,n,i,a,l,u),t.push([h,c,d]),t.push([f,h,d]);break;case 7:c=R(e,r,n,i,a,o,u),h=R(e,r,n,i,a,s,u),d=R(e,r,n,i,a,l,u),t.push([h,d,c]);break;case 8:c=R(e,r,n,i,a,o,u),h=R(e,r,n,i,a,s,u),d=R(e,r,n,i,a,l,u),t.push([h,c,d]);break;case 9:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,o,l),d=R(e,r,n,i,a,s,u),f=R(e,r,n,i,a,l,u),t.push([d,c,h]),t.push([f,d,h]);break;case 10:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,o,u),d=R(e,r,n,i,a,s,l),f=R(e,r,n,i,a,l,u),t.push([c,h,d]),t.push([h,f,d]);break;case 11:c=R(e,r,n,i,a,o,l),h=R(e,r,n,i,a,s,l),d=R(e,r,n,i,a,l,u),t.push([d,h,c]);break;case 12:c=R(e,r,n,i,a,o,l),h=R(e,r,n,i,a,o,u),d=R(e,r,n,i,a,s,l),f=R(e,r,n,i,a,s,u),t.push([h,c,d]),t.push([f,h,d]);break;case 13:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,s,l),d=R(e,r,n,i,a,s,u),t.push([h,d,c]);break;case 14:c=R(e,r,n,i,a,o,s),h=R(e,r,n,i,a,o,l),d=R(e,r,n,i,a,o,u),t.push([d,h,c])}}function H(e,t,r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v){for(var y=h;y!==d;){for(var _=1<<30-y.l,b=null;!b;)b=P(s,y.x+_*f,y.y+_*p,y.z+_*m),_<<=1;var E=L(e,b,y,g,v);I(t,r,n,i,a,o,c,l,b,E),I(t,r,n,i,a,o,c,l,E,y),I(t,r,n,i,a,o,c,u,y,E),I(t,r,n,i,a,o,c,u,E,b),y=b}}function O(e,t,r,n,i){return function(e,t,r,n){for(var i=0,a=0;a<2;++a)for(var o=0;o<2;++o)for(var s=0;s<2;++s)i+=e.cells[S(e,t-a,r-o,n-s)].w;return i/8}(e,t,r,n)}function D(e,t){return e.x-t.x||e.y-t.y||e.z-t.z}t.contour=function(e,t){var r,n="number"==typeof t?+t:-.5,i=e.tree,a=i.cells,o=(e.depth,0),s=new Array(8*a.length),l=new Array(a.length);for(r=0;r<a.length;++r){var u=a[r],c=u.x,h=u.y,d=u.z,f=u.l,p=1<<30-f;s[o++]=new k(c,h,d,f),s[o++]=new k(c+p,h,d,f),s[o++]=new k(c,h+p,d,f),s[o++]=new k(c+p,h+p,d,f),s[o++]=new k(c,h,d+p,f),s[o++]=new k(c+p,h,d+p,f),s[o++]=new k(c,h+p,d+p,f),s[o++]=new k(c+p,h+p,d+p,f);var m=new k(c+(p>>1),h+(p>>1),d+(p>>1),f);m.w=O(i,m.x,m.y,m.z)-n,l[r]=m}s.sort(D);var g=0;for(r=0;r<s.length;++r){for(var v=s[r].l;r+1<s.length&&0===D(s[r],s[r+1]);)v=Math.max(v,s[++r].l);var y=s[r];s[g++]=y,y.l=v,y.w=O(i,y.x,y.y,y.z)-n}return s.length=g,function(e,t,r,n){for(var i=e.tree,a=1<<30-e.depth,o=e.bounds,s=o[0],l=o[1],u=s[0],c=s[1],h=s[2],d=(l[0]-u)/(1<<30),f=[],p=[],m=i.cells,g=0;g<m.length;++g){var v,y,_,b=r[g],E=m[g],w=E.x,x=E.y,T=E.z,M=E.l,A=1<<30-M,R=null,k=null,L=null,I=null,O=null,D=null,F=null,N=null;m[v=S(i,w-1,x,T)].l<=M&&v!==g&&(R=R||P(t,w,x,T),L=L||P(t,w,x+A,T),O=O||P(t,w,x,T+A),F=F||P(t,w,x+A,T+A),H(i,f,p,d,u,c,h,t,b,y=r[v],_=C(0,R,L,O,F,y.w,b.w),R,L,0,1,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,L,F,0,0,1,n,a),H(i,f,p,d,u,c,h,t,b,y,_,F,O,0,-1,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,O,R,0,0,-1,n,a)),m[v=S(i,w+A,x,T)].l<M&&(k=k||P(t,w+A,x,T),D=D||P(t,w+A,x,T+A),I=I||P(t,w+A,x+A,T),N=N||P(t,w+A,x+A,T+A),H(i,f,p,d,u,c,h,t,b,y=r[v],_=C(0,k,D,I,N,y.w,b.w),k,D,0,0,1,n,a),H(i,f,p,d,u,c,h,t,b,y,_,D,N,0,1,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,N,I,0,0,-1,n,a),H(i,f,p,d,u,c,h,t,b,y,_,I,k,0,-1,0,n,a)),m[v=S(i,w,x-1,T)].l<=M&&v!==g&&(R=R||P(t,w,x,T),O=O||P(t,w,x,T+A),k=k||P(t,w+A,x,T),D=D||P(t,w+A,x,T+A),H(i,f,p,d,u,c,h,t,b,y=r[v],_=C(0,R,O,k,D,y.w,b.w),R,O,0,0,1,n,a),H(i,f,p,d,u,c,h,t,b,y,_,O,D,1,0,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,D,k,0,0,-1,n,a),H(i,f,p,d,u,c,h,t,b,y,_,k,R,-1,0,0,n,a)),m[v=S(i,w,x+A,T)].l<M&&(L=L||P(t,w,x+A,T),I=I||P(t,w+A,x+A,T),F=F||P(t,w,x+A,T+A),N=N||P(t,w+A,x+A,T+A),H(i,f,p,d,u,c,h,t,b,y=r[v],_=C(0,L,I,F,N,y.w,b.w),L,I,1,0,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,I,N,0,0,1,n,a),H(i,f,p,d,u,c,h,t,b,y,_,N,F,-1,0,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,F,L,0,0,-1,n,a)),m[v=S(i,w,x,T-1)].l<=M&&v!==g&&(R=R||P(t,w,x,T),k=k||P(t,w+A,x,T),L=L||P(t,w,x+A,T),I=I||P(t,w+A,x+A,T),H(i,f,p,d,u,c,h,t,b,y=r[v],_=C(0,R,k,L,I,y.w,b.w),R,k,1,0,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,k,I,0,1,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,I,L,-1,0,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,L,R,0,-1,0,n,a)),m[v=S(i,w,x,T+A)].l<M&&(O=O||P(t,w,x,T+A),F=F||P(t,w,x+A,T+A),D=D||P(t,w+A,x,T+A),N=N||P(t,w+A,x+A,T+A),H(i,f,p,d,u,c,h,t,b,y=r[v],_=C(0,O,F,D,N,y.w,b.w),O,F,0,1,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,F,N,1,0,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,N,D,0,-1,0,n,a),H(i,f,p,d,u,c,h,t,b,y,_,D,O,-1,0,0,n,a))}return{positions:f,cells:p}}(e,s,l,n)}},function(e,t,r){"use strict";var n=r(13),i=r(170);function a(e,t){var r=e.length,n=e.length-t.length,i=Math.min;if(n)return n;switch(r){case 0:return 0;case 1:return e[0]-t[0];case 2:return(s=e[0]+e[1]-t[0]-t[1])||i(e[0],e[1])-i(t[0],t[1]);case 3:var a=e[0]+e[1],o=t[0]+t[1];if(s=a+e[2]-(o+t[2]))return s;var s,l=i(e[0],e[1]),u=i(t[0],t[1]);return(s=i(l,e[2])-i(u,t[2]))||i(l+e[2],a)-i(u+t[2],o);default:var c=e.slice(0);c.sort();var h=t.slice(0);h.sort();for(var d=0;d<r;++d)if(n=c[d]-h[d])return n;return 0}}function o(e,t){return a(e[0],t[0])}function s(e,t){if(t){for(var r=e.length,n=new Array(r),i=0;i<r;++i)n[i]=[e[i],t[i]];n.sort(o);for(i=0;i<r;++i)e[i]=n[i][0],t[i]=n[i][1];return e}return e.sort(a),e}function l(e){if(0===e.length)return[];for(var t=1,r=e.length,n=1;n<r;++n){var i=e[n];if(a(i,e[n-1])){if(n===t){t++;continue}e[t++]=i}}return e.length=t,e}function u(e,t){for(var r=0,n=e.length-1,i=-1;r<=n;){var o=r+n>>1,s=a(e[o],t);s<=0?(0===s&&(i=o),r=o+1):s>0&&(n=o-1)}return i}function c(e,t){for(var r=new Array(e.length),i=0,o=r.length;i<o;++i)r[i]=[];for(var s=[],l=(i=0,t.length);i<l;++i)for(var c=t[i],h=c.length,d=1,f=1<<h;d<f;++d){s.length=n.popCount(d);for(var p=0,m=0;m<h;++m)d&1<<m&&(s[p++]=c[m]);var g=u(e,s);if(!(g<0))for(;r[g++].push(i),!(g>=e.length||0!==a(e[g],s)););}return r}function h(e,t){if(t<0)return[];for(var r=[],i=(1<<t+1)-1,a=0;a<e.length;++a)for(var o=e[a],l=i;l<1<<o.length;l=n.nextCombination(l)){for(var u=new Array(t+1),c=0,h=0;h<o.length;++h)l&1<<h&&(u[c++]=o[h]);r.push(u)}return s(r)}t.dimension=function(e){for(var t=0,r=Math.max,n=0,i=e.length;n<i;++n)t=r(t,e[n].length);return t-1},t.countVertices=function(e){for(var t=-1,r=Math.max,n=0,i=e.length;n<i;++n)for(var a=e[n],o=0,s=a.length;o<s;++o)t=r(t,a[o]);return t+1},t.cloneCells=function(e){for(var t=new Array(e.length),r=0,n=e.length;r<n;++r)t[r]=e[r].slice(0);return t},t.compareCells=a,t.normalize=s,t.unique=l,t.findCell=u,t.incidence=c,t.dual=function(e,t){if(!t)return c(l(h(e,0)),e);for(var r=new Array(t),n=0;n<t;++n)r[n]=[];n=0;for(var i=e.length;n<i;++n)for(var a=e[n],o=0,s=a.length;o<s;++o)r[a[o]].push(n);return r},t.explode=function(e){for(var t=[],r=0,n=e.length;r<n;++r)for(var i=e[r],a=0|i.length,o=1,l=1<<a;o<l;++o){for(var u=[],c=0;c<a;++c)o>>>c&1&&u.push(i[c]);t.push(u)}return s(t)},t.skeleton=h,t.boundary=function(e){for(var t=[],r=0,n=e.length;r<n;++r)for(var i=e[r],a=0,o=i.length;a<o;++a){for(var l=new Array(i.length-1),u=0,c=0;u<o;++u)u!==a&&(l[c++]=i[u]);t.push(l)}return s(t)},t.connectedComponents=function(e,t){return t?function(e,t){for(var r=new i(t),n=0;n<e.length;++n)for(var a=e[n],o=0;o<a.length;++o)for(var s=o+1;s<a.length;++s)r.link(a[o],a[s]);var l=[],u=r.ranks;for(n=0;n<u.length;++n)u[n]=-1;for(n=0;n<e.length;++n){var c=r.find(e[n][0]);u[c]<0?(u[c]=l.length,l.push([e[n].slice(0)])):l[u[c]].push(e[n].slice(0))}return l}(e,t):function(e){for(var t=l(s(h(e,0))),r=new i(t.length),n=0;n<e.length;++n)for(var a=e[n],o=0;o<a.length;++o)for(var c=u(t,[a[o]]),d=o+1;d<a.length;++d)r.link(c,u(t,[a[d]]));var f=[],p=r.ranks;for(n=0;n<p.length;++n)p[n]=-1;for(n=0;n<e.length;++n){var m=r.find(u(t,[e[n][0]]));p[m]<0?(p[m]=f.length,f.push([e[n].slice(0)])):f[p[m]].push(e[n].slice(0))}return f}(e)}},function(e,t,r){"use strict";var n=r(191),i={body:"",args:[],thisVars:[],localVars:[]};function a(e){if(!e)return i;for(var t=0;t<e.args.length;++t){var r=e.args[t];e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function o(e){for(var t=[],r=0;r<e.args.length;++r)t.push("a"+r);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return n({args:e.args,pre:a(e.pre),body:a(e.body),post:a(e.proc),funcName:e.funcName})}(e))}var s={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in s){var r=s[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:e+"seq"})}}();var l={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in l){var r=l[e];t[e]=o({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:e}),t[e+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var u={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in u){var r=u[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<c.length;++e){var r=c[e];t[r]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),t[r+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var e=0;e<h.length;++e){var r=h[e];t[r]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),t[r+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),t[r+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),t[r+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var d=["atan2","pow"];!function(){for(var e=0;e<d.length;++e){var r=d[e];t[r+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),t[r+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),t[r+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),t[r+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),t.any=n({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=n({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=n({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=n({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=n({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=n({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=n({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},function(e,t,r){"use strict";var n={};(0,r(2).assign)(n,r(193),r(196),r(51)),e.exports=n},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){"use strict";e.exports=function(e){return"string"==typeof e}},function(e,t,r){"use strict";var n=r(206);e.exports=function(e){return n(e)&&e>=0}},function(e,t,r){"use strict";var n=r(28),i=r(29);e.exports=function(e,t){var r,a;if(!n(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(0===e.length||0===t)return"";if(e.length*t>9007199254740991)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(r="",a=t;1==(1&a)&&(r+=e),0!==(a>>>=1);)e+=e;return r}},function(e,t,r){"use strict";var n=n||{};n.Utils=n.Utils||{},n.Utils.crcTable=null,n.Utils.GUNZIP_MAGIC_COOKIE1=31,n.Utils.GUNZIP_MAGIC_COOKIE2=139,n.Utils.getStringAt=function(e,t,r){var n,i,a="";for(n=t;n<r;n+=1)0!==(i=e.getUint8(n))&&(a+=String.fromCharCode(i));return a},n.Utils.getByteAt=function(e,t){return e.getInt8(t)},n.Utils.getShortAt=function(e,t,r){return e.getInt16(t,r)},n.Utils.getIntAt=function(e,t,r){return e.getInt32(t,r)},n.Utils.getFloatAt=function(e,t,r){return e.getFloat32(t,r)},n.Utils.getDoubleAt=function(e,t,r){return e.getFloat64(t,r)},n.Utils.getLongAt=function(e,t,r){var i,a=[],o=0;for(i=0;i<8;i+=1)a[i]=n.Utils.getByteAt(e,t+i,r);for(i=a.length-1;i>=0;i--)o=256*o+a[i];return o},n.Utils.toArrayBuffer=function(e){var t,r,n;for(t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n+=1)r[n]=e[n];return t},n.Utils.isString=function(e){return"string"==typeof e||e instanceof String},n.Utils.formatNumber=function(e,t){var r=0;return r=n.Utils.isString(e)?Number(e):e,r=t?r.toPrecision(5):r.toPrecision(7),parseFloat(r)},n.Utils.makeCRCTable=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},n.Utils.crc32=function(e){for(var t=n.Utils.crcTable||(n.Utils.crcTable=n.Utils.makeCRCTable()),r=-1,i=0;i<e.byteLength;i++)r=r>>>8^t[255&(r^e.getUint8(i))];return(-1^r)>>>0},"undefined"!==typeof e&&e.exports&&(e.exports=n.Utils)},function(e,t,r){"use strict";var n=r(12),i=n.POSITIVE_INFINITY,a=n.NEGATIVE_INFINITY,o=new Int32Array(128);function s(e,t,r,n,i){this.volume=e,this.stencil=t,this.ptrs=r,this.coord=n,this.frontier=i,3*o.length<t.length&&(o=new Int32Array(t.length/3))}!function(){for(var e=0;e<128;++e)o[e]=0}(),s.prototype.clone=function(){return new s(this.volume,this.stencil,new Int32Array(this.ptrs),new Int32Array(this.coord),new Uint8Array(this.frontier))},s.prototype.hasNext=function(){return this.coord[0]<i},s.prototype.next=function(){for(var e=this.volume.coords,t=this.volume.length(),r=this.frontier,n=this.stencil,a=this.ptrs,s=this.coord,l=0,u=0;u<3;++u)s[u]=i;u=0;e:for(var c=0;u<a.length;++u,c+=3){var h=a[u];if(!(h>=t-1)){h+=1;for(var d=2;d>=0;--d){var f=e[d][h]-n[c+d],p=s[d];if(f<p){for(s[d--]=f;d>=0;--d)s[d]=e[d][h]-n[c+d];l=0;break}if(f>p)continue e}o[l++]=u}}for(u=0;u<a.length;++u)r[u]=0;for(u=0;u<l;++u){var m=o[u];++a[m],r[m]=1}},s.prototype.seek=function(e){for(var t=this.volume,r=t.coords,n=t.length(),i=this.ptrs,a=this.stencil,o=this.frontier,s=new Int32Array(3),l=0;l<3;++l)this.coord[l]=e[l];l=0;for(var u=0;l<i.length;++l,u+=3){for(var c=0;c<3;++c)s[c]=e[c]+a[u+c];i[l]=t.bisect(s,0,n-1),o[l]=r[0][i[l]]===s[0]&&r[1][i[l]]===s[1]&&r[2][i[l]]===s[2]}},s.prototype.getValues=function(e,t){for(var r=this.ptrs,n=this.frontier,i=this.volume.phases,a=this.volume.distances,o=0;o<r.length;++o){var s=r[o];e[o]=i[s],t[o]=n[o]?a[s]:1}},t.StencilIterator=s,t.beginStencil=function(e,t){var r=new Int32Array(t.length/3),n=new Int32Array(3);return n[0]=n[1]=n[2]=a,new s(e,t,r,n,new Uint8Array(r.length))}},function(e,t){function r(e){for(var t=[],r=Math.ceil(e),n=-r;n<=r;++n)for(var i=-r;i<=r;++i)for(var a=-r;a<=r;++a)t.push(n),t.push(i),t.push(a);return new Int32Array(t)}function n(e,t){if(e===Number.POSITIVE_INFINITY)return r(t);for(var n=[],i=0|Math.ceil(t),a=Math.pow(t,e),o=-i;o<=i;++o)for(var s=-i;s<=i;++s)for(var l=-i;l<=i;++l)Math.pow(Math.abs(o),e)+Math.pow(Math.abs(s),e)+Math.pow(Math.abs(l),e)<=a&&(n.push(o),n.push(s),n.push(l));return n}var i,a;!function(){for(var e=[],t=0;t<8;++t){for(var r=[0,0,0],n=0;n<3;++n)0!=(t&1<<n)&&(r[n]=-1);e.push(r[0]),e.push(r[1]),e.push(r[2])}i=new Int32Array(e)}(),function(){for(var e=[0,0,0],t=0;t<3;++t)for(var r=-1;r<=1;r+=2)e.push(0===t?r:0),e.push(1===t?r:0),e.push(2===t?r:0);a=new Int32Array(e)}(),t.lp=n,t.moore=r,t.vonNeumann=n.bind(null,1),t.ball=n.bind(null,2),t.CROSS_STENCIL=a,t.CUBE_STENCIL=i},function(e,t,r){"use strict";var n=r(35),i=r(14),a=r(37),o=r(6),s=r(38),l=new Function("a","b",["for(var i=2; i>=0; --i) {","var d = a[i]-b[i];","if(d) return d;","}","return 0;"].join("\n"));e.exports=function(e,t,r){e.cells&&(r=e.faceNormals,t=e.positions,e=e.cells);var u=n(e,t,1),c=(r=r||i.faceNormals(u.cells,u.positions),[]);for(var h in u.grid){var d=u.grid[h].coord,f=a(u,r,d);isNaN(f)||Math.abs(f)>1||(f<0?c.push([d[0],d[1],d[2],1,-f]):c.push([d[0],d[1],d[2],0,f]))}c.sort(l);var p=new Array(c.length+1),m=new Array(c.length+1),g=new Array(c.length+1),v=new Array(c.length+1),y=new Array(c.length+1);p[0]=m[0]=g[0]=o.NEGATIVE_INFINITY,v[0]=0,y[0]=1;for(var _=0;_<c.length;++_){var b=c[_];p[_+1]=b[0],m[_+1]=b[1],g[_+1]=b[2],v[_+1]=b[3],y[_+1]=b[4]}return s.removeDuplicates(new o.DynamicVolume([p,m,g],y,v))}},function(e,t,r){"use strict";var n=r(36),i=r(13),a=r(156);function o(e,t){this.coord=e,this.cells=t}function s(e,t,r,n){this.cells=e,this.positions=t,this.tolerance=r,this.grid=n}function l(e){switch(e.length){case 0:return 0;case 1:return e[0];case 2:return i.interleave2(e[0],e[1]);case 3:return i.interleave3(e[0],e[1],e[2]);default:return e.join("|")}}function u(e){return e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1)}function c(e){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2)}function h(e,t,r,i){var s=t.length;switch(s){case 0:break;case 1:!function(e,t,r,n){for(var i=t[0];i<=r[0];++i)e[i]?e[i].cells.push(n):e[i]=new o([i],[n])}(e,t,r,i);break;case 2:!function(e,t,r,n){for(var i=[0,0],s=2*e.tolerance*e.tolerance,l=t[1];l<=r[1];++l){var c=u(l)<<1;i[1]=l*e.tolerance;for(var h=t[0];h<=r[0];++h){i[0]=f*e.tolerance;var d=a(e.cells[n],e.positions,i);if(!(isNaN(d)||d>=s)){var f=c+u(h),p=e.grid[f];p?p.cells.push(n):e.grid[f]=new o([h,l],[n])}}}}(e,t,r,i);break;case 3:!function(e,t,r,n){for(var i=[0,0,0],s=3*e.tolerance*e.tolerance,l=t[2];l<=r[2];++l){var u=c(l)<<2;i[2]=e.tolerance*l;for(var h=t[1];h<=r[1];++h){var d=u+(c(h)<<1);i[1]=e.tolerance*h;for(var f=t[0];f<=r[0];++f){i[0]=e.tolerance*f;var p=a(e.cells[n],e.positions,i);if(!(isNaN(p)||p>=s)){var m=d+c(f),g=e.grid[m];g?g.cells.push(n):e.grid[m]=new o([f,h,l],[n])}}}}}(e,t,r,i);break;default:!function e(t,r,i,s,u,c){if(u<0){var h=n.mul(t.tolerance,c),d=a(t.cells[s],t.positions,h);if(isNaN(d)||d>=r.length*t.tolerance*t.tolerance)return;var f=l(c),p=t.grid[f];p?p.cells.push(s):t.grid[f]=new o(c.slice(0),[s])}else for(c[u]=r[u];c[u]<=i[u];++c[u])e(t,r,i,s,u-1,c)}(e,t,r,i,s-1,new Array(s))}}o.prototype.closestCells=function(e,t){for(var r=this.cells,n=Number.POSITIVE_INFINITY,i=[],o=[],s=new Array(t.length),l=0;l<r.length;++l){var u=r[l],c=a(e.cells[u],e.positions,t,s);Math.abs(c-n)<1e-6?(i.push(u),o.push(s.slice(0))):c<n&&(n=c,i.length=1,i[0]=u,o.length=1,o[0]=s.slice(0))}return{points:o,cells:i,distance:n}},o.prototype.neighborhood=function(e,t,r){for(var n=this.cells,i=[],o=r*r,s=0;s<n.length;++s){var l=n[s];a(e.cells[l],e.positions,t)<=o&&i.push(l)}return i},s.prototype.closestCells=function(e){for(var t=this.tolerance,r=new Array(e.length),n=0;n<e.length;++n)r[n]=Math.floor(e[n]/t);var i=this.grid[l(r)];return i?i.closestCells(this,e):null},s.prototype.neighborhood=function(e,t){for(var r=this.tolerance,n=new Array(e.length),i=0;i<e.length;++i)n[i]=Math.floor(e[i]/r);var a=this.grid[l(n)];return a?a.neighborhood(this,e,t):[]},e.exports=function(e,t,r){for(var n=new s(e,t,r,{}),i=t[0].length,a=new Array(i),o=new Array(i),l=new Array(i),u=new Array(i),c=0;c<e.length;++c){for(var d=e[c],f=0;f<i;++f)a[f]=Number.POSITIVE_INFINITY,l[f]=Number.NEGATIVE_INFINITY;for(var p=0;p<d.length;++p){var m=t[d[p]];for(f=0;f<i;++f)a[f]=Math.min(a[f],m[f]),l[f]=Math.max(l[f],m[f])}for(f=0;f<i;++f)o[f]=Math.floor(a[f]/r)-1,u[f]=Math.ceil(l[f]/r)+1;h(n,o,u,c)}return n}},function(module,exports,__webpack_require__){"use strict";(function(global){var numeric=exports;void 0!==global&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var r,n,i;for(void 0===t&&(t=15),n=.5,r=new Date;;){for(i=n*=2;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;if(new Date-r>t)break}for(i=n;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;return 1e3*(3*n-1)/(new Date-r)},numeric._myIndexOf=function(e){var t,r=this.length;for(t=0;t<r;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){var t=[];return function e(r){var n;if(void 0===r)return t.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof r)return t.push('"'+r+'"'),!1;if("boolean"==typeof r)return t.push(r.toString()),!1;if("number"==typeof r){var i=function e(t){if(0===t)return"0";if(isNaN(t))return"NaN";if(t<0)return"-"+e(-t);if(isFinite(t)){var r=Math.floor(Math.log(t)/Math.log(10)),n=t/Math.pow(10,r),i=n.toPrecision(numeric.precision);return 10===parseFloat(i)&&(r++,i=(n=1).toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+r.toString()}return"Infinity"}(r),a=r.toPrecision(numeric.precision),o=parseFloat(r.toString()).toString(),s=[i,a,o,parseFloat(a).toString(),parseFloat(o).toString()];for(n=1;n<s.length;n++)s[n].length<i.length&&(i=s[n]);return t.push(Array(numeric.precision+8-i.length).join(" ")+i),!1}if(null===r)return t.push("null"),!1;if("function"==typeof r){t.push(r.toString());var l=!1;for(n in r)r.hasOwnProperty(n)&&(l?t.push(",\n"):t.push("\n{"),l=!0,t.push(n),t.push(": \n"),e(r[n]));return l&&t.push("}\n"),!0}if(r instanceof Array){if(r.length>numeric.largeArray)return t.push("...Large Array..."),!0;l=!1;for(t.push("["),n=0;n<r.length;n++)n>0&&(t.push(","),l&&t.push("\n ")),l=e(r[n]);return t.push("]"),!0}for(n in t.push("{"),l=!1,r)r.hasOwnProperty(n)&&(l&&t.push(",\n"),l=!0,t.push(n),t.push(": \n"),e(r[n]));return t.push("}"),!0}(e),t.join("")},numeric.parseDate=function(e){return function e(t){if("string"==typeof t)return Date.parse(t.replace(/-/g,"/"));if(!(t instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var r,n=[];for(r=0;r<t.length;r++)n[r]=e(t[r]);return n}(e)},numeric.parseFloat=function(e){return function e(t){if("string"==typeof t)return parseFloat(t);if(!(t instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var r,n=[];for(r=0;r<t.length;r++)n[r]=e(t[r]);return n}(e)},numeric.parseCSV=function(e){var t,r,n,i=e.split("\n"),a=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,s=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,l=0;for(r=0;r<i.length;r++){var u,c=(i[r]+",").match(o);if(c.length>0){for(a[l]=[],t=0;t<c.length;t++)u=(n=c[t]).substr(0,n.length-1),s.test(u)?a[l][t]=parseFloat(u):a[l][t]=u;l++}}return a},numeric.toCSV=function(e){var t,r,n,i,a,o=numeric.dim(e);for(n=o[0],o[1],a=[],t=0;t<n;t++){for(i=[],r=0;r<n;r++)i[r]=e[t][r].toString();a[t]=i.join(", ")}return a.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var n,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],a=-1;e.length;for(n=t;n<r;n++)a=a>>>8^i[255&(a^e[n])];return-1^a}var r,n,i,a,o,s,l,u,c,h,d=e[0].length,f=e[0][0].length,p=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,f>>24&255,f>>16&255,f>>8&255,255&f,d>>24&255,d>>16&255,d>>8&255,255&d,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(h=t(p,12,29),p[29]=h>>24&255,p[30]=h>>16&255,p[31]=h>>8&255,p[32]=255&h,r=1,n=0,l=0;l<d;l++){for(l<d-1?p.push(0):p.push(1),o=3*f+1+(0===l)&255,s=3*f+1+(0===l)>>8&255,p.push(o),p.push(s),p.push(255&~o),p.push(255&~s),0===l&&p.push(0),u=0;u<f;u++)for(i=0;i<3;i++)n=(n+(r=(r+(o=(o=e[i][l][u])>255?255:o<0?0:Math.round(o)))%65521))%65521,p.push(o);p.push(0)}return c=(n<<16)+r,p.push(c>>24&255),p.push(c>>16&255),p.push(c>>8&255),p.push(255&c),a=p.length-41,p[33]=a>>24&255,p[34]=a>>16&255,p[35]=a>>8&255,p[36]=255&a,h=t(p,37),p.push(h>>24&255),p.push(h>>16&255),p.push(h>>8&255),p.push(255&h),p.push(0),p.push(0),p.push(0),p.push(0),p.push(73),p.push(69),p.push(78),p.push(68),p.push(174),p.push(66),p.push(96),p.push(130),"data:image/png;base64,"+function(e){var t,r,n,i,a,o,s,l=e.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="";for(t=0;t<l;t+=3)a=((3&(r=e[t]))<<4)+((n=e[t+1])>>4),o=((15&n)<<2)+((i=e[t+2])>>6),s=63&i,t+1>=l?o=s=64:t+2>=l&&(s=64),c+=u.charAt(r>>2)+u.charAt(a)+u.charAt(o)+u.charAt(s);return c}(p)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t;return"object"==typeof e?"object"==typeof(t=e[0])?"object"==typeof t[0]?numeric._dim(e):[e.length,t.length]:[e.length]:[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,r){var n,i;if(!(t instanceof Array&&r instanceof Array))return!1;if((i=t.length)!==r.length)return!1;for(n=0;n<i;n++)if(t[n]!==r[n]){if("object"!=typeof t[n])return!1;if(!e(t[n],r[n]))return!1}return!0},numeric.rep=function(e,t,r){void 0===r&&(r=0);var n,i=e[r],a=Array(i);if(r===e.length-1){for(n=i-2;n>=0;n-=2)a[n+1]=t,a[n]=t;return-1===n&&(a[0]=t),a}for(n=i-1;n>=0;n--)a[n]=numeric.rep(e,t,r+1);return a},numeric.dotMMsmall=function(e,t){var r,n,i,a,o,s,l,u,c,h,d;for(a=e.length,o=t.length,s=t[0].length,l=Array(a),r=a-1;r>=0;r--){for(u=Array(s),c=e[r],i=s-1;i>=0;i--){for(h=c[o-1]*t[o-1][i],n=o-2;n>=1;n-=2)d=n-1,h+=c[n]*t[n][i]+c[d]*t[d][i];0===n&&(h+=c[0]*t[0][i]),u[i]=h}l[r]=u}return l},numeric._getCol=function(e,t,r){var n;for(n=e.length-1;n>0;--n)r[n]=e[n][t],r[--n]=e[n][t];0===n&&(r[0]=e[0][t])},numeric.dotMMbig=function(e,t){var r,n,i,a=numeric._getCol,o=t.length,s=Array(o),l=e.length,u=t[0].length,c=new Array(l),h=numeric.dotVV;for(--o,n=--l;-1!==n;--n)c[n]=Array(u);for(n=--u;-1!==n;--n)for(a(t,n,s),i=l;-1!==i;--i)0,r=e[i],c[i][n]=h(r,s);return c},numeric.dotMV=function(e,t){var r,n=e.length,i=(t.length,Array(n)),a=numeric.dotVV;for(r=n-1;r>=0;r--)i[r]=a(e[r],t);return i},numeric.dotVM=function(e,t){var r,n,i,a,o,s,l;for(i=e.length,a=t[0].length,o=Array(a),n=a-1;n>=0;n--){for(s=e[i-1]*t[i-1][n],r=i-2;r>=1;r-=2)l=r-1,s+=e[r]*t[r][n]+e[l]*t[l][n];0===r&&(s+=e[0]*t[0][n]),o[n]=s}return o},numeric.dotVV=function(e,t){var r,n,i=e.length,a=e[i-1]*t[i-1];for(r=i-2;r>=1;r-=2)n=r-1,a+=e[r]*t[r]+e[n]*t[n];return 0===r&&(a+=e[0]*t[0]),a},numeric.dot=function(e,t){var r=numeric.dim;switch(1e3*r(e).length+r(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,r,n,i,a=e.length,o=Array(a);for(t=a-1;t>=0;t--){for(i=Array(a),r=t+2,n=a-1;n>=r;n-=2)i[n]=0,i[n-1]=0;for(n>t&&(i[n]=0),i[t]=e[t],n=t-1;n>=1;n-=2)i[n]=0,i[n-1]=0;0===n&&(i[0]=0),o[t]=i}return o},numeric.getDiag=function(e){var t,r=Math.min(e.length,e[0].length),n=Array(r);for(t=r-1;t>=1;--t)n[t]=e[t][t],n[--t]=e[t][t];return 0===t&&(n[0]=e[0][0]),n},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,r){void 0===r&&(r="");var n,i,a=[],o=/\[i\]$/,s="",l=!1;for(n=0;n<e.length;n++)o.test(e[n])?s=i=e[n].substring(0,e[n].length-3):i=e[n],"ret"===i&&(l=!0),a.push(i);return a[e.length]="_s",a[e.length+1]="_k",a[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+s+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(l?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,a)},numeric.pointwise2=function(e,t,r){void 0===r&&(r="");var n,i,a=[],o=/\[i\]$/,s="",l=!1;for(n=0;n<e.length;n++)o.test(e[n])?s=i=e[n].substring(0,e[n].length-3):i=e[n],"ret"===i&&(l=!0),a.push(i);return a[e.length]="var _n = "+s+".length;\nvar i"+(l?"":", ret = Array(_n)")+";\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,a)},numeric._biforeach=function e(t,r,n,i,a){var o;if(i!==n.length-1)for(o=n[i]-1;o>=0;o--)e("object"==typeof t?t[o]:t,"object"==typeof r?r[o]:r,n,i+1,a);else a(t,r)},numeric._biforeach2=function e(t,r,n,i,a){if(i===n.length-1)return a(t,r);var o,s=n[i],l=Array(s);for(o=s-1;o>=0;--o)l[o]=e("object"==typeof t?t[o]:t,"object"==typeof r?r[o]:r,n,i+1,a);return l},numeric._foreach=function e(t,r,n,i){var a;if(n!==r.length-1)for(a=r[n]-1;a>=0;a--)e(t[a],r,n+1,i);else i(t)},numeric._foreach2=function e(t,r,n,i){if(n===r.length-1)return i(t);var a,o=r[n],s=Array(o);for(a=o-1;a>=0;a--)s[a]=e(t[a],r,n+1,i);return s},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var r,n,i="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(i="var "+t+" = Math."+t+";\n",r=function(e,r,n){return e+" = "+t+"("+r+","+n+")"},n=function(e,r){return e+" = "+t+"("+e+","+r+")"}):(r=function(e,r,n){return e+" = "+r+" "+t+" "+n},n=numeric.opseq.hasOwnProperty(e+"eq")?function(e,r){return e+" "+t+"= "+r}:function(e,r){return e+" = "+e+" "+t+" "+r}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],r("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],r("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],r("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+n("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],n("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],n("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,r,n,i,a,o,s,l=numeric.dim(e),u=Math.abs,c=l[0],h=l[1],d=numeric.clone(e),f=numeric.identity(c);for(o=0;o<h;++o){var p=-1,m=-1;for(a=o;a!==c;++a)(s=u(d[a][o]))>m&&(p=a,m=s);for(r=d[p],d[p]=d[o],d[o]=r,i=f[p],f[p]=f[o],f[o]=i,e=r[o],s=o;s!==h;++s)r[s]/=e;for(s=h-1;-1!==s;--s)i[s]/=e;for(a=c-1;-1!==a;--a)if(a!==o){for(t=d[a],n=f[a],e=t[o],s=o+1;s!==h;++s)t[s]-=r[s]*e;for(s=h-1;s>0;--s)n[s]-=i[s]*e,n[--s]-=i[s]*e;0===s&&(n[0]-=i[0]*e)}}return f},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var r,n,i,a,o,s,l,u,c=t[0],h=1,d=numeric.clone(e);for(n=0;n<c-1;n++){for(i=n,r=n+1;r<c;r++)Math.abs(d[r][n])>Math.abs(d[i][n])&&(i=r);for(i!==n&&(l=d[i],d[i]=d[n],d[n]=l,h*=-1),a=d[n],r=n+1;r<c;r++){for(s=(o=d[r])[n]/a[n],i=n+1;i<c-1;i+=2)u=i+1,o[i]-=a[i]*s,o[u]-=a[u]*s;i!==c&&(o[i]-=a[i]*s)}if(0===a[n])return 0;h*=a[n]}return h*d[n][n]},numeric.transpose=function(e){var t,r,n,i,a,o=e.length,s=e[0].length,l=Array(s);for(r=0;r<s;r++)l[r]=Array(o);for(t=o-1;t>=1;t-=2){for(i=e[t],n=e[t-1],r=s-1;r>=1;--r)(a=l[r])[t]=i[r],a[t-1]=n[r],(a=l[--r])[t]=i[r],a[t-1]=n[r];0===r&&((a=l[0])[t]=i[0],a[t-1]=n[0])}if(0===t){for(n=e[0],r=s-1;r>=1;--r)l[r][0]=n[r],l[--r][0]=n[r];0===r&&(l[0][0]=n[0])}return l},numeric.negtranspose=function(e){var t,r,n,i,a,o=e.length,s=e[0].length,l=Array(s);for(r=0;r<s;r++)l[r]=Array(o);for(t=o-1;t>=1;t-=2){for(i=e[t],n=e[t-1],r=s-1;r>=1;--r)(a=l[r])[t]=-i[r],a[t-1]=-n[r],(a=l[--r])[t]=-i[r],a[t-1]=-n[r];0===r&&((a=l[0])[t]=-i[0],a[t-1]=-n[0])}if(0===t){for(n=e[0],r=s-1;r>=1;--r)l[r][0]=-n[r],l[--r][0]=-n[r];0===r&&(l[0][0]=-n[0])}return l},numeric._random=function e(t,r){var n,i,a=t[r],o=Array(a);if(r===t.length-1){for(i=Math.random,n=a-1;n>=1;n-=2)o[n]=i(),o[n-1]=i();return 0===n&&(o[0]=i()),o}for(n=a-1;n>=0;n--)o[n]=e(t,r+1);return o},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,r){if(void 0===r&&(r=Math.max(Math.round(t-e)+1,1)),r<2)return 1===r?[e]:[];var n,i=Array(r);for(n=--r;n>=0;n--)i[n]=(n*t+(r-n)*e)/r;return i},numeric.getBlock=function(e,t,r){var n=numeric.dim(e);return function e(i,a){var o,s=t[a],l=r[a]-s,u=Array(l);if(a===n.length-1){for(o=l;o>=0;o--)u[o]=i[o+s];return u}for(o=l;o>=0;o--)u[o]=e(i[o+s],a+1);return u}(e,0)},numeric.setBlock=function(e,t,r,n){var i=numeric.dim(e);return function e(n,a,o){var s,l=t[o],u=r[o]-l;if(o===i.length-1)for(s=u;s>=0;s--)n[s+l]=a[s];for(s=u;s>=0;s--)e(n[s+l],a[s],o+1)}(e,n,0),e},numeric.getRange=function(e,t,r){var n,i,a,o,s=t.length,l=r.length,u=Array(s);for(n=s-1;-1!==n;--n)for(u[n]=Array(l),a=u[n],o=e[t[n]],i=l-1;-1!==i;--i)a[i]=o[r[i]];return u},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var r,n,i,a,o,s=t[0],l=t[1];for(r=0,n=0,i=0;i<s;++i)r+=e[i][0].length;for(a=0;a<l;++a)n+=e[0][a][0].length;var u=Array(r);for(i=0;i<r;++i)u[i]=Array(n);var c,h,d,f,p,m=0;for(i=0;i<s;++i){for(c=n,a=l-1;-1!==a;--a)for(c-=(o=e[i][a])[0].length,d=o.length-1;-1!==d;--d)for(p=o[d],h=u[m+d],f=p.length-1;-1!==f;--f)h[c+f]=p[f];m+=e[i][0].length}return u},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var r=numeric.dim(e),n=numeric.dim(t);if(1!==r.length||1!==n.length)throw new Error("numeric: tensor product is only defined for vectors");var i,a,o,s,l=r[0],u=n[0],c=Array(l);for(a=l-1;a>=0;a--){for(i=Array(u),s=e[a],o=u-1;o>=3;--o)i[o]=s*t[o],i[--o]=s*t[o],i[--o]=s*t[o],i[--o]=s*t[o];for(;o>=0;)i[o]=s*t[o],--o;c[a]=i}return c},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,r,n,i){var a;numeric.indexOf;if("string"!=typeof i)for(a in i="",numeric)numeric.hasOwnProperty(a)&&(e.indexOf(a)>=0||t.indexOf(a)>=0||r.indexOf(a)>=0||n.indexOf(a)>=0)&&a.length>1&&(i+="var "+a+" = numeric."+a+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+n+");\n  }\n  return new numeric.T("+r+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var r=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,r),t(numeric.neg(this.y),r))}return new T(t(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var t=numeric.div;return this.y?new numeric.T(t(this.x,e.x),t(this.y,e.x)):new numeric.T(t(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,r=this.y;return r?new numeric.T(e(t),e(r)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,r=this.y;return r?new numeric.T(e(t),numeric.negtranspose(r)):new numeric.T(e(t))},numeric.Tunop=function(e,t,r){return"string"!=typeof r&&(r=""),Function("var x = this;\n"+r+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if(void 0===e.y)return new numeric.T(numeric.inv(e.x));var t,r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,_=e.x.length,b=numeric.identity(_),E=numeric.rep([_,_],0),w=numeric.clone(e.x),x=numeric.clone(e.y);for(u=0;u<_;u++){for(d=(p=w[u][u])*p+(m=x[u][u])*m,h=u,c=u+1;c<_;c++)(f=(p=w[c][u])*p+(m=x[c][u])*m)>d&&(h=c,d=f);for(h!==u&&(y=w[u],w[u]=w[h],w[h]=y,y=x[u],x[u]=x[h],x[h]=y,y=b[u],b[u]=b[h],b[h]=y,y=E[u],E[u]=E[h],E[h]=y),t=w[u],r=x[u],a=b[u],o=E[u],p=t[u],m=r[u],c=u+1;c<_;c++)g=t[c],v=r[c],t[c]=(g*p+v*m)/d,r[c]=(v*p-g*m)/d;for(c=0;c<_;c++)g=a[c],v=o[c],a[c]=(g*p+v*m)/d,o[c]=(v*p-g*m)/d;for(c=u+1;c<_;c++){for(n=w[c],i=x[c],s=b[c],l=E[c],p=n[u],m=i[u],h=u+1;h<_;h++)g=t[h],v=r[h],n[h]-=g*p-v*m,i[h]-=v*p+g*m;for(h=0;h<_;h++)g=a[h],v=o[h],s[h]-=g*p-v*m,l[h]-=v*p+g*m}}for(u=_-1;u>0;u--)for(a=b[u],o=E[u],c=u-1;c>=0;c--)for(s=b[c],l=E[c],p=w[c][u],m=x[c][u],h=_-1;h>=0;h--)g=a[h],v=o[h],s[h]-=p*g-m*v,l[h]-=p*v+m*g;return new numeric.T(b,E)},numeric.T.prototype.get=function(e){var t,r=this.x,n=this.y,i=0,a=e.length;if(n){for(;i<a;)r=r[t=e[i]],n=n[t],i++;return new numeric.T(r,n)}for(;i<a;)r=r[t=e[i]],i++;return new numeric.T(r)},numeric.T.prototype.set=function(e,t){var r,n=this.x,i=this.y,a=0,o=e.length,s=t.x,l=t.y;if(0===o)return l?this.y=l:i&&(this.y=void 0),this.x=n,this;if(l){for(i||(i=numeric.rep(numeric.dim(n),0),this.y=i);a<o-1;)n=n[r=e[a]],i=i[r],a++;return n[r=e[a]]=s,i[r]=l,this}if(i){for(;a<o-1;)n=n[r=e[a]],i=i[r],a++;return n[r=e[a]]=s,i[r]=s instanceof Array?numeric.rep(numeric.dim(s),0):0,this}for(;a<o-1;)n=n[r=e[a]],a++;return n[r=e[a]]=s,this},numeric.T.prototype.getRows=function(e,t){var r,n,i=t-e+1,a=Array(i),o=this.x,s=this.y;for(r=e;r<=t;r++)a[r-e]=o[r];if(s){for(n=Array(i),r=e;r<=t;r++)n[r-e]=s[r];return new numeric.T(a,n)}return new numeric.T(a)},numeric.T.prototype.setRows=function(e,t,r){var n,i=this.x,a=this.y,o=r.x,s=r.y;for(n=e;n<=t;n++)i[n]=o[n-e];if(s)for(a||(a=numeric.rep(numeric.dim(i),0),this.y=a),n=e;n<=t;n++)a[n]=s[n-e];else if(a)for(n=e;n<=t;n++)a[n]=numeric.rep([o[n-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,r=this.y;return r?new numeric.T(t[e],r[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var r=this.x,n=this.y,i=t.x,a=t.y;return r[e]=i,a?(n||(n=numeric.rep(numeric.dim(r),0),this.y=n),n[e]=a):n&&(n=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var r=this.x,n=this.y,i=numeric.getBlock;return n?new numeric.T(i(r,e,t),i(n,e,t)):new numeric.T(i(r,e,t))},numeric.T.prototype.setBlock=function(e,t,r){r instanceof numeric.T||(r=new numeric.T(r));var n=this.x,i=this.y,a=numeric.setBlock,o=r.x,s=r.y;if(s)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),a(n,e,t,o),a(i,e,t,s),this;a(n,e,t,o),i&&a(i,e,t,numeric.rep(numeric.dim(o),0))},numeric.T.rep=function(e,t){var r=numeric.T;t instanceof r||(t=new r(t));var n=t.x,i=t.y,a=numeric.rep;return i?new r(a(e,n),a(e,i)):new r(a(e,n))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,r=e.y,n=numeric.diag;return r?new numeric.T(n(t),n(r)):new numeric.T(n(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,r=this.y;return r?new e.T(e.getDiag(t),e.getDiag(r)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),r=(e[0]>=0?1:-1)*numeric.norm2(e);t[0]+=r;var n=numeric.norm2(t);if(0===n)throw new Error("eig: internal error");return numeric.div(t,n)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var r,n,i,a,o,s,l,u,c,h,d=t[0],f=numeric.clone(e),p=numeric.identity(d);for(n=0;n<d-2;n++){for(a=Array(d-n-1),r=n+1;r<d;r++)a[r-n-1]=f[r][n];if(numeric.norm2(a)>0){for(o=numeric.house(a),s=numeric.getBlock(f,[n+1,n],[d-1,d-1]),l=numeric.tensor(o,numeric.dot(o,s)),r=n+1;r<d;r++)for(u=f[r],c=l[r-n-1],i=n;i<d;i++)u[i]-=2*c[i-n];for(s=numeric.getBlock(f,[0,n+1],[d-1,d-1]),l=numeric.tensor(numeric.dot(s,o),o),r=0;r<d;r++)for(u=f[r],c=l[r],i=n+1;i<d;i++)u[i]-=2*c[i-n-1];for(s=Array(d-n-1),r=n+1;r<d;r++)s[r-n-1]=p[r];for(l=numeric.tensor(o,numeric.dot(o,s)),r=n+1;r<d;r++)for(h=p[r],c=l[r-n-1],i=0;i<d;i++)h[i]-=2*c[i]}}return{H:f,Q:p}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(e,t){void 0===t&&(t=1e4),e=numeric.clone(e);numeric.clone(e);var r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,_,b=numeric.dim(e)[0],E=numeric.identity(b);if(b<3)return{Q:E,B:[[0,b-1]]};var w=numeric.epsilon;for(_=0;_<t;_++){for(v=0;v<b-1;v++)if(Math.abs(e[v+1][v])<w*(Math.abs(e[v][v])+Math.abs(e[v+1][v+1]))){var x=numeric.QRFrancis(numeric.getBlock(e,[0,0],[v,v]),t),T=numeric.QRFrancis(numeric.getBlock(e,[v+1,v+1],[b-1,b-1]),t);for(f=Array(v+1),g=0;g<=v;g++)f[g]=E[g];for(p=numeric.dot(x.Q,f),g=0;g<=v;g++)E[g]=p[g];for(f=Array(b-v-1),g=v+1;g<b;g++)f[g-v-1]=E[g];for(p=numeric.dot(T.Q,f),g=v+1;g<b;g++)E[g]=p[g-v-1];return{Q:E,B:x.B.concat(numeric.add(T.B,v+1))}}var M,S,A;if(i=e[b-2][b-2],a=e[b-2][b-1],o=e[b-1][b-2],u=i+(s=e[b-1][b-1]),l=i*s-a*o,c=numeric.getBlock(e,[0,0],[2,2]),u*u>=4*l)M=.5*(u+Math.sqrt(u*u-4*l)),S=.5*(u-Math.sqrt(u*u-4*l)),c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,M+S)),numeric.diag(numeric.rep([3],M*S)));else c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,u)),numeric.diag(numeric.rep([3],l)));for(r=[c[0][0],c[1][0],c[2][0]],n=numeric.house(r),f=[e[0],e[1],e[2]],p=numeric.tensor(n,numeric.dot(n,f)),g=0;g<3;g++)for(d=e[g],m=p[g],y=0;y<b;y++)d[y]-=2*m[y];for(f=numeric.getBlock(e,[0,0],[b-1,2]),p=numeric.tensor(numeric.dot(f,n),n),g=0;g<b;g++)for(d=e[g],m=p[g],y=0;y<3;y++)d[y]-=2*m[y];for(f=[E[0],E[1],E[2]],p=numeric.tensor(n,numeric.dot(n,f)),g=0;g<3;g++)for(h=E[g],m=p[g],y=0;y<b;y++)h[y]-=2*m[y];for(v=0;v<b-2;v++){for(y=v;y<=v+1;y++)if(Math.abs(e[y+1][y])<w*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){x=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),T=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[b-1,b-1]),t);for(f=Array(y+1),g=0;g<=y;g++)f[g]=E[g];for(p=numeric.dot(x.Q,f),g=0;g<=y;g++)E[g]=p[g];for(f=Array(b-y-1),g=y+1;g<b;g++)f[g-y-1]=E[g];for(p=numeric.dot(T.Q,f),g=y+1;g<b;g++)E[g]=p[g-y-1];return{Q:E,B:x.B.concat(numeric.add(T.B,y+1))}}for(A=Math.min(b-1,v+3),r=Array(A-v),g=v+1;g<=A;g++)r[g-v-1]=e[g][v];for(n=numeric.house(r),f=numeric.getBlock(e,[v+1,v],[A,b-1]),p=numeric.tensor(n,numeric.dot(n,f)),g=v+1;g<=A;g++)for(d=e[g],m=p[g-v-1],y=v;y<b;y++)d[y]-=2*m[y-v];for(f=numeric.getBlock(e,[0,v+1],[b-1,A]),p=numeric.tensor(numeric.dot(f,n),n),g=0;g<b;g++)for(d=e[g],m=p[g],y=v+1;y<=A;y++)d[y]-=2*m[y-v-1];for(f=Array(A-v),g=v+1;g<=A;g++)f[g-v-1]=E[g];for(p=numeric.tensor(n,numeric.dot(n,f)),g=v+1;g<=A;g++)for(h=E[g],m=p[g-v-1],y=0;y<b;y++)h[y]-=2*m[y]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y=numeric.toUpperHessenberg(e),_=numeric.QRFrancis(y.H,t),b=numeric.T,E=e.length,w=_.B,x=numeric.dot(_.Q,numeric.dot(y.H,numeric.transpose(_.Q))),T=new b(numeric.dot(_.Q,y.Q)),M=w.length,S=Math.sqrt;for(n=0;n<M;n++)if((r=w[n][0])===w[n][1]);else{if(a=r+1,o=x[r][r],s=x[r][a],l=x[a][r],u=x[a][a],0===s&&0===l)continue;(h=(c=-o-u)*c-4*(o*u-s*l))>=0?((g=(o-(d=c<0?-.5*(c-S(h)):-.5*(c+S(h))))*(o-d)+s*s)>(v=l*l+(u-d)*(u-d))?(p=(o-d)/(g=S(g)),m=s/g):(p=l/(v=S(v)),m=(u-d)/v),i=new b([[m,-p],[p,m]]),T.setRows(r,a,i.dot(T.getRows(r,a)))):(d=-.5*c,f=.5*S(-h),(g=(o-d)*(o-d)+s*s)>(v=l*l+(u-d)*(u-d))?(p=(o-d)/(g=S(g+f*f)),m=s/g,d=0,f/=g):(p=l/(v=S(v+f*f)),m=(u-d)/v,d=f/v,f=0),i=new b([[m,-p],[p,m]],[[d,f],[f,-d]]),T.setRows(r,a,i.dot(T.getRows(r,a))))}var A=T.dot(e).dot(T.transjugate()),R=(E=e.length,numeric.T.identity(E));for(a=0;a<E;a++)if(a>0)for(n=a-1;n>=0;n--){var k=A.get([n,n]),P=A.get([a,a]);numeric.neq(k.x,P.x)||numeric.neq(k.y,P.y)?(d=A.getRow(n).getBlock([n],[a-1]),f=R.getRow(a).getBlock([n],[a-1]),R.set([a,n],A.get([n,a]).neg().sub(d.dot(f)).div(k.sub(P)))):R.setRow(a,R.getRow(n))}for(a=0;a<E;a++)d=R.getRow(a),R.setRow(a,d.div(d.norm2()));return R=R.transpose(),R=T.transjugate().dot(R),{lambda:A.getDiag(),E:R}},numeric.ccsSparse=function(e){var t,r,n,i=e.length,a=[];for(r=i-1;-1!==r;--r)for(n in t=e[r]){for(n=parseInt(n);n>=a.length;)a[a.length]=0;0!==t[n]&&a[n]++}var o=a.length,s=Array(o+1);for(s[0]=0,r=0;r<o;++r)s[r+1]=s[r]+a[r];var l=Array(s[o]),u=Array(s[o]);for(r=i-1;-1!==r;--r)for(n in t=e[r])0!==t[n]&&(a[n]--,l[s[n]+a[n]]=r,u[s[n]+a[n]]=t[n]);return[s,l,u]},numeric.ccsFull=function(e){var t,r,n,i,a=e[0],o=e[1],s=e[2],l=numeric.ccsDim(e),u=l[0],c=l[1],h=numeric.rep([u,c],0);for(t=0;t<c;t++)for(n=a[t],i=a[t+1],r=n;r<i;++r)h[o[r]][t]=s[r];return h},numeric.ccsTSolve=function(e,t,r,n,i){var a,o,s,l,u,c,h,d=e[0],f=e[1],p=e[2],m=d.length-1,g=Math.max,v=0;function y(e){var t;if(0===r[e]){for(r[e]=1,t=d[e];t<d[e+1];++t)y(f[t]);i[v]=e,++v}}for(void 0===n&&(r=numeric.rep([m],0)),void 0===n&&(n=numeric.linspace(0,r.length-1)),void 0===i&&(i=[]),a=n.length-1;-1!==a;--a)y(n[a]);for(i.length=v,a=i.length-1;-1!==a;--a)r[i[a]]=0;for(a=n.length-1;-1!==a;--a)o=n[a],r[o]=t[o];for(a=i.length-1;-1!==a;--a){for(o=i[a],s=d[o],l=g(d[o+1],s),u=s;u!==l;++u)if(f[u]===o){r[o]/=p[u];break}for(h=r[o],u=s;u!==l;++u)(c=f[u])!==o&&(r[c]-=h*p[u])}return r},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,r,n,i,a){var o,s,l,u=0,c=i.length,h=this.k,d=this.k1,f=this.j;if(0===n[e])for(n[e]=1,f[0]=e,h[0]=s=t[e],d[0]=l=t[e+1];;)if(s>=l){if(i[c]=f[u],0===u)return;++c,s=h[--u],l=d[u]}else 0===n[o=a[r[s]]]?(n[o]=1,h[u]=s,f[++u]=o,s=t[o],d[u]=l=t[o+1]):++s},numeric.ccsLPSolve=function(e,t,r,n,i,a,o){var s,l,u,c,h,d,f,p,m,g=e[0],v=e[1],y=e[2],_=(g.length,t[0]),b=t[1],E=t[2];for(l=_[i],u=_[i+1],n.length=0,s=l;s<u;++s)o.dfs(a[b[s]],g,v,r,n,a);for(s=n.length-1;-1!==s;--s)r[n[s]]=0;for(s=l;s!==u;++s)r[c=a[b[s]]]=E[s];for(s=n.length-1;-1!==s;--s){for(h=g[c=n[s]],d=g[c+1],f=h;f<d;++f)if(a[v[f]]===c){r[c]/=y[f];break}for(m=r[c],f=h;f<d;++f)(p=a[v[f]])!==c&&(r[p]-=m*y[f])}return r},numeric.ccsLUP1=function(e,t){var r,n,i,a,o,s,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],d=c[0],f=c[1],p=c[2],m=h[0],g=h[1],v=h[2],y=numeric.rep([u],0),_=numeric.rep([u],0),b=numeric.ccsLPSolve,E=(Math.max,Math.abs),w=numeric.linspace(0,u-1),x=numeric.linspace(0,u-1),T=new numeric.ccsDFS(u);for(void 0===t&&(t=1),r=0;r<u;++r){for(b(c,e,y,_,r,x,T),a=-1,o=-1,n=_.length-1;-1!==n;--n)(i=_[n])<=r||(s=E(y[i]))>a&&(o=i,a=s);for(E(y[r])<t*a&&(n=w[r],a=w[o],w[r]=a,x[a]=r,w[o]=n,x[n]=o,a=y[r],y[r]=y[o],y[o]=a),a=d[r],o=m[r],l=y[r],f[a]=w[r],p[a]=1,++a,n=_.length-1;-1!==n;--n)s=y[i=_[n]],_[n]=0,y[i]=0,i<=r?(g[o]=i,v[o]=s,++o):(f[a]=w[i],p[a]=s/l,++a);d[r+1]=a,m[r+1]=o}for(n=f.length-1;-1!==n;--n)f[n]=x[f[n]];return{L:c,U:h,P:w,Pinv:x}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,r,n,i,a,o){var s,l,u,c=0,h=i.length,d=this.k,f=this.k1,p=this.j;if(0===n[e])for(n[e]=1,p[0]=e,d[0]=l=t[a[e]],f[0]=u=t[a[e]+1];;){if(isNaN(l))throw new Error("Ow!");if(l>=u){if(i[h]=a[p[c]],0===c)return;++h,l=d[--c],u=f[c]}else 0===n[s=r[l]]?(n[s]=1,d[c]=l,p[++c]=s,l=t[s=a[s]],f[c]=u=t[s+1]):++l}},numeric.ccsLPSolve0=function(e,t,r,n,i,a,o,s){var l,u,c,h,d,f,p,m,g,v=e[0],y=e[1],_=e[2],b=(v.length,t[0]),E=t[1],w=t[2];for(u=b[i],c=b[i+1],n.length=0,l=u;l<c;++l)s.dfs(E[l],v,y,r,n,a,o);for(l=n.length-1;-1!==l;--l)r[o[h=n[l]]]=0;for(l=u;l!==c;++l)r[h=E[l]]=w[l];for(l=n.length-1;-1!==l;--l){for(m=o[h=n[l]],d=v[h],f=v[h+1],p=d;p<f;++p)if(y[p]===m){r[m]/=_[p];break}for(g=r[m],p=d;p<f;++p)r[y[p]]-=g*_[p];r[m]=g}},numeric.ccsLUP0=function(e,t){var r,n,i,a,o,s,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],d=c[0],f=c[1],p=c[2],m=h[0],g=h[1],v=h[2],y=numeric.rep([u],0),_=numeric.rep([u],0),b=numeric.ccsLPSolve0,E=(Math.max,Math.abs),w=numeric.linspace(0,u-1),x=numeric.linspace(0,u-1),T=new numeric.ccsDFS0(u);for(void 0===t&&(t=1),r=0;r<u;++r){for(b(c,e,y,_,r,x,w,T),a=-1,o=-1,n=_.length-1;-1!==n;--n)(i=_[n])<=r||(s=E(y[w[i]]))>a&&(o=i,a=s);for(E(y[w[r]])<t*a&&(n=w[r],a=w[o],w[r]=a,x[a]=r,w[o]=n,x[n]=o),a=d[r],o=m[r],l=y[w[r]],f[a]=w[r],p[a]=1,++a,n=_.length-1;-1!==n;--n)s=y[w[i=_[n]]],_[n]=0,y[w[i]]=0,i<=r?(g[o]=i,v[o]=s,++o):(f[a]=w[i],p[a]=s/l,++a);d[r+1]=a,m[r+1]=o}for(n=f.length-1;-1!==n;--n)f[n]=x[f[n]];return{L:c,U:h,P:w,Pinv:x}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,r){var n=numeric.ccsDim(e),i=n[0],a=n[1];void 0===t?t=numeric.linspace(0,i-1):"number"==typeof t&&(t=[t]),void 0===r?r=numeric.linspace(0,a-1):"number"==typeof r&&(r=[r]);var o,s,l,u,c=t.length,h=r.length,d=numeric.rep([a],0),f=[],p=[],m=[d,f,p],g=e[0],v=e[1],y=e[2],_=numeric.rep([i],0),b=0,E=numeric.rep([i],0);for(s=0;s<h;++s){var w=g[u=r[s]],x=g[u+1];for(o=w;o<x;++o)E[l=v[o]]=1,_[l]=y[o];for(o=0;o<c;++o)E[t[o]]&&(f[b]=o,p[b]=_[t[o]],++b);for(o=w;o<x;++o)E[l=v[o]]=0;d[s+1]=b}return m},numeric.ccsDot=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f=e[0],p=e[1],m=e[2],g=t[0],v=t[1],y=t[2],_=numeric.ccsDim(e),b=numeric.ccsDim(t),E=_[0],w=(_[1],b[1]),x=numeric.rep([E],0),T=numeric.rep([E],0),M=Array(E),S=numeric.rep([w],0),A=[],R=[],k=[S,A,R];for(i=0;i!==w;++i){for(a=g[i],o=g[i+1],c=0,n=a;n<o;++n)for(h=v[n],d=y[n],s=f[h],l=f[h+1],r=s;r<l;++r)0===T[u=p[r]]&&(M[c]=u,T[u]=1,c+=1),x[u]=x[u]+m[r]*d;for(o=(a=S[i])+c,S[i+1]=o,n=c-1;-1!==n;--n)d=a+n,r=M[n],A[d]=r,R[d]=x[r],T[r]=0,x[r]=0;S[i+1]=S[i]+c}return k},numeric.ccsLUPSolve=function(e,t){var r=e.L,n=e.U,i=(e.P,t[0]),a=!1;"object"!=typeof i&&(i=(t=[[0,t.length],numeric.linspace(0,t.length-1),t])[0],a=!0);var o,s,l,u,c,h,d=t[1],f=t[2],p=r[0].length-1,m=i.length-1,g=numeric.rep([p],0),v=Array(p),y=numeric.rep([p],0),_=Array(p),b=numeric.rep([m+1],0),E=[],w=[],x=numeric.ccsTSolve,T=0;for(o=0;o<m;++o){for(c=0,l=i[o],u=i[o+1],s=l;s<u;++s)h=e.Pinv[d[s]],_[c]=h,y[h]=f[s],++c;for(_.length=c,x(r,y,g,_,v),s=_.length-1;-1!==s;--s)y[_[s]]=0;if(x(n,g,y,v,_),a)return y;for(s=v.length-1;-1!==s;--s)g[v[s]]=0;for(s=_.length-1;-1!==s;--s)h=_[s],E[T]=h,w[T]=y[h],y[h]=0,++T;b[o+1]=T}return[b,E,w]},numeric.ccsbinop=function(e,t){return void 0===t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,r=e[0],n=e[1],i=e[2],a=numeric.sup(n)+1,o=r.length,s=numeric.rep([a],0),l=Array(o),u=Array(o),c=numeric.rep([a],0);for(t=0;t<o;++t)c[n[t]]++;for(t=0;t<a;++t)s[t+1]=s[t]+c[t];var h,d,f=s.slice(0);for(t=0;t<o;++t)l[h=f[d=n[t]]]=r[t],u[h]=i[t],f[d]=f[d]+1;return[s,l,u]},numeric.ccsGather=function(e){var t,r,n,i,a,o=e[0],s=e[1],l=e[2],u=o.length-1,c=s.length,h=Array(c),d=Array(c),f=Array(c);for(a=0,t=0;t<u;++t)for(n=o[t],i=o[t+1],r=n;r!==i;++r)d[a]=t,h[a]=s[r],f[a]=l[r],++a;return[h,d,f]},numeric.sdim=function e(t,r,n){if(void 0===r&&(r=[]),"object"!=typeof t)return r;var i;for(i in void 0===n&&(n=0),n in r||(r[n]=0),t.length>r[n]&&(r[n]=t.length),t)t.hasOwnProperty(i)&&e(t[i],r,n+1);return r},numeric.sclone=function e(t,r,n){void 0===r&&(r=0),void 0===n&&(n=numeric.sdim(t).length);var i,a=Array(t.length);if(r===n-1){for(i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);return a}for(i in t)t.hasOwnProperty(i)&&(a[i]=e(t[i],r+1,n));return a},numeric.sdiag=function(e){var t,r,n=e.length,i=Array(n);for(t=n-1;t>=1;t-=2)r=t-1,i[t]=[],i[t][t]=e[t],i[r]=[],i[r][r]=e[r];return 0===t&&(i[0]=[],i[0][0]=e[t]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,r,n,i=[];e.length;for(t in e)if(e.hasOwnProperty(t))for(r in n=e[t])n.hasOwnProperty(r)&&("object"!=typeof i[r]&&(i[r]=[]),i[r][t]=n[r]);return i},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var r,n,i,a,o,s,l,u=e.length,c=(t.length,numeric.stranspose(t)),h=c.length,d=Array(u);for(i=u-1;i>=0;i--){for(l=[],r=e[i],o=h-1;o>=0;o--){for(a in s=0,n=c[o],r)r.hasOwnProperty(a)&&a in n&&(s+=r[a]*n[a]);s&&(l[o]=s)}d[i]=l}return d},numeric.sdotMV=function(e,t){var r,n,i,a,o=e.length,s=Array(o);for(n=o-1;n>=0;n--){for(i in a=0,r=e[n])r.hasOwnProperty(i)&&t[i]&&(a+=r[i]*t[i]);a&&(s[n]=a)}return s},numeric.sdotVM=function(e,t){var r,n,i,a,o=[];for(r in e)if(e.hasOwnProperty(r))for(n in i=t[r],a=e[r],i)i.hasOwnProperty(n)&&(o[n]||(o[n]=0),o[n]+=a*i[n]);return o},numeric.sdotVV=function(e,t){var r,n=0;for(r in e)e[r]&&t[r]&&(n+=e[r]*t[r]);return n},numeric.sdot=function(e,t){var r=numeric.sdim(e).length,n=numeric.sdim(t).length;switch(1e3*r+n){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+r+" and "+n)}},numeric.sscatter=function(e){var t,r,n,i,a=e[0].length,o=e.length,s=[];for(r=a-1;r>=0;--r)if(e[o-1][r]){for(i=s,n=0;n<o-2;n++)i[t=e[n][r]]||(i[t]=[]),i=i[t];i[e[n][r]]=e[n+1][r]}return s},numeric.sgather=function e(t,r,n){var i,a,o;for(a in void 0===r&&(r=[]),void 0===n&&(n=[]),i=n.length,t)if(t.hasOwnProperty(a))if(n[i]=parseInt(a),"number"==typeof(o=t[a])){if(o){if(0===r.length)for(a=i+1;a>=0;--a)r[a]=[];for(a=i;a>=0;--a)r[a].push(n[a]);r[i+1].push(o)}}else e(o,r,n);return n.length>i&&n.pop(),r},numeric.cLU=function(e){var t,r,n,i,a,o,s=e[0],l=e[1],u=e[2],c=s.length,h=0;for(t=0;t<c;t++)s[t]>h&&(h=s[t]);h++;var d,f=Array(h),p=Array(h),m=numeric.rep([h],1/0),g=numeric.rep([h],-1/0);for(n=0;n<c;n++)t=s[n],(r=l[n])<m[t]&&(m[t]=r),r>g[t]&&(g[t]=r);for(t=0;t<h-1;t++)g[t]>g[t+1]&&(g[t+1]=g[t]);for(t=h-1;t>=1;t--)m[t]<m[t-1]&&(m[t-1]=m[t]);for(t=0;t<h;t++)p[t]=numeric.rep([g[t]-m[t]+1],0),f[t]=numeric.rep([t-m[t]],0),t-m[t]+1,g[t]-t+1;for(n=0;n<c;n++)p[t=s[n]][l[n]-m[t]]=u[n];for(t=0;t<h-1;t++)for(i=t-m[t],_=p[t],r=t+1;m[r]<=t&&r<h;r++)if(a=t-m[r],o=g[t]-t,d=(b=p[r])[a]/_[i]){for(n=1;n<=o;n++)b[n+a]-=d*_[n+i];f[r][t-m[r]]=d}var v,y,_=[],b=[],E=[],w=[],x=[],T=[];for(c=0,v=0,t=0;t<h;t++){for(i=m[t],a=g[t],y=p[t],r=t;r<=a;r++)y[r-i]&&(_[c]=t,b[c]=r,E[c]=y[r-i],c++);for(y=f[t],r=i;r<t;r++)y[r-i]&&(w[v]=t,x[v]=r,T[v]=y[r-i],v++);w[v]=t,x[v]=t,T[v]=1,v++}return{U:[_,b,E],L:[w,x,T]}},numeric.cLUsolve=function(e,t){var r,n,i=e.L,a=e.U,o=numeric.clone(t),s=i[0],l=i[1],u=i[2],c=a[0],h=a[1],d=a[2],f=c.length,p=(s.length,o.length);for(n=0,r=0;r<p;r++){for(;l[n]<r;)o[r]-=u[n]*o[l[n]],n++;n++}for(n=f-1,r=p-1;r>=0;r--){for(;h[n]>r;)o[r]-=d[n]*o[h[n]],n--;o[r]/=d[n],n--}return o},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var r,n,i,a=numeric.rep(e,-1);if("function"!=typeof t)switch(t){case"L":t=function(t,r){return t>=e[0]/2||r<e[1]/2};break;default:t=function(e,t){return!0}}for(i=0,r=1;r<e[0]-1;r++)for(n=1;n<e[1]-1;n++)t(r,n)&&(a[r][n]=i,i++);return a},numeric.cdelsq=function(e){var t,r,n,i,a,o=[[-1,0],[0,-1],[0,1],[1,0]],s=numeric.dim(e),l=s[0],u=s[1],c=[],h=[],d=[];for(t=1;t<l-1;t++)for(r=1;r<u-1;r++)if(!(e[t][r]<0)){for(n=0;n<4;n++)i=t+o[n][0],a=r+o[n][1],e[i][a]<0||(c.push(e[t][r]),h.push(e[i][a]),d.push(-1));c.push(e[t][r]),h.push(e[t][r]),d.push(4)}return[c,h,d]},numeric.cdotMV=function(e,t){var r,n,i,a=e[0],o=e[1],s=e[2],l=a.length;for(i=0,n=0;n<l;n++)a[n]>i&&(i=a[n]);for(i++,r=numeric.rep([i],0),n=0;n<l;n++)r[a[n]]+=s[n]*t[o[n]];return r},numeric.Spline=function(e,t,r,n,i){this.x=e,this.yl=t,this.yr=r,this.kl=n,this.kr=i},numeric.Spline.prototype._at=function(e,t){var r,n,i,a=this.x,o=this.yl,s=this.yr,l=this.kl,u=this.kr,c=numeric.add,h=numeric.sub,d=numeric.mul;r=h(d(l[t],a[t+1]-a[t]),h(s[t+1],o[t])),n=c(d(u[t+1],a[t]-a[t+1]),h(s[t+1],o[t]));var f=(i=(e-a[t])/(a[t+1]-a[t]))*(1-i);return c(c(c(d(1-i,o[t]),d(i,s[t+1])),d(r,f*(1-i))),d(n,f*i))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,r,n,i=this.x,a=i.length,o=Math.floor;for(t=0,r=a-1;r-t>1;)i[n=o((t+r)/2)]<=e?t=n:r=n;return this._at(e,t)}a=e.length;var s,l=Array(a);for(s=a-1;-1!==s;--s)l[s]=this.at(e[s]);return l},numeric.Spline.prototype.diff=function(){var e,t,r,n=this.x,i=this.yl,a=this.yr,o=this.kl,s=this.kr,l=i.length,u=o,c=s,h=Array(l),d=Array(l),f=numeric.add,p=numeric.mul,m=numeric.div,g=numeric.sub;for(e=l-1;-1!==e;--e)t=n[e+1]-n[e],r=g(a[e+1],i[e]),h[e]=m(f(p(r,6),p(o[e],-4*t),p(s[e+1],-2*t)),t*t),d[e+1]=m(f(p(r,-6),p(o[e],2*t),p(s[e+1],4*t)),t*t);return new numeric.Spline(n,u,c,h,d)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],r=this.x,n=this.yl,i=this.yr,a=this.kl,o=this.kr;"number"==typeof n[0]&&(n=[n],i=[i],a=[a],o=[o]);var s,l,u,c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S,A,R,k,P=n.length,L=r.length-1,C=(t=Array(P),Math.sqrt);for(s=0;s!==P;++s){for(c=n[s],h=i[s],d=a[s],f=o[s],p=[],l=0;l!==L;l++){for(l>0&&h[l]*c[l]<0&&p.push(r[l]),w=r[l+1]-r[l],r[l],v=c[l],y=h[l+1],m=d[l]/w,_=(g=f[l+1]/w)+3*v+2*m-3*y,b=3*(g+m+2*(v-y)),(E=e(m-g+3*(v-y))+12*g*v)<=0?x=(T=_/b)>r[l]&&T<r[l+1]?[r[l],T,r[l+1]]:[r[l],r[l+1]]:(T=(_-C(E))/b,M=(_+C(E))/b,x=[r[l]],T>r[l]&&T<r[l+1]&&x.push(T),M>r[l]&&M<r[l+1]&&x.push(M),x.push(r[l+1])),A=x[0],T=this._at(A,l),u=0;u<x.length-1;u++)if(R=x[u+1],M=this._at(R,l),0!==T)if(0===M||T*M>0)A=R,T=M;else{for(var I=0;!((k=(T*R-M*A)/(T-M))<=A||k>=R);)if((S=this._at(k,l))*M>0)R=k,M=S,-1===I&&(T*=.5),I=-1;else{if(!(S*T>0))break;A=k,T=S,1===I&&(M*=.5),I=1}p.push(k),A=x[u+1],T=this._at(A,l)}else p.push(A),A=R,T=M;0===M&&p.push(R)}t[s]=p}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,r,n){var i,a=e.length,o=[],s=[],l=[],u=numeric.sub,c=numeric.mul,h=numeric.add;for(i=a-2;i>=0;i--)s[i]=e[i+1]-e[i],l[i]=u(t[i+1],t[i]);"string"!=typeof r&&"string"!=typeof n||(r=n="periodic");var d=[[],[],[]];switch(typeof r){case"undefined":o[0]=c(3/(s[0]*s[0]),l[0]),d[0].push(0,0),d[1].push(0,1),d[2].push(2/s[0],1/s[0]);break;case"string":o[0]=h(c(3/(s[a-2]*s[a-2]),l[a-2]),c(3/(s[0]*s[0]),l[0])),d[0].push(0,0,0),d[1].push(a-2,0,1),d[2].push(1/s[a-2],2/s[a-2]+2/s[0],1/s[0]);break;default:o[0]=r,d[0].push(0),d[1].push(0),d[2].push(1)}for(i=1;i<a-1;i++)o[i]=h(c(3/(s[i-1]*s[i-1]),l[i-1]),c(3/(s[i]*s[i]),l[i])),d[0].push(i,i,i),d[1].push(i-1,i,i+1),d[2].push(1/s[i-1],2/s[i-1]+2/s[i],1/s[i]);switch(typeof n){case"undefined":o[a-1]=c(3/(s[a-2]*s[a-2]),l[a-2]),d[0].push(a-1,a-1),d[1].push(a-2,a-1),d[2].push(1/s[a-2],2/s[a-2]);break;case"string":d[1][d[1].length-1]=0;break;default:o[a-1]=n,d[0].push(a-1),d[1].push(a-1),d[2].push(1)}o="number"!=typeof o[0]?numeric.transpose(o):[o];var f=Array(o.length);if("string"==typeof r)for(i=f.length-1;-1!==i;--i)f[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(d)),o[i]),f[i][a-1]=f[i][0];else for(i=f.length-1;-1!==i;--i)f[i]=numeric.cLUsolve(numeric.cLU(d),o[i]);return f="number"==typeof t[0]?f[0]:numeric.transpose(f),new numeric.Spline(e,t,t,f,f)},numeric.fftpow2=function e(t,r){var n=t.length;if(1!==n){var i,a,o=Math.cos,s=Math.sin,l=Array(n/2),u=Array(n/2),c=Array(n/2),h=Array(n/2);for(a=n/2,i=n-1;-1!==i;--i)c[--a]=t[i],h[a]=r[i],--i,l[a]=t[i],u[a]=r[i];e(l,u),e(c,h),a=n/2;var d,f,p,m=-6.283185307179586/n;for(i=n-1;-1!==i;--i)-1===--a&&(a=n/2-1),f=o(d=m*i),p=s(d),t[i]=l[a]+f*c[a]-p*h[a],r[i]=u[a]+f*h[a]+p*c[a]}},numeric._ifftpow2=function e(t,r){var n=t.length;if(1!==n){var i,a,o=Math.cos,s=Math.sin,l=Array(n/2),u=Array(n/2),c=Array(n/2),h=Array(n/2);for(a=n/2,i=n-1;-1!==i;--i)c[--a]=t[i],h[a]=r[i],--i,l[a]=t[i],u[a]=r[i];e(l,u),e(c,h),a=n/2;var d,f,p,m=6.283185307179586/n;for(i=n-1;-1!==i;--i)-1===--a&&(a=n/2-1),f=o(d=m*i),p=s(d),t[i]=l[a]+f*c[a]-p*h[a],r[i]=u[a]+f*h[a]+p*c[a]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,r,n){var i,a,o,s,l;for(numeric.fftpow2(e,t),numeric.fftpow2(r,n),i=e.length-1;-1!==i;--i)a=e[i],s=t[i],o=r[i],l=n[i],e[i]=a*o-s*l,t[i]=a*l+s*o;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,r=this.x,n=this.y,i=r.length,a=Math.log,o=a(2),s=Math.ceil(a(2*i-1)/o),l=Math.pow(2,s),u=numeric.rep([l],0),c=numeric.rep([l],0),h=Math.cos,d=Math.sin,f=-3.141592653589793/i,p=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(i/2);for(e=0;e<i;e++)p[e]=r[e];if(void 0!==n)for(e=0;e<i;e++)m[e]=n[e];for(u[0]=1,e=1;e<=l/2;e++)t=f*e*e,u[e]=h(t),c[e]=d(t),u[l-e]=h(t),c[l-e]=d(t);var g=new numeric.T(p,m),v=new numeric.T(u,c);return g=g.mul(v),numeric.convpow2(g.x,g.y,numeric.clone(v.x),numeric.neg(v.y)),(g=g.mul(v)).x.length=i,g.y.length=i,g},numeric.T.prototype.ifft=function(){var e,t,r=this.x,n=this.y,i=r.length,a=Math.log,o=a(2),s=Math.ceil(a(2*i-1)/o),l=Math.pow(2,s),u=numeric.rep([l],0),c=numeric.rep([l],0),h=Math.cos,d=Math.sin,f=3.141592653589793/i,p=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(i/2);for(e=0;e<i;e++)p[e]=r[e];if(void 0!==n)for(e=0;e<i;e++)m[e]=n[e];for(u[0]=1,e=1;e<=l/2;e++)t=f*e*e,u[e]=h(t),c[e]=d(t),u[l-e]=h(t),c[l-e]=d(t);var g=new numeric.T(p,m),v=new numeric.T(u,c);return g=g.mul(v),numeric.convpow2(g.x,g.y,numeric.clone(v.x),numeric.neg(v.y)),(g=g.mul(v)).x.length=i,g.y.length=i,g.div(i)},numeric.gradient=function(e,t){var r=t.length,n=e(t);if(isNaN(n))throw new Error("gradient: f(x) is a NaN!");var i,a,o,s,l,u,c,h,d,f=Math.max,p=numeric.clone(t),m=Array(r),g=(numeric.div,numeric.sub,f=Math.max,Math.abs),v=Math.min,y=0;for(i=0;i<r;i++)for(var _=f(1e-6*n,1e-8);;){if(++y>20)throw new Error("Numerical gradient fails");if(p[i]=t[i]+_,a=e(p),p[i]=t[i]-_,o=e(p),p[i]=t[i],isNaN(a)||isNaN(o))_/=16;else{if(m[i]=(a-o)/(2*_),s=t[i]-_,l=t[i],u=t[i]+_,c=(a-n)/_,h=(n-o)/_,d=f(g(m[i]),g(n),g(a),g(o),g(s),g(l),g(u),1e-8),!(v(f(g(c-m[i]),g(h-m[i]),g(c-h))/d,_/d)>.001))break;_/=16}}return m},numeric.uncmin=function(e,t,r,n,i,a,o){var s=numeric.gradient;void 0===o&&(o={}),void 0===r&&(r=1e-8),void 0===n&&(n=function(t){return s(e,t)}),void 0===i&&(i=1e3);var l,u,c=(t=numeric.clone(t)).length,h=e(t);if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var d=Math.max,f=numeric.norm2;r=d(r,numeric.epsilon);var p,m,g,v,y,_,b,E,w,x,T=o.Hinv||numeric.identity(c),M=numeric.dot,S=(numeric.inv,numeric.sub),A=numeric.add,R=numeric.tensor,k=numeric.div,P=numeric.mul,L=numeric.all,C=numeric.isFinite,I=numeric.neg,H=0,O="";for(m=n(t);H<i;){if("function"==typeof a&&a(H,t,h,m,T)){O="Callback returned true";break}if(!L(C(m))){O="Gradient has Infinity or NaN";break}if(!L(C(p=I(M(T,m))))){O="Search direction has Infinity or NaN";break}if((x=f(p))<r){O="Newton step smaller than tol";break}for(w=1,u=M(m,p),y=t;H<i&&!(w*x<r)&&(y=A(t,v=P(p,w)),(l=e(y))-h>=.1*w*u||isNaN(l));)w*=.5,++H;if(w*x<r){O="Line search step size smaller than tol";break}if(H===i){O="maxit reached during line search";break}E=M(_=S(g=n(y),m),v),b=M(T,_),T=S(A(T,P((E+M(_,b))/(E*E),R(v,v))),k(A(R(b,v),R(v,b)),E)),t=y,h=l,m=g,++H}return{solution:t,f:h,gradient:m,invHessian:T,iterations:H,message:O}},numeric.Dopri=function(e,t,r,n,i,a,o){this.x=e,this.y=t,this.f=r,this.ymid=n,this.iterations=i,this.events=o,this.message=a},numeric.Dopri.prototype._at=function(e,t){function r(e){return e*e}var n,i,a,o,s,l,u,c,h,d=this.x,f=this.y,p=this.f,m=this.ymid,g=(d.length,Math.floor,numeric.add),v=numeric.mul,y=numeric.sub;return n=d[t],i=d[t+1],o=f[t],s=f[t+1],a=n+.5*(i-n),l=m[t],u=y(p[t],v(o,1/(n-a)+2/(n-i))),c=y(p[t+1],v(s,1/(i-a)+2/(i-n))),g(g(g(g(v(o,(h=[r(e-i)*(e-a)/r(n-i)/(n-a),r(e-n)*r(e-i)/r(n-a)/r(i-a),r(e-n)*(e-a)/r(i-n)/(i-a),(e-n)*r(e-i)*(e-a)/r(n-i)/(n-a),(e-i)*r(e-n)*(e-a)/r(n-i)/(i-a)])[0]),v(l,h[1])),v(s,h[2])),v(u,h[3])),v(c,h[4]))},numeric.Dopri.prototype.at=function(e){var t,r,n,i=Math.floor;if("number"!=typeof e){var a=e.length,o=Array(a);for(t=a-1;-1!==t;--t)o[t]=this.at(e[t]);return o}var s=this.x;for(t=0,r=s.length-1;r-t>1;)s[n=i(.5*(t+r))]<=e?t=n:r=n;return this._at(e,t)},numeric.dopri=function(e,t,r,n,i,a,o){void 0===i&&(i=1e-6),void 0===a&&(a=1e3);var s,l,u,c,h,d,f,p,m,g,v,y,_,b=[e],E=[r],w=[n(e,r)],x=[],T=[3/40,9/40],M=[44/45,-56/15,32/9],S=[19372/6561,-25360/2187,64448/6561,-212/729],A=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],R=[35/384,0,500/1113,125/192,-2187/6784,11/84],k=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],P=[.2,.3,.8,8/9,1,1],L=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],C=0,I=(t-e)/10,H=0,O=numeric.add,D=numeric.mul,F=(Math.max,Math.min),N=Math.abs,U=numeric.norminf,B=Math.pow,z=numeric.any,j=numeric.lt,V=numeric.and,G=(numeric.sub,new numeric.Dopri(b,E,w,x,-1,""));for("function"==typeof o&&(v=o(e,r));e<t&&H<a;)if(++H,e+I>t&&(I=t-e),s=n(e+P[0]*I,O(r,D(.2*I,w[C]))),l=n(e+P[1]*I,O(O(r,D(T[0]*I,w[C])),D(T[1]*I,s))),u=n(e+P[2]*I,O(O(O(r,D(M[0]*I,w[C])),D(M[1]*I,s)),D(M[2]*I,l))),c=n(e+P[3]*I,O(O(O(O(r,D(S[0]*I,w[C])),D(S[1]*I,s)),D(S[2]*I,l)),D(S[3]*I,u))),h=n(e+P[4]*I,O(O(O(O(O(r,D(A[0]*I,w[C])),D(A[1]*I,s)),D(A[2]*I,l)),D(A[3]*I,u)),D(A[4]*I,c))),d=n(e+I,m=O(O(O(O(O(r,D(w[C],I*R[0])),D(l,I*R[2])),D(u,I*R[3])),D(c,I*R[4])),D(h,I*R[5]))),(g="number"==typeof(f=O(O(O(O(O(D(w[C],I*L[0]),D(l,I*L[2])),D(u,I*L[3])),D(c,I*L[4])),D(h,I*L[5])),D(d,I*L[6])))?N(f):U(f))>i){if(e+(I=.2*I*B(i/g,.25))===e){G.msg="Step size became too small";break}}else{if(x[C]=O(O(O(O(O(O(r,D(w[C],I*k[0])),D(l,I*k[2])),D(u,I*k[3])),D(c,I*k[4])),D(h,I*k[5])),D(d,I*k[6])),b[++C]=e+I,E[C]=m,w[C]=d,"function"==typeof o){var W,X,Y=e,q=e+.5*I;if(y=o(q,x[C-1]),z(_=V(j(v,0),j(0,y)))||(Y=q,v=y,y=o(q=e+I,m),_=V(j(v,0),j(0,y))),z(_)){for(var Z,K,Q=0,J=1,$=1;;){if("number"==typeof v)X=($*y*Y-J*v*q)/($*y-J*v);else for(X=q,p=v.length-1;-1!==p;--p)v[p]<0&&y[p]>0&&(X=F(X,($*y[p]*Y-J*v[p]*q)/($*y[p]-J*v[p])));if(X<=Y||X>=q)break;K=o(X,W=G._at(X,C-1)),z(Z=V(j(v,0),j(0,K)))?(q=X,y=K,_=Z,$=1,-1===Q?J*=.5:J=1,Q=-1):(Y=X,v=K,J=1,1===Q?$*=.5:$=1,Q=1)}return m=G._at(.5*(e+X),C-1),G.f[C]=n(X,W),G.x[C]=X,G.y[C]=W,G.ymid[C-1]=m,G.events=_,G.iterations=H,G}}e+=I,r=m,v=y,I=F(.8*I*B(i/g,.25),4*I)}return G.iterations=H,G},numeric.LU=function(e,t){t=t||!1;var r,n,i,a,o,s,l,u,c,h=Math.abs,d=e.length,f=d-1,p=new Array(d);for(t||(e=numeric.clone(e)),i=0;i<d;++i){for(l=i,c=h((s=e[i])[i]),n=i+1;n<d;++n)c<(a=h(e[n][i]))&&(c=a,l=n);for(p[i]=l,l!=i&&(e[i]=e[l],e[l]=s,s=e[i]),o=s[i],r=i+1;r<d;++r)e[r][i]/=o;for(r=i+1;r<d;++r){for(u=e[r],n=i+1;n<f;++n)u[n]-=u[i]*s[n],u[++n]-=u[i]*s[n];n===f&&(u[n]-=u[i]*s[n])}}return{LU:e,P:p}},numeric.LUsolve=function(e,t){var r,n,i,a,o,s=e.LU,l=s.length,u=numeric.clone(t),c=e.P;for(r=l-1;-1!==r;--r)u[r]=t[r];for(r=0;r<l;++r)for(i=c[r],c[r]!==r&&(o=u[r],u[r]=u[i],u[i]=o),a=s[r],n=0;n<r;++n)u[r]-=u[n]*a[n];for(r=l-1;r>=0;--r){for(a=s[r],n=r+1;n<l;++n)u[r]-=u[n]*a[n];u[r]/=a[r]}return u},numeric.solve=function(e,t,r){return numeric.LUsolve(numeric.LU(e,r),t)},numeric.echelonize=function(e){var t,r,n,i,a,o,s,l,u=numeric.dim(e),c=u[0],h=u[1],d=numeric.identity(c),f=Array(c),p=Math.abs,m=numeric.diveq;for(e=numeric.clone(e),t=0;t<c;++t){for(n=0,a=e[t],o=d[t],r=1;r<h;++r)p(a[n])<p(a[r])&&(n=r);for(f[t]=n,m(o,a[n]),m(a,a[n]),r=0;r<c;++r)if(r!==t){for(l=(s=e[r])[n],i=h-1;-1!==i;--i)s[i]-=a[i]*l;for(s=d[r],i=c-1;-1!==i;--i)s[i]-=o[i]*l}}return{I:d,A:e,P:f}},numeric.__solveLP=function(e,t,r,n,i,a,o){var s,l,u,c,h=numeric.sum,d=(numeric.log,numeric.mul),f=numeric.sub,p=numeric.dot,m=numeric.div,g=numeric.add,v=e.length,y=r.length,_=!1,b=1,E=(numeric.transpose(t),numeric.svd,numeric.transpose),w=(numeric.leq,Math.sqrt),x=Math.abs,T=(numeric.muleq,numeric.norminf,numeric.any,Math.min),M=numeric.all,S=numeric.gt,A=Array(v),R=Array(y),k=(numeric.rep([y],1),numeric.solve),P=f(r,p(t,a)),L=p(e,e);for(u=0;u<i;++u){var C,I;for(C=y-1;-1!==C;--C)R[C]=m(t[C],P[C]);var H=E(R);for(C=v-1;-1!==C;--C)A[C]=h(H[C]);b=.25*x(L/p(e,A));var O=100*w(L/p(A,A));for((!isFinite(b)||b>O)&&(b=O),c=g(e,d(b,A)),l=p(H,R),C=v-1;-1!==C;--C)l[C][C]+=1;I=k(l,m(c,b),!0);var D=m(P,p(t,I)),F=1;for(C=y-1;-1!==C;--C)D[C]<0&&(F=T(F,-.999*D[C]));if(s=f(a,d(I,F)),!M(S(P=f(r,p(t,s)),0)))return{solution:a,message:"",iterations:u};if(a=s,b<n)return{solution:s,message:"",iterations:u};if(o){var N=p(e,c),U=p(t,c);for(_=!0,C=y-1;-1!==C;--C)if(N*U[C]<0){_=!1;break}}else _=!(a[v-1]>=0);if(_)return{solution:s,message:"Unbounded",iterations:u}}return{solution:a,message:"maximum iteration count exceeded",iterations:u}},numeric._solveLP=function(e,t,r,n,i){var a=e.length,o=r.length,s=(numeric.sum,numeric.log,numeric.mul,numeric.sub),l=numeric.dot,u=(numeric.div,numeric.add,numeric.rep([a],0).concat([1])),c=numeric.rep([o,1],-1),h=numeric.blockMatrix([[t,c]]),d=r,f=numeric.rep([a],0).concat(Math.max(0,numeric.sup(numeric.neg(r)))+1),p=numeric.__solveLP(u,h,d,n,i,f,!1),m=numeric.clone(p.solution);if(m.length=a,numeric.inf(s(r,l(t,m)))<0)return{solution:NaN,message:"Infeasible",iterations:p.iterations};var g=numeric.__solveLP(e,t,r,n,i-p.iterations,m,!0);return g.iterations+=p.iterations,g},numeric.solveLP=function(e,t,r,n,i,a,o){if(void 0===o&&(o=1e3),void 0===a&&(a=numeric.epsilon),void 0===n)return numeric._solveLP(e,t,r,a,o);var s,l=n.length,u=n[0].length,c=t.length,h=numeric.echelonize(n),d=numeric.rep([u],0),f=h.P,p=[];for(s=f.length-1;-1!==s;--s)d[f[s]]=1;for(s=u-1;-1!==s;--s)0===d[s]&&p.push(s);var m=numeric.getRange,g=numeric.linspace(0,l-1),v=numeric.linspace(0,c-1),y=m(n,g,p),_=m(t,v,f),b=m(t,v,p),E=numeric.dot,w=numeric.sub,x=E(_,h.I),T=w(b,E(x,y)),M=w(r,E(x,i)),S=Array(f.length),A=Array(p.length);for(s=f.length-1;-1!==s;--s)S[s]=e[f[s]];for(s=p.length-1;-1!==s;--s)A[s]=e[p[s]];var R=w(A,E(S,E(h.I,y))),k=numeric._solveLP(R,T,M,a,o),P=k.solution;if(P!=P)return k;var L=E(h.I,w(i,E(y,P))),C=Array(e.length);for(s=f.length-1;-1!==s;--s)C[f[s]]=L[s];for(s=p.length-1;-1!==s;--s)C[p[s]]=P[s];return{solution:C,message:k.message,iterations:k.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var t,r,n,i,a=0,o=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],s=e.length,l=0,u={},c=[],h=0,d={},f=0,p=[],m=[],g=[];function v(r){throw new Error("MPStoLP: "+r+"\nLine "+t+": "+e[t]+"\nCurrent state: "+o[a]+"\n")}for(t=0;t<s;++t){var y=(n=e[t]).match(/\S*/g),_=[];for(r=0;r<y.length;++r)""!==y[r]&&_.push(y[r]);if(0!==_.length){for(r=0;r<o.length&&n.substr(0,o[r].length)!==o[r];++r);if(r<o.length){if(a=r,1===r&&(i=_[1]),6===r)return{name:i,c:p,A:numeric.transpose(m),b:g,rows:u,vars:d}}else switch(a){case 0:case 1:v("Unexpected line");case 2:switch(_[0]){case"N":0===l?l=_[1]:v("Two or more N rows");break;case"L":u[_[1]]=h,c[h]=1,g[h]=0,++h;break;case"G":u[_[1]]=h,c[h]=-1,g[h]=0,++h;break;case"E":u[_[1]]=h,c[h]=0,g[h]=0,++h;break;default:v("Parse error "+numeric.prettyPrint(_))}break;case 3:d.hasOwnProperty(_[0])||(d[_[0]]=f,p[f]=0,m[f]=numeric.rep([h],0),++f);var b=d[_[0]];for(r=1;r<_.length;r+=2)if(_[r]!==l){var E=u[_[r]];m[b][E]=(c[E]<0?-1:1)*parseFloat(_[r+1])}else p[b]=parseFloat(_[r+1]);break;case 4:for(r=1;r<_.length;r+=2)g[u[_[r]]]=(c[u[_[r]]]<0?-1:1)*parseFloat(_[r+1]);break;case 5:break;case 6:v("Internal error")}}}v("Reached end of file without ENDATA")}}).call(this,__webpack_require__(5))},function(e,t,r){r(36);e.exports=function(e,t,r){var n=e.closestCells(r);if(!n)return Number.NaN;if(n.distance<1e-6)return 0;for(var i=0,a=!1,o=n.cells,s=n.points,l=0;l<o.length;++l){for(var u=0,c=0,h=s[l],d=t[o[l]],f=0;f<r.length;++f){var p=h[f]-r[f];u+=p*p,c+=d[f]*p}(c/=Math.sqrt(u))<0?(c=-c)>i&&(i=c,a=!0):c>i&&(i=c,a=!1)}var m=Math.sqrt(n.distance);return a?m:-m}},function(e,t,r){"use strict";var n=r(6),i=r(33).CROSS_STENCIL,a=n.beginStencil;function o(e,t){for(var r=t[0],n=0;n<t.length;++n)for(var i=t[n]+1,a=n<t.length-1?t[n+1]:e.length,o=i;o<a;++o)e[r++]=e[o];e.length=e.length-t.length}t.resort=function(e){for(var t=e.coords,r=e.phases,n=e.distances,i=(e.length(),new Array(e.length)),a=0;a<e.length();++a)i[a]=[t[0][a],t[1][a],t[2][a],n[a],r[a]];i.sort(rle.compareCoord);for(a=0;a<e.length;++a){var o=i[a];t[0][a]=o[0],t[1][a]=o[1],t[2][a]=o[2],n[a]=o[3],r[a]=o[4]}return e},t.resurface=function(e){return e},t.removeDuplicates=function(e){var t=[],r=e.coords,n=e.distances,s=e.phases,l=a(e,i),u=l.coord,c=l.ptrs;l.next();e:for(;l.hasNext();l.next()){for(var h=l.ptrs[0],d=0;d<3;++d)if(u[d]!==r[d][h])continue e;var f=s[h];for(d=1;d<7;++d)if(f!==s[c[d]])continue e;t.push(h)}if(t.length>0){for(d=0;d<3;++d)o(r[d],t);o(n,t),o(s,t)}return e},t.fullRepair=function(e){t.resort(e),t.resurface(e),t.removeDuplicates(e)}},function(e,t,r){"use strict";e.exports=function(e,t){var r=0|e.length,n=0|t.length;if(1===r&&1===n)return function(e,t){var r=e+t,n=r-e,i=e-(r-n)+(t-n);if(i)return[i,r];return[r]}(e[0],t[0]);var i,a,o=new Array(r+n),s=0,l=0,u=0,c=Math.abs,h=e[l],d=c(h),f=t[u],p=c(f);d<p?(a=h,(l+=1)<r&&(h=e[l],d=c(h))):(a=f,(u+=1)<n&&(f=t[u],p=c(f)));l<r&&d<p||u>=n?(i=h,(l+=1)<r&&(h=e[l],d=c(h))):(i=f,(u+=1)<n&&(f=t[u],p=c(f)));var m,g,v=i+a,y=v-i,_=a-y,b=_,E=v;for(;l<r&&u<n;)d<p?(i=h,(l+=1)<r&&(h=e[l],d=c(h))):(i=f,(u+=1)<n&&(f=t[u],p=c(f))),(_=(a=b)-(y=(v=i+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m;for(;l<r;)(_=(a=b)-(y=(v=(i=h)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(l+=1)<r&&(h=e[l]);for(;u<n;)(_=(a=b)-(y=(v=(i=f)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(u+=1)<n&&(f=t[u]);b&&(o[s++]=b);E&&(o[s++]=E);s||(o[s++]=0);return o.length=s,o}},function(e,t,r){"use strict";var n=r(22),i=r(162);e.exports=function(e,t){var r=e.length;if(1===r){var a=n(e[0],t);return a[0]?a:[a[1]]}var o=new Array(2*r),s=[.1,.1],l=[.1,.1],u=0;n(e[0],t,s),s[0]&&(o[u++]=s[0]);for(var c=1;c<r;++c){n(e[c],t,l);var h=s[1];i(h,l[0],s),s[0]&&(o[u++]=s[0]);var d=l[1],f=s[1],p=d+f,m=f-(p-d);s[1]=p,m&&(o[u++]=m)}s[1]&&(o[u++]=s[1]);0===u&&(o[u++]=0);return o.length=u,o}},function(e,t,r){"use strict";e.exports=function(e,t,r,i){var a=function(e,t,r){return new l(e.length,function(e){for(var t=e.length,r=n.mallocInt32(o(3*t)),i=0,a=0;a<t;++a)for(var s=e[a],l=0;l<3;++l)r[i++]=s[l];return r}(e),t.length,h(t),h(r))}(e,t,r);w(a,i);var s=a.unpack();return a.dispose(),s},e.exports.packed=w;var n=r(1),i=r(10),a=r(165),o=r(42);function s(e,t,r,n,i,a){return Math.pow(e-n,2)+Math.pow(t-i,2)+Math.pow(r-a,2)}function l(e,t,r,n,i){this.numCells=e,this.cells=t,this.numVerts=r,this.verts=n,this.normals=i}var u=l.prototype;function c(e,t){for(var r=new Array(e),n=0;n<e;++n)r[n]=[t[3*n],t[3*n+1],t[3*n+2]];return r}function h(e){for(var t=e.length,r=n.mallocFloat32(o(3*t)),i=0,a=0;a<t;++a)for(var s=e[a],l=0;l<3;++l)r[i++]=s[l];return r}u.unpack=function(){return{cells:c(this.numCells,this.cells),positions:c(this.numVerts,this.verts),normals:c(this.numVerts,this.normals)}},u.dispose=function(){n.free(this.cells),n.free(this.verts),n.free(this.normals)};function d(e,t,r){if(e.length>=t)return e;t=o(t);for(var i=n.mallocFloat32(t),a=0;a<r;++a)i[a]=e[a];return n.free(e),i}function f(e,t,r,n){for(var i=0;i<3;++i){var a=e[3*t+i];if(a!==r&&a!==n)return i}return-1}var p=[-1,-1,-1,-1,-1];function m(e,t,r,l){for(var u=0;u<r;++u){for(var c=e.numCells,h=e.cells,m=e.numVerts,g=e.verts,v=e.normals,y=3*c,_=0,b=n.mallocInt32(3*y),E=0;E<c;++E){var w=h[3*E],x=h[3*E+1],T=h[3*E+2],M=g[3*w],S=g[3*w+1],A=g[3*w+2],R=g[3*x],k=g[3*x+1],P=g[3*x+2],L=g[3*T],C=g[3*T+1],I=g[3*T+2];s(M,S,A,R,k,P)>t&&(b[_++]=Math.min(w,x),b[_++]=Math.max(w,x),b[_++]=E),s(R,k,P,L,C,I)>t&&(b[_++]=Math.min(x,T),b[_++]=Math.max(x,T),b[_++]=E),s(L,C,I,M,S,A)>t&&(b[_++]=Math.min(T,w),b[_++]=Math.max(T,w),b[_++]=E)}if(_<3*l)return n.free(b),u>0;var H=_/3|0;a(i(b,[H,3],[3,1],0)),g=d(g,3*(H+m),3*m),v=d(v,3*(H+m),3*m);var O=0,D=-1,F=-1,N=-1;for(E=0;E<_;E+=3){w=b[E],x=b[E+1];var U=b[E+2];if(w===D&&x===F){var B=m++;g[3*B]=.5*(g[3*w]+g[3*x]),g[3*B+1]=.5*(g[3*w+1]+g[3*x+1]),g[3*B+2]=.5*(g[3*w+2]+g[3*x+2]);var z=v[3*w],j=v[3*w+1],V=v[3*w+2],G=.5*(z+v[3*x]),W=.5*(j+v[3*x+1]),X=.5*(V+v[3*x+2]),Y=Math.pow(G,2)+Math.pow(W,2)+Math.pow(X,2);Y>1e-6?(Y=1/Math.sqrt(Y),v[3*B]=G*Y,v[3*B+1]=W*Y,v[3*B+2]=X*Y):(v[3*B]=z,v[3*B+1]=j,v[3*B+2]=V),b[O++]=4*U+f(h,U,w,x),b[O++]=B,b[O++]=4*N+f(h,N,w,x),b[O++]=B}D=w,F=x,N=U}var q=O/2|0;if(q<l)return n.free(b),u>0;a(i(b,[q,2],[2,1],0));var Z=0,K=n.mallocInt32(o(3*(c+q))),Q=0;for(E=0;E<c;++E)if(Q>=H||b[2*Q]>>2!==E)K[Z++]=h[3*E],K[Z++]=h[3*E+1],K[Z++]=h[3*E+2];else{p[0]=h[3*E+1],p[1]=-1,p[2]=h[3*E+2],p[3]=-1,p[4]=h[3*E],p[5]=-1;for(var J=0;Q<q;){var $=b[2*Q];if($>>2!==E)break;p[J=1+2*(3&$)]=b[2*Q+1],Q+=1}for(var ee=-1,te=p[J],re=1;re<6;++re){var ne=p[(re+J)%6];ne<0||(ee>=0&&(K[Z++]=te,K[Z++]=ee,K[Z++]=ne),ee=ne)}}e.numVerts=m,e.verts=g,e.numCells=Z/3|0,e.cells=K,e.normals=v,n.free(h),n.free(b)}return u>0}function g(e,t,r,n,i,a){for(var o=0;o<r;++o)n[o]=0;for(var s=0;s<3*e;++s)n[t[s]]+=2;var l=0;for(o=0;o<r;++o)i[o]=l,l+=n[o];for(o=0;o<e;++o){var u=t[3*o],c=t[3*o+1],h=t[3*o+2],d=i[u];i[u]=d+2;var f=i[c];i[c]=f+2;var p=i[h];i[h]=p+2,a[d]=c,a[d+1]=h,a[f]=u,a[f+1]=h,a[p]=u,a[p+1]=c}var m=0,g=0;for(o=0;o<r;++o){var v=i[o],y=m;m=v,i[o]=g;for(s=y;s<v;++s){for(var _=a[s],b=s;b>y;--b){var E=a[b-1];if(E<=_)break;a[b]=E}a[b]=_}var w=-1,x=g;for(s=y;s<v;++s){(_=a[s])!==w&&(a[g++]=w=_)}n[o]=g-x}}function v(e,t,r,n,i,a,o,l,u){for(var c=0;c<a;++c){var h=l[i+c];if(u[h]>=0||s(t,r,n,o[3*h],o[3*h+1],o[3*h+2])>=e)return!0}return!1}function y(e,t,r,n,i,a,o,l,u,c,h,d,f,p,m,g,y,_,b,E,w,x){if(s(h,d,f,p,m,g)>o)return!1;for(var T=n[u],M=i[u],S=n[c],A=i[c],R=.5*(h+p),k=.5*(d+m),P=.5*(f+g),L=0,C=0,I=0;L<M&&C<A;){var H=a[L+T],O=a[C+S];if(H===O){if(++I>2)return!1;L+=1,C+=1}else H<O?L+=1:C+=1}if(v(l,R,k,P,T,M,e,a,r)||v(l,R,k,P,S,A,e,a,r))return!1;var D=.5*(y+E),F=.5*(_+w),N=.5*(b+x),U=Math.pow(D,2)+Math.pow(F,2)+Math.pow(N,2);if(U<.1)return!1;var B=0|Math.min(u,c);return r[u]=r[c]=B,e[3*B]=R,e[3*B+1]=k,e[3*B+2]=P,U=1/Math.sqrt(U),t[3*B]=D*U,t[3*B+1]=F*U,t[3*B+2]=N*U,!0}function _(e,t,r,i,a){for(var o=0|e.numCells,s=e.cells,l=0|e.numVerts,u=e.verts,c=e.normals,h=n.mallocInt32(l),d=n.mallocInt32(l),f=n.mallocInt32(6*o),p=0;p<i;++p){g(o,s,l,d,h,f);for(var m=n.mallocInt32(l),v=0;v<l;++v)m[v]=-1;var _=0;for(v=0;v<o;++v){var b=s[3*v],E=s[3*v+1],w=s[3*v+2],x=m[b],T=m[E],M=m[w];if(!(x>=0||T>=0||M>=0)){var S=u[3*b],A=u[3*b+1],R=u[3*b+2],k=u[3*E],P=u[3*E+1],L=u[3*E+2],C=u[3*w],I=u[3*w+1],H=u[3*w+2],O=c[3*b],D=c[3*b+1],F=c[3*b+2],N=c[3*E],U=c[3*E+1],B=c[3*E+2],z=c[3*w],j=c[3*w+1],V=c[3*w+2];(y(u,c,m,h,d,f,t,r,b,E,S,A,R,k,P,L,O,D,F,N,U,B)||y(u,c,m,h,d,f,t,r,E,w,k,P,L,C,I,H,N,U,B,z,j,V)||y(u,c,m,h,d,f,t,r,w,b,C,I,H,S,A,R,z,j,V,O,D,F))&&(_+=1)}}if(_<a)break;var G=0;for(v=0;v<l;++v){var W=m[v];W<0||W===v?d[v]>0&&(m[v]=G,u[3*G]=u[3*v],u[3*G+1]=u[3*v+1],u[3*G+2]=u[3*v+2],c[3*G]=c[3*v],c[3*G+1]=c[3*v+1],c[3*G+2]=c[3*v+2],G+=1):m[v]=m[W]}var X=0;for(v=0;v<o;++v){b=m[s[3*v]],E=m[s[3*v+1]],w=m[s[3*v+2]];b!==E&&E!==w&&w!==b&&(s[3*X]=b,s[3*X+1]=E,s[3*X+2]=w,X+=1)}e.numVerts=l=G,e.numCells=o=X}return n.free(m),n.free(d),n.free(h),n.free(f),p>0}function b(e,t,r){var o=e.numCells,s=e.cells,l=e.numVerts,u=n.mallocInt32(6*o),c=n.mallocInt32(2*l);!function(e,t,r,o,s){for(var l=0;l<o;++l)s[l]=0;for(l=0;l<3*e;++l)r[l]=-1;var u=3*e,c=n.mallocInt32(3*u),h=0;for(l=0;l<e;++l){var d=t[3*l],f=t[3*l+1],p=t[3*l+2];c[h++]=0|Math.min(d,f),c[h++]=0|Math.max(d,f),c[h++]=4*l+2,c[h++]=0|Math.min(f,p),c[h++]=0|Math.max(f,p),c[h++]=4*l,c[h++]=0|Math.min(p,d),c[h++]=0|Math.max(p,d),c[h++]=4*l+1}var m=h/3|0;a(i(c,[m,3],[3,1],0));var g=-1,v=-1,y=-1;for(l=0;l<m;++l){d=c[3*l],f=c[3*l+1];var _=c[3*l+2];if(d===g&&f===v){var b=y>>2,E=3&y;r[3*(_>>2)+(3&_)]=y,r[3*b+E]=_}else g>=0&&(s[g]+=1,s[v]+=1);g=d,v=f,y=_}g>=0&&(s[g]+=1,s[v]+=1),n.free(c)}(o,s,u,l,c);for(var h=0;h<t;++h){for(var d=0,f=0;f<o;++f){var p=s[3*f],m=s[3*f+1],g=s[3*f+2],v=u[3*f],y=u[3*f+1],_=u[3*f+2],b=c[p],E=c[m],w=c[g],x=6,T=6,M=6;v<0&&(T=M=4),y<0&&(M=x=4),_<0&&(T=x=4);var S=0|Math.abs(b-x+1),A=0|Math.abs(b-x),R=0|Math.abs(b-x-1),k=0|Math.abs(E-T+1),P=0|Math.abs(E-T),L=0|Math.abs(E-T-1),C=0|Math.abs(w-M+1),I=0|Math.abs(w-M),H=0|Math.abs(w-M-1);if(v>=0){var O=c[j=s[3*(B=v>>2)+(z=3&v)]],D=(s[V=3*B+(z+1)%3],u[V]),F=u[3*B+(z+2)%3];if(s[V]===m){var N=D;D=F,F=N}var U=6;if((F<0||D<0)&&(U=4),S+L+H+(0|Math.abs(O-U+1))<A+P+I+(0|Math.abs(O-U))){s[3*f]=p,s[3*f+1]=m,s[3*f+2]=j,u[3*f]=D,u[3*f+1]=4*B+2,u[3*f+2]=_,D>=0&&(u[3*(D>>2)+(3&D)]=4*f),_>=0&&(u[3*(_>>2)+(3&_)]=4*f+2),s[3*B]=p,s[3*B+1]=j,s[3*B+2]=g,u[3*B]=F,u[3*B+1]=y,u[3*B+2]=4*f+1,F>=0&&(u[3*(F>>2)+(3&F)]=4*B),y>=0&&(u[3*(y>>2)+(3&y)]=4*B+1),c[p]+=1,c[m]-=1,c[g]-=1,c[j]+=1,d+=1;continue}}if(y>=0){O=c[j=s[3*(B=y>>2)+(z=3&y)]],s[V=3*B+(z+1)%3],D=u[V],F=u[3*B+(z+2)%3];if(s[V]===g){N=D;D=F,F=N}U=6;if((D<0||F<0)&&(U=4),R+k+H+(0|Math.abs(O-U+1))<A+P+I+(0|Math.abs(O-U))){s[3*f]=m,s[3*f+1]=g,s[3*f+2]=j,u[3*f]=D,u[3*f+1]=4*B+2,u[3*f+2]=v,D>=0&&(u[3*(D>>2)+(3&D)]=4*f),v>=0&&(u[3*(v>>2)+(3&v)]=4*f+2),s[3*B]=m,s[3*B+1]=j,s[3*B+2]=p,u[3*B]=F,u[3*B+1]=_,u[3*B+2]=4*f+1,F>=0&&(u[3*(F>>2)+(3&F)]=4*B),_>=0&&(u[3*(_>>2)+(3&_)]=4*B+1),c[p]-=1,c[m]+=1,c[g]-=1,c[j]+=1,d+=1;continue}}if(_>=0){var B,z,j,V;O=c[j=s[3*(B=_>>2)+(z=3&_)]],s[V=3*B+(z+1)%3],D=u[V],F=u[3*B+(z+2)%3];if(s[V]===p){N=D;D=F,F=N}U=6;if((D<0||F<0)&&(U=4),R+L+C+(0|Math.abs(O-U+1))<A+P+I+(0|Math.abs(O-U))){s[3*f]=g,s[3*f+1]=p,s[3*f+2]=j,u[3*f]=D,u[3*f+1]=4*B+2,u[3*f+2]=y,D>=0&&(u[3*(D>>2)+(3&D)]=4*f),y>=0&&(u[3*(y>>2)+(3&y)]=4*f+2),s[3*B]=g,s[3*B+1]=j,s[3*B+2]=m,u[3*B]=F,u[3*B+1]=v,u[3*B+2]=4*f+1,F>=0&&(u[3*(F>>2)+(3&F)]=4*B),v>=0&&(u[3*(v>>2)+(3&v)]=4*B+1),c[p]-=1,c[m]-=1,c[g]+=1,c[j]+=1,d+=1;continue}}}if(d<r)break}return n.free(c),n.free(u),h>0}function E(e,t,r,i){for(var a=e.numCells,o=e.cells,s=e.numVerts,l=e.verts,u=e.normals,c=n.mallocFloat32(4*s),h=0;h<r;++h){for(var d=0;d<4*s;++d)c[d]=0;for(d=0;d<a;++d){var f=o[3*d],p=o[3*d+1],m=o[3*d+2],g=l[3*f],v=l[3*f+1],y=l[3*f+2],_=l[3*p],b=l[3*p+1],E=l[3*p+2],w=g+_+l[3*m],x=v+b+l[3*m+1],T=y+E+l[3*m+2];c[4*f]+=w,c[4*f+1]+=x,c[4*f+2]+=T,c[4*f+3]+=1,c[4*p]+=w,c[4*p+1]+=x,c[4*p+2]+=T,c[4*p+3]+=1,c[4*m]+=w,c[4*m+1]+=x,c[4*m+2]+=T,c[4*m+3]+=1}var M=0;for(d=0;d<s;++d){w=l[3*d],x=l[3*d+1],T=l[3*d+2];var S=c[4*d],A=c[4*d+1],R=c[4*d+2],k=c[4*d+3];S*=k=1/(3*k),A*=k,R*=k;var P=u[3*d],L=u[3*d+1],C=u[3*d+2],I=S-w,H=A-x,O=R-T,D=P*I+L*H+C*O,F=l[3*d]=w+t*(I-D*P),N=l[3*d+1]=x+t*(H-D*L),U=l[3*d+2]=T+t*(O-D*C);M=Math.max(M,Math.pow(F-w,2)+Math.pow(N-x,2)+Math.pow(U-T,2))}if(M<i)break}return n.free(c),h>0}function w(e,t){var r=(t=t||{}).edgeLength||function(e){for(var t=e.numCells,r=e.cells,o=e.verts,l=n.mallocFloat32(3*t),u=0;u<t;++u){var c=r[3*u],h=r[3*u+1],d=r[3*u+2],f=o[3*c],p=o[3*c+1],m=o[3*c+2],g=o[3*h],v=o[3*h+1],y=o[3*h+2],_=o[3*d],b=o[3*d+1],E=o[3*d+2];l[3*u]=s(f,p,m,g,v,y),l[3*u+1]=s(g,v,y,_,b,E),l[3*u+2]=s(_,b,E,f,p,m)}a(i(l));var w=l[l.length>>1];return n.free(l),Math.sqrt(w)}(e),o=t.smoothRate||.95;o=Math.max(Math.min(o,1),.001);for(var l=Math.pow(1.25*r,2),u=Math.pow(.75*r,2),c=t.maxIters||5,h=t.splitIters||10,d=t.collapseIters||10,f=t.flipIters||10,p=t.smoothIters||20,g=0|Math.max(t.minSplit||0,0),v=0|Math.max(t.minCollapse||0,0),y=0|Math.max(t.minFlip||0,0),w=Math.pow(Math.max(t.minSmooth||.05*r/o,0),2),x=!0,T=0;x&&T<c;++T)x=!1,x=m(e,l,h,g)||x,x=_(e,u,l,d,v)||x,x=b(e,f,y)||x,x=E(e,o,p,w)||x}},function(e,t){e.exports=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}},function(e,t,r){"use strict";e.exports=function(e,t,r){return 0===e.length?e:t?(r||e.sort(t),function(e,t){for(var r=1,n=e.length,i=e[0],a=e[0],o=1;o<n;++o)if(a=i,t(i=e[o],a)){if(o===r){r++;continue}e[r++]=i}return e.length=r,e}(e,t)):(r||e.sort(),function(e){for(var t=1,r=e.length,n=e[0],i=e[0],a=1;a<r;++a)if(i=n,(n=e[a])!==i){if(a===t){t++;continue}e[t++]=n}return e.length=t,e}(e))}},function(e,t){e.exports=function(e,t){var i=e.length,a=e.length-t.length;if(a)return a;switch(i){case 0:return 0;case 1:return e[0]-t[0];case 2:return e[0]+e[1]-t[0]-t[1]||r(e[0],e[1])-r(t[0],t[1]);case 3:var o=e[0]+e[1],s=t[0]+t[1];if(a=o+e[2]-(s+t[2]))return a;var l=r(e[0],e[1]),u=r(t[0],t[1]);return r(l,e[2])-r(u,t[2])||r(l+e[2],o)-r(u+t[2],s);case 4:var c=e[0],h=e[1],d=e[2],f=e[3],p=t[0],m=t[1],g=t[2],v=t[3];return c+h+d+f-(p+m+g+v)||r(c,h,d,f)-r(p,m,g,v,p)||r(c+h,c+d,c+f,h+d,h+f,d+f)-r(p+m,p+g,p+v,m+g,m+v,g+v)||r(c+h+d,c+h+f,c+d+f,h+d+f)-r(p+m+g,p+m+v,p+g+v,m+g+v);default:for(var y=e.slice().sort(n),_=t.slice().sort(n),b=0;b<i;++b)if(a=y[b]-_[b])return a;return 0}};var r=Math.min;function n(e,t){return e-t}},function(e,t,r){"use strict";e.exports=function(e){for(var t=1,r=1;r<e.length;++r)for(var n=0;n<r;++n)if(e[r]<e[n])t=-t;else if(e[n]===e[r])return 0;return t}},function(e,t,r){"use strict";var n=r(25),i=r(10),a=r(1),o=r(13);function s(e,t,r,n,i,a,s){e|=0,t|=0,r|=0,i|=0,a|=0,o.isPow2(r)?u(e,t,r,n,i,a):function(e,t,r,n,i,a,s){e|=0,t|=0,r|=0,i|=0,a|=0,s|=0;var l,c,h,d,f,p,m,g,v,y=o.nextPow2(2*r+1),_=s,b=_+r,E=b+r,w=E+y,x=w+y,T=x+y,M=-e*Math.PI/r;for(v=0;v<r;++v)c=M*(v*v%(2*r)),d=Math.cos(c),f=Math.sin(c),n[x+(y-v)]=n[x+v]=n[_+v]=d,n[T+(y-v)]=n[T+v]=n[b+v]=f;for(v=r;v<=y-r;++v)n[x+v]=0;for(v=r;v<=y-r;++v)n[T+v]=0;u(1,1,y,n,x,T),M=e<0?1/r:1;for(l=0;l<t;++l){for(v=0;v<r;++v)c=n[i+v],h=n[a+v],d=n[_+v],f=-n[b+v],p=d*(c+h),m=c*(f-d),g=h*(d+f),n[E+v]=p-g,n[w+v]=p+m;for(v=r;v<y;++v)n[E+v]=0;for(v=r;v<y;++v)n[w+v]=0;for(u(1,1,y,n,E,w),v=0;v<y;++v)c=n[E+v],h=n[w+v],d=n[x+v],f=n[T+v],p=d*(c+h),m=c*(f-d),g=h*(d+f),n[E+v]=p-g,n[w+v]=p+m;for(u(-1,1,y,n,E,w),v=0;v<r;++v)c=n[E+v],h=n[w+v],d=n[_+v],f=-n[b+v],p=d*(c+h),m=c*(f-d),g=h*(d+f),n[i+v]=M*(p-g),n[a+v]=M*(p+m);i+=r,a+=r}}(e,t,r,n,i,a,s)}function l(e){return o.isPow2(e)?0:2*e+4*o.nextPow2(2*e+1)}function u(e,t,r,n,i,a){var s,l,u,c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S,A,R,k,P;for(e|=0,t|=0,i|=0,a|=0,s=r|=0,l=o.log2(s),T=0;T<t;++T){for(f=s>>1,h=0,u=0;u<s-1;u++){for(u<h&&(_=n[i+u],n[i+u]=n[i+h],n[i+h]=_,_=n[a+u],n[a+u]=n[a+h],n[a+h]=_),d=f;d<=h;)h-=d,d>>=1;h+=d}for(v=-1,y=0,g=1,p=0;p<l;p++){for(m=g,g<<=1,w=1,x=0,h=0;h<m;h++){for(u=h;u<s;u+=g)M=n[i+(c=u+m)],S=n[a+c],A=n[i+u],R=n[a+u],b=(k=w*(M+S))-S*(w+x),E=k+(P=M*(x-w)),n[i+c]=A-b,n[a+c]=R-E,n[i+u]+=b,n[a+u]+=E;P=w*(y-v),w=(k=v*(w+x))-x*(v+y),x=k+P}y=Math.sqrt((1-v)/2),e<0&&(y=-y),v=Math.sqrt((1+v)/2)}if(e<0){var L=1/s;for(u=0;u<s;u++)n[i+u]*=L,n[a+u]*=L}i+=r,a+=r}}e.exports=function(e,t,r){var o,u,c=t.shape,h=c.length,d=1,f=new Array(h),p=0;for(o=h-1;o>=0;--o)if(f[o]=d,d*=c[o],p=Math.max(p,l(c[o])),t.shape[o]!==r.shape[o])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var m,g=4*d+p;m="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?a.mallocDouble(g):a.mallocFloat(g);var v,y,_,b,E=i(m,c.slice(0),f,0),w=i(m,c.slice(0),f.slice(0),d),x=i(m,c.slice(0),f.slice(0),2*d),T=i(m,c.slice(0),f.slice(0),3*d),M=4*d;for(n.assign(E,t),n.assign(w,r),o=h-1;o>=0&&(s(e,d/c[o],c[o],m,E.offset,w.offset,M),0!==o);--o){for(y=1,_=x.stride,b=T.stride,u=o-1;u<h;++u)b[u]=_[u]=y,y*=c[u];for(u=o-2;u>=0;--u)b[u]=_[u]=y,y*=c[u];n.assign(x,E),n.assign(T,w),v=E,E=x,x=v,v=w,w=T,T=v}n.assign(t,E),n.assign(r,w),a.free(m)}},function(e,t,r){"use strict";e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";var n=r(2),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new n.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,t.string2buf=function(e){var t,r,i,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,n,i,a,s=t||e.length,u=new Array(2*s);for(n=0,r=0;r<s;)if((i=e[r++])<128)u[n++]=i;else if((a=o[i])>4)u[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<s;)i=i<<6|63&e[r++],a--;a>1?u[n++]=65533:i<65536?u[n++]=i:(i-=65536,u[n++]=55296|i>>10&1023,u[n++]=56320|1023&i)}return l(u,n)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+o[e[r]]>t?r:t}},function(e,t,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){"use strict";e.exports=Math.floor},function(e,t,r){"use strict";e.exports=Math.ceil},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.ComponentSpec)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||r(7),n.lossless.Utils=n.lossless.Utils||r(17),n.lossless.HuffmanTable=n.lossless.HuffmanTable||function(){this.l=n.lossless.Utils.createArray(4,2,16),this.th=[],this.v=n.lossless.Utils.createArray(4,2,16,200),this.tc=n.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},n.lossless.HuffmanTable.MSB=2147483648,n.lossless.HuffmanTable.prototype.read=function(e,t){var r,n,i,a,o,s,l=0;for(r=e.get16(),l+=2;l<r;){if(l+=1,(i=15&(n=e.get8()))>3)throw new Error("ERROR: Huffman table ID > 3");if((a=n>>4)>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[i]=1,this.tc[i][a]=1,o=0;o<16;o+=1)this.l[i][a][o]=e.get8(),l+=1;for(o=0;o<16;o+=1)for(s=0;s<this.l[i][a][o];s+=1){if(l>r)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[i][a][o][s]=e.get8(),l+=1}}if(l!==r)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(o=0;o<4;o+=1)for(s=0;s<2;s+=1)0!==this.tc[o][s]&&this.buildHuffTable(t[o][s],this.l[o][s],this.v[o][s]);return 1},n.lossless.HuffmanTable.prototype.buildHuffTable=function(e,t,r){var i,a,o,s,l;for(256,a=0,o=0;o<8;o+=1)for(s=0;s<t[o];s+=1)for(l=0;l<256>>o+1;l+=1)e[a]=r[o][s]|o+1<<8,a+=1;for(o=1;a<256;o+=1,a+=1)e[a]=o|n.lossless.HuffmanTable.MSB;for(i=1,a=0,o=8;o<16;o+=1)for(s=0;s<t[o];s+=1){for(l=0;l<256>>o-7;l+=1)e[256*i+a]=r[o][s]|o+1<<8,a+=1;if(a>=256){if(a>256)throw new Error("ERROR: Huffman table error(1)!");a=0,i+=1}}},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.HuffmanTable)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||r(7),n.lossless.Utils=n.lossless.Utils||r(17),n.lossless.QuantizationTable=n.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=n.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},n.lossless.QuantizationTable.enhanceQuantizationTable=function(e,t){var r;for(r=0;r<8;r+=1)e[t[0+r]]*=90,e[t[32+r]]*=90,e[t[16+r]]*=118,e[t[48+r]]*=49,e[t[40+r]]*=71,e[t[8+r]]*=126,e[t[56+r]]*=25,e[t[24+r]]*=106;for(r=0;r<8;r+=1)e[t[0+8*r]]*=90,e[t[4+8*r]]*=90,e[t[2+8*r]]*=118,e[t[6+8*r]]*=49,e[t[5+8*r]]*=71,e[t[1+8*r]]*=126,e[t[7+8*r]]*=25,e[t[3+8*r]]*=106;for(r=0;r<64;r+=1)e[r]>>=6},n.lossless.QuantizationTable.prototype.read=function(e,t){var r,i,a,o,s=0;for(r=e.get16(),s+=2;s<r;){if(s+=1,(a=15&(i=e.get8()))>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[a]=i>>4,0===this.precision[a])this.precision[a]=8;else{if(1!==this.precision[a])throw new Error("ERROR: Quantization table precision error");this.precision[a]=16}if(this.tq[a]=1,8===this.precision[a]){for(o=0;o<64;o+=1){if(s>r)throw new Error("ERROR: Quantization table format error");this.quantTables[a][o]=e.get8(),s+=1}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}else{for(o=0;o<64;o+=1){if(s>r)throw new Error("ERROR: Quantization table format error");this.quantTables[a][o]=e.get16(),s+=2}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}}if(s!==r)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.QuantizationTable)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||r(7),n.lossless.ScanComponent=n.lossless.ScanComponent||r(58),n.lossless.ScanHeader=n.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},n.lossless.ScanHeader.prototype.read=function(e){var t,r,i,a=0;for(t=e.get16(),a+=2,this.numComp=e.get8(),a+=1,r=0;r<this.numComp;r+=1){if(this.components[r]=new n.lossless.ScanComponent,a>t)throw new Error("ERROR: scan header format error");this.components[r].scanCompSel=e.get8(),a+=1,i=e.get8(),a+=1,this.components[r].dcTabSel=i>>4,this.components[r].acTabSel=15&i}if(this.selection=e.get8(),a+=1,this.spectralEnd=e.get8(),a+=1,i=e.get8(),this.ah=i>>4,this.al=15&i,(a+=1)!==t)throw new Error("ERROR: scan header format error [count!=Ns]");return 1},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.ScanHeader)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ScanComponent=n.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.ScanComponent)},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||r(54),n.lossless.DataStream=n.lossless.DataStream||r(7),n.lossless.FrameHeader=n.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},n.lossless.FrameHeader.prototype.read=function(e){var t,r,i,a,o=0;for(t=e.get16(),o+=2,this.precision=e.get8(),o+=1,this.dimY=e.get16(),o+=2,this.dimX=e.get16(),o+=2,this.numComp=e.get8(),o+=1,r=1;r<=this.numComp;r+=1){if(o>t)throw new Error("ERROR: frame format error");if(i=e.get8(),(o+=1)>=t)throw new Error("ERROR: frame format error [c>=Lf]");a=e.get8(),o+=1,this.components[i]||(this.components[i]=new n.lossless.ComponentSpec),this.components[i].hSamp=a>>4,this.components[i].vSamp=15&a,this.components[i].quantTableSel=e.get8(),o+=1}if(o!==t)throw new Error("ERROR: frame format error [Lf!=count]");return 1},"undefined"!==typeof e&&e.exports&&(e.exports=n.lossless.FrameHeader)},function(e,t,r){"use strict";var n=n||{};n.Utils=n.Utils||r(31),n.NIFTI1=n.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},n.NIFTI1.TYPE_NONE=0,n.NIFTI1.TYPE_BINARY=1,n.NIFTI1.TYPE_UINT8=2,n.NIFTI1.TYPE_INT16=4,n.NIFTI1.TYPE_INT32=8,n.NIFTI1.TYPE_FLOAT32=16,n.NIFTI1.TYPE_COMPLEX64=32,n.NIFTI1.TYPE_FLOAT64=64,n.NIFTI1.TYPE_RGB24=128,n.NIFTI1.TYPE_INT8=256,n.NIFTI1.TYPE_UINT16=512,n.NIFTI1.TYPE_UINT32=768,n.NIFTI1.TYPE_INT64=1024,n.NIFTI1.TYPE_UINT64=1280,n.NIFTI1.TYPE_FLOAT128=1536,n.NIFTI1.TYPE_COMPLEX128=1792,n.NIFTI1.TYPE_COMPLEX256=2048,n.NIFTI1.XFORM_UNKNOWN=0,n.NIFTI1.XFORM_SCANNER_ANAT=1,n.NIFTI1.XFORM_ALIGNED_ANAT=2,n.NIFTI1.XFORM_TALAIRACH=3,n.NIFTI1.XFORM_MNI_152=4,n.NIFTI1.SPATIAL_UNITS_MASK=7,n.NIFTI1.TEMPORAL_UNITS_MASK=56,n.NIFTI1.UNITS_UNKNOWN=0,n.NIFTI1.UNITS_METER=1,n.NIFTI1.UNITS_MM=2,n.NIFTI1.UNITS_MICRON=3,n.NIFTI1.UNITS_SEC=8,n.NIFTI1.UNITS_MSEC=16,n.NIFTI1.UNITS_USEC=24,n.NIFTI1.UNITS_HZ=32,n.NIFTI1.UNITS_PPM=40,n.NIFTI1.UNITS_RADS=48,n.NIFTI1.MAGIC_COOKIE=348,n.NIFTI1.STANDARD_HEADER_SIZE=348,n.NIFTI1.MAGIC_NUMBER_LOCATION=344,n.NIFTI1.MAGIC_NUMBER=[110,43,49],n.NIFTI1.MAGIC_NUMBER2=[110,105,49],n.NIFTI1.EXTENSION_HEADER_SIZE=8,n.NIFTI1.prototype.readHeader=function(e){var t,r,i,a,o=new DataView(e),s=n.Utils.getIntAt(o,0,this.littleEndian);if(s!==n.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,s=n.Utils.getIntAt(o,0,this.littleEndian)),s!==n.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=n.Utils.getByteAt(o,39),t=0;t<8;t+=1)a=40+2*t,this.dims[t]=n.Utils.getShortAt(o,a,this.littleEndian);for(this.intent_p1=n.Utils.getFloatAt(o,56,this.littleEndian),this.intent_p2=n.Utils.getFloatAt(o,60,this.littleEndian),this.intent_p3=n.Utils.getFloatAt(o,64,this.littleEndian),this.intent_code=n.Utils.getShortAt(o,68,this.littleEndian),this.datatypeCode=n.Utils.getShortAt(o,70,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(o,72,this.littleEndian),this.slice_start=n.Utils.getShortAt(o,74,this.littleEndian),t=0;t<8;t+=1)a=76+4*t,this.pixDims[t]=n.Utils.getFloatAt(o,a,this.littleEndian);for(this.vox_offset=n.Utils.getFloatAt(o,108,this.littleEndian),this.scl_slope=n.Utils.getFloatAt(o,112,this.littleEndian),this.scl_inter=n.Utils.getFloatAt(o,116,this.littleEndian),this.slice_end=n.Utils.getShortAt(o,120,this.littleEndian),this.slice_code=n.Utils.getByteAt(o,122),this.xyzt_units=n.Utils.getByteAt(o,123),this.cal_max=n.Utils.getFloatAt(o,124,this.littleEndian),this.cal_min=n.Utils.getFloatAt(o,128,this.littleEndian),this.slice_duration=n.Utils.getFloatAt(o,132,this.littleEndian),this.toffset=n.Utils.getFloatAt(o,136,this.littleEndian),this.description=n.Utils.getStringAt(o,148,228),this.aux_file=n.Utils.getStringAt(o,228,252),this.qform_code=n.Utils.getShortAt(o,252,this.littleEndian),this.sform_code=n.Utils.getShortAt(o,254,this.littleEndian),this.quatern_b=n.Utils.getFloatAt(o,256,this.littleEndian),this.quatern_c=n.Utils.getFloatAt(o,260,this.littleEndian),this.quatern_d=n.Utils.getFloatAt(o,264,this.littleEndian),this.qoffset_x=n.Utils.getFloatAt(o,268,this.littleEndian),this.qoffset_y=n.Utils.getFloatAt(o,272,this.littleEndian),this.qoffset_z=n.Utils.getFloatAt(o,276,this.littleEndian),r=0;r<3;r+=1)for(i=0;i<4;i+=1)a=280+4*(4*r+i),this.affine[r][i]=n.Utils.getFloatAt(o,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=n.Utils.getStringAt(o,328,344),this.magic=n.Utils.getStringAt(o,344,348),this.isHDR=this.magic===n.NIFTI1.MAGIC_NUMBER2,o.byteLength>n.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(o,348),this.extensionFlag[1]=n.Utils.getByteAt(o,349),this.extensionFlag[2]=n.Utils.getByteAt(o,350),this.extensionFlag[3]=n.Utils.getByteAt(o,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(o),this.extensionCode=this.getExtensionCode(o)))},n.NIFTI1.prototype.toFormattedString=function(){var e=n.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},n.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===n.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===n.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===n.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===n.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===n.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===n.NIFTI1.TYPE_RGB24?"RGB":e===n.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===n.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===n.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===n.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===n.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},n.NIFTI1.prototype.getTransformCodeString=function(e){return e===n.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===n.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===n.NIFTI1.XFORM_TALAIRACH?"Talairach":e===n.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},n.NIFTI1.prototype.getUnitsCodeString=function(e){return e===n.NIFTI1.UNITS_METER?"Meters":e===n.NIFTI1.UNITS_MM?"Millimeters":e===n.NIFTI1.UNITS_MICRON?"Microns":e===n.NIFTI1.UNITS_SEC?"Seconds":e===n.NIFTI1.UNITS_MSEC?"Milliseconds":e===n.NIFTI1.UNITS_USEC?"Microseconds":e===n.NIFTI1.UNITS_HZ?"Hz":e===n.NIFTI1.UNITS_PPM?"PPM":e===n.NIFTI1.UNITS_RADS?"Rads":"Unknown"},n.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,r,n,i,a,o,s,l,u){var c,h,d,f,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=e,g=t,v=r;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(c=1-(m*m+g*g+v*v))<1e-7?(m*=c=1/Math.sqrt(m*m+g*g+v*v),g*=c,v*=c,c=0):c=Math.sqrt(c),h=o>0?o:1,d=s>0?s:1,f=l>0?l:1,u<0&&(f=-f),p[0][0]=(c*c+m*m-g*g-v*v)*h,p[0][1]=2*(m*g-c*v)*d,p[0][2]=2*(m*v+c*g)*f,p[1][0]=2*(m*g+c*v)*h,p[1][1]=(c*c+g*g-m*m-v*v)*d,p[1][2]=2*(g*v-c*m)*f,p[2][0]=2*(m*v-c*g)*h,p[2][1]=2*(g*v+c*m)*d,p[2][2]=(c*c+v*v-g*g-m*m)*f,p[0][3]=n,p[1][3]=i,p[2][3]=a,p},n.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S,A,R,k,P,L,C,I;if(p=0,S=[[0,0,0],[0,0,0],[0,0,0]],A=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],r=e[0][1],n=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],0===(c=Math.sqrt(t*t+i*i+s*s)))return null;if(t/=c,i/=c,s/=c,0===(c=Math.sqrt(r*r+a*a+l*l)))return null;if(c=t*(r/=c)+i*(a/=c)+s*(l/=c),Math.abs(c)>1e-4){if(r-=c*t,a-=c*i,l-=c*s,0===(c=Math.sqrt(r*r+a*a+l*l)))return null;r/=c,a/=c,l/=c}if(0===(c=Math.sqrt(n*n+o*o+u*u))?(n=i*l-s*a,o=s*r-l*t,u=t*a-i*r):(n/=c,o/=c,u/=c),c=t*n+i*o+s*u,Math.abs(c)>1e-4){if(n-=c*t,o-=c*i,u-=c*s,0===(c=Math.sqrt(n*n+o*o+u*u)))return null;n/=c,o/=c,u/=c}if(c=r*n+a*o+l*u,Math.abs(c)>1e-4){if(n-=c*r,o-=c*a,u-=c*l,0===(c=Math.sqrt(n*n+o*o+u*u)))return null;n/=c,o/=c,u/=c}if(S[0][0]=t,S[0][1]=r,S[0][2]=n,S[1][0]=i,S[1][1]=a,S[1][2]=o,S[2][0]=s,S[2][1]=l,S[2][2]=u,0===(h=this.nifti_mat33_determ(S)))return null;for(M=-666,y=E=w=x=1,_=2,b=3,d=1;d<=3;d+=1)for(f=1;f<=3;f+=1)if(d!==f)for(p=1;p<=3;p+=1)if(d!==p&&f!==p)for(A[0][0]=A[0][1]=A[0][2]=A[1][0]=A[1][1]=A[1][2]=A[2][0]=A[2][1]=A[2][2]=0,m=-1;m<=1;m+=2)for(g=-1;g<=1;g+=2)for(v=-1;v<=1;v+=2)A[0][d-1]=m,A[1][f-1]=g,A[2][p-1]=v,this.nifti_mat33_determ(A)*h>0&&(c=(T=this.nifti_mat33_mul(A,S))[0][0]+T[1][1]+T[2][2])>M&&(M=c,y=d,_=f,b=p,E=m,w=g,x=v);switch(R=k=P=L=C=I=0,y*E){case 1:R="X",L="+";break;case-1:R="X",L="-";break;case 2:R="Y",L="+";break;case-2:R="Y",L="-";break;case 3:R="Z",L="+";break;case-3:R="Z",L="-"}switch(_*w){case 1:k="X",C="+";break;case-1:k="X",C="-";break;case 2:k="Y",C="+";break;case-2:k="Y",C="-";break;case 3:k="Z",C="+";break;case-3:k="Z",C="-"}switch(b*x){case 1:P="X",I="+";break;case-1:P="X",I="-";break;case 2:P="Y",I="+";break;case-2:P="Y",I="-";break;case 3:P="Z",I="+";break;case-3:P="Z",I="-"}return R+k+P+L+C+I},n.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var r,n,i=[[0,0,0],[0,0,0],[0,0,0]];for(r=0;r<3;r+=1)for(n=0;n<3;n+=1)i[r][n]=e[r][0]*t[0][n]+e[r][1]*t[1][n]+e[r][2]*t[2][n];return i},n.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,r,n,i,a,o,s,l,u;return t=e[0][0],r=e[0][1],n=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],t*a*(u=e[2][2])-t*l*o-i*r*u+i*l*n+s*r*o-s*a*n},n.NIFTI1.prototype.getExtensionLocation=function(){return n.NIFTI1.MAGIC_COOKIE+4},n.NIFTI1.prototype.getExtensionSize=function(e){return n.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},n.NIFTI1.prototype.getExtensionCode=function(e){return n.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)},"undefined"!==typeof e&&e.exports&&(e.exports=n.NIFTI1)},function(e,t){(function(){"use strict";function e(e){throw e}var t=void 0,r=this;function n(e,n){var i,a=e.split("."),o=r;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===t?o=o[i]?o[i]:o[i]={}:o[i]=n}var i,a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;for(new(a?Uint8Array:Array)(256),i=0;256>i;++i)for(var o=(o=i)>>>1;o;o>>>=1)0;function s(e,t,r){var n,i="number"==typeof t?t:t=0,a="number"==typeof r?r:e.length;for(n=-1,i=7&a;i--;++t)n=n>>>8^u[255&(n^e[t])];for(i=a>>3;i--;t+=8)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^u[255&(n^e[t])])>>>8^u[255&(n^e[t+1])])>>>8^u[255&(n^e[t+2])])>>>8^u[255&(n^e[t+3])])>>>8^u[255&(n^e[t+4])])>>>8^u[255&(n^e[t+5])])>>>8^u[255&(n^e[t+6])])>>>8^u[255&(n^e[t+7])];return(4294967295^n)>>>0}var l=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],u=a?new Uint32Array(l):l;function c(){}function h(e){var t,r,n,i,o,s,l,u,c,h,d=e.length,f=0,p=Number.POSITIVE_INFINITY;for(u=0;u<d;++u)e[u]>f&&(f=e[u]),e[u]<p&&(p=e[u]);for(t=1<<f,r=new(a?Uint32Array:Array)(t),n=1,i=0,o=2;n<=f;){for(u=0;u<d;++u)if(e[u]===n){for(s=0,l=i,c=0;c<n;++c)s=s<<1|1&l,l>>=1;for(h=n<<16|u,c=s;c<t;c+=o)r[c]=h;++i}++n,i<<=1,o<<=1}return[r,f,p]}c.prototype.getName=function(){return this.name},c.prototype.getData=function(){return this.data},c.prototype.H=function(){return this.I},n("Zlib.GunzipMember",c),n("Zlib.GunzipMember.prototype.getName",c.prototype.getName),n("Zlib.GunzipMember.prototype.getData",c.prototype.getData),n("Zlib.GunzipMember.prototype.getMtime",c.prototype.H);var d,f=[];for(d=0;288>d;d++)switch(!0){case 143>=d:f.push([d+48,8]);break;case 255>=d:f.push([d-144+400,9]);break;case 279>=d:f.push([d-256+0,7]);break;case 287>=d:f.push([d-280+192,8]);break;default:e("invalid literal: "+d)}var p=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var r,n,i=[];for(r=3;258>=r;r++)n=t(r),i[r]=n[2]<<24|n[1]<<16|n[0];return i}();function m(t,r){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=a?new Uint8Array(t):t,this.o=!1,this.k=v,this.z=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.j=r.bufferSize),r.bufferType&&(this.k=r.bufferType),r.resize&&(this.z=r.resize)),this.k){case g:this.a=32768,this.b=new(a?Uint8Array:Array)(32768+this.j+258);break;case v:this.a=0,this.b=new(a?Uint8Array:Array)(this.j),this.e=this.F,this.q=this.B,this.l=this.D;break;default:e(Error("invalid inflate mode"))}}a&&new Uint32Array(p);var g=0,v=1;m.prototype.g=function(){for(;!this.o;){var r=D(this,3);switch(1&r&&(this.o=!0),r>>>=1){case 0:var n=this.input,i=this.c,o=this.b,s=this.a,l=n.length,u=t,c=o.length,h=t;switch(this.d=this.f=0,i+1>=l&&e(Error("invalid uncompressed block header: LEN")),u=n[i++]|n[i++]<<8,i+1>=l&&e(Error("invalid uncompressed block header: NLEN")),u===~(n[i++]|n[i++]<<8)&&e(Error("invalid uncompressed block header: length verify")),i+u>n.length&&e(Error("input buffer is broken")),this.k){case g:for(;s+u>o.length;){if(u-=h=c-s,a)o.set(n.subarray(i,i+h),s),s+=h,i+=h;else for(;h--;)o[s++]=n[i++];this.a=s,o=this.e(),s=this.a}break;case v:for(;s+u>o.length;)o=this.e({t:2});break;default:e(Error("invalid inflate mode"))}if(a)o.set(n.subarray(i,i+u),s),s+=u,i+=u;else for(;u--;)o[s++]=n[i++];this.c=i,this.a=s,this.b=o;break;case 1:this.l(I,O);break;case 2:N(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.q()};var y,_,b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=a?new Uint16Array(b):b,w=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],x=a?new Uint16Array(w):w,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],M=a?new Uint8Array(T):T,S=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],A=a?new Uint16Array(S):S,R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=a?new Uint8Array(R):R,P=new(a?Uint8Array:Array)(288);for(y=0,_=P.length;y<_;++y)P[y]=143>=y?8:255>=y?9:279>=y?7:8;var L,C,I=h(P),H=new(a?Uint8Array:Array)(30);for(L=0,C=H.length;L<C;++L)H[L]=5;var O=h(H);function D(t,r){for(var n,i=t.f,a=t.d,o=t.input,s=t.c,l=o.length;a<r;)s>=l&&e(Error("input buffer is broken")),i|=o[s++]<<a,a+=8;return n=i&(1<<r)-1,t.f=i>>>r,t.d=a-r,t.c=s,n}function F(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.c,l=o.length,u=t[0],c=t[1];a<c&&!(s>=l);)i|=o[s++]<<a,a+=8;return n=(r=u[i&(1<<c)-1])>>>16,e.f=i>>n,e.d=a-n,e.c=s,65535&r}function N(e){function t(e,t,r){var n,i,a,o=this.w;for(a=0;a<e;)switch(n=F(this,t),n){case 16:for(i=3+D(this,2);i--;)r[a++]=o;break;case 17:for(i=3+D(this,3);i--;)r[a++]=0;o=0;break;case 18:for(i=11+D(this,7);i--;)r[a++]=0;o=0;break;default:o=r[a++]=n}return this.w=o,r}var r,n,i,o,s=D(e,5)+257,l=D(e,5)+1,u=D(e,4)+4,c=new(a?Uint8Array:Array)(E.length);for(o=0;o<u;++o)c[E[o]]=D(e,3);if(!a)for(o=u,u=c.length;o<u;++o)c[E[o]]=0;r=h(c),n=new(a?Uint8Array:Array)(s),i=new(a?Uint8Array:Array)(l),e.w=0,e.l(h(t.call(e,s,r,n)),h(t.call(e,l,r,i)))}function U(e){this.input=e,this.c=0,this.m=[],this.s=!1}m.prototype.l=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length-258;256!==(i=F(this,e));)if(256>i)n>=l&&(this.a=n,r=this.e(),n=this.a),r[n++]=i;else for(s=x[a=i-257],0<M[a]&&(s+=D(this,M[a])),i=F(this,t),o=A[i],0<k[i]&&(o+=D(this,k[i])),n>=l&&(this.a=n,r=this.e(),n=this.a);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.D=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length;256!==(i=F(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=x[a=i-257],0<M[a]&&(s+=D(this,M[a])),i=F(this,t),o=A[i],0<k[i]&&(o+=D(this,k[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.e=function(){var e,t,r=new(a?Uint8Array:Array)(this.a-32768),n=this.a-32768,i=this.b;if(a)r.set(i.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=i[e+32768];if(this.i.push(r),this.n+=r.length,a)i.set(i.subarray(n,n+32768));else for(e=0;32768>e;++e)i[e]=i[n+e];return this.a=32768,i},m.prototype.F=function(e){var t,r,n,i=this.input.length/this.c+1|0,o=this.input,s=this.b;return e&&("number"==typeof e.t&&(i=e.t),"number"==typeof e.A&&(i+=e.A)),2>i?r=(n=(o.length-this.c)/this.r[2]/2*258|0)<s.length?s.length+n:s.length<<1:r=s.length*i,a?(t=new Uint8Array(r)).set(s):t=s,this.b=t},m.prototype.q=function(){var e,t,r,n,i,o=0,s=this.b,l=this.i,u=new(a?Uint8Array:Array)(this.n+(this.a-32768));if(0===l.length)return a?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,r=l.length;t<r;++t)for(n=0,i=(e=l[t]).length;n<i;++n)u[o++]=e[n];for(t=32768,r=this.a;t<r;++t)u[o++]=s[t];return this.i=[],this.buffer=u},m.prototype.B=function(){var e,t=this.a;return a?this.z?(e=new Uint8Array(t)).set(this.b.subarray(0,t)):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},U.prototype.G=function(){return this.s||this.g(),this.m.slice()},U.prototype.g=function(){for(var r=this.input.length;this.c<r;){var n,i,o=new c,l=t,u=t,h=t,d=t,f=t,p=t,g=t,v=this.input,y=this.c;switch(o.u=v[y++],o.v=v[y++],(31!==o.u||139!==o.v)&&e(Error("invalid file signature:"+o.u+","+o.v)),o.p=v[y++],o.p){case 8:break;default:e(Error("unknown compression method: "+o.p))}if(o.h=v[y++],i=v[y++]|v[y++]<<8|v[y++]<<16|v[y++]<<24,o.I=new Date(1e3*i),o.O=v[y++],o.N=v[y++],0<(4&o.h)&&(o.J=v[y++]|v[y++]<<8,y+=o.J),0<(8&o.h)){for(p=[],f=0;0<(d=v[y++]);)p[f++]=String.fromCharCode(d);o.name=p.join("")}if(0<(16&o.h)){for(p=[],f=0;0<(d=v[y++]);)p[f++]=String.fromCharCode(d);o.K=p.join("")}0<(2&o.h)&&(o.C=65535&s(v,0,y),o.C!==(v[y++]|v[y++]<<8)&&e(Error("invalid header crc16"))),l=v[v.length-4]|v[v.length-3]<<8|v[v.length-2]<<16|v[v.length-1]<<24,v.length-y-4-4<512*l&&(h=l),u=new m(v,{index:y,bufferSize:h}),o.data=n=u.g(),y=u.c,o.L=g=(v[y++]|v[y++]<<8|v[y++]<<16|v[y++]<<24)>>>0,s(n,t,t)!==g&&e(Error("invalid CRC-32 checksum: 0x"+s(n,t,t).toString(16)+" / 0x"+g.toString(16))),o.M=l=(v[y++]|v[y++]<<8|v[y++]<<16|v[y++]<<24)>>>0,(4294967295&n.length)!==l&&e(Error("invalid input size: "+(4294967295&n.length)+" / "+l)),this.m.push(o),this.c=y}this.s=!0;var _,b,E,w=this.m,x=0,T=0;for(_=0,b=w.length;_<b;++_)T+=w[_].data.length;if(a)for(E=new Uint8Array(T),_=0;_<b;++_)E.set(w[_].data,x),x+=w[_].data.length;else{for(E=[],_=0;_<b;++_)E[_]=w[_].data;E=Array.prototype.concat.apply([],E)}return E},n("Zlib.Gunzip",U),n("Zlib.Gunzip.prototype.decompress",U.prototype.g),n("Zlib.Gunzip.prototype.getMembers",U.prototype.G)}).call(this)},function(e,t,r){(function(t){e.exports=function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};t[o][0].call(u.exports,(function(e){return i(t[o][1][e]||e)}),u,u.exports,e,t,r,n)}return r[o].exports}for(var a=!1,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){t.exports={version:"1.5.0"}},{}],2:[function(e,t,r){"use strict";var n=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};n.prototype.head=function(){return this.head_},n.prototype.setHead=function(e){this.head_=e},n.prototype.tail=function(){return this.tail_},n.prototype.setTail=function(e){this.tail_=e},n.prototype.search=function(){return this.search_node_},n.prototype.setSearch=function(e){this.search_node_=e},n.prototype.findSearchNode=function(){return this.search_node_},n.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},n.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),n=r.point.x;if(t===n){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<n)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=n,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,r){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};i.prototype.toString=function(){return n.toStringBase(this)},i.prototype.toJSON=function(){return{x:this.x,y:this.y}},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.set_zero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},i.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},i.prototype.mul=function(e){return this.x*=e,this.y*=e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},i.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},i.negate=function(e){return new i(-e.x,-e.y)},i.add=function(e,t){return new i(e.x+t.x,e.y+t.y)},i.sub=function(e,t){return new i(e.x-t.x,e.y-t.y)},i.mul=function(e,t){return new i(e*t.x,e*t.y)},i.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new i(-e*t.y,e*t.x):"number"==typeof t?new i(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},i.toString=n.toString,i.compare=n.compare,i.cmp=n.compare,i.equals=n.equals,i.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=i},{"./xy":11}],5:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+n.toString(t[r])};(i.prototype=new Error).constructor=i,t.exports=i},{"./xy":11}],6:[function(e,r,n){(function(t){"use strict";var r=t.poly2tri;n.noConflict=function(){return t.poly2tri=r,n},n.VERSION=e("../dist/version.json").version,n.PointError=e("./pointerror"),n.Point=e("./point"),n.Triangle=e("./triangle"),n.SweepContext=e("./sweepcontext");var i=e("./sweep");n.triangulate=i.triangulate,n.sweep={Triangulate:i.triangulate}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){"use strict";function n(e,t){var r=e.locateNode(t),n=function(e,t,r){var n=new _(t,r.point,r.next.point);n.markNeighbor(r.triangle),e.addToMap(n);var i=new b(t);return i.next=r.next,i.prev=r,r.next.prev=i,r.next=i,l(e,n)||e.mapTriangleToNodes(n),i}(e,t,r);return t.x<=r.point.x+w&&s(e,r),function(e,t){for(var r=t.next;r.next&&!S(r.point,r.next.point,r.prev.point);)s(e,r),r=r.next;for(r=t.prev;r.prev&&!S(r.point,r.next.point,r.prev.point);)s(e,r),r=r.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return v(r>=0,"unordered y"),t>=0||Math.abs(t)<r}(t)&&function(e,t){for(T(t.point,t.next.point,t.next.next.point)===x.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,r){if(!function(e,t){var r;return r=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>r}(t,r)&&(s(t,r),r.prev!==t.basin.left_node||r.next!==t.basin.right_node)){if(r.prev===t.basin.left_node){if(T(r.point,r.next.point,r.next.next.point)===x.CW)return;r=r.next}else if(r.next===t.basin.right_node){if(T(r.point,r.prev.point,r.prev.prev.point)===x.CCW)return;r=r.prev}else r=r.prev.point.y<r.next.point.y?r.prev:r.next;e(t,r)}}(e,e.basin.bottom_node))}}(e,t)}(e,n),n}function i(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,o(r.triangle,t.p,t.q)||(function(e,t,r){e.edge_event.right?function(e,t,r){for(;r.next.point.x<t.p.x;)T(t.q,r.next.point,t.p)===x.CCW?h(e,t,r):r=r.next}(e,t,r):function(e,t,r){for(;r.prev.point.x>t.p.x;)T(t.q,r.prev.point,t.p)===x.CW?f(e,t,r):r=r.prev}(e,t,r)}(e,t,r),a(e,t.p,t.q,r.triangle,t.q))}function a(e,t,r,n,i){if(!o(n,t,r)){var s=n.pointCCW(i),l=T(r,s,t);if(l===x.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,s,t]);var u=n.pointCW(i),c=T(r,u,t);if(c===x.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,u,t]);l===c?a(e,t,r,n=l===x.CW?n.neighborCCW(i):n.neighborCW(i),i):m(e,t,r,n,i)}}function o(e,t,r){var n=e.edgeIndex(t,r);if(-1!==n){e.markConstrainedEdgeByIndex(n);var i=e.getNeighbor(n);return i&&i.markConstrainedEdgeByPoints(t,r),!0}return!1}function s(e,t){var r=new _(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,l(e,r)||e.mapTriangleToNodes(r)}function l(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var n=t.getNeighbor(r);if(n){var i=t.getPoint(r),a=n.oppositePoint(t,i),o=n.index(a);if(n.constrained_edge[o]||n.delaunay_edge[o]){t.constrained_edge[r]=n.constrained_edge[o];continue}if(u(i,t.pointCCW(i),t.pointCW(i),a)){t.delaunay_edge[r]=!0,n.delaunay_edge[o]=!0,c(t,i,n,a);var s=!l(e,t);return s&&e.mapTriangleToNodes(t),(s=!l(e,n))&&e.mapTriangleToNodes(n),t.delaunay_edge[r]=!1,n.delaunay_edge[o]=!1,!0}}}return!1}function u(e,t,r,n){var i=e.x-n.x,a=e.y-n.y,o=t.x-n.x,s=t.y-n.y,l=i*s-o*a;if(l<=0)return!1;var u=r.x-n.x,c=r.y-n.y,h=u*a-i*c;return!(h<=0)&&(i*i+a*a)*(o*c-u*s)+(o*o+s*s)*h+(u*u+c*c)*l>0}function c(e,t,r,n){var i,a,o,s,l,u,c,h,d,f,p,m;i=e.neighborCCW(t),a=e.neighborCW(t),o=r.neighborCCW(n),s=r.neighborCW(n),l=e.getConstrainedEdgeCCW(t),u=e.getConstrainedEdgeCW(t),c=r.getConstrainedEdgeCCW(n),h=r.getConstrainedEdgeCW(n),d=e.getDelaunayEdgeCCW(t),f=e.getDelaunayEdgeCW(t),p=r.getDelaunayEdgeCCW(n),m=r.getDelaunayEdgeCW(n),e.legalize(t,n),r.legalize(n,t),r.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,f),e.setDelaunayEdgeCCW(n,p),r.setDelaunayEdgeCW(n,m),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,u),e.setConstrainedEdgeCCW(n,c),r.setConstrainedEdgeCW(n,h),e.clearNeighbors(),r.clearNeighbors(),i&&r.markNeighbor(i),a&&e.markNeighbor(a),o&&e.markNeighbor(o),s&&r.markNeighbor(s),e.markNeighbor(r)}function h(e,t,r){r.point.x<t.p.x&&(T(r.point,r.next.point,r.next.next.point)===x.CCW?d(e,t,r):(function e(t,r,n){T(n.next.point,n.next.next.point,n.next.next.next.point)===x.CCW?d(t,r,n.next):T(r.q,n.next.next.point,r.p)===x.CCW&&e(t,r,n.next)}(e,t,r),h(e,t,r)))}function d(e,t,r){s(e,r.next),r.next.point!==t.p&&T(t.q,r.next.point,t.p)===x.CCW&&T(r.point,r.next.point,r.next.next.point)===x.CCW&&d(e,t,r)}function f(e,t,r){r.point.x>t.p.x&&(T(r.point,r.prev.point,r.prev.prev.point)===x.CW?p(e,t,r):(function e(t,r,n){T(n.prev.point,n.prev.prev.point,n.prev.prev.prev.point)===x.CW?p(t,r,n.prev):T(r.q,n.prev.prev.point,r.p)===x.CW&&e(t,r,n.prev)}(e,t,r),f(e,t,r)))}function p(e,t,r){s(e,r.prev),r.prev.point!==t.p&&T(t.q,r.prev.point,t.p)===x.CW&&T(r.point,r.prev.point,r.prev.prev.point)===x.CW&&p(e,t,r)}function m(e,t,r,n,i){var o=n.neighborAcross(i);v(o,"FLIP failed due to missing triangle!");var s=o.oppositePoint(n,i);if(n.getConstrainedEdgeAcross(i)){var u=n.index(i);throw new y("poly2tri Intersecting Constraints",[i,s,n.getPoint((u+1)%3),n.getPoint((u+2)%3)])}M(i,n.pointCCW(i),n.pointCW(i),s)?(c(n,i,o,s),e.mapTriangleToNodes(n),e.mapTriangleToNodes(o),i===r&&s===t?r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,r),o.markConstrainedEdgeByPoints(t,r),l(e,n),l(e,o)):(n=function(e,t,r,n,i,a){var o;return t===x.CCW?(o=n.edgeIndex(i,a),n.delaunay_edge[o]=!0,l(e,n),n.clearDelaunayEdges(),r):(o=r.edgeIndex(i,a),r.delaunay_edge[o]=!0,l(e,r),r.clearDelaunayEdges(),n)}(e,T(r,s,t),n,o,i,s),m(e,t,r,n,i))):(function e(t,r,n,i,a,o){var s=a.neighborAcross(o);v(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(a,o);M(n,i.pointCCW(n),i.pointCW(n),l)?m(t,n,l,s,l):e(t,r,n,i,s,g(r,n,s,l))}(e,t,r,n,o,g(t,r,o,s)),a(e,t,r,n,i))}function g(e,t,r,n){var i=T(t,n,e);if(i===x.CW)return r.pointCCW(n);if(i===x.CCW)return r.pointCW(n);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}var v=e("./assert"),y=e("./pointerror"),_=e("./triangle"),b=e("./advancingfront").Node,E=e("./utils"),w=E.EPSILON,x=E.Orientation,T=E.orient2d,M=E.inScanArea,S=E.isAngleObtuse;r.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var a=e.getPoint(t),o=n(e,a),s=a._p2t_edge_list,l=0;s&&l<s.length;++l)i(e,s[l],o)}(e),function(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){"use strict";var n=e("./pointerror"),i=e("./point"),a=e("./triangle"),o=e("./sweep"),s=e("./advancingfront"),l=s.Node,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new n("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},c=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};c.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},d=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new c,this.edge_event=new h,this.initEdges(this.points_)};d.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},d.prototype.addPoint=function(e){return this.points_.push(e),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},d.prototype.triangulate=function(){return o.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(e){this.head_=e},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(e){this.tail_=e},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,n=this.points_[0].y,a=this.points_[0].y,o=this.points_.length;for(e=1;e<o;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<r&&(r=s.x),s.y>n&&(n=s.y),s.y<a&&(a=s.y)}this.pmin_=new i(r,a),this.pmax_=new i(t,n);var l=.3*(t-r),u=.3*(n-a);this.head_=new i(t+l,a-u),this.tail_=new i(r-l,a-u),this.points_.sort(i.compare)},d.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new u(e[t],e[(t+1)%r]))},d.prototype.getPoint=function(e){return this.points_[e]},d.prototype.addToMap=function(e){this.map_.push(e)},d.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},d.prototype.createAdvancingFront=function(){var e,t,r,n=new a(this.points_[0],this.tail_,this.head_);this.map_.push(n),e=new l(n.getPoint(1),n),t=new l(n.getPoint(0),n),r=new l(n.getPoint(2)),this.front_=new s(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t},d.prototype.removeNode=function(e){},d.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},d.prototype.removeFromMap=function(e){var t,r=this.map_,n=r.length;for(t=0;t<n;t++)if(r[t]===e){r.splice(t,1);break}},d.prototype.meshClean=function(e){for(var t,r,n=[e];t=n.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||n.push(t.getNeighbor(r))},t.exports=d},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){"use strict";var n=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},i=e("./xy").toString;n.prototype.toString=function(){return"["+i(this.points_[0])+i(this.points_[1])+i(this.points_[2])+"]"},n.prototype.getPoint=function(e){return this.points_[e]},n.prototype.GetPoint=n.prototype.getPoint,n.prototype.getPoints=function(){return this.points_},n.prototype.getNeighbor=function(e){return this.neighbors_[e]},n.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},n.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},n.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},n.prototype.isInterior=function(){return this.interior_},n.prototype.setInterior=function(e){return this.interior_=e,this},n.prototype.markNeighborPointers=function(e,t,r){var n=this.points_;if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=r;else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=r;else{if(!(e===n[0]&&t===n[1]||e===n[1]&&t===n[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},n.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},n.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},n.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},n.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},n.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},n.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},n.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},n.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},n.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},n.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},n.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},n.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},n.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},n.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},n.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},n.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},n.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},n.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},n.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},n.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},n.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},n.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},n.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},n.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=n},{"./xy":11}],10:[function(e,t,r){"use strict";var n=1e-12;r.EPSILON=n;var i={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=i,r.orient2d=function(e,t,r){var a=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x);return a>-n&&a<n?i.COLLINEAR:a>0?i.CCW:i.CW},r.inScanArea=function(e,t,r,i){return!((e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>=-n||(e.x-r.x)*(i.y-r.y)-(i.x-r.x)*(e.y-r.y)<=n)},r.isAngleObtuse=function(e,t,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)<0}},{}],11:[function(e,t,r){"use strict";function n(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?n(e):t},toStringBase:n,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}).call(this,r(5))},function(e,t,r){var n;!function(i){function a(e,t,r,n,i){this._listener=t,this._isOnce=r,this.context=n,this._signal=e,this._priority=i||0}function o(e,t){if("function"!=typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function s(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){s.prototype.dispatch.apply(e,arguments)}}a.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},s.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,n){var i=this._indexOfListener(e,r);if(-1!==i){if((e=this._bindings[i]).isOnce()!==t)throw Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else e=new a(this,e,t,r,n),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return o(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return o(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){o(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,r=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=r),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(r))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var l=s;l.Signal=s,void 0===(n=function(){return l}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){var n=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),t(++r%i.children.length)}),!1);var a=(performance||Date).now(),o=a,s=0,l=e(new n.Panel("FPS","#0ff","#002")),u=e(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new n.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:i,setMode:t}};n.Panel=function(e,t,r){var n=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,u=3*o,c=2*o,h=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,u,c),g.fillRect(h,d,f,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h,d,f,p),{dom:m,update:function(l,v){n=Math.min(n,l),i=Math.max(i,l),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,s,d),g.fillStyle=t,g.fillText(a(l)+" "+e+" ("+a(n)+"-"+a(i)+")",u,c),g.drawImage(m,h+o,d,f-o,p,h,d,f-o,p),g.fillRect(h+f-o,d,o,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h+f-o,d,o,a((1-l/v)*p))}}},e.exports=n},function(e,t,r){(function(r){var n;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||a;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||f(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||f(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,f()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var r=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=n&&parseInt(n[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!r&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||a,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),r=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||r)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(){a._autoResume();var t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),void 0===t.start?t.noteOn(0):t.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),t.onended=function(){t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0)}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var r=0;r<e._howls[t]._sounds.length;r++)if(!e._howls[t]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then((function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())})))}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return a.ctx||f(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhrWithCredentials=e.xhrWithCredentials||!1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,void 0!==a.ctx&&a.ctx&&a.mobileAutoEnable&&a._enableMobileAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=null;if(a.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var t=0;t<this._src.length;t++){var r,n;if(this._format&&this._format[t])r=this._format[t];else{if("string"!=typeof(n=this._src[t])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(n))||(r=/\.([^.]+)$/.exec(n.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&a.codecs(r)){e=this._src[t];break}}if(e)return this._src=e,this._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new s(this),this._webAudio&&u(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var r=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e){e="__default";for(var i=0,o=0;o<r._sounds.length;o++)r._sounds[o]._paused&&!r._sounds[o]._ended&&(i++,n=r._sounds[o]._id);1===i?e=null:n=null}}var s=n?r._soundById(n):r._inactiveSound();if(!s)return null;if(n&&!e&&(e=s._sprite||"__default"),"loaded"!==r._state){s._sprite=e,s._ended=!1;var l=s._id;return r._queue.push({event:"play",action:function(){r.play(l)}}),l}if(n&&!s._paused)return t||setTimeout((function(){r._emit("play",s._id)}),0),s._id;r._webAudio&&a._autoResume();var u=Math.max(0,s._seek>0?s._seek:r._sprite[e][0]/1e3),c=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-u),h=1e3*c/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=u,s._start=r._sprite[e][0]/1e3,s._stop=(r._sprite[e][0]+r._sprite[e][1])/1e3,s._loop=!(!s._loop&&!r._sprite[e][2]);var d=s._node;if(r._webAudio){var f=function(){r._refreshBuffer(s);var e=s._muted||r._muted?0:s._volume;d.gain.setValueAtTime(e,a.ctx.currentTime),s._playStart=a.ctx.currentTime,void 0===d.bufferSource.start?s._loop?d.bufferSource.noteGrainOn(0,u,86400):d.bufferSource.noteGrainOn(0,u,c):s._loop?d.bufferSource.start(0,u,86400):d.bufferSource.start(0,u,c),h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||setTimeout((function(){r._emit("play",s._id)}),0)};"running"===a.state?f():(r.once("resume",f),r._clearTimer(s._id))}else{var p=function(){d.currentTime=u,d.muted=s._muted||r._muted||a._muted||d.muted,d.volume=s._volume*a.volume(),d.playbackRate=s._rate;try{var e=d.play();if("undefined"!=typeof Promise&&e instanceof Promise&&(r._playLock=!0,e.then((function(){r._playLock=!1,r._loadQueue()}))),d.paused)return void r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||r._emit("play",s._id)}catch(e){r._emit("playerror",s._id,e)}},m=window&&window.ejecta||!d.readyState&&a._navigator.isCocoonJS;if(4===d.readyState||m)p();else{var g=function(){p(),d.removeEventListener(a._canPlayEvent,g,!1)};d.addEventListener(a._canPlayEvent,g,!1),r._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var r=t._getSoundIds(e),n=0;n<r.length;n++){t._clearTimer(r[n]);var i=t._soundById(r[n]);if(i&&!i._paused&&(i._seek=t.seek(r[n]),i._rateSeek=0,i._paused=!0,t._stopFade(r[n]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"stop",action:function(){r.stop(e)}}),r;for(var n=r._getSoundIds(e),i=0;i<n.length;i++){r._clearTimer(n[i]);var a=r._soundById(n[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,r._stopFade(n[i]),a._node&&(r._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),r._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause())),t||r._emit("stop",a._id))}return r},mute:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"mute",action:function(){r.mute(e,t)}}),r;if(void 0===t){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var n=r._getSoundIds(t),i=0;i<n.length;i++){var o=r._soundById(n[i]);o&&(o._muted=e,o._interval&&r._stopFade(o._id),r._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),r._emit("mute",o._id))}return r},volume:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._volume;if(1===i.length||2===i.length&&void 0===i[1]){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(r=t?n._soundById(t):n._sounds[0])?r._volume:0;if("loaded"!==n._state)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,i)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)(r=n._soundById(t[l]))&&(r._volume=e,i[2]||n._stopFade(t[l]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,a.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*a.volume()),n._emit("volume",r._id));return n},fade:function(e,t,r,n){var i=this;if("loaded"!==i._state)return i._queue.push({event:"fade",action:function(){i.fade(e,t,r,n)}}),i;i.volume(e,n);for(var o=i._getSoundIds(n),s=0;s<o.length;s++){var l=i._soundById(o[s]);if(l){if(n||i._stopFade(o[s]),i._webAudio&&!l._muted){var u=a.ctx.currentTime,c=u+r/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(t,c)}i._startFadeInterval(l,e,t,r,o[s],void 0===n)}}return i},_startFadeInterval:function(e,t,r,n,i,a){var o=this,s=t,l=r-t,u=Math.abs(l/.01),c=Math.max(4,u>0?n/u:n),h=Date.now();e._fadeTo=r,e._interval=setInterval((function(){var i=(Date.now()-h)/n;h=Date.now(),s+=l*i,s=Math.max(0,s),s=Math.min(1,s),s=Math.round(100*s)/100,o._webAudio?e._volume=s:o.volume(s,e._id,!0),a&&(o._volume=s),(r<t&&s<=r||r>t&&s>=r)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(r,e._id),o._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this._soundById(e);return t&&t._interval&&(this._webAudio&&t._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(t._interval),t._interval=null,this.volume(t._fadeTo,e),t._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(r=n._soundById(parseInt(i[0],10)))&&r._loop;e=i[0],n._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=n._getSoundIds(t),o=0;o<a.length;o++)(r=n._soundById(a[o]))&&(r._loop=e,n._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=e,e&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop)));return n},rate:function(){var e,t,r,n=this,i=arguments;if(0===i.length)t=n._sounds[0]._id;else if(1===i.length){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(r=n._soundById(t))?r._rate:n._rate;if("loaded"!==n._state)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,i)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)if(r=n._soundById(t[l])){r._rateSeek=n.seek(t[l]),r._playStart=n._webAudio?a.ctx.currentTime:r._playStart,r._rate=e,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):r._node&&(r._node.playbackRate=e);var u=n.seek(t[l]),c=(n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-u,h=1e3*c/Math.abs(r._rate);!n._endTimers[t[l]]&&r._paused||(n._clearTimer(t[l]),n._endTimers[t[l]]=setTimeout(n._ended.bind(n,r),h)),n._emit("rate",r._id)}return n},seek:function(){var e,t,r=this,n=arguments;if(0===n.length)t=r._sounds[0]._id;else if(1===n.length){var i=r._getSoundIds(),o=i.indexOf(n[0]);o>=0?t=parseInt(n[0],10):r._sounds.length&&(t=r._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return r;if("loaded"!==r._state)return r._queue.push({event:"seek",action:function(){r.seek.apply(r,n)}}),r;var s=r._soundById(t);if(s){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var l=r.playing(t)?a.ctx.currentTime-s._playStart:0,u=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(u+l*Math.abs(s._rate))}return s._node.currentTime}var c=r.playing(t);c&&r.pause(t,!0),s._seek=e,s._ended=!1,r._clearTimer(t),c&&r.play(t,!0),!r._webAudio&&s._node&&(s._node.currentTime=e),r._emit("seek",t)}return r},playing:function(e){if("number"==typeof e){var t=this._soundById(e);return!!t&&!t._paused}for(var r=0;r<this._sounds.length;r++)if(!this._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this._duration,r=this._soundById(e);return r&&(t=this._sprite[r._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,r=0;r<t.length;r++){if(t[r]._paused||e.stop(t[r]._id),!e._webAudio)/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(t[r]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[r]._node.removeEventListener("error",t[r]._errorFn,!1),t[r]._node.removeEventListener(a._canPlayEvent,t[r]._loadFn,!1);delete t[r]._node,e._clearTimer(t[r]._id);var n=a._howls.indexOf(e);n>=0&&a._howls.splice(n,1)}var i=!0;for(r=0;r<a._howls.length;r++)if(a._howls[r]._src===e._src){i=!1;break}return l&&i&&delete l[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,r,n){var i=this["_on"+e];return"function"==typeof t&&i.push(n?{id:r,fn:t,once:n}:{id:r,fn:t}),this},off:function(e,t,r){var n=this["_on"+e],i=0;if("number"==typeof t&&(r=t,t=null),t||r)for(i=0;i<n.length;i++){var a=r===n[i].id;if(t===n[i].fn&&a||!t&&a){n.splice(i,1);break}}else if(e)this["_on"+e]=[];else{var o=Object.keys(this);for(i=0;i<o.length;i++)0===o[i].indexOf("_on")&&Array.isArray(this[o[i]])&&(this[o[i]]=[])}return this},once:function(e,t,r){return this.on(e,t,r,1),this},_emit:function(e,t,r){for(var n=this["_on"+e],i=n.length-1;i>=0;i--)n[i].id&&n[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,r)}.bind(this,n[i].fn),0),n[i].once&&this.off(e,n[i].fn,n[i].id));return this},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,(function(){e._queue.shift(),e._loadQueue()})),t.action()}return e},_ended:function(e){var t=e._sprite;if(!this._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(this._ended.bind(this,e),100),this;var r=!(!e._loop&&!this._sprite[t][2]);if(this._emit("end",e._id),!this._webAudio&&r&&this.stop(e._id,!0).play(e._id),this._webAudio&&r){this._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var n=1e3*(e._stop-e._start)/Math.abs(e._rate);this._endTimers[e._id]=setTimeout(this._ended.bind(this,e),n)}return this._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,this._clearTimer(e._id),this._cleanBuffer(e._node),a._autoSuspend()),this._webAudio||r||this.stop(e._id),this},_clearTimer:function(e){return this._endTimers[e]&&(clearTimeout(this._endTimers[e]),delete this._endTimers[e]),this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new s(this)},_drain:function(){var e=this._pool,t=0,r=0;if(!(this._sounds.length<e)){for(r=0;r<this._sounds.length;r++)this._sounds[r]._ended&&t++;for(r=this._sounds.length-1;r>=0;r--){if(t<=e)return;this._sounds[r]._ended&&(this._webAudio&&this._sounds[r]._node&&this._sounds[r]._node.disconnect(0),this._sounds.splice(r,1),t--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],r=0;r<this._sounds.length;r++)t.push(this._sounds[r]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){if(a._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=a._scratchBuffer}catch(e){}}return e.bufferSource=null,this}};var s=function(e){this._parent=e,this.init()};s.prototype={init:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,e._sounds.push(this),this.create(),this},create:function(){var e=this._parent,t=a._muted||this._muted||this._parent._muted?0:this._volume;return e._webAudio?(this._node=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),this._node.gain.setValueAtTime(t,a.ctx.currentTime),this._node.paused=!0,this._node.connect(a.masterGain)):(this._node=new Audio,this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(a._canPlayEvent,this._loadFn,!1),this._node.src=e._src,this._node.preload="auto",this._node.volume=t*a.volume(),this._node.load()),this},reset:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(a._canPlayEvent,this._loadFn,!1)}};var l={},u=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var r=atob(t.split(",")[1]),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);h(n.buffer,e)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.withCredentials=e._xhrWithCredentials,a.responseType="arraybuffer",a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?h(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},c(a)}},c=function(e){try{e.send()}catch(t){e.onerror()}},h=function(e,t){a.ctx.decodeAudioData(e,(function(e){e&&t._sounds.length>0&&(l[t._src]=e,d(t,e))}),(function(){t._emit("loaderror",null,"Decoding audio data failed.")}))},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},f=function(){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(e){a.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=t?parseInt(t[1],10):null;if(e&&r&&r<9){var n=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());(a._navigator&&a._navigator.standalone&&!n||a._navigator&&!a._navigator.standalone&&!n)&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:1,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()};void 0===(n=function(){return{Howler:a,Howl:o}}.apply(t,[]))||(e.exports=n),t.Howler=a,t.Howl=o,"undefined"!=typeof window?(window.HowlerGlobal=i,window.Howler=a,window.Howl=o,window.Sound=s):void 0!==r&&(r.HowlerGlobal=i,r.Howler=a,r.Howl=o,r.Sound=s)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){if(!this.ctx||!this.ctx.listener)return this;for(var t=this._howls.length-1;t>=0;t--)this._howls[t].stereo(e);return this},HowlerGlobal.prototype.pos=function(e,t,r){return this.ctx&&this.ctx.listener?(t="number"!=typeof t?this._pos[1]:t,r="number"!=typeof r?this._pos[2]:r,"number"!=typeof e?this._pos:(this._pos=[e,t,r],this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(e,t,r,n,i,a){if(!this.ctx||!this.ctx.listener)return this;var o=this._orientation;return t="number"!=typeof t?o[1]:t,r="number"!=typeof r?o[2]:r,n="number"!=typeof n?o[3]:n,i="number"!=typeof i?o[4]:i,a="number"!=typeof a?o[5]:a,"number"!=typeof e?o:(this._orientation=[e,t,r,n,i,a],this.ctx.listener.setOrientation(e,t,r,n,i,a),this)},Howl.prototype.init=(e=Howl.prototype.init,function(t){return this._orientation=t.orientation||[1,0,0],this._stereo=t.stereo||null,this._pos=t.pos||null,this._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},this._onstereo=t.onstereo?[{fn:t.onstereo}]:[],this._onpos=t.onpos?[{fn:t.onpos}]:[],this._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,r)}}),n;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===r){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var s=n._soundById(a[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,i),"spatial"===i?s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",s._id)}}return n},Howl.prototype.pos=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,r,n,i)}}),a;if(r="number"!=typeof r?0:r,n="number"!=typeof n?-.5:n,void 0===i){if("number"!=typeof e)return a._pos;a._pos=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,r,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),l._panner.setPosition(e,r,n)),a._emit("pos",l._id)}}return a},Howl.prototype.orientation=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,r,n,i)}}),a;if(r="number"!=typeof r?a._orientation[1]:r,n="number"!=typeof n?a._orientation[2]:n,void 0===i){if("number"!=typeof e)return a._orientation;a._orientation=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,r,n],l._node&&(l._panner||(l._pos||(l._pos=a._pos||[0,0,-.5]),t(l,"spatial")),l._panner.setOrientation(e,r,n)),a._emit("orientation",l._id)}}return a},Howl.prototype.pannerAttr=function(){var e,r,n,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(n=i._soundById(parseInt(a[0],10)))?n._pannerAttr:i._pannerAttr;e=a[0],void 0===r&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],r=parseInt(a[1],10));for(var o=i._getSoundIds(r),s=0;s<o.length;s++)if(n=i._soundById(o[s])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this._parent;this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this),this._stereo?t.stereo(this._stereo):this._pos&&t.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this._parent;return this._orientation=t._orientation,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()}).call(this,r(5))},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function h(e,t,r,n){var i,a,o,s;if(u(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,s=l,console&&console.warn&&console.warn(s)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=d.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)a(l,this,t);else{var u=l.length,c=g(l,u);for(r=0;r<u;++r)a(c[r],this,t)}return!0},s.prototype.addListener=function(e,t){return h(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return h(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,a,o;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(module,exports,__webpack_require__){(function(process,__dirname){var OpenJPEG=function(Module){var Module;Module=Module||{},Module||(Module=(void 0!==OpenJPEG?OpenJPEG:null)||{});var moduleOverrides={};for(var key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER,ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print||(Module.print=function(e){process.stdout.write(e+"\n")}),Module.printErr||(Module.printErr=function(e){process.stderr.write(e+"\n")});var nodeFS=__webpack_require__(211),nodePath=__webpack_require__(212);Module.read=function(e,t){e=nodePath.normalize(e);var r=nodeFS.readFileSync(e);return r||e==nodePath.resolve(e)||(e=path.join(__dirname,"..","src",e),r=nodeFS.readFileSync(e)),r&&!t&&(r=r.toString()),r},Module.readBinary=function(e){var t=Module.read(e,!0);return t.buffer||(t=new Uint8Array(t)),assert(t.buffer),t},Module.load=function(e){globalEval(read(e))},Module.thisProgram||(process.argv.length>1?Module.thisProgram=process.argv[1].replace(/\\/g,"/"):Module.thisProgram="unknown-program"),Module.arguments=process.argv.slice(2),module.exports=Module,process.on("uncaughtException",(function(e){if(!(e instanceof ExitStatus))throw e})),Module.inspect=function(){return"[Emscripten Module object]"}}else if(ENVIRONMENT_IS_SHELL)Module.print||(Module.print=print),"undefined"!=typeof printErr&&(Module.printErr=printErr),"undefined"!=typeof read?Module.read=read:Module.read=function(){throw"no read() available (jsc?)"},Module.readBinary=function(e){if("function"==typeof readbuffer)return new Uint8Array(readbuffer(e));var t=read(e,"binary");return assert("object"==typeof t),t},"undefined"!=typeof scriptArgs?Module.arguments=scriptArgs:void 0!==arguments&&(Module.arguments=arguments);else{if(!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER)throw"Unknown runtime environment. Where are we?";if(Module.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},void 0!==arguments&&(Module.arguments=arguments),"undefined"!=typeof console)Module.print||(Module.print=function(e){console.log(e)}),Module.printErr||(Module.printErr=function(e){console.log(e)});else{var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&"undefined"!=typeof dump?function(e){dump(e)}:function(e){})}ENVIRONMENT_IS_WORKER&&(Module.load=importScripts),void 0===Module.setWindowTitle&&(Module.setWindowTitle=function(e){document.title=e})}function globalEval(e){eval.call(null,e)}for(var key in!Module.load&&Module.read&&(Module.load=function(e){globalEval(Module.read(e))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.thisProgram||(Module.thisProgram="./this.program"),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun=[],Module.postRun=[],moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);var Runtime={setTempRet0:function(e){tempRet0=e},getTempRet0:function(){return tempRet0},stackSave:function(){return STACKTOP},stackRestore:function(e){STACKTOP=e},getNativeTypeSize:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return Runtime.QUANTUM_SIZE;if("i"===e[0]){var t=parseInt(e.substr(1));return assert(t%8==0),t/8}return 0}},getNativeFieldSize:function(e){return Math.max(Runtime.getNativeTypeSize(e),Runtime.QUANTUM_SIZE)},STACK_ALIGN:16,prepVararg:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},getAlignSize:function(e,t,r){return r||"i64"!=e&&"double"!=e?e?Math.min(t||(e?Runtime.getNativeFieldSize(e):0),Runtime.QUANTUM_SIZE):Math.min(t,8):8},dynCall:function(e,t,r){return r&&r.length?(r.splice||(r=Array.prototype.slice.call(r)),r.splice(0,0,t),Module["dynCall_"+e].apply(null,r)):Module["dynCall_"+e].call(null,t)},functionPointers:[],addFunction:function(e){for(var t=0;t<Runtime.functionPointers.length;t++)if(!Runtime.functionPointers[t])return Runtime.functionPointers[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},removeFunction:function(e){Runtime.functionPointers[(e-2)/2]=null},warnOnce:function(e){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[e]||(Runtime.warnOnce.shown[e]=1,Module.printErr(e))},funcWrappers:{},getFuncWrapper:function(e,t){assert(t),Runtime.funcWrappers[t]||(Runtime.funcWrappers[t]={});var r=Runtime.funcWrappers[t];return r[e]||(r[e]=function(){return Runtime.dynCall(t,e,arguments)}),r[e]},getCompilerSetting:function(e){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},stackAlloc:function(e){var t=STACKTOP;return STACKTOP=(STACKTOP=STACKTOP+e|0)+15&-16,t},staticAlloc:function(e){var t=STATICTOP;return STATICTOP=(STATICTOP=STATICTOP+e|0)+15&-16,t},dynamicAlloc:function(e){var t=DYNAMICTOP;if((DYNAMICTOP=(DYNAMICTOP=DYNAMICTOP+e|0)+15&-16)>=TOTAL_MEMORY&&!enlargeMemory())return DYNAMICTOP=t,0;return t},alignMemory:function(e,t){return e=Math.ceil(e/(t||16))*(t||16)},makeBigInt:function(e,t,r){return r?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module.Runtime=Runtime;var __THREW__=0,ABORT=!1,EXITSTATUS=0,undef=0,tempValue,tempInt,tempBigInt,tempInt2,tempBigInt2,tempPair,tempBigIntI,tempBigIntR,tempBigIntS,tempBigIntP,tempBigIntD,tempDouble,tempFloat,tempI64,tempI64b,tempRet0,tempRet1,tempRet2,tempRet3,tempRet4,tempRet5,tempRet6,tempRet7,tempRet8,tempRet9;function assert(e,t){e||abort("Assertion failed: "+t)}var globalScope=this,cwrap,ccall;function getCFunc(ident){var func=Module["_"+ident];if(!func)try{func=eval("_"+ident)}catch(e){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}function setValue(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":HEAP8[e>>0]=t;break;case"i16":HEAP16[e>>1]=t;break;case"i32":HEAP32[e>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,+Math_abs(tempDouble)>=1?tempDouble>0?(0|Math_min(+Math_floor(tempDouble/4294967296),4294967295))>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=t;break;case"double":HEAPF64[e>>3]=t;break;default:abort("invalid type for setValue: "+r)}}function getValue(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return HEAP8[e>>0];case"i16":return HEAP16[e>>1];case"i32":case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for setValue: "+t)}return null}!function(){var JSfuncs={stackSave:function(){Runtime.stackSave()},stackRestore:function(){Runtime.stackRestore()},arrayToC:function(e){var t=Runtime.stackAlloc(e.length);return writeArrayToMemory(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&writeStringToMemory(e,t=Runtime.stackAlloc(1+(e.length<<2))),t}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};ccall=function(e,t,r,n,i){var a=getCFunc(e),o=[],s=0;if(n)for(var l=0;l<n.length;l++){var u=toC[r[l]];u?(0===s&&(s=Runtime.stackSave()),o[l]=u(n[l])):o[l]=n[l]}var c=a.apply(null,o);if("string"===t&&(c=Pointer_stringify(c)),0!==s){if(i&&i.async)return void EmterpreterAsync.asyncFinalizers.push((function(){Runtime.stackRestore(s)}));Runtime.stackRestore(s)}return c};var sourceRegex=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/;function parseJSFunc(e){var t=e.toString().match(sourceRegex).slice(1);return{arguments:t[0],body:t[1],returnValue:t[2]}}var JSsource={};for(var fun in JSfuncs)JSfuncs.hasOwnProperty(fun)&&(JSsource[fun]=parseJSFunc(JSfuncs[fun]));cwrap=function cwrap(ident,returnType,argTypes){argTypes=argTypes||[];var cfunc=getCFunc(ident),numericArgs=argTypes.every((function(e){return"number"===e})),numericRet="string"!==returnType;if(numericRet&&numericArgs)return cfunc;var argNames=argTypes.map((function(e,t){return"$"+t})),funcstr="(function("+argNames.join(",")+") {",nargs=argTypes.length;if(!numericArgs){funcstr+="var stack = "+JSsource.stackSave.body+";";for(var i=0;i<nargs;i++){var arg=argNames[i],type=argTypes[i];if("number"!==type){var convertCode=JSsource[type+"ToC"];funcstr+="var "+convertCode.arguments+" = "+arg+";",funcstr+=convertCode.body+";",funcstr+=arg+"="+convertCode.returnValue+";"}}}var cfuncname=parseJSFunc((function(){return cfunc})).returnValue;if(funcstr+="var ret = "+cfuncname+"("+argNames.join(",")+");",!numericRet){var strgfy=parseJSFunc((function(){return Pointer_stringify})).returnValue;funcstr+="ret = "+strgfy+"(ret);"}return numericArgs||(funcstr+=JSsource.stackRestore.body.replace("()","(stack)")+";"),funcstr+="return ret})",eval(funcstr)}}(),Module.ccall=ccall,Module.cwrap=cwrap,Module.setValue=setValue,Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;function allocate(e,t,r,n){var i,a;"number"==typeof e?(i=!0,a=e):(i=!1,a=e.length);var o,s="string"==typeof t?t:null;if(o=r==ALLOC_NONE?n:[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][void 0===r?ALLOC_STATIC:r](Math.max(a,s?1:t.length)),i){var l;n=o;for(assert(0==(3&o)),l=o+(-4&a);n<l;n+=4)HEAP32[n>>2]=0;for(l=o+a;n<l;)HEAP8[n++>>0]=0;return o}if("i8"===s)return e.subarray||e.slice?HEAPU8.set(e,o):HEAPU8.set(new Uint8Array(e),o),o;for(var u,c,h,d=0;d<a;){var f=e[d];"function"==typeof f&&(f=Runtime.getFunctionIndex(f)),0!==(u=s||t[d])?("i64"==u&&(u="i32"),setValue(o+d,f,u),h!==u&&(c=Runtime.getNativeTypeSize(u),h=u),d+=c):d++}return o}function getMemory(e){return staticSealed?void 0!==_sbrk&&!_sbrk.called||!runtimeInitialized?Runtime.dynamicAlloc(e):_malloc(e):Runtime.staticAlloc(e)}function Pointer_stringify(e,t){if(0===t||!e)return"";for(var r,n=0,i=0;n|=r=HEAPU8[e+i>>0],(0!=r||t)&&(i++,!t||i!=t););t||(t=i);var a="";if(n<128){for(var o;t>0;)o=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(t,1024))),a=a?a+o:o,e+=1024,t-=1024;return a}return Module.UTF8ToString(e)}function AsciiToString(e){for(var t="";;){var r=HEAP8[e++>>0];if(!r)return t;t+=String.fromCharCode(r)}}function stringToAscii(e,t){return writeAsciiToMemory(e,t,!1)}function UTF8ArrayToString(e,t){for(var r,n,i,a,o,s="";;){if(!(r=e[t++]))return s;if(128&r)if(n=63&e[t++],192!=(224&r))if(i=63&e[t++],224==(240&r)?r=(15&r)<<12|n<<6|i:(a=63&e[t++],240==(248&r)?r=(7&r)<<18|n<<12|i<<6|a:(o=63&e[t++],r=248==(252&r)?(3&r)<<24|n<<18|i<<12|a<<6|o:(1&r)<<30|n<<24|i<<18|a<<12|o<<6|63&e[t++])),r<65536)s+=String.fromCharCode(r);else{var l=r-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}else s+=String.fromCharCode((31&r)<<6|n);else s+=String.fromCharCode(r)}}function UTF8ToString(e){return UTF8ArrayToString(HEAPU8,e)}function stringToUTF8Array(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=2097151){if(r+3>=a)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=67108863){if(r+4>=a)break;t[r++]=248|s>>24,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+5>=a)break;t[r++]=252|s>>30,t[r++]=128|s>>24&63,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function stringToUTF8(e,t,r){return stringToUTF8Array(e,HEAPU8,t,r)}function lengthBytesUTF8(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:n<=2097151?4:n<=67108863?5:6}return t}function UTF16ToString(e){for(var t=0,r="";;){var n=HEAP16[e+2*t>>1];if(0==n)return r;++t,r+=String.fromCharCode(n)}}function stringToUTF16(e,t,r){if(void 0===r&&(r=2147483647),r<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,a=0;a<i;++a){var o=e.charCodeAt(a);HEAP16[t>>1]=o,t+=2}return HEAP16[t>>1]=0,t-n}function lengthBytesUTF16(e){return 2*e.length}function UTF32ToString(e){for(var t=0,r="";;){var n=HEAP32[e+4*t>>2];if(0==n)return r;if(++t,n>=65536){var i=n-65536;r+=String.fromCharCode(55296|i>>10,56320|1023&i)}else r+=String.fromCharCode(n)}}function stringToUTF32(e,t,r){if(void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a);if(HEAP32[t>>2]=o,(t+=4)+4>i)break}return HEAP32[t>>2]=0,t-n}function lengthBytesUTF32(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function demangle(e){var t=!!Module.___cxa_demangle;if(t)try{var r=_malloc(e.length);writeStringToMemory(e.substr(1),r);var n=_malloc(4),i=Module.___cxa_demangle(r,0,0,n);if(0===getValue(n,"i32")&&i)return Pointer_stringify(i)}catch(e){}finally{r&&_free(r),n&&_free(n),i&&_free(i)}var a=3,o={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},s=[],l=!0;var u=e;try{if("Object._main"==e||"_main"==e)return"main()";if("number"==typeof e&&(e=Pointer_stringify(e)),"_"!==e[0])return e;if("_"!==e[1])return e;if("Z"!==e[2])return e;switch(e[3]){case"n":return"operator new()";case"d":return"operator delete()"}u=function t(r,n,i){n=n||1/0;var u,c="",h=[];if("N"===e[a]){if(u=function(){a++,"K"===e[a]&&a++;for(var t=[];"E"!==e[a];)if("S"!==e[a])if("C"!==e[a]){var r=parseInt(e.substr(a)),n=r.toString().length;if(!r||!n){a--;break}var i=e.substr(a+n,r);t.push(i),s.push(i),a+=n+r}else t.push(t[t.length-1]),a+=2;else{a++;var o=e.indexOf("_",a),l=e.substring(a,o)||0;t.push(s[l]||"?"),a=o+1}return a++,t}().join("::"),0===--n)return r?[u]:u}else if(("K"===e[a]||l&&"L"===e[a])&&a++,m=parseInt(e.substr(a))){var d=m.toString().length;u=e.substr(a+d,m),a+=d+m}if(l=!1,"I"===e[a]){a++;var f=t(!0);c+=t(!0,1,!0)[0]+" "+u+"<"+f.join(", ")+">"}else c=u;e:for(;a<e.length&&n-- >0;){var p=e[a++];if(p in o)h.push(o[p]);else switch(p){case"P":h.push(t(!0,1,!0)[0]+"*");break;case"R":h.push(t(!0,1,!0)[0]+"&");break;case"L":a++;var m=e.indexOf("E",a)-a;h.push(e.substr(a,m)),a+=m+2;break;case"A":m=parseInt(e.substr(a));if(a+=m.toString().length,"_"!==e[a])throw"?";a++,h.push(t(!0,1,!0)[0]+" ["+m+"]");break;case"E":break e;default:c+="?"+p;break e}}return i||1!==h.length||"void"!==h[0]||(h=[]),r?(c&&h.push(c+"?"),h):c+"("+h.join(", ")+")"}()}catch(e){u+="?"}return u.indexOf("?")>=0&&!t&&Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),u}function demangleAll(e){return e.replace(/__Z[\w\d_]+/g,(function(e){var t=demangle(e);return e===t?e:e+" ["+t+"]"}))}function jsStackTrace(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE,Module.allocate=allocate,Module.getMemory=getMemory,Module.Pointer_stringify=Pointer_stringify,Module.AsciiToString=AsciiToString,Module.stringToAscii=stringToAscii,Module.UTF8ArrayToString=UTF8ArrayToString,Module.UTF8ToString=UTF8ToString,Module.stringToUTF8Array=stringToUTF8Array,Module.stringToUTF8=stringToUTF8,Module.lengthBytesUTF8=lengthBytesUTF8,Module.UTF16ToString=UTF16ToString,Module.stringToUTF16=stringToUTF16,Module.lengthBytesUTF16=lengthBytesUTF16,Module.UTF32ToString=UTF32ToString,Module.stringToUTF32=stringToUTF32,Module.lengthBytesUTF32=lengthBytesUTF32,Module.stackTrace=stackTrace;var PAGE_SIZE=4096,HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function alignMemoryPage(e){return e%4096>0&&(e+=4096-e%4096),e}var STATIC_BASE=0,STATICTOP=0,staticSealed=!1,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0,byteLength;function enlargeMemory(){var e=Math.pow(2,31);if(DYNAMICTOP>=e)return!1;for(;TOTAL_MEMORY<=DYNAMICTOP;)if(TOTAL_MEMORY<e/2)TOTAL_MEMORY=alignMemoryPage(2*TOTAL_MEMORY);else{var t=TOTAL_MEMORY;if((TOTAL_MEMORY=alignMemoryPage((3*TOTAL_MEMORY+e)/4))<=t)return!1}if((TOTAL_MEMORY=Math.max(TOTAL_MEMORY,16777216))>=e)return!1;try{if(ArrayBuffer.transfer)buffer=ArrayBuffer.transfer(buffer,TOTAL_MEMORY);else{var r=HEAP8;buffer=new ArrayBuffer(TOTAL_MEMORY)}}catch(e){return!1}return!!_emscripten_replace_memory(buffer)&&(Module.buffer=buffer,Module.HEAP8=HEAP8=new Int8Array(buffer),Module.HEAP16=HEAP16=new Int16Array(buffer),Module.HEAP32=HEAP32=new Int32Array(buffer),Module.HEAPU8=HEAPU8=new Uint8Array(buffer),Module.HEAPU16=HEAPU16=new Uint16Array(buffer),Module.HEAPU32=HEAPU32=new Uint32Array(buffer),Module.HEAPF32=HEAPF32=new Float32Array(buffer),Module.HEAPF64=HEAPF64=new Float64Array(buffer),ArrayBuffer.transfer||HEAP8.set(r),!0)}try{byteLength=Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get),byteLength(new ArrayBuffer(4))}catch(e){byteLength=function(e){return e.byteLength}}for(var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216,totalMemory=65536,buffer;totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK;)totalMemory<16777216?totalMemory*=2:totalMemory+=16777216;function callRuntimeCallbacks(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?Runtime.dynCall("v",r):Runtime.dynCall("vi",r,[t.arg]):r(void 0===t.arg?null:t.arg)}else t()}}totalMemory=Math.max(totalMemory,16777216),totalMemory!==TOTAL_MEMORY&&(TOTAL_MEMORY=totalMemory),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(TOTAL_MEMORY),HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(255===HEAPU8[0]&&0===HEAPU8[3],"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.buffer=buffer,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1;function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__),runtimeExited=!0}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPreMain(e){__ATMAIN__.unshift(e)}function addOnExit(e){__ATEXIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}function intArrayFromString(e,t,r){var n=r>0?r:lengthBytesUTF8(e)+1,i=new Array(n),a=stringToUTF8Array(e,i,0,i.length);return t&&(i.length=a),i}function intArrayToString(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n>255&&(n&=255),t.push(String.fromCharCode(n))}return t.join("")}function writeStringToMemory(e,t,r){for(var n=intArrayFromString(e,r),i=0;i<n.length;){var a=n[i];HEAP8[t+i>>0]=a,i+=1}}function writeArrayToMemory(e,t){for(var r=0;r<e.length;r++)HEAP8[t++>>0]=e[r]}function writeAsciiToMemory(e,t,r){for(var n=0;n<e.length;++n)HEAP8[t++>>0]=e.charCodeAt(n);r||(HEAP8[t>>0]=0)}function unSign(e,t,r){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function reSign(e,t,r){if(e<=0)return e;var n=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=n&&(t<=32||e>n)&&(e=-2*n+e),e}Module.addOnPreRun=addOnPreRun,Module.addOnInit=addOnInit,Module.addOnPreMain=addOnPreMain,Module.addOnExit=addOnExit,Module.addOnPostRun=addOnPostRun,Module.intArrayFromString=intArrayFromString,Module.intArrayToString=intArrayToString,Module.writeStringToMemory=writeStringToMemory,Module.writeArrayToMemory=writeArrayToMemory,Module.writeAsciiToMemory=writeAsciiToMemory,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16)*n+r*(t>>>16)<<16)|0}),Math.imul=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;t<32;t++)if(e&1<<31-t)return t;return 32}),Math.clz32=Math.clz32;var Math_abs=Math.abs,Math_cos=Math.cos,Math_sin=Math.sin,Math_tan=Math.tan,Math_acos=Math.acos,Math_asin=Math.asin,Math_atan=Math.atan,Math_atan2=Math.atan2,Math_exp=Math.exp,Math_log=Math.log,Math_sqrt=Math.sqrt,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_imul=Math.imul,Math_fround=Math.fround,Math_min=Math.min,Math_clz32=Math.clz32,runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}Module.addRunDependency=addRunDependency,Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={};var memoryInitializer=null,ASM_CONSTS=[];STATIC_BASE=8,STATICTOP=STATIC_BASE+25664,__ATINIT__.push(),allocate([131,192,202,161,69,182,251,63,127,251,58,112,206,136,234,63,127,251,58,112,206,136,234,63,131,192,202,161,69,182,251,63,225,122,20,174,71,225,252,63,94,186,73,12,2,43,249,63,0,0,0,0,0,0,240,63,0,0,0,0,0,0,248,63,0,0,0,0,0,0,6,64,0,0,0,0,0,128,21,64,92,143,194,245,40,92,37,64,215,163,112,61,10,87,53,64,246,40,92,143,194,85,69,64,133,235,81,184,30,85,85,64,102,102,102,102,102,86,101,64,205,204,204,204,204,84,117,64,207,247,83,227,165,155,240,63,70,182,243,253,212,120,249,63,39,49,8,172,28,90,7,64,29,90,100,59,223,207,22,64,41,92,143,194,245,168,38,64,164,112,61,10,215,163,54,64,0,0,0,0,0,160,70,64,31,133,235,81,184,158,86,64,205,204,204,204,204,156,102,64,0,0,0,0,0,0,0,0,207,247,83,227,165,155,240,63,70,182,243,253,212,120,249,63,39,49,8,172,28,90,7,64,29,90,100,59,223,207,22,64,41,92,143,194,245,168,38,64,164,112,61,10,215,163,54,64,0,0,0,0,0,160,70,64,31,133,235,81,184,158,86,64,205,204,204,204,204,156,102,64,0,0,0,0,0,0,0,0,173,250,92,109,197,254,230,63,86,125,174,182,98,127,237,63,199,75,55,137,65,96,249,63,242,210,77,98,16,88,8,64,250,126,106,188,116,19,24,64,133,235,81,184,30,5,40,64,0,0,0,0,0,0,56,64,92,143,194,245,40,252,71,64,236,81,184,30,133,251,87,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240,63,113,61,10,215,163,112,255,63,104,145,237,124,63,181,16,64,117,147,24,4,86,206,32,64,102,102,102,102,102,230,48,64,236,81,184,30,133,235,64,64,92,143,194,245,40,236,80,64,154,153,153,153,153,233,96,64,154,153,153,153,153,233,112,64,51,51,51,51,51,231,128,64,147,24,4,86,14,45,0,64,182,243,253,212,120,233,15,64,246,40,92,143,194,181,32,64,10,215,163,112,61,10,49,64,195,245,40,92,143,34,65,64,184,30,133,235,81,40,81,64,154,153,153,153,153,41,97,64,154,153,153,153,153,41,113,64,0,0,0,0,0,40,129,64,0,0,0,0,0,0,0,0,147,24,4,86,14,45,0,64,182,243,253,212,120,233,15,64,246,40,92,143,194,181,32,64,10,215,163,112,61,10,49,64,195,245,40,92,143,34,65,64,184,30,133,235,81,40,81,64,154,153,153,153,153,41,97,64,154,153,153,153,153,41,113,64,0,0,0,0,0,40,129,64,0,0,0,0,0,0,0,0,164,112,61,10,215,163,0,64,236,81,184,30,133,235,14,64,119,190,159,26,47,157,32,64,174,71,225,122,20,46,49,64,123,20,174,71,225,90,65,64,246,40,92,143,194,101,81,64,154,153,153,153,153,105,97,64,154,153,153,153,153,105,113,64,154,153,153,153,153,105,129,64,0,0,0,0,0,0,0,0,4,0,0,0,67,80,82,76,0,0,0,0,0,0,0,0,76,82,67,80,0,0,0,0,3,0,0,0,80,67,82,76,0,0,0,0,1,0,0,0,82,76,67,80,0,0,0,0,2,0,0,0,82,80,67,76,0,0,0,0,255,255,255,255,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,3,0,0,0,4,0,0,0,144,255,0,0,12,0,0,0,1,0,0,0,82,255,0,0,20,0,0,0,2,0,0,0,83,255,0,0,20,0,0,0,3,0,0,0,94,255,0,0,20,0,0,0,4,0,0,0,92,255,0,0,20,0,0,0,5,0,0,0,93,255,0,0,20,0,0,0,6,0,0,0,95,255,0,0,20,0,0,0,7,0,0,0,81,255,0,0,2,0,0,0,8,0,0,0,85,255,0,0,4,0,0,0,9,0,0,0,87,255,0,0,4,0,0,0,10,0,0,0,88,255,0,0,16,0,0,0,11,0,0,0,96,255,0,0,4,0,0,0,12,0,0,0,97,255,0,0,16,0,0,0,13,0,0,0,145,255,0,0,0,0,0,0,0,0,0,0,99,255,0,0,4,0,0,0,14,0,0,0,100,255,0,0,20,0,0,0,15,0,0,0,116,255,0,0,20,0,0,0,16,0,0,0,120,255,0,0,4,0,0,0,17,0,0,0,117,255,0,0,20,0,0,0,18,0,0,0,119,255,0,0,20,0,0,0,19,0,0,0,0,0,0,0,20,0,0,0,0,0,0,0,2,0,0,0,4,0,0,0,4,0,0,0,8,0,0,0,5,0,0,0,6,0,0,0,7,0,0,0,8,0,0,0,9,0,0,0,10,0,0,0,11,0,0,0,12,0,0,0,32,32,80,106,20,0,0,0,112,121,116,102,21,0,0,0,104,50,112,106,22,0,0,0,114,100,104,105,23,0,0,0,114,108,111,99,24,0,0,0,99,99,112,98,25,0,0,0,114,108,99,112,26,0,0,0,112,97,109,99,27,0,0,0,102,101,100,99,28,0,0,0,1,86,0,0,0,0,0,0,164,4,0,0,180,4,0,0,1,86,0,0,1,0,0,0,180,4,0,0,164,4,0,0,1,52,0,0,0,0,0,0,196,4,0,0,68,5,0,0,1,52,0,0,1,0,0,0,212,4,0,0,84,5,0,0,1,24,0,0,0,0,0,0,228,4,0,0,164,5,0,0,1,24,0,0,1,0,0,0,244,4,0,0,180,5,0,0,193,10,0,0,0,0,0,0,4,5,0,0,4,6,0,0,193,10,0,0,1,0,0,0,20,5,0,0,20,6,0,0,33,5,0,0,0,0,0,0,36,5,0,0,36,8,0,0,33,5,0,0,1,0,0,0,52,5,0,0,52,8,0,0,33,2,0,0,0,0,0,0,68,9,0,0,164,8,0,0,33,2,0,0,1,0,0,0,84,9,0,0,180,8,0,0,1,86,0,0,0,0,0,0,100,5,0,0,84,5,0,0,1,86,0,0,1,0,0,0,116,5,0,0,68,5,0,0,1,84,0,0,0,0,0,0,132,5,0,0,68,6,0,0,1,84,0,0,1,0,0,0,148,5,0,0,84,6,0,0,1,72,0,0,0,0,0,0,164,5,0,0,68,6,0,0,1,72,0,0,1,0,0,0,180,5,0,0,84,6,0,0,1,56,0,0,0,0,0,0,196,5,0,0,68,6,0,0,1,56,0,0,1,0,0,0,212,5,0,0,84,6,0,0,1,48,0,0,0,0,0,0,228,5,0,0,164,6,0,0,1,48,0,0,1,0,0,0,244,5,0,0,180,6,0,0,1,36,0,0,0,0,0,0,4,6,0,0,196,6,0,0,1,36,0,0,1,0,0,0,20,6,0,0,212,6,0,0,1,28,0,0,0,0,0,0,36,6,0,0,4,7,0,0,1,28,0,0,1,0,0,0,52,6,0,0,20,7,0,0,1,22,0,0,0,0,0,0,36,8,0,0,36,7,0,0,1,22,0,0,1,0,0,0,52,8,0,0,52,7,0,0,1,86,0,0,0,0,0,0,100,6,0,0,84,6,0,0,1,86,0,0,1,0,0,0,116,6,0,0,68,6,0,0,1,84,0,0,0,0,0,0,132,6,0,0,68,6,0,0,1,84,0,0,1,0,0,0,148,6,0,0,84,6,0,0,1,81,0,0,0,0,0,0,164,6,0,0,100,6,0,0,1,81,0,0,1,0,0,0,180,6,0,0,116,6,0,0,1,72,0,0,0,0,0,0,196,6,0,0,132,6,0,0,1,72,0,0,1,0,0,0,212,6,0,0,148,6,0,0,1,56,0,0,0,0,0,0,228,6,0,0,164,6,0,0,1,56,0,0,1,0,0,0,244,6,0,0,180,6,0,0,1,52,0,0,0,0,0,0,4,7,0,0,196,6,0,0,1,52,0,0,1,0,0,0,20,7,0,0,212,6,0,0,1,48,0,0,0,0,0,0,36,7,0,0,228,6,0,0,1,48,0,0,1,0,0,0,52,7,0,0,244,6,0,0,1,40,0,0,0,0,0,0,68,7,0,0,228,6,0,0,1,40,0,0,1,0,0,0,84,7,0,0,244,6,0,0,1,36,0,0,0,0,0,0,100,7,0,0,4,7,0,0,1,36,0,0,1,0,0,0,116,7,0,0,20,7,0,0,1,34,0,0,0,0,0,0,132,7,0,0,36,7,0,0,1,34,0,0,1,0,0,0,148,7,0,0,52,7,0,0,1,28,0,0,0,0,0,0,164,7,0,0,68,7,0,0,1,28,0,0,1,0,0,0,180,7,0,0,84,7,0,0,1,24,0,0,0,0,0,0,196,7,0,0,100,7,0,0,1,24,0,0,1,0,0,0,212,7,0,0,116,7,0,0,1,22,0,0,0,0,0,0,228,7,0,0,132,7,0,0,1,22,0,0,1,0,0,0,244,7,0,0,148,7,0,0,1,20,0,0,0,0,0,0,4,8,0,0,164,7,0,0,1,20,0,0,1,0,0,0,20,8,0,0,180,7,0,0,1,18,0,0,0,0,0,0,36,8,0,0,196,7,0,0,1,18,0,0,1,0,0,0,52,8,0,0,212,7,0,0,1,17,0,0,0,0,0,0,68,8,0,0,228,7,0,0,1,17,0,0,1,0,0,0,84,8,0,0,244,7,0,0,193,10,0,0,0,0,0,0,100,8,0,0,4,8,0,0,193,10,0,0,1,0,0,0,116,8,0,0,20,8,0,0,193,9,0,0,0,0,0,0,132,8,0,0,36,8,0,0,193,9,0,0,1,0,0,0,148,8,0,0,52,8,0,0,161,8,0,0,0,0,0,0,164,8,0,0,68,8,0,0,161,8,0,0,1,0,0,0,180,8,0,0,84,8,0,0,33,5,0,0,0,0,0,0,196,8,0,0,100,8,0,0,33,5,0,0,1,0,0,0,212,8,0,0,116,8,0,0,65,4,0,0,0,0,0,0,228,8,0,0,132,8,0,0,65,4,0,0,1,0,0,0,244,8,0,0,148,8,0,0,161,2,0,0,0,0,0,0,4,9,0,0,164,8,0,0,161,2,0,0,1,0,0,0,20,9,0,0,180,8,0,0,33,2,0,0,0,0,0,0,36,9,0,0,196,8,0,0,33,2,0,0,1,0,0,0,52,9,0,0,212,8,0,0,65,1,0,0,0,0,0,0,68,9,0,0,228,8,0,0,65,1,0,0,1,0,0,0,84,9,0,0,244,8,0,0,17,1,0,0,0,0,0,0,100,9,0,0,4,9,0,0,17,1,0,0,1,0,0,0,116,9,0,0,20,9,0,0,133,0,0,0,0,0,0,0,132,9,0,0,36,9,0,0,133,0,0,0,1,0,0,0,148,9,0,0,52,9,0,0,73,0,0,0,0,0,0,0,164,9,0,0,68,9,0,0,73,0,0,0,1,0,0,0,180,9,0,0,84,9,0,0,37,0,0,0,0,0,0,0,196,9,0,0,100,9,0,0,37,0,0,0,1,0,0,0,212,9,0,0,116,9,0,0,21,0,0,0,0,0,0,0,228,9,0,0,132,9,0,0,21,0,0,0,1,0,0,0,244,9,0,0,148,9,0,0,9,0,0,0,0,0,0,0,4,10,0,0,164,9,0,0,9,0,0,0,1,0,0,0,20,10,0,0,180,9,0,0,5,0,0,0,0,0,0,0,36,10,0,0,196,9,0,0,5,0,0,0,1,0,0,0,52,10,0,0,212,9,0,0,1,0,0,0,0,0,0,0,36,10,0,0,228,9,0,0,1,0,0,0,1,0,0,0,52,10,0,0,244,9,0,0,1,86,0,0,0,0,0,0,68,10,0,0,68,10,0,0,1,86,0,0,1,0,0,0,84,10,0,0,84,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,11,0,0,12,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,3,0,0,0,38,94,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,64,4,32,0,32,2,128,0,128,8,16,0,16,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,3,128,4,0,6,128,7,0,9,128,10,0,12,128,13,0,15,128,16,0,18,128,19,0,21,128,22,0,24,128,25,0,27,128,28,0,30,128,31,0,33,128,34,0,36,128,37,0,39,128,40,0,42,128,43,0,45,128,46,0,48,128,49,0,51,128,52,0,54,128,55,0,57,128,58,0,60,128,61,0,63,128,64,0,66,128,67,0,69,128,70,0,72,128,73,0,75,128,76,0,78,128,79,0,81,128,82,0,84,128,85,0,87,128,88,0,90,128,91,0,93,128,94,0,96,128,97,0,99,128,100,0,102,128,103,0,105,128,106,0,108,128,109,0,111,128,112,0,114,128,115,0,117,128,118,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,128,0,128,0,0,1,0,1,0,1,128,1,128,1,0,2,0,2,128,2,128,2,0,3,0,3,128,3,0,4,0,4,128,4,0,5,128,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,128,11,0,12,128,12,0,13,0,14,128,14,0,15,0,16,128,16,128,17,0,18,0,19,128,19,128,20,0,21,0,22,0,23,128,23,128,24,128,25,128,26,0,27,0,28,0,29,0,30,0,31,0,32,0,33,0,34,0,35,0,36,0,37,128,38,128,39,128,40,128,41,0,43,0,44,0,45,128,46,128,47,0,49,0,50,128,51,128,52,0,54,0,55,128,56,0,58,0,59,128,60,0,62,128,63,128,64,0,66,128,67,0,69,128,70,0,72,128,73,0,75,128,76,0,78,128,79,128,81,0,83,128,84,0,86,0,88,128,89,0,91,0,93,128,94,128,96,0,98,0,100,128,101,128,103,0,105,0,107,0,109,128,110,128,112,128,114,128,116,0,118,0,120,0,122,0,124,0,126,0,24,128,23,0,23,128,22,0,22,128,21,0,21,128,20,0,20,128,19,0,19,128,18,0,18,128,17,0,17,128,16,0,16,128,15,0,15,128,14,0,14,128,13,0,13,128,12,0,12,128,11,0,11,128,10,0,10,128,9,0,9,128,8,0,8,128,7,0,7,128,6,0,6,128,5,0,5,128,4,0,4,128,3,0,3,128,2,0,2,128,1,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,1,128,1,0,2,128,2,0,3,128,3,0,4,128,4,0,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,0,11,128,11,0,12,128,12,0,13,128,13,0,14,128,14,0,15,128,15,0,16,128,16,0,17,128,17,0,18,128,18,0,19,128,19,0,20,128,20,0,21,128,21,0,22,128,22,0,23,128,23,0,32,0,31,0,30,0,29,0,28,0,27,128,26,128,25,128,24,128,23,0,23,0,22,0,21,128,20,128,19,0,19,0,18,128,17,128,16,0,16,0,15,128,14,0,14,0,13,128,12,0,12,128,11,128,10,0,10,128,9,0,9,128,8,0,8,128,7,0,7,128,6,0,6,128,5,128,5,0,5,128,4,0,4,0,4,128,3,0,3,0,3,128,2,128,2,0,2,0,2,128,1,128,1,0,1,0,1,0,1,128,0,128,0,128,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,128,0,128,0,0,1,0,1,0,1,128,1,128,1,0,2,0,2,128,2,128,2,0,3,0,3,128,3,0,4,0,4,128,4,0,5,128,5,128,5,0,6,128,6,0,7,128,7,0,8,128,8,0,9,128,9,0,10,128,10,128,11,0,12,128,12,0,13,0,14,128,14,0,15,0,16,128,16,128,17,0,18,0,19,128,19,128,20,0,21,0,22,0,23,128,23,128,24,128,25,128,26,0,27,0,28,0,29,0,30,0,31,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,115,101,116,117,112,32,116,104,101,32,100,101,99,111,100,101,114,0,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,114,101,97,100,32,116,104,101,32,104,101,97,100,101,114,0,91,69,82,82,79,82,93,32,111,112,106,95,100,101,99,111,109,112,114,101,115,115,58,32,102,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,33,0,91,69,82,82,79,82,93,32,37,115,0,83,116,114,101,97,109,32,114,101,97,99,104,101,100,32,105,116,115,32,101,110,100,32,33,10,0,69,114,114,111,114,32,111,110,32,119,114,105,116,105,110,103,32,115,116,114,101,97,109,33,10,0,83,116,114,101,97,109,32,101,114,114,111,114,33,10,0,50,46,49,46,48,0,67,111,100,101,99,32,112,114,111,118,105,100,101,100,32,116,111,32,116,104,101,32,111,112,106,95,115,101,116,117,112,95,100,101,99,111,100,101,114,32,102,117,110,99,116,105,111,110,32,105,115,32,110,111,116,32,97,32,100,101,99,111,109,112,114,101,115,115,111,114,32,104,97,110,100,108,101,114,46,10,0,67,111,100,101,99,32,112,114,111,118,105,100,101,100,32,116,111,32,116,104,101,32,111,112,106,95,114,101,97,100,95,104,101,97,100,101,114,32,102,117,110,99,116,105,111,110,32,105,115,32,110,111,116,32,97,32,100,101,99,111,109,112,114,101,115,115,111,114,32,104,97,110,100,108,101,114,46,10,0,119,98,0,114,98,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,58,32,37,100,32,110,111,116,32,105,110,32,114,97,110,103,101,32,91,49,44,37,100,93,10,0,68,101,112,114,101,99,97,116,101,100,32,102,105,101,108,100,115,32,99,112,95,99,105,110,101,109,97,32,111,114,32,99,112,95,114,115,105,122,32,97,114,101,32,117,115,101,100,10,80,108,101,97,115,101,32,99,111,110,115,105,100,101,114,32,117,115,105,110,103,32,111,110,108,121,32,116,104,101,32,114,115,105,122,32,102,105,101,108,100,10,83,101,101,32,111,112,101,110,106,112,101,103,46,104,32,100,111,99,117,109,101,110,116,97,116,105,111,110,32,102,111,114,32,109,111,114,101,32,100,101,116,97,105,108,115,10,0,84,104,101,32,100,101,115,105,114,101,100,32,109,97,120,105,109,117,109,32,99,111,100,101,115,116,114,101,97,109,32,115,105,122,101,32,104,97,115,32,108,105,109,105,116,101,100,10,97,116,32,108,101,97,115,116,32,111,110,101,32,111,102,32,116,104,101,32,100,101,115,105,114,101,100,32,113,117,97,108,105,116,121,32,108,97,121,101,114,115,10,0,74,80,69,71,32,50,48,48,48,32,83,99,97,108,97,98,108,101,32,68,105,103,105,116,97,108,32,67,105,110,101,109,97,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,49,32,115,105,110,103,108,101,32,113,117,97,108,105,116,121,32,108,97,121,101,114,45,62,32,78,117,109,98,101,114,32,111,102,32,108,97,121,101,114,115,32,102,111,114,99,101,100,32,116,111,32,49,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,45,62,32,82,97,116,101,32,111,102,32,116,104,101,32,108,97,115,116,32,108,97,121,101,114,32,40,37,51,46,49,102,41,32,119,105,108,108,32,98,101,32,117,115,101,100,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,60,61,32,53,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,53,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,62,61,32,49,32,38,38,32,60,61,32,54,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,49,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,62,61,32,49,32,38,38,32,60,61,32,54,10,45,62,32,78,117,109,98,101,114,32,111,102,32,100,101,99,111,109,112,111,115,105,116,105,111,110,32,108,101,118,101,108,115,32,102,111,114,99,101,100,32,116,111,32,54,32,40,114,97,116,104,101,114,32,116,104,97,110,32,37,100,41,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,51,48,50,48,56,51,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,65,115,32,110,111,32,114,97,116,101,32,104,97,115,32,98,101,101,110,32,103,105,118,101,110,44,32,116,104,105,115,32,108,105,109,105,116,32,119,105,108,108,32,98,101,32,117,115,101,100,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,51,48,50,48,56,51,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,45,62,32,83,112,101,99,105,102,105,101,100,32,114,97,116,101,32,101,120,99,101,101,100,115,32,116,104,105,115,32,108,105,109,105,116,46,32,82,97,116,101,32,119,105,108,108,32,98,101,32,102,111,114,99,101,100,32,116,111,32,49,51,48,50,48,56,51,32,98,121,116,101,115,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,48,52,49,54,54,54,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,65,115,32,110,111,32,114,97,116,101,32,104,97,115,32,98,101,101,110,32,103,105,118,101,110,44,32,116,104,105,115,32,108,105,109,105,116,32,119,105,108,108,32,98,101,32,117,115,101,100,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,97,110,100,32,52,32,40,50,107,47,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,77,97,120,105,109,117,109,32,49,48,52,49,54,54,54,32,99,111,109,112,114,101,115,115,101,100,32,98,121,116,101,115,32,64,32,50,52,102,112,115,10,45,62,32,83,112,101,99,105,102,105,101,100,32,114,97,116,101,32,101,120,99,101,101,100,115,32,116,104,105,115,32,108,105,109,105,116,46,32,82,97,116,101,32,119,105,108,108,32,98,101,32,102,111,114,99,101,100,32,116,111,32,49,48,52,49,54,54,54,32,98,121,116,101,115,46,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,51,32,99,111,109,112,111,110,101,110,116,115,45,62,32,78,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,111,102,32,105,110,112,117,116,32,105,109,97,103,101,32,40,37,100,41,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,115,105,103,110,101,100,0,117,110,115,105,103,110,101,100,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,80,114,101,99,105,115,105,111,110,32,111,102,32,101,97,99,104,32,99,111,109,112,111,110,101,110,116,32,115,104,97,108,108,32,98,101,32,49,50,32,98,105,116,115,32,117,110,115,105,103,110,101,100,45,62,32,65,116,32,108,101,97,115,116,32,99,111,109,112,111,110,101,110,116,32,37,100,32,111,102,32,105,110,112,117,116,32,105,109,97,103,101,32,40,37,100,32,98,105,116,115,44,32,37,115,41,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,51,32,40,50,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,119,105,100,116,104,32,60,61,32,50,48,52,56,32,97,110,100,32,104,101,105,103,104,116,32,60,61,32,49,48,56,48,10,45,62,32,73,110,112,117,116,32,105,109,97,103,101,32,115,105,122,101,32,37,100,32,120,32,37,100,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,51,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,114,111,102,105,108,101,45,52,32,40,52,107,32,100,99,32,112,114,111,102,105,108,101,41,32,114,101,113,117,105,114,101,115,58,10,119,105,100,116,104,32,60,61,32,52,48,57,54,32,97,110,100,32,104,101,105,103,104,116,32,60,61,32,50,49,54,48,10,45,62,32,73,109,97,103,101,32,115,105,122,101,32,37,100,32,120,32,37,100,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,10,45,62,32,78,111,110,45,112,114,111,102,105,108,101,45,52,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,98,101,32,103,101,110,101,114,97,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,76,111,110,103,32,84,101,114,109,32,83,116,111,114,97,103,101,32,112,114,111,102,105,108,101,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,66,114,111,97,100,99,97,115,116,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,73,77,70,32,112,114,111,102,105,108,101,115,32,110,111,116,32,121,101,116,32,115,117,112,112,111,114,116,101,100,10,0,74,80,69,71,32,50,48,48,48,32,80,97,114,116,45,50,32,112,114,111,102,105,108,101,32,100,101,102,105,110,101,100,10,98,117,116,32,110,111,32,80,97,114,116,45,50,32,101,120,116,101,110,115,105,111,110,32,101,110,97,98,108,101,100,46,10,80,114,111,102,105,108,101,32,115,101,116,32,116,111,32,78,79,78,69,46,10,0,85,110,115,117,112,112,111,114,116,101,100,32,80,97,114,116,45,50,32,101,120,116,101,110,115,105,111,110,32,101,110,97,98,108,101,100,10,80,114,111,102,105,108,101,32,115,101,116,32,116,111,32,78,79,78,69,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,112,121,32,111,102,32,117,115,101,114,32,101,110,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,112,121,32,111,102,32,99,111,109,109,101,110,116,32,115,116,114,105,110,103,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,99,111,109,109,101,110,116,32,115,116,114,105,110,103,10,0,37,115,37,115,0,67,114,101,97,116,101,100,32,98,121,32,79,112,101,110,74,80,69,71,32,118,101,114,115,105,111,110,32,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,105,108,101,32,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,99,104,101,99,107,105,110,103,32,116,104,101,32,112,111,99,32,118,97,108,117,101,115,46,10,0,77,105,115,115,105,110,103,32,112,97,99,107,101,116,115,32,112,111,115,115,105,98,108,101,32,108,111,115,115,32,111,102,32,100,97,116,97,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,105,108,101,32,99,111,109,112,111,110,101,110,116,32,99,111,100,105,110,103,32,112,97,114,97,109,101,116,101,114,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,116,101,109,112,32,98,117,102,102,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,100,101,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,70,97,105,108,101,100,32,116,111,32,105,110,118,101,114,115,101,32,101,110,99,111,100,101,114,32,77,67,84,32,100,101,99,111,100,105,110,103,32,109,97,116,114,105,120,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,108,108,111,99,97,116,101,32,101,110,99,111,100,101,114,32,77,67,84,32,110,111,114,109,115,32,10,0,70,97,105,108,101,100,32,116,111,32,115,101,116,117,112,32,106,50,107,32,109,99,116,32,101,110,99,111,100,105,110,103,10,0,67,97,110,110,111,116,32,112,101,114,102,111,114,109,32,77,67,84,32,111,110,32,99,111,109,112,111,110,101,110,116,115,32,119,105,116,104,32,100,105,102,102,101,114,101,110,116,32,115,105,122,101,115,46,32,68,105,115,97,98,108,105,110,103,32,77,67,84,46,10,0,83,116,114,101,97,109,32,116,111,111,32,115,104,111,114,116,10,0,73,110,99,111,110,115,105,115,116,101,110,116,32,109,97,114,107,101,114,32,115,105,122,101,10,0,77,97,114,107,101,114,32,105,115,32,110,111,116,32,99,111,109,112,108,105,97,110,116,32,119,105,116,104,32,105,116,115,32,112,111,115,105,116,105,111,110,10,0,77,97,114,107,101,114,32,115,105,122,101,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,115,116,114,101,97,109,32,108,101,110,103,116,104,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,104,101,97,100,101,114,10,0,78,111,116,32,115,117,114,101,32,104,111,119,32,116,104,97,116,32,104,97,112,112,101,110,101,100,46,10,0,70,97,105,108,32,116,111,32,114,101,97,100,32,116,104,101,32,99,117,114,114,101,110,116,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,32,40,37,35,120,41,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,116,108,32,109,97,114,107,101,114,10,0,84,105,108,101,32,112,97,114,116,32,108,101,110,103,116,104,32,115,105,122,101,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,115,116,114,101,97,109,32,108,101,110,103,116,104,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,79,84,32,109,97,114,107,101,114,10,0,111,112,106,95,106,50,107,95,97,112,112,108,121,95,110,98,95,116,105,108,101,95,112,97,114,116,115,95,99,111,114,114,101,99,116,105,111,110,32,101,114,114,111,114,10,0,78,111,110,32,99,111,110,102,111,114,109,97,110,116,32,99,111,100,101,115,116,114,101,97,109,32,84,80,115,111,116,61,61,84,78,115,111,116,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,80,80,84,32,109,97,114,107,101,114,10,0,70,97,105,108,101,100,32,116,111,32,109,101,114,103,101,32,80,80,84,32,100,97,116,97,10,0,67,97,110,110,111,116,32,100,101,99,111,100,101,32,116,105,108,101,44,32,109,101,109,111,114,121,32,101,114,114,111,114,10,0,72,101,97,100,101,114,32,111,102,32,116,105,108,101,32,37,100,32,47,32,37,100,32,104,97,115,32,98,101,101,110,32,114,101,97,100,46,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,46,10,0,78,111,32,69,79,67,32,109,97,114,107,101,114,46,32,80,111,115,115,105,98,108,121,32,97,32,116,114,117,110,99,97,116,101,100,32,115,116,114,101,97,109,10,0,83,116,114,101,97,109,32,100,111,101,115,32,110,111,116,32,101,110,100,32,119,105,116,104,32,69,79,67,10,0,83,116,114,101,97,109,32,116,111,111,32,115,104,111,114,116,44,32,101,120,112,101,99,116,101,100,32,83,79,84,10,0,78,101,101,100,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,109,97,105,110,32,104,101,97,100,101,114,32,98,101,102,111,114,101,32,98,101,103,105,110,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,114,101,109,97,105,110,105,110,103,32,99,111,100,101,115,116,114,101,97,109,0,78,111,32,100,101,99,111,100,101,100,32,97,114,101,97,32,112,97,114,97,109,101,116,101,114,115,44,32,115,101,116,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,116,111,32,116,104,101,32,119,104,111,108,101,32,105,109,97,103,101,10,0,76,101,102,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,115,105,122,61,37,100,41,46,10,0,76,101,102,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,79,115,105,122,61,37,100,41,46,10,0,85,112,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,115,105,122,61,37,100,41,46,10,0,85,112,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,48,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,79,115,105,122,61,37,100,41,46,10,0,82,105,103,104,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,79,115,105,122,61,37,100,41,46,10,0,82,105,103,104,116,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,120,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,88,115,105,122,61,37,100,41,46,10,0,66,111,116,116,111,109,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,79,115,105,122,61,37,100,41,46,10,0,66,111,116,116,111,109,32,112,111,115,105,116,105,111,110,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,97,114,101,97,32,40,114,101,103,105,111,110,95,121,49,61,37,100,41,32,105,115,32,111,117,116,115,105,100,101,32,116,104,101,32,105,109,97,103,101,32,97,114,101,97,32,40,89,115,105,122,61,37,100,41,46,10,0,83,105,122,101,32,120,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,99,111,109,112,111,110,101,110,116,32,105,109,97,103,101,32,105,115,32,105,110,99,111,114,114,101,99,116,32,40,99,111,109,112,91,37,100,93,46,119,61,37,100,41,46,10,0,83,105,122,101,32,121,32,111,102,32,116,104,101,32,100,101,99,111,100,101,100,32,99,111,109,112,111,110,101,110,116,32,105,109,97,103,101,32,105,115,32,105,110,99,111,114,114,101,99,116,32,40,99,111,109,112,91,37,100,93,46,104,61,37,100,41,46,10,0,83,101,116,116,105,110,103,32,100,101,99,111,100,105,110,103,32,97,114,101,97,32,116,111,32,37,100,44,37,100,44,37,100,44,37,100,10,0,87,114,111,110,103,32,102,108,97,103,10,0,67,111,100,101,115,116,114,101,97,109,32,105,110,102,111,32,102,114,111,109,32,109,97,105,110,32,104,101,97,100,101,114,58,32,123,10,0,9,32,116,120,48,61,37,100,44,32,116,121,48,61,37,100,10,0,9,32,116,100,120,61,37,100,44,32,116,100,121,61,37,100,10,0,9,32,116,119,61,37,100,44,32,116,104,61,37,100,10,0,125,10,0,67,111,100,101,115,116,114,101,97,109,32,105,110,100,101,120,32,102,114,111,109,32,109,97,105,110,32,104,101,97,100,101,114,58,32,123,10,0,9,32,77,97,105,110,32,104,101,97,100,101,114,32,115,116,97,114,116,32,112,111,115,105,116,105,111,110,61,37,108,108,105,10,9,32,77,97,105,110,32,104,101],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE),allocate([97,100,101,114,32,101,110,100,32,112,111,115,105,116,105,111,110,61,37,108,108,105,10,0,9,32,77,97,114,107,101,114,32,108,105,115,116,58,32,123,10,0,9,9,32,116,121,112,101,61,37,35,120,44,32,112,111,115,61,37,108,108,105,44,32,108,101,110,61,37,100,10,0,9,32,125,10,0,9,32,84,105,108,101,32,105,110,100,101,120,58,32,123,10,0,9,9,32,110,98,32,111,102,32,116,105,108,101,45,112,97,114,116,32,105,110,32,116,105,108,101,32,91,37,100,93,61,37,100,10,0,9,9,9,32,116,105,108,101,45,112,97,114,116,91,37,100,93,58,32,115,116,97,114,95,112,111,115,61,37,108,108,105,44,32,101,110,100,95,104,101,97,100,101,114,61,37,108,108,105,44,32,101,110,100,95,112,111,115,61,37,108,108,105,46,10,0,91,68,69,86,93,32,68,117,109,112,32,97,110,32,105,109,97,103,101,95,104,101,97,100,101,114,32,115,116,114,117,99,116,32,123,10,0,73,109,97,103,101,32,105,110,102,111,32,123,10,0,37,115,32,120,48,61,37,100,44,32,121,48,61,37,100,10,0,37,115,32,120,49,61,37,100,44,32,121,49,61,37,100,10,0,37,115,32,110,117,109,99,111,109,112,115,61,37,100,10,0,37,115,9,32,99,111,109,112,111,110,101,110,116,32,37,100,32,123,10,0,37,115,125,10,0,91,68,69,86,93,32,68,117,109,112,32,97,110,32,105,109,97,103,101,95,99,111,109,112,95,104,101,97,100,101,114,32,115,116,114,117,99,116,32,123,10,0,37,115,32,100,120,61,37,100,44,32,100,121,61,37,100,10,0,37,115,32,112,114,101,99,61,37,100,10,0,37,115,32,115,103,110,100,61,37,100,10,0,87,101,32,110,101,101,100,32,97,110,32,105,109,97,103,101,32,112,114,101,118,105,111,117,115,108,121,32,99,114,101,97,116,101,100,46,10,0,84,105,108,101,32,105,110,100,101,120,32,112,114,111,118,105,100,101,100,32,98,121,32,116,104,101,32,117,115,101,114,32,105,115,32,105,110,99,111,114,114,101,99,116,32,37,100,32,40,109,97,120,32,61,32,37,100,41,32,10,0,82,101,115,111,108,117,116,105,111,110,32,102,97,99,116,111,114,32,105,115,32,103,114,101,97,116,101,114,32,116,104,97,110,32,116,104,101,32,109,97,120,105,109,117,109,32,114,101,115,111,108,117,116,105,111,110,32,105,110,32,116,104,101,32,99,111,109,112,111,110,101,110,116,46,10,0,84,104,101,32,103,105,118,101,110,32,116,105,108,101,32,105,110,100,101,120,32,100,111,101,115,32,110,111,116,32,109,97,116,99,104,46,0,116,105,108,101,32,110,117,109,98,101,114,32,37,100,32,47,32,37,100,10,0,69,114,114,111,114,32,97,108,108,111,99,97,116,105,110,103,32,116,105,108,101,32,99,111,109,112,111,110,101,110,116,32,100,97,116,97,46,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,101,110,99,111,100,101,32,97,108,108,32,116,105,108,101,115,10,0,83,105,122,101,32,109,105,115,109,97,116,99,104,32,98,101,116,119,101,101,110,32,116,105,108,101,32,100,97,116,97,32,97,110,100,32,115,101,110,116,32,100,97,116,97,46,0,70,97,105,108,101,100,32,116,111,32,97,108,108,111,99,97,116,101,32,105,109,97,103,101,32,104,101,97,100,101,114,46,0,69,114,114,111,114,32,119,104,105,108,101,32,111,112,106,95,106,50,107,95,112,114,101,95,119,114,105,116,101,95,116,105,108,101,32,119,105,116,104,32,116,105,108,101,32,105,110,100,101,120,32,61,32,37,100,10,0,69,114,114,111,114,32,119,104,105,108,101,32,111,112,106,95,106,50,107,95,112,111,115,116,95,119,114,105,116,101,95,116,105,108,101,32,119,105,116,104,32,116,105,108,101,32,105,110,100,101,120,32,61,32,37,100,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,105,108,101,32,67,111,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,66,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,84,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,67,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,77,67,79,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,116,104,101,32,67,79,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,80,79,67,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,84,76,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,81,67,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,83,81,99,100,32,83,81,99,99,32,101,108,101,109,101,110,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,79,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,81,67,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,81,67,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,119,114,105,116,101,32,67,79,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,114,105,116,105,110,103,32,67,79,68,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,104,101,32,83,73,90,32,109,97,114,107,101,114,10,0,78,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,105,115,32,116,111,111,32,104,105,103,104,32,105,110,32,99,111,109,112,97,114,105,115,111,110,32,116,111,32,116,104,101,32,115,105,122,101,32,111,102,32,116,105,108,101,115,10,0,67,97,110,110,111,116,32,101,110,99,111,100,101,32,116,105,108,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,111,110,101,32,116,105,108,101,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,115,101,101,107,32,102,117,110,99,116,105,111,110,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,32,37,100,47,37,100,10,0,84,105,108,101,32,37,100,47,37,100,32,104,97,115,32,98,101,101,110,32,100,101,99,111,100,101,100,46,10,0,73,109,97,103,101,32,100,97,116,97,32,104,97,115,32,98,101,101,110,32,117,112,100,97,116,101,100,32,119,105,116,104,32,116,105,108,101,32,37,100,46,10,10,0,84,105,108,101,32,114,101,97,100,44,32,100,101,99,111,100,101,100,32,97,110,100,32,117,112,100,97,116,101,100,32,105,115,32,110,111,116,32,116,104,101,32,100,101,115,105,114,101,100,32,111,110,101,32,40,37,100,32,118,115,32,37,100,41,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,115,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,105,108,101,32,37,100,47,37,100,10,0,9,32,100,101,102,97,117,108,116,32,116,105,108,101,32,123,10,0,9,9,32,99,115,116,121,61,37,35,120,10,0,9,9,32,112,114,103,61,37,35,120,10,0,9,9,32,110,117,109,108,97,121,101,114,115,61,37,100,10,0,9,9,32,109,99,116,61,37,120,10,0,9,9,32,99,111,109,112,32,37,100,32,123,10,0,9,9,9,32,99,115,116,121,61,37,35,120,10,0,9,9,9,32,110,117,109,114,101,115,111,108,117,116,105,111,110,115,61,37,100,10,0,9,9,9,32,99,98,108,107,119,61,50,94,37,100,10,0,9,9,9,32,99,98,108,107,104,61,50,94,37,100,10,0,9,9,9,32,99,98,108,107,115,116,121,61,37,35,120,10,0,9,9,9,32,113,109,102,98,105,100,61,37,100,10,0,9,9,9,32,112,114,101,99,99,105,110,116,115,105,122,101,32,40,119,44,104,41,61,0,40,37,100,44,37,100,41,32,0,9,9,9,32,113,110,116,115,116,121,61,37,100,10,0,9,9,9,32,110,117,109,103,98,105,116,115,61,37,100,10,0,9,9,9,32,115,116,101,112,115,105,122,101,115,32,40,109,44,101,41,61,0,9,9,9,32,114,111,105,115,104,105,102,116,61,37,100,10,0,9,9,32,125,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,79,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,116,114,97,110,115,102,111,114,109,97,116,105,111,110,32,115,116,97,103,101,115,46,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,67,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,100,97,116,97,32,115,112,97,110,110,105,110,103,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,77,67,67,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,99,111,108,108,101,99,116,105,111,110,115,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,111,116,104,101,114,32,116,104,97,110,32,97,114,114,97,121,32,100,101,99,111,114,114,101,108,97,116,105,111,110,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,119,105,116,104,32,105,110,100,105,120,32,115,104,117,102,102,108,101,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,99,111,108,108,101,99,116,105,111,110,115,32,119,105,116,104,111,117,116,32,115,97,109,101,32,110,117,109,98,101,114,32,111,102,32,105,110,100,105,120,101,115,10,0,67,114,114,111,114,32,114,101,97,100,105,110,103,32,67,66,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,77,67,84,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,99,116,32,100,97,116,97,32,119,105,116,104,105,110,32,109,117,108,116,105,112,108,101,32,77,67,84,32,114,101,99,111,114,100,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,77,67,84,32,109,97,114,107,101,114,10,0,67,97,110,110,111,116,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,109,117,108,116,105,112,108,101,32,77,67,84,32,109,97,114,107,101,114,115,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,82,71,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,84,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,84,32,109,97,114,107,101,114,58,32,112,97,99,107,101,116,32,104,101,97,100,101,114,32,104,97,118,101,32,98,101,101,110,32,112,114,101,118,105,111,117,115,108,121,32,102,111,117,110,100,32,105,110,32,116,104,101,32,109,97,105,110,32,104,101,97,100,101,114,32,40,80,80,77,32,109,97,114,107,101,114,41,46,10,0,90,112,112,116,32,37,117,32,97,108,114,101,97,100,121,32,114,101,97,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,80,77,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,80,80,77,32,109,97,114,107,101,114,10,0,90,112,112,109,32,37,117,32,97,108,114,101,97,100,121,32,114,101,97,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,76,84,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,76,77,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,84,76,77,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,32,115,105,122,101,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,32,105,115,32,105,108,108,101,103,97,108,32,45,62,32,37,100,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,32,105,115,32,110,111,116,32,99,111,109,112,97,116,105,98,108,101,32,119,105,116,104,32,116,104,101,32,114,101,109,97,105,110,105,110,103,32,110,117,109,98,101,114,32,111,102,32,112,97,114,97,109,101,116,101,114,115,32,40,32,37,100,32,118,115,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,110,101,103,97,116,105,118,101,32,111,114,32,122,101,114,111,32,105,109,97,103,101,32,115,105,122,101,32,40,37,100,32,120,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,105,110,118,97,108,105,100,32,116,105,108,101,32,115,105,122,101,32,40,116,100,120,58,32,37,100,44,32,116,100,121,58,32,37,100,41,10,0,80,114,101,118,101,110,116,32,98,117,102,102,101,114,32,111,118,101,114,102,108,111,119,32,40,120,49,58,32,37,100,44,32,121,49,58,32,37,100,41,10,0,69,114,114,111,114,32,119,105,116,104,32,83,73,90,32,109,97,114,107,101,114,58,32,105,108,108,101,103,97,108,32,116,105,108,101,32,111,102,102,115,101,116,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,116,97,107,101,32,105,110,32,99,104,97,114,103,101,32,83,73,90,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,118,97,108,117,101,115,32,102,111,114,32,99,111,109,112,32,61,32,37,100,32,58,32,100,120,61,37,117,32,100,121,61,37,117,10,32,40,115,104,111,117,108,100,32,98,101,32,98,101,116,119,101,101,110,32,49,32,97,110,100,32,50,53,53,32,97,99,99,111,114,100,105,110,103,32,116,104,101,32,74,80,69,71,50,48,48,48,32,110,111,114,109,41,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,115,32,58,32,37,117,32,120,32,37,117,32,40,109,97,120,105,109,117,109,32,102,105,120,101,100,32,98,121,32,106,112,101,103,50,48,48,48,32,110,111,114,109,32,105,115,32,54,53,53,51,53,32,116,105,108,101,115,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,80,79,67,32,109,97,114,107,101,114,10,0,84,111,111,32,109,97,110,121,32,80,79,67,115,32,37,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,81,67,67,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,32,110,117,109,98,101,114,58,32,37,100,44,32,114,101,103,97,114,100,105,110,103,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,37,100,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,81,99,100,32,111,114,32,83,81,99,99,32,101,108,101,109,101,110,116,10,0,87,104,105,108,101,32,114,101,97,100,105,110,103,32,67,67,80,95,81,78,84,83,84,89,32,101,108,101,109,101,110,116,32,105,110,115,105,100,101,32,81,67,68,32,111,114,32,81,67,67,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,44,32,110,117,109,98,101,114,32,111,102,32,115,117,98,98,97,110,100,115,32,40,37,100,41,32,105,115,32,103,114,101,97,116,101,114,32,116,111,32,79,80,74,95,74,50,75,95,77,65,88,66,65,78,68,83,32,40,37,100,41,46,32,83,111,32,119,101,32,108,105,109,105,116,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,101,108,101,109,101,110,116,115,32,115,116,111,114,101,100,32,116,111,32,79,80,74,95,74,50,75,95,77,65,88,66,65,78,68,83,32,40,37,100,41,32,97,110,100,32,115,107,105,112,32,116,104,101,32,114,101,115,116,46,32,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,81,67,68,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,82,71,78,32,109,97,114,107,101,114,10,0,98,97,100,32,99,111,109,112,111,110,101,110,116,32,110,117,109,98,101,114,32,105,110,32,82,71,78,32,40,37,100,32,119,104,101,110,32,116,104,101,114,101,32,97,114,101,32,111,110,108,121,32,37,100,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,67,32,109,97,114,107,101,114,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,67,32,109,97,114,107,101,114,32,40,98,97,100,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,41,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,10,0,73,110,118,97,108,105,100,32,118,97,108,117,101,32,102,111,114,32,110,117,109,114,101,115,111,108,117,116,105,111,110,115,32,58,32,37,100,44,32,109,97,120,32,118,97,108,117,101,32,105,115,32,115,101,116,32,105,110,32,111,112,101,110,106,112,101,103,46,104,32,97,116,32,37,100,10,0,69,114,114,111,114,32,100,101,99,111,100,105,110,103,32,99,111,109,112,111,110,101,110,116,32,37,100,46,10,84,104,101,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,116,111,32,114,101,109,111,118,101,32,105,115,32,104,105,103,104,101,114,32,116,104,97,110,32,116,104,101,32,110,117,109,98,101,114,32,111,102,32,114,101,115,111,108,117,116,105,111,110,115,32,111,102,32,116,104,105,115,32,99,111,109,112,111,110,101,110,116,10,77,111,100,105,102,121,32,116,104,101,32,99,112,95,114,101,100,117,99,101,32,112,97,114,97,109,101,116,101,114,46,10,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,83,80,67,111,100,32,83,80,67,111,99,32,101,108,101,109,101,110,116,44,32,73,110,118,97,108,105,100,32,99,98,108,107,119,47,99,98,108,107,104,32,99,111,109,98,105,110,97,116,105,111,110,10,0,73,110,118,97,108,105,100,32,112,114,101,99,105,110,99,116,32,115,105,122,101,10,0,67,79,68,32,109,97,114,107,101,114,32,97,108,114,101,97,100,121,32,114,101,97,100,46,32,78,111,32,109,111,114,101,32,116,104,97,110,32,111,110,101,32,67,79,68,32,109,97,114,107,101,114,32,112,101,114,32,116,105,108,101,46,10,0,69,114,114,111,114,32,114,101,97,100,105,110,103,32,67,79,68,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,110,32,83,99,111,100,32,118,97,108,117,101,32,105,110,32,67,79,68,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,110,32,112,114,111,103,114,101,115,115,105,111,110,32,111,114,100,101,114,32,105,110,32,67,79,68,32,109,97,114,107,101,114,10,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,108,97,121,101,114,115,32,105,110,32,67,79,68,32,109,97,114,107,101,114,32,58,32,37,100,32,110,111,116,32,105,110,32,114,97,110,103,101,32,91,49,45,54,53,53,51,53,93,10,0,73,110,118,97,108,105,100,32,116,105,108,101,32,110,117,109,98,101,114,32,37,100,10,0,69,109,112,116,121,32,83,79,84,32,109,97,114,107,101,114,32,100,101,116,101,99,116,101,100,58,32,80,115,111,116,61,37,100,46,10,0,80,115,111,116,32,118,97,108,117,101,32,105,115,32,110,111,116,32,99,111,114,114,101,99,116,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,74,80,69,71,50,48,48,48,32,110,111,114,109,58,32,37,100,46,10,0,80,115,111,116,32,118,97,108,117,101,32,111,102,32,116,104,101,32,99,117,114,114,101,110,116,32,116,105,108,101,45,112,97,114,116,32,105,115,32,101,113,117,97,108,32,116,111,32,122,101,114,111,44,32,119,101,32,97,115,115,117,109,105,110,103,32,105,116,32,105,115,32,116,104,101,32,108,97,115,116,32,116,105,108,101,45,112,97,114,116,32,111,102,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,46,10,0,73,110,32,83,79,84,32,109,97,114,107,101,114,44,32,84,80,83,111,116,32,40,37,100,41,32,105,115,32,110,111,116,32,118,97,108,105,100,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,99,117,114,114,101,110,116,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,45,112,97,114,116,32,40,37,100,41,44,32,103,105,118,105,110,103,32,117,112,10,0,73,110,32,83,79,84,32,109,97,114,107,101,114,44,32,84,80,83,111,116,32,40,37,100,41,32,105,115,32,110,111,116,32,118,97,108,105,100,32,114,101,103,97,114,100,115,32,116,111,32,116,104,101,32,99,117,114,114,101,110,116,32,110,117,109,98,101,114,32,111,102,32,116,105,108,101,45,112,97,114,116,32,40,104,101,97,100,101,114,41,32,40,37,100,41,44,32,103,105,118,105,110,103,32,117,112,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,97,100,32,83,79,84,32,109,97,114,107,101,114,46,32,84,105,108,101,32,105,110,100,101,120,32,97,108,108,111,99,97,116,105,111,110,32,102,97,105,108,101,100,10,0,83,116,97,114,116,32,116,111,32,114,101,97,100,32,106,50,107,32,109,97,105,110,32,104,101,97,100,101,114,32,40,37,100,41,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,109,104,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,97,32,83,79,67,32,109,97,114,107,101,114,32,10,0,65,32,109,97,114,107,101,114,32,73,68,32,119,97,115,32,101,120,112,101,99,116,101,100,32,40,48,120,102,102,45,45,41,32,105,110,115,116,101,97,100,32,111,102,32,37,46,56,120,10,0,85,110,107,110,111,119,110,32,109,97,114,107,101,114,10,0,85,110,107,110,111,119,32,109,97,114,107,101,114,32,104,97,118,101,32,98,101,101,110,32,100,101,116,101,99,116,101,100,32,97,110,100,32,103,101,110,101,114,97,116,101,100,32,101,114,114,111,114,46,10,0,77,97,114,107,101,114,32,104,97,110,100,108,101,114,32,102,117,110,99,116,105,111,110,32,102,97,105,108,101,100,32,116,111,32,114,101,97,100,32,116,104,101,32,109,97,114,107,101,114,32,115,101,103,109,101,110,116,10,0,114,101,113,117,105,114,101,100,32,83,73,90,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,114,101,113,117,105,114,101,100,32,67,79,68,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,114,101,113,117,105,114,101,100,32,81,67,68,32,109,97,114,107,101,114,32,110,111,116,32,102,111,117,110,100,32,105,110,32,109,97,105,110,32,104,101,97,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,98,121,116,101,115,32,116,111,32,114,101,97,100,32,78,112,112,109,10,0,67,111,114,114,117,112,116,101,100,32,80,80,77,32,109,97,114,107,101,114,115,10,0,70,97,105,108,101,100,32,116,111,32,109,101,114,103,101,32,80,80,77,32,100,97,116,97,10,0,77,97,105,110,32,104,101,97,100,101,114,32,104,97,115,32,98,101,101,110,32,99,111,114,114,101,99,116,108,121,32,100,101,99,111,100,101,100,46,10,0,70,97,105,108,101,100,32,116,111,32,100,101,99,111,100,101,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,32,105,110,32,116,104,101,32,74,80,50,32,102,105,108,101,10,0,73,110,118,97,108,105,100,32,110,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,115,112,101,99,105,102,105,101,100,32,119,104,105,108,101,32,115,101,116,116,105,110,103,32,117,112,32,74,80,50,32,101,110,99,111,100,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,119,104,101,110,32,115,101,116,117,112,32,116,104,101,32,74,80,50,32,101,110,99,111,100,101,114,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,115,112,101,99,105,102,105,101,100,32,98,117,116,32,117,110,107,110,111,119,110,32,101,110,117,109,99,115,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,115,112,101,99,105,102,105,101,100,32,98,117,116,32,110,111,116,32,101,110,111,117,103,104,32,105,109,97,103,101,32,99,111,109,112,111,110,101,110,116,115,32,102,111,114,32,97,110,32,97,117,116,111,109,97,116,105,99,32,99,100,101,102,32,98,111,120,32,99,114,101,97,116,105,111,110,46,10,0,65,108,112,104,97,32,99,104,97,110,110,101,108,32,112,111,115,105,116,105,111,110,32,99,111,110,102,108,105,99,116,115,32,119,105,116,104,32,99,111,108,111,114,32,99,104,97,110,110,101,108,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,77,117,108,116,105,112,108,101,32,97,108,112,104,97,32,99,104,97,110,110,101,108,115,32,115,112,101,99,105,102,105,101,100,46,32,78,111,32,99,100,101,102,32,98,111,120,32,119,105,108,108,32,98,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,115,101,116,117,112,32,116,104,101,32,74,80,50,32,101,110,99,111,100,101,114,10,0,74,80,50,32,98,111,120,32,119,104,105,99,104,32,97,114,101,32,97,102,116,101,114,32,116,104,101,32,99,111,100,101,115,116,114,101,97,109,32,119,105,108,108,32,110,111,116,32,98,101,32,114,101,97,100,32,98,121,32,116,104,105,115,32,102,117,110,99,116,105,111,110,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,111,108,100,32,74,80,50,32,72,101,97,100,101,114,32,100,97,116,97,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,119,114,105,116,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,102,116,121,112,32,100,97,116,97,10,0,69,114,114,111,114,32,119,104,105,108,101,32,119,114,105,116,105,110,103,32,102,116,121,112,32,100,97,116,97,32,116,111,32,115,116,114,101,97,109,10,0,70,97,105,108,101,100,32,116,111,32,115,101,101,107,32,105,110,32,116,104,101,32,115,116,114,101,97,109,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,106,112,101,103,50,48,48,48,32,102,105,108,101,32,104,101,97,100,101,114,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,115,105,122,101,115,32,104,105,103,104,101,114,32,116,104,97,110,32,50,94,51,50,10,0,98,97,100,32,112,108,97,99,101,100,32,106,112,101,103,32,99,111,100,101,115,116,114,101,97,109,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,111,102,32,117,110,100,101,102,105,110,101,100,32,115,105,122,101,115,10,0,105,110,118,97,108,105,100,32,98,111,120,32,115,105,122,101,32,37,100,32,40,37,120,41,10,0,70,111,117,110,100,32,97,32,109,105,115,112,108,97,99,101,100,32,39,37,99,37,99,37,99,37,99,39,32,98,111,120,32,111,117,116,115,105,100,101,32,106,112,50,104,32,98,111,120,10,0,74,80,69,71,50,48,48,48,32,72,101,97,100,101,114,32,98,111,120,32,110,111,116,32,114,101,97,100,32,121,101,116,44,32,39,37,99,37,99,37,99,37,99,39,32,98,111,120,32,119,105,108,108,32,98,101,32,105,103,110,111,114,101,100,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,115,107,105,112,112,105,110,103,32,74,80,69,71,50,48,48,48,32,98,111,120,44,32,115,116,114,101,97,109,32,101,114,114,111,114,10,0,73,110,118,97,108,105,100,32,98,111,120,32,115,105,122,101,32,37,100,32,102,111,114,32,98,111,120,32,39,37,99,37,99,37,99,37,99,39,46,32,78,101,101,100,32,37,100,32,98,121,116,101,115,44,32,37,100,32,98,121,116,101,115,32,114,101,109,97,105,110,105,110,103,32,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,106,112,101,103,50,48,48,48,32,98,111,120,10,0,80,114,111,98,108,101,109,32,119,105,116,104,32,114,101,97,100,105,110,103,32,74,80,69,71,50,48,48,48,32,98,111,120,44,32,115,116,114,101,97,109,32,101,114,114,111,114,10,0,77,97,108,102,111,114,109,101,100,32,74,80,50,32,102,105,108,101,32,102,111,114,109,97,116,58,32,102,105,114,115,116,32,98,111,120,32,109,117,115,116,32,98,101,32,74,80,69,71,32,50,48,48,48,32,115,105,103,110,97,116,117,114,101,32,98,111,120,10,0,77,97,108,102,111,114,109,101,100,32,74,80,50,32,102,105,108,101,32,102,111,114,109,97,116,58,32,115,101,99,111,110,100,32,98,111,120,32,109,117,115,116,32,98,101,32,102,105,108,101,32,116,121,112,101,32,98,111,120,10,0,73,110,115,117,102,102,105,99,105,101,110,116,32,100,97,116,97,32,102,111,114,32,67,68,69,70,32,98,111,120,46,10,0,78,117,109,98,101,114,32,111,102,32,99,104,97,110,110,101,108,32,100,101,115,99,114,105,112,116,105,111,110,32,105,115,32,101,113,117,97,108,32,116,111,32,122,101,114,111,32,105,110,32,67,68,69,70,32,98,111,120,46,10,0,78,101,101,100,32,116,111,32,114,101,97,100,32,97,32,80,67,76,82,32,98,111,120,32,98,101,102,111,114,101,32,116,104,101,32,67,77,65,80,32,98,111,120,46,10,0,79,110,108,121,32,111,110,101,32,67,77,65,80,32,98,111,120,32,105,115,32,97,108,108,111,119,101,100,46,10,0,73,110,115,117,102,102,105,99,105,101,110,116,32,100,97,116,97,32,102,111,114,32,67,77,65,80,32,98,111,120,46,10,0,73,110,118,97,108,105,100,32,80,67,76,82,32,98,111,120,46,32,82,101,112,111,114,116,115,32,37,100,32,101,110,116,114,105,101,115,10,0,73,110,118,97,108,105,100,32,80,67,76,82,32,98,111,120,46,32,82,101,112,111,114,116,115,32,48,32,112,97,108,101,116,116,101,32,99,111,108,117,109,110,115,10,0,65,32,66,80,67,67,32,104,101,97,100,101,114,32,98,111,120,32,105,115,32,97,118,97,105,108,97,98,108,101,32,97,108,116,104,111,117,103,104,32,66,80,67,32,103,105,118,101,110,32,98,121,32,116,104,101,32,73,72,68,82,32,98,111,120,32,40,37,100,41,32,105,110,100,105,99,97,116,101,32,99,111,109,112,111,110,101,110,116,115,32,98,105,116,32,100,101,112,116,104,32,105,115,32,99,111,110,115,116,97,110,116,10,0,66,97,100,32,66,80,67,67,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,65,32,99,111,110,102,111,114,109,105,110,103,32,74,80,50,32,114,101,97,100,101,114,32,115,104,97,108,108,32,105,103,110,111,114,101,32,97,108,108,32,67,111,108,111,117,114,32,83,112,101,99,105,102,105,99,97,116,105,111,110,32,98,111,120,101,115,32,97,102,116,101,114,32,116,104,101,32,102,105,114,115,116,44,32,115,111,32,119,101,32,105,103,110,111,114,101,32,116,104,105,115,32,111,110,101,46,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,58,32,37,100,41,10,0,66,97,100,32,67,79,76,82,32,104,101,97,100,101,114,32,98,111,120,32,40,67,73,69,76,97,98,44,32,98,97,100,32,115,105,122,101,58,32,37,100,41,10,0,67,79,76,82,32,66,79,88,32,109,101,116,104,32,118,97,108,117,101,32,105,115,32,110,111,116,32,97,32,114,101,103,117,108,97,114,32,118,97,108,117,101,32,40,37,100,41,44,32,115,111,32,119,101,32,119,105,108,108,32,105,103,110,111,114,101,32,116,104,101,32,101,110,116,105,114,101,32,67,111,108,111,117,114,32,83,112,101,99,105,102,105,99,97,116,105,111,110,32,98,111,120,46,32,10,0,66,97,100,32,105,109,97,103,101,32,104,101,97,100,101,114,32,98,111,120,32,40,98,97,100,32,115,105,122,101,41,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,105,109,97,103,101,32,104,101,97,100,101,114,32,40,105,104,100,114,41,10,0,74,80,50,32,73,72,68,82,32,98,111,120,58,32,99,111,109,112,114,101,115,115,105,111,110,32,116,121,112,101,32,105,110,100,105,99,97,116,101,32,116,104,97,116,32,116,104,101,32,102,105,108,101,32,105,115,32,110,111,116,32,97,32,99,111,110,102,111,114,109,105,110,103,32,74,80,50,32,102,105,108,101,32,40,37,100,41,32,10,0,84,104,101,32,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,102,105,114,115,116,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,98,111,120,32,111,102,32,108,101,115,115,32,116,104,97,110,32,56,32,98,121,116,101,115,10,0,67,97,110,110,111,116,32,104,97,110,100,108,101,32,88,76,32,98,111,120,32,111,102,32,108,101,115,115,32,116,104,97,110,32,49,54,32,98,121,116,101,115,10,0,66,111,120,32,108,101,110,103,116,104,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,46,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,58,32,98,111,120,32,108,101,110,103,116,104,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,46,10,0,83,116,114,101,97,109,32,101,114,114,111,114,32,119,104,105,108,101,32,114,101,97,100,105,110,103,32,74,80,50,32,72,101,97,100,101,114,32,98,111,120,58,32,110,111,32,39,105,104,100,114,39,32,98,111,120,46,10,0,84,104,101,32,102,116,121,112,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,115,101,99,111,110,100,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,69,114,114,111,114,32,119,105,116,104,32,70,84,89,80,32,115,105,103,110,97,116,117,114,101,32,66,111,120,32,115,105,122,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,119,105,116,104,32,70,84,89,80,32,66,111,120,10,0,84,104,101,32,115,105,103,110,97,116,117,114,101,32,98,111,120,32,109,117,115,116,32,98,101,32,116,104,101,32,102,105,114,115,116,32,98,111,120,32,105,110,32,116,104,101,32,102,105,108,101,46,10,0,69,114,114,111,114,32,119,105,116,104,32,74,80,32,115,105,103,110,97,116,117,114,101,32,66,111,120,32,115,105,122,101,10,0,69,114,114,111,114,32,119,105,116,104,32,74,80,32,83,105,103,110,97,116,117,114,101,32,58,32,98,97,100,32,109,97,103,105,99,32,110,117,109,98,101,114,10,0,111,112,106,95,106,112,50,95,97,112,112,108,121,95,99,100,101,102,58,32,99,110,61,37,100,44,32,110,117,109,99,111,109,112,115,61,37,100,10,0,111,112,106,95,106,112,50,95,97,112,112,108,121,95,99,100,101,102,58,32,97,99,110,61,37,100,44,32,110,117,109,99,111,109,112,115,61,37,100,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,32,105,110,100,101,120,32,37,100,32,40,62,61,32,37,100,41,46,10,0,73,110,99,111,109,112,108,101,116,101,32,99,104,97,110,110,101,108,32,100,101,102,105,110,105,116,105,111,110,115,46,10,0,85,110,101,120,112,101,99,116,101,100,32,79,79,77,46,10,0,73,110,118,97,108,105,100,32,99,111,109,112,111,110,101,110,116,47,112,97,108,101,116,116,101,32,105,110,100,101,120,32,102,111,114,32,100,105,114,101,99,116,32,109,97,112,112,105,110,103,32,37,100,46,10,0,67,111,109,112,111,110,101,110,116,32,37,100,32,105,115,32,109,97,112,112,101,100,32,116,119,105,99,101,46,10,0,68,105,114,101,99,116,32,117,115,101,32,97,116,32,35,37,100,32,104,111,119,101,118,101,114,32,112,99,111,108,61,37,100,46,10,0,67,111,109,112,111,110,101,110,116,32,37,100,32,100,111,101,115,110,39,116,32,104,97,118,101,32,97,32,109,97,112,112,105,110,103,46,10,0,67,111,109,112,111,110,101,110,116,32,109,97,112,112,105,110,103,32,115,101,101,109,115,32,119,114,111,110,103,46,32,84,114,121,105,110,103,32,116,111,32,99,111,114,114,101,99,116,46,10,0,84,105,108,101,115,32,100,111,110,39,116,32,97,108,108,32,104,97,118,101,32,116,104,101,32,115,97,109,101,32,100,105,109,101,110,115,105,111,110,46,32,83,107,105,112,32,116,104,101,32,77,67,84,32,115,116,101,112,46,10,0,78,117,109,98,101,114,32,111,102,32,99,111,109,112,111,110,101,110,116,115,32,40,37,100,41,32,105,115,32,105,110,99,111,110,115,105,115,116,101,110,116,32,119,105,116,104,32,97,32,77,67,84,46,32,83,107,105,112,32,116,104,101,32,77,67,84,32,115,116,101,112,46,10,0,116,105,108,101,115,32,114,101,113,117,105,114,101,32,97,116,32,108,101,97,115,116,32,111,110,101,32,114,101,115,111,108,117,116,105,111,110,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,105,108,101,32,100,97,116,97,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,116,105,108,101,32,114,101,115,111,108,117,116,105,111,110,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,104,97,110,100,108,101,32,98,97,110,100,32,112,114,101,99,105,110,116,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,102,111,114,32,99,117,114,114,101,110,116,32,112,114,101,99,105,110,99,116,32,99,111,100,101,98,108,111,99,107,32,101,108,101,109,101,110,116,10,0,78,111,32,105,110,99,108,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,32,105,109,115,98,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,97,103,45,116,114,101,101,10,0,116,103,116,95,99,114,101,97,116,101,32,116,114,101,101,45,62,110,117,109,110,111,100,101,115,32,61,61,32,48,44,32,110,111,32,116,114,101,101,32,99,114,101,97,116,101,100,46,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,99,114,101,97,116,101,32,84,97,103,45,116,114,101,101,32,110,111,100,101,115,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,114,101,105,110,105,116,105,97,108,105,122,101,32,116,104,101,32,116,97,103,32,116,114,101,101,10,0,78,111,116,32,101,110,111,117,103,104,32,109,101,109,111,114,121,32,116,111,32,97,100,100,32,97,32,110,101,119,32,118,97,108,105,100,97,116,105,111,110,32,112,114,111,99,101,100,117,114,101,10,0,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+10240),allocate([7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,1,1,2,1,2,2,2,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,3,3,6,3,6,6,8,3,6,6,8,6,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,1,4,4,7,4,7,7,8,4,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,2,5,5,7,5,7,7,8,5,7,7,8,7,8,8,8,9,10,12,13,10,10,13,13,12,13,12,13,13,13,13,13,9,10,12,11,10,9,13,12,12,11,12,11,13,12,13,12,9,10,12,11,10,10,11,11,12,13,9,10,13,13,10,10,9,10,12,13,10,9,11,12,12,11,9,10,13,12,10,9,9,10,12,13,10,9,11,12,12,13,12,13,11,12,11,12,9,10,12,11,10,10,11,11,12,11,12,11,11,11,11,11,9,10,12,11,10,9,13,12,12,13,9,10,11,12,10,9,9,10,12,13,10,10,13,13,12,11,9,10,11,11,10,10,9,10,12,13,10,10,13,13,12,11,9,10,11,11,10,10,9,10,12,11,10,9,13,12,12,13,9,10,11,12,10,9,9,10,12,11,10,10,11,11,12,11,12,11,11,11,11,11,9,10,12,13,10,9,11,12,12,13,12,13,11,12,11,12,9,10,12,13,10,9,11,12,12,11,9,10,13,12,10,9,9,10,12,11,10,10,11,11,12,13,9,10,13,13,10,10,9,10,12,11,10,9,13,12,12,11,12,11,13,12,13,12,9,10,12,13,10,10,13,13,12,13,12,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,1,0,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,1,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,1,1,0,1,1,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,114,101,97,100,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,109,97,120,32,40,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,114,101,97,100,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,99,117,114,114,101,110,116,32,115,105,122,101,32,40,37,100,32,62,32,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,115,107,105,112,58,32,115,101,103,109,101,110,116,32,116,111,111,32,108,111,110,103,32,40,37,100,41,32,119,105,116,104,32,109,97,120,32,40,37,100,41,32,102,111,114,32,99,111,100,101,98,108,111,99,107,32,37,100,32,40,112,61,37,100,44,32,98,61,37,100,44,32,114,61,37,100,44,32,99,61,37,100,41,10,0,78,111,116,32,101,110,111,117,103,104,32,115,112,97,99,101,32,102,111,114,32,101,120,112,101,99,116,101,100,32,83,79,80,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,83,79,80,32,109,97,114,107,101,114,10,0,78,111,116,32,101,110,111,117,103,104,32,115,112,97,99,101,32,102,111,114,32,101,120,112,101,99,116,101,100,32,69,80,72,32,109,97,114,107,101,114,10,0,69,120,112,101,99,116,101,100,32,69,80,72,32,109,97,114,107,101,114,10,0,84,33,34,25,13,1,2,3,17,75,28,12,16,4,11,29,18,30,39,104,110,111,112,113,98,32,5,6,15,19,20,21,26,8,22,7,40,36,23,24,9,10,14,27,31,37,35,131,130,125,38,42,43,60,61,62,63,67,71,74,77,88,89,90,91,92,93,94,95,96,97,99,100,101,102,103,105,106,107,108,114,115,116,121,122,123,124,0,73,108,108,101,103,97,108,32,98,121,116,101,32,115,101,113,117,101,110,99,101,0,68,111,109,97,105,110,32,101,114,114,111,114,0,82,101,115,117,108,116,32,110,111,116,32,114,101,112,114,101,115,101,110,116,97,98,108,101,0,78,111,116,32,97,32,116,116,121,0,80,101,114,109,105,115,115,105,111,110,32,100,101,110,105,101,100,0,79,112,101,114,97,116,105,111,110,32,110,111,116,32,112,101,114,109,105,116,116,101,100,0,78,111,32,115,117,99,104,32,102,105,108,101,32,111,114,32,100,105,114,101,99,116,111,114,121,0,78,111,32,115,117,99,104,32,112,114,111,99,101,115,115,0,70,105,108,101,32,101,120,105,115,116,115,0,86,97,108,117,101,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,100,97,116,97,32,116,121,112,101,0,78,111,32,115,112,97,99,101,32,108,101,102,116,32,111,110,32,100,101,118,105,99,101,0,79,117,116,32,111,102,32,109,101,109,111,114,121,0,82,101,115,111,117,114,99,101,32,98,117,115,121,0,73,110,116,101,114,114,117,112,116,101,100,32,115,121,115,116,101,109,32,99,97,108,108,0,82,101,115,111,117,114,99,101,32,116,101,109,112,111,114,97,114,105,108,121,32,117,110,97,118,97,105,108,97,98,108,101,0,73,110,118,97,108,105,100,32,115,101,101,107,0,67,114,111,115,115,45,100,101,118,105,99,101,32,108,105,110,107,0,82,101,97,100,45,111,110,108,121,32,102,105,108,101,32,115,121,115,116,101,109,0,68,105,114,101,99,116,111,114,121,32,110,111,116,32,101,109,112,116,121,0,67,111,110,110,101,99,116,105,111,110,32,114,101,115,101,116,32,98,121,32,112,101,101,114,0,79,112,101,114,97,116,105,111,110,32,116,105,109,101,100,32,111,117,116,0,67,111,110,110,101,99,116,105,111,110,32,114,101,102,117,115,101,100,0,72,111,115,116,32,105,115,32,100,111,119,110,0,72,111,115,116,32,105,115,32,117,110,114,101,97,99,104,97,98,108,101,0,65,100,100,114,101,115,115,32,105,110,32,117,115,101,0,66,114,111,107,101,110,32,112,105,112,101,0,73,47,79,32,101,114,114,111,114,0,78,111,32,115,117,99,104,32,100,101,118,105,99,101,32,111,114,32,97,100,100,114,101,115,115,0,66,108,111,99,107,32,100,101,118,105,99,101,32,114,101,113,117,105,114,101,100,0,78,111,32,115,117,99,104,32,100,101,118,105,99,101,0,78,111,116,32,97,32,100,105,114,101,99,116,111,114,121,0,73,115,32,97,32,100,105,114,101,99,116,111,114,121,0,84,101,120,116,32,102,105,108,101,32,98,117,115,121,0,69,120,101,99,32,102,111,114,109,97,116,32,101,114,114,111,114,0,73,110,118,97,108,105,100,32,97,114,103,117,109,101,110,116,0,65,114,103,117,109,101,110,116,32,108,105,115,116,32,116,111,111,32,108,111,110,103,0,83,121,109,98,111,108,105,99,32,108,105,110,107,32,108,111,111,112,0,70,105,108,101,110,97,109,101,32,116,111,111,32,108,111,110,103,0,84,111,111,32,109,97,110,121,32,111,112,101,110,32,102,105,108,101,115,32,105,110,32,115,121,115,116,101,109,0,78,111,32,102,105,108,101,32,100,101,115,99,114,105,112,116,111,114,115,32,97,118,97,105,108,97,98,108,101,0,66,97,100,32,102,105,108,101,32,100,101,115,99,114,105,112,116,111,114,0,78,111,32,99,104,105,108,100,32,112,114,111,99,101,115,115,0,66,97,100,32,97,100,100,114,101,115,115,0,70,105,108,101,32,116,111,111,32,108,97,114,103,101,0,84,111,111,32,109,97,110,121,32,108,105,110,107,115,0,78,111,32,108,111,99,107,115,32,97,118,97,105,108,97,98,108,101,0,82,101,115,111,117,114,99,101,32,100,101,97,100,108,111,99,107,32,119,111,117,108,100,32,111,99,99,117,114,0,83,116,97,116,101,32,110,111,116,32,114,101,99,111,118,101,114,97,98,108,101,0,80,114,101,118,105,111,117,115,32,111,119,110,101,114,32,100,105,101,100,0,79,112,101,114,97,116,105,111,110,32,99,97,110,99,101,108,101,100,0,70,117,110,99,116,105,111,110,32,110,111,116,32,105,109,112,108,101,109,101,110,116,101,100,0,78,111,32,109,101,115,115,97,103,101,32,111,102,32,100,101,115,105,114,101,100,32,116,121,112,101,0,73,100,101,110,116,105,102,105,101,114,32,114,101,109,111,118,101,100,0,68,101,118,105,99,101,32,110,111,116,32,97,32,115,116,114,101,97,109,0,78,111,32,100,97,116,97,32,97,118,97,105,108,97,98,108,101,0,68,101,118,105,99,101,32,116,105,109,101,111,117,116,0,79,117,116,32,111,102,32,115,116,114,101,97,109,115,32,114,101,115,111,117,114,99,101,115,0,76,105,110,107,32,104,97,115,32,98,101,101,110,32,115,101,118,101,114,101,100,0,80,114,111,116,111,99,111,108,32,101,114,114,111,114,0,66,97,100,32,109,101,115,115,97,103,101,0,70,105,108,101,32,100,101,115,99,114,105,112,116,111,114,32,105,110,32,98,97,100,32,115,116,97,116,101,0,78,111,116,32,97,32,115,111,99,107,101,116,0,68,101,115,116,105,110,97,116,105,111,110,32,97,100,100,114,101,115,115,32,114,101,113,117,105,114,101,100,0,77,101,115,115,97,103,101,32,116,111,111,32,108,97,114,103,101,0,80,114,111,116,111,99,111,108,32,119,114,111,110,103,32,116,121,112,101,32,102,111,114,32,115,111,99,107,101,116,0,80,114,111,116,111,99,111,108,32,110,111,116,32,97,118,97,105,108,97,98,108,101,0,80,114,111,116,111,99,111,108,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,83,111,99,107,101,116,32,116,121,112,101,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,78,111,116,32,115,117,112,112,111,114,116,101,100,0,80,114,111,116,111,99,111,108,32,102,97,109,105,108,121,32,110,111,116,32,115,117,112,112,111,114,116,101,100,0,65,100,100,114,101,115,115,32,102,97,109,105,108,121,32,110,111,116,32,115,117,112,112,111,114,116,101,100,32,98,121,32,112,114,111,116,111,99,111,108,0,65,100,100,114,101,115,115,32,110,111,116,32,97,118,97,105,108,97,98,108,101,0,78,101,116,119,111,114,107,32,105,115,32,100,111,119,110,0,78,101,116,119,111,114,107,32,117,110,114,101,97,99,104,97,98,108,101,0,67,111,110,110,101,99,116,105,111,110,32,114,101,115,101,116,32,98,121,32,110,101,116,119,111,114,107,0,67,111,110,110,101,99,116,105,111,110,32,97,98,111,114,116,101,100,0,78,111,32,98,117,102,102,101,114,32,115,112,97,99,101,32,97,118,97,105,108,97,98,108,101,0,83,111,99,107,101,116,32,105,115,32,99,111,110,110,101,99,116,101,100,0,83,111,99,107,101,116,32,110,111,116,32,99,111,110,110,101,99,116,101,100,0,67,97,110,110,111,116,32,115,101,110,100,32,97,102,116,101,114,32,115,111,99,107,101,116,32,115,104,117,116,100,111,119,110,0,79,112,101,114,97,116,105,111,110,32,97,108,114,101,97,100,121,32,105,110,32,112,114,111,103,114,101,115,115,0,79,112,101,114,97,116,105,111,110,32,105,110,32,112,114,111,103,114,101,115,115,0,83,116,97,108,101,32,102,105,108,101,32,104,97,110,100,108,101,0,82,101,109,111,116,101,32,73,47,79,32,101,114,114,111,114,0,81,117,111,116,97,32,101,120,99,101,101,100,101,100,0,78,111,32,109,101,100,105,117,109,32,102,111,117,110,100,0,87,114,111,110,103,32,109,101,100,105,117,109,32,116,121,112,101,0,78,111,32,101,114,114,111,114,32,105,110,102,111,114,109,97,116,105,111,110,0,0,114,119,97],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+20480),allocate([17,0,10,0,17,17,17,0,0,0,0,5,0,0,0,0,0,0,9,0,0,0,0,11,0,0,0,0,0,0,0,0,17,0,15,10,17,17,17,3,10,7,0,1,19,9,11,11,0,0,9,6,11,0,0,11,0,6,17,0,0,0,17,17,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,0,17,0,10,10,17,17,17,0,10,0,0,2,0,9,11,0,0,0,9,0,11,0,0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,12,0,0,0,0,9,12,0,0,0,0,0,12,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,13,0,0,0,4,13,0,0,0,0,9,14,0,0,0,0,0,14,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,15,0,0,0,0,15,0,0,0,0,9,16,0,0,0,0,0,16,0,0,16,0,0,18,0,0,0,18,18,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,18,18,18,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,10,0,0,0,0,9,11,0,0,0,0,0,11,0,0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,12,0,0,0,0,9,12,0,0,0,0,0,12,0,0,12,0,0,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,45,43,32,32,32,48,88,48,120,0,40,110,117,108,108,41,0,45,48,88,43,48,88,32,48,88,45,48,120,43,48,120,32,48,120,0,105,110,102,0,73,78,70,0,110,97,110,0,78,65,78,0,46,0],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+25118);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}assert(tempDoublePtr%8==0),Module._i64Subtract=_i64Subtract;var _floorf=Math_floor;Module._bitshift64Ashr=_bitshift64Ashr;var _SItoF=!0;Module._memset=_memset;var _BDtoILow=!0,_ceilf=Math_ceil;function _abort(){Module.abort()}function ___lock(){}function ___unlock(){}Module._bitshift64Shl=_bitshift64Shl,Module._i64Add=_i64Add;var _floor=Math_floor,_sqrt=Math_sqrt,PATH=void 0;function _emscripten_set_main_loop_timing(e,t){if(Browser.mainLoop.timingMode=e,Browser.mainLoop.timingValue=t,!Browser.mainLoop.func)return 1;if(0==e)Browser.mainLoop.scheduler=function(){setTimeout(Browser.mainLoop.runner,t)},Browser.mainLoop.method="timeout";else if(1==e)Browser.mainLoop.scheduler=function(){Browser.requestAnimationFrame(Browser.mainLoop.runner)},Browser.mainLoop.method="rAF";else if(2==e){if(!window.setImmediate){var r=[];window.addEventListener("message",(function(e){e.source===window&&"__emcc"===e.data&&(e.stopPropagation(),r.shift()())}),!0),window.setImmediate=function(e){r.push(e),window.postMessage("__emcc","*")}}Browser.mainLoop.scheduler=function(){window.setImmediate(Browser.mainLoop.runner)},Browser.mainLoop.method="immediate"}return 0}function _emscripten_set_main_loop(e,t,r,n,i){Module.noExitRuntime=!0,assert(!Browser.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),Browser.mainLoop.func=e,Browser.mainLoop.arg=n;var a=Browser.mainLoop.currentlyRunningMainloop;if(Browser.mainLoop.runner=function(){if(!ABORT){if(Browser.mainLoop.queue.length>0){var t=Date.now(),r=Browser.mainLoop.queue.shift();if(r.func(r.arg),Browser.mainLoop.remainingBlockers){var i=Browser.mainLoop.remainingBlockers,o=i%1==0?i-1:Math.floor(i);r.counted?Browser.mainLoop.remainingBlockers=o:(o+=.5,Browser.mainLoop.remainingBlockers=(8*i+o)/9)}return console.log('main loop blocker "'+r.name+'" took '+(Date.now()-t)+" ms"),Browser.mainLoop.updateStatus(),void setTimeout(Browser.mainLoop.runner,0)}a<Browser.mainLoop.currentlyRunningMainloop||(Browser.mainLoop.currentFrameNumber=Browser.mainLoop.currentFrameNumber+1|0,1==Browser.mainLoop.timingMode&&Browser.mainLoop.timingValue>1&&Browser.mainLoop.currentFrameNumber%Browser.mainLoop.timingValue!=0?Browser.mainLoop.scheduler():("timeout"===Browser.mainLoop.method&&Module.ctx&&(Module.printErr("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),Browser.mainLoop.method=""),Browser.mainLoop.runIter((function(){void 0!==n?Runtime.dynCall("vi",e,[n]):Runtime.dynCall("v",e)})),a<Browser.mainLoop.currentlyRunningMainloop||("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),Browser.mainLoop.scheduler())))}},i||(t&&t>0?_emscripten_set_main_loop_timing(0,1e3/t):_emscripten_set_main_loop_timing(1,1),Browser.mainLoop.scheduler()),r)throw"SimulateInfiniteLoop"}var Browser={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Browser.mainLoop.scheduler=null,Browser.mainLoop.currentlyRunningMainloop++},resume:function(){Browser.mainLoop.currentlyRunningMainloop++;var e=Browser.mainLoop.timingMode,t=Browser.mainLoop.timingValue,r=Browser.mainLoop.func;Browser.mainLoop.func=null,_emscripten_set_main_loop(r,0,!1,Browser.mainLoop.arg,!0),_emscripten_set_main_loop_timing(e,t),Browser.mainLoop.scheduler()},updateStatus:function(){if(Module.setStatus){var e=Module.statusMessage||"Please wait...",t=Browser.mainLoop.remainingBlockers,r=Browser.mainLoop.expectedBlockers;t?t<r?Module.setStatus(e+" ("+(r-t)+"/"+r+")"):Module.setStatus(e):Module.setStatus("")}},runIter:function(e){if(!ABORT){if(Module.preMainLoop)if(!1===Module.preMainLoop())return;try{e()}catch(e){if(e instanceof ExitStatus)return;throw e&&"object"==typeof e&&e.stack&&Module.printErr("exception thrown: "+[e,e.stack]),e}Module.postMainLoop&&Module.postMainLoop()}}},isFullScreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(Module.preloadPlugins||(Module.preloadPlugins=[]),!Browser.initted){Browser.initted=!0;try{new Blob,Browser.hasBlobConstructor=!0}catch(e){Browser.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Browser.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),Browser.URLObject="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,Module.noImageDecoding||void 0!==Browser.URLObject||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),Module.noImageDecoding=!0);var e={canHandle:function(e){return!Module.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,r,n){var i=null;if(Browser.hasBlobConstructor)try{(i=new Blob([e],{type:Browser.getMimetype(t)})).size!==e.length&&(i=new Blob([new Uint8Array(e).buffer],{type:Browser.getMimetype(t)}))}catch(e){Runtime.warnOnce("Blob constructor present but fails: "+e+"; falling back to blob builder")}if(!i){var a=new Browser.BlobBuilder;a.append(new Uint8Array(e).buffer),i=a.getBlob()}var o=Browser.URLObject.createObjectURL(i),s=new Image;s.onload=function(){assert(s.complete,"Image "+t+" could not be decoded");var n=document.createElement("canvas");n.width=s.width,n.height=s.height,n.getContext("2d").drawImage(s,0,0),Module.preloadedImages[t]=n,Browser.URLObject.revokeObjectURL(o),r&&r(e)},s.onerror=function(e){console.log("Image "+o+" could not be decoded"),n&&n()},s.src=o}};Module.preloadPlugins.push(e);var t={canHandle:function(e){return!Module.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,r,n){var i=!1;function a(n){i||(i=!0,Module.preloadedAudios[t]=n,r&&r(e))}function o(){i||(i=!0,Module.preloadedAudios[t]=new Audio,n&&n())}if(!Browser.hasBlobConstructor)return o();try{var s=new Blob([e],{type:Browser.getMimetype(t)})}catch(e){return o()}var l=Browser.URLObject.createObjectURL(s),u=new Audio;u.addEventListener("canplaythrough",(function(){a(u)}),!1),u.onerror=function(r){i||(console.log("warning: browser could not fully decode audio "+t+", trying slower base64 approach"),u.src="data:audio/x-"+t.substr(-3)+";base64,"+function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",n=0,i=0,a=0;a<e.length;a++)for(n=n<<8|e[a],i+=8;i>=6;){var o=n>>i-6&63;i-=6,r+=t[o]}return 2==i?(r+=t[(3&n)<<4],r+="=="):4==i&&(r+=t[(15&n)<<2],r+="="),r}(e),a(u))},u.src=l,Browser.safeSetTimeout((function(){a(u)}),1e4)}};Module.preloadPlugins.push(t);var r=Module.canvas;r&&(r.requestPointerLock=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.exitPointerLock=r.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",n,!1),document.addEventListener("mozpointerlockchange",n,!1),document.addEventListener("webkitpointerlockchange",n,!1),document.addEventListener("mspointerlockchange",n,!1),Module.elementPointerLock&&r.addEventListener("click",(function(e){!Browser.pointerLock&&r.requestPointerLock&&(r.requestPointerLock(),e.preventDefault())}),!1))}function n(){Browser.pointerLock=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}},createContext:function(e,t,r,n){if(t&&Module.ctx&&e==Module.canvas)return Module.ctx;var i,a;if(t){var o={antialias:!1,alpha:!1};if(n)for(var s in n)o[s]=n[s];(a=GL.createContext(e,o))&&(i=GL.getContext(a).GLctx),e.style.backgroundColor="black"}else i=e.getContext("2d");return i?(r&&(t||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),Module.ctx=i,t&&GL.makeContextCurrent(a),Module.useWebGL=t,Browser.moduleContextCreatedCallbacks.forEach((function(e){e()})),Browser.init()),i):null},destroyContext:function(e,t,r){},fullScreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullScreen:function(e,t,r){Browser.lockPointer=e,Browser.resizeCanvas=t,Browser.vrDevice=r,void 0===Browser.lockPointer&&(Browser.lockPointer=!0),void 0===Browser.resizeCanvas&&(Browser.resizeCanvas=!1),void 0===Browser.vrDevice&&(Browser.vrDevice=null);var n=Module.canvas;function i(){Browser.isFullScreen=!1;var e=n.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===e?(n.cancelFullScreen=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},n.cancelFullScreen=n.cancelFullScreen.bind(document),Browser.lockPointer&&n.requestPointerLock(),Browser.isFullScreen=!0,Browser.resizeCanvas&&Browser.setFullScreenCanvasSize()):(e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e),Browser.resizeCanvas&&Browser.setWindowedCanvasSize()),Module.onFullScreen&&Module.onFullScreen(Browser.isFullScreen),Browser.updateCanvasDimensions(n)}Browser.fullScreenHandlersInstalled||(Browser.fullScreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var a=document.createElement("div");n.parentNode.insertBefore(a,n),a.appendChild(n),a.requestFullScreen=a.requestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullScreen?function(){a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),r?a.requestFullScreen({vrDisplay:r}):a.requestFullScreen()},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===Browser.nextRAF)Browser.nextRAF=t+1e3/60;else for(;t+2>=Browser.nextRAF;)Browser.nextRAF+=1e3/60;var r=Math.max(Browser.nextRAF-t,0);setTimeout(e,r)},requestAnimationFrame:function(e){"undefined"==typeof window?Browser.fakeRequestAnimationFrame(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Browser.fakeRequestAnimationFrame),window.requestAnimationFrame(e))},safeCallback:function(e){return function(){if(!ABORT)return e.apply(null,arguments)}},allowAsyncCallbacks:!0,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){Browser.allowAsyncCallbacks=!1},resumeAsyncCallbacks:function(){if(Browser.allowAsyncCallbacks=!0,Browser.queuedAsyncCallbacks.length>0){var e=Browser.queuedAsyncCallbacks;Browser.queuedAsyncCallbacks=[],e.forEach((function(e){e()}))}},safeRequestAnimationFrame:function(e){return Browser.requestAnimationFrame((function(){ABORT||(Browser.allowAsyncCallbacks?e():Browser.queuedAsyncCallbacks.push(e))}))},safeSetTimeout:function(e,t){return Module.noExitRuntime=!0,setTimeout((function(){ABORT||(Browser.allowAsyncCallbacks?e():Browser.queuedAsyncCallbacks.push(e))}),t)},safeSetInterval:function(e,t){return Module.noExitRuntime=!0,setInterval((function(){ABORT||Browser.allowAsyncCallbacks&&e()}),t)},getMimetype:function(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail;break;case"mousewheel":t=e.wheelDelta;break;case"wheel":t=e.deltaY;break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(e){if(Browser.pointerLock)"mousemove"!=e.type&&"mozMovementX"in e?Browser.mouseMovementX=Browser.mouseMovementY=0:(Browser.mouseMovementX=Browser.getMovementX(e),Browser.mouseMovementY=Browser.getMovementY(e)),"undefined"!=typeof SDL?(Browser.mouseX=SDL.mouseX+Browser.mouseMovementX,Browser.mouseY=SDL.mouseY+Browser.mouseMovementY):(Browser.mouseX+=Browser.mouseMovementX,Browser.mouseY+=Browser.mouseMovementY);else{var t=Module.canvas.getBoundingClientRect(),r=Module.canvas.width,n=Module.canvas.height,i=void 0!==window.scrollX?window.scrollX:window.pageXOffset,a=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type){var o=e.touch;if(void 0===o)return;var s=o.pageX-(i+t.left),l=o.pageY-(a+t.top),u={x:s*=r/t.width,y:l*=n/t.height};if("touchstart"===e.type)Browser.lastTouches[o.identifier]=u,Browser.touches[o.identifier]=u;else if("touchend"===e.type||"touchmove"===e.type){var c=Browser.touches[o.identifier];c||(c=u),Browser.lastTouches[o.identifier]=c,Browser.touches[o.identifier]=u}return}var h=e.pageX-(i+t.left),d=e.pageY-(a+t.top);h*=r/t.width,d*=n/t.height,Browser.mouseMovementX=h-Browser.mouseX,Browser.mouseMovementY=d-Browser.mouseY,Browser.mouseX=h,Browser.mouseY=d}},xhrLoad:function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)},asyncLoad:function(e,t,r,n){Browser.xhrLoad(e,(function(r){assert(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),n||removeRunDependency("al "+e)}),(function(t){if(!r)throw'Loading data file "'+e+'" failed.';r()})),n||addRunDependency("al "+e)},resizeListeners:[],updateResizeListeners:function(){var e=Module.canvas;Browser.resizeListeners.forEach((function(t){t(e.width,e.height)}))},setCanvasSize:function(e,t,r){var n=Module.canvas;Browser.updateCanvasDimensions(n,e,t),r||Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullScreenCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2];e|=8388608,HEAP32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2]=e}Browser.updateResizeListeners()},setWindowedCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2];e&=-8388609,HEAP32[SDL.screen+0*Runtime.QUANTUM_SIZE>>2]=e}Browser.updateResizeListeners()},updateCanvasDimensions:function(e,t,r){t&&r?(e.widthNative=t,e.heightNative=r):(t=e.widthNative,r=e.heightNative);var n=t,i=r;if(Module.forcedAspectRatio&&Module.forcedAspectRatio>0&&(n/i<Module.forcedAspectRatio?n=Math.round(i*Module.forcedAspectRatio):i=Math.round(n/Module.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var a=Math.min(screen.width/n,screen.height/i);n=Math.round(n*a),i=Math.round(i*a)}Browser.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=i&&(e.height=i),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=t&&(e.width=t),e.height!=r&&(e.height=r),void 0!==e.style&&(n!=t||i!=r?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",i+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var e=Browser.nextWgetRequestHandle;return Browser.nextWgetRequestHandle++,e}},SYSCALLS={varargs:0,get:function(e){return SYSCALLS.varargs+=4,HEAP32[SYSCALLS.varargs-4>>2]},getStr:function(){return Pointer_stringify(SYSCALLS.get())},get64:function(){var e=SYSCALLS.get(),t=SYSCALLS.get();return assert(e>=0?0===t:-1===t),e},getZero:function(){assert(0===SYSCALLS.get())}};function ___syscall54(e,t){SYSCALLS.varargs=t;try{return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___setErrNo(e){return Module.___errno_location&&(HEAP32[Module.___errno_location()>>2]=e),e}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(e){switch(e){case 30:return PAGE_SIZE;case 85:return totalMemory/PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ___setErrNo(ERRNO_CODES.EINVAL),-1}Module._bitshift64Lshr=_bitshift64Lshr;var _BDtoIHigh=!0;function _pthread_cleanup_push(e,t){__ATEXIT__.push((function(){Runtime.dynCall("vi",e,[t])})),_pthread_cleanup_push.level=__ATEXIT__.length}function _pthread_cleanup_pop(){assert(_pthread_cleanup_push.level==__ATEXIT__.length,"cannot pop if something else added meanwhile!"),__ATEXIT__.pop(),_pthread_cleanup_push.level=__ATEXIT__.length}function ___syscall5(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStr(),n=SYSCALLS.get(),i=SYSCALLS.get();return FS.open(r,n,i).fd}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function _emscripten_memcpy_big(e,t,r){return HEAPU8.set(HEAPU8.subarray(t,t+r),e),e}function ___syscall6(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD();return FS.close(r),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}Module._memcpy=_memcpy;var _llvm_pow_f64=Math_pow;function _sbrk(e){var t=_sbrk;t.called||(DYNAMICTOP=alignMemoryPage(DYNAMICTOP),t.called=!0,assert(Runtime.dynamicAlloc),t.alloc=Runtime.dynamicAlloc,Runtime.dynamicAlloc=function(){abort("cannot dynamically allocate, sbrk now has control")});var r=DYNAMICTOP;if(0!=e&&!t.alloc(e))return-1>>>0;return r}var _BItoD=!0;function _time(e){var t=Date.now()/1e3|0;return e&&(HEAP32[e>>2]=t),t}function _pthread_self(){return 0}function ___syscall140(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD(),n=SYSCALLS.get(),i=SYSCALLS.get(),a=SYSCALLS.get(),o=SYSCALLS.get(),s=i;return assert(0===n),FS.llseek(r,s,o),HEAP32[a>>2]=r.position,r.getdents&&0===s&&0===o&&(r.getdents=null),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall146(e,t){SYSCALLS.varargs=t;try{SYSCALLS.get();var r=SYSCALLS.get(),n=SYSCALLS.get(),i=0;___syscall146.buffer||(___syscall146.buffer=[]);for(var a=___syscall146.buffer,o=0;o<n;o++){for(var s=HEAP32[r+8*o>>2],l=HEAP32[r+(8*o+4)>>2],u=0;u<l;u++){var c=HEAPU8[s+u];0===c||10===c?(Module.print(UTF8ArrayToString(a,0)),a.length=0):a.push(c)}i+=l}return i}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall221(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD();switch(SYSCALLS.get()){case 0:return(n=SYSCALLS.get())<0?-ERRNO_CODES.EINVAL:FS.open(r.path,r.flags,0,n).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:var n=SYSCALLS.get();return r.flags|=n,0;case 12:case 12:n=SYSCALLS.get();return HEAP16[n+0>>1]=2,0;case 13:case 14:case 13:case 14:return 0;case 16:case 8:return-ERRNO_CODES.EINVAL;case 9:return ___setErrNo(ERRNO_CODES.EINVAL),-1;default:return-ERRNO_CODES.EINVAL}}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}function ___syscall145(e,t){SYSCALLS.varargs=t;try{var r=SYSCALLS.getStreamFromFD(),n=SYSCALLS.get(),i=SYSCALLS.get();return SYSCALLS.doReadv(r,n,i)}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||abort(e),-e.errno}}Module.requestFullScreen=function(e,t,r){Browser.requestFullScreen(e,t,r)},Module.requestAnimationFrame=function(e){Browser.requestAnimationFrame(e)},Module.setCanvasSize=function(e,t,r){Browser.setCanvasSize(e,t,r)},Module.pauseMainLoop=function(){Browser.mainLoop.pause()},Module.resumeMainLoop=function(){Browser.mainLoop.resume()},Module.getUserMedia=function(){Browser.getUserMedia()},Module.createContext=function(e,t,r,n){return Browser.createContext(e,t,r,n)},STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),staticSealed=!0,STACK_MAX=STACK_BASE+TOTAL_STACK,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);function invoke_iiiiiiii(e,t,r,n,i,a,o,s){try{return Module.dynCall_iiiiiiii(e,t,r,n,i,a,o,s)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiii(e,t,r,n){try{return Module.dynCall_iiii(e,t,r,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_di(e,t){try{return Module.dynCall_di(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_vi(e,t){try{Module.dynCall_vi(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_vii(e,t,r){try{Module.dynCall_vii(e,t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiiii(e,t,r,n,i,a,o){try{return Module.dynCall_iiiiiii(e,t,r,n,i,a,o)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_ii(e,t){try{return Module.dynCall_ii(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_viii(e,t,r,n){try{Module.dynCall_viii(e,t,r,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiiiiiiiii(e,t,r,n,i,a,o,s,l,u,c,h){try{return Module.dynCall_iiiiiiiiiiii(e,t,r,n,i,a,o,s,l,u,c,h)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiii(e,t,r,n,i){try{return Module.dynCall_iiiii(e,t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iii(e,t,r){try{return Module.dynCall_iii(e,t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_iiiiii(e,t,r,n,i,a){try{return Module.dynCall_iiiiii(e,t,r,n,i,a)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}function invoke_viiii(e,t,r,n,i){try{Module.dynCall_viiii(e,t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;asm.setThrew(1,0)}}Module.asmGlobalArg={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,byteLength:byteLength},Module.asmLibraryArg={abort:abort,assert:assert,invoke_iiiiiiii:invoke_iiiiiiii,invoke_iiii:invoke_iiii,invoke_di:invoke_di,invoke_vi:invoke_vi,invoke_vii:invoke_vii,invoke_iiiiiii:invoke_iiiiiii,invoke_ii:invoke_ii,invoke_viii:invoke_viii,invoke_iiiiiiiiiiii:invoke_iiiiiiiiiiii,invoke_iiiii:invoke_iiiii,invoke_iii:invoke_iii,invoke_iiiiii:invoke_iiiiii,invoke_viiii:invoke_viiii,_pthread_cleanup_pop:_pthread_cleanup_pop,___syscall221:___syscall221,_llvm_pow_f64:_llvm_pow_f64,_abort:_abort,_pthread_cleanup_push:_pthread_cleanup_push,_ceilf:_ceilf,_emscripten_set_main_loop_timing:_emscripten_set_main_loop_timing,_sbrk:_sbrk,_emscripten_memcpy_big:_emscripten_memcpy_big,_sysconf:_sysconf,___setErrNo:___setErrNo,_floor:_floor,_pthread_self:_pthread_self,_sqrt:_sqrt,_floorf:_floorf,___syscall54:___syscall54,___unlock:___unlock,_emscripten_set_main_loop:_emscripten_set_main_loop,___lock:___lock,___syscall6:___syscall6,___syscall5:___syscall5,_time:_time,___syscall140:___syscall140,___syscall145:___syscall145,___syscall146:___syscall146,STACKTOP:STACKTOP,STACK_MAX:STACK_MAX,tempDoublePtr:tempDoublePtr,ABORT:ABORT,cttz_i8:cttz_i8};var asm=function(e,t,r){"use asm";var n=e.Int8Array;var i=e.Int16Array;var a=e.Int32Array;var o=e.Uint8Array;var s=e.Uint16Array;var l=e.Uint32Array;var u=e.Float32Array;var c=e.Float64Array;var h=new n(r);var d=new i(r);var f=new a(r);var p=new o(r);var m=new s(r);var g=new l(r);var v=new u(r);var y=new c(r);var _=e.byteLength;var b=t.STACKTOP|0;var E=t.STACK_MAX|0;var w=t.tempDoublePtr|0;var x=t.ABORT|0;var T=t.cttz_i8|0;var M=0;var S=0;var A=0;var R=0;var k=e.NaN,P=e.Infinity;var L=0,C=0,I=0,H=0,O=0.0,D=0,F=0,N=0,U=0.0;var B=0;var z=0;var j=0;var V=0;var G=0;var W=0;var X=0;var Y=0;var q=0;var Z=0;var K=e.Math.floor;var Q=e.Math.abs;var J=e.Math.sqrt;var $=e.Math.pow;var ee=e.Math.cos;var te=e.Math.sin;var re=e.Math.tan;var ne=e.Math.acos;var ie=e.Math.asin;var ae=e.Math.atan;var oe=e.Math.atan2;var se=e.Math.exp;var le=e.Math.log;var ue=e.Math.ceil;var ce=e.Math.imul;var he=e.Math.min;var de=e.Math.clz32;var fe=t.abort;var pe=t.assert;var me=t.invoke_iiiiiiii;var ge=t.invoke_iiii;var ve=t.invoke_di;var ye=t.invoke_vi;var _e=t.invoke_vii;var be=t.invoke_iiiiiii;var Ee=t.invoke_ii;var we=t.invoke_viii;var xe=t.invoke_iiiiiiiiiiii;var Te=t.invoke_iiiii;var Me=t.invoke_iii;var Se=t.invoke_iiiiii;var Ae=t.invoke_viiii;var Re=t._pthread_cleanup_pop;var ke=t.___syscall221;var Pe=t._llvm_pow_f64;var Le=t._abort;var Ce=t._pthread_cleanup_push;var Ie=t._ceilf;var He=t._emscripten_set_main_loop_timing;var Oe=t._sbrk;var De=t._emscripten_memcpy_big;var Fe=t._sysconf;var Ne=t.___setErrNo;var Ue=t._floor;var Be=t._pthread_self;var ze=t._sqrt;var je=t._floorf;var Ve=t.___syscall54;var Ge=t.___unlock;var We=t._emscripten_set_main_loop;var Xe=t.___lock;var Ye=t.___syscall6;var qe=t.___syscall5;var Ze=t._time;var Ke=t.___syscall140;var Qe=t.___syscall145;var Je=t.___syscall146;var $e=0.0;function et(e){if(_(e)&16777215||_(e)<=16777215||_(e)>2147483648)return false;h=new n(e);d=new i(e);f=new a(e);p=new o(e);m=new s(e);g=new l(e);v=new u(e);y=new c(e);r=e;return true}function tt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=b;b=b+48|0;i=c+32|0;u=c+28|0;f[i>>2]=r;if((f[e+8>>2]|0)==16)l=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else l=f[e+12>>2]|0;a=(f[e+80>>2]|0)+16|0;o=(f[a>>2]|0)>>>0<257?1:2;s=o+1|0;if(s>>>0>r>>>0){Jn(n,1,14585,c)|0;n=0;b=c;return n|0}f[i>>2]=r-s;wn(t,u,o);r=f[u>>2]|0;if(r>>>0>=(f[a>>2]|0)>>>0){Jn(n,1,14611,c+8|0)|0;n=0;b=c;return n|0}wn(t+o|0,(f[l+5584>>2]|0)+(r*1080|0)|0,1);if(!(At(e,f[u>>2]|0,t+s|0,i,n)|0)){Jn(n,1,14585,c+16|0)|0;n=0;b=c;return n|0}if(!(f[i>>2]|0)){n=1;b=c;return n|0}Jn(n,1,14585,c+24|0)|0;n=0;b=c;return n|0}function rt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+32|0;s=l+8|0;i=l+20|0;o=f[(f[e+80>>2]|0)+16>>2]|0;a=o>>>0<257?1:2;if((a+2|0)!=(r|0)){Jn(n,1,14502,l)|0;s=0;b=l;return s|0}if((f[e+8>>2]|0)==16)e=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else e=f[e+12>>2]|0;wn(t,i,a);wn(t+a|0,l+16|0,1);r=f[i>>2]|0;if(r>>>0<o>>>0){wn(t+(a+1)|0,(f[e+5584>>2]|0)+(r*1080|0)+808|0,1);s=1;b=l;return s|0}else{f[s>>2]=r;f[s+4>>2]=o;Jn(n,1,14528,s)|0;s=0;b=l;return s|0}return 0}function nt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0;o=b;b=b+16|0;i=o+12|0;f[i>>2]=r;if(!(St(e,0,t,i,n)|0)){Jn(n,1,14476,o)|0;a=0;b=o;return a|0}if(f[i>>2]|0){Jn(n,1,14476,o+8|0)|0;a=0;b=o;return a|0}if((f[e+8>>2]|0)==16)i=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else i=f[e+12>>2]|0;i=f[i+5584>>2]|0;r=e+80|0;if((f[(f[r>>2]|0)+16>>2]|0)>>>0<=1){a=1;b=o;return a|0}n=i+24|0;e=i+804|0;a=i+28|0;t=1;while(1){f[i+1104>>2]=f[n>>2];f[i+1884>>2]=f[e>>2];Yl(i+1108|0,a|0,776)|0;t=t+1|0;if(t>>>0>=(f[(f[r>>2]|0)+16>>2]|0)>>>0){i=1;break}else i=i+1080|0}b=o;return i|0}function it(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;d=b;b=b+48|0;h=d+32|0;c=d+24|0;u=d+16|0;a=d+8|0;i=d;l=d+40|0;o=d+36|0;f[l>>2]=r;s=e+80|0;do{if((f[(f[s>>2]|0)+16>>2]|0)>>>0<257){if(r){wn(t,o,1);a=t+1|0;t=r+-1|0;break}Jn(n,1,14129,i)|0;h=0;b=d;return h|0}else{if(r>>>0>=2){wn(t,o,2);a=t+2|0;t=r+-2|0;break}Jn(n,1,14129,a)|0;h=0;b=d;return h|0}}while(0);f[l>>2]=t;i=f[o>>2]|0;t=f[(f[s>>2]|0)+16>>2]|0;if(i>>>0>=t>>>0){f[u>>2]=i;f[u+4>>2]=t;Jn(n,1,14155,u)|0;h=0;b=d;return h|0}if(!(St(e,i,a,l,n)|0)){Jn(n,1,14129,c)|0;h=0;b=d;return h|0}if(!(f[l>>2]|0)){h=1;b=d;return h|0}Jn(n,1,14129,h)|0;h=0;b=d;return h|0}function at(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;y=b;b=b+16|0;a=y+8|0;v=y+12|0;g=f[(f[e+80>>2]|0)+16>>2]|0;m=g>>>0<257?1:2;p=(m<<1)+5|0;i=(r>>>0)/(p>>>0)|0;if((i|0)==0|((r>>>0)%(p>>>0)|0|0)!=0){Jn(n,1,14085,y)|0;v=0;b=y;return v|0}if((f[e+8>>2]|0)==16)p=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else p=f[e+12>>2]|0;r=p+5636|0;e=h[r>>0]|0;if(!(e&4))d=0;else d=(f[p+420>>2]|0)+1|0;c=d+i|0;if(c>>>0>31){f[a>>2]=c;Jn(n,1,14111,a)|0;v=0;b=y;return v|0}h[r>>0]=e|4;if(d>>>0<c>>>0){n=m+1|0;u=p+8|0;a=m+3|0;o=m|4;s=o+m|0;l=s+1|0;e=t;i=d;r=p+424+(d*148|0)|0;while(1){wn(e,r,1);wn(e+1|0,r+4|0,m);t=r+8|0;wn(e+n|0,t,2);_=f[t>>2]|0;d=f[u>>2]|0;f[t>>2]=_>>>0<d>>>0?_:d;wn(e+a|0,r+12|0,1);t=r+16|0;wn(e+o|0,t,m);wn(e+s|0,v,1);f[r+36>>2]=f[v>>2];d=f[t>>2]|0;f[t>>2]=d>>>0<g>>>0?d:g;i=i+1|0;if(i>>>0>=c>>>0)break;else{e=e+l|0;r=r+148|0}}}f[p+420>>2]=c+-1;_=1;b=y;return _|0}function ot(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0;F=b;b=b+144|0;D=F+128|0;C=F+120|0;L=F+112|0;P=F+104|0;k=F+96|0;R=F+88|0;S=F+72|0;y=F+64|0;g=F+56|0;m=F+48|0;p=F+40|0;v=F+32|0;s=F+24|0;a=F+16|0;i=F+136|0;w=F+132|0;H=f[e+80>>2]|0;O=e+88|0;if(r>>>0<36){Jn(n,1,13440,F)|0;n=0;b=F;return n|0}I=r+-36|0;c=(I>>>0)/3|0;if((I>>>0)%3|0){Jn(n,1,13440,F+8|0)|0;n=0;b=F;return n|0}wn(t,i,2);d[O>>1]=f[i>>2];x=H+8|0;wn(t+2|0,x,4);A=H+12|0;wn(t+6|0,A,4);wn(t+10|0,H,4);u=H+4|0;wn(t+14|0,u,4);E=e+100|0;wn(t+18|0,E,4);M=e+104|0;wn(t+22|0,M,4);_=e+92|0;wn(t+26|0,_,4);T=e+96|0;wn(t+30|0,T,4);wn(t+34|0,i,2);o=t+36|0;r=f[i>>2]|0;if(r>>>0>=16385){f[a>>2]=r;Jn(n,1,13468,a)|0;n=0;b=F;return n|0}r=r&65535;I=H+16|0;f[I>>2]=r;if((r|0)!=(c|0)){f[s>>2]=r;f[s+4>>2]=c;Jn(n,1,13529,s)|0;n=0;b=F;return n|0}s=f[H>>2]|0;l=f[x>>2]|0;if(l>>>0>s>>>0){r=f[u>>2]|0;t=f[A>>2]|0;if(r>>>0<t>>>0){i=f[E>>2]|0;a=f[M>>2]|0;if(!(ce(a,i)|0)){f[p>>2]=i;f[p+4>>2]=a;Jn(n,1,13705,p)|0;n=0;b=F;return n|0}v=Jl(t|0,0,l|0,0)|0;if(!((v|0)==(ce(t,l)|0)&(B|0)==0)){f[m>>2]=l;f[m+4>>2]=t;Jn(n,1,13766,m)|0;n=0;b=F;return n|0}l=f[_>>2]|0;p=Wl(l|0,0,i|0,0)|0;m=B;u=f[T>>2]|0;v=Wl(u|0,0,a|0,0)|0;if(l>>>0<=s>>>0?u>>>0<=r>>>0&(p|0-m)>>>0>s>>>0&(v|0-B)>>>0>r>>>0:0){t=qi(c,52)|0;c=H+24|0;f[c>>2]=t;if(!t){f[I>>2]=0;Jn(n,1,13852,y)|0;n=0;b=F;return n|0}e:do{if(f[I>>2]|0){s=e+168|0;r=0;a=t;while(1){wn(o,w,1);f[a+24>>2]=(f[w>>2]&127)+1;f[a+32>>2]=(f[w>>2]|0)>>>7;wn(o+1|0,w,1);f[a>>2]=f[w>>2];wn(o+2|0,w,1);i=f[w>>2]|0;f[a+4>>2]=i;t=f[a>>2]|0;if((i+-1|0)>>>0>254|(t+-1|0)>>>0>254)break;f[a+36>>2]=0;f[a+40>>2]=f[s>>2];r=r+1|0;if(r>>>0>=(f[I>>2]|0)>>>0)break e;else{o=o+3|0;a=a+52|0}}f[S>>2]=r;f[S+4>>2]=t;f[S+8>>2]=i;Jn(n,1,13900,S)|0;n=0;b=F;return n|0}}while(0);l=f[_>>2]|0;s=f[E>>2]|0;o=((f[x>>2]|0)+-1-l+s|0)/(s|0)|0;f[e+112>>2]=o;a=f[T>>2]|0;i=f[M>>2]|0;t=((f[A>>2]|0)+-1-a+i|0)/(i|0)|0;f[e+116>>2]=t;if(!((t|0)==0|(o|0)==0)?o>>>0<=(65535/(t>>>0)|0)>>>0:0){u=ce(o,t)|0;r=e+28|0;if(!(h[e+76>>0]&2)){f[r>>2]=0;f[e+32>>2]=0;f[e+36>>2]=o;f[e+40>>2]=t}else{f[r>>2]=(((f[r>>2]|0)-l|0)>>>0)/(s>>>0)|0;R=e+32|0;f[R>>2]=(((f[R>>2]|0)-a|0)>>>0)/(i>>>0)|0;R=e+36|0;f[R>>2]=((f[R>>2]|0)+-1-l+s|0)/(s|0)|0;R=e+40|0;f[R>>2]=((f[R>>2]|0)+-1-a+i|0)/(i|0)|0}R=qi(u,5640)|0;o=e+164|0;f[o>>2]=R;if(!R){Jn(n,1,13852,k)|0;n=0;b=F;return n|0}k=qi(f[I>>2]|0,1080)|0;t=e+12|0;f[(f[t>>2]|0)+5584>>2]=k;if(!k){Jn(n,1,13852,P)|0;n=0;b=F;return n|0}P=qi(10,20)|0;r=f[t>>2]|0;f[r+5612>>2]=P;if(!P){Jn(n,1,13852,L)|0;n=0;b=F;return n|0}f[r+5620>>2]=10;L=qi(10,20)|0;r=f[t>>2]|0;f[r+5624>>2]=L;if(!L){Jn(n,1,13852,C)|0;n=0;b=F;return n|0}f[r+5632>>2]=10;a=f[I>>2]|0;if(a){i=f[c>>2]|0;r=r+5584|0;t=0;do{if(!(f[i+(t*52|0)+32>>2]|0))f[(f[r>>2]|0)+(t*1080|0)+1076>>2]=1<<(f[i+(t*52|0)+24>>2]|0)+-1;t=t+1|0}while(t>>>0<a>>>0)}e:do{if(u){r=f[o>>2]|0;C=qi(a,1080)|0;f[r+5584>>2]=C;if(C){t=0;while(1){t=t+1|0;if(t>>>0>=u>>>0)break e;C=qi(f[I>>2]|0,1080)|0;f[r+11224>>2]=C;if(!C)break;else r=r+5640|0}}Jn(n,1,13852,D)|0;n=0;b=F;return n|0}}while(0);f[e+8>>2]=4;ii(H,O);n=1;b=F;return n|0}f[R>>2]=o;f[R+4>>2]=t;Jn(n,1,14002,R)|0;n=0;b=F;return n|0}Jn(n,1,13808,g)|0;n=0;b=F;return n|0}}else{t=f[A>>2]|0;r=f[u>>2]|0}f[v>>2]=l-s;f[v+4>>2]=t-r;Jn(n,1,13643,v)|0;n=0;b=F;return n|0}function st(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0;i=b;b=b+32|0;e=i+12|0;if(r>>>0<2){Jn(n,1,13414,i)|0;n=0;b=i;return n|0}wn(t,i+16|0,1);wn(t+1|0,e,1);t=f[e>>2]|0;if(!(((r+-2|0)>>>0)%(((t>>>5&2)+2+(t>>>4&3)|0)>>>0)|0)){n=1;b=i;return n|0}Jn(n,1,13414,i+8|0)|0;n=0;b=i;return n|0}function lt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;e=b;b=b+16|0;if(!r){Jn(n,1,13388,e)|0;t=0}else t=1;b=e;return t|0}function ut(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+32|0;s=l+8|0;o=l+12|0;if(!r){Jn(n,1,13362,l)|0;n=0;b=l;return n|0}wn(t,l+16|0,1);i=r+-1|0;if(!i){n=1;b=l;return n|0}else{a=0;e=0}do{t=t+1|0;wn(t,o,1);r=f[o>>2]|0;if(!(r&128))e=0;else e=(r&127|e)<<7;a=a+1|0}while((a|0)!=(i|0));if(!e){n=1;b=l;return n|0}Jn(n,1,13362,s)|0;n=0;b=l;return n|0}function ct(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0;p=b;b=b+48|0;d=p+32|0;l=p+24|0;a=p+16|0;i=p+8|0;c=p+36|0;if(r>>>0<2){Jn(n,1,13276,p)|0;d=0;b=p;return d|0}u=e+184|0;h[u>>0]=h[u>>0]|1;wn(t,c,1);u=t+1|0;s=r+-1|0;o=e+124|0;r=f[o>>2]|0;do{if(r){i=e+120|0;t=f[c>>2]|0;if((f[i>>2]|0)>>>0<=t>>>0){e=t+1|0;t=Qi(r,e<<3)|0;if(t){f[o>>2]=t;r=f[i>>2]|0;Vl(t+(r<<3)|0,0,e-r<<3|0)|0;f[i>>2]=e;r=f[o>>2]|0;break}Jn(n,1,13302,a)|0;d=0;b=p;return d|0}}else{t=(f[c>>2]|0)+1|0;r=qi(t,8)|0;f[o>>2]=r;if(r){f[e+120>>2]=t;break}Jn(n,1,13302,i)|0;d=0;b=p;return d|0}}while(0);t=f[c>>2]|0;if(f[r+(t<<3)>>2]|0){f[l>>2]=t;Jn(n,1,13340,l)|0;d=0;b=p;return d|0}l=Yi(s)|0;r=f[c>>2]|0;t=f[o>>2]|0;f[t+(r<<3)>>2]=l;if(!l){Jn(n,1,13302,d)|0;d=0;b=p;return d|0}else{f[t+(r<<3)+4>>2]=s;Yl(f[t+(f[c>>2]<<3)>>2]|0,u|0,s|0)|0;d=1;b=p;return d|0}return 0}function ht(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0;g=b;b=b+48|0;m=g+40|0;d=g+32|0;s=g+24|0;o=g+16|0;p=g+44|0;if(r>>>0<2){Jn(n,1,13127,g)|0;m=0;b=g;return m|0}if(h[e+184>>0]&1){Jn(n,1,13153,g+8|0)|0;m=0;b=g;return m|0}a=f[e+200>>2]|0;i=f[e+164>>2]|0;c=i+(a*5640|0)+5636|0;h[c>>0]=h[c>>0]|2;wn(t,p,1);c=t+1|0;u=r+-1|0;l=i+(a*5640|0)+5164|0;t=f[l>>2]|0;do{if(t){i=i+(a*5640|0)+5160|0;e=f[p>>2]|0;if((f[i>>2]|0)>>>0<=e>>>0){r=e+1|0;e=Qi(t,r<<3)|0;if(e){f[l>>2]=e;t=f[i>>2]|0;Vl(e+(t<<3)|0,0,r-t<<3|0)|0;f[i>>2]=r;t=f[l>>2]|0;break}Jn(n,1,8775,s)|0;m=0;b=g;return m|0}}else{e=(f[p>>2]|0)+1|0;t=qi(e,8)|0;f[l>>2]=t;if(t){f[i+(a*5640|0)+5160>>2]=e;break}Jn(n,1,8775,o)|0;m=0;b=g;return m|0}}while(0);e=f[p>>2]|0;if(f[t+(e<<3)>>2]|0){f[d>>2]=e;Jn(n,1,13254,d)|0;m=0;b=g;return m|0}d=Yi(u)|0;t=f[p>>2]|0;e=f[l>>2]|0;f[e+(t<<3)>>2]=d;if(!d){Jn(n,1,8775,m)|0;m=0;b=g;return m|0}else{f[e+(t<<3)+4>>2]=u;Yl(f[e+(f[p>>2]<<3)>>2]|0,c|0,u|0)|0;m=1;b=g;return m|0}return 0}function dt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;t=b;b=b+16|0;if((f[(f[e+80>>2]|0)+16>>2]<<2|0)==(r|0)){n=1;b=t;return n|0}Jn(n,1,13101,t)|0;n=0;b=t;return n|0}function ft(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return 1}function pt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+48|0;g=v+40|0;m=v+32|0;u=v+24|0;p=v+44|0;if((f[e+8>>2]|0)==16)s=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else s=f[e+12>>2]|0;if(r>>>0<2){Jn(n,1,12933,v)|0;g=0;b=v;return g|0}wn(t,p,2);if(f[p>>2]|0){Jn(n,2,12959,v+8|0)|0;g=1;b=v;return g|0}if(r>>>0<7){Jn(n,1,12933,v+16|0)|0;g=0;b=v;return g|0}wn(t+2|0,p,2);h=t+4|0;d=f[p>>2]&255;l=s+5612|0;i=f[l>>2]|0;c=s+5616|0;e=f[c>>2]|0;e:do{if(!e){a=0;o=i}else{a=0;o=i;do{if((f[o+8>>2]|0)==(d|0))break e;o=o+20|0;a=a+1|0}while(a>>>0<e>>>0)}}while(0);if((a|0)==(e|0)){a=s+5620|0;do{if((e|0)==(f[a>>2]|0)){e=e+10|0;f[a>>2]=e;e=Qi(i,e*20|0)|0;if(e){f[l>>2]=e;i=f[c>>2]|0;Vl(e+(i*20|0)|0,0,((f[a>>2]|0)-i|0)*20|0)|0;i=f[l>>2]|0;e=f[c>>2]|0;break}Ji(f[l>>2]|0);f[l>>2]=0;f[a>>2]=0;f[c>>2]=0;Jn(n,1,13019,u)|0;g=0;b=v;return g|0}}while(0);f[c>>2]=e+1;o=i+(e*20|0)|0}a=o+12|0;e=f[a>>2]|0;if(e){Ji(e);f[a>>2]=0}f[o+8>>2]=d;d=f[p>>2]|0;f[o+4>>2]=d>>>8&3;f[o>>2]=d>>>10&3;wn(h,p,2);if(f[p>>2]|0){Jn(n,2,13057,m)|0;g=1;b=v;return g|0}e=r+-6|0;i=Yi(e)|0;f[a>>2]=i;if(!i){Jn(n,1,12933,g)|0;g=0;b=v;return g|0}else{Yl(i|0,t+6|0,e|0)|0;f[o+16>>2]=e;g=1;b=v;return g|0}return 0}function mt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;i=s+16|0;o=s+12|0;e=e+80|0;a=f[(f[e>>2]|0)+16>>2]|0;if((a+2|0)!=(r|0)){Jn(n,1,12907,s)|0;o=0;b=s;return o|0}wn(t,i,2);if((f[i>>2]|0)!=(a|0)){Jn(n,1,12907,s+8|0)|0;o=0;b=s;return o|0}if(!a){o=1;b=s;return o|0}i=t+2|0;t=0;e=f[(f[e>>2]|0)+24>>2]|0;while(1){wn(i,o,1);f[e+32>>2]=(f[o>>2]|0)>>>7&1;f[e+24>>2]=(f[o>>2]&127)+1;t=t+1|0;if((t|0)==(a|0)){e=1;break}else{i=i+1|0;e=e+52|0}}b=s;return e|0}function gt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0;O=b;b=b+144|0;H=O+120|0;I=O+112|0;C=O+104|0;L=O+96|0;P=O+88|0;k=O+80|0;R=O+72|0;A=O+64|0;S=O+56|0;M=O+48|0;p=O+40|0;d=O+32|0;u=O+24|0;x=O+136|0;_=O+132|0;E=O+128|0;w=O+124|0;if((f[e+8>>2]|0)==16)m=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else m=f[e+12>>2]|0;if(r>>>0<2){Jn(n,1,12567,O)|0;H=0;b=O;return H|0}wn(t,x,2);if(f[x>>2]|0){Jn(n,2,12593,O+8|0)|0;H=1;b=O;return H|0}if(r>>>0<7){Jn(n,1,12567,O+16|0)|0;H=0;b=O;return H|0}wn(t+2|0,_,1);c=t+3|0;l=m+5624|0;i=f[l>>2]|0;T=m+5628|0;e=f[T>>2]|0;e:do{if(!e){o=0;a=i}else{s=f[_>>2]|0;o=0;a=i;do{if((f[a>>2]|0)==(s|0))break e;a=a+20|0;o=o+1|0}while(o>>>0<e>>>0)}}while(0);if((o|0)==(e|0)){a=m+5632|0;do{if((e|0)==(f[a>>2]|0)){e=e+10|0;f[a>>2]=e;e=Qi(i,e*20|0)|0;if(e){f[l>>2]=e;i=f[T>>2]|0;Vl(e+(i*20|0)|0,0,((f[a>>2]|0)-i|0)*20|0)|0;i=f[l>>2]|0;e=f[T>>2]|0;break}Ji(f[l>>2]|0);f[l>>2]=0;f[a>>2]=0;f[T>>2]=0;Jn(n,1,12639,u)|0;H=0;b=O;return H|0}}while(0);a=i+(e*20|0)|0}f[a>>2]=f[_>>2];wn(c,x,2);if(f[x>>2]|0){Jn(n,2,12593,d)|0;H=1;b=O;return H|0}wn(t+5|0,E,2);i=f[E>>2]|0;if(i>>>0>1){Jn(n,2,12677,p)|0;H=1;b=O;return H|0}e=r+-7|0;e:do{if(i){g=a+4|0;v=a+16|0;y=a+8|0;r=a+12|0;p=m+5612|0;d=m+5616|0;u=t+7|0;c=0;t:while(1){if(e>>>0<3){i=27;break}wn(u,x,1);if((f[x>>2]|0)!=1){i=29;break}wn(u+1|0,w,2);i=e+-3|0;o=f[w>>2]|0;s=(o>>>15)+1|0;o=o&32767;f[g>>2]=o;a=(ce(s,o)|0)+2|0;if(i>>>0<a>>>0){i=31;break}e=u+3|0;l=i-a|0;if(o){i=0;do{wn(e,x,s);if((f[x>>2]|0)!=(i|0)){i=34;break t}e=e+s|0;i=i+1|0}while(i>>>0<(f[g>>2]|0)>>>0)}wn(e,w,2);i=e+2|0;a=f[w>>2]|0;o=(a>>>15)+1|0;a=a&32767;f[w>>2]=a;if((a|0)!=(f[g>>2]|0)){i=37;break}e=(ce(o,a)|0)+3|0;if(l>>>0<e>>>0){i=39;break}e=l-e|0;if(a){a=0;do{wn(i,x,o);if((f[x>>2]|0)!=(a|0)){i=42;break t}i=i+o|0;a=a+1|0}while(a>>>0<(f[g>>2]|0)>>>0)}wn(i,x,3);u=i+3|0;h[v>>0]=((f[x>>2]|0)>>>16^1)&1|h[v>>0]&-2;f[y>>2]=0;f[r>>2]=0;l=f[x>>2]|0;a=l&255;f[_>>2]=a;if(a){o=f[d>>2]|0;if(!o){i=50;break}s=0;i=f[p>>2]|0;while(1){if((f[i+8>>2]|0)==(a|0))break;s=s+1|0;if(s>>>0>=o>>>0){i=50;break t}else i=i+20|0}f[y>>2]=i}a=l>>>8&255;f[_>>2]=a;if(a){o=f[d>>2]|0;if(!o){i=57;break}s=0;i=f[p>>2]|0;while(1){if((f[i+8>>2]|0)==(a|0))break;s=s+1|0;if(s>>>0>=o>>>0){i=57;break t}else i=i+20|0}f[r>>2]=i}c=c+1|0;if(c>>>0>=(f[E>>2]|0)>>>0)break e}if((i|0)==27){Jn(n,1,12567,M)|0;H=0;b=O;return H|0}else if((i|0)==29){Jn(n,2,12721,S)|0;H=1;b=O;return H|0}else if((i|0)==31){Jn(n,1,12567,A)|0;H=0;b=O;return H|0}else if((i|0)==34){Jn(n,2,12787,R)|0;H=1;b=O;return H|0}else if((i|0)==37){Jn(n,2,12841,k)|0;H=1;b=O;return H|0}else if((i|0)==39){Jn(n,1,12567,P)|0;H=0;b=O;return H|0}else if((i|0)==42){Jn(n,2,12787,L)|0;H=1;b=O;return H|0}else if((i|0)==50){Jn(n,1,12567,C)|0;H=0;b=O;return H|0}else if((i|0)==57){Jn(n,1,12567,I)|0;H=0;b=O;return H|0}}}while(0);if(!e){f[T>>2]=(f[T>>2]|0)+1;H=1;b=O;return H|0}else{Jn(n,1,12567,H)|0;H=0;b=O;return H|0}return 0}function vt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+32|0;g=v+24|0;m=v+20|0;h=e+80|0;i=f[h>>2]|0;if((f[e+8>>2]|0)==16)a=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else a=f[e+12>>2]|0;if(!r){Jn(n,1,12486,v)|0;g=0;b=v;return g|0}wn(t,m,1);e=f[m>>2]|0;if(e>>>0>1){Jn(n,2,12512,v+8|0)|0;g=1;b=v;return g|0}if((e+1|0)!=(r|0)){Jn(n,2,12486,v+16|0)|0;g=0;b=v;return g|0}c=a+5584|0;e=f[i+16>>2]|0;if(e){r=0;n=f[c>>2]|0;while(1){f[n+1076>>2]=0;r=r+1|0;if(r>>>0>=e>>>0)break;else n=n+1080|0}}u=a+5604|0;e=f[u>>2]|0;if(e){Ji(e);f[u>>2]=0}if(!(f[m>>2]|0)){g=1;b=v;return g|0}l=a+5624|0;o=a+5628|0;s=0;while(1){t=t+1|0;wn(t,g,1);e=f[h>>2]|0;i=f[l>>2]|0;a=f[o>>2]|0;if(((a|0)!=0?!((a|0)==0?1:(f[i>>2]|0)!=(f[g>>2]|0)):0)?(d=f[i+4>>2]|0,p=e+16|0,(d|0)==(f[p>>2]|0)):0){e=f[i+8>>2]|0;if(e){r=ce(d,d)|0;a=ce(f[1036+(f[e>>2]<<2)>>2]|0,r)|0;if((f[e+16>>2]|0)!=(a|0)){e=0;r=32;break}n=Yi(r<<2)|0;f[u>>2]=n;if(!n){e=0;r=32;break}Ou[f[1052+(f[e>>2]<<2)>>2]&15](f[e+12>>2]|0,n,r)}e=f[i+12>>2]|0;if(e){r=f[p>>2]|0;a=ce(r,f[1036+(f[e>>2]<<2)>>2]|0)|0;if((f[e+16>>2]|0)!=(a|0)){e=0;r=32;break}a=Yi(r<<2)|0;if(!a){e=0;r=32;break}Ou[f[1068+(f[e>>2]<<2)>>2]&15](f[e+12>>2]|0,a,r);e=f[p>>2]|0;if(e){r=0;n=a;i=f[c>>2]|0;while(1){f[i+1076>>2]=f[n>>2];r=r+1|0;if((r|0)==(e|0))break;else{n=n+4|0;i=i+1080|0}}}Ji(a)}}s=s+1|0;if(s>>>0>=(f[m>>2]|0)>>>0){e=1;r=32;break}}if((r|0)==32){b=v;return e|0}return 0}function yt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,2);f[t>>2]=f[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+2|0}}b=a;return}function _t(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,4);f[t>>2]=f[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function bt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Sn(e,i);f[t>>2]=~~+v[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function Et(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Tn(e,i);f[t>>2]=~~+y[i>>3];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+8|0}}b=a;return}function wt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,2);v[t>>2]=+((f[i>>2]|0)>>>0);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+2|0}}b=a;return}function xt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){wn(e,i,4);v[t>>2]=+((f[i>>2]|0)>>>0);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function Tt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Sn(e,i);f[t>>2]=f[i>>2];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}b=a;return}function Mt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;if(!r){b=a;return}n=0;while(1){Tn(e,i);v[t>>2]=+y[i>>3];n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+8|0}}b=a;return}function St(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0;h=b;b=b+32|0;o=h+8|0;l=h+20|0;if((f[e+8>>2]|0)==16)e=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else e=f[e+12>>2]|0;c=f[e+5584>>2]|0;e=f[n>>2]|0;if(!e){Jn(i,1,14224,h)|0;t=0;b=h;return t|0}f[n>>2]=e+-1;wn(r,l,1);r=r+1|0;a=f[l>>2]&31;s=c+(t*1080|0)+24|0;f[s>>2]=a;f[c+(t*1080|0)+804>>2]=(f[l>>2]|0)>>>5;do{if((a|0)==1){e=1;u=8}else{e=(f[n>>2]|0)>>>((a|0)!=0&1);if(e>>>0>97){f[o>>2]=e;f[o+4>>2]=97;f[o+8>>2]=97;Jn(i,2,14260,o)|0;a=f[s>>2]|0}i=(e|0)==0;if(a)if(i){e=0;u=20;break}else{u=8;break}if(!i){a=0;while(1){wn(r,l,1);if(a>>>0<97){f[c+(t*1080|0)+28+(a<<3)>>2]=(f[l>>2]|0)>>>3;f[c+(t*1080|0)+28+(a<<3)+4>>2]=0}a=a+1|0;if((a|0)==(e|0))break;else r=r+1|0}}e=(f[n>>2]|0)-e|0}}while(0);if((u|0)==8){a=0;while(1){wn(r,l,2);if(a>>>0<97){f[c+(t*1080|0)+28+(a<<3)>>2]=(f[l>>2]|0)>>>11;f[c+(t*1080|0)+28+(a<<3)+4>>2]=f[l>>2]&2047}a=a+1|0;if((a|0)==(e|0)){u=20;break}else r=r+2|0}}if((u|0)==20)e=(f[n>>2]|0)-(e<<1)|0;f[n>>2]=e;if((f[s>>2]|0)!=1){t=1;b=h;return t|0}e=c+(t*1080|0)+28|0;r=c+(t*1080|0)+32|0;a=1;do{n=(f[e>>2]|0)-(((a+-1|0)>>>0)/3|0)|0;f[c+(t*1080|0)+28+(a<<3)>>2]=(n|0)>0?n:0;f[c+(t*1080|0)+28+(a<<3)+4>>2]=f[r>>2];a=a+1|0}while((a|0)!=97);e=1;b=h;return e|0}function At(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0;g=b;b=b+48|0;p=g+40|0;u=g+32|0;l=g+16|0;s=g+8|0;d=g+44|0;o=e+8|0;if((f[o>>2]|0)==16)a=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else a=f[e+12>>2]|0;c=f[a+5584>>2]|0;if((f[n>>2]|0)>>>0<5){Jn(i,1,14664,g)|0;n=0;b=g;return n|0}h=c+(t*1080|0)+4|0;wn(r,h,1);a=(f[h>>2]|0)+1|0;f[h>>2]=a;if(a>>>0>33){f[s>>2]=a;f[s+4>>2]=33;Jn(i,1,14699,s)|0;n=0;b=g;return n|0}if((f[e+168>>2]|0)>>>0>=a>>>0){f[l>>2]=t;Jn(i,1,14776,l)|0;f[o>>2]=f[o>>2]|32768;n=0;b=g;return n|0}s=c+(t*1080|0)+8|0;wn(r+1|0,s,1);f[s>>2]=(f[s>>2]|0)+2;e=c+(t*1080|0)+12|0;wn(r+2|0,e,1);l=(f[e>>2]|0)+2|0;f[e>>2]=l;s=f[s>>2]|0;if(s>>>0>10|l>>>0>10|(s+l|0)>>>0>12){Jn(i,1,14934,g+24|0)|0;n=0;b=g;return n|0}wn(r+3|0,c+(t*1080|0)+16|0,1);wn(r+4|0,c+(t*1080|0)+20|0,1);o=(f[n>>2]|0)+-5|0;f[n>>2]=o;a=f[h>>2]|0;if(!(f[c+(t*1080|0)>>2]&1)){if(!a){n=1;b=g;return n|0}else a=0;do{f[c+(t*1080|0)+812+(a<<2)>>2]=15;f[c+(t*1080|0)+944+(a<<2)>>2]=15;a=a+1|0}while(a>>>0<(f[h>>2]|0)>>>0);a=1;b=g;return a|0}if(o>>>0<a>>>0){Jn(i,1,14664,u)|0;n=0;b=g;return n|0}do{if(!a)a=0;else{e=0;o=r+5|0;while(1){wn(o,d,1);o=o+1|0;a=f[d>>2]|0;if((e|0)!=0?a>>>0<16|(a&15|0)==0:0)break;f[c+(t*1080|0)+812+(e<<2)>>2]=a&15;f[c+(t*1080|0)+944+(e<<2)>>2]=(f[d>>2]|0)>>>4;e=e+1|0;a=f[h>>2]|0;if(e>>>0>=a>>>0){m=22;break}}if((m|0)==22){o=f[n>>2]|0;break}Jn(i,1,15002,p)|0;n=0;b=g;return n|0}}while(0);f[n>>2]=o-a;n=1;b=g;return n|0}function Rt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){En(t,~~+v[e>>2]>>>0,2);n=n+1|0;if((n|0)==(r|0))break;else{t=t+2|0;e=e+4|0}}return}function kt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){En(t,~~+v[e>>2]>>>0,4);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}return}function Pt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){Mn(t,+v[e>>2]);n=n+1|0;if((n|0)==(r|0))break;else{t=t+4|0;e=e+4|0}}return}function Lt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!r)return;n=0;while(1){xn(t,+v[e>>2]);n=n+1|0;if((n|0)==(r|0))break;else{t=t+8|0;e=e+4|0}}return}function Ct(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+16|0;if(!r){r=0;b=s;return r|0}if(!(va(f[e>>2]|0,t,r,n)|0)){Jn(n,1,16303,s)|0;r=0;b=s;return r|0}if(f[e+128>>2]|0){r=1;b=s;return r|0}o=e+108|0;if(!(Qt(r,o,n)|0)){r=0;b=s;return r|0}t=f[e+48>>2]|0;e:do{switch(t|0){case 16:{f[r+20>>2]=1;break}case 17:{f[r+20>>2]=2;break}case 18:{f[r+20>>2]=3;break}case 24:{f[r+20>>2]=4;break}default:{i=r+20|0;if((t|0)==12){f[i>>2]=5;break e}else{f[i>>2]=-1;break e}}}}while(0);a=e+120|0;t=f[a>>2]|0;do{if(t){if(f[t+12>>2]|0){Jt(r,o);break}Ji(f[t+4>>2]|0);Ji(f[(f[a>>2]|0)+8>>2]|0);Ji(f[f[a>>2]>>2]|0);t=f[a>>2]|0;i=f[t+12>>2]|0;if(i){Ji(i);t=f[a>>2]|0}Ji(t);f[a>>2]=0}}while(0);if(f[e+116>>2]|0)$t(r,o,n);t=f[o>>2]|0;if(!t){r=1;b=s;return r|0}f[r+28>>2]=t;f[r+32>>2]=f[e+112>>2];f[o>>2]=0;r=1;b=s;return r|0}function It(e,t){e=e|0;t=t|0;ea(f[e>>2]|0,t);h[e+124>>0]=0;f[e+128>>2]=f[t+8248>>2]&1;return}function Ht(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0;w=b;b=b+80|0;E=w+64|0;v=w+56|0;h=w+48|0;g=w+40|0;m=w+32|0;p=w+24|0;if(!((e|0)!=0&(t|0)!=0&(r|0)!=0)){t=0;b=w;return t|0}y=r+16|0;if(((f[y>>2]|0)+-1|0)>>>0>16383){Jn(n,1,16352,w)|0;t=0;b=w;return t|0}if(!(na(f[e>>2]|0,t,r,n)|0)){t=0;b=w;return t|0}f[e+56>>2]=1785737760;f[e+60>>2]=0;f[e+64>>2]=1;i=Yi(4)|0;a=e+68|0;f[a>>2]=i;if(!i){f[a>>2]=0;Jn(n,1,16421,w+8|0)|0;t=0;b=w;return t|0}f[i>>2]=1785737760;l=f[y>>2]|0;f[e+20>>2]=l;l=Yi(l*12|0)|0;i=e+72|0;f[i>>2]=l;if(!l){f[i>>2]=0;Jn(n,1,16421,w+16|0)|0;t=0;b=w;return t|0}f[e+16>>2]=(f[r+12>>2]|0)-(f[r+4>>2]|0);f[e+12>>2]=(f[r+8>>2]|0)-(f[r>>2]|0);_=r+24|0;u=f[_>>2]|0;o=f[u+24>>2]|0;s=f[u+32>>2]|0;i=e+24|0;f[i>>2]=o+-1+(s<<7);c=f[y>>2]|0;if(c>>>0>1){a=1;do{if((o|0)!=(f[u+(a*52|0)+24>>2]|0))f[i>>2]=255;a=a+1|0}while(a>>>0<c>>>0)}f[e+28>>2]=7;f[e+32>>2]=0;f[e+36>>2]=0;a=(c|0)==0;if(!a?(f[l+8>>2]=o+-1+(s<<7),c>>>0>1):0){i=1;do{f[l+(i*12|0)+8>>2]=(f[u+(i*52|0)+24>>2]|0)+-1+(f[u+(i*52|0)+32>>2]<<7);i=i+1|0}while(i>>>0<c>>>0)}i=e+40|0;e:do{if(!(f[r+32>>2]|0)){f[i>>2]=1;switch(f[r+20>>2]|0){case 1:{f[e+48>>2]=16;break e}case 2:{f[e+48>>2]=17;break e}case 3:{f[e+48>>2]=18;break e}default:break e}}else{f[i>>2]=2;f[e+48>>2]=0}}while(0);e:do{if(!a){a=0;i=0;o=0;do{r=(d[u+(o*52|0)+48>>1]|0)==0;i=(r&1^1)+i|0;a=r?a:o;o=o+1|0}while(o>>>0<c>>>0);o=a;if((i|0)!=1){if(i>>>0<=1)break;Jn(n,2,16717,h)|0;break}switch(f[e+48>>2]|0){case 18:case 16:{a=3;break}case 17:{a=1;break}default:{Jn(n,2,16467,p)|0;break e}}if(c>>>0<(a+1|0)>>>0){Jn(n,2,16541,m)|0;break}if(o>>>0<a>>>0){Jn(n,2,16634,g)|0;break}g=Yi(8)|0;i=e+116|0;f[i>>2]=g;if(!g){Jn(n,1,16782,v)|0;t=0;b=w;return t|0}v=Yi((f[y>>2]|0)*6|0)|0;r=f[i>>2]|0;f[r>>2]=v;if(!v){Jn(n,1,16782,E)|0;t=0;b=w;return t|0}l=f[y>>2]|0;d[r+4>>1]=l;s=f[r>>2]|0;i=0;do{d[s+(i*6|0)>>1]=i;d[s+(i*6|0)+2>>1]=0;E=i;i=i+1|0;d[s+(E*6|0)+4>>1]=i}while((i|0)!=(a|0));if(a>>>0<l>>>0){o=f[_>>2]|0;do{E=(d[o+(a*52|0)+48>>1]|0)==0;d[s+(a*6|0)>>1]=a;i=s+(a*6|0)+2|0;if(E){d[i>>1]=-1;d[s+(a*6|0)+4>>1]=-1}else{d[i>>1]=1;d[(f[r>>2]|0)+(a*6|0)+4>>1]=0}a=a+1|0}while(a>>>0<l>>>0)}}}while(0);f[e+52>>2]=0;f[e+44>>2]=0;f[e+96>>2]=f[t+18692>>2];t=1;b=w;return t|0}function Ot(e,t,r){e=e|0;t=t|0;r=r|0;return ba(f[e>>2]|0,t,r)|0}function Dt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;n=e+8|0;if(!(_o(f[n>>2]|0,52,r)|0)){r=0;return r|0}a=f[n>>2]|0;o=bo(a)|0;n=Eo(a)|0;if(o){s=0;i=1;while(1){if(!i)i=0;else i=(ku[f[n>>2]&63](e,t,r)|0)!=0;s=s+1|0;if((s|0)==(o|0))break;else{n=n+4|0;i=i&1}}wo(a);if(!i){r=0;return r|0}}else wo(a);r=aa(f[e>>2]|0,t,r)|0;return r|0}function Ft(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;n=e+8|0;if(!(_o(f[n>>2]|0,53,r)|0)){r=0;return r|0}if(!(Ea(f[e>>2]|0,t,r)|0)){r=0;return r|0}s=f[n>>2]|0;a=bo(s)|0;n=Eo(s)|0;if(!a)n=1;else{o=0;i=n;n=1;while(1){if(!n)n=0;else n=(ku[f[i>>2]&63](e,t,r)|0)!=0;n=n&1;o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}wo(s);r=n;return r|0}function Nt(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;i=e+4|0;if(!(_o(f[i>>2]|0,54,n)|0)){t=0;return t|0}o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](e,t,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){t=0;return t|0}}else wo(o);i=e+8|0;if(!(_o(f[i>>2]|0,55,n)|0)){t=0;return t|0}if(!(_o(f[i>>2]|0,56,n)|0)){t=0;return t|0}if(!(_o(f[i>>2]|0,57,n)|0)){t=0;return t|0}if((f[e+96>>2]|0)!=0?(_o(f[i>>2]|0,58,n)|0)==0:0){t=0;return t|0}if(!(_o(f[i>>2]|0,59,n)|0)){t=0;return t|0}o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](e,t,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){t=0;return t|0}}else wo(o);t=wa(f[e>>2]|0,t,r,n)|0;return t|0}function Ut(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;u=t+8|0;if(!(_o(f[u>>2]|0,52,n)|0)){e=0;return e|0}o=f[t+4>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){e=0;return e|0}}else wo(o);o=f[u>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){e=0;return e|0}}else wo(o);e=oa(e,f[t>>2]|0,r,n)|0;return e|0}function Bt(e,t,r,n,i,a,o,s,l,u,c){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;return la(f[e>>2]|0,t,r,n,i,a,o,s,l,u,c)|0}function zt(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;return xa(f[e>>2]|0,t,r,n,i,a)|0}function jt(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;return ua(f[e>>2]|0,t,r,n,i,a)|0}function Vt(e){e=e|0;var t=0,r=0,n=0;if(!e)return;ra(f[e>>2]|0);f[e>>2]=0;t=e+72|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+68|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+108|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}n=e+116|0;t=f[n>>2]|0;if(t){r=f[t>>2]|0;if(r){Ji(r);t=f[n>>2]|0;f[t>>2]=0}Ji(t);f[n>>2]=0}n=e+120|0;t=f[n>>2]|0;if(t){r=f[t+12>>2]|0;if(r){Ji(r);t=f[n>>2]|0;f[t+12>>2]=0}r=f[t+4>>2]|0;if(r){Ji(r);t=f[n>>2]|0;f[t+4>>2]=0}r=f[t+8>>2]|0;if(r){Ji(r);t=f[n>>2]|0;f[t+8>>2]=0}r=f[t>>2]|0;if(r){Ji(r);t=f[n>>2]|0;f[t>>2]=0}Ji(t);f[n>>2]=0}t=e+4|0;r=f[t>>2]|0;if(r){yo(r);f[t>>2]=0}t=e+8|0;r=f[t>>2]|0;if(r){yo(r);f[t>>2]=0}Ji(e);return}function Gt(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;return ca(f[e>>2]|0,t,r,n,i,a,o)|0}function Wt(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+16|0;if(!r){e=0;b=s;return e|0}Jn(n,2,16826,s)|0;if(!(ya(f[e>>2]|0,t,r,n,i)|0)){Jn(n,1,16303,s+8|0)|0;e=0;b=s;return e|0}o=e+108|0;if(!(Qt(r,o,n)|0)){e=0;b=s;return e|0}i=f[e+48>>2]|0;e:do{switch(i|0){case 16:{f[r+20>>2]=1;break}case 17:{f[r+20>>2]=2;break}case 18:{f[r+20>>2]=3;break}case 24:{f[r+20>>2]=4;break}default:{t=r+20|0;if((i|0)==12){f[t>>2]=5;break e}else{f[t>>2]=-1;break e}}}}while(0);a=e+120|0;t=f[a>>2]|0;do{if(t){if(f[t+12>>2]|0){Jt(r,o);break}Ji(f[t+4>>2]|0);Ji(f[(f[a>>2]|0)+8>>2]|0);Ji(f[f[a>>2]>>2]|0);t=f[a>>2]|0;i=f[t+12>>2]|0;if(i){Ji(i);t=f[a>>2]|0}Ji(t);f[a>>2]=0}}while(0);if(f[e+116>>2]|0)$t(r,o,n);t=f[o>>2]|0;if(!t){e=1;b=s;return e|0}f[r+28>>2]=t;f[r+32>>2]=f[e+112>>2];f[o>>2]=0;e=1;b=s;return e|0}function Xt(e){e=e|0;var t=0;t=qi(1,136)|0;if(!t)return t|0;if(!e){e=ta()|0;f[t>>2]=e}else{e=ha()|0;f[t>>2]=e}if(!e){Vt(t);t=0;return t|0}e=t+108|0;f[e>>2]=0;f[e+4>>2]=0;f[e+8>>2]=0;f[e+12>>2]=0;h[e+16>>0]=0;e=vo()|0;f[t+4>>2]=e;if(!e){Vt(t);t=0;return t|0}e=vo()|0;f[t+8>>2]=e;if(e)return t|0;Vt(t);t=0;return t|0}function Yt(e,t,r){e=e|0;t=t|0;r=r|0;da(f[e>>2]|0,t,r);return}function qt(e){e=e|0;return ga(f[e>>2]|0)|0}function Zt(e){e=e|0;return ma(f[e>>2]|0)|0}function Kt(e,t,r){e=e|0;t=t|0;r=r|0;return _a(f[e>>2]|0,t,r)|0}function Qt(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0;A=b;b=b+80|0;S=A+72|0;M=A+64|0;T=A+56|0;x=A+48|0;w=A+40|0;E=A+32|0;_=A+24|0;v=A+16|0;l=A+8|0;s=A;n=f[t+8>>2]|0;e:do{if(n){g=f[n>>2]|0;c=d[n+4>>1]|0;n=f[e+16>>2]|0;u=f[t+12>>2]|0;if((u|0)!=0?(f[u+12>>2]|0)!=0:0)t=p[u+18>>0]|0;else t=n;o=c<<16>>16==0;t:do{if(!o){a=0;r:while(1){i=a&65535;n=m[g+(i*6|0)>>1]|0;if(n>>>0>=t>>>0){i=15;break}n=d[g+(i*6|0)+4>>1]|0;switch(n<<16>>16){case 0:case-1:break;default:{n=(n&65535)+-1|0;if(n>>>0>=t>>>0){i=18;break r}}}a=a+1<<16>>16;if((a&65535)>=(c&65535))break t}if((i|0)==15){f[s>>2]=n;f[s+4>>2]=t;Jn(r,1,19343,s)|0;r=0;b=A;return r|0}else if((i|0)==18){f[l>>2]=n;f[l+4>>2]=t;Jn(r,1,19343,l)|0;r=0;b=A;return r|0}}}while(0);if(!t)n=u;else{t:do{if(!o)while(1){t=t+-1|0;n=0;do{if((m[g+((n&65535)*6|0)>>1]|0)==(t|0))break;n=n+1<<16>>16}while((n&65535)<(c&65535));if(n<<16>>16==c<<16>>16)break t;if(!t){n=u;break e}}}while(0);Jn(r,1,19380,v)|0;r=0;b=A;return r|0}}else n=f[t+12>>2]|0}while(0);if(!n){r=1;b=A;return r|0}y=f[n+12>>2]|0;if(!y){r=1;b=A;return r|0}u=h[n+18>>0]|0;v=u&255;g=u<<24>>24==0;if(g)n=1;else{a=e+16|0;t=0;o=0;n=1;do{t=m[y+(t<<2)>>1]|0;i=f[a>>2]|0;if(t>>>0>=i>>>0){f[_>>2]=t;f[_+4>>2]=i;Jn(r,1,19343,_)|0;n=0}o=o+1<<16>>16;t=o&65535}while(t>>>0<v>>>0)}c=qi(v,4)|0;if(!c){Jn(r,1,19413,E)|0;r=0;b=A;return r|0}if(!g){s=0;l=0;do{i=h[y+(s<<2)+3>>0]|0;a=i&255;do{if((i&255)<(u&255)){o=c+(a<<2)|0;t=h[y+(s<<2)+2>>0]|0;if((f[o>>2]|0)!=0&t<<24>>24==1){f[x>>2]=a;Jn(r,1,19486,x)|0;n=0;break}if(t<<24>>24!=0|i<<24>>24==0){f[o>>2]=1;break}else{f[T>>2]=s;f[T+4>>2]=a;Jn(r,1,19517,T)|0;n=0;break}}else{f[w>>2]=a;Jn(r,1,19430,w)|0;n=0}}while(0);l=l+1<<16>>16;s=l&65535}while(s>>>0<v>>>0);if(!g){t=0;i=0;do{if((f[c+(t<<2)>>2]|0)==0?(h[y+(t<<2)+2>>0]|0)!=0:0){f[M>>2]=t;Jn(r,1,19553,M)|0;n=0}i=i+1<<16>>16;t=i&65535}while(t>>>0<v>>>0)}}if(!n){Ji(c);r=0;b=A;return r|0}e:do{if(!((f[e+16>>2]|0)!=1|g)){n=0;t=0;while(1){t=t+1<<16>>16;if(!(f[c+(n<<2)>>2]|0))break;n=t&65535;if(n>>>0>=v>>>0)break e}f[S>>2]=n;Jn(r,2,19591,S)|0;if(!g){n=0;t=0;do{h[y+(n<<2)+2>>0]=1;h[y+(n<<2)+3>>0]=t;t=t+1<<16>>16;n=t&65535}while(n>>>0<v>>>0)}}}while(0);Ji(c);r=1;b=A;return r|0}function Jt(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0;w=t+12|0;t=f[w>>2]|0;s=f[t+8>>2]|0;u=f[t+4>>2]|0;g=f[t>>2]|0;v=f[t+12>>2]|0;t=h[t+18>>0]|0;y=e+24|0;_=f[y>>2]|0;b=t&255;E=Yi(b*52|0)|0;if(!E)return;l=t<<24>>24==0;if(!l){a=0;o=0;do{t=d[v+(a<<2)>>1]|0;if(!(h[v+(a<<2)+2>>0]|0)){t=t&65535;r=E+(a*52|0)|0;n=_+(t*52|0)|0;i=r+52|0;do{f[r>>2]=f[n>>2];r=r+4|0;n=n+4|0}while((r|0)<(i|0))}else{t=t&65535;r=E+((p[v+(a<<2)+3>>0]|0)*52|0)|0;n=_+(t*52|0)|0;i=r+52|0;do{f[r>>2]=f[n>>2];r=r+4|0;n=n+4|0}while((r|0)<(i|0))}i=Yi(ce(f[_+(t*52|0)+8>>2]<<2,f[_+(t*52|0)+12>>2]|0)|0)|0;f[E+(a*52|0)+44>>2]=i;if(!i){c=7;break}f[E+(a*52|0)+24>>2]=p[s+a>>0];f[E+(a*52|0)+32>>2]=p[u+a>>0];o=o+1<<16>>16;a=o&65535}while(a>>>0<b>>>0);if((c|0)==7){Ji(E);return}s=(m[(f[w>>2]|0)+16>>1]|0)+-1|0;if(!l){t=0;o=0;do{i=f[_+((m[v+(t<<2)>>1]|0)*52|0)+44>>2]|0;n=p[v+(t<<2)+3>>0]|0;a=ce(f[E+(n*52|0)+12>>2]|0,f[E+(n*52|0)+8>>2]|0)|0;if(!(h[v+(t<<2)+2>>0]|0)){t=f[E+(t*52|0)+44>>2]|0;if(a){r=0;do{f[t+(r<<2)>>2]=f[i+(r<<2)>>2];r=r+1|0}while((r|0)!=(a|0))}}else{t=f[E+(n*52|0)+44>>2]|0;if(a){r=0;do{c=f[i+(r<<2)>>2]|0;c=g+((ce((c|0)<0?0:(c|0)>(s|0)?s:c,b)|0)+n<<2)|0;f[t+(r<<2)>>2]=f[c>>2];r=r+1|0}while((r|0)!=(a|0))}}o=o+1<<16>>16;t=o&65535}while(t>>>0<b>>>0)}}r=e+16|0;n=f[r>>2]|0;if(n){t=0;i=0;do{t=f[_+(t*52|0)+44>>2]|0;if(t)Ji(t);i=i+1<<16>>16;t=i&65535}while(t>>>0<n>>>0)}Ji(_);f[y>>2]=E;f[r>>2]=b;Ji(f[(f[w>>2]|0)+4>>2]|0);Ji(f[(f[w>>2]|0)+8>>2]|0);Ji(f[f[w>>2]>>2]|0);t=f[w>>2]|0;r=f[t+12>>2]|0;if(r){Ji(r);t=f[w>>2]|0}Ji(t);f[w>>2]=0;return}function $t(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0;T=b;b=b+80|0;w=T+8|0;E=T;_=T+16|0;x=t+8|0;n=f[x>>2]|0;t=f[n>>2]|0;y=d[n+4>>1]|0;if(y<<16>>16){v=e+16|0;h=e+24|0;m=1;g=0;while(1){p=d[t+(g*6|0)>>1]|0;c=p&65535;e=f[v>>2]|0;e:do{if(c>>>0<e>>>0){n=d[t+(g*6|0)+4>>1]|0;switch(n<<16>>16){case-1:case 0:{d[(f[h>>2]|0)+(c*52|0)+48>>1]=d[t+(g*6|0)+2>>1]|0;break e}default:{}}s=(n&65535)+65535|0;u=s&65535;s=s&65535;if(s>>>0>=e>>>0){f[w>>2]=s;f[w+4>>2]=e;Jn(r,2,19302,w)|0;break}l=t+(g*6|0)+2|0;if((c|0)!=(s|0)?(d[l>>1]|0)==0:0){n=f[h>>2]|0;e=n+(c*52|0)|0;i=_;a=e;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));i=e;a=n+(s*52|0)|0;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));i=(f[h>>2]|0)+(s*52|0)|0;a=_;o=i+52|0;do{f[i>>2]=f[a>>2];i=i+4|0;a=a+4|0}while((i|0)<(o|0));if((g+1&65535)<(y&65535)){i=m;do{n=t+(i*6|0)|0;e=d[n>>1]|0;if(e<<16>>16!=p<<16>>16){if(e<<16>>16==u<<16>>16)d[n>>1]=p}else d[n>>1]=u;i=i+1|0}while((i&65535)<<16>>16!=y<<16>>16)}}d[(f[h>>2]|0)+(c*52|0)+48>>1]=d[l>>1]|0}else{f[E>>2]=c;f[E+4>>2]=e;Jn(r,2,19262,E)|0}}while(0);g=g+1|0;if((g&65535)<<16>>16==y<<16>>16)break;else m=m+1|0}t=f[x>>2]|0;n=t;t=f[t>>2]|0}if(!t){w=n;Ji(w);f[x>>2]=0;b=T;return}else{Ji(t);w=f[x>>2]|0;Ji(w);f[x>>2]=0;b=T;return}}function er(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0;I=b;b=b+192|0;T=I+152|0;x=I+144|0;w=I+136|0;E=I+128|0;_=I+120|0;k=I+88|0;v=I+80|0;m=I+64|0;p=I+48|0;L=I+40|0;M=I+32|0;P=I+24|0;y=I+16|0;g=I+8|0;h=I+176|0;d=I+168|0;R=I+156|0;n=qi(1,1024)|0;if(!n){Jn(r,1,17098,I)|0;C=0;b=I;return C|0}c=h+4|0;S=R+4|0;A=e+100|0;u=1024;e:while(1){if((Gn(t,h,8,r)|0)!=8)break;while(1){wn(h,R,4);wn(c,S,4);switch(f[R>>2]|0){case 0:{i=qn(t)|0;l=B;if((l|0)>0|(l|0)==0&i>>>0>4294967287){C=6;break e}f[R>>2]=i+8;s=8;break}case 1:{if((Gn(t,h,8,r)|0)!=8)break e;wn(h,d,4);if(f[d>>2]|0){C=10;break e}wn(c,R,4);s=16;break}default:s=8}a=f[S>>2]|0;if((a|0)==1785737827){C=13;break e}i=f[R>>2]|0;if(!i){C=17;break e}if(i>>>0<s>>>0){C=19;break e}if((a|0)==1783636e3){o=1084;a=s;C=22;break}if((a|0)==1718909296){o=1092;a=s;C=22;break}l=(a|0)==1785737832;t:do{if((a|0)!=1768449138)if((a|0)!=1668246642)if((a|0)!=1651532643)if((a|0)!=1885564018)if((a|0)!=1668112752){o=(a|0)==1667523942?1148:0;i=i-s|0;if((a|0)<1785737832)switch(a|0){case 1667523942:{C=30;break t}default:{}}else switch(a|0){case 1785737832:{C=30;break t}default:{}}a=f[A>>2]|0;if(!(a&1)){C=45;break e}if(!(a&2)){C=47;break e}f[A>>2]=a|2147483647;l=Zn(t,i,0,r)|0;if(!((l|0)==(i|0)&(B|0)==0)){C=50;break e}}else{o=1140;C=28}else{o=1132;C=28}else{o=1124;C=28}else{o=1116;C=28}else{o=1108;C=28}}while(0);if((C|0)==28){i=i-s|0;C=30}if((C|0)==30){C=0;if(l){o=1100;break}f[p>>2]=a>>>24;f[p+4>>2]=a>>>16&255;f[p+8>>2]=a>>>8&255;f[p+12>>2]=a&255;Jn(r,2,17282,p)|0;if(f[A>>2]&4)break;l=f[S>>2]|0;f[m>>2]=l>>>24;f[m+4>>2]=l>>>16&255;f[m+8>>2]=l>>>8&255;f[m+12>>2]=l&255;Jn(r,2,17333,m)|0;f[A>>2]=f[A>>2]|2147483647;l=Zn(t,i,0,r)|0;if(!((l|0)==(i|0)&(B|0)==0)){C=33;break e}}if((Gn(t,h,8,r)|0)!=8)break e}if((C|0)==22){C=0;i=i-a|0}l=qn(t)|0;s=B;if(0>(s|0)|0==(s|0)&i>>>0>l>>>0){C=35;break}if(i>>>0>u>>>0){a=Qi(n,i)|0;if(!a){C=38;break}else{n=a;a=i}}else a=u;if((Gn(t,n,i,r)|0)!=(i|0)){C=40;break}if(!(Fu[f[o+4>>2]&63](e,n,i,r)|0)){C=43;break}else u=a}switch(C|0){case 6:{Jn(r,1,17148,g)|0;break}case 10:{Jn(r,1,17148,y)|0;break}case 13:{i=f[A>>2]|0;if(!(i&4)){Jn(r,1,17190,P)|0;Ji(n);C=0;b=I;return C|0}else{f[A>>2]=i|8;Ji(n);C=1;b=I;return C|0}}case 17:{Jn(r,1,17218,M)|0;Ji(n);C=0;b=I;return C|0}case 19:{f[L>>2]=i;f[L+4>>2]=a;Jn(r,1,17256,L)|0;Ji(n);C=0;b=I;return C|0}case 33:{Jn(r,1,17399,v)|0;Ji(n);C=0;b=I;return C|0}case 35:{P=f[R>>2]|0;L=f[S>>2]|0;C=qn(t)|0;f[k>>2]=P;f[k+4>>2]=L>>>24;f[k+8>>2]=L>>>16&255;f[k+12>>2]=L>>>8&255;f[k+16>>2]=L&255;f[k+20>>2]=i;f[k+24>>2]=C;Jn(r,1,17449,k)|0;Ji(n);C=0;b=I;return C|0}case 38:{Ji(n);Jn(r,1,17525,_)|0;C=0;b=I;return C|0}case 40:{Jn(r,1,17567,E)|0;Ji(n);C=0;b=I;return C|0}case 43:{Ji(n);C=0;b=I;return C|0}case 45:{Jn(r,1,17616,w)|0;Ji(n);C=0;b=I;return C|0}case 47:{Jn(r,1,17686,x)|0;Ji(n);C=0;b=I;return C|0}case 50:{Jn(r,1,17399,T)|0;Ji(n);C=0;b=I;return C|0}}Ji(n);C=1;b=I;return C|0}function tr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;o=b;b=b+32|0;a=o+24|0;n=Yn(t)|0;i=B;e=e+80|0;s=e;s=zl(n|0,i|0,f[s>>2]|0,f[s+4>>2]|0)|0;En(a,s,4);En(a+4|0,1785737827,4);if(!(Kn(t,f[e>>2]|0,f[e+4>>2]|0,r)|0)){Jn(r,1,17067,o)|0;s=0;b=o;return s|0}if((Wn(t,a,8,r)|0)!=8){Jn(r,1,17067,o+8|0)|0;s=0;b=o;return s|0}if(Kn(t,n,i,r)|0){s=1;b=o;return s|0}Jn(r,1,17067,o+16|0)|0;s=0;b=o;return s|0}function rr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;r=((f[e>>2]|0)!=0?(f[e+104>>2]|f[e+100>>2]|0)==0:0)&(f[e+8>>2]|0)!=0&(f[e+4>>2]|0)!=0&(f[e+64>>2]|0)!=0&(f[e+16>>2]|0)!=0&(f[e+12>>2]|0)!=0&1;n=f[e+20>>2]|0;if(!n){a=r;e=e+40|0;e=f[e>>2]|0;e=e+-1|0;e=e>>>0<2;e=e&1;t=Qn(t)|0;t=t&a;e=t&e;return e|0}i=f[e+72>>2]|0;a=0;do{r=(f[i+(a*12|0)+8>>2]&126)>>>0<38&r;a=a+1|0}while(a>>>0<n>>>0);e=e+40|0;e=f[e>>2]|0;e=e+-1|0;e=e>>>0<2;e=e&1;t=Qn(t)|0;t=t&r;e=t&e;return e|0}function nr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;e=b;b=b+16|0;n=e;En(n,12,4);En(n+4|0,1783636e3,4);En(n+8|0,218793738,4);r=(Wn(t,n,12,r)|0)==12&1;b=e;return r|0}function ir(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;l=u+8|0;i=e+64|0;o=(f[i>>2]<<2)+16|0;s=qi(1,o)|0;if(!s){Jn(r,1,16987,u)|0;l=0;b=u;return l|0}En(s,o,4);En(s+4|0,1718909296,4);En(s+8|0,f[e+56>>2]|0,4);En(s+12|0,f[e+60>>2]|0,4);a=s+16|0;if(f[i>>2]|0){e=e+68|0;n=0;do{En(a,f[(f[e>>2]|0)+(n<<2)>>2]|0,4);n=n+1|0}while(n>>>0<(f[i>>2]|0)>>>0)}e=(Wn(t,s,o,r)|0)==(o|0);if(!e)Jn(r,1,17026,l)|0;Ji(s);l=e&1;b=u;return l|0}function ar(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0;m=b;b=b+80|0;d=m+16|0;c=m+8|0;l=m;i=m+24|0;u=m+72|0;n=i;a=n+48|0;do{f[n>>2]=0;n=n+4|0}while((n|0)<(a|0));p=(f[e+24>>2]|0)==255;f[i>>2]=2;n=i+12|0;if(p){f[n>>2]=3;f[i+24>>2]=4;n=3}else{f[n>>2]=4;n=2}if(!(f[e+116>>2]|0))p=n;else{f[i+(n*12|0)>>2]=5;p=n+1|0}En(u+4|0,1785737832,4);o=0;s=i;n=8;while(1){a=s+8|0;g=Nu[f[s>>2]&7](e,a)|0;f[s+4>>2]=g;if(!g){h=8;break}n=(f[a>>2]|0)+n|0;o=o+1|0;if((o|0)>=(p|0))break;else s=s+12|0}if((h|0)==8){Jn(r,1,16901,l)|0;a=0;while(1){n=f[i+4>>2]|0;if(n)Ji(n);a=a+1|0;if((a|0)>=(p|0)){n=0;break}else i=i+12|0}b=m;return n|0}En(u,n,4);e:do{if((Wn(t,u,8,r)|0)==8){n=0;a=i;while(1){g=a+8|0;h=Wn(t,f[a+4>>2]|0,f[g>>2]|0,r)|0;if((h|0)!=(f[g>>2]|0))break;n=n+1|0;if((n|0)>=(p|0)){n=1;break e}else a=a+12|0}Jn(r,1,16944,d)|0;n=0}else{Jn(r,1,16944,c)|0;n=0}}while(0);o=0;while(1){a=f[i+4>>2]|0;if(a)Ji(a);o=o+1|0;if((o|0)>=(p|0))break;else i=i+12|0}b=m;return n|0}function or(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=Yn(t)|0;e=e+88|0;f[e>>2]=n;f[e+4>>2]=B;t=Zn(t,24,0,r)|0;return(t|0)==24&(B|0)==0&1|0}function sr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=Yn(t)|0;e=e+80|0;f[e>>2]=n;f[e+4>>2]=B;t=Zn(t,8,0,r)|0;return(t|0)==8&(B|0)==0&1|0}function lr(e,t){e=e|0;t=t|0;var r=0;r=qi(1,22)|0;if(!r){t=0;return t|0}En(r,22,4);En(r+4|0,1768449138,4);En(r+8|0,f[e+16>>2]|0,4);En(r+12|0,f[e+12>>2]|0,4);En(r+16|0,f[e+20>>2]|0,2);En(r+18|0,f[e+24>>2]|0,1);En(r+19|0,f[e+28>>2]|0,1);En(r+20|0,f[e+32>>2]|0,1);En(r+21|0,f[e+36>>2]|0,1);f[t>>2]=22;t=r;return t|0}function ur(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0;i=e+20|0;a=(f[i>>2]|0)+8|0;o=qi(1,a)|0;if(!o){t=0;return t|0}En(o,a,4);En(o+4|0,1651532643,4);if(f[i>>2]|0){e=e+72|0;r=0;n=o+8|0;while(1){En(n,f[(f[e>>2]|0)+(r*12|0)+8>>2]|0,1);r=r+1|0;if(r>>>0>=(f[i>>2]|0)>>>0)break;else n=n+1|0}}f[t>>2]=a;t=o;return t|0}function cr(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0;r=e+40|0;switch(f[r>>2]|0){case 1:{s=15;break}case 2:{s=(f[e+112>>2]|0)+11|0;break}default:{t=0;return t|0}}o=qi(1,s)|0;if(!o){t=0;return t|0}En(o,s,4);En(o+4|0,1668246642,4);En(o+8|0,f[r>>2]|0,1);En(o+9|0,f[e+52>>2]|0,1);En(o+10|0,f[e+44>>2]|0,1);i=o+11|0;switch(f[r>>2]|0){case 1:{En(i,f[e+48>>2]|0,4);break}case 2:{a=e+112|0;if(f[a>>2]|0){e=e+108|0;n=0;r=i;while(1){En(r,p[(f[e>>2]|0)+n>>0]|0,1);n=n+1|0;if(n>>>0>=(f[a>>2]|0)>>>0)break;else r=r+1|0}}break}default:{}}f[t>>2]=s;t=o;return t|0}function hr(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0;a=e+116|0;o=((m[(f[a>>2]|0)+4>>1]|0)*6|0)+10|0;s=Yi(o)|0;if(!s){t=0;return t|0}En(s,o,4);En(s+4|0,1667523942,4);En(s+8|0,m[(f[a>>2]|0)+4>>1]|0,2);e=f[a>>2]|0;if(d[e+4>>1]|0){n=0;r=0;i=s+10|0;while(1){En(i,m[(f[e>>2]|0)+(n*6|0)>>1]|0,2);En(i+2|0,m[(f[f[a>>2]>>2]|0)+(n*6|0)+2>>1]|0,2);En(i+4|0,m[(f[f[a>>2]>>2]|0)+(n*6|0)+4>>1]|0,2);r=r+1<<16>>16;e=f[a>>2]|0;if((r&65535)>=(m[e+4>>1]|0))break;else{n=r&65535;i=i+6|0}}}f[t>>2]=o;t=s;return t|0}function dr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;a=b;b=b+32|0;i=a+16|0;if((r|0)!=14){Jn(n,1,18507,a)|0;i=0;b=a;return i|0}wn(t,e+16|0,4);wn(t+4|0,e+12|0,4);r=e+20|0;wn(t+8|0,r,2);r=qi(f[r>>2]|0,12)|0;f[e+72>>2]=r;if(!r){Jn(n,1,18540,a+8|0)|0;i=0;b=a;return i|0}wn(t+10|0,e+24|0,1);r=e+28|0;wn(t+11|0,r,1);r=f[r>>2]|0;if((r|0)!=7){f[i>>2]=r;Jn(n,4,18589,i)|0}wn(t+12|0,e+32|0,1);wn(t+13|0,e+36|0,1);i=1;b=a;return i|0}function fr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0;x=b;b=b+80|0;o=x+40|0;y=x+32|0;l=x+24|0;s=x+16|0;_=x+72|0;v=x+68|0;p=x+64|0;m=x+60|0;c=x+56|0;g=x+52|0;d=x+48|0;u=x+44|0;if(r>>>0<3){Jn(n,1,18180,x)|0;w=0;b=x;return w|0}E=e+108|0;w=e+124|0;if(h[w>>0]|0){Jn(n,4,18212,x+8|0)|0;w=1;b=x;return w|0}a=e+40|0;wn(t,a,1);wn(t+1|0,e+52|0,1);wn(t+2|0,e+44|0,1);i=t+3|0;a=f[a>>2]|0;switch(a|0){case 1:{if(r>>>0<7){f[s>>2]=r;Jn(n,1,18321,s)|0;w=0;b=x;return w|0}a=e+48|0;if(r>>>0>7?(f[a>>2]|0)!=14:0){f[l>>2]=r;Jn(n,2,18321,l)|0}wn(i,a,4);if((f[a>>2]|0)==14){i=Yi(36)|0;f[i>>2]=14;f[d>>2]=0;f[c>>2]=0;f[p>>2]=0;f[g>>2]=0;f[m>>2]=0;f[v>>2]=0;f[u>>2]=4470064;a=i+4|0;f[a>>2]=1145390592;switch(r|0){case 35:{wn(t+7|0,v,4);wn(t+11|0,p,4);wn(t+15|0,m,4);wn(t+19|0,c,4);wn(t+23|0,g,4);wn(t+27|0,d,4);wn(t+31|0,u,4);f[a>>2]=0;break}case 7:break;default:{f[y>>2]=r;Jn(n,2,18357,y)|0}}f[i+8>>2]=f[v>>2];f[i+16>>2]=f[m>>2];f[i+24>>2]=f[g>>2];f[i+12>>2]=f[p>>2];f[i+20>>2]=f[c>>2];f[i+28>>2]=f[d>>2];f[i+32>>2]=f[u>>2];f[E>>2]=i;f[e+112>>2]=0}h[w>>0]=1;w=1;b=x;return w|0}case 2:{o=r+-3|0;a=e+112|0;f[a>>2]=o;e=qi(1,o)|0;f[E>>2]=e;if(!e){f[a>>2]=0;w=0;b=x;return w|0}if((r|0)>3){a=0;while(1){wn(i,_,1);h[(f[E>>2]|0)+a>>0]=f[_>>2];a=a+1|0;if((a|0)==(o|0))break;else i=i+1|0}}h[w>>0]=1;w=1;b=x;return w|0}default:{if(a>>>0<=2){w=1;b=x;return w|0}f[o>>2]=a;Jn(n,4,18401,o)|0;w=1;b=x;return w|0}}return 0}function pr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+16|0;a=s;i=f[e+24>>2]|0;if((i|0)!=255){f[a>>2]=i;Jn(n,2,18034,a)|0}o=e+20|0;if((f[o>>2]|0)!=(r|0)){Jn(n,1,18148,s+8|0)|0;o=0;b=s;return o|0}if(!r){o=1;b=s;return o|0}a=e+72|0;i=0;while(1){wn(t,(f[a>>2]|0)+(i*12|0)+8|0,1);i=i+1|0;if(i>>>0>=(f[o>>2]|0)>>>0){t=1;break}else t=t+1|0}b=s;return t|0}function mr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,m=0,g=0;g=b;b=b+16|0;i=g;m=g+12|0;a=e+120|0;if(r>>>0<3|(f[a>>2]|0)!=0){r=0;b=g;return r|0}wn(t,m,2);o=f[m>>2]|0;c=o&65535;if((c+-1|0)>>>0>1023){f[i>>2]=c;Jn(n,1,17951,i)|0;r=0;b=g;return r|0}wn(t+2|0,m,1);u=f[m>>2]&65535;if(!u){Jn(n,1,17989,g+8|0)|0;r=0;b=g;return r|0}if((u+3|0)>>>0>r>>>0){r=0;b=g;return r|0}i=Yi(ce(c<<2,u)|0)|0;if(!i){r=0;b=g;return r|0}l=Yi(u)|0;if(!l){Ji(i);r=0;b=g;return r|0}s=Yi(u)|0;if(!s){Ji(i);Ji(l);r=0;b=g;return r|0}e=Yi(20)|0;if(!e){Ji(i);Ji(l);Ji(s);r=0;b=g;return r|0}f[e+4>>2]=s;f[e+8>>2]=l;f[e>>2]=i;d[e+16>>1]=o;h[e+18>>0]=f[m>>2];f[e+12>>2]=0;f[a>>2]=e;e=t+3|0;n=0;a=0;do{wn(e,m,1);e=e+1|0;h[l+n>>0]=(f[m>>2]&127)+1;h[s+n>>0]=(f[m>>2]|0)>>>7&1;a=a+1<<16>>16;n=a&65535}while(n>>>0<u>>>0);if(!c){r=1;b=g;return r|0}n=0;e:while(1){o=0;a=i;s=0;while(1){i=((p[l+o>>0]|0)+7|0)>>>3;i=i>>>0>4?4:i;if((e-t+i|0)>(r|0)){e=0;i=22;break e}wn(e,m,i);e=e+i|0;f[a>>2]=f[m>>2];i=a+4|0;s=s+1<<16>>16;o=s&65535;if(o>>>0>=u>>>0)break;else a=i}n=n+1<<16>>16;if((n&65535)>>>0>=c>>>0){e=1;i=22;break}}if((i|0)==22){b=g;return e|0}return 0}function gr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;o=s+20|0;a=e+120|0;e=f[a>>2]|0;if(!e){Jn(n,1,17841,s)|0;o=0;b=s;return o|0}if(f[e+12>>2]|0){Jn(n,1,17887,s+8|0)|0;o=0;b=s;return o|0}i=h[e+18>>0]|0;e=(i&255)<<2;if(e>>>0>r>>>0){Jn(n,1,17918,s+16|0)|0;o=0;b=s;return o|0}n=Yi(e)|0;if(!n){o=0;b=s;return o|0}if(i<<24>>24){e=t;r=0;while(1){wn(e,o,2);d[n+(r<<2)>>1]=f[o>>2];wn(e+2|0,o,1);h[n+(r<<2)+2>>0]=f[o>>2];wn(e+3|0,o,1);h[n+(r<<2)+3>>0]=f[o>>2];r=r+1|0;if((r&255)<<24>>24==i<<24>>24)break;else e=e+4|0}}f[(f[a>>2]|0)+12>>2]=n;o=1;b=s;return o|0}function vr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;o=s+20|0;a=e+116|0;if(f[a>>2]|0){o=0;b=s;return o|0}if(r>>>0<2){Jn(n,1,17747,s)|0;o=0;b=s;return o|0}wn(t,o,2);e=f[o>>2]|0;i=e&65535;if(!i){Jn(n,1,17780,s+8|0)|0;o=0;b=s;return o|0}if(((i*6|0)+2|0)>>>0>r>>>0){Jn(n,1,17747,s+16|0)|0;o=0;b=s;return o|0}r=Yi(e*6|0)|0;if(!r){o=0;b=s;return o|0}e=Yi(8)|0;f[a>>2]=e;if(!e){Ji(r);o=0;b=s;return o|0}f[e>>2]=r;n=f[o>>2]&65535;d[e+4>>1]=n;if(!(n<<16>>16)){o=1;b=s;return o|0}else{i=0;e=t}do{t=i&65535;wn(e+2|0,o,2);d[r+(t*6|0)>>1]=f[o>>2];wn(e+4|0,o,2);e=e+6|0;d[r+(t*6|0)+2>>1]=f[o>>2];wn(e,o,2);d[r+(t*6|0)+4>>1]=f[o>>2];i=i+1<<16>>16}while((i&65535)<(m[(f[a>>2]|0)+4>>1]|0));e=1;b=s;return e|0}function yr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;a=b;b=b+32|0;i=a+20|0;e=e+100|0;if(f[e>>2]|0){Jn(n,1,19130,a)|0;n=0;b=a;return n|0}if((r|0)!=4){Jn(n,1,19184,a+8|0)|0;n=0;b=a;return n|0}wn(t,i,4);if((f[i>>2]|0)==218793738){f[e>>2]=f[e>>2]|1;n=1;b=a;return n|0}else{Jn(n,1,19218,a+16|0)|0;n=0;b=a;return n|0}return 0}function _r(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+32|0;a=s+24|0;o=e+100|0;if((f[o>>2]|0)!=1){Jn(n,1,19011,s)|0;o=0;b=s;return o|0}if(r>>>0<8){Jn(n,1,19061,s+8|0)|0;o=0;b=s;return o|0}wn(t,e+56|0,4);wn(t+4|0,e+60|0,4);t=t+8|0;r=r+-8|0;if(r&3){Jn(n,1,19061,s+16|0)|0;o=0;b=s;return o|0}r=r>>>2;i=e+64|0;f[i>>2]=r;if(r){r=qi(r,4)|0;f[e+68>>2]=r;if(!r){Jn(n,1,19097,a)|0;o=0;b=s;return o|0}if(f[i>>2]|0){e=e+68|0;r=0;while(1){wn(t,(f[e>>2]|0)+(r<<2)|0,4);r=r+1|0;if(r>>>0>=(f[i>>2]|0)>>>0)break;else t=t+4|0}}}f[o>>2]=f[o>>2]|2;o=1;b=s;return o|0}function br(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0;S=b;b=b+96|0;T=S+72|0;v=S+64|0;g=S+56|0;m=S+48|0;w=S+40|0;E=S+32|0;_=S+24|0;y=S+16|0;p=S+8|0;h=S+80|0;d=S+76|0;x=e+100|0;if(!(f[x>>2]&2)){Jn(n,1,18679,S)|0;M=0;b=S;return M|0}c=e+104|0;f[c>>2]=0;do{if(r){l=t;t=0;e:while(1){if(r>>>0<8){M=6;break}wn(l,h,4);i=f[h>>2]|0;wn(l+4|0,h,4);s=f[h>>2]|0;switch(i|0){case 0:{M=14;break e}case 1:{if(r>>>0<16){M=9;break e}wn(l+8|0,d,4);if(f[d>>2]|0){M=11;break e}wn(l+12|0,h,4);i=f[h>>2]|0;if(!i){M=13;break e}else a=16;break}default:a=8}if(i>>>0<a>>>0){M=16;break}if(r>>>0<i>>>0){M=19;break}o=(s|0)==1768449138;if(!o)if((s|0)!=1668246642)if((s|0)!=1651532643)if((s|0)!=1885564018)if((s|0)!=1668112752)if((s|0)==1667523942){u=1148;M=26}else f[c>>2]=f[c>>2]|2147483647;else{u=1140;M=26}else{u=1132;M=26}else{u=1124;M=26}else{u=1116;M=26}else{u=1108;M=26}if((M|0)==26?(M=0,(Fu[f[u+4>>2]&63](e,l+a|0,i-a|0,n)|0)==0):0){t=0;M=32;break}t=o?1:t;if((r|0)==(i|0)){M=29;break}else{l=l+i|0;r=r-i|0}}if((M|0)==6)Jn(n,1,18724,p)|0;else if((M|0)==9)Jn(n,1,18764,y)|0;else if((M|0)==11)Jn(n,1,17148,_)|0;else if((M|0)==13)Jn(n,1,17218,E)|0;else if((M|0)==14)Jn(n,1,17218,w)|0;else if((M|0)==16)Jn(n,1,18808,m)|0;else if((M|0)==19){Jn(n,1,18880,v)|0;M=0;b=S;return M|0}else if((M|0)==29){if(!t)break;f[x>>2]=f[x>>2]|4;M=1;b=S;return M|0}else if((M|0)==32){b=S;return t|0}Jn(n,1,18837,g)|0;M=0;b=S;return M|0}}while(0);Jn(n,1,18952,T)|0;M=0;b=S;return M|0}function Er(){return 8}function wr(){return 32}function xr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!n)return;else i=0;do{c=e+(i<<2)|0;s=f[c>>2]|0;l=t+(i<<2)|0;o=f[l>>2]|0;a=r+(i<<2)|0;u=f[a>>2]|0;f[c>>2]=(o<<1)+s+u>>2;f[l>>2]=u-o;f[a>>2]=s-o;i=i+1|0}while((i|0)!=(n|0));return}function Tr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!n)return;else i=0;do{u=e+(i<<2)|0;l=t+(i<<2)|0;o=f[l>>2]|0;a=r+(i<<2)|0;c=f[a>>2]|0;s=(f[u>>2]|0)-(c+o>>2)|0;f[u>>2]=s+c;f[l>>2]=s;f[a>>2]=s+o;i=i+1|0}while((i|0)!=(n|0));return}function Mr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0;if(!n)return;else i=0;do{p=e+(i<<2)|0;b=f[p>>2]|0;u=t+(i<<2)|0;_=f[u>>2]|0;a=r+(i<<2)|0;y=f[a>>2]|0;l=((b|0)<0)<<31>>31;g=Jl(b|0,l|0,2449,0)|0;g=Wl(g|0,B|0,4096,0)|0;g=Xl(g|0,B|0,13)|0;s=((_|0)<0)<<31>>31;v=Jl(_|0,s|0,4809,0)|0;v=Wl(v|0,B|0,4096,0)|0;v=Xl(v|0,B|0,13)|0;o=((y|0)<0)<<31>>31;m=Jl(y|0,o|0,934,0)|0;m=Wl(m|0,B|0,4096,0)|0;m=Xl(m|0,B|0,13)|0;c=Jl(b|0,l|0,1382,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=Jl(_|0,s|0,2714,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=Xl(h|0,B|0,13)|0;d=Gl(y|0,o|0,12)|0;d=Wl(d|0,B|0,4096,0)|0;d=Xl(d|0,B|0,13)|0;l=Gl(b|0,l|0,12)|0;l=Wl(l|0,B|0,4096,0)|0;l=Xl(l|0,B|0,13)|0;s=Jl(_|0,s|0,3430,0)|0;s=Wl(s|0,B|0,4096,0)|0;s=Xl(s|0,B|0,13)|0;o=Jl(y|0,o|0,666,0)|0;o=Wl(o|0,B|0,4096,0)|0;o=Xl(o|0,B|0,13)|0;f[p>>2]=v+g+m;f[u>>2]=d-(h+c);f[a>>2]=l-s-o;i=i+1|0}while((i|0)!=(n|0));return}function Sr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0.0,s=0.0,l=0,u=0.0,c=0;if(!n)return;else i=0;do{c=e+(i<<2)|0;s=+v[c>>2];l=t+(i<<2)|0;o=+v[l>>2];a=r+(i<<2)|0;u=+v[a>>2];v[c>>2]=s+u*1.4019999504089355;v[l>>2]=s-o*.3441300094127655-u*.714139997959137;v[a>>2]=s+o*1.7719999551773071;i=i+1|0}while((i|0)!=(n|0));return}function Ar(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;a=ce(n,n)|0;d=Yi(a+n<<2)|0;if(!d){n=0;return n|0}if(a){o=0;i=e;while(1){f[d+(o+n<<2)>>2]=~~(+v[i>>2]*8192.0);o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}if(t){c=(n|0)==0;h=0;do{if(!c){i=0;do{f[d+(i<<2)>>2]=f[f[r+(i<<2)>>2]>>2];i=i+1|0}while((i|0)!=(n|0));if(!c){e=0;l=d;do{l=l+(n<<2)|0;a=r+(e<<2)|0;i=f[a>>2]|0;f[i>>2]=0;o=0;s=0;u=l;while(1){p=f[u>>2]|0;m=f[d+(s<<2)>>2]|0;p=Jl(m|0,((m|0)<0)<<31>>31|0,p|0,((p|0)<0)<<31>>31|0)|0;p=Wl(p|0,B|0,4096,0)|0;p=Xl(p|0,B|0,13)|0;o=p+o|0;f[i>>2]=o;s=s+1|0;if((s|0)==(n|0))break;else u=u+4|0}f[a>>2]=i+4;e=e+1|0}while((e|0)!=(n|0))}}h=h+1|0}while((h|0)!=(t|0))}Ji(d);m=1;return m|0}function Rr(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;c=Yi(n<<3)|0;if(!c){n=0;return n|0}if(t){h=(n|0)==0;d=0;do{if(!h){i=0;do{f[c+(i<<2)>>2]=f[f[r+(i<<2)>>2]>>2];i=i+1|0}while((i|0)!=(n|0));if(!h){l=0;u=e;while(1){i=c+(l+n<<2)|0;v[i>>2]=0.0;a=0.0;o=0;s=u;while(1){a=a+ +v[s>>2]*+v[c+(o<<2)>>2];v[i>>2]=a;o=o+1|0;if((o|0)==(n|0))break;else s=s+4|0}o=r+(l<<2)|0;s=f[o>>2]|0;f[o>>2]=s+4;v[s>>2]=a;l=l+1|0;if((l|0)==(n|0))break;else u=u+(n<<2)|0}}}d=d+1|0}while((d|0)!=(t|0))}Ji(c);n=1;return n|0}function kr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0.0,i=0,a=0,o=0,s=0,l=0.0;if(!t)return;else s=0;do{o=e+(s<<3)|0;y[o>>3]=0.0;n=0.0;i=0;a=s;while(1){l=+v[r+(a<<2)>>2];n=n+l*l;i=i+1|0;if((i|0)==(t|0))break;else a=a+t|0}l=+J(+n);y[o>>3]=l;s=s+1|0}while((s|0)!=(t|0));return}function Pr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0;L=b;b=b+32|0;A=L+28|0;w=L+24|0;x=L+20|0;T=L+16|0;M=L+12|0;S=L+8|0;s=L+4|0;l=L;n=t+76|0;k=f[n>>2]|0;R=k+(r*5640|0)+420|0;P=(f[R>>2]|0)+1|0;u=e+16|0;E=Yi((f[u>>2]|0)*528|0)|0;if(!E){P=0;b=L;return P|0}_=Yi(f[u>>2]<<2)|0;if(!_){Ji(E);P=0;b=L;return P|0}n=Dr(e,f[n>>2]|0,r)|0;if(!n){Ji(E);Ji(_);P=0;b=L;return P|0}i=f[u>>2]|0;if(i){a=0;o=E;while(1){f[_+(a<<2)>>2]=o;a=a+1|0;if(a>>>0>=i>>>0)break;else o=o+528|0}}Fr(e,t,r,x,T,M,S,s,l,w,A,_);v=f[w>>2]|0;m=ce(f[u>>2]|0,v)|0;g=ce(f[A>>2]|0,m)|0;y=k+(r*5640|0)+8|0;p=qi(ce((f[y>>2]|0)+1|0,g)|0,2)|0;a=n+4|0;f[a>>2]=p;if(!p){Ji(E);Ji(_);i=f[a>>2]|0;if(i){Ji(i);f[a>>2]=0}if(P){e=n;c=0;while(1){u=e+196|0;i=f[u>>2]|0;if(i){t=e+192|0;a=f[t>>2]|0;if(a){l=0;while(1){o=i+12|0;s=f[o>>2]|0;if(s){Ji(s);f[o>>2]=0;a=f[t>>2]|0}l=l+1|0;if(l>>>0>=a>>>0)break;else i=i+16|0}i=f[u>>2]|0}Ji(i);f[u>>2]=0}c=c+1|0;if((c|0)==(P|0))break;else e=e+232|0}}Ji(n);P=0;b=L;return P|0}i=f[n+196>>2]|0;p=f[e+24>>2]|0;f[n+200>>2]=f[x>>2];f[n+204>>2]=f[M>>2];f[n+208>>2]=f[T>>2];f[n+212>>2]=f[S>>2];f[n+20>>2]=1;f[n+16>>2]=v;f[n+12>>2]=m;f[n+8>>2]=g;u=f[n+192>>2]|0;if(u){e=0;t=p;while(1){o=f[i+12>>2]|0;a=f[_+(e<<2)>>2]|0;f[i>>2]=f[t>>2];f[i+4>>2]=f[t+4>>2];l=f[i+8>>2]|0;if(l){s=0;while(1){f[o>>2]=f[a>>2];f[o+4>>2]=f[a+4>>2];f[o+8>>2]=f[a+8>>2];f[o+12>>2]=f[a+12>>2];s=s+1|0;if(s>>>0>=l>>>0)break;else{a=a+16|0;o=o+16|0}}}e=e+1|0;if(e>>>0>=u>>>0)break;else{i=i+16|0;t=t+52|0}}}if(P>>>0>1){u=n;d=1;do{i=f[u+428>>2]|0;f[u+432>>2]=f[x>>2];f[u+436>>2]=f[M>>2];f[u+440>>2]=f[T>>2];f[u+444>>2]=f[S>>2];f[u+252>>2]=1;f[u+248>>2]=v;f[u+244>>2]=m;f[u+240>>2]=g;e=f[u+424>>2]|0;if(e){c=0;t=p;while(1){o=f[i+12>>2]|0;a=f[_+(c<<2)>>2]|0;f[i>>2]=f[t>>2];f[i+4>>2]=f[t+4>>2];l=f[i+8>>2]|0;if(l){s=0;while(1){f[o>>2]=f[a>>2];f[o+4>>2]=f[a+4>>2];f[o+8>>2]=f[a+8>>2];f[o+12>>2]=f[a+12>>2];s=s+1|0;if(s>>>0>=l>>>0)break;else{a=a+16|0;o=o+16|0}}}c=c+1|0;if(c>>>0>=e>>>0)break;else{i=i+16|0;t=t+52|0}}}f[u+236>>2]=f[u+4>>2];u=u+232|0;d=d+1|0}while((d|0)!=(P|0))}Ji(E);Ji(_);u=f[w>>2]|0;if(!(h[k+(r*5640|0)+5636>>0]&4)){t=f[A>>2]|0;l=(f[R>>2]|0)+1|0;if(!l){P=n;b=L;return P|0}s=f[k+(r*5640|0)+4>>2]|0;i=f[y>>2]|0;a=n;o=0;while(1){f[a+80>>2]=s;f[a+40>>2]=1;f[a+44>>2]=0;f[a+48>>2]=0;f[a+64>>2]=0;f[a+68>>2]=0;f[a+56>>2]=t;f[a+60>>2]=f[a+192>>2];f[a+52>>2]=i;f[a+72>>2]=u;o=o+1|0;if((o|0)==(l|0))break;else a=a+232|0}b=L;return n|0}else{o=(f[R>>2]|0)+1|0;if(!o){P=n;b=L;return P|0}s=n;i=k+(r*5640|0)+424|0;a=0;while(1){f[s+80>>2]=f[i+36>>2];f[s+40>>2]=1;f[s+44>>2]=f[i>>2];f[s+48>>2]=f[i+4>>2];f[s+64>>2]=0;f[s+68>>2]=0;f[s+56>>2]=f[i+12>>2];f[s+60>>2]=f[i+16>>2];f[s+52>>2]=f[i+8>>2];f[s+72>>2]=u;a=a+1|0;if((a|0)==(o|0))break;else{s=s+232|0;i=i+148|0}}b=L;return n|0}return 0}function Lr(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!e)return;r=e+4|0;n=f[r>>2]|0;if(n){Ji(n);f[r>>2]=0}if(t){u=e;c=0;while(1){l=u+196|0;r=f[l>>2]|0;if(r){s=u+192|0;n=f[s>>2]|0;if(n){o=0;while(1){i=r+12|0;a=f[i>>2]|0;if(a){Ji(a);f[i>>2]=0;n=f[s>>2]|0}o=o+1|0;if(o>>>0>=n>>>0)break;else r=r+16|0}r=f[l>>2]|0}Ji(r);f[l>>2]=0}c=c+1|0;if((c|0)==(t|0))break;else u=u+232|0}}Ji(e);return}function Cr(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0;F=b;b=b+32|0;C=F+28|0;L=F+24|0;A=F+20|0;R=F+16|0;k=F+12|0;P=F+8|0;I=F+4|0;H=F;O=t+76|0;x=f[O>>2]|0;D=(f[x+(r*5640|0)+420>>2]|0)+1|0;S=e+16|0;M=Yi((f[S>>2]|0)*528|0)|0;if(!M){r=0;b=F;return r|0}T=Yi(f[S>>2]<<2)|0;if(!T){Ji(M);r=0;b=F;return r|0}i=Dr(e,f[O>>2]|0,r)|0;if(!i){Ji(M);Ji(T);r=0;b=F;return r|0}a=f[S>>2]|0;if(a){o=0;s=M;while(1){f[T+(o<<2)>>2]=s;o=o+1|0;if(o>>>0>=a>>>0)break;else s=s+528|0}}Fr(e,t,r,A,R,k,P,I,H,L,C,T);_=f[L>>2]|0;E=ce(f[S>>2]|0,_)|0;w=ce(f[C>>2]|0,E)|0;h[i>>0]=(p[t+93>>0]|0)>>>3&1;y=qi(ce(f[x+(r*5640|0)+8>>2]|0,w)|0,2)|0;o=i+4|0;f[o>>2]=y;if(!y){Ji(M);Ji(T);a=f[o>>2]|0;if(a){Ji(a);f[o>>2]=0}if(D){m=i;g=0;while(1){c=m+196|0;a=f[c>>2]|0;if(a){u=m+192|0;o=f[u>>2]|0;if(o){l=0;while(1){s=a+12|0;e=f[s>>2]|0;if(e){Ji(e);f[s>>2]=0;o=f[u>>2]|0}l=l+1|0;if(l>>>0>=o>>>0)break;else a=a+16|0}a=f[c>>2]|0}Ji(a);f[c>>2]=0}g=g+1|0;if((g|0)==(D|0))break;else m=m+232|0}}Ji(i);r=0;b=F;return r|0}a=f[i+196>>2]|0;y=f[e+24>>2]|0;f[i+200>>2]=f[A>>2];f[i+204>>2]=f[k>>2];f[i+208>>2]=f[R>>2];f[i+212>>2]=f[P>>2];f[i+224>>2]=f[I>>2];f[i+228>>2]=f[H>>2];f[i+20>>2]=1;f[i+16>>2]=_;f[i+12>>2]=E;f[i+8>>2]=w;c=f[i+192>>2]|0;if(c){m=0;u=y;while(1){s=f[a+12>>2]|0;o=f[T+(m<<2)>>2]|0;f[a>>2]=f[u>>2];f[a+4>>2]=f[u+4>>2];l=f[a+8>>2]|0;if(l){e=0;while(1){f[s>>2]=f[o>>2];f[s+4>>2]=f[o+4>>2];f[s+8>>2]=f[o+8>>2];f[s+12>>2]=f[o+12>>2];e=e+1|0;if(e>>>0>=l>>>0)break;else{o=o+16|0;s=s+16|0}}}m=m+1|0;if(m>>>0>=c>>>0)break;else{a=a+16|0;u=u+52|0}}}if(D>>>0>1){c=i;v=1;do{a=f[c+428>>2]|0;f[c+432>>2]=f[A>>2];f[c+436>>2]=f[k>>2];f[c+440>>2]=f[R>>2];f[c+444>>2]=f[P>>2];f[c+456>>2]=f[I>>2];f[c+460>>2]=f[H>>2];f[c+252>>2]=1;f[c+248>>2]=_;f[c+244>>2]=E;f[c+240>>2]=w;m=f[c+424>>2]|0;if(m){g=0;u=y;while(1){s=f[a+12>>2]|0;o=f[T+(g<<2)>>2]|0;f[a>>2]=f[u>>2];f[a+4>>2]=f[u+4>>2];l=f[a+8>>2]|0;if(l){e=0;while(1){f[s>>2]=f[o>>2];f[s+4>>2]=f[o+4>>2];f[s+8>>2]=f[o+8>>2];f[s+12>>2]=f[o+12>>2];e=e+1|0;if(e>>>0>=l>>>0)break;else{o=o+16|0;s=s+16|0}}}g=g+1|0;if(g>>>0>=m>>>0)break;else{a=a+16|0;u=u+52|0}}}f[c+236>>2]=f[c+4>>2];c=c+232|0;v=v+1|0}while((v|0)!=(D|0))}Ji(M);Ji(T);do{if(h[x+(r*5640|0)+5636>>0]&4){a=d[t>>1]|0;if((a&65535)>2){if(!((n|0)==1|(a&65535)<7))break}else if((n|0)!=1)break;Nr(f[O>>2]|0,r,f[A>>2]|0,f[R>>2]|0,f[k>>2]|0,f[P>>2]|0,f[L>>2]|0,f[I>>2]|0,f[H>>2]|0);r=i;b=F;return r|0}}while(0);w=f[S>>2]|0;E=f[A>>2]|0;_=f[R>>2]|0;y=f[k>>2]|0;v=f[P>>2]|0;g=f[L>>2]|0;m=f[C>>2]|0;c=f[I>>2]|0;u=f[H>>2]|0;a=f[O>>2]|0;s=(f[a+(r*5640|0)+420>>2]|0)+1|0;if(!s){r=i;b=F;return r|0}e=f[a+(r*5640|0)+8>>2]|0;l=f[a+(r*5640|0)+4>>2]|0;a=a+(r*5640|0)+424|0;o=0;while(1){f[a+76>>2]=0;f[a+92>>2]=w;f[a+72>>2]=0;f[a+88>>2]=m;f[a+68>>2]=0;f[a+84>>2]=e;f[a+36>>2]=l;f[a+80>>2]=0;f[a+96>>2]=g;f[a+100>>2]=E;f[a+104>>2]=_;f[a+108>>2]=y;f[a+112>>2]=v;f[a+116>>2]=c;f[a+120>>2]=u;o=o+1|0;if((o|0)==(s|0))break;else a=a+148|0}b=F;return i|0}function Ir(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,u=0,c=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0;j=f[t+76>>2]|0;V=j+(r*5640|0)+424+(n*148|0)+36|0;G=$i(f[V>>2]|0)|0;f[e+(n*232|0)+40>>2]=1;W=e+(n*232|0)+44|0;f[e+(n*232|0)+80>>2]=f[V>>2];do{if(h[t+93>>0]&8){s=d[t>>1]|0;if((s&65535)>2){if(!((o|0)==1&(s&65535)>6|(s+-3&65535)<4))break}else if(!((o|0)==1|(s+-3&65535)<4))break;s=a+1|0;e:do{if((s|0)<4){o=j+(r*5640|0)+424+(n*148|0)+72|0;l=j+(r*5640|0)+424+(n*148|0)+88|0;u=e+(n*232|0)+56|0;c=j+(r*5640|0)+424+(n*148|0)+76|0;p=e+(n*232|0)+48|0;m=j+(r*5640|0)+424+(n*148|0)+92|0;g=e+(n*232|0)+60|0;v=j+(r*5640|0)+424+(n*148|0)+68|0;y=e+(n*232|0)+64|0;_=j+(r*5640|0)+424+(n*148|0)+84|0;b=e+(n*232|0)+52|0;E=j+(r*5640|0)+424+(n*148|0)+80|0;w=e+(n*232|0)+68|0;x=j+(r*5640|0)+424+(n*148|0)+96|0;T=e+(n*232|0)+72|0;M=j+(r*5640|0)+424+(n*148|0)+100|0;S=e+(n*232|0)+96|0;A=j+(r*5640|0)+424+(n*148|0)+108|0;R=e+(n*232|0)+104|0;k=j+(r*5640|0)+424+(n*148|0)+104|0;P=e+(n*232|0)+100|0;L=j+(r*5640|0)+424+(n*148|0)+112|0;C=e+(n*232|0)+108|0;while(1){t:do{switch(h[G+s>>0]|0){case 82:{f[W>>2]=f[o>>2];f[u>>2]=f[l>>2];break}case 67:{f[p>>2]=f[c>>2];f[g>>2]=f[m>>2];break}case 76:{f[y>>2]=f[v>>2];f[b>>2]=f[_>>2];break}case 80:if((f[V>>2]|0)>>>0<2){f[w>>2]=f[E>>2];f[T>>2]=f[x>>2];break t}else{f[S>>2]=f[M>>2];f[R>>2]=f[A>>2];f[P>>2]=f[k>>2];f[C>>2]=f[L>>2];break t}default:{}}}while(0);s=s+1|0;if((s|0)==4)break e}}}while(0);s=(a|0)>-1;if(!i){if(!s)return;u=j+(r*5640|0)+424+(n*148|0)+76|0;c=j+(r*5640|0)+424+(n*148|0)+132|0;p=e+(n*232|0)+48|0;m=e+(n*232|0)+60|0;g=j+(r*5640|0)+424+(n*148|0)+72|0;v=j+(r*5640|0)+424+(n*148|0)+128|0;y=e+(n*232|0)+56|0;_=j+(r*5640|0)+424+(n*148|0)+68|0;b=j+(r*5640|0)+424+(n*148|0)+124|0;E=e+(n*232|0)+64|0;w=e+(n*232|0)+52|0;x=j+(r*5640|0)+424+(n*148|0)+80|0;T=j+(r*5640|0)+424+(n*148|0)+136|0;M=e+(n*232|0)+68|0;S=e+(n*232|0)+72|0;A=j+(r*5640|0)+424+(n*148|0)+100|0;R=j+(r*5640|0)+424+(n*148|0)+140|0;k=j+(r*5640|0)+424+(n*148|0)+108|0;P=j+(r*5640|0)+424+(n*148|0)+144|0;L=e+(n*232|0)+96|0;C=j+(r*5640|0)+424+(n*148|0)+116|0;i=e+(n*232|0)+100|0;I=e+(n*232|0)+104|0;l=j+(r*5640|0)+424+(n*148|0)+120|0;o=e+(n*232|0)+108|0;s=a;while(1){e:do{switch(h[G+s>>0]|0){case 67:{n=f[u>>2]|0;f[p>>2]=n;n=n+1|0;f[m>>2]=n;f[c>>2]=n;break}case 82:{n=f[g>>2]|0;f[W>>2]=n;n=n+1|0;f[y>>2]=n;f[v>>2]=n;break}case 76:{n=f[_>>2]|0;f[E>>2]=n;n=n+1|0;f[w>>2]=n;f[b>>2]=n;break}case 80:if((f[V>>2]|0)>>>0<2){n=f[x>>2]|0;f[M>>2]=n;n=n+1|0;f[S>>2]=n;f[T>>2]=n;break e}else{n=f[A>>2]|0;a=f[k>>2]|0;f[L>>2]=n;r=f[C>>2]|0;r=r+n-((n>>>0)%(r>>>0)|0)|0;f[i>>2]=r;f[I>>2]=a;n=f[l>>2]|0;n=n+a-((a>>>0)%(n>>>0)|0)|0;f[o>>2]=n;f[R>>2]=r;f[P>>2]=n;break e}default:{}}}while(0);if((s|0)>0)s=s+-1|0;else break}return}if(!s)return;F=j+(r*5640|0)+424+(n*148|0)+128|0;N=j+(r*5640|0)+424+(n*148|0)+88|0;U=j+(r*5640|0)+424+(n*148|0)+72|0;B=e+(n*232|0)+56|0;z=j+(r*5640|0)+424+(n*148|0)+132|0;m=j+(r*5640|0)+424+(n*148|0)+92|0;g=j+(r*5640|0)+424+(n*148|0)+76|0;v=e+(n*232|0)+48|0;y=e+(n*232|0)+60|0;_=j+(r*5640|0)+424+(n*148|0)+124|0;b=j+(r*5640|0)+424+(n*148|0)+84|0;E=j+(r*5640|0)+424+(n*148|0)+68|0;w=e+(n*232|0)+64|0;x=e+(n*232|0)+52|0;T=j+(r*5640|0)+424+(n*148|0)+136|0;M=j+(r*5640|0)+424+(n*148|0)+96|0;S=j+(r*5640|0)+424+(n*148|0)+80|0;A=e+(n*232|0)+68|0;R=e+(n*232|0)+72|0;k=j+(r*5640|0)+424+(n*148|0)+140|0;P=j+(r*5640|0)+424+(n*148|0)+104|0;L=e+(n*232|0)+96|0;C=j+(r*5640|0)+424+(n*148|0)+116|0;i=e+(n*232|0)+100|0;I=j+(r*5640|0)+424+(n*148|0)+144|0;H=j+(r*5640|0)+424+(n*148|0)+112|0;O=e+(n*232|0)+104|0;D=j+(r*5640|0)+424+(n*148|0)+120|0;c=e+(n*232|0)+108|0;p=j+(r*5640|0)+424+(n*148|0)+100|0;u=j+(r*5640|0)+424+(n*148|0)+108|0;l=a;s=1;while(1){o=G+l|0;e:do{switch(h[o>>0]|0){case 67:{a=f[z>>2]|0;f[v>>2]=a+-1;f[y>>2]=a;break}case 82:{a=f[F>>2]|0;f[W>>2]=a+-1;f[B>>2]=a;break}case 76:{a=f[_>>2]|0;f[w>>2]=a+-1;f[x>>2]=a;break}case 80:if((f[V>>2]|0)>>>0<2){a=f[T>>2]|0;f[A>>2]=a+-1;f[R>>2]=a;break e}else{a=f[k>>2]|0;j=f[C>>2]|0;f[L>>2]=a-j-((a>>>0)%(j>>>0)|0);f[i>>2]=a;a=f[I>>2]|0;j=f[D>>2]|0;f[O>>2]=a-j-((a>>>0)%(j>>>0)|0);f[c>>2]=a;break e}default:{}}}while(0);e:do{if((s|0)==1)switch(h[o>>0]|0){case 82:{s=f[F>>2]|0;if((s|0)!=(f[N>>2]|0)){f[W>>2]=s;s=s+1|0;f[B>>2]=s;f[F>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[U>>2]|0;f[W>>2]=s;s=s+1|0;f[B>>2]=s;f[F>>2]=s;s=1;break e}case 67:{s=f[z>>2]|0;if((s|0)!=(f[m>>2]|0)){f[v>>2]=s;s=s+1|0;f[y>>2]=s;f[z>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[g>>2]|0;f[v>>2]=s;s=s+1|0;f[y>>2]=s;f[z>>2]=s;s=1;break e}case 76:{s=f[_>>2]|0;if((s|0)!=(f[b>>2]|0)){f[w>>2]=s;s=s+1|0;f[x>>2]=s;f[_>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[E>>2]|0;f[w>>2]=s;s=s+1|0;f[x>>2]=s;f[_>>2]=s;s=1;break e}case 80:{if((f[V>>2]|0)>>>0<2){s=f[T>>2]|0;if((s|0)!=(f[M>>2]|0)){f[A>>2]=s;s=s+1|0;f[R>>2]=s;f[T>>2]=s;s=0;break e}if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}s=f[S>>2]|0;f[A>>2]=s;s=s+1|0;f[R>>2]=s;f[T>>2]=s;s=1;break e}s=f[k>>2]|0;if(s>>>0<(f[P>>2]|0)>>>0){f[L>>2]=s;a=f[C>>2]|0;s=a+s-((s>>>0)%(a>>>0)|0)|0;f[i>>2]=s;f[k>>2]=s;s=0;break e}o=f[I>>2]|0;if(o>>>0<(f[H>>2]|0)>>>0){f[O>>2]=o;a=f[D>>2]|0;s=0;o=a+o-((o>>>0)%(a>>>0)|0)|0}else{if(!(Ur(l+-1|0,t,r,n,G)|0)){s=0;break e}a=f[u>>2]|0;f[I>>2]=a;f[O>>2]=a;o=f[D>>2]|0;s=1;o=o+a-((a>>>0)%(o>>>0)|0)|0}f[c>>2]=o;f[I>>2]=o;j=f[p>>2]|0;f[L>>2]=j;a=f[C>>2]|0;a=a+j-((j>>>0)%(a>>>0)|0)|0;f[i>>2]=a;f[k>>2]=a;break e}default:{s=1;break e}}}while(0);if((l|0)>0)l=l+-1|0;else break}return}}while(0);f[W>>2]=f[j+(r*5640|0)+424+(n*148|0)+72>>2];f[e+(n*232|0)+56>>2]=f[j+(r*5640|0)+424+(n*148|0)+88>>2];f[e+(n*232|0)+48>>2]=f[j+(r*5640|0)+424+(n*148|0)+76>>2];f[e+(n*232|0)+60>>2]=f[j+(r*5640|0)+424+(n*148|0)+92>>2];f[e+(n*232|0)+64>>2]=f[j+(r*5640|0)+424+(n*148|0)+68>>2];f[e+(n*232|0)+52>>2]=f[j+(r*5640|0)+424+(n*148|0)+84>>2];f[e+(n*232|0)+68>>2]=f[j+(r*5640|0)+424+(n*148|0)+80>>2];f[e+(n*232|0)+72>>2]=f[j+(r*5640|0)+424+(n*148|0)+96>>2];f[e+(n*232|0)+96>>2]=f[j+(r*5640|0)+424+(n*148|0)+100>>2];f[e+(n*232|0)+104>>2]=f[j+(r*5640|0)+424+(n*148|0)+108>>2];f[e+(n*232|0)+100>>2]=f[j+(r*5640|0)+424+(n*148|0)+104>>2];f[e+(n*232|0)+108>>2]=f[j+(r*5640|0)+424+(n*148|0)+112>>2];return}function Hr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0;I=f[t+76>>2]|0;O=f[t+24>>2]|0;N=(r>>>0)%(O>>>0)|0;O=(r>>>0)/(O>>>0)|0;D=f[t+4>>2]|0;C=f[t+12>>2]|0;L=(ce(C,N)|0)+D|0;F=f[e>>2]|0;F=(L|0)>(F|0)?L:F;D=(ce(C,N+1|0)|0)+D|0;N=f[e+8>>2]|0;N=(D|0)<(N|0)?D:N;D=f[t+8>>2]|0;C=f[t+16>>2]|0;L=(ce(C,O)|0)+D|0;H=f[e+4>>2]|0;H=(L|0)>(H|0)?L:H;D=(ce(C,O+1|0)|0)+D|0;O=f[e+12>>2]|0;O=(D|0)<(O|0)?D:O;D=f[e+16>>2]|0;if(!D){u=0;l=2147483647;s=2147483647;o=0}else{R=O+-1|0;k=N+-1|0;P=H+-1|0;L=F+-1|0;u=0;l=2147483647;s=2147483647;o=0;C=0;S=f[e+24>>2]|0;A=f[I+(r*5640|0)+5584>>2]|0;while(1){x=f[S>>2]|0;T=f[S+4>>2]|0;M=f[A+4>>2]|0;o=M>>>0>o>>>0?M:o;if(M){E=(R+T|0)/(T|0)|0;_=(k+x|0)/(x|0)|0;v=(P+T|0)/(T|0)|0;m=(L+x|0)/(x|0)|0;m=Wl(m|0,((m|0)<0)<<31>>31|0,-1,-1)|0;g=B;v=Wl(v|0,((v|0)<0)<<31>>31|0,-1,-1)|0;y=B;_=Wl(_|0,((_|0)<0)<<31>>31|0,-1,-1)|0;b=B;E=Wl(E|0,((E|0)<0)<<31>>31|0,-1,-1)|0;w=B;t=0;p=0;while(1){c=f[A+812+(p<<2)>>2]|0;d=f[A+944+(p<<2)>>2]|0;i=t+-1+M|0;a=x<<i+c;U=T<<d+i;l=l>>>0<a>>>0?l:a;s=s>>>0<U>>>0?s:U;U=Gl(1,0,i|0)|0;a=B;t=Wl(m|0,g|0,U|0,a|0)|0;t=jl(t|0,B|0,i|0)|0;n=Wl(v|0,y|0,U|0,a|0)|0;n=jl(n|0,B|0,i|0)|0;e=Wl(_|0,b|0,U|0,a|0)|0;e=jl(e|0,B|0,i|0)|0;a=Wl(E|0,w|0,U|0,a|0)|0;i=jl(a|0,B|0,i|0)|0;a=Gl(1,0,d|0)|0;a=Wl(a|0,B|0,-1,-1)|0;a=Wl(a|0,B|0,i|0,((i|0)<0)<<31>>31|0)|0;a=jl(a|0,B|0,d|0)|0;if((t|0)==(e|0))t=0;else{U=Gl(1,0,c|0)|0;U=Wl(U|0,B|0,-1,-1)|0;U=Wl(U|0,B|0,e|0,((e|0)<0)<<31>>31|0)|0;U=jl(U|0,B|0,c|0)|0;t=(U<<c)-(t>>c<<c)>>c}e=ce(t,(n|0)==(i|0)?0:(a<<d)-(n>>d<<d)>>d)|0;u=e>>>0>u>>>0?e:u;e=p+1|0;if(e>>>0<M>>>0){t=~p;p=e}else break}}C=C+1|0;if(C>>>0>=D>>>0)break;else{S=S+52|0;A=A+1080|0}}}if(h[I+(r*5640|0)+5636>>0]&4){Nr(I,r,F,N,H,O,u,l,s);return}n=(f[I+(r*5640|0)+420>>2]|0)+1|0;if(!n)return;i=f[I+(r*5640|0)+8>>2]|0;a=f[I+(r*5640|0)+4>>2]|0;t=I+(r*5640|0)+424|0;e=0;while(1){f[t+76>>2]=0;f[t+92>>2]=D;f[t+72>>2]=0;f[t+88>>2]=o;f[t+68>>2]=0;f[t+84>>2]=i;f[t+36>>2]=a;f[t+80>>2]=0;f[t+96>>2]=u;f[t+100>>2]=F;f[t+104>>2]=N;f[t+108>>2]=H;f[t+112>>2]=O;f[t+116>>2]=l;f[t+120>>2]=s;e=e+1|0;if((e|0)==(n|0))break;else t=t+148|0}return}function Or(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Me=0,Se=0,Ae=0,Re=0,ke=0,Pe=0,Le=0,Ce=0,Ie=0,He=0,Oe=0,De=0,Fe=0,Ne=0,Ue=0,Be=0,ze=0,je=0,Ve=0,Ge=0,We=0,Xe=0,Ye=0,qe=0,Ze=0,Ke=0,Qe=0,Je=0,$e=0,et=0,tt=0,rt=0,nt=0,it=0,at=0,ot=0,st=0,lt=0,ut=0,ct=0,ht=0,dt=0,ft=0;switch(f[e+80>>2]|0){case 0:{t=e+40|0;if(!(f[t>>2]|0)){P=e+32|0;l=P;P=f[P>>2]|0;r=18}else{f[t>>2]=0;_=f[e+64>>2]|0;f[e+36>>2]=_;r=5}while(1){if((r|0)==5){if(_>>>0>=(f[e+52>>2]|0)>>>0){ft=0;r=153;break}M=f[e+44>>2]|0;f[e+28>>2]=M;r=7}else if((r|0)==18){o=P+1|0;f[l>>2]=o;i=l;r=14}while(1){if((r|0)==7){r=0;if(M>>>0>=(f[e+56>>2]|0)>>>0){r=21;break}S=f[e+48>>2]|0;m=e+24|0;f[m>>2]=S}else if((r|0)==14){if(o>>>0<(f[e+72>>2]|0)>>>0){r=16;break}L=e+24|0;c=L;L=f[L>>2]|0;r=19}while(1){if((r|0)==19){r=0;S=L+1|0;f[c>>2]=S;m=c}if(S>>>0>=(f[e+60>>2]|0)>>>0){r=20;break}A=f[e+196>>2]|0;R=f[e+28>>2]|0;if(R>>>0<(f[A+(S<<4)+8>>2]|0)>>>0)break;else{c=m;L=S;r=19}}if((r|0)==20){r=e+28|0;M=(f[r>>2]|0)+1|0;f[r>>2]=M;r=7;continue}t=f[A+(S<<4)+12>>2]|0;if(!(h[e>>0]|0)){dt=ce(f[t+(R<<4)+12>>2]|0,f[t+(R<<4)+8>>2]|0)|0;f[e+72>>2]=dt}o=f[e+68>>2]|0;i=e+32|0;f[i>>2]=o;r=14}if((r|0)==16){r=0;k=ce(f[e+8>>2]|0,f[e+36>>2]|0)|0;k=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+k|0;k=k+(ce(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;k=k+(ce(f[e+20>>2]|0,o)|0)|0;k=(f[e+4>>2]|0)+(k<<1)|0;if(!(d[k>>1]|0))break;else{l=i;P=o;r=18;continue}}else if((r|0)==21){r=e+36|0;_=(f[r>>2]|0)+1|0;f[r>>2]=_;r=5;continue}}if((r|0)==153)return ft|0;d[k>>1]=1;e=1;return e|0}case 1:{t=e+40|0;if(!(f[t>>2]|0)){x=e+32|0;s=x;x=f[x>>2]|0;r=38}else{f[t>>2]=0;C=f[e+44>>2]|0;f[e+28>>2]=C;r=25}while(1){if((r|0)==25){if(C>>>0>=(f[e+56>>2]|0)>>>0){ft=0;r=153;break}v=f[e+64>>2]|0;f[e+36>>2]=v;r=27}else if((r|0)==38){a=x+1|0;f[s>>2]=a;n=s;r=34}while(1){if((r|0)==27){r=0;if(v>>>0>=(f[e+52>>2]|0)>>>0){r=41;break}y=f[e+48>>2]|0;p=e+24|0;f[p>>2]=y}else if((r|0)==34){if(a>>>0<(f[e+72>>2]|0)>>>0){r=36;break}T=e+24|0;u=T;T=f[T>>2]|0;r=39}while(1){if((r|0)==39){r=0;y=T+1|0;f[u>>2]=y;p=u}if(y>>>0>=(f[e+60>>2]|0)>>>0){r=40;break}b=f[e+196>>2]|0;E=f[e+28>>2]|0;if(E>>>0<(f[b+(y<<4)+8>>2]|0)>>>0)break;else{u=p;T=y;r=39}}if((r|0)==40){r=e+36|0;v=(f[r>>2]|0)+1|0;f[r>>2]=v;r=27;continue}t=f[b+(y<<4)+12>>2]|0;if(!(h[e>>0]|0)){dt=ce(f[t+(E<<4)+12>>2]|0,f[t+(E<<4)+8>>2]|0)|0;f[e+72>>2]=dt}a=f[e+68>>2]|0;n=e+32|0;f[n>>2]=a;r=34}if((r|0)==36){r=0;w=ce(f[e+8>>2]|0,f[e+36>>2]|0)|0;w=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+w|0;w=w+(ce(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;w=w+(ce(f[e+20>>2]|0,a)|0)|0;w=(f[e+4>>2]|0)+(w<<1)|0;if(!(d[w>>1]|0))break;else{s=n;x=a;r=38;continue}}else if((r|0)==41){r=e+28|0;C=(f[r>>2]|0)+1|0;f[r>>2]=C;r=25;continue}}if((r|0)==153)return ft|0;d[w>>1]=1;e=1;return e|0}case 2:{t=e+40|0;if(!(f[t>>2]|0)){ht=e+36|0;We=ht;ht=f[ht>>2]|0;r=75}else{f[t>>2]=0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;g=f[e+192>>2]|0;if(g){v=f[e+196>>2]|0;t=0;r=0;y=0;do{o=f[v+(y<<4)+8>>2]|0;if(o){s=f[v+(y<<4)+12>>2]|0;l=f[v+(y<<4)>>2]|0;u=f[v+(y<<4)+4>>2]|0;c=o+-1|0;n=0;a=0;while(1){i=c+n|0;Ge=l<<i+(f[s+(a<<4)>>2]|0);i=u<<(f[s+(a<<4)+4>>2]|0)+i;t=(t|0)==0?Ge:t>>>0<Ge>>>0?t:Ge;r=(r|0)==0?i:r>>>0<i>>>0?r:i;i=a+1|0;if((i|0)==(o|0))break;else{n=~a;a=i}}f[p>>2]=t;f[m>>2]=r}y=y+1|0}while((y|0)!=(g|0))}if(!(h[e>>0]|0)){f[e+104>>2]=f[e+204>>2];f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}O=f[e+44>>2]|0;f[e+28>>2]=O;r=54}while(1){if((r|0)==54){if(O>>>0>=(f[e+56>>2]|0)>>>0){ft=0;r=153;break}Ze=f[e+104>>2]|0;f[e+220>>2]=Ze;r=56}else if((r|0)==75){ut=ht+1|0;f[We>>2]=ut;Xe=We;r=71}while(1){if((r|0)==56){if((Ze|0)>=(f[e+108>>2]|0)){r=79;break}Ke=f[e+96>>2]|0;f[e+216>>2]=Ke;r=58}else if((r|0)==71){if(ut>>>0<(f[e+52>>2]|0)>>>0){r=73;break}dt=e+24|0;Ye=dt;dt=f[dt>>2]|0;r=76}while(1){if((r|0)==58){if((Ke|0)>=(f[e+100>>2]|0)){r=78;break}Qe=f[e+48>>2]|0;qe=e+24|0;f[qe>>2]=Qe}else if((r|0)==76){Qe=dt+1|0;f[Ye>>2]=Qe;qe=Ye}if(Qe>>>0>=(f[e+60>>2]|0)>>>0){Ke=f[e+224>>2]|0;r=e+216|0;Ge=f[r>>2]|0;Ke=Ge+Ke-((Ge|0)%(Ke|0)|0)|0;f[r>>2]=Ke;r=58;continue}r=f[e+196>>2]|0;u=f[e+28>>2]|0;t=f[r+(Qe<<4)+8>>2]|0;if(u>>>0>=t>>>0){Ye=qe;dt=Qe;r=76;continue}c=f[r+(Qe<<4)+12>>2]|0;a=t+~u|0;o=f[e+200>>2]|0;s=f[r+(Qe<<4)>>2]|0;Je=s<<a;$e=(o+-1+Je|0)/(Je|0)|0;l=f[e+204>>2]|0;Ge=f[r+(Qe<<4)+4>>2]|0;et=Ge<<a;tt=(l+-1+et|0)/(et|0)|0;rt=Je+-1|0;t=(rt+(f[e+208>>2]|0)|0)/(Je|0)|0;nt=et+-1|0;r=(nt+(f[e+212>>2]|0)|0)/(et|0)|0;it=f[c+(u<<4)>>2]|0;n=it+a|0;at=f[c+(u<<4)+4>>2]|0;i=at+a|0;ot=f[e+220>>2]|0;if((ot|0)%(Ge<<i|0)|0){if((ot|0)!=(l|0)){Ye=qe;dt=Qe;r=76;continue}if(!((tt<<a|0)%(1<<i|0)|0)){Ye=qe;dt=Qe;r=76;continue}}st=f[e+216>>2]|0;if((st|0)%(s<<n|0)|0){if((st|0)!=(o|0)){Ye=qe;dt=Qe;r=76;continue}if(!(($e<<a|0)%(1<<n|0)|0)){Ye=qe;dt=Qe;r=76;continue}}lt=f[c+(u<<4)+8>>2]|0;if(!lt){Ye=qe;dt=Qe;r=76;continue}if((tt|0)==(r|0)|(($e|0)==(t|0)?1:(f[c+(u<<4)+12>>2]|0)==0)){Ye=qe;dt=Qe;r=76}else{r=70;break}}if((r|0)==70){ut=(((rt+st|0)/(Je|0)|0)>>it)-($e>>it)+(ce((((nt+ot|0)/(et|0)|0)>>at)-(tt>>at)|0,lt)|0)|0;f[e+32>>2]=ut;ut=f[e+64>>2]|0;Xe=e+36|0;f[Xe>>2]=ut;r=71;continue}else if((r|0)==78){Ze=f[e+228>>2]|0;r=e+220|0;Ge=f[r>>2]|0;Ze=Ge+Ze-((Ge|0)%(Ze|0)|0)|0;f[r>>2]=Ze;r=56;continue}}if((r|0)==73){r=0;ct=ce(f[e+8>>2]|0,ut)|0;ct=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+ct|0;ct=ct+(ce(f[e+16>>2]|0,f[e+24>>2]|0)|0)|0;ct=ct+(ce(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;ct=(f[e+4>>2]|0)+(ct<<1)|0;if(!(d[ct>>1]|0))break;else{We=Xe;ht=ut;r=75;continue}}else if((r|0)==79){r=e+28|0;O=(f[r>>2]|0)+1|0;f[r>>2]=O;r=54;continue}}if((r|0)==153)return ft|0;d[ct>>1]=1;e=1;return e|0}case 3:{r=e+40|0;if(!(f[r>>2]|0)){Ve=f[e+24>>2]|0;De=e+36|0;me=De;De=f[De>>2]|0;Ue=Ve;Ve=(f[e+196>>2]|0)+(Ve<<4)|0;r=113}else{f[r>>2]=0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;g=f[e+192>>2]|0;if(g){v=f[e+196>>2]|0;t=0;r=0;y=0;do{o=f[v+(y<<4)+8>>2]|0;if(o){s=f[v+(y<<4)+12>>2]|0;l=f[v+(y<<4)>>2]|0;u=f[v+(y<<4)+4>>2]|0;c=o+-1|0;n=0;a=0;while(1){i=c+n|0;dt=l<<i+(f[s+(a<<4)>>2]|0);i=u<<(f[s+(a<<4)+4>>2]|0)+i;t=(t|0)==0?dt:t>>>0<dt>>>0?t:dt;r=(r|0)==0?i:r>>>0<i>>>0?r:i;i=a+1|0;if((i|0)==(o|0))break;else{n=~a;a=i}}f[p>>2]=t;f[m>>2]=r}y=y+1|0}while((y|0)!=(g|0))}if(!(h[e>>0]|0)){t=f[e+204>>2]|0;f[e+104>>2]=t;f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}else t=f[e+104>>2]|0;f[e+220>>2]=t;r=93}while(1){if((r|0)==93){if((t|0)>=(f[e+108>>2]|0)){ft=0;r=153;break}_e=f[e+96>>2]|0;f[e+216>>2]=_e;r=95}else if((r|0)==113){Ie=De+1|0;f[me>>2]=Ie;ge=me;He=Ue;je=Ve;r=109}while(1){if((r|0)==95){if((_e|0)>=(f[e+100>>2]|0)){r=117;break}be=f[e+48>>2]|0;f[e+24>>2]=be;r=97}else if((r|0)==109){if(Ie>>>0<(f[e+52>>2]|0)>>>0){r=111;break}Fe=e+28|0;ve=Fe;Fe=f[Fe>>2]|0;Be=He;Ge=je;r=114}while(1){if((r|0)==97){if(be>>>0>=(f[e+60>>2]|0)>>>0){r=116;break}ze=(f[e+196>>2]|0)+(be<<4)|0;Ee=f[e+44>>2]|0;ye=e+28|0;f[ye>>2]=Ee;Ne=be}else if((r|0)==114){Ee=Fe+1|0;f[ve>>2]=Ee;ye=ve;Ne=Be;ze=Ge}dt=f[e+56>>2]|0;r=f[ze+8>>2]|0;if(Ee>>>0>=(dt>>>0<r>>>0?dt:r)>>>0){be=Ne+1|0;f[e+24>>2]=be;r=97;continue}c=f[ze+12>>2]|0;r=r+~Ee|0;n=f[e+200>>2]|0;i=f[ze>>2]|0;we=i<<r;xe=(n+-1+we|0)/(we|0)|0;a=f[e+204>>2]|0;dt=f[ze+4>>2]|0;Te=dt<<r;Me=(a+-1+Te|0)/(Te|0)|0;Se=we+-1|0;o=(Se+(f[e+208>>2]|0)|0)/(we|0)|0;Ae=Te+-1|0;s=(Ae+(f[e+212>>2]|0)|0)/(Te|0)|0;Re=f[c+(Ee<<4)>>2]|0;l=Re+r|0;ke=f[c+(Ee<<4)+4>>2]|0;u=ke+r|0;Pe=f[e+220>>2]|0;if((Pe|0)%(dt<<u|0)|0){if((Pe|0)!=(a|0)){ve=ye;Fe=Ee;Be=Ne;Ge=ze;r=114;continue}if(!((Me<<r|0)%(1<<u|0)|0)){ve=ye;Fe=Ee;Be=Ne;Ge=ze;r=114;continue}}Le=f[e+216>>2]|0;if((Le|0)%(i<<l|0)|0){if((Le|0)!=(n|0)){ve=ye;Fe=Ee;Be=Ne;Ge=ze;r=114;continue}if(!((xe<<r|0)%(1<<l|0)|0)){ve=ye;Fe=Ee;Be=Ne;Ge=ze;r=114;continue}}Ce=f[c+(Ee<<4)+8>>2]|0;if(!Ce){ve=ye;Fe=Ee;Be=Ne;Ge=ze;r=114;continue}if((Me|0)==(s|0)|((xe|0)==(o|0)?1:(f[c+(Ee<<4)+12>>2]|0)==0)){ve=ye;Fe=Ee;Be=Ne;Ge=ze;r=114}else{r=108;break}}if((r|0)==108){Ie=(((Se+Le|0)/(we|0)|0)>>Re)-(xe>>Re)+(ce((((Ae+Pe|0)/(Te|0)|0)>>ke)-(Me>>ke)|0,Ce)|0)|0;f[e+32>>2]=Ie;Ie=f[e+64>>2]|0;ge=e+36|0;f[ge>>2]=Ie;He=Ne;je=ze;r=109;continue}else if((r|0)==116){_e=f[e+224>>2]|0;r=e+216|0;dt=f[r>>2]|0;_e=dt+_e-((dt|0)%(_e|0)|0)|0;f[r>>2]=_e;r=95;continue}}if((r|0)==111){r=0;Oe=ce(f[e+8>>2]|0,Ie)|0;Oe=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+Oe|0;Oe=Oe+(ce(f[e+16>>2]|0,He)|0)|0;Oe=Oe+(ce(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;Oe=(f[e+4>>2]|0)+(Oe<<1)|0;if(!(d[Oe>>1]|0))break;else{me=ge;De=Ie;Ue=He;Ve=je;r=113;continue}}else if((r|0)==117){t=f[e+228>>2]|0;r=e+220|0;dt=f[r>>2]|0;t=dt+t-((dt|0)%(t|0)|0)|0;f[r>>2]=t;r=93;continue}}if((r|0)==153)return ft|0;d[Oe>>1]=1;e=1;return e|0}case 4:{t=e+40|0;if(!(f[t>>2]|0)){fe=f[e+24>>2]|0;ne=e+36|0;D=ne;ne=f[ne>>2]|0;ae=fe;fe=(f[e+196>>2]|0)+(fe<<4)|0;r=148}else{f[t>>2]=0;B=f[e+48>>2]|0;f[e+24>>2]=B;r=121}while(1){if((r|0)==121){if(B>>>0>=(f[e+60>>2]|0)>>>0){ft=0;r=153;break}t=f[e+196>>2]|0;g=t+(B<<4)|0;p=e+224|0;f[p>>2]=0;m=e+228|0;f[m>>2]=0;l=f[t+(B<<4)+8>>2]|0;if(l){u=f[t+(B<<4)+12>>2]|0;c=f[g>>2]|0;i=f[t+(B<<4)+4>>2]|0;a=l+-1|0;r=0;t=0;n=0;s=0;while(1){o=a+n|0;dt=c<<o+(f[u+(s<<4)>>2]|0);o=i<<(f[u+(s<<4)+4>>2]|0)+o;r=(r|0)==0?dt:r>>>0<dt>>>0?r:dt;t=(t|0)==0?o:t>>>0<o>>>0?t:o;o=s+1|0;if((o|0)==(l|0))break;else{n=~s;s=o}}f[p>>2]=r;f[m>>2]=t}if(!(h[e>>0]|0)){t=f[e+204>>2]|0;f[e+104>>2]=t;f[e+96>>2]=f[e+200>>2];f[e+108>>2]=f[e+212>>2];f[e+100>>2]=f[e+208>>2]}else t=f[e+104>>2]|0;f[e+220>>2]=t;I=t;H=B;r=130}else if((r|0)==148){ee=ne+1|0;f[D>>2]=ee;F=D;te=ae;de=fe;r=144}while(1){if((r|0)==130){if((I|0)>=(f[e+108>>2]|0)){r=152;break}z=f[e+96>>2]|0;f[e+216>>2]=z;oe=H;ue=g;r=132}else if((r|0)==144){if(ee>>>0<(f[e+52>>2]|0)>>>0){r=146;break}ie=e+28|0;N=ie;ie=f[ie>>2]|0;le=te;pe=de;r=149}while(1){if((r|0)==132){if((z|0)>=(f[e+100>>2]|0)){r=151;break}j=f[e+44>>2]|0;U=e+28|0;f[U>>2]=j;se=oe;he=ue}else if((r|0)==149){j=ie+1|0;f[N>>2]=j;U=N;se=le;he=pe}dt=f[e+56>>2]|0;t=f[he+8>>2]|0;if(j>>>0>=(dt>>>0<t>>>0?dt:t)>>>0){z=f[e+224>>2]|0;oe=e+216|0;ue=f[oe>>2]|0;z=ue+z-((ue|0)%(z|0)|0)|0;f[oe>>2]=z;oe=se;ue=he;r=132;continue}u=f[he+12>>2]|0;t=t+~j|0;r=f[e+200>>2]|0;n=f[he>>2]|0;V=n<<t;G=(r+-1+V|0)/(V|0)|0;i=f[e+204>>2]|0;dt=f[he+4>>2]|0;W=dt<<t;X=(i+-1+W|0)/(W|0)|0;Y=V+-1|0;a=(Y+(f[e+208>>2]|0)|0)/(V|0)|0;q=W+-1|0;o=(q+(f[e+212>>2]|0)|0)/(W|0)|0;Z=f[u+(j<<4)>>2]|0;s=Z+t|0;K=f[u+(j<<4)+4>>2]|0;l=K+t|0;Q=f[e+220>>2]|0;if((Q|0)%(dt<<l|0)|0){if((Q|0)!=(i|0)){N=U;ie=j;le=se;pe=he;r=149;continue}if(!((X<<t|0)%(1<<l|0)|0)){N=U;ie=j;le=se;pe=he;r=149;continue}}J=f[e+216>>2]|0;if((J|0)%(n<<s|0)|0){if((J|0)!=(r|0)){N=U;ie=j;le=se;pe=he;r=149;continue}if(!((G<<t|0)%(1<<s|0)|0)){N=U;ie=j;le=se;pe=he;r=149;continue}}$=f[u+(j<<4)+8>>2]|0;if(!$){N=U;ie=j;le=se;pe=he;r=149;continue}if((X|0)==(o|0)|((G|0)==(a|0)?1:(f[u+(j<<4)+12>>2]|0)==0)){N=U;ie=j;le=se;pe=he;r=149}else{r=143;break}}if((r|0)==143){ee=(((Y+J|0)/(V|0)|0)>>Z)-(G>>Z)+(ce((((q+Q|0)/(W|0)|0)>>K)-(X>>K)|0,$)|0)|0;f[e+32>>2]=ee;ee=f[e+64>>2]|0;F=e+36|0;f[F>>2]=ee;te=se;de=he;r=144;continue}else if((r|0)==151){I=f[e+228>>2]|0;H=e+220|0;g=f[H>>2]|0;I=g+I-((g|0)%(I|0)|0)|0;f[H>>2]=I;H=oe;g=ue;r=130;continue}}if((r|0)==146){r=0;re=ce(f[e+8>>2]|0,ee)|0;re=(ce(f[e+12>>2]|0,f[e+28>>2]|0)|0)+re|0;re=re+(ce(f[e+16>>2]|0,te)|0)|0;re=re+(ce(f[e+20>>2]|0,f[e+32>>2]|0)|0)|0;re=(f[e+4>>2]|0)+(re<<1)|0;if(!(d[re>>1]|0))break;else{D=F;ne=ee;ae=te;fe=de;r=148;continue}}else if((r|0)==152){B=H+1|0;f[e+24>>2]=B;r=121;continue}}if((r|0)==153)return ft|0;d[re>>1]=1;e=1;return e|0}default:{e=0;return e|0}}return 0}function Dr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=(f[t+(r*5640|0)+420>>2]|0)+1|0;n=qi(c,232)|0;if(!n){c=0;return c|0}if(!c){c=n;return c|0}l=e+16|0;a=t+(r*5640|0)+5584|0;e=f[l>>2]|0;o=n;s=0;e:while(1){t=qi(e,16)|0;i=o+196|0;f[i>>2]=t;if(!t){e=5;break}u=f[l>>2]|0;f[o+192>>2]=u;t:do{if(!u)e=0;else{e=(f[a>>2]|0)+4|0;u=qi(f[e>>2]|0,16)|0;f[t+12>>2]=u;if(!u){e=18;break e}else r=0;while(1){f[t+(r<<4)+8>>2]=f[e>>2];r=r+1|0;e=f[l>>2]|0;if(r>>>0>=e>>>0)break t;t=f[i>>2]|0;e=(f[a>>2]|0)+(r*1080|0)+4|0;u=qi(f[e>>2]|0,16)|0;f[t+(r<<4)+12>>2]=u;if(!u){e=18;break e}}}}while(0);s=s+1|0;if(s>>>0>=c>>>0){e=32;break}else o=o+232|0}if((e|0)==5){e=n+4|0;t=f[e>>2]|0;if(!t){l=n;u=0}else{Ji(t);f[e>>2]=0;l=n;u=0}while(1){s=l+196|0;e=f[s>>2]|0;if(e){o=l+192|0;t=f[o>>2]|0;if(t){a=0;while(1){r=e+12|0;i=f[r>>2]|0;if(i){Ji(i);f[r>>2]=0;t=f[o>>2]|0}a=a+1|0;if(a>>>0>=t>>>0)break;else e=e+16|0}e=f[s>>2]|0}Ji(e);f[s>>2]=0}u=u+1|0;if((u|0)==(c|0))break;else l=l+232|0}Ji(n);c=0;return c|0}else if((e|0)==18){e=n+4|0;t=f[e>>2]|0;if(!t){l=n;u=0}else{Ji(t);f[e>>2]=0;l=n;u=0}while(1){s=l+196|0;e=f[s>>2]|0;if(e){o=l+192|0;t=f[o>>2]|0;if(t){a=0;while(1){r=e+12|0;i=f[r>>2]|0;if(i){Ji(i);f[r>>2]=0;t=f[o>>2]|0}a=a+1|0;if(a>>>0>=t>>>0)break;else e=e+16|0}e=f[s>>2]|0}Ji(e);f[s>>2]=0}u=u+1|0;if((u|0)==(c|0))break;else l=l+232|0}Ji(n);c=0;return c|0}else if((e|0)==32)return n|0;return 0}function Fr(e,t,r,n,i,a,o,s,l,u,c,h){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;h=h|0;var d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0;p=f[(f[t+76>>2]|0)+(r*5640|0)+5584>>2]|0;d=f[e+24>>2]|0;I=f[t+24>>2]|0;C=t+12|0;L=(ce(f[C>>2]|0,(r>>>0)%(I>>>0)|0)|0)+(f[t+4>>2]|0)|0;P=f[e>>2]|0;f[n>>2]=L>>>0>P>>>0?L:P;L=Wl(f[C>>2]|0,0,L|0,0)|0;L=L|0-B;C=f[e+8>>2]|0;f[i>>2]=L>>>0<C>>>0?L:C;C=t+16|0;I=(ce(f[C>>2]|0,(r>>>0)/(I>>>0)|0)|0)+(f[t+8>>2]|0)|0;L=f[e+4>>2]|0;f[a>>2]=I>>>0>L>>>0?I:L;I=Wl(f[C>>2]|0,0,I|0,0)|0;I=I|0-B;C=f[e+12>>2]|0;f[o>>2]=I>>>0<C>>>0?I:C;f[u>>2]=0;f[c>>2]=0;f[s>>2]=2147483647;f[l>>2]=2147483647;C=e+16|0;if(!(f[C>>2]|0))return;else I=0;while(1){v=f[h+(I<<2)>>2]|0;m=f[d>>2]|0;e=((f[n>>2]|0)+-1+m|0)/(m|0)|0;P=d+4|0;g=f[P>>2]|0;r=((f[a>>2]|0)+-1+g|0)/(g|0)|0;m=(m+-1+(f[i>>2]|0)|0)/(m|0)|0;g=(g+-1+(f[o>>2]|0)|0)/(g|0)|0;L=p+4|0;t=f[L>>2]|0;if(t>>>0>(f[c>>2]|0)>>>0){f[c>>2]=t;t=f[L>>2]|0}if(t){R=Wl(e|0,((e|0)<0)<<31>>31|0,-1,-1)|0;k=B;S=Wl(r|0,((r|0)<0)<<31>>31|0,-1,-1)|0;A=B;T=Wl(m|0,((m|0)<0)<<31>>31|0,-1,-1)|0;M=B;w=Wl(g|0,((g|0)<0)<<31>>31|0,-1,-1)|0;x=B;E=0;while(1){t=t+-1|0;m=f[p+812+(E<<2)>>2]|0;b=f[p+944+(E<<2)>>2]|0;f[v>>2]=m;f[v+4>>2]=b;y=f[d>>2]<<m+t;H=f[P>>2]<<b+t;e=f[s>>2]|0;f[s>>2]=(e|0)<(y|0)?e:y;y=f[l>>2]|0;f[l>>2]=(y|0)<(H|0)?y:H;H=Gl(1,0,t|0)|0;y=B;e=Wl(R|0,k|0,H|0,y|0)|0;e=jl(e|0,B|0,t|0)|0;g=Wl(S|0,A|0,H|0,y|0)|0;g=jl(g|0,B|0,t|0)|0;r=Wl(T|0,M|0,H|0,y|0)|0;r=jl(r|0,B|0,t|0)|0;y=Wl(w|0,x|0,H|0,y|0)|0;y=jl(y|0,B|0,t|0)|0;H=Gl(1,0,b|0)|0;_=B;O=Wl(y|0,((y|0)<0)<<31>>31|0,-1,-1)|0;_=Wl(O|0,B|0,H|0,_|0)|0;_=jl(_|0,B|0,b|0)|0;if((e|0)==(r|0))e=0;else{r=Wl(r|0,((r|0)<0)<<31>>31|0,-1,-1)|0;H=B;O=Gl(1,0,m|0)|0;O=Wl(r|0,H|0,O|0,B|0)|0;O=jl(O|0,B|0,m|0)|0;e=(O<<m)-(e>>m<<m)>>m}O=(g|0)==(y|0)?0:(_<<b)-(g>>b<<b)>>b;f[v+8>>2]=e;f[v+12>>2]=O;e=ce(e,O)|0;if(e>>>0>(f[u>>2]|0)>>>0)f[u>>2]=e;E=E+1|0;if(E>>>0>=(f[L>>2]|0)>>>0)break;else v=v+16|0}}I=I+1|0;if(I>>>0>=(f[C>>2]|0)>>>0)break;else{d=d+52|0;p=p+1080|0}}return}function Nr(e,t,r,n,i,a,o,s,l){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;var u=0,c=0;u=(f[e+(t*5640|0)+420>>2]|0)+1|0;f[e+(t*5640|0)+500>>2]=f[e+(t*5640|0)+428>>2];f[e+(t*5640|0)+516>>2]=f[e+(t*5640|0)+440>>2];f[e+(t*5640|0)+496>>2]=f[e+(t*5640|0)+424>>2];f[e+(t*5640|0)+512>>2]=f[e+(t*5640|0)+436>>2];f[e+(t*5640|0)+508>>2]=f[e+(t*5640|0)+432>>2];f[e+(t*5640|0)+492>>2]=0;f[e+(t*5640|0)+460>>2]=f[e+(t*5640|0)+456>>2];f[e+(t*5640|0)+504>>2]=0;f[e+(t*5640|0)+520>>2]=o;f[e+(t*5640|0)+524>>2]=r;f[e+(t*5640|0)+528>>2]=n;f[e+(t*5640|0)+532>>2]=i;f[e+(t*5640|0)+536>>2]=a;f[e+(t*5640|0)+540>>2]=s;f[e+(t*5640|0)+544>>2]=l;if(u>>>0<=1)return;e=e+(t*5640|0)+572|0;t=1;while(1){f[e+76>>2]=f[e+4>>2];f[e+92>>2]=f[e+16>>2];f[e+72>>2]=f[e>>2];f[e+88>>2]=f[e+12>>2];c=f[e+8>>2]|0;f[e+84>>2]=c;f[e+36>>2]=f[e+32>>2];f[e+80>>2]=0;f[e+68>>2]=c>>>0>(f[e+-64>>2]|0)>>>0?c:0;f[e+96>>2]=o;f[e+100>>2]=r;f[e+104>>2]=n;f[e+108>>2]=i;f[e+112>>2]=a;f[e+116>>2]=s;f[e+120>>2]=l;t=t+1|0;if((t|0)==(u|0))break;else e=e+148|0}return}function Ur(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=f[t+76>>2]|0;if((e|0)>-1)a=e;else{r=0;return r|0}e:while(1){switch(h[i+a>>0]|0){case 82:{o=3;break e}case 67:{o=5;break e}case 76:{o=7;break e}case 80:{o=9;break e}default:{}}a=a+-1|0}if((o|0)==3)if((f[s+(r*5640|0)+424+(n*148|0)+128>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+88>>2]|0))return(Ur(e+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}else if((o|0)==5)if((f[s+(r*5640|0)+424+(n*148|0)+132>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+92>>2]|0))return(Ur(e+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}else if((o|0)==7)if((f[s+(r*5640|0)+424+(n*148|0)+124>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+84>>2]|0))return(Ur(e+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}else if((o|0)==9){if((f[s+(r*5640|0)+424+(n*148|0)+36>>2]|0)>>>0<2)if((f[s+(r*5640|0)+424+(n*148|0)+136>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+96>>2]|0))return(Ur(a+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}if((f[s+(r*5640|0)+424+(n*148|0)+140>>2]|0)!=(f[s+(r*5640|0)+424+(n*148|0)+104>>2]|0)){r=1;return r|0}if((f[s+(r*5640|0)+424+(n*148|0)+144>>2]|0)==(f[s+(r*5640|0)+424+(n*148|0)+112>>2]|0))return(Ur(a+-1|0,t,r,n,i)|0)!=0|0;else{r=1;return r|0}}return 0}function Br(e){e=e|0;var t=0,r=0;t=qi(1,44)|0;if(!t){e=0;return e|0}r=t+40|0;h[r>>0]=h[r>>0]&-2|(e|0)!=0;e=qi(1,4)|0;f[t+20>>2]=e;if(e){r=t;return r|0}Ji(t);r=0;return r|0}function zr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0;B=b;b=b+1200|0;U=B;n=f[f[e+20>>2]>>2]|0;N=n+16|0;i=f[N>>2]|0;if(!i){b=B;return}O=n+20|0;D=(f[e+32>>2]|0)+8|0;F=(f[e+28>>2]|0)+88|0;I=e+24|0;H=(t|0)==0;L=(r|0)==0;C=t+-1|0;n=i;P=0;do{s=f[O>>2]|0;l=f[D>>2]|0;R=f[s+(P*52|0)+16>>2]|0;if(l){if(R){e=f[F>>2]|0;a=+((f[(f[(f[I>>2]|0)+24>>2]|0)+(P*52|0)+24>>2]|0)>>>0)*.0625;i=0;do{r=ce(R,i)|0;o=0;do{k=(r+o|0)*3|0;f[U+(i*120|0)+(o*12|0)>>2]=~~(+(f[e+(k<<2)>>2]|0)*a);f[U+(i*120|0)+(o*12|0)+4>>2]=~~(+(f[e+(k+1<<2)>>2]|0)*a);f[U+(i*120|0)+(o*12|0)+8>>2]=~~(+(f[e+(k+2<<2)>>2]|0)*a);o=o+1|0}while(o>>>0<R>>>0);i=i+1|0}while(i>>>0<l>>>0);k=9}}else k=9;if((k|0)==9){k=0;if(R){w=s+(P*52|0)+24|0;A=0;do{x=f[w>>2]|0;T=x+(A*136|0)+24|0;n=f[T>>2]|0;if(n){M=x+(A*136|0)+16|0;S=x+(A*136|0)+20|0;e=f[S>>2]|0;r=f[M>>2]|0;E=0;do{if(ce(e,r)|0){v=x+(A*136|0)+28+(E*36|0)+20|0;y=U+(t*120|0)+(A*12|0)+(E<<2)|0;_=U+(C*120|0)+(A*12|0)+(E<<2)|0;g=0;do{n=f[v>>2]|0;m=ce(f[n+(g*40|0)+20>>2]|0,f[n+(g*40|0)+16>>2]|0)|0;if(m){c=n+(g*40|0)+24|0;h=f[y>>2]|0;p=0;do{l=f[c>>2]|0;u=l+(p*52|0)|0;d=f[l+(p*52|0)+4>>2]|0;n=(f[(f[(f[I>>2]|0)+24>>2]|0)+(P*52|0)+24>>2]|0)-(f[l+(p*52|0)+28>>2]|0)|0;if(!H){e=f[_>>2]|0;r=h-e|0;if((e|0)<=(n|0)){r=r+(e-n)|0;r=(r|0)<0?0:r}}else{f[l+(p*52|0)+44>>2]=0;r=(h|0)>(n|0)?h-n|0:0}s=l+(p*52|0)+44|0;i=f[s>>2]|0;o=(i|0)==0;if(o)if(!r)r=0;else r=(r*3|0)+-2|0;else r=(r*3|0)+i|0;f[d+(t*24|0)>>2]=r-i;do{if((r|0)!=(i|0)){e=f[l+(p*52|0)+8>>2]|0;n=f[e+((r+-1|0)*24|0)>>2]|0;if(o)f[d+(t*24|0)+16>>2]=f[u>>2];else{l=f[e+((i+-1|0)*24|0)>>2]|0;f[d+(t*24|0)+16>>2]=(f[u>>2]|0)+l;n=n-l|0}f[d+(t*24|0)+4>>2]=n;if(L)break;f[s>>2]=r}}while(0);p=p+1|0}while(p>>>0<m>>>0);e=f[S>>2]|0;r=f[M>>2]|0}g=g+1|0}while(g>>>0<(ce(e,r)|0)>>>0);n=f[T>>2]|0}E=E+1|0}while(E>>>0<n>>>0)}A=A+1|0}while(A>>>0<R>>>0);n=f[N>>2]|0}}P=P+1|0}while(P>>>0<n>>>0);b=B;return}function jr(e,t,r,n){e=e|0;t=t|0;r=+r;n=n|0;var i=0,a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0;e=f[f[e+20>>2]>>2]|0;C=e+40+(t<<3)|0;y[C>>3]=0.0;I=e+16|0;i=f[I>>2]|0;if(!i)return;P=e+20|0;L=(t|0)==0;k=(n|0)==0;e=i;R=0;do{i=f[P>>2]|0;A=f[i+(R*52|0)+16>>2]|0;if(A){E=i+(R*52|0)+24|0;S=0;do{w=f[E>>2]|0;x=w+(S*136|0)+24|0;e=f[x>>2]|0;if(e){T=w+(S*136|0)+16|0;M=w+(S*136|0)+20|0;i=f[M>>2]|0;n=f[T>>2]|0;b=0;do{if(ce(i,n)|0){_=w+(S*136|0)+28+(b*36|0)+20|0;v=0;do{e=f[_>>2]|0;g=ce(f[e+(v*40|0)+20>>2]|0,f[e+(v*40|0)+16>>2]|0)|0;if(g){h=e+(v*40|0)+24|0;m=0;do{l=f[h>>2]|0;u=l+(m*52|0)|0;d=f[l+(m*52|0)+4>>2]|0;p=l+(m*52|0)+44|0;if(L){f[p>>2]=0;c=0}else c=f[p>>2]|0;n=f[l+(m*52|0)+48>>2]|0;if(c>>>0<n>>>0){o=f[l+(m*52|0)+8>>2]|0;e=c;s=c;do{i=f[o+(s*24|0)>>2]|0;a=+y[o+(s*24|0)+8>>3];if(e){O=e+-1|0;a=a-+y[o+(O*24|0)+8>>3];i=i-(f[o+(O*24|0)>>2]|0)|0}do{if(!i){if(!(a!=0.0))break;e=s+1|0}else{if(!(r-a/+(i>>>0)<2.220446049250313e-16))break;e=s+1|0}}while(0);s=s+1|0}while(s>>>0<n>>>0);o=e;f[d+(t*24|0)>>2]=o-c;if((o|0)!=(c|0)){n=o+-1|0;i=f[l+(m*52|0)+8>>2]|0;e=f[i+(n*24|0)>>2]|0;if(!c){f[d+(t*24|0)+16>>2]=f[u>>2];a=+y[i+(n*24|0)+8>>3]}else{c=c+-1|0;O=f[i+(c*24|0)>>2]|0;f[d+(t*24|0)+16>>2]=(f[u>>2]|0)+O;a=+y[i+(n*24|0)+8>>3]-+y[i+(c*24|0)+8>>3];e=e-O|0}f[d+(t*24|0)+4>>2]=e;y[d+(t*24|0)+8>>3]=a;y[C>>3]=a+ +y[C>>3];if(!k)f[p>>2]=o}else H=26}else{f[d+(t*24|0)>>2]=0;H=26}if((H|0)==26){H=0;y[d+(t*24|0)+8>>3]=0.0}m=m+1|0}while(m>>>0<g>>>0);i=f[M>>2]|0;n=f[T>>2]|0}v=v+1|0}while(v>>>0<(ce(i,n)|0)>>>0);e=f[x>>2]|0}b=b+1|0}while(b>>>0<e>>>0)}S=S+1|0}while(S>>>0<A>>>0);e=f[I>>2]|0}R=R+1|0}while(R>>>0<e>>>0);return}function Vr(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0.0,l=0.0,u=0.0,c=0.0,p=0.0,m=0.0,g=0,_=0,E=0,w=0,x=0.0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0.0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0;Y=b;b=b+800|0;X=Y;V=f[e+28>>2]|0;G=f[f[e+20>>2]>>2]|0;W=f[e+32>>2]|0;B=G+24|0;f[B>>2]=0;z=f[G+16>>2]|0;if(!z){a=0;O=0.0;s=0.0;u=1797693134862315708145274.0e284}else{N=f[G+20>>2]|0;U=f[(f[e+24>>2]|0)+24>>2]|0;a=0;j=0;l=0.0;s=0.0;u=1797693134862315708145274.0e284;do{H=N+(j*52|0)+48|0;f[H>>2]=0;D=f[N+(j*52|0)+16>>2]|0;if(!D)o=0;else{F=f[N+(j*52|0)+24>>2]|0;o=0;I=0;do{P=f[F+(I*136|0)+24>>2]|0;if(P){L=ce(f[F+(I*136|0)+20>>2]|0,f[F+(I*136|0)+16>>2]|0)|0;C=(L|0)==0;k=0;do{if(!C){R=f[F+(I*136|0)+28+(k*36|0)+20>>2]|0;A=0;do{M=ce(f[R+(A*40|0)+20>>2]|0,f[R+(A*40|0)+16>>2]|0)|0;if(M){S=f[R+(A*40|0)+24>>2]|0;T=0;do{E=f[S+(T*52|0)+48>>2]|0;if(E){w=f[S+(T*52|0)+8>>2]|0;_=0;do{g=f[w+(_*24|0)>>2]|0;c=+y[w+(_*24|0)+8>>3];if(_){q=_+-1|0;c=c-+y[w+(q*24|0)+8>>3];g=g-(f[w+(q*24|0)>>2]|0)|0}do{if(g){c=c/+(g|0);u=c<u?c:u;if(!(c>l))break;l=c}}while(0);_=_+1|0}while(_>>>0<E>>>0)}q=ce((f[S+(T*52|0)+24>>2]|0)-(f[S+(T*52|0)+16>>2]|0)|0,(f[S+(T*52|0)+20>>2]|0)-(f[S+(T*52|0)+12>>2]|0)|0)|0;a=q+a|0;o=q+o|0;T=T+1|0}while(T>>>0<M>>>0);f[B>>2]=a;f[H>>2]=o}A=A+1|0}while(A>>>0<L>>>0)}k=k+1|0}while(k>>>0<P>>>0)}I=I+1|0}while(I>>>0<D>>>0)}O=+(1<<f[U+(j*52|0)+24>>2]|0)+-1.0;s=s+ +(o|0)*(O*O);j=j+1|0}while(j>>>0<z>>>0);O=l}H=(i|0)!=0;if(H){j=f[e+36>>2]|0;z=f[i+88>>2]|0;f[z+(j*592|0)+552>>2]=a;y[z+(j*592|0)+560>>3]=+y[G+32>>3];a=W+8|0;q=Yi(f[a>>2]<<3)|0;f[z+(j*592|0)>>2]=q;if(!q){q=0;b=Y;return q|0}}else a=W+8|0;if(!(f[a>>2]|0)){q=1;b=Y;return q|0}M=G+32|0;S=V+93|0;A=e+36|0;R=i+88|0;k=G+40|0;P=e+24|0;L=e+8|0;C=e+16|0;I=0;while(1){l=+v[W+20+(I<<2)>>2];if(l!=0.0){w=~~+ue(+l)>>>0;w=w>>>0<n>>>0?w:n}else w=n;m=+v[W+5184+(I<<2)>>2];x=+y[M>>3]-s/+$(10.0,+(m/10.0));q=h[S>>0]|0;if(!((q&1)!=0&l>0.0)?!((q&4)!=0&m>0.0):0)l=u;else{T=is(f[P>>2]|0,V)|0;if(!T){a=0;o=57;break}E=I+1|0;o=X+(I+-1<<3)|0;g=G+40+(I<<3)|0;if(!I){p=O;o=0;m=u;c=0.0;do{l=(m+p)*.5;jr(e,0,l,0);do{if(h[S>>0]&4){if(((d[V>>1]|0)+-3&65535)>=4){q=+y[k>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c;break}if(!(rs(T,f[A>>2]|0,G,E,t,r,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0))m=l;else{q=+y[k>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c}}else{q=(rs(T,f[A>>2]|0,G,E,t,r,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0)==0;p=q?p:l;m=q?l:m;c=q?c:l}}while(0);o=o+1|0}while((o|0)!=128)}else{p=O;_=0;m=u;c=0.0;do{l=(m+p)*.5;jr(e,I,l,0);do{if(h[S>>0]&4){if(((d[V>>1]|0)+-3&65535)>=4){q=+y[o>>3]+ +y[g>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c;break}if(!(rs(T,f[A>>2]|0,G,E,t,r,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0))m=l;else{q=+y[o>>3]+ +y[g>>3]<x;p=q?l:p;m=q?m:l;c=q?l:c}}else{q=(rs(T,f[A>>2]|0,G,E,t,r,w,i,f[L>>2]|0,f[e>>2]|0,f[C>>2]|0,0)|0)==0;p=q?p:l;m=q?l:m;c=q?c:l}}while(0);_=_+1|0}while((_|0)!=128)}as(T);l=c==0.0?l:c}if(H)y[(f[(f[R>>2]|0)+((f[A>>2]|0)*592|0)>>2]|0)+(I<<3)>>3]=l;jr(e,I,l,1);if(!I)l=+y[k>>3];else l=+y[X+(I+-1<<3)>>3]+ +y[G+40+(I<<3)>>3];y[X+(I<<3)>>3]=l;I=I+1|0;if(I>>>0>=(f[a>>2]|0)>>>0){a=1;o=57;break}}if((o|0)==57){b=Y;return a|0}return 0}function Gr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;f[e+24>>2]=t;f[e+28>>2]=r;i=qi(1,848)|0;n=e+20|0;f[f[n>>2]>>2]=i;if(!i){e=0;return e|0}i=t+16|0;a=qi(f[i>>2]|0,52)|0;t=f[f[n>>2]>>2]|0;f[t+20>>2]=a;if(!a){a=0;return a|0}f[t+16>>2]=f[i>>2];f[e>>2]=f[r+84>>2];a=1;return a|0}function Wr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;if(!e)return;y=e+20|0;t=f[y>>2]|0;do{if(t){v=(h[e+40>>0]&1)==0?3:4;r=f[t>>2]|0;if(r){p=r+20|0;l=r+16|0;if(f[l>>2]|0){c=0;d=f[p>>2]|0;while(1){u=d+24|0;t=f[u>>2]|0;if(t){o=f[d+28>>2]|0;s=(o>>>0)/136|0;if(o>>>0>135){o=0;while(1){a=t+48|0;r=f[a>>2]|0;if(r){n=f[t+52>>2]|0;i=(n>>>0)/40|0;if(n>>>0>39){n=0;while(1){_=r+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=r+36|0;fo(f[_>>2]|0);f[_>>2]=0;Lu[v&7](r);n=n+1|0;if(n>>>0>=i>>>0)break;else r=r+40|0}r=f[a>>2]|0}Ji(r);f[a>>2]=0}a=t+84|0;r=f[a>>2]|0;if(r){_=f[t+88>>2]|0;i=(_>>>0)/40|0;if(_>>>0>39){n=0;while(1){_=r+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=r+36|0;fo(f[_>>2]|0);f[_>>2]=0;Lu[v&7](r);n=n+1|0;if(n>>>0>=i>>>0)break;else r=r+40|0}r=f[a>>2]|0}Ji(r);f[a>>2]=0}a=t+120|0;r=f[a>>2]|0;if(r){_=f[t+124>>2]|0;i=(_>>>0)/40|0;if(_>>>0>39){n=0;while(1){_=r+32|0;fo(f[_>>2]|0);f[_>>2]=0;_=r+36|0;fo(f[_>>2]|0);f[_>>2]=0;Lu[v&7](r);n=n+1|0;if(n>>>0>=i>>>0)break;else r=r+40|0}r=f[a>>2]|0}Ji(r);f[a>>2]=0}o=o+1|0;if(o>>>0>=s>>>0)break;else t=t+136|0}t=f[u>>2]|0}Ji(t);f[u>>2]=0}if((f[d+36>>2]|0)!=0?(m=d+32|0,g=f[m>>2]|0,(g|0)!=0):0){Ki(g);f[m>>2]=0;f[m+4>>2]=0;f[m+8>>2]=0;f[m+12>>2]=0}c=c+1|0;if(c>>>0>=(f[l>>2]|0)>>>0)break;else d=d+52|0}}Ji(f[p>>2]|0);f[p>>2]=0;Ji(f[f[y>>2]>>2]|0);t=f[y>>2]|0;f[t>>2]=0;if(!t)break}Ji(t);f[y>>2]=0}}while(0);Ji(e);return}function Xr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;n=e+32|0;i=f[n>>2]|0;t=e+40|0;r=f[t>>2]|0;if(i){a=e+44|0;if(r>>>0<=(f[a>>2]|0)>>>0){e=1;return e|0}if(f[e+36>>2]|0){Ki(i);i=Zi(f[t>>2]|0)|0;f[n>>2]=i;if(!i){f[a>>2]=0;f[t>>2]=0;f[e+36>>2]=0;e=0;return e|0}else{f[a>>2]=f[t>>2];f[e+36>>2]=1;e=1;return e|0}}}a=Zi(r)|0;f[n>>2]=a;if(!a){e=0;return e|0}f[e+44>>2]=f[t>>2];f[e+36>>2]=1;e=1;return e|0}function Yr(e,t,r){e=e|0;t=t|0;r=r|0;return nn(e,t,1,1.0,52,r)|0}function qr(e,t,r){e=e|0;t=t|0;r=r|0;return nn(e,t,0,.5,56,r)|0}function Zr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0;r=f[e+24>>2]|0;i=f[r+16>>2]|0;if(!i){a=0;return a|0}a=0;t=0;n=f[r+24>>2]|0;r=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){s=f[n+24>>2]|0;s=((s&7|0)!=0&1)+(s>>>3)|0;o=f[r+24>>2]|0;e=(f[r+20>>2]|0)+-1|0;t=(ce(ce((s|0)==3?4:s,(f[o+(e*136|0)+8>>2]|0)-(f[o+(e*136|0)>>2]|0)|0)|0,(f[o+(e*136|0)+12>>2]|0)-(f[o+(e*136|0)+4>>2]|0)|0)|0)+t|0;a=a+1|0;if(a>>>0>=i>>>0)break;else{n=n+52|0;r=r+52|0}}return t|0}function Kr(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0;T=b;b=b+16|0;w=T;if(!(f[e+8>>2]|0)){f[e+36>>2]=t;_=e+28|0;o=f[(f[_>>2]|0)+76>>2]|0;x=e+32|0;f[x>>2]=o+(t*5640|0);E=(a|0)==0;y=e+20|0;if(!E){s=f[(f[f[y>>2]>>2]|0)+20>>2]|0;d=f[o+(t*5640|0)+5584>>2]|0;p=s+16|0;if(!(f[p>>2]|0)){s=a+88|0;o=0}else{l=f[s+24>>2]|0;s=a+88|0;u=f[s>>2]|0;c=0;o=0;do{v=l+(c*136|0)+16|0;f[u+(t*592|0)+20+(c<<2)>>2]=f[v>>2];g=l+(c*136|0)+20|0;f[u+(t*592|0)+152+(c<<2)>>2]=f[g>>2];o=(ce(f[g>>2]|0,f[v>>2]|0)|0)+o|0;f[u+(t*592|0)+284+(c<<2)>>2]=f[d+812+(c<<2)>>2];f[u+(t*592|0)+416+(c<<2)>>2]=f[d+944+(c<<2)>>2];c=c+1|0}while(c>>>0<(f[p>>2]|0)>>>0)}v=qi(ce(ce(f[a+52>>2]|0,o)|0,f[a+56>>2]|0)|0,32)|0;f[(f[s>>2]|0)+(t*592|0)+548>>2]=v;if(!v){e=0;b=T;return e|0}}o=f[f[y>>2]>>2]|0;v=o+16|0;if(!(f[v>>2]|0)){c=f[x>>2]|0;l=0;s=f[o+20>>2]|0}else{c=f[x>>2]|0;s=f[o+20>>2]|0;t=0;m=f[c+5584>>2]|0;g=s;while(1){d=f[g+32>>2]|0;p=ce((f[g+12>>2]|0)-(f[g+4>>2]|0)|0,(f[g+8>>2]|0)-(f[g>>2]|0)|0)|0;o=(p|0)==0;if((f[m+20>>2]|0)==1){if(!o){l=m+1076|0;u=0;o=d;while(1){f[o>>2]=(f[o>>2]|0)-(f[l>>2]|0);u=u+1|0;if((u|0)==(p|0))break;else o=o+4|0}}}else if(!o){l=m+1076|0;u=0;o=d;while(1){f[o>>2]=(f[o>>2]|0)-(f[l>>2]|0)<<11;u=u+1|0;if((u|0)==(p|0))break;else o=o+4|0}}t=t+1|0;l=f[v>>2]|0;if(t>>>0>=l>>>0)break;else{m=m+1080|0;g=g+52|0}}}d=ce((f[s+12>>2]|0)-(f[s+4>>2]|0)|0,(f[s+8>>2]|0)-(f[s>>2]|0)|0)|0;e:do{switch(f[c+16>>2]|0){case 0:break;case 2:{if(f[c+5608>>2]|0){u=Yi(l<<2)|0;if(!u){e=0;b=T;return e|0}o=f[v>>2]|0;if(!o)o=0;else{l=0;while(1){f[u+(l<<2)>>2]=f[s+32>>2];l=l+1|0;if((l|0)==(o|0))break;else s=s+52|0}}v=(Ar(f[(f[x>>2]|0)+5608>>2]|0,d,u,o,f[(f[(f[e+24>>2]|0)+24>>2]|0)+32>>2]|0)|0)==0;Ji(u);if(v){e=0;b=T;return e|0}}break}default:{l=f[s+32>>2]|0;u=f[s+84>>2]|0;o=f[s+136>>2]|0;if(!(f[(f[c+5584>>2]|0)+20>>2]|0)){Mr(l,u,o,d);break e}else{xr(l,u,o,d);break e}}}}while(0);o=f[f[y>>2]>>2]|0;s=o+16|0;e:do{if(f[s>>2]|0){l=0;u=f[(f[x>>2]|0)+5584>>2]|0;o=f[o+20>>2]|0;t:while(1){switch(f[u+20>>2]|0){case 1:{if(!(Co(o)|0)){o=0;s=54;break t}break}case 0:{if(!(Do(o)|0)){o=0;s=54;break t}break}default:{}}l=l+1|0;if(l>>>0>=(f[s>>2]|0)>>>0)break e;else{u=u+1080|0;o=o+52|0}}if((s|0)==54){b=T;return o|0}}}while(0);o=f[x>>2]|0;s=Zo(1)|0;if(!s){e=0;b=T;return e|0}do{if((f[o+16>>2]|0)==1)if(!(f[(f[o+5584>>2]|0)+20>>2]|0)){l=wr()|0;u=3;break}else{l=Er()|0;u=3;break}else{l=f[o+5600>>2]|0;u=f[(f[e+24>>2]|0)+16>>2]|0}}while(0);y=Jo(s,f[f[y>>2]>>2]|0,o,l,u)|0;Ko(s);if(!y){e=0;b=T;return e|0}o=f[_>>2]|0;f[w>>2]=0;if(!E)f[a+12>>2]=0;if(!(h[o+93>>0]&5)){if(f[(f[x>>2]|0)+8>>2]|0){o=0;do{zr(e,o,1);o=o+1|0}while(o>>>0<(f[(f[x>>2]|0)+8>>2]|0)>>>0)}}else if(!(Vr(e,r,w,i,a)|0)){e=0;b=T;return e|0}}if(a)f[a+12>>2]=1;o=is(f[e+24>>2]|0,f[e+28>>2]|0)|0;if(!o)o=1;else{e=rs(o,f[e+36>>2]|0,f[f[e+20>>2]>>2]|0,f[(f[e+32>>2]|0)+8>>2]|0,r,n,i,a,f[e+4>>2]|0,f[e>>2]|0,f[e+16>>2]|0,1)|0;as(o);o=(e|0)==0}e=o&1^1;b=T;return e|0}function Qr(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,y=0,_=0;_=b;b=b+16|0;u=_+8|0;l=_;s=_+12|0;o=e+36|0;f[o>>2]=n;y=f[e+28>>2]|0;d=e+32|0;f[d>>2]=(f[y+76>>2]|0)+(n*5640|0);f[s>>2]=0;h=e+24|0;n=is(f[h>>2]|0,y)|0;if(!n){y=0;b=_;return y|0}c=e+20|0;y=ns(n,f[o>>2]|0,f[f[c>>2]>>2]|0,t,s,r,i,a)|0;as(n);if(!y){y=0;b=_;return y|0}n=f[f[c>>2]>>2]|0;e=f[(f[d>>2]|0)+5584>>2]|0;o=f[n+20>>2]|0;r=Zo(0)|0;if(!r){y=0;b=_;return y|0}s=n+16|0;e:do{if(f[s>>2]|0){i=0;n=o;while(1){if(!(Qo(r,n,e)|0))break;i=i+1|0;if(i>>>0>=(f[s>>2]|0)>>>0)break e;else{e=e+1080|0;n=n+52|0}}Ko(r);y=0;b=_;return y|0}}while(0);Ko(r);n=f[f[c>>2]>>2]|0;o=n+16|0;do{if(f[o>>2]|0){s=0;i=f[(f[h>>2]|0)+24>>2]|0;r=f[(f[d>>2]|0)+5584>>2]|0;e=f[n+20>>2]|0;while(1){n=(f[i+36>>2]|0)+1|0;if((f[r+20>>2]|0)==1){if(!(Io(e,n)|0)){n=0;e=49;break}}else if(!(Bo(e,n)|0)){n=0;e=49;break}s=s+1|0;if(s>>>0>=(f[o>>2]|0)>>>0){e=14;break}else{i=i+52|0;r=r+1080|0;e=e+52|0}}if((e|0)==14){n=f[f[c>>2]>>2]|0;break}else if((e|0)==49){b=_;return n|0}}}while(0);s=f[d>>2]|0;e=f[n+20>>2]|0;o=f[s+16>>2]|0;do{if(o){t=ce((f[e+12>>2]|0)-(f[e+4>>2]|0)|0,(f[e+8>>2]|0)-(f[e>>2]|0)|0)|0;r=n+16|0;n=f[r>>2]|0;if(n>>>0<=2){f[u>>2]=n;Jn(a,1,19703,u)|0;break}if((ce((f[e+64>>2]|0)-(f[e+56>>2]|0)|0,(f[e+60>>2]|0)-(f[e+52>>2]|0)|0)|0)>=(t|0)?(ce((f[e+116>>2]|0)-(f[e+108>>2]|0)|0,(f[e+112>>2]|0)-(f[e+104>>2]|0)|0)|0)>=(t|0):0){if((o|0)!=2){n=f[e+32>>2]|0;if((f[(f[s+5584>>2]|0)+20>>2]|0)==1){Tr(n,f[e+84>>2]|0,f[e+136>>2]|0,t);break}else{Sr(n,f[e+84>>2]|0,f[e+136>>2]|0,t);break}}i=s+5604|0;if(!(f[i>>2]|0))break;s=Yi(n<<2)|0;if(!s){y=0;b=_;return y|0}n=f[r>>2]|0;if(!n)n=0;else{o=0;while(1){f[s+(o<<2)>>2]=f[e+32>>2];o=o+1|0;if((o|0)==(n|0))break;else e=e+52|0}}y=(Rr(f[i>>2]|0,t,s,n,f[(f[(f[h>>2]|0)+24>>2]|0)+32>>2]|0)|0)==0;Ji(s);if(y)n=0;else break;b=_;return n|0}Jn(a,1,19642,l)|0;y=0;b=_;return y|0}}while(0);n=f[f[c>>2]>>2]|0;g=n+16|0;if(!(f[g>>2]|0)){y=1;b=_;return y|0}y=0;m=f[(f[h>>2]|0)+24>>2]|0;p=f[(f[d>>2]|0)+5584>>2]|0;d=f[n+20>>2]|0;while(1){h=f[d+24>>2]|0;a=f[m+36>>2]|0;o=f[h+(a*136|0)+8>>2]|0;s=f[h+(a*136|0)>>2]|0;c=o-s|0;i=f[h+(a*136|0)+12>>2]|0;a=f[h+(a*136|0)+4>>2]|0;h=(f[d+8>>2]|0)-(f[d>>2]|0)-c|0;n=f[m+24>>2]|0;if(!(f[m+32>>2]|0)){n=1<<n;u=0}else{u=1<<n+-1;n=u;u=0-u|0}l=n+-1|0;n=f[d+32>>2]|0;e=(i|0)==(a|0);if((f[p+20>>2]|0)==1){if(!e){r=(o|0)==(s|0);t=p+1076|0;s=i-a|0;i=0;while(1){if(!r){e=0;o=n;while(1){a=(f[t>>2]|0)+(f[o>>2]|0)|0;f[o>>2]=(a|0)<(u|0)?u:(a|0)>(l|0)?l:a;e=e+1|0;if((e|0)==(c|0))break;else o=o+4|0}n=n+(c<<2)|0}i=i+1|0;if((i|0)==(s|0))break;else n=n+(h<<2)|0}}}else if(!e){r=(o|0)==(s|0);t=p+1076|0;s=i-a|0;i=0;while(1){if(!r){e=0;o=n;while(1){a=Hs(+v[o>>2])|0;a=(f[t>>2]|0)+a|0;f[o>>2]=(a|0)<(u|0)?u:(a|0)>(l|0)?l:a;e=e+1|0;if((e|0)==(c|0))break;else o=o+4|0}n=n+(c<<2)|0}i=i+1|0;if((i|0)==(s|0))break;else n=n+(h<<2)|0}}y=y+1|0;if(y>>>0>=(f[g>>2]|0)>>>0){n=1;break}else{m=m+52|0;p=p+1080|0;d=d+52|0}}b=_;return n|0}function Jr(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,g=0;g=e+24|0;u=f[g>>2]|0;i=f[u+16>>2]|0;l=(i|0)==0;if(l){g=1;return g|0}a=0;n=0;o=f[u+24>>2]|0;s=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){c=f[o+24>>2]|0;c=((c&7|0)!=0&1)+(c>>>3)|0;p=f[s+24>>2]|0;m=(f[s+20>>2]|0)+-1|0;n=(ce(ce((c|0)==3?4:c,(f[p+(m*136|0)+8>>2]|0)-(f[p+(m*136|0)>>2]|0)|0)|0,(f[p+(m*136|0)+12>>2]|0)-(f[p+(m*136|0)+4>>2]|0)|0)|0)+n|0;a=a+1|0;if((a|0)==(i|0))break;else{o=o+52|0;s=s+52|0}}n=n>>>0>r>>>0;if(n|l){g=n&1^1;return g|0}m=0;p=f[u+24>>2]|0;c=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){l=f[p+24>>2]|0;e=f[c+24>>2]|0;r=f[p+36>>2]|0;a=f[e+(r*136|0)+8>>2]|0;o=f[e+(r*136|0)>>2]|0;u=a-o|0;s=f[e+(r*136|0)+12>>2]|0;r=f[e+(r*136|0)+4>>2]|0;e=(f[c+8>>2]|0)-(f[c>>2]|0)-u|0;l=((l&7|0)!=0&1)+(l>>>3)|0;e:do{switch(((l|0)==3?4:l)|0){case 1:{n=f[c+32>>2]|0;i=(s|0)==(r|0);if(!(f[p+32>>2]|0)){if(i)break e;l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+u|0;a=0;i=n;while(1){h[t>>0]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+1|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}else{if(i)break e;l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+u|0;a=0;i=n;while(1){h[t>>0]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+1|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}break}case 2:{n=f[c+32>>2]|0;i=(s|0)==(r|0);if(!(f[p+32>>2]|0)){if(!i){l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+(u<<1)|0;a=0;i=n;while(1){d[t>>1]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+2|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}}else if(!i){l=(a|0)==(o|0);s=s-r|0;r=0;while(1){if(!l){o=t+(u<<1)|0;a=0;i=n;while(1){d[t>>1]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+2|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}break}case 4:{if((s|0)!=(r|0)){l=(a|0)==(o|0);s=s-r|0;r=0;n=f[c+32>>2]|0;while(1){if(!l){o=t+(u<<2)|0;a=0;i=n;while(1){f[t>>2]=f[i>>2];a=a+1|0;if((a|0)==(u|0))break;else{t=t+4|0;i=i+4|0}}t=o;n=n+(u<<2)|0}r=r+1|0;if((r|0)==(s|0))break;else n=n+(e<<2)|0}}break}default:{}}}while(0);m=m+1|0;if(m>>>0>=(f[(f[g>>2]|0)+16>>2]|0)>>>0){t=1;break}else{p=p+52|0;c=c+52|0}}return t|0}function $r(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;r=f[e+24>>2]|0;i=f[r+16>>2]|0;if(!i){a=0;return a|0}a=0;t=0;n=f[r+24>>2]|0;r=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){e=f[n+24>>2]|0;e=((e&7|0)!=0&1)+(e>>>3)|0;t=(ce(ce((f[r+12>>2]|0)-(f[r+4>>2]|0)|0,(f[r+8>>2]|0)-(f[r>>2]|0)|0)|0,(e|0)==3?4:e)|0)+t|0;a=a+1|0;if(a>>>0>=i>>>0)break;else{n=n+52|0;r=r+52|0}}return t|0}function en(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,g=0;u=f[e+24>>2]|0;g=u+16|0;i=f[g>>2]|0;l=(i|0)==0;if(l)n=0;else{a=0;n=0;o=f[u+24>>2]|0;s=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){c=f[o+24>>2]|0;c=((c&7|0)!=0&1)+(c>>>3)|0;n=(ce(ce((f[s+12>>2]|0)-(f[s+4>>2]|0)|0,(f[s+8>>2]|0)-(f[s>>2]|0)|0)|0,(c|0)==3?4:c)|0)+n|0;a=a+1|0;if((a|0)==(i|0))break;else{o=o+52|0;s=s+52|0}}}n=(n|0)!=(r|0);if(n|l){g=n&1^1;return g|0}c=0;l=f[u+24>>2]|0;r=f[(f[f[e+20>>2]>>2]|0)+20>>2]|0;while(1){e=f[l+24>>2]|0;n=(f[r+8>>2]|0)-(f[r>>2]|0)|0;i=(f[r+12>>2]|0)-(f[r+4>>2]|0)|0;s=ce(i,n)|0;e=((e&7|0)!=0&1)+(e>>>3)|0;e:do{switch(((e|0)==3?4:e)|0){case 1:{i=f[r+32>>2]|0;n=(s|0)==0;if(!(f[l+32>>2]|0)){if(n)break e;else{a=0;n=i;i=t}while(1){f[n>>2]=p[i>>0];a=a+1|0;if((a|0)==(s|0))break;else{n=n+4|0;i=i+1|0}}t=t+s|0;break e}else{if(n)break e;else{a=0;n=i;i=t}while(1){f[n>>2]=h[i>>0];a=a+1|0;if((a|0)==(s|0))break;else{n=n+4|0;i=i+1|0}}t=t+s|0;break e}}case 2:{o=f[r+32>>2]|0;a=(s|0)==0;if(!(f[l+32>>2]|0)){if(!a){a=t+(ce(i<<1,n)|0)|0;i=0;n=o;while(1){f[n>>2]=m[t>>1];i=i+1|0;if((i|0)==(s|0))break;else{n=n+4|0;t=t+2|0}}t=a}}else if(!a){a=t+(ce(i<<1,n)|0)|0;i=0;n=o;while(1){f[n>>2]=d[t>>1];i=i+1|0;if((i|0)==(s|0))break;else{n=n+4|0;t=t+2|0}}t=a}break}case 4:{if(s){a=t+(ce(i<<2,n)|0)|0;n=0;i=f[r+32>>2]|0;while(1){f[i>>2]=f[t>>2];n=n+1|0;if((n|0)==(s|0))break;else{i=i+4|0;t=t+4|0}}t=a}break}default:{}}}while(0);c=c+1|0;if(c>>>0>=(f[g>>2]|0)>>>0){t=1;break}else{l=l+52|0;r=r+52|0}}return t|0}function tn(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=e+24|0;t=f[a>>2]|0;if(!t)return;i=f[e+28>>2]|0;n=(i>>>0)/52|0;if(i>>>0>51){i=0;while(1){e=f[t>>2]|0;if(e){Ji(e+-1|0);f[t>>2]=0}e=t+4|0;r=f[e>>2]|0;if(r){Ji(r);f[e>>2]=0}e=t+8|0;r=f[e>>2]|0;if(r){Ji(r);f[e>>2]=0}i=i+1|0;if(i>>>0>=n>>>0)break;else t=t+52|0}t=f[a>>2]|0}Ji(t);f[a>>2]=0;return}function rn(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=e+24|0;t=f[a>>2]|0;if(!t)return;i=f[e+28>>2]|0;n=(i>>>0)/56|0;if(i>>>0>55){i=0;while(1){e=f[t>>2]|0;if(e){Ji(e);f[t>>2]=0}r=t+4|0;e=f[r>>2]|0;if(e){Ji(e);f[r>>2]=0}i=i+1|0;if(i>>>0>=n>>>0)break;else t=t+56|0}t=f[a>>2]|0}Ji(t);f[a>>2]=0;return}function nn(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=+n;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Me=0,Se=0,Ae=0,Re=0,ke=0,Pe=0,Le=0,Ce=0,Ie=0,He=0,Oe=0,De=0,Fe=0,Ne=0,Ue=0,Be=0,ze=0,je=0,Ve=0,Ge=0,We=0.0;Ge=b;b=b+80|0;Fe=Ge+64|0;De=Ge+56|0;Ue=Ge+48|0;ze=Ge+40|0;Be=Ge+32|0;je=Ge+24|0;Ne=Ge+16|0;Oe=Ge+8|0;o=f[e+28>>2]|0;He=f[f[e+20>>2]>>2]|0;d=f[(f[o+76>>2]|0)+(t*5640|0)+5584>>2]|0;p=f[He+20>>2]|0;u=f[e+24>>2]|0;c=f[u+24>>2]|0;Le=f[o+24>>2]|0;l=f[o+12>>2]|0;Ie=(ce(l,(t>>>0)%(Le>>>0)|0)|0)+(f[o+4>>2]|0)|0;s=f[u>>2]|0;s=Ie>>>0>s>>>0?Ie:s;f[He>>2]=s;Ie=Wl(l|0,0,Ie|0,0)|0;Ie=Ie|0-B;l=f[u+8>>2]|0;l=Ie>>>0<l>>>0?Ie:l;Ie=He+8|0;f[Ie>>2]=l;Ce=f[o+16>>2]|0;Le=(ce(Ce,(t>>>0)/(Le>>>0)|0)|0)+(f[o+8>>2]|0)|0;t=f[u+4>>2]|0;t=Le>>>0>t>>>0?Le:t;Pe=He+4|0;f[Pe>>2]=t;Le=Wl(Ce|0,0,Le|0,0)|0;Le=Le|0-B;u=f[u+12>>2]|0;u=Le>>>0<u>>>0?Le:u;Le=He+12|0;f[Le>>2]=u;if(!(f[d+4>>2]|0)){Jn(a,1,19777,Ge)|0;Ve=0;b=Ge;return Ve|0}Ce=He+16|0;if(!(f[Ce>>2]|0)){Ve=1;b=Ge;return Ve|0}ke=o+80|0;Re=e+40|0;Ae=(r|0)==0;o=t;Se=0;e:while(1){f[c+36>>2]=0;Ee=f[c>>2]|0;t=(s+-1+Ee|0)/(Ee|0)|0;f[p>>2]=t;we=f[c+4>>2]|0;o=(o+-1+we|0)/(we|0)|0;Me=p+4|0;f[Me>>2]=o;Ee=(l+-1+Ee|0)/(Ee|0)|0;Te=p+8|0;f[Te>>2]=Ee;we=(u+-1+we|0)/(we|0)|0;xe=p+12|0;f[xe>>2]=we;t=Ee-t|0;o=we-o|0;if((4294967295/(t>>>0)|0)>>>0<o>>>0){Ve=6;break}t=ce(o,t)|0;if(t>>>0>1073741823){Ve=8;break}l=t<<2;Ee=f[d+4>>2]|0;we=p+16|0;f[we>>2]=Ee;e=f[ke>>2]|0;f[p+20>>2]=Ee>>>0<e>>>0?1:Ee-e|0;e=p+40|0;f[e>>2]=l;do{if(h[Re>>0]&1){r=p+32|0;s=f[r>>2]|0;if(s){o=p+44|0;if(l>>>0<=(f[o>>2]|0)>>>0)break;t=p+36|0;if(f[t>>2]|0){Ki(s);Ee=Zi(f[e>>2]|0)|0;f[r>>2]=Ee;if(!Ee){Ve=16;break e}f[o>>2]=f[e>>2];f[t>>2]=1;break}}Ee=Zi(l)|0;f[r>>2]=Ee;if(!Ee)break e;f[p+44>>2]=f[e>>2];f[p+36>>2]=1}}while(0);r=(f[we>>2]|0)*136|0;o=p+24|0;e=f[o>>2]|0;if(e){t=p+28|0;if(r>>>0>(f[t>>2]|0)>>>0){e=Qi(e,r)|0;if(!e){Ve=24;break}f[o>>2]=e;Ee=f[t>>2]|0;Vl(e+Ee|0,0,r-Ee|0)|0;f[t>>2]=r}}else{t=Yi(r)|0;f[o>>2]=t;if(!t){t=0;Ve=87;break}f[p+28>>2]=r;Vl(t|0,0,r|0)|0}t=f[we>>2]|0;Ee=(f[d+20>>2]|0)==0?7:8;if(t){ve=d+8|0;ye=d+12|0;_e=c+24|0;be=d+804|0;ge=f[o>>2]|0;o=d+28|0;e=0;while(1){pe=t;me=t+-1|0;he=f[p>>2]|0;de=Gl(1,0,me|0)|0;de=Wl(de|0,B|0,-1,-1)|0;fe=B;he=Wl(de|0,fe|0,he|0,((he|0)<0)<<31>>31|0)|0;he=jl(he|0,B|0,me|0)|0;f[ge>>2]=he;r=f[Me>>2]|0;r=Wl(de|0,fe|0,r|0,((r|0)<0)<<31>>31|0)|0;r=jl(r|0,B|0,me|0)|0;f[ge+4>>2]=r;t=f[Te>>2]|0;t=Wl(de|0,fe|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,me|0)|0;f[ge+8>>2]=t;s=f[xe>>2]|0;s=Wl(de|0,fe|0,s|0,((s|0)<0)<<31>>31|0)|0;s=jl(s|0,B|0,me|0)|0;f[ge+12>>2]=s;m=f[d+812+(e<<2)>>2]|0;u=f[d+944+(e<<2)>>2]|0;g=he>>m<<m;y=r>>u<<u;l=Gl(1,0,u|0)|0;l=Wl(l|0,B|0,-1,-1)|0;l=Wl(l|0,B|0,s|0,((s|0)<0)<<31>>31|0)|0;l=jl(l|0,B|0,u|0)|0;if((he|0)==(t|0))t=0;else{he=Gl(1,0,m|0)|0;he=Wl(he|0,B|0,-1,-1)|0;t=Wl(he|0,B|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,m|0)|0;t=(t<<m)-g>>m}he=ge+16|0;f[he>>2]=t;se=(r|0)==(s|0)?0:(l<<u)-y>>u;f[ge+20>>2]=se;se=ce(se,t)|0;le=se*40|0;ue=(e|0)==0;if(ue)t=1;else{g=Wl(g|0,((g|0)<0)<<31>>31|0,1,0)|0;g=Xl(g|0,B|0,1)|0;y=Wl(y|0,((y|0)<0)<<31>>31|0,1,0)|0;y=Xl(y|0,B|0,1)|0;t=3;u=u+-1|0;m=m+-1|0}oe=ge+24|0;f[oe>>2]=t;G=f[ve>>2]|0;G=G>>>0<m>>>0?G:m;W=f[ye>>2]|0;W=W>>>0<u>>>0?W:u;X=(se|0)!=0;Y=(se|0)==0;q=1<<m;Z=1<<u;K=Gl(1,0,G|0)|0;K=Wl(K|0,B|0,-1,-1)|0;Q=B;J=Gl(1,0,W|0)|0;J=Wl(J|0,B|0,-1,-1)|0;$=B;ee=1<<G;te=1<<W;re=Gl(1,0,pe|0)|0;re=Wl(re|0,B|0,-1,-1)|0;ne=B;ie=0;ae=ge+28|0;V=o;while(1){if(ue){t=f[p>>2]|0;t=Wl(de|0,fe|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,me|0)|0;o=f[Me>>2]|0;o=Wl(de|0,fe|0,o|0,((o|0)<0)<<31>>31|0)|0;o=jl(o|0,B|0,me|0)|0;r=f[Te>>2]|0;r=Wl(de|0,fe|0,r|0,((r|0)<0)<<31>>31|0)|0;r=jl(r|0,B|0,me|0)|0;l=f[xe>>2]|0;l=Wl(de|0,fe|0,l|0,((l|0)<0)<<31>>31|0)|0;l=jl(l|0,B|0,me|0)|0;s=0}else{s=ie+1|0;t=f[p>>2]|0;U=Gl(s&1|0,0,me|0)|0;U=zl(re|0,ne|0,U|0,B|0)|0;l=B;t=Wl(U|0,l|0,t|0,((t|0)<0)<<31>>31|0)|0;t=jl(t|0,B|0,pe|0)|0;o=f[Me>>2]|0;z=Gl(s>>>1|0,0,me|0)|0;z=zl(re|0,ne|0,z|0,B|0)|0;j=B;o=Wl(z|0,j|0,o|0,((o|0)<0)<<31>>31|0)|0;o=jl(o|0,B|0,pe|0)|0;r=f[Te>>2]|0;r=Wl(U|0,l|0,r|0,((r|0)<0)<<31>>31|0)|0;r=jl(r|0,B|0,pe|0)|0;l=f[xe>>2]|0;l=Wl(z|0,j|0,l|0,((l|0)<0)<<31>>31|0)|0;l=jl(l|0,B|0,pe|0)|0}f[ae+16>>2]=s;f[ae>>2]=t;j=ae+4|0;f[j>>2]=o;z=ae+8|0;f[z>>2]=r;U=ae+12|0;f[U>>2]=l;o=Hu[Ee&15](s)|0;We=+(f[V+4>>2]|0)*.00048828125+1.0;We=+Is(1.0,(f[_e>>2]|0)+o-(f[V>>2]|0)|0)*We*n;v[ae+32>>2]=We;f[ae+28>>2]=(f[V>>2]|0)+-1+(f[be>>2]|0);o=ae+20|0;r=f[o>>2]|0;if(!(X&(r|0)==0)){t=ae+24|0;if((f[t>>2]|0)>>>0<le>>>0){r=Qi(r,le)|0;if(!r){Ve=41;break e}f[o>>2]=r;N=f[t>>2]|0;Vl(r+N|0,0,le-N|0)|0;f[t>>2]=le}}else{t=Yi(le)|0;f[o>>2]=t;if(!t){t=0;Ve=87;break e}Vl(t|0,0,le|0)|0;f[ae+24>>2]=le}if(!Y){F=f[o>>2]|0;N=0;while(1){P=f[he>>2]|0;H=(((N>>>0)%(P>>>0)|0)<<m)+g|0;P=(((N>>>0)/(P>>>0)|0)<<u)+y|0;L=H+q|0;C=P+Z|0;I=f[ae>>2]|0;I=(H|0)>(I|0)?H:I;f[F>>2]=I;H=f[j>>2]|0;H=(P|0)>(H|0)?P:H;P=F+4|0;f[P>>2]=H;D=f[z>>2]|0;D=(L|0)<(D|0)?L:D;L=F+8|0;f[L>>2]=D;s=f[U>>2]|0;s=(C|0)<(s|0)?C:s;C=F+12|0;f[C>>2]=s;I=I>>G<<G;H=H>>W<<W;D=Wl(K|0,Q|0,D|0,((D|0)<0)<<31>>31|0)|0;D=jl(D|0,B|0,G|0)|0;s=Wl(J|0,$|0,s|0,((s|0)<0)<<31>>31|0)|0;s=jl(s|0,B|0,W|0)|0;D=(D<<G)-I>>G;O=F+16|0;f[O>>2]=D;s=(s<<W)-H>>W;_=F+20|0;f[_>>2]=s;D=ce(s,D)|0;s=ce(D,i)|0;o=F+24|0;r=f[o>>2]|0;do{if((r|0)==0&(D|0)!=0){t=Yi(s)|0;f[o>>2]=t;if(!t){t=0;Ve=87;break e}Vl(t|0,0,s|0)|0;f[F+28>>2]=s}else{t=F+28|0;if(s>>>0<=(f[t>>2]|0)>>>0)break;r=Qi(r,s)|0;if(!r){Ve=50;break e}f[o>>2]=r;k=f[t>>2]|0;Vl(r+k|0,0,s-k|0)|0;f[t>>2]=s}}while(0);l=F+32|0;t=f[l>>2]|0;r=f[O>>2]|0;s=f[_>>2]|0;if(!t)t=an(r,s,a)|0;else t=ho(t,r,s,a)|0;f[l>>2]=t;if(!t)Jn(a,2,19990,De)|0;l=F+36|0;r=f[l>>2]|0;s=f[O>>2]|0;t=f[_>>2]|0;if(!r)t=an(s,t,a)|0;else t=ho(r,s,t,a)|0;f[l>>2]=t;if(!t)Jn(a,2,20012,Fe)|0;if(D){k=0;do{S=f[O>>2]|0;M=(((k>>>0)%(S>>>0)|0)<<G)+I|0;S=(((k>>>0)/(S>>>0)|0)<<W)+H|0;A=M+ee|0;R=S+te|0;do{if(Ae){t=f[o>>2]|0;r=t+(k*56|0)|0;s=f[r>>2]|0;if(!s){T=Yi(8192)|0;f[r>>2]=T;if(!T){t=0;Ve=87;break e}f[t+(k*56|0)+32>>2]=8192;T=qi(10,32)|0;f[t+(k*56|0)+4>>2]=T;if(!T){t=0;Ve=87;break e}f[t+(k*56|0)+52>>2]=10}else{l=t+(k*56|0)+32|0;_=f[l>>2]|0;E=t+(k*56|0)+4|0;w=f[E>>2]|0;x=r;T=x+52|0;do{f[x>>2]=0;x=x+4|0}while((x|0)<(T|0));f[r>>2]=s;f[l>>2]=_;f[E>>2]=w}T=f[F>>2]|0;f[t+(k*56|0)+8>>2]=(M|0)>(T|0)?M:T;M=f[P>>2]|0;f[t+(k*56|0)+12>>2]=(S|0)>(M|0)?S:M;S=f[L>>2]|0;f[t+(k*56|0)+16>>2]=(A|0)<(S|0)?A:S;A=f[C>>2]|0;f[t+(k*56|0)+20>>2]=(R|0)<(A|0)?R:A}else{r=f[o>>2]|0;t=r+(k*52|0)+4|0;if((f[t>>2]|0)==0?(T=qi(100,24)|0,f[t>>2]=T,(T|0)==0):0){t=0;Ve=87;break e}t=r+(k*52|0)+8|0;if((f[t>>2]|0)==0?(T=qi(100,24)|0,f[t>>2]=T,(T|0)==0):0){t=0;Ve=87;break e}l=f[F>>2]|0;l=(M|0)>(l|0)?M:l;f[r+(k*52|0)+12>>2]=l;t=f[P>>2]|0;S=(S|0)>(t|0)?S:t;f[r+(k*52|0)+16>>2]=S;t=f[L>>2]|0;t=(A|0)<(t|0)?A:t;f[r+(k*52|0)+20>>2]=t;A=f[C>>2]|0;R=(R|0)<(A|0)?R:A;f[r+(k*52|0)+24>>2]=R;l=ce(R-S|0,t-l<<2)|0;t=r+(k*52|0)+36|0;if(l>>>0<=(f[t>>2]|0)>>>0)break;s=r+(k*52|0)|0;r=f[s>>2]|0;if(r)Ji(r+-1|0);r=Yi(l|1)|0;f[s>>2]=r;if(!r){Ve=74;break e}f[t>>2]=l;h[r>>0]=0;f[s>>2]=(f[s>>2]|0)+1}}while(0);k=k+1|0}while(k>>>0<D>>>0)}N=N+1|0;if(N>>>0>=se>>>0)break;else F=F+40|0}}o=V+8|0;ie=ie+1|0;if(ie>>>0>=(f[oe>>2]|0)>>>0)break;else{ae=ae+36|0;V=o}}e=e+1|0;if(e>>>0<(f[we>>2]|0)>>>0){t=me;ge=ge+136|0}else break}}t=Se+1|0;if(t>>>0>=(f[Ce>>2]|0)>>>0){t=1;Ve=87;break}s=f[He>>2]|0;o=f[Pe>>2]|0;l=f[Ie>>2]|0;u=f[Le>>2]|0;Se=t;c=c+52|0;d=d+1080|0;p=p+52|0}if((Ve|0)==6){Jn(a,1,19816,Oe)|0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==8){Jn(a,1,19816,Ne)|0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==16){f[o>>2]=0;f[e>>2]=0;f[t>>2]=0}else if((Ve|0)==24){Jn(a,1,19849,Be)|0;Ji(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==41){Jn(a,1,19889,ze)|0;Ji(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==50){Ji(f[o>>2]|0);f[o>>2]=0;f[t>>2]=0;Jn(a,1,19932,Ue)|0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==74){f[t>>2]=0;Ve=0;b=Ge;return Ve|0}else if((Ve|0)==87){b=Ge;return t|0}Jn(a,1,19816,je)|0;Ve=0;b=Ge;return Ve|0}function an(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0;E=b;b=b+288|0;u=E+16|0;s=E+8|0;y=E+152|0;_=E+24|0;n=qi(1,20)|0;if(!n){Jn(r,1,20034,E)|0;_=0;b=E;return _|0}f[n>>2]=e;c=n+4|0;f[c>>2]=t;f[y>>2]=e;f[_>>2]=t;l=n+8|0;f[l>>2]=0;i=0;o=0;while(1){v=ce(t,e)|0;e=(e+1|0)/2|0;a=o+1|0;f[y+(a<<2)>>2]=e;t=(t+1|0)/2|0;f[_+(a<<2)>>2]=t;i=i+v|0;if(v>>>0<=1)break;else o=a}f[l>>2]=i;if(!i){Ji(n);Jn(r,2,20072,s)|0;_=0;b=E;return _|0}i=qi(i,16)|0;f[n+12>>2]=i;if(!i){Jn(r,1,20122,u)|0;Ji(n);_=0;b=E;return _|0}v=f[l>>2]|0;f[n+16>>2]=v<<4;t=i+((ce(f[c>>2]|0,f[n>>2]|0)|0)<<4)|0;if(!o)t=i;else{g=0;a=t;e=t;t=i;do{p=f[_+(g<<2)>>2]|0;e:do{if((p|0)>0){m=f[y+(g<<2)>>2]|0;if((m|0)<=0){l=p+-1|0;r=0;while(1){d=(r&1|0)!=0|(r|0)==(l|0);s=d?a:e;e=d?a:e+(m<<4)|0;r=r+1|0;if((r|0)>=(p|0)){a=s;break e}else a=s}}d=((m+2+((m|0)<2?~m:-3)|0)>>>1)+1|0;c=p+-1|0;h=0;do{r=m;u=a;while(1){f[t>>2]=u;s=t+16|0;l=r;r=r+-2|0;if((r|0)>-1){f[s>>2]=u;t=t+32|0}else t=s;if((l|0)<=2)break;else u=u+16|0}u=a+(d<<4)|0;r=(h&1|0)!=0|(h|0)==(c|0);a=r?u:e;e=r?u:e+(m<<4)|0;h=h+1|0}while((h|0)<(p|0))}}while(0);g=g+1|0}while((g|0)!=(o|0))}f[t>>2]=0;if(!v){_=n;b=E;return _|0}else t=0;while(1){f[i+4>>2]=999;f[i+8>>2]=0;f[i+12>>2]=0;t=t+1|0;if((t|0)==(v|0))break;else i=i+16|0}b=E;return n|0}function on(e){e=e|0;var t=0,r=0;if(!e)return;t=f[e+8>>2]|0;if(!t)return;r=0;e=f[e+12>>2]|0;while(1){f[e+4>>2]=999;f[e+8>>2]=0;f[e+12>>2]=0;r=r+1|0;if(r>>>0>=t>>>0)break;else e=e+16|0}return}function sn(e){e=e|0;var t=0;t=b;b=b+e|0;b=b+15&-16;return t|0}function ln(){return b|0}function un(e){e=e|0;b=e}function cn(e,t){e=e|0;t=t|0;b=e;E=t}function hn(e,t){e=e|0;t=t|0;if(!M){M=e;S=t}}function dn(e){e=e|0;h[w>>0]=h[e>>0];h[w+1>>0]=h[e+1>>0];h[w+2>>0]=h[e+2>>0];h[w+3>>0]=h[e+3>>0]}function fn(e){e=e|0;h[w>>0]=h[e>>0];h[w+1>>0]=h[e+1>>0];h[w+2>>0]=h[e+2>>0];h[w+3>>0]=h[e+3>>0];h[w+4>>0]=h[e+4>>0];h[w+5>>0]=h[e+5>>0];h[w+6>>0]=h[e+6>>0];h[w+7>>0]=h[e+7>>0]}function pn(e){e=e|0;B=e}function mn(){return B|0}function gn(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,u=0,c=0,h=0,d=0;d=b;b=b+8272|0;l=d+16|0;c=d+12|0;s=d;f[c>>2]=0;if((f[e>>2]|0)==1375686655)h=di(0)|0;else h=di(2)|0;si(h,1,0)|0;li(h,2,0)|0;ui(h,3,0)|0;fi(l);f[s>>2]=e;f[s+4>>2]=e;f[s+8>>2]=t;u=ci(s,1)|0;if(!(pi(h,l)|0)){fl(4476)|0;Fn(u);Li(h);a=1;b=d;return a|0}if(!(mi(u,h,c)|0)){fl(4528)|0;Fn(u);Li(h);ni(f[c>>2]|0);a=1;b=d;return a|0}if(!(bi(h,u,f[c>>2]|0,f[l+8228>>2]|0)|0)){fl(4578)|0;Li(h);Fn(u);ni(f[c>>2]|0);a=1;b=d;return a|0}s=f[c>>2]|0;f[i>>2]=f[s+8>>2];f[a>>2]=f[s+12>>2];e=f[s+16>>2]|0;f[o>>2]=e;e=ce(ce(e<<2,f[i>>2]|0)|0,f[a>>2]|0)|0;f[n>>2]=e;n=Cl(e)|0;f[r>>2]=n;switch(f[o>>2]|0){case 1:{Yl(n|0,f[(f[s+24>>2]|0)+44>>2]|0,e|0)|0;break}case 3:{if((ce(f[a>>2]|0,f[i>>2]|0)|0)>0){t=f[s+24>>2]|0;s=f[t+44>>2]|0;e=f[t+96>>2]|0;t=f[t+148>>2]|0;l=0;do{o=l*3|0;f[n+(o<<2)>>2]=f[s+(l<<2)>>2];f[n+(o+1<<2)>>2]=f[e+(l<<2)>>2];f[n+(o+2<<2)>>2]=f[t+(l<<2)>>2];l=l+1|0}while((l|0)<(ce(f[a>>2]|0,f[i>>2]|0)|0))}break}default:{}}Fn(u);Li(h);ni(f[c>>2]|0);a=0;b=d;return a|0}function vn(){return hi()|0}function yn(e,t){e=e|0;t=t|0;return}function _n(e,t){e=e|0;t=t|0;return}function bn(e,t){e=e|0;t=t|0;var r=0;t=b;b=b+16|0;r=t;f[r>>2]=e;dl(4625,r)|0;b=t;return}function En(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=b;b=b+16|0;i=a;f[i>>2]=t;if(!r){b=a;return}t=e;n=0;e=i+(r+-1)|0;while(1){h[t>>0]=h[e>>0]|0;n=n+1|0;if((n|0)==(r|0))break;else{t=t+1|0;e=e+-1|0}}b=a;return}function wn(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;f[t>>2]=0;if(!r)return;n=0;t=t+(r+-1)|0;while(1){h[t>>0]=h[e>>0]|0;n=n+1|0;if((n|0)==(r|0))break;else{e=e+1|0;t=t+-1|0}}return}function xn(e,t){e=e|0;t=+t;var r=0,n=0,i=0,a=0,o=0;r=b;b=b+16|0;a=r;y[a>>3]=t;a=a+8|0;y[w>>3]=t;n=f[w>>2]|0;i=f[w+4>>2]|0;o=Xl(n|0,i|0,56)|0;h[e>>0]=o;o=Xl(n|0,i|0,48)|0;h[e+1>>0]=o;o=Xl(n|0,i|0,40)|0;h[e+2>>0]=o;h[e+3>>0]=i;h[e+4>>0]=h[a+-5>>0]|0;h[e+5>>0]=h[a+-6>>0]|0;i=Xl(n|0,i|0,8)|0;h[e+6>>0]=i;h[e+7>>0]=n;b=r;return}function Tn(e,t){e=e|0;t=t|0;var r=0;r=t+8|0;h[r+-1>>0]=h[e>>0]|0;h[r+-2>>0]=h[e+1>>0]|0;h[r+-3>>0]=h[e+2>>0]|0;h[r+-4>>0]=h[e+3>>0]|0;h[r+-5>>0]=h[e+4>>0]|0;h[r+-6>>0]=h[e+5>>0]|0;h[r+-7>>0]=h[e+6>>0]|0;h[t>>0]=h[e+7>>0]|0;return}function Mn(e,t){e=e|0;t=+t;var r=0;r=(v[w>>2]=t,f[w>>2]|0);h[e>>0]=r>>>24;h[e+1>>0]=r>>>16;h[e+2>>0]=r>>>8;h[e+3>>0]=r;return}function Sn(e,t){e=e|0;t=t|0;var r=0;r=t+4|0;h[r+-1>>0]=h[e>>0]|0;h[r+-2>>0]=h[e+1>>0]|0;h[r+-3>>0]=h[e+2>>0]|0;h[t>>0]=h[e+3>>0]|0;return}function An(e,t){e=e|0;t=t|0;var r=0,n=0;n=qi(1,72)|0;if(!n){t=0;return t|0}f[n+64>>2]=e;e=Yi(e)|0;f[n+32>>2]=e;if(!e){Ji(n);t=0;return t|0}f[n+36>>2]=e;e=n+68|0;r=f[e>>2]|0;if(!t){f[e>>2]=r|1;f[n+40>>2]=31;f[n+44>>2]=32}else{f[e>>2]=r|2;f[n+40>>2]=29;f[n+44>>2]=30}f[n+16>>2]=4;f[n+20>>2]=5;f[n+24>>2]=6;f[n+28>>2]=7;t=n;return t|0}function Rn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0;h=b;b=b+16|0;c=h;i=e+48|0;a=f[i>>2]|0;if(a>>>0>=t>>>0){c=e+36|0;f[c>>2]=(f[c>>2]|0)+t;f[i>>2]=a-t;c=e+56|0;e=c;e=Wl(f[e>>2]|0,f[e+4>>2]|0,t|0,r|0)|0;f[c>>2]=e;f[c+4>>2]=B;c=r;e=t;B=c;b=h;return e|0}u=e+68|0;if(f[u>>2]&4){c=e+36|0;f[c>>2]=(f[c>>2]|0)+a;f[i>>2]=0;e=e+56|0;c=e;c=Wl(f[c>>2]|0,f[c+4>>2]|0,a|0,0)|0;f[e>>2]=c;f[e+4>>2]=B;e=(a|0)!=0;c=e?0:-1;e=e?a:-1;B=c;b=h;return e|0}if(!a){a=0;i=0}else{f[e+36>>2]=f[e+32>>2];t=zl(t|0,r|0,a|0,0)|0;f[i>>2]=0;i=0;r=B}e:do{if((r|0)>0|(r|0)==0&t>>>0>0){l=e+24|0;while(1){o=ku[f[l>>2]&63](t,r,f[e>>2]|0)|0;s=B;if((o|0)==-1&(s|0)==-1)break;t=zl(t|0,r|0,o|0,s|0)|0;r=B;a=Wl(o|0,s|0,a|0,i|0)|0;i=B;if(!((r|0)>0|(r|0)==0&t>>>0>0))break e}Jn(n,4,4636,c)|0;f[u>>2]=f[u>>2]|4;e=e+56|0;c=e;c=Wl(f[c>>2]|0,f[c+4>>2]|0,a|0,i|0)|0;f[e>>2]=c;f[e+4>>2]=B;e=(a|0)!=0|(i|0)!=0;c=e?i:-1;e=e?a:-1;B=c;b=h;return e|0}}while(0);c=e+56|0;e=c;e=Wl(f[e>>2]|0,f[e+4>>2]|0,a|0,i|0)|0;f[c>>2]=e;f[c+4>>2]=B;c=i;e=a;B=c;b=h;return e|0}function kn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;f[e+36>>2]=f[e+32>>2];f[e+48>>2]=0;a=(ku[f[e+28>>2]&63](t,r,f[e>>2]|0)|0)==0;n=e+68|0;i=f[n>>2]|0;if(a){f[n>>2]=i|4;a=0;return a|0}else{f[n>>2]=i&-5;a=e+56|0;f[a>>2]=t;f[a+4>>2]=r;a=1;return a|0}return 0}function Pn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0;g=b;b=b+16|0;m=g+8|0;c=g;p=e+68|0;if(f[p>>2]&8){m=-1;e=-1;B=m;b=g;return e|0}l=e+32|0;i=f[l>>2]|0;d=e+36|0;f[d>>2]=i;u=e+48|0;a=f[u>>2]|0;do{if(a){s=e+20|0;while(1){o=ku[f[s>>2]&63](i,a,f[e>>2]|0)|0;if((o|0)==-1)break;i=(f[d>>2]|0)+o|0;f[d>>2]=i;v=f[u>>2]|0;a=v-o|0;f[u>>2]=a;if((v|0)==(o|0)){h=6;break}}if((h|0)==6){i=f[l>>2]|0;break}f[p>>2]=f[p>>2]|8;Jn(n,4,4662,c)|0;f[p>>2]=f[p>>2]|8;f[u>>2]=0;e=-1;v=-1;B=e;b=g;return v|0}}while(0);f[d>>2]=i;e:do{if((r|0)>0|(r|0)==0&t>>>0>0){l=e+24|0;a=0;i=0;while(1){o=ku[f[l>>2]&63](t,r,f[e>>2]|0)|0;s=B;if((o|0)==-1&(s|0)==-1)break;t=zl(t|0,r|0,o|0,s|0)|0;r=B;a=Wl(o|0,s|0,a|0,i|0)|0;i=B;if(!((r|0)>0|(r|0)==0&t>>>0>0))break e}Jn(n,4,4688,m)|0;f[p>>2]=f[p>>2]|8;v=e+56|0;e=v;e=Wl(f[e>>2]|0,f[e+4>>2]|0,a|0,i|0)|0;f[v>>2]=e;f[v+4>>2]=B;v=(a|0)!=0|(i|0)!=0;e=v?i:-1;v=v?a:-1;B=e;b=g;return v|0}else{a=0;i=0}}while(0);e=e+56|0;v=e;v=Wl(f[v>>2]|0,f[v+4>>2]|0,a|0,i|0)|0;f[e>>2]=v;f[e+4>>2]=B;e=i;v=a;B=e;b=g;return v|0}function Ln(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;p=b;b=b+16|0;l=p;c=e+32|0;i=f[c>>2]|0;h=e+36|0;f[h>>2]=i;d=e+48|0;a=f[d>>2]|0;do{if(!a)a=e;else{s=e+20|0;while(1){o=ku[f[s>>2]&63](i,a,f[e>>2]|0)|0;if((o|0)==-1)break;i=(f[h>>2]|0)+o|0;f[h>>2]=i;m=f[d>>2]|0;a=m-o|0;f[d>>2]=a;if((m|0)==(o|0)){u=6;break}}if((u|0)==6){a=e;i=f[c>>2]|0;break}m=e+68|0;f[m>>2]=f[m>>2]|8;Jn(n,4,4662,l)|0;f[m>>2]=f[m>>2]|8;m=0;b=p;return m|0}}while(0);f[h>>2]=i;f[d>>2]=0;if(!(ku[f[e+28>>2]&63](t,r,f[a>>2]|0)|0)){m=e+68|0;f[m>>2]=f[m>>2]|8;m=0;b=p;return m|0}else{m=e+56|0;f[m>>2]=t;f[m+4>>2]=r;m=1;b=p;return m|0}return 0}function Cn(e,t,r){e=e|0;t=t|0;r=r|0;return-1}function In(e,t,r){e=e|0;t=t|0;r=r|0;return-1}function Hn(e,t,r){e=e|0;t=t|0;r=r|0;B=-1;return-1}function On(e,t,r){e=e|0;t=t|0;r=r|0;return 0}function Dn(e){e=e|0;var t=0,r=0,n=0;n=qi(1,72)|0;if(!n){e=0;return e|0}f[n+64>>2]=1048576;t=Yi(1048576)|0;f[n+32>>2]=t;if(!t){Ji(n);e=0;return e|0}f[n+36>>2]=t;t=n+68|0;r=f[t>>2]|0;if(!e){f[t>>2]=r|1;f[n+40>>2]=31;f[n+44>>2]=32}else{f[t>>2]=r|2;f[n+40>>2]=29;f[n+44>>2]=30}f[n+16>>2]=4;f[n+20>>2]=5;f[n+24>>2]=6;f[n+28>>2]=7;e=n;return e|0}function Fn(e){e=e|0;var t=0;if(!e)return;t=f[e+4>>2]|0;if(t)Lu[t&7](f[e>>2]|0);t=e+32|0;Ji(f[t>>2]|0);f[t>>2]=0;Ji(e);return}function Nn(e,t){e=e|0;t=t|0;if(!e)return;if(!(f[e+68>>2]&2))return;f[e+16>>2]=t;return}function Un(e,t){e=e|0;t=t|0;if(!e)return;f[e+28>>2]=t;return}function Bn(e,t){e=e|0;t=t|0;if(!e)return;if(!(f[e+68>>2]&1))return;f[e+20>>2]=t;return}function zn(e,t){e=e|0;t=t|0;if(!e)return;f[e+24>>2]=t;return}function jn(e,t,r){e=e|0;t=t|0;r=r|0;if(!e)return;f[e>>2]=t;f[e+4>>2]=r;return}function Vn(e,t,r){e=e|0;t=t|0;r=r|0;if(!e)return;e=e+8|0;f[e>>2]=t;f[e+4>>2]=r;return}function Gn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0;w=b;b=b+16|0;v=w+8|0;g=w;E=e+48|0;i=f[E>>2]|0;if(i>>>0>=r>>>0){_=e+36|0;Yl(t|0,f[_>>2]|0,r|0)|0;f[_>>2]=(f[_>>2]|0)+r;f[E>>2]=(f[E>>2]|0)-r;E=e+56|0;_=E;_=Wl(f[_>>2]|0,f[_+4>>2]|0,r|0,0)|0;f[E>>2]=_;f[E+4>>2]=B;E=r;b=w;return E|0}y=e+68|0;if(f[y>>2]&4){_=e+36|0;Yl(t|0,f[_>>2]|0,i|0)|0;n=f[E>>2]|0;f[_>>2]=(f[_>>2]|0)+n;_=e+56|0;y=_;n=Wl(f[y>>2]|0,f[y+4>>2]|0,n|0,0)|0;f[_>>2]=n;f[_+4>>2]=B;f[E>>2]=0;E=(i|0)!=0?i:-1;b=w;return E|0}if(!i){d=e+32|0;a=f[d>>2]|0;p=e+36|0;f[p>>2]=a;m=p;_=e+56|0;i=0}else{p=e+36|0;Yl(t|0,f[p>>2]|0,i|0)|0;d=e+32|0;a=f[d>>2]|0;f[p>>2]=a;m=f[E>>2]|0;_=e+56|0;c=_;c=Wl(f[c>>2]|0,f[c+4>>2]|0,m|0,0)|0;h=_;f[h>>2]=c;f[h+4>>2]=B;f[E>>2]=0;r=r-m|0;t=t+m|0;m=p}c=e+64|0;h=e+16|0;u=t;o=a;while(1){t=f[c>>2]|0;a=f[h>>2]|0;if(r>>>0<t>>>0){a=ku[a&63](o,t,f[e>>2]|0)|0;f[E>>2]=a;if((a|0)==-1){a=11;break}if(a>>>0>=r>>>0){t=u;a=14;break}Yl(u|0,f[m>>2]|0,a|0)|0;o=f[d>>2]|0;f[p>>2]=o;t=f[E>>2]|0;s=_;s=Wl(f[s>>2]|0,f[s+4>>2]|0,t|0,0)|0;l=B;i=a+i|0}else{t=ku[a&63](u,r,f[e>>2]|0)|0;f[E>>2]=t;if((t|0)==-1){a=16;break}i=t+i|0;if(t>>>0>=r>>>0){a=20;break}o=f[d>>2]|0;f[p>>2]=o;s=_;s=Wl(f[s>>2]|0,f[s+4>>2]|0,t|0,0)|0;l=B}a=_;f[a>>2]=s;f[a+4>>2]=l;f[E>>2]=0;r=r-t|0;u=u+t|0}if((a|0)==11){Jn(n,4,4636,g)|0;f[E>>2]=0;f[y>>2]=f[y>>2]|4;E=(i|0)!=0?i:-1;b=w;return E|0}else if((a|0)==14){Yl(t|0,f[m>>2]|0,r|0)|0;f[m>>2]=(f[m>>2]|0)+r;f[E>>2]=(f[E>>2]|0)-r;n=_;n=Wl(f[n>>2]|0,f[n+4>>2]|0,r|0,0)|0;E=_;f[E>>2]=n;f[E+4>>2]=B;E=i+r|0;b=w;return E|0}else if((a|0)==16){Jn(n,4,4636,v)|0;f[E>>2]=0;f[y>>2]=f[y>>2]|4;E=(i|0)!=0?i:-1;b=w;return E|0}else if((a|0)==20){n=_;n=Wl(f[n>>2]|0,f[n+4>>2]|0,t|0,0)|0;f[_>>2]=n;f[_+4>>2]=B;f[p>>2]=f[d>>2];f[E>>2]=0;E=i;b=w;return E|0}return 0}function Wn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0;_=b;b=b+16|0;g=_;h=e+68|0;if(f[h>>2]&8){y=-1;b=_;return y|0}m=e+64|0;i=f[m>>2]|0;y=e+48|0;l=f[y>>2]|0;a=i-l|0;do{if(a>>>0<r>>>0){d=e+32|0;o=e+36|0;p=e+20|0;s=e+56|0;u=i;c=a;i=0;e:while(1){if((u|0)==(l|0))a=f[d>>2]|0;else{Yl(f[o>>2]|0,t|0,c|0)|0;a=f[d>>2]|0;f[o>>2]=a;l=(f[y>>2]|0)+c|0;f[y>>2]=l;E=s;E=Wl(f[E>>2]|0,f[E+4>>2]|0,c|0,0)|0;u=s;f[u>>2]=E;f[u+4>>2]=B;r=r-c|0;t=t+c|0;i=c+i|0}f[o>>2]=a;if(!l)l=0;else{do{u=ku[f[p>>2]&63](a,l,f[e>>2]|0)|0;if((u|0)==-1)break e;a=(f[o>>2]|0)+u|0;f[o>>2]=a;E=f[y>>2]|0;l=E-u|0;f[y>>2]=l}while((E|0)!=(u|0));a=f[d>>2]|0}f[o>>2]=a;u=f[m>>2]|0;c=u-l|0;if(r>>>0<=c>>>0){v=5;break}}if((v|0)==5)break;f[h>>2]=f[h>>2]|8;Jn(n,4,4662,g)|0;E=-1;b=_;return E|0}else{a=e+36|0;s=e+56|0;o=a;a=f[a>>2]|0;i=0}}while(0);Yl(a|0,t|0,r|0)|0;f[o>>2]=(f[o>>2]|0)+r;f[y>>2]=(f[y>>2]|0)+r;y=s;y=Wl(f[y>>2]|0,f[y+4>>2]|0,r|0,0)|0;E=s;f[E>>2]=y;f[E+4>>2]=B;E=i+r|0;b=_;return E|0}function Xn(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;h=b;b=b+16|0;l=h;a=e+32|0;r=f[a>>2]|0;c=e+36|0;f[c>>2]=r;o=e+48|0;n=f[o>>2]|0;do{if(n){s=e+20|0;while(1){i=ku[f[s>>2]&63](r,n,f[e>>2]|0)|0;if((i|0)==-1)break;r=(f[c>>2]|0)+i|0;f[c>>2]=r;d=f[o>>2]|0;n=d-i|0;f[o>>2]=n;if((d|0)==(i|0)){u=6;break}}if((u|0)==6){r=f[a>>2]|0;break}d=e+68|0;f[d>>2]=f[d>>2]|8;Jn(t,4,4662,l)|0;d=0;b=h;return d|0}}while(0);f[c>>2]=r;d=1;b=h;return d|0}function Yn(e){e=e|0;e=e+56|0;B=f[e+4>>2]|0;return f[e>>2]|0}function qn(e){e=e|0;var t=0,r=0;r=e+8|0;t=f[r>>2]|0;r=f[r+4>>2]|0;if((t|0)==0&(r|0)==0){r=0;e=0;B=r;return e|0}e=e+56|0;e=zl(t|0,r|0,f[e>>2]|0,f[e+4>>2]|0)|0;r=B;B=r;return e|0}function Zn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;e=Fu[f[e+40>>2]&63](e,t,r,n)|0;return e|0}function Kn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return Fu[f[e+44>>2]&63](e,t,r,n)|0}function Qn(e){e=e|0;return(f[e+28>>2]|0)!=7|0}function Jn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0;s=b;b=b+528|0;a=s;o=s+16|0;e:do{if(e){switch(t|0){case 1:{t=e;i=e+12|0;break}case 2:{t=e+4|0;i=e+16|0;break}case 4:{t=e+8|0;i=e+20|0;break}default:{t=0;break e}}e=f[t>>2]|0;t=f[i>>2]|0;if(t)if(!r)t=1;else{Vl(o|0,0,512)|0;f[a>>2]=n;gl(o,512,r,a)|0;Cu[t&7](o,e);t=1}else t=0}else t=0}while(0);b=s;return t|0}function $n(e){e=e|0;f[e>>2]=0;f[e+4>>2]=0;f[e+8>>2]=0;f[e+12>>2]=4;f[e+20>>2]=4;f[e+16>>2]=4;return}function ei(e,t){e=e|0;t=t|0;return}function ti(){return qi(1,36)|0}function ri(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;n=qi(1,36)|0;if(!n){s=n;return s|0}f[n+20>>2]=r;o=n+16|0;f[o>>2]=e;r=qi(1,e*52|0)|0;s=n+24|0;f[s>>2]=r;if(!r){r=f[n+28>>2]|0;if(r)Ji(r);Ji(n);s=0;return s|0}if(!e){s=n;return s|0}i=0;while(1){f[r+(i*52|0)>>2]=f[t+(i*36|0)>>2];f[r+(i*52|0)+4>>2]=f[t+(i*36|0)+4>>2];l=f[t+(i*36|0)+8>>2]|0;f[r+(i*52|0)+8>>2]=l;u=f[t+(i*36|0)+12>>2]|0;f[r+(i*52|0)+12>>2]=u;f[r+(i*52|0)+16>>2]=f[t+(i*36|0)+16>>2];f[r+(i*52|0)+20>>2]=f[t+(i*36|0)+20>>2];f[r+(i*52|0)+24>>2]=f[t+(i*36|0)+24>>2];f[r+(i*52|0)+28>>2]=f[t+(i*36|0)+28>>2];f[r+(i*52|0)+32>>2]=f[t+(i*36|0)+32>>2];l=qi(ce(u,l)|0,4)|0;f[r+(i*52|0)+44>>2]=l;i=i+1|0;if(!l)break;if(i>>>0>=e>>>0){a=22;break}r=f[s>>2]|0}if((a|0)==22)return n|0;r=f[s>>2]|0;if(r){i=f[o>>2]|0;if(i){t=0;while(1){r=f[r+(t*52|0)+44>>2]|0;if(r){Ji(r);i=f[o>>2]|0}t=t+1|0;if(t>>>0>=i>>>0)break;r=f[s>>2]|0}r=f[s>>2]|0}Ji(r)}r=f[n+28>>2]|0;if(r)Ji(r);Ji(n);u=0;return u|0}function ni(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;if(!e)return;i=e+24|0;t=f[i>>2]|0;if(t){a=e+16|0;r=f[a>>2]|0;if(r){n=0;while(1){t=f[t+(n*52|0)+44>>2]|0;if(t){Ji(t);r=f[a>>2]|0}n=n+1|0;if(n>>>0>=r>>>0)break;t=f[i>>2]|0}t=f[i>>2]|0}Ji(t)}t=f[e+28>>2]|0;if(t)Ji(t);Ji(e);return}function ii(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0;r=f[t+4>>2]|0;n=f[e>>2]|0;a=f[t+8>>2]|0;o=f[e+4>>2]|0;i=f[t+12>>2]|0;c=(ce((f[t+24>>2]|0)+-1|0,i)|0)+r|0;s=f[t+16>>2]|0;l=(ce((f[t+28>>2]|0)+-1|0,s)|0)+a|0;t=Wl(c|0,0,i|0,0)|0;t=t|0-B;i=f[e+8>>2]|0;s=Wl(l|0,0,s|0,0)|0;s=s|0-B;l=f[e+12>>2]|0;c=f[e+16>>2]|0;if(!c)return;u=(r>>>0>n>>>0?r:n)+-1|0;a=(a>>>0>o>>>0?a:o)+-1|0;i=(t>>>0<i>>>0?t:i)+-1|0;r=(s>>>0<l>>>0?s:l)+-1|0;n=0;t=f[e+24>>2]|0;while(1){o=f[t>>2]|0;l=((u+o|0)>>>0)/(o>>>0)|0;p=f[t+4>>2]|0;e=((a+p|0)>>>0)/(p>>>0)|0;s=f[t+40>>2]|0;d=Gl(1,0,s|0)|0;h=B;o=Wl((((i+o|0)>>>0)/(o>>>0)|0)-l|0,0,-1,-1)|0;o=Wl(o|0,B|0,d|0,h|0)|0;o=Xl(o|0,B|0,s|0)|0;p=Wl((((r+p|0)>>>0)/(p>>>0)|0)-e|0,0,-1,-1)|0;h=Wl(p|0,B|0,d|0,h|0)|0;s=Xl(h|0,B|0,s|0)|0;f[t+8>>2]=o;f[t+12>>2]=s;f[t+16>>2]=l;f[t+20>>2]=e;n=n+1|0;if(n>>>0>=c>>>0)break;else t=t+52|0}return}function ai(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0;f[t>>2]=f[e>>2];f[t+4>>2]=f[e+4>>2];f[t+8>>2]=f[e+8>>2];f[t+12>>2]=f[e+12>>2];l=t+24|0;n=f[l>>2]|0;s=t+16|0;if(!n)r=l;else{r=f[s>>2]|0;if(!r)r=l;else{i=0;while(1){n=f[n+(i*52|0)+44>>2]|0;if(n){Ji(n);r=f[s>>2]|0}i=i+1|0;if(i>>>0>=r>>>0)break;n=f[l>>2]|0}r=l;n=f[l>>2]|0}Ji(n);f[l>>2]=0}n=f[e+16>>2]|0;f[s>>2]=n;n=Yi(n*52|0)|0;f[r>>2]=n;if(!n){f[l>>2]=0;f[s>>2]=0;return}if(f[s>>2]|0){o=e+24|0;a=0;do{r=n+(a*52|0)|0;n=(f[o>>2]|0)+(a*52|0)|0;i=r+52|0;do{f[r>>2]=f[n>>2];r=r+4|0;n=n+4|0}while((r|0)<(i|0));n=f[l>>2]|0;f[n+(a*52|0)+44>>2]=0;a=a+1|0}while(a>>>0<(f[s>>2]|0)>>>0)}f[t+20>>2]=f[e+20>>2];i=e+32|0;r=f[i>>2]|0;a=t+32|0;f[a>>2]=r;if(!r){f[t+28>>2]=0;return}n=Yi(r)|0;r=t+28|0;f[r>>2]=n;if(!n){f[r>>2]=0;f[a>>2]=0;return}else{Yl(n|0,f[e+28>>2]|0,f[i>>2]|0)|0;return}}function oi(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=qi(1,36)|0;if(!n){e=n;return e|0}f[n+20>>2]=r;f[n+16>>2]=e;r=qi(e,52)|0;f[n+24>>2]=r;if(!r){r=f[n+28>>2]|0;if(r)Ji(r);Ji(n);e=0;return e|0}else{if(!e){e=n;return e|0}else i=0;do{f[r+(i*52|0)>>2]=f[t+(i*36|0)>>2];f[r+(i*52|0)+4>>2]=f[t+(i*36|0)+4>>2];f[r+(i*52|0)+8>>2]=f[t+(i*36|0)+8>>2];f[r+(i*52|0)+12>>2]=f[t+(i*36|0)+12>>2];f[r+(i*52|0)+16>>2]=f[t+(i*36|0)+16>>2];f[r+(i*52|0)+20>>2]=f[t+(i*36|0)+20>>2];f[r+(i*52|0)+24>>2]=f[t+(i*36|0)+24>>2];f[r+(i*52|0)+32>>2]=f[t+(i*36|0)+32>>2];f[r+(i*52|0)+44>>2]=0;i=i+1|0}while((i|0)!=(e|0));return n|0}return 0}function si(e,t,r){e=e|0;t=t|0;r=r|0;if(!e){r=0;return r|0}f[e+64>>2]=t;f[e+52>>2]=r;r=1;return r|0}function li(e,t,r){e=e|0;t=t|0;r=r|0;if(!e){r=0;return r|0}f[e+60>>2]=t;f[e+48>>2]=r;r=1;return r|0}function ui(e,t,r){e=e|0;t=t|0;r=r|0;if(!e){r=0;return r|0}f[e+56>>2]=t;f[e+44>>2]=r;r=1;return r|0}function ci(e,t){e=e|0;t=t|0;var r=0;if(!e){e=0;return e|0}r=Dn(t)|0;if(!r){e=0;return e|0}jn(r,e,0);Vn(r,f[e+8>>2]|0,0);if(!t)Bn(r,9);else Nn(r,8);zn(r,1);Un(r,10);e=r;return e|0}function hi(){return 4703}function di(e){e=e|0;var t=0;t=qi(1,84)|0;if(!t){e=0;return e|0}f[t+68>>2]=1;switch(e|0){case 0:{f[t+72>>2]=13;f[t+76>>2]=2;f[t+80>>2]=3;f[t+4>>2]=33;f[t+16>>2]=11;f[t>>2]=34;f[t+20>>2]=1;f[t+24>>2]=5;f[t+8>>2]=1;f[t+12>>2]=1;f[t+28>>2]=1;f[t+32>>2]=1;f[t+36>>2]=12;e=ha()|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}case 2:{f[t+72>>2]=14;f[t+76>>2]=4;f[t+80>>2]=5;f[t+4>>2]=35;f[t+16>>2]=13;f[t>>2]=36;f[t+8>>2]=2;f[t+12>>2]=2;f[t+20>>2]=2;f[t+24>>2]=6;f[t+28>>2]=2;f[t+32>>2]=2;f[t+36>>2]=14;e=Xt(1)|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}default:{Ji(t);e=0;return e|0}}$n(t+44|0);e=t;return e|0}function fi(e){e=e|0;if(!e)return;Vl(e|0,0,8248)|0;f[e+8200>>2]=-1;f[e+8204>>2]=-1;f[e+8248>>2]=0;return}function pi(e,t){e=e|0;t=t|0;var r=0;r=b;b=b+16|0;if(!((e|0)!=0&(t|0)!=0)){t=0;b=r;return t|0}if(!(f[e+68>>2]|0)){Jn(e+44|0,1,4709,r)|0;t=0;b=r;return t|0}else{Cu[f[e+24>>2]&7](f[e+40>>2]|0,t);t=1;b=r;return t|0}return 0}function mi(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=b;b=b+16|0;if(!((e|0)!=0&(t|0)!=0)){e=0;b=n;return e|0}if(!(f[t+68>>2]|0)){Jn(t+44|0,1,4790,n)|0;e=0;b=n;return e|0}else{e=Fu[f[t>>2]&63](e,f[t+40>>2]|0,r,t+44|0)|0;b=n;return e|0}return 0}function gi(e,t,r){e=e|0;t=t|0;r=r|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=Fu[f[e+4>>2]&63](f[e+40>>2]|0,t,r,e+44|0)|0;return t|0}function vi(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;if(!e){n=0;return n|0}if(!(f[e+68>>2]|0)){n=0;return n|0}n=Ru[f[e+28>>2]&3](f[e+40>>2]|0,t,r,n,i,a,e+44|0)|0;return n|0}function yi(e,t,r,n,i,a,o,s,l,u){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;if(!((r|0)!=0&((e|0)!=0&(t|0)!=0&(n|0)!=0))){s=0;return s|0}if(!(f[e+68>>2]|0)){s=0;return s|0}s=Du[f[e+8>>2]&3](f[e+40>>2]|0,r,n,i,a,o,s,l,u,t,e+44|0)|0;return s|0}function _i(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;if(!((e|0)!=0&(r|0)!=0&(i|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=Iu[f[e+12>>2]&7](f[e+40>>2]|0,t,r,n,i,e+44|0)|0;return t|0}function bi(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;if(!((e|0)!=0&(t|0)!=0)){n=0;return n|0}if(!(f[e+68>>2]|0)){n=0;return n|0}n=Uu[f[e+32>>2]&3](f[e+40>>2]|0,t,r,e+44|0,n)|0;return n|0}function Ei(e,t){e=e|0;t=t|0;if(!e){t=0;return t|0}t=ku[f[e+36>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function wi(e){e=e|0;var t=0;t=qi(1,84)|0;if(!t){e=0;return e|0}f[t+68>>2]=0;switch(e|0){case 0:{f[t+4>>2]=15;f[t+12>>2]=16;f[t>>2]=37;f[t+8>>2]=3;f[t+16>>2]=1;f[t+20>>2]=38;e=ta()|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}case 2:{f[t+4>>2]=17;f[t+12>>2]=18;f[t>>2]=39;f[t+8>>2]=4;f[t+16>>2]=2;f[t+20>>2]=40;e=Xt(0)|0;f[t+40>>2]=e;if(!e){Ji(t);e=0;return e|0}break}default:{Ji(t);e=0;return e|0}}$n(t+44|0);e=t;return e|0}function xi(e){e=e|0;if(!e)return;Vl(e|0,0,18708)|0;f[e+5592>>2]=6;f[e+18684>>2]=0;f[e+5596>>2]=64;f[e+5600>>2]=64;f[e+44>>2]=0;f[e+5612>>2]=-1;f[e+18188>>2]=1;f[e+18192>>2]=1;h[e+18688>>0]=0;f[e+18196>>2]=-1;f[e+18200>>2]=-1;v[e+4792>>2]=0.0;f[e+4788>>2]=0;f[e+20>>2]=0;f[e+24>>2]=0;f[e+28>>2]=0;f[e+18692>>2]=0;return}function Ti(e,t,r){e=e|0;t=t|0;r=r|0;if(!((e|0)!=0&(t|0)!=0&(r|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=Fu[f[e+20>>2]&63](f[e+40>>2]|0,t,r,e+44|0)|0;return t|0}function Mi(e,t,r){e=e|0;t=t|0;r=r|0;if(!((e|0)!=0&(r|0)!=0)){r=0;return r|0}if(f[e+68>>2]|0){r=0;return r|0}r=Fu[f[e>>2]&63](f[e+40>>2]|0,r,t,e+44|0)|0;return r|0}function Si(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=ku[f[e+4>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function Ai(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=ku[f[e+12>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function Ri(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0)){t=0;return t|0}if(!(f[e+68>>2]|0)){t=0;return t|0}t=ku[f[e+16>>2]&63](f[e+40>>2]|0,t,e+44|0)|0;return t|0}function ki(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0;o=n<<2;i=ce(o,n)|0;a=e+18704|0;n=m[a>>1]|0;d[a>>1]=(n&32768|0)==0?-32512:(n|256)&65535;f[e+5608>>2]=1;h[e+18690>>0]=2;a=Yi(i+o|0)|0;n=e+18696|0;f[n>>2]=a;if(!a){r=0;return r|0}Yl(a|0,t|0,i|0)|0;Yl((f[n>>2]|0)+i|0,r|0,o|0)|0;r=1;return r|0}function Pi(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;if(!((r|0)!=0&((e|0)!=0&(i|0)!=0))){t=0;return t|0}if(f[e+68>>2]|0){t=0;return t|0}t=Iu[f[e+8>>2]&7](f[e+40>>2]|0,t,r,n,i,e+44|0)|0;return t|0}function Li(e){e=e|0;var t=0,r=0;if(!e)return;t=e+40|0;r=f[t>>2]|0;if(!(f[e+68>>2]|0))Lu[f[e+16>>2]&7](r);else Lu[f[e+20>>2]&7](r);f[t>>2]=0;Ji(e);return}function Ci(e,t,r){e=e|0;t=t|0;r=r|0;if(!e)return;Ou[f[e+72>>2]&15](f[e+40>>2]|0,t,r);return}function Ii(e){e=e|0;if(!e){e=0;return e|0}e=Hu[f[e+76>>2]&15](f[e+40>>2]|0)|0;return e|0}function Hi(e){e=e|0;var t=0,r=0;if(!e)return;t=f[e>>2]|0;r=f[t+48>>2]|0;if(r){Ji(r);t=f[e>>2]|0}Ji(t);f[e>>2]=0;return}function Oi(e){e=e|0;if(!e){e=0;return e|0}e=Hu[f[e+80>>2]&15](f[e+40>>2]|0)|0;return e|0}function Di(e){e=e|0;var t=0;t=f[e>>2]|0;if(!t)return;sa(t);f[e>>2]=0;return}function Fi(e,t){e=e|0;t=t|0;return Ni(e,1048576,t)|0}function Ni(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(!e){t=0;return t|0}n=$s(e,(r|0)==0?4869:4872)|0;if(!n){t=0;return t|0}e=An(t,r)|0;if(!e){Qs(n)|0;t=0;return t|0}else{jn(e,n,6);ol(n,0,2)|0;t=ul(n)|0;ol(n,0,0)|0;Vn(e,t,((t|0)<0)<<31>>31);Nn(e,19);Bn(e,20);zn(e,21);Un(e,22);t=e;return t|0}return 0}function Ui(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=(f[r>>2]|0)+(f[r+8>>2]|0)|0;r=r+4|0;n=f[r>>2]|0;i=a-n|0;if((a|0)==(n|0)){a=-1;return a|0}a=i>>>0>t>>>0?t:i;Yl(e|0,n|0,a|0)|0;f[r>>2]=(f[r>>2]|0)+a;return a|0}function Bi(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=r+4|0;n=f[u>>2]|0;s=r+8|0;a=f[s>>2]|0;l=n-(f[r>>2]|0)|0;i=(a|0)==0?1:a;while(1)if((i-l|0)>>>0<t>>>0)i=i<<1;else{o=i;break}if((o|0)!=(a|0)){n=Yi(o)|0;if(!n){t=-1;return t|0}i=f[r>>2]|0;if(i){Yl(n|0,i|0,l|0)|0;Ji(f[r>>2]|0)}f[r>>2]=n;n=n+l|0;f[u>>2]=n;f[s>>2]=o}Yl(n|0,e|0,t|0)|0;f[u>>2]=(f[u>>2]|0)+t;return t|0}function zi(e,t){e=e|0;t=t|0;var r=0,n=0,i=0;i=(f[t>>2]|0)+(f[t+8>>2]|0)|0;t=t+4|0;r=f[t>>2]|0;n=i-r|0;if((i|0)==(r|0)){i=-1;return i|0}f[t>>2]=r+e;i=n>>>0>e>>>0?e:n;return i|0}function ji(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;n=f[r+8>>2]|0;f[r+4>>2]=(f[r>>2]|0)+(0>(t|0)|0==(t|0)&n>>>0>e>>>0?e:n);return 1}function Vi(e,t,r){e=e|0;t=t|0;r=r|0;t=nl(e,1,t,r)|0;return((t|0)!=0?t:-1)|0}function Gi(e,t,r){e=e|0;t=t|0;r=r|0;return hl(e,1,t,r)|0}function Wi(e,t,r){e=e|0;t=t|0;r=r|0;r=(ol(r,e,1)|0)==0;B=r?t:-1;return(r?e:-1)|0}function Xi(e,t,r){e=e|0;t=t|0;r=r|0;return(ol(r,e,0)|0)==0|0}function Yi(e){e=e|0;if(!e)e=0;else e=Cl(e)|0;return e|0}function qi(e,t){e=e|0;t=t|0;if(!t)e=0;else e=Hl(e,t)|0;return e|0}function Zi(e){e=e|0;var t=0,r=0;r=b;b=b+16|0;t=r;do{if(e)if(!(Dl(t,16,e)|0)){t=f[t>>2]|0;break}else{f[t>>2]=0;t=0;break}else t=0}while(0);b=r;return t|0}function Ki(e){e=e|0;Il(e);return}function Qi(e,t){e=e|0;t=t|0;if(!t)t=0;else t=Ol(e,t)|0;return t|0}function Ji(e){e=e|0;Il(e);return}function $i(e){e=e|0;var t=0,r=0;t=696;while(1){r=f[t>>2]|0;if((r|0)==-1|(r|0)==(e|0))break;else t=t+12|0}return t+4|0}function ea(e,t){e=e|0;t=t|0;if(!((e|0)!=0&(t|0)!=0))return;f[e+172>>2]=f[t+4>>2];f[e+168>>2]=f[t>>2];return}function ta(){var e=0,t=0;e=qi(1,208)|0;if(!e){e=0;return e|0}f[e>>2]=0;t=e+184|0;h[t>>0]=h[t>>0]&-3;t=Yi(1e3)|0;f[e+44>>2]=t;if(!t){ra(e);t=0;return t|0}f[e+48>>2]=1e3;t=vo()|0;f[e+192>>2]=t;if(!t){ra(e);t=0;return t|0}t=vo()|0;f[e+188>>2]=t;if(t){t=e;return t|0}ra(e);t=0;return t|0}function ra(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;if(!e)return;if(!(f[e>>2]|0)){t=e+36|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+24|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0;f[e+28>>2]=0}t=e+44|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0;f[e+48>>2]=0}}else{t=e+12|0;r=f[t>>2]|0;if(r){Ta(r);Ji(f[t>>2]|0);f[t>>2]=0}t=e+16|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0;f[e+20>>2]=0}}Wr(f[e+204>>2]|0);t=e+88|0;a=e+164|0;r=f[a>>2]|0;if(r){n=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;if(n){i=0;while(1){Ta(r);i=i+1|0;if((i|0)==(n|0))break;else r=r+5640|0}r=f[a>>2]|0}Ji(r);f[a>>2]=0}a=e+124|0;r=f[a>>2]|0;if(r){o=e+120|0;n=f[o>>2]|0;if(n){i=0;while(1){r=f[r+(i<<3)>>2]|0;if(r){Ji(r);n=f[o>>2]|0}i=i+1|0;if(i>>>0>=n>>>0)break;r=f[a>>2]|0}r=f[a>>2]|0}f[o>>2]=0;Ji(r);f[a>>2]=0}o=e+144|0;Ji(f[o>>2]|0);f[o>>2]=0;f[e+128>>2]=0;o=e+108|0;Ji(f[o>>2]|0);f[o>>2]=0;if(!(h[e+184>>0]&2)){o=e+176|0;Ji(f[o>>2]|0);f[o>>2]=0}r=t+100|0;do{f[t>>2]=0;t=t+4|0}while((t|0)<(r|0));o=e+188|0;yo(f[o>>2]|0);f[o>>2]=0;yo(f[e+192>>2]|0);f[o>>2]=0;o=e+196|0;sa(f[o>>2]|0);f[o>>2]=0;o=e+80|0;ni(f[o>>2]|0);f[o>>2]=0;o=e+84|0;ni(f[o>>2]|0);f[o>>2]=0;Ji(e);return}function na(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0.0,m=0,g=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0.0;ue=b;b=b+320|0;ie=ue+296|0;ne=ue+288|0;le=ue+280|0;se=ue+272|0;oe=ue+264|0;ae=ue+256|0;re=ue+248|0;te=ue+240|0;Y=ue+232|0;W=ue+224|0;G=ue+216|0;V=ue+208|0;j=ue+200|0;z=ue+192|0;B=ue+184|0;E=ue+176|0;_=ue+168|0;g=ue+160|0;m=ue+152|0;c=ue+144|0;H=ue+136|0;I=ue+128|0;N=ue+112|0;C=ue+104|0;L=ue+96|0;P=ue+88|0;R=ue+80|0;A=ue+72|0;S=ue+64|0;M=ue+56|0;T=ue+48|0;x=ue+32|0;w=ue+24|0;u=ue+16|0;o=ue+8|0;a=ue;D=ue+309|0;F=ue+300|0;if(!((e|0)!=0&(t|0)!=0&(r|0)!=0)){n=0;b=ue;return n|0}ee=t+5592|0;i=f[ee>>2]|0;if((i+-1|0)>>>0>32){f[a>>2]=i;f[a+4>>2]=33;Jn(n,1,4875,a)|0;n=0;b=ue;return n|0}J=e+112|0;f[J>>2]=1;$=e+116|0;f[$>>2]=1;O=t+18704|0;do{if(!(d[O>>1]|0)){switch(f[t+18676>>2]|0){case 1:{d[O>>1]=3;f[t+18700>>2]=1302083;f[t+18680>>2]=1041666;a=1;break}case 2:{d[O>>1]=3;f[t+18700>>2]=651041;f[t+18680>>2]=520833;a=1;break}case 3:{d[O>>1]=4;f[t+18700>>2]=1302083;f[t+18680>>2]=1041666;a=1;break}default:a=0}i=f[t+18684>>2]|0;e:do{if((i|0)>=4)if((i|0)<33024){switch(i|0){case 4:break;default:{Q=13;break e}}d[O>>1]=4;break}else{switch(i|0){case 33024:break;default:{Q=13;break e}}d[O>>1]=-32512;break}else{switch(i|0){case 3:break;default:{Q=13;break e}}d[O>>1]=3}}while(0);if((Q|0)==13?(a|0)==0:0)break;Jn(n,2,4931,o)|0}}while(0);k=t+18700|0;i=f[k>>2]|0;do{if((i|0)<1){p=+v[t+4792+((f[t+4788>>2]|0)+-1<<2)>>2];if(p>0.0){q=f[r+24>>2]|0;u=ce(f[q+8>>2]|0,f[r+16>>2]|0)|0;u=ce(u,f[q+12>>2]|0)|0;he=+((ce(u,f[q+24>>2]|0)|0)>>>0);q=~~+K(+(he/(p*8.0*+((f[q>>2]|0)>>>0)*+((f[q+4>>2]|0)>>>0))));f[k>>2]=q;break}else{f[k>>2]=0;break}}else{l=f[r+24>>2]|0;q=ce(f[l+8>>2]|0,f[r+16>>2]|0)|0;q=ce(q,f[l+12>>2]|0)|0;p=+((ce(q,f[l+24>>2]|0)|0)>>>0);i=ce(i<<3,f[l>>2]|0)|0;p=p/+((ce(i,f[l+4>>2]|0)|0)>>>0);l=t+4788|0;i=f[l>>2]|0;if(i){o=i;i=0;s=0;while(1){a=t+4792+(s<<2)|0;if(+v[a>>2]<p){v[a>>2]=p;a=f[l>>2]|0;i=1}else a=o;s=s+1|0;if(s>>>0>=a>>>0)break;else o=a}if(i)Jn(n,2,5068,u)|0}}}while(0);i=d[O>>1]|0;e:do{if((i+-3&65535)>=4){if(i<<16>>16==7){Jn(n,2,7228,c)|0;d[O>>1]=0;i=0;break}if((i+-256&65535)<524){Jn(n,2,7283,m)|0;d[O>>1]=0;i=0;break}if((i+-1024&65535)<1180){Jn(n,2,7331,g)|0;d[O>>1]=0;i=0;break}if(i<<16>>16<=-1)switch(i<<16>>16){case-32512:{i=-32512;break e}case-32768:{Jn(n,2,7373,_)|0;d[O>>1]=0;i=0;break e}default:{Jn(n,2,7461,E)|0;d[O>>1]=0;i=0;break e}}}else{if((i+-5&65535)<2){Jn(n,2,5160,w)|0;d[O>>1]=0;i=0;break}f[t>>2]=0;f[t+12>>2]=1;f[t+16>>2]=1;h[t+18689>>0]=67;h[t+18688>>0]=1;f[t+4>>2]=0;f[t+8>>2]=0;f[t+18180>>2]=0;f[t+18184>>2]=0;f[t+5596>>2]=32;f[t+5600>>2]=32;f[t+5604>>2]=0;f[t+5612>>2]=-1;f[t+18188>>2]=1;f[t+18192>>2]=1;f[t+5608>>2]=1;a=t+4788|0;o=f[a>>2]|0;if((o|0)>1){he=+v[t+4792+(o+-1<<2)>>2];f[x>>2]=o;y[x+8>>3]=he;Jn(n,2,5222,x)|0;f[t+4792>>2]=f[t+4792+((f[a>>2]|0)+-1<<2)>>2];f[a>>2]=1;i=d[O>>1]|0}t:do{switch(i&65535|0){case 3:{i=f[ee>>2]|0;if((i|0)>6){f[T>>2]=i+1;Jn(n,2,5395,T)|0;f[ee>>2]=6;i=6}break}case 4:{i=f[ee>>2]|0;if((i|0)<2){f[M>>2]=i+1;Jn(n,2,5541,M)|0;f[ee>>2]=1;i=1;break t}if((i|0)>7){f[S>>2]=i+1;Jn(n,2,5695,S)|0;f[ee>>2]=7;i=7}break}default:i=f[ee>>2]|0}}while(0);a=t+40|0;f[a>>2]=f[a>>2]|1;a=t+5620|0;f[a>>2]=i+-1;if((i|0)>1){i=0;do{f[t+5624+(i<<2)>>2]=256;f[t+5756+(i<<2)>>2]=256;i=i+1|0}while((i|0)<(f[a>>2]|0))}f[t+44>>2]=4;if((d[O>>1]|0)==4){i=f[ee>>2]|0;f[t+96>>2]=1;f[t+48>>2]=0;f[t+52>>2]=0;f[t+56>>2]=1;q=i+-1|0;f[t+60>>2]=q;f[t+64>>2]=3;f[t+80>>2]=4;f[t+244>>2]=1;f[t+196>>2]=q;f[t+200>>2]=0;f[t+204>>2]=1;f[t+208>>2]=i;f[t+212>>2]=3;f[t+228>>2]=4;i=2}else i=0;f[t+4784>>2]=i;f[t+20>>2]=1;i=f[k>>2]|0;if((i|0)>=1){if((i|0)>1302083){Jn(n,2,5998,R)|0;f[k>>2]=1302083}}else{f[k>>2]=1302083;Jn(n,2,5849,A)|0}i=t+18680|0;a=f[i>>2]|0;if((a|0)>=1){if((a|0)>1041666){Jn(n,2,6320,L)|0;f[i>>2]=1041666}}else{f[i>>2]=1041666;Jn(n,2,6171,P)|0}a=f[r+16>>2]|0;s=f[r+24>>2]|0;l=f[s+8>>2]|0;i=ce(l,a)|0;u=f[s+12>>2]|0;i=ce(i,u)|0;he=+((ce(i,f[s+24>>2]|0)|0)>>>0);i=ce(f[k>>2]<<3,f[s>>2]|0)|0;he=he/+((ce(i,f[s+4>>2]|0)|0)>>>0);v[t+4792>>2]=he;i=d[O>>1]|0;t:do{if((a|0)==3){a=s+28|0;o=s+32|0;if(!((f[a>>2]|0)!=12|f[o>>2])){a=s+80|0;o=s+84|0;if(!((f[a>>2]|0)!=12|f[o>>2])){a=s+132|0;o=s+136|0;if(!((f[a>>2]|0)!=12|f[o>>2])){switch(i&65535|0){case 3:{if(u>>>0>1080|l>>>0>2048){f[I>>2]=l;f[I+4>>2]=u;Jn(n,2,6892,I)|0;break t}break}case 4:{if(u>>>0>2160|l>>>0>4096){f[H>>2]=l;f[H+4>>2]=u;Jn(n,2,7063,H)|0;break t}break}default:{}}break e}else{u=a;i=o;a=2}}else{u=a;i=o;a=1}}else{u=a;i=o;a=0}h[D>>0]=h[6659]|0;h[D+1>>0]=h[6660]|0;h[D+2>>0]=h[6661]|0;h[D+3>>0]=h[6662]|0;h[D+4>>0]=h[6663]|0;h[D+5>>0]=h[6664]|0;h[D+6>>0]=h[6665]|0;o=F;s=6666;l=o+9|0;do{h[o>>0]=h[s>>0]|0;o=o+1|0;s=s+1|0}while((o|0)<(l|0));q=(f[i>>2]|0)!=0?D:F;F=f[u>>2]|0;f[N>>2]=a;f[N+4>>2]=F;f[N+8>>2]=q;Jn(n,2,6675,N)|0}else{f[C>>2]=a;Jn(n,2,6493,C)|0}}while(0);d[O>>1]=0;i=0}}while(0);f[e+168>>2]=f[t+18680>>2];q=e+88|0;d[q>>1]=i;N=e+181|0;D=h[N>>0]&-2|f[t+20>>2]&1;h[N>>0]=D;F=t+24|0;D=(f[F>>2]&255)<<1&2|D&-3;h[N>>0]=D;h[N>>0]=D&-5|(f[t+28>>2]&255)<<2&4;do{if((f[F>>2]|0)!=0?(U=t+32|0,(f[U>>2]|0)!=0):0){i=ce((f[t+4788>>2]|0)*12|0,f[ee>>2]|0)|0;a=Yi(i)|0;f[e+176>>2]=a;if(a){Yl(a|0,f[U>>2]|0,i|0)|0;break}Jn(n,1,7520,B)|0;n=0;b=ue;return n|0}}while(0);s=e+100|0;f[s>>2]=f[t+12>>2];l=e+104|0;f[l>>2]=f[t+16>>2];o=e+92|0;f[o>>2]=f[t+4>>2];u=e+96|0;f[u>>2]=f[t+8>>2];a=t+36|0;i=f[a>>2]|0;do{if(!i){i=hi()|0;a=Yi((xl(i)|0)+29|0)|0;f[e+108>>2]=a;if(a){f[V>>2]=7697;f[V+4>>2]=i;pl(a,7692,V)|0;break}Jn(n,1,7646,j)|0;n=0;b=ue;return n|0}else{i=Yi((xl(i)|0)+1|0)|0;f[e+108>>2]=i;if(i){wl(i,f[a>>2]|0)|0;break}Jn(n,1,7592,z)|0;n=0;b=ue;return n|0}}while(0);i=(f[r+8>>2]|0)-(f[o>>2]|0)|0;a=f[r+12>>2]|0;if(!(f[t>>2]|0)){f[s>>2]=i;f[l>>2]=a-(f[u>>2]|0)}else{V=f[s>>2]|0;f[J>>2]=(i+-1+V|0)/(V|0)|0;V=f[l>>2]|0;f[$>>2]=(a+-1-(f[u>>2]|0)+V|0)/(V|0)|0}if(h[t+18688>>0]|0){h[e+180>>0]=h[t+18689>>0]|0;h[N>>0]=h[N>>0]|8}V=qi(ce(f[$>>2]|0,f[J>>2]|0)|0,5640)|0;F=e+164|0;f[F>>2]=V;if(!V){Jn(n,1,7726,G)|0;n=0;b=ue;return n|0}D=t+4784|0;S=f[D>>2]|0;do{if(S){w=t+48|0;A=f[ee>>2]|0;R=f[r+16>>2]|0;k=f[t+4788>>2]|0;P=ce(R,A)|0;L=qi(ce(P,k)|0,4)|0;if(!L){Jn(n,1,7780,W)|0;break}o=f[w>>2]|0;m=t+60|0;i=f[m>>2]|0;if(o>>>0<i>>>0){c=ce(o,R)|0;g=t+52|0;_=t+64|0;E=t+56|0;a=f[_>>2]|0;while(1){s=f[g>>2]|0;if(s>>>0<a>>>0){i=f[E>>2]|0;u=s;l=s+c|0;while(1){if(!i)i=0;else{a=l;s=0;while(1){f[L+(a<<2)>>2]=1;s=s+1|0;i=f[E>>2]|0;if(s>>>0>=i>>>0)break;else a=a+P|0}a=f[_>>2]|0}u=u+1|0;if(u>>>0>=a>>>0)break;else l=l+1|0}i=f[m>>2]|0}o=o+1|0;if(o>>>0>=i>>>0)break;else c=c+R|0}}if(S>>>0>1){M=1;do{i=w;w=w+148|0;E=f[i+8>>2]|0;_=i+156|0;s=f[_>>2]|0;E=s>>>0>E>>>0?E:0;l=f[w>>2]|0;x=i+160|0;a=f[x>>2]|0;if(l>>>0<a>>>0){c=ce(l,R)|0;T=i+152|0;m=i+164|0;g=ce(E,P)|0;o=f[m>>2]|0;i=s;while(1){s=f[T>>2]|0;if(s>>>0<o>>>0){u=s;s=s+c|0;while(1){if(E>>>0<i>>>0){a=s+g|0;o=E;while(1){f[L+(a<<2)>>2]=1;o=o+1|0;i=f[_>>2]|0;if(o>>>0>=i>>>0)break;else a=a+P|0}o=f[m>>2]|0}u=u+1|0;if(u>>>0>=o>>>0)break;else s=s+1|0}a=f[x>>2]|0}l=l+1|0;if(l>>>0>=a>>>0)break;else c=c+R|0}}M=M+1|0}while((M|0)!=(S|0))}if((k|0)!=0?(X=(R|0)==0,(A|0)!=0):0){a=0;c=0;i=0;do{if(!X){u=a;l=0;while(1){o=0;s=u;while(1){i=(f[L+(s<<2)>>2]|0)!=1|i;o=o+1|0;if((o|0)==(R|0))break;else s=s+1|0}l=l+1|0;if((l|0)==(A|0))break;else u=u+R|0}a=P+a|0}c=c+1|0}while((c|0)!=(k|0));if(i)Jn(n,1,7828,Y)|0}Ji(L)}}while(0);e:do{if(ce(f[$>>2]|0,f[J>>2]|0)|0){w=t+4788|0;x=t+40|0;T=t+44|0;M=t+18690|0;S=r+16|0;a=t+18696|0;A=r+24|0;R=t+5596|0;k=t+5600|0;P=t+5604|0;L=t+5608|0;C=t+5612|0;I=t+5616|0;H=t+5620|0;O=0;t:while(1){c=f[F>>2]|0;m=c+(O*5640|0)|0;Y=f[w>>2]|0;i=c+(O*5640|0)+8|0;f[i>>2]=Y;if(Y){o=((d[q>>1]|0)+-3&65535)<4;l=0;do{s=(h[N>>0]&4)==0;do{if(!o)if(s){f[c+(O*5640|0)+20+(l<<2)>>2]=f[t+4792+(l<<2)>>2];break}else{f[c+(O*5640|0)+5184+(l<<2)>>2]=f[t+5192+(l<<2)>>2];break}else{if(!s)f[c+(O*5640|0)+5184+(l<<2)>>2]=f[t+5192+(l<<2)>>2];f[c+(O*5640|0)+20+(l<<2)>>2]=f[t+4792+(l<<2)>>2]}}while(0);l=l+1|0}while(l>>>0<(f[i>>2]|0)>>>0)}f[m>>2]=f[x>>2];f[c+(O*5640|0)+4>>2]=f[T>>2];u=c+(O*5640|0)+16|0;f[u>>2]=h[M>>0];i=c+(O*5640|0)+5636|0;o=h[i>>0]|0;h[i>>0]=o&-5;if(!(f[D>>2]|0))f[c+(O*5640|0)+420>>2]=0;else{h[i>>0]=o|4;o=f[D>>2]|0;if(!o)i=0;else{s=O+1|0;l=0;i=0;do{if((s|0)==(f[t+48+(l*148|0)+48>>2]|0)){f[c+(O*5640|0)+424+(i*148|0)>>2]=f[t+48+(i*148|0)>>2];f[c+(O*5640|0)+424+(i*148|0)+4>>2]=f[t+48+(i*148|0)+4>>2];f[c+(O*5640|0)+424+(i*148|0)+8>>2]=f[t+48+(i*148|0)+8>>2];f[c+(O*5640|0)+424+(i*148|0)+12>>2]=f[t+48+(i*148|0)+12>>2];f[c+(O*5640|0)+424+(i*148|0)+16>>2]=f[t+48+(i*148|0)+16>>2];f[c+(O*5640|0)+424+(i*148|0)+32>>2]=f[t+48+(i*148|0)+32>>2];f[c+(O*5640|0)+424+(i*148|0)+48>>2]=f[t+48+(i*148|0)+48>>2];i=i+1|0}l=l+1|0}while(l>>>0<o>>>0)}f[c+(O*5640|0)+420>>2]=i+-1}Y=qi(f[S>>2]|0,1080)|0;E=c+(O*5640|0)+5584|0;f[E>>2]=Y;if(!Y){Q=149;break}do{if(!(f[a>>2]|0)){r:do{if((f[u>>2]|0)==1){i=f[S>>2]|0;if(i>>>0<=2){s=i;break}o=f[A>>2]|0;i=f[o>>2]|0;do{if((i|0)==(f[o+52>>2]|0)){if((i|0)!=(f[o+104>>2]|0))break;i=f[o+4>>2]|0;if((i|0)!=(f[o+56>>2]|0))break;if((i|0)==(f[o+108>>2]|0)){Q=175;break r}}}while(0);Jn(n,2,8224,ie)|0;f[u>>2]=0;Q=175}else Q=175}while(0);if((Q|0)==175){Q=0;s=f[S>>2]|0}if(!s)break;i=f[A>>2]|0;o=0;do{if(!(f[i+(o*52|0)+32>>2]|0))f[(f[E>>2]|0)+(o*1080|0)+1076>>2]=1<<(f[i+(o*52|0)+24>>2]|0)+-1;o=o+1|0}while(o>>>0<s>>>0);Z=s;Q=166}else{s=f[S>>2]|0;s=ce(s<<2,s)|0;i=Yi(s)|0;l=(f[a>>2]|0)+s|0;if(!i){Q=152;break t}f[u>>2]=2;o=Yi(s)|0;f[c+(O*5640|0)+5608>>2]=o;if(!o){Q=154;break t}Yl(o|0,f[a>>2]|0,s|0)|0;Yl(i|0,f[a>>2]|0,s|0)|0;o=Yi(s)|0;s=c+(O*5640|0)+5604|0;f[s>>2]=o;if(!o){Q=156;break t}if(!(qo(i,o,f[S>>2]|0)|0)){Q=158;break t}o=Yi(f[S>>2]<<3)|0;f[c+(O*5640|0)+5600>>2]=o;if(!o){Q=160;break t}kr(o,f[S>>2]|0,f[s>>2]|0);Ji(i);i=f[S>>2]|0;if(i){o=f[E>>2]|0;s=0;do{f[o+(s*1080|0)+1076>>2]=f[l+(s<<2)>>2];s=s+1|0}while(s>>>0<i>>>0)}if(!(ia(m,r)|0)){Q=167;break t}Z=f[S>>2]|0;Q=166}}while(0);if((Q|0)==166?(Q=0,(Z|0)!=0):0){_=0;do{m=f[E>>2]|0;g=m+(_*1080|0)|0;f[g>>2]=f[x>>2]&1;s=f[ee>>2]|0;l=m+(_*1080|0)+4|0;f[l>>2]=s;i=f[R>>2]|0;if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+8>>2]=i;i=f[k>>2]|0;if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+12>>2]=i;f[m+(_*1080|0)+16>>2]=f[P>>2];Y=f[L>>2]|0;f[m+(_*1080|0)+20>>2]=(Y|0)==0&1;f[m+(_*1080|0)+24>>2]=(Y|0)!=0?2:0;f[m+(_*1080|0)+804>>2]=2;if((_|0)==(f[C>>2]|0))i=f[I>>2]|0;else i=0;f[m+(_*1080|0)+808>>2]=i;do{if(!(f[x>>2]&1)){if(!s)break;else i=0;do{f[m+(_*1080|0)+812+(i<<2)>>2]=15;f[m+(_*1080|0)+944+(i<<2)>>2]=15;i=i+1|0}while(i>>>0<(f[l>>2]|0)>>>0)}else{if((s|0)>0){l=s;c=0}else break;while(1){u=l;l=l+-1|0;i=f[H>>2]|0;do{if((c|0)<(i|0)){i=f[t+5624+(c<<2)>>2]|0;if((i|0)<1)f[m+(_*1080|0)+812+(l<<2)>>2]=1;else{if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+812+(l<<2)>>2]=i}i=f[t+5756+(c<<2)>>2]|0;if((i|0)<1){f[m+(_*1080|0)+944+(l<<2)>>2]=1;break}if((i|0)>1){o=0;do{i=i>>1;o=o+1|0}while((i|0)>1);i=o}else i=0;f[m+(_*1080|0)+944+(l<<2)>>2]=i}else{Y=i+-1|0;o=c-Y|0;i=f[t+5624+(Y<<2)>>2]>>o;o=f[t+5756+(Y<<2)>>2]>>o;if((i|0)<1)f[m+(_*1080|0)+812+(l<<2)>>2]=1;else{if((i|0)>1){s=0;do{i=i>>1;s=s+1|0}while((i|0)>1);i=s}else i=0;f[m+(_*1080|0)+812+(l<<2)>>2]=i}if((o|0)<1){f[m+(_*1080|0)+944+(l<<2)>>2]=1;break}if((o|0)>1){i=0;do{o=o>>1;i=i+1|0}while((o|0)>1)}else i=0;f[m+(_*1080|0)+944+(l<<2)>>2]=i}}while(0);if((u|0)<=1)break;else c=c+1|0}}}while(0);Uo(g,f[(f[A>>2]|0)+(_*52|0)+24>>2]|0);_=_+1|0}while(_>>>0<(f[S>>2]|0)>>>0)}O=O+1|0;if(O>>>0>=(ce(f[$>>2]|0,f[J>>2]|0)|0)>>>0)break e}if((Q|0)==149){Jn(n,1,7867,te)|0;n=0;b=ue;return n|0}else if((Q|0)==152){Jn(n,1,7931,re)|0;n=0;b=ue;return n|0}else if((Q|0)==154){Ji(i);Jn(n,1,7974,ae)|0;n=0;b=ue;return n|0}else if((Q|0)==156){Ji(i);Jn(n,1,8032,oe)|0;n=0;b=ue;return n|0}else if((Q|0)==158){Ji(i);Jn(n,1,8092,se)|0;n=0;b=ue;return n|0}else if((Q|0)==160){Ji(i);Jn(n,1,8140,le)|0;n=0;b=ue;return n|0}else if((Q|0)==167){Jn(n,1,8190,ne)|0;n=0;b=ue;return n|0}}else a=t+18696|0}while(0);i=f[a>>2]|0;if(!i){n=1;b=ue;return n|0}Ji(i);f[a>>2]=0;n=1;b=ue;return n|0}function ia(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0;if((f[e+16>>2]|0)!=2){e=1;return e|0}u=e+5604|0;g=e+5616|0;r=f[g>>2]|0;c=e+5620|0;do{if(f[u>>2]|0){do{if((r|0)==(f[c>>2]|0)){r=r+10|0;f[c>>2]=r;n=e+5612|0;r=Qi(f[n>>2]|0,r*20|0)|0;if(r){f[n>>2]=r;m=f[g>>2]|0;Vl(r+(m*20|0)|0,0,((f[c>>2]|0)-m|0)*20|0)|0;r=f[g>>2]|0;break}Ji(f[n>>2]|0);f[n>>2]=0;f[c>>2]=0;f[g>>2]=0;e=0;return e|0}else n=e+5612|0}while(0);s=f[n>>2]|0;a=s+(r*20|0)|0;l=s+(r*20|0)+12|0;n=f[l>>2]|0;if(n){Ji(n);f[l>>2]=0}f[s+(r*20|0)+8>>2]=1;f[s+(r*20|0)+4>>2]=1;f[a>>2]=2;n=f[t+16>>2]|0;n=ce(n,n)|0;i=n<<2;o=Yi(i)|0;f[l>>2]=o;if(!o){e=0;return e|0}else{Ou[f[768+(f[a>>2]<<2)>>2]&15](f[u>>2]|0,o,n);f[s+(r*20|0)+16>>2]=i;r=(f[g>>2]|0)+1|0;f[g>>2]=r;o=2;break}}else{o=1;a=0}}while(0);do{if((r|0)==(f[c>>2]|0)){n=r+10|0;f[c>>2]=n;r=e+5612|0;n=Qi(f[r>>2]|0,n*20|0)|0;if(!n){Ji(f[r>>2]|0);f[r>>2]=0;f[c>>2]=0;f[g>>2]=0;e=0;return e|0}else{f[r>>2]=n;i=f[g>>2]|0;Vl(n+(i*20|0)|0,0,((f[c>>2]|0)-i|0)*20|0)|0;if(!a){a=0;break}a=n+((i+-1|0)*20|0)|0;break}}else r=e+5612|0}while(0);u=f[r>>2]|0;c=f[g>>2]|0;m=u+(c*20|0)|0;d=u+(c*20|0)+12|0;r=f[d>>2]|0;if(r){Ji(r);f[d>>2]=0}p=o+1|0;f[u+(c*20|0)+8>>2]=o;f[u+(c*20|0)+4>>2]=2;f[m>>2]=2;t=t+16|0;r=f[t>>2]|0;n=r<<2;l=Yi(n)|0;f[d>>2]=l;if(!l){e=0;return e|0}i=Yi(n)|0;if(!i){Ji(f[d>>2]|0);f[d>>2]=0;e=0;return e|0}if(r){o=0;s=i;l=f[e+5584>>2]|0;while(1){v[s>>2]=+(f[l+1076>>2]|0);o=o+1|0;if((o|0)==(r|0))break;else{s=s+4|0;l=l+1080|0}}}Ou[f[768+(f[m>>2]<<2)>>2]&15](i,f[d>>2]|0,r);Ji(i);f[u+(c*20|0)+16>>2]=n;f[g>>2]=(f[g>>2]|0)+1;o=e+5628|0;r=f[o>>2]|0;i=e+5632|0;do{if((r|0)==(f[i>>2]|0)){r=r+10|0;f[i>>2]=r;n=e+5624|0;r=Qi(f[n>>2]|0,r*20|0)|0;if(r){f[n>>2]=r;e=f[o>>2]|0;Vl(r+(e*20|0)|0,0,((f[i>>2]|0)-e|0)*20|0)|0;r=f[o>>2]|0;break}Ji(f[n>>2]|0);f[n>>2]=0;f[i>>2]=0;f[o>>2]=0;e=0;return e|0}else n=e+5624|0}while(0);e=f[n>>2]|0;f[e+(r*20|0)+8>>2]=a;g=e+(r*20|0)+16|0;h[g>>0]=h[g>>0]|1;f[e+(r*20|0)+4>>2]=f[t>>2];f[e+(r*20|0)>>2]=p;f[e+(r*20|0)+12>>2]=m;f[o>>2]=(f[o>>2]|0)+1;e=1;return e|0}function aa(e,t,r){e=e|0;t=t|0;r=r|0;return 1}function oa(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;l=ti()|0;u=t+80|0;f[u>>2]=l;if(!l){u=0;return u|0}i=t+192|0;if((_o(f[i>>2]|0,23,n)|0)!=0?(_o(f[i>>2]|0,24,n)|0)!=0:0){o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}}else wo(o);i=t+188|0;if((_o(f[i>>2]|0,25,n)|0)!=0?(_o(f[i>>2]|0,26,n)|0)!=0:0){o=f[i>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](t,e,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}}else wo(o);i=ti()|0;f[r>>2]=i;if(!i){u=0;return u|0}ai(f[u>>2]|0,i);i=ce(f[t+116>>2]|0,f[t+112>>2]|0)|0;s=t+196|0;f[(f[s>>2]|0)+36>>2]=i;i=qi(i,40)|0;a=f[s>>2]|0;f[a+40>>2]=i;if(!i){u=0;return u|0}if(!(f[a+36>>2]|0)){u=1;return u|0}o=0;while(1){f[i+(o*40|0)+28>>2]=100;f[i+(o*40|0)+20>>2]=0;u=qi(100,24)|0;a=f[s>>2]|0;i=f[a+40>>2]|0;f[i+(o*40|0)+24>>2]=u;o=o+1|0;if(!u){i=0;a=30;break}if(o>>>0>=(f[a+36>>2]|0)>>>0){i=1;a=30;break}}if((a|0)==30)return i|0}ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}ni(f[u>>2]|0);f[u>>2]=0;u=0;return u|0}function sa(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;if(!e)return;t=e+28|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}o=e+40|0;t=f[o>>2]|0;if(t){a=e+36|0;if(f[a>>2]|0){r=t;i=0;do{n=f[r+(i*40|0)+36>>2]|0;if(n){Ji(n);t=f[o>>2]|0;f[t+(i*40|0)+36>>2]=0;r=t}n=f[r+(i*40|0)+16>>2]|0;if(n){Ji(n);t=f[o>>2]|0;f[t+(i*40|0)+16>>2]=0;r=t}n=f[r+(i*40|0)+24>>2]|0;if(n){Ji(n);r=f[o>>2]|0;f[r+(i*40|0)+24>>2]=0;t=r}i=i+1|0}while(i>>>0<(f[a>>2]|0)>>>0)}Ji(t);f[o>>2]=0}Ji(e);return}function la(e,t,r,n,i,a,o,s,l,u,c){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;var p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Me=0,Se=0,Ae=0,Re=0,ke=0;ke=b;b=b+256|0;Re=ke+200|0;Ae=ke+192|0;Me=ke+184|0;Te=ke+176|0;me=ke+168|0;pe=ke+160|0;fe=ke+152|0;de=ke+144|0;he=ke+136|0;ue=ke+128|0;se=ke+120|0;oe=ke+112|0;we=ke+104|0;be=ke+96|0;ae=ke+88|0;ie=ke+80|0;ne=ke+72|0;Ee=ke+64|0;re=ke+56|0;te=ke+48|0;ye=ke+40|0;ve=ke+32|0;ge=ke+24|0;le=ke+16|0;ee=ke+8|0;$=ke;Y=ke+240|0;W=ke+236|0;Z=ke+232|0;Q=ke+228|0;J=ke+224|0;X=ke+220|0;K=ke+216|0;G=ke+212|0;q=ke+208|0;f[G>>2]=65424;Se=e+8|0;e:do{switch(f[Se>>2]|0){case 256:{f[G>>2]=65497;p=e+76|0;xe=117;break}case 8:{_e=e+76|0;if(!(h[_e>>0]&1)){U=e+200|0;z=e+164|0;j=e+72|0;V=e+24|0;A=e+196|0;R=e+112|0;k=e+116|0;L=Y+2|0;C=Y+6|0;I=Y+7|0;H=e+16|0;O=e+20|0;D=e+64|0;p=65424;t:while(1){r:do{if((p|0)!=65427){while(1){S=qn(u)|0;if((S|0)==0&(B|0)==0){xe=7;break}if((Gn(u,f[H>>2]|0,2,c)|0)!=2){xe=9;break t}wn(f[H>>2]|0,q,2);if((f[q>>2]|0)>>>0<2){xe=11;break t}if((f[G>>2]|0)==32896?(S=qn(u)|0,(S|0)==0&(B|0)==0):0){xe=14;break}v=f[Se>>2]|0;p=f[q>>2]|0;if(v&16)f[V>>2]=-2-p+(f[V>>2]|0);m=p+-2|0;f[q>>2]=m;p=f[G>>2]|0;g=784;while(1){S=f[g>>2]|0;if((S|0)==0|(S|0)==(p|0)){T=g;break}else g=g+12|0}if(!(f[g+4>>2]&v)){xe=20;break t}if(m>>>0>(f[O>>2]|0)>>>0){S=qn(u)|0;M=B;if(0>(M|0)|0==(M|0)&m>>>0>S>>>0){xe=24;break t}p=Qi(f[H>>2]|0,f[q>>2]|0)|0;if(!p){xe=26;break t}f[H>>2]=p;m=f[q>>2]|0;f[O>>2]=m}else p=f[H>>2]|0;m=Gn(u,p,m,c)|0;if((m|0)!=(f[q>>2]|0)){xe=29;break t}p=f[g+8>>2]|0;if(!p){xe=31;break t}if(!(Fu[p&63](e,f[H>>2]|0,m,c)|0)){xe=33;break t}g=f[U>>2]|0;m=f[A>>2]|0;E=f[T>>2]|0;w=Yn(u)|0;x=f[q>>2]|0;w=w-x+-4|0;x=x+4|0;m=m+40|0;_=f[m>>2]|0;p=f[_+(g*40|0)+20>>2]|0;v=_+(g*40|0)+28|0;y=f[v>>2]|0;if((p+1|0)>>>0>y>>>0){y=~~(+(y>>>0)+100.0)>>>0;f[v>>2]=y;v=Qi(f[_+(g*40|0)+24>>2]|0,y*24|0)|0;y=f[m>>2]|0;p=y+(g*40|0)+24|0;if(!v){xe=41;break t}f[p>>2]=v;m=y;p=f[y+(g*40|0)+20>>2]|0}else{m=_;v=f[_+(g*40|0)+24>>2]|0}d[v+(p*24|0)>>1]=E;S=v+(p*24|0)+8|0;f[S>>2]=w;f[S+4>>2]=((w|0)<0)<<31>>31;f[v+(p*24|0)+16>>2]=x;f[m+(g*40|0)+20>>2]=p+1;if((E|0)==65424?(P=f[m+(g*40|0)+16>>2]|0,(P|0)!=0):0){S=P+((f[m+(g*40|0)+12>>2]|0)*24|0)|0;f[S>>2]=w;f[S+4>>2]=0}do{if((f[T>>2]|0)==65424){p=Yn(u)|0;p=-4-(f[q>>2]|0)+p|0;S=D;M=f[S+4>>2]|0;if(!(0>(M|0)|(0==(M|0)?p>>>0>(f[S>>2]|0)>>>0:0)))break;S=D;f[S>>2]=p;f[S+4>>2]=0}}while(0);if(h[_e>>0]&4){xe=46;break}if((Gn(u,f[H>>2]|0,2,c)|0)!=2){xe=50;break t}wn(f[H>>2]|0,G,2);if((f[G>>2]|0)==65427)break r}if((xe|0)==7){xe=0;f[Se>>2]=64;break}else if((xe|0)==14){xe=0;f[Se>>2]=64;break}else if((xe|0)==46){xe=0;S=Zn(u,f[V>>2]|0,0,c)|0;if(!((B|0)==0?(S|0)==(f[V>>2]|0):0)){xe=47;break t}f[G>>2]=65427;break}}}while(0);S=qn(u)|0;if((S|0)==0&(B|0)==0?(f[Se>>2]|0)==64:0){xe=115;break}p=h[_e>>0]|0;if(!(p&4)){m=f[U>>2]|0;g=f[z>>2]|0;if(!(f[j>>2]|0)){p=f[V>>2]|0;if(p>>>0>1){v=p+-2|0;f[V>>2]=v}else v=p}else{v=qn(u)|0;v=Wl(v|0,B|0,-2,0)|0;f[V>>2]=v}p=g+(m*5640|0)+5592|0;S=g+(m*5640|0)+5596|0;do{if(!v)M=1;else{M=qn(u)|0;T=B;if(0>(T|0)|0==(T|0)&v>>>0>M>>>0)Jn(c,2,8573,ae)|0;m=f[p>>2]|0;if(!m){M=Yi(f[V>>2]|0)|0;f[p>>2]=M;if(!M)break t;else{M=0;break}}m=Qi(m,(f[V>>2]|0)+(f[S>>2]|0)|0)|0;if(!m){xe=65;break t}f[p>>2]=m;M=0}}while(0);m=f[A>>2]|0;if(m){w=Yn(u)|0;v=B;T=Wl(w|0,v|0,-2,-1)|0;g=f[U>>2]|0;m=m+40|0;_=f[m>>2]|0;E=f[_+(g*40|0)+12>>2]|0;y=f[_+(g*40|0)+16>>2]|0;x=y+(E*24|0)+8|0;f[x>>2]=T;f[x+4>>2]=B;x=f[V>>2]|0;v=Wl(x|0,0,w|0,v|0)|0;E=y+(E*24|0)+16|0;f[E>>2]=v;f[E+4>>2]=B;x=x+2|0;E=f[_+(g*40|0)+20>>2]|0;v=_+(g*40|0)+28|0;y=f[v>>2]|0;if((E+1|0)>>>0>y>>>0){y=~~(+(y>>>0)+100.0)>>>0;f[v>>2]=y;v=Qi(f[_+(g*40|0)+24>>2]|0,y*24|0)|0;y=f[m>>2]|0;_=y+(g*40|0)+24|0;if(!v){p=_;xe=74;break}f[_>>2]=v;w=y;m=f[y+(g*40|0)+20>>2]|0}else{w=_;v=f[_+(g*40|0)+24>>2]|0;m=E}d[v+(m*24|0)>>1]=-109;E=jl(0,T|0,32)|0;T=v+(m*24|0)+8|0;f[T>>2]=E;f[T+4>>2]=B;f[v+(m*24|0)+16>>2]=x;f[w+(g*40|0)+20>>2]=m+1}if(!M)p=Gn(u,(f[p>>2]|0)+(f[S>>2]|0)|0,f[V>>2]|0,c)|0;else p=0;f[Se>>2]=(p|0)==(f[V>>2]|0)?8:64;f[S>>2]=(f[S>>2]|0)+p;p=h[_e>>0]|0;if((p&9)==1){h[_e>>0]=p|8;m=f[U>>2]|0;do{if((Qn(u)|0)!=0?(F=Yn(u)|0,N=B,!((F|0)==-1&(N|0)==-1)):0){while(1){if((Gn(u,Y,2,c)|0)!=2){xe=81;break}wn(Y,W,2);if((f[W>>2]|0)!=65424){xe=83;break}if((Gn(u,Y,2,c)|0)!=2){xe=85;break}wn(Y,Z,2);if((f[Z>>2]|0)!=10){xe=87;break}f[Z>>2]=8;p=Gn(u,Y,8,c)|0;if((p|0)!=(f[Z>>2]|0)){xe=89;break}if((p|0)!=8){xe=91;break}wn(Y,Q,2);wn(L,J,4);wn(C,X,1);wn(I,K,1);if((f[Q>>2]|0)==(m|0)){xe=97;break}p=f[J>>2]|0;if(p>>>0<14){xe=94;break}xe=p+-12|0;f[J>>2]=xe;xe=Zn(u,xe,0,c)|0;if(!((B|0)==0?(xe|0)==(f[J>>2]|0):0)){xe=96;break}}if((xe|0)==81){xe=0;p=(Kn(u,F,N,c)|0)!=0&1;m=0;break}else if((xe|0)==83){xe=0;p=(Kn(u,F,N,c)|0)!=0&1;m=0;break}else if((xe|0)==85){xe=0;Jn(c,1,8295,oe)|0;p=0;m=0;break}else if((xe|0)==87){xe=0;Jn(c,1,8313,se)|0;p=0;m=0;break}else if((xe|0)==89){xe=0;Jn(c,1,8295,ue)|0;p=0;m=0;break}else if((xe|0)==91){xe=0;Jn(c,1,8662,he)|0;p=0;m=0;break}else if((xe|0)==94){xe=0;p=(Kn(u,F,N,c)|0)!=0&1;m=0;break}else if((xe|0)==96){xe=0;p=(Kn(u,F,N,c)|0)!=0&1;m=0;break}else if((xe|0)==97){xe=0;m=(f[X>>2]|0)==(f[K>>2]|0)&1;p=(Kn(u,F,N,c)|0)!=0&1;break}}else{p=1;m=0}}while(0);if(!p){xe=99;break}if(m){p=ce(f[k>>2]|0,f[R>>2]|0)|0;h[_e>>0]=h[_e>>0]&-18|16;if(p){m=f[z>>2]|0;y=0;do{g=m+(y*5640|0)+5588|0;v=f[g>>2]|0;if(v)f[g>>2]=v+1;y=y+1|0}while((y|0)!=(p|0))}Jn(c,2,8734,fe)|0}}if(!(h[_e>>0]&1)){if((Gn(u,f[H>>2]|0,2,c)|0)!=2){xe=109;break}wn(f[H>>2]|0,G,2)}}else{h[_e>>0]=p&-6;f[Se>>2]=8;if((Gn(u,f[H>>2]|0,2,c)|0)!=2){xe=113;break}wn(f[H>>2]|0,G,2)}p=f[G>>2]|0;if(!((p|0)!=65497&(h[_e>>0]&1)==0)){xe=116;break}}switch(xe|0){case 9:{Jn(c,1,8295,$)|0;c=0;b=ke;return c|0}case 11:{Jn(c,1,8313,ee)|0;c=0;b=ke;return c|0}case 20:{Jn(c,1,8339,le)|0;c=0;b=ke;return c|0}case 24:{Jn(c,1,8382,ge)|0;c=0;b=ke;return c|0}case 26:{Ji(f[H>>2]|0);f[H>>2]=0;f[O>>2]=0;Jn(c,1,8427,ve)|0;c=0;b=ke;return c|0}case 29:{Jn(c,1,8295,ye)|0;c=0;b=ke;return c|0}case 31:{Jn(c,1,8461,te)|0;c=0;b=ke;return c|0}case 33:{f[re>>2]=f[G>>2];Jn(c,1,8490,re)|0;c=0;b=ke;return c|0}case 41:{Ji(f[p>>2]|0);Re=f[m>>2]|0;f[Re+(g*40|0)+24>>2]=0;f[Re+(g*40|0)+28>>2]=0;f[Re+(g*40|0)+20>>2]=0;Jn(c,1,8537,Ee)|0;c=0;b=ke;return c|0}case 47:{Jn(c,1,8295,ne)|0;c=0;b=ke;return c|0}case 50:{Jn(c,1,8295,ie)|0;c=0;b=ke;return c|0}case 65:{Ji(f[p>>2]|0);f[p>>2]=0;break}case 74:{Ji(f[p>>2]|0);Re=f[m>>2]|0;f[Re+(g*40|0)+24>>2]=0;f[Re+(g*40|0)+28>>2]=0;f[Re+(g*40|0)+20>>2]=0;Jn(c,1,8537,we)|0;c=0;b=ke;return c|0}case 99:{Jn(c,1,8688,de)|0;c=0;b=ke;return c|0}case 109:{Jn(c,1,8295,pe)|0;c=0;b=ke;return c|0}case 113:{Jn(c,1,8295,me)|0;c=0;b=ke;return c|0}case 115:{p=f[G>>2]|0;xe=116;break}}if((xe|0)==116)if((p|0)==65497){p=_e;xe=117;break e}else{p=_e;break e}Jn(c,1,8628,be)|0;c=0;b=ke;return c|0}else p=_e;break}default:{c=0;b=ke;return c|0}}}while(0);if((xe|0)==117)if((f[Se>>2]|0)!=256){f[e+200>>2]=0;f[Se>>2]=256}if(!(h[p>>0]&1)){v=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;y=e+200|0;m=f[y>>2]|0;e:do{if(m>>>0<v>>>0){p=m;g=(f[e+164>>2]|0)+(m*5640|0)|0;while(1){if(f[g+5592>>2]|0){m=p;break e}m=p+1|0;f[y>>2]=m;if(m>>>0<v>>>0){p=m;g=g+5640|0}else break}}}while(0);if((m|0)==(v|0)){f[l>>2]=0;c=1;b=ke;return c|0}}else{m=e+200|0;y=m;m=f[m>>2]|0}S=f[e+164>>2]|0;if(h[S+(m*5640|0)+5636>>0]&2){A=S+(m*5640|0)+5160|0;g=f[A>>2]|0;if(!g)p=0;else{v=f[S+(m*5640|0)+5164>>2]|0;_=0;p=0;do{p=(f[v+(_<<3)+4>>2]|0)+p|0;_=_+1|0}while((_|0)!=(g|0))}xe=Yi(p)|0;M=S+(m*5640|0)+5172|0;f[M>>2]=xe;if(!xe){Jn(c,1,8775,Te)|0;Jn(c,1,8813,Me)|0;c=0;b=ke;return c|0}T=S+(m*5640|0)+5180|0;f[T>>2]=p;g=f[A>>2]|0;x=S+(m*5640|0)+5164|0;if(!g)p=f[x>>2]|0;else{p=f[x>>2]|0;E=p;w=0;_=0;while(1){v=f[E+(w<<3)>>2]|0;if(!v)v=E;else{Yl((f[M>>2]|0)+_|0,v|0,f[E+(w<<3)+4>>2]|0)|0;v=f[x>>2]|0;_=(f[v+(w<<3)+4>>2]|0)+_|0;Ji(f[v+(w<<3)>>2]|0);v=f[x>>2]|0;f[v+(w<<3)>>2]=0;f[v+(w<<3)+4>>2]=0;g=f[A>>2]|0;p=v}w=w+1|0;if(w>>>0>=g>>>0)break;else E=v}}f[A>>2]=0;Ji(p);f[x>>2]=0;f[S+(m*5640|0)+5168>>2]=f[M>>2];f[S+(m*5640|0)+5176>>2]=f[T>>2];m=f[y>>2]|0}p=e+204|0;if(!(qr(f[p>>2]|0,m,c)|0)){Jn(c,1,8839,Ae)|0;c=0;b=ke;return c|0}else{Ae=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;f[Re>>2]=(f[y>>2]|0)+1;f[Re+4>>2]=Ae;Jn(c,4,8873,Re)|0;f[t>>2]=f[y>>2];f[l>>2]=1;c=Zr(f[p>>2]|0)|0;f[r>>2]=c;c=f[f[(f[p>>2]|0)+20>>2]>>2]|0;f[n>>2]=f[c>>2];f[i>>2]=f[c+4>>2];f[a>>2]=f[c+8>>2];f[o>>2]=f[c+12>>2];f[s>>2]=f[c+16>>2];f[Se>>2]=f[Se>>2]|128;c=1;b=ke;return c|0}return 0}function ua(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0;y=b;b=b+48|0;g=y+28|0;v=y+32|0;d=e+8|0;if(!(f[d>>2]&128)){i=0;b=y;return i|0}m=e+200|0;if((f[m>>2]|0)!=(t|0)){i=0;b=y;return i|0}o=f[e+164>>2]|0;c=o+(t*5640|0)|0;p=o+(t*5640|0)+5592|0;s=f[p>>2]|0;if(!s){Ta(c);i=0;b=y;return i|0}l=e+204|0;u=o+(t*5640|0)+5596|0;if(!(Qr(f[l>>2]|0,s,f[u>>2]|0,t,f[e+196>>2]|0,a)|0)){Ta(c);f[d>>2]=f[d>>2]|32768;Jn(a,1,8912,y)|0;i=0;b=y;return i|0}if(!(Jr(f[l>>2]|0,r,n)|0)){i=0;b=y;return i|0}o=f[p>>2]|0;if(o){Ji(o);f[p>>2]=0;f[u>>2]=0}p=e+76|0;h[p>>0]=h[p>>0]&-2;f[d>>2]=f[d>>2]&-129;p=qn(i)|0;e=f[d>>2]|0;if((e|0)==256|(p|0)==0&(B|0)==0&(e|0)==64){i=1;b=y;return i|0}if((Gn(i,v,2,a)|0)!=2){Jn(a,2,8931,y+8|0)|0;i=1;b=y;return i|0}wn(v,g,2);switch(f[g>>2]|0){case 65497:{f[m>>2]=0;f[d>>2]=256;i=1;b=y;return i|0}case 65424:{i=1;b=y;return i|0}default:if((qn(i)|0)==0&(B|0)==0){f[d>>2]=64;Jn(a,2,8975,y+16|0)|0;i=1;b=y;return i|0}else{Jn(a,1,9005,y+24|0)|0;i=0;b=y;return i|0}}return 0}function ca(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;var s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0;M=b;b=b+112|0;T=M+96|0;x=M+88|0;w=M+80|0;E=M+72|0;_=M+64|0;v=M+56|0;g=M+48|0;d=M+40|0;c=M+32|0;u=M+24|0;l=M+16|0;p=f[e+80>>2]|0;if((f[e+8>>2]|0)!=8){Jn(o,1,9037,M)|0;o=0;b=M;return o|0}if(!(n|r|i|a)){Jn(o,4,9116,M+8|0)|0;f[e+28>>2]=0;f[e+32>>2]=0;f[e+36>>2]=f[e+112>>2];f[e+40>>2]=f[e+116>>2];o=1;b=M;return o|0}y=p+8|0;s=f[y>>2]|0;if(s>>>0<r>>>0){f[l>>2]=r;f[l+4>>2]=s;Jn(o,1,9185,l)|0;o=0;b=M;return o|0}s=f[p>>2]|0;if(s>>>0>r>>>0){f[u>>2]=r;f[u+4>>2]=s;Jn(o,2,9272,u)|0;s=0;r=f[p>>2]|0}else s=((r-(f[e+92>>2]|0)|0)>>>0)/((f[e+100>>2]|0)>>>0)|0;f[e+28>>2]=s;f[t>>2]=r;m=p+12|0;r=f[m>>2]|0;if(r>>>0<n>>>0){f[c>>2]=n;f[c+4>>2]=r;Jn(o,1,9360,c)|0;o=0;b=M;return o|0}l=p+4|0;r=f[l>>2]|0;if(r>>>0>n>>>0){f[d>>2]=n;f[d+4>>2]=r;Jn(o,2,9445,d)|0;r=0;n=f[l>>2]|0}else r=((n-(f[e+96>>2]|0)|0)>>>0)/((f[e+104>>2]|0)>>>0)|0;f[e+32>>2]=r;u=t+4|0;f[u>>2]=n;r=f[p>>2]|0;if(r>>>0>i>>>0){f[g>>2]=i;f[g+4>>2]=r;Jn(o,1,9531,g)|0;o=0;b=M;return o|0}r=f[y>>2]|0;if(r>>>0<i>>>0){f[v>>2]=i;f[v+4>>2]=r;Jn(o,2,9620,v)|0;r=f[e+112>>2]|0;i=f[y>>2]|0}else{r=f[e+100>>2]|0;r=(i+-1-(f[e+92>>2]|0)+r|0)/(r|0)|0}f[e+36>>2]=r;s=t+8|0;f[s>>2]=i;i=f[l>>2]|0;if(i>>>0>a>>>0){f[_>>2]=a;f[_+4>>2]=i;Jn(o,1,9708,_)|0;o=0;b=M;return o|0}i=f[m>>2]|0;if(i>>>0<a>>>0){f[E>>2]=a;f[E+4>>2]=i;Jn(o,2,9798,E)|0;r=f[m>>2]|0;i=f[e+116>>2]|0}else{i=f[e+104>>2]|0;r=a;i=(a+-1-(f[e+96>>2]|0)+i|0)/(i|0)|0}f[e+40>>2]=i;a=t+12|0;f[a>>2]=r;E=e+76|0;h[E>>0]=h[E>>0]|2;E=f[t+16>>2]|0;e=f[t>>2]|0;e:do{if(E){n=f[u>>2]|0;y=n+-1|0;_=f[s>>2]|0;m=_+-1|0;g=e+-1|0;i=0;p=f[t+24>>2]|0;while(1){t=f[p>>2]|0;r=(g+t|0)/(t|0)|0;f[p+16>>2]=r;d=f[p+4>>2]|0;s=(y+d|0)/(d|0)|0;f[p+20>>2]=s;t=(m+t|0)/(t|0)|0;l=f[p+40>>2]|0;u=Gl(1,0,l|0)|0;c=B;t=Wl(t|0,((t|0)<0)<<31>>31|0,-1,-1)|0;t=Wl(t|0,B|0,u|0,c|0)|0;t=jl(t|0,B|0,l|0)|0;r=Wl(r|0,((r|0)<0)<<31>>31|0,-1,-1)|0;r=Wl(r|0,B|0,u|0,c|0)|0;r=jl(r|0,B|0,l|0)|0;r=t-r|0;if((r|0)<0){s=29;break}v=f[a>>2]|0;t=(d+-1+v|0)/(d|0)|0;f[p+8>>2]=r;t=Wl(t|0,((t|0)<0)<<31>>31|0,-1,-1)|0;t=Wl(t|0,B|0,u|0,c|0)|0;t=jl(t|0,B|0,l|0)|0;r=Wl(s|0,((s|0)<0)<<31>>31|0,-1,-1)|0;r=Wl(r|0,B|0,u|0,c|0)|0;r=jl(r|0,B|0,l|0)|0;r=t-r|0;if((r|0)<0){s=31;break}f[p+12>>2]=r;i=i+1|0;if(i>>>0>=E>>>0){r=_;i=v;break e}else p=p+52|0}if((s|0)==29){f[w>>2]=i;f[w+4>>2]=r;Jn(o,1,9887,w)|0;o=0;b=M;return o|0}else if((s|0)==31){f[x>>2]=i;f[x+4>>2]=r;Jn(o,1,9956,x)|0;o=0;b=M;return o|0}}else{n=f[u>>2]|0;r=f[s>>2]|0;i=f[a>>2]|0}}while(0);f[T>>2]=e;f[T+4>>2]=n;f[T+8>>2]=r;f[T+12>>2]=i;Jn(o,4,10025,T)|0;o=1;b=M;return o|0}function ha(){var e=0,t=0,r=0;e=qi(1,208)|0;if(!e){t=0;return t|0}f[e>>2]=1;t=e+184|0;h[t>>0]=h[t>>0]|2;t=qi(1,5640)|0;f[e+12>>2]=t;if(!t){ra(e);t=0;return t|0}t=qi(1,1e3)|0;f[e+16>>2]=t;if(!t){ra(e);t=0;return t|0}f[e+20>>2]=1e3;f[e+60>>2]=-1;t=e+64|0;f[t>>2]=0;f[t+4>>2]=0;t=qi(1,48)|0;do{if(t){f[t+32>>2]=100;f[t+24>>2]=0;r=qi(100,24)|0;f[t+28>>2]=r;if(!r){Ji(t);break}f[t+40>>2]=0;f[e+196>>2]=t;r=vo()|0;f[e+192>>2]=r;if(!r){ra(e);r=0;return r|0}r=vo()|0;f[e+188>>2]=r;if(r){r=e;return r|0}ra(e);r=0;return r|0}}while(0);f[e+196>>2]=0;ra(e);r=0;return r|0}function da(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,g=0,v=0,y=0,_=0;y=b;b=b+128|0;v=y+104|0;g=y+72|0;p=y+64|0;c=y+40|0;l=y+24|0;o=y+16|0;a=y+8|0;i=y;if(t&384){hl(10063,11,1,r)|0;b=y;return}if((t&1|0)!=0?(n=f[e+80>>2]|0,(n|0)!=0):0)fa(n,0,r);if(t&2){hl(10075,36,1,r)|0;n=f[e+96>>2]|0;f[i>>2]=f[e+92>>2];f[i+4>>2]=n;el(r,10112,i)|0;i=f[e+104>>2]|0;f[a>>2]=f[e+100>>2];f[a+4>>2]=i;el(r,10130,a)|0;a=f[e+116>>2]|0;f[o>>2]=f[e+112>>2];f[o+4>>2]=a;el(r,10148,o)|0;ka(f[e+12>>2]|0,f[(f[e+80>>2]|0)+16>>2]|0,r);hl(10164,2,1,r)|0}if((t&8|0)!=0?(s=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0,(s|0)!=0):0){n=e+80|0;i=0;a=f[e+164>>2]|0;while(1){ka(a,f[(f[n>>2]|0)+16>>2]|0,r);i=i+1|0;if((i|0)==(s|0))break;else a=a+5640|0}}if(!(t&16)){b=y;return}o=f[e+196>>2]|0;hl(10167,37,1,r)|0;s=o;t=f[s+4>>2]|0;n=o+8|0;e=f[n>>2]|0;n=f[n+4>>2]|0;a=l;f[a>>2]=f[s>>2];f[a+4>>2]=t;a=l+8|0;f[a>>2]=e;f[a+4>>2]=n;el(r,10205,l)|0;hl(10272,17,1,r)|0;a=o+28|0;n=f[a>>2]|0;e:do{if((n|0)!=0?(u=o+24|0,(f[u>>2]|0)!=0):0){i=0;while(1){t=n+(i*24|0)+8|0;s=f[t>>2]|0;t=f[t+4>>2]|0;l=f[n+(i*24|0)+16>>2]|0;f[c>>2]=m[n+(i*24|0)>>1];e=c+8|0;f[e>>2]=s;f[e+4>>2]=t;f[c+16>>2]=l;el(r,10290,c)|0;i=i+1|0;if(i>>>0>=(f[u>>2]|0)>>>0)break e;n=f[a>>2]|0}}}while(0);hl(10321,4,1,r)|0;t=o+40|0;a=f[t>>2]|0;if((a|0)!=0?(d=o+36|0,h=f[d>>2]|0,(h|0)!=0):0){i=0;n=0;do{n=(f[a+(i*40|0)+4>>2]|0)+n|0;i=i+1|0}while((i|0)!=(h|0));if(n){hl(10326,16,1,r)|0;if(f[d>>2]|0){n=f[t>>2]|0;s=0;do{o=f[n+(s*40|0)+4>>2]|0;f[p>>2]=s;f[p+4>>2]=o;el(r,10343,p)|0;n=f[t>>2]|0;i=f[n+(s*40|0)+16>>2]|0;e:do{if(!((o|0)==0|(i|0)==0)){n=0;while(1){e=i+(n*24|0)|0;_=f[e>>2]|0;e=f[e+4>>2]|0;u=i+(n*24|0)+8|0;l=f[u>>2]|0;u=f[u+4>>2]|0;h=i+(n*24|0)+16|0;c=f[h>>2]|0;h=f[h+4>>2]|0;f[g>>2]=n;a=g+8|0;f[a>>2]=_;f[a+4>>2]=e;a=g+16|0;f[a>>2]=l;f[a+4>>2]=u;a=g+24|0;f[a>>2]=c;f[a+4>>2]=h;el(r,10379,g)|0;a=n+1|0;n=f[t>>2]|0;if((a|0)==(o|0))break e;i=f[n+(s*40|0)+16>>2]|0;n=a}}}while(0);i=f[n+(s*40|0)+24>>2]|0;e:do{if((i|0)!=0?(f[n+(s*40|0)+20>>2]|0)!=0:0){n=0;while(1){h=i+(n*24|0)+8|0;c=f[h>>2]|0;h=f[h+4>>2]|0;a=f[i+(n*24|0)+16>>2]|0;f[v>>2]=m[i+(n*24|0)>>1];_=v+8|0;f[_>>2]=c;f[_+4>>2]=h;f[v+16>>2]=a;el(r,10290,v)|0;a=n+1|0;n=f[t>>2]|0;if(a>>>0>=(f[n+(s*40|0)+20>>2]|0)>>>0)break e;i=f[n+(s*40|0)+24>>2]|0;n=a}}}while(0);s=s+1|0}while(s>>>0<(f[d>>2]|0)>>>0)}hl(10321,4,1,r)|0}}hl(10164,2,1,r)|0;b=y;return}function fa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0;c=b;b=b+64|0;u=c+48|0;l=c+40|0;o=c+32|0;a=c+16|0;i=c;s=c+52|0;if(!t){hl(10482,13,1,r)|0;h[s+1>>0]=0;n=9}else{hl(10445,36,1,f[676]|0)|0;n=0}h[s>>0]=n;d=f[e>>2]|0;n=f[e+4>>2]|0;f[i>>2]=s;f[i+4>>2]=d;f[i+8>>2]=n;el(r,10496,i)|0;i=f[e+8>>2]|0;n=f[e+12>>2]|0;f[a>>2]=s;f[a+4>>2]=i;f[a+8>>2]=n;el(r,10513,a)|0;a=e+16|0;n=f[a>>2]|0;f[o>>2]=s;f[o+4>>2]=n;el(r,10530,o)|0;n=e+24|0;if(!(f[n>>2]|0)){hl(10164,2,1,r)|0;b=c;return}if(!(f[a>>2]|0)){hl(10164,2,1,r)|0;b=c;return}else i=0;do{f[l>>2]=s;f[l+4>>2]=i;el(r,10546,l)|0;pa((f[n>>2]|0)+(i*52|0)|0,t,r);f[u>>2]=s;el(r,10566,u)|0;i=i+1|0}while(i>>>0<(f[a>>2]|0)>>>0);hl(10164,2,1,r)|0;b=c;return}function pa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;l=b;b=b+48|0;s=l+24|0;o=l+16|0;a=l;i=l+32|0;n=(t|0)!=0;if(n){hl(10571,41,1,f[676]|0)|0;t=0}else{h[i+1>>0]=9;h[i+2>>0]=0;t=9}h[i>>0]=t;u=f[e>>2]|0;t=f[e+4>>2]|0;f[a>>2]=i;f[a+4>>2]=u;f[a+8>>2]=t;el(r,10613,a)|0;a=f[e+24>>2]|0;f[o>>2]=i;f[o+4>>2]=a;el(r,10630,o)|0;o=f[e+32>>2]|0;f[s>>2]=i;f[s+4>>2]=o;el(r,10642,s)|0;if(!n){b=l;return}hl(10164,2,1,r)|0;b=l;return}function ma(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=b;b=b+16|0;n=c;t=e+80|0;l=f[(f[t>>2]|0)+16>>2]|0;r=qi(1,56)|0;f[n>>2]=r;if(!r){u=0;b=c;return u|0}f[r+24>>2]=f[(f[t>>2]|0)+16>>2];f[r>>2]=f[e+92>>2];f[r+4>>2]=f[e+96>>2];f[r+8>>2]=f[e+100>>2];f[r+12>>2]=f[e+104>>2];f[r+16>>2]=f[e+112>>2];f[r+20>>2]=f[e+116>>2];f[r+52>>2]=0;r=f[e+12>>2]|0;t=f[n>>2]|0;f[t+32>>2]=f[r>>2];f[t+36>>2]=f[r+4>>2];f[t+40>>2]=f[r+8>>2];f[t+44>>2]=f[r+16>>2];s=qi(f[t+24>>2]|0,1080)|0;f[t+48>>2]=s;t=f[n>>2]|0;s=t+48|0;e=f[s>>2]|0;if(!e){Hi(n);u=0;b=c;return u|0}if(!l){u=t;b=c;return u|0}o=r+5584|0;r=0;while(1){a=f[o>>2]|0;f[e+(r*1080|0)+4>>2]=f[a+(r*1080|0)>>2];n=a+(r*1080|0)+4|0;i=f[n>>2]|0;f[e+(r*1080|0)+8>>2]=i;f[e+(r*1080|0)+12>>2]=f[a+(r*1080|0)+8>>2];f[e+(r*1080|0)+16>>2]=f[a+(r*1080|0)+12>>2];f[e+(r*1080|0)+20>>2]=f[a+(r*1080|0)+16>>2];f[e+(r*1080|0)+24>>2]=f[a+(r*1080|0)+20>>2];if(i>>>0<33){Yl(e+(r*1080|0)+948|0,a+(r*1080|0)+944|0,i|0)|0;Yl(e+(r*1080|0)+816|0,a+(r*1080|0)+812|0,f[n>>2]|0)|0}i=f[a+(r*1080|0)+24>>2]|0;f[e+(r*1080|0)+28>>2]=i;f[e+(r*1080|0)+808>>2]=f[a+(r*1080|0)+804>>2];if((i|0)!=1){i=(f[n>>2]|0)*3|0;n=i+-2|0;if((n|0)<97&(i|0)>2)u=10}else{n=1;u=10}if((u|0)==10){u=0;i=0;do{f[e+(r*1080|0)+32+(i<<2)>>2]=f[a+(r*1080|0)+28+(i<<3)+4>>2];f[e+(r*1080|0)+420+(i<<2)>>2]=f[a+(r*1080|0)+28+(i<<3)>>2];i=i+1|0}while((i|0)!=(n|0))}f[e+(r*1080|0)+812>>2]=f[a+(r*1080|0)+808>>2];r=r+1|0;if((r|0)==(l|0))break;e=f[s>>2]|0}b=c;return t|0}function ga(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0;t=qi(1,48)|0;if(!t){u=0;return u|0}o=e+196|0;r=f[o>>2]|0;s=r;u=f[s+4>>2]|0;e=t;f[e>>2]=f[s>>2];f[e+4>>2]=u;e=r+8|0;u=f[e+4>>2]|0;s=t+8|0;f[s>>2]=f[e>>2];f[s+4>>2]=u;s=r+16|0;u=f[s+4>>2]|0;e=t+16|0;f[e>>2]=f[s>>2];f[e+4>>2]=u;r=f[r+24>>2]|0;e=t+24|0;f[e>>2]=r;r=Yi(r*24|0)|0;u=t+28|0;f[u>>2]=r;if(!r){Ji(t);u=0;return u|0}n=f[(f[o>>2]|0)+28>>2]|0;if(!n){Ji(r);f[u>>2]=0}else Yl(r|0,n|0,(f[e>>2]|0)*24|0)|0;e=f[(f[o>>2]|0)+36>>2]|0;a=t+36|0;f[a>>2]=e;e=qi(e,40)|0;s=t+40|0;f[s>>2]=e;if(!e){Ji(f[u>>2]|0);Ji(t);u=0;return u|0}r=f[(f[o>>2]|0)+40>>2]|0;if(!r){Ji(e);f[s>>2]=0;u=t;return u|0}if(!(f[a>>2]|0)){u=t;return u|0}r=f[r+20>>2]|0;f[e+20>>2]=r;r=Yi(r*24|0)|0;e=f[s>>2]|0;f[e+24>>2]=r;e:do{if(!r)r=0;else{i=r;r=0;while(1){n=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+24>>2]|0;if(!n){Ji(i);e=f[s>>2]|0;f[e+(r*40|0)+24>>2]=0}else{Yl(i|0,n|0,(f[e+(r*40|0)+20>>2]|0)*24|0)|0;e=f[s>>2]|0}n=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+4>>2]|0;f[e+(r*40|0)+4>>2]=n;n=Yi(n*24|0)|0;e=f[s>>2]|0;f[e+(r*40|0)+16>>2]=n;if(!n)break;i=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+16>>2]|0;if(!i){Ji(n);e=f[s>>2]|0;f[e+(r*40|0)+16>>2]=0}else{Yl(n|0,i|0,(f[e+(r*40|0)+4>>2]|0)*24|0)|0;e=f[s>>2]|0}f[e+(r*40|0)+32>>2]=0;f[e+(r*40|0)+36>>2]=0;r=r+1|0;if(r>>>0>=(f[a>>2]|0)>>>0){l=32;break}i=f[(f[(f[o>>2]|0)+40>>2]|0)+(r*40|0)+20>>2]|0;f[e+(r*40|0)+20>>2]=i;i=Yi(i*24|0)|0;e=f[s>>2]|0;f[e+(r*40|0)+24>>2]=i;if(!i)break e}if((l|0)==32)return t|0;if(r){Ji(f[e+24>>2]|0);Ji(f[(f[s>>2]|0)+16>>2]|0);if((r|0)!=1){e=1;do{Ji(f[(f[s>>2]|0)+(e*40|0)+24>>2]|0);Ji(f[(f[s>>2]|0)+(e*40|0)+16>>2]|0);e=e+1|0}while((e|0)!=(r|0))}e=f[s>>2]|0}Ji(e);Ji(f[u>>2]|0);Ji(t);u=0;return u|0}}while(0);if(r){Ji(f[e+24>>2]|0);if((r|0)!=1){e=1;do{Ji(f[(f[s>>2]|0)+(e*40|0)+24>>2]|0);e=e+1|0}while((e|0)!=(r|0))}e=f[s>>2]|0}Ji(e);Ji(f[u>>2]|0);Ji(t);u=0;return u|0}function va(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;if(!r){r=0;return r|0}i=ti()|0;u=e+84|0;f[u>>2]=i;if(!i){r=0;return r|0}ai(r,i);o=e+188|0;_o(f[o>>2]|0,27,n)|0;o=f[o>>2]|0;s=bo(o)|0;i=Eo(o)|0;if(s){l=0;a=1;while(1){if(!a)a=0;else a=(ku[f[i>>2]&63](e,t,n)|0)!=0;l=l+1|0;if((l|0)==(s|0))break;else{i=i+4|0;a=a&1}}wo(o);if(!a){r=e+80|0;ni(f[r>>2]|0);f[r>>2]=0;r=0;return r|0}}else wo(o);s=f[r+16>>2]|0;if(!s){r=1;return r|0}o=f[(f[u>>2]|0)+24>>2]|0;i=f[r+24>>2]|0;a=0;do{f[i+(a*52|0)+36>>2]=f[o+(a*52|0)+36>>2];r=o+(a*52|0)+44|0;f[i+(a*52|0)+44>>2]=f[r>>2];f[r>>2]=0;a=a+1|0}while(a>>>0<s>>>0);i=1;return i|0}function ya(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0;y=b;b=b+16|0;s=y+8|0;if(!r){Jn(n,1,10654,y)|0;v=0;b=y;return v|0}a=f[e+112>>2]|0;o=ce(f[e+116>>2]|0,a)|0;if(o>>>0<=i>>>0){f[s>>2]=i;f[s+4>>2]=o+-1;Jn(n,1,10692,s)|0;v=0;b=y;return v|0}v=(i>>>0)%(a>>>0)|0;g=(i>>>0)/(a>>>0)|0;s=f[e+100>>2]|0;o=ce(s,v)|0;l=f[e+92>>2]|0;o=o+l|0;f[r>>2]=o;m=e+80|0;a=f[m>>2]|0;u=f[a>>2]|0;o=o>>>0<u>>>0?u:o;f[r>>2]=o;l=(ce(s,v+1|0)|0)+l|0;v=r+8|0;f[v>>2]=l;s=f[a+8>>2]|0;l=l>>>0>s>>>0?s:l;f[v>>2]=l;v=f[e+104>>2]|0;s=ce(v,g)|0;u=f[e+96>>2]|0;s=s+u|0;p=r+4|0;f[p>>2]=s;d=f[a+4>>2]|0;s=s>>>0<d>>>0?d:s;f[p>>2]=s;u=(ce(v,g+1|0)|0)+u|0;g=r+12|0;f[g>>2]=u;v=f[a+12>>2]|0;u=u>>>0>v>>>0?v:u;f[g>>2]=u;g=r+24|0;v=r+16|0;p=f[v>>2]|0;if(p){d=f[a+24>>2]|0;h=o+-1|0;c=s+-1|0;l=l+-1|0;a=u+-1|0;o=0;s=f[g>>2]|0;while(1){u=f[d+(o*52|0)+40>>2]|0;f[s+40>>2]=u;M=f[s>>2]|0;T=(h+M|0)/(M|0)|0;f[s+16>>2]=T;_=f[s+4>>2]|0;x=(c+_|0)/(_|0)|0;f[s+20>>2]=x;M=(l+M|0)/(M|0)|0;_=(a+_|0)/(_|0)|0;w=Gl(1,0,u|0)|0;E=B;M=Wl(M|0,((M|0)<0)<<31>>31|0,-1,-1)|0;M=Wl(M|0,B|0,w|0,E|0)|0;M=jl(M|0,B|0,u|0)|0;T=Wl(T|0,((T|0)<0)<<31>>31|0,-1,-1)|0;T=Wl(T|0,B|0,w|0,E|0)|0;T=jl(T|0,B|0,u|0)|0;f[s+8>>2]=M-T;_=Wl(_|0,((_|0)<0)<<31>>31|0,-1,-1)|0;_=Wl(_|0,B|0,w|0,E|0)|0;_=jl(_|0,B|0,u|0)|0;x=Wl(x|0,((x|0)<0)<<31>>31|0,-1,-1)|0;E=Wl(x|0,B|0,w|0,E|0)|0;u=jl(E|0,B|0,u|0)|0;f[s+12>>2]=_-u;o=o+1|0;if(o>>>0>=p>>>0)break;else s=s+52|0}}c=e+84|0;a=f[c>>2]|0;if(a)ni(a);a=ti()|0;f[c>>2]=a;if(!a){M=0;b=y;return M|0}ai(r,a);f[e+60>>2]=i;s=e+188|0;_o(f[s>>2]|0,28,n)|0;s=f[s>>2]|0;l=bo(s)|0;a=Eo(s)|0;if(l){u=0;o=1;while(1){if(!o)o=0;else o=(ku[f[a>>2]&63](e,t,n)|0)!=0;u=u+1|0;if((u|0)==(l|0))break;else{a=a+4|0;o=o&1}}wo(s);if(!o){ni(f[m>>2]|0);f[m>>2]=0;M=0;b=y;return M|0}}else wo(s);a=f[v>>2]|0;if(!a){M=1;b=y;return M|0}l=f[(f[c>>2]|0)+24>>2]|0;s=f[g>>2]|0;u=0;while(1){f[s+(u*52|0)+36>>2]=f[l+(u*52|0)+36>>2];o=f[s+(u*52|0)+44>>2]|0;if(!o)o=l;else{Ji(o);o=f[(f[c>>2]|0)+24>>2]|0;s=f[g>>2]|0;a=f[v>>2]|0}M=o+(u*52|0)+44|0;f[s+(u*52|0)+44>>2]=f[M>>2];f[M>>2]=0;u=u+1|0;if(u>>>0>=a>>>0){a=1;break}else l=o}b=y;return a|0}function _a(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0;l=b;b=b+16|0;s=l;f[e+168>>2]=t;n=f[e+80>>2]|0;e:do{if((((n|0)!=0?(o=f[n+24>>2]|0,(o|0)!=0):0)?(i=f[e+12>>2]|0,(i|0)!=0):0)?(a=f[i+5584>>2]|0,(a|0)!=0):0){n=f[n+16>>2]|0;if(!n)n=1;else{i=0;while(1){if((f[a+(i*1080|0)+4>>2]|0)>>>0<=t>>>0)break;f[o+(i*52|0)+40>>2]=t;i=i+1|0;if(i>>>0>=n>>>0){n=1;break e}}Jn(r,1,10753,s)|0;n=0}}else n=0}while(0);b=l;return n|0}function ba(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0;j=b;b=b+48|0;B=j+32|0;U=j+24|0;N=j+16|0;D=j+8|0;F=j;S=e+204|0;n=f[S>>2]|0;L=e+116|0;C=e+112|0;I=ce(f[C>>2]|0,f[L>>2]|0)|0;H=(I|0)==1;if(!I){z=1;b=j;return z|0}O=e+200|0;A=e+12|0;R=e+164|0;k=e+8|0;P=n+20|0;T=n+24|0;M=0;n=0;s=0;e:while(1){if((f[O>>2]|0)!=(M|0)){z=5;break}w=M;M=M+1|0;x=ce(f[L>>2]|0,f[C>>2]|0)|0;f[D>>2]=M;f[D+4>>2]=x;Jn(r,4,10866,D)|0;f[A>>2]=0;x=f[S>>2]|0;f[x+12>>2]=f[(f[R>>2]|0)+(w*5640|0)+5588>>2];f[k>>2]=0;if(!(Yr(x,f[O>>2]|0,r)|0))break;i=f[S>>2]|0;if(f[(f[i+24>>2]|0)+16>>2]|0){o=0;do{a=f[(f[f[P>>2]>>2]|0)+20>>2]|0;if(H){f[a+(o*52|0)+32>>2]=f[(f[(f[T>>2]|0)+24>>2]|0)+(o*52|0)+44>>2];f[a+(o*52|0)+36>>2]=0}else{if(!(Xr(a+(o*52|0)|0)|0)){z=14;break e}i=f[S>>2]|0}o=o+1|0}while(o>>>0<(f[(f[i+24>>2]|0)+16>>2]|0)>>>0)}x=$r(i)|0;if(!H){if(x>>>0>s>>>0){i=Qi(n,x)|0;if(!i){z=20;break}else{n=i;i=x}}else i=s;a=f[S>>2]|0;w=a+24|0;o=f[w>>2]|0;if(f[o+16>>2]|0){E=a+20|0;a=n;_=0;do{g=f[(f[f[E>>2]>>2]|0)+20>>2]|0;l=f[o+24>>2]|0;m=f[l+(_*52|0)+24>>2]|0;m=((m&7|0)!=0&1)+(m>>>3)|0;u=f[g+(_*52|0)+8>>2]|0;c=f[g+(_*52|0)>>2]|0;y=u-c|0;p=f[g+(_*52|0)+12>>2]|0;g=f[g+(_*52|0)+4>>2]|0;W=f[o>>2]|0;G=f[l+(_*52|0)>>2]|0;s=f[l+(_*52|0)+4>>2]|0;V=(G+~W+(f[o+8>>2]|0)|0)/(G|0)|0;v=V-y|0;o=c-((W+-1+G|0)/(G|0)|0)+(ce(V,g-(((f[o+4>>2]|0)+-1+s|0)/(s|0)|0)|0)|0)|0;o=(f[l+(_*52|0)+44>>2]|0)+(o<<2)|0;t:do{switch(((m|0)==3?4:m)|0){case 1:{s=(p|0)==(g|0);if(!(f[l+(_*52|0)+32>>2]|0)){if(s)break t;m=(u|0)==(c|0);c=p-g|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){h[l>>0]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+1|0;u=u+4|0}}a=a+y|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(v<<2)|0}}else{if(s)break t;m=(u|0)==(c|0);c=p-g|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){h[l>>0]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+1|0;u=u+4|0}}a=a+y|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(v<<2)|0}}break}case 2:{s=(p|0)==(g|0);if(!(f[l+(_*52|0)+32>>2]|0)){if(!s){m=(u|0)==(c|0);c=p-g|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){d[l>>1]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+2|0;u=u+4|0}}a=a+(y<<1)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(v<<2)|0}}}else if(!s){m=(u|0)==(c|0);c=p-g|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){d[l>>1]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+2|0;u=u+4|0}}a=a+(y<<1)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(v<<2)|0}}break}case 4:{if((p|0)!=(g|0)){m=(u|0)==(c|0);c=p-g|0;p=0;while(1){if(!m){s=0;l=a;u=o;while(1){f[l>>2]=f[u>>2];s=s+1|0;if((s|0)==(y|0))break;else{l=l+4|0;u=u+4|0}}a=a+(y<<2)|0;o=o+(y<<2)|0}p=p+1|0;if((p|0)==(c|0))break;else o=o+(v<<2)|0}}break}default:{}}}while(0);_=_+1|0;o=f[w>>2]|0}while(_>>>0<(f[o+16>>2]|0)>>>0);a=f[S>>2]|0}if(!(en(a,n,x)|0)){z=63;break}}else i=s;if(!(Ca(e,t,r)|0)){z=65;break}if(M>>>0>=I>>>0){z=67;break}else s=i}if((z|0)==5)Jn(r,1,10829,F)|0;else if((z|0)==14){Jn(r,1,10887,N)|0;if(!n){W=0;b=j;return W|0}Ji(n);W=0;b=j;return W|0}else if((z|0)==20){if(n)Ji(n);Jn(r,1,10925,U)|0;W=0;b=j;return W|0}else if((z|0)==63){Jn(r,1,10964,B)|0;Ji(n);W=0;b=j;return W|0}else if((z|0)==65){if(!n){W=0;b=j;return W|0}Ji(n);W=0;b=j;return W|0}else if((z|0)==67){if(!n){W=1;b=j;return W|0}Ji(n);W=1;b=j;return W|0}if(!n){W=0;b=j;return W|0}Ji(n);W=0;b=j;return W|0}function Ea(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;n=e+188|0;if(!(_o(f[n>>2]|0,29,r)|0)){t=0;return t|0}if(((d[e+88>>1]|0)+-3&65535)<4?(_o(f[n>>2]|0,30,r)|0)==0:0){t=0;return t|0}if(!(_o(f[n>>2]|0,31,r)|0)){t=0;return t|0}if(!(_o(f[n>>2]|0,32,r)|0)){t=0;return t|0}if(!(_o(f[n>>2]|0,33,r)|0)){t=0;return t|0}s=f[n>>2]|0;a=bo(s)|0;n=Eo(s)|0;if(!a)n=1;else{o=0;i=n;n=1;while(1){if(!n)n=0;else n=(ku[f[i>>2]&63](e,t,r)|0)!=0;n=n&1;o=o+1|0;if((o|0)==(a|0))break;else i=i+4|0}}wo(s);t=n;return t|0}function wa(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;i=ti()|0;s=e+80|0;f[s>>2]=i;if(!i){Jn(n,1,11011,u)|0;t=0;b=u;return t|0}ai(r,i);o=f[r+24>>2]|0;if((o|0)!=0?(l=f[r+16>>2]|0,(l|0)!=0):0){a=0;do{r=o+(a*52|0)+44|0;i=f[r>>2]|0;if(i){f[(f[(f[s>>2]|0)+24>>2]|0)+(a*52|0)+44>>2]=i;f[r>>2]=0}a=a+1|0}while(a>>>0<l>>>0)}i=e+192|0;if(!(_o(f[i>>2]|0,34,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,35,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,36,n)|0)){t=0;b=u;return t|0}a=f[i>>2]|0;o=bo(a)|0;i=Eo(a)|0;if(o){s=0;r=1;while(1){if(!r)r=0;else r=(ku[f[i>>2]&63](e,t,n)|0)!=0;s=s+1|0;if((s|0)==(o|0))break;else{i=i+4|0;r=r&1}}wo(a);if(!r){t=0;b=u;return t|0}}else wo(a);i=e+188|0;if(!(_o(f[i>>2]|0,37,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,38,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,39,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,40,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,41,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,42,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,43,n)|0)){t=0;b=u;return t|0}r=e+88|0;if(((d[r>>1]|0)+-3&65535)<4){if(!(_o(f[i>>2]|0,44,n)|0)){t=0;b=u;return t|0}if((d[r>>1]|0)==4?(_o(f[i>>2]|0,45,n)|0)==0:0){t=0;b=u;return t|0}}if(!(_o(f[i>>2]|0,46,n)|0)){t=0;b=u;return t|0}if((f[e+108>>2]|0)!=0?(_o(f[i>>2]|0,47,n)|0)==0:0){t=0;b=u;return t|0}if((d[r>>1]&256)!=0?(_o(f[i>>2]|0,48,n)|0)==0:0){t=0;b=u;return t|0}if((f[e+196>>2]|0)!=0?(_o(f[i>>2]|0,49,n)|0)==0:0){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,50,n)|0)){t=0;b=u;return t|0}if(!(_o(f[i>>2]|0,51,n)|0)){t=0;b=u;return t|0}s=f[i>>2]|0;a=bo(s)|0;i=Eo(s)|0;if(!a)i=1;else{o=0;r=i;i=1;while(1){if(!i)i=0;else i=(ku[f[r>>2]&63](e,t,n)|0)!=0;i=i&1;o=o+1|0;if((o|0)==(a|0))break;else r=r+4|0}}wo(s);t=i;b=u;return t|0}function xa(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;m=b;b=b+48|0;d=m+40|0;p=m+32|0;h=m+24|0;u=m+16|0;s=m+8|0;o=m;l=e+200|0;if((f[l>>2]|0)==(t|0)){c=ce(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[s>>2]=t+1;f[s+4>>2]=c;Jn(a,4,10866,s)|0;f[e+12>>2]=0;c=e+204|0;s=f[c>>2]|0;f[s+12>>2]=f[(f[e+164>>2]|0)+(t*5640|0)+5588>>2];f[e+8>>2]=0;if(Yr(s,f[l>>2]|0,a)|0){o=f[c>>2]|0;e:do{if(f[(f[o+24>>2]|0)+16>>2]|0){s=0;while(1){if(!(Xr((f[(f[f[o+20>>2]>>2]|0)+20>>2]|0)+(s*52|0)|0)|0))break;s=s+1|0;o=f[c>>2]|0;if(s>>>0>=(f[(f[o+24>>2]|0)+16>>2]|0)>>>0)break e}Jn(a,1,10887,h)|0;p=0;b=m;return p|0}}while(0);if(!(en(o,r,n)|0)){Jn(a,1,10964,p)|0;p=0;b=m;return p|0}if(Ca(e,i,a)|0){p=1;b=m;return p|0}f[d>>2]=t;Jn(a,1,11101,d)|0;p=0;b=m;return p|0}}else Jn(a,1,10829,o)|0;f[u>>2]=t;Jn(a,1,11044,u)|0;p=0;b=m;return p|0}function Ta(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0;if(!e)return;i=e+5164|0;t=f[i>>2]|0;if(t){a=e+5160|0;r=f[a>>2]|0;if(r){n=0;while(1){t=f[t+(n<<3)>>2]|0;if(t){Ji(t);r=f[a>>2]|0}n=n+1|0;if(n>>>0>=r>>>0)break;t=f[i>>2]|0}t=f[i>>2]|0}f[a>>2]=0;Ji(t);f[i>>2]=0}t=e+5172|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+5584|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+5608|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+5604|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+5624|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0;f[e+5632>>2]=0;f[e+5628>>2]=0}s=e+5612|0;t=f[s>>2]|0;if(t){o=e+5616|0;r=f[o>>2]|0;if(r){a=0;while(1){n=t+12|0;i=f[n>>2]|0;if(i){Ji(i);f[n>>2]=0;r=f[o>>2]|0}a=a+1|0;if(a>>>0>=r>>>0)break;else t=t+20|0}t=f[s>>2]|0}Ji(t);f[s>>2]=0}t=e+5600|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}t=e+5592|0;r=f[t>>2]|0;if(!r)return;Ji(r);f[t>>2]=0;f[e+5596>>2]=0;return}function Ma(e,t,r){e=e|0;t=t|0;r=r|0;return 1}function Sa(e,t,r){e=e|0;t=t|0;r=r|0;return(f[e+8>>2]|0)==0&(f[e+188>>2]|0)!=0&(f[e+192>>2]|0)!=0&1|0}function Aa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0;K=b;b=b+224|0;Z=K+200|0;X=K+192|0;W=K+184|0;j=K+176|0;z=K+168|0;U=K+160|0;F=K+152|0;D=K+144|0;O=K+136|0;k=K+128|0;H=K+120|0;R=K+112|0;A=K+104|0;S=K+96|0;M=K+88|0;T=K+80|0;I=K+72|0;C=K+64|0;x=K+56|0;w=K+48|0;E=K+40|0;P=K+32|0;p=K+24|0;l=K+16|0;s=K+8|0;N=K;G=K+216|0;n=K+204|0;L=K+212|0;_=K+208|0;q=e+8|0;f[q>>2]=1;e:do{if((Gn(t,G,2,r)|0)==2?(wn(G,n,2),(f[n>>2]|0)==65359):0){f[q>>2]=2;c=Yn(t)|0;c=Wl(c|0,B|0,-2,-1)|0;u=B;Y=e+196|0;i=f[Y>>2]|0;f[i>>2]=c;f[i+4>>2]=u;i=N;f[i>>2]=c;f[i+4>>2]=u;Jn(r,4,15766,N)|0;i=f[Y>>2]|0;u=f[i>>2]|0;c=i+24|0;n=f[c>>2]|0;o=i+32|0;a=f[o>>2]|0;do{if((n+1|0)>>>0>a>>>0){y=~~(+(a>>>0)+100.0)>>>0;f[o>>2]=y;n=i+28|0;i=Qi(f[n>>2]|0,y*24|0)|0;if(!i){Ji(f[n>>2]|0);f[n>>2]=0;f[o>>2]=0;f[c>>2]=0;Jn(r,1,15803,s)|0;break e}else{f[n>>2]=i;n=f[c>>2]|0;break}}else i=f[i+28>>2]|0}while(0);d[i+(n*24|0)>>1]=-177;v=jl(0,u|0,32)|0;y=i+(n*24|0)+8|0;f[y>>2]=v;f[y+4>>2]=B;f[i+(n*24|0)+16>>2]=2;f[c>>2]=n+1;y=e+16|0;if((Gn(t,f[y>>2]|0,2,r)|0)!=2){Jn(r,1,8295,p)|0;r=0;b=K;return r|0}wn(f[y>>2]|0,L,2);n=f[L>>2]|0;if((n|0)!=65424){v=e+20|0;m=0;a=0;g=0;t:while(1){if(n>>>0<65280){V=14;break}else s=784;while(1){i=f[s>>2]|0;o=(i|0)==0;if(o|(i|0)==(n|0))break;else s=s+12|0}if(o){Jn(r,2,15914,E)|0;l=2;r:while(1){do{if((Gn(t,f[y>>2]|0,2,r)|0)!=2){V=20;break t}wn(f[y>>2]|0,N,2);n=f[N>>2]|0}while(n>>>0<65280);s=784;while(1){i=f[s>>2]|0;if((i|0)==0|(i|0)==(n|0)){o=s;n=s;break}else s=s+12|0}if(!(f[n+4>>2]&f[q>>2])){V=25;break t}if((i|0)>=65424){V=100;break}switch(i|0){case 0:break;default:{p=o;c=l;break r}}l=l+2|0}if((V|0)==100){V=0;switch(i|0){case 65424:{i=m;n=g;V=27;break t}default:{p=o;c=l}}}s=f[Y>>2]|0;u=Yn(t)|0;u=u-c|0;o=s+24|0;n=f[o>>2]|0;i=s+32|0;l=f[i>>2]|0;if((n+1|0)>>>0>l>>>0){n=~~(+(l>>>0)+100.0)>>>0;f[i>>2]=n;s=s+28|0;n=Qi(f[s>>2]|0,n*24|0)|0;if(!n){a=s;n=s;V=32;break}f[s>>2]=n;i=n;n=f[o>>2]|0}else i=f[s+28>>2]|0;d[i+(n*24|0)>>1]=0;l=i+(n*24|0)+8|0;f[l>>2]=u;f[l+4>>2]=((u|0)<0)<<31>>31;f[i+(n*24|0)+16>>2]=c;f[o>>2]=n+1;n=f[p>>2]|0;f[L>>2]=n;if((n|0)==65424){i=m;n=g;break}else o=784;while(1){i=f[o>>2]|0;if((i|0)==0|(i|0)==(n|0))break;else o=o+12|0}}else o=s;g=(i|0)==65361?1:g;m=(i|0)==65362?1:m;a=(i|0)==65372?1:a;if(!(f[o+4>>2]&f[q>>2])){V=38;break}if((Gn(t,f[y>>2]|0,2,r)|0)!=2){V=40;break}wn(f[y>>2]|0,_,2);i=(f[_>>2]|0)+-2|0;f[_>>2]=i;n=f[y>>2]|0;if(i>>>0>(f[v>>2]|0)>>>0){n=Qi(n,i)|0;if(!n){V=43;break}f[y>>2]=n;i=f[_>>2]|0;f[v>>2]=i}n=Gn(t,n,i,r)|0;if((n|0)!=(f[_>>2]|0)){V=46;break}if(!(Fu[f[o+8>>2]&63](e,f[y>>2]|0,n,r)|0)){V=48;break}l=f[Y>>2]|0;u=f[o>>2]|0;c=Yn(t)|0;p=f[_>>2]|0;c=-4-p+c|0;p=p+4|0;o=l+24|0;n=f[o>>2]|0;i=l+32|0;s=f[i>>2]|0;if((n+1|0)>>>0>s>>>0){n=~~(+(s>>>0)+100.0)>>>0;f[i>>2]=n;s=l+28|0;n=Qi(f[s>>2]|0,n*24|0)|0;if(!n){a=s;n=s;V=53;break}f[s>>2]=n;i=n;n=f[o>>2]|0}else i=f[l+28>>2]|0;d[i+(n*24|0)>>1]=u;u=i+(n*24|0)+8|0;f[u>>2]=c;f[u+4>>2]=((c|0)<0)<<31>>31;f[i+(n*24|0)+16>>2]=p;f[o>>2]=n+1;if((Gn(t,f[y>>2]|0,2,r)|0)!=2){V=55;break}wn(f[y>>2]|0,L,2);n=f[L>>2]|0;if((n|0)==65424){i=m;n=g;break}}switch(V|0){case 14:{f[P>>2]=n;Jn(r,1,15863,P)|0;r=0;b=K;return r|0}case 20:{Jn(r,1,8295,w)|0;V=34;break}case 25:{Jn(r,1,8339,x)|0;V=34;break}case 27:{f[L>>2]=65424;break}case 32:{Ji(f[n>>2]|0);f[a>>2]=0;f[i>>2]=0;f[o>>2]=0;Jn(r,1,15803,C)|0;V=34;break}case 38:{Jn(r,1,8339,T)|0;r=0;b=K;return r|0}case 40:{Jn(r,1,8295,M)|0;r=0;b=K;return r|0}case 43:{Ji(f[y>>2]|0);f[y>>2]=0;f[v>>2]=0;Jn(r,1,8427,S)|0;r=0;b=K;return r|0}case 46:{Jn(r,1,8295,A)|0;r=0;b=K;return r|0}case 48:{Jn(r,1,15985,R)|0;r=0;b=K;return r|0}case 53:{Ji(f[n>>2]|0);f[a>>2]=0;f[i>>2]=0;f[o>>2]=0;Jn(r,1,15803,H)|0;r=0;b=K;return r|0}case 55:{Jn(r,1,8295,k)|0;r=0;b=K;return r|0}}if((V|0)==34){Jn(r,1,15930,I)|0;r=0;b=K;return r|0}if(n){if(!i){Jn(r,1,16090,D)|0;r=0;b=K;return r|0}if(!a){Jn(r,1,16136,F)|0;r=0;b=K;return r|0}t:do{if(h[e+184>>0]&1){v=e+120|0;do{if(f[v>>2]|0){u=e+124|0;c=0;n=0;i=0;r:do{a=f[u>>2]|0;o=f[a+(c<<3)>>2]|0;n:do{if(o){s=f[a+(c<<3)+4>>2]|0;a=n>>>0<s>>>0;l=a?0:n-s|0;if((s|0)==(n|0)|a^1)n=l;else{o=a?o+n|0:o;n=s-n|0;while(1){if(n>>>0<4){V=70;break r}wn(o,N,4);a=n+-4|0;n=f[N>>2]|0;i=n+i|0;if(a>>>0<n>>>0)break;if((a|0)==(n|0)){n=l;break n}else{o=o+(n+4)|0;n=a-n|0}}n=n-a|0}}}while(0);c=c+1|0}while(c>>>0<(f[v>>2]|0)>>>0);if((V|0)==70){Jn(r,1,16182,U)|0;break}if(!n)V=77;else Jn(r,1,16213,z)|0}else{i=0;V=77}}while(0);r:do{if((V|0)==77){a=Yi(i)|0;p=e+144|0;f[p>>2]=a;if(!a){Jn(r,1,13302,j)|0;break}m=e+132|0;f[m>>2]=i;o=f[v>>2]|0;g=e+124|0;do{if(o){n=f[g>>2]|0;a=n;c=0;u=0;i=0;n:while(1){s=f[a+(c<<3)>>2]|0;if(!s)s=u;else{a=f[a+(c<<3)+4>>2]|0;n=(f[p>>2]|0)+i|0;i:do{if(u>>>0<a>>>0){Yl(n|0,s|0,u|0)|0;i=i+u|0;if((a|0)==(u|0)){s=0;break}l=s+u|0;n=a-u|0;while(1){if(n>>>0<4){V=88;break n}wn(l,G,4);s=l+4|0;o=n+-4|0;a=f[G>>2]|0;n=(f[p>>2]|0)+i|0;if(o>>>0<a>>>0){a=s;break}Yl(n|0,s|0,a|0)|0;n=f[G>>2]|0;i=n+i|0;if((o|0)==(n|0)){s=0;break i}else{l=l+(n+4)|0;n=o-n|0}}Yl(n|0,a|0,o|0)|0;s=(f[G>>2]|0)-o|0;i=o+i|0}else{Yl(n|0,s|0,a|0)|0;s=u-a|0;i=a+i|0}}while(0);Ji(f[(f[g>>2]|0)+(c<<3)>>2]|0);a=f[g>>2]|0;f[a+(c<<3)>>2]=0;f[a+(c<<3)+4>>2]=0;o=f[v>>2]|0;n=a}c=c+1|0;if(c>>>0>=o>>>0){V=94;break}else u=s}if((V|0)==88){Jn(r,1,16182,W)|0;break r}else if((V|0)==94){a=f[p>>2]|0;i=f[m>>2]|0;break}}else n=f[g>>2]|0}while(0);f[e+128>>2]=a;f[e+152>>2]=i;f[v>>2]=0;Ji(n);f[g>>2]=0;break t}}while(0);Jn(r,1,16236,X)|0;r=0;b=K;return r|0}}while(0);Jn(r,4,16262,Z)|0;Z=Yn(t)|0;r=(f[Y>>2]|0)+8|0;f[r>>2]=Z+-2;f[r+4>>2]=0;f[q>>2]=8;r=1;b=K;return r|0}}Jn(r,1,16044,O)|0;r=0;b=K;return r|0}}while(0);Jn(r,1,15839,l)|0;r=0;b=K;return r|0}function Ra(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0;C=b;b=b+16|0;L=C;k=f[e+80>>2]|0;P=e+88|0;S=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;m=f[k+16>>2]|0;d=m*1080|0;p=f[e+12>>2]|0;m=ce(m<<2,m)|0;e:do{if(S){g=p+5604|0;v=p+5620|0;y=p+5612|0;_=p+5616|0;E=p+5632|0;w=p+5624|0;x=p+5584|0;A=0;R=f[e+164>>2]|0;t:while(1){s=R+5584|0;T=f[s>>2]|0;Yl(R|0,p|0,5640)|0;t=R+5636|0;h[t>>0]=h[t>>0]&-4;f[R+5168>>2]=0;t=R+5604|0;f[t>>2]=0;l=R+5620|0;f[l>>2]=0;M=R+5612|0;f[M>>2]=0;u=R+5632|0;f[u>>2]=0;c=R+5624|0;f[c>>2]=0;f[s>>2]=T;if(f[g>>2]|0){n=Yi(m)|0;f[t>>2]=n;if(!n){t=0;n=25;break}Yl(n|0,f[g>>2]|0,m|0)|0}t=(f[v>>2]|0)*20|0;n=Yi(t)|0;f[M>>2]=n;if(!n){t=0;n=25;break}Yl(n|0,f[y>>2]|0,t|0)|0;t=f[_>>2]|0;if(t){a=0;o=f[M>>2]|0;s=f[y>>2]|0;while(1){i=s+12|0;if(f[i>>2]|0){t=s+16|0;n=Yi(f[t>>2]|0)|0;f[o+12>>2]=n;if(!n){t=0;n=25;break t}Yl(n|0,f[i>>2]|0,f[t>>2]|0)|0;t=f[_>>2]|0}f[l>>2]=(f[l>>2]|0)+1;a=a+1|0;if(a>>>0>=t>>>0)break;else{o=o+20|0;s=s+20|0}}}t=(f[E>>2]|0)*20|0;n=Yi(t)|0;f[c>>2]=n;if(!n){t=0;n=25;break}Yl(n|0,f[w>>2]|0,t|0)|0;f[u>>2]=f[E>>2];a=f[E>>2]|0;if(a){o=0;n=f[c>>2]|0;i=f[w>>2]|0;while(1){t=f[i+8>>2]|0;if(t)f[n+8>>2]=(f[M>>2]|0)+(((t-(f[y>>2]|0)|0)/20|0)*20|0);t=f[i+12>>2]|0;if(t)f[n+12>>2]=(f[M>>2]|0)+(((t-(f[y>>2]|0)|0)/20|0)*20|0);o=o+1|0;if(o>>>0>=a>>>0)break;else{n=n+20|0;i=i+20|0}}}Yl(T|0,f[x>>2]|0,d|0)|0;A=A+1|0;if(A>>>0>=S>>>0)break e;else R=R+5640|0}if((n|0)==25){b=C;return t|0}}}while(0);n=Br(1)|0;t=e+204|0;f[t>>2]=n;if(!n){r=0;b=C;return r|0}if(Gr(n,k,P)|0){r=1;b=C;return r|0}Wr(f[t>>2]|0);f[t>>2]=0;Jn(r,1,8839,L)|0;r=0;b=C;return r|0}function ka(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0;w=b;b=b+128|0;_=w+120|0;y=w+112|0;v=w+104|0;g=w+96|0;m=w+88|0;p=w+80|0;d=w+72|0;h=w+64|0;c=w+56|0;u=w+48|0;l=w+40|0;s=w+32|0;o=w+24|0;a=w+16|0;i=w+8|0;n=w;if(!e){b=w;return}hl(12191,17,1,r)|0;f[n>>2]=f[e>>2];el(r,12209,n)|0;f[i>>2]=f[e+4>>2];el(r,12222,i)|0;f[a>>2]=f[e+8>>2];el(r,12234,a)|0;f[o>>2]=f[e+16>>2];el(r,12251,o)|0;if((t|0)>0){a=e+5584|0;o=0;do{i=f[a>>2]|0;f[s>>2]=o;el(r,12262,s)|0;f[l>>2]=f[i+(o*1080|0)>>2];el(r,12276,l)|0;e=i+(o*1080|0)+4|0;f[u>>2]=f[e>>2];el(r,12290,u)|0;f[c>>2]=f[i+(o*1080|0)+8>>2];el(r,12313,c)|0;f[h>>2]=f[i+(o*1080|0)+12>>2];el(r,12329,h)|0;f[d>>2]=f[i+(o*1080|0)+16>>2];el(r,12345,d)|0;f[p>>2]=f[i+(o*1080|0)+20>>2];el(r,12362,p)|0;hl(12377,23,1,r)|0;if(f[e>>2]|0){n=0;do{x=f[i+(o*1080|0)+944+(n<<2)>>2]|0;f[m>>2]=f[i+(o*1080|0)+812+(n<<2)>>2];f[m+4>>2]=x;el(r,12401,m)|0;n=n+1|0}while(n>>>0<(f[e>>2]|0)>>>0)}tl(10,r)|0;x=i+(o*1080|0)+24|0;f[g>>2]=f[x>>2];el(r,12410,g)|0;f[v>>2]=f[i+(o*1080|0)+804>>2];el(r,12425,v)|0;hl(12442,20,1,r)|0;if((f[x>>2]|0)!=1){e=(f[e>>2]|0)*3|0;if((e|0)>2){e=e+-2|0;E=8}}else{e=1;E=8}if((E|0)==8){E=0;n=0;do{x=f[i+(o*1080|0)+28+(n<<3)>>2]|0;f[y>>2]=f[i+(o*1080|0)+28+(n<<3)+4>>2];f[y+4>>2]=x;el(r,12401,y)|0;n=n+1|0}while((n|0)!=(e|0))}tl(10,r)|0;f[_>>2]=f[i+(o*1080|0)+808>>2];el(r,12463,_)|0;hl(12480,5,1,r)|0;o=o+1|0}while((o|0)!=(t|0))}hl(10321,4,1,r)|0;b=w;return}function Pa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0;A=b;b=b+80|0;_=A+32|0;E=A+24|0;T=A+16|0;x=A+8|0;d=A+64|0;w=A+60|0;h=A+56|0;m=A+52|0;v=A+48|0;g=A+44|0;y=A+40|0;p=A+36|0;f[d>>2]=1;n=Yi(1e3)|0;if(!n){Jn(r,1,12127,A)|0;r=0;b=A;return r|0}M=e+116|0;S=e+112|0;l=e+204|0;u=e+84|0;c=e+8|0;i=1e3;s=0;while(1){if(!(la(e,w,h,m,v,g,y,p,d,t,r)|0)){a=5;break}if(!(f[d>>2]|0)){a=17;break}o=f[h>>2]|0;if(o>>>0>i>>>0){i=Qi(n,o)|0;if(!i){a=9;break}else{n=i;a=o}}else a=i;i=f[w>>2]|0;if(!(ua(e,i,n,o,t,r)|0)){a=11;break}i=i+1|0;o=ce(f[S>>2]|0,f[M>>2]|0)|0;f[E>>2]=i;f[E+4>>2]=o;Jn(r,4,11986,E)|0;o=f[l>>2]|0;if(!(lo(f[(f[f[o+20>>2]>>2]|0)+20>>2]|0,f[o+24>>2]|0,n,f[(f[u>>2]|0)+24>>2]|0)|0)){a=13;break}f[_>>2]=i;Jn(r,4,12016,_)|0;o=qn(t)|0;if((o|0)==0&(B|0)==0?(f[c>>2]|0)==64:0){a=17;break}s=s+1|0;if((s|0)==(ce(f[S>>2]|0,f[M>>2]|0)|0)){a=17;break}else i=a}if((a|0)==5){Ji(n);r=0;b=A;return r|0}else if((a|0)==9){Ji(n);S=ce(f[S>>2]|0,f[M>>2]|0)|0;f[x>>2]=(f[w>>2]|0)+1;f[x+4>>2]=S;Jn(r,1,11946,x)|0;r=0;b=A;return r|0}else if((a|0)==11){Ji(n);S=ce(f[S>>2]|0,f[M>>2]|0)|0;f[T>>2]=i+1;f[T+4>>2]=S;Jn(r,1,12162,T)|0;r=0;b=A;return r|0}else if((a|0)==13){Ji(n);r=0;b=A;return r|0}else if((a|0)==17){Ji(n);r=1;b=A;return r|0}return 0}function La(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0;L=b;b=b+96|0;T=L+56|0;R=L+48|0;x=L+40|0;M=L+32|0;k=L+24|0;l=L+16|0;s=L+8|0;g=L+92|0;A=L+88|0;m=L+84|0;y=L+80|0;E=L+76|0;_=L+72|0;w=L+68|0;v=L+64|0;f[g>>2]=1;n=Yi(1e3)|0;if(!n){Jn(r,1,11880,L)|0;P=0;b=L;return P|0}S=e+196|0;a=f[S>>2]|0;i=f[a+40>>2]|0;e:do{if(!i){i=ce(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[a+36>>2]=i;i=qi(i,40)|0;a=f[S>>2]|0;f[a+40>>2]=i;t:do{if(i){if(f[a+36>>2]|0){o=0;do{f[i+(o*40|0)+28>>2]=100;f[i+(o*40|0)+20>>2]=0;p=qi(100,24)|0;a=f[S>>2]|0;i=f[a+40>>2]|0;f[i+(o*40|0)+24>>2]=p;o=o+1|0;if(!p)break t}while(o>>>0<(f[a+36>>2]|0)>>>0)}a=f[e+60>>2]|0;if(!i)break e;else{P=12;break e}}}while(0);Ji(n);P=0;b=L;return P|0}else{a=f[e+60>>2]|0;P=12}}while(0);if((P|0)==12)if(f[i+16>>2]|0){if(!(f[i+(a*40|0)+4>>2]|0)){p=e+64|0;p=Wl(f[p>>2]|0,f[p+4>>2]|0,2,0)|0;if(!(kn(t,p,B,r)|0)){Jn(r,1,11918,s)|0;Ji(n);P=0;b=L;return P|0}}else{p=f[i+(a*40|0)+16>>2]|0;p=Wl(f[p>>2]|0,f[p+4>>2]|0,2,0)|0;if(!(kn(t,p,B,r)|0)){Jn(r,1,11918,l)|0;Ji(n);P=0;b=L;return P|0}}i=e+8|0;if((f[i>>2]|0)==256)f[i>>2]=8}e:do{if(la(e,A,m,y,E,_,w,v,g,t,r)|0){d=e+116|0;p=e+112|0;u=e+204|0;c=e+84|0;h=a+1|0;i=1e3;while(1){if(!(f[g>>2]|0))break;l=f[m>>2]|0;if(l>>>0>i>>>0){i=Qi(n,l)|0;if(!i){P=26;break}else{n=i;s=l}}else s=i;o=f[A>>2]|0;if(!(ua(e,o,n,l,t,r)|0)){P=28;break}i=o+1|0;l=ce(f[p>>2]|0,f[d>>2]|0)|0;f[M>>2]=i;f[M+4>>2]=l;Jn(r,4,11986,M)|0;l=f[u>>2]|0;if(!(lo(f[(f[f[l+20>>2]>>2]|0)+20>>2]|0,f[l+24>>2]|0,n,f[(f[c>>2]|0)+24>>2]|0)|0)){P=30;break}f[x>>2]=i;Jn(r,4,12016,x)|0;if((o|0)==(a|0)){P=32;break}f[T>>2]=i;f[T+4>>2]=h;Jn(r,2,12060,T)|0;if(!(la(e,A,m,y,E,_,w,v,g,t,r)|0))break e;else i=s}if((P|0)==26){Ji(n);P=ce(f[p>>2]|0,f[d>>2]|0)|0;f[k>>2]=(f[A>>2]|0)+1;f[k+4>>2]=P;Jn(r,1,11946,k)|0;P=0;b=L;return P|0}else if((P|0)==28){Ji(n);P=0;b=L;return P|0}else if((P|0)==30){Ji(n);P=0;b=L;return P|0}else if((P|0)==32){P=(f[S>>2]|0)+8|0;P=Wl(f[P>>2]|0,f[P+4>>2]|0,2,0)|0;if(!(kn(t,P,B,r)|0)){Jn(r,1,11918,R)|0;Ji(n);P=0;b=L;return P|0}}Ji(n);P=1;b=L;return P|0}}while(0);Ji(n);P=0;b=L;return P|0}function Ca(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0;I=b;b=b+32|0;k=I+16|0;y=I+8|0;l=I;R=I+20|0;P=f[e+40>>2]|0;C=e+36|0;c=f[C>>2]|0;h=e+204|0;s=f[h>>2]|0;f[s+16>>2]=0;A=e+8|0;f[A>>2]=0;f[R>>2]=0;En(c,65424,2);En(c+2|0,10,2);L=e+200|0;En(c+4|0,f[L>>2]|0,2);M=e+12|0;En(c+10|0,f[M>>2]|0,1);S=e+164|0;En(c+11|0,f[(f[S>>2]|0)+((f[L>>2]|0)*5640|0)+5588>>2]|0,1);f[R>>2]=12;a=c+12|0;n=P+-12|0;u=e+88|0;if(((d[u>>1]|0)+-3&65535)>=4?(i=f[L>>2]|0,o=f[S>>2]|0,(f[o+(i*5640|0)+420>>2]|0)!=0):0){f[R>>2]=0;io(f[(f[e+80>>2]|0)+16>>2]|0,o,i,a,R);T=f[R>>2]|0;i=T+12|0;a=c+i|0;n=n-T|0}else i=12;f[R>>2]=0;En(a,65427,2);f[s+4>>2]=f[A>>2];T=f[M>>2]|0;f[s+8>>2]=T;if(!T)f[(f[f[s+20>>2]>>2]|0)+840>>2]=0;f[R>>2]=0;if(!(Kr(s,f[L>>2]|0,a+2|0,R,n+-4|0,0)|0)){Jn(r,1,11860,l)|0;t=0;b=I;return t|0}n=(f[R>>2]|0)+2|0;f[R>>2]=n;n=n+i|0;En(c+6|0,n,4);if(((d[u>>1]|0)+-3&65535)<4){T=e+28|0;En(f[T>>2]|0,f[L>>2]|0,1);x=(f[T>>2]|0)+1|0;f[T>>2]=x;En(x,n,4);f[T>>2]=(f[T>>2]|0)+4}i=c+n|0;T=P-n|0;E=f[h>>2]|0;w=e+88|0;g=f[S>>2]|0;v=f[L>>2]|0;u=so(w,0,v)|0;x=e+8|0;f[M>>2]=(f[M>>2]|0)+1;e:do{if(u>>>0>1){c=E+4|0;h=E+8|0;p=E+20|0;m=e+28|0;o=i;i=T;n=0;l=1;while(1){f[x>>2]=l;f[R>>2]=0;En(o,65424,2);En(o+2|0,10,2);En(o+4|0,f[L>>2]|0,2);En(o+10|0,f[M>>2]|0,1);En(o+11|0,f[(f[S>>2]|0)+((f[L>>2]|0)*5640|0)+5588>>2]|0,1);f[R>>2]=0;En(o+12|0,65427,2);f[c>>2]=f[A>>2];s=f[M>>2]|0;f[h>>2]=s;if(!s)f[(f[f[p>>2]>>2]|0)+840>>2]=0;f[R>>2]=0;if(!(Kr(E,f[L>>2]|0,o+14|0,R,i+-16|0,0)|0))break;H=f[R>>2]|0;O=H+2|0;f[R>>2]=O;s=H+14|0;a=o+s|0;n=n+12+O|0;i=i+-12+(-2-H)|0;En(o+6|0,s,4);if(((d[w>>1]|0)+-3&65535)<4){En(f[m>>2]|0,f[L>>2]|0,1);O=(f[m>>2]|0)+1|0;f[m>>2]=O;En(O,s,4);f[m>>2]=(f[m>>2]|0)+4}f[M>>2]=(f[M>>2]|0)+1;l=l+1|0;if(l>>>0>=u>>>0){_=12;break e}else o=a}Jn(r,1,11860,y)|0}else{a=i;i=T;n=0;_=12}}while(0);e:do{if((_|0)==12){p=g+(v*5640|0)+420|0;t:do{if(f[p>>2]|0){m=E+16|0;g=E+4|0;v=E+8|0;y=E+20|0;h=e+28|0;c=1;r:while(1){f[m>>2]=c;u=so(w,c,f[L>>2]|0)|0;if(u){l=0;while(1){f[x>>2]=l;f[R>>2]=0;En(a,65424,2);En(a+2|0,10,2);En(a+4|0,f[L>>2]|0,2);En(a+10|0,f[M>>2]|0,1);En(a+11|0,f[(f[S>>2]|0)+((f[L>>2]|0)*5640|0)+5588>>2]|0,1);f[R>>2]=0;En(a+12|0,65427,2);f[g>>2]=f[A>>2];O=f[M>>2]|0;f[v>>2]=O;if(!O)f[(f[f[y>>2]>>2]|0)+840>>2]=0;f[R>>2]=0;if(!(Kr(E,f[L>>2]|0,a+14|0,R,i+-16|0,0)|0))break r;O=f[R>>2]|0;o=O+2|0;f[R>>2]=o;n=n+12+o|0;o=O+14|0;s=a+o|0;i=i+-12+(-2-O)|0;En(a+6|0,o,4);if(((d[w>>1]|0)+-3&65535)<4){En(f[h>>2]|0,f[L>>2]|0,1);O=(f[h>>2]|0)+1|0;f[h>>2]=O;En(O,o,4);f[h>>2]=(f[h>>2]|0)+4}f[M>>2]=(f[M>>2]|0)+1;l=l+1|0;if(l>>>0>=u>>>0){a=s;break}else a=s}}c=c+1|0;if(c>>>0>(f[p>>2]|0)>>>0)break t}Jn(r,1,11860,k)|0;break e}}while(0);O=n-T+P|0;if((Wn(t,f[C>>2]|0,O,r)|0)!=(O|0)){O=0;b=I;return O|0}f[L>>2]=(f[L>>2]|0)+1;O=1;b=I;return O|0}}while(0);O=0;b=I;return O|0}function Ia(e,t,r){e=e|0;t=t|0;r=r|0;e=e+44|0;En(f[e>>2]|0,65497,2);if((Wn(t,f[e>>2]|0,2,r)|0)!=2){t=0;return t|0}t=(Xn(t,r)|0)!=0&1;return t|0}function Ha(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;a=(f[e+32>>2]|0)*5|0;s=e+16|0;s=Wl(f[s>>2]|0,f[s+4>>2]|0,6,0)|0;o=B;n=Yn(t)|0;i=B;if(!(Kn(t,s,o,r)|0)){s=0;return s|0}if((Wn(t,f[e+24>>2]|0,a,r)|0)!=(a|0)){s=0;return s|0}s=(Kn(t,n,i,r)|0)!=0&1;return s|0}function Oa(e,t,r){e=e|0;t=t|0;r=r|0;e=f[e+196>>2]|0;if(!e)return 1;t=Yn(t)|0;r=e;r=zl(t|0,B|0,f[r>>2]|0,f[r+4>>2]|0)|0;t=e+16|0;f[t>>2]=r;f[t+4>>2]=B;return 1}function Da(e,t,r){e=e|0;t=t|0;r=r|0;r=e+204|0;Wr(f[r>>2]|0);f[r>>2]=0;r=e+24|0;t=f[r>>2]|0;if(t){Ji(t);f[r>>2]=0;f[e+28>>2]=0}r=e+36|0;t=f[r>>2]|0;if(!t){e=e+40|0;f[e>>2]=0;return 1}Ji(t);f[r>>2]=0;e=e+40|0;f[e>>2]=0;return 1}function Fa(e,t,r){e=e|0;t=t|0;r=r|0;r=e+44|0;t=f[r>>2]|0;if(t){Ji(t);f[r>>2]=0}f[e+48>>2]=0;return 1}function Na(e,t,r){e=e|0;t=t|0;r=r|0;return 1}function Ua(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;i=b;b=b+32|0;n=(f[e+8>>2]|0)==0&(f[e+188>>2]|0)!=0&(f[e+192>>2]|0)!=0&1;t=(f[(f[(f[e+164>>2]|0)+5584>>2]|0)+4>>2]|0)+-1|0;if(t>>>0>31){Jn(r,1,11790,i)|0;r=0;b=i;return r|0}t=1<<t;if((f[e+100>>2]|0)>>>0<t>>>0){Jn(r,1,11790,i+8|0)|0;r=0;b=i;return r|0}if((f[e+104>>2]|0)>>>0>=t>>>0){r=n;b=i;return r|0}Jn(r,1,11790,i+16|0)|0;r=0;b=i;return r|0}function Ba(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;if((d[e+88>>1]&-32256)<<16>>16!=-32256){s=1;return s|0}o=ce(f[e+112>>2]|0,f[e+116>>2]|0)|0;if(!o){s=1;return s|0}a=e+80|0;s=0;r=1;i=f[e+164>>2]|0;while(1){if((f[i+16>>2]|0)==2){r=(f[i+5608>>2]|0)!=0&r;e=f[(f[a>>2]|0)+16>>2]|0;if(e){n=0;t=f[i+5584>>2]|0;while(1){r=(f[t+20>>2]&1^1)&r;n=n+1|0;if(n>>>0>=e>>>0)break;else t=t+1080|0}}}s=s+1|0;if((s|0)==(o|0))break;else i=i+5640|0}return r|0}function za(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;a=e+88|0;o=e+32|0;s=f[e+80>>2]|0;l=ce(f[e+116>>2]|0,f[e+112>>2]|0)|0;f[o>>2]=0;if(!l)return 1;n=f[e+164>>2]|0;i=0;while(1){Hr(s,a,i);t=n+420|0;r=0;e=0;do{u=so(a,e,i)|0;f[o>>2]=(f[o>>2]|0)+u;r=u+r|0;e=e+1|0}while(e>>>0<=(f[t>>2]|0)>>>0);f[n+5588>>2]=r;i=i+1|0;if((i|0)==(l|0))break;else n=n+5640|0}return 1}function ja(e,t,r){e=e|0;t=t|0;r=r|0;e=f[e+44>>2]|0;En(e,65359,2);return(Wn(t,e,2,r)|0)==2|0}function Va(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;d=b;b=b+16|0;o=d;s=f[e+80>>2]|0;c=s+16|0;l=(f[c>>2]|0)*3|0;h=l+40|0;n=f[s+24>>2]|0;a=e+48|0;u=e+44|0;i=f[u>>2]|0;do{if(h>>>0>(f[a>>2]|0)>>>0){i=Qi(i,h)|0;if(i){f[u>>2]=i;f[a>>2]=h;break}Ji(f[u>>2]|0);f[u>>2]=0;f[a>>2]=0;Jn(r,1,11752,o)|0;t=0;b=d;return t|0}}while(0);En(i,65361,2);En(i+2|0,l+38|0,2);En(i+4|0,m[e+88>>1]|0,2);En(i+6|0,f[s+8>>2]|0,4);En(i+10|0,f[s+12>>2]|0,4);En(i+14|0,f[s>>2]|0,4);En(i+18|0,f[s+4>>2]|0,4);En(i+22|0,f[e+100>>2]|0,4);En(i+26|0,f[e+104>>2]|0,4);En(i+30|0,f[e+92>>2]|0,4);En(i+34|0,f[e+96>>2]|0,4);En(i+38|0,f[c>>2]|0,2);if(f[c>>2]|0){a=0;i=i+40|0;while(1){En(i,(f[n+24>>2]|0)+-1+(f[n+32>>2]<<7)|0,1);En(i+1|0,f[n>>2]|0,1);En(i+2|0,f[n+4>>2]|0,1);a=a+1|0;if(a>>>0>=(f[c>>2]|0)>>>0)break;else{i=i+3|0;n=n+52|0}}}t=(Wn(t,f[u>>2]|0,h,r)|0)==(h|0)&1;b=d;return t|0}function Ga(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0;g=b;b=b+32|0;m=g+16|0;p=g+8|0;s=g;d=g+20|0;l=e+200|0;u=f[l>>2]|0;c=e+164|0;h=f[c>>2]|0;n=f[h+(u*5640|0)+5584>>2]|0;if(!(f[n>>2]&1))a=5;else a=(f[n+4>>2]|0)+5|0;o=a+9|0;f[d>>2]=o;i=e+48|0;e=e+44|0;n=f[e>>2]|0;do{if(o>>>0>(f[i>>2]|0)>>>0){n=Qi(n,o)|0;if(n){f[e>>2]=n;f[i>>2]=o;break}Ji(f[e>>2]|0);f[e>>2]=0;f[i>>2]=0;Jn(r,1,11687,s)|0;m=0;b=g;return m|0}}while(0);En(n,65362,2);En(n+2|0,a+7|0,2);En(n+4|0,f[h+(u*5640|0)>>2]|0,1);En(n+5|0,f[h+(u*5640|0)+4>>2]|0,1);En(n+6|0,f[h+(u*5640|0)+8>>2]|0,2);En(n+8|0,f[h+(u*5640|0)+16>>2]|0,1);f[d>>2]=a;if(!(oo(f[c>>2]|0,f[l>>2]|0,n+9|0,d,r)|0)){Jn(r,1,11726,p)|0;m=0;b=g;return m|0}if(!(f[d>>2]|0)){m=(Wn(t,f[e>>2]|0,o,r)|0)==(o|0)&1;b=g;return m|0}else{Jn(r,1,11726,m)|0;m=0;b=g;return m|0}return 0}function Wa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0;p=b;b=b+32|0;d=p+16|0;h=p+8|0;s=p;u=p+20|0;l=e+200|0;c=e+164|0;n=f[(f[c>>2]|0)+((f[l>>2]|0)*5640|0)+5584>>2]|0;i=f[n+24>>2]|0;if((i|0)==1)n=1;else n=((f[n+4>>2]|0)*3|0)+-2|0;a=(i|0)==0?n+1|0:n<<1|1;o=a+4|0;f[u>>2]=o;i=e+48|0;e=e+44|0;n=f[e>>2]|0;do{if(o>>>0>(f[i>>2]|0)>>>0){n=Qi(n,o)|0;if(n){f[e>>2]=n;f[i>>2]=o;break}Ji(f[e>>2]|0);f[e>>2]=0;f[i>>2]=0;Jn(r,1,11622,s)|0;d=0;b=p;return d|0}}while(0);En(n,65372,2);En(n+2|0,a+2|0,2);f[u>>2]=a;if(!(ao(f[c>>2]|0,f[l>>2]|0,0,n+4|0,u,r)|0)){Jn(r,1,11661,h)|0;d=0;b=p;return d|0}if(!(f[u>>2]|0)){d=(Wn(t,f[e>>2]|0,o,r)|0)==(o|0)&1;b=p;return d|0}else{Jn(r,1,11661,d)|0;d=0;b=p;return d|0}return 0}function Xa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0;w=b;b=b+16|0;_=w;g=w+4|0;d=e+80|0;n=f[(f[d>>2]|0)+16>>2]|0;if(n>>>0<=1){E=1;b=w;return E|0}v=e+164|0;y=e+200|0;m=e+48|0;h=e+44|0;c=1;while(1){o=f[v>>2]|0;l=f[y>>2]|0;a=f[o+(l*5640|0)+5584>>2]|0;s=f[a+(c*1080|0)>>2]|0;e:do{if((((((f[a>>2]|0)==(s|0)?(p=f[a+4>>2]|0,(p|0)==(f[a+(c*1080|0)+4>>2]|0)):0)?(f[a+8>>2]|0)==(f[a+(c*1080|0)+8>>2]|0):0)?(f[a+12>>2]|0)==(f[a+(c*1080|0)+12>>2]|0):0)?(f[a+16>>2]|0)==(f[a+(c*1080|0)+16>>2]|0):0)?(f[a+20>>2]|0)==(f[a+(c*1080|0)+20>>2]|0):0){if(p){e=0;do{if((f[a+812+(e<<2)>>2]|0)!=(f[a+(c*1080|0)+812+(e<<2)>>2]|0)){E=13;break e}if((f[a+944+(e<<2)>>2]|0)!=(f[a+(c*1080|0)+944+(e<<2)>>2]|0)){E=13;break e}e=e+1|0}while(e>>>0<p>>>0)}}else E=13}while(0);if((E|0)==13){E=0;if(!(s&1))e=5;else e=(f[a+(c*1080|0)+4>>2]|0)+5|0;u=e+(n>>>0<257?6:7)|0;i=f[h>>2]|0;if(u>>>0>(f[m>>2]|0)>>>0){e=Qi(i,u)|0;if(!e){E=17;break}f[h>>2]=e;f[m>>2]=u;l=f[y>>2]|0;o=f[v>>2]|0;a=f[o+(l*5640|0)+5584>>2]|0;n=f[(f[d>>2]|0)+16>>2]|0;s=f[a+(c*1080|0)>>2]|0;i=e}n=n>>>0<257?1:2;if(!(s&1))e=5;else e=(f[a+(c*1080|0)+4>>2]|0)+5|0;En(i,65363,2);En(i+2|0,n+3+e|0,2);En(i+4|0,c,n);s=n|4;En(i+s|0,f[(f[o+(l*5640|0)+5584>>2]|0)+(c*1080|0)>>2]|0,1);f[g>>2]=e;oo(f[v>>2]|0,f[y>>2]|0,i+(s+1)|0,g,r)|0;if((Wn(t,f[h>>2]|0,u,r)|0)!=(u|0)){e=0;E=24;break}n=f[(f[d>>2]|0)+16>>2]|0}c=c+1|0;if(c>>>0>=n>>>0){e=1;E=24;break}}if((E|0)==17){Ji(f[h>>2]|0);f[h>>2]=0;f[m>>2]=0;Jn(r,1,11548,_)|0;E=0;b=w;return E|0}else if((E|0)==24){b=w;return e|0}return 0}function Ya(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0;y=b;b=b+16|0;g=y;d=y+4|0;c=e+80|0;n=f[(f[c>>2]|0)+16>>2]|0;if(n>>>0<=1){v=1;b=y;return v|0}p=e+164|0;m=e+200|0;h=e+48|0;u=e+44|0;l=1;while(1){s=f[(f[p>>2]|0)+((f[m>>2]|0)*5640|0)+5584>>2]|0;a=f[s+24>>2]|0;o=f[s+(l*1080|0)+24>>2]|0;e:do{if((a|0)==(o|0)?(f[s+804>>2]|0)==(f[s+(l*1080|0)+804>>2]|0):0){if((a|0)!=1){i=(f[s+4>>2]|0)*3|0;e=i+-2|0;if((i|0)!=((f[s+(l*1080|0)+4>>2]|0)*3|0)){v=14;break}if(!e)break}else e=1;i=0;do{if((f[s+28+(i<<3)>>2]|0)!=(f[s+(l*1080|0)+28+(i<<3)>>2]|0)){v=14;break e}i=i+1|0}while(i>>>0<e>>>0);if(a){i=0;do{if((f[s+28+(i<<3)+4>>2]|0)!=(f[s+(l*1080|0)+28+(i<<3)+4>>2]|0)){v=14;break e}i=i+1|0}while(i>>>0<e>>>0)}}else v=14}while(0);if((v|0)==14){v=0;if((o|0)==1)e=1;else e=((f[s+(l*1080|0)+4>>2]|0)*3|0)+-2|0;a=((o|0)==0?e+1|0:e<<1|1)+5+(n>>>0>256&1)|0;e=f[u>>2]|0;if(a>>>0>(f[h>>2]|0)>>>0){e=Qi(e,a)|0;if(!e){v=18;break}f[u>>2]=e;f[h>>2]=a;n=f[(f[p>>2]|0)+((f[m>>2]|0)*5640|0)+5584>>2]|0;i=f[n+(l*1080|0)+24>>2]|0}else{i=o;n=s}if((i|0)==1)n=1;else n=((f[n+(l*1080|0)+4>>2]|0)*3|0)+-2|0;i=(i|0)==0?n+1|0:n<<1|1;f[d>>2]=i+6;En(e,65373,2);n=e+2|0;if((f[(f[c>>2]|0)+16>>2]|0)>>>0<257){En(n,i+3|0,2);En(e+4|0,l,1);e=e+5|0}else{En(n,i+4|0,2);En(e+4|0,l,2);e=e+6|0}f[d>>2]=i;ao(f[p>>2]|0,f[m>>2]|0,l,e,d,r)|0;if((Wn(t,f[u>>2]|0,a,r)|0)!=(a|0)){e=0;v=28;break}n=f[(f[c>>2]|0)+16>>2]|0}l=l+1|0;if(l>>>0>=n>>>0){e=1;v=28;break}}if((v|0)==18){Ji(f[u>>2]|0);f[u>>2]=0;f[h>>2]=0;Jn(r,1,11476,g)|0;v=0;b=y;return v|0}else if((v|0)==28){b=y;return e|0}return 0}function qa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;a=u;o=(f[e+32>>2]|0)*5|0;s=o+6|0;i=e+48|0;l=e+44|0;n=f[l>>2]|0;do{if(s>>>0>(f[i>>2]|0)>>>0){n=Qi(n,s)|0;if(n){f[l>>2]=n;f[i>>2]=s;break}Ji(f[l>>2]|0);f[l>>2]=0;f[i>>2]=0;Jn(r,1,11437,a)|0;t=0;b=u;return t|0}}while(0);a=Yn(t)|0;e=e+16|0;f[e>>2]=a;f[e+4>>2]=B;En(n,65365,2);En(n+2|0,o+4|0,2);En(n+4|0,0,1);En(n+5|0,80,1);t=(Wn(t,f[l>>2]|0,s,r)|0)==(s|0)&1;b=u;return t|0}function Za(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;m=b;b=b+16|0;s=m;p=m+4|0;f[p>>2]=0;c=e+200|0;n=f[c>>2]|0;u=e+164|0;i=f[u>>2]|0;l=e+80|0;o=f[(f[l>>2]|0)+16>>2]|0;d=(ce(o>>>0<257?7:9,(f[i+(n*5640|0)+420>>2]|0)+1|0)|0)+4|0;a=e+48|0;h=e+44|0;e=f[h>>2]|0;do{if(d>>>0>(f[a>>2]|0)>>>0){n=Qi(e,d)|0;if(n){f[h>>2]=n;f[a>>2]=d;a=n;e=f[(f[l>>2]|0)+16>>2]|0;i=f[u>>2]|0;n=f[c>>2]|0;break}Ji(f[h>>2]|0);f[h>>2]=0;f[a>>2]=0;Jn(r,1,11398,s)|0;t=0;b=m;return t|0}else{a=e;e=o}}while(0);io(e,i,n,a,p);t=(Wn(t,f[h>>2]|0,d,r)|0)==(d|0)&1;b=m;return t|0}function Ka(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0;s=e+164|0;l=e+80|0;i=f[l>>2]|0;n=f[i+16>>2]|0;if(!n){t=1;return t|0}o=e+44|0;e=0;a=f[(f[s>>2]|0)+5584>>2]|0;while(1){if(f[a+808>>2]|0){u=f[(f[s>>2]|0)+5584>>2]|0;h=n>>>0<257?1:2;i=h+6|0;c=f[o>>2]|0;En(c,65374,2);n=h|4;En(c+2|0,n,2);En(c+4|0,e,h);En(c+n|0,0,1);En(c+(n+1)|0,f[u+(e*1080|0)+808>>2]|0,1);if((Wn(t,f[o>>2]|0,i,r)|0)!=(i|0)){e=0;n=7;break}i=f[l>>2]|0}e=e+1|0;n=f[i+16>>2]|0;if(e>>>0>=n>>>0){e=1;n=7;break}else a=a+1080|0}if((n|0)==7)return e|0;return 0}function Qa(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;u=b;b=b+16|0;a=u;o=f[e+108>>2]|0;s=xl(o)|0;l=s+6|0;n=e+48|0;i=e+44|0;e=f[i>>2]|0;do{if(l>>>0>(f[n>>2]|0)>>>0){e=Qi(e,l)|0;if(e){f[i>>2]=e;f[n>>2]=l;break}Ji(f[i>>2]|0);f[i>>2]=0;f[n>>2]=0;Jn(r,1,11355,a)|0;t=0;b=u;return t|0}}while(0);En(e,65380,2);En(e+2|0,s+4|0,2);En(e+4|0,1,2);Yl(e+6|0,o|0,s|0)|0;t=(Wn(t,f[i>>2]|0,l,r)|0)==(l|0)&1;b=u;return t|0}function Ja(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0;S=b;b=b+32|0;w=S+24|0;y=S+16|0;d=S+8|0;i=S;o=f[e+80>>2]|0;s=o+16|0;a=f[s>>2]|0;l=a+6|0;E=e+48|0;M=e+44|0;n=f[M>>2]|0;do{if(l>>>0>(f[E>>2]|0)>>>0){n=Qi(n,l)|0;if(n){f[M>>2]=n;f[E>>2]=l;break}Ji(f[M>>2]|0);f[M>>2]=0;f[E>>2]=0;Jn(r,1,11199,i)|0;t=0;b=S;return t|0}}while(0);En(n,65400,2);En(n+2|0,a+4|0,2);En(n+4|0,f[s>>2]|0,2);if(f[s>>2]|0){a=0;i=f[o+24>>2]|0;n=n+6|0;while(1){En(n,(f[i+24>>2]|0)+-1|f[i+32>>2]<<7,1);a=a+1|0;if(a>>>0>=(f[s>>2]|0)>>>0)break;else{i=i+52|0;n=n+1|0}}}if((Wn(t,f[M>>2]|0,l,r)|0)!=(l|0)){t=0;b=S;return t|0}m=e+200|0;c=f[m>>2]|0;g=e+164|0;u=f[g>>2]|0;i=u+(c*5640|0)+5616|0;e:do{if(f[i>>2]|0){l=0;e=f[u+(c*5640|0)+5612>>2]|0;while(1){a=e+16|0;o=f[a>>2]|0;s=o+10|0;n=f[M>>2]|0;if(s>>>0>(f[E>>2]|0)>>>0){n=Qi(n,s)|0;if(!n)break;f[M>>2]=n;f[E>>2]=s}En(n,65396,2);En(n+2|0,o+8|0,2);En(n+4|0,0,2);En(n+6|0,f[e+4>>2]<<8|f[e+8>>2]&255|f[e>>2]<<10,2);En(n+8|0,0,2);Yl(n+10|0,f[e+12>>2]|0,f[a>>2]|0)|0;if((Wn(t,f[M>>2]|0,s,r)|0)!=(s|0)){v=0;x=42;break}l=l+1|0;if(l>>>0>=(f[i>>2]|0)>>>0)break e;else e=e+20|0}if((x|0)==42){b=S;return v|0}Ji(f[M>>2]|0);f[M>>2]=0;f[E>>2]=0;Jn(r,1,11238,d)|0;t=0;b=S;return t|0}}while(0);d=u+(c*5640|0)+5628|0;e:do{if(f[d>>2]|0){p=0;u=f[u+(c*5640|0)+5624>>2]|0;while(1){l=u+4|0;i=f[l>>2]|0;o=i>>>0>255;s=o?2:1;o=o?32768:0;i=ce(s,i<<1)|0;e=i+19|0;n=f[M>>2]|0;if(e>>>0>(f[E>>2]|0)>>>0){n=Qi(n,e)|0;if(!n)break;f[M>>2]=n;f[E>>2]=e}En(n,65397,2);En(n+2|0,i+17|0,2);En(n+4|0,0,2);En(n+6|0,f[u>>2]|0,1);En(n+7|0,0,2);En(n+9|0,1,2);En(n+11|0,1,1);En(n+12|0,f[l>>2]|o,2);n=n+14|0;if(!(f[l>>2]|0))i=0;else{a=0;do{En(n,a,s);n=n+s|0;a=a+1|0;i=f[l>>2]|0}while(a>>>0<i>>>0)}En(n,i|o,2);n=n+2|0;if(!(f[l>>2]|0))a=n;else{i=0;do{En(n,i,s);n=n+s|0;i=i+1|0}while(i>>>0<(f[l>>2]|0)>>>0);a=n}n=((h[u+16>>0]^1)&255)<<16&65536;i=f[u+8>>2]|0;if(i)n=f[i+8>>2]|n;i=f[u+12>>2]|0;if(i)n=f[i+8>>2]<<8|n;En(a,n,3);if((Wn(t,f[M>>2]|0,e,r)|0)!=(e|0)){v=0;x=42;break}p=p+1|0;if(p>>>0>=(f[d>>2]|0)>>>0)break e;else u=u+20|0}if((x|0)==42){b=S;return v|0}Ji(f[M>>2]|0);f[M>>2]=0;f[E>>2]=0;Jn(r,1,11277,y)|0;t=0;b=S;return t|0}}while(0);s=f[m>>2]|0;o=f[g>>2]|0;l=o+(s*5640|0)+5628|0;i=f[l>>2]|0;e=i+5|0;n=f[M>>2]|0;do{if(e>>>0>(f[E>>2]|0)>>>0){n=Qi(n,e)|0;if(!n){Ji(f[M>>2]|0);f[M>>2]=0;f[E>>2]=0;Jn(r,1,11316,w)|0;_=1;break}else{f[M>>2]=n;f[E>>2]=e;T=n;x=37;break}}else{T=n;x=37}}while(0);if((x|0)==37){En(T,65399,2);En(T+2|0,i+3|0,2);En(T+4|0,f[l>>2]|0,1);if(f[l>>2]|0){a=0;i=T+5|0;n=f[o+(s*5640|0)+5624>>2]|0;while(1){En(i,f[n>>2]|0,1);a=a+1|0;if(a>>>0>=(f[l>>2]|0)>>>0)break;else{i=i+1|0;n=n+20|0}}}_=(Wn(t,f[M>>2]|0,e,r)|0)!=(e|0)}t=_&1^1;b=S;return t|0}function $a(e,t,r){e=e|0;t=t|0;r=r|0;r=Yn(t)|0;t=(f[e+196>>2]|0)+8|0;f[t>>2]=r;f[t+4>>2]=B;return 1}function eo(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;i=b;b=b+16|0;t=Br(0)|0;n=e+204|0;f[n>>2]=t;if(!t){Jn(r,1,11159,i)|0;r=0;b=i;return r|0}if(Gr(t,f[e+80>>2]|0,e+88|0)|0){r=1;b=i;return r|0}Wr(f[n>>2]|0);f[n>>2]=0;r=0;b=i;return r|0}function to(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0.0,c=0,p=0,m=0,g=0,y=0,_=0.0,b=0,E=0,w=0.0,x=0.0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0.0,C=0.0,I=0.0,H=0.0,O=0,D=0,F=0,N=0,U=0,z=0,j=0,V=0;U=e+80|0;k=f[U>>2]|0;z=e+164|0;i=f[z>>2]|0;N=k+24|0;P=f[N>>2]|0;r=f[P>>2]|0;n=f[P+4>>2]|0;F=k+16|0;P=ce(f[P+24>>2]|0,f[F>>2]|0)|0;R=Yn(t)|0;m=e+116|0;s=f[m>>2]|0;g=e+112|0;t=f[g>>2]|0;L=(+(R>>>0)+4294967296.0*+(B|0))/+((ce(t,s)|0)>>>0);R=(h[e+181>>0]&8)==0?1:2;if(s){y=e+92|0;b=e+100|0;E=e+96|0;T=e+104|0;M=k+4|0;S=k+8|0;A=k+12|0;x=+((ce(r<<3,n)|0)>>>0);l=t;r=t;p=0;t=i;do{c=p;p=p+1|0;if(!r)r=0;else{l=0;do{w=+Pu[R&3](t);s=f[t+8>>2]|0;w=w/+(s>>>0);j=f[y>>2]|0;i=f[b>>2]|0;o=(ce(i,l)|0)+j|0;r=f[k>>2]|0;r=(o|0)>(r|0)?o:r;o=f[E>>2]|0;a=f[T>>2]|0;V=(ce(a,c)|0)+o|0;n=f[M>>2]|0;n=(V|0)>(n|0)?V:n;l=l+1|0;j=(ce(i,l)|0)+j|0;i=f[S>>2]|0;i=(j|0)<(i|0)?j:i;o=(ce(a,p)|0)+o|0;a=f[A>>2]|0;a=(o|0)<(a|0)?o:a;o=t+20|0;u=+v[o>>2];if(u!=0.0){_=+((ce(ce(i-r|0,P)|0,a-n|0)|0)>>>0)/(x*u)-w;v[o>>2]=_}if(s>>>0>1){u=+((ce(ce(i-r|0,P)|0,a-n|0)|0)>>>0);r=1;n=t+24|0;while(1){_=+v[n>>2];if(_!=0.0)v[n>>2]=u/(x*_)-w;r=r+1|0;if(r>>>0>=s>>>0)break;else n=n+4|0}}t=t+5640|0;r=f[g>>2]|0}while(l>>>0<r>>>0);s=f[m>>2]|0;l=r}}while(p>>>0<s>>>0);if(!s)s=0;else{y=(l|0)==0;_=L+2.0;E=l>>>0>1?l:1;b=0;r=f[z>>2]|0;do{if(!y){p=r+16|0;m=0;g=r;while(1){t=g+20|0;u=+v[t>>2];if(u!=0.0?(x=u-L,v[t>>2]=x,x<30.0):0)v[t>>2]=30.0;a=g+24|0;t=f[g+8>>2]|0;c=t+-1|0;u=+v[a>>2];n=u!=0.0;if(c>>>0>1){o=p+(t<<2)|0;i=1;t=a;do{if(n?(x=u-L,v[t>>2]=x,I=+v[t+-4>>2],x<I+10.0):0)v[t>>2]=I+20.0;t=t+4|0;i=i+1|0;u=+v[t>>2];n=u!=0.0}while((i|0)!=(c|0));if(n){C=u;O=o;D=29}}else if(n){C=u;O=a;D=29}if((D|0)==29?(D=0,x=C-_,v[O>>2]=x,H=+v[O+-4>>2],x<H+10.0):0)v[O>>2]=H+20.0;m=m+1|0;if(m>>>0>=l>>>0)break;else{p=p+5640|0;g=g+5640|0}}r=r+(E*5640|0)|0}b=b+1|0}while(b>>>0<s>>>0)}}else{l=t;s=0}n=f[F>>2]|0;if(!n)b=0;else{i=(f[e+100>>2]|0)+-1|0;a=(f[e+104>>2]|0)+-1|0;o=0;t=f[N>>2]|0;r=0;while(1){V=f[t>>2]|0;j=f[t+4>>2]|0;V=ce(((a+j|0)>>>0)/(j>>>0)|0,((i+V|0)>>>0)/(V>>>0)|0)|0;r=(ce(V,f[t+24>>2]|0)|0)+r|0;o=o+1|0;if(o>>>0>=n>>>0)break;else t=t+52|0}b=~~(+(r>>>0)*.1625)>>>0}c=f[(f[U>>2]|0)+16>>2]|0;m=c+-1|0;y=ce(s,l)|0;p=(y|0)==0;if(p)i=0;else{t=0;r=0;n=f[z>>2]|0;while(1){V=f[n+5588>>2]|0;r=r>>>0>V>>>0?r:V;t=t+1|0;if((t|0)==(y|0))break;else n=n+5640|0}i=r*12|0}g=e+88|0;if(((d[g>>1]|0)+-3&65535)>=4){if(p){t=0;r=0}else{l=(c|0)==0;o=0;r=0;do{if(!l){n=f[(f[z>>2]|0)+(o*5640|0)+5584>>2]|0;a=0;do{if(!(f[n+(a*1080|0)>>2]&1))t=5;else t=(f[n+(a*1080|0)+4>>2]|0)+5|0;r=r>>>0>t>>>0?r:t;a=a+1|0}while((a|0)!=(c|0))}o=o+1|0}while((o|0)!=(y|0));s=0;t=0;do{if(!l){a=f[(f[z>>2]|0)+(s*5640|0)+5584>>2]|0;o=0;do{if(!(f[a+(o*1080|0)>>2]&1))n=5;else n=(f[a+(o*1080|0)+4>>2]|0)+5|0;t=t>>>0>n>>>0?t:n;o=o+1|0}while((o|0)!=(c|0))}s=s+1|0}while((s|0)!=(y|0))}i=(ce(r+12+t|0,m)|0)+i|0}if(p)r=13;else{n=0;r=0;t=f[z>>2]|0;while(1){V=f[t+420>>2]|0;r=r>>>0>V>>>0?r:V;n=n+1|0;if((n|0)==(y|0))break;else t=t+5640|0}r=(r*9|0)+13|0}V=i+b+r|0;f[e+40>>2]=V;V=Yi(V)|0;f[e+36>>2]=V;if(!V){V=0;return V|0}if(((d[g>>1]|0)+-3&65535)>=4){V=1;return V|0}r=Yi((f[e+32>>2]|0)*5|0)|0;f[e+24>>2]=r;if(!r){V=0;return V|0}f[e+28>>2]=r;V=1;return V|0}function ro(e){e=e|0;return 0.0}function no(e){e=e|0;return+ +((((f[e+5588>>2]|0)*14|0)+-14|0)>>>0)}function io(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0;a=f[t+(r*5640|0)+5584>>2]|0;g=(f[t+(r*5640|0)+420>>2]|0)+1|0;l=e>>>0<257?1:2;m=ce(g,(l<<1)+5|0)|0;v=m+4|0;En(n,65375,2);En(n+2|0,m+2|0,2);if(!g){f[i>>2]=v;return}u=l+1|0;c=l+3|0;h=l|4;d=h+l|0;p=d+1|0;m=t+(r*5640|0)+8|0;o=a+4|0;s=0;n=n+4|0;a=t+(r*5640|0)+424|0;while(1){En(n,f[a>>2]|0,1);En(n+1|0,f[a+4>>2]|0,l);_=a+8|0;En(n+u|0,f[_>>2]|0,2);t=a+12|0;En(n+c|0,f[t>>2]|0,1);r=a+16|0;En(n+h|0,f[r>>2]|0,l);En(n+d|0,f[a+36>>2]|0,1);b=f[_>>2]|0;y=f[m>>2]|0;f[_>>2]=(b|0)<(y|0)?b:y;_=f[t>>2]|0;y=f[o>>2]|0;f[t>>2]=(_|0)<(y|0)?_:y;t=f[r>>2]|0;f[r>>2]=(t|0)<(e|0)?t:e;s=s+1|0;if((s|0)==(g|0))break;else{n=n+p|0;a=a+148|0}}f[i>>2]=v;return}function ao(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;var o=0,s=0,l=0,u=0,c=0,h=0;h=b;b=b+16|0;l=h+8|0;s=h;u=f[e+(t*5640|0)+5584>>2]|0;t=f[u+(r*1080|0)+24>>2]|0;do{if((t|0)!=1){e=(f[u+(r*1080|0)+4>>2]|0)*3|0;o=e+-2|0;if(!t){e=e+-1|0;if((f[i>>2]|0)>>>0<e>>>0){Jn(a,1,11515,s)|0;i=0;b=h;return i|0}else{En(n,f[u+(r*1080|0)+804>>2]<<5,1);if(!o)break;else t=0;do{n=n+1|0;En(n,f[u+(r*1080|0)+28+(t<<3)>>2]<<3,1);t=t+1|0}while((t|0)!=(o|0))}}else c=7}else{o=1;t=1;c=7}}while(0);if((c|0)==7){e=o<<1|1;if((f[i>>2]|0)>>>0<e>>>0){Jn(a,1,11515,l)|0;i=0;b=h;return i|0}En(n,(f[u+(r*1080|0)+804>>2]<<5)+t|0,1);if(o){n=n+1|0;t=0;while(1){En(n,(f[u+(r*1080|0)+28+(t<<3)>>2]<<11)+(f[u+(r*1080|0)+28+(t<<3)+4>>2]|0)|0,2);t=t+1|0;if((t|0)==(o|0))break;else n=n+2|0}}}f[i>>2]=(f[i>>2]|0)-e;i=1;b=h;return i|0}function oo(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+16|0;a=f[e+(t*5640|0)+5584>>2]|0;if((f[n>>2]|0)>>>0<5){Jn(i,1,11587,s)|0;n=0;b=s;return n|0}o=a+4|0;En(r,(f[o>>2]|0)+-1|0,1);En(r+1|0,(f[a+8>>2]|0)+-2|0,1);En(r+2|0,(f[a+12>>2]|0)+-2|0,1);En(r+3|0,f[a+16>>2]|0,1);En(r+4|0,f[a+20>>2]|0,1);t=(f[n>>2]|0)+-5|0;f[n>>2]=t;if(!(f[a>>2]&1)){n=1;b=s;return n|0}e=f[o>>2]|0;if(t>>>0<e>>>0){Jn(i,1,11587,s+8|0)|0;n=0;b=s;return n|0}if(!e)e=0;else{t=r+5|0;r=0;while(1){En(t,(f[a+944+(r<<2)>>2]<<4)+(f[a+812+(r<<2)>>2]|0)|0,1);r=r+1|0;e=f[o>>2]|0;if(r>>>0>=e>>>0)break;else t=t+1|0}t=f[n>>2]|0}f[n>>2]=t-e;n=1;b=s;return n|0}function so(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0;a=f[e+76>>2]|0;n=f[a+(r*5640|0)+4>>2]|0;i=696;while(1){u=f[i>>2]|0;if((u|0)==-1|(u|0)==(n|0))break;else i=i+12|0}if(!(h[e+93>>0]&8)){e=1;return e|0}u=p[e+92>>0]|0;o=a+(r*5640|0)+424+(t*148|0)+92|0;s=a+(r*5640|0)+424+(t*148|0)+88|0;l=a+(r*5640|0)+424+(t*148|0)+96|0;t=a+(r*5640|0)+424+(t*148|0)+84|0;a=h[i+4>>0]|0;switch(a|0){case 67:{n=f[o>>2]|0;break}case 82:{n=f[s>>2]|0;break}case 80:{n=f[l>>2]|0;break}case 76:{n=f[t>>2]|0;break}default:n=1}if((u|0)!=(a|0)){a=h[i+5>>0]|0;switch(a|0){case 67:{n=ce(f[o>>2]|0,n)|0;break}case 82:{n=ce(f[s>>2]|0,n)|0;break}case 80:{n=ce(f[l>>2]|0,n)|0;break}case 76:{n=ce(f[t>>2]|0,n)|0;break}default:{}}if((u|0)!=(a|0)){a=h[i+6>>0]|0;switch(a|0){case 67:{n=ce(f[o>>2]|0,n)|0;break}case 82:{n=ce(f[s>>2]|0,n)|0;break}case 80:{n=ce(f[l>>2]|0,n)|0;break}case 76:{n=ce(f[t>>2]|0,n)|0;break}default:{}}if((u|0)!=(a|0)){i=h[i+7>>0]|0;switch(i|0){case 67:{n=ce(f[o>>2]|0,n)|0;break}case 82:{n=ce(f[s>>2]|0,n)|0;break}case 80:{n=ce(f[l>>2]|0,n)|0;break}case 76:{n=ce(f[t>>2]|0,n)|0;break}default:{}}if((u|0)==(i|0))i=3;else{e=n;return e|0}}else i=2}else i=1}else i=0;f[e+84>>2]=i;e=n;return e|0}function lo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0;A=t+16|0;if(!(f[A>>2]|0)){A=1;return A|0}S=0;M=f[t+24>>2]|0;while(1){a=n+44|0;i=f[a>>2]|0;o=n+8|0;if(!i){t=n+12|0;i=qi(ce(f[t>>2]|0,f[o>>2]|0)|0,4)|0;f[a>>2]=i;if(!i){r=0;n=61;break}}else t=n+12|0;g=M+36|0;f[n+36>>2]=f[g>>2];x=f[M+24>>2]|0;_=f[e+24>>2]|0;g=f[g>>2]|0;x=((x&7|0)!=0&1)+(x>>>3)|0;x=(x|0)==3?4:x;l=f[_+(g*136|0)+8>>2]|0;s=f[_+(g*136|0)>>2]|0;E=l-s|0;y=f[_+(g*136|0)+12>>2]|0;g=f[_+(g*136|0)+4>>2]|0;_=y-g|0;a=f[n+16>>2]|0;c=f[n+40>>2]|0;u=Gl(1,0,c|0)|0;w=B;a=Wl(a|0,0,-1,-1)|0;a=Wl(a|0,B|0,u|0,w|0)|0;a=Xl(a|0,B|0,c|0)|0;v=Wl(f[n+20>>2]|0,0,-1,-1)|0;w=Wl(v|0,B|0,u|0,w|0)|0;c=Xl(w|0,B|0,c|0)|0;w=f[o>>2]|0;o=a+w|0;u=f[t>>2]|0;v=c+u|0;do{if(a>>>0<s>>>0){t=s-a|0;if(l>>>0>o>>>0){T=o-s|0;b=0;s=E-T|0;l=t}else{b=0;s=0;l=t;T=E}}else{t=a-s|0;if(l>>>0>o>>>0){b=t;s=l-o|0;l=0;T=w;break}else{b=t;s=0;l=0;T=E-t|0;break}}}while(0);do{if(c>>>0<g>>>0){o=g-c|0;if(y>>>0>v>>>0){a=v-g|0;u=a;t=0;a=_-a|0}else{u=_;t=0;a=0}}else{t=c-g|0;if(y>>>0>v>>>0){a=y-v|0;o=0;break}else{u=_-t|0;a=0;o=0;break}}}while(0);if((b|s|T|a|t|u|0)<0){r=0;n=61;break}t=(ce(t,E)|0)+b|0;g=b+s|0;v=(ce(a,E)|0)-b|0;c=w-T|0;i=i+((ce(w,o)|0)+l<<2)|0;switch(x|0){case 1:{r=r+t|0;t=(u|0)==0;if(!(f[M+32>>2]|0)){if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=p[i>>0];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+1|0}}t=o;r=r+T|0}r=r+g|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}}else if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=h[i>>0];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+1|0}}t=o;r=r+T|0}r=r+g|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}r=r+v|0;break}case 2:{r=r+(t<<1)|0;t=(u|0)==0;if(!(f[M+32>>2]|0)){if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=m[i>>1];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+2|0}}t=o;r=r+(T<<1)|0}r=r+(g<<1)|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}}else if(!t){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=d[i>>1];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+2|0}}t=o;r=r+(T<<1)|0}r=r+(g<<1)|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}r=r+(v<<1)|0;break}case 4:{r=r+(t<<2)|0;if(u){s=(T|0)==0;l=0;t=i;while(1){if(!s){o=t+(T<<2)|0;a=0;i=r;while(1){f[t>>2]=f[i>>2];a=a+1|0;if((a|0)==(T|0))break;else{t=t+4|0;i=i+4|0}}t=o;r=r+(T<<2)|0}r=r+(g<<2)|0;l=l+1|0;if((l|0)==(u|0))break;else t=t+(c<<2)|0}}r=r+(v<<2)|0;break}default:{}}S=S+1|0;if(S>>>0>=(f[A>>2]|0)>>>0){r=1;n=61;break}else{n=n+52|0;M=M+52|0;e=e+52|0}}if((n|0)==61)return r|0;return 0}function uo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0;M=b;b=b+112|0;x=M+88|0;_=M+80|0;E=M+72|0;y=M+64|0;m=M+56|0;d=M+48|0;l=M+40|0;o=M+32|0;a=M+24|0;i=M+16|0;g=M+100|0;v=M+96|0;w=M+92|0;f[v>>2]=0;T=e+200|0;if((r|0)!=8){Jn(n,1,8662,M)|0;Jn(n,1,8662,M+8|0)|0;n=0;b=M;return n|0}wn(t,T,2);wn(t+2|0,g,4);wn(t+6|0,w,1);wn(t+7|0,v,1);s=f[T>>2]|0;t=f[e+112>>2]|0;if(s>>>0>=(ce(f[e+116>>2]|0,t)|0)>>>0){f[i>>2]=s;Jn(n,1,15258,i)|0;n=0;b=M;return n|0}r=f[e+164>>2]|0;c=(s>>>0)%(t>>>0)|0;u=(s>>>0)/(t>>>0)|0;t=f[g>>2]|0;do{if((t+-1|0)>>>0<13){if((t|0)==12){f[a>>2]=12;Jn(n,2,15282,a)|0;t=f[g>>2]|0;break}f[o>>2]=t;Jn(n,1,15319,o)|0;n=0;b=M;return n|0}}while(0);if(!t){Jn(n,4,15380,l)|0;f[e+72>>2]=1}t=f[v>>2]|0;do{if(!t)t=f[r+(s*5640|0)+5588>>2]|0;else{t=((p[e+76>>0]|0)>>>4&1)+t|0;f[v>>2]=t;i=r+(s*5640|0)+5588|0;a=f[i>>2]|0;r=f[w>>2]|0;if((a+-1|0)>>>0<r>>>0){f[d>>2]=r;f[d+4>>2]=a;Jn(n,1,15491,d)|0;f[e+72>>2]=1;n=0;b=M;return n|0}if(r>>>0<t>>>0){f[i>>2]=t;break}f[m>>2]=r;f[m+4>>2]=t;Jn(n,1,15590,m)|0;f[e+72>>2]=1;n=0;b=M;return n|0}}while(0);if((t|0)!=0?(t|0)==((f[w>>2]|0)+1|0):0){m=e+76|0;h[m>>0]=h[m>>0]|1}f[e+24>>2]=(f[e+72>>2]|0)==0?(f[g>>2]|0)+-12|0:0;f[e+8>>2]=16;t=f[e+60>>2]|0;if((t|0)==-1){if((c>>>0>=(f[e+28>>2]|0)>>>0?c>>>0<(f[e+36>>2]|0)>>>0:0)?u>>>0>=(f[e+32>>2]|0)>>>0:0)t=(u>>>0>=(f[e+40>>2]|0)>>>0&1)<<2&255;else t=4;g=e+76|0;h[g>>0]=h[g>>0]&-5|t}else{g=e+76|0;h[g>>0]=((f[T>>2]|0)!=(t|0)&1)<<2&255|h[g>>0]&-5}o=e+196|0;t=f[o>>2]|0;if(!t){n=1;b=M;return n|0}a=f[T>>2]|0;t=f[t+40>>2]|0;f[t+(a*40|0)>>2]=a;f[t+(a*40|0)+12>>2]=f[w>>2];r=f[v>>2]|0;if(r){f[t+(a*40|0)+4>>2]=r;f[t+(a*40|0)+8>>2]=f[v>>2];t=f[t+(a*40|0)+16>>2]|0;if(!t){x=qi(f[v>>2]|0,24)|0;f[(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16>>2]=x;if(x){n=1;b=M;return n|0}Jn(n,1,15698,y)|0;n=0;b=M;return n|0}t=Qi(t,(f[v>>2]|0)*24|0)|0;r=(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16|0;if(!t){Ji(f[r>>2]|0);f[(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16>>2]=0;Jn(n,1,15698,E)|0;n=0;b=M;return n|0}else{f[r>>2]=t;n=1;b=M;return n|0}}if(!(f[t+(a*40|0)+16>>2]|0)){f[t+(a*40|0)+8>>2]=10;E=qi(10,24)|0;r=f[T>>2]|0;t=f[(f[o>>2]|0)+40>>2]|0;f[t+(r*40|0)+16>>2]=E;if(!E){f[t+(r*40|0)+8>>2]=0;Jn(n,1,15698,_)|0;n=0;b=M;return n|0}else a=r}r=f[w>>2]|0;i=t+(a*40|0)+8|0;if(r>>>0<(f[i>>2]|0)>>>0){n=1;b=M;return n|0}r=r+1|0;f[i>>2]=r;t=Qi(f[t+(a*40|0)+16>>2]|0,r*24|0)|0;r=(f[(f[o>>2]|0)+40>>2]|0)+((f[T>>2]|0)*40|0)+16|0;if(!t){Ji(f[r>>2]|0);T=f[T>>2]|0;w=f[(f[o>>2]|0)+40>>2]|0;f[w+(T*40|0)+16>>2]=0;f[w+(T*40|0)+8>>2]=0;Jn(n,1,15698,x)|0;n=0;b=M;return n|0}else{f[r>>2]=t;n=1;b=M;return n|0}return 0}function co(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+64|0;p=v+48|0;m=v+40|0;s=v+32|0;c=v+56|0;o=v+52|0;f[c>>2]=r;g=e+80|0;l=f[g>>2]|0;d=e+8|0;if((f[d>>2]|0)==16)u=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else u=f[e+12>>2]|0;i=u+5636|0;a=h[i>>0]|0;if(a&1){Jn(n,1,15025,v)|0;g=0;b=v;return g|0}h[i>>0]=a|1;if(r>>>0<5){Jn(n,1,15089,v+8|0)|0;g=0;b=v;return g|0}wn(t,u,1);if((f[u>>2]|0)>>>0>7){Jn(n,1,15115,v+16|0)|0;g=0;b=v;return g|0}wn(t+1|0,o,1);o=f[o>>2]|0;i=u+4|0;f[i>>2]=o;if((o|0)>4){Jn(n,1,15149,v+24|0)|0;f[i>>2]=-1}i=u+8|0;wn(t+2|0,i,2);i=f[i>>2]|0;if((i+-1|0)>>>0>65534){f[s>>2]=i;Jn(n,1,15190,s)|0;g=0;b=v;return g|0}s=f[e+172>>2]|0;f[u+12>>2]=(s|0)==0?i:s;wn(t+4|0,u+16|0,1);s=t+5|0;f[c>>2]=r+-5;o=f[l+16>>2]|0;if(o){t=f[u>>2]&1;i=f[u+5584>>2]|0;a=0;do{f[i+(a*1080|0)>>2]=t;a=a+1|0}while(a>>>0<o>>>0)}if(!(At(e,0,s,c,n)|0)){Jn(n,1,15089,m)|0;g=0;b=v;return g|0}if(f[c>>2]|0){Jn(n,1,15089,p)|0;g=0;b=v;return g|0}if((f[d>>2]|0)==16)i=(f[e+164>>2]|0)+((f[e+200>>2]|0)*5640|0)|0;else i=f[e+12>>2]|0;i=f[i+5584>>2]|0;r=i+4|0;a=f[r>>2]|0;u=a<<2;if((f[(f[g>>2]|0)+16>>2]|0)>>>0<=1){g=1;b=v;return g|0}c=i+8|0;d=i+12|0;e=i+16|0;n=i+20|0;p=i+812|0;m=i+944|0;f[i+1084>>2]=a;o=f[c>>2]|0;f[i+1088>>2]=o;t=f[d>>2]|0;f[i+1092>>2]=t;s=f[e>>2]|0;f[i+1096>>2]=s;l=f[n>>2]|0;f[i+1100>>2]=l;Yl(i+1892|0,p|0,u|0)|0;Yl(i+2024|0,m|0,u|0)|0;if((f[(f[g>>2]|0)+16>>2]|0)>>>0<=2){g=1;b=v;return g|0}f[i+2164>>2]=a;f[i+2168>>2]=o;f[i+2172>>2]=t;f[i+2176>>2]=s;f[i+2180>>2]=l;Yl(i+2972|0,p|0,u|0)|0;Yl(i+3104|0,m|0,u|0)|0;if((f[(f[g>>2]|0)+16>>2]|0)>>>0>3)a=3;else{g=1;b=v;return g|0}while(1){o=f[c>>2]|0;t=f[d>>2]|0;s=f[e>>2]|0;l=f[n>>2]|0;f[i+3244>>2]=f[r>>2];f[i+3248>>2]=o;f[i+3252>>2]=t;f[i+3256>>2]=s;f[i+3260>>2]=l;Yl(i+4052|0,p|0,u|0)|0;Yl(i+4184|0,m|0,u|0)|0;a=a+1|0;if(a>>>0>=(f[(f[g>>2]|0)+16>>2]|0)>>>0){i=1;break}else i=i+1080|0}b=v;return i|0}function ho(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;_=b;b=b+272|0;h=_;v=_+136|0;y=_+8|0;if(!e){y=0;b=_;return y|0}c=e+4|0;if((f[e>>2]|0)==(t|0)?(f[c>>2]|0)==(r|0):0)i=e+8|0;else{f[e>>2]=t;f[c>>2]=r;f[v>>2]=t;f[y>>2]=r;i=e+8|0;f[i>>2]=0;a=0;s=r;l=t;u=0;while(1){g=ce(s,l)|0;l=(l+1|0)/2|0;o=u+1|0;f[v+(o<<2)>>2]=l;s=(s+1|0)/2|0;f[y+(o<<2)>>2]=s;a=a+g|0;if(g>>>0<=1)break;else u=o}f[i>>2]=a;if(!a){i=e+12|0;a=f[i>>2]|0;if(a){Ji(a);f[i>>2]=0}Ji(e);y=0;b=_;return y|0}o=a<<4;s=e+16|0;l=e+12|0;do{if(o>>>0>(f[s>>2]|0)>>>0){a=Qi(f[l>>2]|0,o)|0;if(a){f[l>>2]=a;r=f[s>>2]|0;Vl(a+r|0,0,o-r|0)|0;f[s>>2]=o;r=f[c>>2]|0;t=f[e>>2]|0;break}Jn(n,1,20166,h)|0;i=f[l>>2]|0;if(i){Ji(i);f[l>>2]=0}Ji(e);y=0;b=_;return y|0}}while(0);a=f[l>>2]|0;t=a+((ce(r,t)|0)<<4)|0;if(u){g=0;r=t;do{p=f[y+(g<<2)>>2]|0;e:do{if((p|0)>0){m=f[v+(g<<2)>>2]|0;if((m|0)<=0){o=p+-1|0;s=0;while(1){d=(s&1|0)!=0|(s|0)==(o|0);l=d?r:t+(m<<4)|0;r=d?r:t;s=s+1|0;if((s|0)>=(p|0)){t=l;break e}else t=l}}d=((m+2+((m|0)<2?~m:-3)|0)>>>1)+1|0;n=p+-1|0;h=0;while(1){c=m;l=r;while(1){f[a>>2]=l;o=a+16|0;s=c;c=c+-2|0;if((c|0)>-1){f[o>>2]=l;a=a+32|0}else a=o;if((s|0)<=2)break;else l=l+16|0}r=r+(d<<4)|0;c=(h&1|0)!=0|(h|0)==(n|0);o=c?r:t+(m<<4)|0;r=c?r:t;h=h+1|0;if((h|0)>=(p|0)){t=o;break}else t=o}}}while(0);g=g+1|0}while((g|0)!=(u|0))}f[a>>2]=0}i=f[i>>2]|0;if(!i){y=e;b=_;return y|0}a=0;t=f[e+12>>2]|0;while(1){f[t+4>>2]=999;f[t+8>>2]=0;f[t+12>>2]=0;a=a+1|0;if((a|0)==(i|0))break;else t=t+16|0}b=_;return e|0}function fo(e){e=e|0;var t=0,r=0;if(!e)return;t=e+12|0;r=f[t>>2]|0;if(r){Ji(r);f[t>>2]=0}Ji(e);return}function po(e,t,r){e=e|0;t=t|0;r=r|0;t=(f[e+12>>2]|0)+(t<<4)|0;if(!t)return;while(1){e=t+4|0;if((f[e>>2]|0)<=(r|0)){t=4;break}f[e>>2]=r;t=f[t>>2]|0;if(!t){t=4;break}}if((t|0)==4)return}function mo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+128|0;s=l;r=(f[t+12>>2]|0)+(r<<4)|0;if(!(f[r>>2]|0)){i=0;a=s}else{i=r;t=s;while(1){a=t+4|0;f[t>>2]=r;r=f[i>>2]|0;if(!(f[r>>2]|0)){i=0;break}else{i=r;t=a}}}while(1){o=r+8|0;t=f[o>>2]|0;if((i|0)>(t|0)){f[o>>2]=i;t=i}e:do{if((t|0)<(n|0)){i=r+4|0;while(1){if((t|0)>=(f[i>>2]|0))break;Ro(e,0,1);t=t+1|0;if((t|0)>=(n|0)){r=t;break e}}r=r+12|0;if(!(f[r>>2]|0)){Ro(e,1,1);f[r>>2]=1;r=t}else r=t}else r=t}while(0);f[o>>2]=r;if((a|0)==(s|0))break;o=a+-4|0;i=r;r=f[o>>2]|0;a=o}b=l;return}function go(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0;l=b;b=b+128|0;s=l;r=(f[t+12>>2]|0)+(r<<4)|0;if(!(f[r>>2]|0)){t=0;a=s}else{i=r;t=s;while(1){a=t+4|0;f[t>>2]=r;r=f[i>>2]|0;if(!(f[r>>2]|0)){t=0;break}else{i=r;t=a}}}while(1){o=r+8|0;i=f[o>>2]|0;if((t|0)>(i|0))f[o>>2]=t;else t=i;r=r+4|0;e:do{if((t|0)<(n|0)){while(1){if((t|0)>=(f[r>>2]|0))break e;if(ko(e,1)|0)break;t=t+1|0;if((t|0)>=(n|0))break e}f[r>>2]=t}}while(0);f[o>>2]=t;if((a|0)==(s|0))break;o=a+-4|0;r=f[o>>2]|0;a=o}b=l;return(f[r>>2]|0)<(n|0)|0}function vo(){var e=0,t=0;e=qi(1,12)|0;if(!e){e=0;return e|0}f[e+4>>2]=10;t=qi(10,4)|0;f[e+8>>2]=t;if(t){t=e;return t|0}Ji(e);t=0;return t|0}function yo(e){e=e|0;var t=0;if(!e)return;t=f[e+8>>2]|0;if(t)Ji(t);Ji(e);return}function _o(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;s=b;b=b+16|0;o=s;a=e+4|0;i=f[a>>2]|0;n=f[e>>2]|0;do{if((i|0)==(n|0)){i=i+10|0;f[a>>2]=i;n=e+8|0;i=Qi(f[n>>2]|0,i<<2)|0;if(i){f[n>>2]=i;n=f[e>>2]|0;break}Ji(f[n>>2]|0);f[a>>2]=0;f[e>>2]=0;Jn(r,1,20214,o)|0;e=0;b=s;return e|0}else i=f[e+8>>2]|0}while(0);f[i+(n<<2)>>2]=t;f[e>>2]=n+1;e=1;b=s;return e|0}function bo(e){e=e|0;return f[e>>2]|0}function Eo(e){e=e|0;return f[e+8>>2]|0}function wo(e){e=e|0;f[e>>2]=0;return}function xo(){return Yi(20)|0}function To(e){e=e|0;if(!e)return;Ji(e);return}function Mo(e){e=e|0;return(f[e+8>>2]|0)-(f[e>>2]|0)|0}function So(e,t,r){e=e|0;t=t|0;r=r|0;f[e>>2]=t;f[e+4>>2]=t+r;f[e+8>>2]=t;f[e+12>>2]=0;f[e+16>>2]=8;return}function Ao(e,t,r){e=e|0;t=t|0;r=r|0;f[e>>2]=t;f[e+4>>2]=t+r;f[e+8>>2]=t;f[e+12>>2]=0;f[e+16>>2]=0;return}function Ro(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;if(!r)return;l=e+16|0;u=e+12|0;c=e+8|0;a=e+4|0;e=f[l>>2]|0;s=r+-1|0;do{o=t>>>s&1;if(!e){i=f[u>>2]|0;e=i<<8&65280;f[u>>2]=e;e=(e|0)==65280?7:8;f[l>>2]=e;n=f[c>>2]|0;if(n>>>0<(f[a>>2]|0)>>>0){f[c>>2]=n+1;h[n>>0]=i;e=f[l>>2]|0}}e=e+-1|0;f[l>>2]=e;f[u>>2]=o<<e|f[u>>2];s=s+-1|0}while(s>>>0<r>>>0);return}function ko(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0;if(!t){t=0;return t|0}s=e+16|0;l=e+12|0;u=e+8|0;a=e+4|0;r=f[s>>2]|0;n=f[l>>2]|0;o=t+-1|0;e=0;do{if(!r){i=n<<8&65280;f[l>>2]=i;r=(i|0)==65280?7:8;f[s>>2]=r;n=f[u>>2]|0;if(n>>>0<(f[a>>2]|0)>>>0){f[u>>2]=n+1;n=p[n>>0]|0|i;f[l>>2]=n}else n=i}r=r+-1|0;f[s>>2]=r;e=((n>>>r&1)<<o)+e|0;o=o+-1|0}while(o>>>0<t>>>0);return e|0}function Po(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;n=e+12|0;t=f[n>>2]|0;o=t<<8&65280;f[n>>2]=o;i=e+16|0;f[i>>2]=(o|0)==65280?7:8;o=e+8|0;r=f[o>>2]|0;a=e+4|0;if(r>>>0>=(f[a>>2]|0)>>>0){o=0;return o|0}f[o>>2]=r+1;h[r>>0]=t;if((f[i>>2]|0)!=7){o=1;return o|0}t=f[n>>2]|0;e=t<<8&65280;f[n>>2]=e;f[i>>2]=(e|0)==65280?7:8;e=f[o>>2]|0;if(e>>>0>=(f[a>>2]|0)>>>0){o=0;return o|0}f[o>>2]=e+1;h[e>>0]=t;o=1;return o|0}function Lo(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=e+12|0;t=f[a>>2]|0;do{if((t&255|0)==255){n=t<<8&65280;f[a>>2]=n;t=e+16|0;f[t>>2]=(n|0)==65280?7:8;i=e+8|0;r=f[i>>2]|0;if(r>>>0<(f[e+4>>2]|0)>>>0){f[i>>2]=r+1;f[a>>2]=p[r>>0]|0|n;break}else{e=0;return e|0}}else t=e+16|0}while(0);f[t>>2]=0;e=1;return e|0}function Co(e){e=e|0;return jo(e,1)|0}function Io(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0;k=b;b=b+32|0;A=k+16|0;R=k;l=f[e+24>>2]|0;s=(f[l+8>>2]|0)-(f[l>>2]|0)|0;o=(f[l+12>>2]|0)-(f[l+4>>2]|0)|0;S=(f[e+8>>2]|0)-(f[e>>2]|0)|0;if((t|0)==1){R=1;b=k;return R|0}a=t+-1|0;i=(a|0)==0;if(i)t=0;else{r=l;n=a;t=0;do{M=r;r=r+136|0;T=(f[M+144>>2]|0)-(f[r>>2]|0)|0;t=t>>>0<T>>>0?T:t;M=(f[M+148>>2]|0)-(f[M+140>>2]|0)|0;t=t>>>0<M>>>0?M:t;n=n+-1|0}while((n|0)!=0);t=t<<2}M=Zi(t)|0;f[A>>2]=M;if(!M){R=0;b=k;return R|0}f[R>>2]=M;if(!i){v=e+32|0;y=A+8|0;_=R+8|0;E=A+4|0;w=A+12|0;x=R+4|0;T=R+12|0;do{m=f[v>>2]|0;h=l;l=l+136|0;f[y>>2]=s;f[_>>2]=o;d=f[h+144>>2]|0;p=f[l>>2]|0;n=s;s=d-p|0;t=f[h+148>>2]|0;h=h+140|0;g=f[h>>2]|0;r=o;o=t-g|0;f[E>>2]=s-n;f[w>>2]=(p|0)%2|0;g=(t|0)==(g|0);if(!g){c=s<<2;t=0;while(1){e=ce(t,S)|0;u=m+(e<<2)|0;if(n){r=u;i=M+(f[w>>2]<<2)|0;while(1){n=n+-1|0;f[i>>2]=f[r>>2];if(!n)break;else{r=r+4|0;i=i+8|0}}}r=f[E>>2]|0;if(r){n=m+((f[y>>2]|0)+e<<2)|0;i=M+(1-(f[w>>2]|0)<<2)|0;while(1){r=r+-1|0;f[i>>2]=f[n>>2];if(!r)break;else{n=n+4|0;i=i+8|0}}}Vo(A);Yl(u|0,M|0,c|0)|0;t=t+1|0;if((t|0)==(o|0))break;n=f[y>>2]|0}r=f[_>>2]|0;t=f[h>>2]|0}f[x>>2]=o-r;f[T>>2]=(t|0)%2|0;e:do{if((d|0)!=(p|0)){t=0;while(1){if(r){n=m+(t<<2)|0;i=M+(f[T>>2]<<2)|0;while(1){r=r+-1|0;f[i>>2]=f[n>>2];if(!r)break;else{n=n+(S<<2)|0;i=i+8|0}}}r=f[x>>2]|0;if(r){n=m+((ce(f[_>>2]|0,S)|0)+t<<2)|0;i=M+(1-(f[T>>2]|0)<<2)|0;while(1){r=r+-1|0;f[i>>2]=f[n>>2];if(!r)break;else{n=n+(S<<2)|0;i=i+8|0}}}Vo(R);if(!g){r=0;do{p=m+((ce(r,S)|0)+t<<2)|0;f[p>>2]=f[M+(r<<2)>>2];r=r+1|0}while((r|0)!=(o|0))}t=t+1|0;if((t|0)==(s|0))break e;r=f[_>>2]|0}}}while(0);a=a+-1|0}while((a|0)!=0)}Ki(M);R=1;b=k;return R|0}function Ho(e){e=e|0;if(!e){e=0;return e|0}e=(e+-1|0)>>>0<2?1:2;return e|0}function Oo(e,t){e=e|0;t=t|0;return+ +y[56+(t*80|0)+(e<<3)>>3]}function Do(e){e=e|0;return jo(e,2)|0}function Fo(e){e=e|0;return 0}function No(e,t){e=e|0;t=t|0;return+ +y[376+(t*80|0)+(e<<3)>>3]}function Uo(e,t){e=e|0;t=t|0;var r=0.0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;l=e+4|0;u=((f[l>>2]|0)*3|0)+-2|0;if(!u)return;c=e+20|0;h=e+24|0;d=0;do{if(!d){n=0;i=0}else{i=d+-1|0;n=((i>>>0)/3|0)+1|0;i=((i>>>0)%3|0)+1|0}if((i|0)==0|(f[c>>2]|0)==0)a=0;else a=(i+-1|0)>>>0<2?1:2;if(!(f[h>>2]|0))r=1.0;else r=+(1<<a|0)/+y[376+(i*80|0)+((f[l>>2]|0)+~n<<3)>>3];s=~~+K(+(r*8192.0));o=a+t|0;if((s|0)>1){n=s;i=0;while(1){n=n>>1;if((n|0)<=1)break;else i=i+1|0}a=s;n=0;do{a=a>>1;n=n+1|0}while((a|0)>1);i=i+-12|0}else{i=-13;n=0}a=11-n|0;f[e+28+(d<<3)+4>>2]=((a|0)<0?s>>0-a:s<<a)&2047;f[e+28+(d<<3)>>2]=o-i;d=d+1|0}while((d|0)!=(u|0));return}function Bo(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0;W=b;b=b+32|0;j=W+16|0;V=W;c=f[e+24>>2]|0;h=f[c+8>>2]|0;d=f[c>>2]|0;l=f[c+12>>2]|0;u=f[c+4>>2]|0;z=e+8|0;o=f[z>>2]|0;s=f[e>>2]|0;B=o-s|0;a=t+-1|0;i=(a|0)==0;if(i)t=80;else{r=c;n=a;t=0;do{U=r;r=r+136|0;N=(f[U+144>>2]|0)-(f[r>>2]|0)|0;t=t>>>0<N>>>0?N:t;U=(f[U+148>>2]|0)-(f[U+140>>2]|0)|0;t=t>>>0<U>>>0?U:t;n=n+-1|0}while((n|0)!=0);t=(t<<4)+80|0}U=Zi(t)|0;f[j>>2]=U;if(!U){G=0;b=W;return G|0}f[V>>2]=U;e:do{if(!i){T=e+32|0;M=e+12|0;S=e+4|0;A=j+8|0;R=V+8|0;k=j+4|0;P=j+12|0;L=V+4|0;C=V+12|0;I=B<<1;H=B<<2;O=B*3|0;F=s<<2;N=o<<2;D=F-N|0;F=N-F|0;N=o-s<<2;t=a;r=U;a=o;n=s;g=l-u|0;i=c;o=h-d|0;while(1){v=f[T>>2]|0;n=ce((f[M>>2]|0)-(f[S>>2]|0)|0,a-n|0)|0;f[A>>2]=o;f[R>>2]=g;w=i+136|0;p=f[i+144>>2]|0;m=f[w>>2]|0;x=p-m|0;_=f[i+148>>2]|0;h=i+140|0;y=f[h>>2]|0;E=_-y|0;f[k>>2]=x-o;f[P>>2]=(m|0)%2|0;if((E|0)>3){a=(x|0)>0;o=(_+-4-y|0)>>>2;c=ce(D,o)|0;o=v+(F+(ce(N,o)|0)<<2)|0;s=v;l=n;u=E;while(1){Wo(j,s,B,l);Xo(j);if(a){i=x;do{d=i;i=i+-1|0;f[s+(i<<2)>>2]=f[U+(i<<4)>>2];f[s+(i+B<<2)>>2]=f[U+(i<<4)+4>>2];f[s+(i+I<<2)>>2]=f[U+(i<<4)+8>>2];f[s+(i+O<<2)>>2]=f[U+(i<<4)+12>>2]}while((d|0)>1)}u=u+-4|0;if((u|0)<=3)break;else{s=s+(H<<2)|0;l=l-H|0}}n=D+n+c|0}else o=v;a=E&3;t:do{if(!a)G=21;else{Wo(j,o,B,n);Xo(j);if((x|0)>0)n=x;else{l=E-g|0;f[L>>2]=l;a=(f[h>>2]|0)%2|0;f[C>>2]=a;u=g;s=v;break}while(1){i=n;n=n+-1|0;switch(a|0){case 3:{f[o+(n+I<<2)>>2]=f[U+(n<<4)+8>>2];G=18;break}case 2:{G=18;break}case 1:{G=19;break}default:{}}if((G|0)==18){f[o+(n+B<<2)>>2]=f[U+(n<<4)+4>>2];G=19}if((G|0)==19){G=0;f[o+(n<<2)>>2]=f[U+(n<<4)>>2]}if((i|0)<=1){G=21;break t}}}}while(0);if((G|0)==21){G=0;l=E-g|0;f[L>>2]=l;a=(f[h>>2]|0)%2|0;f[C>>2]=a;if((x|0)>3){d=(_|0)==(y|0);p=p+-4-m|0;h=f[R>>2]|0;u=(h|0)>0;s=1-a|0;c=(l|0)>0;i=v;o=x;while(1){if(u){n=0;do{g=r+((n<<1)+a<<4)|0;m=i+((ce(n,B)|0)<<2)|0;f[g>>2]=f[m>>2];f[g+4>>2]=f[m+4>>2];f[g+8>>2]=f[m+8>>2];f[g+12>>2]=f[m+12>>2];n=n+1|0}while((n|0)!=(h|0))}if(c){n=0;do{g=r+(s+(n<<1)<<4)|0;m=i+((ce(n+h|0,B)|0)<<2)|0;f[g>>2]=f[m>>2];f[g+4>>2]=f[m+4>>2];f[g+8>>2]=f[m+8>>2];f[g+12>>2]=f[m+12>>2];n=n+1|0}while((n|0)!=(l|0))}Xo(V);if(!d){r=f[V>>2]|0;n=0;do{g=i+((ce(n,B)|0)<<2)|0;m=r+(n<<4)|0;f[g>>2]=f[m>>2];f[g+4>>2]=f[m+4>>2];f[g+8>>2]=f[m+8>>2];f[g+12>>2]=f[m+12>>2];n=n+1|0}while((n|0)!=(E|0))}o=o+-4|0;if((o|0)<=3)break;else i=i+16|0}u=h;s=v+((p+4&-4)<<2)|0}else{u=g;s=v}}o=x&3;if(o){r=f[V>>2]|0;if((u|0)>0){n=o<<2;i=0;do{Yl(r+((i<<1)+a<<4)|0,s+((ce(i,B)|0)<<2)|0,n|0)|0;i=i+1|0}while((i|0)!=(u|0))}n=1-a|0;if((l|0)>0){i=o<<2;a=0;do{Yl(r+(n+(a<<1)<<4)|0,s+((ce(a+u|0,B)|0)<<2)|0,i|0)|0;a=a+1|0}while((a|0)!=(l|0))}Xo(V);if((_|0)!=(y|0)){n=o<<2;i=0;do{Yl(s+((ce(i,B)|0)<<2)|0,r+(i<<4)|0,n|0)|0;i=i+1|0}while((i|0)!=(E|0))}}t=t+-1|0;if(!t)break e;a=f[z>>2]|0;n=f[e>>2]|0;g=E;i=w;o=x}}}while(0);Ki(U);G=1;b=W;return G|0}function zo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;if(!n){n=(t|0)>0;if(!(n|(r|0)>1))return;if(n){n=e+((r<<1)+-2<<2)|0;i=0;do{l=i;i=i+1|0;u=e+((l<<1|1)<<2)|0;f[u>>2]=(f[u>>2]|0)-((f[((i|0)<(r|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((l|0)<(r|0)?e+(l<<1<<2)|0:n)>>2]|0)>>1)}while((i|0)!=(t|0))}if((r|0)<=0)return;i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)n=i;else n=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;u=e+(o<<1<<2)|0;f[u>>2]=((f[n>>2]|0)+2+(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)>>2)+(f[u>>2]|0);o=o+1|0}while((o|0)!=(r|0));return}if((t|0)==1&(r|0)==0){f[e>>2]=f[e>>2]<<1;return}if((t|0)>0){i=e+4|0;a=(r<<1)+-1|0;o=e+(a<<2)|0;u=0;do{s=u<<1;l=f[e+(((u|0)<(r|0)?s|1:a)<<2)>>2]|0;if((u|0)>=1)if((u|0)>(r|0))n=o;else n=e+(s+-1<<2)|0;else n=i;s=e+(s<<2)|0;f[s>>2]=(f[s>>2]|0)-((f[n>>2]|0)+l>>1);u=u+1|0}while((u|0)!=(t|0))}if((r|0)<=0)return;n=e+((t<<1)+-2<<2)|0;i=0;do{l=i;i=i+1|0;u=e+((l<<1|1)<<2)|0;f[u>>2]=((f[((l|0)<(t|0)?e+(l<<1<<2)|0:n)>>2]|0)+2+(f[((i|0)<(t|0)?e+(i<<1<<2)|0:n)>>2]|0)>>2)+(f[u>>2]|0)}while((i|0)!=(r|0));return}function jo(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0;w=(f[e+8>>2]|0)-(f[e>>2]|0)|0;a=f[e+16>>2]|0;s=a+-1|0;x=f[e+32>>2]|0;o=f[e+24>>2]|0;i=(s|0)==0;if(i)e=0;else{r=o;n=s;e=0;do{E=r;r=r+136|0;b=(f[E+144>>2]|0)-(f[r>>2]|0)|0;e=e>>>0<b>>>0?b:e;E=(f[E+148>>2]|0)-(f[E+140>>2]|0)|0;e=e>>>0<E>>>0?E:e;n=n+-1|0}while((n|0)!=0);e=e<<2}E=Yi(e)|0;if(!((e|0)==0|(E|0)!=0)){t=0;return t|0}if(!i){_=a+-2|0;b=_;e=o+(s*136|0)|0;_=o+(_*136|0)|0;while(1){g=f[e>>2]|0;y=(f[e+8>>2]|0)-g|0;h=f[e+4>>2]|0;p=(f[e+12>>2]|0)-h|0;m=(f[_+8>>2]|0)-(f[_>>2]|0)|0;e=f[_+12>>2]|0;r=f[_+4>>2]|0;c=e-r|0;g=g&1;h=h&1;d=p-c|0;v=(y|0)>0;e:do{if(v){i=(e|0)==(r|0);s=(p|0)==(c|0);l=E+((h^1)<<2)|0;u=ce(c,w)|0;o=E+(h<<2)|0;if((p|0)>0){a=0;while(1){r=x+(a<<2)|0;e=0;do{n=x+((ce(e,w)|0)+a<<2)|0;f[E+(e<<2)>>2]=f[n>>2];e=e+1|0}while((e|0)!=(p|0));Bu[t&3](E,d,c,h);if(!i){n=c;e=o;while(1){n=n+-1|0;f[r>>2]=f[e>>2];if(!n)break;else{r=r+(w<<2)|0;e=e+8|0}}}if(!s){e=d;r=x+(a+u<<2)|0;n=l;while(1){e=e+-1|0;f[r>>2]=f[n>>2];if(!e)break;else{r=r+(w<<2)|0;n=n+8|0}}}a=a+1|0;if((a|0)==(y|0))break e}}if(i){r=0;while(1){Bu[t&3](E,d,c,h);if(!s){e=d;n=x+(r+u<<2)|0;i=l;while(1){e=e+-1|0;f[n>>2]=f[i>>2];if(!e)break;else{n=n+(w<<2)|0;i=i+8|0}}}r=r+1|0;if((r|0)==(y|0))break e}}else i=0;do{Bu[t&3](E,d,c,h);e=c;r=x+(i<<2)|0;n=o;while(1){e=e+-1|0;f[r>>2]=f[n>>2];if(!e)break;else{r=r+(w<<2)|0;n=n+8|0}}if(!s){e=d;r=x+(i+u<<2)|0;n=l;while(1){e=e+-1|0;f[r>>2]=f[n>>2];if(!e)break;else{r=r+(w<<2)|0;n=n+8|0}}}i=i+1|0}while((i|0)!=(y|0))}}while(0);a=y-m|0;if((p|0)>0){o=(m|0)>0;s=E+(g<<2)|0;l=(a|0)>0;u=E+((g^1)<<2)|0;c=0;do{i=ce(c,w)|0;r=x+(i<<2)|0;if(v){e=0;do{f[E+(e<<2)>>2]=f[x+(e+i<<2)>>2];e=e+1|0}while((e|0)!=(y|0))}Bu[t&3](E,a,m,g);if(o){n=0;e=s;while(1){f[r>>2]=f[e>>2];n=n+1|0;if((n|0)==(m|0))break;else{r=r+4|0;e=e+8|0}}}if(l){n=0;e=x+(i+m<<2)|0;r=u;while(1){f[e>>2]=f[r>>2];n=n+1|0;if((n|0)==(a|0))break;else{e=e+4|0;r=r+8|0}}}c=c+1|0}while((c|0)!=(p|0))}if(!b)break;else{e=_;b=b+-1|0;_=_+-136|0}}}Ji(E);t=1;return t|0}function Vo(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0;s=f[e>>2]|0;l=f[e+4>>2]|0;u=f[e+8>>2]|0;if(!(f[e+12>>2]|0)){n=(l|0)>0;if(!(n|(u|0)>1))return;if((u|0)>0){t=s+4|0;r=(l<<1)+-1|0;i=0;do{if((i|0)<1)e=t;else e=s+((((i|0)>(l|0)?l:i)<<1)+-1<<2)|0;a=i<<1;o=s+(a<<2)|0;f[o>>2]=(f[o>>2]|0)-((f[e>>2]|0)+2+(f[s+(((i|0)<(l|0)?a|1:r)<<2)>>2]|0)>>2);i=i+1|0}while((i|0)!=(u|0))}if(!n)return;e=s+((u<<1)+-2<<2)|0;t=0;do{a=t<<1;i=t;t=t+1|0;o=s+((a|1)<<2)|0;f[o>>2]=((f[((t|0)<(u|0)?s+(t<<1<<2)|0:e)>>2]|0)+(f[((i|0)<(u|0)?s+(a<<2)|0:e)>>2]|0)>>1)+(f[o>>2]|0)}while((t|0)!=(l|0));return}if((l|0)==1&(u|0)==0){f[s>>2]=(f[s>>2]|0)/2|0;return}if((u|0)>0){e=s+((l<<1)+-2<<2)|0;t=0;do{a=t<<1;i=t;t=t+1|0;o=s+((a|1)<<2)|0;f[o>>2]=(f[o>>2]|0)-((f[((i|0)<(l|0)?s+(a<<2)|0:e)>>2]|0)+2+(f[((t|0)<(l|0)?s+(t<<1<<2)|0:e)>>2]|0)>>2)}while((t|0)!=(u|0))}if((l|0)<=0)return;t=s+4|0;r=(u<<1)+-1|0;n=s+(r<<2)|0;o=0;do{i=o<<1;a=f[s+(((o|0)<(u|0)?i|1:r)<<2)>>2]|0;if((o|0)>=1)if((o|0)>(u|0))e=n;else e=s+(i+-1<<2)|0;else e=t;i=s+(i<<2)|0;f[i>>2]=((f[e>>2]|0)+a>>1)+(f[i>>2]|0);o=o+1|0}while((o|0)!=(l|0));return}function Go(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0;if(!n){l=(t|0)>0;if(!(l|(r|0)>1))return;if(l){n=e+((r<<1)+-2<<2)|0;i=0;do{h=i;i=i+1|0;c=(f[((i|0)<(r|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((h|0)<(r|0)?e+(h<<1<<2)|0:n)>>2]|0)|0;c=Jl(c|0,((c|0)<0)<<31>>31|0,12993,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+((h<<1|1)<<2)|0;f[h>>2]=(f[h>>2]|0)-c}while((i|0)!=(t|0))}s=(r|0)>0;if(s){i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)n=i;else n=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;c=(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)+(f[n>>2]|0)|0;c=Jl(c|0,((c|0)<0)<<31>>31|0,434,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+(o<<1<<2)|0;f[h>>2]=(f[h>>2]|0)-c;o=o+1|0}while((o|0)!=(r|0))}if(l){n=e+((r<<1)+-2<<2)|0;i=0;do{h=i;i=i+1|0;c=(f[((i|0)<(r|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((h|0)<(r|0)?e+(h<<1<<2)|0:n)>>2]|0)|0;c=Jl(c|0,((c|0)<0)<<31>>31|0,7233,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+((h<<1|1)<<2)|0;f[h>>2]=c+(f[h>>2]|0)}while((i|0)!=(t|0))}if(s){i=e+4|0;a=(t<<1)+-1|0;o=0;do{if((o|0)<1)n=i;else n=e+((((o|0)>(t|0)?t:o)<<1)+-1<<2)|0;c=(f[e+(((o|0)<(t|0)?o<<1|1:a)<<2)>>2]|0)+(f[n>>2]|0)|0;c=Jl(c|0,((c|0)<0)<<31>>31|0,3633,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;h=e+(o<<1<<2)|0;f[h>>2]=c+(f[h>>2]|0);o=o+1|0}while((o|0)!=(r|0))}if(l){n=0;do{h=e+((n<<1|1)<<2)|0;c=f[h>>2]|0;c=Jl(c|0,((c|0)<0)<<31>>31|0,5038,0)|0;c=Wl(c|0,B|0,4096,0)|0;c=Xl(c|0,B|0,13)|0;f[h>>2]=c;n=n+1|0}while((n|0)!=(t|0))}if(s)n=0;else return;do{t=e+(n<<1<<2)|0;h=f[t>>2]|0;h=Jl(h|0,((h|0)<0)<<31>>31|0,6659,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=Xl(h|0,B|0,13)|0;f[t>>2]=h;n=n+1|0}while((n|0)!=(r|0));return}h=(r|0)>0;if(!((t|0)>1|h))return;c=(t|0)>0;if(c){i=e+4|0;a=(r<<1)+-1|0;o=e+(a<<2)|0;u=0;do{s=u<<1;l=f[e+(((u|0)<(r|0)?s|1:a)<<2)>>2]|0;if((u|0)>=1)if((u|0)>(r|0))n=o;else n=e+(s+-1<<2)|0;else n=i;n=(f[n>>2]|0)+l|0;n=Jl(n|0,((n|0)<0)<<31>>31|0,12993,0)|0;n=Wl(n|0,B|0,4096,0)|0;n=Xl(n|0,B|0,13)|0;l=e+(s<<2)|0;f[l>>2]=(f[l>>2]|0)-n;u=u+1|0}while((u|0)!=(t|0))}if(h){n=e+((t<<1)+-2<<2)|0;i=0;do{u=i;i=i+1|0;l=(f[((i|0)<(t|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((u|0)<(t|0)?e+(u<<1<<2)|0:n)>>2]|0)|0;l=Jl(l|0,((l|0)<0)<<31>>31|0,434,0)|0;l=Wl(l|0,B|0,4096,0)|0;l=Xl(l|0,B|0,13)|0;u=e+((u<<1|1)<<2)|0;f[u>>2]=(f[u>>2]|0)-l}while((i|0)!=(r|0))}if(c){i=e+4|0;a=(r<<1)+-1|0;o=e+(a<<2)|0;u=0;do{s=u<<1;l=f[e+(((u|0)<(r|0)?s|1:a)<<2)>>2]|0;if((u|0)>=1)if((u|0)>(r|0))n=o;else n=e+(s+-1<<2)|0;else n=i;n=(f[n>>2]|0)+l|0;n=Jl(n|0,((n|0)<0)<<31>>31|0,7233,0)|0;n=Wl(n|0,B|0,4096,0)|0;n=Xl(n|0,B|0,13)|0;l=e+(s<<2)|0;f[l>>2]=n+(f[l>>2]|0);u=u+1|0}while((u|0)!=(t|0))}if(h){n=e+((t<<1)+-2<<2)|0;i=0;do{u=i;i=i+1|0;l=(f[((i|0)<(t|0)?e+(i<<1<<2)|0:n)>>2]|0)+(f[((u|0)<(t|0)?e+(u<<1<<2)|0:n)>>2]|0)|0;l=Jl(l|0,((l|0)<0)<<31>>31|0,3633,0)|0;l=Wl(l|0,B|0,4096,0)|0;l=Xl(l|0,B|0,13)|0;u=e+((u<<1|1)<<2)|0;f[u>>2]=l+(f[u>>2]|0)}while((i|0)!=(r|0))}if(c){n=0;do{c=e+(n<<1<<2)|0;u=f[c>>2]|0;u=Jl(u|0,((u|0)<0)<<31>>31|0,5038,0)|0;u=Wl(u|0,B|0,4096,0)|0;u=Xl(u|0,B|0,13)|0;f[c>>2]=u;n=n+1|0}while((n|0)!=(t|0))}if(h)n=0;else return;do{t=e+((n<<1|1)<<2)|0;h=f[t>>2]|0;h=Jl(h|0,((h|0)<0)<<31>>31|0,6659,0)|0;h=Wl(h|0,B|0,4096,0)|0;h=Xl(h|0,B|0,13)|0;f[t>>2]=h;n=n+1|0}while((n|0)!=(r|0));return}function Wo(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0;h=f[e>>2]|0;s=f[e+12>>2]|0;g=f[e+8>>2]|0;d=r*3|0;c=1-s|0;u=e+4|0;l=g;e=0;while(1){o=h+(s<<4)|0;if(((l+d|0)<(n|0)?(t&15|0)==0:0)?((o|r)&15|0)==0:0){if((l|0)>0){i=0;do{o=i<<3;f[h+(s<<4)+(o<<2)>>2]=f[t+(i<<2)>>2];a=i+r|0;f[h+(s<<4)+((o|1)<<2)>>2]=f[t+(a<<2)>>2];a=a+r|0;f[h+(s<<4)+((o|2)<<2)>>2]=f[t+(a<<2)>>2];f[h+(s<<4)+((o|3)<<2)>>2]=f[t+(a+r<<2)>>2];i=i+1|0}while((i|0)!=(l|0))}}else v=3;if((v|0)==3?(v=0,(l|0)>0):0){o=0;do{i=o<<3;f[h+(s<<4)+(i<<2)>>2]=f[t+(o<<2)>>2];a=o+r|0;if(((a|0)<(n|0)?(f[h+(s<<4)+((i|1)<<2)>>2]=f[t+(a<<2)>>2],p=a+r|0,(p|0)<(n|0)):0)?(f[h+(s<<4)+((i|2)<<2)>>2]=f[t+(p<<2)>>2],m=p+r|0,(m|0)<(n|0)):0)f[h+(s<<4)+((i|3)<<2)>>2]=f[t+(m<<2)>>2];o=o+1|0}while((o|0)!=(l|0))}e=e+1|0;if((e|0)==2)break;else{t=t+(g<<2)|0;n=n-g|0;s=c;l=f[u>>2]|0}}return}function Xo(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0.0,u=0.0,c=0,h=0.0,d=0,p=0;do{if(!(f[e+12>>2]|0)){r=f[e+8>>2]|0;if((f[e+4>>2]|0)>0){t=f[e>>2]|0;if((r|0)>0){o=0;i=1;s=9;break}else{o=0;a=1;break}}if((r|0)>1){n=0;i=1;s=7}else return}else{r=f[e+8>>2]|0;if((r|0)<=0)if((f[e+4>>2]|0)>1){t=f[e>>2]|0;o=1;a=0;break}else return;else{n=1;i=0;s=7}}}while(0);if((s|0)==7){t=f[e>>2]|0;o=n;s=9}if((s|0)==9){n=0;do{s=n<<3;d=t+(o<<4)+(s<<2)|0;c=t+(o<<4)+((s|1)<<2)|0;h=+v[c>>2];a=t+(o<<4)+((s|2)<<2)|0;u=+v[a>>2];s=t+(o<<4)+((s|3)<<2)|0;l=+v[s>>2];v[d>>2]=+v[d>>2]*1.2301740646362305;v[c>>2]=h*1.2301740646362305;v[a>>2]=u*1.2301740646362305;v[s>>2]=l*1.2301740646362305;n=n+1|0}while((n|0)!=(r|0));a=i}n=f[e+4>>2]|0;if((n|0)>0){i=0;do{d=i<<3;s=t+(a<<4)+(d<<2)|0;e=t+(a<<4)+((d|1)<<2)|0;l=+v[e>>2];c=t+(a<<4)+((d|2)<<2)|0;u=+v[c>>2];d=t+(a<<4)+((d|3)<<2)|0;h=+v[d>>2];v[s>>2]=+v[s>>2]*1.625732421875;v[e>>2]=l*1.625732421875;v[c>>2]=u*1.625732421875;v[d>>2]=h*1.625732421875;i=i+1|0}while((i|0)!=(n|0))}p=t+(a<<4)|0;i=t+(o+1<<4)|0;s=n-o|0;s=(r|0)<(s|0)?r:s;Yo(p,i,r,s,-.4435068666934967);e=t+(o<<4)|0;c=t+(a+1<<4)|0;d=r-a|0;d=(n|0)<(d|0)?n:d;Yo(e,c,n,d,-.8829110860824585);Yo(p,i,r,s,.05298011749982834);Yo(e,c,n,d,1.5861343145370483);return}function Yo(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=+i;var a=0.0,o=0.0,s=0.0,l=0.0,u=0,c=0,h=0,d=0,f=0.0,p=0.0,m=0,g=0.0,y=0.0,_=0,b=0.0,E=0.0,w=0,x=0.0;if((n|0)>0){h=n<<1;c=h+-2|0;o=+v[e>>2];s=+v[e+4>>2];l=+v[e+8>>2];a=+v[e+12>>2];e=t;u=0;while(1){w=e+-16|0;_=e+-12|0;E=+v[_>>2];m=e+-8|0;y=+v[m>>2];d=e+-4|0;p=+v[d>>2];x=o;o=+v[e>>2];b=s;s=+v[e+4>>2];g=l;l=+v[e+8>>2];f=a;a=+v[e+12>>2];v[w>>2]=+v[w>>2]+(x+o)*i;v[_>>2]=E+(b+s)*i;v[m>>2]=y+(g+l)*i;v[d>>2]=p+(f+a)*i;u=u+1|0;if((u|0)==(n|0))break;else e=e+32|0}e=t+(c<<4)|0;t=t+(h<<4)|0}if((n|0)>=(r|0))return;a=i+i;o=a*+v[e>>2];s=a*+v[e+4>>2];l=a*+v[e+8>>2];a=a*+v[e+12>>2];while(1){d=t+-16|0;m=t+-12|0;b=+v[m>>2];_=t+-8|0;E=+v[_>>2];w=t+-4|0;x=+v[w>>2];v[d>>2]=o+ +v[d>>2];v[m>>2]=s+b;v[_>>2]=l+E;v[w>>2]=a+x;n=n+1|0;if((n|0)==(r|0))break;else t=t+32|0}return}function qo(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0.0,o=0,s=0,l=0,u=0,c=0,h=0,d=0.0,p=0,m=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0;x=r<<2;T=Yi(r<<4)|0;if(!T){e=0;return e|0}M=T+x|0;Vl(T|0,0,x|0)|0;E=r+-1|0;b=(r|0)==0;if(!b){n=0;i=T;while(1){f[i>>2]=n;n=n+1|0;if((n|0)==(r|0))break;else i=i+4|0}}e:do{if(E){m=E;s=0;n=0;g=e;y=1;_=T;while(1){l=g+(s<<2)|0;if(s>>>0<r>>>0){o=s;i=l;a=0.0}else break;while(1){d=+v[i>>2];d=d>0.0?d:-d;w=d>a;n=w?o:n;a=w?d:a;o=o+1|0;if((o|0)==(r|0))break;else i=i+(r<<2)|0}if(a==0.0)break;if((n|0)!=(s|0)){w=n-s|0;p=_+(w<<2)|0;h=f[_>>2]|0;f[_>>2]=f[p>>2];f[p>>2]=h;w=g+((ce(w,r)|0)<<2)|0;Yl(M|0,w|0,x|0)|0;Yl(w|0,g|0,x|0)|0;Yl(g|0,M|0,x|0)|0}i=s;p=s+1|0;d=+v[l>>2];if(y>>>0<r>>>0){u=g+(p<<2)|0;h=p+m|0;c=y;o=g+(i+r<<2)|0;while(1){a=+v[o>>2]/d;v[o>>2]=a;i=y;s=o;l=u;while(1){s=s+4|0;v[s>>2]=+v[s>>2]-a*+v[l>>2];i=i+1|0;if((i|0)==(r|0))break;else l=l+4|0}c=c+1|0;if((c|0)==(r|0))break;else o=o+(h<<2)|0}}if(p>>>0<E>>>0){m=m+-1|0;s=p;g=g+(r<<2)|0;y=y+1|0;_=_+4|0}else break e}Ji(T);e=0;return e|0}}while(0);n=r<<1;w=M+(n<<2)|0;if(!b){b=M+(E+r<<2)|0;m=M+(n+E<<2)|0;g=e+((ce(r,r)|0)+-1<<2)|0;y=~r;_=0;p=t;while(1){Vl(M|0,0,x|0)|0;v[M+(_<<2)>>2]=1.0;s=0;l=1;u=T;c=w;h=e;while(1){if(!s)a=0.0;else{n=1;i=w;o=h;a=0.0;while(1){a=a+ +v[o>>2]*+v[i>>2];n=n+1|0;if((n|0)==(l|0))break;else{i=i+4|0;o=o+4|0}}}v[c>>2]=+v[M+(f[u>>2]<<2)>>2]-a;s=s+1|0;if((s|0)==(r|0)){s=r;l=b;u=w;c=m;h=g;break}else{l=l+1|0;u=u+4|0;c=c+4|0;h=h+(r<<2)|0}}while(1){n=s;s=s+-1|0;d=+v[h>>2];if(n>>>0<r>>>0){i=u;o=h;a=0.0;while(1){o=o+4|0;a=a+ +v[o>>2]*+v[i>>2];n=n+1|0;if((n|0)==(r|0))break;else i=i+4|0}}else a=0.0;u=u+-4|0;v[l>>2]=(+v[c>>2]-a)/d;if(!s){n=0;i=p;break}else{l=l+-4|0;c=c+-4|0;h=h+(y<<2)|0}}while(1){f[i>>2]=f[M+(n+r<<2)>>2];n=n+1|0;if((n|0)==(r|0))break;else i=i+(r<<2)|0}_=_+1|0;if((_|0)==(r|0))break;else p=p+4|0}}Ji(T);e=1;return e|0}function Zo(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;a=qi(1,44)|0;if(!a){a=0;return a|0}o=ls()|0;f[a>>2]=o;if(!o){us(0);f[a>>2]=0;o=a+4|0;Ms(f[o>>2]|0);f[o>>2]=0;if((f[a+40>>2]|0)==0?(r=a+8|0,t=f[r>>2]|0,(t|0)!=0):0){Ki(t);f[r>>2]=0}t=a+12|0;r=f[t>>2]|0;if(r){Ki(r);f[t>>2]=0}Ji(a);o=0;return o|0}o=Ts()|0;t=a+4|0;f[t>>2]=o;if(o){f[a+40>>2]=e;o=a;return o|0}us(f[a>>2]|0);f[a>>2]=0;Ms(f[t>>2]|0);f[t>>2]=0;if((f[a+40>>2]|0)==0?(n=a+8|0,i=f[n>>2]|0,(i|0)!=0):0){Ki(i);f[n>>2]=0}t=a+12|0;r=f[t>>2]|0;if(r){Ki(r);f[t>>2]=0}Ji(a);o=0;return o|0}function Ko(e){e=e|0;var t=0,r=0,n=0;if(!e)return;us(f[e>>2]|0);f[e>>2]=0;n=e+4|0;Ms(f[n>>2]|0);f[n>>2]=0;if((f[e+40>>2]|0)==0?(t=e+8|0,r=f[t>>2]|0,(r|0)!=0):0){Ki(r);f[t>>2]=0}t=e+12|0;r=f[t>>2]|0;if(r){Ki(r);f[t>>2]=0}Ji(e);return}function Qo(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,g=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Me=0,Se=0,Ae=0,Re=0,ke=0;Te=(f[t+8>>2]|0)-(f[t>>2]|0)|0;Me=t+20|0;n=f[Me>>2]|0;if(!n){e=1;return e|0}Se=t+24|0;Ae=r+808|0;Re=r+16|0;_e=e+4|0;Ee=e+8|0;we=e+16|0;xe=e+20|0;ye=r+20|0;me=t+32|0;ge=e+32|0;ve=e+12|0;r=n;pe=0;e:while(1){de=f[Se>>2]|0;fe=de+(pe*136|0)+24|0;t=f[fe>>2]|0;if(t){le=de+(pe*136|0)+16|0;ue=de+(pe*136|0)+20|0;he=pe+-1|0;r=f[ue>>2]|0;n=f[le>>2]|0;se=0;do{if(ce(r,n)|0){re=de+(pe*136|0)+28+(se*36|0)+20|0;ne=de+(pe*136|0)+28+(se*36|0)+16|0;ie=de+(pe*136|0)+28+(se*36|0)|0;ae=de+(pe*136|0)+28+(se*36|0)+4|0;oe=de+(pe*136|0)+28+(se*36|0)+32|0;te=0;do{t=f[re>>2]|0;$=t+(te*40|0)+16|0;ee=t+(te*40|0)+20|0;if(ce(f[ee>>2]|0,f[$>>2]|0)|0){Q=t+(te*40|0)+24|0;J=0;do{r=f[Q>>2]|0;G=f[ne>>2]|0;i=f[Ae>>2]|0;t=f[Re>>2]|0;W=f[_e>>2]|0;X=f[e>>2]|0;Y=r+(J*56|0)+8|0;K=r+(J*56|0)+12|0;if(!($o(e,(f[r+(J*56|0)+16>>2]|0)-(f[Y>>2]|0)|0,(f[r+(J*56|0)+20>>2]|0)-(f[K>>2]|0)|0)|0)){r=0;C=201;break e}q=r+(J*56|0)+24|0;a=f[q>>2]|0;vs(X);ys(X,18,0,46);ys(X,17,0,3);ys(X,0,0,4);Z=r+(J*56|0)+48|0;n=f[Z>>2]|0;if(n){U=r+(J*56|0)+4|0;B=(t&1|0)!=0;z=(t&2|0)==0;j=(t&8|0)==0;V=G<<8;N=(t&32|0)==0;t=a+i|0;r=2;F=0;do{a=f[U>>2]|0;D=B&(r>>>0<2?(t|0)<=((f[q>>2]|0)+-4|0):0);i=f[a+(F<<5)>>2]|0;if(i){n=(f[i>>2]|0)+(f[a+(F<<5)+4>>2]|0)|0;i=f[a+(F<<5)+16>>2]|0;if(!D){if(!(ws(X,n,i)|0)){r=0;C=201;break e}}else Ss(W,n,i);H=a+(F<<5)+12|0;t:do{if(f[H>>2]|0){O=z|D;I=0;while(1){r:do{switch(r|0){case 0:{if(D){w=1<<t;w=w>>1|w;i=f[xe>>2]|0;if(!i)break r;E=0-w|0;n=f[we>>2]|0;b=0;while(1){_=b;b=b+4|0;if(!n)n=0;else{h=(_|0)==-4;g=_|3;y=0;do{n:do{if(!h)if(j){u=_;do{if(u>>>0>=(f[xe>>2]|0)>>>0)break n;s=u;u=u+1|0;n=(ce(f[ge>>2]|0,u)|0)+y|0;i=n+1|0;a=f[ve>>2]|0;o=a+(i<<1)|0;s=(ce(f[we>>2]|0,s)|0)+y|0;s=(f[Ee>>2]|0)+(s<<2)|0;l=f[_e>>2]|0;C=d[o>>1]|0;if((C&255|0)!=0&(C&20480|0)==0){if(As(l)|0){k=As(l)|0;f[s>>2]=(k|0)!=0?E:w;L=f[ge>>2]|0;C=a+(i-L<<1)|0;P=a+(L+i<<1)|0;R=a+(i+~L<<1)|0;d[R>>1]=m[R>>1]|2;d[C>>1]=d[C>>1]|d[3436+(k<<1)>>1];C=n+2|0;R=a+(C-L<<1)|0;d[R>>1]=m[R>>1]|4;R=a+(n<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+2<<1)>>1];d[o>>1]=m[o>>1]|4096;R=a+(C<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+4<<1)>>1];R=a+(L+n<<1)|0;d[R>>1]=m[R>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];C=a+(L+C<<1)|0;d[C>>1]=m[C>>1]|8}d[o>>1]=m[o>>1]|16384}}while(u>>>0<b>>>0)}else{c=_;do{n=f[xe>>2]|0;if(c>>>0>=n>>>0)break n;L=c;c=c+1|0;i=(ce(f[ge>>2]|0,c)|0)+y|0;a=i+1|0;o=f[ve>>2]|0;s=o+(a<<1)|0;l=(ce(f[we>>2]|0,L)|0)+y|0;l=(f[Ee>>2]|0)+(l<<2)|0;u=f[_e>>2]|0;C=d[s>>1]|0;C=(L|0)==(g|0)|(L|0)==(n+-1|0)?C&-1095:C;if((C&255|0)!=0&(C&20480|0)==0){if(As(u)|0){k=As(u)|0;f[l>>2]=(k|0)!=0?E:w;L=f[ge>>2]|0;C=o+(a-L<<1)|0;P=o+(L+a<<1)|0;R=o+(a+~L<<1)|0;d[R>>1]=m[R>>1]|2;d[C>>1]=d[C>>1]|d[3436+(k<<1)>>1];C=i+2|0;R=o+(C-L<<1)|0;d[R>>1]=m[R>>1]|4;R=o+(i<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+2<<1)>>1];d[s>>1]=m[s>>1]|4096;R=o+(C<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+4<<1)>>1];R=o+(L+i<<1)|0;d[R>>1]=m[R>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];C=o+(L+C<<1)|0;d[C>>1]=m[C>>1]|8}d[s>>1]=m[s>>1]|16384}}while(c>>>0<b>>>0)}}while(0);y=y+1|0;n=f[we>>2]|0}while(y>>>0<n>>>0);i=f[xe>>2]|0}if(b>>>0>=i>>>0){C=163;break r}}}if(j){a=f[Ee>>2]|0;o=(f[ve>>2]|0)+2|0;g=1<<t;g=g>>1|g;n=f[xe>>2]|0;i=f[we>>2]|0;if(n>>>0>3){u=i;l=0;while(1){if(!i){i=u;s=0}else{i=0;do{C=(f[ge>>2]|0)+i|0;es(e,o+(C<<1)|0,a+(i<<2)|0,G,g);n=(f[we>>2]|0)+i|0;C=(f[ge>>2]|0)+C|0;es(e,o+(C<<1)|0,a+(n<<2)|0,G,g);n=(f[we>>2]|0)+n|0;C=(f[ge>>2]|0)+C|0;es(e,o+(C<<1)|0,a+(n<<2)|0,G,g);es(e,o+((f[ge>>2]|0)+C<<1)|0,a+((f[we>>2]|0)+n<<2)|0,G,g);i=i+1|0;n=f[we>>2]|0}while(i>>>0<n>>>0);i=n;s=n;n=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=o+(f[ge>>2]<<2<<1)|0;l=l+4|0;if(l>>>0<(n&-4)>>>0){u=i;i=s}else{h=o;c=l;break}}}else{h=o;c=0}if(!i){C=163;break r}else u=0;while(1){if(c>>>0<n>>>0){o=a+(u<<2)|0;s=h+(u<<1)|0;l=c;while(1){s=s+(f[ge>>2]<<1)|0;es(e,s,o,G,g);i=f[we>>2]|0;l=l+1|0;n=f[xe>>2]|0;if(l>>>0>=n>>>0)break;else o=o+(i<<2)|0}}u=u+1|0;if(u>>>0>=i>>>0){C=163;break r}}}w=1<<t;w=w>>1|w;n=f[xe>>2]|0;if(!n){C=163;break r}x=0-w|0;i=f[we>>2]|0;o=i;E=0;while(1){b=E;E=E+4|0;do{if(!i){a=o;i=0}else{_=b|3;if((b|0)==-4){a=o;i=o;break}else y=0;do{g=b;do{n=f[xe>>2]|0;if(g>>>0>=n>>>0)break;C=g;g=g+1|0;o=(ce(f[ge>>2]|0,g)|0)+y|0;s=o+1|0;l=f[ve>>2]|0;u=l+(s<<1)|0;c=(ce(f[we>>2]|0,C)|0)+y|0;c=(f[Ee>>2]|0)+(c<<2)|0;h=f[e>>2]|0;i=d[u>>1]|0;n=(C|0)==(_|0)|(C|0)==(n+-1|0)?i&-1095:i;i=n&255;if((i|0)!=0&(n&20480|0)==0){a=h+100|0;f[a>>2]=h+24+(p[20267+(i|V)>>0]<<2);if(xs(h)|0){L=n>>>4&255;f[a>>2]=h+24+(p[21291+L>>0]<<2);C=xs(h)|0;L=p[21547+L>>0]|0;k=L^C;f[c>>2]=(C|0)!=(L|0)?x:w;L=f[ge>>2]|0;C=l+(s-L<<1)|0;P=l+(L+s<<1)|0;R=l+(s+~L<<1)|0;d[R>>1]=m[R>>1]|2;d[C>>1]=d[C>>1]|d[3436+(k<<1)>>1];C=o+2|0;R=l+(C-L<<1)|0;d[R>>1]=m[R>>1]|4;R=l+(o<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+2<<1)>>1];d[u>>1]=m[u>>1]|4096;R=l+(C<<1)|0;d[R>>1]=d[R>>1]|d[3436+(k+4<<1)>>1];R=l+(L+o<<1)|0;d[R>>1]=m[R>>1]|1;d[P>>1]=d[P>>1]|d[3436+(k+6<<1)>>1];C=l+(L+C<<1)|0;d[C>>1]=m[C>>1]|8}d[u>>1]=m[u>>1]|16384}}while(g>>>0<E>>>0);y=y+1|0;n=f[we>>2]|0}while(y>>>0<n>>>0);a=n;i=n;n=f[xe>>2]|0}}while(0);if(E>>>0>=n>>>0){C=163;break}else o=a}break}case 1:{if(D){h=1<<t>>1;g=(t|0)>0?0-h|0:-1;i=f[xe>>2]|0;if(!i)break r;a=f[we>>2]|0;n=a;c=0;while(1){u=c;c=c+4|0;if(!a){o=n;a=0}else{l=(u|0)==-4;s=0;do{o=s;s=s+1|0;if(!l){a=u;do{if(a>>>0>=(f[xe>>2]|0)>>>0)break;i=a;a=a+1|0;n=(ce(f[ge>>2]|0,a)|0)+s|0;n=(f[ve>>2]|0)+(n<<1)|0;i=(ce(f[we>>2]|0,i)|0)+o|0;i=(f[Ee>>2]|0)+(i<<2)|0;if((d[n>>1]&20480)==4096){L=(As(f[_e>>2]|0)|0)!=0;L=L?h:g;C=f[i>>2]|0;f[i>>2]=((C|0)<0?0-L|0:L)+C;d[n>>1]=m[n>>1]|8192}}while(a>>>0<c>>>0);n=f[we>>2]|0}}while(s>>>0<n>>>0);o=n;a=n;i=f[xe>>2]|0}if(c>>>0>=i>>>0){C=163;break r}else n=o}}if(!j){_=1<<t>>1;b=(t|0)>0?0-_|0:-1;n=f[xe>>2]|0;if(!n){C=163;break r}i=f[we>>2]|0;a=i;y=0;while(1){g=y;y=y+4|0;if(!i)i=0;else{c=(g|0)==-4;h=g|3;n=a;u=0;do{l=u;u=u+1|0;if(!c){o=g;do{n=f[xe>>2]|0;if(o>>>0>=n>>>0)break;L=o;o=o+1|0;i=(ce(f[ge>>2]|0,o)|0)+u|0;i=(f[ve>>2]|0)+(i<<1)|0;a=(ce(f[we>>2]|0,L)|0)+l|0;a=(f[Ee>>2]|0)+(a<<2)|0;s=f[e>>2]|0;C=d[i>>1]|0;n=(L|0)==(h|0)|(L|0)==(n+-1|0)?C&-1095:C;if((n&20480|0)==4096){f[s+100>>2]=s+24+(((n&8192|0)!=0?16:(n&255|0)!=0?15:14)<<2);L=(xs(s)|0)!=0;L=L?_:b;C=f[a>>2]|0;f[a>>2]=((C|0)<0?0-L|0:L)+C;d[i>>1]=m[i>>1]|8192}}while(o>>>0<y>>>0);n=f[we>>2]|0}}while(u>>>0<n>>>0);a=n;i=n;n=f[xe>>2]|0}if(y>>>0>=n>>>0){C=163;break r}}}a=f[Ee>>2]|0;o=(f[ve>>2]|0)+2|0;E=1<<t>>1;w=(t|0)>0?0-E|0:-1;n=f[xe>>2]|0;i=f[we>>2]|0;if(n>>>0>3){l=i;_=o;b=0;while(1){if(!i){i=l;s=0}else{n=l;y=0;do{i=a+(y<<2)|0;l=f[ge>>2]|0;c=l+y|0;o=_+(c<<1)|0;u=f[e>>2]|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[u+100>>2]=u+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);l=(xs(u)|0)!=0;l=l?E:w;n=f[i>>2]|0;f[i>>2]=((n|0)<0?0-l|0:l)+n;d[o>>1]=m[o>>1]|8192;n=f[we>>2]|0;i=f[ge>>2]|0;l=f[e>>2]|0}else{i=l;l=u}h=n+y|0;u=a+(h<<2)|0;g=i+c|0;o=_+(g<<1)|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);i=(xs(l)|0)!=0;i=i?E:w;n=f[u>>2]|0;f[u>>2]=((n|0)<0?0-i|0:i)+n;d[o>>1]=m[o>>1]|8192;n=f[we>>2]|0;i=f[ge>>2]|0;l=f[e>>2]|0}c=n+h|0;u=a+(c<<2)|0;h=i+g|0;o=_+(h<<1)|0;s=d[o>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);i=(xs(l)|0)!=0;i=i?E:w;n=f[u>>2]|0;f[u>>2]=((n|0)<0?0-i|0:i)+n;d[o>>1]=m[o>>1]|8192;n=f[we>>2]|0;i=f[ge>>2]|0;l=f[e>>2]|0}s=a+(n+c<<2)|0;i=_+(i+h<<1)|0;o=d[i>>1]|0;if((o&20480|0)==4096){f[l+100>>2]=l+24+(((o&8192|0)!=0?16:(o&255|0)!=0?15:14)<<2);C=(xs(l)|0)!=0;C=C?E:w;n=f[s>>2]|0;f[s>>2]=((n|0)<0?0-C|0:C)+n;d[i>>1]=m[i>>1]|8192;n=f[we>>2]|0}y=y+1|0}while(y>>>0<n>>>0);i=n;s=n;n=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=_+(f[ge>>2]<<2<<1)|0;u=b+4|0;if(u>>>0<(n&-4)>>>0){l=i;i=s;_=o;b=u}else{y=u;break}}}else y=0;if(!i){C=163;break r}else g=0;do{if(y>>>0<n>>>0){u=a+(g<<2)|0;c=o+(g<<1)|0;h=y;while(1){c=c+(f[ge>>2]<<1)|0;l=f[e>>2]|0;s=d[c>>1]|0;if((s&20480|0)==4096){f[l+100>>2]=l+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);n=(xs(l)|0)!=0;n=n?E:w;s=f[u>>2]|0;f[u>>2]=((s|0)<0?0-n|0:n)+s;d[c>>1]=m[c>>1]|8192;s=f[we>>2]|0;n=f[xe>>2]|0}else s=i;h=h+1|0;if(h>>>0>=n>>>0){i=s;break}else{i=s;u=u+(s<<2)|0}}}g=g+1|0}while(g>>>0<i>>>0);C=163;break}case 2:{P=f[e>>2]|0;L=1<<t;L=L>>1|L;do{if(j){a=f[Ee>>2]|0;o=(f[ve>>2]|0)+2|0;i=f[xe>>2]|0;if(i>>>0>3){w=P+92|0;x=P+100|0;T=P+96|0;M=0-L|0;s=f[we>>2]|0;n=s;u=0;while(1){if(!s)s=0;else{g=u|1;y=g+1|0;_=u|3;b=g+3|0;E=0;do{n=f[ge>>2]|0;i=E;E=E+1|0;R=(ce(n,g)|0)+E|0;A=f[ve>>2]|0;S=A+((ce(n,y)|0)+E<<1)|0;k=A+((ce(n,_)|0)+E<<1)|0;C=A+((ce(n,b)|0)+E<<1)|0;n:do{if(!((d[S>>1]|d[A+(R<<1)>>1]|d[k>>1]|d[C>>1])&20735)){f[x>>2]=w;if(!(xs(P)|0))break;f[x>>2]=T;c=(xs(P)|0)<<1;c=c|(xs(P)|0);if(c>>>0>=4)break;h=a+((ce(f[we>>2]|0,c)|0)+i<<2)|0;i=o+((ce(f[ge>>2]|0,c)|0)+i<<1)|0;l=c;while(1){if(l>>>0>=(f[xe>>2]|0)>>>0)break n;n=f[ge>>2]|0;s=i;i=i+(n<<1)|0;if((l|0)==(c|0)){C=f[e>>2]|0;k=(m[i>>1]|0)>>>4&255;f[C+100>>2]=C+24+(p[21291+k>>0]<<2);C=xs(C)|0;k=p[21547+k>>0]|0;A=k^C;f[h>>2]=(C|0)!=(k|0)?M:L;k=f[ge>>2]|0;C=s+(n-k<<1)|0;R=s+(k+n<<1)|0;S=s+(n+~k<<1)|0;d[S>>1]=m[S>>1]|2;d[C>>1]=d[C>>1]|d[3436+(A<<1)>>1];C=n+1|0;S=s+(C-k<<1)|0;d[S>>1]=m[S>>1]|4;S=n+-1|0;n=s+(S<<1)|0;d[n>>1]=d[n>>1]|d[3436+(A+2<<1)>>1];d[i>>1]=m[i>>1]|4096;n=s+(C<<1)|0;d[n>>1]=d[n>>1]|d[3436+(A+4<<1)>>1];S=s+(k+S<<1)|0;d[S>>1]=m[S>>1]|1;d[R>>1]=d[R>>1]|d[3436+(A+6<<1)>>1];C=s+(k+C<<1)|0;d[C>>1]=m[C>>1]|8;d[i>>1]=m[i>>1]&49151}else ts(e,i,h,G,L);l=l+1|0;if(l>>>0>=4)break;else h=h+(f[we>>2]<<2)|0}}else{k=n+i|0;ts(e,o+(k<<1)|0,a+(i<<2)|0,G,L);C=(f[we>>2]|0)+i|0;k=(f[ge>>2]|0)+k|0;ts(e,o+(k<<1)|0,a+(C<<2)|0,G,L);C=(f[we>>2]|0)+C|0;k=(f[ge>>2]|0)+k|0;ts(e,o+(k<<1)|0,a+(C<<2)|0,G,L);ts(e,o+((f[ge>>2]|0)+k<<1)|0,a+((f[we>>2]|0)+C<<2)|0,G,L)}}while(0);n=f[we>>2]|0}while(E>>>0<n>>>0);s=n;i=f[xe>>2]|0}a=a+(s<<2<<2)|0;o=o+(f[ge>>2]<<2<<1)|0;u=u+4|0;if(u>>>0>=(i&-4)>>>0){h=a;c=o;break}}}else{n=f[we>>2]|0;h=a;c=o;u=0}if(!n)break;else l=0;do{if(u>>>0<i>>>0){a=h+(l<<2)|0;o=c+(l<<1)|0;s=u;while(1){o=o+(f[ge>>2]<<1)|0;ts(e,o,a,G,L);n=f[we>>2]|0;s=s+1|0;i=f[xe>>2]|0;if(s>>>0>=i>>>0)break;else a=a+(n<<2)|0}}l=l+1|0}while(l>>>0<n>>>0)}else{n=f[xe>>2]|0;if(!n)break;S=P+92|0;A=P+100|0;R=P+96|0;k=0-L|0;i=f[we>>2]|0;M=0;while(1){if(!i){a=M+4|0;i=0}else{E=M|3;w=M|1;x=w+1|0;T=w+3|0;a=M+4|0;b=0;while(1){do{if(E>>>0<n>>>0){n=f[ge>>2]|0;o=b+1|0;_=(ce(n,w)|0)+o|0;i=f[ve>>2]|0;if(d[i+(_<<1)>>1]&20735){_=0;n=0;C=127;break}_=i+((ce(n,x)|0)+o<<1)|0;if(d[_>>1]&20735){_=0;n=0;C=127;break}_=i+((ce(n,E)|0)+o<<1)|0;if(d[_>>1]&20735){_=0;n=0;C=127;break}_=i+((ce(n,T)|0)+o<<1)|0;if(d[_>>1]&20665){_=0;n=0;C=127;break}f[A>>2]=S;if(!(xs(P)|0))break;f[A>>2]=R;n=(xs(P)|0)<<1;_=1;n=n|(xs(P)|0);C=127}else{_=0;n=0;C=127}}while(0);if((C|0)==127){C=0;o=n+M|0;n:do{if(o>>>0<a>>>0){y=o;do{n=f[xe>>2]|0;if(y>>>0>=n>>>0)break n;ke=y;y=y+1|0;s=(ce(f[ge>>2]|0,y)|0)+b|0;l=s+1|0;u=f[ve>>2]|0;c=u+(l<<1)|0;h=(ce(f[we>>2]|0,ke)|0)+b|0;h=(f[Ee>>2]|0)+(h<<2)|0;g=f[e>>2]|0;i=d[c>>1]|0;i=(ke|0)==(E|0)|(ke|0)==(n+-1|0)?i&-1095:i;do{if(!(_&(ke|0)==(o|0))){if(i&20480)break;n=g+100|0;f[n>>2]=g+24+(p[20267+(i&255|V)>>0]<<2);if(xs(g)|0)C=133}else{n=g+100|0;C=133}}while(0);if((C|0)==133){C=0;i=i>>>4&255;f[n>>2]=g+24+(p[21291+i>>0]<<2);ke=xs(g)|0;g=p[21547+i>>0]|0;i=g^ke;f[h>>2]=(ke|0)!=(g|0)?k:L;g=f[ge>>2]|0;ke=u+(l-g<<1)|0;h=u+(g+l<<1)|0;l=u+(l+~g<<1)|0;d[l>>1]=m[l>>1]|2;d[ke>>1]=d[ke>>1]|d[3436+(i<<1)>>1];ke=s+2|0;l=u+(ke-g<<1)|0;d[l>>1]=m[l>>1]|4;l=u+(s<<1)|0;d[l>>1]=d[l>>1]|d[3436+(i+2<<1)>>1];d[c>>1]=m[c>>1]|4096;l=u+(ke<<1)|0;d[l>>1]=d[l>>1]|d[3436+(i+4<<1)>>1];l=u+(g+s<<1)|0;d[l>>1]=m[l>>1]|1;d[h>>1]=d[h>>1]|d[3436+(i+6<<1)>>1];ke=u+(g+ke<<1)|0;d[ke>>1]=m[ke>>1]|8}d[c>>1]=m[c>>1]&49151}while(y>>>0<a>>>0)}}while(0);o=b+1|0}i=f[we>>2]|0;n=f[xe>>2]|0;if(o>>>0<i>>>0)b=o;else break}}if(a>>>0<n>>>0)M=a;else break}}}while(0);if(N){C=163;break r}f[P+100>>2]=P+96;xs(P)|0;xs(P)|0;xs(P)|0;xs(P)|0;C=163;break}default:C=163}}while(0);do{if((C|0)==163){C=0;if(O)break;vs(X);ys(X,18,0,46);ys(X,17,0,3);ys(X,0,0,4)}}while(0);r=r+1|0;ke=(r|0)==3;t=(ke<<31>>31)+t|0;r=ke?0:r;I=I+1|0;if(I>>>0>=(f[H>>2]|0)>>>0)break t}}}while(0);n=f[Z>>2]|0}F=F+1|0}while(F>>>0<n>>>0)}r=(f[Y>>2]|0)-(f[ie>>2]|0)|0;t=(f[K>>2]|0)-(f[ae>>2]|0)|0;n=f[ne>>2]|0;if(n&1){ke=f[Se>>2]|0;r=(f[ke+(he*136|0)+8>>2]|0)+r-(f[ke+(he*136|0)>>2]|0)|0}if(n&2){ke=f[Se>>2]|0;t=(f[ke+(he*136|0)+12>>2]|0)+t-(f[ke+(he*136|0)+4>>2]|0)|0}c=f[Ee>>2]|0;h=f[we>>2]|0;g=f[xe>>2]|0;n=f[Ae>>2]|0;if((n|0)!=0?(be=1<<n,(g|0)!=0):0){n=(h|0)==0;u=0;do{if(!n){i=ce(u,h)|0;l=0;do{a=c+(l+i<<2)|0;o=f[a>>2]|0;s=(o|0)>-1?o:0-o|0;if((s|0)>=(be|0)){ke=s>>f[Ae>>2];f[a>>2]=(o|0)<0?0-ke|0:ke}l=l+1|0}while((l|0)!=(h|0))}u=u+1|0}while((u|0)!=(g|0))}l=(ce(t,Te)|0)+r|0;u=f[me>>2]|0;r=(g|0)==0;if((f[ye>>2]|0)==1){if(!r){r=(h|0)==0;a=0;do{if(!r){t=ce(a,h)|0;n=(ce(a,Te)|0)+l|0;i=0;do{f[u+(n+i<<2)>>2]=(f[c+(i+t<<2)>>2]|0)/2|0;i=i+1|0}while((i|0)!=(h|0))}a=a+1|0}while((a|0)!=(g|0))}}else if(!r){s=(h|0)==0;r=c;o=0;a=u+(l<<2)|0;while(1){if(!s){t=r;n=0;i=a;while(1){v[i>>2]=+(f[t>>2]|0)*+v[oe>>2];n=n+1|0;if((n|0)==(h|0))break;else{t=t+4|0;i=i+4|0}}r=r+(h<<2)|0}o=o+1|0;if((o|0)==(g|0))break;else a=a+(Te<<2)|0}}J=J+1|0}while(J>>>0<(ce(f[ee>>2]|0,f[$>>2]|0)|0)>>>0);r=f[ue>>2]|0;n=f[le>>2]|0}te=te+1|0}while(te>>>0<(ce(r,n)|0)>>>0);t=f[fe>>2]|0}se=se+1|0}while(se>>>0<t>>>0);r=f[Me>>2]|0}pe=pe+1|0;if(pe>>>0>=r>>>0){r=1;C=201;break}}if((C|0)==201)return r|0;return 0}function Jo(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,g=0.0,_=0.0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,z=0,j=0,V=0,G=0,W=0.0,X=0,Y=0,q=0,Z=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0.0,le=0,ue=0,he=0,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=0,_e=0,be=0,Ee=0,we=0,xe=0,Te=0,Me=0,Se=0,Ae=0,Re=0,ke=0,Pe=0,Le=0,Ce=0,Ie=0,He=0,Oe=0,De=0,Fe=0,Ne=0,Ue=0,Be=0,ze=0,je=0,Ve=0,Ge=0,We=0,Xe=0,Ye=0,qe=0,Ze=0,Ke=0,Qe=0,Je=0,$e=0;Ke=t+32|0;y[Ke>>3]=0.0;Qe=t+16|0;a=f[Qe>>2]|0;if(!a){Je=1;return Je|0}Ze=t+20|0;Ge=r+5584|0;We=e+16|0;Xe=e+20|0;Ye=e+8|0;qe=e+36|0;ze=(n|0)!=0;je=e+32|0;Ve=e+12|0;t=a;Be=0;e:while(1){r=f[Ze>>2]|0;a=f[Ge>>2]|0;Ne=(f[r+(Be*52|0)+8>>2]|0)-(f[r+(Be*52|0)>>2]|0)|0;Ue=r+(Be*52|0)+16|0;o=f[Ue>>2]|0;if(o){Fe=r+(Be*52|0)+24|0;Oe=r+(Be*52|0)+32|0;De=a+(Be*1080|0)+20|0;Ce=a+(Be*1080|0)+16|0;He=ze&Be>>>0<i>>>0;Ie=n+(Be<<3)|0;t=o;Le=0;do{ke=f[Fe>>2]|0;Pe=ke+(Le*136|0)+24|0;r=f[Pe>>2]|0;if(r){Me=ke+(Le*136|0)+16|0;Se=ke+(Le*136|0)+20|0;Ae=~Le;Re=Le+-1|0;t=f[Se>>2]|0;a=f[Me>>2]|0;Te=0;do{xe=ke+(Le*136|0)+28+(Te*36|0)+32|0;if(ce(t,a)|0){ve=67108864/(~~+K(+(+v[xe>>2]*8192.0))|0)|0;ye=ke+(Le*136|0)+28+(Te*36|0)+20|0;_e=ke+(Le*136|0)+28+(Te*36|0)|0;be=ke+(Le*136|0)+28+(Te*36|0)+4|0;Ee=ke+(Le*136|0)+28+(Te*36|0)+16|0;we=((ve|0)<0)<<31>>31;ge=0;do{r=f[ye>>2]|0;pe=r+(ge*40|0)+16|0;me=r+(ge*40|0)+20|0;if(ce(f[me>>2]|0,f[pe>>2]|0)|0){de=r+(ge*40|0)+24|0;fe=0;do{he=f[de>>2]|0;o=f[he+(fe*52|0)+12>>2]|0;t=o-(f[_e>>2]|0)|0;s=f[he+(fe*52|0)+16>>2]|0;r=s-(f[be>>2]|0)|0;a=f[Ee>>2]|0;if(a&1){ue=f[Fe>>2]|0;t=(f[ue+(Re*136|0)+8>>2]|0)+t-(f[ue+(Re*136|0)>>2]|0)|0}if(a&2){ue=f[Fe>>2]|0;r=(f[ue+(Re*136|0)+12>>2]|0)+r-(f[ue+(Re*136|0)+4>>2]|0)|0}if(!($o(e,(f[he+(fe*52|0)+20>>2]|0)-o|0,(f[he+(fe*52|0)+24>>2]|0)-s|0)|0)){t=0;Je=173;break e}l=f[We>>2]|0;u=f[Xe>>2]|0;c=Ne-l|0;b=(ce(r,Ne)|0)+t|0;E=f[Oe>>2]|0;f[Ye>>2]=E+(b<<2);f[qe>>2]=Ne;t=(u|0)==0;if((f[De>>2]|0)==1){if(!t){o=(l|0)==0;s=0;t=0;while(1){if(!o){r=0;a=t;while(1){ue=E+(a+b<<2)|0;f[ue>>2]=f[ue>>2]<<6;r=r+1|0;if((r|0)==(l|0))break;else a=a+1|0}t=l+t|0}s=s+1|0;if((s|0)==(u|0))break;else t=t+c|0}}}else if(!t){o=(l|0)==0;s=0;t=0;while(1){if(!o){r=0;a=t;while(1){ue=E+(a+b<<2)|0;le=f[ue>>2]|0;le=Jl(le|0,((le|0)<0)<<31>>31|0,ve|0,we|0)|0;le=Wl(le|0,B|0,4096,0)|0;le=Xl(le|0,B|0,18)|0;f[ue>>2]=le;r=r+1|0;if((r|0)==(l|0))break;else a=a+1|0}t=l+t|0}s=s+1|0;if((s|0)==(u|0))break;else t=t+c|0}}ae=f[Ee>>2]|0;oe=(f[Ue>>2]|0)+Ae|0;c=f[De>>2]|0;se=+v[xe>>2];le=f[Ce>>2]|0;ue=f[e>>2]|0;o=f[We>>2]|0;do{if(!o)t=0;else{s=f[Xe>>2]|0;l=(s|0)==0;u=0;t=0;do{if(!l){r=f[qe>>2]|0;a=0;do{ie=E+(b+((ce(a,r)|0)+u)<<2)|0;ie=f[ie>>2]|0;ie=(ie|0)>-1?ie:0-ie|0;t=(t|0)>(ie|0)?t:ie;a=a+1|0}while((a|0)!=(s|0))}u=u+1|0}while((u|0)!=(o|0));if(!t){t=0;break}if((t|0)>1){r=t;t=0}else{t=-5;break}while(1){r=r>>1;if((r|0)<=1)break;else t=t+1|0}t=t+-4|0}}while(0);ne=he+(fe*52|0)+28|0;f[ne>>2]=t;t=t+-1|0;vs(ue);ys(ue,18,0,46);ys(ue,17,0,3);ys(ue,0,0,4);ie=he+(fe*52|0)|0;hs(ue,f[ie>>2]|0);t:do{if((t|0)>-1){te=he+(fe*52|0)+8|0;Y=le&1;re=(Y|0)!=0;q=(c|0)==1;Z=(le&4|0)==0;Y=(Y|0)==0;Q=(le&2|0)==0;J=(le&8|0)==0;$=ae<<8;ee=(le&32|0)==0;r=0;G=t;W=0.0;t=0;X=2;while(1){V=f[te>>2]|0;I=re&(X>>>0<2?(G|0)<((f[ne>>2]|0)+-4|0):0);r:do{switch(X|0){case 0:{L=1<<G+6;r=f[Xe>>2]|0;if(!r){o=0;break r}C=(G|0)==0;s=f[We>>2]|0;a=s;o=0;P=0;do{k=P;P=P+4|0;if(!a)a=0;else{A=(k|0)==-4;R=k|3;a=s;S=0;do{if(!A){M=k;do{r=f[Xe>>2]|0;if(M>>>0>=r>>>0)break;do{if(J)r=0;else{if((M|0)==(R|0)){r=1;break}r=(M|0)==(r+-1|0)}}while(0);l=M;M=M+1|0;b=(ce(f[je>>2]|0,M)|0)+S|0;E=b+1|0;w=f[Ve>>2]|0;T=w+(E<<1)|0;l=(ce(f[qe>>2]|0,l)|0)+S|0;l=(f[Ye>>2]|0)+(l<<2)|0;x=f[e>>2]|0;u=d[T>>1]|0;u=r?u&-1095:u;r=u&255;if((r|0)!=0&(u&20480|0)==0){a=f[l>>2]|0;a=(((a|0)<0?0-a|0:a)&L|0)!=0;s=a&1;c=x+100|0;f[c>>2]=x+24+(p[20267+(r|$)>>0]<<2);if(I)ms(x,s);else ds(x,s);if(a){r=f[l>>2]|0;a=r>>>31;r=(r|0)<0?0-r|0:r;if(C)r=3708+((r&127)<<1)|0;else r=3452+((r>>>G&127)<<1)|0;o=(d[r>>1]|0)+o|0;r=u>>>4&255;f[c>>2]=x+24+(p[21291+r>>0]<<2);if(I)ms(x,a);else ds(x,p[21547+r>>0]^a);z=f[je>>2]|0;j=w+(E-z<<1)|0;U=w+(z+E<<1)|0;N=w+(E+~z<<1)|0;d[N>>1]=m[N>>1]|2;d[j>>1]=d[j>>1]|d[3436+(a<<1)>>1];j=b+2|0;N=w+(j-z<<1)|0;d[N>>1]=m[N>>1]|4;N=w+(b<<1)|0;d[N>>1]=d[N>>1]|d[3436+((a|2)<<1)>>1];d[T>>1]=m[T>>1]|4096;N=w+(j<<1)|0;d[N>>1]=d[N>>1]|d[3436+((a|4)<<1)>>1];N=w+(z+b<<1)|0;d[N>>1]=m[N>>1]|1;d[U>>1]=d[U>>1]|d[3436+((a|6)<<1)>>1];j=w+(z+j<<1)|0;d[j>>1]=m[j>>1]|8}d[T>>1]=m[T>>1]|16384}}while(M>>>0<P>>>0);a=f[We>>2]|0}S=S+1|0}while(S>>>0<a>>>0);r=f[Xe>>2]|0;s=a}}while(P>>>0<r>>>0);break}case 1:{S=1<<G+6;r=f[Xe>>2]|0;if(!r){o=0;break r}A=(G|0)==0;s=f[We>>2]|0;a=s;o=0;M=0;do{T=M;M=M+4|0;if(!a)a=0;else{w=(T|0)==-4;x=T|3;a=s;E=0;do{b=E;E=E+1|0;if(!w){c=T;do{r=f[Xe>>2]|0;if(c>>>0>=r>>>0)break;do{if(J)r=0;else{if((c|0)==(x|0)){r=1;break}r=(c|0)==(r+-1|0)}}while(0);a=c;c=c+1|0;l=(ce(f[je>>2]|0,c)|0)+E|0;l=(f[Ve>>2]|0)+(l<<1)|0;u=f[e>>2]|0;s=d[l>>1]|0;s=r?s&-1095:s;if((s&20480|0)==4096){a=(f[Ye>>2]|0)+((ce(f[qe>>2]|0,a)|0)+b<<2)|0;a=f[a>>2]|0;a=(a|0)<0?0-a|0:a;if(A)r=4220+((a&127)<<1)|0;else r=3964+((a>>>G&127)<<1)|0;o=(d[r>>1]|0)+o|0;r=(a&S|0)!=0&1;f[u+100>>2]=u+24+(((s&8192|0)!=0?16:(s&255|0)!=0?15:14)<<2);if(I)ms(u,r);else ds(u,r);d[l>>1]=m[l>>1]|8192}}while(c>>>0<M>>>0);a=f[We>>2]|0}}while(E>>>0<a>>>0);r=f[Xe>>2]|0;s=a}}while(M>>>0<r>>>0);break}case 2:{D=f[e>>2]|0;F=1<<G+6;a=f[Xe>>2]|0;if(!a)r=0;else{N=D+92|0;U=D+100|0;z=D+96|0;j=(G|0)==0;o=f[We>>2]|0;r=0;O=0;while(1){if(!o){s=O+4|0;o=0}else{R=O|3;k=O|1;P=k+1|0;L=k+3|0;s=O+4|0;C=O+1|0;I=O+2|0;H=O+3|0;A=0;while(1){do{if(R>>>0<a>>>0){a=f[je>>2]|0;u=A+1|0;l=(ce(a,k)|0)+u|0;o=f[Ve>>2]|0;l=d[o+(l<<1)>>1]|0;if(J){M=o+((ce(a,P)|0)+u<<1)|0;S=o+((ce(a,R)|0)+u<<1)|0;a=o+((ce(a,L)|0)+u<<1)|0;a=((d[M>>1]|l|d[S>>1]|d[a>>1])&20735)==0&1}else{do{if(!(l&20735)){S=o+((ce(a,P)|0)+u<<1)|0;if(d[S>>1]&20735){a=1;break}S=o+((ce(a,R)|0)+u<<1)|0;if(d[S>>1]&20735){a=1;break}a=o+((ce(a,L)|0)+u<<1)|0;a=(d[a>>1]&20665)!=0}else a=1}while(0);a=a&1^1}if(!a){S=0;a=0;Je=109;break}a=f[qe>>2]|0;o=f[Ye>>2]|0;S=o+((ce(a,O)|0)+A<<2)|0;S=f[S>>2]|0;do{if(!(((S|0)<0?0-S|0:S)&F)){S=o+((ce(a,C)|0)+A<<2)|0;S=f[S>>2]|0;if(((S|0)<0?0-S|0:S)&F){a=1;break}S=o+((ce(a,I)|0)+A<<2)|0;S=f[S>>2]|0;if(((S|0)<0?0-S|0:S)&F){a=2;break}a=o+((ce(a,H)|0)+A<<2)|0;a=f[a>>2]|0;a=(((a|0)<0?0-a|0:a)&F|0)==0?4:3}else a=0}while(0);f[U>>2]=N;ds(D,(a|0)!=4&1);if((a|0)==4){l=u;break}f[U>>2]=z;ds(D,a>>>1);ds(D,a&1);S=1;Je=109}else{S=0;a=0;Je=109}}while(0);if((Je|0)==109){Je=0;M=a+O|0;n:do{if(M>>>0<s>>>0){T=M;do{a=f[Xe>>2]|0;if(T>>>0>=a>>>0)break n;do{if(J)a=0;else{if((T|0)==(R|0)){a=1;break}a=(T|0)==(a+-1|0)}}while(0);$e=T;T=T+1|0;c=(ce(f[je>>2]|0,T)|0)+A|0;b=c+1|0;E=f[Ve>>2]|0;x=E+(b<<1)|0;o=(ce(f[qe>>2]|0,$e)|0)+A|0;o=(f[Ye>>2]|0)+(o<<2)|0;w=f[e>>2]|0;l=d[x>>1]|0;u=a?l&-1095:l;do{if(!(S&($e|0)==(M|0))){if(l&20480)break;f[w+100>>2]=w+24+(p[20267+(u&255|$)>>0]<<2);$e=f[o>>2]|0;$e=((($e|0)<0?0-$e|0:$e)&F|0)!=0;ds(w,$e&1);if($e)Je=117}else Je=117}while(0);if((Je|0)==117){Je=0;o=f[o>>2]|0;a=(o|0)<0?0-o|0:o;if(j)a=3708+((a&127)<<1)|0;else a=3452+((a>>>G&127)<<1)|0;r=(d[a>>1]|0)+r|0;$e=u>>>4&255;f[w+100>>2]=w+24+(p[21291+$e>>0]<<2);l=o>>>31;ds(w,p[21547+$e>>0]^l);w=f[je>>2]|0;$e=E+(b-w<<1)|0;u=E+(w+b<<1)|0;b=E+(b+~w<<1)|0;d[b>>1]=m[b>>1]|2;d[$e>>1]=d[$e>>1]|d[3436+(l<<1)>>1];$e=c+2|0;b=E+($e-w<<1)|0;d[b>>1]=m[b>>1]|4;b=E+(c<<1)|0;d[b>>1]=d[b>>1]|d[3436+((l|2)<<1)>>1];d[x>>1]=m[x>>1]|4096;b=E+($e<<1)|0;d[b>>1]=d[b>>1]|d[3436+((l|4)<<1)>>1];b=E+(w+c<<1)|0;d[b>>1]=m[b>>1]|1;d[u>>1]=d[u>>1]|d[3436+((l|6)<<1)>>1];$e=E+(w+$e<<1)|0;d[$e>>1]=m[$e>>1]|8}d[x>>1]=m[x>>1]&49151}while(T>>>0<s>>>0)}}while(0);l=A+1|0}o=f[We>>2]|0;a=f[Xe>>2]|0;if(l>>>0<o>>>0)A=l;else break}}if(s>>>0<a>>>0)O=s;else break}}if(ee){o=r;break r}Es(ue);o=r;break}default:o=r}}while(0);if(He)g=+y[Ie>>3];else g=1.0;if(q)_=+Oo(oe,ae);else _=+No(oe,ae);_=+(1<<G|0)*(se*(g*_));_=_*(+(o|0)*_*.0001220703125);W=W+_;y[Ke>>3]=+y[Ke>>3]+_;do{if(Z)Je=137;else{if((G|0)<1&(X|0)==2){Je=137;break}fs(ue);a=V+(t*24|0)+20|0;r=h[a>>0]|1;h[a>>0]=r;a=1}}while(0);do{if((Je|0)==137){r=(f[ne>>2]|0)+-4|0;if((X|0)!=0&(G|0)<(r|0))if(Y)Je=141;else Je=140;else if(Y|((X|0)!=2|(G|0)!=(r|0)))Je=141;else Je=140;if((Je|0)==140){Je=0;fs(ue);a=V+(t*24|0)+20|0;r=h[a>>0]|1;h[a>>0]=r;a=1;break}else if((Je|0)==141){Je=0;a=V+(t*24|0)+20|0;r=h[a>>0]&-2;h[a>>0]=r;a=3;break}}}while(0);j=X+1|0;$e=(j|0)==3;X=$e?0:j;G=($e<<31>>31)+G|0;do{if((G|0)>0&(r&1)!=0)if(re&(X>>>0<2?(G|0)<((f[ne>>2]|0)+-4|0):0)){ps(ue);break}else{_s(ue);break}}while(0);y[V+(t*24|0)+8>>3]=W;$e=(cs(ue)|0)+a|0;f[V+(t*24|0)>>2]=$e;if(!Q)gs(ue);t=t+1|0;if((G|0)<=-1)break t;else r=o}}else t=0}while(0);do{if(!(le&16)){if(le&1)break;fs(ue)}else bs(ue)}while(0);u=he+(fe*52|0)+48|0;f[u>>2]=t;if(t){o=he+(fe*52|0)+8|0;l=0;do{s=f[o>>2]|0;r=s+(l*24|0)|0;$e=f[r>>2]|0;if($e>>>0>(cs(ue)|0)>>>0){t=cs(ue)|0;f[r>>2]=t}else t=f[r>>2]|0;do{if(t>>>0>1){a=t+-1|0;if((h[(f[ie>>2]|0)+a>>0]|0)!=-1)break;f[r>>2]=a;t=a}}while(0);if(!l)r=0;else r=f[(f[o>>2]|0)+((l+-1|0)*24|0)>>2]|0;f[s+(l*24|0)+16>>2]=t-r;l=l+1|0}while(l>>>0<(f[u>>2]|0)>>>0)}fe=fe+1|0}while(fe>>>0<(ce(f[me>>2]|0,f[pe>>2]|0)|0)>>>0);t=f[Se>>2]|0;a=f[Me>>2]|0}ge=ge+1|0}while(ge>>>0<(ce(t,a)|0)>>>0);r=f[Pe>>2]|0}Te=Te+1|0}while(Te>>>0<r>>>0);t=f[Ue>>2]|0}Le=Le+1|0}while(Le>>>0<t>>>0);t=f[Qe>>2]|0}Be=Be+1|0;if(Be>>>0>=t>>>0){t=1;Je=173;break}}if((Je|0)==173)return t|0;return 0}function $o(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0;a=ce(r,t)|0;if(!(f[e+40>>2]|0)){o=e+24|0;s=e+8|0;n=f[s>>2]|0;do{if(a>>>0>(f[o>>2]|0)>>>0){Ki(n);i=a<<2;n=Zi(i)|0;f[s>>2]=n;if(!n){t=0;return t|0}else{f[o>>2]=a;break}}else i=a<<2}while(0);Vl(n|0,0,i|0)|0}a=t+2|0;f[e+32>>2]=a;a=ce(r+2|0,a)|0;o=e+28|0;s=e+12|0;n=f[s>>2]|0;do{if(a>>>0>(f[o>>2]|0)>>>0){Ki(n);i=a<<1;n=Zi(i)|0;f[s>>2]=n;if(!n){t=0;return t|0}else{f[o>>2]=a;break}}else i=a<<1}while(0);Vl(n|0,0,i|0)|0;f[e+16>>2]=t;f[e+20>>2]=r;t=1;return t|0}function es(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0;a=f[e>>2]|0;s=d[t>>1]|0;l=s&255;if(!((l|0)!=0&(s&20480|0)==0))return;o=a+100|0;f[o>>2]=a+24+(p[20267+(l|n<<8)>>0]<<2);if(xs(a)|0){n=s>>>4&255;f[o>>2]=a+24+(p[21291+n>>0]<<2);s=xs(a)|0;n=p[21547+n>>0]|0;l=n^s;f[r>>2]=(s|0)!=(n|0)?0-i|0:i;e=f[e+32>>2]|0;i=t+(0-e<<1)|0;n=t+(e<<1)|0;r=t+(~e<<1)|0;d[r>>1]=m[r>>1]|2;d[i>>1]=d[i>>1]|d[3436+(l<<1)>>1];i=t+(1-e<<1)|0;d[i>>1]=m[i>>1]|4;i=t+-2|0;d[i>>1]=d[i>>1]|d[3436+(l+2<<1)>>1];d[t>>1]=m[t>>1]|4096;i=t+2|0;d[i>>1]=d[i>>1]|d[3436+(l+4<<1)>>1];i=t+(e+-1<<1)|0;d[i>>1]=m[i>>1]|1;d[n>>1]=d[n>>1]|d[3436+(l+6<<1)>>1];e=t+(e+1<<1)|0;d[e>>1]=m[e>>1]|8}d[t>>1]=m[t>>1]|16384;return}function ts(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;a=f[e>>2]|0;s=d[t>>1]|0;if(s&20480){e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}o=a+100|0;f[o>>2]=a+24+(p[20267+(s&255|n<<8)>>0]<<2);if(!(xs(a)|0)){e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}n=s>>>4&255;f[o>>2]=a+24+(p[21291+n>>0]<<2);o=xs(a)|0;n=p[21547+n>>0]|0;s=n^o;f[r>>2]=(o|0)!=(n|0)?0-i|0:i;e=f[e+32>>2]|0;i=t+(0-e<<1)|0;n=t+(e<<1)|0;r=t+(~e<<1)|0;d[r>>1]=m[r>>1]|2;d[i>>1]=d[i>>1]|d[3436+(s<<1)>>1];i=t+(1-e<<1)|0;d[i>>1]=m[i>>1]|4;i=t+-2|0;d[i>>1]=d[i>>1]|d[3436+(s+2<<1)>>1];d[t>>1]=m[t>>1]|4096;i=t+2|0;d[i>>1]=d[i>>1]|d[3436+(s+4<<1)>>1];i=t+(e+-1<<1)|0;d[i>>1]=m[i>>1]|1;d[n>>1]=d[n>>1]|d[3436+(s+6<<1)>>1];e=t+(e+1<<1)|0;d[e>>1]=m[e>>1]|8;e=d[t>>1]|0;e=e&65535;e=e&49151;e=e&65535;d[t>>1]=e;return}function rs(e,t,r,n,i,a,o,s,l,u,c,h){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;h=h|0;var m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0;I=b;b=b+16|0;C=I;f[C>>2]=0;m=f[e>>2]|0;R=f[e+4>>2]|0;e=f[R+76>>2]|0;P=e+(t*5640|0)|0;v=(d[R>>1]|0)==4?2:1;y=R+80|0;if(!(f[y>>2]|0))g=1;else g=f[m+16>>2]|0;L=(f[e+(t*5640|0)+420>>2]|0)+1|0;k=Cr(m,R,t,h)|0;if(!k){t=0;b=I;return t|0}f[a>>2]=0;e:do{if(!h){if(g){e=0;t:while(1){h=0;c=k;m=0;while(1){Ir(k,R,t,m,e,u,0);if((f[c+80>>2]|0)==-1){e=9;break t}l=c+36|0;r:while(1){do{if(!(Or(c)|0))break r}while((f[l>>2]|0)>>>0>=n>>>0);f[C>>2]=0;if(!(os(t,r,P,c,i,C,o,s)|0)){e=13;break t}A=f[C>>2]|0;f[a>>2]=(f[a>>2]|0)+A;o=o-A|0;h=A+h|0;i=i+A|0}A=f[y>>2]|0;if((A|0)!=0&h>>>0>A>>>0){e=17;break t}m=m+1|0;if(m>>>0<v>>>0)c=c+232|0;else break}e=e+1|0;if(e>>>0>=g>>>0)break e}if((e|0)==9){Lr(k,L);t=0;b=I;return t|0}else if((e|0)==13){Lr(k,L);t=0;b=I;return t|0}else if((e|0)==17){Lr(k,L);t=0;b=I;return t|0}}}else{Ir(k,R,t,c,l,u,h);M=k+(c*232|0)|0;if((f[k+(c*232|0)+80>>2]|0)==-1){Lr(k,L);t=0;b=I;return t|0}u=k+(c*232|0)+36|0;_=(s|0)==0;E=r+840|0;w=s+12|0;x=s+8|0;T=s+88|0;y=R+93|0;v=e+(t*5640|0)+5636|0;while(1){do{if(!(Or(M)|0))break e}while((f[u>>2]|0)>>>0>=n>>>0);f[C>>2]=0;if(!(os(t,r,P,M,i,C,o,s)|0))break;g=f[C>>2]|0;i=i+g|0;o=o-g|0;f[a>>2]=(f[a>>2]|0)+g;if(!_){if(!(f[w>>2]|0))e=f[x>>2]|0;else{m=f[T>>2]|0;e=f[x>>2]|0;c=f[m+(t*592|0)+548>>2]|0;h=c+(e<<5)|0;if(!e){l=(f[m+(t*592|0)+12>>2]|0)+1|0;m=((l|0)<0)<<31>>31;R=h;f[R>>2]=l;f[R+4>>2]=m}else{if((((p[v>>0]|0)>>>2|(p[y>>0]|0)>>>3)&1)!=0?(A=h,S=f[A>>2]|0,A=f[A+4>>2]|0,!((S|0)==0&(A|0)==0)):0){l=S;m=A}else{l=c+(e+-1<<5)+16|0;l=Wl(f[l>>2]|0,f[l+4>>2]|0,1,0)|0;m=B}R=h;f[R>>2]=l;f[R+4>>2]=m}h=Wl(l|0,m|0,-1,-1)|0;l=B;g=Wl(h|0,l|0,g|0,0)|0;R=c+(e<<5)+16|0;f[R>>2]=g;f[R+4>>2]=B;R=c+(e<<5)+8|0;g=R;g=Wl(h|0,l|0,f[g>>2]|0,f[g+4>>2]|0)|0;f[R>>2]=g;f[R+4>>2]=B}f[x>>2]=e+1}f[E>>2]=(f[E>>2]|0)+1}Lr(k,L);t=0;b=I;return t|0}}while(0);Lr(k,L);t=1;b=I;return t|0}function ns(e,t,r,n,i,a,o,s){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;var l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,B=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0,Q=0,J=0,$=0;J=b;b=b+112|0;q=J+64|0;Z=J+32|0;G=J;V=J+96|0;j=J+92|0;l=f[e>>2]|0;N=e+4|0;Q=f[N>>2]|0;o=f[Q+76>>2]|0;B=o+(t*5640|0)|0;z=o+(t*5640|0)+420|0;K=(f[z>>2]|0)+1|0;Q=Pr(l,Q,t)|0;if(!Q){$=0;b=J;return $|0}U=l+16|0;F=o+(t*5640|0)+12|0;D=r+20|0;O=l+24|0;t=a;e=n;I=Q;H=0;e:while(1){if((f[I+80>>2]|0)==-1){$=4;break}o=Yi(f[U>>2]<<2)|0;if(!o){$=6;break}Vl(o|0,1,f[U>>2]<<2|0)|0;if(Or(I)|0){a=I+24|0;r=I+28|0;C=I+36|0;l=I+32|0;L=t;P=e;while(1){if((f[F>>2]|0)>>>0>(f[C>>2]|0)>>>0){t=f[a>>2]|0;e=f[D>>2]|0;if((f[r>>2]|0)>>>0<(f[e+(t*52|0)+20>>2]|0)>>>0){f[o+(t<<2)>>2]=0;k=f[N>>2]|0;f[j>>2]=0;if(!(ss(k,e,B,I,V,P,j,L,s)|0)){$=45;break e}R=f[j>>2]|0;if(!(f[V>>2]|0))e=R;else{A=L-R|0;M=P+R|0;f[j>>2]=0;t=f[r>>2]|0;u=f[(f[D>>2]|0)+((f[a>>2]|0)*52|0)+24>>2]|0;x=u+(t*136|0)+24|0;e=f[x>>2]|0;t:do{if(!e){e=M;$=43}else{T=P+L|0;c=e;k=0;w=u+(t*136|0)+28|0;u=M;r:while(1){e=f[l>>2]|0;t=f[w+20>>2]|0;if(((f[w+8>>2]|0)!=(f[w>>2]|0)?(f[w+12>>2]|0)!=(f[w+4>>2]|0):0)?(Y=ce(f[t+(e*40|0)+20>>2]|0,f[t+(e*40|0)+16>>2]|0)|0,(Y|0)!=0):0){S=0;e=f[t+(e*40|0)+24>>2]|0;p=u;while(1){_=e+40|0;if(!(f[_>>2]|0))t=p;else{E=e+44|0;t=f[E>>2]|0;do{if(!t){d=f[e+4>>2]|0;f[E>>2]=1;f[e+36>>2]=0}else{u=t+-1|0;c=f[e+4>>2]|0;if((f[c+(u<<5)+8>>2]|0)!=(f[c+(u<<5)+20>>2]|0)){d=c+(u<<5)|0;break}f[E>>2]=t+1;d=c+(t<<5)|0}}while(0);y=e+36|0;t=e+32|0;v=p;h=d+28|0;u=f[h>>2]|0;if((u+v|0)>>>0<v>>>0|(p+u|0)>>>0>T>>>0){t=k;e=S;break r}c=f[y>>2]|0;v=p;g=d;while(1){d=u+c|0;if(d>>>0<c>>>0){t=k;e=S;$=29;break e}p=f[e>>2]|0;if(d>>>0>(f[t>>2]|0)>>>0){u=Qi(p,d)|0;if(!u){$=32;break e}c=f[y>>2]|0;m=f[h>>2]|0;f[t>>2]=m+c;f[e>>2]=u;p=u;u=m}Yl(p+c|0,v|0,u|0)|0;u=g+8|0;c=f[u>>2]|0;if(!c){f[g>>2]=e;d=f[y>>2]|0;f[g+4>>2]=d}else d=f[y>>2]|0;p=f[h>>2]|0;m=v;v=v+p|0;h=f[g+24>>2]|0;c=h+c|0;f[u>>2]=c;u=f[_>>2]|0;f[_>>2]=u-h;f[g+12>>2]=c;c=p+d|0;f[y>>2]=c;d=g+16|0;f[d>>2]=(f[d>>2]|0)+p;if((u|0)==(h|0)){t=v;break}f[E>>2]=(f[E>>2]|0)+1;d=v;h=g+60|0;u=f[h>>2]|0;if((u+d|0)>>>0<d>>>0?1:(m+(u+p)|0)>>>0>T>>>0){t=k;e=S;break r}else g=g+32|0}f[e+48>>2]=f[E>>2]}S=S+1|0;if(S>>>0>=Y>>>0){e=t;break}else{e=e+56|0;p=t}}t=f[x>>2]|0}else{t=c;e=u}k=k+1|0;if(k>>>0>=t>>>0){$=43;break t}else{c=t;w=w+36|0;u=e}}M=f[l>>2]|0;S=f[r>>2]|0;k=f[a>>2]|0;f[G>>2]=u;f[G+4>>2]=A;f[G+8>>2]=e;f[G+12>>2]=M;f[G+16>>2]=t;f[G+20>>2]=S;f[G+24>>2]=k;Jn(s,2,21803,G)|0;e=f[j>>2]|0}}while(0);if(($|0)==43){$=0;e=e-M|0;f[j>>2]=e}e=e+R|0}u=f[a>>2]|0;R=f[r>>2]|0;t=(f[O>>2]|0)+(u*52|0)+36|0;k=f[t>>2]|0;f[t>>2]=R>>>0>k>>>0?R:k;t=e}else $=47}else{e=f[D>>2]|0;$=47}if(($|0)==47){$=0;k=f[N>>2]|0;f[j>>2]=0;if(!(ss(k,e,B,I,V,P,j,L,s)|0)){$=69;break e}_=f[j>>2]|0;if(!(f[V>>2]|0))e=_;else{u=L-_|0;w=f[r>>2]|0;x=f[a>>2]|0;e=f[(f[D>>2]|0)+(x*52|0)+24>>2]|0;f[j>>2]=0;y=f[e+(w*136|0)+24>>2]|0;if(!y)e=0;else{E=f[l>>2]|0;t=0;v=e+(w*136|0)+28|0;while(1){c=f[v+20>>2]|0;if(((f[v+8>>2]|0)!=(f[v>>2]|0)?(f[v+12>>2]|0)!=(f[v+4>>2]|0):0)?(W=ce(f[c+(E*40|0)+20>>2]|0,f[c+(E*40|0)+16>>2]|0)|0,(W|0)!=0):0){e=0;g=f[c+(E*40|0)+24>>2]|0;while(1){p=g+40|0;t:do{if(f[p>>2]|0){m=g+44|0;c=f[m>>2]|0;do{if(!c){d=f[g+4>>2]|0;f[m>>2]=1;f[g+36>>2]=0}else{h=c+-1|0;d=f[g+4>>2]|0;if((f[d+(h<<5)+8>>2]|0)!=(f[d+(h<<5)+20>>2]|0)){d=d+(h<<5)|0;break}f[m>>2]=c+1;d=d+(c<<5)|0}}while(0);k=f[j>>2]|0;c=f[d+28>>2]|0;h=c+k|0;if(h>>>0<k>>>0|h>>>0>u>>>0){a=E;r=w;l=x;$=65;break e}while(1){f[j>>2]=h;k=f[d+24>>2]|0;R=d+8|0;f[R>>2]=(f[R>>2]|0)+k;R=f[p>>2]|0;f[p>>2]=R-k;if((R|0)==(k|0))break t;f[m>>2]=(f[m>>2]|0)+1;k=f[j>>2]|0;c=f[d+60>>2]|0;h=c+k|0;if(h>>>0<k>>>0|h>>>0>u>>>0){a=E;r=w;l=x;$=65;break e}else d=d+32|0}}}while(0);e=e+1|0;if(e>>>0>=W>>>0)break;else g=g+56|0}}t=t+1|0;if(t>>>0>=y>>>0)break;else v=v+36|0}e=f[j>>2]|0}e=e+_|0}u=f[a>>2]|0;t=e}if((f[o+(u<<2)>>2]|0)!=0?(X=(f[O>>2]|0)+(u*52|0)+36|0,(f[X>>2]|0)==0):0)f[X>>2]=(f[(f[D>>2]|0)+(u*52|0)+20>>2]|0)+-1;e=P+t|0;t=L-t|0;if(!(Or(I)|0))break;else{L=t;P=e}}}Ji(o);H=H+1|0;if(H>>>0>(f[z>>2]|0)>>>0){o=e;$=75;break}else I=I+232|0}if(($|0)==4){Lr(Q,K);$=0;b=J;return $|0}else if(($|0)==6){Lr(Q,K);$=0;b=J;return $|0}else if(($|0)==29){i=f[l>>2]|0;n=f[r>>2]|0;q=f[a>>2]|0;f[Z>>2]=u;f[Z+4>>2]=c;f[Z+8>>2]=~u;f[Z+12>>2]=e;f[Z+16>>2]=i;f[Z+20>>2]=t;f[Z+24>>2]=n;f[Z+28>>2]=q;Jn(s,1,21888,Z)|0;$=45}else if(($|0)==32){Ji(f[e>>2]|0);f[e>>2]=0;f[t>>2]=0;$=45}else if(($|0)==65){f[q>>2]=c;f[q+4>>2]=u;f[q+8>>2]=e;f[q+12>>2]=a;f[q+16>>2]=t;f[q+20>>2]=r;f[q+24>>2]=l;Jn(s,1,21987,q)|0;$=69}else if(($|0)==75){Lr(Q,K);f[i>>2]=o-n;$=1;b=J;return $|0}if(($|0)==45){Lr(Q,K);Ji(o);$=0;b=J;return $|0}else if(($|0)==69){Lr(Q,K);Ji(o);$=0;b=J;return $|0}return 0}function is(e,t){e=e|0;t=t|0;var r=0;r=qi(1,8)|0;if(!r){e=0;return e|0}f[r>>2]=e;f[r+4>>2]=t;e=r;return e|0}function as(e){e=e|0;if(!e)return;Ji(e);return}function os(e,t,r,n,i,a,o,s){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;var l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0.0,O=0,D=0;v=f[n+28>>2]|0;O=f[n+32>>2]|0;D=f[n+36>>2]|0;g=f[(f[t+20>>2]|0)+((f[n+24>>2]|0)*52|0)+24>>2]|0;if(!(f[r>>2]&2))C=i;else{h[i>>0]=-1;h[i+1>>0]=-111;h[i+2>>0]=0;h[i+3>>0]=4;C=t+840|0;h[i+4>>0]=(f[C>>2]|0)>>>8;h[i+5>>0]=f[C>>2];o=o+-6|0;C=i+6|0}if((D|0)==0?(m=g+(v*136|0)+24|0,(f[m>>2]|0)!=0):0){d=g+(v*136|0)+28|0;p=0;while(1){n=f[d+20>>2]|0;on(f[n+(O*40|0)+32>>2]|0);u=n+(O*40|0)+36|0;on(f[u>>2]|0);c=ce(f[n+(O*40|0)+20>>2]|0,f[n+(O*40|0)+16>>2]|0)|0;if(c){n=n+(O*40|0)+24|0;t=d+28|0;l=0;do{I=f[n>>2]|0;f[I+(l*52|0)+40>>2]=0;po(f[u>>2]|0,l,(f[t>>2]|0)-(f[I+(l*52|0)+28>>2]|0)|0);l=l+1|0}while((l|0)!=(c|0))}p=p+1|0;if(p>>>0>=(f[m>>2]|0)>>>0)break;else d=d+36|0}}P=xo()|0;if(!P){a=0;return a|0}So(P,C,o);Ro(P,1,1);L=g+(v*136|0)+28|0;I=g+(v*136|0)+24|0;if(f[I>>2]|0){S=D+1|0;R=L;k=0;while(1){c=f[R+20>>2]|0;A=ce(f[c+(O*40|0)+20>>2]|0,f[c+(O*40|0)+16>>2]|0)|0;d=c+(O*40|0)+24|0;n=(A|0)==0;if(!n){t=c+(O*40|0)+32|0;l=f[d>>2]|0;u=0;while(1){if((f[l+40>>2]|0)==0?(f[(f[l+4>>2]|0)+(D*24|0)>>2]|0)!=0:0)po(f[t>>2]|0,u,D);u=u+1|0;if((u|0)==(A|0))break;else l=l+52|0}if(!n){M=c+(O*40|0)+32|0;T=c+(O*40|0)+36|0;w=f[d>>2]|0;x=0;while(1){n=(f[w+4>>2]|0)+(D*24|0)|0;E=w+40|0;if(!(f[E>>2]|0))mo(P,f[M>>2]|0,x,S);else Ro(P,(f[n>>2]|0)!=0&1,1);t=f[n>>2]|0;if(t){if(!(f[E>>2]|0)){f[w+32>>2]=3;mo(P,f[T>>2]|0,x,999);t=f[n>>2]|0}e:do{switch(t|0){case 1:{Ro(P,0,1);break}case 2:{Ro(P,2,2);break}default:{if(t>>>0<6){Ro(P,t+-3|12,4);break e}if(t>>>0<37){Ro(P,t+-6|480,9);break e}if(t>>>0<165)Ro(P,t+-37|65408,16)}}}while(0);d=f[E>>2]|0;t=f[n>>2]|0;b=t+d|0;_=w+8|0;if(d>>>0<b>>>0){v=w+32|0;m=d+-1+t|0;u=0;c=0;l=0;g=(f[_>>2]|0)+(d*24|0)|0;while(1){l=l+1|0;c=(f[g+16>>2]|0)+c|0;if((h[g+20>>0]&1)!=0|(d|0)==(m|0)){if((c|0)>1){t=0;do{c=c>>1;t=t+1|0}while((c|0)>1)}else t=0;p=f[v>>2]|0;if((l|0)>1){c=0;do{l=l>>1;c=c+1|0}while((l|0)>1);l=c}else l=0;c=t+1-p-l|0;u=(u|0)>(c|0)?u:c;c=0;l=0}d=d+1|0;if((d|0)==(b|0))break;else g=g+24|0}if((u|0)>0){t=u;while(1){Ro(P,1,1);if((t|0)>1)t=t+-1|0;else{t=c;break}}}else t=c}else{u=0;t=0;l=0}Ro(P,0,1);m=w+32|0;f[m>>2]=(f[m>>2]|0)+u;u=f[E>>2]|0;if(u>>>0<b>>>0){p=(f[_>>2]|0)+(u*24|0)|0;while(1){l=l+1|0;c=(f[p+16>>2]|0)+t|0;if((h[p+20>>0]&1)==0?(u|0)!=((f[E>>2]|0)+-1+(f[n>>2]|0)|0):0)t=c;else{d=f[m>>2]|0;if((l|0)>1){t=0;do{l=l>>1;t=t+1|0}while((l|0)>1)}else t=0;Ro(P,c,t+d|0);t=0;l=0}u=u+1|0;if((u|0)==(b|0))break;else p=p+24|0}}}x=x+1|0;if((x|0)==(A|0))break;else w=w+52|0}}}k=k+1|0;if(k>>>0>=(f[I>>2]|0)>>>0)break;else R=R+36|0}}if(!(Po(P)|0)){To(P);a=0;return a|0}t=Mo(P)|0;n=C+t|0;o=o-t|0;To(P);if(f[r>>2]&4){h[n>>0]=-1;h[C+(t+1)>>0]=-110;o=o+-2|0;n=C+(t+2)|0}_=(s|0)!=0;if(_?(f[s+12>>2]|0)!=0:0){C=n-i|0;r=(f[(f[s+88>>2]|0)+(e*592|0)+548>>2]|0)+(f[s+8>>2]<<5)+8|0;f[r>>2]=C;f[r+4>>2]=((C|0)<0)<<31>>31}t=f[I>>2]|0;e:do{if(t){b=s+12|0;E=s+8|0;w=s+88|0;g=L;v=0;t:while(1){l=f[g+20>>2]|0;m=ce(f[l+(O*40|0)+20>>2]|0,f[l+(O*40|0)+16>>2]|0)|0;l=f[l+(O*40|0)+24>>2]|0;if(m){if(_){p=0;while(1){d=f[l+4>>2]|0;t=d+(D*24|0)|0;if(f[t>>2]|0){u=d+(D*24|0)+4|0;c=f[u>>2]|0;if(c>>>0>o>>>0){n=0;o=81;break t}Yl(n|0,f[d+(D*24|0)+16>>2]|0,c|0)|0;r=l+40|0;f[r>>2]=(f[r>>2]|0)+(f[t>>2]|0);r=f[u>>2]|0;n=n+r|0;o=o-r|0;if((f[b>>2]|0)!=0?(r=(f[(f[w>>2]|0)+(e*592|0)+548>>2]|0)+(f[E>>2]<<5)+24|0,H=+y[d+(D*24|0)+8>>3]+ +y[r>>3],y[r>>3]=H,+y[s>>3]<H):0)y[s>>3]=H}p=p+1|0;if(p>>>0>=m>>>0)break;else l=l+52|0}}else{p=0;while(1){t=f[l+4>>2]|0;u=t+(D*24|0)|0;if(f[u>>2]|0){c=t+(D*24|0)+4|0;d=f[c>>2]|0;if(d>>>0>o>>>0){n=0;o=81;break t}Yl(n|0,f[t+(D*24|0)+16>>2]|0,d|0)|0;r=l+40|0;f[r>>2]=(f[r>>2]|0)+(f[u>>2]|0);r=f[c>>2]|0;o=o-r|0;n=n+r|0}p=p+1|0;if(p>>>0>=m>>>0)break;else l=l+52|0}}t=f[I>>2]|0}v=v+1|0;if(v>>>0>=t>>>0)break e;else g=g+36|0}if((o|0)==81)return n|0}}while(0);f[a>>2]=n-i+(f[a>>2]|0);a=1;return a|0}function ss(e,t,r,n,i,a,o,s,l){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;var u=0,c=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0;U=b;b=b+64|0;F=U+40|0;D=U+32|0;x=U+24|0;w=U+16|0;_=U+8|0;y=U;E=U+48|0;N=U+44|0;f[N>>2]=a;M=f[n+28>>2]|0;O=n+24|0;T=f[t+((f[O>>2]|0)*52|0)+24>>2]|0;I=n+36|0;if((f[I>>2]|0)==0?(v=T+(M*136|0)+24|0,u=f[v>>2]|0,(u|0)!=0):0){g=n+32|0;p=0;m=T+(M*136|0)+28|0;while(1){t=f[g>>2]|0;c=f[m+20>>2]|0;if((f[m+8>>2]|0)!=(f[m>>2]|0)?(f[m+12>>2]|0)!=(f[m+4>>2]|0):0){on(f[c+(t*40|0)+32>>2]|0);on(f[c+(t*40|0)+36>>2]|0);u=ce(f[c+(t*40|0)+20>>2]|0,f[c+(t*40|0)+16>>2]|0)|0;if(u){d=0;t=f[c+(t*40|0)+24>>2]|0;while(1){f[t+44>>2]=0;f[t+48>>2]=0;d=d+1|0;if((d|0)==(u|0))break;else t=t+56|0}}u=f[v>>2]|0}p=p+1|0;if(p>>>0>=u>>>0)break;else m=m+36|0}}do{if(f[r>>2]&2){if(s>>>0<6){Jn(l,2,22072,y)|0;break}t=f[N>>2]|0;if((h[t>>0]|0)==-1?(h[t+1>>0]|0)==-111:0){f[N>>2]=t+6;break}Jn(l,2,22114,_)|0}}while(0);C=xo()|0;if(!C){a=0;b=U;return a|0}do{if(!(h[e+96>>0]&1))if(!(h[r+5636>>0]&2)){P=f[N>>2]|0;f[E>>2]=a+s-P;L=N;break}else{L=r+5168|0;P=f[L>>2]|0;E=r+5180|0;break}else{L=e+40|0;P=f[L>>2]|0;E=e+44|0}}while(0);Ao(C,P,f[E>>2]|0);if(!(ko(C,1)|0)){Lo(C)|0;u=Mo(C)|0;t=P+u|0;To(C);do{if(f[r>>2]&4){if(((f[E>>2]|0)-t+(f[L>>2]|0)|0)>>>0<2){Jn(l,2,22135,w)|0;break}if((h[t>>0]|0)==-1?(h[P+(u+1)>>0]|0)==-110:0){t=P+(u+2)|0;break}Jn(l,2,22177,x)|0}}while(0);f[E>>2]=(f[E>>2]|0)+((f[L>>2]|0)-t);f[L>>2]=t;f[i>>2]=0;f[o>>2]=(f[N>>2]|0)-a;a=1;b=U;return a|0}k=T+(M*136|0)+24|0;t=f[k>>2]|0;e:do{if(t){A=n+32|0;R=r+5584|0;S=0;T=T+(M*136|0)+28|0;t:while(1){u=f[A>>2]|0;c=f[T+20>>2]|0;if(((f[T+8>>2]|0)!=(f[T>>2]|0)?(f[T+12>>2]|0)!=(f[T+4>>2]|0):0)?(H=ce(f[c+(u*40|0)+20>>2]|0,f[c+(u*40|0)+16>>2]|0)|0,(H|0)!=0):0){e=c+(u*40|0)+32|0;n=c+(u*40|0)+36|0;w=T+28|0;x=0;s=f[c+(u*40|0)+24>>2]|0;while(1){u=s+44|0;if(!(f[u>>2]|0))t=go(C,f[e>>2]|0,x,(f[I>>2]|0)+1|0)|0;else t=ko(C,1)|0;r:do{if(!t)f[s+40>>2]=0;else{if(!(f[u>>2]|0)){t=0;while(1)if(!(go(C,f[n>>2]|0,x,t)|0))t=t+1|0;else break;f[s+24>>2]=1-t+(f[w>>2]|0);f[s+28>>2]=3}do{if(ko(C,1)|0)if(ko(C,1)|0){t=ko(C,2)|0;if((t|0)!=3){t=t+3|0;break}t=ko(C,5)|0;if((t|0)==31){t=(ko(C,7)|0)+37|0;break}else{t=t+6|0;break}}else t=2;else t=1}while(0);y=s+40|0;f[y>>2]=t;t=0;while(1)if(!(ko(C,1)|0))break;else t=t+1|0;_=s+28|0;f[_>>2]=(f[_>>2]|0)+t;u=f[u>>2]|0;do{if(!u){c=f[(f[R>>2]|0)+((f[O>>2]|0)*1080|0)+16>>2]|0;t=s+52|0;if(!(f[t>>2]|0)){f[t>>2]=10;d=s+4|0;u=Qi(f[d>>2]|0,320)|0;if(!u){u=t;c=d;t=d;d=66;break t}f[d>>2]=u}else u=f[s+4>>2]|0;f[u>>2]=0;f[u+4>>2]=0;f[u+8>>2]=0;f[u+12>>2]=0;f[u+16>>2]=0;f[u+20>>2]=0;f[u+24>>2]=0;f[u+28>>2]=0;if(c&4){f[u+20>>2]=1;u=0;break}u=u+20|0;if(!(c&1)){f[u>>2]=109;u=0;break}else{f[u>>2]=10;u=0;break}}else{m=u+-1|0;g=s+4|0;c=f[g>>2]|0;if((f[c+(m<<5)+8>>2]|0)!=(f[c+(m<<5)+20>>2]|0)){t=s+52|0;u=m;break}p=f[(f[R>>2]|0)+((f[O>>2]|0)*1080|0)+16>>2]|0;t=s+52|0;d=f[t>>2]|0;if((u+1|0)>>>0>d>>>0){M=d+10|0;f[t>>2]=M;c=Qi(c,M<<5)|0;if(!c){c=g;u=t;t=g;d=77;break t}f[g>>2]=c}M=c+(u<<5)|0;f[M>>2]=0;f[M+4>>2]=0;f[M+8>>2]=0;f[M+12>>2]=0;f[M+16>>2]=0;f[M+20>>2]=0;f[M+24>>2]=0;f[M+28>>2]=0;if(p&4){f[c+(u<<5)+20>>2]=1;break}if(!(p&1)){f[c+(u<<5)+20>>2]=109;break}else{M=f[c+(m<<5)+20>>2]|0;f[c+(u<<5)+20>>2]=(M|0)==1|(M|0)==10?2:1;break}}}while(0);v=s+4|0;m=f[y>>2]|0;while(1){p=f[v>>2]|0;c=(f[p+(u<<5)+20>>2]|0)-(f[p+(u<<5)+8>>2]|0)|0;c=(c|0)<(m|0)?c:m;f[p+(u<<5)+24>>2]=c;p=f[_>>2]|0;if(c>>>0>1){d=0;while(1){d=d+1|0;if(c>>>0>3)c=c>>>1;else{c=d;break}}}else c=0;p=ko(C,c+p|0)|0;c=f[v>>2]|0;f[c+(u<<5)+28>>2]=p;p=m-(f[c+(u<<5)+24>>2]|0)|0;if((p|0)<=0)break r;m=u+1|0;g=f[(f[R>>2]|0)+((f[O>>2]|0)*1080|0)+16>>2]|0;d=f[t>>2]|0;if((u+2|0)>>>0>d>>>0){M=d+10|0;f[t>>2]=M;c=Qi(c,M<<5)|0;if(!c){c=v;u=v;d=90;break t}f[v>>2]=c}M=c+(m<<5)|0;f[M>>2]=0;f[M+4>>2]=0;f[M+8>>2]=0;f[M+12>>2]=0;f[M+16>>2]=0;f[M+20>>2]=0;f[M+24>>2]=0;f[M+28>>2]=0;if(g&4){f[c+(m<<5)+20>>2]=1;u=m;m=p;continue}if(!(g&1)){f[c+(m<<5)+20>>2]=109;u=m;m=p;continue}else{M=f[c+(u<<5)+20>>2]|0;f[c+(m<<5)+20>>2]=(M|0)==1|(M|0)==10?2:1;u=m;m=p;continue}}}}while(0);x=x+1|0;if(x>>>0>=H>>>0)break;else s=s+56|0}t=f[k>>2]|0}S=S+1|0;if(S>>>0>=t>>>0)break e;else T=T+36|0}if((d|0)==66){Ji(f[t>>2]|0);f[c>>2]=0;f[u>>2]=0;To(C);a=0;b=U;return a|0}else if((d|0)==77){Ji(f[t>>2]|0);f[c>>2]=0;f[u>>2]=0;To(C);a=0;b=U;return a|0}else if((d|0)==90){Ji(f[u>>2]|0);f[c>>2]=0;f[t>>2]=0;To(C);a=0;b=U;return a|0}}}while(0);if(!(Lo(C)|0)){To(C);a=0;b=U;return a|0}u=Mo(C)|0;t=P+u|0;To(C);do{if(f[r>>2]&4){if(((f[E>>2]|0)-t+(f[L>>2]|0)|0)>>>0<2){Jn(l,2,22135,D)|0;break}if((h[t>>0]|0)==-1?(h[P+(u+1)>>0]|0)==-110:0){t=P+(u+2)|0;break}Jn(l,2,22177,F)|0}}while(0);f[E>>2]=(f[E>>2]|0)+((f[L>>2]|0)-t);f[L>>2]=t;f[i>>2]=1;f[o>>2]=(f[N>>2]|0)-a;a=1;b=U;return a|0}function ls(){return Yi(104)|0}function us(e){e=e|0;if(!e)return;Ji(e);return}function cs(e){e=e|0;return(f[e+12>>2]|0)-(f[e+16>>2]|0)|0}function hs(e,t){e=e|0;t=t|0;var r=0,n=0;f[e+100>>2]=e+24;f[e+4>>2]=32768;f[e>>2]=0;n=t+-1|0;f[e+12>>2]=n;r=e+8|0;f[r>>2]=12;f[r>>2]=(h[n>>0]|0)==-1?13:12;f[e+16>>2]=t;return}function ds(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0;i=f[e+100>>2]|0;a=f[i>>2]|0;s=(f[a+4>>2]|0)==(t|0);n=f[a>>2]|0;l=e+4|0;t=(f[l>>2]|0)-n|0;f[l>>2]=t;if(!s){if(t>>>0<n>>>0){s=(f[e>>2]|0)+n|0;f[e>>2]=s;n=t;t=s;s=e}else{f[l>>2]=n;t=f[e>>2]|0;s=e}f[i>>2]=f[a+12>>2];o=e+8|0;a=e+12|0;i=t;t=f[o>>2]|0;while(1){n=n<<1;f[l>>2]=n;r=i<<1;f[s>>2]=r;t=t+-1|0;f[o>>2]=t;if(!t){t=f[a>>2]|0;n=h[t>>0]|0;do{if(n<<24>>24!=-1){if(!(r&134217728)){r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>18;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}h[t>>0]=n+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){e=f[s>>2]&134217727;f[s>>2]=e;r=t+1|0;f[a>>2]=r;h[r>>0]=e>>>20;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7;break}else{r=t+1|0;f[a>>2]=r;h[r>>0]=(f[s>>2]|0)>>>19;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}}else{r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>19;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7}}while(0);n=f[l>>2]|0}if(!(n&32768))i=r;else break}return}if(t&32768){f[e>>2]=(f[e>>2]|0)+n;return}if(t>>>0<n>>>0){f[l>>2]=n;r=f[e>>2]|0;s=e}else{r=(f[e>>2]|0)+n|0;f[e>>2]=r;n=t;s=e}f[i>>2]=f[a+8>>2];o=e+8|0;a=e+12|0;i=r;t=f[o>>2]|0;while(1){n=n<<1;f[l>>2]=n;r=i<<1;f[s>>2]=r;t=t+-1|0;f[o>>2]=t;if(!t){t=f[a>>2]|0;n=h[t>>0]|0;do{if(n<<24>>24!=-1){if(!(r&134217728)){r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>18;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}h[t>>0]=n+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){e=f[s>>2]&134217727;f[s>>2]=e;r=t+1|0;f[a>>2]=r;h[r>>0]=e>>>20;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7;break}else{r=t+1|0;f[a>>2]=r;h[r>>0]=(f[s>>2]|0)>>>19;r=f[s>>2]&524287;f[s>>2]=r;f[o>>2]=8;t=8;break}}else{r=t+1|0;f[a>>2]=r;h[r>>0]=i>>>19;r=f[s>>2]&1048575;f[s>>2]=r;f[o>>2]=7;t=7}}while(0);n=f[l>>2]|0}if(!(n&32768))i=r;else break}return}function fs(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;a=f[e>>2]|0;n=a|65535;i=e+8|0;n=(n>>>0<((f[e+4>>2]|0)+a|0)>>>0?n:n+-32768|0)<<f[i>>2];f[e>>2]=n;a=e+12|0;t=f[a>>2]|0;r=h[t>>0]|0;do{if(r<<24>>24!=-1){if(!(n&134217728)){t=t+1|0;f[a>>2]=t;h[t>>0]=n>>>19;t=f[e>>2]&524287;f[e>>2]=t;f[i>>2]=8;r=8;break}h[t>>0]=r+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){r=f[e>>2]&134217727;f[e>>2]=r;t=t+1|0;f[a>>2]=t;h[t>>0]=r>>>20;t=f[e>>2]&1048575;f[e>>2]=t;f[i>>2]=7;r=7;break}else{t=t+1|0;f[a>>2]=t;h[t>>0]=(f[e>>2]|0)>>>19;t=f[e>>2]&524287;f[e>>2]=t;f[i>>2]=8;r=8;break}}else{t=t+1|0;f[a>>2]=t;h[t>>0]=n>>>20;t=f[e>>2]&1048575;f[e>>2]=t;f[i>>2]=7;r=7}}while(0);t=t<<r;f[e>>2]=t;r=f[a>>2]|0;n=h[r>>0]|0;do{if(n<<24>>24!=-1){if(!(t&134217728)){n=r+1|0;f[a>>2]=n;h[n>>0]=t>>>19;f[e>>2]=f[e>>2]&524287;f[i>>2]=8;break}h[r>>0]=n+1<<24>>24;t=f[a>>2]|0;if((h[t>>0]|0)==-1){r=f[e>>2]&134217727;f[e>>2]=r;n=t+1|0;f[a>>2]=n;h[n>>0]=r>>>20;f[e>>2]=f[e>>2]&1048575;f[i>>2]=7;break}else{n=t+1|0;f[a>>2]=n;h[n>>0]=(f[e>>2]|0)>>>19;f[e>>2]=f[e>>2]&524287;f[i>>2]=8;break}}else{n=r+1|0;f[a>>2]=n;h[n>>0]=t>>>20;f[e>>2]=f[e>>2]&1048575;f[i>>2]=7}}while(0);t=f[a>>2]|0;if((h[t>>0]|0)==-1)return;f[a>>2]=t+1;return}function ps(e){e=e|0;f[e>>2]=0;f[e+8>>2]=8;return}function ms(e,t){e=e|0;t=t|0;var r=0,n=0,i=0;r=e+8|0;n=(f[r>>2]|0)+-1|0;f[r>>2]=n;t=(t<<n)+(f[e>>2]|0)|0;f[e>>2]=t;if(n)return;n=e+12|0;i=(f[n>>2]|0)+1|0;f[n>>2]=i;h[i>>0]=t;f[r>>2]=8;f[r>>2]=(h[f[n>>2]>>0]|0)==-1?7:8;f[e>>2]=0;return}function gs(e){e=e|0;f[e+28>>2]=1156;f[e+32>>2]=1156;f[e+36>>2]=1156;f[e+40>>2]=1156;f[e+44>>2]=1156;f[e+48>>2]=1156;f[e+52>>2]=1156;f[e+56>>2]=1156;f[e+60>>2]=1156;f[e+64>>2]=1156;f[e+68>>2]=1156;f[e+72>>2]=1156;f[e+76>>2]=1156;f[e+80>>2]=1156;f[e+84>>2]=1156;f[e+88>>2]=1156;f[e+96>>2]=2628;f[e+92>>2]=1252;f[e+24>>2]=1284;return}function vs(e){e=e|0;f[e+24>>2]=1156;f[e+28>>2]=1156;f[e+32>>2]=1156;f[e+36>>2]=1156;f[e+40>>2]=1156;f[e+44>>2]=1156;f[e+48>>2]=1156;f[e+52>>2]=1156;f[e+56>>2]=1156;f[e+60>>2]=1156;f[e+64>>2]=1156;f[e+68>>2]=1156;f[e+72>>2]=1156;f[e+76>>2]=1156;f[e+80>>2]=1156;f[e+84>>2]=1156;f[e+88>>2]=1156;f[e+92>>2]=1156;f[e+96>>2]=1156;return}function ys(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;f[e+24+(t<<2)>>2]=1156+((n<<1)+r<<4);return}function _s(e){e=e|0;var t=0,r=0;f[e+100>>2]=e+24;f[e+4>>2]=32768;f[e>>2]=0;t=e+8|0;f[t>>2]=12;r=e+12|0;e=(f[r>>2]|0)+-1|0;f[r>>2]=e;if((h[e>>0]|0)!=-1)return;f[t>>2]=13;return}function bs(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;o=e+8|0;t=f[o>>2]|0;n=12-t|0;if((n|0)>0){i=e+12|0;r=f[e>>2]|0;do{t=r<<t;f[e>>2]=t;f[o>>2]=0;r=f[i>>2]|0;a=h[r>>0]|0;do{if(a<<24>>24!=-1){if(!(t&134217728)){r=r+1|0;f[i>>2]=r;h[r>>0]=t>>>19;r=f[e>>2]&524287;f[e>>2]=r;f[o>>2]=8;t=8;break}h[r>>0]=a+1<<24>>24;t=f[i>>2]|0;if((h[t>>0]|0)==-1){a=f[e>>2]&134217727;f[e>>2]=a;r=t+1|0;f[i>>2]=r;h[r>>0]=a>>>20;r=f[e>>2]&1048575;f[e>>2]=r;f[o>>2]=7;t=7;break}else{r=t+1|0;f[i>>2]=r;h[r>>0]=(f[e>>2]|0)>>>19;r=f[e>>2]&524287;f[e>>2]=r;f[o>>2]=8;t=8;break}}else{r=r+1|0;f[i>>2]=r;h[r>>0]=t>>>20;r=f[e>>2]&1048575;f[e>>2]=r;f[o>>2]=7;t=7}}while(0);n=n-t|0}while((n|0)>0)}else i=e+12|0;t=f[i>>2]|0;r=h[t>>0]|0;if(r<<24>>24==-1)return;n=f[e>>2]|0;if(!(n&134217728)){a=t+1|0;f[i>>2]=a;h[a>>0]=n>>>19;f[e>>2]=f[e>>2]&524287;f[o>>2]=8;return}h[t>>0]=r+1<<24>>24;t=f[i>>2]|0;if((h[t>>0]|0)==-1){n=f[e>>2]&134217727;f[e>>2]=n;a=t+1|0;f[i>>2]=a;h[a>>0]=n>>>20;f[e>>2]=f[e>>2]&1048575;f[o>>2]=7;return}else{a=t+1|0;f[i>>2]=a;h[a>>0]=(f[e>>2]|0)>>>19;f[e>>2]=f[e>>2]&524287;f[o>>2]=8;return}}function Es(e){e=e|0;f[e+100>>2]=e+96;ds(e,1);ds(e,0);ds(e,1);ds(e,0);return}function ws(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;f[e+100>>2]=e+24;f[e+16>>2]=t;f[e+20>>2]=t+r;i=e+12|0;f[i>>2]=t;do{if(r){a=p[t>>0]<<16;f[e>>2]=a;n=t+1|0;if((r|0)==1)r=255;else r=p[n>>0]|0;if((h[t>>0]|0)!=-1){f[i>>2]=n;n=a|r<<8;f[e>>2]=n;r=e+8|0;f[r>>2]=8;i=e;a=1;break}if(r>>>0>143){n=a|65280;f[e>>2]=n;r=e+8|0;f[r>>2]=8;i=e;a=1;break}else{f[i>>2]=n;n=a+(r<<9)|0;f[e>>2]=n;r=e+8|0;f[r>>2]=7;i=e;a=0;break}}else{f[e>>2]=16776960;r=e+8|0;f[r>>2]=8;n=16776960;i=e;a=1}}while(0);f[i>>2]=n<<7;f[r>>2]=a;f[e+4>>2]=32768;return 1}function xs(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;r=f[e+100>>2]|0;n=f[r>>2]|0;o=f[n>>2]|0;c=e+4|0;a=(f[c>>2]|0)-o|0;f[c>>2]=a;i=f[e>>2]|0;if(i>>>16>>>0<o>>>0){f[c>>2]=o;t=f[n+4>>2]|0;if(a>>>0<o>>>0)f[r>>2]=f[n+8>>2];else{f[r>>2]=f[n+12>>2];t=1-t|0}s=e+8|0;l=e+12|0;u=e+20|0;n=f[s>>2]|0;r=i;do{do{if(!n){i=f[l>>2]|0;n=f[u>>2]|0;if((i|0)==(n|0)){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}a=i+1|0;if((a|0)==(n|0))n=255;else n=p[a>>0]|0;if((h[i>>0]|0)!=-1){f[l>>2]=a;r=r+(n<<8)|0;f[e>>2]=r;f[s>>2]=8;n=8;break}if(n>>>0>143){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}else{f[l>>2]=a;r=r+(n<<9)|0;f[e>>2]=r;f[s>>2]=7;n=7;break}}}while(0);o=o<<1;f[c>>2]=o;r=r<<1;f[e>>2]=r;n=n+-1|0;f[s>>2]=n}while(o>>>0<32768);return t|0}i=i-(o<<16)|0;f[e>>2]=i;if(a&32768){e=f[n+4>>2]|0;return e|0}t=f[n+4>>2]|0;if(o>>>0>a>>>0){f[r>>2]=f[n+12>>2];t=1-t|0}else f[r>>2]=f[n+8>>2];s=e+8|0;l=e+12|0;u=e+20|0;n=f[s>>2]|0;r=i;o=a;do{do{if(!n){i=f[l>>2]|0;n=f[u>>2]|0;if((i|0)==(n|0)){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}a=i+1|0;if((a|0)==(n|0))n=255;else n=p[a>>0]|0;if((h[i>>0]|0)!=-1){f[l>>2]=a;r=r+(n<<8)|0;f[e>>2]=r;f[s>>2]=8;n=8;break}if(n>>>0>143){r=r+65280|0;f[e>>2]=r;f[s>>2]=8;n=8;break}else{f[l>>2]=a;r=r+(n<<9)|0;f[e>>2]=r;f[s>>2]=7;n=7;break}}}while(0);o=o<<1;f[c>>2]=o;r=r<<1;f[e>>2]=r;n=n+-1|0;f[s>>2]=n}while(o>>>0<32768);return t|0}function Ts(){return Yi(28)|0}function Ms(e){e=e|0;if(!e)return;Ji(e);return}function Ss(e,t,r){e=e|0;t=t|0;r=r|0;f[e+20>>2]=t;f[e+8>>2]=r;f[e+12>>2]=0;h[e>>0]=0;f[e+4>>2]=0;return}function As(e){e=e|0;var t=0,r=0,n=0,i=0,a=0;i=e+4|0;t=f[i>>2]|0;do{if(!t){f[i>>2]=8;r=e+12|0;n=f[r>>2]|0;if((n|0)==(f[e+8>>2]|0)){h[e>>0]=-1;t=8;r=-1;break}if((h[e>>0]|0)==-1){f[i>>2]=7;t=7}else t=8;a=h[(f[e+20>>2]|0)+n>>0]|0;h[e>>0]=a;f[r>>2]=n+1;r=a}else r=h[e>>0]|0}while(0);a=t+-1|0;f[i>>2]=a;return(r&255)>>>a&1|0}function Rs(){var e=0;if(!(f[665]|0))e=2712;else{e=(Be()|0)+60|0;e=f[e>>2]|0}return e|0}function ks(e){e=e|0;var t=0,r=0;t=0;while(1){if((p[22198+t>>0]|0)==(e|0)){r=2;break}t=t+1|0;if((t|0)==87){t=87;e=22286;r=5;break}}if((r|0)==2)if(!t)e=22286;else{e=22286;r=5}if((r|0)==5)while(1){r=e;while(1){e=r+1|0;if(!(h[r>>0]|0))break;else r=e}t=t+-1|0;if(!t)break;else r=5}return e|0}function Ps(e){e=e|0;var t=0;if(e>>>0>4294963200){t=Rs()|0;f[t>>2]=0-e;e=-1}return e|0}function Ls(e,t){e=+e;t=t|0;var r=0,n=0,i=0;y[w>>3]=e;r=f[w>>2]|0;n=f[w+4>>2]|0;i=Xl(r|0,n|0,52)|0;i=i&2047;switch(i|0){case 0:{if(e!=0.0){e=+Ls(e*18446744073709551616.0,t);r=(f[t>>2]|0)+-64|0}else r=0;f[t>>2]=r;break}case 2047:break;default:{f[t>>2]=i+-1022;f[w>>2]=r;f[w+4>>2]=n&-2146435073|1071644672;e=+y[w>>3]}}return+e}function Cs(e,t){e=+e;t=t|0;return+ +Ls(e,t)}function Is(e,t){e=+e;t=t|0;return+ +Ds(e,t)}function Hs(e){e=+e;return~~+Os(e)|0}function Os(e){e=+e;var t=0;t=(v[w>>2]=e,f[w>>2]|0);if((t&2130706432)>>>0<=1249902592){t=(t|0)<0;e=t?e+-8388608.0+8388608.0:e+8388608.0+-8388608.0;if(e==0.0)e=t?-0.0:0.0}return+e}function Ds(e,t){e=+e;t=t|0;var r=0;if((t|0)>1023){e=e*8988465674311579538646525.0e283;r=t+-1023|0;if((r|0)>1023){r=t+-2046|0;r=(r|0)>1023?1023:r;e=e*8988465674311579538646525.0e283}}else if((t|0)<-1022){e=e*2.2250738585072014e-308;r=t+1022|0;if((r|0)<-1022){r=t+2044|0;r=(r|0)<-1022?-1022:r;e=e*2.2250738585072014e-308}}else r=t;r=Gl(r+1023|0,0,52)|0;t=B;f[w>>2]=r;f[w+4>>2]=t;return+(e*+y[w>>3])}function Fs(e,t,r){e=e|0;t=t|0;r=r|0;do{if(e){if(t>>>0<128){h[e>>0]=t;e=1;break}if(t>>>0<2048){h[e>>0]=t>>>6|192;h[e+1>>0]=t&63|128;e=2;break}if(t>>>0<55296|(t&-8192|0)==57344){h[e>>0]=t>>>12|224;h[e+1>>0]=t>>>6&63|128;h[e+2>>0]=t&63|128;e=3;break}if((t+-65536|0)>>>0<1048576){h[e>>0]=t>>>18|240;h[e+1>>0]=t>>>12&63|128;h[e+2>>0]=t>>>6&63|128;h[e+3>>0]=t&63|128;e=4;break}else{e=Rs()|0;f[e>>2]=84;e=-1;break}}else e=1}while(0);return e|0}function Ns(e,t){e=e|0;t=t|0;if(!e)e=0;else e=Fs(e,t,0)|0;return e|0}function Us(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0;d=b;b=b+112|0;c=d+40|0;l=d+24|0;s=d+16|0;i=d;u=d+52|0;n=h[t>>0]|0;if(yl(24090,n<<24>>24,4)|0){r=Cl(1144)|0;if(!r)r=0;else{a=r;o=a+112|0;do{f[a>>2]=0;a=a+4|0}while((a|0)<(o|0));if(!(bl(t,43)|0))f[r>>2]=n<<24>>24==114?8:4;if(bl(t,101)|0){f[i>>2]=e;f[i+4>>2]=2;f[i+8>>2]=1;ke(221,i|0)|0;n=h[t>>0]|0}if(n<<24>>24==97){f[s>>2]=e;f[s+4>>2]=3;n=ke(221,s|0)|0;if(!(n&1024)){f[l>>2]=e;f[l+4>>2]=4;f[l+8>>2]=n|1024;ke(221,l|0)|0}t=f[r>>2]|128;f[r>>2]=t}else t=f[r>>2]|0;f[r+60>>2]=e;f[r+44>>2]=r+120;f[r+48>>2]=1024;n=r+75|0;h[n>>0]=-1;if((t&8|0)==0?(f[c>>2]=e,f[c+4>>2]=21505,f[c+8>>2]=u,(Ve(54,c|0)|0)==0):0)h[n>>0]=10;f[r+32>>2]=60;f[r+36>>2]=61;f[r+40>>2]=3;f[r+12>>2]=1;if(!(f[666]|0))f[r+76>>2]=-1;Xe(2688);n=f[671]|0;f[r+56>>2]=n;if(n)f[n+52>>2]=r;f[671]=r;Ge(2688)}}else{r=Rs()|0;f[r>>2]=22;r=0}b=d;return r|0}function Bs(e){e=e|0;var t=0,r=0,n=0;r=(bl(e,43)|0)==0;t=h[e>>0]|0;r=r?t<<24>>24!=114&1:2;n=(bl(e,120)|0)==0;r=n?r:r|128;e=(bl(e,101)|0)==0;e=e?r:r|524288;e=t<<24>>24==114?e:e|64;e=t<<24>>24==119?e|512:e;return(t<<24>>24==97?e|1024:e)|0}function zs(e){e=e|0;return 0}function js(e){e=e|0;return}function Vs(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0;l=b;b=b+16|0;s=l;o=t&255;h[s>>0]=o;n=e+16|0;i=f[n>>2]|0;if(!i)if(!(Ks(e)|0)){i=f[n>>2]|0;a=4}else r=-1;else a=4;do{if((a|0)==4){n=e+20|0;a=f[n>>2]|0;if(a>>>0<i>>>0?(r=t&255,(r|0)!=(h[e+75>>0]|0)):0){f[n>>2]=a+1;h[a>>0]=o;break}if((ku[f[e+36>>2]&63](e,s,1)|0)==1)r=p[s>>0]|0;else r=-1}}while(0);b=l;return r|0}function Gs(e){e=e|0;var t=0,r=0;t=b;b=b+16|0;r=t;f[r>>2]=f[e+60>>2];e=Ps(Ye(6,r|0)|0)|0;b=t;return e|0}function Ws(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0;u=b;b=b+48|0;a=u+16|0;i=u;n=u+32|0;f[n>>2]=t;o=n+4|0;l=e+48|0;c=f[l>>2]|0;f[o>>2]=r-((c|0)!=0&1);s=e+44|0;f[n+8>>2]=f[s>>2];f[n+12>>2]=c;if(!(f[665]|0)){f[a>>2]=f[e+60>>2];f[a+4>>2]=n;f[a+8>>2]=2;n=Ps(Qe(145,a|0)|0)|0}else{Ce(5,e|0);f[i>>2]=f[e+60>>2];f[i+4>>2]=n;f[i+8>>2]=2;n=Ps(Qe(145,i|0)|0)|0;Re(0)}if((n|0)>=1){o=f[o>>2]|0;if(n>>>0>o>>>0){a=f[s>>2]|0;i=e+4|0;f[i>>2]=a;f[e+8>>2]=a+(n-o);if(!(f[l>>2]|0))n=r;else{f[i>>2]=a+1;h[t+(r+-1)>>0]=h[a>>0]|0;n=r}}}else{f[e>>2]=f[e>>2]|n&48^16;f[e+8>>2]=0;f[e+4>>2]=0}b=u;return n|0}function Xs(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;i=b;b=b+32|0;a=i;n=i+20|0;f[a>>2]=f[e+60>>2];f[a+4>>2]=0;f[a+8>>2]=t;f[a+12>>2]=n;f[a+16>>2]=r;if((Ps(Ke(140,a|0)|0)|0)<0){f[n>>2]=-1;e=-1}else e=f[n>>2]|0;b=i;return e|0}function Ys(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;m=b;b=b+48|0;h=m+16|0;c=m;n=m+32|0;d=e+28|0;i=f[d>>2]|0;f[n>>2]=i;p=e+20|0;i=(f[p>>2]|0)-i|0;f[n+4>>2]=i;f[n+8>>2]=t;f[n+12>>2]=r;l=e+60|0;u=e+44|0;t=2;i=i+r|0;while(1){if(!(f[665]|0)){f[h>>2]=f[l>>2];f[h+4>>2]=n;f[h+8>>2]=t;o=Ps(Je(146,h|0)|0)|0}else{Ce(6,e|0);f[c>>2]=f[l>>2];f[c+4>>2]=n;f[c+8>>2]=t;o=Ps(Je(146,c|0)|0)|0;Re(0)}if((i|0)==(o|0)){i=6;break}if((o|0)<0){i=8;break}i=i-o|0;a=f[n+4>>2]|0;if(o>>>0<=a>>>0)if((t|0)==2){f[d>>2]=(f[d>>2]|0)+o;s=a;t=2}else s=a;else{s=f[u>>2]|0;f[d>>2]=s;f[p>>2]=s;s=f[n+12>>2]|0;o=o-a|0;n=n+8|0;t=t+-1|0}f[n>>2]=(f[n>>2]|0)+o;f[n+4>>2]=s-o}if((i|0)==6){h=f[u>>2]|0;f[e+16>>2]=h+(f[e+48>>2]|0);e=h;f[d>>2]=e;f[p>>2]=e}else if((i|0)==8){f[e+16>>2]=0;f[d>>2]=0;f[p>>2]=0;f[e>>2]=f[e>>2]|32;if((t|0)==2)r=0;else r=r-(f[n+4>>2]|0)|0}b=m;return r|0}function qs(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;i=b;b=b+80|0;n=i;f[e+36>>2]=61;if((f[e>>2]&64|0)==0?(f[n>>2]=f[e+60>>2],f[n+4>>2]=21505,f[n+8>>2]=i+12,(Ve(54,n|0)|0)!=0):0)h[e+75>>0]=-1;n=Ys(e,t,r)|0;b=i;return n|0}function Zs(e){e=e|0;var t=0,r=0;t=e+74|0;r=h[t>>0]|0;h[t>>0]=r+255|r;t=e+20|0;r=e+44|0;if((f[t>>2]|0)>>>0>(f[r>>2]|0)>>>0)ku[f[e+36>>2]&63](e,0,0)|0;f[e+16>>2]=0;f[e+28>>2]=0;f[t>>2]=0;t=f[e>>2]|0;if(t&20)if(!(t&4))t=-1;else{f[e>>2]=t|32;t=-1}else{t=f[r>>2]|0;f[e+8>>2]=t;f[e+4>>2]=t;t=0}return t|0}function Ks(e){e=e|0;var t=0,r=0;t=e+74|0;r=h[t>>0]|0;h[t>>0]=r+255|r;t=f[e>>2]|0;if(!(t&8)){f[e+8>>2]=0;f[e+4>>2]=0;t=f[e+44>>2]|0;f[e+28>>2]=t;f[e+20>>2]=t;f[e+16>>2]=t+(f[e+48>>2]|0);t=0}else{f[e>>2]=t|32;t=-1}return t|0}function Qs(e){e=e|0;var t=0,r=0,n=0;n=(f[e>>2]&1|0)!=0;if(!n){Xe(2688);r=f[e+52>>2]|0;t=e+56|0;if(r)f[r+56>>2]=f[t>>2];t=f[t>>2]|0;if(t)f[t+52>>2]=r;if((f[671]|0)==(e|0))f[671]=t;Ge(2688)}t=Js(e)|0;t=Hu[f[e+12>>2]&15](e)|0|t;r=f[e+92>>2]|0;if(r)Il(r);if(!n)Il(e);return t|0}function Js(e){e=e|0;var t=0,r=0;do{if(e){if((f[e+76>>2]|0)<=-1){t=Sl(e)|0;break}r=(zs(e)|0)==0;t=Sl(e)|0;if(!r)js(e)}else{if(!(f[677]|0))t=0;else t=Js(f[677]|0)|0;Xe(2688);e=f[671]|0;if(e)do{if((f[e+76>>2]|0)>-1)r=zs(e)|0;else r=0;if((f[e+20>>2]|0)>>>0>(f[e+28>>2]|0)>>>0)t=Sl(e)|0|t;if(r)js(e);e=f[e+56>>2]|0}while((e|0)!=0);Ge(2688)}}while(0);return t|0}function $s(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0;i=b;b=b+32|0;n=i+16|0;r=i;if(yl(24090,h[t>>0]|0,4)|0){a=Bs(t)|0|32768;f[r>>2]=e;f[r+4>>2]=a;f[r+8>>2]=438;r=Ps(qe(5,r|0)|0)|0;if((r|0)>=0){e=Us(r,t)|0;if(!e){f[n>>2]=r;Ye(6,n|0)|0;e=0}}else e=0}else{e=Rs()|0;f[e>>2]=22;e=0}b=i;return e|0}function el(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=b;b=b+16|0;i=n;f[i>>2]=r;r=ml(e,t,i)|0;b=n;return r|0}function tl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0;if((f[t+76>>2]|0)>=0?(zs(t)|0)!=0:0){if((h[t+75>>0]|0)!=(e|0)?(n=t+20|0,i=f[n>>2]|0,i>>>0<(f[t+16>>2]|0)>>>0):0){f[n>>2]=i+1;h[i>>0]=e;r=e&255}else r=Vs(t,e)|0;js(t)}else o=3;do{if((o|0)==3){if((h[t+75>>0]|0)!=(e|0)?(a=t+20|0,r=f[a>>2]|0,r>>>0<(f[t+16>>2]|0)>>>0):0){f[a>>2]=r+1;h[r>>0]=e;r=e&255;break}r=Vs(t,e)|0}}while(0);return r|0}function rl(e,t){e=e|0;t=t|0;return(hl(e,xl(e)|0,1,t)|0)+-1|0}function nl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;s=ce(r,t)|0;if((f[n+76>>2]|0)>-1)l=zs(n)|0;else l=0;i=n+74|0;a=h[i>>0]|0;h[i>>0]=a+255|a;i=n+4|0;a=f[i>>2]|0;o=(f[n+8>>2]|0)-a|0;if((o|0)>0){o=o>>>0<s>>>0?o:s;Yl(e|0,a|0,o|0)|0;f[i>>2]=a+o;e=e+o|0;i=s-o|0}else i=s;e:do{if(!i)u=13;else{o=n+32|0;a=i;while(1){if(Zs(n)|0){r=a;break}i=ku[f[o>>2]&63](n,e,a)|0;if((i+1|0)>>>0<2){r=a;break}if((a|0)==(i|0)){u=13;break e}else{e=e+i|0;a=a-i|0}}if(l)js(n);r=((s-r|0)>>>0)/(t>>>0)|0}}while(0);if((u|0)==13)if(l)js(n);return r|0}function il(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;if((r|0)==1)t=t-(f[e+8>>2]|0)+(f[e+4>>2]|0)|0;i=e+20|0;n=e+28|0;if((f[i>>2]|0)>>>0>(f[n>>2]|0)>>>0?(ku[f[e+36>>2]&63](e,0,0)|0,(f[i>>2]|0)==0):0)t=-1;else{f[e+16>>2]=0;f[n>>2]=0;f[i>>2]=0;if((ku[f[e+40>>2]&63](e,t,r)|0)<0)t=-1;else{f[e+8>>2]=0;f[e+4>>2]=0;f[e>>2]=f[e>>2]&-17;t=0}}return t|0}function al(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if((f[e+76>>2]|0)>-1){n=(zs(e)|0)==0;t=il(e,t,r)|0;if(!n)js(e)}else t=il(e,t,r)|0;return t|0}function ol(e,t,r){e=e|0;t=t|0;r=r|0;return al(e,t,r)|0}function sl(e){e=e|0;var t=0;if(!(f[e>>2]&128))t=1;else t=(f[e+20>>2]|0)>>>0>(f[e+28>>2]|0)>>>0?2:1;t=ku[f[e+40>>2]&63](e,0,t)|0;if((t|0)>=0)t=t-(f[e+8>>2]|0)+(f[e+4>>2]|0)+(f[e+20>>2]|0)-(f[e+28>>2]|0)|0;return t|0}function ll(e){e=e|0;var t=0;if((f[e+76>>2]|0)>-1){t=(zs(e)|0)==0;e=sl(e)|0}else e=sl(e)|0;return e|0}function ul(e){e=e|0;return ll(e)|0}function cl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0;n=r+16|0;i=f[n>>2]|0;if(!i)if(!(Ks(r)|0)){i=f[n>>2]|0;a=4}else n=0;else a=4;e:do{if((a|0)==4){o=r+20|0;a=f[o>>2]|0;if((i-a|0)>>>0<t>>>0){n=ku[f[r+36>>2]&63](r,e,t)|0;break}t:do{if((h[r+75>>0]|0)>-1){n=t;while(1){if(!n){i=a;n=0;break t}i=n+-1|0;if((h[e+i>>0]|0)==10)break;else n=i}if((ku[f[r+36>>2]&63](r,e,n)|0)>>>0<n>>>0)break e;t=t-n|0;e=e+n|0;i=f[o>>2]|0}else{i=a;n=0}}while(0);Yl(i|0,e|0,t|0)|0;f[o>>2]=(f[o>>2]|0)+t;n=n+t|0}}while(0);return n|0}function hl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;i=ce(r,t)|0;if((f[n+76>>2]|0)>-1){a=(zs(n)|0)==0;e=cl(e,i,n)|0;if(!a)js(n)}else e=cl(e,i,n)|0;if((e|0)!=(i|0))r=(e>>>0)/(t>>>0)|0;return r|0}function dl(e,t){e=e|0;t=t|0;var r=0,n=0;r=b;b=b+16|0;n=r;f[n>>2]=t;t=ml(f[676]|0,e,n)|0;b=r;return t|0}function fl(e){e=e|0;var t=0,r=0,n=0,i=0;n=f[676]|0;if((f[n+76>>2]|0)>-1)i=zs(n)|0;else i=0;do{if((rl(e,n)|0)<0)t=1;else{if((h[n+75>>0]|0)!=10?(t=n+20|0,r=f[t>>2]|0,r>>>0<(f[n+16>>2]|0)>>>0):0){f[t>>2]=r+1;h[r>>0]=10;t=0;break}t=(Vs(n,10)|0)<0}}while(0);if(i)js(n);return t<<31>>31|0}function pl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=b;b=b+16|0;i=n;f[i>>2]=r;r=vl(e,t,i)|0;b=n;return r|0}function ml(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,p=0,m=0,g=0,v=0;v=b;b=b+224|0;d=v+80|0;g=v+96|0;m=v;p=v+136|0;n=g;i=n+40|0;do{f[n>>2]=0;n=n+4|0}while((n|0)<(i|0));f[d>>2]=f[r>>2];if((Al(0,t,d,m,g)|0)<0)r=-1;else{if((f[e+76>>2]|0)>-1)u=zs(e)|0;else u=0;r=f[e>>2]|0;c=r&32;if((h[e+74>>0]|0)<1)f[e>>2]=r&-33;r=e+48|0;if(!(f[r>>2]|0)){i=e+44|0;a=f[i>>2]|0;f[i>>2]=p;o=e+28|0;f[o>>2]=p;s=e+20|0;f[s>>2]=p;f[r>>2]=80;l=e+16|0;f[l>>2]=p+80;n=Al(e,t,d,m,g)|0;if(a){ku[f[e+36>>2]&63](e,0,0)|0;n=(f[s>>2]|0)==0?-1:n;f[i>>2]=a;f[r>>2]=0;f[l>>2]=0;f[o>>2]=0;f[s>>2]=0}}else n=Al(e,t,d,m,g)|0;r=f[e>>2]|0;f[e>>2]=r|c;if(u)js(e);r=(r&32|0)==0?n:-1}b=v;return r|0}function gl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0,c=0;c=b;b=b+128|0;i=c+112|0;u=c;a=u;o=2716;s=a+112|0;do{f[a>>2]=f[o>>2];a=a+4|0;o=o+4|0}while((a|0)<(s|0));if((t+-1|0)>>>0>2147483646)if(!t){t=1;l=4}else{t=Rs()|0;f[t>>2]=75;t=-1}else{i=e;l=4}if((l|0)==4){l=-2-i|0;l=t>>>0>l>>>0?l:t;f[u+48>>2]=l;e=u+20|0;f[e>>2]=i;f[u+44>>2]=i;t=i+l|0;i=u+16|0;f[i>>2]=t;f[u+28>>2]=t;t=ml(u,r,n)|0;if(l){r=f[e>>2]|0;h[r+(((r|0)==(f[i>>2]|0))<<31>>31)>>0]=0}}b=c;return t|0}function vl(e,t,r){e=e|0;t=t|0;r=r|0;return gl(e,2147483647,t,r)|0}function yl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0;a=t&255;n=(r|0)!=0;e:do{if(n&(e&3|0)!=0){i=t&255;while(1){if((h[e>>0]|0)==i<<24>>24){o=6;break e}e=e+1|0;r=r+-1|0;n=(r|0)!=0;if(!(n&(e&3|0)!=0)){o=5;break}}}else o=5}while(0);if((o|0)==5)if(n)o=6;else r=0;e:do{if((o|0)==6){i=t&255;if((h[e>>0]|0)!=i<<24>>24){n=ce(a,16843009)|0;t:do{if(r>>>0>3)while(1){a=f[e>>2]^n;if((a&-2139062144^-2139062144)&a+-16843009)break;e=e+4|0;r=r+-4|0;if(r>>>0<=3){o=11;break t}}else o=11}while(0);if((o|0)==11)if(!r){r=0;break}while(1){if((h[e>>0]|0)==i<<24>>24)break e;e=e+1|0;r=r+-1|0;if(!r){r=0;break}}}}}while(0);return((r|0)!=0?e:0)|0}function _l(e,t){e=e|0;t=t|0;var r=0,n=0;r=t;e:do{if(!((r^e)&3)){if(r&3)do{r=h[t>>0]|0;h[e>>0]=r;if(!(r<<24>>24))break e;t=t+1|0;e=e+1|0}while((t&3|0)!=0);r=f[t>>2]|0;if(!((r&-2139062144^-2139062144)&r+-16843009)){n=e;while(1){t=t+4|0;e=n+4|0;f[n>>2]=r;r=f[t>>2]|0;if((r&-2139062144^-2139062144)&r+-16843009)break;else n=e}}n=8}else n=8}while(0);if((n|0)==8){n=h[t>>0]|0;h[e>>0]=n;if(n<<24>>24)do{t=t+1|0;e=e+1|0;n=h[t>>0]|0;h[e>>0]=n}while(n<<24>>24!=0)}return e|0}function bl(e,t){e=e|0;t=t|0;e=El(e,t)|0;return((h[e>>0]|0)==(t&255)<<24>>24?e:0)|0}function El(e,t){e=e|0;t=t|0;var r=0,n=0,i=0;n=t&255;e:do{if(!n)e=e+(xl(e)|0)|0;else{if(e&3){r=t&255;do{i=h[e>>0]|0;if(i<<24>>24==0?1:i<<24>>24==r<<24>>24)break e;e=e+1|0}while((e&3|0)!=0)}n=ce(n,16843009)|0;r=f[e>>2]|0;t:do{if(!((r&-2139062144^-2139062144)&r+-16843009))do{i=r^n;if((i&-2139062144^-2139062144)&i+-16843009)break t;e=e+4|0;r=f[e>>2]|0}while(((r&-2139062144^-2139062144)&r+-16843009|0)==0)}while(0);r=t&255;while(1){i=h[e>>0]|0;if(i<<24>>24==0?1:i<<24>>24==r<<24>>24)break;else e=e+1|0}}}while(0);return e|0}function wl(e,t){e=e|0;t=t|0;_l(e,t)|0;return e|0}function xl(e){e=e|0;var t=0,r=0,n=0;n=e;e:do{if(!(n&3))r=4;else{t=e;e=n;while(1){if(!(h[t>>0]|0))break e;t=t+1|0;e=t;if(!(e&3)){e=t;r=4;break}}}}while(0);if((r|0)==4){while(1){t=f[e>>2]|0;if(!((t&-2139062144^-2139062144)&t+-16843009))e=e+4|0;else break}if((t&255)<<24>>24)do{e=e+1|0}while((h[e>>0]|0)!=0)}return e-n|0}function Tl(e){e=e|0;if(!(f[e+68>>2]|0))js(e);return}function Ml(e){e=e|0;if(!(f[e+68>>2]|0))js(e);return}function Sl(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0;t=e+20|0;a=e+28|0;if((f[t>>2]|0)>>>0>(f[a>>2]|0)>>>0?(ku[f[e+36>>2]&63](e,0,0)|0,(f[t>>2]|0)==0):0)t=-1;else{o=e+4|0;r=f[o>>2]|0;n=e+8|0;i=f[n>>2]|0;if(r>>>0<i>>>0)ku[f[e+40>>2]&63](e,r-i|0,1)|0;f[e+16>>2]=0;f[a>>2]=0;f[t>>2]=0;f[n>>2]=0;f[o>>2]=0;t=0}return t|0}function Al(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0.0,c=0,m=0,g=0,v=0,_=0.0,E=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0,U=0,z=0,j=0,V=0,G=0,W=0,X=0,Y=0,q=0,Z=0,K=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0;oe=b;b=b+624|0;te=oe+24|0;ne=oe+16|0;re=oe+588|0;K=oe+576|0;ee=oe;Y=oe+536|0;ae=oe+8|0;ie=oe+528|0;F=(e|0)!=0;N=Y+40|0;X=N;Y=Y+39|0;q=ae+4|0;Z=K+12|0;K=K+11|0;Q=re;J=Z;$=J-Q|0;U=-2-Q|0;z=J+2|0;j=te+288|0;V=re+9|0;G=V;W=re+8|0;a=0;E=t;o=0;t=0;e:while(1){do{if((a|0)>-1)if((o|0)>(2147483647-a|0)){a=Rs()|0;f[a>>2]=75;a=-1;break}else{a=o+a|0;break}}while(0);o=h[E>>0]|0;if(!(o<<24>>24)){D=245;break}else s=E;t:while(1){switch(o<<24>>24){case 37:{o=s;D=9;break t}case 0:{o=s;break t}default:{}}O=s+1|0;o=h[O>>0]|0;s=O}t:do{if((D|0)==9)while(1){D=0;if((h[o+1>>0]|0)!=37)break t;s=s+1|0;o=o+2|0;if((h[o>>0]|0)==37)D=9;else break}}while(0);T=s-E|0;if(F?(f[e>>2]&32|0)==0:0)cl(E,T,e)|0;if((s|0)!=(E|0)){E=o;o=T;continue}c=o+1|0;s=h[c>>0]|0;l=(s<<24>>24)+-48|0;if(l>>>0<10){O=(h[o+2>>0]|0)==36;c=O?o+3|0:c;s=h[c>>0]|0;v=O?l:-1;t=O?1:t}else v=-1;o=s<<24>>24;t:do{if((o&-32|0)==32){l=0;while(1){if(!(1<<o+-32&75913)){m=l;o=c;break t}l=1<<(s<<24>>24)+-32|l;c=c+1|0;s=h[c>>0]|0;o=s<<24>>24;if((o&-32|0)!=32){m=l;o=c;break}}}else{m=0;o=c}}while(0);do{if(s<<24>>24==42){l=o+1|0;s=(h[l>>0]|0)+-48|0;if(s>>>0<10?(h[o+2>>0]|0)==36:0){f[i+(s<<2)>>2]=10;t=1;o=o+3|0;s=f[n+((h[l>>0]|0)+-48<<3)>>2]|0}else{if(t){a=-1;break e}if(!F){x=m;o=l;t=0;O=0;break}t=(f[r>>2]|0)+(4-1)&~(4-1);s=f[t>>2]|0;f[r>>2]=t+4;t=0;o=l}if((s|0)<0){x=m|8192;O=0-s|0}else{x=m;O=s}}else{l=(s<<24>>24)+-48|0;if(l>>>0<10){s=0;do{s=(s*10|0)+l|0;o=o+1|0;l=(h[o>>0]|0)+-48|0}while(l>>>0<10);if((s|0)<0){a=-1;break e}else{x=m;O=s}}else{x=m;O=0}}}while(0);t:do{if((h[o>>0]|0)==46){l=o+1|0;s=h[l>>0]|0;if(s<<24>>24!=42){c=(s<<24>>24)+-48|0;if(c>>>0<10){o=l;s=0}else{o=l;c=0;break}while(1){s=(s*10|0)+c|0;o=o+1|0;c=(h[o>>0]|0)+-48|0;if(c>>>0>=10){c=s;break t}}}l=o+2|0;s=(h[l>>0]|0)+-48|0;if(s>>>0<10?(h[o+3>>0]|0)==36:0){f[i+(s<<2)>>2]=10;o=o+4|0;c=f[n+((h[l>>0]|0)+-48<<3)>>2]|0;break}if(t){a=-1;break e}if(F){o=(f[r>>2]|0)+(4-1)&~(4-1);c=f[o>>2]|0;f[r>>2]=o+4;o=l}else{o=l;c=0}}else c=-1}while(0);g=0;while(1){s=(h[o>>0]|0)+-65|0;if(s>>>0>57){a=-1;break e}l=o+1|0;s=h[25126+(g*58|0)+s>>0]|0;m=s&255;if((m+-1|0)>>>0<8){o=l;g=m}else{H=l;break}}if(!(s<<24>>24)){a=-1;break}l=(v|0)>-1;do{if(s<<24>>24==19)if(l){a=-1;break e}else D=52;else{if(l){f[i+(v<<2)>>2]=m;C=n+(v<<3)|0;I=f[C+4>>2]|0;D=ee;f[D>>2]=f[C>>2];f[D+4>>2]=I;D=52;break}if(!F){a=0;break e}kl(ee,m,r)}}while(0);if((D|0)==52?(D=0,!F):0){E=H;o=T;continue}v=h[o>>0]|0;v=(g|0)!=0&(v&15|0)==3?v&-33:v;l=x&-65537;I=(x&8192|0)==0?x:l;t:do{switch(v|0){case 110:switch(g|0){case 0:{f[f[ee>>2]>>2]=a;E=H;o=T;continue e}case 1:{f[f[ee>>2]>>2]=a;E=H;o=T;continue e}case 2:{E=f[ee>>2]|0;f[E>>2]=a;f[E+4>>2]=((a|0)<0)<<31>>31;E=H;o=T;continue e}case 3:{d[f[ee>>2]>>1]=a;E=H;o=T;continue e}case 4:{h[f[ee>>2]>>0]=a;E=H;o=T;continue e}case 6:{f[f[ee>>2]>>2]=a;E=H;o=T;continue e}case 7:{E=f[ee>>2]|0;f[E>>2]=a;f[E+4>>2]=((a|0)<0)<<31>>31;E=H;o=T;continue e}default:{E=H;o=T;continue e}}case 112:{g=I|8;c=c>>>0>8?c:8;v=120;D=64;break}case 88:case 120:{g=I;D=64;break}case 111:{l=ee;s=f[l>>2]|0;l=f[l+4>>2]|0;if((s|0)==0&(l|0)==0)o=N;else{o=N;do{o=o+-1|0;h[o>>0]=s&7|48;s=Xl(s|0,l|0,3)|0;l=B}while(!((s|0)==0&(l|0)==0))}if(!(I&8)){s=I;g=0;m=25606;D=77}else{g=X-o+1|0;s=I;c=(c|0)<(g|0)?g:c;g=0;m=25606;D=77}break}case 105:case 100:{s=ee;o=f[s>>2]|0;s=f[s+4>>2]|0;if((s|0)<0){o=zl(0,0,o|0,s|0)|0;s=B;l=ee;f[l>>2]=o;f[l+4>>2]=s;l=1;m=25606;D=76;break t}if(!(I&2048)){m=I&1;l=m;m=(m|0)==0?25606:25608;D=76}else{l=1;m=25607;D=76}break}case 117:{s=ee;o=f[s>>2]|0;s=f[s+4>>2]|0;l=0;m=25606;D=76;break}case 99:{h[Y>>0]=f[ee>>2];E=Y;s=1;g=0;v=25606;o=N;break}case 109:{o=Rs()|0;o=ks(f[o>>2]|0)|0;D=82;break}case 115:{o=f[ee>>2]|0;o=(o|0)!=0?o:25616;D=82;break}case 67:{f[ae>>2]=f[ee>>2];f[q>>2]=0;f[ee>>2]=ae;c=-1;D=86;break}case 83:{if(!c){Ll(e,32,O,0,I);o=0;D=98}else D=86;break}case 65:case 71:case 70:case 69:case 97:case 103:case 102:case 101:{u=+y[ee>>3];f[ne>>2]=0;y[w>>3]=u;if((f[w+4>>2]|0)>=0)if(!(I&2048)){C=I&1;L=C;C=(C|0)==0?25624:25629}else{L=1;C=25626}else{u=-u;L=1;C=25623}y[w>>3]=u;P=f[w+4>>2]&2146435072;do{if(P>>>0<2146435072|(P|0)==2146435072&0<0){_=+Cs(u,ne)*2.0;s=_!=0.0;if(s)f[ne>>2]=(f[ne>>2]|0)+-1;R=v|32;if((R|0)==97){E=v&32;T=(E|0)==0?C:C+9|0;x=L|2;o=12-c|0;do{if(!(c>>>0>11|(o|0)==0)){u=8.0;do{o=o+-1|0;u=u*16.0}while((o|0)!=0);if((h[T>>0]|0)==45){u=-(u+(-_-u));break}else{u=_+u-u;break}}else u=_}while(0);s=f[ne>>2]|0;o=(s|0)<0?0-s|0:s;o=Pl(o,((o|0)<0)<<31>>31,Z)|0;if((o|0)==(Z|0)){h[K>>0]=48;o=K}h[o+-1>>0]=(s>>31&2)+43;g=o+-2|0;h[g>>0]=v+15;m=(c|0)<1;l=(I&8|0)==0;s=re;while(1){C=~~u;o=s+1|0;h[s>>0]=p[25590+C>>0]|E;u=(u-+(C|0))*16.0;do{if((o-Q|0)==1){if(l&(m&u==0.0))break;h[o>>0]=46;o=s+2|0}}while(0);if(!(u!=0.0))break;else s=o}c=(c|0)!=0&(U+o|0)<(c|0)?z+c-g|0:$-g+o|0;l=c+x|0;Ll(e,32,O,l,I);if(!(f[e>>2]&32))cl(T,x,e)|0;Ll(e,48,O,l,I^65536);o=o-Q|0;if(!(f[e>>2]&32))cl(re,o,e)|0;s=J-g|0;Ll(e,48,c-(o+s)|0,0,0);if(!(f[e>>2]&32))cl(g,s,e)|0;Ll(e,32,O,l,I^8192);o=(l|0)<(O|0)?O:l;break}o=(c|0)<0?6:c;if(s){s=(f[ne>>2]|0)+-28|0;f[ne>>2]=s;u=_*268435456.0}else{u=_;s=f[ne>>2]|0}P=(s|0)<0?te:j;k=P;s=P;do{A=~~u>>>0;f[s>>2]=A;s=s+4|0;u=(u-+(A>>>0))*1.0e9}while(u!=0.0);l=s;s=f[ne>>2]|0;if((s|0)>0){m=P;while(1){g=(s|0)>29?29:s;c=l+-4|0;do{if(c>>>0<m>>>0)c=m;else{s=0;do{A=Gl(f[c>>2]|0,0,g|0)|0;A=Wl(A|0,B|0,s|0,0)|0;s=B;S=eu(A|0,s|0,1e9,0)|0;f[c>>2]=S;s=$l(A|0,s|0,1e9,0)|0;c=c+-4|0}while(c>>>0>=m>>>0);if(!s){c=m;break}c=m+-4|0;f[c>>2]=s}}while(0);while(1){if(l>>>0<=c>>>0)break;s=l+-4|0;if(!(f[s>>2]|0))l=s;else break}s=(f[ne>>2]|0)-g|0;f[ne>>2]=s;if((s|0)>0)m=c;else break}}else c=P;if((s|0)<0){T=((o+25|0)/9|0)+1|0;M=(R|0)==102;E=c;while(1){x=0-s|0;x=(x|0)>9?9:x;do{if(E>>>0<l>>>0){s=(1<<x)+-1|0;m=1e9>>>x;c=0;g=E;do{A=f[g>>2]|0;f[g>>2]=(A>>>x)+c;c=ce(A&s,m)|0;g=g+4|0}while(g>>>0<l>>>0);s=(f[E>>2]|0)==0?E+4|0:E;if(!c){c=s;break}f[l>>2]=c;c=s;l=l+4|0}else c=(f[E>>2]|0)==0?E+4|0:E}while(0);s=M?P:c;l=(l-s>>2|0)>(T|0)?s+(T<<2)|0:l;s=(f[ne>>2]|0)+x|0;f[ne>>2]=s;if((s|0)>=0){E=c;break}else E=c}}else E=c;do{if(E>>>0<l>>>0){s=(k-E>>2)*9|0;m=f[E>>2]|0;if(m>>>0<10)break;else c=10;do{c=c*10|0;s=s+1|0}while(m>>>0>=c>>>0)}else s=0}while(0);S=(R|0)==103;A=(o|0)!=0;c=o-((R|0)!=102?s:0)+((A&S)<<31>>31)|0;if((c|0)<(((l-k>>2)*9|0)+-9|0)){g=c+9216|0;M=(g|0)/9|0;c=P+(M+-1023<<2)|0;g=((g|0)%9|0)+1|0;if((g|0)<9){m=10;do{m=m*10|0;g=g+1|0}while((g|0)!=9)}else m=10;x=f[c>>2]|0;T=(x>>>0)%(m>>>0)|0;if((T|0)==0?(P+(M+-1022<<2)|0)==(l|0):0)m=E;else D=163;do{if((D|0)==163){D=0;_=(((x>>>0)/(m>>>0)|0)&1|0)==0?9007199254740992.0:9007199254740994.0;g=(m|0)/2|0;do{if(T>>>0<g>>>0)u=.5;else{if((T|0)==(g|0)?(P+(M+-1022<<2)|0)==(l|0):0){u=1.0;break}u=1.5}}while(0);do{if(L){if((h[C>>0]|0)!=45)break;_=-_;u=-u}}while(0);g=x-T|0;f[c>>2]=g;if(!(_+u!=_)){m=E;break}R=g+m|0;f[c>>2]=R;if(R>>>0>999999999){s=E;while(1){m=c+-4|0;f[c>>2]=0;if(m>>>0<s>>>0){s=s+-4|0;f[s>>2]=0}R=(f[m>>2]|0)+1|0;f[m>>2]=R;if(R>>>0>999999999)c=m;else{E=s;c=m;break}}}s=(k-E>>2)*9|0;g=f[E>>2]|0;if(g>>>0<10){m=E;break}else m=10;do{m=m*10|0;s=s+1|0}while(g>>>0>=m>>>0);m=E}}while(0);R=c+4|0;E=m;l=l>>>0>R>>>0?R:l}T=0-s|0;while(1){if(l>>>0<=E>>>0){M=0;R=l;break}c=l+-4|0;if(!(f[c>>2]|0))l=c;else{M=1;R=l;break}}do{if(S){o=(A&1^1)+o|0;if((o|0)>(s|0)&(s|0)>-5){v=v+-1|0;o=o+-1-s|0}else{v=v+-2|0;o=o+-1|0}l=I&8;if(l)break;do{if(M){l=f[R+-4>>2]|0;if(!l){c=9;break}if(!((l>>>0)%10|0)){m=10;c=0}else{c=0;break}do{m=m*10|0;c=c+1|0}while(((l>>>0)%(m>>>0)|0|0)==0)}else c=9}while(0);l=((R-k>>2)*9|0)+-9|0;if((v|32|0)==102){l=l-c|0;l=(l|0)<0?0:l;o=(o|0)<(l|0)?o:l;l=0;break}else{l=l+s-c|0;l=(l|0)<0?0:l;o=(o|0)<(l|0)?o:l;l=0;break}}else l=I&8}while(0);x=o|l;m=(x|0)!=0&1;g=(v|32|0)==102;if(g){s=(s|0)>0?s:0;v=0}else{c=(s|0)<0?T:s;c=Pl(c,((c|0)<0)<<31>>31,Z)|0;if((J-c|0)<2)do{c=c+-1|0;h[c>>0]=48}while((J-c|0)<2);h[c+-1>>0]=(s>>31&2)+43;k=c+-2|0;h[k>>0]=v;s=J-k|0;v=k}T=L+1+o+m+s|0;Ll(e,32,O,T,I);if(!(f[e>>2]&32))cl(C,L,e)|0;Ll(e,48,O,T,I^65536);do{if(g){c=E>>>0>P>>>0?P:E;s=c;do{l=Pl(f[s>>2]|0,0,V)|0;do{if((s|0)==(c|0)){if((l|0)!=(V|0))break;h[W>>0]=48;l=W}else{if(l>>>0<=re>>>0)break;do{l=l+-1|0;h[l>>0]=48}while(l>>>0>re>>>0)}}while(0);if(!(f[e>>2]&32))cl(l,G-l|0,e)|0;s=s+4|0}while(s>>>0<=P>>>0);do{if(x){if(f[e>>2]&32)break;cl(25658,1,e)|0}}while(0);if((o|0)>0&s>>>0<R>>>0){l=s;while(1){s=Pl(f[l>>2]|0,0,V)|0;if(s>>>0>re>>>0)do{s=s+-1|0;h[s>>0]=48}while(s>>>0>re>>>0);if(!(f[e>>2]&32))cl(s,(o|0)>9?9:o,e)|0;l=l+4|0;s=o+-9|0;if(!((o|0)>9&l>>>0<R>>>0)){o=s;break}else o=s}}Ll(e,48,o+9|0,9,0)}else{g=M?R:E+4|0;if((o|0)>-1){m=(l|0)==0;c=E;do{s=Pl(f[c>>2]|0,0,V)|0;if((s|0)==(V|0)){h[W>>0]=48;s=W}do{if((c|0)==(E|0)){l=s+1|0;if(!(f[e>>2]&32))cl(s,1,e)|0;if(m&(o|0)<1){s=l;break}if(f[e>>2]&32){s=l;break}cl(25658,1,e)|0;s=l}else{if(s>>>0<=re>>>0)break;do{s=s+-1|0;h[s>>0]=48}while(s>>>0>re>>>0)}}while(0);l=G-s|0;if(!(f[e>>2]&32))cl(s,(o|0)>(l|0)?l:o,e)|0;o=o-l|0;c=c+4|0}while(c>>>0<g>>>0&(o|0)>-1)}Ll(e,48,o+18|0,18,0);if(f[e>>2]&32)break;cl(v,J-v|0,e)|0}}while(0);Ll(e,32,O,T,I^8192);o=(T|0)<(O|0)?O:T}else{g=(v&32|0)!=0;m=u!=u|0.0!=0.0;s=m?0:L;c=s+3|0;Ll(e,32,O,c,l);o=f[e>>2]|0;if(!(o&32)){cl(C,s,e)|0;o=f[e>>2]|0}if(!(o&32))cl(m?g?25650:25654:g?25642:25646,3,e)|0;Ll(e,32,O,c,I^8192);o=(c|0)<(O|0)?O:c}}while(0);E=H;continue e}default:{l=I;s=c;g=0;v=25606;o=N}}}while(0);t:do{if((D|0)==64){l=ee;s=f[l>>2]|0;l=f[l+4>>2]|0;m=v&32;if(!((s|0)==0&(l|0)==0)){o=N;do{o=o+-1|0;h[o>>0]=p[25590+(s&15)>>0]|m;s=Xl(s|0,l|0,4)|0;l=B}while(!((s|0)==0&(l|0)==0));D=ee;if((g&8|0)==0|(f[D>>2]|0)==0&(f[D+4>>2]|0)==0){s=g;g=0;m=25606;D=77}else{s=g;g=2;m=25606+(v>>4)|0;D=77}}else{o=N;s=g;g=0;m=25606;D=77}}else if((D|0)==76){o=Pl(o,s,N)|0;s=I;g=l;D=77}else if((D|0)==82){D=0;I=yl(o,0,c)|0;C=(I|0)==0;E=o;s=C?c:I-o|0;g=0;v=25606;o=C?o+c|0:I}else if((D|0)==86){D=0;s=0;o=0;m=f[ee>>2]|0;while(1){l=f[m>>2]|0;if(!l)break;o=Ns(ie,l)|0;if((o|0)<0|o>>>0>(c-s|0)>>>0)break;s=o+s|0;if(c>>>0>s>>>0)m=m+4|0;else break}if((o|0)<0){a=-1;break e}Ll(e,32,O,s,I);if(!s){o=0;D=98}else{l=0;c=f[ee>>2]|0;while(1){o=f[c>>2]|0;if(!o){o=s;D=98;break t}o=Ns(ie,o)|0;l=o+l|0;if((l|0)>(s|0)){o=s;D=98;break t}if(!(f[e>>2]&32))cl(ie,o,e)|0;if(l>>>0>=s>>>0){o=s;D=98;break}else c=c+4|0}}}}while(0);if((D|0)==98){D=0;Ll(e,32,O,o,I^8192);E=H;o=(O|0)>(o|0)?O:o;continue}if((D|0)==77){D=0;l=(c|0)>-1?s&-65537:s;s=ee;s=(f[s>>2]|0)!=0|(f[s+4>>2]|0)!=0;if((c|0)!=0|s){s=(s&1^1)+(X-o)|0;E=o;s=(c|0)>(s|0)?c:s;v=m;o=N}else{E=N;s=0;v=m;o=N}}m=o-E|0;s=(s|0)<(m|0)?m:s;c=g+s|0;o=(O|0)<(c|0)?c:O;Ll(e,32,o,c,l);if(!(f[e>>2]&32))cl(v,g,e)|0;Ll(e,48,o,c,l^65536);Ll(e,48,s,m,0);if(!(f[e>>2]&32))cl(E,m,e)|0;Ll(e,32,o,c,l^8192);E=H}e:do{if((D|0)==245)if(!e)if(t){a=1;while(1){t=f[i+(a<<2)>>2]|0;if(!t)break;kl(n+(a<<3)|0,t,r);a=a+1|0;if((a|0)>=10){a=1;break e}}if((a|0)<10)while(1){if(f[i+(a<<2)>>2]|0){a=-1;break e}a=a+1|0;if((a|0)>=10){a=1;break}}else a=1}else a=0}while(0);b=oe;return a|0}function Rl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0;n=e+20|0;i=f[n>>2]|0;e=(f[e+16>>2]|0)-i|0;e=e>>>0>r>>>0?r:e;Yl(i|0,t|0,e|0)|0;f[n>>2]=(f[n>>2]|0)+e;return r|0}function kl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0.0;e:do{if(t>>>0<=20)do{switch(t|0){case 9:{n=(f[r>>2]|0)+(4-1)&~(4-1);t=f[n>>2]|0;f[r>>2]=n+4;f[e>>2]=t;break e}case 10:{n=(f[r>>2]|0)+(4-1)&~(4-1);t=f[n>>2]|0;f[r>>2]=n+4;n=e;f[n>>2]=t;f[n+4>>2]=((t|0)<0)<<31>>31;break e}case 11:{n=(f[r>>2]|0)+(4-1)&~(4-1);t=f[n>>2]|0;f[r>>2]=n+4;n=e;f[n>>2]=t;f[n+4>>2]=0;break e}case 12:{n=(f[r>>2]|0)+(8-1)&~(8-1);t=n;i=f[t>>2]|0;t=f[t+4>>2]|0;f[r>>2]=n+8;n=e;f[n>>2]=i;f[n+4>>2]=t;break e}case 13:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;n=(n&65535)<<16>>16;i=e;f[i>>2]=n;f[i+4>>2]=((n|0)<0)<<31>>31;break e}case 14:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;i=e;f[i>>2]=n&65535;f[i+4>>2]=0;break e}case 15:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;n=(n&255)<<24>>24;i=e;f[i>>2]=n;f[i+4>>2]=((n|0)<0)<<31>>31;break e}case 16:{i=(f[r>>2]|0)+(4-1)&~(4-1);n=f[i>>2]|0;f[r>>2]=i+4;i=e;f[i>>2]=n&255;f[i+4>>2]=0;break e}case 17:{i=(f[r>>2]|0)+(8-1)&~(8-1);a=+y[i>>3];f[r>>2]=i+8;y[e>>3]=a;break e}case 18:{i=(f[r>>2]|0)+(8-1)&~(8-1);a=+y[i>>3];f[r>>2]=i+8;y[e>>3]=a;break e}default:break e}}while(0)}while(0);return}function Pl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(t>>>0>0|(t|0)==0&e>>>0>4294967295)while(1){n=eu(e|0,t|0,10,0)|0;r=r+-1|0;h[r>>0]=n|48;n=$l(e|0,t|0,10,0)|0;if(t>>>0>9|(t|0)==9&e>>>0>4294967295){e=n;t=B}else{e=n;break}}if(e)while(1){r=r+-1|0;h[r>>0]=(e>>>0)%10|0|48;if(e>>>0<10)break;else e=(e>>>0)/10|0}return r|0}function Ll(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0;s=b;b=b+256|0;o=s;do{if((r|0)>(n|0)&(i&73728|0)==0){i=r-n|0;Vl(o|0,t|0,(i>>>0>256?256:i)|0)|0;t=f[e>>2]|0;a=(t&32|0)==0;if(i>>>0>255){n=r-n|0;do{if(a){cl(o,256,e)|0;t=f[e>>2]|0}i=i+-256|0;a=(t&32|0)==0}while(i>>>0>255);if(a)i=n&255;else break}else if(!a)break;cl(o,i,e)|0}}while(0);b=s;return}function Cl(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=0,H=0,O=0,D=0,F=0,N=0;do{if(e>>>0<245){p=e>>>0<11?16:e+11&-8;e=p>>>3;s=f[735]|0;r=s>>>e;if(r&3){e=(r&1^1)+e|0;n=e<<1;r=2980+(n<<2)|0;n=2980+(n+2<<2)|0;i=f[n>>2]|0;a=i+8|0;o=f[a>>2]|0;do{if((r|0)!=(o|0)){if(o>>>0<(f[739]|0)>>>0)Le();t=o+12|0;if((f[t>>2]|0)==(i|0)){f[t>>2]=r;f[n>>2]=o;break}else Le()}else f[735]=s&~(1<<e)}while(0);N=e<<3;f[i+4>>2]=N|3;N=i+(N|4)|0;f[N>>2]=f[N>>2]|1;N=a;return N|0}o=f[737]|0;if(p>>>0>o>>>0){if(r){n=2<<e;n=r<<e&(n|0-n);n=(n&0-n)+-1|0;l=n>>>12&16;n=n>>>l;i=n>>>5&8;n=n>>>i;a=n>>>2&4;n=n>>>a;r=n>>>1&2;n=n>>>r;e=n>>>1&1;e=(i|l|a|r|e)+(n>>>e)|0;n=e<<1;r=2980+(n<<2)|0;n=2980+(n+2<<2)|0;a=f[n>>2]|0;l=a+8|0;i=f[l>>2]|0;do{if((r|0)!=(i|0)){if(i>>>0<(f[739]|0)>>>0)Le();t=i+12|0;if((f[t>>2]|0)==(a|0)){f[t>>2]=r;f[n>>2]=i;u=f[737]|0;break}else Le()}else{f[735]=s&~(1<<e);u=o}}while(0);N=e<<3;o=N-p|0;f[a+4>>2]=p|3;s=a+p|0;f[a+(p|4)>>2]=o|1;f[a+N>>2]=o;if(u){i=f[740]|0;r=u>>>3;t=r<<1;n=2980+(t<<2)|0;e=f[735]|0;r=1<<r;if(e&r){e=2980+(t+2<<2)|0;t=f[e>>2]|0;if(t>>>0<(f[739]|0)>>>0)Le();else{c=e;h=t}}else{f[735]=e|r;c=2980+(t+2<<2)|0;h=n}f[c>>2]=i;f[h+12>>2]=i;f[i+8>>2]=h;f[i+12>>2]=n}f[737]=o;f[740]=s;N=l;return N|0}e=f[736]|0;if(e){r=(e&0-e)+-1|0;F=r>>>12&16;r=r>>>F;D=r>>>5&8;r=r>>>D;N=r>>>2&4;r=r>>>N;e=r>>>1&2;r=r>>>e;n=r>>>1&1;n=f[3244+((D|F|N|e|n)+(r>>>n)<<2)>>2]|0;r=(f[n+4>>2]&-8)-p|0;e=n;while(1){t=f[e+16>>2]|0;if(!t){t=f[e+20>>2]|0;if(!t){l=r;break}}e=(f[t+4>>2]&-8)-p|0;N=e>>>0<r>>>0;r=N?e:r;e=t;n=N?t:n}a=f[739]|0;if(n>>>0<a>>>0)Le();s=n+p|0;if(n>>>0>=s>>>0)Le();o=f[n+24>>2]|0;r=f[n+12>>2]|0;do{if((r|0)==(n|0)){e=n+20|0;t=f[e>>2]|0;if(!t){e=n+16|0;t=f[e>>2]|0;if(!t){d=0;break}}while(1){r=t+20|0;i=f[r>>2]|0;if(i){t=i;e=r;continue}r=t+16|0;i=f[r>>2]|0;if(!i)break;else{t=i;e=r}}if(e>>>0<a>>>0)Le();else{f[e>>2]=0;d=t;break}}else{i=f[n+8>>2]|0;if(i>>>0<a>>>0)Le();t=i+12|0;if((f[t>>2]|0)!=(n|0))Le();e=r+8|0;if((f[e>>2]|0)==(n|0)){f[t>>2]=r;f[e>>2]=i;d=r;break}else Le()}}while(0);do{if(o){t=f[n+28>>2]|0;e=3244+(t<<2)|0;if((n|0)==(f[e>>2]|0)){f[e>>2]=d;if(!d){f[736]=f[736]&~(1<<t);break}}else{if(o>>>0<(f[739]|0)>>>0)Le();t=o+16|0;if((f[t>>2]|0)==(n|0))f[t>>2]=d;else f[o+20>>2]=d;if(!d)break}e=f[739]|0;if(d>>>0<e>>>0)Le();f[d+24>>2]=o;t=f[n+16>>2]|0;do{if(t)if(t>>>0<e>>>0)Le();else{f[d+16>>2]=t;f[t+24>>2]=d;break}}while(0);t=f[n+20>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[d+20>>2]=t;f[t+24>>2]=d;break}}}while(0);if(l>>>0<16){N=l+p|0;f[n+4>>2]=N|3;N=n+(N+4)|0;f[N>>2]=f[N>>2]|1}else{f[n+4>>2]=p|3;f[n+(p|4)>>2]=l|1;f[n+(l+p)>>2]=l;t=f[737]|0;if(t){a=f[740]|0;r=t>>>3;t=r<<1;i=2980+(t<<2)|0;e=f[735]|0;r=1<<r;if(e&r){t=2980+(t+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Le();else{m=t;g=e}}else{f[735]=e|r;m=2980+(t+2<<2)|0;g=i}f[m>>2]=a;f[g+12>>2]=a;f[a+8>>2]=g;f[a+12>>2]=i}f[737]=l;f[740]=s}N=n+8|0;return N|0}else g=p}else g=p}else if(e>>>0<=4294967231){e=e+11|0;h=e&-8;c=f[736]|0;if(c){r=0-h|0;e=e>>>8;if(e)if(h>>>0>16777215)u=31;else{g=(e+1048320|0)>>>16&8;E=e<<g;m=(E+520192|0)>>>16&4;E=E<<m;u=(E+245760|0)>>>16&2;u=14-(m|g|u)+(E<<u>>>15)|0;u=h>>>(u+7|0)&1|u<<1}else u=0;e=f[3244+(u<<2)>>2]|0;e:do{if(!e){i=0;e=0;E=86}else{o=r;i=0;s=h<<((u|0)==31?0:25-(u>>>1)|0);l=e;e=0;while(1){a=f[l+4>>2]&-8;r=a-h|0;if(r>>>0<o>>>0)if((a|0)==(h|0)){a=l;e=l;E=90;break e}else e=l;else r=o;E=f[l+20>>2]|0;l=f[l+16+(s>>>31<<2)>>2]|0;i=(E|0)==0|(E|0)==(l|0)?i:E;if(!l){E=86;break}else{o=r;s=s<<1}}}}while(0);if((E|0)==86){if((i|0)==0&(e|0)==0){e=2<<u;e=c&(e|0-e);if(!e){g=h;break}e=(e&0-e)+-1|0;d=e>>>12&16;e=e>>>d;c=e>>>5&8;e=e>>>c;m=e>>>2&4;e=e>>>m;g=e>>>1&2;e=e>>>g;i=e>>>1&1;i=f[3244+((c|d|m|g|i)+(e>>>i)<<2)>>2]|0;e=0}if(!i){s=r;l=e}else{a=i;E=90}}if((E|0)==90)while(1){E=0;g=(f[a+4>>2]&-8)-h|0;i=g>>>0<r>>>0;r=i?g:r;e=i?a:e;i=f[a+16>>2]|0;if(i){a=i;E=90;continue}a=f[a+20>>2]|0;if(!a){s=r;l=e;break}else E=90}if((l|0)!=0?s>>>0<((f[737]|0)-h|0)>>>0:0){i=f[739]|0;if(l>>>0<i>>>0)Le();o=l+h|0;if(l>>>0>=o>>>0)Le();a=f[l+24>>2]|0;r=f[l+12>>2]|0;do{if((r|0)==(l|0)){e=l+20|0;t=f[e>>2]|0;if(!t){e=l+16|0;t=f[e>>2]|0;if(!t){p=0;break}}while(1){r=t+20|0;n=f[r>>2]|0;if(n){t=n;e=r;continue}r=t+16|0;n=f[r>>2]|0;if(!n)break;else{t=n;e=r}}if(e>>>0<i>>>0)Le();else{f[e>>2]=0;p=t;break}}else{n=f[l+8>>2]|0;if(n>>>0<i>>>0)Le();t=n+12|0;if((f[t>>2]|0)!=(l|0))Le();e=r+8|0;if((f[e>>2]|0)==(l|0)){f[t>>2]=r;f[e>>2]=n;p=r;break}else Le()}}while(0);do{if(a){t=f[l+28>>2]|0;e=3244+(t<<2)|0;if((l|0)==(f[e>>2]|0)){f[e>>2]=p;if(!p){f[736]=f[736]&~(1<<t);break}}else{if(a>>>0<(f[739]|0)>>>0)Le();t=a+16|0;if((f[t>>2]|0)==(l|0))f[t>>2]=p;else f[a+20>>2]=p;if(!p)break}e=f[739]|0;if(p>>>0<e>>>0)Le();f[p+24>>2]=a;t=f[l+16>>2]|0;do{if(t)if(t>>>0<e>>>0)Le();else{f[p+16>>2]=t;f[t+24>>2]=p;break}}while(0);t=f[l+20>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[p+20>>2]=t;f[t+24>>2]=p;break}}}while(0);e:do{if(s>>>0>=16){f[l+4>>2]=h|3;f[l+(h|4)>>2]=s|1;f[l+(s+h)>>2]=s;t=s>>>3;if(s>>>0<256){e=t<<1;n=2980+(e<<2)|0;r=f[735]|0;t=1<<t;if(r&t){t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Le();else{y=t;_=e}}else{f[735]=r|t;y=2980+(e+2<<2)|0;_=n}f[y>>2]=o;f[_+12>>2]=o;f[l+(h+8)>>2]=_;f[l+(h+12)>>2]=n;break}t=s>>>8;if(t)if(s>>>0>16777215)n=31;else{F=(t+1048320|0)>>>16&8;N=t<<F;D=(N+520192|0)>>>16&4;N=N<<D;n=(N+245760|0)>>>16&2;n=14-(D|F|n)+(N<<n>>>15)|0;n=s>>>(n+7|0)&1|n<<1}else n=0;t=3244+(n<<2)|0;f[l+(h+28)>>2]=n;f[l+(h+20)>>2]=0;f[l+(h+16)>>2]=0;e=f[736]|0;r=1<<n;if(!(e&r)){f[736]=e|r;f[t>>2]=o;f[l+(h+24)>>2]=t;f[l+(h+12)>>2]=o;f[l+(h+8)>>2]=o;break}t=f[t>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(s|0)){n=s<<((n|0)==31?0:25-(n>>>1)|0);while(1){e=t+16+(n>>>31<<2)|0;r=f[e>>2]|0;if(!r)break;if((f[r+4>>2]&-8|0)==(s|0)){T=r;break t}else{n=n<<1;t=r}}if(e>>>0<(f[739]|0)>>>0)Le();else{f[e>>2]=o;f[l+(h+24)>>2]=t;f[l+(h+12)>>2]=o;f[l+(h+8)>>2]=o;break e}}else T=t}while(0);t=T+8|0;e=f[t>>2]|0;N=f[739]|0;if(e>>>0>=N>>>0&T>>>0>=N>>>0){f[e+12>>2]=o;f[t>>2]=o;f[l+(h+8)>>2]=e;f[l+(h+12)>>2]=T;f[l+(h+24)>>2]=0;break}else Le()}else{N=s+h|0;f[l+4>>2]=N|3;N=l+(N+4)|0;f[N>>2]=f[N>>2]|1}}while(0);N=l+8|0;return N|0}else g=h}else g=h}else g=-1}while(0);r=f[737]|0;if(r>>>0>=g>>>0){t=r-g|0;e=f[740]|0;if(t>>>0>15){f[740]=e+g;f[737]=t;f[e+(g+4)>>2]=t|1;f[e+r>>2]=t;f[e+4>>2]=g|3}else{f[737]=0;f[740]=0;f[e+4>>2]=r|3;N=e+(r+4)|0;f[N>>2]=f[N>>2]|1}N=e+8|0;return N|0}e=f[738]|0;if(e>>>0>g>>>0){F=e-g|0;f[738]=F;N=f[741]|0;f[741]=N+g;f[N+(g+4)>>2]=F|1;f[N+4>>2]=g|3;N=N+8|0;return N|0}do{if(!(f[853]|0)){e=Fe(30)|0;if(!(e+-1&e)){f[855]=e;f[854]=e;f[856]=-1;f[857]=-1;f[858]=0;f[846]=0;T=(Ze(0)|0)&-16^1431655768;f[853]=T;break}else Le()}}while(0);l=g+48|0;s=f[855]|0;u=g+47|0;o=s+u|0;s=0-s|0;c=o&s;if(c>>>0<=g>>>0){N=0;return N|0}e=f[845]|0;if((e|0)!=0?(_=f[843]|0,T=_+c|0,T>>>0<=_>>>0|T>>>0>e>>>0):0){N=0;return N|0}e:do{if(!(f[846]&4)){e=f[741]|0;t:do{if(e){i=3388;while(1){r=f[i>>2]|0;if(r>>>0<=e>>>0?(v=i+4|0,(r+(f[v>>2]|0)|0)>>>0>e>>>0):0){a=i;e=v;break}i=f[i+8>>2]|0;if(!i){E=174;break t}}r=o-(f[738]|0)&s;if(r>>>0<2147483647){i=Oe(r|0)|0;T=(i|0)==((f[a>>2]|0)+(f[e>>2]|0)|0);e=T?r:0;if(T){if((i|0)!=(-1|0)){w=i;m=e;E=194;break e}}else E=184}else e=0}else E=174}while(0);do{if((E|0)==174){a=Oe(0)|0;if((a|0)!=(-1|0)){e=a;r=f[854]|0;i=r+-1|0;if(!(i&e))r=c;else r=c-e+(i+e&0-r)|0;e=f[843]|0;i=e+r|0;if(r>>>0>g>>>0&r>>>0<2147483647){T=f[845]|0;if((T|0)!=0?i>>>0<=e>>>0|i>>>0>T>>>0:0){e=0;break}i=Oe(r|0)|0;T=(i|0)==(a|0);e=T?r:0;if(T){w=a;m=e;E=194;break e}else E=184}else e=0}else e=0}}while(0);t:do{if((E|0)==184){a=0-r|0;do{if(l>>>0>r>>>0&(r>>>0<2147483647&(i|0)!=(-1|0))?(b=f[855]|0,b=u-r+b&0-b,b>>>0<2147483647):0)if((Oe(b|0)|0)==(-1|0)){Oe(a|0)|0;break t}else{r=b+r|0;break}}while(0);if((i|0)!=(-1|0)){w=i;m=r;E=194;break e}}}while(0);f[846]=f[846]|4;E=191}else{e=0;E=191}}while(0);if((((E|0)==191?c>>>0<2147483647:0)?(w=Oe(c|0)|0,x=Oe(0)|0,w>>>0<x>>>0&((w|0)!=(-1|0)&(x|0)!=(-1|0))):0)?(M=x-w|0,S=M>>>0>(g+40|0)>>>0,S):0){m=S?M:e;E=194}if((E|0)==194){e=(f[843]|0)+m|0;f[843]=e;if(e>>>0>(f[844]|0)>>>0)f[844]=e;o=f[741]|0;e:do{if(o){a=3388;do{e=f[a>>2]|0;r=a+4|0;i=f[r>>2]|0;if((w|0)==(e+i|0)){A=e;R=r;k=i;P=a;E=204;break}a=f[a+8>>2]|0}while((a|0)!=0);if(((E|0)==204?(f[P+12>>2]&8|0)==0:0)?o>>>0<w>>>0&o>>>0>=A>>>0:0){f[R>>2]=k+m;N=(f[738]|0)+m|0;F=o+8|0;F=(F&7|0)==0?0:0-F&7;D=N-F|0;f[741]=o+F;f[738]=D;f[o+(F+4)>>2]=D|1;f[o+(N+4)>>2]=40;f[742]=f[857];break}e=f[739]|0;if(w>>>0<e>>>0){f[739]=w;e=w}r=w+m|0;a=3388;while(1){if((f[a>>2]|0)==(r|0)){i=a;r=a;E=212;break}a=f[a+8>>2]|0;if(!a){r=3388;break}}if((E|0)==212)if(!(f[r+12>>2]&8)){f[i>>2]=w;d=r+4|0;f[d>>2]=(f[d>>2]|0)+m;d=w+8|0;d=(d&7|0)==0?0:0-d&7;u=w+(m+8)|0;u=(u&7|0)==0?0:0-u&7;t=w+(u+m)|0;h=d+g|0;p=w+h|0;c=t-(w+d)-g|0;f[w+(d+4)>>2]=g|3;t:do{if((t|0)!=(o|0)){if((t|0)==(f[740]|0)){N=(f[737]|0)+c|0;f[737]=N;f[740]=p;f[w+(h+4)>>2]=N|1;f[w+(N+h)>>2]=N;break}s=m+4|0;r=f[w+(s+u)>>2]|0;if((r&3|0)==1){l=r&-8;a=r>>>3;r:do{if(r>>>0>=256){o=f[w+((u|24)+m)>>2]|0;n=f[w+(m+12+u)>>2]|0;do{if((n|0)==(t|0)){i=u|16;n=w+(s+i)|0;r=f[n>>2]|0;if(!r){n=w+(i+m)|0;r=f[n>>2]|0;if(!r){O=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<e>>>0)Le();else{f[n>>2]=0;O=r;break}}else{i=f[w+((u|8)+m)>>2]|0;if(i>>>0<e>>>0)Le();e=i+12|0;if((f[e>>2]|0)!=(t|0))Le();r=n+8|0;if((f[r>>2]|0)==(t|0)){f[e>>2]=n;f[r>>2]=i;O=n;break}else Le()}}while(0);if(!o)break;e=f[w+(m+28+u)>>2]|0;r=3244+(e<<2)|0;do{if((t|0)!=(f[r>>2]|0)){if(o>>>0<(f[739]|0)>>>0)Le();e=o+16|0;if((f[e>>2]|0)==(t|0))f[e>>2]=O;else f[o+20>>2]=O;if(!O)break r}else{f[r>>2]=O;if(O)break;f[736]=f[736]&~(1<<e);break r}}while(0);r=f[739]|0;if(O>>>0<r>>>0)Le();f[O+24>>2]=o;t=u|16;e=f[w+(t+m)>>2]|0;do{if(e)if(e>>>0<r>>>0)Le();else{f[O+16>>2]=e;f[e+24>>2]=O;break}}while(0);t=f[w+(s+t)>>2]|0;if(!t)break;if(t>>>0<(f[739]|0)>>>0)Le();else{f[O+20>>2]=t;f[t+24>>2]=O;break}}else{n=f[w+((u|8)+m)>>2]|0;i=f[w+(m+12+u)>>2]|0;r=2980+(a<<1<<2)|0;do{if((n|0)!=(r|0)){if(n>>>0<e>>>0)Le();if((f[n+12>>2]|0)==(t|0))break;Le()}}while(0);if((i|0)==(n|0)){f[735]=f[735]&~(1<<a);break}do{if((i|0)==(r|0))L=i+8|0;else{if(i>>>0<e>>>0)Le();e=i+8|0;if((f[e>>2]|0)==(t|0)){L=e;break}Le()}}while(0);f[n+12>>2]=i;f[L>>2]=n}}while(0);t=w+((l|u)+m)|0;i=l+c|0}else i=c;t=t+4|0;f[t>>2]=f[t>>2]&-2;f[w+(h+4)>>2]=i|1;f[w+(i+h)>>2]=i;t=i>>>3;if(i>>>0<256){e=t<<1;n=2980+(e<<2)|0;r=f[735]|0;t=1<<t;do{if(!(r&t)){f[735]=r|t;D=2980+(e+2<<2)|0;F=n}else{t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0>=(f[739]|0)>>>0){D=t;F=e;break}Le()}}while(0);f[D>>2]=p;f[F+12>>2]=p;f[w+(h+8)>>2]=F;f[w+(h+12)>>2]=n;break}t=i>>>8;do{if(!t)n=0;else{if(i>>>0>16777215){n=31;break}D=(t+1048320|0)>>>16&8;F=t<<D;O=(F+520192|0)>>>16&4;F=F<<O;n=(F+245760|0)>>>16&2;n=14-(O|D|n)+(F<<n>>>15)|0;n=i>>>(n+7|0)&1|n<<1}}while(0);t=3244+(n<<2)|0;f[w+(h+28)>>2]=n;f[w+(h+20)>>2]=0;f[w+(h+16)>>2]=0;e=f[736]|0;r=1<<n;if(!(e&r)){f[736]=e|r;f[t>>2]=p;f[w+(h+24)>>2]=t;f[w+(h+12)>>2]=p;f[w+(h+8)>>2]=p;break}t=f[t>>2]|0;r:do{if((f[t+4>>2]&-8|0)!=(i|0)){n=i<<((n|0)==31?0:25-(n>>>1)|0);while(1){e=t+16+(n>>>31<<2)|0;r=f[e>>2]|0;if(!r)break;if((f[r+4>>2]&-8|0)==(i|0)){N=r;break r}else{n=n<<1;t=r}}if(e>>>0<(f[739]|0)>>>0)Le();else{f[e>>2]=p;f[w+(h+24)>>2]=t;f[w+(h+12)>>2]=p;f[w+(h+8)>>2]=p;break t}}else N=t}while(0);t=N+8|0;e=f[t>>2]|0;F=f[739]|0;if(e>>>0>=F>>>0&N>>>0>=F>>>0){f[e+12>>2]=p;f[t>>2]=p;f[w+(h+8)>>2]=e;f[w+(h+12)>>2]=N;f[w+(h+24)>>2]=0;break}else Le()}else{N=(f[738]|0)+c|0;f[738]=N;f[741]=p;f[w+(h+4)>>2]=N|1}}while(0);N=w+(d|8)|0;return N|0}else r=3388;while(1){e=f[r>>2]|0;if(e>>>0<=o>>>0?(t=f[r+4>>2]|0,n=e+t|0,n>>>0>o>>>0):0)break;r=f[r+8>>2]|0}i=e+(t+-39)|0;e=e+(t+-47+((i&7|0)==0?0:0-i&7))|0;i=o+16|0;e=e>>>0<i>>>0?o:e;t=e+8|0;r=w+8|0;r=(r&7|0)==0?0:0-r&7;N=m+-40-r|0;f[741]=w+r;f[738]=N;f[w+(r+4)>>2]=N|1;f[w+(m+-36)>>2]=40;f[742]=f[857];r=e+4|0;f[r>>2]=27;f[t>>2]=f[847];f[t+4>>2]=f[848];f[t+8>>2]=f[849];f[t+12>>2]=f[850];f[847]=w;f[848]=m;f[850]=0;f[849]=t;t=e+28|0;f[t>>2]=7;if((e+32|0)>>>0<n>>>0)do{N=t;t=t+4|0;f[t>>2]=7}while((N+8|0)>>>0<n>>>0);if((e|0)!=(o|0)){a=e-o|0;f[r>>2]=f[r>>2]&-2;f[o+4>>2]=a|1;f[e>>2]=a;t=a>>>3;if(a>>>0<256){e=t<<1;n=2980+(e<<2)|0;r=f[735]|0;t=1<<t;if(r&t){t=2980+(e+2<<2)|0;e=f[t>>2]|0;if(e>>>0<(f[739]|0)>>>0)Le();else{C=t;I=e}}else{f[735]=r|t;C=2980+(e+2<<2)|0;I=n}f[C>>2]=o;f[I+12>>2]=o;f[o+8>>2]=I;f[o+12>>2]=n;break}t=a>>>8;if(t)if(a>>>0>16777215)n=31;else{F=(t+1048320|0)>>>16&8;N=t<<F;D=(N+520192|0)>>>16&4;N=N<<D;n=(N+245760|0)>>>16&2;n=14-(D|F|n)+(N<<n>>>15)|0;n=a>>>(n+7|0)&1|n<<1}else n=0;r=3244+(n<<2)|0;f[o+28>>2]=n;f[o+20>>2]=0;f[i>>2]=0;t=f[736]|0;e=1<<n;if(!(t&e)){f[736]=t|e;f[r>>2]=o;f[o+24>>2]=r;f[o+12>>2]=o;f[o+8>>2]=o;break}t=f[r>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(a|0)){n=a<<((n|0)==31?0:25-(n>>>1)|0);while(1){e=t+16+(n>>>31<<2)|0;r=f[e>>2]|0;if(!r)break;if((f[r+4>>2]&-8|0)==(a|0)){H=r;break t}else{n=n<<1;t=r}}if(e>>>0<(f[739]|0)>>>0)Le();else{f[e>>2]=o;f[o+24>>2]=t;f[o+12>>2]=o;f[o+8>>2]=o;break e}}else H=t}while(0);t=H+8|0;e=f[t>>2]|0;N=f[739]|0;if(e>>>0>=N>>>0&H>>>0>=N>>>0){f[e+12>>2]=o;f[t>>2]=o;f[o+8>>2]=e;f[o+12>>2]=H;f[o+24>>2]=0;break}else Le()}}else{N=f[739]|0;if((N|0)==0|w>>>0<N>>>0)f[739]=w;f[847]=w;f[848]=m;f[850]=0;f[744]=f[853];f[743]=-1;t=0;do{N=t<<1;F=2980+(N<<2)|0;f[2980+(N+3<<2)>>2]=F;f[2980+(N+2<<2)>>2]=F;t=t+1|0}while((t|0)!=32);N=w+8|0;N=(N&7|0)==0?0:0-N&7;F=m+-40-N|0;f[741]=w+N;f[738]=F;f[w+(N+4)>>2]=F|1;f[w+(m+-36)>>2]=40;f[742]=f[857]}}while(0);t=f[738]|0;if(t>>>0>g>>>0){F=t-g|0;f[738]=F;N=f[741]|0;f[741]=N+g;f[N+(g+4)>>2]=F|1;f[N+4>>2]=g|3;N=N+8|0;return N|0}}N=Rs()|0;f[N>>2]=12;N=0;return N|0}function Il(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0;if(!e)return;t=e+-8|0;s=f[739]|0;if(t>>>0<s>>>0)Le();r=f[e+-4>>2]|0;n=r&3;if((n|0)==1)Le();p=r&-8;g=e+(p+-8)|0;do{if(!(r&1)){t=f[t>>2]|0;if(!n)return;l=-8-t|0;c=e+l|0;h=t+p|0;if(c>>>0<s>>>0)Le();if((c|0)==(f[740]|0)){t=e+(p+-4)|0;r=f[t>>2]|0;if((r&3|0)!=3){b=c;a=h;break}f[737]=h;f[t>>2]=r&-2;f[e+(l+4)>>2]=h|1;f[g>>2]=h;return}i=t>>>3;if(t>>>0<256){n=f[e+(l+8)>>2]|0;r=f[e+(l+12)>>2]|0;t=2980+(i<<1<<2)|0;if((n|0)!=(t|0)){if(n>>>0<s>>>0)Le();if((f[n+12>>2]|0)!=(c|0))Le()}if((r|0)==(n|0)){f[735]=f[735]&~(1<<i);b=c;a=h;break}if((r|0)!=(t|0)){if(r>>>0<s>>>0)Le();t=r+8|0;if((f[t>>2]|0)==(c|0))o=t;else Le()}else o=r+8|0;f[n+12>>2]=r;f[o>>2]=n;b=c;a=h;break}o=f[e+(l+24)>>2]|0;n=f[e+(l+12)>>2]|0;do{if((n|0)==(c|0)){r=e+(l+20)|0;t=f[r>>2]|0;if(!t){r=e+(l+16)|0;t=f[r>>2]|0;if(!t){u=0;break}}while(1){n=t+20|0;i=f[n>>2]|0;if(i){t=i;r=n;continue}n=t+16|0;i=f[n>>2]|0;if(!i)break;else{t=i;r=n}}if(r>>>0<s>>>0)Le();else{f[r>>2]=0;u=t;break}}else{i=f[e+(l+8)>>2]|0;if(i>>>0<s>>>0)Le();t=i+12|0;if((f[t>>2]|0)!=(c|0))Le();r=n+8|0;if((f[r>>2]|0)==(c|0)){f[t>>2]=n;f[r>>2]=i;u=n;break}else Le()}}while(0);if(o){t=f[e+(l+28)>>2]|0;r=3244+(t<<2)|0;if((c|0)==(f[r>>2]|0)){f[r>>2]=u;if(!u){f[736]=f[736]&~(1<<t);b=c;a=h;break}}else{if(o>>>0<(f[739]|0)>>>0)Le();t=o+16|0;if((f[t>>2]|0)==(c|0))f[t>>2]=u;else f[o+20>>2]=u;if(!u){b=c;a=h;break}}r=f[739]|0;if(u>>>0<r>>>0)Le();f[u+24>>2]=o;t=f[e+(l+16)>>2]|0;do{if(t)if(t>>>0<r>>>0)Le();else{f[u+16>>2]=t;f[t+24>>2]=u;break}}while(0);t=f[e+(l+20)>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[u+20>>2]=t;f[t+24>>2]=u;b=c;a=h;break}else{b=c;a=h}}else{b=c;a=h}}else{b=t;a=p}}while(0);if(b>>>0>=g>>>0)Le();t=e+(p+-4)|0;r=f[t>>2]|0;if(!(r&1))Le();if(!(r&2)){if((g|0)==(f[741]|0)){_=(f[738]|0)+a|0;f[738]=_;f[741]=b;f[b+4>>2]=_|1;if((b|0)!=(f[740]|0))return;f[740]=0;f[737]=0;return}if((g|0)==(f[740]|0)){_=(f[737]|0)+a|0;f[737]=_;f[740]=b;f[b+4>>2]=_|1;f[b+_>>2]=_;return}a=(r&-8)+a|0;i=r>>>3;do{if(r>>>0>=256){o=f[e+(p+16)>>2]|0;t=f[e+(p|4)>>2]|0;do{if((t|0)==(g|0)){r=e+(p+12)|0;t=f[r>>2]|0;if(!t){r=e+(p+8)|0;t=f[r>>2]|0;if(!t){m=0;break}}while(1){n=t+20|0;i=f[n>>2]|0;if(i){t=i;r=n;continue}n=t+16|0;i=f[n>>2]|0;if(!i)break;else{t=i;r=n}}if(r>>>0<(f[739]|0)>>>0)Le();else{f[r>>2]=0;m=t;break}}else{r=f[e+p>>2]|0;if(r>>>0<(f[739]|0)>>>0)Le();n=r+12|0;if((f[n>>2]|0)!=(g|0))Le();i=t+8|0;if((f[i>>2]|0)==(g|0)){f[n>>2]=t;f[i>>2]=r;m=t;break}else Le()}}while(0);if(o){t=f[e+(p+20)>>2]|0;r=3244+(t<<2)|0;if((g|0)==(f[r>>2]|0)){f[r>>2]=m;if(!m){f[736]=f[736]&~(1<<t);break}}else{if(o>>>0<(f[739]|0)>>>0)Le();t=o+16|0;if((f[t>>2]|0)==(g|0))f[t>>2]=m;else f[o+20>>2]=m;if(!m)break}r=f[739]|0;if(m>>>0<r>>>0)Le();f[m+24>>2]=o;t=f[e+(p+8)>>2]|0;do{if(t)if(t>>>0<r>>>0)Le();else{f[m+16>>2]=t;f[t+24>>2]=m;break}}while(0);t=f[e+(p+12)>>2]|0;if(t)if(t>>>0<(f[739]|0)>>>0)Le();else{f[m+20>>2]=t;f[t+24>>2]=m;break}}}else{n=f[e+p>>2]|0;r=f[e+(p|4)>>2]|0;t=2980+(i<<1<<2)|0;if((n|0)!=(t|0)){if(n>>>0<(f[739]|0)>>>0)Le();if((f[n+12>>2]|0)!=(g|0))Le()}if((r|0)==(n|0)){f[735]=f[735]&~(1<<i);break}if((r|0)!=(t|0)){if(r>>>0<(f[739]|0)>>>0)Le();t=r+8|0;if((f[t>>2]|0)==(g|0))d=t;else Le()}else d=r+8|0;f[n+12>>2]=r;f[d>>2]=n}}while(0);f[b+4>>2]=a|1;f[b+a>>2]=a;if((b|0)==(f[740]|0)){f[737]=a;return}}else{f[t>>2]=r&-2;f[b+4>>2]=a|1;f[b+a>>2]=a}t=a>>>3;if(a>>>0<256){r=t<<1;i=2980+(r<<2)|0;n=f[735]|0;t=1<<t;if(n&t){t=2980+(r+2<<2)|0;r=f[t>>2]|0;if(r>>>0<(f[739]|0)>>>0)Le();else{v=t;y=r}}else{f[735]=n|t;v=2980+(r+2<<2)|0;y=i}f[v>>2]=b;f[y+12>>2]=b;f[b+8>>2]=y;f[b+12>>2]=i;return}t=a>>>8;if(t)if(a>>>0>16777215)i=31;else{v=(t+1048320|0)>>>16&8;y=t<<v;g=(y+520192|0)>>>16&4;y=y<<g;i=(y+245760|0)>>>16&2;i=14-(g|v|i)+(y<<i>>>15)|0;i=a>>>(i+7|0)&1|i<<1}else i=0;t=3244+(i<<2)|0;f[b+28>>2]=i;f[b+20>>2]=0;f[b+16>>2]=0;r=f[736]|0;n=1<<i;e:do{if(r&n){t=f[t>>2]|0;t:do{if((f[t+4>>2]&-8|0)!=(a|0)){i=a<<((i|0)==31?0:25-(i>>>1)|0);while(1){r=t+16+(i>>>31<<2)|0;n=f[r>>2]|0;if(!n)break;if((f[n+4>>2]&-8|0)==(a|0)){_=n;break t}else{i=i<<1;t=n}}if(r>>>0<(f[739]|0)>>>0)Le();else{f[r>>2]=b;f[b+24>>2]=t;f[b+12>>2]=b;f[b+8>>2]=b;break e}}else _=t}while(0);t=_+8|0;r=f[t>>2]|0;y=f[739]|0;if(r>>>0>=y>>>0&_>>>0>=y>>>0){f[r+12>>2]=b;f[t>>2]=b;f[b+8>>2]=r;f[b+12>>2]=_;f[b+24>>2]=0;break}else Le()}else{f[736]=r|n;f[t>>2]=b;f[b+24>>2]=t;f[b+12>>2]=b;f[b+8>>2]=b}}while(0);b=(f[743]|0)+-1|0;f[743]=b;if(!b)t=3396;else return;while(1){t=f[t>>2]|0;if(!t)break;else t=t+8|0}f[743]=-1;return}function Hl(e,t){e=e|0;t=t|0;var r=0;if(e){r=ce(t,e)|0;if((t|e)>>>0>65535)r=((r>>>0)/(e>>>0)|0|0)==(t|0)?r:-1}else r=0;t=Cl(r)|0;if(!t)return t|0;if(!(f[t+-4>>2]&3))return t|0;Vl(t|0,0,r|0)|0;return t|0}function Ol(e,t){e=e|0;t=t|0;var r=0,n=0;if(!e){e=Cl(t)|0;return e|0}if(t>>>0>4294967231){e=Rs()|0;f[e>>2]=12;e=0;return e|0}r=Fl(e+-8|0,t>>>0<11?16:t+11&-8)|0;if(r){e=r+8|0;return e|0}r=Cl(t)|0;if(!r){e=0;return e|0}n=f[e+-4>>2]|0;n=(n&-8)-((n&3|0)==0?8:4)|0;Yl(r|0,e|0,(n>>>0<t>>>0?n:t)|0)|0;Il(e);e=r;return e|0}function Dl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;do{if((t|0)!=8){n=t>>>2;if((t&3|0)!=0|(n|0)==0){e=22;return e|0}if(n+1073741823&n){e=22;return e|0}if((-64-t|0)>>>0<r>>>0){e=12;return e|0}else{n=Nl(t>>>0<16?16:t,r)|0;break}}else n=Cl(r)|0}while(0);if(!n){e=12;return e|0}f[e>>2]=n;e=0;return e|0}function Fl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;p=e+4|0;m=f[p>>2]|0;l=m&-8;c=e+l|0;s=f[739]|0;r=m&3;if(!((r|0)!=1&e>>>0>=s>>>0&e>>>0<c>>>0))Le();n=e+(l|4)|0;i=f[n>>2]|0;if(!(i&1))Le();if(!r){if(t>>>0<256){e=0;return e|0}if(l>>>0>=(t+4|0)>>>0?(l-t|0)>>>0<=f[855]<<1>>>0:0)return e|0;e=0;return e|0}if(l>>>0>=t>>>0){r=l-t|0;if(r>>>0<=15)return e|0;f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=r|3;f[n>>2]=f[n>>2]|1;Ul(e+t|0,r);return e|0}if((c|0)==(f[741]|0)){r=(f[738]|0)+l|0;if(r>>>0<=t>>>0){e=0;return e|0}d=r-t|0;f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=d|1;f[741]=e+t;f[738]=d;return e|0}if((c|0)==(f[740]|0)){n=(f[737]|0)+l|0;if(n>>>0<t>>>0){e=0;return e|0}r=n-t|0;if(r>>>0>15){f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=r|1;f[e+n>>2]=r;n=e+(n+4)|0;f[n>>2]=f[n>>2]&-2;n=e+t|0}else{f[p>>2]=m&1|n|2;n=e+(n+4)|0;f[n>>2]=f[n>>2]|1;n=0;r=0}f[737]=r;f[740]=n;return e|0}if(i&2){e=0;return e|0}h=(i&-8)+l|0;if(h>>>0<t>>>0){e=0;return e|0}d=h-t|0;a=i>>>3;do{if(i>>>0>=256){o=f[e+(l+24)>>2]|0;a=f[e+(l+12)>>2]|0;do{if((a|0)==(c|0)){n=e+(l+20)|0;r=f[n>>2]|0;if(!r){n=e+(l+16)|0;r=f[n>>2]|0;if(!r){u=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<s>>>0)Le();else{f[n>>2]=0;u=r;break}}else{i=f[e+(l+8)>>2]|0;if(i>>>0<s>>>0)Le();r=i+12|0;if((f[r>>2]|0)!=(c|0))Le();n=a+8|0;if((f[n>>2]|0)==(c|0)){f[r>>2]=a;f[n>>2]=i;u=a;break}else Le()}}while(0);if(o){r=f[e+(l+28)>>2]|0;n=3244+(r<<2)|0;if((c|0)==(f[n>>2]|0)){f[n>>2]=u;if(!u){f[736]=f[736]&~(1<<r);break}}else{if(o>>>0<(f[739]|0)>>>0)Le();r=o+16|0;if((f[r>>2]|0)==(c|0))f[r>>2]=u;else f[o+20>>2]=u;if(!u)break}n=f[739]|0;if(u>>>0<n>>>0)Le();f[u+24>>2]=o;r=f[e+(l+16)>>2]|0;do{if(r)if(r>>>0<n>>>0)Le();else{f[u+16>>2]=r;f[r+24>>2]=u;break}}while(0);r=f[e+(l+20)>>2]|0;if(r)if(r>>>0<(f[739]|0)>>>0)Le();else{f[u+20>>2]=r;f[r+24>>2]=u;break}}}else{i=f[e+(l+8)>>2]|0;n=f[e+(l+12)>>2]|0;r=2980+(a<<1<<2)|0;if((i|0)!=(r|0)){if(i>>>0<s>>>0)Le();if((f[i+12>>2]|0)!=(c|0))Le()}if((n|0)==(i|0)){f[735]=f[735]&~(1<<a);break}if((n|0)!=(r|0)){if(n>>>0<s>>>0)Le();r=n+8|0;if((f[r>>2]|0)==(c|0))o=r;else Le()}else o=n+8|0;f[i+12>>2]=n;f[o>>2]=i}}while(0);if(d>>>0<16){f[p>>2]=h|m&1|2;t=e+(h|4)|0;f[t>>2]=f[t>>2]|1;return e|0}else{f[p>>2]=m&1|t|2;f[e+(t+4)>>2]=d|3;m=e+(h|4)|0;f[m>>2]=f[m>>2]|1;Ul(e+t|0,d);return e|0}return 0}function Nl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0;e=e>>>0<16?16:e;if(e+-1&e){r=16;while(1)if(r>>>0<e>>>0)r=r<<1;else{e=r;break}}if((-64-e|0)>>>0<=t>>>0){s=Rs()|0;f[s>>2]=12;s=0;return s|0}o=t>>>0<11?16:t+11&-8;n=Cl(o+12+e|0)|0;if(!n){s=0;return s|0}t=n+-8|0;r=e+-1|0;do{if(n&r){i=n+r&0-e;r=i+-8|0;a=t;i=(r-a|0)>>>0>15?r:i+(e+-8)|0;a=i-a|0;e=n+-4|0;n=f[e>>2]|0;r=(n&-8)-a|0;if(!(n&3)){f[i>>2]=(f[t>>2]|0)+a;f[i+4>>2]=r;t=i;break}else{n=i+4|0;f[n>>2]=r|f[n>>2]&1|2;r=i+(r+4)|0;f[r>>2]=f[r>>2]|1;f[e>>2]=a|f[e>>2]&1|2;f[n>>2]=f[n>>2]|1;Ul(t,a);t=i;break}}}while(0);e=t+4|0;r=f[e>>2]|0;if((r&3|0)!=0?(s=r&-8,s>>>0>(o+16|0)>>>0):0){a=s-o|0;f[e>>2]=o|r&1|2;f[t+(o|4)>>2]=a|3;s=t+(s|4)|0;f[s>>2]=f[s>>2]|1;Ul(t+o|0,a)}s=t+8|0;return s|0}function Ul(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0;g=e+t|0;r=f[e+4>>2]|0;do{if(!(r&1)){u=f[e>>2]|0;if(!(r&3))return;d=e+(0-u)|0;h=u+t|0;l=f[739]|0;if(d>>>0<l>>>0)Le();if((d|0)==(f[740]|0)){n=e+(t+4)|0;r=f[n>>2]|0;if((r&3|0)!=3){_=d;o=h;break}f[737]=h;f[n>>2]=r&-2;f[e+(4-u)>>2]=h|1;f[g>>2]=h;return}a=u>>>3;if(u>>>0<256){i=f[e+(8-u)>>2]|0;n=f[e+(12-u)>>2]|0;r=2980+(a<<1<<2)|0;if((i|0)!=(r|0)){if(i>>>0<l>>>0)Le();if((f[i+12>>2]|0)!=(d|0))Le()}if((n|0)==(i|0)){f[735]=f[735]&~(1<<a);_=d;o=h;break}if((n|0)!=(r|0)){if(n>>>0<l>>>0)Le();r=n+8|0;if((f[r>>2]|0)==(d|0))s=r;else Le()}else s=n+8|0;f[i+12>>2]=n;f[s>>2]=i;_=d;o=h;break}s=f[e+(24-u)>>2]|0;i=f[e+(12-u)>>2]|0;do{if((i|0)==(d|0)){i=16-u|0;n=e+(i+4)|0;r=f[n>>2]|0;if(!r){n=e+i|0;r=f[n>>2]|0;if(!r){c=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<l>>>0)Le();else{f[n>>2]=0;c=r;break}}else{a=f[e+(8-u)>>2]|0;if(a>>>0<l>>>0)Le();r=a+12|0;if((f[r>>2]|0)!=(d|0))Le();n=i+8|0;if((f[n>>2]|0)==(d|0)){f[r>>2]=i;f[n>>2]=a;c=i;break}else Le()}}while(0);if(s){r=f[e+(28-u)>>2]|0;n=3244+(r<<2)|0;if((d|0)==(f[n>>2]|0)){f[n>>2]=c;if(!c){f[736]=f[736]&~(1<<r);_=d;o=h;break}}else{if(s>>>0<(f[739]|0)>>>0)Le();r=s+16|0;if((f[r>>2]|0)==(d|0))f[r>>2]=c;else f[s+20>>2]=c;if(!c){_=d;o=h;break}}i=f[739]|0;if(c>>>0<i>>>0)Le();f[c+24>>2]=s;r=16-u|0;n=f[e+r>>2]|0;do{if(n)if(n>>>0<i>>>0)Le();else{f[c+16>>2]=n;f[n+24>>2]=c;break}}while(0);r=f[e+(r+4)>>2]|0;if(r)if(r>>>0<(f[739]|0)>>>0)Le();else{f[c+20>>2]=r;f[r+24>>2]=c;_=d;o=h;break}else{_=d;o=h}}else{_=d;o=h}}else{_=e;o=t}}while(0);l=f[739]|0;if(g>>>0<l>>>0)Le();r=e+(t+4)|0;n=f[r>>2]|0;if(!(n&2)){if((g|0)==(f[741]|0)){y=(f[738]|0)+o|0;f[738]=y;f[741]=_;f[_+4>>2]=y|1;if((_|0)!=(f[740]|0))return;f[740]=0;f[737]=0;return}if((g|0)==(f[740]|0)){y=(f[737]|0)+o|0;f[737]=y;f[740]=_;f[_+4>>2]=y|1;f[_+y>>2]=y;return}o=(n&-8)+o|0;a=n>>>3;do{if(n>>>0>=256){s=f[e+(t+24)>>2]|0;i=f[e+(t+12)>>2]|0;do{if((i|0)==(g|0)){n=e+(t+20)|0;r=f[n>>2]|0;if(!r){n=e+(t+16)|0;r=f[n>>2]|0;if(!r){m=0;break}}while(1){i=r+20|0;a=f[i>>2]|0;if(a){r=a;n=i;continue}i=r+16|0;a=f[i>>2]|0;if(!a)break;else{r=a;n=i}}if(n>>>0<l>>>0)Le();else{f[n>>2]=0;m=r;break}}else{a=f[e+(t+8)>>2]|0;if(a>>>0<l>>>0)Le();r=a+12|0;if((f[r>>2]|0)!=(g|0))Le();n=i+8|0;if((f[n>>2]|0)==(g|0)){f[r>>2]=i;f[n>>2]=a;m=i;break}else Le()}}while(0);if(s){r=f[e+(t+28)>>2]|0;n=3244+(r<<2)|0;if((g|0)==(f[n>>2]|0)){f[n>>2]=m;if(!m){f[736]=f[736]&~(1<<r);break}}else{if(s>>>0<(f[739]|0)>>>0)Le();r=s+16|0;if((f[r>>2]|0)==(g|0))f[r>>2]=m;else f[s+20>>2]=m;if(!m)break}n=f[739]|0;if(m>>>0<n>>>0)Le();f[m+24>>2]=s;r=f[e+(t+16)>>2]|0;do{if(r)if(r>>>0<n>>>0)Le();else{f[m+16>>2]=r;f[r+24>>2]=m;break}}while(0);r=f[e+(t+20)>>2]|0;if(r)if(r>>>0<(f[739]|0)>>>0)Le();else{f[m+20>>2]=r;f[r+24>>2]=m;break}}}else{i=f[e+(t+8)>>2]|0;n=f[e+(t+12)>>2]|0;r=2980+(a<<1<<2)|0;if((i|0)!=(r|0)){if(i>>>0<l>>>0)Le();if((f[i+12>>2]|0)!=(g|0))Le()}if((n|0)==(i|0)){f[735]=f[735]&~(1<<a);break}if((n|0)!=(r|0)){if(n>>>0<l>>>0)Le();r=n+8|0;if((f[r>>2]|0)==(g|0))p=r;else Le()}else p=n+8|0;f[i+12>>2]=n;f[p>>2]=i}}while(0);f[_+4>>2]=o|1;f[_+o>>2]=o;if((_|0)==(f[740]|0)){f[737]=o;return}}else{f[r>>2]=n&-2;f[_+4>>2]=o|1;f[_+o>>2]=o}r=o>>>3;if(o>>>0<256){n=r<<1;a=2980+(n<<2)|0;i=f[735]|0;r=1<<r;if(i&r){r=2980+(n+2<<2)|0;n=f[r>>2]|0;if(n>>>0<(f[739]|0)>>>0)Le();else{v=r;y=n}}else{f[735]=i|r;v=2980+(n+2<<2)|0;y=a}f[v>>2]=_;f[y+12>>2]=_;f[_+8>>2]=y;f[_+12>>2]=a;return}r=o>>>8;if(r)if(o>>>0>16777215)a=31;else{v=(r+1048320|0)>>>16&8;y=r<<v;g=(y+520192|0)>>>16&4;y=y<<g;a=(y+245760|0)>>>16&2;a=14-(g|v|a)+(y<<a>>>15)|0;a=o>>>(a+7|0)&1|a<<1}else a=0;r=3244+(a<<2)|0;f[_+28>>2]=a;f[_+20>>2]=0;f[_+16>>2]=0;n=f[736]|0;i=1<<a;if(!(n&i)){f[736]=n|i;f[r>>2]=_;f[_+24>>2]=r;f[_+12>>2]=_;f[_+8>>2]=_;return}r=f[r>>2]|0;e:do{if((f[r+4>>2]&-8|0)!=(o|0)){a=o<<((a|0)==31?0:25-(a>>>1)|0);while(1){n=r+16+(a>>>31<<2)|0;i=f[n>>2]|0;if(!i)break;if((f[i+4>>2]&-8|0)==(o|0)){r=i;break e}else{a=a<<1;r=i}}if(n>>>0<(f[739]|0)>>>0)Le();f[n>>2]=_;f[_+24>>2]=r;f[_+12>>2]=_;f[_+8>>2]=_;return}}while(0);n=r+8|0;i=f[n>>2]|0;y=f[739]|0;if(!(i>>>0>=y>>>0&r>>>0>=y>>>0))Le();f[i+12>>2]=_;f[n>>2]=_;f[_+8>>2]=i;f[_+12>>2]=r;f[_+24>>2]=0;return}function Bl(){}function zl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;n=t-n-(r>>>0>e>>>0|0)>>>0;return(B=n,e-r>>>0|0)|0}function jl(e,t,r){e=e|0;t=t|0;r=r|0;if((r|0)<32){B=t>>r;return e>>>r|(t&(1<<r)-1)<<32-r}B=(t|0)<0?-1:0;return t>>r-32|0}function Vl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0,o=0;n=e+r|0;if((r|0)>=20){t=t&255;a=e&3;o=t|t<<8|t<<16|t<<24;i=n&~3;if(a){a=e+4-a|0;while((e|0)<(a|0)){h[e>>0]=t;e=e+1|0}}while((e|0)<(i|0)){f[e>>2]=o;e=e+4|0}}while((e|0)<(n|0)){h[e>>0]=t;e=e+1|0}return e-r|0}function Gl(e,t,r){e=e|0;t=t|0;r=r|0;if((r|0)<32){B=t<<r|(e&(1<<r)-1<<32-r)>>>32-r;return e<<r}B=e<<r-32;return 0}function Wl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;r=e+r>>>0;return(B=t+n+(r>>>0<e>>>0|0)>>>0,r|0)|0}function Xl(e,t,r){e=e|0;t=t|0;r=r|0;if((r|0)<32){B=t>>>r;return e>>>r|(t&(1<<r)-1)<<32-r}B=0;return t>>>r-32|0}function Yl(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if((r|0)>=4096)return De(e|0,t|0,r|0)|0;n=e|0;if((e&3)==(t&3)){while(e&3){if(!r)return n|0;h[e>>0]=h[t>>0]|0;e=e+1|0;t=t+1|0;r=r-1|0}while((r|0)>=4){f[e>>2]=f[t>>2];e=e+4|0;t=t+4|0;r=r-4|0}}while((r|0)>0){h[e>>0]=h[t>>0]|0;e=e+1|0;t=t+1|0;r=r-1|0}return n|0}function ql(e){e=e|0;var t=0;t=h[T+(e&255)>>0]|0;if((t|0)<8)return t|0;t=h[T+(e>>8&255)>>0]|0;if((t|0)<8)return t+8|0;t=h[T+(e>>16&255)>>0]|0;if((t|0)<8)return t+16|0;return(h[T+(e>>>24)>>0]|0)+24|0}function Zl(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0;a=e&65535;i=t&65535;r=ce(i,a)|0;n=e>>>16;e=(r>>>16)+(ce(i,n)|0)|0;i=t>>>16;t=ce(i,a)|0;return(B=(e>>>16)+(ce(i,n)|0)+(((e&65535)+t|0)>>>16)|0,e+t<<16|r&65535|0)|0}function Kl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;u=t>>31|((t|0)<0?-1:0)<<1;l=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1;a=n>>31|((n|0)<0?-1:0)<<1;i=((n|0)<0?-1:0)>>31|((n|0)<0?-1:0)<<1;s=zl(u^e,l^t,u,l)|0;o=B;e=a^u;t=i^l;return zl((tu(s,o,zl(a^r,i^n,a,i)|0,B,0)|0)^e,B^t,e,t)|0}function Ql(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0,o=0,s=0,l=0,u=0;i=b;b=b+16|0;s=i|0;o=t>>31|((t|0)<0?-1:0)<<1;a=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1;u=n>>31|((n|0)<0?-1:0)<<1;l=((n|0)<0?-1:0)>>31|((n|0)<0?-1:0)<<1;e=zl(o^e,a^t,o,a)|0;t=B;tu(e,t,zl(u^r,l^n,u,l)|0,B,s)|0;n=zl(f[s>>2]^o,f[s+4>>2]^a,o,a)|0;r=B;b=i;return(B=r,n)|0}function Jl(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;i=e;a=r;r=Zl(i,a)|0;e=B;return(B=(ce(t,a)|0)+(ce(n,i)|0)+e|e&0,r|0|0)|0}function $l(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return tu(e,t,r,n,0)|0}function eu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,a=0;a=b;b=b+16|0;i=a|0;tu(e,t,r,n,i)|0;b=a;return(B=f[i+4>>2]|0,f[i>>2]|0)|0}function tu(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,p=0,m=0;c=e;l=t;u=l;o=r;d=n;s=d;if(!u){a=(i|0)!=0;if(!s){if(a){f[i>>2]=(c>>>0)%(o>>>0);f[i+4>>2]=0}d=0;i=(c>>>0)/(o>>>0)>>>0;return(B=d,i)|0}else{if(!a){d=0;i=0;return(B=d,i)|0}f[i>>2]=e|0;f[i+4>>2]=t&0;d=0;i=0;return(B=d,i)|0}}a=(s|0)==0;do{if(o){if(!a){a=(de(s|0)|0)-(de(u|0)|0)|0;if(a>>>0<=31){h=a+1|0;s=31-a|0;t=a-31>>31;o=h;e=c>>>(h>>>0)&t|u<<s;t=u>>>(h>>>0)&t;a=0;s=c<<s;break}if(!i){d=0;i=0;return(B=d,i)|0}f[i>>2]=e|0;f[i+4>>2]=l|t&0;d=0;i=0;return(B=d,i)|0}a=o-1|0;if(a&o){s=(de(o|0)|0)+33-(de(u|0)|0)|0;m=64-s|0;h=32-s|0;l=h>>31;p=s-32|0;t=p>>31;o=s;e=h-1>>31&u>>>(p>>>0)|(u<<h|c>>>(s>>>0))&t;t=t&u>>>(s>>>0);a=c<<m&l;s=(u<<m|c>>>(p>>>0))&l|c<<h&s-33>>31;break}if(i){f[i>>2]=a&c;f[i+4>>2]=0}if((o|0)==1){p=l|t&0;m=e|0|0;return(B=p,m)|0}else{m=ql(o|0)|0;p=u>>>(m>>>0)|0;m=u<<32-m|c>>>(m>>>0)|0;return(B=p,m)|0}}else{if(a){if(i){f[i>>2]=(u>>>0)%(o>>>0);f[i+4>>2]=0}p=0;m=(u>>>0)/(o>>>0)>>>0;return(B=p,m)|0}if(!c){if(i){f[i>>2]=0;f[i+4>>2]=(u>>>0)%(s>>>0)}p=0;m=(u>>>0)/(s>>>0)>>>0;return(B=p,m)|0}a=s-1|0;if(!(a&s)){if(i){f[i>>2]=e|0;f[i+4>>2]=a&u|t&0}p=0;m=u>>>((ql(s|0)|0)>>>0);return(B=p,m)|0}a=(de(s|0)|0)-(de(u|0)|0)|0;if(a>>>0<=30){t=a+1|0;s=31-a|0;o=t;e=u<<s|c>>>(t>>>0);t=u>>>(t>>>0);a=0;s=c<<s;break}if(!i){p=0;m=0;return(B=p,m)|0}f[i>>2]=e|0;f[i+4>>2]=l|t&0;p=0;m=0;return(B=p,m)|0}}while(0);if(!o){u=s;l=0;s=0}else{h=r|0|0;c=d|n&0;u=Wl(h|0,c|0,-1,-1)|0;r=B;l=s;s=0;do{n=l;l=a>>>31|l<<1;a=s|a<<1;n=e<<1|n>>>31|0;d=e>>>31|t<<1|0;zl(u,r,n,d)|0;m=B;p=m>>31|((m|0)<0?-1:0)<<1;s=p&1;e=zl(n,d,p&h,(((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1)&c)|0;t=B;o=o-1|0}while((o|0)!=0);u=l;l=0}o=0;if(i){f[i>>2]=e;f[i+4>>2]=t}p=(a|0)>>>31|(u|o)<<1|(o<<1|a>>>31)&0|l;m=(a<<1|0>>>31)&-2|s;return(B=p,m)|0}function ru(e,t,r,n,i,a,o,s){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;return Ru[e&3](t|0,r|0,n|0,i|0,a|0,o|0,s|0)|0}function nu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return ku[e&63](t|0,r|0,n|0)|0}function iu(e,t){e=e|0;t=t|0;return+Pu[e&3](t|0)}function au(e,t){e=e|0;t=t|0;Lu[e&7](t|0)}function ou(e,t,r){e=e|0;t=t|0;r=r|0;Cu[e&7](t|0,r|0)}function su(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;return Iu[e&7](t|0,r|0,n|0,i|0,a|0,o|0)|0}function lu(e,t){e=e|0;t=t|0;return Hu[e&15](t|0)|0}function uu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;Ou[e&15](t|0,r|0,n|0)}function cu(e,t,r,n,i,a,o,s,l,u,c,h){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;h=h|0;return Du[e&3](t|0,r|0,n|0,i|0,a|0,o|0,s|0,l|0,u|0,c|0,h|0)|0}function hu(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;return Fu[e&63](t|0,r|0,n|0,i|0)|0}function du(e,t,r){e=e|0;t=t|0;r=r|0;return Nu[e&7](t|0,r|0)|0}function fu(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;return Uu[e&3](t|0,r|0,n|0,i|0,a|0)|0}function pu(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;Bu[e&3](t|0,r|0,n|0,i|0)}function mu(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;fe(0);return 0}function gu(e,t,r){e=e|0;t=t|0;r=r|0;fe(1);return 0}function vu(e){e=e|0;fe(2);return 0.0}function yu(e){e=e|0;fe(3)}function _u(e,t){e=e|0;t=t|0;fe(4)}function bu(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;fe(5);return 0}function Eu(e){e=e|0;fe(6);return 0}function wu(e,t,r){e=e|0;t=t|0;r=r|0;fe(7)}function xu(e,t,r,n,i,a,o,s,l,u,c){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;s=s|0;l=l|0;u=u|0;c=c|0;fe(8);return 0}function Tu(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;fe(9);return 0}function Mu(e,t){e=e|0;t=t|0;fe(10);return 0}function Su(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;fe(11);return 0}function Au(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;fe(12)}var Ru=[mu,ca,Gt,mu];var ku=[gu,Rl,qs,Xs,Cn,In,Hn,On,Ui,Bi,ji,aa,_a,Dt,Kt,ba,Ea,Ot,Ft,Vi,Gi,Wi,Xi,Ma,Sa,Aa,Ra,Pa,La,Ia,Ha,Oa,Da,Fa,Na,Ua,Ba,za,ja,Va,Ga,Wa,Xa,Ya,qa,Za,Ka,Qa,Ja,$a,eo,to,er,tr,rr,nr,ir,ar,or,sr,Ws,Ys,gu,gu];var Pu=[vu,ro,no,vu];var Lu=[yu,ra,Vt,tn,rn,Tl,Ml,yu];var Cu=[_u,yn,_n,bn,ei,ea,It,_u];var Iu=[bu,ua,jt,xa,zt,bu,bu,bu];var Hu=[Eu,Gs,ma,ga,Zt,qt,Qs,Fo,Ho,Eu,Eu,Eu,Eu,Eu,Eu,Eu];var Ou=[wu,Rt,kt,Pt,Lt,wt,xt,Tt,Mt,yt,_t,bt,Et,da,Yt,wu];var Du=[xu,la,Bt,xu];var Fu=[Tu,uo,co,tt,rt,nt,it,at,ot,st,lt,ut,ct,ht,dt,ft,pt,mt,gt,vt,yr,_r,br,dr,fr,pr,mr,gr,vr,Rn,kn,Pn,Ln,va,oa,Ct,Ut,wa,na,Nt,Ht,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu,Tu];var Nu=[Mu,zi,lr,ur,cr,hr,Mu,Mu];var Uu=[Su,ya,Wt,Su];var Bu=[Au,zo,Go,Au];return{_opj_stream_destroy:Fn,_opj_stream_set_read_function:Nn,_opj_read_tile_header:yi,_opj_set_warning_handler:li,_opj_destroy_cstr_info:Hi,_opj_image_create:ri,_opj_set_error_handler:ui,_opj_stream_set_user_data:jn,_opj_end_decompress:Ri,_bitshift64Lshr:Xl,_opj_stream_set_seek_function:Un,_opj_decode:gi,_opj_set_decoded_resolution_factor:Ei,_i64Add:Wl,_opj_stream_create_default_file_stream:Fi,_opj_encode:Si,_bitshift64Ashr:jl,_opj_get_decoded_tile:bi,_memset:Vl,_opj_version:hi,_memcpy:Yl,_opj_destroy_cstr_index:Di,_opj_stream_set_user_data_length:Vn,_opj_stream_set_skip_function:zn,_opj_image_destroy:ni,_opj_stream_create_file_stream:Ni,_opj_setup_encoder:Ti,_opj_stream_default_create:Dn,_bitshift64Shl:Gl,_opj_stream_create:An,_jp2_version:vn,_i64Subtract:zl,_opj_get_cstr_index:Oi,_opj_set_default_decoder_parameters:fi,_opj_read_header:mi,_opj_get_cstr_info:Ii,_opj_set_default_encoder_parameters:xi,_opj_set_decode_area:vi,_opj_stream_set_write_function:Bn,_opj_dump_codec:Ci,_opj_create_decompress:di,_opj_decode_tile_data:_i,_free:Il,_opj_image_tile_create:oi,_opj_set_MCT:ki,_opj_set_info_handler:si,_opj_start_compress:Mi,_opj_write_tile:Pi,_opj_setup_decoder:pi,_malloc:Cl,_opj_end_compress:Ai,_opj_destroy_codec:Li,_jp2_decode:gn,_opj_stream_create_buffer_stream:ci,_opj_create_compress:wi,runPostSets:Bl,_emscripten_replace_memory:et,stackAlloc:sn,stackSave:ln,stackRestore:un,establishStackSpace:cn,setThrew:hn,setTempRet0:pn,getTempRet0:mn,dynCall_iiiiiiii:ru,dynCall_iiii:nu,dynCall_di:iu,dynCall_vi:au,dynCall_vii:ou,dynCall_iiiiiii:su,dynCall_ii:lu,dynCall_viii:uu,dynCall_iiiiiiiiiiii:cu,dynCall_iiiii:hu,dynCall_iii:du,dynCall_iiiiii:fu,dynCall_viiii:pu}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer),_opj_stream_destroy=Module._opj_stream_destroy=asm._opj_stream_destroy,_opj_stream_set_read_function=Module._opj_stream_set_read_function=asm._opj_stream_set_read_function,_opj_read_tile_header=Module._opj_read_tile_header=asm._opj_read_tile_header,_opj_set_warning_handler=Module._opj_set_warning_handler=asm._opj_set_warning_handler,_opj_destroy_cstr_info=Module._opj_destroy_cstr_info=asm._opj_destroy_cstr_info,_opj_image_create=Module._opj_image_create=asm._opj_image_create,_opj_set_error_handler=Module._opj_set_error_handler=asm._opj_set_error_handler,_opj_image_tile_create=Module._opj_image_tile_create=asm._opj_image_tile_create,_opj_end_decompress=Module._opj_end_decompress=asm._opj_end_decompress,_bitshift64Lshr=Module._bitshift64Lshr=asm._bitshift64Lshr,_opj_stream_set_seek_function=Module._opj_stream_set_seek_function=asm._opj_stream_set_seek_function,_opj_decode=Module._opj_decode=asm._opj_decode,_opj_set_decoded_resolution_factor=Module._opj_set_decoded_resolution_factor=asm._opj_set_decoded_resolution_factor,_opj_stream_create_default_file_stream=Module._opj_stream_create_default_file_stream=asm._opj_stream_create_default_file_stream,_opj_set_default_decoder_parameters=Module._opj_set_default_decoder_parameters=asm._opj_set_default_decoder_parameters,_bitshift64Ashr=Module._bitshift64Ashr=asm._bitshift64Ashr,_opj_get_decoded_tile=Module._opj_get_decoded_tile=asm._opj_get_decoded_tile,_memset=Module._memset=asm._memset,_opj_version=Module._opj_version=asm._opj_version,_memcpy=Module._memcpy=asm._memcpy,_opj_destroy_cstr_index=Module._opj_destroy_cstr_index=asm._opj_destroy_cstr_index,_opj_stream_set_user_data_length=Module._opj_stream_set_user_data_length=asm._opj_stream_set_user_data_length,_opj_stream_set_skip_function=Module._opj_stream_set_skip_function=asm._opj_stream_set_skip_function,_opj_image_destroy=Module._opj_image_destroy=asm._opj_image_destroy,_opj_stream_create_file_stream=Module._opj_stream_create_file_stream=asm._opj_stream_create_file_stream,_opj_setup_encoder=Module._opj_setup_encoder=asm._opj_setup_encoder,_opj_stream_default_create=Module._opj_stream_default_create=asm._opj_stream_default_create,_bitshift64Shl=Module._bitshift64Shl=asm._bitshift64Shl,_opj_stream_create=Module._opj_stream_create=asm._opj_stream_create,_jp2_version=Module._jp2_version=asm._jp2_version,_i64Subtract=Module._i64Subtract=asm._i64Subtract,_opj_get_cstr_index=Module._opj_get_cstr_index=asm._opj_get_cstr_index,_opj_encode=Module._opj_encode=asm._opj_encode,_i64Add=Module._i64Add=asm._i64Add,_opj_get_cstr_info=Module._opj_get_cstr_info=asm._opj_get_cstr_info,_opj_set_default_encoder_parameters=Module._opj_set_default_encoder_parameters=asm._opj_set_default_encoder_parameters,_opj_set_decode_area=Module._opj_set_decode_area=asm._opj_set_decode_area,_opj_stream_set_write_function=Module._opj_stream_set_write_function=asm._opj_stream_set_write_function,_opj_dump_codec=Module._opj_dump_codec=asm._opj_dump_codec,_opj_read_header=Module._opj_read_header=asm._opj_read_header,_opj_create_decompress=Module._opj_create_decompress=asm._opj_create_decompress,_opj_decode_tile_data=Module._opj_decode_tile_data=asm._opj_decode_tile_data,_opj_set_info_handler=Module._opj_set_info_handler=asm._opj_set_info_handler,_opj_stream_set_user_data=Module._opj_stream_set_user_data=asm._opj_stream_set_user_data,_opj_set_MCT=Module._opj_set_MCT=asm._opj_set_MCT,_free=Module._free=asm._free,runPostSets=Module.runPostSets=asm.runPostSets,_opj_start_compress=Module._opj_start_compress=asm._opj_start_compress,_opj_write_tile=Module._opj_write_tile=asm._opj_write_tile,_opj_setup_decoder=Module._opj_setup_decoder=asm._opj_setup_decoder,_malloc=Module._malloc=asm._malloc,_opj_end_compress=Module._opj_end_compress=asm._opj_end_compress,_opj_destroy_codec=Module._opj_destroy_codec=asm._opj_destroy_codec,_emscripten_replace_memory=Module._emscripten_replace_memory=asm._emscripten_replace_memory,_jp2_decode=Module._jp2_decode=asm._jp2_decode,_opj_stream_create_buffer_stream=Module._opj_stream_create_buffer_stream=asm._opj_stream_create_buffer_stream,_opj_create_compress=Module._opj_create_compress=asm._opj_create_compress,dynCall_iiiiiiii=Module.dynCall_iiiiiiii=asm.dynCall_iiiiiiii,dynCall_iiii=Module.dynCall_iiii=asm.dynCall_iiii,dynCall_di=Module.dynCall_di=asm.dynCall_di,dynCall_vi=Module.dynCall_vi=asm.dynCall_vi,dynCall_vii=Module.dynCall_vii=asm.dynCall_vii,dynCall_iiiiiii=Module.dynCall_iiiiiii=asm.dynCall_iiiiiii,dynCall_ii=Module.dynCall_ii=asm.dynCall_ii,dynCall_viii=Module.dynCall_viii=asm.dynCall_viii,dynCall_iiiiiiiiiiii=Module.dynCall_iiiiiiiiiiii=asm.dynCall_iiiiiiiiiiii,dynCall_iiiii=Module.dynCall_iiiii=asm.dynCall_iiiii,dynCall_iii=Module.dynCall_iii=asm.dynCall_iii,dynCall_iiiiii=Module.dynCall_iiiiii=asm.dynCall_iiiiii,dynCall_viiii=Module.dynCall_viiii=asm.dynCall_viiii,initialStackTop;function ExitStatus(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}Runtime.stackAlloc=asm.stackAlloc,Runtime.stackSave=asm.stackSave,Runtime.stackRestore=asm.stackRestore,Runtime.establishStackSpace=asm.establishStackSpace,Runtime.setTempRet0=asm.setTempRet0,Runtime.getTempRet0=asm.getTempRet0,ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var preloadStartTime=null,calledMain=!1;function run(e){function t(){Module.calledRun||(Module.calledRun=!0,ABORT||(ensureInitRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),Module._main&&shouldRunNow&&Module.callMain(e),postRun()))}e=e||Module.arguments,null===preloadStartTime&&(preloadStartTime=Date.now()),runDependencies>0||(preRun(),runDependencies>0||Module.calledRun||(Module.setStatus?(Module.setStatus("Running..."),setTimeout((function(){setTimeout((function(){Module.setStatus("")}),1),t()}),1)):t()))}function exit(e,t){if(!t||!Module.noExitRuntime)throw Module.noExitRuntime||(ABORT=!0,EXITSTATUS=e,STACKTOP=initialStackTop,exitRuntime(),Module.onExit&&Module.onExit(e)),ENVIRONMENT_IS_NODE?(process.stdout.once("drain",(function(){process.exit(e)})),console.log(" "),setTimeout((function(){process.exit(e)}),500)):ENVIRONMENT_IS_SHELL&&"function"==typeof quit&&quit(e),new ExitStatus(e)}dependenciesFulfilled=function e(){Module.calledRun||run(),Module.calledRun||(dependenciesFulfilled=e)},Module.callMain=Module.callMain=function(e){assert(0==runDependencies,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==__ATPRERUN__.length,"cannot call main when preRun functions remain to be called"),e=e||[],ensureInitRuntime();var t=e.length+1;function r(){for(var e=0;e<3;e++)n.push(0)}var n=[allocate(intArrayFromString(Module.thisProgram),"i8",ALLOC_NORMAL)];r();for(var i=0;i<t-1;i+=1)n.push(allocate(intArrayFromString(e[i]),"i8",ALLOC_NORMAL)),r();n.push(0),n=allocate(n,"i32",ALLOC_NORMAL);try{exit(Module._main(t,n,0),!0)}catch(e){if(e instanceof ExitStatus)return;if("SimulateInfiniteLoop"==e)return void(Module.noExitRuntime=!0);throw e&&"object"==typeof e&&e.stack&&Module.printErr("exception thrown: "+[e,e.stack]),e}finally{calledMain=!0}},Module.run=Module.run=run,Module.exit=Module.exit=exit;var abortDecorators=[];function abort(e){void 0!==e?(Module.print(e),Module.printErr(e),e=JSON.stringify(e)):e="",ABORT=!0,EXITSTATUS=1;var t="abort("+e+") at "+stackTrace()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw abortDecorators&&abortDecorators.forEach((function(r){t=r(t,e)})),t}if(Module.abort=Module.abort=abort,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;return Module.noInitialRun&&(shouldRunNow=!1),run(),Module}}).call(this,__webpack_require__(16),"/")},function(e,t){THREE.OrbitControls=function(e,t){var r,n,i,a,o;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=h.NONE},this.update=(r=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=n.clone().inverse(),a=new THREE.Vector3,o=new THREE.Quaternion,function(){var e=s.object.position;return r.copy(e).sub(s.target),r.applyQuaternion(n),p.setFromVector3(r),s.autoRotate&&d===h.NONE&&k(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(p.theta+=m.theta*s.dampingFactor,p.phi+=m.phi*s.dampingFactor):(p.theta+=m.theta,p.phi+=m.phi),p.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,p.theta)),p.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=g,p.radius=Math.max(s.minDistance,Math.min(s.maxDistance,p.radius)),!0===s.enableDamping?s.target.addScaledVector(v,s.dampingFactor):s.target.add(v),r.setFromSpherical(p),r.applyQuaternion(i),e.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,v.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),v.set(0,0,0)),g=1,!!(y||a.distanceToSquared(s.object.position)>f||8*(1-o.dot(s.object.quaternion))>f)&&(s.dispatchEvent(l),a.copy(s.object.position),o.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",$,!1),s.domElement.removeEventListener("mousedown",W,!1),s.domElement.removeEventListener("wheel",q,!1),s.domElement.removeEventListener("touchstart",K,!1),s.domElement.removeEventListener("touchend",J,!1),s.domElement.removeEventListener("touchmove",Q,!1),document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),s.domElement.removeEventListener("keydown",Z,!1)};var s=this,l={type:"change"},u={type:"start"},c={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=h.NONE,f=1e-6,p=new THREE.Spherical,m=new THREE.Spherical,g=1,v=new THREE.Vector3,y=!1,_=new THREE.Vector2,b=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2,A=new THREE.Vector2;function R(){return Math.pow(.95,s.zoomSpeed)}function k(e){m.theta-=e}function P(e){m.phi-=e}var L,C=(L=new THREE.Vector3,function(e,t){L.setFromMatrixColumn(t,0),L.multiplyScalar(-e),v.add(L)}),I=function(){var e=new THREE.Vector3;return function(t,r){!0===s.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),v.add(e)}}(),H=function(){var e=new THREE.Vector3;return function(t,r){var n=s.domElement;if(s.object.isPerspectiveCamera){var i=s.object.position;e.copy(i).sub(s.target);var a=e.length();a*=Math.tan(s.object.fov/2*Math.PI/180),C(2*t*a/n.clientHeight,s.object.matrix),I(2*r*a/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(C(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),I(r*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function O(e){s.object.isPerspectiveCamera?g/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function D(e){s.object.isPerspectiveCamera?g*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(e){_.set(e.clientX,e.clientY)}function N(e){w.set(e.clientX,e.clientY)}function U(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,r)}}function B(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,r)}}function z(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);M.set(0,n)}function j(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,r)}E.subVectors(b,_).multiplyScalar(s.rotateSpeed);var n=s.domElement;k(2*Math.PI*E.x/n.clientHeight),P(2*Math.PI*E.y/n.clientHeight),_.copy(b)}function V(e){if(1==e.touches.length)x.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(t,r)}T.subVectors(x,w).multiplyScalar(s.panSpeed),H(T.x,T.y),w.copy(x)}function G(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);S.set(0,n),A.set(0,Math.pow(S.y/M.y,s.zoomSpeed)),O(A.y),M.copy(S)}function W(e){if(!1!==s.enabled){var t;switch(e.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),e.button){case 0:t=s.mouseButtons.LEFT;break;case 1:t=s.mouseButtons.MIDDLE;break;case 2:t=s.mouseButtons.RIGHT;break;default:t=-1}switch(t){case THREE.MOUSE.DOLLY:if(!1===s.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),d=h.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;N(e),d=h.PAN}else{if(!1===s.enableRotate)return;F(e),d=h.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;F(e),d=h.ROTATE}else{if(!1===s.enablePan)return;N(e),d=h.PAN}break;default:d=h.NONE}d!==h.NONE&&(document.addEventListener("mousemove",X,!1),document.addEventListener("mouseup",Y,!1),s.dispatchEvent(u))}}function X(e){if(!1!==s.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;!function(e){b.set(e.clientX,e.clientY),E.subVectors(b,_).multiplyScalar(s.rotateSpeed);var t=s.domElement;k(2*Math.PI*E.x/t.clientHeight),P(2*Math.PI*E.y/t.clientHeight),_.copy(b),s.update()}(e);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(e){S.set(e.clientX,e.clientY),A.subVectors(S,M),A.y>0?O(R()):A.y<0&&D(R()),M.copy(S),s.update()}(e);break;case h.PAN:if(!1===s.enablePan)return;!function(e){x.set(e.clientX,e.clientY),T.subVectors(x,w).multiplyScalar(s.panSpeed),H(T.x,T.y),w.copy(x),s.update()}(e)}}function Y(e){!1!==s.enabled&&(document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),s.dispatchEvent(c),d=h.NONE)}function q(e){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(u),function(e){e.deltaY<0?D(R()):e.deltaY>0&&O(R()),s.update()}(e),s.dispatchEvent(c))}function Z(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){var t=!1;switch(e.keyCode){case s.keys.UP:H(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:H(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:H(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:H(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function K(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(s.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===s.enableRotate)return;U(e),d=h.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===s.enablePan)return;B(e),d=h.TOUCH_PAN;break;default:d=h.NONE}break;case 2:switch(s.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&z(e),s.enablePan&&B(e)}(e),d=h.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&z(e),s.enableRotate&&U(e)}(e),d=h.TOUCH_DOLLY_ROTATE;break;default:d=h.NONE}break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(u)}}function Q(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),d){case h.TOUCH_ROTATE:if(!1===s.enableRotate)return;j(e),s.update();break;case h.TOUCH_PAN:if(!1===s.enablePan)return;V(e),s.update();break;case h.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&G(e),s.enablePan&&V(e)}(e),s.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&G(e),s.enableRotate&&j(e)}(e),s.update();break;default:d=h.NONE}}function J(e){!1!==s.enabled&&(s.dispatchEvent(c),d=h.NONE)}function $(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",$,!1),s.domElement.addEventListener("mousedown",W,!1),s.domElement.addEventListener("wheel",q,!1),s.domElement.addEventListener("touchstart",K,!1),s.domElement.addEventListener("touchend",J,!1),s.domElement.addEventListener("touchmove",Q,!1),s.domElement.addEventListener("keydown",Z,!1),-1===s.domElement.tabIndex&&(s.domElement.tabIndex=0),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(e,t){THREE.OrbitControls.call(this,e,t),this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls},function(e,t){THREE.TrackballControls=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var r=this,n=-1,i=0,a=1,o=2,s=3,l=4;this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.ZOOM,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;var u=new THREE.Vector3,c=1,h=n,d=n,f=new THREE.Vector3,p=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector3,v=0,y=new THREE.Vector2,_=new THREE.Vector2,b=0,E=0,w=new THREE.Vector2,x=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var T={type:"change"},M={type:"start"},S={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var A,R,k,P,L,C,I,H,O,D,F,N=(A=new THREE.Vector2,function(e,t){return A.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),A}),U=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function B(e){!1!==r.enabled&&(window.removeEventListener("keydown",B),d===n&&(e.keyCode!==r.keys[i]||r.noRotate?e.keyCode!==r.keys[a]||r.noZoom?e.keyCode!==r.keys[o]||r.noPan||(d=o):d=a:d=i))}function z(){!1!==r.enabled&&(d=n,window.addEventListener("keydown",B,!1))}function j(e){if(!1!==r.enabled){if(e.preventDefault(),e.stopPropagation(),h===n)switch(e.button){case r.mouseButtons.LEFT:h=i;break;case r.mouseButtons.MIDDLE:h=a;break;case r.mouseButtons.RIGHT:h=o;break;default:h=n}var t=d!==n?d:h;t!==i||r.noRotate?t!==a||r.noZoom?t!==o||r.noPan||(w.copy(N(e.pageX,e.pageY)),x.copy(w)):(y.copy(N(e.pageX,e.pageY)),_.copy(y)):(m.copy(U(e.pageX,e.pageY)),p.copy(m)),document.addEventListener("mousemove",V,!1),document.addEventListener("mouseup",G,!1),r.dispatchEvent(M)}}function V(e){if(!1!==r.enabled){e.preventDefault(),e.stopPropagation();var t=d!==n?d:h;t!==i||r.noRotate?t!==a||r.noZoom?t!==o||r.noPan||x.copy(N(e.pageX,e.pageY)):_.copy(N(e.pageX,e.pageY)):(p.copy(m),m.copy(U(e.pageX,e.pageY)))}}function G(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),h=n,document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",G),r.dispatchEvent(S))}function W(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:y.y-=.025*e.deltaY;break;case 1:y.y-=.01*e.deltaY;break;default:y.y-=25e-5*e.deltaY}r.dispatchEvent(M),r.dispatchEvent(S)}}function X(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:h=s,m.copy(U(e.touches[0].pageX,e.touches[0].pageY)),p.copy(m);break;default:h=l;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;E=b=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;w.copy(N(i,a)),x.copy(w)}r.dispatchEvent(M)}}function Y(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:p.copy(m),m.copy(U(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;E=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;x.copy(N(i,a))}}function q(e){if(!1!==r.enabled){switch(e.touches.length){case 0:h=n;break;case 1:h=s,m.copy(U(e.touches[0].pageX,e.touches[0].pageY)),p.copy(m)}r.dispatchEvent(S)}}function Z(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=(k=new THREE.Vector3,P=new THREE.Quaternion,L=new THREE.Vector3,C=new THREE.Vector3,I=new THREE.Vector3,H=new THREE.Vector3,function(){H.set(m.x-p.x,m.y-p.y,0),(R=H.length())?(f.copy(r.object.position).sub(r.target),L.copy(f).normalize(),C.copy(r.object.up).normalize(),I.crossVectors(C,L).normalize(),C.setLength(m.y-p.y),I.setLength(m.x-p.x),H.copy(C.add(I)),k.crossVectors(H,f).normalize(),R*=r.rotateSpeed,P.setFromAxisAngle(k,R),f.applyQuaternion(P),r.object.up.applyQuaternion(P),g.copy(k),v=R):!r.staticMoving&&v&&(v*=Math.sqrt(1-r.dynamicDampingFactor),f.copy(r.object.position).sub(r.target),P.setFromAxisAngle(g,v),f.applyQuaternion(P),r.object.up.applyQuaternion(P)),p.copy(m)}),this.zoomCamera=function(){var e;h===l?(e=b/E,b=E,r.object.isPerspectiveCamera?f.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom*=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(_.y-y.y)*r.zoomSpeed)&&e>0&&(r.object.isPerspectiveCamera?f.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom/=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),r.staticMoving?y.copy(_):y.y+=(_.y-y.y)*this.dynamicDampingFactor)},this.panCamera=(O=new THREE.Vector2,D=new THREE.Vector3,F=new THREE.Vector3,function(){if(O.copy(x).sub(w),O.lengthSq()){if(r.object.isOrthographicCamera){var e=(r.object.right-r.object.left)/r.object.zoom/r.domElement.clientWidth,t=(r.object.top-r.object.bottom)/r.object.zoom/r.domElement.clientWidth;O.x*=e,O.y*=t}O.multiplyScalar(f.length()*r.panSpeed),F.copy(f).cross(r.object.up).setLength(O.x),F.add(D.copy(r.object.up).setLength(O.y)),r.object.position.add(F),r.target.add(F),r.staticMoving?w.copy(x):w.add(O.subVectors(x,w).multiplyScalar(r.dynamicDampingFactor))}}),this.checkDistances=function(){r.noZoom&&r.noPan||(f.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,f.setLength(r.maxDistance)),y.copy(_)),f.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,f.setLength(r.minDistance)),y.copy(_)))},this.update=function(){f.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,f),r.object.isPerspectiveCamera?(r.checkDistances(),r.object.lookAt(r.target),u.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(T),u.copy(r.object.position))):r.object.isOrthographicCamera?(r.object.lookAt(r.target),(u.distanceToSquared(r.object.position)>1e-6||c!==r.object.zoom)&&(r.dispatchEvent(T),u.copy(r.object.position),c=r.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){h=n,d=n,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),f.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(T),u.copy(r.object.position),c=r.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",Z,!1),this.domElement.removeEventListener("mousedown",j,!1),this.domElement.removeEventListener("wheel",W,!1),this.domElement.removeEventListener("touchstart",X,!1),this.domElement.removeEventListener("touchend",q,!1),this.domElement.removeEventListener("touchmove",Y,!1),document.removeEventListener("mousemove",V,!1),document.removeEventListener("mouseup",G,!1),window.removeEventListener("keydown",B,!1),window.removeEventListener("keyup",z,!1)},this.domElement.addEventListener("contextmenu",Z,!1),this.domElement.addEventListener("mousedown",j,!1),this.domElement.addEventListener("wheel",W,!1),this.domElement.addEventListener("touchstart",X,!1),this.domElement.addEventListener("touchend",q,!1),this.domElement.addEventListener("touchmove",Y,!1),window.addEventListener("keydown",B,!1),window.addEventListener("keyup",z,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls},function(e,t){THREE.FirstPersonControls=function(e,t){void 0===t&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),t=document),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;var r,n=0,i=0,a=new THREE.Vector3,o=new THREE.Spherical,s=new THREE.Vector3;function l(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,r){return e.isVector3?s.copy(e):s.set(e,t,r),this.object.lookAt(s),m(this),this},this.update=(r=new THREE.Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var a=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);var o=e*this.lookSpeed;this.activeLook||(o=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.mouseX*o,this.lookVertical&&(n-=this.mouseY*o*s),n=Math.max(-85,Math.min(85,n));var l=THREE.MathUtils.degToRad(90-n),u=THREE.MathUtils.degToRad(i);this.constrainVertical&&(l=THREE.MathUtils.mapLinear(l,0,Math.PI,this.verticalMin,this.verticalMax));var c=this.object.position;r.setFromSphericalCoords(1,l,u).add(c),this.object.lookAt(r)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",c,!1),this.domElement.removeEventListener("mousemove",u,!1),this.domElement.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)};var u=p(this,this.onMouseMove),c=p(this,this.onMouseDown),h=p(this,this.onMouseUp),d=p(this,this.onKeyDown),f=p(this,this.onKeyUp);function p(e,t){return function(){t.apply(e,arguments)}}function m(e){var t=e.object.quaternion;a.set(0,0,-1).applyQuaternion(t),o.setFromVector3(a),n=90-THREE.MathUtils.radToDeg(o.phi),i=THREE.MathUtils.radToDeg(o.theta)}this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousemove",u,!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mouseup",h,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),this.handleResize(),m(this)}},function(e,t){THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,u=void 0!==t.encoding?t.encoding:THREE.LinearEncoding,c=new THREE.Plane,h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Matrix4,m=new THREE.Vector3(0,0,-1),g=new THREE.Vector4,v=new THREE.Vector3,y=new THREE.Vector3,_=new THREE.Vector4,b=new THREE.Matrix4,E=new THREE.PerspectiveCamera,w={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1,encoding:u},x=new THREE.WebGLRenderTarget(i,a,w);THREE.MathUtils.isPowerOfTwo(i)&&THREE.MathUtils.isPowerOfTwo(a)||(x.texture.generateMipmaps=!1);var T=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});T.uniforms.tDiffuse.value=x.texture,T.uniforms.color.value=n,T.uniforms.textureMatrix.value=b,this.material=T,this.onBeforeRender=function(e,t,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(d.setFromMatrixPosition(r.matrixWorld),f.setFromMatrixPosition(n.matrixWorld),p.extractRotation(r.matrixWorld),h.set(0,0,1),h.applyMatrix4(p),v.subVectors(d,f),!(v.dot(h)>0)){v.reflect(h).negate(),v.add(d),p.extractRotation(n.matrixWorld),m.set(0,0,-1),m.applyMatrix4(p),m.add(f),y.subVectors(d,m),y.reflect(h).negate(),y.add(d),E.position.copy(v),E.up.set(0,1,0),E.up.applyMatrix4(p),E.up.reflect(h),E.lookAt(y),E.far=n.far,E.updateMatrixWorld(),E.projectionMatrix.copy(n.projectionMatrix),E.userData.recursion=0,b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(E.projectionMatrix),b.multiply(E.matrixWorldInverse),b.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(h,d),c.applyMatrix4(E.matrixWorldInverse),g.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var i=E.projectionMatrix;_.x=(Math.sign(g.x)+i.elements[8])/i.elements[0],_.y=(Math.sign(g.y)+i.elements[9])/i.elements[5],_.z=-1,_.w=(1+i.elements[10])/i.elements[14],g.multiplyScalar(2/g.dot(_)),i.elements[2]=g.x,i.elements[6]=g.y,i.elements[10]=g.z+1-o,i.elements[14]=g.w,r.visible=!1;var a=e.getRenderTarget(),s=e.xr.enabled,u=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(x),e.clear(),e.render(t,E),e.xr.enabled=s,e.shadowMap.autoUpdate=u,e.setRenderTarget(a);var w=n.viewport;void 0!==w&&e.state.viewport(w),r.visible=!0}},this.getRenderTarget=function(){return x}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=void 0!==t.encoding?t.encoding:THREE.LinearEncoding,u=new THREE.PerspectiveCamera;u.matrixAutoUpdate=!1,u.userData.refractor=!0;var c=new THREE.Plane,h=new THREE.Matrix4,d={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1,encoding:l},f=new THREE.WebGLRenderTarget(i,a,d);THREE.MathUtils.isPowerOfTwo(i)&&THREE.MathUtils.isPowerOfTwo(a)||(f.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=f.texture,this.material.uniforms.textureMatrix.value=h;p=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Matrix4,v=new THREE.Vector3,y=new THREE.Vector3;var p,m,g,v,y,_,b,E,w=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;return function(){r.matrixWorld.decompose(t,n,i),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),c.setFromNormalAndCoplanarPoint(e,t)}}(),x=(_=new THREE.Plane,b=new THREE.Vector4,E=new THREE.Vector4,function(e){u.matrixWorld.copy(e.matrixWorld),u.matrixWorldInverse.getInverse(u.matrixWorld),u.projectionMatrix.copy(e.projectionMatrix),u.far=e.far,_.copy(c),_.applyMatrix4(u.matrixWorldInverse),b.set(_.normal.x,_.normal.y,_.normal.z,_.constant);var t=u.projectionMatrix;E.x=(Math.sign(b.x)+t.elements[8])/t.elements[0],E.y=(Math.sign(b.y)+t.elements[9])/t.elements[5],E.z=-1,E.w=(1+t.elements[10])/t.elements[14],b.multiplyScalar(2/b.dot(E)),t.elements[2]=b.x,t.elements[6]=b.y,t.elements[10]=b.z+1-o,t.elements[14]=b.w});this.onBeforeRender=function(e,t,n){!0!==n.userData.refractor&&(w(),function(e){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(e.projectionMatrix),h.multiply(e.matrixWorldInverse),h.multiply(r.matrixWorld)}(n),x(n),function(e,t,n){r.visible=!1;var i=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(f),e.clear(),e.render(t,u),e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i);var s=n.viewport;void 0!==s&&e.state.viewport(s),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return f}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.FresnelShader={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","\tvec3 I = worldPosition.xyz - cameraPosition;","\tvReflect = reflect( I, worldNormal );","\tvRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","\tvRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","\tvRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","\tvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","\tvec4 refractedColor = vec4( 1.0 );","\trefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","\trefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","\trefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","\tgl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")}},function(e,t){THREE.RGBELoader=function(e){THREE.DataTextureLoader.call(this,e),this.type=THREE.UnsignedByteType},THREE.RGBELoader.prototype=Object.assign(Object.create(THREE.DataTextureLoader.prototype),{constructor:THREE.RGBELoader,parse:function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var n=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));0>(i=s.indexOf("\n"))&&a<t&&n<e.byteLength;)o+=s,a+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<i&&(!1!==r&&(e.pos+=a+i+1),o+s.slice(0,i))},n=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function r(r){e[0]=r;var n=t[0],i=n>>16&32768,a=n>>12&2047,o=n>>23&255;return o<103?i:o>142?(i|=31744,i|=(255==o?0:1)&&8388607&n):o<113?i|=((a|=2048)>>114-o)+(a>>113-o&1):(i|=o-112<<10|a>>1,i+=1&a)}return function(e,t,n,i){var a=e[t+3],o=Math.pow(2,a-128)/255;n[i+0]=r(e[t+0]*o),n[i+1]=r(e[t+1]*o),n[i+2]=r(e[t+2]*o)}}(),i=new Uint8Array(e);i.pos=0;var a,o,s,l,u,c,h=function(e){var n,i,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=r(e)))return t(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(u.valid|=1,u.programtype=i[1],u.string+=n+"\n";!1!==(n=r(e));)if(u.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(a))&&(u.gamma=parseFloat(i[1],10)),(i=n.match(o))&&(u.exposure=parseFloat(i[1],10)),(i=n.match(s))&&(u.valid|=2,u.format=i[1]),(i=n.match(l))&&(u.valid|=4,u.height=parseInt(i[1],10),u.width=parseInt(i[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=n+"\n";return 2&u.valid?4&u.valid?u:t(3,"missing image size specifier"):t(3,"missing format specifier")}(i);if(-1!==h){var d=h.width,f=h.height,p=function(e,r,n){var i,a,o,s,l,u,c,h,d,f,p,m,g,v=r,y=n;if(v<8||v>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(v!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return t(4,"unable to allocate buffer space");for(a=0,o=0,h=4*v,g=new Uint8Array(4),u=new Uint8Array(h);y>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(g[0]=e[o++],g[1]=e[o++],g[2]=e[o++],g[3]=e[o++],2!=g[0]||2!=g[1]||(g[2]<<8|g[3])!=v)return t(3,"bad rgbe scanline format");for(c=0;c<h&&o<e.byteLength;){if((m=(s=e[o++])>128)&&(s-=128),0===s||c+s>h)return t(3,"bad scanline data");if(m)for(l=e[o++],d=0;d<s;d++)u[c++]=l;else u.set(e.subarray(o,o+s),c),c+=s,o+=s}for(f=v,d=0;d<f;d++)p=0,i[a]=u[d+p],p+=v,i[a+1]=u[d+p],p+=v,i[a+2]=u[d+p],p+=v,i[a+3]=u[d+p],a+=4;y--}return i}(i.subarray(i.pos),d,f);if(-1!==p){switch(this.type){case THREE.UnsignedByteType:var m=p,g=THREE.RGBEFormat,v=THREE.UnsignedByteType;break;case THREE.FloatType:for(var y=p.length/4*3,_=new Float32Array(y),b=0;b<y;b++)s=_,l=3*b,u=void 0,c=void 0,u=(a=p)[(o=4*b)+3],c=Math.pow(2,u-128)/255,s[l+0]=a[o+0]*c,s[l+1]=a[o+1]*c,s[l+2]=a[o+2]*c;m=_,g=THREE.RGBFormat,v=THREE.FloatType;break;case THREE.HalfFloatType:y=p.length/4*3;var E=new Uint16Array(y);for(b=0;b<y;b++)n(p,4*b,E,3*b);m=E,g=THREE.RGBFormat,v=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:f,data:m,header:h.string,gamma:h.gamma,exposure:h.exposure,format:g,type:v}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,t,r,n){return THREE.DataTextureLoader.prototype.load.call(this,e,(function(e,r){switch(e.type){case THREE.UnsignedByteType:e.encoding=THREE.RGBEEncoding,e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case THREE.FloatType:case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,n)}})},function(e,t){THREE.HDRCubeTextureLoader=function(e){THREE.Loader.call(this,e),this.hdrLoader=new THREE.RGBELoader,this.type=THREE.UnsignedByteType},THREE.HDRCubeTextureLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.HDRCubeTextureLoader,load:function(e,t,r,n){Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(e),e=t,t=r,r=n,n=arguments[4]);var i=new THREE.CubeTexture;switch(i.type=this.type,i.type){case THREE.UnsignedByteType:i.encoding=THREE.RGBEEncoding,i.format=THREE.RGBAFormat,i.minFilter=THREE.NearestFilter,i.magFilter=THREE.NearestFilter,i.generateMipmaps=!1;break;case THREE.FloatType:case THREE.HalfFloatType:i.encoding=THREE.LinearEncoding,i.format=THREE.RGBFormat,i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.generateMipmaps=!1}var a=this,o=0;function s(t,r,n,s){new THREE.FileLoader(a.manager).setPath(a.path).setResponseType("arraybuffer").load(e[t],(function(e){o++;var n=a.hdrLoader.parse(e);if(n){if(void 0!==n.data){var s=new THREE.DataTexture(n.data,n.width,n.height);s.type=i.type,s.encoding=i.encoding,s.format=i.format,s.minFilter=i.minFilter,s.magFilter=i.magFilter,s.generateMipmaps=i.generateMipmaps,i.images[t]=s}6===o&&(i.needsUpdate=!0,r&&r(i))}}),n,s)}for(var l=0;l<e.length;l++)s(l,t,r,n);return i},setDataType:function(e){return this.type=e,this.hdrLoader.setDataType(e),this}})},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /,n=/^usemap /;function i(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(e,t,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[r+0],n[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,i,a,o,s,l){var u=this.vertices.length,c=this.parseVertexIndex(e,u),h=this.parseVertexIndex(t,u),d=this.parseVertexIndex(r,u);if(this.addVertex(c,h,d),this.colors.length>0&&this.addColor(c,h,d),void 0!==n&&""!==n){var f=this.uvs.length;c=this.parseUVIndex(n,f),h=this.parseUVIndex(i,f),d=this.parseUVIndex(a,f),this.addUV(c,h,d)}if(void 0!==o&&""!==o){var p=this.normals.length;c=this.parseNormalIndex(o,p),h=o===s?c:this.parseNormalIndex(s,p),d=o===l?c:this.parseNormalIndex(l,p),this.addNormal(c,h,d)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,n=e.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,a=e.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var o=0;for(a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],n))}};return e.startObject("",!1),e}function a(e){THREE.Loader.call(this,e),this.materials=null}return a.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:a,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(this.path),a.load(e,(function(e){t(i.parse(e))}),r,n)},setMaterials:function(e){return this.materials=e,this},parse:function(a){var o=new i;-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n")),-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));for(var s=a.split("\n"),l="",u="",c=[],h="function"==typeof"".trimLeft,d=0,f=s.length;d<f;d++)if(l=s[d],0!==(l=h?l.trimLeft():l.trim()).length&&"#"!==(u=l.charAt(0)))if("v"===u){var p=l.split(/\s+/);switch(p[0]){case"v":o.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7&&o.colors.push(parseFloat(p[4]/255),parseFloat(p[5]/255),parseFloat(p[6]/255));break;case"vn":o.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":o.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===u){for(var m=l.substr(1).trim().split(/\s+/),g=[],v=0,y=m.length;v<y;v++){var _=m[v];if(_.length>0){var b=_.split("/");g.push(b)}}var E=g[0];for(v=1,y=g.length-1;v<y;v++){var w=g[v],x=g[v+1];o.addFace(E[0],w[0],x[0],E[1],w[1],x[1],E[2],w[2],x[2])}}else if("l"===u){var T=l.substring(1).trim().split(" "),M=[],S=[];if(-1===l.indexOf("/"))M=T;else for(var A=0,R=T.length;A<R;A++){var k=T[A].split("/");""!==k[0]&&M.push(k[0]),""!==k[1]&&S.push(k[1])}o.addLineGeometry(M,S)}else if("p"===u){var P=l.substr(1).trim().split(" ");o.addPointGeometry(P)}else if(null!==(c=e.exec(l))){var L=(" "+c[0].substr(1).trim()).substr(1);o.startObject(L)}else if(r.test(l))o.object.startMaterial(l.substring(7).trim(),o.materialLibraries);else if(t.test(l))o.materialLibraries.push(l.substring(7).trim());else if(n.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===u){if((c=l.split(" ")).length>1){var C=c[1].trim().toLowerCase();o.object.smooth="0"!==C&&"off"!==C}else o.object.smooth=!0;(X=o.object.currentMaterial())&&(X.smooth=o.object.smooth)}else{if("\0"===l)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}o.finalize();var I=new THREE.Group;I.materialLibraries=[].concat(o.materialLibraries);for(d=0,f=o.objects.length;d<f;d++){var H=o.objects[d],O=H.geometry,D=H.materials,F="Line"===O.type,N="Points"===O.type,U=!1;if(0!==O.vertices.length){var B=new THREE.BufferGeometry;B.setAttribute("position",new THREE.Float32BufferAttribute(O.vertices,3)),O.normals.length>0?B.setAttribute("normal",new THREE.Float32BufferAttribute(O.normals,3)):B.computeVertexNormals(),O.colors.length>0&&(U=!0,B.setAttribute("color",new THREE.Float32BufferAttribute(O.colors,3))),O.uvs.length>0&&B.setAttribute("uv",new THREE.Float32BufferAttribute(O.uvs,2));for(var z,j=[],V=0,G=D.length;V<G;V++){var W=(Z=D[V]).name+"_"+Z.smooth+"_"+U,X=o.materials[W];if(null!==this.materials)if(X=this.materials.create(Z.name),!F||!X||X instanceof THREE.LineBasicMaterial){if(N&&X&&!(X instanceof THREE.PointsMaterial)){var Y=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(Y,X),Y.color.copy(X.color),Y.map=X.map,X=Y}}else{var q=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(q,X),q.color.copy(X.color),X=q}void 0===X&&((X=F?new THREE.LineBasicMaterial:N?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=Z.name,X.flatShading=!Z.smooth,X.vertexColors=U,o.materials[W]=X),j.push(X)}if(j.length>1){for(V=0,G=D.length;V<G;V++){var Z=D[V];B.addGroup(Z.groupStart,Z.groupCount,V)}z=F?new THREE.LineSegments(B,j):N?new THREE.Points(B,j):new THREE.Mesh(B,j)}else z=F?new THREE.LineSegments(B,j[0]):N?new THREE.Points(B,j[0]):new THREE.Mesh(B,j[0]);z.name=H.name,I.add(z)}}return I}}),a}()},function(e,t){THREE.OBJExporter=function(){},THREE.OBJExporter.prototype={constructor:THREE.OBJExporter,parse:function(e){var t,r,n,i,a,o="",s=0,l=0,u=0,c=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector2,f=[];return e.traverse((function(e){e instanceof THREE.Mesh&&function(e){var n=0,p=0,m=0,g=e.geometry,v=new THREE.Matrix3;if(g instanceof THREE.Geometry&&(g=(new THREE.BufferGeometry).setFromObject(e)),g instanceof THREE.BufferGeometry){var y=g.getAttribute("position"),_=g.getAttribute("normal"),b=g.getAttribute("uv"),E=g.getIndex();if(o+="o "+e.name+"\n",e.material&&e.material.name&&(o+="usemtl "+e.material.name+"\n"),void 0!==y)for(t=0,i=y.count;t<i;t++,n++)c.x=y.getX(t),c.y=y.getY(t),c.z=y.getZ(t),c.applyMatrix4(e.matrixWorld),o+="v "+c.x+" "+c.y+" "+c.z+"\n";if(void 0!==b)for(t=0,i=b.count;t<i;t++,m++)d.x=b.getX(t),d.y=b.getY(t),o+="vt "+d.x+" "+d.y+"\n";if(void 0!==_)for(v.getNormalMatrix(e.matrixWorld),t=0,i=_.count;t<i;t++,p++)h.x=_.getX(t),h.y=_.getY(t),h.z=_.getZ(t),h.applyMatrix3(v).normalize(),o+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==E)for(t=0,i=E.count;t<i;t+=3){for(a=0;a<3;a++)r=E.getX(t+a)+1,f[a]=s+r+(_||b?"/"+(b?l+r:"")+(_?"/"+(u+r):""):"");o+="f "+f.join(" ")+"\n"}else for(t=0,i=y.count;t<i;t+=3){for(a=0;a<3;a++)r=t+a+1,f[a]=s+r+(_||b?"/"+(b?l+r:"")+(_?"/"+(u+r):""):"");o+="f "+f.join(" ")+"\n"}}else console.warn("THREE.OBJExporter.parseMesh(): geometry type unsupported",g);s+=n,l+=m,u+=p}(e),e instanceof THREE.Line&&function(e){var a=0,l=e.geometry,u=e.type;if(l instanceof THREE.Geometry&&(l=(new THREE.BufferGeometry).setFromObject(e)),l instanceof THREE.BufferGeometry){var h=l.getAttribute("position");if(o+="o "+e.name+"\n",void 0!==h)for(t=0,i=h.count;t<i;t++,a++)c.x=h.getX(t),c.y=h.getY(t),c.z=h.getZ(t),c.applyMatrix4(e.matrixWorld),o+="v "+c.x+" "+c.y+" "+c.z+"\n";if("Line"===u){for(o+="l ",r=1,i=h.count;r<=i;r++)o+=s+r+" ";o+="\n"}if("LineSegments"===u)for(n=(r=1)+1,i=h.count;r<i;n=(r+=2)+1)o+="l "+(s+r)+" "+(s+n)+"\n"}else console.warn("THREE.OBJExporter.parseLine(): geometry type unsupported",l);s+=a}(e)})),o}}},function(e,t){THREE.MTLLoader=function(e){THREE.Loader.call(this,e)},THREE.MTLLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.MTLLoader,load:function(e,t,r,n){var i=this,a=""===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.load(e,(function(e){t(i.parse(e,a))}),r,n)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var r=e.split("\n"),n={},i=/\s+/,a={},o=0;o<r.length;o++){var s=r[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),u=l>=0?s.substring(0,l):s;u=u.toLowerCase();var c=l>=0?s.substring(l+1):"";if(c=c.trim(),"newmtl"===u)n={name:c},a[c]=n;else if("ka"===u||"kd"===u||"ks"===u||"ke"===u){var h=c.split(i,3);n[u]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else n[u]=c}}var d=new THREE.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(a),d}}),THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],i={};for(var a in t[r]=i,n){var o=!0,s=n[a],l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(i[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function i(e,r){if(!n[e]){var i,a,o=t.getTextureParams(r,n),s=t.loadTexture((i=t.baseUrl,"string"!=typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:i+a));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,n[e]=s}}for(var a in r){var o,s=r[a];if(""!==s)switch(a.toLowerCase()){case"kd":n.color=(new THREE.Color).fromArray(s);break;case"ks":n.specular=(new THREE.Color).fromArray(s);break;case"ke":n.emissive=(new THREE.Color).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"map_ke":i("emissiveMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"map_d":i("alphaMap",s),n.transparent=!0;break;case"ns":n.shininess=parseFloat(s);break;case"d":(o=parseFloat(s))<1&&(n.opacity=o,n.transparent=!0);break;case"tr":o=parseFloat(s),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(n.opacity=1-o,n.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(n),this.materials[e]},getTextureParams:function(e,t){var r,n={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},i=e.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(e,t,r,n,i){var a,o=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager,s=o.getHandler(e);return null===s&&(s=new THREE.TextureLoader(o)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),a=s.load(e,r,n,i),void 0!==t&&(a.mapping=t),a}}},function(e,t){THREE.STLLoader=function(e){THREE.Loader.call(this,e)},THREE.STLLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.STLLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){try{t(i.parse(e))}catch(e){n&&n(e)}}),r,n)},parse:function(e){function t(e,t,r){for(var n=0,i=e.length;n<i;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}var r,n=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var r;if(50,84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(t(n,r,i))return!1;return!0}(n)?function(e){for(var t,r,n,i,a,o,s,l,u=new DataView(e),c=u.getUint32(80,!0),h=!1,d=0;d<70;d++)1129270351==u.getUint32(d,!1)&&82==u.getUint8(d+4)&&61==u.getUint8(d+5)&&(h=!0,i=new Float32Array(3*c*3),a=u.getUint8(d+6)/255,o=u.getUint8(d+7)/255,s=u.getUint8(d+8)/255,l=u.getUint8(d+9)/255);for(var f=new THREE.BufferGeometry,p=new Float32Array(3*c*3),m=new Float32Array(3*c*3),g=0;g<c;g++){var v=84+50*g,y=u.getFloat32(v,!0),_=u.getFloat32(v+4,!0),b=u.getFloat32(v+8,!0);if(h){var E=u.getUint16(v+48,!0);0==(32768&E)?(t=(31&E)/31,r=(E>>5&31)/31,n=(E>>10&31)/31):(t=a,r=o,n=s)}for(var w=1;w<=3;w++){var x=v+12*w,T=3*g*3+3*(w-1);p[T]=u.getFloat32(x,!0),p[T+1]=u.getFloat32(x+4,!0),p[T+2]=u.getFloat32(x+8,!0),m[T]=y,m[T+1]=_,m[T+2]=b,h&&(i[T]=t,i[T+1]=r,i[T+2]=n)}}return f.setAttribute("position",new THREE.BufferAttribute(p,3)),f.setAttribute("normal",new THREE.BufferAttribute(m,3)),h&&(f.setAttribute("color",new THREE.BufferAttribute(i,3)),f.hasColors=!0,f.alpha=l),f}(n):function(e){for(var t,r=new THREE.BufferGeometry,n=/solid([\s\S]*?)endsolid/g,i=/facet([\s\S]*?)endfacet/g,a=0,o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),u=[],c=[],h=new THREE.Vector3,d=0,f=0,p=0;null!==(t=n.exec(e));){f=p;for(var m=t[0];null!==(t=i.exec(m));){for(var g=0,v=0,y=t[0];null!==(t=l.exec(y));)h.x=parseFloat(t[1]),h.y=parseFloat(t[2]),h.z=parseFloat(t[3]),v++;for(;null!==(t=s.exec(y));)u.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),c.push(h.x,h.y,h.z),g++,p++;1!==v&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+a),3!==g&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+a),a++}var _=f,b=p-f;r.addGroup(_,b,d),d++}return r.setAttribute("position",new THREE.Float32BufferAttribute(u,3)),r.setAttribute("normal",new THREE.Float32BufferAttribute(c,3)),r}("string"!=typeof(r=e)?THREE.LoaderUtils.decodeText(new Uint8Array(r)):r)}})},function(e,t){var r,n;THREE.STLExporter=function(){},THREE.STLExporter.prototype={constructor:THREE.STLExporter,parse:(r=new THREE.Vector3,n=new THREE.Matrix3,function(e,t){void 0===t&&(t={});var i=void 0!==t.binary&&t.binary,a=[],o=0;if(e.traverse((function(e){if(e.isMesh){var t=e.geometry;t.isBufferGeometry&&(t=(new THREE.Geometry).fromBufferGeometry(t)),t.isGeometry&&(o+=t.faces.length,a.push({geometry:t,matrixWorld:e.matrixWorld}))}})),i){var s=80,l=new ArrayBuffer(2*o+3*o*4*4+80+4);(_=new DataView(l)).setUint32(s,o,!0),s+=4;for(var u=0,c=a.length;u<c;u++){var h=(b=a[u]).geometry.vertices,d=b.geometry.faces,f=b.matrixWorld;n.getNormalMatrix(f);for(var p=0,m=d.length;p<m;p++){var g=d[p];r.copy(g.normal).applyMatrix3(n).normalize(),_.setFloat32(s,r.x,!0),s+=4,_.setFloat32(s,r.y,!0),s+=4,_.setFloat32(s,r.z,!0),s+=4;for(var v=[g.a,g.b,g.c],y=0;y<3;y++)r.copy(h[v[y]]).applyMatrix4(f),_.setFloat32(s,r.x,!0),s+=4,_.setFloat32(s,r.y,!0),s+=4,_.setFloat32(s,r.z,!0),s+=4;_.setUint16(s,0,!0),s+=2}}return _}var _="";for(_+="solid exported\n",u=0,c=a.length;u<c;u++){var b;for(h=(b=a[u]).geometry.vertices,d=b.geometry.faces,f=b.matrixWorld,n.getNormalMatrix(f),p=0,m=d.length;p<m;p++){for(g=d[p],r.copy(g.normal).applyMatrix3(n).normalize(),_+="\tfacet normal "+r.x+" "+r.y+" "+r.z+"\n",_+="\t\touter loop\n",v=[g.a,g.b,g.c],y=0;y<3;y++)r.copy(h[v[y]]).applyMatrix4(f),_+="\t\t\tvertex "+r.x+" "+r.y+" "+r.z+"\n";_+="\t\tendloop\n",_+="\tendfacet\n"}}return _+="endsolid exported\n"})}},function(e,t){THREE.PLYLoader=function(e){THREE.Loader.call(this,e),this.propertyNameMapping={}},THREE.PLYLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.PLYLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),r,n)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,n=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==n&&(t=n[1],r=n[0].length);var i,a,o,s,l,u,h={comments:[],elements:[],headerLength:r},d=t.split("\n");for(var f=0;f<d.length;f++){var p=d[f];if(""!==(p=p.trim()))switch(a=(o=p.split(/\s+/)).shift(),p=o.join(" "),a){case"format":h.format=o[0],h.version=o[1];break;case"comment":h.comments.push(p);break;case"element":void 0!==i&&h.elements.push(i),(i={}).name=o[0],i.count=parseInt(o[1]),i.properties=[];break;case"property":i.properties.push((s=o,l=c.propertyNameMapping,u=void 0,"list"===(u={type:s[0]}).type?(u.name=s[3],u.countType=s[1],u.itemType=s[2]):u.name=s[1],u.name in l&&(u.name=l[u.name]),u));break;default:console.log("unhandled",a,o)}}return void 0!==i&&h.elements.push(i),h}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function n(e,t){for(var n=t.split(/\s+/),i={},a=0;a<e.length;a++)if("list"===e[a].type){for(var o=[],s=r(n.shift(),e[a].countType),l=0;l<s;l++)o.push(r(n.shift(),e[a].itemType));i[e[a].name]=o}else i[e[a].name]=r(n.shift(),e[a].type);return i}function i(e,t){var r,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},s="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(s=r[1]);for(var l=s.split("\n"),u=0,c=0,h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim())){c>=t.elements[u].count&&(u++,c=0);var f=n(t.elements[u].properties,d);o(i,t.elements[u].name,f),c++}}return a(i)}function a(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new THREE.Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var n=r.vertex_indices||r.vertex_index,i=r.texcoord;3===n.length?(e.indices.push(n[0],n[1],n[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===n.length&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]))}}function s(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function l(e,t,r,n){for(var i,a={},o=0,l=0;l<r.length;l++)if("list"===r[l].type){var u=[],c=(i=s(e,t+o,r[l].countType,n))[0];o+=i[1];for(var h=0;h<c;h++)i=s(e,t+o,r[l].itemType,n),u.push(i[0]),o+=i[1];a[r[l].name]=u}else i=s(e,t+o,r[l].type,n),a[r[l].name]=i[0],o+=i[1];return[a,o]}var u,c=this;if(e instanceof ArrayBuffer){var h=THREE.LoaderUtils.decodeText(new Uint8Array(e)),d=t(h);u="ascii"===d.format?i(h,d):function(e,t){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,s=new DataView(e,t.headerLength),u=0,c=0;c<t.elements.length;c++)for(var h=0;h<t.elements[c].count;h++){u+=(r=l(s,u,t.elements[c].properties,i))[1];var d=r[0];o(n,t.elements[c].name,d)}return a(n)}(e,d)}else u=i(e,t(e));return u}})},function(e,t){THREE.PLYExporter=function(){},THREE.PLYExporter.prototype={constructor:THREE.PLYExporter,parse:function(e,t,r){function n(t){e.traverse((function(e){if(!0===e.isMesh){var r=e,n=r.geometry;!0===n.isGeometry&&(n=a.get(n)),!0===n.isBufferGeometry&&void 0!==n.getAttribute("position")&&t(r,n)}}))}t&&"object"==typeof t&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=t,t=void 0);var i=(r=Object.assign({binary:!1,excludeAttributes:[]},r)).excludeAttributes,a=new WeakMap,o=!1,s=!1,l=!1,u=0,c=0;e.traverse((function(e){if(!0===e.isMesh){var t=e,r=t.geometry;if(!0===r.isGeometry){var n=a.get(r)||(new THREE.BufferGeometry).setFromObject(t);a.set(r,n),r=n}if(!0===r.isBufferGeometry){var i=r.getAttribute("position"),h=r.getAttribute("normal"),d=r.getAttribute("uv"),f=r.getAttribute("color"),p=r.getIndex();if(void 0===i)return;u+=i.count,c+=p?p.count/3:i.count/3,void 0!==h&&(o=!0),void 0!==d&&(l=!0),void 0!==f&&(s=!0)}}}));var h=-1===i.indexOf("index");if(o=o&&-1===i.indexOf("normal"),s=s&&-1===i.indexOf("color"),l=l&&-1===i.indexOf("uv"),h&&c!==Math.floor(c))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var d=`ply\nformat ${r.binary?"binary_big_endian":"ascii"} 1.0\nelement vertex ${u}\nproperty float x\nproperty float y\nproperty float z\n`;!0===o&&(d+="property float nx\nproperty float ny\nproperty float nz\n"),!0===l&&(d+="property float s\nproperty float t\n"),!0===s&&(d+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===h&&(d+=`element face ${c}\nproperty list uchar int vertex_index\n`),d+="end_header\n";var f=new THREE.Vector3,p=new THREE.Matrix3,m=null;if(!0===r.binary){var g=(new TextEncoder).encode(d),v=u*(12+(o?12:0)+(s?3:0)+(l?8:0)),y=h?13*c:0,_=new DataView(new ArrayBuffer(g.length+v+y));new Uint8Array(_.buffer).set(g,0);var b=g.length,E=g.length+v,w=0;n((function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),u=t.getIndex();p.getNormalMatrix(e.matrixWorld);for(var c=0,d=r.count;c<d;c++)f.x=r.getX(c),f.y=r.getY(c),f.z=r.getZ(c),f.applyMatrix4(e.matrixWorld),_.setFloat32(b,f.x),b+=4,_.setFloat32(b,f.y),b+=4,_.setFloat32(b,f.z),b+=4,!0===o&&(null!=n?(f.x=n.getX(c),f.y=n.getY(c),f.z=n.getZ(c),f.applyMatrix3(p).normalize(),_.setFloat32(b,f.x),b+=4,_.setFloat32(b,f.y),b+=4,_.setFloat32(b,f.z),b+=4):(_.setFloat32(b,0),b+=4,_.setFloat32(b,0),b+=4,_.setFloat32(b,0),b+=4)),!0===l&&(null!=i?(_.setFloat32(b,i.getX(c)),b+=4,_.setFloat32(b,i.getY(c)),b+=4):!1!==l&&(_.setFloat32(b,0),b+=4,_.setFloat32(b,0),b+=4)),!0===s&&(null!=a?(_.setUint8(b,Math.floor(255*a.getX(c))),b+=1,_.setUint8(b,Math.floor(255*a.getY(c))),b+=1,_.setUint8(b,Math.floor(255*a.getZ(c))),b+=1):(_.setUint8(b,255),b+=1,_.setUint8(b,255),b+=1,_.setUint8(b,255),b+=1));if(!0===h)if(null!==u)for(c=0,d=u.count;c<d;c+=3)_.setUint8(E,3),E+=1,_.setUint32(E,u.getX(c+0)+w),E+=4,_.setUint32(E,u.getX(c+1)+w),E+=4,_.setUint32(E,u.getX(c+2)+w),E+=4;else for(c=0,d=r.count;c<d;c+=3)_.setUint8(E,3),E+=1,_.setUint32(E,w+c),E+=4,_.setUint32(E,w+c+1),E+=4,_.setUint32(E,w+c+2),E+=4;w+=r.count})),m=_.buffer}else{w=0;var x="",T="";n((function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),u=t.getIndex();p.getNormalMatrix(e.matrixWorld);for(var d=0,m=r.count;d<m;d++){f.x=r.getX(d),f.y=r.getY(d),f.z=r.getZ(d),f.applyMatrix4(e.matrixWorld);var g=f.x+" "+f.y+" "+f.z;!0===o&&(null!=n?(f.x=n.getX(d),f.y=n.getY(d),f.z=n.getZ(d),f.applyMatrix3(p).normalize(),g+=" "+f.x+" "+f.y+" "+f.z):g+=" 0 0 0"),!0===l&&(null!=i?g+=" "+i.getX(d)+" "+i.getY(d):!1!==l&&(g+=" 0 0")),!0===s&&(g+=null!=a?" "+Math.floor(255*a.getX(d))+" "+Math.floor(255*a.getY(d))+" "+Math.floor(255*a.getZ(d)):" 255 255 255"),x+=g+"\n"}if(!0===h){if(null!==u)for(d=0,m=u.count;d<m;d+=3)T+="3 "+(u.getX(d+0)+w),T+=" "+(u.getX(d+1)+w),T+=` ${u.getX(d+2)+w}\n`;else for(d=0,m=r.count;d<m;d+=3)T+=`3 ${w+d} ${w+d+1} ${w+d+2}\n`;c+=u?u.count/3:r.count/3}w+=r.count})),m=`${d}${x}${h?T+"\n":"\n"}`}return"function"==typeof t&&requestAnimationFrame(()=>t(m)),m}}},function(e,t){THREE.ColladaLoader=function(e){THREE.Loader.call(this,e)},THREE.ColladaLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.ColladaLoader,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(e,a))}),r,n)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,a=n.length;i<a;i++){var o=n[i];o.nodeName===t&&r.push(o)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function o(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function c(e,t,n,i){var a=r(e,t)[0];if(void 0!==a)for(var o=r(a,n),s=0;s<o.length;s++)i(o[s])}function h(e,t){for(var r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=o(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=a}}return t}function p(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),a=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)r=i.split("."),i=r.shift(),t.member=r.shift();else if(a){var l=i.split("(");i=l.shift();for(var u=0;u<l.length;u++)l[u]=parseInt(l[u].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=i,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}function m(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=n[o.sampler],l=s.inputs.INPUT,u=s.inputs.OUTPUT;E(v(o,i[l],i[u]),t)}return t}function g(e){return d(Ke.animations[e],m)}function v(e,t,r){var n,i,a,o,s,l,u=Ke.nodes[e.id],c=Oe(u.id),h=u.transforms[e.sid],d=u.matrix.clone().transpose(),f={};switch(h){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(n=t.array[a],i=a*r.stride,void 0===f[n]&&(f[n]={}),!0===e.arraySyntax){var p=r.array[i],m=e.indices[0]+4*e.indices[1];f[n][m]=p}else for(s=0,l=r.stride;s<l;s++)f[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var g=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort((function(e,t){return e.time-t.time}));for(var i=0;i<16;i++)w(r,i,t.elements[i]);return r}(f,d);return{name:c.uuid,keyframes:g}}var y=new THREE.Vector3,_=new THREE.Vector3,b=new THREE.Quaternion;function E(e,t){for(var r=e.keyframes,n=e.name,i=[],a=[],o=[],s=[],l=0,u=r.length;l<u;l++){var c=r[l],h=c.time,d=c.value;Te.fromArray(d).transpose(),Te.decompose(y,b,_),i.push(h),a.push(y.x,y.y,y.z),o.push(b.x,b.y,b.z,b.w),s.push(_.x,_.y,_.z)}return a.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",i,a)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",i,o)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",i,s)),t}function w(e,t,r){var n,i,a,o=!0;for(i=0,a=e.length;i<a;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,a=e.length;i<a;i++){var o=e[i];if(null===o.value[t]){if(r=x(e,i,t),n=T(e,i,t),null===r){o.value[t]=n.value[t];continue}if(null===n){o.value[t]=r.value[t];continue}M(o,r,n,t)}}}(e,t)}function x(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function T(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function M(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function S(e){for(var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations,a=0,o=i.length;a<o;a++)for(var s=g(i[a]),l=0,u=s.length;l<u;l++)t.push(s[l]);return new THREE.AnimationClip(r,n,t)}function A(e){return d(Ke.clips[e],S)}function R(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(a.textContent);break;case"source":var o=a.getAttribute("id");t.sources[o]=ie(a);break;case"joints":t.joints=k(a);break;case"vertex_weights":t.vertexWeights=P(a)}}return t}function k(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),s=o(i.getAttribute("source"));t.inputs[a]=s}}return t}function P(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=o(i.getAttribute("source")),u=parseInt(i.getAttribute("offset"));t.inputs[s]={id:l,offset:u};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function L(e){var t={id:e.id},r=Ke.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=e.sources,o=e.vertexWeights,s=o.vcount,l=o.v,u=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=a[o.inputs.WEIGHT.id].array,p=0;for(t=0,n=s.length;t<n;t++){var m=s[t],g=[];for(r=0;r<m;r++){var v=l[p+u],y=l[p+c],_=f[y];g.push({index:v,weight:_}),p+=2}for(g.sort(x),r=0;r<4;r++){var b=g[r];void 0!==b?(i.indices.array.push(b.index),i.weights.array.push(b.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}e.bindShapeMatrix?i.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():i.bindMatrix=(new THREE.Matrix4).identity();for(t=0,n=h.array.length;t<n;t++){var E=h.array[t],w=(new THREE.Matrix4).fromArray(d.array,t*d.stride).transpose();i.joints.push({name:E,boneInverse:w})}return i;function x(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function C(e){return void 0!==e.build?e.build:e.init_from}function I(e){var t=Ke.images[e];return void 0!==t?d(t,C):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function H(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":O(i,t);break;case"technique":t.technique=N(i);break;case"extra":t.extra=G(i)}}return t}function O(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=D(a);break;case"sampler2D":t.samplers[r]=F(a)}}}function D(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function F(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function N(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=U(i)}}return t}function U(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=B(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:B(i)}}}return t}function B(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":t[a.nodeName]=i(a.textContent);break;case"float":t[a.nodeName]=parseFloat(a.textContent);break;case"texture":t[a.nodeName]={id:a.getAttribute("texture"),extra:z(a)}}}return t}function z(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":j(i,t)}}return t}function j(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":V(i,t)}}}function V(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function G(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=W(i)}}return t}function W(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function X(e){return e}function Y(e){var t,r,n=(t=e.url,d(Ke.effects[t],X)),i=n.profile.technique,a=n.profile.extra;switch(i.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}function o(e){var t=n.profile.samplers[e.id],r=null;void 0!==t?r=I(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=I(e.id));if(null!==r){var i=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=Ge;break;default:t=Xe}return t}(r);if(void 0!==i){var a=i.load(r),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var l=o.technique;a.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.offset.set(l.offsetU||0,l.offsetV||0),a.repeat.set(l.repeatU||1,l.repeatV||1)}else a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping;return a}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name||"";var l=i.parameters;for(var u in l){var c=l[u];switch(u){case"diffuse":c.color&&r.color.fromArray(c.color),c.texture&&(r.map=o(c.texture));break;case"specular":c.color&&r.specular&&r.specular.fromArray(c.color),c.texture&&(r.specularMap=o(c.texture));break;case"bump":c.texture&&(r.normalMap=o(c.texture));break;case"ambient":c.texture&&(r.lightMap=o(c.texture));break;case"shininess":c.float&&r.shininess&&(r.shininess=c.float);break;case"emission":c.color&&r.emissive&&r.emissive.fromArray(c.color),c.texture&&(r.emissiveMap=o(c.texture))}}var h=l.transparent,f=l.transparency;if(void 0===f&&h&&(f={float:1}),void 0===h&&f&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&f)if(h.data.texture)r.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=p[3]*f.float;break;case"RGB_ZERO":r.opacity=1-p[0]*f.float;break;case"A_ZERO":r.opacity=1-p[3]*f.float;break;case"RGB_ONE":r.opacity=p[0]*f.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(r.side=THREE.DoubleSide),r}function q(e){return d(Ke.materials[e],Y)}function Z(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return K(r)}}return{}}function K(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=Q(n)}}return t}function Q(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function J(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,n*=.5,r*=.5,t=new THREE.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name||"",t}function $(e){var t=Ke.cameras[e];return void 0!==t?d(t,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=te(i)}}return t}function te(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":var o=i(a.textContent);t.color=(new THREE.Color).fromArray(o);break;case"falloff_angle":t.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=Ke.lights[e];return void 0!==t?d(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=n(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ae(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=o(n.getAttribute("source")))}return t}function oe(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=o(i.getAttribute("source")),l=i.getAttribute("semantic"),u=parseInt(i.getAttribute("offset")),c=parseInt(i.getAttribute("set")),h=c>0?l+c:l;t.inputs[h]={id:s,offset:u},t.stride=Math.max(t.stride,u+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var a=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var o in a){var s=a[o];se(s),t[o]=ue(s,r,n)}return t}function ue(e,t,r){for(var n={},i={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},u=[],c=4,h=[],d=4,f=new THREE.BufferGeometry,p=[],m=0,g=0;g<e.length;g++){var v=e[g],y=v.inputs,_=0;switch(v.type){case"lines":case"linestrips":_=2*v.count;break;case"triangles":_=3*v.count;break;case"polylist":for(var b=0;b<v.count;b++){var E=v.vcount[b];switch(E){case 3:_+=3;break;case 4:_+=6;break;default:_+=3*(E-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",v.type)}for(var w in f.addGroup(m,_,g),m+=_,v.material&&p.push(v.material),y){var x=y[w];switch(w){case"VERTEX":for(var T in r){var M=r[T];switch(T){case"POSITION":var S=i.array.length;if(ce(v,t[M],x.offset,i.array),i.stride=t[M].stride,t.skinWeights&&t.skinIndices&&(ce(v,t.skinIndices,x.offset,u),ce(v,t.skinWeights,x.offset,h)),!1===v.hasUV&&!0===e.uvsNeedsFix){_=(i.array.length-S)/i.stride;for(var A=0;A<_;A++)o.array.push(0,0)}break;case"NORMAL":ce(v,t[M],x.offset,a.array),a.stride=t[M].stride;break;case"COLOR":ce(v,t[M],x.offset,l.array),l.stride=t[M].stride;break;case"TEXCOORD":ce(v,t[M],x.offset,o.array),o.stride=t[M].stride;break;case"TEXCOORD1":ce(v,t[M],x.offset,s.array),o.stride=t[M].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',T)}}break;case"NORMAL":ce(v,t[x.id],x.offset,a.array),a.stride=t[x.id].stride;break;case"COLOR":ce(v,t[x.id],x.offset,l.array),l.stride=t[x.id].stride;break;case"TEXCOORD":ce(v,t[x.id],x.offset,o.array),o.stride=t[x.id].stride;break;case"TEXCOORD1":ce(v,t[x.id],x.offset,s.array),s.stride=t[x.id].stride}}}return i.array.length>0&&f.setAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),a.array.length>0&&f.setAttribute("normal",new THREE.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&f.setAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),o.array.length>0&&f.setAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&f.setAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),u.length>0&&f.setAttribute("skinIndex",new THREE.Float32BufferAttribute(u,c)),h.length>0&&f.setAttribute("skinWeight",new THREE.Float32BufferAttribute(h,d)),n.data=f,n.type=e[0].type,n.materialKeys=p,n}function ce(e,t,r,n){var i=e.p,a=e.stride,o=e.vcount;function s(e){for(var t=i[e+r]*u,a=t+u;t<a;t++)n.push(l[t])}var l=t.array,u=t.stride;if(void 0!==e.vcount)for(var c=0,h=0,d=o.length;h<d;h++){var f=o[h];if(4===f){var p=c+1*a,m=c+2*a,g=c+3*a;s(c+0*a),s(p),s(g),s(p),s(m),s(g)}else if(3===f){p=c+1*a,m=c+2*a;s(c+0*a),s(p),s(m)}else if(f>4)for(var v=1,y=f-2;v<=y;v++){p=c+a*v,m=c+a*(v+1);s(c+0*a),s(p),s(m)}c+=a*f}else for(h=0,d=i.length;h<d;h+=a)s(h)}function he(e){return d(Ke.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function fe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=pe(n);break;case"link":t.links.push(ge(n))}}}function pe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var a=i(n.textContent);t.axis.fromArray(a);break;case"limits":var o=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ge(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ve(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.MathUtils.degToRad(r[3])}return t}function _e(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":be(n,t)}}}function be(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=i(n.textContent);break;case"mass":t.mass=i(n.textContent)[0]}}}function Ee(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substr(0,a.length-1)}}return t}function we(e){return void 0!==e.build?e.build:e}function xe(e){for(var t=[],r=Ue.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var a=r.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"matrix":var o=i(a.textContent),s=(new THREE.Matrix4).fromArray(o).transpose();t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"translate":case"scale":o=i(a.textContent);var l=(new THREE.Vector3).fromArray(o);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"rotate":o=i(a.textContent),l=(new THREE.Vector3).fromArray(o);var u=THREE.MathUtils.degToRad(o[3]);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l,angle:u})}}return t}var Te=new THREE.Matrix4,Me=new THREE.Vector3;function Se(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Se(n);break;case"instance_camera":t.instanceCameras.push(o(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ae(n));break;case"instance_light":t.instanceLights.push(o(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ae(n));break;case"instance_node":t.instanceNodes.push(o(n.getAttribute("url")));break;case"matrix":var a=i(n.textContent);t.matrix.multiply(Te.fromArray(a).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":a=i(n.textContent);Me.fromArray(a),t.matrix.multiply(Te.makeTranslation(Me.x,Me.y,Me.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":a=i(n.textContent);var s=THREE.MathUtils.degToRad(a[3]);t.matrix.multiply(Te.makeRotationAxis(Me.fromArray(a),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":a=i(n.textContent);t.matrix.scale(Me.fromArray(a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return He(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ke.nodes[t.id]=t,t}function Ae(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),a=0;a<i.length;a++){var s=i[a],l=s.getAttribute("symbol"),u=s.getAttribute("target");t.materials[l]=o(u)}break;case"skeleton":t.skeletons.push(o(n.textContent))}}return t}function Re(e,t){var r,n,i,a=[],o=[];for(r=0;r<e.length;r++){var s=e[r];if(He(s))ke(Oe(s),t,a);else if(i=s,void 0!==Ke.visualScenes[i])for(var l=Ke.visualScenes[s].children,u=0;u<l.length;u++){var c=l[u];if("JOINT"===c.type)ke(Oe(c.id),t,a)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(u=0;u<a.length;u++)if((n=a[u]).bone.name===t[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<a.length;r++)!1===(n=a[r]).processed&&(o.push(n),n.processed=!0);var h=[],d=[];for(r=0;r<o.length;r++)n=o[r],h.push(n.bone),d.push(n.boneInverse);return new THREE.Skeleton(h,d)}function ke(e,t,r){e.traverse((function(e){if(!0===e.isBone){for(var n,i=0;i<t.length;i++){var a=t[i];if(a.name===e.name){n=a.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}}))}function Pe(e){for(var t,r=[],n=e.matrix,i=e.nodes,a=e.type,o=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,u=e.instanceGeometries,c=e.instanceNodes,h=0,f=i.length;h<f;h++)r.push(Oe(i[h]));for(h=0,f=o.length;h<f;h++){var p=$(o[h]);null!==p&&r.push(p.clone())}for(h=0,f=s.length;h<f;h++)for(var m=s[h],g=(t=m.id,d(Ke.controllers[t],L)),v=Ie(he(g.id),m.materials),y=Re(m.skeletons,g.skin.joints),_=0,b=v.length;_<b;_++){var E;(E=v[_]).isSkinnedMesh&&(E.bind(y,g.skin.bindMatrix),E.normalizeSkinWeights()),r.push(E)}for(h=0,f=l.length;h<f;h++){var w=ne(l[h]);null!==w&&r.push(w.clone())}for(h=0,f=u.length;h<f;h++)for(_=0,b=(v=Ie(he((m=u[h]).id),m.materials)).length;_<b;_++)r.push(v[_]);for(h=0,f=c.length;h<f;h++)r.push(Oe(c[h]).clone());if(0===i.length&&1===r.length)E=r[0];else{E="JOINT"===a?new THREE.Bone:new THREE.Group;for(h=0;h<r.length;h++)E.add(r[h])}return""===E.name&&(E.name="JOINT"===a?e.sid:e.name),E.matrix.copy(n),E.matrix.decompose(E.position,E.quaternion,E.scale),E}var Le=new THREE.MeshBasicMaterial({color:16711935});function Ce(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Le)):r.push(q(a))}return r}function Ie(e,t){var r=[];for(var n in e){var i=e[n],a=Ce(i.materialKeys,t);0===a.length&&("lines"===n||"linestrips"===n?a.push(new THREE.LineBasicMaterial):a.push(new THREE.MeshPhongMaterial));var o=void 0!==i.data.attributes.skinIndex;if(o)for(var s=0,l=a.length;s<l;s++)a[s].skinning=!0;var u,c=1===a.length?a[0]:a;switch(n){case"lines":u=new THREE.LineSegments(i.data,c);break;case"linestrips":u=new THREE.Line(i.data,c);break;case"triangles":case"polylist":u=o?new THREE.SkinnedMesh(i.data,c):new THREE.Mesh(i.data,c)}r.push(u)}return r}function He(e){return void 0!==Ke.nodes[e]}function Oe(e){return d(Ke.nodes[e],Pe)}function De(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var i=r[n];t.add(Oe(i.id))}return t}function Fe(e){return d(Ke.visualScenes[e],De)}if(0===e.length)return{scene:new THREE.Scene};var Ne=(new DOMParser).parseFromString(e,"application/xml"),Ue=r(Ne,"COLLADA")[0],Be=Ne.getElementsByTagName("parsererror")[0];if(void 0!==Be){var ze,je=r(Be,"div")[0];return ze=je?je.textContent:function(e){for(var t="",r=[e];r.length;){var n=r.shift();n.nodeType===Node.TEXT_NODE?t+=n.textContent:(t+="\n",r.push.apply(r,n.childNodes))}return t.trim()}(Be),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",ze),null}var Ve=Ue.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ve);var Ge,We=function(e){return{unit:l(r(e,"unit")[0]),upAxis:u(r(e,"up_axis")[0])}}(r(Ue,"asset")[0]),Xe=new THREE.TextureLoader(this.manager);Xe.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Ge=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ye=[],qe={},Ze=0,Ke={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(Ue,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var i,a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"source":i=a.getAttribute("id"),t.sources[i]=ie(a);break;case"sampler":i=a.getAttribute("id"),t.samplers[i]=f(a);break;case"channel":i=a.getAttribute("target"),t.channels[i]=p(a);break;default:console.log(a)}}Ke.animations[e.getAttribute("id")]=t})),c(Ue,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(o(i.getAttribute("url")))}}Ke.clips[e.getAttribute("id")]=t})),c(Ue,"library_controllers","controller",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=o(i.getAttribute("source")),t.skin=R(i);break;case"morph":t.id=o(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ke.controllers[e.getAttribute("id")]=t})),c(Ue,"library_images","image",(function(e){var t={init_from:r(e,"init_from")[0].textContent};Ke.images[e.getAttribute("id")]=t})),c(Ue,"library_effects","effect",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=H(i)}}Ke.effects[e.getAttribute("id")]=t})),c(Ue,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=o(i.getAttribute("url"))}}Ke.materials[e.getAttribute("id")]=t})),c(Ue,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=Z(i)}}Ke.cameras[e.getAttribute("id")]=t})),c(Ue,"library_lights","light",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=ee(i)}}Ke.lights[e.getAttribute("id")]=t})),c(Ue,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=ie(a);break;case"vertices":t.vertices=ae(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(a));break;default:console.log(a)}}}Ke.geometries[e.getAttribute("id")]=t}})),c(Ue,"library_nodes","node",Se),c(Ue,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Ze++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(Se(n[i]));Ke.visualScenes[e.getAttribute("id")]=t})),c(Ue,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":fe(n,t)}}Ke.kinematicsModels[e.getAttribute("id")]=t})),c(Ue,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},_e(n,t.rigidBodies[n.getAttribute("name")])}}Ke.physicsModels[e.getAttribute("id")]=t})),c(Ue,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ee(n))}}Ke.kinematicsScenes[o(e.getAttribute("url"))]=t})),h(Ke.animations,m),h(Ke.clips,S),h(Ke.controllers,L),h(Ke.images,C),h(Ke.effects,X),h(Ke.materials,Y),h(Ke.cameras,J),h(Ke.lights,re),h(Ke.geometries,le),h(Ke.visualScenes,De),function(){var e=Ke.clips;if(!0===s(e)){if(!1===s(Ke.animations)){var t=[];for(var r in Ke.animations)for(var n=g(r),i=0,a=n.length;i<a;i++)t.push(n[i]);Ye.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)Ye.push(A(r))}(),function(){var e=Object.keys(Ke.kinematicsModels)[0],t=Object.keys(Ke.kinematicsScenes)[0],r=Object.keys(Ke.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,i=(n=e,d(Ke.kinematicsModels[n],de)),a=function(e){return d(Ke.kinematicsScenes[e],we)}(t),o=Fe(r),s=a.bindJointAxis,l={},u=0,c=s.length;u<c;u++){var h=s[u],f=Ue.querySelector('[sid="'+h.target+'"]');if(f){var p=f.parentElement;g(h.jointIndex,p)}}var m=new THREE.Matrix4;qe={joints:i&&i.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=r.object,a=n.axis,o=r.transforms;Te.identity();for(var s=0;s<o.length;s++){var u=o[s];if(u.sid&&-1!==u.sid.indexOf(e))switch(n.type){case"revolute":Te.multiply(m.makeRotationAxis(a,THREE.MathUtils.degToRad(t)));break;case"prismatic":Te.multiply(m.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(u.type){case"matrix":Te.multiply(u.obj);break;case"translate":Te.multiply(m.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":Te.scale(u.obj);break;case"rotate":Te.multiply(m.makeRotationAxis(u.obj,u.angle))}}i.matrix.copy(Te),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function g(e,t){var r=t.getAttribute("name"),n=i.joints[e];o.traverse((function(i){i.name===r&&(l[e]={object:i,transforms:xe(t),joint:n,position:n.zeroPosition})}))}}();var Qe=function(e){return Fe(o(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Ue,"scene")[0]);return"Z_UP"===We.upAxis&&Qe.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Qe.scale.multiplyScalar(We.unit),{animations:Ye,kinematics:qe,library:Ke,scene:Qe}}})},function(e,t){THREE.ColladaExporter=function(){},THREE.ColladaExporter.prototype={constructor:THREE.ColladaExporter,parse:function(e,t,r){r=r||{},""!==(r=Object.assign({version:"1.4.1",author:null,textureDirectory:""},r)).textureDirectory&&(r.textureDirectory=(r.textureDirectory+"/").replace(/\\/g,"/").replace(/\/+/g,"/"));var n,i,a=r.version;if("1.4.1"!==a&&"1.5.0"!==a)return console.warn(`ColladaExporter : Version ${a} not supported for export. Only 1.4.1 and 1.5.0.`),null;function o(e,t){return n=n||document.createElement("canvas"),i=i||n.getContext("2d"),n.width=e.naturalWidth,n.height=e.naturalHeight,i.drawImage(e,0,0),function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0,i=r.length;n<i;n++)r[n]=t.charCodeAt(n);return r}(n.toDataURL("image/"+t,1).replace(/^data:image\/(png|jpg);base64,/,""))}var s,l=["getX","getY","getZ","getW"];function u(e){if(e.isInterleavedBufferAttribute){for(var t=new e.array.constructor(e.count*e.itemSize),r=e.itemSize,n=0,i=e.count;n<i;n++)for(var a=0;a<r;a++)t[n*r+a]=e[l[a]](n);return t}return e.array}function c(e,t,r,n){var i=u(e);return`<source id="${t}"><float_array id="${t}-array" count="${i.length}">`+i.join(" ")+"</float_array><technique_common>"+`<accessor source="#${t}-array" count="${Math.floor(i.length/e.itemSize)}" stride="${e.itemSize}">`+r.map(e=>`<param name="${e}" type="${n}" />`).join("")+"</accessor></technique_common></source>"}function h(e){var t=p.get(e);if(null==t){t="image-"+(g.length+1);var n=e.name||t,i=`<image id="${t}" name="${n}">`;i+="1.5.0"===a?`<init_from><ref>${r.textureDirectory}${n}.png</ref></init_from>`:`<init_from>${r.textureDirectory}${n}.png</init_from>`,i+="</image>",g.push(i),p.set(e,t),m.push({directory:r.textureDirectory,name:n,ext:"png",data:o(e.image,"png"),original:e})}return t}var d=new WeakMap,f=new WeakMap,p=new WeakMap,m=[],g=[],v=[],y=[],_=[],b=function e(t){var r=`<node name="${t.name}">`;if(r+=function(e){return e.updateMatrix(),(s=s||new THREE.Matrix4).copy(e.matrix),s.transpose(),`<matrix>${s.toArray().join(" ")}</matrix>`}(t),t instanceof THREE.Mesh&&null!=t.geometry){var n=function(e){var t,r,n,i=d.get(e);if(!i){var a=e;a instanceof THREE.Geometry&&(a=(new THREE.BufferGeometry).fromGeometry(a));var o="Mesh"+(v.length+1),s=a.index?a.index.count*a.index.itemSize:a.attributes.position.count,l=null!=a.groups&&0!==a.groups.length?a.groups:[{start:0,count:s,materialIndex:0}],h=`<geometry id="${o}"${e.name?` name="${e.name}"`:""}><mesh>`,f=o+"-position",p=o+"-vertices";h+=c(a.attributes.position,f,["X","Y","Z"],"float"),h+=`<vertices id="${p}"><input semantic="POSITION" source="#${f}" /></vertices>`;var m=`<input semantic="VERTEX" source="#${p}" offset="0" />`;if("normal"in a.attributes){var g=o+"-normal";h+=c(a.attributes.normal,g,["X","Y","Z"],"float"),m+=`<input semantic="NORMAL" source="#${g}" offset="0" />`}if("uv"in a.attributes){var y=o+"-texcoord";h+=c(a.attributes.uv,y,["S","T"],"float"),m+=`<input semantic="TEXCOORD" source="#${y}" offset="0" set="0" />`}if("color"in a.attributes){var _=o+"-color";h+=c(a.attributes.color,_,["X","Y","Z"],"uint8"),m+=`<input semantic="COLOR" source="#${_}" offset="0" />`}var b=null;if(a.index)b=u(a.index);else for(var E=0,w=(b=new Array(s)).length;E<w;E++)b[E]=E;for(E=0,w=l.length;E<w;E++){var x=l[E],T=(t=b,r=x.start,n=x.count,Array.isArray(t)?t.slice(r,r+n):new t.constructor(t.buffer,r*t.BYTES_PER_ELEMENT,n)),M=T.length/3;h+=`<triangles material="MESH_MATERIAL_${x.materialIndex}" count="${M}">`,h+=m,h+=`<p>${T.join(" ")}</p>`,h+="</triangles>"}h+="</mesh></geometry>",v.push(h),i={meshid:o,bufferGeometry:a},d.set(e,i)}return i}(t.geometry),i=n.meshid,a=n.bufferGeometry,o=null,l=t.material||new THREE.MeshBasicMaterial,p=Array.isArray(l)?l:[l];o=(a.groups.length>p.length?new Array(a.groups.length):new Array(p.length)).fill().map((e,t)=>function(e){var t=f.get(e);if(null==t){t="Mat"+(y.length+1);var r="phong";e instanceof THREE.MeshLambertMaterial?r="lambert":e instanceof THREE.MeshBasicMaterial&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));var n=e.emissive?e.emissive:new THREE.Color(0,0,0),i=e.color?e.color:new THREE.Color(0,0,0),a=e.specular?e.specular:new THREE.Color(1,1,1),o=e.shininess||0,s=e.reflectivity||0,l="";!0===e.transparent&&(l+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(l+=`<transparency><float>${e.opacity}</float></transparency>`));var u=`<technique sid="common"><${r}><emission>`+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${n.r} ${n.g} ${n.b} 1</color>`)+"</emission>"+("constant"!==r?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${i.r} ${i.g} ${i.b} 1</color>`)+"</diffuse>":"")+("phong"===r?`<specular><color sid="specular">${a.r} ${a.g} ${a.b} 1</color></specular><shininess>`+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${o}</float>`)+"</shininess>":"")+`<reflective><color>${i.r} ${i.g} ${i.b} 1</color></reflective>`+`<reflectivity><float>${s}</float></reflectivity>`+l+`</${r}></technique>`,c=`<effect id="${t}-effect"><profile_COMMON>`+(e.map?`<newparam sid="diffuse-surface"><surface type="2D"><init_from>${h(e.map)}</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>`:"")+(e.specularMap?`<newparam sid="specular-surface"><surface type="2D"><init_from>${h(e.specularMap)}</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>`:"")+(e.emissiveMap?`<newparam sid="emissive-surface"><surface type="2D"><init_from>${h(e.emissiveMap)}</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>`:"")+u+(e.side===THREE.DoubleSide?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>",d=`<material id="${t}"${e.name?` name="${e.name}"`:""}><instance_effect url="#${t}-effect" /></material>`;_.push(d),y.push(c),f.set(e,t)}return t}(p[t%p.length])),r+=`<instance_geometry url="#${i}">`+(null!=o?"<bind_material><technique_common>"+o.map((e,t)=>`<instance_material symbol="MESH_MATERIAL_${t}" target="#${e}" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>`).join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach(t=>r+=e(t)),r+="</node>"}(e),E=`<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="${"1.4.1"===a?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${a}"><asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>`+(null!==r.author?`<author>${r.author}</author>`:"")+"</contributor>"+`<created>${(new Date).toISOString()}</created>`+`<modified>${(new Date).toISOString()}</modified><up_axis>Y_UP</up_axis></asset>`;E+=`<library_images>${g.join("")}</library_images>`,E+=`<library_effects>${y.join("")}</library_effects>`,E+=`<library_materials>${_.join("")}</library_materials>`,E+=`<library_geometries>${v.join("")}</library_geometries>`,E+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${b}</visual_scene></library_visual_scenes>`,E+='<scene><instance_visual_scene url="#Scene"/></scene>';var w,x,T,M,S,A,R={data:(w=E+="</COLLADA>",x=/^<\//,T=/(\?>$)|(\/>$)/,M=/<[^>]+>[^<]*<\/[^<]+>/,S=(e,t)=>t>0?e+S(e,t-1):"",A=0,w.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map(e=>{M.test(e)||T.test(e)||!x.test(e)||A--;var t=`${S("  ",A)}${e}`;return M.test(e)||T.test(e)||x.test(e)||A++,t}).join("\n")),textures:m};return"function"==typeof t&&requestAnimationFrame(()=>t(R)),R}}},function(e,t){THREE.GCodeLoader=function(e){THREE.Loader.call(this,e),this.splitLayer=!1},THREE.GCodeLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.GCodeLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:function(e){var t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},r=[],n=void 0,i=new THREE.LineBasicMaterial({color:16711680});i.name="path";var a=new THREE.LineBasicMaterial({color:65280});function o(e){n={vertex:[],pathVertex:[],z:e.z},r.push(n)}function s(e,r){return t.relative?r:r-e}function l(e,r){return t.relative?e+r:r}a.name="extruded";for(var u,c,h=e.replace(/;.+/g,"").split("\n"),d=0;d<h.length;d++){var f=h[d].split(" "),p=f[0].toUpperCase(),m={};if(f.splice(1).forEach((function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),r=parseFloat(e.substring(1));m[t]=r}})),"G0"===p||"G1"===p){var g={x:void 0!==m.x?l(t.x,m.x):t.x,y:void 0!==m.y?l(t.y,m.y):t.y,z:void 0!==m.z?l(t.z,m.z):t.z,e:void 0!==m.e?l(t.e,m.e):t.e,f:void 0!==m.f?l(t.f,m.f):t.f};s(t.e,g.e)>0&&(g.extruding=s(t.e,g.e)>0,null!=n&&g.z==n.z||o(g)),u=t,c=g,void 0===n&&o(u),g.extruding?(n.vertex.push(u.x,u.y,u.z),n.vertex.push(c.x,c.y,c.z)):(n.pathVertex.push(u.x,u.y,u.z),n.pathVertex.push(c.x,c.y,c.z)),t=g}else if("G2"===p||"G3"===p);else if("G90"===p)t.relative=!1;else if("G91"===p)t.relative=!0;else if("G92"===p){(g=t).x=void 0!==m.x?m.x:g.x,g.y=void 0!==m.y?m.y:g.y,g.z=void 0!==m.z?m.z:g.z,g.e=void 0!==m.e?m.e:g.e,t=g}}function v(e,t){var r=new THREE.BufferGeometry;r.setAttribute("position",new THREE.Float32BufferAttribute(e,3));var n=new THREE.LineSegments(r,t?a:i);n.name="layer"+d,y.add(n)}var y=new THREE.Group;if(y.name="gcode",this.splitLayer)for(d=0;d<r.length;d++){v((E=r[d]).vertex,!0),v(E.pathVertex,!1)}else{var _=[],b=[];for(d=0;d<r.length;d++){var E=r[d];_=_.concat(E.vertex),b=b.concat(E.pathVertex)}v(_,!0),v(b,!1)}return y.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),y}})},function(e,t){THREE.DRACOLoader=function(e){THREE.Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}},THREE.DRACOLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,r,n){var i=new THREE.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&i.setWithCredentials(!0),i.load(e,e=>{var r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(n)},r,n)},decodeDracoFile:function(e,t,r,n){var i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,i).then(t)},decodeGeometry:function(e,t){for(var r in t.attributeTypes){var n=t.attributeTypes[r];void 0!==n.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=n.name)}var i,a=JSON.stringify(t);if(THREE.DRACOLoader.taskCache.has(e)){var o=THREE.DRACOLoader.taskCache.get(e);if(o.key===a)return o.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var s=this.workerNextTaskID++,l=e.byteLength,u=this._getWorker(s,l).then(r=>(i=r,new Promise((r,n)=>{i._callbacks[s]={resolve:r,reject:n},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return u.finally(()=>{i&&s&&this._releaseTask(i,s)}),THREE.DRACOLoader.taskCache.set(e,{key:a,promise:u}),u},_createGeometry:function(e){var t=new THREE.BufferGeometry;e.index&&t.setIndex(new THREE.BufferAttribute(e.index.array,1));for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r],i=n.name,a=n.array,o=n.itemSize;t.setAttribute(i,new THREE.BufferAttribute(a,o))}return t},_loadLibrary:function(e,t){var r=new THREE.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),new Promise((t,n)=>{r.load(e,t,void 0,n)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var n=THREE.DRACOLoader.DRACOWorker.toString(),i=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var r;this.workerPool.length<this.workerLimit?((r=new Worker(this.workerSourceURL))._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(r)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(r=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,r._taskLoad+=t,r})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),THREE.DRACOLoader.DRACOWorker=function(){var e,t;function r(e,t,r,n,i,a){var o,s,l=a.num_components(),u=r.num_points()*l;switch(i){case Float32Array:o=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,a,o),s=new Float32Array(u);break;case Int8Array:o=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,a,o),s=new Int8Array(u);break;case Int16Array:o=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,a,o),s=new Int16Array(u);break;case Int32Array:o=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,a,o),s=new Int32Array(u);break;case Uint8Array:o=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,a,o),s=new Uint8Array(u);break;case Uint16Array:o=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,a,o),s=new Uint16Array(u);break;case Uint32Array:o=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,a,o),s=new Uint32Array(u);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var c=0;c<u;c++)s[c]=o.GetValue(c);return e.destroy(o),{name:n,array:s,itemSize:l}}onmessage=function(n){var i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=i.buffer,o=i.taskConfig;t.then(e=>{var t=e.draco,n=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var l=function(e,t,n,i){var a,o,s=i.attributeIDs,l=i.attributeTypes,u=t.GetEncodedGeometryType(n);if(u===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(n,a);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(n,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c={index:null,attributes:[]};for(var h in s){var d,f,p=self[l[h]];if(i.useUniqueIDs)f=s[h],d=t.GetAttributeByUniqueId(a,f);else{if(-1===(f=t.GetAttributeId(a,e[s[h]])))continue;d=t.GetAttribute(a,f)}c.attributes.push(r(e,t,a,h,p,d))}if(u===e.TRIANGULAR_MESH){for(var m=a.num_faces(),g=new Uint32Array(3*m),v=new e.DracoInt32Array,y=0;y<m;++y){t.GetFaceFromMesh(a,y,v);for(var _=0;_<3;++_)g[3*y+_]=v.GetValue(_)}c.index={array:g,itemSize:1},e.destroy(v)}return e.destroy(a),c}(t,n,s,o),u=l.attributes.map(e=>e.array.buffer);l.index&&u.push(l.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:l},u)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s),t.destroy(n)}})}}},THREE.DRACOLoader.taskCache=new WeakMap,THREE.DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},THREE.DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},THREE.DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},THREE.DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},function(e,t){THREE.DDSLoader=function(e){THREE.CompressedTextureLoader.call(this,e)},THREE.DDSLoader.prototype=Object.assign(Object.create(THREE.CompressedTextureLoader.prototype),{constructor:THREE.DDSLoader,parse:function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,r,n){for(var i=r*n*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i),s=0,l=0,u=0;u<n;u++)for(var c=0;c<r;c++){var h=a[l],d=a[++l],f=a[++l],p=a[++l];l++,o[s]=f,o[++s]=d,o[++s]=h,o[++s]=p,s++}return o}var a,o=n("DXT1"),s=n("DXT3"),l=n("DXT5"),u=n("ETC1"),c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!c[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var h,d=c[21],f=!1;switch(d){case o:a=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case s:a=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case l:a=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;case u:a=8,r.format=THREE.RGB_ETC1_Format;break;default:if(!(32===c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(h=d,String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255))),r;f=!0,a=64,r.format=THREE.RGBAFormat}r.mipmapCount=1,131072&c[2]&&!1!==t&&(r.mipmapCount=Math.max(1,c[7]));var p=c[28];if(r.isCubemap=!!(512&p),r.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),r;r.width=c[4],r.height=c[3];for(var m=c[1]+4,g=r.isCubemap?6:1,v=0;v<g;v++)for(var y=r.width,_=r.height,b=0;b<r.mipmapCount;b++){if(f)var E=(w=i(e,m,y,_)).length;else{E=Math.max(4,y)/4*Math.max(4,_)/4*a;var w=new Uint8Array(e,m,E)}var x={data:w,width:y,height:_};r.mipmaps.push(x),m+=E,y=Math.max(y>>1,1),_=Math.max(_>>1,1)}return r}})},function(e,t){THREE.GLTFLoader=function(){function e(e){THREE.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:e,load:function(e,t,r,n){var i,a=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),a.manager.itemStart(e);var o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new THREE.FileLoader(a.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===a.crossOrigin&&s.setWithCredentials(!0),s.load(e,(function(r){try{a.parse(r,i,(function(r){t(r),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),r,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,s,l){var d,m={};if("string"==typeof e)d=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o){try{m[r.KHR_BINARY_GLTF]=new u(e)}catch(e){return void(l&&l(e))}d=m[r.KHR_BINARY_GLTF].content}else d=THREE.LoaderUtils.decodeText(new Uint8Array(e));var g=JSON.parse(d);if(void 0===g.asset||g.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(g.extensionsUsed)for(var v=0;v<g.extensionsUsed.length;++v){var y=g.extensionsUsed[v],_=g.extensionsRequired||[];switch(y){case r.KHR_LIGHTS_PUNCTUAL:m[y]=new i(g);break;case r.KHR_MATERIALS_UNLIT:m[y]=new a;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[y]=new f;break;case r.KHR_DRACO_MESH_COMPRESSION:m[y]=new c(g,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:m[y]=new n(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:m[y]=new h;break;case r.KHR_MESH_QUANTIZATION:m[y]=new p;break;default:_.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new U(g,m,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(s,l)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function a(){this.name=r.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(e){var t,r=this.lightDefs[e],n=new THREE.Color(16777215);void 0!==r.color&&n.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(n)).distance=i;break;case"spot":(t=new THREE.SpotLight(n)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},a.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},a.prototype.extendParams=function(e,t,r){var n=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(n)};var o="glTF",s=1313821514,l=5130562;function u(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(e,12),i=0;i<n.byteLength;){var a=n.getUint32(i,!0);i+=4;var u=n.getUint32(i,!0);if(i+=4,u===s){var c=new Uint8Array(e,12+i,a);this.content=THREE.LoaderUtils.decodeText(c)}else if(u===l){var h=12+i;this.body=e.slice(h,h+a)}i+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function c(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function h(){this.name=r.KHR_TEXTURE_TRANSFORM}function d(e){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var s in o)e.uniforms[s]=o[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",i),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function f(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return d},extendParams:function(e,t,r){var n=t.extensions[this.name];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=[];if(Array.isArray(n.diffuseFactor)){var a=n.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==n.diffuseTexture&&i.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var o=n.specularGlossinessTexture;i.push(r.assignTexture(e,"glossinessMap",o)),i.push(r.assignTexture(e,"specularMap",o))}return Promise.all(i)},createMaterial:function(e){var t=new d(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=THREE.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function p(){this.name=r.KHR_MESH_QUANTIZATION}function m(e,t,r,n){THREE.Interpolant.call(this,e,t,r,n)}c.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var u in a){var c=A[u]||u.toLowerCase();o[c]=a[u]}for(u in e.attributes){c=A[u]||u.toLowerCase();if(void 0!==a[u]){var h=r.accessors[e.attributes[u]],d=x[h.componentType];l[c]=d,s[c]=!0===h.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(var r in e.attributes){var n=e.attributes[r],i=s[r];void 0!==i&&(n.normalized=i)}t(e)}),o,l)}))}))},h.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},d.prototype=Object.create(THREE.MeshStandardMaterial.prototype),d.prototype.constructor=d,d.prototype.copy=function(e){return THREE.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},m.prototype=Object.create(THREE.Interpolant.prototype),m.prototype.constructor=m,m.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n,a=0;a!==n;a++)t[a]=r[i+a];return t},m.prototype.beforeStart_=m.prototype.copySampleValue_,m.prototype.afterEnd_=m.prototype.copySampleValue_,m.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=n-t,c=(r-t)/u,h=c*c,d=h*c,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+c,_=0;_!==o;_++){var b=a[p+_+o],E=a[p+_+s]*u,w=a[f+_+o],x=a[f+_]*u;i[_]=v*b+y*E+m*w+g*x}return i};var g=0,v=1,y=2,_=3,b=4,E=5,w=6,x={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},T={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},M={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},S={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},k={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},P="OPAQUE",L="MASK",C="BLEND",I={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function H(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function O(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function D(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function F(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function N(e){for(var t="",r=Object.keys(e).sort(),n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function U(e,r,n){this.json=e||{},this.extensions=r||{},this.options=n||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function B(e,t,r){var n=t.attributes,i=[];function a(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(var o in n){var s=A[o]||o.toLowerCase();s in e.attributes||i.push(a(n[o],s))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(l)}return D(e,t),function(e,t,r){var n=t.attributes,i=new THREE.Box3;if(void 0!==n.POSITION){var a=(d=r.json.accessors[n.POSITION]).min,o=d.max;if(void 0!==a&&void 0!==o){i.set(new THREE.Vector3(a[0],a[1],a[2]),new THREE.Vector3(o[0],o[1],o[2]));var s=t.targets;if(void 0!==s)for(var l=new THREE.Vector3,u=0,c=s.length;u<c;u++){var h=s[u];if(void 0!==h.POSITION){var d;a=(d=r.json.accessors[h.POSITION]).min,o=d.max;void 0!==a&&void 0!==o?(l.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),l.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),l.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),i.expandByVector(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}e.boundingBox=i;var f=new THREE.Sphere;i.getCenter(f.center),f.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,r),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,i=!1,a=0,o=t.length;a<o;a++){if(void 0!==(u=t[a]).POSITION&&(n=!0),void 0!==u.NORMAL&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var u=t[a];if(n){var c=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;s.push(c)}if(i){c=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal;l.push(c)}}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var r=t[0],a=t[1];return n&&(e.morphAttributes.position=r),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function z(e,t){var r=e.getIndex();if(null===r){var n=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<i.count;a++)n.push(a);e.setIndex(n),r=e.getIndex()}var o=r.count-2,s=[];if(t===THREE.TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(r.getX(0)),s.push(r.getX(a)),s.push(r.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(r.getX(a)),s.push(r.getX(a+1)),s.push(r.getX(a+2))):(s.push(r.getX(a+2)),s.push(r.getX(a+1)),s.push(r.getX(a)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l}return U.prototype.parse=function(e,t){var r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};O(i,a,n),D(a,n),e(a)})).catch(t)},U.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n={},i={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var c=0,h=e.length;c<h;c++){var d=e[c];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},U.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},U.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t},U.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,r){n.load(H(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},U.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))},U.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,a,o=e[0],s=S[n.type],l=x[n.componentType],u=l.BYTES_PER_ELEMENT,c=u*s,h=n.byteOffset||0,d=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,f=!0===n.normalized;if(d&&d!==c){var p=Math.floor(h/d),m="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+p+":"+n.count,g=t.cache.get(m);g||(i=new l(o,p*d,n.count*d/u),g=new THREE.InterleavedBuffer(i,d/u),t.cache.add(m,g)),a=new THREE.InterleavedBufferAttribute(g,s,h%d/u,f)}else i=null===o?new l(n.count*s):new l(o,h,n.count*s),a=new THREE.BufferAttribute(i,s,f);if(void 0!==n.sparse){var v=S.SCALAR,y=x[n.sparse.indices.componentType],_=n.sparse.indices.byteOffset||0,b=n.sparse.values.byteOffset||0,E=new y(e[1],_,n.sparse.count*v),w=new l(e[2],b,n.sparse.count*s);null!==o&&(a=new THREE.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(var T=0,M=E.length;T<M;T++){var A=E[T];if(a.setX(A,w[T*s]),s>=2&&a.setY(A,w[T*s+1]),s>=3&&a.setZ(A,w[T*s+2]),s>=4&&a.setW(A,w[T*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))},U.prototype.loadTexture=function(e){var t,n=this,i=this.json,a=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,l=i.textures[e],u=l.extensions||{},c=(t=u[r.MSFT_TEXTURE_DDS]?i.images[u[r.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(c=n.getDependency("bufferView",t.bufferView).then((function(e){h=!0;var r=new Blob([e],{type:t.mimeType});return c=s.createObjectURL(r)}))),Promise.resolve(c).then((function(e){var t=a.manager.getHandler(e);return t||(t=u[r.MSFT_TEXTURE_DDS]?n.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise((function(r,n){t.load(H(e,a.path),r,void 0,n)}))})).then((function(e){!0===h&&s.revokeObjectURL(c),e.flipY=!1,l.name&&(e.name=l.name),t.mimeType in I&&(e.format=I[t.mimeType]);var r=(i.samplers||{})[l.sampler]||{};return e.magFilter=T[r.magFilter]||THREE.LinearFilter,e.minFilter=T[r.minFilter]||THREE.LinearMipmapLinearFilter,e.wrapS=M[r.wrapS]||THREE.RepeatWrapping,e.wrapT=M[r.wrapT]||THREE.RepeatWrapping,e}))},U.prototype.assignTexture=function(e,t,n){var i=this;return this.getDependency("texture",n.index).then((function(a){if(!a.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":a.format=THREE.RGBFormat}if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;o&&(a=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(a,o))}e[t]=a}))},U.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,n=void 0!==t.attributes.color,i=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,o=Object.keys(t.morphAttributes).length>0,s=o&&void 0!==t.morphAttributes.normal;if(e.isPoints){var l="PointsMaterial:"+r.uuid,u=this.cache.get(l);u||(u=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(u,r),u.color.copy(r.color),u.map=r.map,u.sizeAttenuation=!1,this.cache.add(l,u)),r=u}else if(e.isLine){l="LineBasicMaterial:"+r.uuid;var c=this.cache.get(l);c||(c=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(c,r),c.color.copy(r.color),this.cache.add(l,c)),r=c}if(n||i||a||o){l="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),a&&(l+="skinning:"),n&&(l+="vertex-colors:"),i&&(l+="flat-shading:"),o&&(l+="morph-targets:"),s&&(l+="morph-normals:");var h=this.cache.get(l);h||(h=r.clone(),a&&(h.skinning=!0),n&&(h.vertexColors=!0),i&&(h.flatShading=!0),o&&(h.morphTargets=!0),s&&(h.morphNormals=!0),this.cache.add(l,h)),r=h}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2)),r.normalScale&&(r.normalScale.y=-r.normalScale.y),e.material=r},U.prototype.loadMaterial=function(e){var t,n=this.json,i=this.extensions,a=n.materials[e],o={},s=a.extensions||{},l=[];if(s[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),l.push(u.extendParams(o,a,this))}else if(s[r.KHR_MATERIALS_UNLIT]){var c=i[r.KHR_MATERIALS_UNLIT];t=c.getMaterialType(),l.push(c.extendParams(o,a,this))}else{t=THREE.MeshStandardMaterial;var h=a.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var f=h.baseColorFactor;o.color.fromArray(f),o.opacity=f[3]}void 0!==h.baseColorTexture&&l.push(this.assignTexture(o,"map",h.baseColorTexture)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===a.doubleSided&&(o.side=THREE.DoubleSide);var p=a.alphaMode||P;return p===C?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,p===L&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==a.normalTexture.scale&&o.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(l).then((function(){var e;return e=t===d?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),a.name&&(e.name=a.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),D(e,a),a.extensions&&O(i,e,a),e}))},U.prototype.loadGeometries=function(e){var t=this,n=this.extensions,i=this.primitiveCache;function a(e){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return B(r,e,t)}))}for(var o,s,l=[],u=0,c=e.length;u<c;u++){var h,d=e[u],f=(s=void 0,(s=(o=d).extensions&&o.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+N(s.attributes):o.indices+":"+N(o.attributes)+":"+o.mode),p=i[f];if(p)l.push(p.promise);else h=d.extensions&&d.extensions[r.KHR_DRACO_MESH_COMPRESSION]?a(d):B(new THREE.BufferGeometry,d,t),i[f]={primitive:d,promise:h},l.push(h)}return Promise.all(l)},U.prototype.loadMesh=function(e){for(var t,r=this,n=this.json.meshes[e],i=n.primitives,a=[],o=0,s=i.length;o<s;o++){var l=void 0===i[o].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),t.DefaultMaterial):this.getDependency("material",i[o].material);a.push(l)}return a.push(r.loadGeometries(i)),Promise.all(a).then((function(t){for(var a=t.slice(0,t.length-1),o=t[t.length-1],s=[],l=0,u=o.length;l<u;l++){var c,h=o[l],d=i[l],f=a[l];if(d.mode===b||d.mode===E||d.mode===w||void 0===d.mode)!0!==(c=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(h,f):new THREE.Mesh(h,f)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),d.mode===E?c.geometry=z(c.geometry,THREE.TriangleStripDrawMode):d.mode===w&&(c.geometry=z(c.geometry,THREE.TriangleFanDrawMode));else if(d.mode===v)c=new THREE.LineSegments(h,f);else if(d.mode===_)c=new THREE.Line(h,f);else if(d.mode===y)c=new THREE.LineLoop(h,f);else{if(d.mode!==g)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);c=new THREE.Points(h,f)}Object.keys(c.geometry.morphAttributes).length>0&&F(c,n),c.name=n.name||"mesh_"+e,o.length>1&&(c.name+="_"+l),D(c,n),r.assignFinalMaterial(c),s.push(c)}if(1===s.length)return s[0];var p=new THREE.Group;for(l=0,u=s.length;l<u;l++)p.add(s[l]);return p}))},U.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),r.name&&(t.name=r.name),D(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},U.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))},U.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],n=[],i=[],a=[],o=[],s=0,l=t.channels.length;s<l;s++){var u=t.channels[s],c=t.samplers[u.sampler],h=u.target,d=void 0!==h.node?h.node:h.id,f=void 0!==t.parameters?t.parameters[c.input]:c.input,p=void 0!==t.parameters?t.parameters[c.output]:c.output;r.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",p)),a.push(c),o.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(r){for(var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=[],u=0,c=n.length;u<c;u++){var h=n[u],d=i[u],f=a[u],p=o[u],g=s[u];if(void 0!==h){var v;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,R[g.path]){case R.weights:v=THREE.NumberKeyframeTrack;break;case R.rotation:v=THREE.QuaternionKeyframeTrack;break;case R.position:case R.scale:default:v=THREE.VectorKeyframeTrack}var y=h.name?h.name:h.uuid,_=void 0!==p.interpolation?k[p.interpolation]:THREE.InterpolateLinear,b=[];R[g.path]===R.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(y);var E=f.array;if(f.normalized){var w;if(E.constructor===Int8Array)w=1/127;else if(E.constructor===Uint8Array)w=1/255;else if(E.constructor==Int16Array)w=1/32767;else{if(E.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var x=new Float32Array(E.length),T=0,M=E.length;T<M;T++)x[T]=E[T]*w;E=x}for(T=0,M=b.length;T<M;T++){var S=new v(b[T]+"."+R[g.path],d.array,E,_);"CUBICSPLINE"===p.interpolation&&(S.createInterpolant=function(e){return new m(this.times,this.values,this.getValueSize()/3,e)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(S)}}}var A=t.name?t.name:"animation_"+e;return new THREE.AnimationClip(A,void 0,l)}))},U.prototype.loadNode=function(e){var t,n=this.json,i=this.extensions,a=this,o=n.meshReferences,s=n.meshUses,l=n.nodes[e];return(t=[],void 0!==l.mesh&&t.push(a.getDependency("mesh",l.mesh).then((function(e){var t;if(o[l.mesh]>1){var r=s[l.mesh]++;(t=e.clone()).name+="_instance_"+r}else t=e;return void 0!==l.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,r=l.weights.length;t<r;t++)e.morphTargetInfluences[t]=l.weights[t]})),t}))),void 0!==l.camera&&t.push(a.getDependency("camera",l.camera)),l.extensions&&l.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[r.KHR_LIGHTS_PUNCTUAL].light&&t.push(a.getDependency("light",l.extensions[r.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then((function(e){var t;if((t=!0===l.isBone?new THREE.Bone:e.length>1?new THREE.Group:1===e.length?e[0]:new THREE.Object3D)!==e[0])for(var r=0,n=e.length;r<n;r++)t.add(e[r]);if(l.name&&(t.userData.name=l.name,t.name=THREE.PropertyBinding.sanitizeNodeName(l.name)),D(t,l),l.extensions&&O(i,t,l),void 0!==l.matrix){var a=new THREE.Matrix4;a.fromArray(l.matrix),t.applyMatrix4(a)}else void 0!==l.translation&&t.position.fromArray(l.translation),void 0!==l.rotation&&t.quaternion.fromArray(l.rotation),void 0!==l.scale&&t.scale.fromArray(l.scale);return t}))},U.prototype.loadScene=function(){function e(t,r,n,i){var a=n.nodes[t];return i.getDependency("node",t).then((function(e){return void 0===a.skin?e:i.getDependency("skin",a.skin).then((function(e){for(var r=[],n=0,a=(t=e).joints.length;n<a;n++)r.push(i.getDependency("node",t.joints[n]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(e.isMesh){for(var n=[],i=[],a=0,o=r.length;a<o;a++){var s=r[a];if(s){n.push(s);var l=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*a),i.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new THREE.Skeleton(n,i),e.matrixWorld)}})),e}));var t})).then((function(t){r.add(t);var o=[];if(a.children)for(var s=a.children,l=0,u=s.length;l<u;l++){var c=s[l];o.push(e(c,t,n,i))}return Promise.all(o)}))}return function(t){var r=this.json,n=this.extensions,i=this.json.scenes[t],a=new THREE.Group;i.name&&(a.name=i.name),D(a,i),i.extensions&&O(n,a,i);for(var o=i.nodes||[],s=[],l=0,u=o.length;l<u;l++)s.push(e(o[l],a,r,this));return Promise.all(s).then((function(){return a}))}}(),e}()},function(e,t){var r=0,n=1,i=2,a=3,o=4,s=5121,l=5123,u=5126,c=5125,h=34962,d=34963,f=9728,p=9729,m=9984,g=9985,v=9986,y=9987,_=33071,b=33648,E=10497,w={};w[THREE.NearestFilter]=f,w[THREE.NearestMipmapNearestFilter]=m,w[THREE.NearestMipmapLinearFilter]=v,w[THREE.LinearFilter]=p,w[THREE.LinearMipmapNearestFilter]=g,w[THREE.LinearMipmapLinearFilter]=y,w[THREE.ClampToEdgeWrapping]=_,w[THREE.RepeatWrapping]=E,w[THREE.MirroredRepeatWrapping]=b;var x={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,t,f){var p={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1};(f=Object.assign({},p,f)).animations.length>0&&(f.trs=!0);var m,g={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},v=0,y=[],_=[],b=new Map,E=[],T={},M={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},S=new Map,A=0;function R(e){return S.has(e)||S.set(e,A++),S.get(e)}function k(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))}function P(e){return 4*Math.ceil(e/4)}function L(e,t){t=t||0;var r=P(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}function C(e,t){if(0!==Object.keys(e.userData).length)try{var r=JSON.parse(JSON.stringify(e.userData));if(f.includeCustomExtensions&&r.gltfExtensions){for(var n in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[n]=r.gltfExtensions[n],T[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function I(e,t){var r=!1,n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,T.KHR_texture_transform=!0)}function H(e){return g.buffers||(g.buffers=[{byteLength:0}]),y.push(e),0}function O(e,t,r,n){var i;if(e.array.constructor===Float32Array)i=u;else if(e.array.constructor===Uint32Array)i=c;else if(e.array.constructor===Uint16Array)i=l;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");i=s}if(void 0===r&&(r=0),void 0===n&&(n=e.count),f.truncateDrawRange&&void 0!==t&&null===t.index){var a=r+n,o=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;r=Math.max(r,t.drawRange.start),(n=Math.min(a,o)-r)<0&&(n=0)}if(0===n)return null;var p,m=function(e,t,r){for(var n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+r;i++)for(var a=0;a<e.itemSize;a++){var o=e.array[i*e.itemSize+a];n.min[a]=Math.min(n.min[a],o),n.max[a]=Math.max(n.max[a],o)}return n}(e,r,n);void 0!==t&&(p=e===t.index?d:h);var y=function(e,t,r,n,i){var a;g.bufferViews||(g.bufferViews=[]),a=t===s?1:t===l?2:4;for(var o=P(n*e.itemSize*a),d=new DataView(new ArrayBuffer(o)),f=0,p=r;p<r+n;p++)for(var m=0;m<e.itemSize;m++){var y=e.array[p*e.itemSize+m];t===u?d.setFloat32(f,y,!0):t===c?d.setUint32(f,y,!0):t===l?d.setUint16(f,y,!0):t===s&&d.setUint8(f,y),f+=a}var _={buffer:H(d.buffer),byteOffset:v,byteLength:o};return void 0!==i&&(_.target=i),i===h&&(_.byteStride=e.itemSize*a),v+=o,g.bufferViews.push(_),{id:g.bufferViews.length-1,byteLength:0}}(e,i,r,n,p),_={bufferView:y.id,byteOffset:y.byteOffset,componentType:i,count:n,max:m.max,min:m.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return g.accessors||(g.accessors=[]),g.accessors.push(_),g.accessors.length-1}function D(e,t,r){M.images.has(e)||M.images.set(e,{});var n=M.images.get(e),i=t===THREE.RGBAFormat?"image/png":"image/jpeg",a=i+":flipY/"+r.toString();if(void 0!==n[a])return n[a];g.images||(g.images=[]);var o={mimeType:i};if(f.embedImages){var s=m=m||document.createElement("canvas");s.width=Math.min(e.width,f.maxTextureSize),s.height=Math.min(e.height,f.maxTextureSize),f.forcePowerOfTwoTextures&&!function(e){return THREE.MathUtils.isPowerOfTwo(e.width)&&THREE.MathUtils.isPowerOfTwo(e.height)}(s)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),s.width=THREE.MathUtils.floorPowerOfTwo(s.width),s.height=THREE.MathUtils.floorPowerOfTwo(s.height));var l=s.getContext("2d");!0===r&&(l.translate(0,s.height),l.scale(1,-1)),l.drawImage(e,0,0,s.width,s.height),!0===f.binary?_.push(new Promise((function(e){s.toBlob((function(t){(function(e){return g.bufferViews||(g.bufferViews=[]),new Promise((function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=L(r.result),n={buffer:H(e),byteOffset:v,byteLength:e.byteLength};v+=e.byteLength,g.bufferViews.push(n),t(g.bufferViews.length-1)}}))})(t).then((function(t){o.bufferView=t,e()}))}),i)}))):o.uri=s.toDataURL(i)}else o.uri=e.src;g.images.push(o);var u=g.images.length-1;return n[a]=u,u}function F(e){g.samplers||(g.samplers=[]);var t={magFilter:w[e.magFilter],minFilter:w[e.minFilter],wrapS:w[e.wrapS],wrapT:w[e.wrapT]};return g.samplers.push(t),g.samplers.length-1}function N(e){if(M.textures.has(e))return M.textures.get(e);g.textures||(g.textures=[]);var t={sampler:F(e),source:D(e.image,e.format,e.flipY)};e.name&&(t.name=e.name),g.textures.push(t);var r=g.textures.length-1;return M.textures.set(e,r),r}function U(e){if(M.materials.has(e))return M.materials.get(e);if(g.materials||(g.materials=[]),e.isShaderMaterial&&!e.isGLTFSpecularGlossinessMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},T.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},T.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(k(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial){t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var n=[1,1,1];e.specular.toArray(n,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=n,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness}if(e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var i={index:N(e.metalnessMap)};I(i,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=i}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var a={index:N(e.map)};I(a,e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=a),t.pbrMetallicRoughness.baseColorTexture=a}if(e.isGLTFSpecularGlossinessMaterial&&e.specularMap){var o={index:N(e.specularMap)};I(o,e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=o}if(e.emissive){var s=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(k(s,[0,0,0])||(t.emissiveFactor=s),e.emissiveMap){var l={index:N(e.emissiveMap)};I(l,e.emissiveMap),t.emissiveTexture=l}}if(e.normalMap){var u={index:N(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),u.scale=e.normalScale.x),I(u,e.normalMap),t.normalTexture=u}if(e.aoMap){var c={index:N(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(c.strength=e.aoMapIntensity),I(c,e.aoMap),t.occlusionTexture=c}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),C(e,t),g.materials.push(t);var h=g.materials.length-1;return M.materials.set(e,h),h}function B(e){var t=[e.geometry.uuid];if(Array.isArray(e.material))for(var s=0,l=e.material.length;s<l;s++)t.push(e.material[s].uuid);else t.push(e.material.uuid);var u=t.join(":");if(M.meshes.has(u))return M.meshes.get(u);var c,h=e.geometry;if(e.isLineSegments)c=n;else if(e.isLineLoop)c=i;else if(e.isLine)c=a;else if(e.isPoints)c=r;else{if(!h.isBufferGeometry){console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use THREE.BufferGeometry instead.");var d=new THREE.BufferGeometry;d.fromGeometry(h),h=d}c=e.material.wireframe?n:o}var p={},m={},v=[],y=[],_={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},b=h.getAttribute("normal");void 0===b||function(e){if(M.attributesNormalized.has(e))return!1;for(var t=new THREE.Vector3,r=0,n=e.count;r<n;r++)if(Math.abs(t.fromArray(e.array,3*r).length()-1)>5e-4)return!1;return!0}(b)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),h.setAttribute("normal",function(e){if(M.attributesNormalized.has(e))return M.attributesNormalized.get(e);for(var t=e.clone(),r=new THREE.Vector3,n=0,i=t.count;n<i;n++)r.fromArray(t.array,3*n),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*n);return M.attributesNormalized.set(e,t),t}(b)));var E=null;for(var w in h.attributes)if("morph"!==w.substr(0,5)){var x=h.attributes[w];w=_[w]||w.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(w)||(w="_"+w),M.attributes.has(R(x)))m[w]=M.attributes.get(R(x));else{E=null;var T=x.array;"JOINTS_0"!==w||T instanceof Uint16Array||T instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),E=new THREE.BufferAttribute(new Uint16Array(T),x.itemSize,x.normalized));var S=O(E||x,h);null!==S&&(m[w]=S,M.attributes.set(R(x),S))}}if(void 0!==b&&h.setAttribute("normal",b),0===Object.keys(m).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var A=[],k=[],P={};if(void 0!==e.morphTargetDictionary)for(var L in e.morphTargetDictionary)P[e.morphTargetDictionary[L]]=L;for(s=0;s<e.morphTargetInfluences.length;++s){var I={},H=!1;for(var w in h.morphAttributes)if("position"===w||"normal"===w){x=h.morphAttributes[w][s];var D=w.toUpperCase(),F=h.attributes[w];if(M.attributes.has(R(x)))I[D]=M.attributes.get(R(x));else{var N=x.clone();if(!h.morphTargetsRelative)for(var B=0,z=x.count;B<z;B++)N.setXYZ(B,x.getX(B)-F.getX(B),x.getY(B)-F.getY(B),x.getZ(B)-F.getZ(B));I[D]=O(N,h),M.attributes.set(R(F),I[D])}}else H||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),H=!0);y.push(I),A.push(e.morphTargetInfluences[s]),void 0!==e.morphTargetDictionary&&k.push(P[s])}p.weights=A,k.length>0&&(p.extras={},p.extras.targetNames=k)}var j=f.forceIndices,V=Array.isArray(e.material);if(V&&0===h.groups.length)return null;!j&&null===h.index&&V&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),j=!0);var G=!1;if(null===h.index&&j){for(var W=[],X=(s=0,h.attributes.position.count);s<X;s++)W[s]=s;h.setIndex(W),G=!0}var Y=V?e.material:[e.material],q=V?h.groups:[{materialIndex:0,start:void 0,count:void 0}];for(s=0,X=q.length;s<X;s++){var Z={mode:c,attributes:m};if(C(h,Z),y.length>0&&(Z.targets=y),null!==h.index){var K=R(h.index);void 0===q[s].start&&void 0===q[s].count||(K+=":"+q[s].start+":"+q[s].count),M.attributes.has(K)?Z.indices=M.attributes.get(K):(Z.indices=O(h.index,h,q[s].start,q[s].count),M.attributes.set(K,Z.indices)),null===Z.indices&&delete Z.indices}var Q=U(Y[q[s].materialIndex]);null!==Q&&(Z.material=Q),v.push(Z)}G&&h.setIndex(null),p.primitives=v,g.meshes||(g.meshes=[]),g.meshes.push(p);var J=g.meshes.length-1;return M.meshes.set(u,J),J}function z(e,t){g.animations||(g.animations=[]);for(var r=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,n=[],i=[],a=0;a<r.length;++a){var o=r[a],s=THREE.PropertyBinding.parseTrackName(o.name),l=THREE.PropertyBinding.findNode(t,s.nodeName),u=x[s.propertyName];if("bones"===s.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(s.objectIndex):void 0),!l||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',o.name),null;var c,h=o.values.length/o.times.length;u===x.morphTargetInfluences&&(h/=l.morphTargetInfluences.length),!0===o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(c="CUBICSPLINE",h/=3):c=o.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",i.push({input:O(new THREE.BufferAttribute(o.times,1)),output:O(new THREE.BufferAttribute(o.values,h)),interpolation:c}),n.push({sampler:i.length-1,target:{node:b.get(l),path:u}})}return g.animations.push({name:e.name||"clip_"+g.animations.length,samplers:i,channels:n}),g.animations.length-1}function j(e){var t=g.nodes[b.get(e)],r=e.skeleton;if(void 0===r)return null;var n=e.skeleton.bones[0];if(void 0===n)return null;for(var i=[],a=new Float32Array(16*r.bones.length),o=0;o<r.bones.length;++o)i.push(b.get(r.bones[o])),r.boneInverses[o].toArray(a,16*o);return void 0===g.skins&&(g.skins=[]),g.skins.push({inverseBindMatrices:O(new THREE.BufferAttribute(a,16)),joints:i,skeleton:b.get(n)}),t.skin=g.skins.length-1}function V(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=g.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function G(e){g.nodes||(g.nodes=[]);var t={};if(f.trs){var r=e.quaternion.toArray(),n=e.position.toArray(),i=e.scale.toArray();k(r,[0,0,0,1])||(t.rotation=r),k(n,[0,0,0])||(t.translation=n),k(i,[1,1,1])||(t.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),k(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),C(e,t),e.isMesh||e.isLine||e.isPoints){var a=B(e);null!==a&&(t.mesh=a)}else if(e.isCamera)t.camera=function(e){g.cameras||(g.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),g.cameras.push(r),g.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)T.KHR_lights_punctual||(g.extensions=g.extensions||{},g.extensions.KHR_lights_punctual={lights:[]},T.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:V(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&E.push(e),e.children.length>0){for(var o=[],s=0,l=e.children.length;s<l;s++){var u=e.children[s];if(u.visible||!1===f.onlyVisible){var c=G(u);null!==c&&o.push(c)}}o.length>0&&(t.children=o)}g.nodes.push(t);var h=g.nodes.length-1;return b.set(e,h),h}function W(e){g.scenes||(g.scenes=[],g.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),g.scenes.push(t);for(var r=[],n=0,i=e.children.length;n<i;n++){var a=e.children[n];if(a.visible||!1===f.onlyVisible){var o=G(a);null!==o&&r.push(o)}}r.length>0&&(t.nodes=r),C(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof THREE.Scene?W(e[r]):t.push(e[r]);for(t.length>0&&function(e){var t=new THREE.Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);W(t)}(t),r=0;r<E.length;++r)j(E[r]);for(r=0;r<f.animations.length;++r)z(f.animations[r],e[0])}(e),Promise.all(_).then((function(){var e=new Blob(y,{type:"application/octet-stream"}),r=Object.keys(T);if(r.length>0&&(g.extensionsUsed=r),g.buffers&&g.buffers.length>0){g.buffers[0].byteLength=e.size;var n=new window.FileReader;if(!0===f.binary){n.readAsArrayBuffer(e),n.onloadend=function(){var e=L(n.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var i=L(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);t[r]=i>255?32:i}return t.buffer}(JSON.stringify(g)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,i.byteLength,!0),a.setUint32(4,1313821514,!0);var o=new ArrayBuffer(12),s=new DataView(o);s.setUint32(0,1179937895,!0),s.setUint32(4,2,!0);var l=12+a.byteLength+i.byteLength+r.byteLength+e.byteLength;s.setUint32(8,l,!0);var u=new Blob([o,a,i,r,e],{type:"application/octet-stream"}),c=new window.FileReader;c.readAsArrayBuffer(u),c.onloadend=function(){t(c.result)}}}else n.readAsDataURL(e),n.onloadend=function(){var e=n.result;g.buffers[0].uri=e,t(g)}}else t(g)}))}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var r,n=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+n),o=e.createInterpolant(new e.ValueBufferType(n));if(0===e.times.length){i[0]=t;for(var s=0;s<n;s++)a[s]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;i[0]=t,i.set(e.times,1),a.set(o.evaluate(t),0),a.set(e.values,n),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),a.set(e.values,0),a.set(o.evaluate(t),e.values.length),r=i.length-1}else for(s=0;s<e.times.length;s++){if(Math.abs(e.times[s]-t)<.001)return s;if(e.times[s]<t&&e.times[s+1]>t){i.set(e.times.slice(0,s+1),0),i[s+1]=t,i.set(e.times.slice(s+1),s+2),a.set(e.values.slice(0,(s+1)*n),0),a.set(o.evaluate(t),(s+1)*n),a.set(e.values.slice((s+1)*n),(s+2)*n),r=s+1;break}}return e.times=i,e.values=a,r},mergeMorphTargetTracks:function(e,t){for(var r=[],n={},i=e.tracks,a=0;a<i.length;++a){var o=i[a],s=THREE.PropertyBinding.parseTrackName(o.name),l=THREE.PropertyBinding.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(THREE.InterpolateLinear)}var u,c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[s.propertyIndex];if(void 0===h)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0!==n[l.uuid]){var d=o.createInterpolant(new o.ValueBufferType(1));u=n[l.uuid];for(m=0;m<u.times.length;m++)u.values[m*c+h]=d.evaluate(u.times[m]);for(m=0;m<o.times.length;m++){var f=this.insertKeyframe(u,o.times[m]);u.values[f*c+h]=o.values[m]}}else{for(var p=new((u=o.clone()).ValueBufferType)(c*u.times.length),m=0;m<u.times.length;m++)p[m*c+h]=u.values[m];u.name=".morphTargetInfluences",u.values=p,n[l.uuid]=u,r.push(u)}}else r.push(o)}return e.tracks=r,e}}},function(e,t,r){"use strict";r.r(t);var n=r(3);THREE.AMFLoader=function(e){THREE.Loader.call(this,e)},THREE.AMFLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.AMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:function(e){function t(e){for(var t="AMF Material",n=e.attributes.id.textContent,i={r:1,g:1,b:1,a:1},a=null,o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(t=s.textContent):"color"===s.nodeName&&(i=r(s))}return a=new THREE.MeshPhongMaterial({flatShading:!0,color:new THREE.Color(i.r,i.g,i.b),name:t}),1!==i.a&&(a.transparent=!0,a.opacity=i.a),{id:n,material:a}}function r(e){for(var t={r:1,g:1,b:1,a:1},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function i(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,i=r.getElementsByTagName("v2")[0].textContent,a=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(n,i,a)}r=r.nextElementSibling}return t}function a(e){for(var t=[],r=[],n=e.firstElementChild;n;){if("vertex"===n.nodeName)for(var i=n.firstElementChild;i;){if("coordinates"===i.nodeName){var a=i.getElementsByTagName("x")[0].textContent,o=i.getElementsByTagName("y")[0].textContent,s=i.getElementsByTagName("z")[0].textContent;t.push(a,o,s)}else if("normal"===i.nodeName){var l=i.getElementsByTagName("nx")[0].textContent,u=i.getElementsByTagName("ny")[0].textContent,c=i.getElementsByTagName("nz")[0].textContent;r.push(l,u,c)}i=i.nextElementSibling}n=n.nextElementSibling}return{vertices:t,normals:r}}function o(e){for(var t=e.attributes.id.textContent,n={name:"amfobject",meshes:[]},o=null,s=e.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(n.name=s.textContent);else if("color"===s.nodeName)o=r(s);else if("mesh"===s.nodeName){for(var l=s.firstElementChild,u={vertices:[],normals:[],volumes:[],color:o};l;){if("vertices"===l.nodeName){var c=a(l);u.normals=u.normals.concat(c.normals),u.vertices=u.vertices.concat(c.vertices)}else"volume"===l.nodeName&&u.volumes.push(i(l));l=l.nextElementSibling}n.meshes.push(u)}s=s.nextElementSibling}return{id:t,obj:n}}var s,l,u=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var r=null,i=null;console.log("THREE.AMFLoader: Loading Zip");try{r=new n(e)}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: jszip missing and file is compressed."),null}for(i in r.files)if(".amf"===i.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+i),t=new DataView(r.file(i).asArrayBuffer())}var a=THREE.LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(a,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),c="",h="",d=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(u),f={},p={},m=u.documentElement.childNodes;for(s=0;s<m.length;s++){var g=m[s];if("metadata"===g.nodeName)void 0!==g.attributes.type&&("name"===g.attributes.type.value?c=g.textContent:"author"===g.attributes.type.value&&(h=g.textContent));else if("material"===g.nodeName){var v=t(g);f[v.id]=v.material}else if("object"===g.nodeName){var y=o(g);p[y.id]=y.obj}}var _=new THREE.Group,b=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});for(var E in _.name=c,_.userData.author=h,_.userData.loader="AMF",p){var w=p[E],x=w.meshes,T=new THREE.Group;for(T.name=w.name||"",s=0;s<x.length;s++){var M=b,S=x[s],A=new THREE.Float32BufferAttribute(S.vertices,3),R=null;if(S.normals.length&&(R=new THREE.Float32BufferAttribute(S.normals,3)),S.color){var k=S.color;(M=b.clone()).color=new THREE.Color(k.r,k.g,k.b),1!==k.a&&(M.transparent=!0,M.opacity=k.a)}var P=S.volumes;for(l=0;l<P.length;l++){var L=P[l],C=new THREE.BufferGeometry,I=M;C.setIndex(L.triangles),C.setAttribute("position",A.clone()),R&&C.setAttribute("normal",R.clone()),void 0!==f[L.materialId]&&(I=f[L.materialId]),C.scale(d,d,d),T.add(new THREE.Mesh(C,I.clone()))}}_.add(T)}return _}})},function(e,t,r){"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=u(e),o=n[0],s=n[1],l=new a(function(e,t,r){return 3*(t+r)/4-r}(0,o,s)),c=0,h=s>0?o-4:o;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,l[c++]=255&t);1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t);return l},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(c(e,o,o+16383>s?s:o+16383));1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";r.r(t);var n=r(3);THREE.ThreeMFLoader=function(e){THREE.Loader.call(this,e),this.availableExtensions=[]},THREE.ThreeMFLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.ThreeMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:function(e){var t=this,r=new THREE.TextureLoader(this.manager);function i(e){for(var t=[],r=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship"),n=0;n<r.length;n++){var i=r[n],a={target:i.getAttribute("Target"),id:i.getAttribute("Id"),type:i.getAttribute("Type")};t.push(a)}return t}function a(e){for(var t={id:e.getAttribute("id"),basematerials:[]},r=e.querySelectorAll("base"),n=0;n<r.length;n++){var i=u(r[n]);i.index=n,t.basematerials.push(i)}return t}function o(e){for(var t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("tex2coord"),n=[],i=0;i<r.length;i++){var a=r[i],o=a.getAttribute("u"),s=a.getAttribute("v");n.push(parseFloat(o),parseFloat(s))}return t.uvs=new Float32Array(n),t}function s(e){for(var t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("color"),n=[],i=new THREE.Color,a=0;a<r.length;a++){var o=r[a].getAttribute("color");i.setStyle(o.substring(0,7)),i.convertSRGBToLinear(),n.push(i.r,i.g,i.b)}return t.colors=new Float32Array(n),t}function l(e){for(var t={id:e.getAttribute("id")},r=e.querySelectorAll("pbmetallic"),n=[],i=0;i<r.length;i++){var a=r[i];n.push({name:a.getAttribute("name"),metallicness:parseFloat(a.getAttribute("metallicness")),roughness:parseFloat(a.getAttribute("roughness"))})}return t.data=n,t}function u(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}function c(e){var t={};t.objectId=e.getAttribute("objectid");var r=e.getAttribute("transform");return r&&(t.transform=h(r)),t}function h(e){var t=[];e.split(" ").forEach((function(e){t.push(parseFloat(e))}));var r=new THREE.Matrix4;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function d(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var n=e.getAttribute("pid");n&&(t.pid=n);var i=e.getAttribute("pindex");i&&(t.pindex=i);var a=e.getAttribute("thumbnail");a&&(t.thumbnail=a);var o=e.getAttribute("partnumber");o&&(t.partnumber=o);var s=e.getAttribute("name");s&&(t.name=s);var l=e.querySelector("mesh");l&&(t.mesh=function(e){for(var t={},r=[],n=e.querySelectorAll("vertices vertex"),i=0;i<n.length;i++){var a=n[i],o=a.getAttribute("x"),s=a.getAttribute("y"),l=a.getAttribute("z");r.push(parseFloat(o),parseFloat(s),parseFloat(l))}t.vertices=new Float32Array(r);var u=[],c=[],h=e.querySelectorAll("triangles triangle");for(i=0;i<h.length;i++){var d=h[i],f=d.getAttribute("v1"),p=d.getAttribute("v2"),m=d.getAttribute("v3"),g=d.getAttribute("p1"),v=d.getAttribute("p2"),y=d.getAttribute("p3"),_=d.getAttribute("pid"),b={};b.v1=parseInt(f,10),b.v2=parseInt(p,10),b.v3=parseInt(m,10),c.push(b.v1,b.v2,b.v3),g&&(b.p1=parseInt(g,10)),v&&(b.p2=parseInt(v,10)),y&&(b.p3=parseInt(y,10)),_&&(b.pid=_),0<Object.keys(b).length&&u.push(b)}return t.triangleProperties=u,t.triangles=new Uint32Array(c),t}(l));var u=e.querySelector("components");return u&&(t.components=function(e){for(var t=[],r=e.querySelectorAll("component"),n=0;n<r.length;n++){var i=c(r[n]);t.push(i)}return t}(u)),t}function f(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=n.textContent)}return t}(r));var n=e.querySelector("resources");n&&(t.resources=function(e){for(var t={basematerials:{}},r=e.querySelectorAll("basematerials"),n=0;n<r.length;n++){var i=a(r[n]);t.basematerials[i.id]=i}t.texture2d={};var u,c=e.querySelectorAll("texture2d");for(n=0;n<c.length;n++){var h=c[n],f={id:(u=h).getAttribute("id"),path:u.getAttribute("path"),contenttype:u.getAttribute("contenttype"),tilestyleu:u.getAttribute("tilestyleu"),tilestylev:u.getAttribute("tilestylev"),filter:u.getAttribute("filter")};t.texture2d[f.id]=f}t.colorgroup={};var p=e.querySelectorAll("colorgroup");for(n=0;n<p.length;n++){var m=s(p[n]);t.colorgroup[m.id]=m}t.pbmetallicdisplayproperties={};var g=e.querySelectorAll("pbmetallicdisplayproperties");for(n=0;n<g.length;n++){var v=l(g[n]);t.pbmetallicdisplayproperties[v.id]=v}t.texture2dgroup={};var y=e.querySelectorAll("texture2dgroup");for(n=0;n<y.length;n++){var _=o(y[n]);t.texture2dgroup[_.id]=_}t.object={};var b=e.querySelectorAll("object");for(n=0;n<b.length;n++){var E=d(b[n]);t.object[E.id]=E}return t}(n));var i=e.querySelector("build");return i&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),n=0;n<r.length;n++){var i=r[n],a={objectId:i.getAttribute("objectid")},o=i.getAttribute("transform");o&&(a.transform=h(o)),t.push(a)}return t}(i)),t}function p(e,t,n,i){var a=e.texid,o=n.resources.texture2d[a];if(o){var s=i[o.path],l=o.contenttype,u=new Blob([s],{type:l}),c=URL.createObjectURL(u),h=r.load(c,(function(){URL.revokeObjectURL(c)}));switch(h.encoding=THREE.sRGBEncoding,o.tilestyleu){case"wrap":h.wrapS=THREE.RepeatWrapping;break;case"mirror":h.wrapS=THREE.MirroredRepeatWrapping;break;case"none":case"clamp":h.wrapS=THREE.ClampToEdgeWrapping;break;default:h.wrapS=THREE.RepeatWrapping}switch(o.tilestylev){case"wrap":h.wrapT=THREE.RepeatWrapping;break;case"mirror":h.wrapT=THREE.MirroredRepeatWrapping;break;case"none":case"clamp":h.wrapT=THREE.ClampToEdgeWrapping;break;default:h.wrapT=THREE.RepeatWrapping}switch(o.filter){case"auto":h.magFilter=THREE.LinearFilter,h.minFilter=THREE.LinearMipmapLinearFilter;break;case"linear":h.magFilter=THREE.LinearFilter,h.minFilter=THREE.LinearFilter;break;case"nearest":h.magFilter=THREE.NearestFilter,h.minFilter=THREE.NearestFilter;break;default:h.magFilter=THREE.LinearFilter,h.minFilter=THREE.LinearMipmapLinearFilter}return h}return null}function m(e,t,r,n,i,a){for(var o=a.pindex,s={},l=0,u=t.length;l<u;l++){var c=void 0!==(x=t[l]).p1?x.p1:o;void 0===s[c]&&(s[c]=[]),s[c].push(x)}var h=Object.keys(s),d=[];for(l=0,u=h.length;l<u;l++){for(var f=h[l],p=s[f],m=E(e.basematerials[f],S,r,i,a,w),g=new THREE.BufferGeometry,v=[],y=n.vertices,_=0,b=p.length;_<b;_++){var x=p[_];v.push(y[3*x.v1+0]),v.push(y[3*x.v1+1]),v.push(y[3*x.v1+2]),v.push(y[3*x.v2+0]),v.push(y[3*x.v2+1]),v.push(y[3*x.v2+2]),v.push(y[3*x.v3+0]),v.push(y[3*x.v3+1]),v.push(y[3*x.v3+2])}g.setAttribute("position",new THREE.Float32BufferAttribute(v,3));var T=new THREE.Mesh(g,m);d.push(T)}return d}function g(e,t,r,n,i,a){for(var o=new THREE.BufferGeometry,s=[],l=[],u=n.vertices,c=e.uvs,h=0,d=t.length;h<d;h++){var f=t[h];s.push(u[3*f.v1+0]),s.push(u[3*f.v1+1]),s.push(u[3*f.v1+2]),s.push(u[3*f.v2+0]),s.push(u[3*f.v2+1]),s.push(u[3*f.v2+2]),s.push(u[3*f.v3+0]),s.push(u[3*f.v3+1]),s.push(u[3*f.v3+2]),l.push(c[2*f.p1+0]),l.push(c[2*f.p1+1]),l.push(c[2*f.p2+0]),l.push(c[2*f.p2+1]),l.push(c[2*f.p3+0]),l.push(c[2*f.p3+1])}o.setAttribute("position",new THREE.Float32BufferAttribute(s,3)),o.setAttribute("uv",new THREE.Float32BufferAttribute(l,2));var m=E(e,S,r,i,a,p),g=new THREE.MeshPhongMaterial({map:m,flatShading:!0});return new THREE.Mesh(o,g)}function v(e,t,r,n){for(var i=new THREE.BufferGeometry,a=[],o=[],s=n.vertices,l=e.colors,u=0,c=t.length;u<c;u++){var h=t[u],d=h.v1,f=h.v2,p=h.v3;a.push(s[3*d+0]),a.push(s[3*d+1]),a.push(s[3*d+2]),a.push(s[3*f+0]),a.push(s[3*f+1]),a.push(s[3*f+2]),a.push(s[3*p+0]),a.push(s[3*p+1]),a.push(s[3*p+2]);var m=h.p1,g=h.p2,v=h.p3;o.push(l[3*m+0]),o.push(l[3*m+1]),o.push(l[3*m+2]),o.push(l[3*(g||m)+0]),o.push(l[3*(g||m)+1]),o.push(l[3*(g||m)+2]),o.push(l[3*(v||m)+0]),o.push(l[3*(v||m)+1]),o.push(l[3*(v||m)+2])}i.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),i.setAttribute("color",new THREE.Float32BufferAttribute(o,3));var y=new THREE.MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new THREE.Mesh(i,y)}function y(e){var t=new THREE.BufferGeometry;t.setIndex(new THREE.BufferAttribute(e.triangles,1)),t.setAttribute("position",new THREE.BufferAttribute(e.vertices,3));var r=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});return new THREE.Mesh(t,r)}function _(e,t){return void 0!==t.resources.texture2dgroup[e]?"texture":void 0!==t.resources.basematerials[e]?"material":void 0!==t.resources.colorgroup[e]?"vertexColors":"default"===e?"default":void 0}function b(e,t,r,n,i){for(var a=new THREE.Group,o=function(e,t,r,n,i){for(var a=Object.keys(e),o=[],s=0,l=a.length;s<l;s++){var u=a[s],c=e[u];switch(_(u,t)){case"material":for(var h=m(t.resources.basematerials[u],c,t,r,n,i),d=0,f=h.length;d<f;d++)o.push(h[d]);break;case"texture":var p=t.resources.texture2dgroup[u];o.push(g(p,c,t,r,n,i));break;case"vertexColors":var b=t.resources.colorgroup[u];o.push(v(b,c,0,r));break;case"default":o.push(y(r));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}return o}(function(e,t,r){for(var n={},i=t.triangleProperties,a=r.pid,o=0,s=i.length;o<s;o++){var l=i[o],u=void 0!==l.pid?l.pid:a;void 0===u&&(u="default"),void 0===n[u]&&(n[u]=[]),n[u].push(l)}return n}(0,e,i),r,e,n,i),s=0,l=o.length;s<l;s++)a.add(o[s]);return a}function E(e,t,r,n,i,a){return void 0!==e.build||(e.build=a(e,t,r,n,i)),e.build}function w(e,t,r){var n,i=e.displaypropertiesid,a=r.resources.pbmetallicdisplayproperties;if(null!==i&&void 0!==a[i]){var o=a[i].data[e.index];n=new THREE.MeshStandardMaterial({flatShading:!0,roughness:o.roughness,metalness:o.metallicness})}else n=new THREE.MeshPhongMaterial({flatShading:!0});n.name=e.name;var s=e.displaycolor,l=s.substring(0,7);return n.color.setStyle(l),n.color.convertSRGBToLinear(),9===s.length&&(n.opacity=parseInt(s.charAt(7)+s.charAt(8),16)/255),n}function x(e,t,r,n){for(var i=new THREE.Group,a=0;a<e.length;a++){var o=e[a],s=t[o.objectId];void 0===s&&(T(o.objectId,t,r,n),s=t[o.objectId]);var l=s.clone(),u=o.transform;u&&l.applyMatrix4(u),i.add(l)}return i}function T(e,r,n,i){var a=n.resources.object[e];if(a.mesh){var o=a.mesh;!function(e,r,n){if(e){for(var i=[],a=Object.keys(e),o=0;o<a.length;o++)for(var s=a[o],l=0;l<t.availableExtensions.length;l++){(u=t.availableExtensions[l]).ns===s&&i.push(u)}for(o=0;o<i.length;o++){var u;(u=i[o]).apply(n,e[u.ns],r)}}}(n.extensions,o,n.xml),r[a.id]=E(o,r,n,i,a,b)}else{var s=a.components;r[a.id]=E(s,r,n,i,a,x)}}var M=function(e){var t,r,a,o,s=null,l=null,u=[],c=[],h=[],d=[],p={},m={};try{s=new n(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: jszip missing and file is compressed."),null}for(l in s.files)l.match(/\_rels\/.rels$/)?t=l:l.match(/3D\/_rels\/.*\.model\.rels$/)?r=l:l.match(/^3D\/.*\.model$/)?u.push(l):l.match(/^3D\/Metadata\/.*\.xml$/)?c.push(l):l.match(/^3D\/Textures?\/.*/)?h.push(l):l.match(/^3D\/Other\/.*/)&&d.push(l);var g=new Uint8Array(s.file(t).asArrayBuffer());if(a=i(THREE.LoaderUtils.decodeText(g)),r){g=new Uint8Array(s.file(r).asArrayBuffer());o=i(THREE.LoaderUtils.decodeText(g))}for(var v=0;v<u.length;v++){var y=u[v],_=new Uint8Array(s.file(y).asArrayBuffer()),b=THREE.LoaderUtils.decodeText(_),E=(new DOMParser).parseFromString(b,"application/xml");"model"!==E.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",y);var w=E.querySelector("model"),x={};for(v=0;v<w.attributes.length;v++){var T=w.attributes[v];T.name.match(/^xmlns:(.+)$/)&&(x[T.value]=RegExp.$1)}var M=f(w);M.xml=w,0<Object.keys(x).length&&(M.extensions=x),p[y]=M}for(v=0;v<h.length;v++){var S=h[v];m[S]=s.file(S).asArrayBuffer()}return{rels:a,modelRels:o,model:p,printTicket:{},texture:m,other:{}}}(e),S=function(e){var t=e.model,r=e.modelRels,n={},i=Object.keys(t),a={};if(r)for(var o=0,s=r.length;o<s;o++){var l=r[o],u=l.target.substring(1);e.texture[u]&&(a[l.target]=e.texture[u])}for(o=0;o<i.length;o++)for(var c=t[i[o]],h=Object.keys(c.resources.object),d=0;d<h.length;d++){T(h[d],n,c,a)}return n}(M);return function(e,t){for(var r=new THREE.Group,n=t.rels[0],i=t.model[n.target.substring(1)].build,a=0;a<i.length;a++){var o=i[a],s=e[o.objectId],l=o.transform;l&&s.applyMatrix4(l),r.add(s)}return r}(S,M)},addExtension:function(e){this.availableExtensions.push(e)}}),THREE.ThreeMFLoader.MaterialsAndPropertiesExtension={ns:"http://schemas.microsoft.com/3dmanufacturing/material/2015/02",apply:function(e,t,r){for(var n=e.querySelectorAll("colorgroup"),i=0;i<n.length;i++){var a=n[i];if(a.prefix===t){for(var o=a.getAttribute("id"),s=a.querySelectorAll("color"),l=[],u=0;u<s.length;u++){var c=s[u].getAttribute("color");c.match(/#[0-9a-fA-F]{8}/)?l.push(new THREE.Color(c.substring(0,7))):l.push(new THREE.Color(c))}for(var h=[],d=0;d<r.triangleProperties.length;d++){var f=r.triangleProperties[d];if(f.pid===o){var p=l[f.p1],m=l[f.p2||f.p1],g=l[f.p3||f.p1];h.push(p.r,p.g,p.b),h.push(m.r,m.g,m.b),h.push(g.r,g.g,g.b)}}r.colors=new Float32Array(h.length);for(var v=0;v<h.length;v++)r.colors[v]=h[v]}}}}},function(e,t,r){"use strict";r.r(t);var n=r(4),i=r.n(n);THREE.VRMLLoader=function(){if(void 0===i.a)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function e(e){THREE.Loader.call(this,e)}function t(e){this.lexer=new i.a.Lexer(e)}function r(e){i.a.Parser.call(this,e);var t=this,r=e.Version,n=e.LCurly,a=e.RCurly,o=e.LSquare,s=e.RSquare,l=e.Identifier,u=e.RouteIdentifier,c=e.StringLiteral,h=e.HexLiteral,d=e.NumberLiteral,f=e.TrueLiteral,p=e.FalseLiteral,m=e.NullLiteral,g=e.DEF,v=e.USE,y=e.ROUTE,_=e.TO,b=e.NodeName;t.RULE("vrml",(function(){t.SUBRULE(t.version),t.AT_LEAST_ONE((function(){t.SUBRULE(t.node)})),t.MANY((function(){t.SUBRULE(t.route)}))})),t.RULE("version",(function(){t.CONSUME(r)})),t.RULE("node",(function(){t.OPTION((function(){t.SUBRULE(t.def)})),t.CONSUME(b),t.CONSUME(n),t.MANY((function(){t.SUBRULE(t.field)})),t.CONSUME(a)})),t.RULE("field",(function(){t.CONSUME(l),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])})),t.RULE("def",(function(){t.CONSUME(g),t.CONSUME(l)})),t.RULE("use",(function(){t.CONSUME(v),t.CONSUME(l)})),t.RULE("singleFieldValue",(function(){t.AT_LEAST_ONE((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(f)}},{ALT:function(){t.CONSUME(p)}},{ALT:function(){t.CONSUME(m)}}])}))})),t.RULE("multiFieldValue",(function(){t.CONSUME(o),t.MANY((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(m)}}])})),t.CONSUME(s)})),t.RULE("route",(function(){t.CONSUME(y),t.CONSUME(u),t.CONSUME(_),t.CONSUME2(u)})),this.performSelfAnalysis()}function n(e,t,r){this.a=e,this.b=t,this.c=r,this.normal=new THREE.Vector3}e.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:e,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(e,a))}),r,n)},parse:function(e,o){var s={};function l(e){e.DEF&&(s[e.DEF]=e);for(var t=e.fields,r=0,n=t.length;r<n;r++){var i=t[r];if("node"===i.type)for(var a=i.values,o=0,u=a.length;o<u;o++)l(a[o])}}function u(e){return e.USE?(t=e.USE,(r=u(s[t])).isObject3D||r.isMaterial?r.clone():r):(void 0!==e.build||(e.build=function(e){var t,r=e.name;switch(r){case"Group":case"Transform":t=function(e){for(var t=new THREE.Group,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":break;case"children":d(s,t);break;case"rotation":var l=new THREE.Vector3(s[0],s[1],s[2]),u=s[3];t.quaternion.setFromAxisAngle(l,u);break;case"scale":t.scale.set(s[0],s[1],s[2]);break;case"scaleOrientation":break;case"translation":t.position.set(s[0],s[1],s[2]);break;case"bboxCenter":case"bboxSize":break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"Background":t=function(e){for(var t,r,n,i,a=new THREE.Group,o=e.fields,s=0,l=o.length;s<l;s++){var u=o[s],c=u.name,h=u.values;switch(c){case"groundAngle":t=h;break;case"groundColor":r=h;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":n=h;break;case"skyColor":i=h;break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(i){var d=new THREE.SphereBufferGeometry(1e4,32,16),f=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,depthWrite:!1,depthTest:!1});i.length>3?(C(d,1e4,n,L(i),!0),f.vertexColors=!0):f.color.setRGB(i[0],i[1],i[2]);var p=new THREE.Mesh(d,f);a.add(p)}if(r&&r.length>0){var m=new THREE.SphereBufferGeometry(1e4,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),g=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});C(m,1e4,t,L(r),!1);var v=new THREE.Mesh(m,g);a.add(v)}return a.renderOrder=-1/0,a}(e);break;case"Shape":t=function(e){for(var t,r,n=e.fields,i=new THREE.MeshBasicMaterial({color:0}),a=0,o=n.length;a<o;a++){var s=n[a],l=s.name,c=s.values;switch(l){case"appearance":null!==c[0]&&(i=u(c[0]));break;case"geometry":null!==c[0]&&(t=u(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(t&&t.attributes.position){var h=t._type;if("points"===h){var d=new THREE.PointsMaterial({color:16777215});void 0!==t.attributes.color?d.vertexColors=!0:i.isMeshPhongMaterial&&d.color.copy(i.emissive),r=new THREE.Points(t,d)}else if("line"===h){var f=new THREE.LineBasicMaterial({color:16777215});void 0!==t.attributes.color?f.vertexColors=!0:i.isMeshPhongMaterial&&f.color.copy(i.emissive),r=new THREE.LineSegments(t,f)}else void 0!==t._solid&&(i.side=t._solid?THREE.FrontSide:THREE.DoubleSide),void 0!==t.attributes.color&&(i.vertexColors=!0),r=new THREE.Mesh(t,i)}else(r=new THREE.Object3D).visible=!1;return r}(e);break;case"Appearance":t=function(e){for(var t,r=new THREE.MeshPhongMaterial,n=e.fields,i=0,o=n.length;i<o;i++){var s=n[i],l=s.name,c=s.values;switch(l){case"material":if(null!==c[0]){var h=u(c[0]);h.diffuseColor&&r.color.copy(h.diffuseColor),h.emissiveColor&&r.emissive.copy(h.emissiveColor),h.shininess&&(r.shininess=h.shininess),h.specularColor&&r.specular.copy(h.specularColor),h.transparency&&(r.opacity=1-h.transparency),h.transparency>0&&(r.transparent=!0)}else r=new THREE.MeshBasicMaterial({color:0});break;case"texture":var d=c[0];null!==d&&("ImageTexture"!==d.name&&"PixelTexture"!==d.name||(r.map=u(d)));break;case"textureTransform":null!==c[0]&&(t=u(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(r.map){if(r.map.__type){switch(r.map.__type){case a.INTENSITY_ALPHA:r.opacity=1;break;case a.RGB:r.color.set(16777215);break;case a.RGBA:r.color.set(16777215),r.opacity=1}delete r.map.__type}t&&(r.map.center.copy(t.center),r.map.rotation=t.rotation,r.map.repeat.copy(t.scale),r.map.offset.copy(t.translation))}return r}(e);break;case"Material":t=function(e){for(var t={},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new THREE.Color(s[0],s[1],s[2]);break;case"emissiveColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"shininess":t.shininess=s[0];break;case"specularColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"transparency":t.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"ImageTexture":t=function(e){for(var t,r=THREE.RepeatWrapping,n=THREE.RepeatWrapping,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,u=s.values;switch(l){case"url":var c=u[0];c&&(t=I.load(c));break;case"repeatS":!1===u[0]&&(r=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===u[0]&&(n=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"PixelTexture":t=function(e){for(var t,r=THREE.RepeatWrapping,n=THREE.RepeatWrapping,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,u=s.values;switch(l){case"image":for(var d=u[0],f=u[1],p=u[2],m=2===p||4===p,g=h(p),v=new Uint8Array(d*f*(!0===m?4:3)),y={r:0,g:0,b:0,a:0},_=3,b=0,E=u.length;_<E;_++,b++){var w;if(c(u[_],g,y),!0===m)v[(w=4*b)+0]=y.r,v[w+1]=y.g,v[w+2]=y.b,v[w+3]=y.a;else v[(w=3*b)+0]=y.r,v[w+1]=y.g,v[w+2]=y.b}(t=new THREE.DataTexture(v,d,f,!0===m?THREE.RGBAFormat:THREE.RGBFormat)).__type=g;break;case"repeatS":!1===u[0]&&(r=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===u[0]&&(n=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"TextureTransform":t=function(e){for(var t={center:new THREE.Vector2,rotation:new THREE.Vector2,scale:new THREE.Vector2,translation:new THREE.Vector2},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":t.center.set(s[0],s[1]);break;case"rotation":t.rotation=s[0];break;case"scale":t.scale.set(s[0],s[1]);break;case"translation":t.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"IndexedFaceSet":t=function(e){for(var t,r,i,a,o,s,l,c,h=!0,d=!0,g=0,v=!0,E=!0,w=e.fields,x=0,S=w.length;x<S;x++){var L=w[x],C=L.name,I=L.values;switch(C){case"color":var H=I[0];null!==H&&(t=u(H));break;case"coord":var O=I[0];null!==O&&(r=u(O));break;case"normal":var D=I[0];null!==D&&(i=u(D));break;case"texCoord":var F=I[0];null!==F&&(a=u(F));break;case"ccw":h=I[0];break;case"colorIndex":o=I;break;case"colorPerVertex":v=I[0];break;case"convex":break;case"coordIndex":s=I;break;case"creaseAngle":g=I[0];break;case"normalIndex":l=I;break;case"normalPerVertex":E=I[0];break;case"solid":d=I[0];break;case"texCoordIndex":c=I;break;default:console.warn("THREE.VRMLLoader: Unknown field:",C)}}if(void 0===s)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new THREE.BufferGeometry;var N,U,B,z,j=f(s,h);if(t)if(!0===v)if(o&&o.length>0){var V=f(o,h);U=T(j,V,t,3)}else U=A(j,new THREE.Float32BufferAttribute(t,3));else if(o&&o.length>0){var G=p(m(t,o),s);U=M(j,G)}else{G=p(t,s);U=M(j,G)}if(i)if(!0===E)if(l&&l.length>0){var W=f(l,h);B=T(j,W,i,3)}else B=A(j,new THREE.Float32BufferAttribute(i,3));else if(l&&l.length>0){var X=p(m(i,l),s);B=M(j,X)}else{X=p(i,s);B=M(j,X)}else B=function(e,t,r){for(var i=[],a={},o=0,s=e.length;o<s;o+=3){var l=e[o],u=e[o+1],c=e[o+2],h=new n(l,u,c);y.fromArray(t,3*l),_.fromArray(t,3*u),b.fromArray(t,3*c),k.subVectors(b,_),R.subVectors(y,_),k.cross(R),k.normalize(),h.normal.copy(k),void 0===a[l]&&(a[l]=[]),void 0===a[u]&&(a[u]=[]),void 0===a[c]&&(a[c]=[]),a[l].push(h.normal),a[u].push(h.normal),a[c].push(h.normal),i.push(h)}var d=[];for(o=0,s=i.length;o<s;o++){h=i[o];var f=P(a[h.a],h.normal,r),p=P(a[h.b],h.normal,r),m=P(a[h.c],h.normal,r);y.fromArray(t,3*h.a),_.fromArray(t,3*h.b),b.fromArray(t,3*h.c),d.push(f.x,f.y,f.z),d.push(p.x,p.y,p.z),d.push(m.x,m.y,m.z)}return new THREE.Float32BufferAttribute(d,3)}(j,r,g);if(a)if(c&&c.length>0){var Y=f(c,h);z=T(j,Y,a,2)}else z=A(j,new THREE.Float32BufferAttribute(a,2));var q=new THREE.BufferGeometry;N=A(j,new THREE.Float32BufferAttribute(r,3)),q.setAttribute("position",N),q.setAttribute("normal",B),U&&q.setAttribute("color",U);z&&q.setAttribute("uv",z);return q._solid=d,q._type="mesh",q}(e);break;case"IndexedLineSet":t=function(e){for(var t,r,n,i,a,o=!0,s=e.fields,l=0,c=s.length;l<c;l++){var h=s[l],d=h.name,f=h.values;switch(d){case"color":var p=f[0];null!==p&&(t=u(p));break;case"coord":var y=f[0];null!==y&&(r=u(y));break;case"colorIndex":n=f;break;case"colorPerVertex":o=f[0];break;case"coordIndex":i=f;break;default:console.warn("THREE.VRMLLoader: Unknown field:",d)}}var _=g(i);if(t)if(!0===o)if(n.length>0){var b=g(n);a=T(_,b,t,3)}else a=A(_,new THREE.Float32BufferAttribute(t,3));else if(n.length>0){var E=v(m(t,n),i);a=S(_,E)}else{E=v(t,i);a=S(_,E)}var w=new THREE.BufferGeometry,x=A(_,new THREE.Float32BufferAttribute(r,3));w.setAttribute("position",x),a&&w.setAttribute("color",a);return w._type="line",w}(e);break;case"PointSet":t=function(e){for(var t,r,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,l=o.values;switch(s){case"color":var c=l[0];null!==c&&(t=u(c));break;case"coord":var h=l[0];null!==h&&(r=u(h));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}var d;(d=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute(r,3)),t&&d.setAttribute("color",new THREE.Float32BufferAttribute(t,3));return d._type="points",d}(e);break;case"Box":t=function(e){for(var t=new THREE.Vector3(2,2,2),r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"size":t.x=s[0],t.y=s[1],t.z=s[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.BoxBufferGeometry(t.x,t.y,t.z)}(e);break;case"Cone":t=function(e){for(var t=1,r=2,n=!1,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,u=s.values;switch(l){case"bottom":n=!u[0];break;case"bottomRadius":t=u[0];break;case"height":r=u[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return new THREE.ConeBufferGeometry(t,r,16,1,n)}(e);break;case"Cylinder":t=function(e){for(var t=1,r=2,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,l=o.values;switch(s){case"bottom":break;case"radius":t=l[0];break;case"height":r=l[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new THREE.CylinderBufferGeometry(t,t,r,16,1)}(e);break;case"Sphere":t=function(e){for(var t=1,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"radius":t=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.SphereBufferGeometry(t,16,16)}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":t=function(e){return e.fields[0].values}(e);break;case"Anchor":case"Billboard":case"Collision":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"WorldInfo":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"ElevationGrid":case"Extrusion":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",r)}return t}(e)),e.build);var t,r}function c(e,t,r){switch(t){case a.INTENSITY:var n=parseInt(e);r.r=n,r.g=n,r.b=n;break;case a.INTENSITY_ALPHA:n=parseInt("0x"+e.substring(2,4));r.r=n,r.g=n,r.b=n,r.a=parseInt("0x"+e.substring(4,6));break;case a.RGB:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8));break;case a.RGBA:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8)),r.a=parseInt("0x"+e.substring(8,10))}}function h(e){var t;switch(e){case 1:t=a.INTENSITY;break;case 2:t=a.INTENSITY_ALPHA;break;case 3:t=a.RGB;break;case 4:t=a.RGBA}return t}function d(e,t){for(var r=0,n=e.length;r<n;r++){var i=u(e[r]);i instanceof THREE.Object3D&&t.add(i)}}function f(e,t){for(var r=[],n=0,i=0,a=e.length;i<a;i++){var o=e[n],s=e[i+(t?1:2)],l=e[i+(t?2:1)];r.push(o,s,l),(-1===e[i+3]||i+3>=a)&&(n=(i+=3)+1)}return r}function p(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],u=e[o+2];r.push(s,l,u),(-1===t[i+3]||i+3>=a)&&(i+=3,n++)}return r}function m(e,t){for(var r=[],n=0,i=t.length;n<i;n++){var a=3*t[n],o=e[a],s=e[a+1],l=e[a+2];r.push(o,s,l)}return r}function g(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=e[r+1];t.push(i,a),(-1===e[r+2]||r+2>=n)&&(r+=2)}return t}function v(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],u=e[o+2];r.push(s,l,u),(-1===t[i+2]||i+2>=a)&&(i+=2,n++)}return r}var y=new THREE.Vector3,_=new THREE.Vector3,b=new THREE.Vector3,E=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2;function T(e,t,r,n){for(var i=[],a=0,o=e.length;a<o;a+=3){var s=t[a],l=t[a+1],u=t[a+2];2===n?(E.fromArray(r,s*n),w.fromArray(r,l*n),x.fromArray(r,u*n),i.push(E.x,E.y),i.push(w.x,w.y),i.push(x.x,x.y)):(y.fromArray(r,s*n),_.fromArray(r,l*n),b.fromArray(r,u*n),i.push(y.x,y.y,y.z),i.push(_.x,_.y,_.z),i.push(b.x,b.y,b.z))}return new THREE.Float32BufferAttribute(i,n)}function M(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=3,i++)y.fromArray(t,3*i),r.push(y.x,y.y,y.z),r.push(y.x,y.y,y.z),r.push(y.x,y.y,y.z);return new THREE.Float32BufferAttribute(r,3)}function S(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=2,i++)y.fromArray(t,3*i),r.push(y.x,y.y,y.z),r.push(y.x,y.y,y.z);return new THREE.Float32BufferAttribute(r,3)}function A(e,t){for(var r=t.array,n=t.itemSize,i=new r.constructor(e.length*n),a=0,o=0,s=0,l=e.length;s<l;s++){a=e[s]*n;for(var u=0;u<n;u++)i[o++]=r[a++]}return new THREE.Float32BufferAttribute(i,n)}var R=new THREE.Vector3,k=new THREE.Vector3;function P(e,t,r){var n=new THREE.Vector3;if(0===r)n.copy(t);else for(var i=0,a=e.length;i<a;i++)e[i].angleTo(t)<r&&n.add(e[i]);return n.normalize()}function L(e){for(var t=[],r=0,n=e.length;r<n;r+=3)t.push(new THREE.Color(e[r],e[r+1],e[r+2]));return t}function C(e,t,r,n,i){for(var a=[],o=!0===i?0:Math.PI,s=0,l=n.length;s<l;s++){var u=0===s?0:r[s-1];u=!0===i?u:o-u;var c=new THREE.Vector3;c.setFromSphericalCoords(t,u,0),a.push(c)}var h=e.index,d=e.attributes.position,f=new THREE.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),p=new THREE.Vector3,m=new THREE.Color;for(s=0;s<h.count;s++){var g,v,y=h.getX(s);p.fromBufferAttribute(d,y);for(var _=1,b=1;b<a.length;b++){v=b;var E=a[g=b-1],w=a[v];if(!0===i){if(p.y<=E.y&&p.y>w.y){_=Math.abs(E.y-p.y)/Math.abs(E.y-w.y);break}}else if(p.y>=E.y&&p.y<w.y){_=Math.abs(E.y-p.y)/Math.abs(E.y-w.y);break}}var x=n[g],T=n[v];m.copy(x).lerp(T,_),f.setXYZ(y,m.r,m.g,m.b)}e.setAttribute("color",f)}var I=new THREE.TextureLoader(this.manager);I.setPath(this.resourcePath||o).setCrossOrigin(this.crossOrigin);var H=function(e){var n=function(){for(var e=i.a.createToken,t=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),r=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:t}),n=e({name:"Version",pattern:/#VRML.*/,longer_alt:r}),a=e({name:"NodeName",pattern:new RegExp(["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"].join("|")),longer_alt:r}),o=e({name:"DEF",pattern:/DEF/,longer_alt:r}),s=e({name:"USE",pattern:/USE/,longer_alt:r}),l=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:r}),u=e({name:"TO",pattern:/TO/,longer_alt:r}),c=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/}),h=e({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),d=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),f=e({name:"TrueLiteral",pattern:/TRUE/}),p=e({name:"FalseLiteral",pattern:/FALSE/}),m=e({name:"NullLiteral",pattern:/NULL/}),g=e({name:"LSquare",pattern:/\[/}),v=e({name:"RSquare",pattern:/]/}),y=e({name:"LCurly",pattern:/{/}),_=e({name:"RCurly",pattern:/}/}),b=e({name:"Comment",pattern:/#.*/,group:i.a.Lexer.SKIPPED}),E=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:i.a.Lexer.SKIPPED}),a,o,s,l,u,f,p,m,n,r,t,c,h,d,g,v,y,_,b],w={},x=0,T=E.length;x<T;x++){var M=E[x];w[M.name]=M}return{tokens:E,tokenVocabulary:w}}(),a=new t(n.tokens),o=new r(n.tokenVocabulary),s=function(e){function t(){e.call(this),this.validateVisitor()}function r(e,t){var r={type:null,values:[]};if(t.node){r.type="node";for(var n=0,i=t.node.length;n<i;n++){var a=t.node[n];r.values.push(e.visit(a))}}if(t.use){r.type="use";for(n=0,i=t.use.length;n<i;n++){var o=t.use[n];r.values.push(e.visit(o))}}if(t.StringLiteral){r.type="string";for(n=0,i=t.StringLiteral.length;n<i;n++){var s=t.StringLiteral[n];r.values.push(s.image.replace(/'|"/g,""))}}if(t.NumberLiteral){r.type="number";for(n=0,i=t.NumberLiteral.length;n<i;n++){var l=t.NumberLiteral[n];r.values.push(parseFloat(l.image))}}if(t.HexLiteral){r.type="hex";for(n=0,i=t.HexLiteral.length;n<i;n++){var u=t.HexLiteral[n];r.values.push(u.image)}}if(t.TrueLiteral){r.type="boolean";for(n=0,i=t.TrueLiteral.length;n<i;n++){"TRUE"===t.TrueLiteral[n].image&&r.values.push(!0)}}if(t.FalseLiteral){r.type="boolean";for(n=0,i=t.FalseLiteral.length;n<i;n++){"FALSE"===t.FalseLiteral[n].image&&r.values.push(!1)}}return t.NullLiteral&&(r.type="null",t.NullLiteral.forEach((function(){r.values.push(null)}))),r}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){for(var t={version:this.visit(e.version),nodes:[],routes:[]},r=0,n=e.node.length;r<n;r++){var i=e.node[r];t.nodes.push(this.visit(i))}if(e.route)for(r=0,n=e.route.length;r<n;r++){var a=e.route[r];t.routes.push(this.visit(a))}return t},version:function(e){return e.Version[0].image},node:function(e){var t={name:e.NodeName[0].image,fields:[]};if(e.field)for(var r=0,n=e.field.length;r<n;r++){var i=e.field[r];t.fields.push(this.visit(i))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){var t,r={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(t=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(t=this.visit(e.multiFieldValue[0])),r.type=t.type,r.values=t.values,r},def:function(e){return e.Identifier[0].image},use:function(e){return{USE:e.Identifier[0].image}},singleFieldValue:function(e){return r(this,e)},multiFieldValue:function(e){return r(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(o.getBaseCstVisitorConstructor()),l=a.lex(e);o.input=l.tokens;var u=o.vrml();if(o.errors.length>0)throw console.error(o.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return s.visit(u)}(e);if(-1===H.version.indexOf("V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){for(var t=e.nodes,r=new THREE.Scene,n=0,i=t.length;n<i;n++){l(t[n])}for(n=0,i=t.length;n<i;n++){var a=u(t[n]);a instanceof THREE.Object3D&&r.add(a)}return r}(H)}}),t.prototype={constructor:t,lex:function(e){var t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}},r.prototype=Object.create(i.a.Parser.prototype),r.prototype.constructor=r;var a={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};return e}()},function(e,t,r){"use strict";r.r(t);var n=r(11);THREE.FBXLoader=function(){var e,t,r;function i(e){THREE.Loader.call(this,e)}function a(e,t){this.textureLoader=e,this.manager=t}function o(){}function s(){}function l(){}function u(){}function c(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function d(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}i.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:i,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.load(e,(function(r){try{t(i.parse(r,a))}catch(t){setTimeout((function(){n&&n(t),i.manager.itemError(e)}),0)}}),r,n)},parse:function(t,r){if(o="Kaydara FBX Binary  \0",(i=t).byteLength>=o.length&&o===E(i,0,o.length))e=(new u).parse(t);else{var n=E(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(var n=0;n<t.length;++n){if((a=void 0,a=e[(i=1)-1],e=e.slice(r+i),r++,a)===t[n])return!1}var i,a;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(d(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(n));e=(new l).parse(n)}var i,o;return new a(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),a.prototype={constructor:a,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),i=this.parseMaterials(n),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,i),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).parents.push(a),t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).children.push(o)}));return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var a=n[i];if(t[u=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(o||s){var l=this.parseImage(n[i]);r[a.RelativeFilename||a.Filename]=l}}}}for(var u in t){var c=t[u];void 0!==r[c]?t[u]=r[c]:t[u]=t[u].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var a=new Uint8Array(r);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var i in n){var a=this.parseTexture(n[i],t);r.set(parseInt(i),a)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,i=e.WrapModeV,a=void 0!==n?n.value:0,o=void 0!==i?i.value:0;if(r.wrapS=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.wrapT=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;r.repeat.x=s[0],r.repeat.y=s[1]}return r},loadTexture:function(e,r){var n,i,a=this.textureLoader.path,o=t.get(e.id).children;void 0!==o&&o.length>0&&void 0!==r[o[0].ID]&&(0!==(n=r[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=this.manager.getHandler(".tga");null===l?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new THREE.Texture):i=l.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new THREE.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(a),i},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var a=this.parseMaterial(n[i],t);null!==a&&r.set(parseInt(i),a)}}return r},parseMaterial:function(e,r){var n=e.id,i=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!t.has(n))return null;var o,s=this.parseParameters(e,r,n);switch(a.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new THREE.MeshPhongMaterial}return o.setValues(s),o.name=i,o},parseParameters:function(e,r,n){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var a=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=a.getTexture(r,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(r,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(r,e.ID),i.map.encoding=THREE.sRGBEncoding;break;case"DisplacementColor":i.displacementMap=a.getTexture(r,e.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(r,e.ID),i.emissiveMap.encoding=THREE.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(r,e.ID);break;case"ReflectionColor":i.envMap=a.getTexture(r,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping,i.envMap.encoding=THREE.sRGBEncoding;break;case"SpecularColor":i.specularMap=a.getTexture(r,e.ID),i.specularMap.encoding=THREE.sRGBEncoding;break;case"TransparentColor":i.alphaMap=a.getTexture(r,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),i},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var l=this.parseSkeleton(s,i);l.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,r[a]=l}else if("BlendShape"===o.attrType){var u={id:a};u.rawTargets=this.parseMorphTargets(s,i),u.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[a]=u}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}})),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var a=e.children[i],o=r[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(s)}return n},parseScene:function(n,i,a){r=new THREE.Group;var o=this.parseModels(n.skeletons,i,a),l=e.Objects.Model,u=this;o.forEach((function(e){var n=l[e.ID];u.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var r=o.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&r.add(e)})),this.bindSkeleton(n.skeletons,i,o),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=y(e.userData.transformData);e.applyMatrix4(t)}}));var c=(new s).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=c,r=r.children[0]),r.animations=c},parseModels:function(r,n,i){var a=new Map,o=e.Objects.Model;for(var s in o){var l=parseInt(s),u=o[s],c=t.get(l),h=this.buildSkeleton(c,r,l,u.attrName);if(!h){switch(u.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,n,i);break;case"NurbsCurve":h=this.createCurve(c,n);break;case"LimbNode":case"Root":h=new THREE.Bone;break;case"Null":default:h=new THREE.Group}h.name=u.attrName?THREE.PropertyBinding.sanitizeNodeName(u.attrName):"",h.ID=l}this.getTransformData(h,u),a.set(l,h)}return a},buildSkeleton:function(e,t,r,n){var i=null;return e.parents.forEach((function(e){for(var a in t){var o=t[a];o.rawBones.forEach((function(t,a){if(t.ID===e.ID){var s=i;(i=new THREE.Bone).matrixWorld.copy(t.transformLink),i.name=n?THREE.PropertyBinding.sanitizeNodeName(n):"",i.ID=r,o.bones[a]=i,null!==s&&i.add(s)}}))}})),i},createCamera:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new THREE.Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var u=s/l,c=45;void 0!==n.FieldOfView&&(c=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new THREE.PerspectiveCamera(c,u,a,o),null!==h&&r.setFocalLength(h);break;case 1:r=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),r=new THREE.Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new THREE.Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new THREE.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(i){case 0:r=new THREE.PointLight(a,o,s,1);break;case 1:r=new THREE.DirectionalLight(a,o);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.MathUtils.degToRad(n.InnerAngle.value));var u=0;void 0!==n.OuterAngle&&(u=THREE.MathUtils.degToRad(n.OuterAngle.value),u=Math.max(u,1)),r=new THREE.SpotLight(a,o,s,l,u,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),r=new THREE.PointLight(a,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,i=null,a=null,o=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))})),o.length>1?a=o:o.length>0?a=o[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(o.forEach((function(e){e.skinning=!0})),(n=new THREE.SkinnedMesh(i,a)).normalizeSkinWeights()):n=new THREE.Mesh(i,a),n},createCurve:function(e,t){var r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(r,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?_(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,i){"LookAtProperty"in i&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var a=i.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(a),r.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(a))}}}))},bindSkeleton:function(e,r,n){var i=this.parsePoseNodes();for(var a in e){var o=e[a];t.get(parseInt(o.ID)).parents.forEach((function(e){if(r.has(e.ID)){var a=e.ID;t.get(a).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)})):t[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],i=t[1],a=t[2];if(0!==n||0!==i||0!==a){var o=new THREE.Color(n,i,a);r.add(new THREE.AmbientLight(o,1))}}},setupMorphMaterials:function(){var e=this;r.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,n){e.setupMorphMaterial(t,r,n)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,n){var i=e.uuid,a=t.uuid,o=!1;if(r.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===a&&e.uuid!==i&&(o=!0)})):e.material.uuid===a&&e.uuid!==i&&(o=!0))})),!0===o){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=this.parseGeometry(o,i[a],r);n.set(parseInt(a),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var i=n.skeletons,a=[],o=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==o.length){var s=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);t.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&a.push(n.morphTargets[e.ID])}));var l=o[0],u={};"RotationOrder"in l&&(u.eulerOrder=_(l.RotationOrder.value)),"InheritType"in l&&(u.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(u.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(u.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(u.scale=l.GeometricScaling.value);var c=y(u);return this.genGeometry(r,s,a,c)}},genGeometry:function(e,t,r,n){var i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new THREE.Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(n),i.setAttribute("position",s),o.colors.length>0&&i.setAttribute("color",new THREE.Float32BufferAttribute(o.colors,3)),t&&(i.setAttribute("skinIndex",new THREE.Uint16BufferAttribute(o.weightsIndices,4)),i.setAttribute("skinWeight",new THREE.Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){var l=(new THREE.Matrix3).getNormalMatrix(n),u=new THREE.Float32BufferAttribute(o.normal,3);u.applyNormalMatrix(l),i.setAttribute("normal",u)}if(o.uvs.forEach((function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),i.setAttribute(r,new THREE.Float32BufferAttribute(o.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){var c=o.materialIndex[0],h=0;if(o.materialIndex.forEach((function(e,t){e!==c&&(i.addGroup(h,t-h,c),c=e,h=t)})),i.groups.length>0){var d=i.groups[i.groups.length-1],f=d.start+d.count;f!==o.materialIndex.length&&i.addGroup(f,o.materialIndex.length-f,c)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,r,n),i},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})}))}))),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,a=[],o=[],s=[],l=[],u=[],c=[],h=this;return e.vertexIndices.forEach((function(d,f){var p=!1;d<0&&(d^=-1,p=!0);var g=[],v=[];if(a.push(3*d,3*d+1,3*d+2),e.color){var y=m(f,r,d,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var _=[0,0,0,0],b=[0,0,0,0];v.forEach((function(e,t){var r=e,n=g[t];b.forEach((function(e,t,i){if(r>e){i[t]=r,r=e;var a=_[t];_[t]=n,n=a}}))})),g=_,v=b}for(;v.length<4;)v.push(0),g.push(0);for(var E=0;E<4;++E)u.push(v[E]),c.push(g[E])}if(e.normal){y=m(f,r,d,e.normal);o.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var w=m(f,r,d,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var n=m(f,r,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,p&&(h.genFace(t,e,a,w,o,s,l,u,c,n),r++,n=0,a=[],o=[],s=[],l=[],u=[],c=[])})),t},genFace:function(e,t,r,n,i,a,o,s,l,u){for(var c=2;c<u;c++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(c-1)]]),e.vertex.push(t.vertexPositions[r[3*(c-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(c-1)+2]]),e.vertex.push(t.vertexPositions[r[3*c]]),e.vertex.push(t.vertexPositions[r[3*c+1]]),e.vertex.push(t.vertexPositions[r[3*c+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(c-1)]),e.vertexWeights.push(s[4*(c-1)+1]),e.vertexWeights.push(s[4*(c-1)+2]),e.vertexWeights.push(s[4*(c-1)+3]),e.vertexWeights.push(s[4*c]),e.vertexWeights.push(s[4*c+1]),e.vertexWeights.push(s[4*c+2]),e.vertexWeights.push(s[4*c+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(c-1)]),e.weightsIndices.push(l[4*(c-1)+1]),e.weightsIndices.push(l[4*(c-1)+2]),e.weightsIndices.push(l[4*(c-1)+3]),e.weightsIndices.push(l[4*c]),e.weightsIndices.push(l[4*c+1]),e.weightsIndices.push(l[4*c+2]),e.weightsIndices.push(l[4*c+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(c-1)]),e.colors.push(a[3*(c-1)+1]),e.colors.push(a[3*(c-1)+2]),e.colors.push(a[3*c]),e.colors.push(a[3*c+1]),e.colors.push(a[3*c+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(c-1)]),e.normal.push(i[3*(c-1)+1]),e.normal.push(i[3*(c-1)+2]),e.normal.push(i[3*c]),e.normal.push(i[3*c+1]),e.normal.push(i[3*c+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(c-1)]),e.uvs[r].push(o[r][2*(c-1)+1]),e.uvs[r].push(o[r][2*c]),e.uvs[r].push(o[r][2*c+1])}))},addMorphTargets:function(t,r,n,i){if(0!==n.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var a=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var o=e.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(t,r,o,i,n.name)}))}))}},genMorphGeometry:function(e,t,r,n,i){for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==r.Vertices?r.Vertices.a:[],s=void 0!==r.Indexes?r.Indexes.a:[],l=3*e.attributes.position.count,u=new Float32Array(l),c=0;c<s.length;c++){var h=3*s[c];u[h]=o[3*c],u[h+1]=o[3*c+1],u[h+2]=o[3*c+2]}var d={vertexIndices:a,vertexPositions:u},f=this.genBuffers(d),p=new THREE.Float32BufferAttribute(f.vertex,3);p.name=i||r.attrName,p.applyMatrix4(n),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],a=0;a<n.length;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var r,n,i=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,l=0,u=s.length;l<u;l+=4)o.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){r=i,n=a.length-1-r;for(l=0;l<i;++l)o.push(o[l])}var c=new THREE.NURBSCurve(i,a,o,r,n).getPoints(7*o.length),h=new Float32Array(3*c.length);c.forEach((function(e,t){e.toArray(h,3*t)}));var d=new THREE.BufferGeometry;return d.setAttribute("position",new THREE.BufferAttribute(h,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var n=t[r],i=this.addClip(n);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};r.set(a.id,a)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var i in n){var a={id:n[i].id,times:n[i].KeyTime.a.map(f),values:n[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?r.get(s).curves.x=a:l.match(/Y/)?r.get(s).curves.y=a:l.match(/Z/)?r.get(s).curves.z=a:l.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=a)}}},parseAnimationLayers:function(n){var i=e.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],l=t.get(parseInt(o));if(void 0!==l)l.children.forEach((function(i,a){if(n.has(i.ID)){var o=n.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a])if(void 0!==(f=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){var l={modelName:(u=e.Objects.Model[f.toString()]).attrName?THREE.PropertyBinding.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse((function(e){e.ID===u.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new THREE.Matrix4),"PreRotation"in u&&(l.preRotation=u.PreRotation.value),"PostRotation"in u&&(l.postRotation=u.PostRotation.value),s[a]=l}s[a]&&(s[a][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===s[a]){var u,c=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,h=t.get(c).parents[0].ID,d=t.get(h).parents[0].ID,f=t.get(d).parents[0].ID;l={modelName:(u=e.Objects.Model[f]).attrName?THREE.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:e.Objects.Deformer[c].attrName};s[a]=l}s[a][o.attr]=o}}})),a.set(parseInt(o),s)}return a},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,i={};for(var a in n){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);i[a]={name:n[a].attrName,layer:s}}return i},addClip:function(e){var t=[],r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(r,n,i),r=r.toArray(),n=(new THREE.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,r,n){var i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,r);return new THREE.VectorKeyframeTrack(e+"."+n,i,a)},generateRotationTrack:function(e,t,r,n,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.MathUtils.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,r);void 0!==n&&((n=n.map(THREE.MathUtils.degToRad)).push(a),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(THREE.MathUtils.degToRad)).push(a),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).inverse());for(var l=new THREE.Quaternion,u=new THREE.Euler,c=[],h=0;h<s.length;h+=3)u.set(s[h],s[h+1],s[h+2],a),l.setFromEuler(u),void 0!==n&&l.premultiply(n),void 0!==i&&l.multiply(i),l.toArray(c,h/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,c)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})).filter((function(e,t,r){return r.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,r){var n=r,i=[],a=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var r=t.x.values[a];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==o){var l=t.y.values[o];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==s){var u=t.z.values[s];i.push(u),n[2]=u}else i.push(n[2])})),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){for(var a=i/180,o=n/a,s=r+o,l=e.times[t-1],u=(e.times[t]-l)/a,c=l+u,h=[],d=[];c<e.times[t];)h.push(c),c+=u,d.push(s),s+=o;e.times=w(e.times,t,h),e.values=w(e.values,t,d)}}}},l.prototype={constructor:l,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in o?("PoseNode"===r?o.PoseNode.push(i):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=i)):"number"==typeof a.id?(o[r]={},o[r][a.id]=i):"Properties70"!==r&&(o[r]="PoseNode"===r?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){var o=i.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),u=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[s,l],u=u.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=i),n in a&&Array.isArray(a[n])?a[n].push(i):"a"!==n?a[n]=i:a.a=i,this.setCurrentProp(a,n),"a"===n&&","!==i.slice(-1)&&(a.a=b(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=n[0],a=n[1],o=n[2],s=n[3],l=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},u.prototype={constructor:u,parse:function(e){var t=new c(e);t.skip(23);var r=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var n=new h;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),a=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(a);if(0===n)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,r,d)}return r.propertyList=s,"number"==typeof u&&(r.id=u),""!==c&&(r.attrName=c),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){var a,o=r.propertyList[0],s=r.propertyList[1],l=r.propertyList[2],u=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[o]={type:s,type2:l,flag:u,value:a}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}void 0===n.Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new c(new n.Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var p=[];function m(e,t,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var a=i*n.dataSize,o=a+n.dataSize;return function(e,t,r,n){for(var i=r,a=0;i<n;i++,a++)e[a]=t[i];return e}(p,n.buffer,a,o)}var g=new THREE.Euler,v=new THREE.Vector3;function y(e){var t,r=new THREE.Matrix4,n=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,u=new THREE.Matrix4,c=new THREE.Matrix4,h=new THREE.Matrix4,d=new THREE.Matrix4,f=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(v.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(g.fromArray(t)));e.rotation&&((t=e.rotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(g.fromArray(t)));e.postRotation&&((t=e.postRotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(g.fromArray(t)));e.scale&&o.scale(v.fromArray(e.scale)),e.scalingOffset&&l.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var p=n.multiply(i).multiply(a),m=new THREE.Matrix4;h.extractRotation(m);var y,_,b,E,w=new THREE.Matrix4;if(w.copyPosition(h),b=w.getInverse(w).multiply(h),_=m.getInverse(m).multiply(b),y=o,0===f)E=m.multiply(p).multiply(_).multiply(y);else if(1===f)E=m.multiply(_).multiply(p).multiply(y);else{var x=(new THREE.Matrix4).copy(o),T=_.multiply(x.getInverse(x));E=m.multiply(p).multiply(T).multiply(y)}var M=r.multiply(u).multiply(c).multiply(n).multiply(i).multiply(a).multiply(c.getInverse(c)).multiply(l).multiply(s).multiply(o).multiply(s.getInverse(s)),S=(new THREE.Matrix4).copyPosition(M),A=h.multiply(S);return d.copyPosition(A),M=d.multiply(E)}function _(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function E(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function w(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return i}()},function(e,t,r){"use strict";r.r(t);var n=r(61);THREE.NRRDLoader=function(e){THREE.Loader.call(this,e)},THREE.NRRDLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.NRRDLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:function(e){var t=e,r=0,i=new Int8Array(new Int16Array([1]).buffer)[0]>0,a={};var o=function(e,n){null==n&&(n=1);var a=1,o=Uint8Array;switch(e){case"uchar":break;case"schar":o=Int8Array;break;case"ushort":o=Uint16Array,a=2;break;case"sshort":o=Int16Array,a=2;break;case"uint":o=Uint32Array,a=4;break;case"sint":o=Int32Array,a=4;break;case"float":o=Float32Array,a=4;break;case"complex":case"double":o=Float64Array,a=8}var s=new o(t.slice(r,r+=n*a));return 1!=i&&(s=function(e,t){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=0;n<e.byteLength;n+=t)for(var i=n+t-1,a=n;i>a;i--,a++){var o=r[a];r[a]=r[i],r[i]=o}return e}(s,a)),1==n?s[0]:s}("uchar",e.byteLength),s=o.length,l=null,u=0;for(d=1;d<s;d++)if(10==o[d-1]&&10==o[d]){l=this.parseChars(o,0,d-2),u=d+1;break}!function(e){var t,r,n,i,o,s,l,u,c;for(u=0,c=(s=e.split(/\r?\n/)).length;u<c;u++)(o=s[u]).match(/NRRD\d+/)?a.isNrrd=!0:o.match(/^#/)||(l=o.match(/(.*):(.*)/))&&(r=l[1].trim(),t=l[2].trim(),(n=THREE.NRRDLoader.prototype.fieldFunctions[r])?n.call(a,t):a[r]=t);if(!a.isNrrd)throw new Error("Not an NRRD file");if("bz2"===a.encoding||"bzip2"===a.encoding)throw new Error("Bzip is not supported");if(!a.vectors&&(a.vectors=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],a.spacings))for(i=0;i<=2;i++)isNaN(a.spacings[i])||a.vectors[i].multiplyScalar(a.spacings[i])}(l);t=o.subarray(u);if("gzip"===a.encoding||"gz"===a.encoding){var c=new n.Zlib.Gunzip(new Uint8Array(t));t=c.decompress()}else if("ascii"===a.encoding||"text"===a.encoding||"txt"===a.encoding||"hex"===a.encoding)t=function(e,t,r){var n,i="";t=t||0,r=r||e.length;var o=a.sizes.reduce((function(e,t){return e*t}),1),s=10;"hex"===a.encoding&&(s=16);var l=new a.__array(o),u=0,c=parseInt;a.__array!==Float32Array&&a.__array!==Float64Array||(c=parseFloat);for(var h=t;h<r;h++)((n=e[h])<9||n>13)&&32!==n?i+=String.fromCharCode(n):(""!==i&&(l[u]=c(i,s),u++),i="");return""!==i&&(l[u]=c(i,s),u++),l}(t);else if("raw"===a.encoding){for(var h=new Uint8Array(t.length),d=0;d<t.length;d++)h[d]=t[d];t=h}t=t.buffer;var f=new THREE.Volume;f.header=a,f.data=new a.__array(t);var p=f.computeMinMax(),m=p[0],g=p[1];f.windowLow=m,f.windowHigh=g,f.dimensions=[a.sizes[0],a.sizes[1],a.sizes[2]],f.xLength=f.dimensions[0],f.yLength=f.dimensions[1],f.zLength=f.dimensions[2];var v=new THREE.Vector3(a.vectors[0][0],a.vectors[0][1],a.vectors[0][2]).length(),y=new THREE.Vector3(a.vectors[1][0],a.vectors[1][1],a.vectors[1][2]).length(),_=new THREE.Vector3(a.vectors[2][0],a.vectors[2][1],a.vectors[2][2]).length();f.spacing=[v,y,_],f.matrix=new THREE.Matrix4;var b=1,E=1;if("left-posterior-superior"==a.space?(b=-1,E=-1):"left-anterior-superior"===a.space&&(b=-1),a.vectors){var w=a.vectors;f.matrix.set(b*w[0][0],b*w[1][0],b*w[2][0],0,E*w[0][1],E*w[1][1],E*w[2][1],0,1*w[0][2],1*w[1][2],1*w[2][2],0,0,0,0,1)}else f.matrix.set(b,0,0,0,0,E,0,0,0,0,1,0,0,0,0,1);return f.inverseMatrix=new THREE.Matrix4,f.inverseMatrix.getInverse(f.matrix),f.RASDimensions=new THREE.Vector3(f.xLength,f.yLength,f.zLength).applyMatrix4(f.matrix).round().toArray().map(Math.abs),f.lowerThreshold===-1/0&&(f.lowerThreshold=m),f.upperThreshold===1/0&&(f.upperThreshold=g),f},parseChars:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var n="",i=0;for(i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n},fieldFunctions:{type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){var t;return this.sizes=function(){var r,n,i,a;for(a=[],r=0,n=(i=e.split(/\s+/)).length;r<n;r++)t=i[r],a.push(parseInt(t,10));return a}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,r,n;return r=e.match(/\(.*?\)/g),this.vectors=function(){var e,i,a;for(a=[],e=0,i=r.length;e<i;e++)n=r[e],a.push(function(){var e,r,i,a;for(a=[],e=0,r=(i=n.slice(1,-1).split(/,/)).length;e<r;e++)t=i[e],a.push(parseFloat(t));return a}());return a}()},spacings:function(e){var t,r;return r=e.split(/\s+/),this.spacings=function(){var e,n,i=[];for(e=0,n=r.length;e<n;e++)t=r[e],i.push(parseFloat(t));return i}()}}})},function(e,t,r){"use strict";r.r(t);var n=r(3);THREE.KMZLoader=function(e){THREE.Loader.call(this,e)},THREE.KMZLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.KMZLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:function(e){var t=new THREE.LoadingManager;t.setURLModifier((function(e){var t=function(e){for(var t in r.files)if(t.substr(-e.length)===e)return r.files[t]}(e);if(t){console.log("Loading",e);var n=new Blob([t.asArrayBuffer()],{type:"application/octet-stream"});return URL.createObjectURL(n)}return e}));var r=new n(e);if(r.files["doc.kml"]){var i=(new DOMParser).parseFromString(r.files["doc.kml"].asText(),"application/xml").querySelector("Placemark Model Link href");if(i)return new THREE.ColladaLoader(t).parse(r.files[i.textContent].asText())}else for(var a in console.warn("KMZLoader: Missing doc.kml file."),r.files){if("dae"===a.split(".").pop().toLowerCase())return new THREE.ColladaLoader(t).parse(r.files[a].asText())}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new THREE.Group}}})},function(e,t){var r;THREE.MD2Loader=function(e){THREE.Loader.call(this,e)},THREE.MD2Loader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.MD2Loader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:(r=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]],function(e){for(var t=new DataView(e),n={},i=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],a=0;a<i.length;a++)n[i[a]]=t.getInt32(4*a,!0);if(844121161===n.ident&&8===n.version){if(n.offset_end===t.byteLength){for(var o=new THREE.BufferGeometry,s=[],l=n.offset_st,u=(a=0,n.num_st);a<u;a++){var c=t.getInt16(l+0,!0),h=t.getInt16(l+2,!0);s.push(c/n.skinwidth,1-h/n.skinheight),l+=4}l=n.offset_tris;var d=[],f=[];for(a=0,u=n.num_tris;a<u;a++)d.push(t.getUint16(l+0,!0),t.getUint16(l+2,!0),t.getUint16(l+4,!0)),f.push(t.getUint16(l+6,!0),t.getUint16(l+8,!0),t.getUint16(l+10,!0)),l+=12;var p=new THREE.Vector3,m=new THREE.Vector3,g=[],v=[];for(l=n.offset_frames,a=0,u=n.num_frames;a<u;a++){m.set(t.getFloat32(l+0,!0),t.getFloat32(l+4,!0),t.getFloat32(l+8,!0)),p.set(t.getFloat32(l+12,!0),t.getFloat32(l+16,!0),t.getFloat32(l+20,!0)),l+=24;for(var y=0;y<16;y++){var _=t.getUint8(l+y,!0);if(0===_)break;g[y]=_}var b={name:String.fromCharCode.apply(null,g),vertices:[],normals:[]};for(l+=16,y=0;y<n.num_vertices;y++){var E=t.getUint8(l++,!0),w=t.getUint8(l++,!0),x=t.getUint8(l++,!0),T=r[t.getUint8(l++,!0)];E=E*m.x+p.x,w=w*m.y+p.y,x=x*m.z+p.z,b.vertices.push(E,x,w),b.normals.push(T[0],T[2],T[1])}v.push(b)}var M=[],S=[],A=[],R=v[0].vertices,k=v[0].normals;for(a=0,u=d.length;a<u;a++){E=R[F=3*d[a]],w=R[F+1],x=R[F+2],M.push(E,w,x);var P=k[F],L=k[F+1],C=k[F+2];S.push(P,L,C),c=s[F=2*f[a]],h=s[F+1],A.push(c,h)}o.setAttribute("position",new THREE.Float32BufferAttribute(M,3)),o.setAttribute("normal",new THREE.Float32BufferAttribute(S,3)),o.setAttribute("uv",new THREE.Float32BufferAttribute(A,2));var I=[],H=[];for(a=0,u=v.length;a<u;a++){var O=(b=v[a]).name;if(b.vertices.length>0){M=[],y=0;for(var D=d.length;y<D;y++){var F=3*d[y];E=b.vertices[F],w=b.vertices[F+1],x=b.vertices[F+2],M.push(E,w,x)}var N=new THREE.Float32BufferAttribute(M,3);N.name=O,I.push(N)}if(b.normals.length>0){for(S=[],y=0,D=d.length;y<D;y++)F=3*d[y],P=b.normals[F],L=b.normals[F+1],C=b.normals[F+2],S.push(P,L,C);var U=new THREE.Float32BufferAttribute(S,3);U.name=O,H.push(U)}}return o.morphAttributes.position=I,o.morphAttributes.normal=H,o.morphTargetsRelative=!1,o.animations=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(v,10),o}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")})})},function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y;THREE.SVGLoader=function(e){THREE.Loader.call(this,e),this.defaultDPI=90,this.defaultUnit="px"},THREE.SVGLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.SVGLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:function(e){var t=this;function r(e,t,r,i,a,o,s,l){i=i*Math.PI/180,t=Math.abs(t),r=Math.abs(r);var u=(s.x-l.x)/2,c=(s.y-l.y)/2,h=Math.cos(i)*u+Math.sin(i)*c,d=-Math.sin(i)*u+Math.cos(i)*c,f=t*t,p=r*r,m=h*h,g=d*d,v=m/f+g/p;if(v>1){var y=Math.sqrt(v);f=(t*=y)*t,p=(r*=y)*r}var _=f*g+p*m,b=(f*p-_)/_,E=Math.sqrt(Math.max(0,b));a===o&&(E=-E);var w=E*t*d/r,x=-E*r*h/t,T=Math.cos(i)*w-Math.sin(i)*x+(s.x+l.x)/2,M=Math.sin(i)*w+Math.cos(i)*x+(s.y+l.y)/2,S=n(1,0,(h-w)/t,(d-x)/r),A=n((h-w)/t,(d-x)/r,(-h-w)/t,(-d-x)/r)%(2*Math.PI);e.currentPath.absellipse(T,M,t,r,S,S+A,0===o,i)}function n(e,t,r,n){var i=e*r+t*n,a=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n),o=Math.acos(Math.max(-1,Math.min(1,i/a)));return e*n-t*r<0&&(o=-o),o}function i(e,t){function r(r,n,i){void 0===i&&(i=function(e){return e}),e.hasAttribute(r)&&(t[n]=i(e.getAttribute(r))),e.style&&""!==e.style[r]&&(t[n]=i(e.style[r]))}function n(e){return Math.max(0,Math.min(1,u(e)))}function i(e){return Math.max(0,u(e))}return t=Object.assign({},t),r("fill","fill"),r("fill-opacity","fillOpacity",n),r("stroke","stroke"),r("stroke-opacity","strokeOpacity",n),r("stroke-width","strokeWidth",i),r("stroke-linejoin","strokeLineJoin"),r("stroke-linecap","strokeLineCap"),r("stroke-miterlimit","strokeMiterLimit",i),t}function a(e,t){return e-(t-e)}function o(e){for(var t=e.split(/[\s,]+|(?=\s?[+\-])/),r=0;r<t.length;r++){var n=t[r];if(n.indexOf(".")!==n.lastIndexOf("."))for(var i=n.split("."),a=2;a<i.length;a++)t.splice(r+a-1,0,"0."+i[a]);t[r]=u(n)}return t}var s=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function u(e){var r="px";if("string"==typeof e||e instanceof String)for(var n=0,i=s.length;n<i;n++){var a=s[n];if(e.endsWith(a)){r=a,e=e.substring(0,e.length-a.length);break}}var o=void 0;return"px"===r&&"px"!==t.defaultUnit?o=l.in[t.defaultUnit]/t.defaultDPI:(o=l[r][t.defaultUnit])<0&&(o=l[r].in*t.defaultDPI),o*parseFloat(e)}function c(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var d=[],f=[],p=new THREE.Matrix3,m=new THREE.Matrix3,g=new THREE.Matrix3,v=new THREE.Matrix3,y=new THREE.Vector2,_=new THREE.Vector3,b=new THREE.Matrix3,E=(new DOMParser).parseFromString(e,"image/svg+xml");return function e(t,n){if(1===t.nodeType){var s=function(e){if(!e.hasAttribute("transform"))return null;var t=function(e){for(var t=new THREE.Matrix3,r=p,n=e.getAttribute("transform").split(")"),i=n.length-1;i>=0;i--){var a=n[i].trim();if(""!==a){var s=a.indexOf("("),l=a.length;if(s>0&&s<l){var u=a.substr(0,s),c=o(a.substr(s+1,l-s-1));switch(r.identity(),u){case"translate":if(c.length>=1){var h=c[0],d=h;c.length>=2&&(d=c[1]),r.translate(h,d)}break;case"rotate":if(c.length>=1){var f,y=0,_=0;f=-c[0]*Math.PI/180,c.length>=3&&(y=c[1],_=c[2]),m.identity().translate(-y,-_),g.identity().rotate(f),v.multiplyMatrices(g,m),m.identity().translate(y,_),r.multiplyMatrices(m,v)}break;case"scale":if(c.length>=1){var b=c[0],E=b;c.length>=2&&(E=c[1]),r.scale(b,E)}break;case"skewX":1===c.length&&r.set(1,Math.tan(c[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===c.length&&r.set(1,0,0,Math.tan(c[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===c.length&&r.set(c[0],c[2],c[4],c[1],c[3],c[5],0,0,1)}}t.premultiply(r)}}return t}(e);f.length>0&&t.premultiply(f[f.length-1]);return b.copy(t),f.push(t),t}(t),l=null;switch(t.nodeName){case"svg":break;case"g":n=i(t,n);break;case"path":n=i(t,n),t.hasAttribute("d")&&(l=function(e){for(var t=new THREE.ShapePath,n=new THREE.Vector2,i=new THREE.Vector2,s=new THREE.Vector2,l=!0,u=!1,c=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),h=0,d=c.length;h<d;h++){var f=c[h],p=f.charAt(0),m=f.substr(1).trim();switch(!0===l&&(u=!0,l=!1),p){case"M":for(var g=o(m),v=0,y=g.length;v<y;v+=2)n.x=g[v+0],n.y=g[v+1],i.x=n.x,i.y=n.y,0===v?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"H":for(g=o(m),v=0,y=g.length;v<y;v++)n.x=g[v],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"V":for(g=o(m),v=0,y=g.length;v<y;v++)n.y=g[v],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"L":for(g=o(m),v=0,y=g.length;v<y;v+=2)n.x=g[v+0],n.y=g[v+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"C":for(g=o(m),v=0,y=g.length;v<y;v+=6)t.bezierCurveTo(g[v+0],g[v+1],g[v+2],g[v+3],g[v+4],g[v+5]),i.x=g[v+2],i.y=g[v+3],n.x=g[v+4],n.y=g[v+5],0===v&&!0===u&&s.copy(n);break;case"S":for(g=o(m),v=0,y=g.length;v<y;v+=4)t.bezierCurveTo(a(n.x,i.x),a(n.y,i.y),g[v+0],g[v+1],g[v+2],g[v+3]),i.x=g[v+0],i.y=g[v+1],n.x=g[v+2],n.y=g[v+3],0===v&&!0===u&&s.copy(n);break;case"Q":for(g=o(m),v=0,y=g.length;v<y;v+=4)t.quadraticCurveTo(g[v+0],g[v+1],g[v+2],g[v+3]),i.x=g[v+0],i.y=g[v+1],n.x=g[v+2],n.y=g[v+3],0===v&&!0===u&&s.copy(n);break;case"T":for(g=o(m),v=0,y=g.length;v<y;v+=2){var _=a(n.x,i.x),b=a(n.y,i.y);t.quadraticCurveTo(_,b,g[v+0],g[v+1]),i.x=_,i.y=b,n.x=g[v+0],n.y=g[v+1],0===v&&!0===u&&s.copy(n)}break;case"A":for(g=o(m),v=0,y=g.length;v<y;v+=7){var E=n.clone();n.x=g[v+5],n.y=g[v+6],i.x=n.x,i.y=n.y,r(t,g[v],g[v+1],g[v+2],g[v+3],g[v+4],E,n),0===v&&!0===u&&s.copy(n)}break;case"m":for(g=o(m),v=0,y=g.length;v<y;v+=2)n.x+=g[v+0],n.y+=g[v+1],i.x=n.x,i.y=n.y,0===v?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"h":for(g=o(m),v=0,y=g.length;v<y;v++)n.x+=g[v],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"v":for(g=o(m),v=0,y=g.length;v<y;v++)n.y+=g[v],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"l":for(g=o(m),v=0,y=g.length;v<y;v+=2)n.x+=g[v+0],n.y+=g[v+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===v&&!0===u&&s.copy(n);break;case"c":for(g=o(m),v=0,y=g.length;v<y;v+=6)t.bezierCurveTo(n.x+g[v+0],n.y+g[v+1],n.x+g[v+2],n.y+g[v+3],n.x+g[v+4],n.y+g[v+5]),i.x=n.x+g[v+2],i.y=n.y+g[v+3],n.x+=g[v+4],n.y+=g[v+5],0===v&&!0===u&&s.copy(n);break;case"s":for(g=o(m),v=0,y=g.length;v<y;v+=4)t.bezierCurveTo(a(n.x,i.x),a(n.y,i.y),n.x+g[v+0],n.y+g[v+1],n.x+g[v+2],n.y+g[v+3]),i.x=n.x+g[v+0],i.y=n.y+g[v+1],n.x+=g[v+2],n.y+=g[v+3],0===v&&!0===u&&s.copy(n);break;case"q":for(g=o(m),v=0,y=g.length;v<y;v+=4)t.quadraticCurveTo(n.x+g[v+0],n.y+g[v+1],n.x+g[v+2],n.y+g[v+3]),i.x=n.x+g[v+0],i.y=n.y+g[v+1],n.x+=g[v+2],n.y+=g[v+3],0===v&&!0===u&&s.copy(n);break;case"t":for(g=o(m),v=0,y=g.length;v<y;v+=2){_=a(n.x,i.x),b=a(n.y,i.y);t.quadraticCurveTo(_,b,n.x+g[v+0],n.y+g[v+1]),i.x=_,i.y=b,n.x=n.x+g[v+0],n.y=n.y+g[v+1],0===v&&!0===u&&s.copy(n)}break;case"a":for(g=o(m),v=0,y=g.length;v<y;v+=7){E=n.clone();n.x+=g[v+5],n.y+=g[v+6],i.x=n.x,i.y=n.y,r(t,g[v],g[v+1],g[v+2],g[v+3],g[v+4],E,n),0===v&&!0===u&&s.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(s),t.currentPath.currentPoint.copy(n),l=!0);break;default:console.warn(f)}u=!1}return t}(t));break;case"rect":n=i(t,n),l=function(e){var t=u(e.getAttribute("x")||0),r=u(e.getAttribute("y")||0),n=u(e.getAttribute("rx")||0),i=u(e.getAttribute("ry")||0),a=u(e.getAttribute("width")),o=u(e.getAttribute("height")),s=new THREE.ShapePath;s.moveTo(t+2*n,r),s.lineTo(t+a-2*n,r),(0!==n||0!==i)&&s.bezierCurveTo(t+a,r,t+a,r,t+a,r+2*i);s.lineTo(t+a,r+o-2*i),(0!==n||0!==i)&&s.bezierCurveTo(t+a,r+o,t+a,r+o,t+a-2*n,r+o);s.lineTo(t+2*n,r+o),(0!==n||0!==i)&&s.bezierCurveTo(t,r+o,t,r+o,t,r+o-2*i);s.lineTo(t,r+2*i),(0!==n||0!==i)&&s.bezierCurveTo(t,r,t,r,t+2*n,r);return s}(t);break;case"polygon":n=i(t,n),l=function(e){function t(e,t,i){var a=u(t),o=u(i);0===n?r.moveTo(a,o):r.lineTo(a,o),n++}var r=new THREE.ShapePath,n=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,t),r.currentPath.autoClose=!0,r}(t);break;case"polyline":n=i(t,n),l=function(e){function t(e,t,i){var a=u(t),o=u(i);0===n?r.moveTo(a,o):r.lineTo(a,o),n++}var r=new THREE.ShapePath,n=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,t),r.currentPath.autoClose=!1,r}(t);break;case"circle":n=i(t,n),l=function(e){var t=u(e.getAttribute("cx")),r=u(e.getAttribute("cy")),n=u(e.getAttribute("r")),i=new THREE.Path;i.absarc(t,r,n,0,2*Math.PI);var a=new THREE.ShapePath;return a.subPaths.push(i),a}(t);break;case"ellipse":n=i(t,n),l=function(e){var t=u(e.getAttribute("cx")),r=u(e.getAttribute("cy")),n=u(e.getAttribute("rx")),i=u(e.getAttribute("ry")),a=new THREE.Path;a.absellipse(t,r,n,i,0,2*Math.PI);var o=new THREE.ShapePath;return o.subPaths.push(a),o}(t);break;case"line":n=i(t,n),l=function(e){var t=u(e.getAttribute("x1")),r=u(e.getAttribute("y1")),n=u(e.getAttribute("x2")),i=u(e.getAttribute("y2")),a=new THREE.ShapePath;return a.moveTo(t,r),a.lineTo(n,i),a.currentPath.autoClose=!1,a}(t);break;default:console.log(t)}l&&(void 0!==n.fill&&"none"!==n.fill&&l.color.setStyle(n.fill),function(e,t){function r(e){_.set(e.x,e.y,1).applyMatrix3(t),e.set(_.x,_.y)}for(var n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths,a=0,o=i.length;a<o;a++)for(var s=i[a].curves,l=0;l<s.length;l++){var u=s[l];u.isLineCurve?(r(u.v1),r(u.v2)):u.isCubicBezierCurve?(r(u.v0),r(u.v1),r(u.v2),r(u.v3)):u.isQuadraticBezierCurve?(r(u.v0),r(u.v1),r(u.v2)):u.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),y.set(u.aX,u.aY),r(y),u.aX=y.x,u.aY=y.y,u.xRadius*=c(t),u.yRadius*=h(t))}}(l,b),d.push(l),l.userData={node:t,style:n});for(var E=t.childNodes,w=0;w<E.length;w++)e(E[w],n);s&&(f.pop(),f.length>0?b.copy(f[f.length-1]):b.identity())}}(E.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:d,xml:E.documentElement}}}),THREE.SVGLoader.getStrokeStyle=function(e,t,r,n,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:i=void 0!==i?i:4}},THREE.SVGLoader.pointsToStroke=function(e,t,r,n){var i=[],a=[],o=[];if(0===THREE.SVGLoader.pointsToStrokeWithBuffers(e,t,r,n,i,a,o))return null;var s=new THREE.BufferGeometry;return s.setAttribute("position",new THREE.Float32BufferAttribute(i,3)),s.setAttribute("normal",new THREE.Float32BufferAttribute(a,3)),s.setAttribute("uv",new THREE.Float32BufferAttribute(o,2)),s},THREE.SVGLoader.pointsToStrokeWithBuffers=(r=new THREE.Vector2,n=new THREE.Vector2,i=new THREE.Vector2,a=new THREE.Vector2,o=new THREE.Vector2,s=new THREE.Vector2,l=new THREE.Vector2,u=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,d=new THREE.Vector2,f=new THREE.Vector2,p=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,function(e,t,_,b,E,w,x,T){_=void 0!==_?_:12,b=void 0!==b?b:.001,T=void 0!==T?T:0;var M=(e=function(e){for(var t=!1,r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<b){t=!0;break}if(!t)return e;var i=[];for(i.push(e[0]),r=1,n=e.length-1;r<n;r++)e[r].distanceTo(e[r+1])>=b&&i.push(e[r]);return i.push(e[e.length-1]),i}(e)).length;if(M<2)return 0;var S,A,R,k,P,L=e[0].equals(e[M-1]),C=e[0],I=t.strokeWidth/2,H=1/(M-1),O=0,D=!1,F=0,N=3*T,U=2*T;Q(e[0],e[1],r).multiplyScalar(I),u.copy(e[0]).sub(r),c.copy(e[0]).add(r),h.copy(u),d.copy(c);for(var B=1;B<M;B++){S=e[B],A=B===M-1?L?e[1]:void 0:e[B+1];var z=r;Q(C,S,z),i.copy(z).multiplyScalar(I),f.copy(S).sub(i),p.copy(S).add(i);var j=O+H;if(R=!1,void 0!==A){Q(S,A,n),i.copy(n).multiplyScalar(I),m.copy(S).sub(i),g.copy(S).add(i),k=!0,i.subVectors(A,C),z.dot(i)<0&&(k=!1),1===B&&(D=k),i.subVectors(A,S),i.normalize();var V=Math.abs(z.dot(i));if(0!==V){var G=I/V;i.multiplyScalar(-G),a.subVectors(S,C),o.copy(a).setLength(G).add(i),v.copy(o).negate();var W=o.length(),X=a.length();a.divideScalar(X),s.subVectors(A,S);var Y=s.length();switch(s.divideScalar(Y),a.dot(v)<X&&s.dot(v)<Y&&(R=!0),y.copy(o).add(S),v.add(S),P=!1,R?k?(g.copy(v),p.copy(v)):(m.copy(v),f.copy(v)):ee(),t.strokeLineJoin){case"bevel":te(k,R,j);break;case"round":re(k,R),k?$(S,f,m,j,0):$(S,g,p,j,1);break;case"miter":case"miter-clip":default:var q=I*t.strokeMiterLimit/W;if(q<1){if("miter-clip"!==t.strokeLineJoin){te(k,R,j);break}re(k,R),k?(s.subVectors(y,f).multiplyScalar(q).add(f),l.subVectors(y,m).multiplyScalar(q).add(m),J(f,j,0),J(s,j,0),J(S,j,.5),J(S,j,.5),J(s,j,0),J(l,j,0),J(S,j,.5),J(l,j,0),J(m,j,0)):(s.subVectors(y,p).multiplyScalar(q).add(p),l.subVectors(y,g).multiplyScalar(q).add(g),J(p,j,1),J(s,j,1),J(S,j,.5),J(S,j,.5),J(s,j,1),J(l,j,1),J(S,j,.5),J(l,j,1),J(g,j,1))}else R?(k?(J(c,O,1),J(u,O,0),J(y,j,0),J(c,O,1),J(y,j,0),J(v,j,1)):(J(c,O,1),J(u,O,0),J(y,j,1),J(u,O,0),J(v,j,0),J(y,j,1)),k?m.copy(y):g.copy(y)):k?(J(f,j,0),J(y,j,0),J(S,j,.5),J(S,j,.5),J(y,j,0),J(m,j,0)):(J(p,j,1),J(y,j,1),J(S,j,.5),J(S,j,.5),J(y,j,1),J(g,j,1)),P=!0}}else ee()}else ee();L||B!==M-1||ne(e[0],h,d,k,!0,O),O=j,C=S,u.copy(m),c.copy(g)}if(L){if(R&&E){var Z=y,K=v;D!==k&&(Z=v,K=y),k?(P||D)&&(K.toArray(E,0),K.toArray(E,9),P&&Z.toArray(E,3)):!P&&D||(K.toArray(E,3),K.toArray(E,9),P&&Z.toArray(E,0))}}else ne(S,f,p,k,!1,j);return F;function Q(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function J(e,t,r){E&&(E[N]=e.x,E[N+1]=e.y,E[N+2]=0,w&&(w[N]=0,w[N+1]=0,w[N+2]=1),N+=3,x&&(x[U]=t,x[U+1]=r,U+=2)),F+=3}function $(e,t,o,s,l){r.copy(t).sub(e).normalize(),n.copy(o).sub(e).normalize();var u=Math.PI,c=r.dot(n);Math.abs(c)<1&&(u=Math.abs(Math.acos(c))),u/=_,i.copy(t);for(var h=0,d=_-1;h<d;h++)a.copy(i).rotateAround(e,u),J(i,s,l),J(a,s,l),J(e,s,.5),i.copy(a);J(a,s,l),J(o,s,l),J(e,s,.5)}function ee(){J(c,O,1),J(u,O,0),J(f,j,0),J(c,O,1),J(f,j,1),J(p,j,0)}function te(e,t,r){t?e?(J(c,O,1),J(u,O,0),J(f,j,0),J(c,O,1),J(f,j,0),J(v,j,1),J(f,r,0),J(m,r,0),J(v,r,.5)):(J(c,O,1),J(u,O,0),J(p,j,1),J(u,O,0),J(v,j,0),J(p,j,1),J(p,r,1),J(g,r,0),J(v,r,.5)):e?(J(f,r,0),J(m,r,0),J(S,r,.5)):(J(p,r,1),J(g,r,0),J(S,r,.5))}function re(e,t){t&&(e?(J(c,O,1),J(u,O,0),J(f,j,0),J(c,O,1),J(f,j,0),J(v,j,1),J(f,O,0),J(S,j,.5),J(v,j,1),J(S,j,.5),J(m,O,0),J(v,j,1)):(J(c,O,1),J(u,O,0),J(p,j,1),J(u,O,0),J(v,j,0),J(p,j,1),J(p,O,1),J(v,j,0),J(S,j,.5),J(S,j,.5),J(v,j,0),J(g,O,1)))}function ne(e,o,s,l,u,c){switch(t.strokeLineCap){case"round":u?$(e,s,o,c,.5):$(e,o,s,c,.5);break;case"square":if(u)r.subVectors(o,e),n.set(r.y,-r.x),i.addVectors(r,n).add(e),a.subVectors(n,r).add(e),l?(i.toArray(E,3),a.toArray(E,0),a.toArray(E,9)):(i.toArray(E,3),i.toArray(E,9),a.toArray(E,0));else{r.subVectors(s,e),n.set(r.y,-r.x),i.addVectors(r,n).add(e),a.subVectors(n,r).add(e);var h=E.length;l?(i.toArray(E,h-3),a.toArray(E,h-6),a.toArray(E,h-12)):(i.toArray(E,h-6),a.toArray(E,h-3),a.toArray(E,h-12))}}}})},function(e,t){THREE.TDSLoader=function(e){THREE.Loader.call(this,e),this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]},THREE.TDSLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.TDSLoader,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,(function(e){t(i.parse(e,a))}),r,n)},parse:function(e,t){this.group=new THREE.Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(var r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group},readFile:function(e,t){var o=new DataView(e),s=this.readChunk(o);if(s.id===n||s.id===i||s.id===r)for(var l=this.nextChunk(o,s);0!==l;){if(l===a){var u=this.readDWord(o);this.debugMessage("3DS file version: "+u)}else l===c?(this.resetPosition(o),this.readMeshData(o,t)):this.debugMessage("Unknown main chunk: "+l.toString(16));l=this.nextChunk(o,s)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(e,t){for(var r=this.readChunk(e),n=this.nextChunk(e,r);0!==n;){if(n===h){var i=+this.readDWord(e);this.debugMessage("Mesh Version: "+i)}else if(n===d){var a=this.readFloat(e);this.debugMessage("Master scale: "+a),this.group.scale.set(a,a,a)}else n===I?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):n===f?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+n.toString(16));n=this.nextChunk(e,r)}},readNamedObject:function(e){var t=this.readChunk(e),r=this.readString(e,64);t.cur=this.position;for(var n=this.nextChunk(e,t);0!==n;){if(n===H){this.resetPosition(e);var i=this.readMesh(e);i.name=r,this.meshes.push(i)}else this.debugMessage("Unknown named object chunk: "+n.toString(16));n=this.nextChunk(e,t)}this.endChunk(t)},readMaterialEntry:function(e,t){for(var r=this.readChunk(e),n=this.nextChunk(e,r),i=new THREE.MeshPhongMaterial;0!==n;){if(n===p)i.name=this.readString(e,64),this.debugMessage("   Name: "+i.name);else if(n===w)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(n===x){var a=this.readByte(e);i.wireframeLinewidth=a,this.debugMessage("   Wireframe Thickness: "+a)}else if(n===b)i.side=THREE.DoubleSide,this.debugMessage("   DoubleSided");else if(n===E)this.debugMessage("   Additive Blending"),i.blending=THREE.AdditiveBlending;else if(n===g)this.debugMessage("   Diffuse Color"),i.color=this.readColor(e);else if(n===v)this.debugMessage("   Specular Color"),i.specular=this.readColor(e);else if(n===m)this.debugMessage("   Ambient color"),i.color=this.readColor(e);else if(n===y){var o=this.readWord(e);i.shininess=o,this.debugMessage("   Shininess : "+o)}else if(n===_){var s=this.readWord(e);i.opacity=.01*s,this.debugMessage("  Opacity : "+s),i.transparent=s<100}else n===T?(this.debugMessage("   ColorMap"),this.resetPosition(e),i.map=this.readMap(e,t)):n===S?(this.debugMessage("   BumpMap"),this.resetPosition(e),i.bumpMap=this.readMap(e,t)):n===M?(this.debugMessage("   OpacityMap"),this.resetPosition(e),i.alphaMap=this.readMap(e,t)):n===A?(this.debugMessage("   SpecularMap"),this.resetPosition(e),i.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+n.toString(16));n=this.nextChunk(e,r)}this.endChunk(r),this.materials[i.name]=i},readMesh:function(e){var t=this.readChunk(e),r=this.nextChunk(e,t),n=new THREE.BufferGeometry,i=[],a=new THREE.MeshPhongMaterial,o=new THREE.Mesh(n,a);for(o.name="mesh";0!==r;){if(r===O){var s=this.readWord(e);this.debugMessage("   Vertex: "+s);for(var l=[],u=0;u<s;u++)l.push(this.readFloat(e)),l.push(this.readFloat(e)),l.push(this.readFloat(e));n.setAttribute("position",new THREE.Float32BufferAttribute(l,3))}else if(r===D)this.resetPosition(e),this.readFaceArray(e,o);else if(r===N){var c=this.readWord(e);this.debugMessage("   UV: "+c);for(i=[],u=0;u<c;u++)i.push(this.readFloat(e)),i.push(this.readFloat(e));n.setAttribute("uv",new THREE.Float32BufferAttribute(i,2))}else if(r===U){this.debugMessage("   Tranformation Matrix (TODO)");var h=[];for(u=0;u<12;u++)h[u]=this.readFloat(e);var d=new THREE.Matrix4;d.elements[0]=h[0],d.elements[1]=h[6],d.elements[2]=h[3],d.elements[3]=h[9],d.elements[4]=h[2],d.elements[5]=h[8],d.elements[6]=h[5],d.elements[7]=h[11],d.elements[8]=h[1],d.elements[9]=h[7],d.elements[10]=h[4],d.elements[11]=h[10],d.elements[12]=0,d.elements[13]=0,d.elements[14]=0,d.elements[15]=1,d.transpose();var f=new THREE.Matrix4;f.getInverse(d,!0),n.applyMatrix4(f),d.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(e,t)}return this.endChunk(t),n.computeVertexNormals(),o},readFaceArray:function(e,t){var r=this.readChunk(e),n=this.readWord(e);this.debugMessage("   Faces: "+n);for(var i=[],a=0;a<n;++a)i.push(this.readWord(e),this.readWord(e),this.readWord(e)),this.readWord(e);for(t.geometry.setIndex(i);this.position<r.end;){if((r=this.readChunk(e)).id===F){this.debugMessage("      Material Group"),this.resetPosition(e);var o=this.readMaterialGroup(e),s=this.materials[o.name];void 0!==s&&(t.material=s,""===s.name&&(s.name=t.name))}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}this.endChunk(r)},readMap:function(e,t){var r=this.readChunk(e),n=this.nextChunk(e,r),i={},a=new THREE.TextureLoader(this.manager);for(a.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);0!==n;){if(n===R){var o=this.readString(e,128);i=a.load(o),this.debugMessage("      File: "+t+o)}else n===L?(i.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+i.offset.x)):n===C?(i.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+i.offset.y)):n===k?(i.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+i.repeat.x)):n===P?(i.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.toString(16));n=this.nextChunk(e,r)}return this.endChunk(r),i},readMaterialGroup:function(e){this.readChunk(e);var t=this.readString(e,64),r=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);for(var n=[],i=0;i<r;++i)n.push(this.readWord(e));return{name:t,index:n}},readColor:function(e){var t=this.readChunk(e),r=new THREE.Color;if(t.id===s||t.id===l){var n=this.readByte(e),i=this.readByte(e),a=this.readByte(e);r.setRGB(n/255,i/255,a/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===o||t.id===u){n=this.readFloat(e),i=this.readFloat(e),a=this.readFloat(e);r.setRGB(n,i,a),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),r},readChunk:function(e){var t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t},endChunk:function(e){this.position=e.end},nextChunk:function(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{var r=this.readChunk(e);return t.cur+=r.size,r.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(e){var t=e.getUint8(this.position,!0);return this.position+=1,t},readFloat:function(e){try{var t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}},readInt:function(e){var t=e.getInt32(this.position,!0);return this.position+=4,t},readShort:function(e){var t=e.getInt16(this.position,!0);return this.position+=2,t},readDWord:function(e){var t=e.getUint32(this.position,!0);return this.position+=4,t},readWord:function(e){var t=e.getUint16(this.position,!0);return this.position+=2,t},readString:function(e,t){for(var r="",n=0;n<t;n++){var i=this.readByte(e);if(!i)break;r+=String.fromCharCode(i)}return r},debugMessage:function(e){this.debug&&console.log(e)}});var r=19789,n=15786,i=49725,a=2,o=16,s=17,l=18,u=19,c=15677,h=15678,d=256,f=45055,p=40960,m=40976,g=40992,v=41008,y=41024,_=41040,b=41089,E=41091,w=41093,x=41095,T=41472,M=41488,S=41520,A=41476,R=41728,k=41812,P=41814,L=41816,C=41818,I=16384,H=16640,O=16656,D=16672,F=16688,N=16704,U=16736},function(e,t,r){"use strict";r.r(t);var n=r(11);THREE.VTKLoader=function(e){THREE.Loader.call(this,e)},THREE.VTKLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.VTKLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){t(i.parse(e))}),r,n)},parse:function(e){function t(e,t){var r=e.length,n=new Int32Array(r+t.length);return n.set(e),n.set(t,r),n}function r(e){for(var t="",r=new Uint8Array(e),n=0,i=r.length;i--;)t+=String.fromCharCode(r[n++]);return t}var i=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==i[0].indexOf("xml")?function(e){function r(e){var t,r,n,i,a,o,s="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],u=[],c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=c.length;for(t=0;t<h;t++)l[t]=c[t];for(t=0;t<h;++t)u[c.charCodeAt(t)]=t;if(u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63,(h=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=new s(3*h/4-(a="="===e[h-2]?2:"="===e[h-1]?1:0)),n=a>0?h-4:h;var d=0;for(t=0,r=0;t<n;t+=4,r+=3)i=u[e.charCodeAt(t)]<<18|u[e.charCodeAt(t+1)]<<12|u[e.charCodeAt(t+2)]<<6|u[e.charCodeAt(t+3)],o[d++]=(16711680&i)>>16,o[d++]=(65280&i)>>8,o[d++]=255&i;return 2===a?(i=u[e.charCodeAt(t)]<<2|u[e.charCodeAt(t+1)]>>4,o[d++]=255&i):1===a&&(i=u[e.charCodeAt(t)]<<10|u[e.charCodeAt(t+1)]<<4|u[e.charCodeAt(t+2)]>>2,o[d++]=i>>8&255,o[d++]=255&i),o}function i(e,i){var a,s,l,u,c=0;if("UInt64"===o.attributes.header_type?c=8:"UInt32"===o.attributes.header_type&&(c=4),"binary"===e.attributes.format&&i){var h,d,f,p,m,g;if("Float32"===e.attributes.type)var v=new Float32Array;else if("Int64"===e.attributes.type)v=new Int32Array;d=(h=r(e["#text"]))[0];for(var y=1;y<c-1;y++)d|=h[y]<<y*c;p=(d+3)*c,g=p+=p%3>0?3-p%3:0,(m=[]).push(g),f=3*c;for(y=0;y<d;y++){for(var _=h[y*c+f],b=1;b<c-1;b++)_|=h[y*c+f+b]<<8*b;g+=_,m.push(g)}for(y=0;y<m.length-1;y++){E=(E=new n.Zlib.Inflate(h.slice(m[y],m[y+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===e.attributes.type?(E=new Float32Array(E),s=E,l=void 0,u=void 0,l=(a=v).length,(u=new Float32Array(l+s.length)).set(a),u.set(s,l),v=u):"Int64"===e.attributes.type&&(v=t(v,E=new Int32Array(E)))}delete e["#text"],"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(v=v.filter((function(e,t){if(t%2!=1)return!0})))}else{if("binary"!==e.attributes.format||i)if(e["#text"])var E=e["#text"].split(/\s+/).filter((function(e){if(""!==e)return e}));else E=new Int32Array(0).buffer;else E=(E=r(e["#text"])).slice(c).buffer;if(delete e["#text"],"Float32"===e.attributes.type)v=new Float32Array(E);else if("Int32"===e.attributes.type)v=new Int32Array(E);else if("Int64"===e.attributes.type){v=new Int32Array(E);"binary"===e.attributes.format&&(v=v.filter((function(e,t){if(t%2!=1)return!0})))}}return v}var a=null;if(window.DOMParser)try{a=(new DOMParser).parseFromString(e,"text/xml")}catch(e){a=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((a=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!a.loadXML())throw new Error(a.parseError.reason+a.parseError.srcText)}catch(e){a=null}}var o=function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r.attributes={};for(var n=0;n<t.attributes.length;n++){var i=t.attributes.item(n);r.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++){var o=t.childNodes.item(a),s=o.nodeName;if(void 0===r[s]){""!==(u=e(o))&&(r[s]=u)}else{if(void 0===r[s].push){var l=r[s];r[s]=[l]}var u;""!==(u=e(o))&&r[s].push(u)}}return r}(a.documentElement),s=[],l=[],u=[];if(o.PolyData){for(var c=o.PolyData.Piece,h=o.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],f=0,p=d.length;f<p;){var m=c[d[f]];if(m&&m.DataArray){if("[object Array]"===Object.prototype.toString.call(m.DataArray))var g=m.DataArray;else g=[m.DataArray];for(var v=0,y=g.length;v<y;)"#text"in g[v]&&g[v]["#text"].length>0&&(g[v].text=i(g[v],h)),v++;switch(d[f]){case"PointData":var _=parseInt(c.attributes.NumberOfPoints),b=m.attributes.Normals;if(_>0)for(var E=0,w=g.length;E<w;E++)if(b===g[E].attributes.Name){var x=g[E].attributes.NumberOfComponents;(l=new Float32Array(_*x)).set(g[E].text,0)}break;case"Points":if((_=parseInt(c.attributes.NumberOfPoints))>0){x=m.DataArray.attributes.NumberOfComponents;(s=new Float32Array(_*x)).set(m.DataArray.text,0)}break;case"Strips":var T=parseInt(c.attributes.NumberOfStrips);if(T>0){var M=new Int32Array(m.DataArray[0].text.length),S=new Int32Array(m.DataArray[1].text.length);M.set(m.DataArray[0].text,0),S.set(m.DataArray[1].text,0);var A=T+M.length;u=new Uint32Array(3*A-9*T);var R=0;for(E=0,w=T;E<w;E++){for(var k=[],P=0,L=S[E],C=0;P<L-C;P++)k.push(M[P]),E>0&&(C=S[E-1]);var I=0;for(L=S[E],C=0;I<L-C-2;I++)I%2?(u[R++]=k[I],u[R++]=k[I+2],u[R++]=k[I+1]):(u[R++]=k[I],u[R++]=k[I+1],u[R++]=k[I+2]),E>0&&(C=S[E-1])}}break;case"Polys":var H=parseInt(c.attributes.NumberOfPolys);if(H>0){M=new Int32Array(m.DataArray[0].text.length),S=new Int32Array(m.DataArray[1].text.length);M.set(m.DataArray[0].text,0),S.set(m.DataArray[1].text,0);A=H+M.length;u=new Uint32Array(3*A-9*H);R=0;var O=0;for(E=0,w=H,C=0;E<w;){var D=[];for(P=0,L=S[E];P<L-C;)D.push(M[O++]),P++;for(I=1;I<L-C-1;)u[R++]=D[0],u[R++]=D[I],u[R++]=D[I+1],I++;C=S[++E-1]}}}}f++}var F=new THREE.BufferGeometry;return F.setIndex(new THREE.BufferAttribute(u,1)),F.setAttribute("position",new THREE.BufferAttribute(s,3)),l.length===s.length&&F.setAttribute("normal",new THREE.BufferAttribute(l,3)),F}throw new Error("Unsupported DATASET type")}(r(e)):i[2].includes("ASCII")?function(e){for(var t,r=[],n=[],i=[],a=[],o=/^[^\d.\s-]+/,s=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,c=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,f=/^CELL_DATA[ ]+(\d+)/,p=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,g=!1,v=!1,y=!1,_=!1,b=!1,E=!1,w=!1,x=e.split("\n"),T=0,M=x.length;T<M;T++){var S=x[T].trim();if(0===S.indexOf("DATASET")){var A=S.split(" ")[1];if("POLYDATA"!==A)throw new Error("Unsupported DATASET type: "+A)}else if(g)for(;null!==(t=s.exec(S))&&null===o.exec(S);){var R=parseFloat(t[1]),k=parseFloat(t[2]),P=parseFloat(t[3]);n.push(R,k,P)}else if(v){if(null!==(t=l.exec(S))){var L=parseInt(t[1]),C=t[2].split(/\s+/);if(L>=3)for(var I=parseInt(C[0]),H=1,O=0;O<L-2;++O)D=parseInt(C[H]),F=parseInt(C[H+1]),r.push(I,D,F),H++}}else if(y){if(null!==(t=l.exec(S))){L=parseInt(t[1]),C=t[2].split(/\s+/);if(L>=3){var D,F;for(O=0;O<L-2;O++)O%2==1?(I=parseInt(C[O]),D=parseInt(C[O+2]),F=parseInt(C[O+1]),r.push(I,D,F)):(I=parseInt(C[O]),D=parseInt(C[O+1]),F=parseInt(C[O+2]),r.push(I,D,F))}}}else if(_||b)if(E)for(;null!==(t=s.exec(S))&&null===o.exec(S);){var N=parseFloat(t[1]),U=parseFloat(t[2]),B=parseFloat(t[3]);i.push(N,U,B)}else if(w)for(;null!==(t=s.exec(S))&&null===o.exec(S);){var z=parseFloat(t[1]),j=parseFloat(t[2]),V=parseFloat(t[3]);a.push(z,j,V)}null!==c.exec(S)?(v=!0,g=!1,y=!1):null!==u.exec(S)?(v=!1,g=!0,y=!1):null!==h.exec(S)?(v=!1,g=!1,y=!0):null!==d.exec(S)?(_=!0,g=!1,v=!1,y=!1):null!==f.exec(S)?(b=!0,g=!1,v=!1,y=!1):null!==p.exec(S)?(E=!0,w=!1,g=!1,v=!1,y=!1):null!==m.exec(S)&&(w=!0,E=!1,g=!1,v=!1,y=!1)}var G=new THREE.BufferGeometry;if(G.setIndex(r),G.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),a.length===n.length&&G.setAttribute("normal",new THREE.Float32BufferAttribute(a,3)),i.length!==r.length)i.length===n.length&&G.setAttribute("color",new THREE.Float32BufferAttribute(i,3));else{var W=(G=G.toNonIndexed()).attributes.position.count/3;if(i.length===3*W){var X=[];for(T=0;T<W;T++){N=i[3*T+0],U=i[3*T+1],B=i[3*T+2];X.push(N,U,B),X.push(N,U,B),X.push(N,U,B)}G.setAttribute("color",new THREE.Float32BufferAttribute(X,3))}}return G}(r(e)):function(e){var t,r,n,i,a,o,s,l=new Uint8Array(e),u=new DataView(e),c=[],h=[],d=[],f=[],p=0;function m(e,t){for(var r=t,n=e[r],i=[];10!==n;)i.push(String.fromCharCode(n)),n=e[++r];return{start:t,end:r,next:r+1,parsedString:i.join("")}}for(;;){if(0===(s=(o=m(l,p)).parsedString).indexOf("DATASET")){var g=s.split(" ")[1];if("POLYDATA"!==g)throw new Error("Unsupported DATASET type: "+g)}else if(0===s.indexOf("POINTS")){for(f.push(s),t=4*(i=parseInt(s.split(" ")[1],10))*3,c=new Float32Array(3*i),r=o.next,n=0;n<i;n++)c[3*n]=u.getFloat32(r,!1),c[3*n+1]=u.getFloat32(r+4,!1),c[3*n+2]=u.getFloat32(r+8,!1),r+=12;o.next=o.next+t+1}else if(0===s.indexOf("TRIANGLE_STRIPS")){var v=parseInt(s.split(" ")[1],10);t=4*(w=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*w-9*v);var y=0;for(r=o.next,n=0;n<v;n++){var _=u.getInt32(r,!1),b=[];for(r+=4,a=0;a<_;a++)b.push(u.getInt32(r,!1)),r+=4;for(var E=0;E<_-2;E++)E%2?(d[y++]=b[E],d[y++]=b[E+2],d[y++]=b[E+1]):(d[y++]=b[E],d[y++]=b[E+1],d[y++]=b[E+2])}o.next=o.next+t+1}else if(0===s.indexOf("POLYGONS")){var w;v=parseInt(s.split(" ")[1],10);t=4*(w=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*w-9*v);y=0;for(r=o.next,n=0;n<v;n++){_=u.getInt32(r,!1),b=[];for(r+=4,a=0;a<_;a++)b.push(u.getInt32(r,!1)),r+=4;for(E=1;E<_-1;E++)d[y++]=b[0],d[y++]=b[E],d[y++]=b[E+1]}o.next=o.next+t+1}else if(0===s.indexOf("POINT_DATA")){for(i=parseInt(s.split(" ")[1],10),o=m(l,o.next),t=4*i*3,h=new Float32Array(3*i),r=o.next,n=0;n<i;n++)h[3*n]=u.getFloat32(r,!1),h[3*n+1]=u.getFloat32(r+4,!1),h[3*n+2]=u.getFloat32(r+8,!1),r+=12;o.next=o.next+t}if((p=o.next)>=l.byteLength)break}var x=new THREE.BufferGeometry;return x.setIndex(new THREE.BufferAttribute(d,1)),x.setAttribute("position",new THREE.BufferAttribute(c,3)),h.length===c.length&&x.setAttribute("normal",new THREE.BufferAttribute(h,3)),x}(e)}})},function(e,t){THREE.UnpackDepthRGBAShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","\tgl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")}},function(e,t){var r,n,i;THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},n=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,r,n=this.renderer.getRenderTarget(),i=!1,a=this.passes.length;for(r=0;r<a;r++)if(!1!==(t=this.passes[r]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(t instanceof THREE.MaskPass?i=!0:t instanceof THREE.ClearMaskPass&&(i=!1))}this.renderer.setRenderTarget(n)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.Pass.FullScreenQuad=(r=new THREE.OrthographicCamera(-1,1,1,-1,0,1),n=new THREE.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new THREE.Mesh(n,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,r)}}),i)},function(e,t){THREE.RenderPass=function(e,t,r,n,i){THREE.Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,r){var n,i,a,o=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(n=e.getClearColor().getHex(),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(n,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=o}})},function(e,t){THREE.MaskPass=function(e,t){THREE.Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.MaskPass,render:function(e,t,r){var n,i,a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(n=0,i=1):(n=1,i=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,n,4294967295),o.buffers.stencil.setClear(i),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}}),THREE.ClearMaskPass=function(){THREE.Pass.call(this),this.needsSwap=!1},THREE.ClearMaskPass.prototype=Object.create(THREE.Pass.prototype),Object.assign(THREE.ClearMaskPass.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}})},function(e,t){THREE.OutlinePass=function(e,t,r,n){this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,THREE.Pass.call(this),this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=THREE.DoubleSide,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===THREE.CopyShader&&console.error("THREE.OutlinePass relies on THREE.CopyShader");var s=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4},THREE.OutlinePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value.set(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value.set(r,n)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function r(e){e.isMesh&&t.push(e)}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(r)}this.renderScene.traverse((function(r){if(r.isMesh||r.isLine||r.isSprite){for(var n=!1,i=0;i<t.length;i++){if(t[i].id===r.id){n=!0;break}}if(!n){var a=r.visible;e&&!r.bVisible||(r.visible=e),r.bVisible=a}}}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,r,n,i){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,i&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),THREE.OutlinePass.BlurDirectionX=new THREE.Vector2(1,0),THREE.OutlinePass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.ShaderPass=function(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}})},function(e,t){THREE.UnrealBloomPass=function(e,t,r,n){THREE.Pass.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(a,o,i);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new THREE.WebGLRenderTarget(a,o,i);u.texture.name="UnrealBloomPass.v"+s,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),a=Math.round(a/2),o=Math.round(o/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var c=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");var d=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.basic=new THREE.MeshBasicMaterial,this.fsQuad=new THREE.Pass.FullScreenQuad(null)},THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new THREE.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,i){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0),THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.GlitchPass=function(e){THREE.Pass.call(this),void 0===THREE.DigitalGlitch&&console.error("THREE.GlitchPass relies on THREE.DigitalGlitch");var t=THREE.DigitalGlitch;this.uniforms=THREE.UniformsUtils.clone(t.uniforms),null==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()},THREE.GlitchPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.GlitchPass,render:function(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=THREE.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=THREE.MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=THREE.MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=THREE.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=THREE.MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=THREE.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=THREE.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=THREE.MathUtils.randFloat(0,1),this.uniforms.seed_x.value=THREE.MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=THREE.MathUtils.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},generateTrigger:function(){this.randX=THREE.MathUtils.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),r=e*e,n=0;n<r;n++){var i=THREE.MathUtils.randFloat(0,1);t[3*n+0]=i,t[3*n+1]=i,t[3*n+2]=i}return new THREE.DataTexture(t,e,e,THREE.RGBFormat,THREE.FloatType)}})},function(e,t){THREE.SSAOPass=function(e,t,r,n){THREE.Pass.call(this),this.width=void 0!==r?r:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this.generateSampleKernel(),this.generateRandomKernelRotations();var i=new THREE.DepthTexture;i.type=THREE.UnsignedShortType,i.minFilter=THREE.NearestFilter,i.maxFilter=THREE.NearestFilter,this.beautyRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthTexture:i,depthBuffer:!0}),this.normalRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),this.ssaoRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===THREE.SSAOShader&&console.error("THREE.SSAOPass: The pass relies on THREE.SSAOShader."),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOShader.uniforms),vertexShader:THREE.SSAOShader.vertexShader,fragmentShader:THREE.SSAOShader.fragmentShader,blending:THREE.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.normalMaterial=new THREE.MeshNormalMaterial,this.normalMaterial.blending=THREE.NoBlending,this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOBlurShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOBlurShader.uniforms),vertexShader:THREE.SSAOBlurShader.vertexShader,fragmentShader:THREE.SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAODepthShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAODepthShader.uniforms),vertexShader:THREE.SSAODepthShader.vertexShader,fragmentShader:THREE.SSAODepthShader.fragmentShader,blending:THREE.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.CopyShader.uniforms),vertexShader:THREE.CopyShader.vertexShader,fragmentShader:THREE.CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:THREE.DstColorFactor,blendDst:THREE.ZeroFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.DstAlphaFactor,blendDstAlpha:THREE.ZeroFactor,blendEquationAlpha:THREE.AddEquation}),this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.originalClearColor=new THREE.Color},THREE.SSAOPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.SSAOPass,dispose:function(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()},render:function(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case THREE.SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}},renderPass:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},renderOverride:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},setSize:function(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.blurMaterial.uniforms.resolution.value.set(e,t)},generateSampleKernel:function(){for(var e=this.kernelSize,t=this.kernel,r=0;r<e;r++){var n=new THREE.Vector3;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();var i=r/e;i=THREE.MathUtils.lerp(.1,1,i*i),n.multiplyScalar(i),t.push(n)}},generateRandomKernelRotations:function(){void 0===THREE.SimplexNoise&&console.error("THREE.SSAOPass: The pass relies on THREE.SimplexNoise.");for(var e=new THREE.SimplexNoise,t=new Float32Array(64),r=0;r<16;r++){var n=4*r,i=2*Math.random()-1,a=2*Math.random()-1,o=e.noise3d(i,a,0);t[n]=o,t[n+1]=o,t[n+2]=o,t[n+3]=1}this.noiseTexture=new THREE.DataTexture(t,4,4,THREE.RGBAFormat,THREE.FloatType),this.noiseTexture.wrapS=THREE.RepeatWrapping,this.noiseTexture.wrapT=THREE.RepeatWrapping}}),THREE.SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5}},function(e,t){THREE.BokehPass=function(e,t,r){THREE.Pass.call(this);var n=r.width||window.innerWidth||1,i=r.height||window.innerHeight||1,a=r.vignetting||0;this.scene=e,this.camera=t,this.mouse=new THREE.Vector2,this.width=n,this.height=i;var o=THREE.BokehDepthShader,s=THREE.UniformsUtils.clone(o.uniforms);this.materialDepth=new THREE.ShaderMaterial({uniforms:s,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),s.mNear.value=t.near,s.mFar.value=t.far,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(n/-2,n/2,i/2,i/-2,-1e4,1e4),this.camera2.position.z=100,this.scene2.add(this.camera2);var l={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureDepth=new THREE.WebGLRenderTarget(n,i,l),this.rtTextureColor=new THREE.WebGLRenderTarget(n,i,l);var u=3,c=4,h=THREE.BokehShader,d=THREE.UniformsUtils.clone(h.uniforms);d.textureWidth.value=n,d.textureHeight.value=i,d.shaderFocus.value=1,d.vignetting.value=a,this.materialBokeh=new THREE.ShaderMaterial({uniforms:d,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{RINGS:u,SAMPLES:c}}),this.materialBokeh.uniforms.tColor.value=this.rtTextureColor.texture,this.materialBokeh.uniforms.tDepth.value=this.rtTextureDepth.texture;var f=new THREE.Mesh(new THREE.PlaneBufferGeometry(n,i),this.materialBokeh);f.position.z=-500,this.scene2.add(f)},THREE.BokehPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.BokehPass,render:function(e,t,r,n,i){var a=this.scene,o=this.camera,s=this.materialBokeh.uniforms,l=this.materialDepth.uniforms,u=.5,c=.5;u=.5*this.mouse.x+.5,c=.5*this.mouse.y+.5,s.focusCoords.value.set(u,c),s.znear.value=o.near,s.zfar.value=o.far,l.mNear.value=o.near,l.mFar.value=o.far,e.setRenderTarget(this.rtTextureColor),e.clear(),e.render(a,o),a.overrideMaterial=this.materialDepth,e.setRenderTarget(this.rtTextureDepth),e.clear(),e.render(a,o),a.overrideMaterial=null,this.renderToScreen||(e.setRenderTarget(t),this.clear&&e.clear()),e.render(this.scene2,this.camera2)}})},function(e,t){THREE.BokehShader={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:1},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","\t//pentagonal shape","\tfloat scale = float(rings) - 1.3;","\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","\tvec4  one = vec4( 1.0 );","\tvec4 P = vec4((coords),vec2(scale, scale));","\tvec4 dist = vec4(0.0);","\tfloat inorout = -4.0;","\tdist.x = dot( P, HS0 );","\tdist.y = dot( P, HS1 );","\tdist.z = dot( P, HS2 );","\tdist.w = dot( P, HS3 );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dot( dist, one );","\tdist.x = dot( P, HS4 );","\tdist.y = HS5.w - abs( P.z );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dist.x;","\treturn clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","\t// Depth buffer blur","\tfloat d = 0.0;","\tfloat kernel[9];","\tvec2 offset[9];","\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","\toffset[0] = vec2(-wh.x,-wh.y);","\toffset[1] = vec2( 0.0, -wh.y);","\toffset[2] = vec2( wh.x -wh.y);","\toffset[3] = vec2(-wh.x,  0.0);","\toffset[4] = vec2( 0.0,   0.0);","\toffset[5] = vec2( wh.x,  0.0);","\toffset[6] = vec2(-wh.x, wh.y);","\toffset[7] = vec2( 0.0,  wh.y);","\toffset[8] = vec2( wh.x, wh.y);","\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","\tfor( int i=0; i<9; i++ ) {","\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;","\t\td += tmp * kernel[i];","\t}","\treturn d;","}","vec3 color(vec2 coords,float blur) {","\t//processing the sample","\tvec3 col = vec3(0.0);","\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","\tvec3 lumcoeff = vec3(0.299,0.587,0.114);","\tfloat lum = dot(col.rgb, lumcoeff);","\tfloat thresh = max((lum-threshold)*gain, 0.0);","\treturn col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","\tfloat edge = 0.002*depth; //distance based edge smoothing","\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","\treturn col;","}","float linearize(float depth) {","\treturn -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));","\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","\treturn clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","\tfloat rings2 = float(rings);","\tfloat step = PI*2.0 / float(ringsamples);","\tfloat pw = cos(j*step)*i;","\tfloat ph = sin(j*step)*i;","\tfloat p = 1.0;","\tif (pentagon) {","\t\tp = penta(vec2(pw,ph));","\t}","\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","\treturn 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","\t//scene depth calculation","\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);","\t// Blur depth?","\tif ( depthblur ) {","\t\tdepth = linearize(bdepth(vUv.xy));","\t}","\t//focal plane calculation","\tfloat fDepth = focalDepth;","\tif (shaderFocus) {","\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);","\t}","\t// dof blur factor calculation","\tfloat blur = 0.0;","\tif (manualdof) {","\t\tfloat a = depth-fDepth; // Focal plane","\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF","\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof","\t\tblur = (a>0.0) ? b : c;","\t} else {","\t\tfloat f = focalLength; // focal length in mm","\t\tfloat d = fDepth*1000.0; // focal plane in mm","\t\tfloat o = depth*1000.0; // depth in mm","\t\tfloat a = (o*f)/(o-f);","\t\tfloat b = (d*f)/(d-f);","\t\tfloat c = (d-f)/(d*fstop*CoC);","\t\tblur = abs(a-b)*c;","\t}","\tblur = clamp(blur,0.0,1.0);","\t// calculation of pattern for dithering","\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","\t// getting blur x and y step factor","\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;","\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;","\t// calculation of final color","\tvec3 col = vec3(0.0);","\tif(blur < 0.05) {","\t\t//some optimization thingy","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t} else {","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t\tfloat s = 1.0;","\t\tint ringsamples;","\t\tfor (int i = 1; i <= rings; i++) {","\t\t\t/*unboxstart*/","\t\t\tringsamples = i * samples;","\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {","\t\t\t\tif (j >= ringsamples) break;","\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);","\t\t\t}","\t\t\t/*unboxend*/","\t\t}","\t\tcol /= s; //divide by sample count","\t}","\tif (showFocus) {","\t\tcol = debugFocus(col, blur, depth);","\t}","\tif (vignetting) {","\t\tcol *= vignette();","\t}","\tgl_FragColor.rgb = col;","\tgl_FragColor.a = 1.0;","} "].join("\n")},THREE.BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")}},function(e,t){THREE.BleachBypassShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 base = texture2D( tDiffuse, vUv );","\tvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","\tfloat lum = dot( lumCoeff, base.rgb );","\tvec3 blend = vec3( lum );","\tfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","\tvec3 result1 = 2.0 * base.rgb * blend;","\tvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","\tvec3 newColor = mix( result1, result2, L );","\tfloat A2 = opacity * base.a;","\tvec3 mixRGB = A2 * newColor.rgb;","\tmixRGB += ( ( 1.0 - A2 ) * base.rgb );","\tgl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")}},function(e,t){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t){THREE.DotScreenShader={uniforms:{tDiffuse:{value:null},tSize:{value:new THREE.Vector2(256,256)},center:{value:new THREE.Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","\tfloat s = sin( angle ), c = cos( angle );","\tvec2 tex = vUv * tSize - center;","\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tfloat average = ( color.r + color.g + color.b ) / 3.0;","\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")}},function(e,t){THREE.FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")}},function(e,t){THREE.GammaCorrectionShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")}},function(e,t){THREE.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new THREE.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvec2 imageCoord = vUv;","\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","\t\timageCoord += uImageIncrement;","\t}","\tgl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var r,n,i,a,o=2*Math.ceil(3*e)+1;for(o>25&&(o=25),a=.5*(o-1),n=new Array(o),i=0,r=0;r<o;++r)n[r]=t(r-a,e),i+=n[r];for(r=0;r<o;++r)n[r]/=i;return n}}},function(e,t){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(e,t){THREE.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tvec3 c = color.rgb;","\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")}},function(e,t){THREE.DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","\tif(byp<1) {","\t\tvec2 p = vUv;","\t\tfloat xs = floor(gl_FragCoord.x / 0.5);","\t\tfloat ys = floor(gl_FragCoord.y / 0.5);","\t\tvec4 normal = texture2D (tDisp, p*seed*seed);","\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","\t\t\tif(seed_x>0.){","\t\t\t\tp.y = 1. - (p.y + distortion_y);","\t\t\t}","\t\t\telse {","\t\t\t\tp.y = distortion_y;","\t\t\t}","\t\t}","\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","\t\t\tif(seed_y>0.){","\t\t\t\tp.x=distortion_x;","\t\t\t}","\t\t\telse {","\t\t\t\tp.x = 1. - (p.x + distortion_x);","\t\t\t}","\t\t}","\t\tp.x+=normal.x*seed_x*(seed/5.);","\t\tp.y+=normal.y*seed_y*(seed/5.);","\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));","\t\tvec4 cr = texture2D(tDiffuse, p + offset);","\t\tvec4 cga = texture2D(tDiffuse, p);","\t\tvec4 cb = texture2D(tDiffuse, p - offset);","\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","\t\tgl_FragColor = gl_FragColor+ snow;","\t}","\telse {","\t\tgl_FragColor=texture2D (tDiffuse, vUv);","\t}","}"].join("\n")}},function(e,t){THREE.SSAOShader={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new THREE.Vector2},cameraProjectionMatrix:{value:new THREE.Matrix4},cameraInverseProjectionMatrix:{value:new THREE.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},THREE.SSAODepthShader={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},THREE.SSAOBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")}},function(e,t){THREE.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")}},function(e,t){THREE.GodRaysDepthMaskShader={uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},THREE.GodRaysGenerateShader={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","\tvec2 delta = vSunPositionScreenSpace - vUv;","\tfloat dist = length( delta );","\tvec2 stepv = fStepSize * delta / dist;","\tfloat iters = dist/fStepSize;","\tvec2 uv = vUv.xy;","\tfloat col = 0.0;","\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tgl_FragColor = vec4( col/TAPS_PER_PASS );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysCombineShader={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysFakeSunShader={uniforms:{vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)},fAspect:{value:1},sunColor:{value:new THREE.Color(16772608)},bgColor:{value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","\tvec2 diff = vUv - vSunPositionScreenSpace;","\tdiff.x *= fAspect;","\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","\tprop = 0.35 * pow( 1.0 - prop, 3.0 );","\tgl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","\tgl_FragColor.w = 1.0;","}"].join("\n")}},function(e,t){THREE.AnaglyphEffect=function(e,t,r){this.colorMatrixLeft=(new THREE.Matrix3).fromArray([1.0671679973602295,-.0016435992438346148,.0001777536963345483,-.028107794001698494,-.00019593400065787137,-.0002875397040043026,-.04279090091586113,15809757314855233e-21,-.00024287120322696865]),this.colorMatrixRight=(new THREE.Matrix3).fromArray([-.0355340838432312,-.06440307199954987,.018319187685847282,-.10269022732973099,.8079727292060852,-.04835830628871918,.0001224992738571018,-.009558862075209618,.567823588848114]);var n=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=new THREE.Scene,a=new THREE.StereoCamera,o={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};void 0===t&&(t=512),void 0===r&&(r=512);var s=new THREE.WebGLRenderTarget(t,r,o),l=new THREE.WebGLRenderTarget(t,r,o),u=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:s.texture},mapRight:{value:l.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),c=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),u);i.add(c),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();s.setSize(t*n,r*n),l.setSize(t*n,r*n)},this.render=function(t,r){var o=e.getRenderTarget();t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),a.update(r),e.setRenderTarget(s),e.clear(),e.render(t,a.cameraL),e.setRenderTarget(l),e.clear(),e.render(t,a.cameraR),e.setRenderTarget(null),e.render(i,n),e.setRenderTarget(o)},this.dispose=function(){s&&s.dispose(),l&&l.dispose(),c&&c.geometry.dispose(),u&&u.dispose()}}},function(e,t){THREE.StereoEffect=function(e){var t=new THREE.StereoCamera;t.aspect=.5;var r=new THREE.Vector2;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,r){e.setSize(t,r)},this.render=function(n,i){n.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),t.update(i),e.getSize(r),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,r.width/2,r.height),e.setViewport(0,0,r.width/2,r.height),e.render(n,t.cameraL),e.setScissor(r.width/2,0,r.width/2,r.height),e.setViewport(r.width/2,0,r.width/2,r.height),e.render(n,t.cameraR),e.setScissorTest(!1)}}},function(e,t){THREE.ParallaxBarrierEffect=function(e){var t=new THREE.OrthographicCamera(-1,1,1,-1,0,1),r=new THREE.Scene,n=new THREE.StereoCamera,i={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},a=new THREE.WebGLRenderTarget(512,512,i),o=new THREE.WebGLRenderTarget(512,512,i),s=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:a.texture},mapRight:{value:o.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),l=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),s);r.add(l),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();a.setSize(t*n,r*n),o.setSize(t*n,r*n)},this.render=function(i,s){i.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),n.update(s),e.setRenderTarget(a),e.clear(),e.render(i,n.cameraL),e.setRenderTarget(o),e.clear(),e.render(i,n.cameraR),e.setRenderTarget(null),e.render(r,t)}}},function(e,t){THREE.TypedArrayUtils={},THREE.TypedArrayUtils.quicksortIP=function(e,t,r){for(var n,i,a=[],o=-1,s=0,l=e.length/t-1,u=0,c=0,h=0,d=function(r,n){for(r*=t,n*=t,h=0;h<t;h++)u=e[r+h],e[r+h]=e[n+h],e[n+h]=u},f=new Float32Array(t),p=new Float32Array(t);;)if(l-s<=25){for(i=s+1;i<=l;i++){for(c=0;c<t;c++)f[c]=e[i*t+c];for(n=i-1;n>=s&&e[n*t+r]>f[r];){for(c=0;c<t;c++)e[(n+1)*t+c]=e[n*t+c];n--}for(c=0;c<t;c++)e[(n+1)*t+c]=f[c]}if(-1==o)break;l=a[o--],s=a[o--]}else{for(i=l,d(s+l>>1,n=s+1),e[s*t+r]>e[l*t+r]&&d(s,l),e[n*t+r]>e[l*t+r]&&d(n,l),e[s*t+r]>e[n*t+r]&&d(s,n),c=0;c<t;c++)p[c]=e[n*t+c];for(;;){do{n++}while(e[n*t+r]<p[r]);do{i--}while(e[i*t+r]>p[r]);if(i<n)break;d(n,i)}for(c=0;c<t;c++)e[(s+1)*t+c]=e[i*t+c],e[i*t+c]=p[c];l-n+1>=i-s?(a[++o]=n,a[++o]=l,l=i-1):(a[++o]=s,a[++o]=i-1,s=n)}return e},THREE.TypedArrayUtils.Kdtree=function(e,t,r){var n=this,i=0,a=function(e,t){return e.subarray(t*r,t*r+r)};this.root=function e(t,o,s,l){var u,c,h=o%r,d=t.length/r;return o>i&&(i=o),0===d?null:1===d?new n.Node(a(t,0),o,s,l):(THREE.TypedArrayUtils.quicksortIP(t,r,h),u=Math.floor(d/2),(c=new n.Node(a(t,u),o,s,u+l)).left=e(t.subarray(0,u*r),o+1,c,l),c.right=e(t.subarray((u+1)*r,t.length),o+1,c,l+u+1),c)}(e,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(e,i,a){var o,s,l;if(l=new THREE.TypedArrayUtils.Kdtree.BinaryHeap((function(e){return-e[1]})),a)for(o=0;o<i;o+=1)l.push([null,a]);for(function n(a){var o,s,u,c,h=a.depth%r,d=t(e,a.obj),f=[];function p(e,t){l.push([e,t]),l.size()>i&&l.pop()}for(c=0;c<r;c+=1)c===a.depth%r?f[c]=e[c]:f[c]=a.obj[c];s=t(f,a.obj),null!==a.right||null!==a.left?(n(o=null===a.right?a.left:null===a.left?a.right:e[h]<a.obj[h]?a.left:a.right),(l.size()<i||d<l.peek()[1])&&p(a,d),(l.size()<i||Math.abs(s)<l.peek()[1])&&null!==(u=o===a.left?a.right:a.left)&&n(u)):(l.size()<i||d<l.peek()[1])&&p(a,d)}(n.root),s=[],o=0;o<i;o+=1)l.content[o][0]&&s.push([l.content[o][0],l.content[o][1]]);return s}},THREE.TypedArrayUtils.Kdtree.prototype.Node=function(e,t,r,n){this.obj=e,this.left=null,this.right=null,this.parent=r,this.depth=t,this.pos=n},THREE.TypedArrayUtils.Kdtree.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},THREE.TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,r=0;r<t;r++)if(this.content[r]==e){var n=this.content.pop();return void(r!=t-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var r=Math.floor((e+1)/2)-1,n=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[r]=t,this.content[e]=n,e=r}},sinkDown:function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=2*(e+1),a=i-1,o=null;if(a<t){var s=this.content[a],l=this.scoreFunction(s);l<n&&(o=a)}if(i<t){var u=this.content[i];this.scoreFunction(u)<(null===o?n:l)&&(o=i)}if(null===o)break;this.content[e]=this.content[o],this.content[o]=r,e=o}}}},function(e,t){THREE.BufferGeometryUtils={computeTangents:function(e){var t=e.index,r=e.attributes;if(null!==t&&void 0!==r.position&&void 0!==r.normal&&void 0!==r.uv){var n=t.array,i=r.position.array,a=r.normal.array,o=r.uv.array,s=i.length/3;void 0===r.tangent&&e.setAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*s),4));for(var l=r.tangent.array,u=[],c=[],h=0;h<s;h++)u[h]=new THREE.Vector3,c[h]=new THREE.Vector3;var d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector3,_=new THREE.Vector3,b=e.groups;0===b.length&&(b=[{start:0,count:n.length}]);h=0;for(var E=b.length;h<E;++h)for(var w=C=(L=b[h]).start,x=C+L.count;w<x;w+=3)I(n[w+0],n[w+1],n[w+2]);var T,M,S,A=new THREE.Vector3,R=new THREE.Vector3,k=new THREE.Vector3,P=new THREE.Vector3;for(h=0,E=b.length;h<E;++h){var L,C;for(w=C=(L=b[h]).start,x=C+L.count;w<x;w+=3)H(n[w+0]),H(n[w+1]),H(n[w+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function I(e,t,r){d.fromArray(i,3*e),f.fromArray(i,3*t),p.fromArray(i,3*r),m.fromArray(o,2*e),g.fromArray(o,2*t),v.fromArray(o,2*r),f.sub(d),p.sub(d),g.sub(m),v.sub(m);var n=1/(g.x*v.y-v.x*g.y);isFinite(n)&&(y.copy(f).multiplyScalar(v.y).addScaledVector(p,-g.y).multiplyScalar(n),_.copy(p).multiplyScalar(g.x).addScaledVector(f,-v.x).multiplyScalar(n),u[e].add(y),u[t].add(y),u[r].add(y),c[e].add(_),c[t].add(_),c[r].add(_))}function H(e){k.fromArray(a,3*e),P.copy(k),M=u[e],A.copy(M),A.sub(k.multiplyScalar(k.dot(M))).normalize(),R.crossVectors(P,M),S=R.dot(c[e]),T=S<0?-1:1,l[4*e]=A.x,l[4*e+1]=A.y,l[4*e+2]=A.z,l[4*e+3]=T}},mergeBufferGeometries:function(e,t){for(var r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,l=new THREE.BufferGeometry,u=0,c=0;c<e.length;++c){var h=e[c];if(r!==(null!==h.index))return null;for(var d in h.attributes){if(!n.has(d))return null;void 0===a[d]&&(a[d]=[]),a[d].push(h.attributes[d])}if(s!==h.morphTargetsRelative)return null;for(var d in h.morphAttributes){if(!i.has(d))return null;void 0===o[d]&&(o[d]=[]),o[d].push(h.morphAttributes[d])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(h.userData),t){var f;if(r)f=h.index.count;else{if(void 0===h.attributes.position)return null;f=h.attributes.position.count}l.addGroup(u,f,c),u+=f}}if(r){var p=0,m=[];for(c=0;c<e.length;++c){for(var g=e[c].index,v=0;v<g.count;++v)m.push(g.getX(v)+p);p+=e[c].attributes.position.count}l.setIndex(m)}for(var d in a){var y=this.mergeBufferAttributes(a[d]);if(!y)return null;l.setAttribute(d,y)}for(var d in o){var _=o[d][0].length;if(0===_)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[d]=[];for(c=0;c<_;++c){var b=[];for(v=0;v<o[d].length;++v)b.push(o[d][v][c]);var E=this.mergeBufferAttributes(b);if(!E)return null;l.morphAttributes[d].push(E)}}return l},mergeBufferAttributes:function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.BufferAttribute(s,r,n)},interleaveAttributes:function(e){for(var t,r=0,n=0,i=0,a=e.length;i<a;++i){var o=e[i];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;r+=o.array.length,n+=o.itemSize}var s=new THREE.InterleavedBuffer(new t(r),n),l=0,u=[],c=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"],d=0;for(a=e.length;d<a;d++){var f=(o=e[d]).itemSize,p=o.count,m=new THREE.InterleavedBufferAttribute(s,f,l,o.normalized);u.push(m),l+=f;for(var g=0;g<p;g++)for(var v=0;v<f;v++)m[h[v]](g,o[c[v]](g))}return u},estimateBytesUsed:function(e){var t=0;for(var r in e.attributes){var n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}var i=e.getIndex();return t+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var r={},n=e.getIndex(),i=e.getAttribute("position"),a=n?n.count:i.count,o=0,s=Object.keys(e.attributes),l={},u={},c=[],h=["getX","getY","getZ","getW"],d=0,f=s.length;d<f;d++){l[_=s[d]]=[],(x=e.morphAttributes[_])&&(u[_]=new Array(x.length).fill().map(()=>[]))}var p=Math.log10(1/t),m=Math.pow(10,p);for(d=0;d<a;d++){var g=n?n.getX(d):d,v="",y=0;for(f=s.length;y<f;y++)for(var _=s[y],b=(w=e.getAttribute(_)).itemSize,E=0;E<b;E++)v+=~~(w[h[E]](g)*m)+",";if(v in r)c.push(r[v]);else{for(y=0,f=s.length;y<f;y++){_=s[y];var w=e.getAttribute(_),x=e.morphAttributes[_],T=(b=w.itemSize,l[_]),M=u[_];for(E=0;E<b;E++){var S=h[E];if(T.push(w[S](g)),x)for(var A=0,R=x.length;A<R;A++)M[A].push(x[A][S](g))}}r[v]=o,c.push(o),o++}}const k=e.clone();for(d=0,f=s.length;d<f;d++){_=s[d];var P=e.getAttribute(_),L=new P.array.constructor(l[_]);w=new THREE.BufferAttribute(L,P.itemSize,P.normalized);if(k.setAttribute(_,w),_ in u)for(y=0;y<u[_].length;y++){var C=e.morphAttributes[_][y],I=(L=new C.array.constructor(u[_][y]),new THREE.BufferAttribute(L,C.itemSize,C.normalized));k.morphAttributes[_][y]=I}}return k.setIndex(c),k},toTrianglesDrawMode:function(e,t){if(t===THREE.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===THREE.TriangleFanDrawMode||t===THREE.TriangleStripDrawMode){var r=e.getIndex();if(null===r){var n=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<i.count;a++)n.push(a);e.setIndex(n),r=e.getIndex()}var o=r.count-2,s=[];if(t===THREE.TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(r.getX(0)),s.push(r.getX(a)),s.push(r.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(r.getX(a)),s.push(r.getX(a+1)),s.push(r.getX(a+2))):(s.push(r.getX(a+2)),s.push(r.getX(a+1)),s.push(r.getX(a)));s.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l.clearGroups(),l}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}}},function(module,exports){THREE.Volume=function(e,t,r,n,i){if(arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(r)||1,n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(i);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(i);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(i);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(i);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(i);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(i);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in THREE.Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(i);break;case"Float64":case"float64":case"double":this.data=new Float64Array(i);break;default:this.data=new Uint8Array(i)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in THREE.Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new THREE.Matrix3,this.matrix.identity();var a=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return a},set:function(e){a=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}});var o=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}}),this.sliceList=[]},THREE.Volume.prototype={constructor:THREE.Volume,getData:function(e,t,r){return this.data[r*this.xLength*this.yLength+t*this.xLength+e]},access:function(e,t,r){return r*this.xLength*this.yLength+t*this.xLength+e},reverseAccess:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),r=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-r*this.xLength,r,t]},map:function(e,t){var r=this.data.length;t=t||this;for(var n=0;n<r;n++)this.data[n]=e.call(t,this.data[n],n,this.data);return this},extractPerpendicularPlane:function(axis,RASIndex){var iLength,jLength,sliceAccess,planeMatrix=(new THREE.Matrix4).identity(),volume=this,planeWidth,planeHeight,firstSpacing,secondSpacing,positionOffset,IJKIndex,axisInIJK=new THREE.Vector3,firstDirection=new THREE.Vector3,secondDirection=new THREE.Vector3,dimensions=new THREE.Vector3(this.xLength,this.yLength,this.zLength);switch(axis){case"x":axisInIJK.set(1,0,0),firstDirection.set(0,0,-1),secondDirection.set(0,-1,0),firstSpacing=this.spacing[2],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(RASIndex,0,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationY(Math.PI/2)),positionOffset=(volume.RASDimensions[0]-1)/2,planeMatrix.setPosition(new THREE.Vector3(RASIndex-positionOffset,0,0));break;case"y":axisInIJK.set(0,1,0),firstDirection.set(1,0,0),secondDirection.set(0,0,1),firstSpacing=this.spacing[0],secondSpacing=this.spacing[2],IJKIndex=new THREE.Vector3(0,RASIndex,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationX(-Math.PI/2)),positionOffset=(volume.RASDimensions[1]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,RASIndex-positionOffset,0));break;case"z":default:axisInIJK.set(0,0,1),firstDirection.set(1,0,0),secondDirection.set(0,-1,0),firstSpacing=this.spacing[0],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(0,0,RASIndex),positionOffset=(volume.RASDimensions[2]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,0,RASIndex-positionOffset))}firstDirection.applyMatrix4(volume.inverseMatrix).normalize(),firstDirection.argVar="i",secondDirection.applyMatrix4(volume.inverseMatrix).normalize(),secondDirection.argVar="j",axisInIJK.applyMatrix4(volume.inverseMatrix).normalize(),iLength=Math.floor(Math.abs(firstDirection.dot(dimensions))),jLength=Math.floor(Math.abs(secondDirection.dot(dimensions))),planeWidth=Math.abs(iLength*firstSpacing),planeHeight=Math.abs(jLength*secondSpacing),IJKIndex=Math.abs(Math.round(IJKIndex.applyMatrix4(volume.inverseMatrix).dot(axisInIJK)));var base=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],iDirection=[firstDirection,secondDirection,axisInIJK].find((function(e){return Math.abs(e.dot(base[0]))>.9})),jDirection=[firstDirection,secondDirection,axisInIJK].find((function(e){return Math.abs(e.dot(base[1]))>.9})),kDirection=[firstDirection,secondDirection,axisInIJK].find((function(e){return Math.abs(e.dot(base[2]))>.9})),argumentsWithInversion=["volume.xLength-1-","volume.yLength-1-","volume.zLength-1-"],argArray=[iDirection,jDirection,kDirection].map((function(e,t){return(e.dot(base[t])>0?"":argumentsWithInversion[t])+(e===axisInIJK?"IJKIndex":e.argVar)})),argString=argArray.join(",");return sliceAccess=eval("(function sliceAccess (i,j) {return volume.access( "+argString+");})"),{iLength:iLength,jLength:jLength,sliceAccess:sliceAccess,matrix:planeMatrix,planeWidth:planeWidth,planeHeight:planeHeight}},extractSlice:function(e,t){var r=new THREE.VolumeSlice(this,t,e);return this.sliceList.push(r),r},repaintAllSlices:function(){return this.sliceList.forEach((function(e){e.repaint()})),this},computeMinMax:function(){var e=1/0,t=-1/0,r=this.data.length,n=0;for(n=0;n<r;n++)if(!isNaN(this.data[n])){var i=this.data[n];e=Math.min(e,i),t=Math.max(t,i)}return this.min=e,this.max=t,[e,t]}}},function(e,t){THREE.VolumeSlice=function(e,t,r){var n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new THREE.Texture(this.canvas);i.minFilter=THREE.LinearFilter,i.wrapS=i.wrapT=THREE.ClampToEdgeWrapping;var a=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide,transparent:!0});this.mesh=new THREE.Mesh(this.geometry,a),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()},THREE.VolumeSlice.prototype={constructor:THREE.VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,i=this.canvasBuffer,a=this.ctxBuffer,o=a.getImageData(0,0,e,t),s=o.data,l=n.data,u=n.upperThreshold,c=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,f=0;if("label"===n.dataType)for(var p=0;p<t;p++)for(var m=0;m<e;m++){var g=l[r(m,p)];g=g>=this.colorMap.length?g%this.colorMap.length+1:g;var v=this.colorMap[g];s[4*f]=v>>24&255,s[4*f+1]=v>>16&255,s[4*f+2]=v>>8&255,s[4*f+3]=255&v,f++}else for(p=0;p<t;p++)for(m=0;m<e;m++){var y=l[r(m,p)],_=255;_=u>=y&&c<=y?_:0,y=(y=Math.floor(255*(y-h)/(d-h)))>255?255:y<0?0:0|y,s[4*f]=y,s[4*f+1]=y,s[4*f+2]=y,s[4*f+3]=_,f++}a.putImageData(o,0,0),this.ctx.drawImage(i,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new THREE.PlaneBufferGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}}},function(e,t){THREE.VolumeRenderShader1={uniforms:{u_size:{value:new THREE.Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new THREE.Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tvarying vec3 v_position;","\t\tmat4 inversemat(mat4 m) {","\t\t\t\tfloat","\t\t\t\ta00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],","\t\t\t\ta10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],","\t\t\t\ta20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],","\t\t\t\ta30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],","\t\t\t\tb00 = a00 * a11 - a01 * a10,","\t\t\t\tb01 = a00 * a12 - a02 * a10,","\t\t\t\tb02 = a00 * a13 - a03 * a10,","\t\t\t\tb03 = a01 * a12 - a02 * a11,","\t\t\t\tb04 = a01 * a13 - a03 * a11,","\t\t\t\tb05 = a02 * a13 - a03 * a12,","\t\t\t\tb06 = a20 * a31 - a21 * a30,","\t\t\t\tb07 = a20 * a32 - a22 * a30,","\t\t\t\tb08 = a20 * a33 - a23 * a30,","\t\t\t\tb09 = a21 * a32 - a22 * a31,","\t\t\t\tb10 = a21 * a33 - a23 * a31,","\t\t\t\tb11 = a22 * a33 - a23 * a32,","\t\t\t\tdet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;","\t\treturn mat4(","\t\t\t\ta11 * b11 - a12 * b10 + a13 * b09,","\t\t\t\ta02 * b10 - a01 * b11 - a03 * b09,","\t\t\t\ta31 * b05 - a32 * b04 + a33 * b03,","\t\t\t\ta22 * b04 - a21 * b05 - a23 * b03,","\t\t\t\ta12 * b08 - a10 * b11 - a13 * b07,","\t\t\t\ta00 * b11 - a02 * b08 + a03 * b07,","\t\t\t\ta32 * b02 - a30 * b05 - a33 * b01,","\t\t\t\ta20 * b05 - a22 * b02 + a23 * b01,","\t\t\t\ta10 * b10 - a11 * b08 + a13 * b06,","\t\t\t\ta01 * b08 - a00 * b10 - a03 * b06,","\t\t\t\ta30 * b04 - a31 * b02 + a33 * b00,","\t\t\t\ta21 * b02 - a20 * b04 - a23 * b00,","\t\t\t\ta11 * b07 - a10 * b09 - a12 * b06,","\t\t\t\ta00 * b09 - a01 * b07 + a02 * b06,","\t\t\t\ta31 * b01 - a30 * b03 - a32 * b00,","\t\t\t\ta20 * b03 - a21 * b01 + a22 * b00) / det;","\t\t}","\t\tvoid main() {","\t\t\t\tmat4 viewtransformf = modelViewMatrix;","\t\t\t\tmat4 viewtransformi = inversemat(modelViewMatrix);","\t\t\t\tvec4 position4 = vec4(position, 1.0);","\t\t\t\tvec4 pos_in_cam = viewtransformf * position4;","\t\t\t\tpos_in_cam.z = -pos_in_cam.w;","\t\t\t\tv_nearpos = viewtransformi * pos_in_cam;","\t\t\t\tpos_in_cam.z = pos_in_cam.w;","\t\t\t\tv_farpos = viewtransformi * pos_in_cam;","\t\t\t\tv_position = position;","\t\t\t\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","\t\t}"].join("\n"),fragmentShader:["\t\tprecision highp float;","\t\tprecision mediump sampler3D;","\t\tuniform vec3 u_size;","\t\tuniform int u_renderstyle;","\t\tuniform float u_renderthreshold;","\t\tuniform vec2 u_clim;","\t\tuniform sampler3D u_data;","\t\tuniform sampler2D u_cmdata;","\t\tvarying vec3 v_position;","\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tconst int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3","\t\tconst int REFINEMENT_STEPS = 4;","\t\tconst float relative_step_size = 1.0;","\t\tconst vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","\t\tconst vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","\t\tconst vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","\t\tconst float shininess = 40.0;","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tfloat sample1(vec3 texcoords);","\t\tvec4 apply_colormap(float val);","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","\t\tvoid main() {","\t\t\t\tvec3 farpos = v_farpos.xyz / v_farpos.w;","\t\t\t\tvec3 nearpos = v_nearpos.xyz / v_nearpos.w;","\t\t\t\tvec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","\t\t\t\tfloat distance = dot(nearpos - v_position, view_ray);","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.x - 0.5 - v_position.x) / view_ray.x));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.y - 0.5 - v_position.y) / view_ray.y));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.z - 0.5 - v_position.z) / view_ray.z));","\t\t\t\tvec3 front = v_position + view_ray * distance;","\t\t\t\tint nsteps = int(-distance / relative_step_size + 0.5);","\t\t\t\tif ( nsteps < 1 )","\t\t\t\t\t\tdiscard;","\t\t\t\tvec3 step = ((v_position - front) / u_size) / float(nsteps);","\t\t\t\tvec3 start_loc = front / u_size;","\t\t\t\tif (u_renderstyle == 0)","\t\t\t\t\t\tcast_mip(start_loc, step, nsteps, view_ray);","\t\t\t\telse if (u_renderstyle == 1)","\t\t\t\t\t\tcast_iso(start_loc, step, nsteps, view_ray);","\t\t\t\tif (gl_FragColor.a < 0.05)","\t\t\t\t\t\tdiscard;","\t\t}","\t\tfloat sample1(vec3 texcoords) {","\t\t\t\t/* Sample float value from a 3D texture. Assumes intensity data. */","\t\t\t\treturn texture(u_data, texcoords.xyz).r;","\t\t}","\t\tvec4 apply_colormap(float val) {","\t\t\t\tval = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","\t\t\t\treturn texture2D(u_cmdata, vec2(val, 0.5));","\t\t}","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tfloat max_val = -1e6;","\t\t\t\tint max_i = 100;","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > max_val) {","\t\t\t\t\t\t\t\tmax_val = val;","\t\t\t\t\t\t\t\tmax_i = iter;","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t\t\tvec3 iloc = start_loc + step * (float(max_i) - 0.5);","\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\tmax_val = max(max_val, sample1(iloc));","\t\t\t\t\t\tiloc += istep;","\t\t\t\t}","\t\t\t\tgl_FragColor = apply_colormap(max_val);","\t\t}","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tgl_FragColor = vec4(0.0);\t// init transparent","\t\t\t\tvec4 color3 = vec4(0.0);\t// final color","\t\t\t\tvec3 dstep = 1.5 / u_size;\t// step to sample derivative","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfloat low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > low_threshold) {","\t\t\t\t\t\t\t\tvec3 iloc = loc - 0.5 * step;","\t\t\t\t\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\t\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\t\t\t\t\tval = sample1(iloc);","\t\t\t\t\t\t\t\t\t\tif (val > u_renderthreshold) {","\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = add_lighting(val, iloc, dstep, view_ray);","\t\t\t\t\t\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t\t\tiloc += istep;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t}","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","\t\t{","\t\t\t\tvec3 V = normalize(view_ray);","\t\t\t\tvec3 N;","\t\t\t\tfloat val1, val2;","\t\t\t\tval1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","\t\t\t\tval2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","\t\t\t\tN[0] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, -step[1], 0.0));","\t\t\t\tval2 = sample1(loc + vec3(0.0, +step[1], 0.0));","\t\t\t\tN[1] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","\t\t\t\tval2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","\t\t\t\tN[2] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tfloat gm = length(N); // gradient magnitude","\t\t\t\tN = normalize(N);","\t\t\t\tfloat Nselect = float(dot(N, V) > 0.0);","\t\t\t\tN = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;","\t\t\t\tvec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tfor (int i=0; i<1; i++)","\t\t\t\t{","\t\t\t\t\t\tvec3 L = normalize(view_ray);\t//lightDirs[i];","\t\t\t\t\t\tfloat lightEnabled = float( length(L) > 0.0 );","\t\t\t\t\t\tL = normalize(L + (1.0 - lightEnabled));","\t\t\t\t\t\tfloat lambertTerm = clamp(dot(N, L), 0.0, 1.0);","\t\t\t\t\t\tvec3 H = normalize(L+V); // Halfway vector","\t\t\t\t\t\tfloat specularTerm = pow(max(dot(H, N), 0.0), shininess);","\t\t\t\t\t\tfloat mask1 = lightEnabled;","\t\t\t\t\t\tambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;","\t\t\t\t\t\tdiffuse_color +=\tmask1 * lambertTerm;","\t\t\t\t\t\tspecular_color += mask1 * specularTerm * specular_color;","\t\t\t\t}","\t\t\t\tvec4 final_color;","\t\t\t\tvec4 color = apply_colormap(val);","\t\t\t\tfinal_color = color * (ambient_color + diffuse_color) + specular_color;","\t\t\t\tfinal_color.a = color.a;","\t\t\t\treturn final_color;","\t\t}"].join("\n")}},function(e,t){THREE.DragControls=function(e,t,r){var n=new THREE.Plane,i=new THREE.Raycaster,a=new THREE.Vector2,o=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Matrix4,c=[],h=null,d=null,f=this;function p(){r.addEventListener("mousemove",g,!1),r.addEventListener("mousedown",v,!1),r.addEventListener("mouseup",y,!1),r.addEventListener("mouseleave",y,!1),r.addEventListener("touchmove",_,!1),r.addEventListener("touchstart",b,!1),r.addEventListener("touchend",E,!1)}function m(){r.removeEventListener("mousemove",g,!1),r.removeEventListener("mousedown",v,!1),r.removeEventListener("mouseup",y,!1),r.removeEventListener("mouseleave",y,!1),r.removeEventListener("touchmove",_,!1),r.removeEventListener("touchstart",b,!1),r.removeEventListener("touchend",E,!1)}function g(p){if(!1!==f.enabled){p.preventDefault();var m=r.getBoundingClientRect();if(a.x=(p.clientX-m.left)/m.width*2-1,a.y=-(p.clientY-m.top)/m.height*2+1,i.setFromCamera(a,t),h&&f.enabled)return i.ray.intersectPlane(n,s)&&h.position.copy(s.sub(o).applyMatrix4(u)),void f.dispatchEvent({type:"drag",object:h});if(c.length=0,i.setFromCamera(a,t),i.intersectObjects(e,!0,c),c.length>0){var g=c[0].object;n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),l.setFromMatrixPosition(g.matrixWorld)),d!==g&&(f.dispatchEvent({type:"hoveron",object:g}),r.style.cursor="pointer",d=g)}else null!==d&&(f.dispatchEvent({type:"hoveroff",object:d}),r.style.cursor="auto",d=null)}}function v(d){!1!==f.enabled&&(d.preventDefault(),c.length=0,i.setFromCamera(a,t),i.intersectObjects(e,!0,c),c.length>0&&(h=!0===f.transformGroup?e[0]:c[0].object,i.ray.intersectPlane(n,s)&&(u.getInverse(h.parent.matrixWorld),o.copy(s).sub(l.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",f.dispatchEvent({type:"dragstart",object:h})))}function y(e){!1!==f.enabled&&(e.preventDefault(),h&&(f.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor=d?"pointer":"auto")}function _(e){if(!1!==f.enabled){e.preventDefault(),e=e.changedTouches[0];var l=r.getBoundingClientRect();return a.x=(e.clientX-l.left)/l.width*2-1,a.y=-(e.clientY-l.top)/l.height*2+1,i.setFromCamera(a,t),h&&f.enabled?(i.ray.intersectPlane(n,s)&&h.position.copy(s.sub(o).applyMatrix4(u)),void f.dispatchEvent({type:"drag",object:h})):void 0}}function b(d){if(!1!==f.enabled){d.preventDefault(),d=d.changedTouches[0];var p=r.getBoundingClientRect();a.x=(d.clientX-p.left)/p.width*2-1,a.y=-(d.clientY-p.top)/p.height*2+1,c.length=0,i.setFromCamera(a,t),i.intersectObjects(e,!0,c),c.length>0&&(h=!0===f.transformGroup?e[0]:c[0].object,n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),l.setFromMatrixPosition(h.matrixWorld)),i.ray.intersectPlane(n,s)&&(u.getInverse(h.parent.matrixWorld),o.copy(s).sub(l.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",f.dispatchEvent({type:"dragstart",object:h}))}}function E(e){!1!==f.enabled&&(e.preventDefault(),h&&(f.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor="auto")}p(),this.enabled=!0,this.transformGroup=!1,this.activate=p,this.deactivate=m,this.dispose=function(){m()},this.getObjects=function(){return e}},THREE.DragControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.DragControls.prototype.constructor=THREE.DragControls},function(e,t){THREE.TransformControls=function(e,t){void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),THREE.Object3D.call(this),this.visible=!1,this.domElement=t;var r=new THREE.TransformControlsGizmo;this.add(r);var n=new THREE.TransformControlsPlane;this.add(n);var i=this;U("camera",e),U("object",void 0),U("enabled",!0),U("axis",null),U("mode","translate"),U("translationSnap",null),U("rotationSnap",null),U("scaleSnap",null),U("space","world"),U("size",1),U("dragging",!1),U("showX",!0),U("showY",!0),U("showZ",!0);var a={type:"change"},o={type:"mouseDown"},s={type:"mouseUp",mode:i.mode},l={type:"objectChange"},u=new THREE.Raycaster,c=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Quaternion,f={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},p=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,_=new THREE.Vector3,b=0,E=new THREE.Vector3,w=new THREE.Quaternion,x=new THREE.Vector3,T=new THREE.Vector3,M=new THREE.Quaternion,S=new THREE.Quaternion,A=new THREE.Vector3,R=new THREE.Vector3,k=new THREE.Quaternion,P=new THREE.Vector3,L=new THREE.Vector3,C=new THREE.Quaternion,I=new THREE.Quaternion,H=new THREE.Vector3,O=new THREE.Vector3,D=new THREE.Vector3,F=new THREE.Quaternion,N=new THREE.Vector3;function U(e,t){var o=t;Object.defineProperty(i,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,n[e]=t,r[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(a))}}),i[e]=t,n[e]=t,r[e]=t}function B(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};var r=e.changedTouches?e.changedTouches[0]:e,n=t.getBoundingClientRect();return{x:(r.clientX-n.left)/n.width*2-1,y:-(r.clientY-n.top)/n.height*2+1,button:e.button}}function z(e){i.enabled&&i.pointerHover(B(e))}function j(e){i.enabled&&(document.addEventListener("mousemove",V,!1),i.pointerHover(B(e)),i.pointerDown(B(e)))}function V(e){i.enabled&&i.pointerMove(B(e))}function G(e){i.enabled&&(document.removeEventListener("mousemove",V,!1),i.pointerUp(B(e)))}U("worldPosition",L),U("worldPositionStart",R),U("worldQuaternion",C),U("worldQuaternionStart",k),U("cameraPosition",E),U("cameraQuaternion",w),U("pointStart",p),U("pointEnd",m),U("rotationAxis",v),U("rotationAngle",b),U("eye",O),t.addEventListener("mousedown",j,!1),t.addEventListener("touchstart",j,!1),t.addEventListener("mousemove",z,!1),t.addEventListener("touchmove",z,!1),t.addEventListener("touchmove",V,!1),document.addEventListener("mouseup",G,!1),t.addEventListener("touchend",G,!1),t.addEventListener("touchcancel",G,!1),t.addEventListener("touchleave",G,!1),this.dispose=function(){t.removeEventListener("mousedown",j),t.removeEventListener("touchstart",j),t.removeEventListener("mousemove",z),document.removeEventListener("mousemove",V),t.removeEventListener("touchmove",z),t.removeEventListener("touchmove",V),document.removeEventListener("mouseup",G),t.removeEventListener("touchend",G),t.removeEventListener("touchcancel",G),t.removeEventListener("touchleave",G),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(T,M,A),this.object.matrixWorld.decompose(L,C,H),S.copy(M).inverse(),I.copy(C).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(E,w,x),O.copy(E).sub(L).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var t=u.intersectObjects(r.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){u.setFromCamera(e,this.camera);var t=u.intersectObjects([n],!0)[0]||!1;if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),D.copy(this.object.position),F.copy(this.object.quaternion),N.copy(this.object.scale),this.object.matrixWorld.decompose(R,k,P),p.copy(t.point).sub(R)}this.dragging=!0,o.mode=this.mode,this.dispatchEvent(o)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,i=this.object,o=this.space;if("scale"===r?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var s=u.intersectObjects([n],!0)[0]||!1;if(!1!==s){if(m.copy(s.point).sub(R),"translate"===r)g.copy(m).sub(p),"local"===o&&"XYZ"!==t&&g.applyQuaternion(I),-1===t.indexOf("X")&&(g.x=0),-1===t.indexOf("Y")&&(g.y=0),-1===t.indexOf("Z")&&(g.z=0),"local"===o&&"XYZ"!==t?g.applyQuaternion(F).divide(A):g.applyQuaternion(S).divide(A),i.position.copy(g).add(D),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(d.copy(F).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(F)),"world"===o&&(i.parent&&i.position.add(c.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(c.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var E=m.length()/p.length();m.dot(p)<0&&(E*=-1),h.set(E,E,E)}else c.copy(p),h.copy(m),c.applyQuaternion(I),h.applyQuaternion(I),h.divide(c),-1===t.search("X")&&(h.x=1),-1===t.search("Y")&&(h.y=1),-1===t.search("Z")&&(h.z=1);i.scale.copy(N).multiply(h),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){g.copy(m).sub(p);var w=20/L.distanceTo(c.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(v.copy(O),b=m.angleTo(p),y.copy(p).normalize(),_.copy(m).normalize(),b*=_.cross(y).dot(O)<0?1:-1):"XYZE"===t?(v.copy(g).cross(O).normalize(),b=g.dot(c.copy(v).cross(this.eye))*w):"X"!==t&&"Y"!==t&&"Z"!==t||(v.copy(f[t]),c.copy(f[t]),"local"===o&&c.applyQuaternion(C),b=g.dot(c.cross(O).normalize())*w),this.rotationSnap&&(b=Math.round(b/this.rotationSnap)*this.rotationSnap),this.rotationAngle=b,"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(F),i.quaternion.multiply(d.setFromAxisAngle(v,b)).normalize()):(v.applyQuaternion(S),i.quaternion.copy(d.setFromAxisAngle(v,b)),i.quaternion.multiply(F).normalize())}this.dispatchEvent(a),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return i.mode},this.setMode=function(e){i.mode=e},this.setTranslationSnap=function(e){i.translationSnap=e},this.setRotationSnap=function(e){i.rotationSnap=e},this.setScaleSnap=function(e){i.scaleSnap=e},this.setSize=function(e){i.size=e},this.setSpace=function(e){i.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var n=e.clone();n.opacity=.33;var i=e.clone();i.color.set(16711680);var a=e.clone();a.color.set(65280);var o=e.clone();o.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var u=s.clone();u.color.set(65535);var c=s.clone();c.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var d=t.clone();d.color.set(65280);var f=t.clone();f.color.set(255);var p=t.clone();p.color.set(65535);var m=t.clone();m.color.set(16711935);var g=t.clone();g.color.set(16776960);var v=t.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var _=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),b=new THREE.BoxBufferGeometry(.125,.125,.125),E=new THREE.BufferGeometry;E.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var w,x=function(e,t){for(var r=new THREE.BufferGeometry,n=[],i=0;i<=64*t;++i)n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return r.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),r},T={X:[[new THREE.Mesh(_,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(_,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(E,h)]],Y:[[new THREE.Mesh(_,a),[0,1,0],null,null,"fwd"],[new THREE.Mesh(_,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(E,d),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(_,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(_,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(E,f),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s.clone()),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l.clone()),[.15,.15,0]],[new THREE.Line(E,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(E,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(E,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(E,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(E,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},M={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),r)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},S={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new THREE.Line((w=new THREE.BufferGeometry,w.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),w),n),null,null,null,"helper"]],X:[[new THREE.Line(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={X:[[new THREE.Line(x(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(x(1,.5),d),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(x(1,.5),f),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(x(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(x(1,1),v),null,[0,Math.PI/2,0]]]},R={AXIS:[[new THREE.Line(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},k={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),r)]]},P={X:[[new THREE.Mesh(b,i),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(E,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(b,a),[0,.8,0]],[new THREE.Line(E,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(b,o),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(E,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(b,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(E,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(E,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(b,u),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(E,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(b,c),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(E,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(E,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s.clone()),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s.clone()),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s.clone()),[0,0,1.1]]]},L={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(b,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(b,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(b,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},C={X:[[new THREE.Line(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I=function(e){var t=new THREE.Object3D;for(var r in e)for(var n=e[r].length;n--;){var i=e[r][n][0].clone(),a=e[r][n][1],o=e[r][n][2],s=e[r][n][3],l=e[r][n][4];i.name=r,i.tag=l,a&&i.position.set(a[0],a[1],a[2]),o&&i.rotation.set(o[0],o[1],o[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();var u=i.geometry.clone();u.applyMatrix4(i.matrix),i.geometry=u,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t},H=new THREE.Vector3(0,0,0),O=new THREE.Euler,D=new THREE.Vector3(0,1,0),F=new THREE.Vector3(0,0,0),N=new THREE.Matrix4,U=new THREE.Quaternion,B=new THREE.Quaternion,z=new THREE.Quaternion,j=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),G=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=I(T)),this.add(this.gizmo.rotate=I(A)),this.add(this.gizmo.scale=I(P)),this.add(this.picker.translate=I(M)),this.add(this.picker.rotate=I(k)),this.add(this.picker.scale=I(L)),this.add(this.helper.translate=I(S)),this.add(this.helper.rotate=I(R)),this.add(this.helper.scale=I(C)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:z;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var n=0;n<r.length;n++){var i=r[n];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);var a=this.worldPosition.distanceTo(this.cameraPosition);if(i.scale.set(1,1,1).multiplyScalar(a*this.size/7),"helper"!==i.tag){if(i.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==i.name&&"XYZX"!==i.name||Math.abs(D.copy(j).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"!==i.name&&"XYZY"!==i.name||Math.abs(D.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"!==i.name&&"XYZZ"!==i.name||Math.abs(D.copy(G).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(D.copy(G).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(D.copy(j).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(D.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),-1!==i.name.search("X")&&(D.copy(j).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.x*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Y")&&(D.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.y*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Z")&&(D.copy(G).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.z*=-1:"bwd"===i.tag&&(i.visible=!1))}else"rotate"===this.mode&&(B.copy(t),D.copy(this.eye).applyQuaternion(U.copy(t).inverse()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(N.lookAt(this.eye,F,V)),"X"===i.name&&(U.setFromAxisAngle(j,Math.atan2(-D.y,D.z)),U.multiplyQuaternions(B,U),i.quaternion.copy(U)),"Y"===i.name&&(U.setFromAxisAngle(V,Math.atan2(D.x,D.z)),U.multiplyQuaternions(B,U),i.quaternion.copy(U)),"Z"===i.name&&(U.setFromAxisAngle(G,Math.atan2(D.y,D.x)),U.multiplyQuaternions(B,U),i.quaternion.copy(U)));i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._opacity=i.material._opacity||i.material.opacity,i.material._color=i.material._color||i.material.color.clone(),i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled?this.axis&&(i.name===this.axis||this.axis.split("").some((function(e){return i.name===e}))?(i.material.opacity=1,i.material.color.lerp(new THREE.Color(1,1,1),.5)):(i.material.opacity*=.25,i.material.color.lerp(new THREE.Color(1,1,1),.5))):(i.material.opacity*=.5,i.material.color.lerp(new THREE.Color(1,1,1),.5))}else i.visible=!1,"AXIS"===i.name?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,"X"===this.axis&&(U.setFromEuler(O.set(0,0,0)),i.quaternion.copy(t).multiply(U),Math.abs(D.copy(j).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(U.setFromEuler(O.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(U),Math.abs(D.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(U.setFromEuler(O.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(U),Math.abs(D.copy(G).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(U.setFromEuler(O.set(0,Math.PI/2,0)),D.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(N.lookAt(F,D,V)),i.quaternion.multiply(U),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),H.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),H.applyQuaternion(this.worldQuaternionStart.clone().inverse()),i.scale.copy(H),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),r.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),a.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(e),i.copy(e).cross(a);break;case"Y":a.copy(this.eye).cross(t),i.copy(t).cross(a);break;case"Z":a.copy(this.eye).cross(r),i.copy(r).cross(a);break;case"XY":i.copy(r);break;case"YZ":i.copy(e);break;case"XZ":a.copy(r),i.copy(t);break;case"XYZ":case"E":i.set(0,0,0)}break;case"rotate":default:i.set(0,0,0)}0===i.length()?this.quaternion.copy(this.cameraQuaternion):(o.lookAt(n.set(0,0,0),i,a),this.quaternion.setFromRotationMatrix(o)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0})},function(e,t){THREE.GPUComputationRenderer=function(e,t,r){this.variables=[],this.currentTextureIndex=0;var n=new THREE.Scene,i=new THREE.Camera;i.position.z=1;var a={passThruTexture:{value:null}},o=u("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),s=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),o);function l(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function u(e,t){t=t||{};var r=new THREE.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return l(r),r}n.add(s),this.addVariable=function(e,t,r){var n={name:e,initialValueTexture:r,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!r.capabilities.isWebGL2&&!r.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var n=0;n<this.variables.length;n++){var i=this.variables[n];i.renderTargets[0]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.renderTexture(i.initialValueTexture,i.renderTargets[0]),this.renderTexture(i.initialValueTexture,i.renderTargets[1]);var a=i.material,o=a.uniforms;if(null!==i.dependencies)for(var s=0;s<i.dependencies.length;s++){var l=i.dependencies[s];if(l.name!==i.name){for(var u=!1,c=0;c<this.variables.length;c++)if(l.name===this.variables[c].name){u=!0;break}if(!u)return"Variable dependency not found. Variable="+i.name+", dependency="+l.name}o[l.name]={value:null},a.fragmentShader="\nuniform sampler2D "+l.name+";\n"+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,r=0,n=this.variables.length;r<n;r++){var i=this.variables[r];if(null!==i.dependencies)for(var a=i.material.uniforms,o=0,s=i.dependencies.length;o<s;o++){var l=i.dependencies[o];a[l.name].value=l.renderTargets[e].texture}this.doRenderTarget(i.material,i.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=l,this.createShaderMaterial=u,this.createRenderTarget=function(r,n,i,a,o,s){return r=r||e,n=n||t,i=i||THREE.ClampToEdgeWrapping,a=a||THREE.ClampToEdgeWrapping,o=o||THREE.NearestFilter,s=s||THREE.NearestFilter,new THREE.WebGLRenderTarget(r,n,{wrapS:i,wrapT:a,minFilter:o,magFilter:s,format:THREE.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?THREE.HalfFloatType:THREE.FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var r=new Float32Array(e*t*4);return new THREE.DataTexture(r,e,t,THREE.RGBAFormat,THREE.FloatType)},this.renderTexture=function(e,t){a.passThruTexture.value=e,this.doRenderTarget(o,t),a.passThruTexture.value=null},this.doRenderTarget=function(e,t){var a=r.getRenderTarget();s.material=e,r.setRenderTarget(t),r.render(n,i),s.material=o,r.setRenderTarget(a)}}},function(e,t){THREE.ImprovedNoise=function(){for(var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;t<256;t++)e[256+t]=e[t];function r(e){return e*e*e*(e*(6*e-15)+10)}function n(e,t,r){return t+e*(r-t)}function i(e,t,r,n){var i=15&e,a=i<8?t:r,o=i<4?r:12==i||14==i?t:n;return(0==(1&i)?a:-a)+(0==(2&i)?o:-o)}return{noise:function(t,a,o){var s=Math.floor(t),l=Math.floor(a),u=Math.floor(o),c=255&s,h=255&l,d=255&u,f=(t-=s)-1,p=(a-=l)-1,m=(o-=u)-1,g=r(t),v=r(a),y=r(o),_=e[c]+h,b=e[_]+d,E=e[_+1]+d,w=e[c+1]+h,x=e[w]+d,T=e[w+1]+d;return n(y,n(v,n(g,i(e[b],t,a,o),i(e[x],f,a,o)),n(g,i(e[E],t,p,o),i(e[T],f,p,o))),n(v,n(g,i(e[b+1],t,a,m),i(e[x+1],f,a,o-1)),n(g,i(e[E+1],t,p,m),i(e[T+1],f,p,m))))}}}},function(e,t){THREE.SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]},THREE.SimplexNoise.prototype.dot=function(e,t,r){return e[0]*t+e[1]*r},THREE.SimplexNoise.prototype.dot3=function(e,t,r,n){return e[0]*t+e[1]*r+e[2]*n},THREE.SimplexNoise.prototype.dot4=function(e,t,r,n,i){return e[0]*t+e[1]*r+e[2]*n+e[3]*i},THREE.SimplexNoise.prototype.noise=function(e,t){var r,n,i=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+i),o=Math.floor(t+i),s=(3-Math.sqrt(3))/6,l=(a+o)*s,u=e-(a-l),c=t-(o-l);u>c?(r=1,n=0):(r=0,n=1);var h=u-r+s,d=c-n+s,f=u-1+2*s,p=c-1+2*s,m=255&a,g=255&o,v=this.perm[m+this.perm[g]]%12,y=this.perm[m+r+this.perm[g+n]]%12,_=this.perm[m+1+this.perm[g+1]]%12,b=.5-u*u-c*c,E=.5-h*h-d*d,w=.5-f*f-p*p;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[v],u,c))+(E<0?0:(E*=E)*E*this.dot(this.grad3[y],h,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[_],f,p)))},THREE.SimplexNoise.prototype.noise3d=function(e,t,r){var n,i,a,o,s,l,u=(e+t+r)*(1/3),c=Math.floor(e+u),h=Math.floor(t+u),d=Math.floor(r+u),f=1/6,p=(c+h+d)*f,m=e-(c-p),g=t-(h-p),v=r-(d-p);m>=g?g>=v?(n=1,i=0,a=0,o=1,s=1,l=0):m>=v?(n=1,i=0,a=0,o=1,s=0,l=1):(n=0,i=0,a=1,o=1,s=0,l=1):g<v?(n=0,i=0,a=1,o=0,s=1,l=1):m<v?(n=0,i=1,a=0,o=0,s=1,l=1):(n=0,i=1,a=0,o=1,s=1,l=0);var y=m-n+f,_=g-i+f,b=v-a+f,E=m-o+2*f,w=g-s+2*f,x=v-l+2*f,T=m-1+.5,M=g-1+.5,S=v-1+.5,A=255&c,R=255&h,k=255&d,P=this.perm[A+this.perm[R+this.perm[k]]]%12,L=this.perm[A+n+this.perm[R+i+this.perm[k+a]]]%12,C=this.perm[A+o+this.perm[R+s+this.perm[k+l]]]%12,I=this.perm[A+1+this.perm[R+1+this.perm[k+1]]]%12,H=.6-m*m-g*g-v*v,O=.6-y*y-_*_-b*b,D=.6-E*E-w*w-x*x,F=.6-T*T-M*M-S*S;return 32*((H<0?0:(H*=H)*H*this.dot3(this.grad3[P],m,g,v))+(O<0?0:(O*=O)*O*this.dot3(this.grad3[L],y,_,b))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[C],E,w,x))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[I],T,M,S)))},THREE.SimplexNoise.prototype.noise4d=function(e,t,r,n){var i,a,o,s,l,u,c,h,d,f,p,m,g=this.grad4,v=this.simplex,y=this.perm,_=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,E=(e+t+r+n)*_,w=Math.floor(e+E),x=Math.floor(t+E),T=Math.floor(r+E),M=Math.floor(n+E),S=(w+x+T+M)*b,A=e-(w-S),R=t-(x-S),k=r-(T-S),P=n-(M-S),L=(A>R?32:0)+(A>k?16:0)+(R>k?8:0)+(A>P?4:0)+(R>P?2:0)+(k>P?1:0),C=A-(i=v[L][0]>=3?1:0)+b,I=R-(a=v[L][1]>=3?1:0)+b,H=k-(o=v[L][2]>=3?1:0)+b,O=P-(s=v[L][3]>=3?1:0)+b,D=A-(l=v[L][0]>=2?1:0)+2*b,F=R-(u=v[L][1]>=2?1:0)+2*b,N=k-(c=v[L][2]>=2?1:0)+2*b,U=P-(h=v[L][3]>=2?1:0)+2*b,B=A-(d=v[L][0]>=1?1:0)+3*b,z=R-(f=v[L][1]>=1?1:0)+3*b,j=k-(p=v[L][2]>=1?1:0)+3*b,V=P-(m=v[L][3]>=1?1:0)+3*b,G=A-1+4*b,W=R-1+4*b,X=k-1+4*b,Y=P-1+4*b,q=255&w,Z=255&x,K=255&T,Q=255&M,J=y[q+y[Z+y[K+y[Q]]]]%32,$=y[q+i+y[Z+a+y[K+o+y[Q+s]]]]%32,ee=y[q+l+y[Z+u+y[K+c+y[Q+h]]]]%32,te=y[q+d+y[Z+f+y[K+p+y[Q+m]]]]%32,re=y[q+1+y[Z+1+y[K+1+y[Q+1]]]]%32,ne=.6-A*A-R*R-k*k-P*P,ie=.6-C*C-I*I-H*H-O*O,ae=.6-D*D-F*F-N*N-U*U,oe=.6-B*B-z*z-j*j-V*V,se=.6-G*G-W*W-X*X-Y*Y;return 27*((ne<0?0:(ne*=ne)*ne*this.dot4(g[J],A,R,k,P))+(ie<0?0:(ie*=ie)*ie*this.dot4(g[$],C,I,H,O))+(ae<0?0:(ae*=ae)*ae*this.dot4(g[ee],D,F,N,U))+(oe<0?0:(oe*=oe)*oe*this.dot4(g[te],B,z,j,V))+(se<0?0:(se*=se)*se*this.dot4(g[re],G,W,X,Y)))}},function(e,t){THREE.Lut=function(e,t){return this.lut=[],this.setColorMap(e,t),this},THREE.Lut.prototype={constructor:THREE.Lut,lut:[],map:[],n:256,minV:0,maxV:1,set:function(e){return e instanceof THREE.Lut&&this.copy(e),this},setMin:function(e){return this.minV=e,this},setMax:function(e){return this.maxV=e,this},setColorMap:function(e,t){this.map=THREE.ColorMapKeywords[e]||THREE.ColorMapKeywords.rainbow,this.n=t||32;var r=1/this.n;this.lut.length=0;for(var n=0;n<=1;n+=r)for(var i=0;i<this.map.length-1;i++)if(n>=this.map[i][0]&&n<this.map[i+1][0]){var a=this.map[i][0],o=this.map[i+1][0],s=new THREE.Color(this.map[i][1]),l=new THREE.Color(this.map[i+1][1]),u=s.lerp(l,(n-a)/(o-a));this.lut.push(u)}return this},copy:function(e){return this.lut=e.lut,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this},getColor:function(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);var t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]},addColorMap:function(e,t){THREE.ColorMapKeywords[e]=t},createCanvas:function(){var e=document.createElement("canvas");return e.width=1,e.height=this.n,this.updateCanvas(e),e},updateCanvas:function(e){for(var t=e.getContext("2d",{alpha:!1}),r=t.getImageData(0,0,1,this.n),n=r.data,i=0,a=1/this.n,o=1;o>=0;o-=a)for(var s=this.map.length-1;s>=0;s--)if(o<this.map[s][0]&&o>=this.map[s-1][0]){var l=this.map[s-1][0],u=this.map[s][0],c=new THREE.Color(this.map[s-1][1]),h=new THREE.Color(this.map[s][1]),d=c.lerp(h,(o-l)/(u-l));n[4*i]=Math.round(255*d.r),n[4*i+1]=Math.round(255*d.g),n[4*i+2]=Math.round(255*d.b),n[4*i+3]=255,i+=1}return t.putImageData(r,0,0),e}},THREE.ColorMapKeywords={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]}},function(e,t){THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function r(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}function n(e,t){var r,n,i,a=t.position.distanceTo(e.position),o=0,s=[],l=e.faces.length;for(r=0;r<l;r++)(n=e.faces[r]).hasVertex(t)&&s.push(n);for(r=0;r<l;r++){var u=1;n=e.faces[r];for(var c=0;c<s.length;c++){i=s[c];var h=n.normal.dot(i.normal);u=Math.min(u,(1.001-h)/2)}o=Math.max(o,u)}return s.length<2&&(o=1),a*o+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var r=n(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}function a(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){r(e.neighbors.pop().neighbors,e)}r(t,e)}function o(e,t){r(t,e),e.v1&&r(e.v1.faces,e),e.v2&&r(e.v2.faces,e),e.v3&&r(e.v3.faces,e);for(var n,i,a=[e.v1,e.v2,e.v3],o=0;o<3;o++)i=a[(o+1)%3],(n=a[o])&&i&&(n.removeIfNonNeighbor(i),i.removeIfNonNeighbor(n))}function s(e,t,r,n){if(n){var s,l=[];for(s=0;s<r.neighbors.length;s++)l.push(r.neighbors[s]);for(s=r.faces.length-1;s>=0;s--)r.faces[s].hasVertex(n)&&o(r.faces[s],t);for(s=r.faces.length-1;s>=0;s--)r.faces[s].replaceVertex(r,n);for(a(r,e),s=0;s<l.length;s++)i(l[s])}else a(r,e)}function l(e){for(var t=e[0],r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}function u(e,t,r,n,i,a){this.a=n,this.b=i,this.c=a,this.v1=e,this.v2=t,this.v3=r,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function c(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}u.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position,i=this.v3.position;e.subVectors(i,n),t.subVectors(r,n),e.cross(t).normalize(),this.normal.copy(e)},u.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},u.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),r(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},c.prototype.addUniqueNeighbor=function(e){!function(e,t){-1===e.indexOf(t)&&e.push(t)}(this.neighbors,e)},c.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(e))return;t.splice(n,1)}},THREE.SimplifyModifier.prototype.modify=function(e,t){e.isBufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var r,n,a,o=e.vertices,h=e.faces,d=[],f=[];for(r=0,n=o.length;r<n;r++){var p=new c(o[r],r);d.push(p)}for(r=0,n=h.length;r<n;r++){var m=(x=h[r]).a,g=x.b,v=x.c,y=new u(d[m],d[g],d[v],m,g,v);f.push(y)}for(r=0,n=d.length;r<n;r++)i(d[r]);for(var _=t;_--;){if(!(a=l(d))){console.log("THREE.SimplifyModifier: No next vertex");break}s(d,f,a,a.collapseNeighbor)}var b=new THREE.BufferGeometry,E=[],w=[];for(r=0;r<d.length;r++){p=d[r].position;E.push(p.x,p.y,p.z)}for(r=0;r<f.length;r++){var x=f[r];m=d.indexOf(x.v1),g=d.indexOf(x.v2),v=d.indexOf(x.v3);w.push(m,g,v)}return b.setAttribute("position",new THREE.Float32BufferAttribute(E,3)),b.setIndex(w),b}}()},function(e,t){THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){(e=e.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this.smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e},function(){var e=["a","b","c"];function t(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function r(e,t,r,n,i,a){var o,s=Math.min(e,t),l=Math.max(e,t),u=s+"_"+l;u in n?o=n[u]:(o={a:r[s],b:r[l],newEdge:null,faces:[]},n[u]=o);o.faces.push(i),a[e].edges.push(o),a[t].edges.push(o)}function n(e,t,r,n,i){e.push(new THREE.Face3(t,r,n,void 0,void 0,i))}function i(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function a(e,t,r,n){e.push([t.clone(),r.clone(),n.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(o){var s,l,u,c,h,d,f,p,m,g,v,y,_,b=new THREE.Vector3,E=[];s=o.vertices,l=o.faces;var w,x,T,M,S,A,R,k,P,L,C,I,H,O,D=void 0!==(u=o.faceVertexUvs)[0]&&u[0].length>0;if(D)for(var F=0;F<u.length;F++)E.push([]);for(f in function(e,t,n,i){var a,o,s;for(a=0,o=e.length;a<o;a++)n[a]={edges:[]};for(a=0,o=t.length;a<o;a++)r((s=t[a]).a,s.b,e,i,s,n),r(s.b,s.c,e,i,s,n),r(s.c,s.a,e,i,s,n)}(s,l,g=new Array(s.length),v={}),y=[],v){for(x=v[f],T=new THREE.Vector3,S=3/8,A=1/8,2!=(R=x.faces.length)&&(S=.5,A=0),T.addVectors(x.a,x.b).multiplyScalar(S),b.set(0,0,0),F=0;F<R;F++){for(M=x.faces[F],m=0;m<3&&((w=s[M[e[m]]])===x.a||w===x.b);m++);b.add(w)}b.multiplyScalar(A),T.add(b),x.newEdge=y.length,y.push(T)}for(_=[],f=0,p=s.length;f<p;f++){for(H=s[f],3==(d=(I=g[f].edges).length)?k=3/16:d>3&&(k=3/(8*d)),P=1-d*k,L=k,d<=2&&2==d&&(P=3/4,L=1/8),O=H.clone().multiplyScalar(P),b.set(0,0,0),F=0;F<d;F++)w=(C=I[F]).a!==H?C.a:C.b,b.add(w);b.multiplyScalar(L),O.add(b),_.push(O)}c=_.concat(y);var N,U,B,z,j,V,G,W=_.length;h=[];var X=new THREE.Vector2,Y=new THREE.Vector2,q=new THREE.Vector2;for(f=0,p=l.length;f<p;f++)if(n(h,N=t((M=l[f]).a,M.b,v).newEdge+W,U=t(M.b,M.c,v).newEdge+W,B=t(M.c,M.a,v).newEdge+W,M.materialIndex),n(h,M.a,N,B,M.materialIndex),n(h,M.b,U,N,M.materialIndex),n(h,M.c,B,U,M.materialIndex),D)for(F=0;F<u.length;F++)j=(z=u[F][f])[0],V=z[1],G=z[2],X.set(i(j.x,V.x),i(j.y,V.y)),Y.set(i(V.x,G.x),i(V.y,G.y)),q.set(i(j.x,G.x),i(j.y,G.y)),a(E[F],X,Y,q),a(E[F],j,X,q),a(E[F],V,Y,X),a(E[F],G,q,Y);o.vertices=c,o.faces=h,D&&(o.faceVertexUvs=E)}}()},function(e,t){THREE.ConvexHull=function(){var e,t,r,n,i=new THREE.Vector3;function a(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new u,this.unassigned=new u,this.vertices=[]}function o(){this.normal=new THREE.Vector3,this.midpoint=new THREE.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function s(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function l(e){this.point=e,this.prev=null,this.next=null,this.face=null}function u(){this.head=null,this.tail=null}return Object.assign(a.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.vertices.push(new l(e[t]));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,i,a=e.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(r=0,n=o.length;r<n;r++)(i=o[r].clone()).applyMatrix4(e.matrixWorld),t.push(i)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(r=0,n=s.count;r<n;r++)(i=new THREE.Vector3).fromBufferAttribute(s,r).applyMatrix4(e.matrixWorld),t.push(i)}})),this.setFromPoints(t)},containsPoint:function(e){for(var t=this.faces,r=0,n=t.length;r<n;r++){if(t[r].distanceToPoint(e)>this.tolerance)return!1}return!0},intersectRay:function(e,t){for(var r=this.faces,n=-1/0,i=1/0,a=0,o=r.length;a<o;a++){var s=r[a],l=s.distanceToPoint(e.origin),u=s.normal.dot(e.direction);if(l>0&&u>=0)return null;var c=0!==u?-l/u:0;if(!(c<=0)&&(u>0?i=Math.min(c,i):n=Math.max(c,n),n>i))return null}return n!==-1/0?e.at(n,t):e.at(i,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,i)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,r=e.outside;null!==r.next&&r.next.face===e;)r=r.next;return this.assigned.removeSubList(t,r),t.prev=r.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var r=this.removeAllVerticesFromFace(e);if(void 0!==r)if(void 0===t)this.unassigned.appendChain(r);else{var n=r;do{var i=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=i}while(null!==n)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var r=t.next,n=this.tolerance,i=null,a=0;a<e.length;a++){var o=e[a];if(0===o.mark){var s=o.distanceToPoint(t.point);if(s>n&&(n=s,i=o),n>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(t,i),t=r}while(null!==t)}return this},computeExtremes:function(){var e,t,r,n=new THREE.Vector3,i=new THREE.Vector3,a=[],o=[];for(e=0;e<3;e++)a[e]=o[e]=this.vertices[0];for(n.copy(this.vertices[0].point),i.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var s=this.vertices[e],l=s.point;for(r=0;r<3;r++)l.getComponent(r)<n.getComponent(r)&&(n.setComponent(r,l.getComponent(r)),a[r]=s);for(r=0;r<3;r++)l.getComponent(r)>i.getComponent(r)&&(i.setComponent(r,l.getComponent(r)),o[r]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(i.x))+Math.max(Math.abs(n.y),Math.abs(i.y))+Math.max(Math.abs(n.z),Math.abs(i.z))),{min:a,max:o}},computeInitialHull:function(){void 0===e&&(e=new THREE.Line3,t=new THREE.Plane,r=new THREE.Vector3);var n,i,a,s,l,u,c,h,d,f=this.vertices,p=this.computeExtremes(),m=p.min,g=p.max,v=0,y=0;for(u=0;u<3;u++)(d=g[u].point.getComponent(u)-m[u].point.getComponent(u))>v&&(v=d,y=u);for(i=m[y],a=g[y],v=0,e.set(i.point,a.point),u=0,c=this.vertices.length;u<c;u++)(n=f[u])!==i&&n!==a&&(e.closestPointToPoint(n.point,!0,r),(d=r.distanceToSquared(n.point))>v&&(v=d,s=n));for(v=-1,t.setFromCoplanarPoints(i.point,a.point,s.point),u=0,c=this.vertices.length;u<c;u++)(n=f[u])!==i&&n!==a&&n!==s&&(d=Math.abs(t.distanceToPoint(n.point)))>v&&(v=d,l=n);var _=[];if(t.distanceToPoint(l.point)<0)for(_.push(o.create(i,a,s),o.create(l,a,i),o.create(l,s,a),o.create(l,i,s)),u=0;u<3;u++)h=(u+1)%3,_[u+1].getEdge(2).setTwin(_[0].getEdge(h)),_[u+1].getEdge(1).setTwin(_[h+1].getEdge(0));else for(_.push(o.create(i,s,a),o.create(l,i,a),o.create(l,a,s),o.create(l,s,i)),u=0;u<3;u++)h=(u+1)%3,_[u+1].getEdge(2).setTwin(_[0].getEdge((3-u)%3)),_[u+1].getEdge(0).setTwin(_[h+1].getEdge(1));for(u=0;u<4;u++)this.faces.push(_[u]);for(u=0,c=f.length;u<c;u++)if((n=f[u])!==i&&n!==a&&n!==s&&n!==l){v=this.tolerance;var b=null;for(h=0;h<4;h++)(d=this.faces[h].distanceToPoint(n.point))>v&&(v=d,b=this.faces[h]);null!==b&&this.addVertexToFace(n,b)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var r=this.faces[t];0===r.mark&&e.push(r)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,r=this.assigned.first().face,n=r.outside;do{var i=r.distanceToPoint(n.point);i>t&&(t=i,e=n),n=n.next}while(null!==n&&n.face===r);return e}},computeHorizon:function(e,t,r,n){var i;this.deleteFaceVertices(r),r.mark=1,i=null===t?t=r.getEdge(0):t.next;do{var a=i.twin,o=a.face;0===o.mark&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,a,o,n):n.push(i)),i=i.next}while(i!==t);return this},addAdjoiningFace:function(e,t){var r=o.create(e,t.tail(),t.head());return this.faces.push(r),r.getEdge(-1).setTwin(t.twin),r.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var r=null,n=null,i=0;i<t.length;i++){var a=t[i],o=this.addAdjoiningFace(e,a);null===r?r=o:o.next.setTwin(n),this.newFaces.push(o.face),n=o}return r.next.setTwin(n),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(o,{create:function(e,t,r){var n=new o,i=new s(e,n),a=new s(t,n),l=new s(r,n);return i.next=l.prev=a,a.next=i.prev=l,l.next=a.prev=i,n.edge=i,n.compute()}}),Object.assign(o.prototype,{getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===n&&(n=new THREE.Triangle);var e=this.edge.tail(),t=this.edge.head(),r=this.edge.next.head();return n.set(e.point,t.point,r.point),n.getNormal(this.normal),n.getMidpoint(this.midpoint),this.area=n.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(s.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(u.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),a}()},function(e,t){THREE.ConvexGeometry=function(e){THREE.Geometry.call(this),this.fromBufferGeometry(new THREE.ConvexBufferGeometry(e)),this.mergeVertices()},THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ConvexGeometry.prototype.constructor=THREE.ConvexGeometry,THREE.ConvexBufferGeometry=function(e){THREE.BufferGeometry.call(this);var t=[],r=[];void 0===THREE.ConvexHull&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on THREE.ConvexHull");for(var n=(new THREE.ConvexHull).setFromPoints(e).faces,i=0;i<n.length;i++){var a=n[i],o=a.edge;do{var s=o.head().point;t.push(s.x,s.y,s.z),r.push(a.normal.x,a.normal.y,a.normal.z),o=o.next}while(o!==a.edge)}this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.setAttribute("normal",new THREE.Float32BufferAttribute(r,3))},THREE.ConvexBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.ConvexBufferGeometry.prototype.constructor=THREE.ConvexBufferGeometry},function(e,t){THREE.LegacyJSONLoader=function(){function e(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1}return Object.assign(e.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){var n=JSON.parse(r),o=n.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(n,a);t(l.geometry,l.materials)}),r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new THREE.Geometry;return function(e,t){function r(e,t){return e&1<<t}var n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S,A,R,k,P=e.faces,L=e.vertices,C=e.normals,I=e.colors,H=e.scale,O=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&O++;for(n=0;n<O;n++)t.faceVertexUvs[n]=[]}for(o=0,s=L.length;o<s;)(b=new THREE.Vector3).x=L[o++]*H,b.y=L[o++]*H,b.z=L[o++]*H,t.vertices.push(b);for(o=0,s=P.length;o<s;)if(f=r(d=P[o++],0),p=r(d,1),m=r(d,3),g=r(d,4),v=r(d,5),y=r(d,6),_=r(d,7),f){if((w=new THREE.Face3).a=P[o],w.b=P[o+1],w.c=P[o+3],(x=new THREE.Face3).a=P[o+1],x.b=P[o+2],x.c=P[o+3],o+=4,p&&(h=P[o++],w.materialIndex=h,x.materialIndex=h),a=t.faces.length,m)for(n=0;n<O;n++)for(S=e.uvs[n],t.faceVertexUvs[n][a]=[],t.faceVertexUvs[n][a+1]=[],i=0;i<4;i++)R=S[2*(c=P[o++])],k=S[2*c+1],A=new THREE.Vector2(R,k),2!==i&&t.faceVertexUvs[n][a].push(A),0!==i&&t.faceVertexUvs[n][a+1].push(A);if(g&&(u=3*P[o++],w.normal.set(C[u++],C[u++],C[u]),x.normal.copy(w.normal)),v)for(n=0;n<4;n++)u=3*P[o++],M=new THREE.Vector3(C[u++],C[u++],C[u]),2!==n&&w.vertexNormals.push(M),0!==n&&x.vertexNormals.push(M);if(y&&(T=I[l=P[o++]],w.color.setHex(T),x.color.setHex(T)),_)for(n=0;n<4;n++)T=I[l=P[o++]],2!==n&&w.vertexColors.push(new THREE.Color(T)),0!==n&&x.vertexColors.push(new THREE.Color(T));t.faces.push(w),t.faces.push(x)}else{if((E=new THREE.Face3).a=P[o++],E.b=P[o++],E.c=P[o++],p&&(h=P[o++],E.materialIndex=h),a=t.faces.length,m)for(n=0;n<O;n++)for(S=e.uvs[n],t.faceVertexUvs[n][a]=[],i=0;i<3;i++)R=S[2*(c=P[o++])],k=S[2*c+1],A=new THREE.Vector2(R,k),t.faceVertexUvs[n][a].push(A);if(g&&(u=3*P[o++],E.normal.set(C[u++],C[u++],C[u])),v)for(n=0;n<3;n++)u=3*P[o++],M=new THREE.Vector3(C[u++],C[u++],C[u]),E.vertexNormals.push(M);if(y&&(l=P[o++],E.color.setHex(I[l])),_)for(n=0;n<3;n++)l=P[o++],E.vertexColors.push(new THREE.Color(I[l]));t.faces.push(E)}}(e,r),function(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=r){var a=e.skinWeights[n],o=r>1?e.skinWeights[n+1]:0,s=r>2?e.skinWeights[n+2]:0,l=r>3?e.skinWeights[n+3]:0;t.skinWeights.push(new THREE.Vector4(a,o,s,l))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=r){var u=e.skinIndices[n],c=r>1?e.skinIndices[n+1]:0,h=r>2?e.skinIndices[n+2]:0,d=r>3?e.skinIndices[n+3]:0;t.skinIndices.push(new THREE.Vector4(u,c,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;n<i;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var a=t.morphTargets[n].vertices,o=e.morphTargets[n].vertices,s=0,l=o.length;s<l;s+=3){var u=new THREE.Vector3;u.x=o[s]*r,u.y=o[s+1]*r,u.z=o[s+2]*r,a.push(u)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var c=t.faces,h=e.morphColors[0].colors;for(n=0,i=c.length;n<i;n++)c[n].color.fromArray(h,3*n)}}(e,r),function(e,t){var r=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var a=THREE.AnimationClip.parseAnimation(n[i],t.bones);a&&r.push(a)}if(t.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(o)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:THREE.Loader.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}),e}()},function(e,t){THREE.LensFlare=function(){THREE.Group.call(this),this.type="LensFlare",this.positionScreen=new THREE.Vector3,this.flareVisible=!1;var e=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.needsUpdate=!0;var t=new THREE.DataTexture(new Uint8Array(1024),16,16,THREE.RGBAFormat);t.minFilter=THREE.NearestFilter,t.magFilter=THREE.NearestFilter,t.needsUpdate=!0;var r=THREE.LensFlare.Shader,n=new THREE.RawShaderMaterial({uniforms:r.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthWrite:!1}),i=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),n);i.frustumCulled=!1;var a=new THREE.Vector2,o=new THREE.Vector2,s=new THREE.Box2,l=0;this.update=function(r,n,c){if(r instanceof THREE.WebGLRenderer){var h=r.info.render.frame;if(l!==h){l=h;var d=c.w/c.z,f=.5*c.z,p=.5*c.w,m=16/c.w;a.set(m*d,m),s.min.set(c.x,c.y),s.max.set(c.x+(c.z-16),c.y+(c.w-16)),this.positionScreen.setFromMatrixPosition(this.matrixWorld),this.positionScreen.applyMatrix4(n.matrixWorldInverse),this.positionScreen.applyMatrix4(n.projectionMatrix),o.x=c.x+this.positionScreen.x*f+f-8,o.y=c.y+this.positionScreen.y*p+p-8,!0===s.containsPoint(o)?(this.flareVisible=!0,r.copyFramebufferToTexture(o,e),i.material.uniforms.renderType.value=0,i.material.uniforms.scale.value=a,i.material.uniforms.screenPosition.value=this.positionScreen,i.material.depthTest=!0,r.render(i,n),r.copyFramebufferToTexture(o,t),i.material.uniforms.renderType.value=1,i.material.uniforms.map.value=e,i.material.depthTest=!1,r.render(i,n),function(){for(var e=2*-u.positionScreen.x,t=2*-u.positionScreen.y,r=0,n=u.children.length;r<n;r++){var i=u.children[r];i.flarePosition.x=u.positionScreen.x+e*i.flareDistance,i.flarePosition.y=u.positionScreen.y+t*i.flareDistance}}()):this.flareVisible=!1}}};var u=this;this.getOcclusionMap=function(){return t},this.dispose=function(){i.material.dispose(),e.dispose(),t.dispose()}},THREE.LensFlare.prototype=Object.create(THREE.Group.prototype),THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.isLensFlare=!0,THREE.LensFlare.Shader={uniforms:{renderType:{value:0},map:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform lowp int renderType;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else {","\t\tgl_FragColor = texture2D( map, vUV );","\t}","}"].join("\n")},THREE.LensFlareElement=function(e,t,r,n,i,a){THREE.Mesh.call(this),this.type="LensFlareElement",this.frustumCulled=!1,this.renderOrder=1/0,this.flareTexture=e,this.flareSize=t||1,this.flareDistance=r||0,this.flareBlending=i||THREE.AdditiveBlending,this.flareColor=n||new THREE.Color(16777215),this.flareOpacity=a||1,this.flarePosition=new THREE.Vector3,this.flareRotation=0,this.geometry=new THREE.PlaneBufferGeometry(2,2);var o=THREE.LensFlareElement.Shader;this.material=new THREE.RawShaderMaterial({uniforms:o.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:this.flareBlending,transparent:!0,depthWrite:!1});var s=new THREE.Vector2,l=new THREE.Vector4;this.onBeforeRender=function(e,t,r,n,i,a){var o=this.parent;if(null!==o){e.getCurrentViewport(l),o.update(e,r,l);var u=this.flareSize/l.w,c=l.w/l.z;s.set(u*c,u),this.material.uniforms.map.value=this.flareTexture,this.material.uniforms.occlusionMap.value=o.getOcclusionMap(),this.material.uniforms.opacity.value=this.flareOpacity,this.material.uniforms.color.value=this.flareColor,this.material.uniforms.scale.value=s,this.material.uniforms.rotation.value=this.flareRotation,this.material.uniforms.screenPosition.value=this.flarePosition,!1===o.flareVisible&&(this.material.uniforms.opacity.value=0)}else console.error("THREE.LensFlareElement: LensFlareElement not assigned to a LensFlare. Rendering not possible.")},this.dispose=function(){this.material.dispose()}},THREE.LensFlareElement.prototype=Object.create(THREE.Mesh.prototype),THREE.LensFlareElement.prototype.constructor=THREE.LensFlareElement,THREE.LensFlareElement.prototype.isLensFlareElement=!0,THREE.LensFlareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},opacity:{value:1},color:{value:null},scale:{value:null},rotation:{value:0},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );"," visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tvVisibility *= 1.0 - visibility.a / 9.0;","\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= opacity * vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")}},function(e,t){THREE.PhysicsRenderer=function(e,t,r){this.checkCompatibility(r),this.renderer=r,this.size=e||128,this.resolution=new THREE.Vector2(this.size,this.size),this.rt_1=new THREE.WebGLRenderTarget(this.size,this.size,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType,stencilBuffer:!1}),this.rt_2=this.rt_1.clone(),this.rt_3=this.rt_1.clone(),this.counter=0,this.texturePass=this.createTexturePassProgram(),this.simulatePass=this.createSimulatePassProgram(t),this.boundTextures=[],this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2)),this.scene.add(this.mesh)},THREE.PhysicsRenderer.prototype.checkCompatibility=function(e){var t=e.getContext();null!==t.getExtension("OES_texture_float")?0!==t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)||this.onError("Vertex Shader Textures don't work"):this.onError("No Float Textures")},THREE.PhysicsRenderer.prototype.onError=function(e){console.log(e)},THREE.PhysicsRenderer.prototype.createDebugScene=function(){var e=new THREE.Object3D;e.position.z=0;var t,r=new THREE.PlaneBufferGeometry(100,100);return(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_1}))).position.set(-105,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_2}))).position.set(0,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_3}))).position.set(105,0,0),e.add(t),e},THREE.PhysicsRenderer.prototype.removeDebugScene=function(e){e.remove(this.debugScene)},THREE.PhysicsRenderer.prototype.addDebugScene=function(e){e.add(this.debugScene)},THREE.PhysicsRenderer.prototype.createTexturePassProgram=function(){return new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:null}},vertexShader:this.VSPass,fragmentShader:this.FSPass})},THREE.PhysicsRenderer.prototype.createSimulatePassProgram=function(e){var t={t_oPos:{type:"t",value:null},t_pos:{type:"t",value:null},resolution:{type:"v2",value:this.resolution}};return new THREE.ShaderMaterial({uniforms:t,vertexShader:this.VSPass,fragmentShader:e})},THREE.PhysicsRenderer.prototype.update=function(){var e=this.counter%3;0==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_1.texture,this.simulatePass.uniforms.t_pos.value=this.rt_2.texture,this.pass(this.simulatePass,this.rt_3),this.ooOutput=this.rt_1.texture,this.oOutput=this.rt_2.texture,this.output=this.rt_3.texture):1==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_2.texture,this.simulatePass.uniforms.t_pos.value=this.rt_3.texture,this.pass(this.simulatePass,this.rt_1),this.ooOutput=this.rt_2.texture,this.oOutput=this.rt_3.texture,this.output=this.rt_1.texture):2==e&&(this.simulatePass.uniforms.t_oPos.value=this.rt_3.texture,this.simulatePass.uniforms.t_pos.value=this.rt_1.texture,this.pass(this.simulatePass,this.rt_2),this.ooOutput=this.rt_3.texture,this.oOutput=this.rt_1.texture,this.output=this.rt_2.texture),this.counter++,this.bindTextures()},THREE.PhysicsRenderer.prototype.render=function(e,t,r){this.renderer.setRenderTarget(r),this.renderer.render(e,t)},THREE.PhysicsRenderer.prototype.pass=function(e,t){this.mesh.material=e,this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.out=function(e){this.mesh.material=e.material,this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.setUniforms=function(e){for(var t in e)this.simulatePass.uniforms[t]=e[t];this.simulatePass.uniforms.t_pos={type:"t",value:null},this.simulatePass.uniforms.t_oPos={type:"t",value:null},this.simulatePass.uniforms.resolution={type:"v2",value:this.resolution}},THREE.PhysicsRenderer.prototype.setUniform=function(e,t){this.simulatePass.uniforms[e]=t},THREE.PhysicsRenderer.prototype.reset=function(e){this.texture=e,this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,this.rt_1),this.pass(this.texturePass,this.rt_2),this.pass(this.texturePass,this.rt_3)},THREE.PhysicsRenderer.prototype.passTexture=function(e,t){this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,t)},THREE.PhysicsRenderer.prototype.resetRand=function(e,t,r,n){e=e||100,t=t||0,r=r||0,n=n||0;for(var i=new Float32Array(this.size*this.size*4),a=0;a<i.length;a+=4)i[a+0]=t+(Math.random()-.5)*e,i[a+1]=r+(Math.random()-.5)*e,i[a+2]=n+(Math.random()-.5)*e,i[a+3]=100;var o=new THREE.DataTexture(i,this.size,this.size,THREE.RGBAFormat,THREE.FloatType);o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.needsUpdate=!0,this.reset(o)},THREE.PhysicsRenderer.prototype.addBoundTexture=function(e,t){this.boundTextures.push([e,t])},THREE.PhysicsRenderer.prototype.bindTextures=function(){for(var e=0;e<this.boundTextures.length;e++){var t=this.boundTextures[e][0],r=this.boundTextures[e][1];t.value=this[r]}},THREE.PhysicsRenderer.prototype.VSPass=["varying vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = vec4( position, 1.0 );","}"].join("\n"),THREE.PhysicsRenderer.prototype.FSPass=["uniform sampler2D texture;","varying vec2 vUv;","void main() {","  vec4 c = texture2D( texture , vUv );","  gl_FragColor = c;","}"].join("\n")},function(e,t){THREE.MirrorRenderer=function(e,t,r,n){function i(e,t){return void 0!==e?e:t}THREE.Object3D.call(this),this.name="mirror_"+this.id,n=n||{},this.matrixNeedsUpdate=!0;var a=i(n.textureWidth,512),o=i(n.textureHeight,512);this.clipBias=i(n.clipBias,0),this.renderer=e,this.scene=r,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4,t instanceof THREE.PerspectiveCamera?this.camera=t:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mesh=new THREE.Object3D,this.texture=new THREE.WebGLRenderTarget(a,o),this.tempTexture=new THREE.WebGLRenderTarget(a,o),THREE.Math.isPowerOfTwo(a)&&THREE.Math.isPowerOfTwo(o)||(this.texture.texture.generateMipmaps=!1,this.tempTexture.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()},THREE.MirrorRenderer.prototype=Object.create(THREE.Object3D.prototype),THREE.MirrorRenderer.prototype.renderWithMirror=function(e){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var t=e.camera;e.camera=this.mirrorCamera,e.render(!0),e.material.uniforms.mirrorSampler.value=e.tempTexture.texture,this.render(),this.matrixNeedsUpdate=!0,e.material.uniforms.mirrorSampler.value=e.texture.texture,e.camera=t,e.updateTextureMatrix()},THREE.MirrorRenderer.prototype.updateTextureMatrix=function(){function e(e){return e?e<0?-1:1:0}null!=this.parent&&(this.mesh=this.parent),this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal=new THREE.Vector3(0,1,0).applyEuler(this.mesh.rotation);var t=new THREE.Vector3(0,0,1).applyEuler(this.camera.rotation);if(this.normal.dot(t)<0){var r=new THREE.Vector3(0,0,1).applyEuler(this.mesh.rotation);this.normal.reflect(r)}var n=this.mesh.position.clone().sub(this.cameraWorldPosition);n.reflect(this.normal).negate(),n.add(this.mesh.position),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mesh.position.clone().sub(this.lookAtPosition);i.reflect(this.normal).negate(),i.add(this.mesh.position),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(n),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(i),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mesh.position),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var a=new THREE.Vector4,o=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+o.elements[8])/o.elements[0],a.y=(e(this.clipPlane.y)+o.elements[9])/o.elements[5],a.z=-1,a.w=(1+o.elements[10])/o.elements[14];var s=new THREE.Vector4;s=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),o.elements[2]=s.x,o.elements[6]=s.y,o.elements[10]=s.z+1-this.clipBias,o.elements[14]=s.w;var l=new THREE.Vector3;l.setFromMatrixPosition(this.camera.matrixWorld),this.eye=l},THREE.MirrorRenderer.prototype.render=function(e){if(this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0,void 0!==this.scene&&this.scene instanceof THREE.Scene){var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.setRenderTarget(t),this.renderer.clear(),this.renderer.render(this.scene,this.mirrorCamera)}}},function(e,t){THREE.ShaderLib.ocean_sim_vertex={vertexShader:["varying vec2 vUV;","void main (void) {","vUV = position.xy * 0.5 + 0.5;","gl_Position = vec4(position, 1.0);","}"].join("\n")},THREE.ShaderLib.ocean_subtransform={uniforms:{u_input:{value:null},u_transformSize:{value:512},u_subtransformSize:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","uniform sampler2D u_input;","uniform float u_transformSize;","uniform float u_subtransformSize;","varying vec2 vUV;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","void main (void) {","#ifdef HORIZONTAL","float index = vUV.x * u_transformSize - 0.5;","#else","float index = vUV.y * u_transformSize - 0.5;","#endif","float evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);","#ifdef HORIZONTAL","vec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","#else","vec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;","#endif","float twiddleArgument = -2.0 * PI * (index / u_subtransformSize);","vec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));","vec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);","vec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);","gl_FragColor = vec4(outputA, outputB);","}"].join("\n")},THREE.ShaderLib.ocean_initial_spectrum={uniforms:{u_wind:{value:new THREE.Vector2(10,10)},u_resolution:{value:512},u_size:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","const float CM = 0.23;","uniform vec2 u_wind;","uniform float u_resolution;","uniform float u_size;","float square (float x) {","return x * x;","}","float omega (float k) {","return sqrt(G * k * (1.0 + square(k / KM)));","}","float tanh_ (float x) {","return (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 K = (2.0 * PI * vec2(n, m)) / u_size;","float k = length(K);","float l_wind = length(u_wind);","float Omega = 0.84;","float kp = G * square(Omega / l_wind);","float c = omega(k) / k;","float cp = omega(kp) / kp;","float Lpm = exp(-1.25 * square(kp / k));","float gamma = 1.7;","float sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));","float Gamma = exp(-square(sqrt(k / kp) - 1.0) / 2.0 * square(sigma));","float Jp = pow(gamma, Gamma);","float Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));","float alphap = 0.006 * sqrt(Omega);","float Bl = 0.5 * alphap * cp / c * Fp;","float z0 = 0.000037 * square(l_wind) / G * pow(l_wind / cp, 0.9);","float uStar = 0.41 * l_wind / log(10.0 / z0);","float alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));","float Fm = exp(-0.25 * square(k / KM - 1.0));","float Bh = 0.5 * alpham * CM / c * Fm * Lpm;","float a0 = log(2.0) / 4.0;","float am = 0.13 * uStar / CM;","float Delta = tanh_(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));","float cosPhi = dot(normalize(u_wind), normalize(K));","float S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));","float dk = 2.0 * PI / u_size;","float h = sqrt(S / 2.0) * dk;","if (K.x == 0.0 && K.y == 0.0) {","h = 0.0;","}","gl_FragColor = vec4(h, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_phase={uniforms:{u_phases:{value:null},u_deltaTime:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform sampler2D u_phases;","uniform float u_deltaTime;","uniform float u_resolution;","uniform float u_size;","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","float deltaTime = 1.0 / 60.0;","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","float deltaPhase = omega(length(waveVector)) * u_deltaTime;","phase = mod(phase + deltaPhase, 2.0 * PI);","gl_FragColor = vec4(phase, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_spectrum={uniforms:{u_size:{value:null},u_resolution:{value:null},u_choppiness:{value:null},u_phases:{value:null},u_initialSpectrum:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform float u_size;","uniform float u_resolution;","uniform float u_choppiness;","uniform sampler2D u_phases;","uniform sampler2D u_initialSpectrum;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","vec2 multiplyByI (vec2 z) {","return vec2(-z[1], z[0]);","}","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","vec2 phaseVector = vec2(cos(phase), sin(phase));","vec2 h0 = texture2D(u_initialSpectrum, vUV).rg;","vec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;","h0Star.y *= -1.0;","vec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));","vec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;","vec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;","if (waveVector.x == 0.0 && waveVector.y == 0.0) {","h = vec2(0.0);","hX = vec2(0.0);","hZ = vec2(0.0);","}","gl_FragColor = vec4(hX + multiplyByI(h), hZ);","}"].join("\n")},THREE.ShaderLib.ocean_normals={uniforms:{u_displacementMap:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","varying vec2 vUV;","uniform sampler2D u_displacementMap;","uniform float u_resolution;","uniform float u_size;","void main (void) {","float texel = 1.0 / u_resolution;","float texelSize = u_size / u_resolution;","vec3 center = texture2D(u_displacementMap, vUV).rgb;","vec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;","vec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;","vec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;","vec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;","vec3 topRight = cross(right, top);","vec3 topLeft = cross(top, left);","vec3 bottomLeft = cross(left, bottom);","vec3 bottomRight = cross(bottom, right);","gl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);","}"].join("\n")},THREE.ShaderChunk.screenplane_pars_vertex=["const float infinite = 150000.0;","const float screenScale = 1.2;","const vec3 groundNormal = vec3( 0.0, 1.0, 0.0 );","varying vec3 vCamPosition;","vec3 interceptPlane( in vec3 source, in vec3 dir, in vec3 normal, float height )","{","\tfloat distance = ( - height - dot( normal, source ) ) / dot( normal, dir );","\tif( distance < 0.0 )","\t\treturn source + dir * distance;","\telse ","\t\treturn - ( vec3( source.x, height, source.z ) + vec3( dir.x, height, dir.z ) * infinite );","}","mat3 getRotation()","{","\treturn mat3( ","\t\tviewMatrix[0].xyz,","\t\tviewMatrix[1].xyz,","\t\tviewMatrix[2].xyz","\t);","}","vec3 getCameraPos( in mat3 rotation )","{","\treturn - viewMatrix[3].xyz * rotation;","}","vec2 getImagePlan()","{","\tfloat focal = projectionMatrix[0].x;","\tfloat aspect = projectionMatrix[1].y;","\treturn vec2( ( uv.x - 0.5 ) * screenScale * aspect, ( uv.y - 0.5 ) * screenScale * focal );","}","vec3 getCamRay( in mat3 rotation, in vec2 screenUV )","{","\treturn vec3( screenUV.x, screenUV.y, projectionMatrix[0].x ) * rotation;","}","vec3 computeProjectedPosition()","{","\tmat3 cameraRotation = getRotation();","\tvec3 camPosition = getCameraPos( cameraRotation );","\tvCamPosition = camPosition;","\tvec2 screenUV = getImagePlan();","\tvec3 ray = getCamRay( cameraRotation, screenUV );","\tvec3 finalPos = interceptPlane( camPosition, ray, groundNormal, -u_groundHeight );","\tfloat distance = length( finalPos );","\tif( distance > infinite )","\t\tfinalPos *= infinite / distance;","\treturn finalPos;","}"].join("\n"),THREE.ShaderChunk.screenplane_vertex=["vec4 screenPlaneWorldPosition = vec4( computeProjectedPosition(), 1.0 );"].join("\n"),THREE.ShaderChunk.screenplane_pars_fragment=["varying vec3 vCamPosition;"].join("\n"),THREE.ShaderChunk.oceanfft_pars_vertex=["uniform sampler2D u_displacementMap;","uniform float u_geometrySize;","uniform float u_size;"].join("\n"),THREE.ShaderChunk.oceanfft_vertex=["vec3 displacement = texture2D( u_displacementMap, worldPosition.xz * 0.002 ).rgb * ( u_geometrySize / u_size );","vec4 oceanfftWorldPosition = worldPosition + vec4( displacement, 0.0 );"].join("\n"),THREE.ShaderLib.ocean_main={uniforms:{u_displacementMap:{value:null},u_reflection:{value:null},u_normalMap:{value:null},u_geometrySize:{value:null},u_size:{value:null},u_mirrorMatrix:{value:null},u_oceanColor:{value:null},u_sunDirection:{value:null},u_exposure:{value:null},u_groundHeight:{value:null}},vertexShader:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vec4 worldPosition = screenPlaneWorldPosition;",THREE.ShaderChunk.oceanfft_vertex,"vWorldPosition = oceanfftWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * oceanfftWorldPosition;","gl_Position = projectionMatrix * viewMatrix * oceanfftWorldPosition;","}"].join("\n"),vertexShaderNoTexLookup:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vWorldPosition = screenPlaneWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * screenPlaneWorldPosition;","gl_Position = projectionMatrix * viewMatrix * screenPlaneWorldPosition;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform sampler2D u_reflection;","uniform sampler2D u_normalMap;","uniform vec3 u_oceanColor;","uniform vec3 u_sunDirection;","uniform float u_exposure;","vec3 hdr (vec3 color, float exposure) {","return 1.0 - exp(-color * exposure);","}",THREE.ShaderChunk.screenplane_pars_fragment,"void main (void) {","vec3 normal = texture2D( u_normalMap, vWorldPosition.xz * 0.002 ).rgb;","vec3 view = normalize( vCamPosition - vWorldPosition );","vec3 reflection = normalize( reflect( -u_sunDirection, normal ) );","float specularFactor = pow( max( 0.0, dot( view, reflection ) ), 500.0 ) * 20.0;","vec3 distortion = 200.0 * normal * vec3( 1.0, 0.0, 0.1 );","vec3 reflectionColor = texture2DProj( u_reflection, vReflectCoordinates.xyz + distortion ).xyz;","float distanceRatio = min( 1.0, log( 1.0 / length( vCamPosition - vWorldPosition ) * 3000.0 + 1.0 ) );","distanceRatio *= distanceRatio;","distanceRatio = distanceRatio * 0.7 + 0.3;","normal = ( distanceRatio * normal + vec3( 0.0, 1.0 - distanceRatio, 0.0 ) ) * 0.5;","normal /= length( normal );","float fresnel = pow( 1.0 - dot( normal, view ), 2.0 );","float skyFactor = ( fresnel + 0.2 ) * 10.0;","vec3 waterColor = ( 1.0 - fresnel ) * u_oceanColor;","vec3 color = ( skyFactor + specularFactor + waterColor ) * reflectionColor + waterColor * 0.5 ;","color = hdr( color, u_exposure );","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")}},function(e,t,r){"use strict";window.ThreeBSP=function(){var e;return(e=function(e){this.matrix=new THREE.Matrix4,this.create(e)}).prototype.subtract=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.union=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),(r=new e(r)).matrix=this.matrix,r},e.prototype.intersect=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),n.clipTo(r),n.invert(),r.clipTo(n),n.clipTo(r),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.create=function(t){if(t instanceof THREE.Geometry)this.fromGeometry(t);else if(t instanceof THREE.BufferGeometry)this.fromBufferGeometry(t);else{if(!(t instanceof THREE.Mesh)){if(t instanceof e.Node)return this.tree=t,this;throw new Error("ThreeBSP: is unable to create a BSP for the given input")}this.fromMesh(t)}},e.prototype.fromGeometry=function(t){var r,n,i,a,o,s,l,u=[];for(r=0,n=t.faces.length;r<n;r++)i=t.faces[r],o=t.faceVertexUvs[0][r],l=new e.Polygon,a=t.vertices[i.a],s=o?new THREE.Vector2(o[0].x,o[0].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[0],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.b],s=o?new THREE.Vector2(o[1].x,o[1].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[1],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.c],s=o?new THREE.Vector2(o[2].x,o[2].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[2],s)).applyMatrix4(this.matrix),l.vertices.push(a),l.calculateProperties(),u.push(l);this.tree=new e.Node(u)},e.prototype.fromIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m=t.index.array,g=t.attributes.position.array,v=t.attributes.normal.array,y=t.attributes.uv.array,_=[];for(r=0,n=m.length;r<n;r+=3){for(o=new e.Polygon,s=0;s<3;s++)u=(l=3*(i=m[r+s]))+1,c=l+2,d=(h=2*i)+1,f=v?new THREE.Vector3(v[l],v[u],v[c]):null,p=y?new THREE.Vector2(y[h],y[d]):null,(a=new e.Vertex(g[l],g[u],g[c],f,p)).applyMatrix4(this.matrix),o.vertices.push(a);o.calculateProperties(),_.push(o)}this.tree=new e.Node(_)},e.prototype.fromNonIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l=t.attributes.position.array,u=t.attributes.normal.array,c=t.attributes.uv.array,h=[];for(r=0,n=l.length;r<n;r+=9)a=new e.Polygon,o=u?new THREE.Vector3(u[r],u[r+1],u[r+2]):null,s=c?new THREE.Vector2(c[r],c[r+1]):null,(i=new e.Vertex(l[r],l[r+1],l[r+2],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=u?new THREE.Vector3(u[r+3],u[r+4],u[r+5]):null,s=c?new THREE.Vector2(c[r+2],c[r+3]):null,(i=new e.Vertex(l[r+3],l[r+4],l[r+5],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=u?new THREE.Vector3(u[r+6],u[r+7],u[r+8]):null,s=c?new THREE.Vector2(c[r+4],c[r+5]):null,(i=new e.Vertex(l[r+6],l[r+7],l[r+8])).applyMatrix4(this.matrix),a.vertices.push(i),a.calculateProperties(),h.push(a);this.tree=new e.Node(h)},e.prototype.fromBufferGeometry=function(e){null===e.index?this.fromNonIndexedBufferGeometry(e):this.fromIndexedBufferGeometry(e)},e.prototype.fromMesh=function(e){var t=e.geometry;e.updateMatrix(),this.matrix=e.matrix.clone(),this.create(t)},e.prototype.toGeometry=function(){var e,t,r,n,i,a,o,s,l,u,c=(new THREE.Matrix4).getInverse(this.matrix),h=new THREE.Geometry,d=this.tree.allPolygons(),f=d.length,p={};for(e=0;e<f;e++)for(n=(r=d[e]).vertices.length,t=2;t<n;t++)u=[],s=r.vertices[0],u.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(c),void 0!==p[s.x+","+s.y+","+s.z]?i=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),i=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t-1],u.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(c),void 0!==p[s.x+","+s.y+","+s.z]?a=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),a=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t],u.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(c),void 0!==p[s.x+","+s.y+","+s.z]?o=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),o=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),l=new THREE.Face3(i,a,o,new THREE.Vector3(r.normal.x,r.normal.y,r.normal.z)),h.faces.push(l),h.faceVertexUvs[0].push(u);return h},e.prototype.toBufferGeometry=function(){var e,t,r,n,i,a,o,s,l=(new THREE.Matrix4).getInverse(this.matrix),u=new THREE.BufferGeometry,c=[],h=[],d=[],f=[],p=this.tree.allPolygons(),m=p.length,g={},v=0;for(e=0;e<m;e++)for(n=(r=p[e]).vertices.length,t=2;t<n;t++)[],(s=r.vertices[0]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==g[s.x+","+s.y+","+s.z]?i=g[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),i=v,d.push(r.normal.x,r.normal.y,r.normal.z),v++),(s=r.vertices[t-1]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==g[s.x+","+s.y+","+s.z]?a=g[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),a=v,d.push(r.normal.x,r.normal.y,r.normal.z),v++),(s=r.vertices[t]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==g[s.x+","+s.y+","+s.z]?o=g[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),o=v,d.push(r.normal.x,r.normal.y,r.normal.z),v++),c.push(i,a,o);return u.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(f),2)),u.setAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3)),u.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(d),3)),u.setIndex(new THREE.BufferAttribute(new Uint32Array(c),1)),u},e.prototype.toMesh=function(e){var t=this.toGeometry(),r=new THREE.Mesh(t,e);return r.position.setFromMatrixPosition(this.matrix),r.rotation.setFromRotationMatrix(this.matrix),r},(e.Polygon=function(e,t,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=void 0}).prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],r=this.vertices[2];return this.normal=t.clone().subtract(e).cross(r.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this},e.Polygon.prototype.clone=function(){var t,r,n=new e.Polygon;for(t=0,r=this.vertices.length;t<r;t++)n.vertices.push(this.vertices[t].clone());return n.calculateProperties(),n},e.Polygon.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},e.Polygon.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:t>1e-5?1:0},e.Polygon.prototype.classifySide=function(e){var t,r,n,i=0,a=0,o=e.vertices.length;for(t=0;t<o;t++)r=e.vertices[t],1===(n=this.classifyVertex(r))?i++:2===n&&a++;return i>0&&0===a?1:0===i&&a>0?2:0===i&&0===a?0:3},e.Polygon.prototype.splitPolygon=function(t,r,n,i,a){var o=this.classifySide(t);if(0===o)(this.normal.dot(t.normal)>0?r:n).push(t);else if(1===o)i.push(t);else if(2===o)a.push(t);else{var s,l,u,c,h,d,f,p,m,g=[],v=[];for(l=0,s=t.vertices.length;l<s;l++)u=(l+1)%s,d=t.vertices[l],f=t.vertices[u],c=this.classifyVertex(d),h=this.classifyVertex(f),2!=c&&g.push(d),1!=c&&v.push(d),3==(c|h)&&(p=(this.w-this.normal.dot(d))/this.normal.dot(f.clone().subtract(d)),m=d.interpolate(f,p),g.push(m),v.push(m));g.length>=3&&i.push(new e.Polygon(g).calculateProperties()),v.length>=3&&a.push(new e.Polygon(v).calculateProperties())}},(e.Vertex=function(e,t,r,n,i){this.x=e,this.y=t,this.z=r,this.normal=n||new THREE.Vector3,this.uv=i||new THREE.Vector2}).prototype.clone=function(){return new e.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},e.Vertex.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.Vertex.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.Vertex.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.Vertex.prototype.cross=function(e){var t=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-r*e.x,this},e.Vertex.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},e.Vertex.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.Vertex.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this},e.Vertex.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},e.Vertex.prototype.applyMatrix4=function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this},(e.Node=function(t){var r,n,i=[],a=[];if(this.polygons=[],this.front=this.back=void 0,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front=new e.Node(i)),a.length>0&&(this.back=new e.Node(a))}}).isConvex=function(e){var t,r;for(t=0;t<e.length;t++)for(r=0;r<e.length;r++)if(t!==r&&2!==e[t].classifySide(e[r]))return!1;return!0},e.Node.prototype.build=function(t){var r,n,i=[],a=[];for(this.divider||(this.divider=t[0].clone()),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front||(this.front=new e.Node),this.front.build(i)),a.length>0&&(this.back||(this.back=new e.Node),this.back.build(a))},e.Node.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.Node.prototype.clone=function(){var t=new e.Node;return t.divider=this.divider.clone(),t.polygons=this.polygons.map((function(e){return e.clone()})),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t},e.Node.prototype.invert=function(){var e,t,r;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),r=this.front,this.front=this.back,this.back=r,this},e.Node.prototype.clipPolygons=function(e){var t,r,n,i;if(!this.divider)return e.slice();for(n=[],i=[],t=0,r=e.length;t<r;t++)this.divider.splitPolygon(e[t],n,i,n,i);return this.front&&(n=this.front.clipPolygons(n)),i=this.back?this.back.clipPolygons(i):[],n.concat(i)},e.Node.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e}()},function(e,t){const r=/\bvoid\s+main\s*\(\s*\)\s*{/g;function n(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){let r=THREE.ShaderChunk[t];return r?n(r):e}))}const i=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}return e};let a=0;const o=Date.now(),s=new WeakMap;function l(e,t){return"uniforms"===e?void 0:t}THREE.createDerivedMaterial=function(e,t){const u=function(e){return JSON.stringify(e,l)}(t);let c=s.get(e);if(c||(c=Object.create(null),s.set(e,c)),c[u])return c[u].clone();const h=++a,d="_derivedShaders"+h,f="_onBeforeCompile"+h;let p,m;function g(a){e.onBeforeCompile.call(this,a);const{vertex:s,fragment:l}=this[d]||(this[d]={vertex:{},fragment:{}});if(s.source!==a.vertexShader||l.source!==a.fragmentShader){const e=function({vertexShader:e,fragmentShader:t},i,a){let{vertexDefs:o,vertexTransform:s,vertexMainIntro:l,fragmentDefs:u,fragmentDiffuseTransform:c,fragmentMainIntro:h,fragmentColorTransform:d,timeUniform:f}=i;if(f){const e=`\nuniform float ${f};\n`;o=(o||"")+e,u=(u||"")+e}(o||s||l)&&(s&&(e=n(e),o=`\n        ${o||""}\n        void vertexTransform_${a}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n          ${s}\n        }\n      `,e=e.replace(/\b(position|normal|uv)\b/g,(e,t,r,n)=>/\battribute\s+vec3\s+$/.test(n.substr(0,r))?t:`_${t}_${a}`),l=`\n        vec3 _position_${a} = vec3(position);\n        vec3 _normal_${a} = vec3(normal);\n        vec2 _uv_${a} = vec2(uv);\n        vertexTransform_${a}(_position_${a}, _normal_${a}, _uv_${a});\n        ${l||""}\n      `),e=e.replace(r,`${o||""}\n\n$&\n\n${l||""}`));(u||c||h||d)&&(t=n(t),c&&(u=`\n        ${u||""}\n        void fragmentDiffuseTransform_${a}(inout vec3 diffuse) {\n          ${c}\n        }\n      `,t=t.replace(/\b(diffuse)\b/g,(e,t,r,n)=>/\buniform\s+vec3\s+$/.test(n.substr(0,r))?t:`_${t}_${a}`),h=`\n        vec3 _diffuse_${a} = diffuse;\n        fragmentDiffuseTransform_${a}(_diffuse_${a});\n        ${h||""}\n      `),t=t.replace(r,`\n      ${u||""}\n      void threejsMain_${a}() {\n      ${h||""}\n    `),t+=`\n      void main() {\n        threejsMain_${a}();\n        ${d||""}\n      }\n    `);return{vertexShader:e,fragmentShader:t}}(a,t,h);s.source=a.vertexShader,s.result=e.vertexShader,l.source=a.fragmentShader,l.result=e.fragmentShader}a.vertexShader=s.result,a.fragmentShader=l.result,i(a.uniforms,this.uniforms),t.timeUniform&&(a.uniforms[t.timeUniform]={get value(){return Date.now()-o}}),this[f]&&this[f](a)}function v(){e.constructor.apply(this,arguments),this._listeners=void 0}v.prototype=Object.create(e,{constructor:{value:v},isDerivedMaterial:{value:!0},baseMaterial:{value:e},onBeforeCompile:{get:()=>g,set(e){this[f]=e}},copy:{value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(this.extensions=t.extensions,this.defines=i({},t.defines),this.uniforms=THREE.UniformsUtils.clone(t.uniforms)),this}},getDepthMaterial:{value:function(){let r=this._depthMaterial;return r||(m||(m=createDerivedMaterial(e.isDerivedMaterial?e.getDepthMaterial():new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking}),t),m.defines.IS_DEPTH_MATERIAL=""),r=this._depthMaterial=m.clone()),r}},getDistanceMaterial:{value:function(){let r=this._distanceMaterial;return r||(p||(p=createDerivedMaterial(e.isDerivedMaterial?e.getDistanceMaterial():new THREE.MeshDistanceMaterial,t),p.defines.IS_DISTANCE_MATERIAL=""),r=this._distanceMaterial=p.clone()),r}},dispose:{value(){const{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}});const y=new v;return y.copy(e),y.uniforms=i(THREE.UniformsUtils.clone(e.uniforms||{}),t.uniforms),y.defines=i({},e.defines,t.defines),y.defines.DERIVED_MATERIAL=h,y.extensions=i({},e.extensions,t.extensions),c[u]=y,y.clone()};const u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};THREE.getShadersForMaterial=function(e){let t=u[e.type];return t?THREE.ShaderLib[t]:e},THREE.getShaderUniformTypes=function(e){let t,r=/\buniform\s+(int|float|vec[234])\s+([A-Za-z_][\w]*)/g,n=Object.create(null);for(;null!==(t=r.exec(e));)n[t[2]]=t[1];return n}},function(e,t){THREE.OrthographicTrackballControls=function(e,t){var r=this,n=-1,i=0,a=1,o=2,s=3,l=4;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var u=!0,c=n,h=n,d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,v=0,y=0,_=new THREE.Vector2,b=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var E={type:"change"},w={type:"start"},x={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var T,M,S,A,R,k,P=(T=new THREE.Vector2,function(e,t){return T.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),T}),L=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,a){n.set((i-.5*r.screen.width-r.screen.left)/r.radius,(.5*r.screen.height+r.screen.top-a)/r.radius,0);var o=n.length();return r.noRoll?o<Math.SQRT1_2?n.z=Math.sqrt(1-o*o):n.z=.5/o:o>1?n.normalize():n.z=Math.sqrt(1-o*o),d.copy(r.object.position).sub(r.target),e.copy(r.object.up).setLength(n.y),e.add(t.copy(r.object.up).cross(d).setLength(n.x)),e.add(d.setLength(n.z)),e}}();function C(e){!1!==r.enabled&&(window.removeEventListener("keydown",C),h=c,c===n&&(e.keyCode!==r.keys[i]||r.noRotate?e.keyCode!==r.keys[a]||r.noZoom?e.keyCode!==r.keys[o]||r.noPan||(c=o):c=a:c=i))}function I(e){!1!==r.enabled&&(c=h,window.addEventListener("keydown",C,!1))}function H(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),c===n&&(c=e.button),c!==i||r.noRotate?c!==a||r.noZoom?c!==o||r.noPan||(_.copy(P(e.pageX,e.pageY)),b.copy(_)):(m.copy(P(e.pageX,e.pageY)),g.copy(m)):(f.copy(L(e.pageX,e.pageY)),p.copy(f)),document.addEventListener("mousemove",O,!1),document.addEventListener("mouseup",D,!1),r.dispatchEvent(w))}function O(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),c!==i||r.noRotate?c!==a||r.noZoom?c!==o||r.noPan||b.copy(P(e.pageX,e.pageY)):g.copy(P(e.pageX,e.pageY)):p.copy(L(e.pageX,e.pageY)))}function D(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),c=n,document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",D),r.dispatchEvent(x))}function F(e){if(!1!==r.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),m.y+=.01*t,r.dispatchEvent(w),r.dispatchEvent(x)}}function N(e){if(!1!==r.enabled){switch(e.touches.length){case 1:c=s,f.copy(L(e.touches[0].pageX,e.touches[0].pageY)),p.copy(f);break;case 2:c=l;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;y=v=Math.sqrt(t*t+i*i);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;_.copy(P(a,o)),b.copy(_);break;default:c=n}r.dispatchEvent(w)}}function U(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:p.copy(L(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;y=Math.sqrt(t*t+i*i);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(P(a,o));break;default:c=n}}function B(e){if(!1!==r.enabled){switch(e.touches.length){case 1:p.copy(L(e.touches[0].pageX,e.touches[0].pageY)),f.copy(p);break;case 2:v=y=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(P(t,i)),_.copy(b)}c=n,r.dispatchEvent(x)}}function z(e){e.preventDefault()}this.rotateCamera=(M=new THREE.Vector3,S=new THREE.Quaternion,function(){var e=Math.acos(f.dot(p)/f.length()/p.length());e&&(M.crossVectors(f,p).normalize(),e*=r.rotateSpeed,S.setFromAxisAngle(M,-e),d.applyQuaternion(S),r.object.up.applyQuaternion(S),p.applyQuaternion(S),r.staticMoving?f.copy(p):(S.setFromAxisAngle(M,e*(r.dynamicDampingFactor-1)),f.applyQuaternion(S)),u=!0)}),this.zoomCamera=function(){if(c===l){var e=y/v;v=y,r.object.zoom*=e,u=!0}else{e=1+(g.y-m.y)*r.zoomSpeed;Math.abs(e-1)>1e-6&&e>0&&(r.object.zoom/=e,r.staticMoving?m.copy(g):m.y+=(g.y-m.y)*this.dynamicDampingFactor,u=!0)}},this.panCamera=(A=new THREE.Vector2,R=new THREE.Vector3,k=new THREE.Vector3,function(){if(A.copy(b).sub(_),A.lengthSq()){var e=(r.object.right-r.object.left)/r.object.zoom,t=(r.object.top-r.object.bottom)/r.object.zoom;A.x*=e*r.panSpeed,A.y*=t*r.panSpeed,k.copy(d).cross(r.object.up).setLength(A.x),k.add(R.copy(r.object.up).setLength(A.y)),r.object.position.add(k),r.target.add(k),r.staticMoving?_.copy(b):_.add(A.subVectors(b,_).multiplyScalar(r.dynamicDampingFactor)),u=!0}}),this.update=function(){d.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||(r.zoomCamera(),u&&r.object.updateProjectionMatrix()),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,d),r.object.lookAt(r.target),u&&(r.dispatchEvent(E),u=!1)},this.reset=function(){c=n,h=n,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),d.subVectors(r.object.position,r.target),r.object.left=r.left0,r.object.right=r.right0,r.object.top=r.top0,r.object.bottom=r.bottom0,r.object.lookAt(r.target),r.dispatchEvent(E),u=!1},this.disableEvents=function(){this.domElement.removeEventListener("contextmenu",z,!1),this.domElement.removeEventListener("mousedown",H,!1),this.domElement.removeEventListener("wheel",F,!1),this.domElement.removeEventListener("MozMousePixelScroll",F,!1),this.domElement.removeEventListener("touchstart",N,!1),this.domElement.removeEventListener("touchend",B,!1),this.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",D,!1),window.removeEventListener("keydown",C,!1),window.removeEventListener("keyup",I,!1)},this.dispose=this.disableEvents,this.enableEvents=function(){this.domElement.addEventListener("contextmenu",z,!1),this.domElement.addEventListener("mousedown",H,!1),this.domElement.addEventListener("wheel",F,!1),this.domElement.addEventListener("MozMousePixelScroll",F,!1),this.domElement.addEventListener("touchstart",N,!1),this.domElement.addEventListener("touchend",B,!1),this.domElement.addEventListener("touchmove",U,!1),window.addEventListener("keydown",C,!1),window.addEventListener("keyup",I,!1)},this.enableEvents(),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls},function(e,t,r){"use strict";var n=r(6),i=new Function("return 1.0");function a(e,t,r,a){a||(a=i);var o=new n.DynamicVolume,s=new Int32Array(3),l=new Int32Array(3);for(s[2]=e[2];s[2]<t[2];++s[2])for(s[1]=e[1];s[1]<t[1];++s[1])for(s[0]=e[0];s[0]<t[0];++s[0]){var u=r(s);l[0]=s[0],l[1]=s[1],l[2]=s[2];e:for(var c=0;c<3;++c)for(var h=-1;h<=1;h+=2){if(l[c]+=h,u!==r(l)){o.push(s[0],s[1],s[2],n.saturateAbs(a(s)),u);break e}l[c]=s[c]}}return o}t.dense=a;var o=new Function("x","return x.join('|');");function s(e,t,r,a,s){s=s||i;var l={},u=[];e:for(var c=0;c<r.length;++c)for(var h=a(g=r[c]),d=0;d<3;++d)for(var f=-1;f<=2;f+=2){var p=g[d];g[d]+=f;var m=a(g);if(g[d]=p,m!==h){u.push([g[0],g[1],g[2],s(g),a(g)]),l[o(g)]=!0;continue e}}for(var g=[0,0,0],v=0;v<u.length;++v){var y=u[v];for(d=0;d<3;++d)e:for(f=-1;f<=1;f+=2){for(c=0;c<3;++c)g[c]=y[c];g[d]+=f;for(c=0;c<3;++c)if(g[c]<e[c]||g[c]>=t[c])continue e;var _=o(g);if(!l[_]){var b=a(g);t:for(var E=0;E<3;++E)for(p=-1;p<=1;++p){g[E]+=p;var w=a(g);if(g[E]-=p,w!==b){u.push([g[0],g[1],g[2],n.saturateAbs(s(g)),b]);break t}}l[_]=!0}}}u.sort(n.compareCoord);var x=new Array(u.length+1),T=new Array(u.length+1),M=new Array(u.length+1),S=new Array(u.length+1),A=new Array(u.length+1);x[0]=T[0]=M[0]=n.NEGATIVE_INFINITY,S[0]=1,A[0]=0;for(c=0;c<u.length;++c){var R=u[c];x[c+1]=R[0],T[c+1]=R[1],M[c+1]=R[2],S[c+1]=R[3],A[c+1]=R[4]}return new n.DynamicVolume([x,T,M],S,A)}function l(e,t,r,n,a){r instanceof Array||(r=[r,r,r]),a=a||i;var o=[],l=[0,0,0];for(l[0]=e[0]+r[0];l[0]<t[0];l[0]+=r[0])for(l[1]=e[1]+r[1];l[1]<t[1];l[1]+=r[1])for(l[2]=e[2]+r[2];l[2]<t[2];l[2]+=r[2])for(var u=n(l),c=0;c<3;++c){var h=l[c];l[c]-=r[c];var d=n(l[c]);if(u!==d){for(var f=l[c],p=l[c]+r[c];f<p;)l[c]=f+p>>1,n(l[c])===d?f=l[c]+1:p=l[c]-1;o.push(l.slice(0))}l[c]=h}return s(e,t,o,n,a)}t.marching=s,t.adaptive=l;var u=new Function("dist_func","x","return dist_func(x) <= 0 ? 1 : 0;");function c(e){return u.bind(null,e)}t.solid={dense:function(e,t,r){return a(e,t,c(r),r)},marching:function(e,t,r,n){return s(e,t,r,c(n),n)},adaptive:function(e,t,r,n){return l(e,t,r,c(n),n)}}},function(e,t,r){"use strict";var n=r(12).NEGATIVE_INFINITY;function i(e,t,r){var n=this.coords;e:for(;t<=r;){for(var i=t+r>>1,a=2;a>=0;--a){var o=n[a][i]-e[a];if(o<0){t=i+1;continue e}if(o>0){r=i-1;continue e}}return i}return Math.max(0,r)}function a(e,t,r){e?(this.coords=e,this.distances=t,this.phases=r):(this.coords=[[n],[n],[n]],this.distances=[1],this.phases=[0])}function o(e,t,r){e?(this.coords=e,this.distances=t,this.phases=r):(this.coords=[new Int32Array(1),new Int32Array(1),new Int32Array(1)],this.distances=new Float32Array(1),this.phases=new Int32Array(1),this.coords[0][0]=this.coords[1][0]=this.coords[2][0]=n,this.distances[0]=1)}a.prototype.clone=function(){return new a([this.coords[0].slice(0),this.coords[1].slice(0),this.coords[2].slice(0)],this.distances.slice(0),this.phases.slice(0))},a.prototype.length=function(){return this.phases.length},a.prototype.pop=function(){this.coords[0].pop(),this.coords[1].pop(),this.coords[2].pop(),this.distances.pop(),this.phases.pop()},a.prototype.push=function(e,t,r,n,i){var a=this.coords;a[0].push(e),a[1].push(t),a[2].push(r),this.distances.push(n),this.phases.push(i)},a.prototype.bisect=i,a.prototype.toStatic=function(){return new o([new Int32Array(this.coords[0]),new Int32Array(this.coords[1]),new Int32Array(this.coords[2])],new Float32Array(this.distances),new Int32Array(this.phases))},o.prototype.clone=function(){return new o([new Int32Array(this.coords[0]),new Int32Array(this.coords[1]),new Int32Array(this.coords[2])],new Float64Array(this.distances),new Int32Array(this.phases))},o.prototype.length=function(){return this.phases.length};var s=Array.prototype.slice;o.prototype.toDynamic=function(){return new a([s.call(this.coords[0],0),s.call(this.coords[1],0),s.call(this.coords[2],0)],s.call(this.distances,0),s.call(this.phases,0))},o.prototype.bisect=i,t.StaticVolume=o,t.DynamicVolume=a},function(e,t,r){"use strict";var n=r(12),i=n.POSITIVE_INFINITY,a=n.NEGATIVE_INFINITY,o=r(32).StencilIterator,s=new Array(128);function l(e,t,r,n,i,a){this.volumes=e,this.stencil=t,this.ptrs=r,this.coord=n,this.stencil_len=i,this.frontier=a}!function(){for(var e=0;e<128;++e)s[e]=0}(),l.prototype.clone=function(){return new l(this.volumes,this.stencil,new Int32Array(this.ptrs),new Int32Array(this.coord),this.stencil_len)},l.prototype.hasNext=function(){return this.coord[0]<i},l.prototype.next=function(){for(var e=this.volumes,t=this.stencil,r=this.ptrs,n=this.coord,a=this.stencil_len,o=this.frontier,l=0,u=0,c=0;c<3;++c)n[c]=i;for(var h=0;h<e.length;++h){var d=e[h],f=d.coords,p=d.length();c=0;e:for(var m=0;c<a;++c,m+=3,u++){var g=r[u];if(!(g>=p-1)){g+=1;for(var v=2;v>=0;--v){var y=f[v][g]-t[m+v],_=n[v];if(y<_){for(n[v--]=y;v>=0;--v)n[v]=f[v][g]-t[m+v];l=0;break}if(y>_)continue e}s[l++]=u}}}for(c=0;c<o.length;++c)o[c]=0;for(c=0;c<l;++c){++r[u=s[c]],o[u]=1}},l.prototype.seek=function(e){for(var t=this.volumes,r=this.ptrs,n=this.stencil,i=new Int32Array(3),a=0,o=0;o<3;++o)this.coord[o]=e[o];for(var s=0;s<t.length;++s)for(var l=t[s],u=l.coords,c=l.length(),h=(o=0,0);o<stencil_len;++o,h+=3){for(var d=0;d<3;++d)i[d]=e[d]+n[h+d];r[a]=l.bisect(i,0,c-1),this[a]=u[0][r[a]]===i[0]&&u[1][r[a]]===i[1]&&u[2][r[a]]===i[2],++a}},l.prototype.getValues=function(e,t){for(var r=this.ptrs,n=this.frontier,i=0,a=0;a<this.volumes.length;++a)for(var o=this.volumes[a],s=o.phases,l=o.distances,u=0;u<this.stencil_len;++u){var c=r[i];e[i]=s[c],t[i]=n[i]?l[c]:1,++i}},l.prototype.subiterator=function(e){var t=this.stencil_len;return new o(this.volumes[e],this.stencil,new Int32Array(this.ptrs.subarray(3*t*e,3*t*(e+1))),new Int32Array(this.coord))},t.MultiIterator=l,t.beginMulti=function(e,t){var r=t.length/3|0;return s.length<r&&(s.length=r),new l(e,t,new Int32Array(e.length*r),new Int32Array([a,a,a]),r,new Uint8Array(e.length*r))}},function(e,t,r){"use strict";var n=r(6),i=r(33),a=n.NEGATIVE_INFINITY,o=n.POSITIVE_INFINITY,s=n.EPSILON,l=i.CUBE_STENCIL,u=n.compareCoord,c=n.beginStencil,h=new Int32Array([6,5,3,0,0,0,1,1,2,2,4,4]),d=new Int32Array([7,7,7,1,2,4,3,5,3,6,5,6]),f=new Int32Array([0,1,2,0,1,2,1,2,0,2,0,1]),p=new Int16Array(256);!function(){for(var e=0;e<256;++e)for(var t=0,r=0;r<12;++r){!(e&1<<h[r])!=!(e&1<<d[r])&&(t|=1<<r),p[e]=t}}();var m=new Function("phase","return !!phase;");e.exports=function(e,t,r,n){var i,g;t?i instanceof Int32Array||(i=new Int32Array(t)):(i=new Int32Array(3))[0]=i[1]=i[2]=a,r?g instanceof Int32Array||(g=new Int32Array(r)):(g=new Int32Array(3))[0]=g[1]=g[2]=o,n||(n=m);var v=[],y=[],_=[],b=e.distances,E=e.phases,w=new Float64Array(8),x=new Int32Array(8),T=new Int32Array(8),M=c(e,l);M.seek(i);e:for(;M.hasNext();M.next()){var S=M.coord;if(u(g,S)<=0)break;for(var A=0;A<3;++A)if(S[A]<i[A]||S[A]>=g[A])continue e;var R=M.ptrs,k=0;for(A=0;A<8;++A){var P=R[A];w[A]=b[P];var L=E[P];x[A]=L,k|=n(E[R[A]])?0:1<<A}if(0!==k&&255!==k){var C=p[k],I=[0,0,0],H=0;for(A=0;A<12;++A)if(0!=(C&1<<A)){for(var O=h[A],D=d[A],F=f[A],N=w[O],U=w[D],B=0;B<3;++B)O&1<<B&&(I[B]-=1-s);I[F]-=Math.min(1-s,Math.max(s,N/(N+U))),++H}var z=1/H;for(A=0;A<3;++A)I[A]=S[A]+I[A]*z;v.push(I);t:for(A=0;A<8;++A)for(;;){if(T[A]>=v.length-1)continue t;var j=v[T[A]+1];for(B=2;B>=0;--B){var V=(0|Math.ceil(j[B]))-S[B]+(A&1<<B?1:0);if(V)break}if(V<=0&&++T[A],V>=0)break}for(A=0;A<3;++A)if(S[A]<=i[A])continue e;var G=x[7];for(A=0;A<3;++A)if(C&1<<A){var W=x[7^1<<A],X=1<<(A+1)%3,Y=1<<(A+2)%3;128&k?(_.push([W,G]),_.push([W,G]),y.push([T[0],T[X],T[Y]]),y.push([T[Y],T[X],T[X+Y]])):(_.push([G,W]),_.push([G,W]),y.push([T[0],T[Y],T[X]]),y.push([T[X],T[Y],T[X+Y]]))}}}return{positions:v,cells:y,phases:_}}},function(e,t,r){"use strict";var n=new Float64Array(4),i=new Float64Array(4),a=new Float64Array(4);var o=new Float64Array(4);e.exports=function(e,t,r,s){switch(s||(o.length<r.length&&(o=new Float64Array(r.length)),s=o),e.length){case 0:for(var l=0;l<r.length;++l)s[l]=Number.NaN;return Number.NaN;case 1:return function(e,t,r){for(var n=0,i=0;i<t.length;++i){r[i]=e[i];var a=e[i]-t[i];n+=a*a}return n}(t[e[0]],r,s);case 2:return function(e,t,r,n){for(var i=0,a=0,o=0;o<r.length;++o){var s=e[o],l=t[o],u=s-l;a+=u*(r[o]-l),i+=u*u}var c=0;Math.abs(i)>1e-8&&((c=a/i)<0?c=0:c>1&&(c=1));var h=1-c,d=0;for(o=0;o<r.length;++o){var f=c*e[o]+h*t[o];n[o]=f;var p=r[o]-f;d+=p*p}return d}(t[e[0]],t[e[1]],r,s);case 3:return function(e,t,r,o,s){n.length<o.length&&(n=new Float64Array(o.length),i=new Float64Array(o.length),a=new Float64Array(o.length));for(var l=0;l<o.length;++l)n[l]=e[l]-o[l],i[l]=t[l]-e[l],a[l]=r[l]-e[l];var u=0,c=0,h=0,d=0,f=0,p=0;for(l=0;l<o.length;++l){var m=i[l],g=a[l],v=n[l];u+=m*m,c+=m*g,h+=g*g,d+=v*m,f+=v*g,p+=v*v}var y,_,b,E,w,x=Math.abs(u*h-c*c),T=c*f-h*d,M=c*d-u*f;if(T+M<=x)if(T<0)M<0&&d<0?(M=0,-d>=u?(T=1,y=u+2*d+p):y=d*(T=-d/u)+p):(T=0,f>=0?(M=0,y=p):-f>=h?(M=1,y=h+2*f+p):y=f*(M=-f/h)+p);else if(M<0)M=0,d>=0?(T=0,y=p):-d>=u?(T=1,y=u+2*d+p):y=d*(T=-d/u)+p;else{var S=1/x;y=(T*=S)*(u*T+c*(M*=S)+2*d)+M*(c*T+h*M+2*f)+p}else T<0?(b=h+f)>(_=c+d)?(E=b-_)>=(w=u-2*c+h)?(T=1,M=0,y=u+2*d+p):y=(T=E/w)*(u*T+c*(M=1-T)+2*d)+M*(c*T+h*M+2*f)+p:(T=0,b<=0?(M=1,y=h+2*f+p):f>=0?(M=0,y=p):y=f*(M=-f/h)+p):M<0?(b=u+d)>(_=c+f)?(E=b-_)>=(w=u-2*c+h)?(M=1,T=0,y=h+2*f+p):y=(T=1-(M=E/w))*(u*T+c*M+2*d)+M*(c*T+h*M+2*f)+p:(M=0,b<=0?(T=1,y=u+2*d+p):d>=0?(T=0,y=p):y=d*(T=-d/u)+p):(E=h+f-c-d)<=0?(T=0,M=1,y=h+2*f+p):E>=(w=u-2*c+h)?(T=1,M=0,y=u+2*d+p):y=(T=E/w)*(u*T+c*(M=1-T)+2*d)+M*(c*T+h*M+2*f)+p;var A=1-T-M;for(l=0;l<o.length;++l)s[l]=A*e[l]+T*t[l]+M*r[l];return y<0?0:y}(t[e[0]],t[e[1]],t[e[2]],r,s);default:return console.log("closestPoint: general case not supported..."),Number.NaN}}},function(e,t,r){"use strict";var n=r(34),i=r(158).rle2array;e.exports=function(e,t,r){var a,o,s,l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0],c=t.length;for(a=0;a<c;++a)for(s=t[a],o=0;o<3;++o)l[o]=Math.min(l[o],s[o]),u[o]=Math.max(u[o],s[o]);var h=+r||1,d=1/h,f=[0,0,0];for(o=0;o<3;++o)f[o]=l[o]-h;var p=new Array(c);for(a=0;a<c;++a){for(s=t[a].slice(0),o=0;o<3;++o)s[o]=(s[o]-f[o])*d;p[a]=s}var m=n(e,p);return{voxels:i(m).phase,origin:f,resolution:r}}},function(e,t,r){"use strict";var n=r(10),i=r(6),a=r(38),o=r(159);t.rle2array=function(e,t){t||(t=o(e));var r,i,a=[0,0,0],s=e.length(),l=1,u=[0,0,0];for(r=0;r<3;++r)a[r]=t[1][r]-t[0][r]|0,u[r]=l,l*=a[r];var c,h,d,f,p,m,g=n(new Int32Array(l),a,u,0),v=n(new Float32Array(l),a,u,0),y=l,_=e.coords[0],b=e.coords[1],E=e.coords[2],w=e.phases,x=e.distances,T=0|t[0][0],M=0|t[0][1],S=0|t[0][2];for(r=s-1;r>=0;--r)if(m=y,c=_[r]-T|0,h=b[r]-M|0,!((d=E[r]-S|0)<0||d>=a[2]))for(h<0?c=h=0:h>=a[1]?(c=a[0]-1,h=a[1]-1):c<0?c=0:c>=a[0]&&(c=a[0]-1),y=c+a[0]*(h+a[1]*d),p=x[r],f=w[r],i=m-1;i>=y;--i)g.data[i]=f,v.data[i]=p;return{phase:g,distance:v}},t.array2rle=function(e,t,r){var n,o,s,l=new i.DynamicVolume,u=t.shape,c=u[0],h=u[1],d=u[2];if(e)if(r){for(s=0;s<d;++s){for(o=0;o<h;++o){for(n=0;n<c;++n)l.push(n-e[0],o-e[1],s-e[2],Math.abs(r.get(n,o,s)),t.get(n,o,s));l.push(n-e[0],o-e[1],s-e[2],1,0)}for(n=0;n<c;++n)l.push(n-e[0],o-e[1],s-e[2],1,0)}for(o=0;o<h;++o)for(n=0;n<c;++n)l.push(n-e[0],o-e[1],s-e[2],1,0)}else{for(s=0;s<d;++s){for(o=0;o<h;++o){for(n=0;n<c;++n)l.push(n-e[0],o-e[1],s-e[2],1,0|t.get(n,o,s));l.push(n-e[0],o-e[1],s-e[2],1,0)}for(n=0;n<c;++n)l.push(n-e[0],o-e[1],s-e[2],1,0)}for(o=0;o<h;++o)for(n=0;n<c;++n)l.push(n-e[0],o-e[1],s-e[2],1,0)}else if(r){for(s=0;s<d;++s){for(o=0;o<h;++o){for(n=0;n<c;++n)l.push(n,o,s,Math.abs(r.get(n,o,s)),t.get(n,o,s));l.push(n,o,s,1,0)}for(n=0;n<c;++n)l.push(n,o,s,1,0)}for(o=0;o<h;++o)for(n=0;n<c;++n)l.push(n,o,s,1,0)}else{for(s=0;s<d;++s){for(o=0;o<h;++o){for(n=0;n<c;++n)l.push(n,o,s,1,0|t.get(n,o,s));l.push(n,o,s,1,0)}for(n=0;n<c;++n)l.push(n,o,s,1,0)}for(o=0;o<h;++o)for(n=0;n<c;++n)l.push(n,o,s,1,0)}return a.removeDuplicates(l),l}},function(e,t,r){"use strict";var n=r(6),i=n.POSITIVE_INFINITY,a=n.NEGATIVE_INFINITY;function o(e){return!!e}e.exports=function(e,t){var r,n,s=[i,i,i],l=[a,a,a],u=e.length(),c=e.coords,h=e.phases;for(t||(t=o),r=0;r<u-1;++r)if(t(h[r]))for(n=0;n<3;++n)s[n]=Math.min(c[n][r],s[n]),l[n]=Math.max(c[n][r],l[n]);for(n=0;n<3;++n)--s[n],++l[n];return[s,l]}},function(e,t,r){"use strict";var n=r(161);e.exports=function(e){var t=e.length;if(0===t)return[];if(1===t)return[[0]];var r=e[0].length;return 0===r?[]:1===r?function(e){for(var t=0,r=0,n=1;n<e.length;++n)e[n][0]<e[t][0]&&(t=n),e[n][0]>e[r][0]&&(r=n);return t<r?[[t],[r]]:t>r?[[r],[t]]:[[t]]}(e):2===r?function(e){var t=n(e),r=t.length;if(r<=2)return[];for(var i=new Array(r),a=t[r-1],o=0;o<r;++o){var s=t[o];i[o]=[a,s],a=s}return i}(e):[]}},function(e,t,r){"use strict";e.exports=function(e){var t=e.length;if(t<3){for(var r=new Array(t),i=0;i<t;++i)r[i]=i;return 2===t&&e[0][0]===e[1][0]&&e[0][1]===e[1][1]?[0]:r}var a=new Array(t);for(i=0;i<t;++i)a[i]=i;a.sort((function(t,r){var n=e[t][0]-e[r][0];return n||e[t][1]-e[r][1]}));var o=[a[0],a[1]],s=[a[0],a[1]];for(i=2;i<t;++i){for(var l=a[i],u=e[l],c=o.length;c>1&&n(e[o[c-2]],e[o[c-1]],u)<=0;)c-=1,o.pop();for(o.push(l),c=s.length;c>1&&n(e[s[c-2]],e[s[c-1]],u)>=0;)c-=1,s.pop();s.push(l)}r=new Array(s.length+o.length-2);for(var h=0,d=(i=0,o.length);i<d;++i)r[h++]=o[i];for(var f=s.length-2;f>0;--f)r[h++]=s[f];return r};var n=r(21)[3]},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=e+t,i=n-e,a=t-i,o=e-(n-i);if(r)return r[0]=o+a,r[1]=n,r;return[o+a,n]}},function(e,t,r){"use strict";e.exports=function(e,t){var r=0|e.length,n=0|t.length;if(1===r&&1===n)return function(e,t){var r=e+t,n=r-e,i=e-(r-n)+(t-n);if(i)return[i,r];return[r]}(e[0],-t[0]);var i,a,o=new Array(r+n),s=0,l=0,u=0,c=Math.abs,h=e[l],d=c(h),f=-t[u],p=c(f);d<p?(a=h,(l+=1)<r&&(h=e[l],d=c(h))):(a=f,(u+=1)<n&&(f=-t[u],p=c(f)));l<r&&d<p||u>=n?(i=h,(l+=1)<r&&(h=e[l],d=c(h))):(i=f,(u+=1)<n&&(f=-t[u],p=c(f)));var m,g,v=i+a,y=v-i,_=a-y,b=_,E=v;for(;l<r&&u<n;)d<p?(i=h,(l+=1)<r&&(h=e[l],d=c(h))):(i=f,(u+=1)<n&&(f=-t[u],p=c(f))),(_=(a=b)-(y=(v=i+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m;for(;l<r;)(_=(a=b)-(y=(v=(i=h)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(l+=1)<r&&(h=e[l]);for(;u<n;)(_=(a=b)-(y=(v=(i=f)+a)-i))&&(o[s++]=_),b=E-((m=E+v)-(g=m-E))+(v-g),E=m,(u+=1)<n&&(f=-t[u]);b&&(o[s++]=b);E&&(o[s++]=E);s||(o[s++]=0);return o.length=s,o}},function(e,t,r){e.exports=function(e,t){for(var r=t[0],i=t[1],a=e.length,o=1,s=a,l=0,u=a-1;l<s;u=l++){var c=e[l],h=e[u],d=c[1],f=h[1];if(f<d){if(f<i&&i<d){if(0===(g=n(c,h,t)))return 0;o^=0<g|0}else if(i===d){var p=(m=e[(l+1)%a])[1];if(d<p){if(0===(g=n(c,h,t)))return 0;o^=0<g|0}}}else if(d<f){if(d<i&&i<f){if(0===(g=n(c,h,t)))return 0;o^=g<0|0}else if(i===d){var m=e[(l+1)%a];if((p=m[1])<d){var g;if(0===(g=n(c,h,t)))return 0;o^=g<0|0}}}else if(i===d){var v=Math.min(c[0],h[0]),y=Math.max(c[0],h[0]);if(0===l){for(;u>0;){var _=(u+a-1)%a;if((w=e[_])[1]!==i)break;var b=w[0];v=Math.min(v,b),y=Math.max(y,b),u=_}if(0===u)return v<=r&&r<=y?0:1;s=u+1}for(var E=e[(u+a-1)%a][1];l+1<s;){var w;if((w=e[l+1])[1]!==i)break;b=w[0];v=Math.min(v,b),y=Math.max(y,b),l+=1}if(v<=r&&r<=y)return 0;var x=e[(l+1)%a][1];r<v&&E<i!=x<i&&(o^=1)}}return 2*o-1};var n=r(21)},function(e,t,r){"use strict";var n=r(1),i=32;function a(e){switch(e){case"uint8":return[n.mallocUint8,n.freeUint8];case"uint16":return[n.mallocUint16,n.freeUint16];case"uint32":return[n.mallocUint32,n.freeUint32];case"int8":return[n.mallocInt8,n.freeInt8];case"int16":return[n.mallocInt16,n.freeInt16];case"int32":return[n.mallocInt32,n.freeInt32];case"float32":return[n.mallocFloat,n.freeFloat];case"float64":return[n.mallocDouble,n.freeDouble];default:return null}}function o(e){for(var t=[],r=0;r<e;++r)t.push("s"+r);for(r=0;r<e;++r)t.push("n"+r);for(r=1;r<e;++r)t.push("d"+r);for(r=1;r<e;++r)t.push("e"+r);for(r=1;r<e;++r)t.push("f"+r);return t}function s(e,t){var r=["'use strict'"],n=["ndarraySortWrapper",e.join("d"),t].join("");r.push(["function ",n,"(",["array"].join(","),"){"].join(""));for(var s=["data=array.data,offset=array.offset|0,shape=array.shape,stride=array.stride"],l=0;l<e.length;++l)s.push(["s",l,"=stride[",l,"]|0,n",l,"=shape[",l,"]|0"].join(""));var u=new Array(e.length),c=[];for(l=0;l<e.length;++l){0!==(f=e[l])&&(0===c.length?u[f]="1":u[f]=c.join("*"),c.push("n"+f))}var h=-1,d=-1;for(l=0;l<e.length;++l){var f,p=e[l];0!==p&&(h>0?s.push(["d",p,"=s",p,"-d",h,"*n",h].join("")):s.push(["d",p,"=s",p].join("")),h=p),0!==(f=e.length-1-l)&&(d>0?s.push(["e",f,"=s",f,"-e",d,"*n",d,",f",f,"=",u[f],"-f",d,"*n",d].join("")):s.push(["e",f,"=s",f,",f",f,"=",u[f]].join("")),d=f)}r.push("var "+s.join(","));var m=["0","n0-1","data","offset"].concat(o(e.length));r.push(["if(n0<=",i,"){","insertionSort(",m.join(","),")}else{","quickSort(",m.join(","),")}"].join("")),r.push("}return "+n);var g=new Function("insertionSort","quickSort",r.join("\n")),v=function(e,t){var r=["'use strict'"],n=["ndarrayInsertionSort",e.join("d"),t].join(""),i=["left","right","data","offset"].concat(o(e.length)),s=a(t),l=["i,j,cptr,ptr=left*s0+offset"];if(e.length>1){for(var u=[],c=1;c<e.length;++c)l.push("i"+c),u.push("n"+c);s?l.push("scratch=malloc("+u.join("*")+")"):l.push("scratch=new Array("+u.join("*")+")"),l.push("dptr","sptr","a","b")}else l.push("scratch");function h(e){return"generic"===t?["data.get(",e,")"].join(""):["data[",e,"]"].join("")}function d(e,r){return"generic"===t?["data.set(",e,",",r,")"].join(""):["data[",e,"]=",r].join("")}if(r.push(["function ",n,"(",i.join(","),"){var ",l.join(",")].join(""),"for(i=left+1;i<=right;++i){","j=i;ptr+=s0","cptr=ptr"),e.length>1){r.push("dptr=0;sptr=ptr");for(c=e.length-1;c>=0;--c){0!==(f=e[c])&&r.push(["for(i",f,"=0;i",f,"<n",f,";++i",f,"){"].join(""))}r.push("scratch[dptr++]=",h("sptr"));for(c=0;c<e.length;++c){0!==(f=e[c])&&r.push("sptr+=d"+f,"}")}r.push("__g:while(j--\x3eleft){","dptr=0","sptr=cptr-s0");for(c=1;c<e.length;++c)1===c&&r.push("__l:"),r.push(["for(i",c,"=0;i",c,"<n",c,";++i",c,"){"].join(""));r.push(["a=",h("sptr"),"\nb=scratch[dptr]\nif(a<b){break __g}\nif(a>b){break __l}"].join(""));for(c=e.length-1;c>=1;--c)r.push("sptr+=e"+c,"dptr+=f"+c,"}");r.push("dptr=cptr;sptr=cptr-s0");for(c=e.length-1;c>=0;--c){0!==(f=e[c])&&r.push(["for(i",f,"=0;i",f,"<n",f,";++i",f,"){"].join(""))}r.push(d("dptr",h("sptr")));for(c=0;c<e.length;++c){0!==(f=e[c])&&r.push(["dptr+=d",f,";sptr+=d",f].join(""),"}")}r.push("cptr-=s0\n}"),r.push("dptr=cptr;sptr=0");for(c=e.length-1;c>=0;--c){0!==(f=e[c])&&r.push(["for(i",f,"=0;i",f,"<n",f,";++i",f,"){"].join(""))}r.push(d("dptr","scratch[sptr++]"));for(c=0;c<e.length;++c){var f;0!==(f=e[c])&&r.push("dptr+=d"+f,"}")}}else r.push("scratch="+h("ptr"),"while((j--\x3eleft)&&("+h("cptr-s0")+">scratch)){",d("cptr",h("cptr-s0")),"cptr-=s0","}",d("cptr","scratch"));return r.push("}"),e.length>1&&s&&r.push("free(scratch)"),r.push("} return "+n),s?new Function("malloc","free",r.join("\n"))(s[0],s[1]):new Function(r.join("\n"))()}(e,t),y=function(e,t,r){var n=["'use strict'"],s=["ndarrayQuickSort",e.join("d"),t].join(""),l=["left","right","data","offset"].concat(o(e.length)),u=a(t),c=0;n.push(["function ",s,"(",l.join(","),"){"].join(""));var h=["sixth=((right-left+1)/6)|0","index1=left+sixth","index5=right-sixth","index3=(left+right)>>1","index2=index3-sixth","index4=index3+sixth","el1=index1","el2=index2","el3=index3","el4=index4","el5=index5","less=left+1","great=right-1","pivots_are_equal=true","tmp","tmp0","x","y","z","k","ptr0","ptr1","ptr2","comp_pivot1=0","comp_pivot2=0","comp=0"];if(e.length>1){for(var d=[],f=1;f<e.length;++f)d.push("n"+f),h.push("i"+f);for(f=0;f<8;++f)h.push("b_ptr"+f);h.push("ptr3","ptr4","ptr5","ptr6","ptr7","pivot_ptr","ptr_shift","elementSize="+d.join("*")),u?h.push("pivot1=malloc(elementSize)","pivot2=malloc(elementSize)"):h.push("pivot1=new Array(elementSize),pivot2=new Array(elementSize)")}else h.push("pivot1","pivot2");function p(e){return["(offset+",e,"*s0)"].join("")}function m(e){return"generic"===t?["data.get(",e,")"].join(""):["data[",e,"]"].join("")}function g(e,r){return"generic"===t?["data.set(",e,",",r,")"].join(""):["data[",e,"]=",r].join("")}function v(t,r,i){if(1===t.length)n.push("ptr0="+p(t[0]));else for(var a=0;a<t.length;++a)n.push(["b_ptr",a,"=s0*",t[a]].join(""));r&&n.push("pivot_ptr=0"),n.push("ptr_shift=offset");for(a=e.length-1;a>=0;--a){0!==(o=e[a])&&n.push(["for(i",o,"=0;i",o,"<n",o,";++i",o,"){"].join(""))}if(t.length>1)for(a=0;a<t.length;++a)n.push(["ptr",a,"=b_ptr",a,"+ptr_shift"].join(""));n.push(i),r&&n.push("++pivot_ptr");for(a=0;a<e.length;++a){var o;0!==(o=e[a])&&(t.length>1?n.push("ptr_shift+=d"+o):n.push("ptr0+=d"+o),n.push("}"))}}function y(t,r,i,a){if(1===r.length)n.push("ptr0="+p(r[0]));else{for(var o=0;o<r.length;++o)n.push(["b_ptr",o,"=s0*",r[o]].join(""));n.push("ptr_shift=offset")}i&&n.push("pivot_ptr=0"),t&&n.push(t+":");for(o=1;o<e.length;++o)n.push(["for(i",o,"=0;i",o,"<n",o,";++i",o,"){"].join(""));if(r.length>1)for(o=0;o<r.length;++o)n.push(["ptr",o,"=b_ptr",o,"+ptr_shift"].join(""));n.push(a);for(o=e.length-1;o>=1;--o)i&&n.push("pivot_ptr+=f"+o),r.length>1?n.push("ptr_shift+=e"+o):n.push("ptr0+=e"+o),n.push("}")}function _(){e.length>1&&u&&n.push("free(pivot1)","free(pivot2)")}function b(t,r){var i="el"+t,a="el"+r;if(e.length>1){var o="__l"+ ++c;y(o,[i,a],!1,["comp=",m("ptr0"),"-",m("ptr1"),"\n","if(comp>0){tmp0=",i,";",i,"=",a,";",a,"=tmp0;break ",o,"}\n","if(comp<0){break ",o,"}"].join(""))}else n.push(["if(",m(p(i)),">",m(p(a)),"){tmp0=",i,";",i,"=",a,";",a,"=tmp0}"].join(""))}function E(t,r){e.length>1?v([t,r],!1,g("ptr0",m("ptr1"))):n.push(g(p(t),m(p(r))))}function w(t,r,i){if(e.length>1){var a="__l"+ ++c;y(a,[r],!0,[t,"=",m("ptr0"),"-pivot",i,"[pivot_ptr]\n","if(",t,"!==0){break ",a,"}"].join(""))}else n.push([t,"=",m(p(r)),"-pivot",i].join(""))}function x(t,r){e.length>1?v([t,r],!1,["tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1","tmp")].join("")):n.push(["ptr0=",p(t),"\n","ptr1=",p(r),"\n","tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1","tmp")].join(""))}function T(t,r,i){e.length>1?(v([t,r,i],!1,["tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1",m("ptr2")),"\n",g("ptr2","tmp")].join("")),n.push("++"+r,"--"+i)):n.push(["ptr0=",p(t),"\n","ptr1=",p(r),"\n","ptr2=",p(i),"\n","++",r,"\n","--",i,"\n","tmp=",m("ptr0"),"\n",g("ptr0",m("ptr1")),"\n",g("ptr1",m("ptr2")),"\n",g("ptr2","tmp")].join(""))}function M(e,t){x(e,t),n.push("--"+t)}function S(t,r,i){e.length>1?v([t,r],!0,[g("ptr0",m("ptr1")),"\n",g("ptr1",["pivot",i,"[pivot_ptr]"].join(""))].join("")):n.push(g(p(t),m(p(r))),g(p(r),"pivot"+i))}function A(t,r){n.push(["if((",r,"-",t,")<=",i,"){\n","insertionSort(",t,",",r,",data,offset,",o(e.length).join(","),")\n","}else{\n",s,"(",t,",",r,",data,offset,",o(e.length).join(","),")\n","}"].join(""))}function R(t,r,i){e.length>1?(n.push(["__l",++c,":while(true){"].join("")),v([t],!0,["if(",m("ptr0"),"!==pivot",r,"[pivot_ptr]){break __l",c,"}"].join("")),n.push(i,"}")):n.push(["while(",m(p(t)),"===pivot",r,"){",i,"}"].join(""))}return n.push("var "+h.join(",")),b(1,2),b(4,5),b(1,3),b(2,3),b(1,4),b(3,4),b(2,5),b(2,3),b(4,5),e.length>1?v(["el1","el2","el3","el4","el5","index1","index3","index5"],!0,["pivot1[pivot_ptr]=",m("ptr1"),"\n","pivot2[pivot_ptr]=",m("ptr3"),"\n","pivots_are_equal=pivots_are_equal&&(pivot1[pivot_ptr]===pivot2[pivot_ptr])\n","x=",m("ptr0"),"\n","y=",m("ptr2"),"\n","z=",m("ptr4"),"\n",g("ptr5","x"),"\n",g("ptr6","y"),"\n",g("ptr7","z")].join("")):n.push(["pivot1=",m(p("el2")),"\n","pivot2=",m(p("el4")),"\n","pivots_are_equal=pivot1===pivot2\n","x=",m(p("el1")),"\n","y=",m(p("el3")),"\n","z=",m(p("el5")),"\n",g(p("index1"),"x"),"\n",g(p("index3"),"y"),"\n",g(p("index5"),"z")].join("")),E("index2","left"),E("index4","right"),n.push("if(pivots_are_equal){"),n.push("for(k=less;k<=great;++k){"),w("comp","k",1),n.push("if(comp===0){continue}"),n.push("if(comp<0){"),n.push("if(k!==less){"),x("k","less"),n.push("}"),n.push("++less"),n.push("}else{"),n.push("while(true){"),w("comp","great",1),n.push("if(comp>0){"),n.push("great--"),n.push("}else if(comp<0){"),T("k","less","great"),n.push("break"),n.push("}else{"),M("k","great"),n.push("break"),n.push("}"),n.push("}"),n.push("}"),n.push("}"),n.push("}else{"),n.push("for(k=less;k<=great;++k){"),w("comp_pivot1","k",1),n.push("if(comp_pivot1<0){"),n.push("if(k!==less){"),x("k","less"),n.push("}"),n.push("++less"),n.push("}else{"),w("comp_pivot2","k",2),n.push("if(comp_pivot2>0){"),n.push("while(true){"),w("comp","great",2),n.push("if(comp>0){"),n.push("if(--great<k){break}"),n.push("continue"),n.push("}else{"),w("comp","great",1),n.push("if(comp<0){"),T("k","less","great"),n.push("}else{"),M("k","great"),n.push("}"),n.push("break"),n.push("}"),n.push("}"),n.push("}"),n.push("}"),n.push("}"),n.push("}"),S("left","(less-1)",1),S("right","(great+1)",2),A("left","(less-2)"),A("(great+2)","right"),n.push("if(pivots_are_equal){"),_(),n.push("return"),n.push("}"),n.push("if(less<index1&&great>index5){"),R("less",1,"++less"),R("great",2,"--great"),n.push("for(k=less;k<=great;++k){"),w("comp_pivot1","k",1),n.push("if(comp_pivot1===0){"),n.push("if(k!==less){"),x("k","less"),n.push("}"),n.push("++less"),n.push("}else{"),w("comp_pivot2","k",2),n.push("if(comp_pivot2===0){"),n.push("while(true){"),w("comp","great",2),n.push("if(comp===0){"),n.push("if(--great<k){break}"),n.push("continue"),n.push("}else{"),w("comp","great",1),n.push("if(comp<0){"),T("k","less","great"),n.push("}else{"),M("k","great"),n.push("}"),n.push("break"),n.push("}"),n.push("}"),n.push("}"),n.push("}"),n.push("}"),n.push("}"),_(),A("less","great"),n.push("}return "+s),e.length>1&&u?new Function("insertionSort","malloc","free",n.join("\n"))(r,u[0],u[1]):new Function("insertionSort",n.join("\n"))(r)}(e,t,v);return g(v,y)}var l={};e.exports=function(e){var t=e.order,r=e.dtype,n=[t,r].join(":"),i=l[n];return i||(l[n]=i=s(t,r)),i(e),e}},function(e,t,r){var n=r(23).rasterize,i=r(23).contour,a=r(14).angleNormals,o=r(41);function s(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],l=r[2];return e[0]=i*l-a*s,e[1]=a*o-n*l,e[2]=n*s-i*o,e}function l(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function u(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}var c=[0,0,0],h=[0,0,0],d=[0,0,0],f=[0,0,0],p=[0,0,0];function m(e,t,r,n,i){u(c,n,r),u(h,i,r),s(f,t,h);var a=l(c,f);if(Math.abs(a)<1e-4)return 1/0;u(d,e,r);var o=l(d,f);if(o<0||o>a)return 1/0;s(p,d,c);var m=l(t,p);return m<0||o+m>a?1/0:l(h,p)/a}e.exports=function(e,t,r){var s,l=r||{},u=2*(s="tolerance"in l?l.tolerance:function(e,t){for(var r=0,n=0;n<e.length;++n)for(var i=e[n],a=0;a<3;++a){var o=t[i[a]],s=t[i[(a+1)%3]];r+=Math.sqrt(Math.pow(o[0]-s[0],2)+Math.pow(o[1]-s[1],2)+Math.pow(o[2]-s[2],2))}return 2*r/(3*e.length)}(e,t)),c=i(n(e,t,{resolution:.5*s})),h=function(e,t,r){for(var n={},i=0;i<e.length;++i)for(var a=e[i],o=t[a[0]],s=t[a[1]],l=t[a[2]],u=Math.floor(Math.min(o[0],s[0],l[0])/r)-1,c=Math.floor(Math.min(o[1],s[1],l[1])/r)-1,h=Math.floor(Math.min(o[2],s[2],l[2])/r)-1,d=Math.ceil(Math.max(o[0],s[0],l[0])/r)+1,f=Math.ceil(Math.max(o[1],s[1],l[1])/r)+1,p=Math.ceil(Math.max(o[2],s[2],l[2])/r)+1,m=u;m<=d;++m)for(var g=c;g<=f;++g)for(var v=h;v<=p;++v){var y=m+","+g+","+v,_=n[y];_?_.push(a):n[y]=[a]}return n}(e,t,u);return c.normals=a(c.cells,c.positions),function(e,t,r,n,i){for(var a=0;a<r.length;++a){var o=r[a],s=o[0],l=o[1],u=o[1],c=e[Math.floor(s/i)+","+Math.floor(l/i)+","+Math.floor(u/i)];if(c){for(var h=n[a],d=1/0,f=0;f<c.length;++f){var p=c[f],g=m(o,h,t[p[0]],t[p[1]],t[p[2]]);Math.abs(g)<Math.abs(d)&&(d=g,p)}Math.abs(d)}}}(h,t,(c=o(c.cells,c.positions,c.normals,{edgeLength:.5*s})).positions,c.normals,u),c}},function(e,t,r){var n=r(1);function i(e,t,r){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(r,2))}function a(e,t,r){for(var n=0;n<3;++n)e[n]+=t[n]*r}function o(e){for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=e[r].slice();return t}function s(e,t,r,n,o){var s,l=t.length,u=e.length;for(s=0;s<l;++s){var c=r[s];c[0]=c[1]=c[2]=0}for(s=0;s<l;++s)n[s]=0;for(s=0;s<u;++s){var h=e[s],d=h[0],f=h[1],p=h[2],m=t[d],g=t[f],v=t[p],y=m[0]-g[0],_=m[1]-g[1],b=m[2]-g[2],E=g[0]-v[0],w=g[1]-v[1],x=g[2]-v[2],T=v[0]-m[0],M=v[1]-m[1],S=v[2]-m[2],A=.5*i(_*S-b*M,b*T-y*S,y*M-_*T);if(!(A<1e-8)){var R=-.5/A,k=R*(y*T+_*M+b*S),P=R*(E*y+w*_+x*b),L=R*(T*E+M*w+S*x);n[d]+=P+L,n[f]+=L+k,n[p]+=k+P;var C=r[d],I=r[f],H=r[p];a(I,v,k),a(H,g,k),a(H,m,P),a(C,v,P),a(C,g,L),a(I,m,L)}}for(s=0;s<l;++s)for(var O=r[s],D=t[s],F=n[s],N=0;N<3;++N){var U=D[N];O[N]=U+o*(O[N]/F-U)}}e.exports=function(e,t,r){for(var i=r||{},a=("passBand"in i?+i.passBand:.1),l=("iters"in i?0|i.iters:10),u=n.mallocDouble(t.length),c=o(t),h=o(t),d=a,f=Math.sqrt(d*d- -8),p=(-d+f)/-4,m=(-d-f)/-4,g=Math.max(p,m),v=Math.min(p,m),y=0;y<l;++y)s(e,c,h,u,g),s(e,h,c,u,v);return n.free(u),c}},function(e,t,r){var n,i,a,o,s,l=r(14).angleNormals,u=null,c=null,h=null,d=null,f=!1,p=!1;function m(){if(!f)throw new Error("Must call initModule() before calling this function!")}function g(e){a=e;for(var t=new Int32Array(3*a.cells.length),r=0,o=0;o<a.cells.length;++o){var s=a.cells[o];t[r++]=s[0],t[r++]=s[1],t[r++]=s[2]}var l=t.length*t.BYTES_PER_ELEMENT;d=Module._malloc(l),(n=new Uint8Array(Module.HEAPU8.buffer,d,l)).set(new Uint8Array(t.buffer));var u=new Float64Array(3*a.positions.length);for(r=0,o=0;o<a.positions.length;++o){s=a.positions[o];u[r++]=s[0],u[r++]=s[1],u[r++]=s[2]}l=u.length*u.BYTES_PER_ELEMENT;h=Module._malloc(l),(i=new Uint8Array(Module.HEAPU8.buffer,h,l)).set(new Uint8Array(u.buffer)),f=!0}function v(e,t){m(),o=[];var r=0;for(const t of e)o[r++]=t;s=r;for(const e of t)o[r++]=e;var l=new Int32Array(o),c=l.length*l.BYTES_PER_ELEMENT;null!==u&&(Module._free(u),u=null),u=Module._malloc(c);var h=new Uint8Array(Module.HEAPU8.buffer,u,c);h.set(new Uint8Array(l.buffer)),prepareDeformWrap(n.byteOffset,3*a.cells.length,i.byteOffset,3*a.positions.length,h.byteOffset,o.length,s,!0),p=!0}function y(e){!function(){if(!p)throw new Error("Must call prepareDeform() before calling this function!")}();for(var t=s,r=new Float64Array(3*t),n=0,o=0;o<e.length;++o)r[n++]=e[o][0],r[n++]=e[o][1],r[n++]=e[o][2];var l=r.length*r.BYTES_PER_ELEMENT;null!==c&&(Module._free(c),c=null),c=Module._malloc(l);var u=new Uint8Array(Module.HEAPU8.buffer,c,l);u.set(new Uint8Array(r.buffer)),doDeformWrap(u.byteOffset,t,i.byteOffset);var h=new Float64Array(i.buffer,i.byteOffset,3*a.positions.length),d=[];for(o=0;o<a.positions.length;++o)d[o]=[h[3*o+0],h[3*o+1],h[3*o+2]];return d}function _(){m(),Module._free(h),Module._free(d),null!==u&&(Module._free(u),u=null),null!==c&&(Module._free(c),c=null),freeDeformWrap(),f=!1}e.exports={msh:null,adj:[],roi:{},_getOneRing:function(e){for(var t=[],r=0,n=e.positions.length;r<n;r++)t[r]=[];for(r=0,n=e.cells.length;r<n;r++)for(var i=e.cells[r],a=0;a<3;a++){var o=i[a+0],s=i[(a+1)%3];t[o].push(s)}return t},setMesh:function(e,t){if(this.msh===e&&f)t&&t();else{var r=this;r.dispose(),function(e){Module={},new Promise(t=>{fetch("./trimesh/laplacian_deformation.wasm").then(e=>e.arrayBuffer()).then(r=>{Module.wasmBinary=r;const n=document.createElement("script");n.src="./trimesh/laplacian_deformation.js",Module.onRuntimeInitialized=function(){prepareDeformWrap=Module.cwrap("prepareDeform",null,["number","number","number","number","number","number","number","number"]),doDeformWrap=Module.cwrap("doDeform",null,["number","number","number"]),freeDeformWrap=Module.cwrap("freeDeform",null,[]),e(g,v,y,_)},n.onload=()=>{t(Module)},document.body.appendChild(n)})}).then(e=>{})}((function(n,i,a,o){r._initModule=n,r._prepareDeform=i,r._doDeform=a,r._freeModule=o,r.msh=e,void 0===e.normals&&(e.normals=l(e.cells,e.positions)),r.adj=r._getOneRing(e),r._initModule(e),t&&t()}))}},setROI:function(e,t,r,n){var i=this.adj,a=this.roi;a.handles=[],a.unconstrained=[];for(var o=[e],s=[],l=0,u=this.msh.positions.length;l<u;l++)s[l]=!1;for(var c=0;c<t;c++){var h=[];for(l=0;l<o.length;l++){if(!s[p=o[l]]){a.handles.push(p),s[p]=!0;for(var d=i[p],f=0;f<d.length;f++)h.push(d[f])}}o=h}for(c=0;c<r;c++){for(h=[],l=0;l<o.length;l++){if(!s[p=o[l]]){a.unconstrained.push(p),s[p]=!0;for(d=i[p],f=0;f<d.length;f++)h.push(d[f])}}o=h}a.boundaryIndices=a.handles.length;for(l=0;l<o.length;l++){var p;s[p=o[l]]||(a.handles.push(p),s[p]=!0)}this._prepareDeform(a.handles,a.unconstrained),n&&n()},deform:function(e,t){var r=this.roi;if(r.handles&&0!==r.handles.length){for(var n=r.handles,i=r.boundaryIndices,a=[],o=this.msh.positions,s=0,l=n.length;s<l;s++)s>=i?a.push([o[n[s]][0],o[n[s]][1],o[n[s]][2]]):a.push([o[n[s]][0]+e[0],o[n[s]][1]+e[1],o[n[s]][2]+e[2]]);var u=this._doDeform(a);for(s=0,l=u.length;s<l;s++)o[s]=u[s];if(!t)return this.msh;t(this.msh)}},dispose:function(){this.msh=null,this.adj=[],this.roi={},f&&this._freeModule()},run:function(e,t,r,n,i,a){var o=this;o.setMesh(e,(function(){o.setROI(t,n,i,(function(){o.deform(r,(function(e){a&&a(e)}))}))}))}}},function(e,t,r){"use strict";e.exports=function(e,t){for(var r=function(e,t){return n.unique(n.normalize(n.skeleton(e,t)))}(e,1),l=n.incidence(r,e),u=n.dual(e,t.length),c=[],h=[],d=new Array(r.length),f=new Array(t.length),p=0;p<d.length;++p)d[p]=-1;for(p=0;p<f.length;++p)f[p]=-1;for(var m=0;m<e.length;++m){for(var g=e[m],v=0;v<3;++v){var y=g[v],_=g[(v+1)%3];s[0]=y,s[1]=_;var b=n.findCell(r,s),E=d[b];if(E>=0)a[v]=E;else{var w=l[b],x=t[_],T=t[y],M=new Array(3);if(2===w.length){var S=t[i(_,y,e[w[0]])],A=t[i(_,y,e[w[1]])];for(p=0;p<3;++p)M[p]=(3*(x[p]+T[p])+S[p]+A[p])/8}else for(p=0;p<3;++p)M[p]=.5*(x[p]+T[p]);d[b]=a[v]=c.length,c.push(M)}if(f[y]>=0)o[v]=f[y];else{var R=u[y],k=[y];for(p=0;p<R.length;++p)for(var P=e[R[p]],L=0;L<3;++L)-1!==k.indexOf(P[L])&&k.push(P[L]);var C=3===R.length?3/16:3/(8*R.length),I=1-R.length*C,H=t[y];for(M=[.1,.1,.1],p=0;p<3;++p)M[p]=I*H[p];for(p=1;p<k.length;++p){var O=t[k[p]];for(L=0;L<3;++L)M[L]+=C*O[L]}o[v]=f[y]=c.length,c.push(M)}}h.push([o[0],a[0],a[2]],[a[0],a[1],a[2]],[a[0],o[1],a[1]],[a[1],o[2],a[2]])}return{positions:c,cells:h}};var n=r(24);function i(e,t,r){for(var n=0;n<3;++n)if(r[n]!==e&&r[n]!==t)return r[n];return 0}var a=[0,0,0],o=[0,0,0],s=[0,0]},function(e,t,r){"use strict";function n(e){this.roots=new Array(e),this.ranks=new Array(e);for(var t=0;t<e;++t)this.roots[t]=t,this.ranks[t]=0}e.exports=n;var i=n.prototype;Object.defineProperty(i,"length",{get:function(){return this.roots.length}}),i.makeSet=function(){var e=this.roots.length;return this.roots.push(e),this.ranks.push(0),e},i.find=function(e){for(var t=e,r=this.roots;r[e]!==e;)e=r[e];for(;r[t]!==e;){var n=r[t];r[t]=e,t=n}return e},i.link=function(e,t){var r=this.find(e),n=this.find(t);if(r!==n){var i=this.ranks,a=this.roots,o=i[r],s=i[n];o<s?a[r]=n:s<o?a[n]=r:(a[n]=r,++i[r])}}},function(e,t,r){"use strict";e.exports=function(e,t){var r,a=i.fromList(n(e,t)),o=t.length,s=new Array(o),l=new Array(o),u=new Array(o),c=new Array(o);for(r=0;r<o;++r){var h=t[r];s[r]=h[0],l[r]=h[1],u[r]=h[2],c[r]=0}for(a.apply(s,c),r=0;r<o;++r)c[r]=Math.pow(c[r],2),s[r]=0;for(a.apply(l,s),r=0;r<o;++r)c[r]+=Math.pow(s[r],2),s[r]=0;for(a.apply(u,s),r=0;r<o;++r)c[r]+=Math.pow(s[r],2),s[r]=0;for(r=0;r<o;++r)c[r]=Math.sqrt(c[r]);return c};var n=r(172),i=r(173)},function(e,t,r){"use strict";var n=r(1);function i(e,t){return e[0]-t[0]||e[1]-t[1]}e.exports=function(e,t){for(var r=t.length,a=e.length,o=n.mallocDouble(r),s=0;s<r;++s)o[s]=0;var l=[];for(s=0;s<a;++s){var u=e[s],c=u[0],h=u[1],d=u[2],f=t[c],p=t[h],m=t[d],g=f[0]-p[0],v=f[1]-p[1],y=f[2]-p[2],_=p[0]-m[0],b=p[1]-m[1],E=p[2]-m[2],w=m[0]-f[0],x=m[1]-f[1],T=m[2]-f[2],M=.5*(L=v*T-y*x,C=y*w-g*T,I=g*x-v*w,Math.sqrt(Math.pow(L,2)+Math.pow(C,2)+Math.pow(I,2)));if(!(M<1e-8)){var S=-.5/M,A=S*(g*w+v*x+y*T),R=S*(_*g+b*v+E*y),k=S*(w*_+x*b+T*E),P=M/3;o[c]+=P,o[h]+=P,o[d]+=P,l.push([h,d,A],[d,h,A],[d,c,R],[c,d,R],[c,h,k],[h,c,k])}}var L,C,I;var H=n.mallocDouble(r);for(s=0;s<r;++s)H[s]=0;l.sort(i);var O=0;for(s=0;s<l.length;){for(var D=l[s++];s<l.length&&l[s][0]===D[0]&&l[s][1]===D[1];)D[2]+=l[s++][2];D[2]/=o[D[0]],H[D[0]]+=D[2],l[O++]=D}l.length=O;for(s=0;s<r;++s)l.push([s,s,-H[s]]);return n.free(o),n.free(H),l}},function(e,t,r){"use strict";var n=r(174),i=r(15);e.exports={fromList:u,fromDictionary:function(e,t,r){return u(Object.keys(e).map((function(t){var r=t.split(",");return[0|r[0],0|r[1],e[t]]})),t,r)},fromDense:function(e){var t=[],r=e.length;if(0===r)return u([],0,0);for(var n=e[0].length,i=0;i<r;++i)for(var o=e[i],s=0;s<n;++s){var l=o[s];Math.abs(l)>a&&t.push([i,s,l])}return u(t,r,n)},fromNDArray:function(e){var t=[],r=e.shape[0],n=e.shape[1];if(e.stride[1]>e.stride[0])for(var i=0;i<n;++i)for(var a=0;a<r;++a)t.push([a,i,e.get(a,i)]);else for(a=0;a<r;++a)for(i=0;i<n;++i)t.push([a,i,e.get(a,i)]);return u(t,r,n)}};var a=n.DBL_EPSILON;function o(e,t,r,n,i){this.rows=e,this.row_ptrs=t,this.columns=r,this.column_ptrs=n,this.data=i}var s=o.prototype;function l(e,t){return e[0]-t[0]||e[1]-t[1]}function u(e,t,r){e=function(e,t,r){var n=0,i=0;for(e.sort(l);n<e.length;){var o=e[n++];if(!(o[0]>=t||o[1]>=r)){for(;n<e.length&&0===l(e[n],o);)o[2]+=e[n++][2];Math.abs(o[2])>a&&(e[i++]=o)}}return e.length=i,e}(e,t||1/0,r||1/0);var n=[],i=[],s=[],u=[],c=new Float64Array(e.length);t=t||0,r=r||0;for(var h=0;h<e.length;++h){var d=e[h];0===h||d[0]!==e[h-1][0]?(n.push(d[0]),i.push(s.length),s.push(d[1]),u.push(h)):d[1]!==e[h-1][1]+1&&(s.push(d[1]),u.push(h)),t=Math.max(t,d[0]+1),r=Math.max(r,d[1]+1),c[h]=d[2]}return n.push(t),i.push(s.length),s.push(r),u.push(c.length),new o(new Uint32Array(n),new Uint32Array(i),new Uint32Array(s),new Uint32Array(u),c)}Object.defineProperty(s,"rowCount",{get:function(){return this.rows[this.rows.length-1]}}),Object.defineProperty(s,"columnCount",{get:function(){return this.columns[this.columns.length-1]}}),s.apply=function(e,t){return function(e,t,r,n,i,a,o){for(var s=0,l=0,u=0,c=0,h=e.length-1;c<h;++c){for(var d=e[c],f=t[c+1],p=0;++u<d;)o[u]=0;for(;s<f;)for(var m=r[s],g=n[++s];l<g;)p+=i[l++]*a[m++];o[d]=p}for(var v=o.length;++u<v;)o[u]=0}(this.rows,this.row_ptrs,this.columns,this.column_ptrs,this.data,e,t),t},s.transpose=function(){for(var e=this.toList(),t=0;t<e.length;++t){var r=e[t],n=r[0];r[0]=r[1],r[1]=n}return u(e,this.columnCount,this.rowCount)},s.toList=function(){for(var e=[],t=0,r=this.rows.length-1;t<r;++t)for(var n=this.rows[t],i=this.row_ptrs[t],a=this.row_ptrs[t+1];i<a;++i)for(var o=this.columns[i],s=this.column_ptrs[i],l=this.column_ptrs[i+1];s<l;++s){var u=this.data[s];e.push([n,o++,u])}return e},s.toDictionary=function(){for(var e={},t=0,r=this.rows.length-1;t<r;++t)for(var n=this.rows[t],i=this.row_ptrs[t],a=this.row_ptrs[t+1];i<a;++i)for(var o=this.columns[i],s=this.column_ptrs[i],l=this.column_ptrs[i+1];s<l;++s){var u=this.data[s];e[[n,o++]]=u}return e},s.toDense=function(){for(var e=i([this.rowCount,this.columnCount],0),t=0,r=this.rows.length-1;t<r;++t)for(var n=this.rows[t],a=this.row_ptrs[t],o=this.row_ptrs[t+1];a<o;++a)for(var s=this.columns[a],l=this.column_ptrs[a],u=this.column_ptrs[a+1];l<u;++l){var c=this.data[l];e[n][s++]=c}return e},o.prototype.toNDArray=function(e){for(var t=0,r=this.rows.length-1;t<r;++t)for(var n=this.rows[t],i=this.row_ptrs[t],a=this.row_ptrs[t+1];i<a;++i)for(var o=this.columns[i],s=this.column_ptrs[i],l=this.column_ptrs[i+1];s<l;++s){var u=this.data[s];e.set(n,o++,u)}return e}},function(e,t,r){"use strict";var n=Math.abs,i=Math.min;function a(e,t,r,o){var s=n(e-t);return null==r&&(r=a.DBL_EPSILON),null==o&&(o=r),s<=r||(s<=o*i(n(e),n(t))||e===t)}a.FLT_EPSILON=1.1920929e-7,a.DBL_EPSILON=2220446049250313e-31,e.exports=a},function(e,t,r){e.exports=function(e,t){return i(n(e,t))};var n=r(176),i=r(184)},function(e,t,r){"use strict";e.exports=function(e,t){return n(t).filter((function(r){for(var n=new Array(r.length),a=0;a<r.length;++a)n[a]=t[r[a]];return i(n)*e<1}))};var n=r(177),i=r(179)},function(e,t,r){"use strict";var n=r(178),i=r(43);function a(e,t){this.point=e,this.index=t}function o(e,t){for(var r=e.point,n=t.point,i=r.length,a=0;a<i;++a){var o=n[a]-r[a];if(o)return o}return 0}e.exports=function(e,t){var r=e.length;if(0===r)return[];var s=e[0].length;if(s<1)return[];if(1===s)return function(e,t,r){if(1===e)return r?[[-1,0]]:[];var n=t.map((function(e,t){return[e[0],t]}));n.sort((function(e,t){return e[0]-t[0]}));for(var i=new Array(e-1),a=1;a<e;++a){var o=n[a-1],s=n[a];i[a-1]=[o[1],s[1]]}r&&i.push([-1,i[0][1]],[i[e-1][1],-1]);return i}(r,e,t);for(var l=new Array(r),u=1,c=0;c<r;++c){for(var h=e[c],d=new Array(s+1),f=0,p=0;p<s;++p){var m=h[p];d[p]=m,f+=m*m}d[s]=f,l[c]=new a(d,c),u=Math.max(f,u)}i(l,o),r=l.length;var g=new Array(r+s+1),v=new Array(r+s+1),y=(s+1)*(s+1)*u,_=new Array(s+1);for(c=0;c<=s;++c)_[c]=0;_[s]=y,g[0]=_.slice(),v[0]=-1;for(c=0;c<=s;++c){(d=_.slice())[c]=1,g[c+1]=d,v[c+1]=-1}for(c=0;c<r;++c){var b=l[c];g[c+s+1]=b.point,v[c+s+1]=b.index}var E=n(g,!1);E=t?E.filter((function(e){for(var t=0,r=0;r<=s;++r){var n=v[e[r]];if(n<0&&++t>=2)return!1;e[r]=n}return!0})):E.filter((function(e){for(var t=0;t<=s;++t){var r=v[e[t]];if(r<0)return!1;e[t]=r}return!0}));if(1&s)for(c=0;c<E.length;++c){d=(b=E[c])[0];b[0]=b[1],b[1]=d}return E}},function(e,t,r){"use strict";e.exports=function(e,t){var r=e.length;if(0===r)throw new Error("Must have at least d+1 points");var i=e[0].length;if(r<=i)throw new Error("Must input at least d+1 points");var o=e.slice(0,i+1),s=n.apply(void 0,o);if(0===s)throw new Error("Input not in general position");for(var l=new Array(i+1),c=0;c<=i;++c)l[c]=c;s<0&&(l[0]=1,l[1]=0);var h=new a(l,new Array(i+1),!1),d=h.adjacent,f=new Array(i+2);for(c=0;c<=i;++c){for(var p=l.slice(),m=0;m<=i;++m)m===c&&(p[m]=-1);var g=p[0];p[0]=p[1],p[1]=g;var v=new a(p,new Array(i+1),!0);d[c]=v,f[c]=v}f[i+1]=h;for(c=0;c<=i;++c){p=d[c].vertices;var y=d[c].adjacent;for(m=0;m<=i;++m){var _=p[m];if(_<0)y[m]=h;else for(var b=0;b<=i;++b)d[b].vertices.indexOf(_)<0&&(y[m]=d[b])}}var E=new u(i,o,f),w=!!t;for(c=i+1;c<r;++c)E.insert(e[c],w);return E.boundary()};var n=r(21),i=r(24).compareCells;function a(e,t,r){this.vertices=e,this.adjacent=t,this.boundary=r,this.lastVisited=-1}function o(e,t,r){this.vertices=e,this.cell=t,this.index=r}function s(e,t){return i(e.vertices,t.vertices)}a.prototype.flip=function(){var e=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=e;var t=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=t};var l=[];function u(e,t,r){this.dimension=e,this.vertices=t,this.simplices=r,this.interior=r.filter((function(e){return!e.boundary})),this.tuple=new Array(e+1);for(var i=0;i<=e;++i)this.tuple[i]=this.vertices[i];var a=l[e];a||(a=l[e]=function(e){for(var t=["function orient(){var tuple=this.tuple;return test("],r=0;r<=e;++r)r>0&&t.push(","),t.push("tuple[",r,"]");t.push(")}return orient");var i=new Function("test",t.join("")),a=n[e+1];return a||(a=n),i(a)}(e)),this.orient=a}var c=u.prototype;c.handleBoundaryDegeneracy=function(e,t){var r=this.dimension,n=this.vertices.length-1,i=this.tuple,a=this.vertices,o=[e];for(e.lastVisited=-n;o.length>0;){(e=o.pop()).vertices;for(var s=e.adjacent,l=0;l<=r;++l){var u=s[l];if(u.boundary&&!(u.lastVisited<=-n)){for(var c=u.vertices,h=0;h<=r;++h){var d=c[h];i[h]=d<0?t:a[d]}var f=this.orient();if(f>0)return u;u.lastVisited=-n,0===f&&o.push(u)}}}return null},c.walk=function(e,t){var r=this.vertices.length-1,n=this.dimension,i=this.vertices,a=this.tuple,o=t?this.interior.length*Math.random()|0:this.interior.length-1,s=this.interior[o];e:for(;!s.boundary;){for(var l=s.vertices,u=s.adjacent,c=0;c<=n;++c)a[c]=i[l[c]];s.lastVisited=r;for(c=0;c<=n;++c){var h=u[c];if(!(h.lastVisited>=r)){var d=a[c];a[c]=e;var f=this.orient();if(a[c]=d,f<0){s=h;continue e}h.boundary?h.lastVisited=-r:h.lastVisited=r}}return}return s},c.addPeaks=function(e,t){var r=this.vertices.length-1,n=this.dimension,i=this.vertices,l=this.tuple,u=this.interior,c=this.simplices,h=[t];t.lastVisited=r,t.vertices[t.vertices.indexOf(-1)]=r,t.boundary=!1,u.push(t);for(var d=[];h.length>0;){var f=(t=h.pop()).vertices,p=t.adjacent,m=f.indexOf(r);if(!(m<0))for(var g=0;g<=n;++g)if(g!==m){var v=p[g];if(v.boundary&&!(v.lastVisited>=r)){var y=v.vertices;if(v.lastVisited!==-r){for(var _=0,b=0;b<=n;++b)y[b]<0?(_=b,l[b]=e):l[b]=i[y[b]];if(this.orient()>0){y[_]=r,v.boundary=!1,u.push(v),h.push(v),v.lastVisited=r;continue}v.lastVisited=-r}var E=v.adjacent,w=f.slice(),x=p.slice(),T=new a(w,x,!0);c.push(T);var M=E.indexOf(t);if(!(M<0)){E[M]=T,x[m]=v,w[g]=-1,x[g]=t,p[g]=T,T.flip();for(b=0;b<=n;++b){var S=w[b];if(!(S<0||S===r)){for(var A=new Array(n-1),R=0,k=0;k<=n;++k){var P=w[k];P<0||k===b||(A[R++]=P)}d.push(new o(A,T,b))}}}}}}d.sort(s);for(g=0;g+1<d.length;g+=2){var L=d[g],C=d[g+1],I=L.index,H=C.index;I<0||H<0||(L.cell.adjacent[L.index]=C.cell,C.cell.adjacent[C.index]=L.cell)}},c.insert=function(e,t){var r=this.vertices;r.push(e);var n=this.walk(e,t);if(n){for(var i=this.dimension,a=this.tuple,o=0;o<=i;++o){var s=n.vertices[o];a[o]=s<0?e:r[s]}var l=this.orient(a);l<0||(0!==l||(n=this.handleBoundaryDegeneracy(n,e)))&&this.addPeaks(e,n)}},c.boundary=function(){for(var e=this.dimension,t=[],r=this.simplices,n=r.length,i=0;i<n;++i){var a=r[i];if(a.boundary){for(var o=new Array(e),s=a.vertices,l=0,u=0,c=0;c<=e;++c)s[c]>=0?o[l++]=s[c]:u=1&c;if(u===(1&e)){var h=o[0];o[0]=o[1],o[1]=h}t.push(o)}}return t}},function(e,t,r){e.exports=function(e){for(var t=n(e),r=0,i=0;i<e.length;++i)for(var a=e[i],o=0;o<t.length;++o)r+=Math.pow(a[o]-t[o],2);return Math.sqrt(r/e.length)};var n=r(180)},function(e,t,r){"use strict";var n=r(15),i=r(181);function a(e,t){for(var r=0,n=e.length,i=0;i<n;++i)r+=e[i]*t[i];return r}function o(e){var t=e.length;if(0===t)return[];e[0].length;var r=n([e.length+1,e.length+1],1),o=n([e.length+1],1);r[t][t]=0;for(var s=0;s<t;++s){for(var l=0;l<=s;++l)r[l][s]=r[s][l]=2*a(e[s],e[l]);o[s]=a(e[s],e[s])}var u=i(r,o),c=0,h=u[t+1];for(s=0;s<h.length;++s)c+=h[s];var d=new Array(t);for(s=0;s<t;++s){h=u[s];var f=0;for(l=0;l<h.length;++l)f+=h[l];d[s]=f/c}return d}function s(e){if(0===e.length)return[];for(var t=e[0].length,r=n([t]),i=o(e),a=0;a<e.length;++a)for(var s=0;s<t;++s)r[s]+=e[a][s]*i[a];return r}s.barycenetric=o,e.exports=s},function(e,t,r){"use strict";var n=r(182);function i(e){for(var t="robustLinearSolve"+e+"d",r=["function ",t,"(A,b){return ["],i=0;i<e;++i){r.push("det([");for(var a=0;a<e;++a){a>0&&r.push(","),r.push("[");for(var o=0;o<e;++o)o>0&&r.push(","),o===i?r.push("+b[",a,"]"):r.push("+A[",a,"][",o,"]");r.push("]")}r.push("]),")}r.push("det(A)]}return ",t);var s=new Function("det",r.join(""));return s(e<6?n[e]:n)}var a=[function(){return[[0]]},function(e,t){return[[t[0]],[e[0][0]]]}];!function(){for(;a.length<6;)a.push(i(a.length));for(var t=[],r=["function dispatchLinearSolve(A,b){switch(A.length){"],n=0;n<6;++n)t.push("s"+n),r.push("case ",n,":return s",n,"(A,b);");r.push("}var s=CACHE[A.length];if(!s)s=CACHE[A.length]=g(A.length);return s(A,b)}return dispatchLinearSolve"),t.push("CACHE","g",r.join(""));var o=Function.apply(void 0,t);for(e.exports=o.apply(void 0,a.concat([a,i])),n=0;n<6;++n)e.exports[n]=a[n]}()},function(e,t,r){"use strict";var n=r(22),i=r(39),a=r(40),o=r(183);function s(e,t){for(var r=new Array(e.length-1),n=1;n<e.length;++n)for(var i=r[n-1]=new Array(e.length-1),a=0,o=0;a<e.length;++a)a!==t&&(i[o++]=e[n][a]);return r}function l(e){for(var t=new Array(e),r=0;r<e;++r){t[r]=new Array(e);for(var n=0;n<e;++n)t[r][n]=["m[",r,"][",n,"]"].join("")}return t}function u(e){if(2===e.length)return["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("");for(var t=[],r=0;r<e.length;++r)t.push(["scale(",u(s(e,r)),",",(n=r,1&n?"-":""),e[0][r],")"].join(""));return function e(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var r=t.length>>1;return["sum(",e(t.slice(0,r)),",",e(t.slice(r)),")"].join("")}(t);var n}function c(e){return new Function("sum","scale","prod","compress",["function robustDeterminant",e,"(m){return compress(",u(l(e)),")};return robustDeterminant",e].join(""))(i,a,n,o)}var h=[function(){return[0]},function(e){return[e[0][0]]}];!function(){for(;h.length<6;)h.push(c(h.length));for(var t=[],r=["function robustDeterminant(m){switch(m.length){"],n=0;n<6;++n)t.push("det"+n),r.push("case ",n,":return det",n,"(m);");r.push("}var det=CACHE[m.length];if(!det)det=CACHE[m.length]=gen(m.length);return det(m);}return robustDeterminant"),t.push("CACHE","gen",r.join(""));var i=Function.apply(void 0,t);for(e.exports=i.apply(void 0,h.concat([h,c])),n=0;n<h.length;++n)e.exports[n]=h[n]}()},function(e,t,r){"use strict";e.exports=function(e){for(var t=e.length,r=e[e.length-1],n=t,i=t-2;i>=0;--i){var a=r,o=e[i];(l=o-((r=a+o)-a))&&(e[--n]=r,r=l)}var s=0;for(i=n;i<t;++i){var l;a=e[i];(l=(o=r)-((r=a+o)-a))&&(e[s++]=l)}return e[s++]=r,e.length=s,e}},function(e,t,r){"use strict";e.exports=function(e){return i(n(e))};var n=r(185),i=r(186)},function(e,t,r){"use strict";e.exports=function(e){var t,r,n,i=e.length,a=0;for(t=0;t<i;++t)a+=e[t].length;var o=new Array(a),s=0;for(t=0;t<i;++t){var l=e[t],u=l.length;for(r=0;r<u;++r){var c=o[s++]=new Array(u-1),h=0;for(n=0;n<u;++n)n!==r&&(c[h++]=l[n]);if(1&r){var d=c[1];c[1]=c[0],c[0]=d}}}return o}},function(e,t,r){"use strict";var n=r(44),i=r(187),a=r(45);e.exports=function(e){e.sort(i);for(var t=e.length,r=0,o=0;o<t;++o){var s=e[o],l=a(s);if(0!==l){if(r>0){var u=e[r-1];if(0===n(s,u)&&a(u)!==l){r-=1;continue}}e[r++]=s}}return e.length=r,e}},function(e,t,r){"use strict";var n=r(44),i=r(45);e.exports=function(e,t){return n(e,t)||i(e)-i(t)}},function(e,t,r){var n=r(189),i=r(24);function a(e,t,r,n,i,a){for(var o=new Array(3),s=new Array(3),l=0,u=0;u<3;++u)o[u]=t[u]-e[u],l+=o[u]*o[u],s[u]=r[u]-e[u];if(l<1e-6)return 1e30;var c=Math.sqrt(l),h=1/c,d=0;for(u=0;u<3;++u)o[u]*=h,d+=o[u]*s[u];var f=0;for(u=0;u<3;++u)f+=Math.pow(s[u]-d*o[u],2);f=Math.sqrt(f);var p=n*n,m=(p-i*i+l)/(2*c),g=p-m*m;return g<0?1e30:(g=Math.sqrt(g),a<0&&(g*=-1),Math.sqrt(Math.pow(d-m,2)+Math.pow(f-g,2)))}function o(e,t){this.d=e,this.v=t}function s(e,t){return e.d-t.d}t.quadratic_distance=a,t.geodesic_distance=function(e,t,r,l,u,c){void 0===l&&(l=Number.POSITIVE_INFINITY),void 0===u&&(u=1e-4),"undefined"==typeof dual&&(c=i.dual(e,t.length));var h=function(e,t,r,i,a){var l=new n(s),u={};l.push(new o(0,e));for(var c=i[e],h=a*a;l.size()>0;){var d=l.pop();if(!(d.v in u)){var f=d.d,p=d.v;u[p]=f;for(var m=i[p],g=t[p],v=0;v<g.length;++v)for(var y=r[g[v]],_=0;_<y.length;++_){var b=y[_];if(b!==p&&!(b in u)){for(var E=i[b],w=0,x=0,T=0;T<3;++T)w+=Math.pow(m[T]-E[T],2),x+=Math.pow(c[T]-E[T],2);x<=h&&l.push(new o(Math.sqrt(w)+f,b))}}}}return u}(r,c,e,t,l);return function(e,t,r,n,i,o,s){function l(e,r){return t[e]-t[r]}for(var u=!1;!u;){u=!0;var c=[];for(var h in t)c.push(h);c.sort(l);for(var d=0;d<c.length;++d){h=c[d];if(t[h]>o)break;for(var f=n[h],p=0;p<f.length;++p){var m=i[f[p]].slice(0);if(m.sort(l),!(Math.abs(t[m[1]]-t[m[2]])<1e-6)){var g=a(r[m[0]],r[m[1]],r[m[2]],t[m[0]],t[m[1]],-1);if(!(g>o)){var v=t[m[2]];g<v&&Math.abs(g-v)>s&&(t[m[2]]=Math.min(v,g),u=!1)}}}}}}(0,h,t,c,e,l,u),h}},function(e,t,r){var n,i,a;(function(){var r,o,s,l,u,c,h,d,f,p,m,g,v,y,_;s=Math.floor,p=Math.min,o=function(e,t){return e<t?-1:e>t?1:0},f=function(e,t,r,n,i){var a;if(null==r&&(r=0),null==i&&(i=o),r<0)throw new Error("lo must be non-negative");for(null==n&&(n=e.length);r<n;)i(t,e[a=s((r+n)/2)])<0?n=a:r=a+1;return[].splice.apply(e,[r,r-r].concat(t)),t},c=function(e,t,r){return null==r&&(r=o),e.push(t),y(e,0,e.length-1,r)},u=function(e,t){var r,n;return null==t&&(t=o),r=e.pop(),e.length?(n=e[0],e[0]=r,_(e,0,t)):n=r,n},d=function(e,t,r){var n;return null==r&&(r=o),n=e[0],e[0]=t,_(e,0,r),n},h=function(e,t,r){var n;return null==r&&(r=o),e.length&&r(e[0],t)<0&&(t=(n=[e[0],t])[0],e[0]=n[1],_(e,0,r)),t},l=function(e,t){var r,n,i,a,l,u;for(null==t&&(t=o),l=[],n=0,i=(a=function(){u=[];for(var t=0,r=s(e.length/2);0<=r?t<r:t>r;0<=r?t++:t--)u.push(t);return u}.apply(this).reverse()).length;n<i;n++)r=a[n],l.push(_(e,r,t));return l},v=function(e,t,r){var n;if(null==r&&(r=o),-1!==(n=e.indexOf(t)))return y(e,0,n,r),_(e,n,r)},m=function(e,t,r){var n,i,a,s,u;if(null==r&&(r=o),!(i=e.slice(0,t)).length)return i;for(l(i,r),a=0,s=(u=e.slice(t)).length;a<s;a++)n=u[a],h(i,n,r);return i.sort(r).reverse()},g=function(e,t,r){var n,i,a,s,c,h,d,m,g;if(null==r&&(r=o),10*t<=e.length){if(!(a=e.slice(0,t).sort(r)).length)return a;for(i=a[a.length-1],s=0,h=(d=e.slice(t)).length;s<h;s++)r(n=d[s],i)<0&&(f(a,n,0,null,r),a.pop(),i=a[a.length-1]);return a}for(l(e,r),g=[],c=0,m=p(t,e.length);0<=m?c<m:c>m;0<=m?++c:--c)g.push(u(e,r));return g},y=function(e,t,r,n){var i,a,s;for(null==n&&(n=o),i=e[r];r>t&&n(i,a=e[s=r-1>>1])<0;)e[r]=a,r=s;return e[r]=i},_=function(e,t,r){var n,i,a,s,l;for(null==r&&(r=o),i=e.length,l=t,a=e[t],n=2*t+1;n<i;)(s=n+1)<i&&!(r(e[n],e[s])<0)&&(n=s),e[t]=e[n],n=2*(t=n)+1;return e[t]=a,y(e,l,t,r)},r=function(){function e(e){this.cmp=null!=e?e:o,this.nodes=[]}return e.push=c,e.pop=u,e.replace=d,e.pushpop=h,e.heapify=l,e.updateItem=v,e.nlargest=m,e.nsmallest=g,e.prototype.push=function(e){return c(this.nodes,e,this.cmp)},e.prototype.pop=function(){return u(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return d(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return h(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return l(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return v(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),i=[],void 0===(a="function"==typeof(n=function(){return r})?n.apply(t,i):n)||(e.exports=a)}).call(this)},function(e,t,r){e.exports=function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};t[o][0].call(u.exports,(function(e){return i(t[o][1][e]||e)}),u,u.exports,e,t,r,n)}return r[o].exports}for(var a=!1,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){function n(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])}t.exports=function(e){const t=function(e){const t=[];for(let r=0;r<e.length;r++){for(;t.length>=2&&n(t[t.length-2],t[t.length-1],e[r])<=0;)t.pop();t.push(e[r])}return t.pop(),t}(e),r=function(e){const t=e.reverse(),r=[];for(let e=0;e<t.length;e++){for(;r.length>=2&&n(r[r.length-2],r[r.length-1],t[e])<=0;)r.pop();r.push(t[e])}return r.pop(),r}(e).concat(t);return r.push(e[0]),r}},{}],2:[function(e,t,r){t.exports={toXy:function(e,t){return void 0===t?e.slice():e.map((function(e){return new Function("pt","return [pt"+t[0]+",pt"+t[1]+"];")(e)}))},fromXy:function(e,t){return void 0===t?e.slice():e.map((function(e){return new Function("pt","const o = {}; o"+t[0]+"= pt[0]; o"+t[1]+"= pt[1]; return o;")(e)}))}}},{}],3:[function(e,t,r){function n(e,t){this._cells=[],this._cellSize=t,this._reverseCellSize=1/t;for(let t=0;t<e.length;t++){const r=e[t],n=this.coordToCellNum(r[0]),i=this.coordToCellNum(r[1]);if(this._cells[n])this._cells[n][i]?this._cells[n][i].push(r):this._cells[n][i]=[r];else{const e=[];e[i]=[r],this._cells[n]=e}}}n.prototype={cellPoints:function(e,t){return void 0!==this._cells[e]&&void 0!==this._cells[e][t]?this._cells[e][t]:[]},rangePoints:function(e){const t=this.coordToCellNum(e[0]),r=this.coordToCellNum(e[1]),n=this.coordToCellNum(e[2]),i=this.coordToCellNum(e[3]),a=[];for(let e=t;e<=n;e++)for(let t=r;t<=i;t++)Array.prototype.push.apply(a,this.cellPoints(e,t));return a},removePoint:function(e){const t=this.coordToCellNum(e[0]),r=this.coordToCellNum(e[1]),n=this._cells[t][r];let i;for(let t=0;t<n.length;t++)if(n[t][0]===e[0]&&n[t][1]===e[1]){i=t;break}return n.splice(i,1),n},trunc:Math.trunc||function(e){return e-e%1},coordToCellNum:function(e){return this.trunc(e*this._reverseCellSize)},extendBbox:function(e,t){return[e[0]-t*this._cellSize,e[1]-t*this._cellSize,e[2]+t*this._cellSize,e[3]+t*this._cellSize]}},t.exports=function(e,t){return new n(e,t)}},{}],4:[function(e,t,r){"use strict";const n=e("./intersect.js"),i=e("./grid.js"),a=e("./format.js"),o=e("./convex.js");function s(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function l(e,t,r){const n=[t[0]-e[0],t[1]-e[1]],i=[r[0]-e[0],r[1]-e[1]],a=s(e,t),o=s(e,r);return(n[0]*i[0]+n[1]*i[1])/Math.sqrt(a*o)}function u(e,t){for(let r=0;r<t.length-1;r++){const i=[t[r],t[r+1]];if(!(e[0][0]===i[0][0]&&e[0][1]===i[0][1]||e[0][0]===i[1][0]&&e[0][1]===i[1][1])&&n(e,i))return!0}return!1}function c(e){return[Math.min(e[0][0],e[1][0]),Math.min(e[0][1],e[1][1]),Math.max(e[0][0],e[1][0]),Math.max(e[0][1],e[1][1])]}function h(e,t,r){let n,i,a=null,o=d,s=d;for(let c=0;c<t.length;c++)n=l(e[0],e[1],t[c]),i=l(e[1],e[0],t[c]),n>o&&i>s&&!u([e[0],t[c]],r)&&!u([e[1],t[c]],r)&&(o=n,s=i,a=t[c]);return a}const d=Math.cos(90/(180/Math.PI)),f=.6;t.exports=function(e,t,r){let n=t||20;const l=function(e){const t=[e[0]];let r=e[0];for(let n=1;n<e.length;n++){const i=e[n];r[0]===i[0]&&r[1]===i[1]||t.push(i),r=i}return t}(function(e){return e.sort((function(e,t){return e[0]-t[0]||e[1]-t[1]}))}(a.toXy(e,r)));if(l.length<4)return l.concat([l[0]]);const u=function(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(let a=e.length-1;a>=0;a--)e[a][0]<t&&(t=e[a][0]),e[a][1]<r&&(r=e[a][1]),e[a][0]>n&&(n=e[a][0]),e[a][1]>i&&(i=e[a][1]);return[n-t,i-r]}(l),d=[u[0]*f,u[1]*f],p=o(l),m=l.filter((function(e){return p.indexOf(e)<0})),g=Math.ceil(1/(l.length/(u[0]*u[1]))),v=function e(t,r,n,i,a){let o=!1;for(let e=0;e<t.length-1;e++){const l=[t[e],t[e+1]],u=l[0][0]+","+l[0][1]+","+l[1][0]+","+l[1][1];if(s(l[0],l[1])<r||a.has(u))continue;let d,f,p,m=0,g=c(l);do{g=i.extendBbox(g,m),d=g[2]-g[0],f=g[3]-g[1],p=h(l,i.rangePoints(g),t),m++}while(null===p&&(n[0]>d||n[1]>f));d>=n[0]&&f>=n[1]&&a.add(u),null!==p&&(t.splice(e+1,0,p),i.removePoint(p),o=!0)}return o?e(t,r,n,i,a):t}(p,Math.pow(n,2),d,i(m,g),new Set);return r?a.fromXy(v,r):v}},{"./convex.js":1,"./format.js":2,"./grid.js":3,"./intersect.js":5}],5:[function(e,t,r){function n(e,t,r,n,i,a){const o=(a-t)*(r-e)-(n-t)*(i-e);return o>0||!(o<0)}t.exports=function(e,t){const r=e[0][0],i=e[0][1],a=e[1][0],o=e[1][1],s=t[0][0],l=t[0][1],u=t[1][0],c=t[1][1];return n(r,i,s,l,u,c)!==n(a,o,s,l,u,c)&&n(r,i,a,o,s,l)!==n(r,i,a,o,u,c)}},{}]},{},[4])(4)},function(e,t,r){"use strict";var n=r(43);function i(e,t,r){var n,i,a=e.length,o=t.arrayArgs.length,s=t.indexArgs.length>0,l=[],u=[],c=0,h=0;for(n=0;n<a;++n)u.push(["i",n,"=0"].join(""));for(i=0;i<o;++i)for(n=0;n<a;++n)h=c,c=e[n],0===n?u.push(["d",i,"s",n,"=t",i,"p",c].join("")):u.push(["d",i,"s",n,"=(t",i,"p",c,"-s",h,"*t",i,"p",h,")"].join(""));for(u.length>0&&l.push("var "+u.join(",")),n=a-1;n>=0;--n)c=e[n],l.push(["for(i",n,"=0;i",n,"<s",c,";++i",n,"){"].join(""));for(l.push(r),n=0;n<a;++n){for(h=c,c=e[n],i=0;i<o;++i)l.push(["p",i,"+=d",i,"s",n].join(""));s&&(n>0&&l.push(["index[",h,"]-=s",h].join("")),l.push(["++index[",c,"]"].join(""))),l.push("}")}return l.join("\n")}function a(e,t,r){for(var n=e.body,i=[],a=[],o=0;o<e.args.length;++o){var s=e.args[o];if(!(s.count<=0)){var l=new RegExp(s.name,"g"),u="",c=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var h=t.offsetArgIndex.indexOf(o);c=t.offsetArgs[h].array,u="+q"+h;case"array":u="p"+c+u;var d="l"+o,f="a"+c;if(0===t.arrayBlockIndices[c])1===s.count?"generic"===r[c]?s.lvalue?(i.push(["var ",d,"=",f,".get(",u,")"].join("")),n=n.replace(l,d),a.push([f,".set(",u,",",d,")"].join(""))):n=n.replace(l,[f,".get(",u,")"].join("")):n=n.replace(l,[f,"[",u,"]"].join("")):"generic"===r[c]?(i.push(["var ",d,"=",f,".get(",u,")"].join("")),n=n.replace(l,d),s.lvalue&&a.push([f,".set(",u,",",d,")"].join(""))):(i.push(["var ",d,"=",f,"[",u,"]"].join("")),n=n.replace(l,d),s.lvalue&&a.push([f,"[",u,"]=",d].join("")));else{for(var p=[s.name],m=[u],g=0;g<Math.abs(t.arrayBlockIndices[c]);g++)p.push("\\s*\\[([^\\]]+)\\]"),m.push("$"+(g+1)+"*t"+c+"b"+g);if(l=new RegExp(p.join(""),"g"),u=m.join("+"),"generic"===r[c])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(l,[f,"[",u,"]"].join(""))}break;case"scalar":n=n.replace(l,"Y"+t.scalarArgs.indexOf(o));break;case"index":n=n.replace(l,"index");break;case"shape":n=n.replace(l,"shape")}}}return[i.join("\n"),n,a.join("\n")].join("\n").trim()}function o(e){for(var t=new Array(e.length),r=!0,n=0;n<e.length;++n){var i=e[n],a=i.match(/\d+/);a=a?a[0]:"",0===i.charAt(0)?t[n]="u"+i.charAt(1)+a:t[n]=i.charAt(0)+a,n>0&&(r=r&&t[n]===t[n-1])}return r?t[0]:t.join("")}var s=function(e,t){for(var r=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,s=new Array(e.arrayArgs.length),l=new Array(e.arrayArgs.length),u=0;u<e.arrayArgs.length;++u)l[u]=t[2*u],s[u]=t[2*u+1];var c=[],h=[],d=[],f=[],p=[];for(u=0;u<e.arrayArgs.length;++u){e.arrayBlockIndices[u]<0?(d.push(0),f.push(r),c.push(r),h.push(r+e.arrayBlockIndices[u])):(d.push(e.arrayBlockIndices[u]),f.push(e.arrayBlockIndices[u]+r),c.push(0),h.push(e.arrayBlockIndices[u]));for(var m=[],g=0;g<s[u].length;g++)d[u]<=s[u][g]&&s[u][g]<f[u]&&m.push(s[u][g]-d[u]);p.push(m)}var v=["SS"],y=["'use strict'"],_=[];for(g=0;g<r;++g)_.push(["s",g,"=SS[",g,"]"].join(""));for(u=0;u<e.arrayArgs.length;++u){v.push("a"+u),v.push("t"+u),v.push("p"+u);for(g=0;g<r;++g)_.push(["t",u,"p",g,"=t",u,"[",d[u]+g,"]"].join(""));for(g=0;g<Math.abs(e.arrayBlockIndices[u]);++g)_.push(["t",u,"b",g,"=t",u,"[",c[u]+g,"]"].join(""))}for(u=0;u<e.scalarArgs.length;++u)v.push("Y"+u);if(e.shapeArgs.length>0&&_.push("shape=SS.slice(0)"),e.indexArgs.length>0){var b=new Array(r);for(u=0;u<r;++u)b[u]="0";_.push(["index=[",b.join(","),"]"].join(""))}for(u=0;u<e.offsetArgs.length;++u){var E=e.offsetArgs[u],w=[];for(g=0;g<E.offset.length;++g)0!==E.offset[g]&&(1===E.offset[g]?w.push(["t",E.array,"p",g].join("")):w.push([E.offset[g],"*t",E.array,"p",g].join("")));0===w.length?_.push("q"+u+"=0"):_.push(["q",u,"=",w.join("+")].join(""))}var x=n([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((_=_.concat(x)).length>0&&y.push("var "+_.join(",")),u=0;u<e.arrayArgs.length;++u)y.push("p"+u+"|=0");e.pre.body.length>3&&y.push(a(e.pre,e,l));var T=a(e.body,e,l),M=function(e){for(var t=0,r=e[0].length;t<r;){for(var n=1;n<e.length;++n)if(e[n][t]!==e[0][t])return t;++t}return t}(p);M<r?y.push(function(e,t,r,n){for(var a=t.length,o=r.arrayArgs.length,s=r.blockSize,l=r.indexArgs.length>0,u=[],c=0;c<o;++c)u.push(["var offset",c,"=p",c].join(""));for(c=e;c<a;++c)u.push(["for(var j"+c+"=SS[",t[c],"]|0;j",c,">0;){"].join("")),u.push(["if(j",c,"<",s,"){"].join("")),u.push(["s",t[c],"=j",c].join("")),u.push(["j",c,"=0"].join("")),u.push(["}else{s",t[c],"=",s].join("")),u.push(["j",c,"-=",s,"}"].join("")),l&&u.push(["index[",t[c],"]=j",c].join(""));for(c=0;c<o;++c){for(var h=["offset"+c],d=e;d<a;++d)h.push(["j",d,"*t",c,"p",t[d]].join(""));u.push(["p",c,"=(",h.join("+"),")"].join(""))}for(u.push(i(t,r,n)),c=e;c<a;++c)u.push("}");return u.join("\n")}(M,p[0],e,T)):y.push(i(p[0],e,T)),e.post.body.length>3&&y.push(a(e.post,e,l)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+y.join("\n")+"\n----------");var S=[e.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",M,o(l)].join("");return new Function(["function ",S,"(",v.join(","),"){",y.join("\n"),"} return ",S].join(""))()};function l(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}e.exports=function(e){var t=new l;t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var n=0;n<r.length;++n){var i=r[n];if("array"===i||"object"==typeof i&&i.blockIndices){if(t.argTypes[n]="array",t.arrayArgs.push(n),t.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),t.shimArgs.push("array"+n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)t.scalarArgs.push(n),t.shimArgs.push("scalar"+n);else if("index"===i){if(t.indexArgs.push(n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(t.shapeArgs.push(n),n<t.pre.args.length&&t.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<t.post.args.length&&t.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+r[n]);t.argTypes[n]="offset",t.offsetArgs.push({array:i.array,offset:i.offset}),t.offsetArgIndex.push(n)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,function(e){var t=["'use strict'","var CACHED={}"],r=[],n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],a=[],o=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],l=[],u=[],c=0;c<e.arrayArgs.length;++c){var h=e.arrayArgs[c];r.push(["t",h,"=array",h,".dtype,","r",h,"=array",h,".order"].join("")),i.push("t"+h),i.push("r"+h),a.push("t"+h),a.push("r"+h+".join()"),o.push("array"+h+".data"),o.push("array"+h+".stride"),o.push("array"+h+".offset|0"),c>0&&(l.push("array"+e.arrayArgs[0]+".shape.length===array"+h+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),u.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+h+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),c=0;c<e.scalarArgs.length;++c)o.push("scalar"+e.scalarArgs[c]);return r.push(["type=[",a.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),t.push("var "+r.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",o.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(s.bind(void 0,e))}(t)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var u=new Array(e.dimension),c=1;Array.isArray(r)||(r=l(e.dimension,!!r));Array.isArray(t)||(t=l(e.dimension,t));for(var h=0;h<e.dimension;++h)r[h]?u[h]=e.shape[h]:u[h]=i(e.shape[h]+2*Math.ceil(3*t[h])),c*=u[h];var d=n(s.mallocDouble(c),u),f=d.hi.apply(d,e.shape.slice()),p=n(s.mallocDouble(c),u);return a.assigns(d,0),a.assign(f,e),a.assigns(p,0),o(1,d,p),function(e,t,r){for(var n=r.length,i=new Array(n),a=new Array(n),o=0;o<n;o++)i[o]=e.shape[o],a[o]=0;var s=new Array(n);for(o=0;o<n;++o)r[o]<1e-6?s[o]=0:s[o]=-2*Math.pow(Math.PI*r[o]/i[o],2);if(1===n)for(a[0]=0;a[0]<i[0];++a[0]){var l=0;for(o=0;o<n;++o){var u=.5*i[o]-Math.abs(.5*i[o]-a[o]);l+=s[o]*u*u}l=Math.exp(l),e.set(a[0],e.get(a[0])*l),t.set(a[0],t.get(a[0])*l)}else if(2===n)for(a[1]=0;a[1]<i[1];++a[1])for(a[0]=0;a[0]<i[0];++a[0]){for(l=0,o=0;o<n;++o){u=.5*i[o]-Math.abs(.5*i[o]-a[o]);l+=s[o]*u*u}l=Math.exp(l),e.set(a[0],a[1],e.get(a[0],a[1])*l),t.set(a[0],a[1],t.get(a[0],a[1])*l)}else if(3===n)for(a[2]=0;a[2]<i[2];++a[2])for(a[1]=0;a[1]<i[1];++a[1])for(a[0]=0;a[0]<i[0];++a[0]){for(l=0,o=0;o<n;++o){u=.5*i[o]-Math.abs(.5*i[o]-a[o]);l+=s[o]*u*u}l=Math.exp(l),e.set(a[0],a[1],a[2],e.get(a[0],a[1],a[2])*l),t.set(a[0],a[1],a[2],t.get(a[0],a[1],a[2])*l)}else console.warn("gaussBlur: higher dimension (> 3) not supported")}(d,p,t),o(-1,d,p),a.assign(e,f),s.freeDouble(d),s.freeDouble(p),e};var n=r(10),i=r(42),a=r(25),o=r(46),s=r(1),l=r(15)},function(e,t,r){"use strict";var n=r(194),i=r(2),a=r(49),o=r(27),s=r(50),l=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=n.deflateSetDictionary(this.strm,c)))throw new Error(o[r]);this._dict_set=!0}}function c(e,t){var r=new u(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}u.prototype.push=function(e,t){var r,o,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(u),s.next_out=0,s.avail_out=u),1!==(r=n.deflate(s,o))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==o||(this.onEnd(0),s.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=u,t.deflate=c,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},function(e,t,r){"use strict";var n,i=r(2),a=r(195),o=r(47),s=r(48),l=r(27);function u(e,t){return e.msg=l[t],t}function c(e){return(e<<1)-(e>4?9:0)}function h(e){for(var t=e.length;--t>=0;)e[t]=0}function d(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function f(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,d(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function g(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,u=e.window,c=e.w_mask,h=e.prev,d=e.strstart+258,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===f&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<d);if(n=258-(d-a),a=d-258,n>o){if(e.match_start=t,o=n,n>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=h[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function v(e){var t,r,n,a,l,u,c,h,d,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=p?n-p:0}while(--r);t=r=p;do{n=e.prev[--t],e.prev[t]=n>=p?n-p:0}while(--r);a+=p}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,h=e.strstart+e.lookahead,d=a,f=void 0,(f=u.avail_in)>d&&(f=d),r=0===f?0:(u.avail_in-=f,i.arraySet(c,u.input,u.next_in,f,h),1===u.state.wrap?u.adler=o(u.adler,c,f,h):2===u.state.wrap&&(u.adler=s(u.adler,c,f,h)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function y(e,t){for(var r,n;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=g(e,r)),e.match_length>=3)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function _(e,t){for(var r,n,i;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=g(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function b(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function E(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):u(e,-2)}function x(e){var t,r=w(e);return 0===r&&((t=e.state).window_size=2*t.w_size,h(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function T(e,t,r,n,a,o){if(!e)return-2;var s=1;if(-1===t&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||8!==r||n<8||n>15||t<0||t>9||o<0||o>4)return u(e,-2);8===n&&(n=9);var l=new E;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,x(e)}n=[new b(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(v(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)})),new b(4,4,8,4,y),new b(4,5,16,8,y),new b(4,6,32,32,y),new b(4,4,16,16,_),new b(8,16,32,32,_),new b(8,16,128,128,_),new b(8,32,128,256,_),new b(32,128,258,1024,_),new b(32,258,258,4096,_)],t.deflateInit=function(e,t){return T(e,t,8,15,8,0)},t.deflateInit2=T,t.deflateReset=x,t.deflateResetKeep=w,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||t>5||t<0)return e?u(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return u(e,0===e.avail_out?-5:-2);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var g=8+(i.w_bits-8<<4)<<8;g|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(g|=32),g+=31-g%31,i.status=113,m(i,g),0!==i.strstart&&(m(i,e.adler>>>16),m(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),d(e),o=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),d(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),d(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&d(e),i.pending+2<=i.pending_buf_size&&(p(i,255&e.adler),p(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(d(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&c(t)<=c(r)&&4!==t)return u(e,-5);if(666===i.status&&0!==e.avail_in)return u(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var y=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(v(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=258){if(v(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+258;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=258-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):n[i.level].func(i,t);if(3!==y&&4!==y||(i.status=666),1===y||3===y)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===y&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(h(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),d(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&e.adler),p(i,e.adler>>8&255),p(i,e.adler>>16&255),p(i,e.adler>>24&255),p(i,255&e.total_in),p(i,e.total_in>>8&255),p(i,e.total_in>>16&255),p(i,e.total_in>>24&255)):(m(i,e.adler>>>16),m(i,65535&e.adler)),d(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?u(e,-2):(e.state=null,113===t?u(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var r,n,a,s,l,u,c,d,f=t.length;if(!e||!e.state)return-2;if(2===(s=(r=e.state).wrap)||1===s&&42!==r.status||r.lookahead)return-2;for(1===s&&(e.adler=o(e.adler,t,f,0)),r.wrap=0,f>=r.w_size&&(0===s&&(h(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new i.Buf8(r.w_size),i.arraySet(d,t,f-r.w_size,r.w_size,0),t=d,f=r.w_size),l=e.avail_in,u=e.next_in,c=e.input,e.avail_in=f,e.next_in=0,e.input=t,v(r);r.lookahead>=3;){n=r.strstart,a=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=2,v(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=u,e.input=c,e.avail_in=l,r.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";var n=r(2);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);i(u);var c=new Array(60);i(c);var h=new Array(512);i(h);var d=new Array(256);i(d);var f=new Array(29);i(f);var p,m,g,v=new Array(30);function y(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function b(e){return e<256?h[e]:h[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function w(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function x(e,t,r){w(e,r[2*t],r[2*t+1])}function T(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function M(e,t,r){var n,i,a=new Array(16),o=0;for(n=1;n<=15;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=T(a[s]++,s))}}function S(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function A(e){e.bi_valid>8?E(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function R(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function k(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&R(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!R(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function P(e,t,r){var n,i,s,l,u=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===n?x(e,i,t):(x(e,(s=d[i])+256+1,t),0!==(l=a[s])&&w(e,i-=f[s],l),x(e,s=b(--n),r),0!==(l=o[s])&&w(e,n-=v[s],l))}while(u<e.last_lit);x(e,256,t)}function L(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)k(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],k(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,k(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>p&&(a=p,m++),l[2*n+1]=a,n>u||(e.bl_count[a]++,o=0,n>=f&&(o=d[n-f]),s=l[2*n],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(c[2*n+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),M(a,u,e.bl_count)}function C(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function I(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<l&&i===o)){if(s<u)do{x(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(x(e,i,e.bl_tree),s--),x(e,16,e.bl_tree),w(e,s-3,2)):s<=10?(x(e,17,e.bl_tree),w(e,s-3,3)):(x(e,18,e.bl_tree),w(e,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}}i(v);var H=!1;function O(e,t,r,i){w(e,0+(i?1:0),3),function(e,t,r,i){A(e),i&&(E(e,r),E(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}t._tr_init=function(e){H||(!function(){var e,t,r,n,i,l=new Array(16);for(r=0,n=0;n<28;n++)for(f[n]=r,e=0;e<1<<a[n];e++)d[r++]=n;for(d[r-1]=n,i=0,n=0;n<16;n++)for(v[n]=i,e=0;e<1<<o[n];e++)h[i++]=n;for(i>>=7;n<30;n++)for(v[n]=i<<7,e=0;e<1<<o[n]-7;e++)h[256+i++]=n;for(t=0;t<=15;t++)l[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,l[8]++;for(;e<=255;)u[2*e+1]=9,e++,l[9]++;for(;e<=279;)u[2*e+1]=7,e++,l[7]++;for(;e<=287;)u[2*e+1]=8,e++,l[8]++;for(M(u,287,l),e=0;e<30;e++)c[2*e+1]=5,c[2*e]=T(e,5);p=new y(u,a,257,286,15),m=new y(c,o,0,30,15),g=new y(new Array(0),s,0,19,7)}(),H=!0),e.l_desc=new _(e.dyn_ltree,p),e.d_desc=new _(e.dyn_dtree,m),e.bl_desc=new _(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,S(e)},t._tr_stored_block=O,t._tr_flush_block=function(e,t,r,n){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),L(e,e.l_desc),L(e,e.d_desc),o=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),L(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?O(e,t,r,n):4===e.strategy||a===i?(w(e,2+(n?1:0),3),P(e,u,c)):(w(e,4+(n?1:0),3),function(e,t,r,n){var i;for(w(e,t-257,5),w(e,r-1,5),w(e,n-4,4),i=0;i<n;i++)w(e,e.bl_tree[2*l[i]+1],3);I(e,e.dyn_ltree,t-1),I(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),P(e,e.dyn_ltree,e.dyn_dtree)),S(e),n&&A(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(d[r]+256+1)]++,e.dyn_dtree[2*b(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){w(e,2,3),x(e,256,u),function(e){16===e.bi_valid?(E(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var n=r(197),i=r(2),a=r(49),o=r(51),s=r(27),l=r(50),u=r(200),c=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(s[r]);if(this.header=new u,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[r])}function d(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}h.prototype.push=function(e,t){var r,s,l,u,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=a.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(r=n.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===o.Z_BUF_ERROR&&!0===m&&(r=o.Z_OK,m=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&r!==o.Z_STREAM_END&&(0!==d.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),u=d.next_out-l,h=a.buf2string(d.output,l),d.next_out=u,d.avail_out=f-u,u&&i.arraySet(d.output,d.output,l,u,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,r){"use strict";var n=r(2),i=r(47),a=r(48),o=r(198),s=r(199);function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function c(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(852),t.distcode=t.distdyn=new n.Buf32(592),t.sane=1,t.back=-1,0):-2}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,c(e)):-2}function d(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,h(e))):-2}function f(e,t){var r,n;return e?(n=new u,e.state=n,n.window=null,0!==(r=d(e,t))&&(e.state=null),r):-2}var p,m,g=!0;function v(e){if(g){var t;for(p=new n.Buf32(512),m=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,m,0,e.work,{bits:5}),g=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}function y(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=h,t.inflateReset2=d,t.inflateResetKeep=c,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var r,u,c,h,d,f,p,m,g,_,b,E,w,x,T,M,S,A,R,k,P,L,C,I,H=0,O=new n.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(r=e.state).mode&&(r.mode=13),d=e.next_out,c=e.output,p=e.avail_out,h=e.next_in,u=e.input,f=e.avail_in,m=r.hold,g=r.bits,_=f,b=p,L=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;g<16;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(2&r.wrap&&35615===m){r.check=0,O[0]=255&m,O[1]=m>>>8&255,r.check=a(r.check,O,2,0),m=0,g=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&m)){e.msg="unknown compression method",r.mode=30;break}if(g-=4,P=8+(15&(m>>>=4)),0===r.wbits)r.wbits=P;else if(P>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<P,e.adler=r.check=1,r.mode=512&m?10:12,m=0,g=0;break;case 2:for(;g<16;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(r.flags=m,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=m>>8&1),512&r.flags&&(O[0]=255&m,O[1]=m>>>8&255,r.check=a(r.check,O,2,0)),m=0,g=0,r.mode=3;case 3:for(;g<32;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}r.head&&(r.head.time=m),512&r.flags&&(O[0]=255&m,O[1]=m>>>8&255,O[2]=m>>>16&255,O[3]=m>>>24&255,r.check=a(r.check,O,4,0)),m=0,g=0,r.mode=4;case 4:for(;g<16;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}r.head&&(r.head.xflags=255&m,r.head.os=m>>8),512&r.flags&&(O[0]=255&m,O[1]=m>>>8&255,r.check=a(r.check,O,2,0)),m=0,g=0,r.mode=5;case 5:if(1024&r.flags){for(;g<16;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}r.length=m,r.head&&(r.head.extra_len=m),512&r.flags&&(O[0]=255&m,O[1]=m>>>8&255,r.check=a(r.check,O,2,0)),m=0,g=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((E=r.length)>f&&(E=f),E&&(r.head&&(P=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,u,h,E,P)),512&r.flags&&(r.check=a(r.check,u,E,h)),f-=E,h+=E,r.length-=E),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===f)break e;E=0;do{P=u[h+E++],r.head&&P&&r.length<65536&&(r.head.name+=String.fromCharCode(P))}while(P&&E<f);if(512&r.flags&&(r.check=a(r.check,u,E,h)),f-=E,h+=E,P)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===f)break e;E=0;do{P=u[h+E++],r.head&&P&&r.length<65536&&(r.head.comment+=String.fromCharCode(P))}while(P&&E<f);if(512&r.flags&&(r.check=a(r.check,u,E,h)),f-=E,h+=E,P)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;g<16;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(m!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}m=0,g=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;g<32;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}e.adler=r.check=l(m),m=0,g=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=d,e.avail_out=p,e.next_in=h,e.avail_in=f,r.hold=m,r.bits=g,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){m>>>=7&g,g-=7&g,r.mode=27;break}for(;g<3;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}switch(r.last=1&m,g-=1,3&(m>>>=1)){case 0:r.mode=14;break;case 1:if(v(r),r.mode=20,6===t){m>>>=2,g-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}m>>>=2,g-=2;break;case 14:for(m>>>=7&g,g-=7&g;g<32;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&m,m=0,g=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(E=r.length){if(E>f&&(E=f),E>p&&(E=p),0===E)break e;n.arraySet(c,u,h,E,d),f-=E,h+=E,p-=E,d+=E,r.length-=E;break}r.mode=12;break;case 17:for(;g<14;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(r.nlen=257+(31&m),m>>>=5,g-=5,r.ndist=1+(31&m),m>>>=5,g-=5,r.ncode=4+(15&m),m>>>=4,g-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;g<3;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}r.lens[D[r.have++]]=7&m,m>>>=3,g-=3}for(;r.have<19;)r.lens[D[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C={bits:r.lenbits},L=s(0,r.lens,0,19,r.lencode,0,r.work,C),r.lenbits=C.bits,L){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;M=(H=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,S=65535&H,!((T=H>>>24)<=g);){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(S<16)m>>>=T,g-=T,r.lens[r.have++]=S;else{if(16===S){for(I=T+2;g<I;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(m>>>=T,g-=T,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}P=r.lens[r.have-1],E=3+(3&m),m>>>=2,g-=2}else if(17===S){for(I=T+3;g<I;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}g-=T,P=0,E=3+(7&(m>>>=T)),m>>>=3,g-=3}else{for(I=T+7;g<I;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}g-=T,P=0,E=11+(127&(m>>>=T)),m>>>=7,g-=7}if(r.have+E>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;E--;)r.lens[r.have++]=P}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,C={bits:r.lenbits},L=s(1,r.lens,0,r.nlen,r.lencode,0,r.work,C),r.lenbits=C.bits,L){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,C={bits:r.distbits},L=s(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,C),r.distbits=C.bits,L){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(f>=6&&p>=258){e.next_out=d,e.avail_out=p,e.next_in=h,e.avail_in=f,r.hold=m,r.bits=g,o(e,b),d=e.next_out,c=e.output,p=e.avail_out,h=e.next_in,u=e.input,f=e.avail_in,m=r.hold,g=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;M=(H=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,S=65535&H,!((T=H>>>24)<=g);){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(M&&0==(240&M)){for(A=T,R=M,k=S;M=(H=r.lencode[k+((m&(1<<A+R)-1)>>A)])>>>16&255,S=65535&H,!(A+(T=H>>>24)<=g);){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}m>>>=A,g-=A,r.back+=A}if(m>>>=T,g-=T,r.back+=T,r.length=S,0===M){r.mode=26;break}if(32&M){r.back=-1,r.mode=12;break}if(64&M){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&M,r.mode=22;case 22:if(r.extra){for(I=r.extra;g<I;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,g-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;M=(H=r.distcode[m&(1<<r.distbits)-1])>>>16&255,S=65535&H,!((T=H>>>24)<=g);){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(0==(240&M)){for(A=T,R=M,k=S;M=(H=r.distcode[k+((m&(1<<A+R)-1)>>A)])>>>16&255,S=65535&H,!(A+(T=H>>>24)<=g);){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}m>>>=A,g-=A,r.back+=A}if(m>>>=T,g-=T,r.back+=T,64&M){e.msg="invalid distance code",r.mode=30;break}r.offset=S,r.extra=15&M,r.mode=24;case 24:if(r.extra){for(I=r.extra;g<I;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,g-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===p)break e;if(E=b-p,r.offset>E){if((E=r.offset-E)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}E>r.wnext?(E-=r.wnext,w=r.wsize-E):w=r.wnext-E,E>r.length&&(E=r.length),x=r.window}else x=c,w=d-r.offset,E=r.length;E>p&&(E=p),p-=E,r.length-=E;do{c[d++]=x[w++]}while(--E);0===r.length&&(r.mode=21);break;case 26:if(0===p)break e;c[d++]=r.length,p--,r.mode=21;break;case 27:if(r.wrap){for(;g<32;){if(0===f)break e;f--,m|=u[h++]<<g,g+=8}if(b-=p,e.total_out+=b,r.total+=b,b&&(e.adler=r.check=r.flags?a(r.check,c,b,d-b):i(r.check,c,b,d-b)),b=p,(r.flags?m:l(m))!==r.check){e.msg="incorrect data check",r.mode=30;break}m=0,g=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;g<32;){if(0===f)break e;f--,m+=u[h++]<<g,g+=8}if(m!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}m=0,g=0}r.mode=29;case 29:L=1;break e;case 30:L=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=d,e.avail_out=p,e.next_in=h,e.avail_in=f,r.hold=m,r.bits=g,(r.wsize||b!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&y(e,e.output,e.next_out,b-e.avail_out)?(r.mode=31,-4):(_-=e.avail_in,b-=e.avail_out,e.total_in+=_,e.total_out+=b,r.total+=b,r.wrap&&b&&(e.adler=r.check=r.flags?a(r.check,c,b,e.next_out-b):i(r.check,c,b,e.next_out-b)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===_&&0===b||4===t)&&0===L&&(L=-5),L)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?-2:(r.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?-2:11===r.mode&&i(1,t,n,0)!==r.check?-3:y(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S;r=e.state,n=e.next_in,M=e.input,i=n+(e.avail_in-5),a=e.next_out,S=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,d=r.window,f=r.hold,p=r.bits,m=r.lencode,g=r.distcode,v=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(f+=M[n++]<<p,p+=8,f+=M[n++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))S[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&_,(b&=15)&&(p<b&&(f+=M[n++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=M[n++]<<p,p+=8,f+=M[n++]<<p,p+=8),_=g[f&y];r:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=M[n++]<<p,(p+=8)<b&&(f+=M[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=0,T=d,0===h){if(x+=u-b,b<E){E-=b;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}}else if(h<b){if(x+=u+h-b,(b-=h)<E){E-=b;do{S[a++]=d[x++]}while(--b);if(x=0,h<E){E-=b=h;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}}}else if(x+=h-b,b<E){E-=b;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}for(;E>2;)S[a++]=T[x++],S[a++]=T[x++],S[a++]=T[x++],E-=3;E&&(S[a++]=T[x++],E>1&&(S[a++]=T[x++]))}else{x=a-w;do{S[a++]=S[x++],S[a++]=S[x++],S[a++]=S[x++],E-=3}while(E>2);E&&(S[a++]=S[x++],E>1&&(S[a++]=S[x++]))}break}}break}}while(n<i&&a<s);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=p}},function(e,t,r){"use strict";var n=r(2),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,u,c,h,d){var f,p,m,g,v,y,_,b,E,w=d.bits,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=null,H=0,O=new n.Buf16(16),D=new n.Buf16(16),F=null,N=0;for(x=0;x<=15;x++)O[x]=0;for(T=0;T<l;T++)O[t[r+T]]++;for(A=w,S=15;S>=1&&0===O[S];S--);if(A>S&&(A=S),0===S)return u[c++]=20971520,u[c++]=20971520,d.bits=1,0;for(M=1;M<S&&0===O[M];M++);for(A<M&&(A=M),P=1,x=1;x<=15;x++)if(P<<=1,(P-=O[x])<0)return-1;if(P>0&&(0===e||1!==S))return-1;for(D[1]=0,x=1;x<15;x++)D[x+1]=D[x]+O[x];for(T=0;T<l;T++)0!==t[r+T]&&(h[D[t[r+T]]++]=T);if(0===e?(I=F=h,y=19):1===e?(I=i,H-=257,F=a,N-=257,y=256):(I=o,F=s,y=-1),C=0,T=0,x=M,v=c,R=A,k=0,m=-1,g=(L=1<<A)-1,1===e&&L>852||2===e&&L>592)return 1;for(;;){_=x-k,h[T]<y?(b=0,E=h[T]):h[T]>y?(b=F[N+h[T]],E=I[H+h[T]]):(b=96,E=0),f=1<<x-k,M=p=1<<R;do{u[v+(C>>k)+(p-=f)]=_<<24|b<<16|E|0}while(0!==p);for(f=1<<x-1;C&f;)f>>=1;if(0!==f?(C&=f-1,C+=f):C=0,T++,0==--O[x]){if(x===S)break;x=t[r+h[T]]}if(x>A&&(C&g)!==m){for(0===k&&(k=A),v+=M,P=1<<(R=x-k);R+k<S&&!((P-=O[R+k])<=0);)R++,P<<=1;if(L+=1<<R,1===e&&L>852||2===e&&L>592)return 1;u[m=C&g]=A<<24|R<<16|v-c|0}}return 0!==C&&(u[v+C]=x-k<<24|64<<16|0),d.bits=A,0}},function(e,t,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){"use strict";var n=r(202),i=r(203),a=r(204),o=r(52),s=r(205),l=r(208),u=r(30),c=r(209),h=r(210);e.exports=function(e){var t,r,d,f,p,m,g;if(r=e<0||1/e===i?"1":"0",e===n||e===i)return r+(f=u("1",8))+(d=u("0",23));if(e!=e)return r+(f=u("1",8))+(d="1"+u("0",22));if(0===e)return r+(f=u("0",8))+(d=u("0",23));if(m=(e=a(e))-(p=o(e)),p=c(p),m=h(m),p)f=p.length-1;else{for(g=0;g<m.length;g++)if("1"===m[g]){t=g+1;break}f=-t}return d=p+m,f<0?(f<=-127&&(t=126),d=d.substring(t)):d=d.substring(1),f=c(f+127),r+(f=l(f,8,"0"))+(d=s(d,23,"0").substring(0,23))}},function(e,t,r){"use strict";var n=new Float32Array(1);new Uint32Array(n.buffer)[0]=2139095040,e.exports=n[0]},function(e,t,r){"use strict";var n=new Float32Array(1);new Uint32Array(n.buffer)[0]=4286578688,e.exports=n[0]},function(e,t,r){"use strict";e.exports=function(e){return e<0?-e:0===e?0:e}},function(e,t,r){"use strict";var n=r(28),i=r(29),a=r(53),o=r(30);e.exports=function(e,t,r){var s,l;if(!n(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(!n(l=r))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+l+"`.");if(0===l.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else l=" ";if(t>9007199254740991)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(s=(t-e.length)/l.length)<=0?e:(s=a(s),e+o(l,s))}},function(e,t,r){"use strict";var n=r(207);e.exports=function(e){return n(e)&&e%1==0}},function(e,t,r){"use strict";e.exports=function(e){return("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))&&e.valueOf()==e.valueOf()}},function(e,t,r){"use strict";var n=r(28),i=r(29),a=r(53),o=r(30);e.exports=function(e,t,r){var s,l;if(!n(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(!n(l=r))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+l+"`.");if(0===l.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else l=" ";if(t>9007199254740991)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(s=(t-e.length)/l.length)<=0?e:(s=a(s),o(l,s)+e)}},function(e,t,r){"use strict";var n=r(52);e.exports=function(e){for(var t,r="";e>0;)r=(t=e/2)===(e=n(t))?"0"+r:"1"+r;return r}},function(e,t,r){"use strict";e.exports=function(e){var t,r,n,i;if(t="",0===e)return t;for(i=149,n=0;n<149&&((r=2*e)>=1?(e=r-1,t+="1",149===i&&(i=n)):(e=r,t+="0"),!(1===r||n-i>24));n++);return t}},function(e,t){},function(e,t,r){(function(e){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var t="",i=!1,a=arguments.length-1;a>=-1&&!i;a--){var o=a>=0?arguments[a]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,i="/"===o.charAt(0))}return(i?"/":"")+(t=r(n(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var a=t.isAbsolute(e),o="/"===i(e,-1);return(e=r(n(e.split("/"),(function(e){return!!e})),!a).join("/"))||a||(e="."),e&&o&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=n(e.split("/")),a=n(r.split("/")),o=Math.min(i.length,a.length),s=o,l=0;l<o;l++)if(i[l]!==a[l]){s=l;break}var u=[];for(l=s;l<i.length;l++)u.push("..");return(u=u.concat(a.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,i=!0,a=e.length-1;a>=1;--a)if(47===(t=e.charCodeAt(a))){if(!i){n=a;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"/":e.slice(0,n)},t.basename=function(e,t){var r=function(e){"string"!=typeof e&&(e+="");var t,r=0,n=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){r=t+1;break}}else-1===n&&(i=!1,n=t+1);return-1===n?"":e.slice(r,n)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,r=0,n=-1,i=!0,a=0,o=e.length-1;o>=0;--o){var s=e.charCodeAt(o);if(47!==s)-1===n&&(i=!1,n=o+1),46===s?-1===t?t=o:1!==a&&(a=1):-1!==t&&(a=-1);else if(!i){r=o+1;break}}return-1===t||-1===n||0===a||1===a&&t===n-1&&t===r+1?"":e.slice(t,n)};var i="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,r(16))},function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=79)}([function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";(function(e){var n=r(73),i=r(72),a=r(38);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=r;a<s;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return-1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function _(e,t,r,n){return j(B(t,e.length-r),e,r,n)}function b(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return b(e,t,r,n)}function w(e,t,r,n){return j(z(t),e,r,n)}function x(e,t,r,n){return j(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function T(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function M(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return u(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return c(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,r);case"utf8":case"utf-8":return M(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return R(this,t,r);case"base64":return T(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(n,i),c=e.slice(t,r),h=0;h<s;++h)if(u[h]!==c[h]){a=u[h],o=c[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":return b(this,e,t,r);case"latin1":case"binary":return E(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function k(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=U(e[a]);return i}function P(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function I(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function H(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function O(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,n,a){return a||O(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function F(e,t,r,n,a){return a||O(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):H(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):H(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:B(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function z(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(0))},function(e,t,r){"use strict";var n=r(10),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=h;var a=r(6);a.inherits=r(5);var o=r(35),s=r(19);a.inherits(h,o);for(var l=i(s.prototype),u=0;u<l.length;u++){var c=l[u];h.prototype[c]||(h.prototype[c]=s.prototype[c])}function h(e){if(!(this instanceof h))return new h(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||n.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!c){var e=s(d);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*e.readUint16()*256+e.readUint16()).toString(16)).substr(-8)}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){(function(e){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,r(1).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(14);function a(e,t){return void 0!==e.parser?e.parser:t}var o=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=r,this.elements=n}return n(e,[{key:"uint16",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readUint16(this.byteArray,r.dataOffset+2*t)}},{key:"int16",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readInt16(this.byteArray,r.dataOffset+2*t)}},{key:"uint32",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readUint32(this.byteArray,r.dataOffset+4*t)}},{key:"int32",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readInt32(this.byteArray,r.dataOffset+4*t)}},{key:"float",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readFloat(this.byteArray,r.dataOffset+4*t)}},{key:"double",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readDouble(this.byteArray,r.dataOffset+8*t)}},{key:"numStringValues",value:function(e){var t=this.elements[e];if(t&&t.length>0){var r=(0,i.readFixedString)(this.byteArray,t.dataOffset,t.length).match(/\\/g);return null===r?1:r.length+1}}},{key:"string",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){var n=(0,i.readFixedString)(this.byteArray,r.dataOffset,r.length);return t>=0?n.split("\\")[t].trim():n.trim()}}},{key:"text",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){var n=(0,i.readFixedString)(this.byteArray,r.dataOffset,r.length);return t>=0?n.split("\\")[t].replace(/ +$/,""):n.replace(/ +$/,"")}}},{key:"floatString",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){t=void 0!==t?t:0;var n=this.string(e,t);if(void 0!==n)return parseFloat(n)}}},{key:"intString",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){t=void 0!==t?t:0;var n=this.string(e,t);if(void 0!==n)return parseInt(n)}}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var r=a(t,this.byteArrayParser).readUint16,n=this.byteArray,i=t.dataOffset;return"x"+("00000000"+(256*r(n,i)*256+r(n,i+2)).toString(16)).substr(-8)}}}]),e}();t.default=o},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t,r){var n=r(1),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,r)}));case 3:return t.nextTick((function(){e.call(null,r,n)}));case 4:return t.nextTick((function(){e.call(null,r,n,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}}:e.exports=t}).call(this,r(3))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,r,n){if(void 0!==e&&t instanceof e)return t.slice(r,r+n);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+r,n);throw"dicomParser.from: unknown type for byteArray"}}).call(this,r(1).Buffer)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(11))&&n.__esModule?n:{default:n},o=r(14),s=function(){function t(r,n,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==0&&n instanceof e==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=r,this.byteArray=n,this.position=i||0,this.warnings=[]}return i(t,[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var r=(0,a.default)(this.byteArray,this.position,e);return this.position+=e,new t(this.byteArrayParser,r)}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=(0,o.readFixedString)(this.byteArray,this.position,e);return this.position+=e,t}}]),t}();t.default=s}).call(this,r(1).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:(0,i.default)(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return t};var n,i=(n=r(4))&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFixedString=function(e,t,r){if(r<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+r>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var n,i="",a=0;a<r;a++){if(0===(n=e[t+a]))return t+=r,i;i+=String.fromCharCode(n)}return i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var l={tag:(0,o.default)(e),vr:e.readFixedString(2)};return 2===u(l.vr)?(l.length=e.readUint16(),l.dataOffset=e.position):(e.seek(2),l.length=e.readUint32(),l.dataOffset=e.position),4294967295===l.length&&(l.hadUndefinedLength=!0),l.tag===r?l:"SQ"===l.vr?((0,s.default)(e,l,t),l):4294967295===l.length?"x7fe00010"===l.tag?((0,n.default)(e,l,t),l):"UN"===l.vr?((0,i.default)(e,l),l):((0,a.default)(e,l),l):(e.seek(l.length),l)};var n=l(r(42)),i=l(r(41)),a=l(r(25)),o=l(r(4)),s=l(r(40));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDicomDataSetExplicit=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?t.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var a=e.elements;t.position<r;){var o=(0,n.default)(t,e.warnings,i.untilTag);if(a[o.tag]=o,o.tag===i.untilTag)return}if(t.position>r)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?e.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;t.position<r;){var o=(0,i.default)(t,n.untilTag,n.vrCallback);if(a[o.tag]=o,o.tag===n.untilTag)return}};var n=a(r(15)),i=a(r(24));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};t.isStringVr=function(e){return n[e]},t.isPrivateTag=function(e){return parseInt(e[4],10)%2==1},t.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s,u){if(s=s||1,u=u||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===s)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(r>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(s<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(r+s>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var c=new i.default(e.byteArrayParser,e.byteArray,t.dataOffset),h=(0,a.default)(c);if("xfffee000"!==h.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";c.seek(h.length);var d=c.position;if(1===s)return(0,o.default)(c.byteArray,d+u[r].offset+8,u[r].length);for(var f=l(u,r,s),p=(0,n.default)(c.byteArray,f),m=0,g=r;g<r+s;g++)for(var v=d+u[g].offset+8,y=0;y<u[g].length;y++)p[m++]=c.byteArray[v++];return p};var n=s(r(23)),i=s(r(12)),a=s(r(13)),o=s(r(11));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,r){for(var n=0,i=t;i<t+r;i++)n+=e[i].length;return n}},function(e,t,r){"use strict";(function(t,n,i){var a=r(10);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(void 0),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?n:a.nextTick;y.WritableState=v;var u=r(6);u.inherits=r(5);var c,h={deprecate:r(61)},d=r(34),f=r(9).Buffer,p=i.Uint8Array||function(){},m=r(33);function g(){}function v(e,t){s=s||r(2),e=e||{};var n=t instanceof s;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(u||0===u)?u:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===e.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(a.nextTick(i,n),a.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),T(e,t))}(e,r,n,t,i);else{var o=w(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||E(e,r),n?l(b,e,r,o,i):b(e,r,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function y(e){if(s=s||r(2),!(c.call(y,this)||this instanceof s))return new y(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function _(e,t,r,n,i,a,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function b(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),T(e,t)}function E(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var s=0,l=!0;r;)i[s]=r,r.isBuf||(l=!1),r=r.next,s+=1;i.allBuffers=l,_(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,h=r.callback;if(_(e,t,!1,t.objectMode?1:u.length,u,c,h),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final((function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var r=w(t);return r&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(x,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}u.inherits(y,d),v.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(v.prototype,"buffer",{get:h.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===y&&e&&e._writableState instanceof v}})):c=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,r){var n,i=this._writableState,o=!1,s=!i.objectMode&&(n=e,f.isBuffer(n)||n instanceof p);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=g),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),a.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(n,o),i=!1),i}(this,i,e,r))&&(i.pendingcb++,o=function(e,t,r,n,i,a){if(!r){var o=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r)),t}(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,s,n,i,a);return l}(this,i,s,e,t,r)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||E(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},y.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,T(e,t),r&&(t.finished?a.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,r(3),r(63).setImmediate,r(0))},function(e,t,r){(t=e.exports=r(35)).Stream=t,t.Readable=t,t.Writable=r(19),t.Duplex=r(2),t.Transform=r(31),t.PassThrough=r(60)},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,o,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(i(r))for(s=Array.prototype.slice.call(arguments,1),o=(u=r.slice()).length,l=0;l<o;l++)u[l].apply(this,s);return!0},r.prototype.addListener=function(e,t){var o;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var r,a,o,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,a=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){a=s;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var r=e[t]+(e[t+1]<<8);return 32768&r&&(r=r-65535-1),r},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r[4]=e[t+4],r[5]=e[t+5],r[6]=e[t+6],r[7]=e[t+7],new Float64Array(r.buffer)[0]}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,r){if(void 0!==e&&t instanceof e)return e.alloc(r);if(t instanceof Uint8Array)return new Uint8Array(r);throw"dicomParser.alloc: unknown type for byteArray"}}).call(this,r(1).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var s={tag:(0,a.default)(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===s.length&&(s.hadUndefinedLength=!0),s.tag===t?s:l(s,e,r)&&!(0,o.isPrivateTag)(s.tag)?((0,i.default)(e,s),s):s.hadUndefinedLength?((0,n.default)(e,s),s):(e.seek(s.length),s)};var n=s(r(25)),i=s(r(39)),a=s(r(4)),o=r(17);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,r){if(void 0!==r)return"SQ"===r(e.tag);if(t.position+4<=t.byteArray.length){var n=(0,a.default)(t);return t.seek(-4),"xfffee000"===n||"xfffee0dd"===n}return t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n,s){if(n=n||t.basicOffsetTable,s=s||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===n.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(r<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(r>=n.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=n[r],u=a(s,l);if(void 0===u)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var c=o(r,n,s,u);return(0,i.default)(e,t,u,c,s)};var n,i=(n=r(18))&&n.__esModule?n:{default:n},a=function(e,t){for(var r=0;r<e.length;r++)if(e[r].offset===t)return r},o=function(e,t,r,n){if(e===t.length-1)return r.length-n;for(var i=t[e+1],a=n+1;a<r.length;a++)if(r[a].offset===i)return a-n;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}},function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,r){(function(e,n){var i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),l=n[r];r<a;l=n[++r])m(l)||!b(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(r,i){if(y(e.process))return function(){return t.deprecate(r,i).apply(this,arguments)};if(!0===n.noDeprecation)return r;var a=!1;return function(){if(!a){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?console.trace(i):console.error(i),a=!0}return r.apply(this,arguments)}};var a,o={};function s(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,e,n.depth)}function l(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function u(e,t){return e}function c(e,r,n){if(e.customInspect&&r&&x(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return v(i)||(i=c(e,i,n)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return g(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,r);if(a)return a;var o=Object.keys(r),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),w(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(r);if(0===o.length){if(x(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(_(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return e.stylize(Date.prototype.toString.call(r),"date");if(w(r))return h(r)}var u,b="",T=!1,M=["{","}"];return f(r)&&(T=!0,M=["[","]"]),x(r)&&(b=" [Function"+(r.name?": "+r.name:"")+"]"),_(r)&&(b=" "+RegExp.prototype.toString.call(r)),E(r)&&(b=" "+Date.prototype.toUTCString.call(r)),w(r)&&(b=" "+h(r)),0!==o.length||T&&0!=r.length?n<0?_(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=T?function(e,t,r,n,i){for(var a=[],o=0,s=t.length;o<s;++o)A(t,String(o))?a.push(d(e,t,r,n,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(d(e,t,r,n,i,!0))})),a}(e,r,n,s,o):o.map((function(t){return d(e,r,n,s,t,T)})),e.seen.pop(),function(e,t,r){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(u,b,M)):M[0]+b+M[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),A(n,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(r)?c(e,l.value,null):c(e,l.value,r-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===T(e)}function b(e){return"object"==typeof e&&null!==e}function E(e){return b(e)&&"[object Date]"===T(e)}function w(e){return b(e)&&("[object Error]"===T(e)||e instanceof Error)}function x(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function M(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(a)&&(a=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var r=n.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=_,t.isObject=b,t.isDate=E,t.isError=w,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(54);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,r;console.log("%s - %s",(r=[M((e=new Date).getHours()),M(e.getMinutes()),M(e.getSeconds())].join(":"),[e.getDate(),S[e.getMonth()],r].join(" ")),t.format.apply(t,arguments))},t.inherits=r(53),t._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,r(0),r(3))},function(e,t,r){"use strict";(function(t){function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=r(29),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function c(e){return!i(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var h=e.exports=v,d=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(a.isFunction(e)){if(l)return e.name;var t=e.toString().match(d);return t&&t[1]}}function p(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(l||!a.isFunction(e))return a.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,r,n,i){throw new h.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function v(e,t){e||g(e,!0,t,"==",h.ok)}function y(e,t,r,o){if(e===t)return!0;if(i(e)&&i(t))return 0===n(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(c(e)&&c(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var l=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return-1!==l&&l===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=_(e),o=_(t);if(i&&!o||!i&&o)return!1;if(i)return y(e=s.call(e),t=s.call(t),r);var l,u,c=w(e),h=w(t);if(c.length!==h.length)return!1;for(c.sort(),h.sort(),u=c.length-1;u>=0;u--)if(c[u]!==h[u])return!1;for(u=c.length-1;u>=0;u--)if(!y(e[l=c[u]],t[l],r,n))return!1;return!0}(e,t,r,o))}return r?e===t:e==t}function _(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function b(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function E(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&g(i,r,"Missing expected exception"+n);var o="string"==typeof n,s=!e&&i&&!r;if((!e&&a.isError(i)&&o&&b(i,r)||s)&&g(i,r,"Got unwanted exception"+n),e&&i&&r&&!b(i,r)||!e&&i)throw i}h.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(m(this.actual),128)+" "+this.operator+" "+p(m(this.expected),128),this.generatedMessage=!0);var t=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,i=f(t),a=n.indexOf("\n"+i);if(a>=0){var o=n.indexOf("\n",a+1);n=n.substring(o+1)}this.stack=n}}},a.inherits(h.AssertionError,Error),h.fail=g,h.ok=v,h.equal=function(e,t,r){e!=t&&g(e,t,r,"==",h.equal)},h.notEqual=function(e,t,r){e==t&&g(e,t,r,"!=",h.notEqual)},h.deepEqual=function(e,t,r){y(e,t,!1)||g(e,t,r,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(e,t,r){y(e,t,!0)||g(e,t,r,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(e,t,r){y(e,t,!1)&&g(e,t,r,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function e(t,r,n){y(t,r,!0)&&g(t,r,n,"notDeepStrictEqual",e)},h.strictEqual=function(e,t,r){e!==t&&g(e,t,r,"===",h.strictEqual)},h.notStrictEqual=function(e,t,r){e===t&&g(e,t,r,"!==",h.notStrictEqual)},h.throws=function(e,t,r){E(!0,e,t,r)},h.doesNotThrow=function(e,t,r){E(!1,e,t,r)},h.ifError=function(e){if(e)throw e};var w=Object.keys||function(e){var t=[];for(var r in e)o.call(e,r)&&t.push(r);return t}}).call(this,r(0))},function(e,t,r){"use strict";e.exports=a;var n=r(2),i=r(6);function a(e){if(!(this instanceof a))return new a(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,r){s(e,t,r)})):s(this,null,null)}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=r(5),i.inherits(a,n),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,(function(e){t(e),r.emit("close")}))}},function(e,t,r){"use strict";var n=r(9).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=h,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�".repeat(r);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�".repeat(r+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�".repeat(r+2)}}(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�".repeat(this.lastTotal-this.lastNeed):t},a.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r?0:(i=o(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r?0:(i=o(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){"use strict";var n=r(10);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,a=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return a||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){e.exports=r(21).EventEmitter},function(e,t,r){"use strict";(function(t,n){var i=r(10);e.exports=_;var a,o=r(38);_.ReadableState=y,r(21).EventEmitter;var s=function(e,t){return e.listeners(t).length},l=r(34),u=r(9).Buffer,c=t.Uint8Array||function(){},h=r(6);h.inherits=r(5);var d=r(66),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,m=r(65),g=r(33);h.inherits(_,l);var v=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var n=t instanceof(a=a||r(2));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=r(32).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function _(e){if(a=a||r(2),!(this instanceof _))return new _(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function b(e,t,r,n,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,T(e)}}(e,o)):(i||(a=function(e,t){var r,n;return n=t,u.isBuffer(n)||n instanceof c||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),n?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):E(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?E(e,o,t,!1):S(e,o)):E(e,o,t,!1))):n||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function E(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&T(e)),S(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=g.destroy,_.prototype._undestroy=g.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),b(this,e,t,!1,r)},_.prototype.unshift=function(e){return b(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return p||(p=r(32).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var w=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=w?e=w:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(M,e):M(e))}function M(e){f("emit readable"),e.emit("readable"),P(e)}function S(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(A,e,t))}function A(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function R(e){f("readable nexttick read 0"),e.read(0)}function k(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),P(e),t.flowing&&!t.reading&&e.read(0)}function P(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;for(e-=i.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(o===a.length?i+=a:i+=a.slice(0,e),0==(e-=o)){o===a.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=u.allocUnsafe(e),n=t.head,i=1;for(n.data.copy(r),e-=n.data.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(a.copy(r,r.length-e,0,o),0==(e-=o)){o===a.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(o));break}++i}return t.length-=i,r}(e,t),n}(e,t.buffer,t.decoder),r);var r}function C(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function H(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}_.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?C(this):T(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&C(this),null;var n,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(r,t))),null===(n=e>0?L(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&C(this)),null!==n&&this.emit("data",n),n},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var r=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var l=t&&!1===t.end||e===n.stdout||e===n.stderr?y:u;function u(){f("onend"),e.end()}a.endEmitted?i.nextTick(l):r.once("end",l),e.on("unpipe",(function t(n,i){f("onunpipe"),n===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",g),e.removeListener("finish",v),e.removeListener("drain",c),e.removeListener("error",m),e.removeListener("unpipe",t),r.removeListener("end",u),r.removeListener("end",y),r.removeListener("data",p),h=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,P(e))}}(r);e.on("drain",c);var h=!1,d=!1;function p(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==H(a.pipes,e))&&!h&&(f("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,d=!0),r.pause())}function m(t){f("onerror",t),y(),e.removeListener("error",m),0===s(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",v),y()}function v(){f("onfinish"),e.removeListener("close",g),y()}function y(){f("unpipe"),r.unpipe(e)}return r.on("data",p),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",m),e.once("close",g),e.once("finish",v),e.emit("pipe",r),a.flowing||(f("pipe resume"),r.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,r);return this}var o=H(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},_.prototype.on=function(e,t){var r=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&T(this):i.nextTick(R,this))}return r},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(k,e,t))}(this,e)),this},_.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){f("wrapped data"),r.decoder&&(i=r.decoder.write(i)),(!r.objectMode||null!=i)&&(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<v.length;a++)e.on(v[a],this.emit.bind(this,v[a]));return this._read=function(t){f("wrapped _read",t),n&&(n=!1,e.resume())},this},_._fromList=L}).call(this,r(0),r(3))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var r=new n.default(a.default,e);return function(){!function(){if(r.seek(128),"DICM"!==r.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var e=[],t={};r.position<r.byteArray.length;){var n=r.position,s=(0,o.default)(r,e);if(s.tag>"x0002ffff"){r.position=n;break}s.parser=a.default,t[s.tag]=s}var l=new i.default(r.byteArrayParser,r.byteArray,t);return l.warnings=r.warnings,l.position=r.position,l}()};var n=s(r(12)),i=s(r(7)),a=s(r(22)),o=s(r(15));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var r=(e[t]<<8)+e[t+1];return 32768&r&&(r=r-65535-1),r},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[3]=e[t],r[2]=e[t+1],r[1]=e[t+2],r[0]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[7]=e[t],r[6]=e[t+1],r[5]=e[t+2],r[4]=e[t+3],r[3]=e[t+4],r[2]=e[t+5],r[1]=e[t+6],r[0]=e[t+7],new Float64Array(r.buffer)[0]}}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var n=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===n)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,r);t.items.push(i)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}(e,t,r):function(e,t,r){for(var n=t.dataOffset+t.length;e.position<n;){var i=u(e,r);t.items.push(i)}}(e,t,r)};var n=l(r(7)),i=l(r(24)),a=l(r(13)),o=l(r(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var r=(0,a.default)(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=(0,i.default)(e,void 0,t);if(r[a.tag]=a,"xfffee00d"===a.tag)return new n.default(e.byteArrayParser,e.byteArray,r)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new n.default(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new n.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetImplicit(r.dataSet,e,e.position+r.length,{vrCallback:t})),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var n=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===n)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,r);t.items.push(i)}r.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}(e,t,r):function(e,t,r){for(var n=t.dataOffset+t.length;e.position<n;){var i=u(e,r);t.items.push(i)}}(e,t,r)};var n=l(r(7)),i=l(r(15)),a=l(r(13)),o=l(r(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var r=(0,a.default)(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=(0,i.default)(e,t);if(r[a.tag]=a,"xfffee00d"===a.tag)return new n.default(e.byteArrayParser,e.byteArray,r)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new n.default(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new n.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetExplicit(r.dataSet,e,e.position+r.length)),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==(0,i.default)(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var n=e.readUint32()/4,a=0;a<n;a++){var o=e.readUint32();t.basicOffsetTable.push(o)}for(var s=e.position;e.position<e.byteArray.length;){var l=(0,i.default)(e),u=e.readUint32();if("xfffee0dd"===l)return e.seek(u),void(t.length=e.position-t.dataOffset);if("xfffee000"!==l)return r&&r.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),u>e.byteArray.length-e.position&&(u=e.byteArray.length-e.position),t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u)}r&&r.push("pixel data element "+t.tag+" missing sequence delimiter tag xfffee0dd")};var n,i=(n=r(4))&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,i=t.vr,a=t.tag;function o(t,r){for(var n="",i=0;i<t;i++)0!==i&&(n+="/"),n+=r.call(e,a,i).toString();return n}if(!0===n.isStringVr(i))r=e.string(a);else{if("AT"===i){var s=e.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"===i?r=o(t.length/2,e.uint16):"SS"===i?r=o(t.length/2,e.int16):"UL"===i?r=o(t.length/4,e.uint32):"SL"===i?r=o(t.length/4,e.int32):"FD"===i?r=o(t.length/8,e.double):"FL"===i&&(r=o(t.length/4,e.float))}return r};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(17))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(o||(o=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?(0,n.default)(e,t,r):(0,i.default)(e,t,0,t.fragments.length)};var n=a(r(26)),i=a(r(18));function a(e){return e&&e.__esModule?e:{default:e}}var o=!1},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){"use strict";var n=r(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,u,c,h,d){var f,p,m,g,v,y,_,b,E,w=d.bits,x=0,T=0,M=0,S=0,A=0,R=0,k=0,P=0,L=0,C=0,I=null,H=0,O=new n.Buf16(16),D=new n.Buf16(16),F=null,N=0;for(x=0;x<=15;x++)O[x]=0;for(T=0;T<l;T++)O[t[r+T]]++;for(A=w,S=15;S>=1&&0===O[S];S--);if(A>S&&(A=S),0===S)return u[c++]=20971520,u[c++]=20971520,d.bits=1,0;for(M=1;M<S&&0===O[M];M++);for(A<M&&(A=M),P=1,x=1;x<=15;x++)if(P<<=1,(P-=O[x])<0)return-1;if(P>0&&(0===e||1!==S))return-1;for(D[1]=0,x=1;x<15;x++)D[x+1]=D[x]+O[x];for(T=0;T<l;T++)0!==t[r+T]&&(h[D[t[r+T]]++]=T);if(0===e?(I=F=h,y=19):1===e?(I=i,H-=257,F=a,N-=257,y=256):(I=o,F=s,y=-1),C=0,T=0,x=M,v=c,R=A,k=0,m=-1,g=(L=1<<A)-1,1===e&&L>852||2===e&&L>592)return 1;for(;;){_=x-k,h[T]<y?(b=0,E=h[T]):h[T]>y?(b=F[N+h[T]],E=I[H+h[T]]):(b=96,E=0),f=1<<x-k,M=p=1<<R;do{u[v+(C>>k)+(p-=f)]=_<<24|b<<16|E|0}while(0!==p);for(f=1<<x-1;C&f;)f>>=1;if(0!==f?(C&=f-1,C+=f):C=0,T++,0==--O[x]){if(x===S)break;x=t[r+h[T]]}if(x>A&&(C&g)!==m){for(0===k&&(k=A),v+=M,P=1<<(R=x-k);R+k<S&&!((P-=O[R+k])<=0);)R++,P<<=1;if(L+=1<<R,1===e&&L>852||2===e&&L>592)return 1;u[m=C&g]=A<<24|R<<16|v-c|0}}return 0!==C&&(u[v+C]=x-k<<24|64<<16|0),d.bits=A,0}},function(e,t,r){"use strict";e.exports=function(e,t){var r,n,i,a,o,s,l,u,c,h,d,f,p,m,g,v,y,_,b,E,w,x,T,M,S;r=e.state,n=e.next_in,M=e.input,i=n+(e.avail_in-5),a=e.next_out,S=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,d=r.window,f=r.hold,p=r.bits,m=r.lencode,g=r.distcode,v=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(f+=M[n++]<<p,p+=8,f+=M[n++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=b=_>>>24,p-=b,0==(b=_>>>16&255))S[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&_,(b&=15)&&(p<b&&(f+=M[n++]<<p,p+=8),E+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=M[n++]<<p,p+=8,f+=M[n++]<<p,p+=8),_=g[f&y];r:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=M[n++]<<p,(p+=8)<b&&(f+=M[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=b,p-=b,w>(b=a-o)){if((b=w-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=0,T=d,0===h){if(x+=u-b,b<E){E-=b;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}}else if(h<b){if(x+=u+h-b,(b-=h)<E){E-=b;do{S[a++]=d[x++]}while(--b);if(x=0,h<E){E-=b=h;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}}}else if(x+=h-b,b<E){E-=b;do{S[a++]=d[x++]}while(--b);x=a-w,T=S}for(;E>2;)S[a++]=T[x++],S[a++]=T[x++],S[a++]=T[x++],E-=3;E&&(S[a++]=T[x++],E>1&&(S[a++]=T[x++]))}else{x=a-w;do{S[a++]=S[x++],S[a++]=S[x++],S[a++]=S[x++],E-=3}while(E>2);E&&(S[a++]=S[x++],E>1&&(S[a++]=S[x++]))}break}}break}}while(n<i&&a<s);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=p}},function(e,t,r){"use strict";var n=r(8),i=r(28),a=r(27),o=r(47),s=r(46),l=-2,u=12,c=30;function h(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(852),t.distcode=t.distdyn=new n.Buf32(592),t.sane=1,t.back=-1,0):l}function f(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):l}function p(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,f(e))):l}function m(e,t){var r,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,0!==(r=p(e,t))&&(e.state=null),r):l}var g,v,y=!0;function _(e){if(y){var t;for(g=new n.Buf32(512),v=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,g,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=g,e.lenbits=9,e.distcode=v,e.distbits=5}function b(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=f,t.inflateReset2=p,t.inflateResetKeep=d,t.inflateInit=function(e){return m(e,15)},t.inflateInit2=m,t.inflate=function(e,t){var r,d,f,p,m,g,v,y,E,w,x,T,M,S,A,R,k,P,L,C,I,H,O,D,F=0,N=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(r=e.state).mode===u&&(r.mode=13),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,d=e.input,g=e.avail_in,y=r.hold,E=r.bits,w=g,x=v,H=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;E<16;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(2&r.wrap&&35615===y){r.check=0,N[0]=255&y,N[1]=y>>>8&255,r.check=a(r.check,N,2,0),y=0,E=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",r.mode=c;break}if(8!=(15&y)){e.msg="unknown compression method",r.mode=c;break}if(E-=4,I=8+(15&(y>>>=4)),0===r.wbits)r.wbits=I;else if(I>r.wbits){e.msg="invalid window size",r.mode=c;break}r.dmax=1<<I,e.adler=r.check=1,r.mode=512&y?10:u,y=0,E=0;break;case 2:for(;E<16;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(r.flags=y,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=c;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=c;break}r.head&&(r.head.text=y>>8&1),512&r.flags&&(N[0]=255&y,N[1]=y>>>8&255,r.check=a(r.check,N,2,0)),y=0,E=0,r.mode=3;case 3:for(;E<32;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}r.head&&(r.head.time=y),512&r.flags&&(N[0]=255&y,N[1]=y>>>8&255,N[2]=y>>>16&255,N[3]=y>>>24&255,r.check=a(r.check,N,4,0)),y=0,E=0,r.mode=4;case 4:for(;E<16;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}r.head&&(r.head.xflags=255&y,r.head.os=y>>8),512&r.flags&&(N[0]=255&y,N[1]=y>>>8&255,r.check=a(r.check,N,2,0)),y=0,E=0,r.mode=5;case 5:if(1024&r.flags){for(;E<16;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}r.length=y,r.head&&(r.head.extra_len=y),512&r.flags&&(N[0]=255&y,N[1]=y>>>8&255,r.check=a(r.check,N,2,0)),y=0,E=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((T=r.length)>g&&(T=g),T&&(r.head&&(I=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,d,p,T,I)),512&r.flags&&(r.check=a(r.check,d,T,p)),g-=T,p+=T,r.length-=T),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===g)break e;T=0;do{I=d[p+T++],r.head&&I&&r.length<65536&&(r.head.name+=String.fromCharCode(I))}while(I&&T<g);if(512&r.flags&&(r.check=a(r.check,d,T,p)),g-=T,p+=T,I)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===g)break e;T=0;do{I=d[p+T++],r.head&&I&&r.length<65536&&(r.head.comment+=String.fromCharCode(I))}while(I&&T<g);if(512&r.flags&&(r.check=a(r.check,d,T,p)),g-=T,p+=T,I)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;E<16;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(y!==(65535&r.check)){e.msg="header crc mismatch",r.mode=c;break}y=0,E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=u;break;case 10:for(;E<32;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}e.adler=r.check=h(y),y=0,E=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,r.hold=y,r.bits=E,2;e.adler=r.check=1,r.mode=u;case u:if(5===t||6===t)break e;case 13:if(r.last){y>>>=7&E,E-=7&E,r.mode=27;break}for(;E<3;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}switch(r.last=1&y,E-=1,3&(y>>>=1)){case 0:r.mode=14;break;case 1:if(_(r),r.mode=20,6===t){y>>>=2,E-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=c}y>>>=2,E-=2;break;case 14:for(y>>>=7&E,E-=7&E;E<32;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",r.mode=c;break}if(r.length=65535&y,y=0,E=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(T=r.length){if(T>g&&(T=g),T>v&&(T=v),0===T)break e;n.arraySet(f,d,p,T,m),g-=T,p+=T,v-=T,m+=T,r.length-=T;break}r.mode=u;break;case 17:for(;E<14;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(r.nlen=257+(31&y),y>>>=5,E-=5,r.ndist=1+(31&y),y>>>=5,E-=5,r.ncode=4+(15&y),y>>>=4,E-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=c;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;E<3;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}r.lens[U[r.have++]]=7&y,y>>>=3,E-=3}for(;r.have<19;)r.lens[U[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,O={bits:r.lenbits},H=s(0,r.lens,0,19,r.lencode,0,r.work,O),r.lenbits=O.bits,H){e.msg="invalid code lengths set",r.mode=c;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;R=(F=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,k=65535&F,!((A=F>>>24)<=E);){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(k<16)y>>>=A,E-=A,r.lens[r.have++]=k;else{if(16===k){for(D=A+2;E<D;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(y>>>=A,E-=A,0===r.have){e.msg="invalid bit length repeat",r.mode=c;break}I=r.lens[r.have-1],T=3+(3&y),y>>>=2,E-=2}else if(17===k){for(D=A+3;E<D;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}E-=A,I=0,T=3+(7&(y>>>=A)),y>>>=3,E-=3}else{for(D=A+7;E<D;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}E-=A,I=0,T=11+(127&(y>>>=A)),y>>>=7,E-=7}if(r.have+T>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=c;break}for(;T--;)r.lens[r.have++]=I}}if(r.mode===c)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=c;break}if(r.lenbits=9,O={bits:r.lenbits},H=s(1,r.lens,0,r.nlen,r.lencode,0,r.work,O),r.lenbits=O.bits,H){e.msg="invalid literal/lengths set",r.mode=c;break}if(r.distbits=6,r.distcode=r.distdyn,O={bits:r.distbits},H=s(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,O),r.distbits=O.bits,H){e.msg="invalid distances set",r.mode=c;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(g>=6&&v>=258){e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,r.hold=y,r.bits=E,o(e,x),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,d=e.input,g=e.avail_in,y=r.hold,E=r.bits,r.mode===u&&(r.back=-1);break}for(r.back=0;R=(F=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,k=65535&F,!((A=F>>>24)<=E);){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(R&&0==(240&R)){for(P=A,L=R,C=k;R=(F=r.lencode[C+((y&(1<<P+L)-1)>>P)])>>>16&255,k=65535&F,!(P+(A=F>>>24)<=E);){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}y>>>=P,E-=P,r.back+=P}if(y>>>=A,E-=A,r.back+=A,r.length=k,0===R){r.mode=26;break}if(32&R){r.back=-1,r.mode=u;break}if(64&R){e.msg="invalid literal/length code",r.mode=c;break}r.extra=15&R,r.mode=22;case 22:if(r.extra){for(D=r.extra;E<D;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}r.length+=y&(1<<r.extra)-1,y>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;R=(F=r.distcode[y&(1<<r.distbits)-1])>>>16&255,k=65535&F,!((A=F>>>24)<=E);){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(0==(240&R)){for(P=A,L=R,C=k;R=(F=r.distcode[C+((y&(1<<P+L)-1)>>P)])>>>16&255,k=65535&F,!(P+(A=F>>>24)<=E);){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}y>>>=P,E-=P,r.back+=P}if(y>>>=A,E-=A,r.back+=A,64&R){e.msg="invalid distance code",r.mode=c;break}r.offset=k,r.extra=15&R,r.mode=24;case 24:if(r.extra){for(D=r.extra;E<D;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}r.offset+=y&(1<<r.extra)-1,y>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=c;break}r.mode=25;case 25:if(0===v)break e;if(T=x-v,r.offset>T){if((T=r.offset-T)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=c;break}T>r.wnext?(T-=r.wnext,M=r.wsize-T):M=r.wnext-T,T>r.length&&(T=r.length),S=r.window}else S=f,M=m-r.offset,T=r.length;T>v&&(T=v),v-=T,r.length-=T;do{f[m++]=S[M++]}while(--T);0===r.length&&(r.mode=21);break;case 26:if(0===v)break e;f[m++]=r.length,v--,r.mode=21;break;case 27:if(r.wrap){for(;E<32;){if(0===g)break e;g--,y|=d[p++]<<E,E+=8}if(x-=v,e.total_out+=x,r.total+=x,x&&(e.adler=r.check=r.flags?a(r.check,f,x,m-x):i(r.check,f,x,m-x)),x=v,(r.flags?y:h(y))!==r.check){e.msg="incorrect data check",r.mode=c;break}y=0,E=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;E<32;){if(0===g)break e;g--,y+=d[p++]<<E,E+=8}if(y!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=c;break}y=0,E=0}r.mode=29;case 29:H=1;break e;case c:H=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,r.hold=y,r.bits=E,(r.wsize||x!==e.avail_out&&r.mode<c&&(r.mode<27||4!==t))&&b(e,e.output,e.next_out,x-e.avail_out)?(r.mode=31,-4):(w-=e.avail_in,x-=e.avail_out,e.total_in+=w,e.total_out+=x,r.total+=x,r.wrap&&x&&(e.adler=r.check=r.flags?a(r.check,f,x,e.next_out-x):i(r.check,f,x,e.next_out-x)),e.data_type=r.bits+(r.last?64:0)+(r.mode===u?128:0)+(20===r.mode||15===r.mode?256:0),(0===w&&0===x||4===t)&&0===H&&(H=-5),H)},t.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?l:(r.head=t,t.done=!1,0):l},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?l:11===r.mode&&i(1,t,n,0)!==r.check?-3:b(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):l},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){"use strict";var n=r(8);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=256,o=286,s=30,l=15,u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);i(f);var p=new Array(60);i(p);var m=new Array(512);i(m);var g=new Array(256);i(g);var v=new Array(29);i(v);var y,_,b,E=new Array(s);function w(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function x(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function T(e){return e<256?m[e]:m[256+(e>>>7)]}function M(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function S(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,M(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function A(e,t,r){S(e,r[2*t],r[2*t+1])}function R(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function k(e,t,r){var n,i,a=new Array(16),o=0;for(n=1;n<=l;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=R(a[s]++,s))}}function P(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function L(e){e.bi_valid>8?M(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function C(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function I(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&C(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!C(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function H(e,t,r){var n,i,o,s,l=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===n?A(e,i,t):(A(e,(o=g[i])+a+1,t),0!==(s=u[o])&&S(e,i-=v[o],s),A(e,o=T(--n),r),0!==(s=c[o])&&S(e,n-=E[o],s))}while(l<e.last_lit);A(e,256,t)}function O(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<u;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)I(e,a,r);i=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],I(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,I(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,u=t.dyn_tree,c=t.max_code,h=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,m=t.stat_desc.max_length,g=0;for(a=0;a<=l;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(a=u[2*u[2*(n=e.heap[r])+1]+1]+1)>m&&(a=m,g++),u[2*n+1]=a,n>c||(e.bl_count[a]++,o=0,n>=p&&(o=f[n-p]),s=u[2*n],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(h[2*n+1]+o)));if(0!==g){do{for(a=m-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[m]--,g-=2}while(g>0);for(a=m;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>c||(u[2*i+1]!==a&&(e.opt_len+=(a-u[2*i+1])*u[2*i],u[2*i+1]=a),n--)}}(e,t),k(a,c,e.bl_count)}function D(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function F(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<l&&i===o)){if(s<u)do{A(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(A(e,i,e.bl_tree),s--),A(e,16,e.bl_tree),S(e,s-3,2)):s<=10?(A(e,17,e.bl_tree),S(e,s-3,3)):(A(e,18,e.bl_tree),S(e,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}}i(E);var N=!1;function U(e,t,r,i){S(e,0+(i?1:0),3),function(e,t,r,i){L(e),M(e,r),M(e,~r),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r)}t._tr_init=function(e){N||(function(){var e,t,r,n,i,a=new Array(16);for(r=0,n=0;n<28;n++)for(v[n]=r,e=0;e<1<<u[n];e++)g[r++]=n;for(g[r-1]=n,i=0,n=0;n<16;n++)for(E[n]=i,e=0;e<1<<c[n];e++)m[i++]=n;for(i>>=7;n<s;n++)for(E[n]=i<<7,e=0;e<1<<c[n]-7;e++)m[256+i++]=n;for(t=0;t<=l;t++)a[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,a[8]++;for(;e<=255;)f[2*e+1]=9,e++,a[9]++;for(;e<=279;)f[2*e+1]=7,e++,a[7]++;for(;e<=287;)f[2*e+1]=8,e++,a[8]++;for(k(f,287,a),e=0;e<s;e++)p[2*e+1]=5,p[2*e]=R(e,5);y=new w(f,u,257,o,l),_=new w(p,c,0,s,l),b=new w(new Array(0),h,0,19,7)}(),N=!0),e.l_desc=new x(e.dyn_ltree,y),e.d_desc=new x(e.dyn_dtree,_),e.bl_desc=new x(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,P(e)},t._tr_stored_block=U,t._tr_flush_block=function(e,t,r,n){var i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<a;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),O(e,e.l_desc),O(e,e.d_desc),s=function(e){var t;for(D(e,e.dyn_ltree,e.l_desc.max_code),D(e,e.dyn_dtree,e.d_desc.max_code),O(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*d[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?U(e,t,r,n):4===e.strategy||o===i?(S(e,2+(n?1:0),3),H(e,f,p)):(S(e,4+(n?1:0),3),function(e,t,r,n){var i;for(S(e,t-257,5),S(e,r-1,5),S(e,n-4,4),i=0;i<n;i++)S(e,e.bl_tree[2*d[i]+1],3);F(e,e.dyn_ltree,t-1),F(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),H(e,e.dyn_ltree,e.dyn_dtree)),P(e),n&&L(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(g[r]+a+1)]++,e.dyn_dtree[2*T(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){S(e,2,3),A(e,256,f),function(e){16===e.bi_valid?(M(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var n,i=r(8),a=r(50),o=r(28),s=r(27),l=r(49),u=-2,c=258,h=262,d=103,f=113,p=666;function m(e,t){return e.msg=l[t],t}function g(e){return(e<<1)-(e>4?9:0)}function v(e){for(var t=e.length;--t>=0;)e[t]=0}function y(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function _(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,y(e.strm)}function b(e,t){e.pending_buf[e.pending++]=t}function E(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function w(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-h?e.strstart-(e.w_size-h):0,u=e.window,d=e.w_mask,f=e.prev,p=e.strstart+c,m=u[a+o-1],g=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===g&&u[r+o-1]===m&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<p);if(n=c-(p-a),a=p-c,n>o){if(e.match_start=t,o=n,n>=s)break;m=u[a+o-1],g=u[a+o]}}}while((t=f[t&d])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function x(e){var t,r,n,a,l,u,c,d,f,p,m=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-h)){i.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=m?n-m:0}while(--r);t=r=m;do{n=e.prev[--t],e.prev[t]=n>=m?n-m:0}while(--r);a+=m}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,d=e.strstart+e.lookahead,f=a,p=void 0,(p=u.avail_in)>f&&(p=f),r=0===p?0:(u.avail_in-=p,i.arraySet(c,u.input,u.next_in,p,d),1===u.state.wrap?u.adler=o(u.adler,c,p,d):2===u.state.wrap&&(u.adler=s(u.adler,c,p,d)),u.next_in+=p,u.total_in+=p,p),e.lookahead+=r,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<h&&0!==e.strm.avail_in)}function T(e,t){for(var r,n;;){if(e.lookahead<h){if(x(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-h&&(e.match_length=w(e,r)),e.match_length>=3)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function M(e,t){for(var r,n,i;;){if(e.lookahead<h){if(x(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-h&&(e.match_length=w(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(_(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&_(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function S(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function A(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):m(e,u)}function R(e){var t,r=A(e);return 0===r&&((t=e.state).window_size=2*t.w_size,v(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function k(e,t,r,n,a,o){if(!e)return u;var s=1;if(-1===t&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||8!==r||n<8||n>15||t<0||t>9||o<0||o>4)return m(e,u);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),v(this.dyn_ltree),v(this.dyn_dtree),v(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),v(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),v(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,R(e)}n=[new S(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(x(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,_(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-h&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(_(e,!1),e.strm.avail_out),1)})),new S(4,4,8,4,T),new S(4,5,16,8,T),new S(4,6,32,32,T),new S(4,4,16,16,M),new S(8,16,32,32,M),new S(8,16,128,128,M),new S(8,32,128,256,M),new S(32,128,258,1024,M),new S(32,258,258,4096,M)],t.deflateInit=function(e,t){return k(e,t,8,15,8,0)},t.deflateInit2=k,t.deflateReset=R,t.deflateResetKeep=A,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?u:(e.state.gzhead=t,0):u},t.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||t>5||t<0)return e?m(e,u):u;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===p&&4!==t)return m(e,0===e.avail_out?-5:u);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,b(i,31),b(i,139),b(i,8),i.gzhead?(b(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),b(i,255&i.gzhead.time),b(i,i.gzhead.time>>8&255),b(i,i.gzhead.time>>16&255),b(i,i.gzhead.time>>24&255),b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(b(i,255&i.gzhead.extra.length),b(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(b(i,0),b(i,0),b(i,0),b(i,0),b(i,0),b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,3),i.status=f);else{var h=8+(i.w_bits-8<<4)<<8;h|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(h|=32),h+=31-h%31,i.status=f,E(i,h),0!==i.strstart&&(E(i,e.adler>>>16),E(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending!==i.pending_buf_size));)b(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,b(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=d)}else i.status=d;if(i.status===d&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&y(e),i.pending+2<=i.pending_buf_size&&(b(i,255&e.adler),b(i,e.adler>>8&255),e.adler=0,i.status=f)):i.status=f),0!==i.pending){if(y(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&g(t)<=g(r)&&4!==t)return m(e,-5);if(i.status===p&&0!==e.avail_in)return m(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&i.status!==p){var w=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(x(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=c){if(x(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+c;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=c-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(i,t):n[i.level].func(i,t);if(3!==w&&4!==w||(i.status=p),1===w||3===w)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===w&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(v(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),y(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(b(i,255&e.adler),b(i,e.adler>>8&255),b(i,e.adler>>16&255),b(i,e.adler>>24&255),b(i,255&e.total_in),b(i,e.total_in>>8&255),b(i,e.total_in>>16&255),b(i,e.total_in>>24&255)):(E(i,e.adler>>>16),E(i,65535&e.adler)),y(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==d&&t!==f&&t!==p?m(e,u):(e.state=null,t===f?m(e,-3):0):u},t.deflateSetDictionary=function(e,t){var r,n,a,s,l,c,h,d,f=t.length;if(!e||!e.state)return u;if(2===(s=(r=e.state).wrap)||1===s&&42!==r.status||r.lookahead)return u;for(1===s&&(e.adler=o(e.adler,t,f,0)),r.wrap=0,f>=r.w_size&&(0===s&&(v(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new i.Buf8(r.w_size),i.arraySet(d,t,f-r.w_size,r.w_size,0),t=d,f=r.w_size),l=e.avail_in,c=e.next_in,h=e.input,e.avail_in=f,e.next_in=0,e.input=t,x(r);r.lookahead>=3;){n=r.strstart,a=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=2,x(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=c,e.input=h,e.avail_in=l,r.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,r){"use strict";(function(e,n){var i=r(30),a=r(52),o=r(51),s=r(48),l=r(45);for(var u in l)t[u]=l[u];function c(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},c.prototype.write=function(e,t,r,n,i,a,o){return this._write(!0,e,t,r,n,i,a,o)},c.prototype.writeSync=function(e,t,r,n,i,a,o){return this._write(!1,e,t,r,n,i,a,o)},c.prototype._write=function(r,a,o,s,l,u,c,h){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==t.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==t.Z_NO_FLUSH&&a!==t.Z_PARTIAL_FLUSH&&a!==t.Z_SYNC_FLUSH&&a!==t.Z_FULL_FLUSH&&a!==t.Z_FINISH&&a!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),l=0,s=0),this.strm.avail_in=l,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=h,this.strm.output=u,this.strm.next_out=c,this.flush=a,!r)return this._process(),this._checkError()?this._afterSync():void 0;var d=this;return n.nextTick((function(){d._process(),d._after()})),this},c.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},c.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},c.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(e,r,n,a,o){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(r>=-1&&r<=9,"invalid compression level"),i(n>=1&&n<=9,"invalid memlevel"),i(a===t.Z_FILTERED||a===t.Z_HUFFMAN_ONLY||a===t.Z_RLE||a===t.Z_FIXED||a===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(r,e,n,a,o),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(e,r,n,i,l){switch(this.level=e,this.windowBits=r,this.memLevel=n,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=c}).call(this,r(1).Buffer,r(3))},function(e,t,r){e.exports=r(20).PassThrough},function(e,t,r){e.exports=r(20).Transform},function(e,t,r){e.exports=r(2)},function(e,t,r){e.exports=r(19)},function(e,t,r){"use strict";e.exports=a;var n=r(31),i=r(6);function a(e){if(!(this instanceof a))return new a(e);n.call(this,e)}i.inherits=r(5),i.inherits(a,n),a.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){(function(t){function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,r(0))},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,a,o,s,l=1,u={},c=!1,h=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),n=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data)},n=function(e){a.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,n=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(p,0,e)},d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return u[l]=i,n(l),l++},d.clearImmediate=f}function f(e){delete u[e]}function p(e){if(c)setTimeout(p,0,e);else{var t=u[e];if(t){c=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{f(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(0),r(3))},function(e,t,r){(function(e){var n=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(62),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(0))},function(e,t){},function(e,t,r){"use strict";var n=r(9).Buffer,i=r(64);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i=n.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=i,r=o,a.data.copy(t,r),o+=a.data.length,a=a.next;return i},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,r){e.exports=i;var n=r(21).EventEmitter;function i(){n.call(this)}r(5)(i,n),i.Readable=r(20),i.Writable=r(59),i.Duplex=r(58),i.Transform=r(57),i.PassThrough=r(56),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===n.listenerCount(this,"error"))throw e}function c(){r.removeListener("data",i),e.removeListener("drain",a),r.removeListener("end",s),r.removeListener("close",l),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",c),r.removeListener("close",c),e.removeListener("close",c)}return r.on("error",u),e.on("error",u),r.on("end",c),r.on("close",c),e.on("close",c),e.emit("pipe",r),e}},function(e,t,r){"use strict";(function(e){var n=r(1).Buffer,i=r(67).Transform,a=r(55),o=r(29),s=r(30).ok,l=r(1).kMaxLength,u="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var c=Object.keys(a),h=0;h<c.length;h++){var d=c[h];d.match(/^Z/)&&Object.defineProperty(t,d,{enumerable:!0,value:a[d],writable:!1})}for(var f={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=Object.keys(f),m=0;m<p.length;m++){var g=p[m];f[f[g]]=g}function v(e,t,r){var i=[],a=0;function o(){for(var t;null!==(t=e.read());)i.push(t),a+=t.length;e.once("readable",o)}function s(){var t,o=null;a>=l?o=new RangeError(u):t=n.concat(i,a),i=[],e.close(),r(o,t)}e.on("error",(function(t){e.removeListener("end",s),e.removeListener("readable",o),r(t)})),e.on("end",s),e.end(t),o()}function y(e,t){if("string"==typeof t&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError("Not a string or buffer");var r=e._finishFlushFlag;return e._processChunk(t,r)}function _(e){if(!(this instanceof _))return new _(e);A.call(this,e,a.DEFLATE)}function b(e){if(!(this instanceof b))return new b(e);A.call(this,e,a.INFLATE)}function E(e){if(!(this instanceof E))return new E(e);A.call(this,e,a.GZIP)}function w(e){if(!(this instanceof w))return new w(e);A.call(this,e,a.GUNZIP)}function x(e){if(!(this instanceof x))return new x(e);A.call(this,e,a.DEFLATERAW)}function T(e){if(!(this instanceof T))return new T(e);A.call(this,e,a.INFLATERAW)}function M(e){if(!(this instanceof M))return new M(e);A.call(this,e,a.UNZIP)}function S(e){return e===a.Z_NO_FLUSH||e===a.Z_PARTIAL_FLUSH||e===a.Z_SYNC_FLUSH||e===a.Z_FULL_FLUSH||e===a.Z_FINISH||e===a.Z_BLOCK}function A(e,r){var o=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!S(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!S(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:a.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!n.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(r);var s=this;this._hadError=!1,this._handle.onerror=function(e,r){R(s),s._hadError=!0;var n=new Error(e);n.errno=r,n.code=t.codes[r],s.emit("error",n)};var l=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(l=e.level);var u=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(u=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,l,e.memLevel||t.Z_DEFAULT_MEMLEVEL,u,e.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=u,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!o._handle},configurable:!0,enumerable:!0})}function R(t,r){r&&e.nextTick(r),t._handle&&(t._handle.close(),t._handle=null)}function k(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(f),writable:!1}),t.Deflate=_,t.Inflate=b,t.Gzip=E,t.Gunzip=w,t.DeflateRaw=x,t.InflateRaw=T,t.Unzip=M,t.createDeflate=function(e){return new _(e)},t.createInflate=function(e){return new b(e)},t.createDeflateRaw=function(e){return new x(e)},t.createInflateRaw=function(e){return new T(e)},t.createGzip=function(e){return new E(e)},t.createGunzip=function(e){return new w(e)},t.createUnzip=function(e){return new M(e)},t.deflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),v(new _(t),e,r)},t.deflateSync=function(e,t){return y(new _(t),e)},t.gzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),v(new E(t),e,r)},t.gzipSync=function(e,t){return y(new E(t),e)},t.deflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),v(new x(t),e,r)},t.deflateRawSync=function(e,t){return y(new x(t),e)},t.unzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),v(new M(t),e,r)},t.unzipSync=function(e,t){return y(new M(t),e)},t.inflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),v(new b(t),e,r)},t.inflateSync=function(e,t){return y(new b(t),e)},t.gunzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),v(new w(t),e,r)},t.gunzipSync=function(e,t){return y(new w(t),e)},t.inflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),v(new T(t),e,r)},t.inflateRawSync=function(e,t){return y(new T(t),e)},o.inherits(A,i),A.prototype.params=function(r,n,i){if(r<t.Z_MIN_LEVEL||r>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+r);if(n!=t.Z_FILTERED&&n!=t.Z_HUFFMAN_ONLY&&n!=t.Z_RLE&&n!=t.Z_FIXED&&n!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==r||this._strategy!==n){var o=this;this.flush(a.Z_SYNC_FLUSH,(function(){s(o._handle,"zlib binding closed"),o._handle.params(r,n),o._hadError||(o._level=r,o._strategy=n,i&&i())}))}else e.nextTick(i)},A.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},A.prototype._flush=function(e){this._transform(n.alloc(0),"",e)},A.prototype.flush=function(t,r){var i=this,o=this._writableState;("function"==typeof t||void 0===t&&!r)&&(r=t,t=a.Z_FULL_FLUSH),o.ended?r&&e.nextTick(r):o.ending?r&&this.once("end",r):o.needDrain?r&&this.once("drain",(function(){return i.flush(t,r)})):(this._flushFlag=t,this.write(n.alloc(0),"",r))},A.prototype.close=function(t){R(this,t),e.nextTick(k,this)},A.prototype._transform=function(e,t,r){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);return null===e||n.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(e,i,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},A.prototype._processChunk=function(e,t,r){var i=e&&e.length,a=this._chunkSize-this._offset,o=0,c=this,h="function"==typeof r;if(!h){var d,f=[],p=0;this.on("error",(function(e){d=e})),s(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,a)}while(!this._hadError&&y(m[0],m[1]));if(this._hadError)throw d;if(p>=l)throw R(this),new RangeError(u);var g=n.concat(f,p);return R(this),g}s(this._handle,"zlib binding closed");var v=this._handle.write(t,e,o,i,this._buffer,this._offset,a);function y(l,u){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var d=a-u;if(s(d>=0,"have should not go down"),d>0){var m=c._buffer.slice(c._offset,c._offset+d);c._offset+=d,h?c.push(m):(f.push(m),p+=m.length)}if((0===u||c._offset>=c._chunkSize)&&(a=c._chunkSize,c._offset=0,c._buffer=n.allocUnsafe(c._chunkSize)),0===u){if(o+=i-l,i=l,!h)return!0;var g=c._handle.write(t,e,o,i,c._buffer,c._offset,c._chunkSize);return g.callback=y,void(g.buffer=e)}if(!h)return!1;r()}}v.buffer=e,v.callback=y},o.inherits(_,A),o.inherits(b,A),o.inherits(E,A),o.inherits(w,A),o.inherits(x,A),o.inherits(T,A),o.inherits(M,A)}).call(this,r(3))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,d){if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return p=function(l){var f=function(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var r=e.elements.x00020010;return c.readFixedString(t,r.dataOffset,r.length)}(l),p=function(e){return"1.2.840.10008.1.2"!==e}(f),m=function(o,l){if("1.2.840.10008.1.2.1.99"===o){if(d&&d.inflater){var c=d.inflater(t,l);return new a.default(s.default,c,0)}if(void 0!==e&&this.module!==e){var h=r(68),f=(0,u.default)(t,l,t.length-l),p=h.inflateRawSync(f),m=(0,n.default)(t,p.length+l);return t.copy(m,0,0,l),p.copy(m,l),new a.default(s.default,m,0)}if("undefined"!=typeof pako){var g=t.slice(l),v=pako.inflateRaw(g),y=(0,n.default)(t,v.length+l);return y.set(t.slice(0,l),0),y.set(v,l),new a.default(s.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===o?new a.default(i.default,t,l):new a.default(s.default,t,l)}(f,l.position),g=new o.default(m.byteArrayParser,m.byteArray,{});g.warnings=m.warnings;try{p?h.parseDicomDataSetExplicit(g,m,m.byteArray.length,d):h.parseDicomDataSetImplicit(g,m,m.byteArray.length,d)}catch(e){throw{exception:e,dataSet:g}}return g}(f=(0,l.default)(t,d)),function(e,t){for(var r in e.elements)e.elements.hasOwnProperty(r)&&(t.elements[r]=e.elements[r]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(f,p);var f,p};var n=f(r(23)),i=f(r(37)),a=f(r(12)),o=f(r(7)),s=f(r(22)),l=f(r(36)),u=f(r(11)),c=d(r(14)),h=d(r(16));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}}).call(this,r(69)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.8.5"},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*m}},function(e,t,r){"use strict";t.byteLength=function(e){return 3*e.length/4-u(e)},t.toByteArray=function(e){var t,r,n,o,s,l=e.length;o=u(e),s=new a(3*l/4-o),r=o>0?l-4:l;var c=0;for(t=0;t<r;t+=4)n=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[c++]=n>>16&255,s[c++]=n>>8&255,s[c++]=255&n;return 2===o?(n=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[c++]=255&n):1===o&&(n=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[c++]=n>>8&255,s[c++]=255&n),s},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a="",o=[],s=0,l=r-i;s<l;s+=16383)o.push(c(e,s,s+16383>l?l:s+16383));return 1===i?(t=e[r-1],a+=n[t>>2],a+=n[t<<4&63],a+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],a+=n[t>>10],a+=n[t>>4&63],a+=n[t<<2&63],a+="="),o.push(a),o.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function c(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t,r){"use strict";function n(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function i(e,t,r){var i=t.fragments[r];return!(!n(e,i.position+i.length-2)&&!n(e,i.position+i.length-3))}function a(e,t,r){for(var n=r;n<t.fragments.length;n++)if(i(e,t,n))return n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r&&r.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";r=r||t.fragments;for(var n=[],i=0;;){n.push(t.fragments[i].offset);var o=a(e,t,i);if(void 0===o||o===t.fragments.length-1)return n;i=o+1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";r=r||{omitPrivateAttibutes:!0,maxElementLength:128};var n={};for(var o in t.elements){var s=t.elements[o];if(!0!==r.omitPrivateAttibutes||!a.isPrivateTag(o))if(s.items){for(var l=[],u=0;u<s.items.length;u++)l.push(e(s.items[u].dataSet,r));n[o]=l}else{var c;c=void 0,s.length<r.maxElementLength&&(c=(0,i.default)(t,s)),n[o]=void 0!==c?c:{dataOffset:s.dataOffset,length:s.length}}}return n};var n,i=(n=r(43))&&n.__esModule?n:{default:n},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(17))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&8===e.length){var r=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);if(t&&!0!==function(e,t,r){return!isNaN(r)&&t>0&&t<=12&&e>0&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,r)}(i,n,r))throw"invalid DA '"+e+"'";return{year:r,month:n,day:i}}if(t)throw"invalid DA '"+e+"'"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.length>=2){var r=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,a=e.length>=8?parseInt(e.substring(7,13),10):void 0;if(t&&(isNaN(r)||void 0!==n&&isNaN(n)||void 0!==i&&isNaN(i)||void 0!==a&&isNaN(a)||r<0||r>23||n&&(n<0||n>59)||i&&(i<0||i>59)||a&&(a<0||a>999999)))throw"invalid TM '"+e+"'";return{hours:r,minutes:n,seconds:i,fractionalSeconds:a}}if(t)throw"invalid TM '"+e+"'"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var n=r(17),i=u(r(77)),a=u(r(76)),o=u(r(43)),s=u(r(75)),l=u(r(74));function u(e){return e&&e.__esModule?e:{default:e}}t.isStringVr=n.isStringVr,t.isPrivateTag=n.isPrivateTag,t.parsePN=n.parsePN,t.parseTM=i.default,t.parseDA=a.default,t.explicitElementToString=o.default,t.explicitDataSetToJS=s.default,t.createJPEGBasicOffsetTable=l.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readTag=t.readSequenceItem=t.readSequenceItemsImplicit=t.readSequenceItemsExplicit=t.readPart10Header=t.readEncapsulatedPixelDataFromFragments=t.readEncapsulatedPixelData=t.readEncapsulatedImageFrame=t.readDicomElementImplicit=t.readDicomElementExplicit=t.parseDicom=t.littleEndianByteArrayParser=t.findItemDelimitationItemAndSetElementLength=t.findEndOfEncapsulatedElement=t.findAndSetUNElementLength=t.DataSet=t.sharedCopy=t.ByteStream=t.bigEndianByteArrayParser=t.version=t.alloc=t.readFixedString=t.parseDicomDataSetImplicit=t.parseDicomDataSetExplicit=t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var n=r(78),i=r(16),a=r(14),o=A(r(23)),s=A(r(71)),l=A(r(37)),u=A(r(12)),c=A(r(11)),h=A(r(7)),d=A(r(41)),f=A(r(42)),p=A(r(25)),m=A(r(22)),g=A(r(70)),v=A(r(15)),y=A(r(24)),_=A(r(26)),b=A(r(44)),E=A(r(18)),w=A(r(36)),x=A(r(40)),T=A(r(39)),M=A(r(13)),S=A(r(4));function A(e){return e&&e.__esModule?e:{default:e}}var R={isStringVr:n.isStringVr,isPrivateTag:n.isPrivateTag,parsePN:n.parsePN,parseTM:n.parseTM,parseDA:n.parseDA,explicitElementToString:n.explicitElementToString,explicitDataSetToJS:n.explicitDataSetToJS,createJPEGBasicOffsetTable:n.createJPEGBasicOffsetTable,parseDicomDataSetExplicit:i.parseDicomDataSetExplicit,parseDicomDataSetImplicit:i.parseDicomDataSetImplicit,readFixedString:a.readFixedString,alloc:o.default,version:s.default,bigEndianByteArrayParser:l.default,ByteStream:u.default,sharedCopy:c.default,DataSet:h.default,findAndSetUNElementLength:d.default,findEndOfEncapsulatedElement:f.default,findItemDelimitationItemAndSetElementLength:p.default,littleEndianByteArrayParser:m.default,parseDicom:g.default,readDicomElementExplicit:v.default,readDicomElementImplicit:y.default,readEncapsulatedImageFrame:_.default,readEncapsulatedPixelData:b.default,readEncapsulatedPixelDataFromFragments:E.default,readPart10Header:w.default,readSequenceItemsExplicit:x.default,readSequenceItemsImplicit:T.default,readSequenceItem:M.default,readTag:S.default};t.isStringVr=n.isStringVr,t.isPrivateTag=n.isPrivateTag,t.parsePN=n.parsePN,t.parseTM=n.parseTM,t.parseDA=n.parseDA,t.explicitElementToString=n.explicitElementToString,t.explicitDataSetToJS=n.explicitDataSetToJS,t.createJPEGBasicOffsetTable=n.createJPEGBasicOffsetTable,t.parseDicomDataSetExplicit=i.parseDicomDataSetExplicit,t.parseDicomDataSetImplicit=i.parseDicomDataSetImplicit,t.readFixedString=a.readFixedString,t.alloc=o.default,t.version=s.default,t.bigEndianByteArrayParser=l.default,t.ByteStream=u.default,t.sharedCopy=c.default,t.DataSet=h.default,t.findAndSetUNElementLength=d.default,t.findEndOfEncapsulatedElement=f.default,t.findItemDelimitationItemAndSetElementLength=p.default,t.littleEndianByteArrayParser=m.default,t.parseDicom=g.default,t.readDicomElementExplicit=v.default,t.readDicomElementImplicit=y.default,t.readEncapsulatedImageFrame=_.default,t.readEncapsulatedPixelData=b.default,t.readEncapsulatedPixelDataFromFragments=E.default,t.readPart10Header=w.default,t.readSequenceItemsExplicit=x.default,t.readSequenceItemsImplicit=T.default,t.readSequenceItem=M.default,t.readTag=S.default,t.default=R}])},function(e,t,r){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||r(54),n.lossless.DataStream=n.lossless.DataStream||r(7),n.lossless.Decoder=n.lossless.Decoder||r(215),n.lossless.FrameHeader=n.lossless.FrameHeader||r(59),n.lossless.HuffmanTable=n.lossless.HuffmanTable||r(55),n.lossless.QuantizationTable=n.lossless.QuantizationTable||r(56),n.lossless.ScanComponent=n.lossless.ScanComponent||r(58),n.lossless.ScanHeader=n.lossless.ScanHeader||r(57),n.lossless.Utils=n.lossless.Utils||r(17),"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";var n,i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||r(7),i.lossless.HuffmanTable=i.lossless.HuffmanTable||r(55),i.lossless.QuantizationTable=i.lossless.QuantizationTable||r(56),i.lossless.ScanHeader=i.lossless.ScanHeader||r(57),i.lossless.FrameHeader=i.lossless.FrameHeader||r(59),i.lossless.Utils=i.lossless.Utils||r(17),i.lossless.Decoder=i.lossless.Decoder||function(e,t){this.buffer=e,this.frame=new i.lossless.FrameHeader,this.huffTable=new i.lossless.HuffmanTable,this.quantTable=new i.lossless.QuantizationTable,this.scan=new i.lossless.ScanHeader,this.DU=i.lossless.Utils.createArray(10,4,64),this.HuffTab=i.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=i.lossless.Utils.createArray(10,1),this.dcTab=i.lossless.Utils.createArray(10,1),this.qTab=i.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,void 0!==t&&(this.numBytes=t)},i.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],i.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],i.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,i.lossless.Decoder.MSB=2147483648,i.lossless.Decoder.RESTART_MARKER_BEGIN=65488,i.lossless.Decoder.RESTART_MARKER_END=65495,i.lossless.Decoder.prototype.decompress=function(e,t,r){return this.decode(e,t,r).buffer},i.lossless.Decoder.prototype.decode=function(e,t,r,n){var a,o,s,l,u=0,c=[],h=[],d=[];if(void 0!==e&&(this.buffer=e),void 0!==n&&(this.numBytes=n),this.stream=new i.lossless.DataStream(this.buffer,t,r),this.buffer=null,this.xLoc=0,this.yLoc=0,65496!==(a=this.stream.get16()))throw new Error("Not a JPEG file");for(a=this.stream.get16();a>>4!=4092||65476===a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (decode)")}a=this.stream.get16()}if(a<65472||a>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),a=this.stream.get16();do{for(;65498!==a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}a=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,o=0;o<this.numComp;o+=1)s=this.scanComps[o].scanCompSel,this.qTab[o]=this.quantTables[this.components[s].quantTableSel],this.nBlock[o]=this.components[s].vSamp*this.components[s].hSamp,this.dcTab[o]=this.HuffTab[this.scanComps[o].dcTabSel][0],this.acTab[o]=this.HuffTab[this.scanComps[o].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,1==this.numBytes?this.outputData=new Uint8Array(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)):this.outputData=new Uint16Array(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),u+=1;;){for(h[0]=0,d[0]=0,o=0;o<10;o+=1)c[o]=1<<this.precision-1;if(0===this.restartInterval){for(a=this.decodeUnit(c,h,d);0===a&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(c),a=this.decodeUnit(c,h,d);break}for(l=0;l<this.restartInterval&&(this.restarting=0==l,a=this.decodeUnit(c,h,d),this.output(c),0===a);l+=1);if(0===a&&(0!==this.markerIndex?(a=65280|this.marker,this.markerIndex=0):a=this.stream.get16()),!(a>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&a<=i.lossless.Decoder.RESTART_MARKER_END))break}65500===a&&1===u&&(this.readNumber(),a=this.stream.get16())}while(65497!==a&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===u);return this.outputData},i.lossless.Decoder.prototype.decodeUnit=function(e,t,r){return 1==this.numComp?this.decodeSingle(e,t,r):3==this.numComp?this.decodeRGB(e,t,r):-1},i.lossless.Decoder.prototype.select1=function(e){return this.getPreviousX(e)},i.lossless.Decoder.prototype.select2=function(e){return this.getPreviousY(e)},i.lossless.Decoder.prototype.select3=function(e){return this.getPreviousXY(e)},i.lossless.Decoder.prototype.select4=function(e){return this.getPreviousX(e)+this.getPreviousY(e)-this.getPreviousXY(e)},i.lossless.Decoder.prototype.select5=function(e){return this.getPreviousX(e)+(this.getPreviousY(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select6=function(e){return this.getPreviousY(e)+(this.getPreviousX(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select7=function(e){return(this.getPreviousX(e)+this.getPreviousY(e))/2},i.lossless.Decoder.prototype.decodeRGB=function(e,t,r){var n,a,o,s,l,u,c,h;for(e[0]=this.selector(0),e[1]=this.selector(1),e[2]=this.selector(2),l=0;l<this.numComp;l+=1)for(s=this.qTab[l],a=this.acTab[l],o=this.dcTab[l],u=0;u<this.nBlock[l];u+=1){for(c=0;c<this.IDCT_Source.length;c+=1)this.IDCT_Source[c]=0;if((n=this.getHuffmanValue(o,t,r))>=65280)return n;for(e[l]=this.IDCT_Source[0]=e[l]+this.getn(r,n,t,r),this.IDCT_Source[0]*=s[0],h=1;h<64;h+=1){if((n=this.getHuffmanValue(a,t,r))>=65280)return n;if(h+=n>>4,0==(15&n)){if(n>>4==0)break}else this.IDCT_Source[i.lossless.Decoder.IDCT_P[h]]=this.getn(r,15&n,t,r)*s[h]}}return 0},i.lossless.Decoder.prototype.decodeSingle=function(e,t,r){var n,a,o,s;for(this.restarting?(this.restarting=!1,e[0]=1<<this.frame.precision-1):e[0]=this.selector(),a=0;a<this.nBlock[0];a+=1){if((n=this.getHuffmanValue(this.dcTab[0],t,r))>=65280)return n;if((s=(o=this.getn(e,n,t,r))>>8)>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&s<=i.lossless.Decoder.RESTART_MARKER_END)return s;e[0]+=o}return 0},i.lossless.Decoder.prototype.getHuffmanValue=function(e,t,r){var n,a;if(65535,r[0]<8?(t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a):r[0]-=8,0!=((n=e[t[0]>>r[0]])&i.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;t[0]&=65535>>16-r[0],t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a,n=e[256*(255&n)+(t[0]>>r[0])],r[0]+=8}if(r[0]+=8-(n>>8),r[0]<0)throw new Error("index="+r[0]+" temp="+t[0]+" code="+n+" in HuffmanValue()");return r[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(t[0]&=65535>>16-r[0],255&n)},i.lossless.Decoder.prototype.getn=function(e,t,r,n){var i,a;if(1,-1,65535,0===t)return 0;if(16===t)return e[0]>=0?-32768:32768;if(n[0]-=t,n[0]>=0){if(n[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;i=r[0]>>n[0],r[0]&=65535>>16-n[0]}else{if(r[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),r[0]|=a,n[0]+=8,n[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;r[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),r[0]|=a,n[0]+=8}if(n[0]<0)throw new Error("index="+n[0]+" in getn()");if(n[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;i=r[0]>>n[0],r[0]&=65535>>16-n[0]}return i<1<<t-1&&(i+=1+(-1<<t)),i},i.lossless.Decoder.prototype.getPreviousX=function(e){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,e):this.yLoc>0?this.getPreviousY(e):1<<this.frame.precision-1},i.lossless.Decoder.prototype.getPreviousXY=function(e){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,e):this.getPreviousY(e)},i.lossless.Decoder.prototype.getPreviousY=function(e){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,e):this.getPreviousX(e)},i.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},i.lossless.Decoder.prototype.outputSingle=function(e){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&e[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.outputRGB=function(e){var t=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(t,e[0],0),this.setter(t,e[1],1),this.setter(t,e[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.setValue8=function(e,t){this.outputData[e]=t},i.lossless.Decoder.prototype.getValue8=function(e){return this.outputData[e]},(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0])?(i.lossless.Decoder.prototype.setValue16=i.lossless.Decoder.prototype.setValue8,i.lossless.Decoder.prototype.getValue16=i.lossless.Decoder.prototype.getValue8):(i.lossless.Decoder.prototype.setValue16=function(e,t){this.outputData[e]=(255&t)<<8|t>>8&255},i.lossless.Decoder.prototype.getValue16=function(e){var t=this.outputData[e];return(255&t)<<8|t>>8&255}),i.lossless.Decoder.prototype.setValueRGB=function(e,t,r){this.outputData[3*e+r]=t},i.lossless.Decoder.prototype.getValueRGB=function(e,t){return this.outputData[3*e+t]},i.lossless.Decoder.prototype.readApp=function(){var e=0,t=this.stream.get16();for(e+=2;e<t;)this.stream.get8(),e+=1;return t},i.lossless.Decoder.prototype.readComment=function(){var e,t="",r=0;for(e=this.stream.get16(),r+=2;r<e;)t+=this.stream.get8(),r+=1;return t},i.lossless.Decoder.prototype.readNumber=function(){if(4!==this.stream.get16())throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()},"undefined"!==typeof e&&e.exports&&(e.exports=i.lossless.Decoder)},function(e,t){var r={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},n=function(){"use strict";var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function t(){}function n(e,t){for(var r,n,i=0,a=[],o=16;o>0&&!e[o-1];)o--;a.push({children:[],index:0});var s,l=a[0];for(r=0;r<o;r++){for(n=0;n<e[r];n++){for((l=a.pop()).children[l.index]=t[i];l.index>0;)l=a.pop();for(l.index++,a.push(l);a.length<=r;)a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s;i++}r+1<o&&(a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s)}return a[0].children}function i(e,t,r){return 64*((e.blocksPerLine+1)*t+r)}function a(t,r,n,a,o,s,l,u,c){n.precision,n.samplesPerLine,n.scanLines;var h=n.mcusPerLine,d=n.progressive,f=(n.maxH,n.maxV,r),p=0,m=0;function g(){if(m>0)return m--,p>>m&1;if(255==(p=t[r++])){var e=t[r++];if(e)throw"unexpected marker: "+(p<<8|e).toString(16)}return m=7,p>>>7}function v(e){for(var t,r=e;null!==(t=g());){if("number"==typeof(r=r[t]))return r;if("object"!=typeof r)throw"invalid huffman sequence"}return null}function y(e){for(var t=0;e>0;){var r=g();if(null===r)return;t=t<<1|r,e--}return t}function _(e){var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var b=0;var E,w=0;function x(e,t,r,n,a){var o=r%h;t(e,i(e,(r/h|0)*e.v+n,o*e.h+a))}function T(e,t,r){t(e,i(e,r/e.blocksPerLine|0,r%e.blocksPerLine))}var M,S,A,R,k,P,L=a.length;P=d?0===s?0===u?function(e,t){var r=v(e.huffmanTableDC),n=0===r?0:_(r)<<c;e.blockData[t]=e.pred+=n}:function(e,t){e.blockData[t]|=g()<<c}:0===u?function(t,r){if(b>0)b--;else for(var n=s,i=l;n<=i;){var a=v(t.huffmanTableAC),o=15&a,u=a>>4;if(0!==o){var h=e[n+=u];t.blockData[r+h]=_(o)*(1<<c),n++}else{if(u<15){b=y(u)+(1<<u)-1;break}n+=16}}}:function(t,r){for(var n=s,i=l,a=0;n<=i;){var o=e[n];switch(w){case 0:var u=v(t.huffmanTableAC),h=15&u;if(a=u>>4,0===h)a<15?(b=y(a)+(1<<a),w=4):(a=16,w=1);else{if(1!==h)throw"invalid ACn encoding";E=_(h),w=a?2:3}continue;case 1:case 2:t.blockData[r+o]?t.blockData[r+o]+=g()<<c:0===--a&&(w=2==w?3:0);break;case 3:t.blockData[r+o]?t.blockData[r+o]+=g()<<c:(t.blockData[r+o]=E<<c,w=0);break;case 4:t.blockData[r+o]&&(t.blockData[r+o]+=g()<<c)}n++}4===w&&0===--b&&(w=0)}:function(t,r){var n=v(t.huffmanTableDC),i=0===n?0:_(n);t.blockData[r]=t.pred+=i;for(var a=1;a<64;){var o=v(t.huffmanTableAC),s=15&o,l=o>>4;if(0!==s){var u=e[a+=l];t.blockData[r+u]=_(s),a++}else{if(l<15)break;a+=16}}};var C,I,H,O,D=0;for(I=1==L?a[0].blocksPerLine*a[0].blocksPerColumn:h*n.mcusPerColumn,o||(o=I);D<I;){for(S=0;S<L;S++)a[S].pred=0;if(b=0,1==L)for(M=a[0],k=0;k<o;k++)T(M,P,D),D++;else for(k=0;k<o;k++){for(S=0;S<L;S++)for(H=(M=a[S]).h,O=M.v,A=0;A<O;A++)for(R=0;R<H;R++)x(M,P,D,A,R);D++}if(m=0,(C=t[r]<<8|t[r+1])<=65280)throw"marker was not found";if(!(C>=65488&&C<=65495))break;r+=2}return r-f}function o(e,t,r){var n,i,a,o,s,l,u,c,h,d,f=e.quantizationTable;for(d=0;d<64;d++)r[d]=e.blockData[t+d]*f[d];for(d=0;d<8;++d){var p=8*d;0!==r[1+p]||0!==r[2+p]||0!==r[3+p]||0!==r[4+p]||0!==r[5+p]||0!==r[6+p]||0!==r[7+p]?(n=5793*r[0+p]+128>>8,i=5793*r[4+p]+128>>8,a=r[2+p],o=r[6+p],s=2896*(r[1+p]-r[7+p])+128>>8,c=2896*(r[1+p]+r[7+p])+128>>8,l=r[3+p]<<4,h=n-i+1>>1,n=n+i+1>>1,i=h,h=3784*a+1567*o+128>>8,a=1567*a-3784*o+128>>8,o=h,h=s-(u=r[5+p]<<4)+1>>1,s=s+u+1>>1,u=h,h=c+l+1>>1,l=c-l+1>>1,c=h,h=n-o+1>>1,n=n+o+1>>1,o=h,h=i-a+1>>1,i=i+a+1>>1,a=h,h=2276*s+3406*c+2048>>12,s=3406*s-2276*c+2048>>12,c=h,h=799*l+4017*u+2048>>12,l=4017*l-799*u+2048>>12,u=h,r[0+p]=n+c,r[7+p]=n-c,r[1+p]=i+u,r[6+p]=i-u,r[2+p]=a+l,r[5+p]=a-l,r[3+p]=o+s,r[4+p]=o-s):(h=5793*r[0+p]+512>>10,r[0+p]=h,r[1+p]=h,r[2+p]=h,r[3+p]=h,r[4+p]=h,r[5+p]=h,r[6+p]=h,r[7+p]=h)}for(d=0;d<8;++d){var m=d;0!==r[8+m]||0!==r[16+m]||0!==r[24+m]||0!==r[32+m]||0!==r[40+m]||0!==r[48+m]||0!==r[56+m]?(n=5793*r[0+m]+2048>>12,i=5793*r[32+m]+2048>>12,a=r[16+m],o=r[48+m],s=2896*(r[8+m]-r[56+m])+2048>>12,c=2896*(r[8+m]+r[56+m])+2048>>12,l=r[24+m],h=n-i+1>>1,n=n+i+1>>1,i=h,h=3784*a+1567*o+2048>>12,a=1567*a-3784*o+2048>>12,o=h,h=s-(u=r[40+m])+1>>1,s=s+u+1>>1,u=h,h=c+l+1>>1,l=c-l+1>>1,c=h,h=n-o+1>>1,n=n+o+1>>1,o=h,h=i-a+1>>1,i=i+a+1>>1,a=h,h=2276*s+3406*c+2048>>12,s=3406*s-2276*c+2048>>12,c=h,h=799*l+4017*u+2048>>12,l=4017*l-799*u+2048>>12,u=h,r[0+m]=n+c,r[56+m]=n-c,r[8+m]=i+u,r[48+m]=i-u,r[16+m]=a+l,r[40+m]=a-l,r[24+m]=o+s,r[32+m]=o-s):(h=5793*r[d+0]+8192>>14,r[0+m]=h,r[8+m]=h,r[16+m]=h,r[24+m]=h,r[32+m]=h,r[40+m]=h,r[48+m]=h,r[56+m]=h)}for(d=0;d<64;++d){var g=t+d,v=r[d];v=v<=-2056/e.bitConversion?0:v>=2024/e.bitConversion?255/e.bitConversion:v+2056/e.bitConversion>>4,e.blockData[g]=v}}function s(e,t){for(var r=t.blocksPerLine,n=t.blocksPerColumn,a=new Int32Array(64),s=0;s<n;s++)for(var l=0;l<r;l++){o(t,i(t,s,l),a)}return t.blockData}function l(e){return e<=0?0:e>=255?255:0|e}return t.prototype={load:function(e){var t=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(e.indexOf("data:")>-1){for(var r=e.indexOf("base64,")+7,n=atob(e.substring(r)),i=new Uint8Array(n.length),a=n.length-1;a>=0;a--)i[a]=n.charCodeAt(a);t(n)}else{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){var e=new Uint8Array(o.response);t(e)}.bind(this),o.send(null)}},parse:function(t){function i(){var e=t[h]<<8|t[h+1];return h+=2,e}function o(){var e=i(),r=t.subarray(h,h+e-2);return h+=r.length,r}function l(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),r=Math.ceil(e.scanLines/8/e.maxV),n=0;n<e.components.length;n++){W=e.components[n];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*W.h/e.maxH),a=Math.ceil(Math.ceil(e.scanLines/8)*W.v/e.maxV),o=t*W.h,s=64*(r*W.v)*(o+1);W.blockData=new Int16Array(s),W.blocksPerLine=i,W.blocksPerColumn=a}e.mcusPerLine=t,e.mcusPerColumn=r}var u,c,h=0,d=(t.length,null),f=null,p=[],m=[],g=[],v=i();if(65496!=v)throw"SOI not found";for(v=i();65497!=v;){var y,_;switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var b=o();65504===v&&74===b[0]&&70===b[1]&&73===b[2]&&70===b[3]&&0===b[4]&&(d={version:{major:b[5],minor:b[6]},densityUnits:b[7],xDensity:b[8]<<8|b[9],yDensity:b[10]<<8|b[11],thumbWidth:b[12],thumbHeight:b[13],thumbData:b.subarray(14,14+3*b[12]*b[13])}),65518===v&&65===b[0]&&100===b[1]&&111===b[2]&&98===b[3]&&101===b[4]&&0===b[5]&&(f={version:b[6],flags0:b[7]<<8|b[8],flags1:b[9]<<8|b[10],transformCode:b[11]});break;case 65499:for(var E=i()+h-2;h<E;){var w=t[h++],x=new Int32Array(64);if(w>>4==0)for(y=0;y<64;y++){x[e[y]]=t[h++]}else{if(w>>4!=1)throw"DQT: invalid table spec";for(y=0;y<64;y++){x[e[y]]=i()}}p[15&w]=x}break;case 65472:case 65473:case 65474:if(u)throw"Only single frame JPEGs supported";i(),(u={}).extended=65473===v,u.progressive=65474===v,u.precision=t[h++],u.scanLines=i(),u.samplesPerLine=i(),u.components=[],u.componentIds={};var T,M=t[h++],S=0,A=0;for(G=0;G<M;G++){T=t[h];var R=t[h+1]>>4,k=15&t[h+1];S<R&&(S=R),A<k&&(A=k);var P=t[h+2];_=u.components.push({h:R,v:k,quantizationTable:p[P],quantizationTableId:P,bitConversion:255/((1<<u.precision)-1)}),u.componentIds[T]=_-1,h+=3}u.maxH=S,u.maxV=A,l(u);break;case 65476:var L=i();for(G=2;G<L;){var C=t[h++],I=new Uint8Array(16),H=0;for(y=0;y<16;y++,h++)H+=I[y]=t[h];var O=new Uint8Array(H);for(y=0;y<H;y++,h++)O[y]=t[h];G+=17+H,(C>>4==0?g:m)[15&C]=n(I,O)}break;case 65501:i(),c=i();break;case 65498:i();var D=t[h++],F=[];for(G=0;G<D;G++){var N=u.componentIds[t[h++]];W=u.components[N];var U=t[h++];W.huffmanTableDC=g[U>>4],W.huffmanTableAC=m[15&U],F.push(W)}var B=t[h++],z=t[h++],j=t[h++],V=a(t,h,u,F,c,B,z,j>>4,15&j);h+=V;break;default:if(255==t[h-3]&&t[h-2]>=192&&t[h-2]<=254){h-=3;break}throw"unknown JPEG marker "+v.toString(16)}v=i()}switch(this.width=u.samplesPerLine,this.height=u.scanLines,this.jfif=d,this.adobe=f,this.components=[],u.components.length){case 1:this.colorspace=r.Grayscale;break;case 3:this.adobe?this.colorspace=r.AdobeRGB:this.colorspace=r.RGB;break;case 4:this.colorspace=r.CYMK;break;default:this.colorspace=r.Unknown}for(var G=0;G<u.components.length;G++){var W;(W=u.components[G]).quantizationTable||null===W.quantizationTableId||(W.quantizationTable=p[W.quantizationTableId]),this.components.push({output:s(0,W),scaleX:W.h/u.maxH,scaleY:W.v/u.maxV,blocksPerLine:W.blocksPerLine,blocksPerColumn:W.blocksPerColumn,bitConversion:W.bitConversion})}},getData16:function(e,t){if(1!==this.components.length)throw"Unsupported color mode";var r,n,a,o,s,l,u=this.width/e,c=this.height/t,h=0,d=this.components.length,f=new Uint16Array(e*t*d),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(l=0;l<d;l++){for(var m,g,v,y=(r=this.components[l]).blocksPerLine,_=r.blocksPerColumn,b=y<<3,E=0,w=0;w<_;w++)for(var x=w<<3,T=0;T<y;T++){var M=i(r,w,T),S=(h=0,T<<3);for(m=0;m<8;m++){E=(x+m)*b;for(g=0;g<8;g++)p[E+S+g]=r.output[M+h++]}}for(n=r.scaleX*u,a=r.scaleY*c,h=l,s=0;s<t;s++)for(o=0;o<e;o++)v=(0|s*a)*b+(0|o*n),f[h]=p[v],h+=d}return f},getData:function(e,t){var r,n,a,o,s,u,c,h,d,f,p,m,g,v,y,_=this.width/e,b=this.height/t,E=0,w=this.components.length,x=e*t*w,T=new Uint8Array(x),M=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(u=0;u<w;u++){for(var S,A,R,k=(r=this.components[u]).blocksPerLine,P=r.blocksPerColumn,L=k<<3,C=0,I=0;I<P;I++)for(var H=I<<3,O=0;O<k;O++){var D=i(r,I,O),F=(E=0,O<<3);for(S=0;S<8;S++){C=(H+S)*L;for(A=0;A<8;A++)M[C+F+A]=r.output[D+E++]*r.bitConversion}}for(n=r.scaleX*_,a=r.scaleY*b,E=u,s=0;s<t;s++)for(o=0;o<e;o++)R=(0|s*a)*L+(0|o*n),T[E]=M[R],E+=w}switch(w){case 1:case 2:break;case 3:if(y=!0,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(u=0;u<x;u+=w)c=T[u],h=T[u+1],m=l(c-179.456+1.402*(d=T[u+2])),g=l(c+135.459-.344*h-.714*d),v=l(c-226.816+1.772*h),T[u]=m,T[u+1]=g,T[u+2]=v;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(y=!1,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(u=0;u<x;u+=w)c=T[u],h=T[u+1],f=l(434.456-c-1.402*(d=T[u+2])),p=l(119.541-c+.344*h+.714*d),c=l(481.816-c-1.772*h),T[u]=f,T[u+1]=p,T[u+2]=c;break;default:throw"Unsupported color mode"}return T}},t}();"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";var n=function(){var e={LL:0,LH:1,HL:1,HH:2};function t(){this.failOnCorruptedImage=!1}function r(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function n(e,t){for(var r,n=e.SIZ,i=[],a=Math.ceil((n.Xsiz-n.XTOsiz)/n.XTsiz),o=Math.ceil((n.Ysiz-n.YTOsiz)/n.YTsiz),s=0;s<o;s++)for(var l=0;l<a;l++)(r={}).tx0=Math.max(n.XTOsiz+l*n.XTsiz,n.XOsiz),r.ty0=Math.max(n.YTOsiz+s*n.YTsiz,n.YOsiz),r.tx1=Math.min(n.XTOsiz+(l+1)*n.XTsiz,n.Xsiz),r.ty1=Math.min(n.YTOsiz+(s+1)*n.YTsiz,n.Ysiz),r.width=r.tx1-r.tx0,r.height=r.ty1-r.ty0,r.components=[],i.push(r);e.tiles=i;for(var u=0,c=n.Csiz;u<c;u++)for(var h=t[u],d=0,f=i.length;d<f;d++){var p={};r=i[d],p.tcx0=Math.ceil(r.tx0/h.XRsiz),p.tcy0=Math.ceil(r.ty0/h.YRsiz),p.tcx1=Math.ceil(r.tx1/h.XRsiz),p.tcy1=Math.ceil(r.ty1/h.YRsiz),p.width=p.tcx1-p.tcx0,p.height=p.tcy1-p.tcy0,r.components[u]=p}}function a(e,t,r){var n=t.codingStyleParameters,i={};return n.entropyCoderWithCustomPrecincts?(i.PPx=n.precinctsSizes[r].PPx,i.PPy=n.precinctsSizes[r].PPy):(i.PPx=15,i.PPy=15),i.xcb_=r>0?Math.min(n.xcb,i.PPx-1):Math.min(n.xcb,i.PPx),i.ycb_=r>0?Math.min(n.ycb,i.PPy-1):Math.min(n.ycb,i.PPy),i}function l(e,t,r){var n=1<<r.PPx,i=1<<r.PPy,a=0===t.resLevel,o=1<<r.PPx+(a?0:-1),s=1<<r.PPy+(a?0:-1),l=t.trx1>t.trx0?Math.ceil(t.trx1/n)-Math.floor(t.trx0/n):0,u=t.try1>t.try0?Math.ceil(t.try1/i)-Math.floor(t.try0/i):0,c=l*u;t.precinctParameters={precinctWidth:n,precinctHeight:i,numprecinctswide:l,numprecinctshigh:u,numprecincts:c,precinctWidthInSubband:o,precinctHeightInSubband:s}}function u(e,t,r){var n,i,a,o,s=r.xcb_,l=r.ycb_,u=1<<s,c=1<<l,h=t.tbx0>>s,d=t.tby0>>l,f=t.tbx1+u-1>>s,p=t.tby1+c-1>>l,m=t.resolution.precinctParameters,g=[],v=[];for(i=d;i<p;i++)for(n=h;n<f;n++){if((a={cbx:n,cby:i,tbx0:u*n,tby0:c*i,tbx1:u*(n+1),tby1:c*(i+1)}).tbx0_=Math.max(t.tbx0,a.tbx0),a.tby0_=Math.max(t.tby0,a.tby0),a.tbx1_=Math.min(t.tbx1,a.tbx1),a.tby1_=Math.min(t.tby1,a.tby1),o=Math.floor((a.tbx0_-t.tbx0)/m.precinctWidthInSubband)+Math.floor((a.tby0_-t.tby0)/m.precinctHeightInSubband)*m.numprecinctswide,a.precinctNumber=o,a.subbandType=t.type,a.Lblock=3,!(a.tbx1_<=a.tbx0_||a.tby1_<=a.tby0_)){g.push(a);var y=v[o];void 0!==y?(n<y.cbxMin?y.cbxMin=n:n>y.cbxMax&&(y.cbxMax=n),i<y.cbyMin?y.cbxMin=i:i>y.cbyMax&&(y.cbyMax=i)):v[o]=y={cbxMin:n,cbyMin:i,cbxMax:n,cbyMax:i},a.precinct=y}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:l,numcodeblockwide:f-h+1,numcodeblockhigh:p-d+1},t.codeblocks=g,t.precincts=v}function c(e,t,r){for(var n=[],i=e.subbands,a=0,o=i.length;a<o;a++)for(var s=i[a].codeblocks,l=0,u=s.length;l<u;l++){var c=s[l];c.precinctNumber===t&&n.push(c)}return{layerNumber:r,codeblocks:n}}function h(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;s<a;s++)o=Math.max(o,n.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,u=0,h=0,d=0;this.nextPacket=function(){for(;l<i;l++){for(;u<=o;u++){for(;h<a;h++){var e=n.components[h];if(!(u>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[u],r=t.precinctParameters.numprecincts;d<r;){var s=c(t,d,l);return d++,s}d=0}}h=0}u=0}}}function d(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;s<a;s++)o=Math.max(o,n.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,u=0,h=0,d=0;this.nextPacket=function(){for(;l<=o;l++){for(;u<i;u++){for(;h<a;h++){var e=n.components[h];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],r=t.precinctParameters.numprecincts;d<r;){var s=c(t,d,u);return d++,s}d=0}}h=0}u=0}}}function f(e){var t,r,n,i,a=e.SIZ,o=e.currentTile.index,s=e.tiles[o],l=s.codingStyleDefaultParameters.layersCount,u=a.Csiz,h=0;for(n=0;n<u;n++){var d=s.components[n];h=Math.max(h,d.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(h+1);for(r=0;r<=h;++r){var p=0;for(n=0;n<u;++n){var m=s.components[n].resolutions;r<m.length&&(p=Math.max(p,m[r].precinctParameters.numprecincts))}f[r]=p}t=0,r=0,n=0,i=0,this.nextPacket=function(){for(;r<=h;r++){for(;i<f[r];i++){for(;n<u;n++){var e=s.components[n];if(!(r>e.codingStyleParameters.decompositionLevelsCount)){var a=e.resolutions[r],o=a.precinctParameters.numprecincts;if(!(i>=o)){for(;t<l;){var d=c(a,i,t);return t++,d}t=0}}}n=0}i=0}}}function p(e){var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(n),s=o,l=0,u=0,h=0,d=0,f=0;this.nextPacket=function(){for(;f<s.maxNumHigh;f++){for(;d<s.maxNumWide;d++){for(;h<a;h++){for(var e=n.components[h],t=e.codingStyleParameters.decompositionLevelsCount;u<=t;u++){var r=e.resolutions[u],p=o.components[h].resolutions[u],m=_(d,f,p,s,r);if(null!==m){for(;l<i;){var g=c(r,m,l);return l++,g}l=0}}u=0}h=0}d=0}}}function y(e){var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=n.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(n),s=0,l=0,u=0,h=0,d=0;this.nextPacket=function(){for(;u<a;++u){for(var e=n.components[u],t=o.components[u],r=e.codingStyleParameters.decompositionLevelsCount;d<t.maxNumHigh;d++){for(;h<t.maxNumWide;h++){for(;l<=r;l++){var f=e.resolutions[l],p=t.resolutions[l],m=_(h,d,p,t,f);if(null!==m){for(;s<i;){var g=c(f,m,s);return s++,g}s=0}}l=0}h=0}d=0}}}function _(e,t,r,n,i){var a=e*n.minWidth,o=t*n.minHeight;if(a%r.width!=0||o%r.height!=0)return null;var s=o/r.width*i.precinctParameters.numprecinctswide;return a/r.height+s}function b(e){for(var t=e.components.length,r=Number.MAX_VALUE,n=Number.MAX_VALUE,i=0,a=0,o=new Array(t),s=0;s<t;s++){for(var l=e.components[s],u=l.codingStyleParameters.decompositionLevelsCount,c=new Array(u+1),h=Number.MAX_VALUE,d=Number.MAX_VALUE,f=0,p=0,m=1,g=u;g>=0;--g){var v=l.resolutions[g],y=m*v.precinctParameters.precinctWidth,_=m*v.precinctParameters.precinctHeight;h=Math.min(h,y),d=Math.min(d,_),f=Math.max(f,v.precinctParameters.numprecinctswide),p=Math.max(p,v.precinctParameters.numprecinctshigh),c[g]={width:y,height:_},m<<=1}r=Math.min(r,h),n=Math.min(n,d),i=Math.max(i,f),a=Math.max(a,p),o[s]={resolutions:c,minWidth:h,minHeight:d,maxNumWide:f,maxNumHigh:p}}return{components:o,minWidth:r,minHeight:n,maxNumWide:i,maxNumHigh:a}}function E(e){for(var t=e.SIZ,r=e.currentTile.index,n=e.tiles[r],i=t.Csiz,o=0;o<i;o++){for(var s=n.components[o],c=s.codingStyleParameters.decompositionLevelsCount,m=[],g=[],v=0;v<=c;v++){var _,b=a(0,s,v),E={},w=1<<c-v;if(E.trx0=Math.ceil(s.tcx0/w),E.try0=Math.ceil(s.tcy0/w),E.trx1=Math.ceil(s.tcx1/w),E.try1=Math.ceil(s.tcy1/w),E.resLevel=v,l(0,E,b),m.push(E),0===v)(_={}).type="LL",_.tbx0=Math.ceil(s.tcx0/w),_.tby0=Math.ceil(s.tcy0/w),_.tbx1=Math.ceil(s.tcx1/w),_.tby1=Math.ceil(s.tcy1/w),_.resolution=E,u(0,_,b),g.push(_),E.subbands=[_];else{var x=1<<c-v+1,T=[];(_={}).type="HL",_.tbx0=Math.ceil(s.tcx0/x-.5),_.tby0=Math.ceil(s.tcy0/x),_.tbx1=Math.ceil(s.tcx1/x-.5),_.tby1=Math.ceil(s.tcy1/x),_.resolution=E,u(0,_,b),g.push(_),T.push(_),(_={}).type="LH",_.tbx0=Math.ceil(s.tcx0/x),_.tby0=Math.ceil(s.tcy0/x-.5),_.tbx1=Math.ceil(s.tcx1/x),_.tby1=Math.ceil(s.tcy1/x-.5),_.resolution=E,u(0,_,b),g.push(_),T.push(_),(_={}).type="HH",_.tbx0=Math.ceil(s.tcx0/x-.5),_.tby0=Math.ceil(s.tcy0/x-.5),_.tbx1=Math.ceil(s.tcx1/x-.5),_.tby1=Math.ceil(s.tcy1/x-.5),_.resolution=E,u(0,_,b),g.push(_),T.push(_),E.subbands=T}}s.resolutions=m,s.subbands=g}var M=n.codingStyleDefaultParameters.progressionOrder;switch(M){case 0:n.packetsIterator=new h(e);break;case 1:n.packetsIterator=new d(e);break;case 2:n.packetsIterator=new f(e);break;case 3:n.packetsIterator=new p(e);break;case 4:n.packetsIterator=new y(e);break;default:throw new Error("JPX Error: Unsupported progression order "+M)}}function w(e,t,r,n){var i,a=0,o=0,s=!1;function l(e){for(;o<e;){if(r+a>=t.length)throw new Error("Unexpected EOF");var n=t[r+a];a++,s?(i=i<<7|n,o+=7,s=!1):(i=i<<8|n,o+=8),255===n&&(s=!0)}return i>>>(o-=e)&(1<<e)-1}function u(e){return 255===t[r+a-1]&&t[r+a]===e?(c(1),!0):255===t[r+a]&&t[r+a+1]===e&&(c(2),!0)}function c(e){a+=e}function h(){o=0,s&&(a++,s=!1)}function d(){if(0===l(1))return 1;if(0===l(1))return 2;var e=l(2);return e<3?e+3:(e=l(5))<31?e+6:(e=l(7))+37}for(var f=e.currentTile.index,p=e.tiles[f],g=e.COD.sopMarkerUsed,v=e.COD.ephMarkerUsed,y=p.packetsIterator;a<n;)try{h(),g&&u(145)&&c(4);var _=y.nextPacket();if(void 0===_)return;if(!l(1))continue;for(var b,E=_.layerNumber,w=[],x=0,T=_.codeblocks.length;x<T;x++){var M=(b=_.codeblocks[x]).precinct,R=b.cbx-M.cbxMin,k=b.cby-M.cbyMin,P=!1,L=!1;if(void 0!==b.included)P=!!l(1);else{var C,I;if(void 0!==(M=b.precinct).inclusionTree)C=M.inclusionTree;else{var H=M.cbxMax-M.cbxMin+1,O=M.cbyMax-M.cbyMin+1;C=new A(H,O),I=new S(H,O),M.inclusionTree=C,M.zeroBitPlanesTree=I}for(C.reset(R,k,E);;){if(a>=t.length)return;if(C.isAboveThreshold())break;if(C.isKnown())C.nextLevel();else if(l(1)){if(C.setKnown(),C.isLeaf()){b.included=!0,P=L=!0;break}C.nextLevel()}else C.incrementValue()}}if(P){if(L){for((I=M.zeroBitPlanesTree).reset(R,k);;){if(a>=t.length)return;if(l(1)){if(!I.nextLevel())break}else I.incrementValue()}b.zeroBitPlanes=I.value}for(var D=d();l(1);)b.Lblock++;var F=m(D),N=l((D<1<<F?F-1:F)+b.Lblock);w.push({codeblock:b,codingpasses:D,dataLength:N})}}for(h(),v&&u(146);w.length>0;){var U=w.shift();void 0===(b=U.codeblock).data&&(b.data=[]),b.data.push({data:t,start:r+a,end:r+a+U.dataLength,codingpasses:U.codingpasses}),a+=U.dataLength}}catch(e){return}return a}function x(e,t,r,n,a,o,s,l){for(var u=n.tbx0,c=n.tby0,h=n.tbx1-n.tbx0,d=n.codeblocks,f="H"===n.type.charAt(0)?1:0,p="H"===n.type.charAt(1)?t:0,m=0,g=d.length;m<g;++m){var v=d[m],y=v.tbx1_-v.tbx0_,_=v.tby1_-v.tby0_;if(0!==y&&0!==_&&void 0!==v.data){var b,E;b=new R(y,_,v.subbandType,v.zeroBitPlanes,o),E=2;var w,x,T,M=v.data,S=0,A=0;for(w=0,x=M.length;w<x;w++)S+=(T=M[w]).end-T.start,A+=T.codingpasses;var k=new Int16Array(S),P=0;for(w=0,x=M.length;w<x;w++){var L=(T=M[w]).data.subarray(T.start,T.end);k.set(L,P),P+=L.length}var C=new i(k,0,S);for(b.setDecoder(C),w=0;w<A;w++){switch(E){case 0:b.runSignificancePropogationPass();break;case 1:b.runMagnitudeRefinementPass();break;case 2:b.runCleanupPass(),l&&b.checkSegmentationSymbol()}E=(E+1)%3}var I,H,O,D=v.tbx0_-u+(v.tby0_-c)*h,F=b.coefficentsSign,N=b.coefficentsMagnitude,U=b.bitsDecoded,B=s?0:.5;P=0;var z="LL"!==n.type;for(w=0;w<_;w++){var j=2*(D/h|0)*(t-h)+f+p;for(I=0;I<y;I++){if(0!==(H=N[P])){H=(H+B)*a,0!==F[P]&&(H=-H),O=U[P];var V=z?j+(D<<1):D;e[V]=s&&O>=o?H:H*(1<<o-O)}D++,P++}D+=h-y}}}}function T(t,r,n){for(var i=r.components[n],a=i.codingStyleParameters,o=i.quantizationParameters,s=a.decompositionLevelsCount,l=o.SPqcds,u=o.scalarExpounded,c=o.guardBits,h=a.segmentationSymbolUsed,d=t.components[n].precision,f=a.reversibleTransformation,p=f?new L:new P,m=[],g=0,v=0;v<=s;v++){for(var y=i.resolutions[v],_=y.trx1-y.trx0,b=y.try1-y.try0,E=new Float32Array(_*b),w=0,T=y.subbands.length;w<T;w++){var M,S;u?(M=l[g].mu,S=l[g].epsilon,g++):(M=l[0].mu,S=l[0].epsilon+(v>0?1-v:0));var A=y.subbands[w],R=e[A.type];x(E,_,0,A,f?1:Math.pow(2,d+R-S)*(1+M/2048),c+S-1,f,h)}m.push({width:_,height:b,items:E})}var k=p.calculate(m,i.tcx0,i.tcy0);return{left:i.tcx0,top:i.tcy0,width:k.width,height:k.height,items:k.items}}function M(e,t){for(var r=e.SIZ.Csiz,n=e.tiles[t],i=0;i<r;i++){var a=n.components[i],o=void 0!==e.currentTile.QCC[i]?e.currentTile.QCC[i]:e.currentTile.QCD;a.quantizationParameters=o;var s=void 0!==e.currentTile.COC[i]?e.currentTile.COC[i]:e.currentTile.COD;a.codingStyleParameters=s}n.codingStyleDefaultParameters=e.currentTile.COD}t.prototype={parse:function(e){if(65359!==g(e,0))for(var t=0,r=e.length;t<r;){var n=8,i=v(e,t),a=v(e,t+4);if(t+=n,1===i&&(i=4294967296*v(e,t)+v(e,t+4),t+=8,n+=8),0===i&&(i=r-t+n),i<n)throw new Error("JPX Error: Invalid box field size");var l=i-n,u=!0;switch(a){case 1785737832:u=!1;break;case 1668246642:var c=e[t];e[t+1],e[t+2];if(1===c){var h=v(e,t+3);switch(h){case 16:case 17:case 18:break;default:s("Unknown colorspace "+h)}}else 2===c&&o("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,t,t+l);break;case 1783636e3:218793738!==v(e,t)&&s("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:s("Unsupported header type "+a+" ("+String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)+")")}u&&(t+=l)}else this.parseCodestream(e,0,e.length)},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){if(65361===(t<<8|(t=e.getByte()))){e.skip(4);var r=e.getInt32()>>>0,n=e.getInt32()>>>0,i=e.getInt32()>>>0,a=e.getInt32()>>>0;e.skip(16);var o=e.getUint16();return this.width=r-i,this.height=n-a,this.componentsCount=o,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,t,i){var a={};try{for(var o=!1,l=t;l+1<i;){var u=g(e,l);l+=2;var c,h,d,f,p,m,y=0;switch(u){case 65359:a.mainHeader=!0;break;case 65497:break;case 65361:y=g(e,l);var _={};_.Xsiz=v(e,l+4),_.Ysiz=v(e,l+8),_.XOsiz=v(e,l+12),_.YOsiz=v(e,l+16),_.XTsiz=v(e,l+20),_.YTsiz=v(e,l+24),_.XTOsiz=v(e,l+28),_.YTOsiz=v(e,l+32);var b=g(e,l+36);_.Csiz=b;var x=[];c=l+38;for(var S=0;S<b;S++){var A={precision:1+(127&e[c]),isSigned:!!(128&e[c]),XRsiz:e[c+1],YRsiz:e[c+1]};r(A,_),x.push(A)}a.SIZ=_,a.components=x,n(a,x),a.QCC=[],a.COC=[];break;case 65372:y=g(e,l);var R={};switch(c=l+2,31&(h=e[c++])){case 0:f=8,p=!0;break;case 1:f=16,p=!1;break;case 2:f=16,p=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(R.noQuantization=8===f,R.scalarExpounded=p,R.guardBits=h>>5,d=[];c<y+l;){var k={};8===f?(k.epsilon=e[c++]>>3,k.mu=0):(k.epsilon=e[c]>>3,k.mu=(7&e[c])<<8|e[c+1],c+=2),d.push(k)}R.SPqcds=d,a.mainHeader?a.QCD=R:(a.currentTile.QCD=R,a.currentTile.QCC=[]);break;case 65373:y=g(e,l);var P,L={};switch(c=l+2,a.SIZ.Csiz<257?P=e[c++]:(P=g(e,c),c+=2),31&(h=e[c++])){case 0:f=8,p=!0;break;case 1:f=16,p=!1;break;case 2:f=16,p=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(L.noQuantization=8===f,L.scalarExpounded=p,L.guardBits=h>>5,d=[];c<y+l;)k={},8===f?(k.epsilon=e[c++]>>3,k.mu=0):(k.epsilon=e[c]>>3,k.mu=(7&e[c])<<8|e[c+1],c+=2),d.push(k);L.SPqcds=d,a.mainHeader?a.QCC[P]=L:a.currentTile.QCC[P]=L;break;case 65362:y=g(e,l);var C={};c=l+2;var I=e[c++];C.entropyCoderWithCustomPrecincts=!!(1&I),C.sopMarkerUsed=!!(2&I),C.ephMarkerUsed=!!(4&I),C.progressionOrder=e[c++],C.layersCount=g(e,c),c+=2,C.multipleComponentTransform=e[c++],C.decompositionLevelsCount=e[c++],C.xcb=2+(15&e[c++]),C.ycb=2+(15&e[c++]);var H=e[c++];if(C.selectiveArithmeticCodingBypass=!!(1&H),C.resetContextProbabilities=!!(2&H),C.terminationOnEachCodingPass=!!(4&H),C.verticalyStripe=!!(8&H),C.predictableTermination=!!(16&H),C.segmentationSymbolUsed=!!(32&H),C.reversibleTransformation=e[c++],C.entropyCoderWithCustomPrecincts){for(var O=[];c<y+l;){var D=e[c++];O.push({PPx:15&D,PPy:D>>4})}C.precinctsSizes=O}var F=[];if(C.selectiveArithmeticCodingBypass&&F.push("selectiveArithmeticCodingBypass"),C.resetContextProbabilities&&F.push("resetContextProbabilities"),C.terminationOnEachCodingPass&&F.push("terminationOnEachCodingPass"),C.verticalyStripe&&F.push("verticalyStripe"),C.predictableTermination&&F.push("predictableTermination"),F.length>0)throw o=!0,new Error("JPX Error: Unsupported COD options ("+F.join(", ")+")");a.mainHeader?a.COD=C:(a.currentTile.COD=C,a.currentTile.COC=[]);break;case 65424:y=g(e,l),(m={}).index=g(e,l+2),m.length=v(e,l+4),m.dataEnd=m.length+l-2,m.partIndex=e[l+8],m.partsCount=e[l+9],a.mainHeader=!1,0===m.partIndex&&(m.COD=a.COD,m.COC=a.COC.slice(0),m.QCD=a.QCD,m.QCC=a.QCC.slice(0)),a.currentTile=m;break;case 65427:0===(m=a.currentTile).partIndex&&(M(a,m.index),E(a)),w(a,e,l,y=m.dataEnd-l);break;case 65365:case 65367:case 65368:case 65380:y=g(e,l);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+u.toString(16))}l+=y}}catch(e){if(o||this.failOnCorruptedImage)throw e;s("Trying to recover from "+e.message)}this.tiles=function(e){for(var t=e.SIZ,r=e.components,n=t.Csiz,i=[],a=0,o=e.tiles.length;a<o;a++){var s,l=e.tiles[a],u=[];for(s=0;s<n;s++)u[s]=T(e,l,s);var c=u[0];if(N=r[0].isSigned)var h=new Int16Array(c.items.length*n);else h=new Uint16Array(c.items.length*n);var d,f,p,m,g,v,y,_,b,E,w,x,M,S,A,R={left:c.left,top:c.top,width:c.width,height:c.height,items:h},k=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var P=4===n,L=u[0].items,C=u[1].items,I=u[2].items,H=P?u[3].items:null;d=r[0].precision-8,f=.5+(128<<d),m=-(g=.5*(p=255*(1<<d)));var O=l.components[0],D=n-3;if(y=L.length,O.codingStyleParameters.reversibleTransformation)for(v=0;v<y;v++,k+=D)_=L[v]+f,b=C[v],E=I[v],w=(x=_-(E+b>>2))+E,M=x+b,h[k++]=w<=0?0:w>=p?255:w>>d,h[k++]=x<=0?0:x>=p?255:x>>d,h[k++]=M<=0?0:M>=p?255:M>>d;else for(v=0;v<y;v++,k+=D)_=L[v]+f,b=C[v],E=I[v],w=_+1.402*E,x=_-.34413*b-.71414*E,M=_+1.772*b,h[k++]=w<=0?0:w>=p?255:w>>d,h[k++]=x<=0?0:x>=p?255:x>>d,h[k++]=M<=0?0:M>=p?255:M>>d;if(P)for(v=0,k=3;v<y;v++,k+=4)S=H[v],h[k]=S<=m?0:S>=g?255:S+f>>d}else for(s=0;s<n;s++)if(8===r[s].precision){var F=u[s].items;for(d=r[s].precision-8,f=.5+(128<<d),m=-(p=127.5*(1<<d)),k=s,v=0,y=F.length;v<y;v++)A=F[v],h[k]=A<=m?0:A>=p?255:A+f>>d,k+=n}else{var N=r[s].isSigned;F=u[s].items;if(N)for(k=s,v=0,y=F.length;v<y;v++)h[k]=F[v],k+=n;else{d=r[s].precision-8,f=.5+(128<<d);var U=Math.pow(2,r[s].precision)-1;for(k=s,v=0,y=F.length;v<y;v++)A=F[v],h[k]=Math.max(Math.min(A+f,U),0),k+=n}}i.push(R)}return i}(a),this.width=a.SIZ.Xsiz-a.SIZ.XOsiz,this.height=a.SIZ.Ysiz-a.SIZ.YOsiz,this.componentsCount=a.SIZ.Csiz}};var S=function(){function e(e,t){var r=m(Math.max(e,t))+1;this.levels=[];for(var n=0;n<r;n++){var i={width:e,height:t,items:[]};this.levels.push(i),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t){for(var r,n=0,i=0;n<this.levels.length;){var a=e+t*(r=this.levels[n]).width;if(void 0!==r.items[a]){i=r.items[a];break}r.index=a,e>>=1,t>>=1,n++}n--,(r=this.levels[n]).items[r.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];return--e<0?(this.value=r,!1):(this.currentLevel=e,(t=this.levels[e]).items[t.index]=r,!0)}},e}(),A=function(){function e(e,t){var r=m(Math.max(e,t))+1;this.levels=[];for(var n=0;n<r;n++){for(var i=new Uint8Array(e*t),a=new Uint8Array(e*t),o=0,s=i.length;o<s;o++)i[o]=0,a[o]=0;var l={width:e,height:t,items:i,status:a};this.levels.push(l),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t,r){this.currentStopValue=r;for(var n=0;n<this.levels.length;){var i=this.levels[n],a=e+t*i.width;i.index=a,e>>=1,t>>=1,n++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var e=this.currentLevel;if(--e<0)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var e=this.currentLevel,t=this.levels[e];return t.items[t.index]>this.currentStopValue},isKnown:function(){var e=this.currentLevel,t=this.levels[e];return t.status[t.index]>0},setKnown:function(){var e=this.currentLevel,t=this.levels[e];t.status[t.index]=1}},e}(),R=function(){var e=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),t=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),r=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);function n(n,i,a,o,s){this.width=n,this.height=i,this.contextLabelTable="HH"===a?r:"HL"===a?t:e;var l=n*i;this.neighborsSignificance=new Uint8Array(l),this.coefficentsSign=new Uint8Array(l),this.coefficentsMagnitude=s>14?new Uint32Array(l):s>6?new Uint16Array(l):new Uint8Array(l),this.processingFlags=new Uint8Array(l);var u=new Uint8Array(l);if(0!==o)for(var c=0;c<l;c++)u[c]=o;this.bitsDecoded=u,this.reset()}return n.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[17]=92,this.contexts[18]=6},setNeighborsSignificance:function(e,t,r){var n,i=this.neighborsSignificance,a=this.width,o=this.height,s=t>0,l=t+1<a;e>0&&(n=r-a,s&&(i[n-1]+=16),l&&(i[n+1]+=16),i[n]+=4),e+1<o&&(n=r+a,s&&(i[n-1]+=16),l&&(i[n+1]+=16),i[n]+=4),s&&(i[r-1]+=1),l&&(i[r+1]+=1),i[r]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,r=this.height,n=this.coefficentsMagnitude,i=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,s=this.contexts,l=this.contextLabelTable,u=this.bitsDecoded,c=0;c<r;c+=4)for(var h=0;h<t;h++)for(var d=c*t+h,f=0;f<4;f++,d+=t){var p=c+f;if(p>=r)break;if(o[d]&=-2,!n[d]&&a[d]){var m=l[a[d]];if(e.readBit(s,m)){var g=this.decodeSignBit(p,h,d);i[d]=g,n[d]=1,this.setNeighborsSignificance(p,h,d),o[d]|=2}u[d]++,o[d]|=1}}},decodeSignBit:function(e,t,r){var n,i,a,o,s,l,u=this.width,c=this.height,h=this.coefficentsMagnitude,d=this.coefficentsSign;o=t>0&&0!==h[r-1],t+1<u&&0!==h[r+1]?(a=d[r+1],n=o?1-a-(i=d[r-1]):1-a-a):n=o?1-(i=d[r-1])-i:0;var f=3*n;return o=e>0&&0!==h[r-u],e+1<c&&0!==h[r+u]?(a=d[r+u],n=o?1-a-(i=d[r-u])+f:1-a-a+f):n=o?1-(i=d[r-u])-i+f:f,n>=0?(s=9+n,l=this.decoder.readBit(this.contexts,s)):(s=9-n,l=1^this.decoder.readBit(this.contexts,s)),l},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,r=this.width,n=this.height,i=this.coefficentsMagnitude,a=this.neighborsSignificance,o=this.contexts,s=this.bitsDecoded,l=this.processingFlags,u=r*n,c=4*r,h=0;h<u;h=e){e=Math.min(u,h+c);for(var d=0;d<r;d++)for(var f=h+d;f<e;f+=r)if(i[f]&&0==(1&l[f])){var p=16;if(0!=(2&l[f]))l[f]^=2,p=0===(127&a[f])?15:14;var m=t.readBit(o,p);i[f]=i[f]<<1|m,s[f]++,l[f]|=1}}},runCleanupPass:function(){for(var e,t=this.decoder,r=this.width,n=this.height,i=this.neighborsSignificance,a=this.coefficentsMagnitude,o=this.coefficentsSign,s=this.contexts,l=this.contextLabelTable,u=this.bitsDecoded,c=this.processingFlags,h=r,d=2*r,f=3*r,p=0;p<n;p=e){e=Math.min(p+4,n);for(var m=p*r,g=p+3<n,v=0;v<r;v++){var y,_=m+v,b=0,E=_,w=p;if(g&&0===c[_]&&0===c[_+h]&&0===c[_+d]&&0===c[_+f]&&0===i[_]&&0===i[_+h]&&0===i[_+d]&&0===i[_+f]){if(!t.readBit(s,18)){u[_]++,u[_+h]++,u[_+d]++,u[_+f]++;continue}0!==(b=t.readBit(s,17)<<1|t.readBit(s,17))&&(w=p+b,E+=b*r),y=this.decodeSignBit(w,v,E),o[E]=y,a[E]=1,this.setNeighborsSignificance(w,v,E),c[E]|=2,E=_;for(var x=p;x<=w;x++,E+=r)u[E]++;b++}for(w=p+b;w<e;w++,E+=r)if(!a[E]&&0==(1&c[E])){var T=l[i[E]];1===t.readBit(s,T)&&(y=this.decodeSignBit(w,v,E),o[E]=y,a[E]=1,this.setNeighborsSignificance(w,v,E),c[E]|=2),u[E]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,t=this.contexts;if(10!==(e.readBit(t,17)<<3|e.readBit(t,17)<<2|e.readBit(t,17)<<1|e.readBit(t,17)))throw new Error("JPX Error: Invalid segmentation symbol")}},n}(),k=function(){function e(){}return e.prototype.calculate=function(e,t,r){for(var n=e[0],i=1,a=e.length;i<a;i++)n=this.iterate(n,e[i],t,r);return n},e.prototype.extend=function(e,t,r){var n=t-1,i=t+1,a=t+r-2,o=t+r;e[n--]=e[i++],e[o++]=e[a--],e[n--]=e[i++],e[o++]=e[a--],e[n--]=e[i++],e[o++]=e[a--],e[n]=e[i],e[o]=e[a]},e.prototype.iterate=function(e,t,r,n){var i,a,o,s,l,u,c=e.width,h=e.height,d=e.items,f=t.width,p=t.height,m=t.items;for(o=0,i=0;i<h;i++)for(s=2*i*f,a=0;a<c;a++,o++,s+=2)m[s]=d[o];d=e.items=null;var g=new Float32Array(f+8);if(1===f){if(0!=(1&r))for(u=0,o=0;u<p;u++,o+=f)m[o]*=.5}else for(u=0,o=0;u<p;u++,o+=f)g.set(m.subarray(o,o+f),4),this.extend(g,4,f),this.filter(g,4,f),m.set(g.subarray(4,4+f),o);var v=16,y=[];for(i=0;i<v;i++)y.push(new Float32Array(p+8));var _,b=0;if(e=4+p,1===p){if(0!=(1&n))for(l=0;l<f;l++)m[l]*=.5}else for(l=0;l<f;l++){if(0===b){for(v=Math.min(f-l,v),o=l,s=4;s<e;o+=f,s++)for(_=0;_<v;_++)y[_][s]=m[o+_];b=v}var E=y[--b];if(this.extend(E,4,p),this.filter(E,4,p),0===b)for(o=l-v+1,s=4;s<e;o+=f,s++)for(_=0;_<v;_++)m[o+_]=y[_][s]}return{width:f,height:p,items:m}},e}(),P=function(){function e(){k.call(this)}return e.prototype=Object.create(k.prototype),e.prototype.filter=function(e,t,r){var n,i,a,o,s=r>>1,l=-1.586134342059924,u=-.052980118572961,c=.882911075530934,h=.443506852043971,d=1.230174104914001;for(n=(t|=0)-3,i=s+4;i--;n+=2)e[n]*=.8128930661159609;for(a=h*e[(n=t-2)-1],i=s+3;i--&&(o=h*e[n+1],e[n]=d*e[n]-a-o,i--);n+=2)a=h*e[(n+=2)+1],e[n]=d*e[n]-a-o;for(a=c*e[(n=t-1)-1],i=s+2;i--&&(o=c*e[n+1],e[n]-=a+o,i--);n+=2)a=c*e[(n+=2)+1],e[n]-=a+o;for(a=u*e[(n=t)-1],i=s+1;i--&&(o=u*e[n+1],e[n]-=a+o,i--);n+=2)a=u*e[(n+=2)+1],e[n]-=a+o;if(0!==s)for(a=l*e[(n=t+1)-1],i=s;i--&&(o=l*e[n+1],e[n]-=a+o,i--);n+=2)a=l*e[(n+=2)+1],e[n]-=a+o},e}(),L=function(){function e(){k.call(this)}return e.prototype=Object.create(k.prototype),e.prototype.filter=function(e,t,r){var n,i,a=r>>1;for(n=t|=0,i=a+1;i--;n+=2)e[n]-=e[n-1]+e[n+1]+2>>2;for(n=t+1,i=a;i--;n+=2)e[n]+=e[n-1]+e[n+1]>>1},e}();return t}(),i=function(){var e=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];function t(e,t,r){this.data=e,this.bp=t,this.dataEnd=r,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}return t.prototype={byteIn:function(){var e=this.data,t=this.bp;255===e[t]?e[t+1]>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t);this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(t,r){var n,i=t[r]>>1,a=1&t[r],o=e[i],s=o.qe,l=this.a-s;if(this.chigh<s)l<s?(l=s,n=a,i=o.nmps):(l=s,n=1^a,1===o.switchFlag&&(a=n),i=o.nlps);else{if(this.chigh-=s,0!=(32768&l))return this.a=l,a;l<s?(n=1^a,1===o.switchFlag&&(a=n),i=o.nlps):(n=a,i=o.nmps)}do{0===this.ct&&this.byteIn(),l<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&l));return this.a=l,t[r]=i<<1|a,n}},t}(),a="undefined"==typeof window?this:window;a.PDFJS||(a.PDFJS={}),a.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};function o(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function s(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}var l;PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},PDFJS.UnsupportedManager=(l=[],{listen:function(e){l.push(e)},notify:function(e){s('Unsupported feature "'+e+'"');for(var t=0,r=l.length;t<r;t++)l[t](e)}});function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!1}),r}PDFJS.isValidUrl=function(e,t){if(!e)return!1;var r=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);if(!r)return t;switch(r=r[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}},PDFJS.shadow=u;PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};var c=function(){function e(e,t){this.name="PasswordException",this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.PasswordException=c;var h=function(){function e(e,t){this.name="UnknownErrorException",this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=h;var d=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=d;var f=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=f;var p=function(){function e(e,t){this.name="UnexpectedResponseException",this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=p;(function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e})(),function(){function e(e,t){this.begin=e,this.end=t,this.message="Missing data ["+e+", "+t+")"}e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e}(),function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e}();function m(e){for(var t=1,r=0;e>t;)t<<=1,r++;return r}function g(e,t){return e[t]<<8|e[t+1]}function v(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return u(PDFJS,"isLittleEndian",((e=new Uint8Array(2))[0]=1,1===new Uint16Array(e.buffer)[0]));var e}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return u(PDFJS,"hasCanvasTypedArrays",((e=document.createElement("canvas")).width=e.height=1,void 0!==e.getContext("2d").createImageData(1,1).data.buffer));var e}});!function(){function e(n,i){this.buffer=n,this.byteLength=n.length,this.length=void 0===i?this.byteLength>>2:i,function(n){for(;t<n;)Object.defineProperty(e.prototype,t,r(t)),t++}(this.length)}e.prototype=Object.create(null);var t=0;function r(e){return{get:function(){var t=this.buffer,r=e<<2;return(t[r]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24)>>>0},set:function(t){var r=this.buffer,n=e<<2;r[n]=255&t,r[n+1]=t>>8&255,r[n+2]=t>>16&255,r[n+3]=t>>>24&255}}}}();var y=PDFJS.Util=function(){function e(){}var t=["rgb(",0,",",0,",",0,")"];return e.makeCssRgb=function(e,r,n){return t[1]=e,t[3]=r,t[5]=n,t.join("")},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]},e.applyInverseTransform=function(e,t){var r=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/r,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/r]},e.getAxialAlignedBoundingBox=function(t,r){var n=e.applyTransform(t,r),i=e.applyTransform(t.slice(2,4),r),a=e.applyTransform([t[0],t[3]],r),o=e.applyTransform([t[2],t[1]],r);return[Math.min(n[0],i[0],a[0],o[0]),Math.min(n[1],i[1],a[1],o[1]),Math.max(n[0],i[0],a[0],o[0]),Math.max(n[1],i[1],a[1],o[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=[e[0],e[2],e[1],e[3]],r=e[0]*t[0]+e[1]*t[2],n=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(r+a)/2,s=Math.sqrt((r+a)*(r+a)-4*(r*a-i*n))/2,l=o+s||1,u=o-s||1;return[Math.sqrt(l),Math.sqrt(u)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,r){function n(e,t){return e-t}var i=[t[0],t[2],r[0],r[2]].sort(n),a=[t[1],t[3],r[1],r[3]].sort(n),o=[];return t=e.normalizeRect(t),r=e.normalizeRect(r),(i[0]===t[0]&&i[1]===r[0]||i[0]===r[0]&&i[1]===t[0])&&(o[0]=i[1],o[2]=i[2],(a[0]===t[1]&&a[1]===r[1]||a[0]===r[1]&&a[1]===t[1])&&(o[1]=a[1],o[3]=a[2],o))},e.sign=function(e){return e<0?-1:1},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var r in t)e[r]=t[r]},e.getInheritableProperty=function(e,t){for(;e&&!e.has(t);)e=e.get("Parent");return e?e.get(t):null},e.inherit=function(e,t,r){for(var n in e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r)e.prototype[n]=r[n]},e.loadScript=function(e,t){var r=document.createElement("script"),n=!1;r.setAttribute("src",e),t&&(r.onload=function(){n||t(),n=!0}),document.getElementsByTagName("head")[0].appendChild(r)},e}();PDFJS.PageViewport=function(){function e(e,t,r,n,i,a){this.viewBox=e,this.scale=t,this.rotation=r,this.offsetX=n,this.offsetY=i;var o,s,l,u,c,h,d,f,p=(e[2]+e[0])/2,m=(e[3]+e[1])/2;switch(r=(r%=360)<0?r+360:r){case 180:o=-1,s=0,l=0,u=1;break;case 90:o=0,s=1,l=1,u=0;break;case 270:o=0,s=-1,l=-1,u=0;break;default:o=1,s=0,l=0,u=-1}a&&(l=-l,u=-u),0===o?(c=Math.abs(m-e[1])*t+n,h=Math.abs(p-e[0])*t+i,d=Math.abs(e[3]-e[1])*t,f=Math.abs(e[2]-e[0])*t):(c=Math.abs(p-e[0])*t+n,h=Math.abs(m-e[1])*t+i,d=Math.abs(e[2]-e[0])*t,f=Math.abs(e[3]-e[1])*t),this.transform=[o*t,s*t,l*t,u*t,c-o*t*p-l*t*m,h-s*t*p-u*t*m],this.width=d,this.height=f,this.fontScale=t}return e.prototype={clone:function(t){var r="scale"in(t=t||{})?t.scale:this.scale,n="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),r,n,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return y.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=y.applyTransform([e[0],e[1]],this.transform),r=y.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],r[0],r[1]]},convertToPdfPoint:function(e,t){return y.applyInverseTransform([e,t],this.transform)}},e}();function _(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}PDFJS.createPromiseCapability=_,function(){if(a.Promise)return"function"!=typeof a.Promise.all&&(a.Promise.all=function(e){var t,r,n=0,i=[],o=new a.Promise((function(e,n){t=e,r=n}));return e.forEach((function(e,a){n++,e.then((function(e){i[a]=e,0===--n&&t(i)}),r)})),0===n&&t(i),o}),"function"!=typeof a.Promise.resolve&&(a.Promise.resolve=function(e){return new a.Promise((function(t){t(e)}))}),"function"!=typeof a.Promise.reject&&(a.Promise.reject=function(e){return new a.Promise((function(t,r){r(e)}))}),void("function"!=typeof a.Promise.prototype.catch&&(a.Promise.prototype.catch=function(e){return a.Promise.prototype.then(void 0,e)}));var e={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(e){0!==e._status&&(this.handlers=this.handlers.concat(e._handlers),e._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=Date.now()+1;this.handlers.length>0;){var t=this.handlers.shift(),r=t.thisPromise._status,n=t.thisPromise._value;try{1===r?"function"==typeof t.onResolve&&(n=t.onResolve(n)):"function"==typeof t.onReject&&(n=t.onReject(n),r=1,t.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(t.thisPromise))}catch(e){r=2,n=e}if(t.nextPromise._updateStatus(r,n),Date.now()>=e)break}this.handlers.length>0?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(e){e._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===e&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var e=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(e-this.unhandledRejections[t].time>500){var r=this.unhandledRejections[t].promise._value,n="Unhandled rejection: "+r;r.stack&&(n+="\n"+r.stack),s(n),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};function t(e){this._status=0,this._handlers=[];try{e.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(e){this._reject(e)}}t.all=function(e){var r,n,i=new t((function(e,t){r=e,n=t})),a=e.length,o=[];if(0===a)return r(o),i;function s(e){2!==i._status&&(o=[],n(e))}for(var l=0,u=e.length;l<u;++l){var c=e[l],h=function(e){return function(t){2!==i._status&&(o[e]=t,0===--a&&r(o))}}(l);t.isPromise(c)?c.then(h,s):h(c)}return i},t.isPromise=function(e){return e&&"function"==typeof e.then},t.resolve=function(e){return new t((function(t){t(e)}))},t.reject=function(e){return new t((function(t,r){r(e)}))},t.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(r,n){1!==this._status&&2!==this._status&&(1===r&&t.isPromise(n)?n.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,2)):(this._status=r,this._value=n,2===r&&0===this._handlers.length&&(this._unhandledRejection=!0,e.addUnhandledRejection(this)),e.scheduleHandlers(this)))},_resolve:function(e){this._updateStatus(1,e)},_reject:function(e){this._updateStatus(2,e)},then:function(r,n){var i=new t((function(e,t){this.resolve=e,this.reject=t}));return this._handlers.push({thisPromise:this,onResolve:r,onReject:n,nextPromise:i}),e.scheduleHandlers(this),i},catch:function(e){return this.then(void 0,e)}},a.Promise=t}();var b;!function(){function e(e,t,r){for(;e.length<r;)e+=t;return e}function t(){this.started={},this.times=[],this.enabled=!0}t.prototype={time:function(e){this.enabled&&(e in this.started&&s("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||s("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t,r,n=this.times,i="",a=0;for(t=0,r=n.length;t<r;++t){var o=n[t].name;o.length>a&&(a=o.length)}for(t=0,r=n.length;t<r;++t){var s=n[t],l=s.end-s.start;i+=e(s.name," ",a)+" "+l+"ms\n"}return i}}}();PDFJS.createBlob=function(e,t){if("undefined"!=typeof Blob)return new Blob([e],{type:t});var r=new MozBlobBuilder;return r.append(e),r.getBlob(t)},PDFJS.createObjectURL=(b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",function(e,t){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var r=PDFJS.createBlob(e,t);return URL.createObjectURL(r)}for(var n="data:"+t+";base64,",i=0,a=e.length;i<a;i+=3){var o=255&e[i],s=255&e[i+1],l=255&e[i+2];n+=b[o>>2]+b[(3&o)<<4|s>>4]+b[i+1<a?(15&s)<<2|l>>6:64]+b[i+2<a?63&l:64]}return n}),"undefined"!==typeof e&&e.exports&&(e.exports=n)},function(e,t,r){"use strict";var n=n||{};n.Utils=n.Utils||r(31),n.NIFTI1=n.NIFTI1||r(60),n.NIFTI2=n.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},n.NIFTI2.MAGIC_COOKIE=540,n.NIFTI2.MAGIC_NUMBER_LOCATION=4,n.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],n.NIFTI2.prototype.readHeader=function(e){var t,r,i,a,o=new DataView(e),s=n.Utils.getIntAt(o,0,this.littleEndian);if(s!==n.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,s=n.Utils.getIntAt(o,0,this.littleEndian)),s!==n.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=n.Utils.getShortAt(o,12,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(o,14,this.littleEndian),t=0;t<8;t+=1)a=16+8*t,this.dims[t]=n.Utils.getLongAt(o,a,this.littleEndian);for(this.intent_p1=n.Utils.getDoubleAt(o,80,this.littleEndian),this.intent_p2=n.Utils.getDoubleAt(o,88,this.littleEndian),this.intent_p3=n.Utils.getDoubleAt(o,96,this.littleEndian),t=0;t<8;t+=1)a=104+8*t,this.pixDims[t]=n.Utils.getDoubleAt(o,a,this.littleEndian);for(this.vox_offset=n.Utils.getLongAt(o,168,this.littleEndian),this.scl_slope=n.Utils.getDoubleAt(o,176,this.littleEndian),this.scl_inter=n.Utils.getDoubleAt(o,184,this.littleEndian),this.cal_max=n.Utils.getDoubleAt(o,192,this.littleEndian),this.cal_min=n.Utils.getDoubleAt(o,200,this.littleEndian),this.slice_duration=n.Utils.getDoubleAt(o,208,this.littleEndian),this.toffset=n.Utils.getDoubleAt(o,216,this.littleEndian),this.slice_start=n.Utils.getLongAt(o,224,this.littleEndian),this.slice_end=n.Utils.getLongAt(o,232,this.littleEndian),this.description=n.Utils.getStringAt(o,240,320),this.aux_file=n.Utils.getStringAt(o,320,344),this.qform_code=n.Utils.getIntAt(o,344,this.littleEndian),this.sform_code=n.Utils.getIntAt(o,348,this.littleEndian),this.quatern_b=n.Utils.getDoubleAt(o,352,this.littleEndian),this.quatern_c=n.Utils.getDoubleAt(o,360,this.littleEndian),this.quatern_d=n.Utils.getDoubleAt(o,368,this.littleEndian),this.qoffset_x=n.Utils.getDoubleAt(o,376,this.littleEndian),this.qoffset_y=n.Utils.getDoubleAt(o,384,this.littleEndian),this.qoffset_z=n.Utils.getDoubleAt(o,392,this.littleEndian),r=0;r<3;r+=1)for(i=0;i<4;i+=1)a=400+8*(4*r+i),this.affine[r][i]=n.Utils.getDoubleAt(o,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=n.Utils.getIntAt(o,496,this.littleEndian),this.xyzt_units=n.Utils.getIntAt(o,500,this.littleEndian),this.intent_code=n.Utils.getIntAt(o,504,this.littleEndian),this.intent_name=n.Utils.getStringAt(o,508,524),this.dim_info=n.Utils.getByteAt(o,524),o.byteLength>n.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(o,540),this.extensionFlag[1]=n.Utils.getByteAt(o,541),this.extensionFlag[2]=n.Utils.getByteAt(o,542),this.extensionFlag[3]=n.Utils.getByteAt(o,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(o),this.extensionCode=this.getExtensionCode(o)))},n.NIFTI2.prototype.toFormattedString=function(){var e=n.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",t+='Intent Name: "'+this.intent_name+'"\n',t+="Dim Info = "+this.dim_info+"\n"},n.NIFTI2.prototype.getExtensionLocation=function(){return n.NIFTI2.MAGIC_COOKIE+4},n.NIFTI2.prototype.getExtensionSize=n.NIFTI1.prototype.getExtensionSize,n.NIFTI2.prototype.getExtensionCode=n.NIFTI1.prototype.getExtensionCode,n.NIFTI2.prototype.getDatatypeCodeString=n.NIFTI1.prototype.getDatatypeCodeString,n.NIFTI2.prototype.getTransformCodeString=n.NIFTI1.prototype.getTransformCodeString,n.NIFTI2.prototype.getUnitsCodeString=n.NIFTI1.prototype.getUnitsCodeString,n.NIFTI2.prototype.getQformMat=n.NIFTI1.prototype.getQformMat,n.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,n.NIFTI2.prototype.convertNiftiSFormToNEMA=n.NIFTI1.prototype.convertNiftiSFormToNEMA,n.NIFTI2.prototype.nifti_mat33_mul=n.NIFTI1.prototype.nifti_mat33_mul,n.NIFTI2.prototype.nifti_mat33_determ=n.NIFTI1.prototype.nifti_mat33_determ,"undefined"!==typeof e&&e.exports&&(e.exports=n.NIFTI2)},function(e,t,r){"use strict";var n=r(220),i=/[ \f\t\v]*\r?\n/,a=/^NRRD\d{4}$/,o=/^([^:]*)(:[ =])(.*)$/,s=/^LIST(?: (\d+))?$/;function l(e,t,r,i){var a,o,s=(o=e)in h?h[o]:o;switch(e){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":a=s+": "+t;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":n("number"==typeof t||t instanceof Number,"Field "+e+" should at least contain a number!"),a=s+": "+t;break;case"min":case"max":case"oldMin":case"oldMax":n("number"==typeof t||t instanceof Number,"Field "+e+" should contain a number!"),a=s+": "+t;break;case"spaceOrigin":n(t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach((function(t){n("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")})),a=s+": ("+t.join(",")+")";break;case"labels":case"units":case"spaceUnits":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){n("string"==typeof t||t instanceof String,"Field "+e+" should be a list of numbers!")})),a=s+": "+t.map(v).join(" ");break;case"sizes":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){n("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")})),a=s+": "+t.join(" ");break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){n("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")})),a=s+": "+t.join(" ");break;case"spaceDirections":n(void 0!==t.length&&t.length===r,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach((function(t){n(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach((function(t){n("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")}))})),a=s+": "+t.map((function(e){return null===e?"none":"("+e.join(",")+")"})).join(" ");break;case"measurementFrame":n(void 0!==t.length&&t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach((function(t){n(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach((function(t){n("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")}))})),a=s+": "+t.map((function(e){return null===e?"none":"("+e.join(",")+")"})).join(" ");break;case"type":case"encoding":case"endian":n("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),a=s+": "+t;break;case"dataFile":t.length||t.files&&"subdim"in t||(a=s+": "+function(e){if("string"==typeof e||e instanceof String)return e;if("format"in e&&"min"in e&&"max"in e&&"step"in e)return"subdim"in e?e.format+" "+e.min+" "+e.max+" "+e.step+" "+e.subdim:e.format+" "+e.min+" "+e.max+" "+e.step;throw new Error("Unrecognized data file format!")}(t));break;case"centers":case"kinds":n(void 0!==t.length&&t.length==r,"Field "+e+" should be a list with length equal to the dimension!"),a=s+": "+t.map(A).join(" ");break;default:console.warn("Unrecognized NRRD field: "+e+", skipping.")}return a}function u(e,t){switch(e){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":t=f(t);break;case"min":case"max":case"oldMin":case"oldMax":t=p(t);break;case"spaceOrigin":t=m(t);break;case"labels":case"units":case"spaceUnits":t=_(t,g);break;case"sizes":t=_(t,f);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":t=_(t,p);break;case"spaceDirections":case"measurementFrame":t=_(t,m);break;case"type":t=b(t);break;case"encoding":t=E(t);break;case"endian":t=w(t);break;case"dataFile":r=t,t=(n=x.exec(r))?5==n.length&&n[4]?{format:r.substring(0,n.index),min:f(n[1]),max:f(n[2]),step:f(n[3]),subdim:f(n[4])}:{format:r.substring(0,n.index),min:f(n[1]),max:f(n[2]),step:f(n[3])}:r;break;case"centers":t=_(t,T);break;case"kinds":t=_(t,S);break;case"space":t=function(e){switch(e.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+e),e}}(t);break;default:console.warn("Unrecognized NRRD field: "+e)}var r,n;return t}e.exports.serialize=function(e){var t,r,n,i,a,o,s,u,c,h,d=1,f={},p=[];for(i in e)f[i]=e[i];if(void 0===f.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===f.dimension&&(f.dimension=f.sizes.length),f.data instanceof Int8Array?a="int8":f.data instanceof Uint8Array?a="uint8":f.data instanceof Int16Array?a="int16":f.data instanceof Uint16Array?a="uint16":f.data instanceof Int32Array?a="int32":f.data instanceof Uint32Array?a="uint32":f.data instanceof Float32Array?a="float":f.data instanceof Float64Array&&(a="double"),void 0===f.type&&void 0!==a)f.type=a;else{if(void 0===f.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof f.type||f.type instanceof String)&&(f.type=b(f.type))}void 0===f.encoding?f.encoding="raw":("string"==typeof f.encoding||f.encoding instanceof String)&&(f.encoding=E(f.encoding)),f.data&&"block"!=f.type&&"int8"!=f.type&&"uint8"!=f.type&&"ascii"!=f.encoding?f.endian=L:"block"==f.type||"int8"==f.type||"uint8"==f.type||"ascii"==f.encoding?f.endian=void 0:("string"==typeof f.endian||f.endian instanceof String)&&(f.endian=w(f.endian));var m=void 0;if(void 0!==f.spaceDimension)m=f.spaceDimension;else if(void 0!==f.space)switch(f.space){case"right-anterior-superior":case"RAS":m=3;break;case"left-anterior-superior":case"LAS":m=3;break;case"left-posterior-superior":case"LPS":m=3;break;case"right-anterior-superior-time":case"RAST":m=4;break;case"left-anterior-superior-time":case"LAST":m=4;break;case"left-posterior-superior-time":case"LPST":m=4;break;case"scanner-xyz":m=3;break;case"scanner-xyz-time":m=4;break;case"3D-right-handed":case"3D-left-handed":m=3;break;case"3D-right-handed-time":case"3D-left-handed-time":m=4;break;default:console.warn("Unrecognized space: "+f.space)}for(H(f),t=0;t<f.sizes.length;t++){if(f.sizes[t]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");d*=f.sizes[t]}if(f.data){if(f.data.length<d)throw new Error("Missing data to serialize!")}else if(f.buffer){if("raw"==f.encoding&&(o="block"==f.type&&void 0!==f.blockSize?f.blockSize:I(f.type),f.buffer.byteLength<d*o))throw new Error("Missing data to serialize!")}else if(!f.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(f.data)switch(f.encoding){case"raw":s=f.type==a&&f.endian==L?f.data.buffer.slice(f.data.byteOffset,f.data.byteOffset+f.data.byteLength):f.endian==L?(s=O(f.data,f.type)).buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):function(e,t,r){var n,i,a,o=I(t),s=new ArrayBuffer(e.length*o);switch(r){case"big":i=!1;break;case"little":i=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+r)}switch(a=new DataView(s),t){case"int8":for(n=0;n<e.length;n++)a.setInt8(n,e[n],i);return s;case"uint8":for(n=0;n<e.length;n++)a.setUint8(n,e[n],i);return s;case"int16":for(n=0;n<e.length;n++)a.setInt16(2*n,e[n],i);return s;case"uint16":for(n=0;n<e.length;n++)a.setUint16(2*n,e[n],i);return s;case"int32":for(n=0;n<e.length;n++)a.setInt32(4*n,e[n],i);return s;case"uint32":for(n=0;n<e.length;n++)a.setUint32(4*n,e[n],i);return s;case"float":for(n=0;n<e.length;n++)a.setFloat32(4*n,e[n],i);return s;case"double":for(n=0;n<e.length;n++)a.setFloat64(8*n,e[n],i);return s;default:return void console.warn("Cannot serialize NRRD type: "+t+".")}}(f.data,f.type,f.endian);break;case"ascii":s=f.type==a?D(f.data):D(O(f.data,f.type));break;default:throw new Error("Unsupported NRRD encoding: "+f.encoding)}else f.buffer&&(s=f.buffer);p.push("NRRD0005"),p.push("# Generated by nrrd-js");var g=["dimension","spaceDimension","space"];for(t=0;t<g.length;t++)void 0!==f[i=g[t]]&&void 0!==(c=l(i,f[i],f.dimension,m))&&p.push(c);for(i in f)void 0!==f[i]&&(g.indexOf(i)>=0||void 0!==(c=l(i,f[i],f.dimension,m))&&p.push(c));if(f.keys)for(i in f.keys){if(i.indexOf(":=")>=0)throw new Error("The combination ':=' is not allowed in an NRRD key!");p.push(i+":="+f[i].replace("\\","\\\\").replace("\n","\\n"))}if(f.dataFile&&f.dataFile.length?(p.push("data file: LIST"),Array.prototype.push.apply(p,f.dataFile)):f.dataFile&&f.dataFile.files&&"subdim"in f.dataFile&&(p.push("data file: LIST "+f.dataFile.subdim),Array.prototype.push.apply(p,f.dataFile.files)),s&&!("dataFile"in f)){for(p.push(""),p.push(""),h=p.join("\n"),r=new ArrayBuffer(h.length+s.byteLength),n=new Uint8Array(r),t=0;t<h.length;t++)n[t]=h.charCodeAt(t);u=new Uint8Array(s),n.set(u,h.length)}else for(p.push(""),h=p.join("\n"),r=new ArrayBuffer(h.length),n=new Uint8Array(r),t=0;t<h.length;t++)n[t]=h.charCodeAt(t);return r},e.exports.parse=function(e){var t,r,n,l,c,h,m={data:void 0,buffer:void 0,keys:{},version:void 0},g=new Uint8Array(e);for(g.buffer!==e&&(e=g.buffer),t=2;t<g.length;)if(10==g[t]){if(10==g[t-1]||13==g[t-1]&&10==g[t-2]){n=t+1;break}t++}else 13==g[t]?t++:t+=2;if(void 0===n?r=String.fromCharCode.apply(null,g):(r=String.fromCharCode.apply(null,g.subarray(0,n)),m.buffer=e.slice(n)),l=(l=r.split(i)).filter((function(e){return e.length>0&&"#"!=e[0]})),!a.test(l[0]))throw new Error("File is not an NRRD file!");for(m.version=parseInt(l[0].substring(4,8),10),m.version>5&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),t=1;t<l.length;t++)if(c=o.exec(l[t]))if(": "==c[2])c[1]=d(c[1]),"dataFile"==c[1]&&(h=s.exec(c[3]))?(2==h.length&&h[1]?m[c[1]]={files:l.slice(t+1),subdim:f(h[1])}:m[c[1]]=l.slice(t+1),l.length=t):m[c[1]]=u(c[1],c[3]);else{if(":="!=c[2])throw new Error("Logic error in NRRD parser.");m.keys[c[1]]=c[3].split("\\\\").map((function(e){return e.replace("\\n","\n")})).join("\\")}else console.warn("Unrecognized line in NRRD header: "+l[t]);if(H(m),"dataFile"in m)console.warn("No support for external data yet!");else switch(m.encoding){case"raw":m.data=function(e,t,r,n){var i,a,o,s=1;for(i=0;i<r.length;i++){if(r[i]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");s*=r[i]}if("block"==t)return e.slice(0,s*n.blockSize);if("int8"==t||"uint8"==t||n.endian==L)switch(t){case"int8":return l(1),new Int8Array(e.slice(0,s));case"uint8":return l(1),new Uint8Array(e.slice(0,s));case"int16":return l(2),new Int16Array(e.slice(0,2*s));case"uint16":return l(2),new Uint16Array(e.slice(0,2*s));case"int32":return l(4),new Int32Array(e.slice(0,4*s));case"uint32":return l(4),new Uint32Array(e.slice(0,4*s));case"float":return l(4),new Float32Array(e.slice(0,4*s));case"double":return l(8),new Float64Array(e.slice(0,8*s));default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}else{switch(n.endian){case"big":!1;break;case"little":!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+n.endian)}switch(o=new DataView(e),t){case"int8":for(a=new Int8Array(s),i=0;i<s;i++)a[i]=o.getInt8(i);return a;case"uint8":for(a=new Uint8Array(s),i=0;i<s;i++)a[i]=o.getUint8(i);return a;case"int16":for(a=new Int16Array(s),i=0;i<s;i++)a[i]=o.getInt16(2*i);return a;case"uint16":for(a=new Uint16Array(s),i=0;i<s;i++)a[i]=o.getUint16(2*i);return a;case"int32":for(a=new Int32Array(s),i=0;i<s;i++)a[i]=o.getInt32(4*i);return a;case"uint32":for(a=new Uint32Array(s),i=0;i<s;i++)a[i]=o.getUint32(4*i);return a;case"float":for(a=new Float32Array(s),i=0;i<s;i++)a[i]=o.getFloat32(4*i);return a;case"double":for(a=new Float64Array(s),i=0;i<s;i++)a[i]=o.getFloat64(8*i);return a;default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}}function l(t){if(e.byteLength<s*t)throw new Error("NRRD file does not contain enough data!")}}(m.buffer,m.type,m.sizes,{endian:m.endian,blockSize:m.blockSize});break;case"ascii":m.data=function(e,t,r){var n,i,a,o,s=1;for(n=0;n<r.length;n++){if(r[n]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");s*=r[n]}if(i=new Uint8Array(e),a=String.fromCharCode.apply(null,i),(o=a.split(C)).length<s)throw new Error("Not enough data in NRRD file!");o.length>s&&(""===o[0]&&(o=o.slice(1)),o=o.slice(0,s));switch(t){case"int8":return new Int8Array(o.map(f));case"uint8":return new Uint8Array(o.map(f));case"int16":return new Int16Array(o.map(f));case"uint16":return new Uint16Array(o.map(f));case"int32":return new Int32Array(o.map(f));case"uint32":return new Uint32Array(o.map(f));case"float":return new Float32Array(o.map(p));case"double":return new Float64Array(o.map(p));default:return void console.warn("Unsupported NRRD type: "+t+".")}}(m.buffer,m.type,m.sizes);break;default:console.warn("Unsupported NRRD encoding: "+m.encoding)}return m};var c={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},h=function(){var e,t={};for(e in c)t[c[e]]=e;return t}();function d(e){return(e=e.toLowerCase())in c?c[e]:e}function f(e){var t=parseInt(e,10);if(Number.isNaN(t))throw new Error("Malformed NRRD integer: "+e);return t}function p(e){if((e=e.toLowerCase()).indexOf("nan")>=0)return NaN;if(e.indexOf("-inf")>=0)return-1/0;if(e.indexOf("inf")>=0)return 1/0;var t=parseFloat(e);if(Number.isNaN(t))throw new Error("Malformed NRRD float: "+e);return t}function m(e){if("none"==e)return null;if(e.length<2||"("!==e[0]||")"!==e[e.length-1])throw new Error("Malformed NRRD vector: "+e);return e.slice(1,-1).split(",").map(p)}function g(e){if(length<2||'"'!=e[0]||'"'!=e[e.length-1])throw new Error("Invalid NRRD quoted string: "+e);return e.slice(1,-1).replace('\\"','"')}function v(e){return'"'+e.replace('"','\\"')+'"'}var y=/[ \t]+/;function _(e,t){return e.split(y).map(t)}function b(e){switch(e.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+e),e}}function E(e){switch(e.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+e),e}}function w(e){switch(e.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+e),e}}var x=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/;function T(e){switch(e.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+e),e}}var M={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null};function S(e){var t=e.toLowerCase();return t in M?M[t]:(console.warn("Unrecognized NRRD kind: "+e),e)}function A(e){return null===e?"???":e}var R,k,P,L=(R=new ArrayBuffer(4),k=new Uint32Array(R),P=new Uint8Array(R),k[0]=16909060,1==P[0]&&2==P[1]&&3==P[2]&&4==P[3]?"big":4==P[0]&&3==P[1]&&2==P[2]&&1==P[3]?"little":void console.warn("Unrecognized system endianness!"));var C=/[ \t\n\r\v\f]+/;function I(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":return 4;case"int64":case"uint64":return 8;case"float":return 4;case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+e)}}function H(e){if(void 0===e.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===e.type)throw new Error("Type missing from NRRD file!");if(void 0===e.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===e.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=e.type&&"int8"!=e.type&&"uint8"!=e.type&&"ascii"!=e.encoding&&void 0===e.endian)throw new Error("Endianness missing from NRRD file!");if("block"==e.type&&void 0===e.blockSize)throw new Error("Missing block size in NRRD file!");if(0===e.dimension)throw new Error("Zero-dimensional NRRD file?");if(e.dimension!=e.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(e.spacings&&e.dimension!=e.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(e.thicknesses&&e.dimension!=e.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(e.axisMins&&e.dimension!=e.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(e.axisMaxs&&e.dimension!=e.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");if(e.centers&&e.dimension!=e.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(e.labels&&e.dimension!=e.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(e.units&&e.dimension!=e.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(e.kinds&&e.dimension!=e.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if(!(void 0!==e.data&&0!==e.data.length||void 0!==e.buffer&&0!==e.buffer.byteLength||void 0!==e.dataFile))throw new Error("NRRD file has neither inline or external data!")}function O(e,t){switch(t){case"int8":return new Int8Array(e);case"uint8":return new Uint8Array(e);case"int16":return new Int16Array(e);case"uint16":return new Uint16Array(e);case"int32":return new Int32Array(e);case"uint32":return new Uint32Array(e);case"float":return new Float32Array(e);case"double":return new Float64Array(e);default:throw new Error("Cannot cast to NRRD type: "+t)}}function D(e){var t,r,n,i,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=""+e[t];for(r=a.join(" "),n=new ArrayBuffer(r.length),i=new Uint8Array(n),t=0;t<i.length;t++)i[t]=r.charCodeAt(t);return n}},function(e,t,r){"use strict";(function(t){var n=r(221);function i(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function a(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=r(222),s=Object.prototype.hasOwnProperty,l=Array.prototype.slice,u="foo"===function(){}.name;function c(e){return Object.prototype.toString.call(e)}function h(e){return!a(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var d=e.exports=y,f=/\s*function\s+([^\(\s]*)\s*/;function p(e){if(o.isFunction(e)){if(u)return e.name;var t=e.toString().match(f);return t&&t[1]}}function m(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function g(e){if(u||!o.isFunction(e))return o.inspect(e);var t=p(e);return"[Function"+(t?": "+t:"")+"]"}function v(e,t,r,n,i){throw new d.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function y(e,t){e||v(e,!0,t,"==",d.ok)}function _(e,t,r,n){if(e===t)return!0;if(a(e)&&a(t))return 0===i(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(h(e)&&h(t)&&c(e)===c(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(a(e)!==a(t))return!1;var s=(n=n||{actual:[],expected:[]}).actual.indexOf(e);return-1!==s&&s===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=b(e),a=b(t);if(i&&!a||!i&&a)return!1;if(i)return e=l.call(e),t=l.call(t),_(e,t,r);var s,u,c=x(e),h=x(t);if(c.length!==h.length)return!1;for(c.sort(),h.sort(),u=c.length-1;u>=0;u--)if(c[u]!==h[u])return!1;for(u=c.length-1;u>=0;u--)if(s=c[u],!_(e[s],t[s],r,n))return!1;return!0}(e,t,r,n))}return r?e===t:e==t}function b(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function E(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function w(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&v(i,r,"Missing expected exception"+n);var a="string"==typeof n,s=!e&&i&&!r;if((!e&&o.isError(i)&&a&&E(i,r)||s)&&v(i,r,"Got unwanted exception"+n),e&&i&&r&&!E(i,r)||!e&&i)throw i}d.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return m(g(e.actual),128)+" "+e.operator+" "+m(g(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,i=p(t),a=n.indexOf("\n"+i);if(a>=0){var o=n.indexOf("\n",a+1);n=n.substring(o+1)}this.stack=n}}},o.inherits(d.AssertionError,Error),d.fail=v,d.ok=y,d.equal=function(e,t,r){e!=t&&v(e,t,r,"==",d.equal)},d.notEqual=function(e,t,r){e==t&&v(e,t,r,"!=",d.notEqual)},d.deepEqual=function(e,t,r){_(e,t,!1)||v(e,t,r,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(e,t,r){_(e,t,!0)||v(e,t,r,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(e,t,r){_(e,t,!1)&&v(e,t,r,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function e(t,r,n){_(t,r,!0)&&v(t,r,n,"notDeepStrictEqual",e)},d.strictEqual=function(e,t,r){e!==t&&v(e,t,r,"===",d.strictEqual)},d.notStrictEqual=function(e,t,r){e===t&&v(e,t,r,"!==",d.notStrictEqual)},d.throws=function(e,t,r){w(!0,e,t,r)},d.doesNotThrow=function(e,t,r){w(!1,e,t,r)},d.ifError=function(e){if(e)throw e},d.strict=n((function e(t,r){t||v(t,!0,r,"==",e)}),d,{equal:d.strictEqual,deepEqual:d.deepStrictEqual,notEqual:d.notStrictEqual,notDeepEqual:d.notDeepStrictEqual}),d.strict.strict=d.strict;var x=Object.keys||function(e){var t=[];for(var r in e)s.call(e,r)&&t.push(r);return t}}).call(this,r(5))},function(e,t,r){"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,s,l=o(e),u=1;u<arguments.length;u++){for(var c in r=Object(arguments[u]))i.call(r,c)&&(l[c]=r[c]);if(n){s=n(r);for(var h=0;h<s.length;h++)a.call(r,s[h])&&(l[s[h]]=r[s[h]])}}return l}},function(e,t,r){(function(e){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),l=n[r];r<a;l=n[++r])m(l)||!b(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(r,n){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var a,o={};function s(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,e,n.depth)}function l(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function u(e,t){return e}function c(e,r,n){if(e.customInspect&&r&&x(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return v(i)||(i=c(e,i,n)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(g(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,r);if(a)return a;var o=Object.keys(r),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),w(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(r);if(0===o.length){if(x(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(_(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return e.stylize(Date.prototype.toString.call(r),"date");if(w(r))return h(r)}var u,b="",T=!1,M=["{","}"];(f(r)&&(T=!0,M=["[","]"]),x(r))&&(b=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(b=" "+RegExp.prototype.toString.call(r)),E(r)&&(b=" "+Date.prototype.toUTCString.call(r)),w(r)&&(b=" "+h(r)),0!==o.length||T&&0!=r.length?n<0?_(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=T?function(e,t,r,n,i){for(var a=[],o=0,s=t.length;o<s;++o)R(t,String(o))?a.push(d(e,t,r,n,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(d(e,t,r,n,i,!0))})),a}(e,r,n,s,o):o.map((function(t){return d(e,r,n,s,t,T)})),e.seen.pop(),function(e,t,r){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,b,M)):M[0]+b+M[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),R(n,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(r)?c(e,l.value,null):c(e,l.value,r-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===T(e)}function b(e){return"object"==typeof e&&null!==e}function E(e){return b(e)&&"[object Date]"===T(e)}function w(e){return b(e)&&("[object Error]"===T(e)||e instanceof Error)}function x(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function M(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(r){if(y(a)&&(a=e.env.NODE_DEBUG||""),r=r.toUpperCase(),!o[r])if(new RegExp("\\b"+r+"\\b","i").test(a)){var n=e.pid;o[r]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",r,n,e)}}else o[r]=function(){};return o[r]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=_,t.isObject=b,t.isDate=E,t.isError=w,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(223);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(){var e=new Date,t=[M(e.getHours()),M(e.getMinutes()),M(e.getSeconds())].join(":");return[e.getDate(),S[e.getMonth()],t].join(" ")}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",A(),t.format.apply(t,arguments))},t.inherits=r(224),t._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var k="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(k&&e[k]){var t;if("function"!=typeof(t=e[k]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise((function(e,n){t=e,r=n})),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),k&&Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=k,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};t.apply(this,r).then((function(t){e.nextTick(o,null,t)}),(function(t){e.nextTick(P,t,o)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.defineProperties(r,n(t)),r}}).call(this,r(16))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"Octree",(function(){return _e})),r.d(n,"World",(function(){return we})),r.d(n,"HeroAnimator",(function(){return xe})),r.d(n,"HeroController",(function(){return Te})),r.d(n,"KeyInputControl",(function(){return He})),r.d(n,"TPSCameraControl",(function(){return Ve}));var i=r(0);window.THREE=i,r(68),r(69),r(70),r(71),r(72),r(73),r(74),r(75),r(76),r(77),r(78),r(79),r(80),r(81),r(82),r(83),r(84),r(85),r(86),r(87),r(88),r(89),r(90),r(94),r(95),r(96),r(97),r(98),r(99),r(100),r(101),r(102),r(103),r(104),r(105),r(106),r(107),r(108),r(109),r(110),r(111),r(112),r(113),r(114),r(115),r(116),r(117),r(118),r(119),r(120),r(121),r(122),r(123),r(124),r(125),r(126),r(127),r(128),r(129),r(130),r(131),r(132),r(133),r(134),r(135),r(136),r(137),r(138),r(139),r(140),r(141),r(142),r(143),r(144),r(145),r(146),r(147),r(148),r(149),r(150),r(151);var a={tabIndices:{viewWorks:"1",gameWorks:"1",natureWorks:"1",sketcher:"4"},zIndices:{viewWorks:"0",natureWorks:"0",sketcher:"2",colorSelector:"3",matcaps:"4"},renderer:null,scene:null,camera:null,appWorks:null,shaders:null,sunLight:null,TEXTURE_MAPS:["map","matcap","alphaMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","specularMap","envMap","lightMap","aoMap","emissiveMap","gradientMap"],WORLD_SIZE:1e3,GRID_SPACING:5,GROUND_HEIGHT:0,WATER_HEIGHT:0,WATER_COLOR:7695,OCEAN_COLOR:139053,FOG_COLOR:14014425,SUN_COLOR:16777215};a.Timer={unit:"sec",startTime:0,endTime:0,msg:"",start:function(e){this.msg=e,this.startTime=performance.now()},end:function(){this.endTime=performance.now();var e=this.endTime-this.startTime;"sec"===this.unit&&(e*=.001),console.log(">> time ("+this.msg+") = "+e.toFixed(2)+" ("+this.unit+")")},setUnit:function(e){this.unit=e}};var o,s,l,u,c,h,d,f,p,m,g,v,y,_,b,E=r(8);a.clock=new THREE.Clock,a.getDeltaTime=function(){return a.clock.getDelta()},a.getCurrentTime=function(){return a.clock.getElapsedTime()},a.humanFileSize=function(e,t,r,n,i){return(t=Math,r=t.log,1e3,i=r(e)/r(1e3)|0,e/t.pow(1e3,i)).toFixed(2)+" "+(i?"KMGTPEZY"[--i]+"B":"Bytes")},a.isDeviceMobile=function(){var e=!1;return/Mobi|Android|webOS|Tablet|iPad|iPhone|iPod|Windows Phone|BlackBerry|BB10|Opera Mini/i.test(navigator.userAgent)&&(e=!0),e},a.isDeviceLandscape=function(){return 90===window.orientation||-90===window.orientation},a.isDeviceTouch=function(){return"ontouchend"in window},a.isDeviceWindowsOS=function(){return navigator.platform.toUpperCase().indexOf("WIN32")>=0},a.isDeviceMacOS=function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0},a.isDeviceiOS=function(){return/iPad|iPhone|iPod/g.test(navigator.userAgent)&&!window.MSStream},a.isWebGL1Available=function(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},a.isWebGL2Available=function(){var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))},a.isWebGL1=function(){var e=a.appWorks.renderer.getContext();return void 0!==e&&e instanceof window.WebGLRenderingContext},a.isWebGL2=function(){var e=a.appWorks.renderer.getContext();return void 0!==e&&e instanceof window.WebGL2RenderingContext},a.getWebGLInfo=function(){var e=[],t="WebGL1: "+(a.isWebGL1Available()?"available":"unavailable");e.push(t);var r="WebGL2: "+(a.isWebGL2Available()?"available":"unavailable");e.push(r);var n=a.appWorks.renderer.getContext().getSupportedExtensions();return e=e.concat(n)},a.isWebGLExtensionAvailable=function(e){return a.appWorks.renderer.getContext().getSupportedExtensions().indexOf(e)>=0},Number.prototype.format=function(){return this.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},String.prototype.trunc=function(e,t){if(this.length<=e)return(" "+this).slice(1);var r=this.substr(0,e);return(t?r.substr(0,r.lastIndexOf(" ")+1):r)+"..."},Array.prototype.clone=function(){return this.map(e=>Array.isArray(e)?e.clone():e)},Array.prototype.remove=function(e,t){var r=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,r)},Array.prototype.sum=function(){return this.reduce((function(e,t){return e+Number(t)}),0)},Array.prototype.average=function(){return this.sum()/(this.length||1)},Array.prototype.mean=function(){return this.sum()/(this.length||1)},Array.prototype.median=function(){var e=this.slice(0).sort((e,t)=>e-t),t=e.length/2;return t%1?e[t-.5]:(e[t-1]+e[t])/2},Array.prototype.variance=function(){var e=this.mean();return this.map(t=>Math.pow(t-e,2)).mean()},Array.prototype.std=function(){return Math.sqrt(this.variance())},Array.prototype.zscores=function(){var e=this.mean(),t=this.std();return this.map(r=>(r-e)/t)},Array.prototype.range=function(){return this.max()-this.min()},Array.prototype.zero=function(e){for(var t=0;t<e;t++)this[t]=0;return this},Array.prototype.scale=function(e){return this.map(t=>t*e)},Array.prototype.add=function(e){return this.map((t,r)=>t+e[r])},Array.prototype.sub=function(e){return this.map((t,r)=>t-e[r])},Array.prototype.mul=function(e){return this.map((t,r)=>t*e[r])},Array.prototype.div=function(e){return this.map((t,r)=>t/e[r])},Array.prototype.dot=function(e){return this.map((t,r)=>t*e[r]).reduce((e,t)=>e+t)},Array.prototype.norm2=function(){return Math.sqrt(this.map((e,t)=>e*e).reduce((e,t)=>e+t))},Array.prototype.transpose=function(){var e=this;return e[0].map((function(t,r){return e.map((function(e,t){return e[r]}))}))},Array.prototype.mmul=function(e){return this.map((function(t,r){return e.transpose().map((function(e,r){return t.dot(e)}))}))},Array.prototype.vmul=function(e){return this.map((function(t,r){return t.dot(e)}))},Array.prototype.sortNumbers=function(e){return"ascending"===(e=e||"ascending")?this.sort((e,t)=>e-t):"descending"===e&&this.sort((e,t)=>t-e),this},Array.prototype.minX=function(){return this.reduce((e,t)=>t.x<e?t.x:e,this[0].x)},Array.prototype.maxX=function(){return this.reduce((e,t)=>t.x>e?t.x:e,this[0].x)},Array.prototype.minY=function(){return this.reduce((e,t)=>t.y<e?t.y:e,this[0].y)},Array.prototype.maxY=function(){return this.reduce((e,t)=>t.y>e?t.y:e,this[0].y)},Array.prototype.minZ=function(){return this.reduce((e,t)=>t.z<e?t.z:e,this[0].z)},Array.prototype.maxZ=function(){return this.reduce((e,t)=>t.z>e?t.z:e,this[0].z)},Array.prototype.min=function(){return this.reduce((e,t)=>t<e?t:e,this[0])},Array.prototype.max=function(){return this.reduce((e,t)=>t>e?t:e,this[0])},Array.prototype.householder=function(){function e(e,t=(e=>e)){return Array.from(Array(e),(e,r)=>t(r))}function t(e,t=(e=>e)){return e.reduce((e,r,n)=>e+t(r,n),0)}const r=Math.sqrt(this.length),n=Array.from(this);console.assert(Number.isInteger(r));const i=(e,t)=>t*r+e;for(let a=0;a<r-2;a++){if(Math.abs(n[i(a,a+1)])<Number.EPSILON)continue;const o=e(r,e=>e<=a?0:n[i(a,e)]),s=Math.sign(o[a+1])*Math.hypot(...o);o[a+1]+=s;const l=Math.sqrt(2*s*o[a+1]),u=o.map(e=>e/l),c=e(r,e=>t(u,(t,r)=>t*n[i(r,e)])),h=e(r,e=>t(u,(t,r)=>t*n[i(e,r)])),d=t(c,(e,t)=>e*u[t]),f=t(h,(e,t)=>e*u[t]),p=c.map((e,t)=>2*(e-d*u[t])),m=h.map((e,t)=>2*(e-f*u[t]));for(let e=0;e<r;e++)for(let t=0;t<r;t++)n[i(t,e)]-=u[e]*m[t]+u[t]*p[e]}return n},Array.prototype.qr=function(){function e(e,t=(e=>e)){return e.reduce((e,r,n)=>e+t(r,n),0)}const t=Math.sqrt(this.length),r=Array.from(this);console.assert(Number.isInteger(t));const n=(e,r)=>r*t+e;let i=t;for(;i>=2;){if(Math.abs(r[n(i-2,i-1)])<Number.EPSILON){i--;continue}const t=r[n(i-1,i-1)],a=r[n(i-2,i-1)],o=r[n(i-1,i-2)],s=r[n(i-2,i-2)],l=t*s,u=t*s-a*o,c=Math.sqrt(l*l-4*u)||0,h=(l+c)/2,d=(l-c)/2,f=t-(Math.abs(h)<Math.abs(d)?h:d);for(let e=0;e<i;e++)r[n(e,e)]-=f;const p=(e,t)=>t*i+e,m=Array(i*i).fill(0);for(let e=0;e<i;e++)m[p(e,e)]=1;for(let e=0;e<i-1;e++){const t=r[n(e,e)],a=r[n(e,e+1)],o=Math.hypot(t,a),s=o<Number.EPSILON?0:t/o,l=o<Number.EPSILON?0:a/o;r[n(e,e)]=o,r[n(e,e+1)]=0;for(let t=e+1;t<i;t++){const i=r[n(t,e)],a=r[n(t,e+1)];r[n(t,e)]=i*s+a*l,r[n(t,e+1)]=a*s-i*l}for(let t=0;t<i;t++){const r=m[p(e,t)],n=m[p(e+1,t)];m[p(e,t)]=r*s+n*l,m[p(e+1,t)]=n*s-r*l}}for(let t=0;t<i;t++){const a=Array.from(Array(i-t),(e,i)=>r[n(t+i,t)]);for(let o=0;o<i;o++)r[n(o,t)]=e(a,(e,r)=>e*m[p(o,r+t)])}for(let e=0;e<i;e++)r[n(e,e)]+=f}return r},Array.prototype.eigenvalues=function(){const e=this.householder().qr(),t=Math.sqrt(e.length);return function(e,t=(e=>e)){return Array.from(Array(e),(e,r)=>t(r))}(t,r=>e[r*t+r])},a.concatTypedArrays=function(e,...t){const r=new e(t.reduce((e,t)=>e+t.length,0));return t.reduce((e,t)=>(r.set(t,e),e+t.length),0),r},a.fromTypedArray=function(e){return[].slice.call(e)},a.fillArray=function(e,t){for(var r=[],n=t;n--;)r[n]=e;return r},a.flattenArray=function(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?a.flattenArray(t):t)}),[])},a.flattenVector2s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y)}return t},a.flattenVector3s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z)}return t},a.flattenVector4s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z,i.w)}return t},a.mergeArray3=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],a.z=e[o][2],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)+"_"+Math.round(a.z*t)]&&(n[r]=o,i.push([e[o][0],e[o][1],e[o][2]]));return i.slice(0)},a.mergeArray2=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)]&&(n[r]=o,i.push([e[o][0],e[o][1]]));return i.slice(0)},a.mergeArray=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o],void 0===n[r=Math.round(a.x*t)]&&(n[r]=o,i.push(e[o]));return i.slice(0)},a.mergeVertices=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n,i={},a=0,o=e.length;a<o;a++)r=e[a],void 0===i[n=Math.round(r.x*t)+"_"+Math.round(r.y*t)+"_"+Math.round(r.z*t)]&&(i[n]=a,this.push(e[a]));return e.length-this.length},THREE.Color.prototype.getHSV=function(e){void 0===e&&(console.warn("THREE.Color: .getHSV() target is now required"),e={h:0,s:0,v:0});var t,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),l=o,u=o-s;if(r=0===o?0:u/o,o===s)t=0;else{switch(o){case n:t=(i-a)/u+(i<a?6:0);break;case i:t=(a-n)/u+2;break;case a:t=(n-i)/u+4}t/=6}return e.h=t,e.s=r,e.v=l,e},THREE.Color.prototype.setHSV=function(e,t,r){var n,i,a,o=Math.floor(6*e),s=6*e-o,l=r*(1-t),u=r*(1-s*t),c=r*(1-(1-s)*t);switch(o%6){case 0:n=r,i=c,a=l;break;case 1:n=u,i=r,a=l;break;case 2:n=l,i=r,a=c;break;case 3:n=l,i=u,a=r;break;case 4:n=c,i=l,a=r;break;case 5:n=r,i=l,a=u}return this.r=n,this.g=i,this.b=a,this},THREE.Color.prototype.getHSI=function(e){void 0===e&&(console.warn("THREE.Color: .getHSI() target is now required"),e={h:0,s:0,i:0});var t,r,n=this.r,i=this.g,a=this.b,o=(n+i+a)/3;if(n===i&&i===a)t=0,r=0;else{var s=.5*(n-i+n-a)/Math.sqrt((n-i)*(n-i)+(n-a)*(i-a));if(s>1&&(s=1),s<-1&&(s=-1),(t=Math.acos(s))<0)return void console.warn("THREE.Color.getHSI(): hue < 0");a>i&&(t=2*Math.PI-t),t/=2*Math.PI,r=1-Math.min(n,i,a)/o}return e.h=t,e.s=r,e.i=o,e},THREE.Color.prototype.setHSI=function(e,t,r){if(t>1&&(t=1),r>1&&(r=1),0===t)this.r=this.g=this.b=r;else{var n,i,a,o=Math.PI/3;if((e*=2*Math.PI)>=0&&e<2*o)a=r*(1-t),i=3*r-((n=r*(1+t*Math.cos(e)/Math.cos(o-e)))+a);else if(e>=2*o&&e<4*o)e-=2*o,a=3*r-((n=r*(1-t))+(i=r*(1+t*Math.cos(e)/Math.cos(o-e))));else{if(!(e>=4*o&&e<6*o))return void console.warn("THREE.Color.setHSI: hue out of range");e-=4*o,i=r*(1-t),n=3*r-((a=r*(1+t*Math.cos(e)/Math.cos(o-e)))+i)}if(n<0||i<0||a<0)return void console.warn("THREE.Color.setHSI: r < 0, g < 0 or b < 0");this.r=Math.min(Math.max(n,0),1),this.g=Math.min(Math.max(i,0),1),this.b=Math.min(Math.max(a,0),1)}},THREE.Color.prototype.getLAB=function(e){void 0===e&&(console.warn("THREE.Color: .getLAB() target is now required"),e={l:0,a:0,b:0});var t,r,n,i=this.r,a=this.g,o=this.b;return r=(.2126*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.7152*(a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92)+.0722*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92))/1,n=(.0193*i+.1192*a+.9505*o)/1.08883,t=(t=(.4124*i+.3576*a+.1805*o)/.95047)>.008856?Math.pow(t,1/3):7.787*t+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,e.l=116*r-16,e.a=500*(t-r),e.b=200*(r-n),e.l=e.l/100,e.a=(e.a+128)/256,e.b=(e.b+128)/256,e},THREE.Color.prototype.setLAB=function(e,t,r){var n,i,a=((e*=100)+16)/116,o=(t=256*t-128)/500+a,s=a-(r=256*r-128)/200;i=-.9689*(o=.95047*(o*o*o>.008856?o*o*o:(o-16/116)/7.787))+1.8758*(a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787))+.0415*(s=1.08883*(s*s*s>.008856?s*s*s:(s-16/116)/7.787)),r=.0557*o+-.204*a+1.057*s,n=(n=3.2406*o+-1.5372*a+-.4986*s)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,this.r=Math.max(0,Math.min(1,n)),this.g=Math.max(0,Math.min(1,i)),this.b=Math.max(0,Math.min(1,r))},a.toHexValue=function(e,t){return t?"0x"+a.toHexValue(e).toString(16):new THREE.Color(e).getHex()},a.toHexStyle=function(e){return"#"+new THREE.Color(e).getHexString()},a.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},a.mix=function(e,t,r){return e*(1-r)+t*r},a.lerp=function(e,t,r){return e*(1-r)+t*r},a.smoothstep=function(e,t,r){return r<=e?0:r>=t?1:(r=(r-e)/(t-e))*r*(3-2*r)},a.randInt=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},a.randFloat=function(e,t){return e+Math.random()*(t-e)},a.randFloatSpread=function(e,t){return e+t*(Math.random()-.5)},a.linearRand=function(e,t){return a.randFloat(e,t)},a.gaussRand=function(e,t){var r,n,i;do{r=(n=a.randFloat(-1,1))*n+(i=a.randFloat(-1,1))*i}while(r>1);return i*t*t*Math.sqrt(-2*Math.log(r)/r)+e},a.diskRand=(o=new THREE.Vector2,function(e){var t;do{o.x=a.randFloat(-e,e),o.y=a.randFloat(-e,e),t=o.length()}while(t>e);return o}),a.ballRand=function(){var e=new THREE.Vector3;return function(t){var r;do{e.x=a.randFloat(-t,t),e.y=a.randFloat(-t,t),e.z=a.randFloat(-t,t),r=e.length()}while(r>t);return e}}(),a.circularRand=function(){var e=new THREE.Vector2;return function(t){var r=a.randFloat(0,6.283185307179586);return e.x=t*Math.cos(r),e.y=t*Math.sin(r),e}}(),a.sphericalRand=function(){var e=new THREE.Vector3;return function(t){var r=a.randFloat(-1,1),n=a.randFloat(0,6.283185307179586),i=Math.sqrt(1-r*r),o=i*Math.cos(n),s=i*Math.sin(n);return e.x=o*t,e.y=s*t,e.z=r*t,e}}(),a.createMathRandom=function(e){var t,r=function(e){for(var t=0,r=1779033703^e.length;t<e.length;t++)r=(r=Math.imul(r^e.charCodeAt(t),3432918353))<<13|r>>>19;return function(){return r=Math.imul(r^r>>>16,2246822507),r=Math.imul(r^r>>>13,3266489909),(r^=r>>>16)>>>0}}(e.toString());return t=r(),()=>((t=Math.imul(741103597,t))>>>0)/2**32},a.createRandFloat=function(e){var t=void 0!==e?a.createMathRandom(e):Math.random;return function(e,r){return e+t()*(r-e)}},a.createFbmNoise=function(e){var t=void 0!==(e=e||{}).octaves?e.octaves:4,r=void 0!==e.persistence?e.persistence:.5;switch(void 0!==e.noiseType?e.noiseType:"simplex3d"){case"perlin3d":var n=(new THREE.ImprovedNoise).noise;break;default:var i=new THREE.SimplexNoise;n=i.noise3d.bind(i)}for(var a=new Array(t),o=new Array(t),s=0,l=0;l<t;l++)a[l]=Math.pow(r,l),o[l]=Math.pow(2,l),s+=a[l];return s=1/s,function(e,r,i){for(var o=0,l=0;l<t;l++){var u=1<<l;o+=a[l]*n(e*u,r*u,i*u)}return o*s}},a.triggerWindowResize=function(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}},a.isCtrlKeyDown=function(e){return a.isDeviceMacOS()?e.metaKey:e.ctrlKey},a.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},a.createImageDropZone=function(e,t){return null==e&&((e=document.createElement("img")).style.width="50px",e.style.height="50px",e.style.border="1px solid white"),e.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"}),!1),e.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation();var r=new FileReader;r.addEventListener("load",(function(e){var r=new Image;r.onload=function(){t(r)},r.src=e.currentTarget.result}),!1),r.readAsDataURL(e.dataTransfer.files[0])}),!1),e},a.setDraggable=function(e){var t=0,r=0,n=0,i=0,a=e.children[0];function o(e){(e=e||window.event).preventDefault(),n=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(a){(a=a||window.event).preventDefault(),t=n-a.clientX,r=i-a.clientY,n=a.clientX,i=a.clientY,e.style.top=e.offsetTop-r+"px",e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null}a?a.onmousedown=o:e.onmousedown=o},a.createSpincircle=function(){if(!(e=document.getElementById("spin-circle"))){var e;(e=document.createElement("div")).id="spin-circle",e.innerHTML='\n        <div class="spin-wrapper">\n            <div class="spin"></div>\n        </div>\n    ',document.body.appendChild(e);var t=document.createElement("style");t.id="spin-style",t.innerHTML='\n        .spin-wrapper {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: 1000;\n        }\n        .spin {\n            position: relative;\n            left: 50%;\n            top: 50%;\n            width: 150px;\n            height: 150px;\n            margin: -75px 0 0 -75px;\n            border-radius: 50%;\n            border: 3px solid transparent;\n            border-top-color: #3498db;\n            -webkit-animation: spin 2s linear infinite; /* Chrome, Opera 15+, Safari 5+ */\n            animation: spin 2s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */\n        }\n        .spin:before {\n            content: "";\n            position: absolute;\n            top: 5px;\n            left: 5px;\n            right: 5px;\n            bottom: 5px;\n            border-radius: 50%;\n            border: 3px solid transparent;\n            border-top-color: #e74c3c;\n            -webkit-animation: spin 3s linear infinite; /* Chrome, Opera 15+, Safari 5+ */\n            animation: spin 3s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */\n        }\n        .spin:after {\n            content: "";\n            position: absolute;\n            top: 15px;\n            left: 15px;\n            right: 15px;\n            bottom: 15px;\n            border-radius: 50%;\n            border: 3px solid transparent;\n            border-top-color: #f9c922;\n            -webkit-animation: spin 1.5s linear infinite; /* Chrome, Opera 15+, Safari 5+ */\n            animation: spin 1.5s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */\n        }\n        @-webkit-keyframes spin {\n            0%   {\n                -webkit-transform: rotate(0deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(0deg);  /* IE 9 */\n                transform: rotate(0deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n            100% {\n                -webkit-transform: rotate(360deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(360deg);  /* IE 9 */\n                transform: rotate(360deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n        }\n        @keyframes spin {\n            0%   {\n                -webkit-transform: rotate(0deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(0deg);  /* IE 9 */\n                transform: rotate(0deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n            100% {\n                -webkit-transform: rotate(360deg);  /* Chrome, Opera 15+, Safari 3.1+ */\n                -ms-transform: rotate(360deg);  /* IE 9 */\n                transform: rotate(360deg);  /* Firefox 16+, IE 10+, Opera */\n            }\n        }\n    ',document.head.appendChild(t)}},a.showSpincircle=function(){document.getElementById("spin-circle").style.display=""},a.hideSpincircle=function(){document.getElementById("spin-circle").style.display="none"},a.removeSpincircle=function(){var e=document.getElementById("spin-circle");void 0!==e&&document.body.removeChild(e);var t=document.getElementById("spin-style");void 0!==t&&document.head.removeChild(t)},a.createProgressbar=function(){var e;if(e=document.getElementById("progress-box"))return e.style.display="",void(a.getProgressbar().style.width="0%");(e=document.createElement("div")).id="progress-box",e.innerHTML='\n        <div>\n            <div>Loading...</div>\n            <div class="progress">\n                <div id="progressbar"></div>\n            </div>\n        </div>\n    ',document.body.appendChild(e);var t=document.createElement("style");t.id="progress-style",t.innerHTML="\n        #progress-box {\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            font-size: x-large;\n            font-family: sans-serif;\n        }\n        #progress-box>div>div {\n            padding: 2px;\n        }\n        .progress {\n            width: 50vw;\n            border: 1px solid black;\n        }\n        #progressbar {\n            width: 0;\n            transition: width ease-out .5s;\n            height: 1em;\n            background-color: #888;\n            background-image: linear-gradient(\n                -45deg, \n                rgba(255, 255, 255, .5) 25%, \n                transparent 25%, \n                transparent 50%, \n                rgba(255, 255, 255, .5) 50%, \n                rgba(255, 255, 255, .5) 75%, \n                transparent 75%, \n                transparent\n            );\n            background-size: 50px 50px;\n            animation: progressanim 2s linear infinite;\n        }\n    ",document.head.appendChild(t)},a.getProgressbar=function(){return document.getElementById("progressbar")},a.updateProgressbar=function(e,t,r){void 0===r&&(r=a.getProgressbar()),r.style.width=(e/t*100|0)+"%"},a.hideProgressbar=function(){document.getElementById("progress-box").style.display="none"},a.showProgressbar=function(){document.getElementById("progress-box").style.display=""},a.errorProgressbar=function(e){console.warn(e)},a.removeProgressbar=function(){var e=document.getElementById("progress-box");void 0!==e&&document.body.removeChild(e);var t=document.getElementById("progress-style");void 0!==t&&document.head.removeChild(t)},a.getDistancePerPixel=function(){var e=a.appWorks.camera;return e.position.length()*Math.tan(e.fov/2*THREE.Math.DEG2RAD)*2*e.aspect/a.appWorks.width},a.getMouseScreenCoords=(s=new THREE.Vector2,function(e){return e.changedTouches?(s.x=e.changedTouches[0].clientX,s.y=e.changedTouches[0].clientY):(s.x=e.clientX,s.y=e.clientY),s}),a.toggleLightHelpers=function(e){a.appWorks.sceneHelpers.children.forEach((function(t){(t instanceof THREE.PointLightHelper||t instanceof THREE.SpotLightHelper||t instanceof THREE.DirectionalLightHelper||t instanceof THREE.HemisphereLightHelper)&&(t.visible=void 0!==e?e:!t.visible)}))},a.createSpritesHUD=function(e,t,r,n,i){var o;o=e.isTexture?new THREE.SpriteMaterial({map:e,transparent:!0,depthTest:!1}):!0===e.isSpriteMaterial?e:new THREE.SpriteMaterial({color:16777215,transparent:!0,depthTest:!1});var s=new THREE.Sprite(o);s.center.set(.5,.5),s.scale.set(n,i,1),s.name="spritesHUD";var l=a.appWorks.cameraHUD;return s.position.x=l.left+n/2+t,s.position.y=l.bottom+i/2+r,s},a.createTextHUD=function(e,t,r,n,i,o){!1===Array.isArray(e)&&(e=[e]);t=t||0,r=r||0;var s,l=-1;e.forEach((e,t)=>{e.length>l&&(l=e.length,s=t)});var u=document.createElement("canvas"),c=u.getContext("2d");c.font="Normal 20px Arial",u.width=c.measureText(e[s]).width,c.font="Normal 20px Arial";var h=1.2*c.measureText("M").width;u.height=h*e.length*1.2;n=n||u.width,i=i||u.height;var d=new THREE.CanvasTexture(c.canvas),f=new THREE.MeshBasicMaterial({map:d,transparent:!0,depthTest:!1}),p=new THREE.PlaneBufferGeometry(n,i),m=new THREE.Mesh(p,f);m.name="textHUD";var g=a.appWorks.cameraHUD;m.position.x=g.left+n/2+t,m.position.y=g.bottom+i/2+r,!0===o&&(m.userData.context2D=c,m.userData.texts=e,m.userData.lineHeight=h),c.font="Normal 20px Arial",c.textAlign="left",c.fillStyle="rgba(255,255,255,1.0)",c.clear();r=h;return e.forEach(e=>{c.fillText(e,0,r),r+=h}),d.needsUpdate=!0,m},a.createRenderTargetHUD=function(e,t,r,n,i,o){t=t||0,r=r||0,n=n||a.appWorks.width,i=i||a.appWorks.height;var s=e.clone(),l=new THREE.Scene;l.add(s),l.add(a.createHemisphereLight()),l.background=a.appWorks.scene.background;var u=a.appWorks.camera.clone();a.fitCameraToObject(s,u);var c=new THREE.WebGLRenderTarget(a.appWorks.width,a.appWorks.height),h=a.appWorks.renderer;h.setRenderTarget(c),h.render(l,u);var d=new THREE.MeshBasicMaterial({map:c.texture}),f=new THREE.PlaneBufferGeometry(n,i),p=new THREE.Mesh(f,d);p.name="renderTargetHUD";var m=a.appWorks.cameraHUD;return p.position.x=m.left+n/2+t,p.position.y=m.bottom+i/2+r,!0===o&&(p.userData.renderTarget=c,p.userData.rtScene=l,p.userData.rtCamera=u),p},THREE.AmbientLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.PointLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.SpotLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.DirectionalLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.HemisphereLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.PerspectiveCamera.prototype.getMousePosition=function(e,t,r,n){n=void 0!==n&&n;void 0===r&&(r=new THREE.Vector3);var i=Math.tan(.5*this.fov*THREE.Math.DEG2RAD)/this.zoom,o=a.lerp(this.near,this.far,t),s=o*i,l=this.aspect*s;return r.set(e.x*l,e.y*s,-o),!0===n&&this.localToWorld(r),r},THREE.Object3D.prototype.getColorDepthRT=(l=window.innerWidth,u=window.innerHeight,c=new THREE.WebGLRenderTarget(l,u,{stencilBuffer:!1,depthBuffer:!0,depthTexture:new THREE.DepthTexture}),h=new THREE.WebGLRenderTarget(l,u,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.FloatType}),d=new THREE.Scene,f=new THREE.OrthographicCamera(-1,1,1,-1,0,1),p=new THREE.ShaderMaterial({uniforms:{cameraNear:{value:null},cameraFar:{value:null},tDiffuse:{value:null},tDepth:{value:null}},vertexShader:"\n            varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n            }\n        ",fragmentShader:"\n            #include <packing>\n            varying vec2 vUv;\n            uniform sampler2D tDiffuse;\n            uniform sampler2D tDepth;\n            uniform float cameraNear;\n            uniform float cameraFar;\n            \n            float getOrthographicDepth( sampler2D depthTex, vec2 uv ) {\n            #ifdef RAYMARCH\n                return texture2D( depthTex, uv ).r;\n            #else\n                float fragCoordZ = texture2D( depthTex, uv ).r;\n                float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n                return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n            #endif\n            }\n            void main() {\n                gl_FragColor.rgb = texture2D( tDiffuse, vUv ).rgb;\n                gl_FragColor.a = getOrthographicDepth( tDepth, vUv );\n            }\n        "}),m=new THREE.PlaneBufferGeometry(2,2),d.add(new THREE.Mesh(m,p)),function(e){var t=a.appWorks,r=t.renderer;if(!r.extensions.get("WEBGL_depth_texture"))return alert("WEBGL_depth_texture: not supported in WebGL2..."),null;this.isRaymarch&&(p.defines={RAYMARCH:""});var n=t.scene;e=void 0!==e?e:t.camera,n.traverse(e=>{e.isLight||0!==e.children.length||(e.visible=!1)}),this.visible=!0,r.setRenderTarget(c),r.clear(),r.render(n,e);var i=p.uniforms;return i.cameraNear.value=e.near,i.cameraFar.value=e.far,i.tDiffuse.value=c.texture,i.tDepth.value=c.depthTexture,r.setRenderTarget(h),r.clear(),r.render(d,f),h}),THREE.Object3D.prototype.readColorDepthRTCube=function(){var e=new THREE.Vector3,t=[];t.push(new THREE.Vector3(-1,0,0)),t.push(new THREE.Vector3(1,0,0)),t.push(new THREE.Vector3(0,-1,0)),t.push(new THREE.Vector3(0,1,0)),t.push(new THREE.Vector3(0,0,-1)),t.push(new THREE.Vector3(0,0,1));var r=new THREE.PerspectiveCamera;return function(n,i){var o=a.appWorks.renderer;if(o.extensions.get("WEBGL_depth_texture")){r.copy(a.appWorks.camera),a.fitCameraToObject(this,r,!1);for(var s=Math.tan(.5*r.fov*THREE.Math.DEG2RAD)/r.zoom,l=.5*a.getObjectSize(this)/s*1.25,u={x:0,y:0},c=a.appWorks.dom.getBoundingClientRect(),h=new Float32Array(c.width*c.height*4),d=0;d<t.length;d++){r.position.subVectors(this.position,t[d].multiplyScalar(l)),r.lookAt(this.position);var f=this.getColorDepthRT(r);o.readRenderTargetPixels(f,0,0,c.width,c.height,h);for(var p=0,m=0;m<c.height;m++){u.y=2/(c.height-1)*m-1;for(var g=0;g<c.width;g++)u.x=2/(c.width-1)*g-1,h[p+3]<.99&&(r.getMousePosition(u,h[p+3],e,!0),n.push(e.x,e.y,e.z),i.push(h[p],h[p+1],h[p+2])),p+=4}}}else alert("WEBGL_depth_texture: not supported...")}}(),THREE.Object3D.prototype.readColorDepthRT=function(e,t){var r=a.appWorks.renderer,n=a.appWorks.camera;if(r.extensions.get("WEBGL_depth_texture")){var i={x:0,y:0},o=new THREE.Vector3,s=a.appWorks.dom.getBoundingClientRect(),l=new Float32Array(s.width*s.height*4),u=this.getColorDepthRT(n);r.readRenderTargetPixels(u,0,0,s.width,s.height,l);for(var c=0,h=0;h<s.height;h++){i.y=2/(s.height-1)*h-1;for(var d=0;d<s.width;d++)i.x=2/(s.width-1)*d-1,l[c+3]<.99&&(n.getMousePosition(i,l[c+3],o,!0),e.push(o.x,o.y,o.z),t.push(l[c],l[c+1],l[c+2])),c+=4}}else alert("WEBGL_depth_texture: not supported...")},THREE.Object3D.prototype.clonedToPoints=function(e,t){e=void 0!==e?e:.05;var r=[],n=[];(t=void 0===t||t)?this.readColorDepthRTCube(r,n):this.readColorDepthRT(r,n);var i=new THREE.BufferGeometry;i.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),i.setAttribute("color",new THREE.Float32BufferAttribute(n,3));var a=new THREE.PointsMaterial({size:e,vertexColors:THREE.VertexColors}),o=new THREE.Points(i,a);return o.name="clonedToPoints",o},THREE.Object3D.prototype.clonedToVoxels=function(e,t){e=void 0!==e?e:200;var r=[],n=[];(t=void 0===t||t)?this.readColorDepthRTCube(r,n):this.readColorDepthRT(r,n);var i,o,s,l,u,c,h,d,f,p=a.computeBoundingBox(this),m=p.getSize(new THREE.Vector3);l=u=c=Math.max(m.x,m.y,m.z)/e,i=p.min.x,o=p.min.y,s=p.min.z;for(var g,v={},y=[],_=[],b=0,E=r.length;b<E;b+=3)void 0===v[g=(h=~~((r[b]-i)/l))+"_"+(d=~~((r[b+1]-o)/u))+"_"+(f=~~((r[b+2]-s)/c))]&&(v[g]=!0,y.push(i+(h+.5)*l,o+(d+.5)*u,s+(f+.5)*c),_.push(n[b],n[b+1],n[b+2]));var w=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[l,u,c]},material:{type:"MeshBasicMaterial"}}),x=a.createInstancedMeshes(w,{positions:y,colors:_});return x.name="clonedToVoxels",x},THREE.Object3D.prototype.rayIntersect=function(e,t){var r=a.appWorks,n=r.renderer,i=r.camera,o=r.raycaster;if(n.extensions.get("WEBGL_depth_texture")){e=void 0!==e?e:r.mouseUpPosition;var s=new THREE.Vector2,l=r.dom.getBoundingClientRect();s.x=(.5*e.x+.5)*l.width,s.y=(.5*e.y+.5)*l.height;var u=this.getColorDepthRT(),c=new Float32Array(4);n.readRenderTargetPixels(u,s.x,s.y,1,1,c);var h=new THREE.Vector3;i.getMousePosition(e,c[3],h);var d=h.length();o.ray.at(d,h),t.push({distance:d,point:h,object:this})}else alert("WEBGL_depth_texture: not supported...")},THREE.Object3D.prototype.getObjectsByProperty=function(e,t,r,n){void 0===n&&(n=[]);var i=this[e];void 0!==i&&i[t]===r&&n.push(this);for(var a=0,o=this.children.length;a<o;a++){this.children[a].getObjectsByProperty(e,t,r,n)}return n},THREE.Object3D.prototype.getObjectsByType=function(e,t){void 0===t&&(t=[]),this.type===e&&t.push(this);for(var r=0,n=this.children.length;r<n;r++){this.children[r].getObjectsByType(e,t)}return t},a.getObjectName=function(e,t){t=void 0!==t?t:"";if(Array.isArray(e)){for(var r=[],n=0;n<e.length;n++)r.push(""===e[n].name?t:e[n].name);return r.join(", ").trunc(20)}return(void 0===e.name?t:e.name).trunc(20)},a.getObjectSize=(g=new THREE.Vector3,function(e){return a.computeBoundingBox(e).getSize(g),Math.max(g.x,g.y,g.z)}),a.resizeObject=function(e,t){if(t){var r=a.getObjectSize(e);e.scale.setScalar(t/r)}},a.transformObject=function(e,t,r,n){t&&e.position.set(t.x,t.y,t.z),r&&e.rotation.set(r.x,r.y,r.z),n&&e.scale.set(n.x,n.y,n.z),e.updateMatrix()},a.copyTransform=function(e,t){var r=t.position,n=t.rotation,i=t.scale;a.transformObject(e,r,n,i)},a.cloneObject=function(e){return void 0!==e.userData.type?new a[e.userData.type](e):e.clone()},THREE.BufferGeometryUtils.mergeInstancedBufferAttribute=function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.InstancedBufferAttribute(s,r,n)},a.traverseMaterials=function(e,t){e.traverse(e=>{if(!e.isMesh)return;(Array.isArray(e.material)?e.material:[e.material]).forEach(t)})},a.updateMaterialMapEncoding=function(e,t){t=t||THREE.sRGBEncoding,a.traverseMaterials(e,e=>{e.map&&(e.map.encoding=t),e.emissiveMap&&(e.emissiveMap.encoding=t),(e.map||e.emissiveMap)&&(e.needsUpdate=!0)})},a.underWaterBackground=function(){void 0!==a.appWorks.underWaterPass&&(a.appWorks.underWaterPass.enabled=!0),a.appWorks.createSceneBackground("underWater"),a.scene.fog||a.appWorks.createSceneFog({type:"exp2",color:594516,density:.004}),a.renderer.toneMappingExposure=.7},a.filmGrainBackground=function(){var e=a.appWorks.width,t=a.appWorks.height,r={aspect:a.camera.aspect,aspectCorrection:!0,grainScale:1.5/Math.min(e,t),color1:16777215,color2:3487029,noiseAlpha:.75};(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg",(function(e){a.imageProcessing(e,"FilmGrainShader",r,(function(e){a.scene.background=e}))}))},a.redColors=(v=[16752762,16416882,15308410,15761536,13458524,14423100,11674146,16711680,9109504,8388608,16737095,16729344,14381203],function(e){return v[e%v.length]}),a.greenColors=(y=[8190976,8388352,3329330,65280,2263842,32768,25600,11403055,10145074,65407,64154,9498256,10025880,9419919,3978097,2142890,3050327,526336,5597999,7048739],function(e){return y[e%y.length]}),a.blueColors=(_=[4744096,2839678,2832470,1383252,128,1388926,1383309,160,8386,16834,2446535,1403335,2842846,2049532,2844140,3174143,1411583,6723839,3914239],function(e){return _[e%_.length]}),a.randomColors=function(e){if((e=e||{}).colors)return e.colors;var t,r,n,i=void 0!==e.numInstances?Math.floor(e.numInstances):1,o=void 0!==e.colorMode?e.colorMode:"none",s=new THREE.Color,l=[];if("0"===o)for(var u=0;u<i;u++)t=Math.random(),r=Math.random(),n=Math.random(),s.setHSL(t,r,n),l.push(s.r,s.g,s.b);else if("1"===o)for(u=0;u<i;u++)t=Math.random(),r=.5,n=.5,s.setHSL(t,r,n),l.push(s.r,s.g,s.b);else if("2"===o)for(u=0;u<i;u++)t=Math.random(),r=1,n=.5,s.setHSL(t,r,n),l.push(s.r,s.g,s.b);else if("reds"===o)for(u=0;u<i;u++)s.setHex(a.redColors(u)),l.push(s.r,s.g,s.b);else if("greens"===o)for(u=0;u<i;u++)s.setHex(a.greenColors(u)),l.push(s.r,s.g,s.b);else if("blues"===o)for(u=0;u<i;u++)s.setHex(a.blueColors(u)),l.push(s.r,s.g,s.b);return l},a.cameraAutoView=function(e){if((e=e||{}).isWorking)return"stop"!==b;if("circle"===(b=e.viewMode||"circle")){var t=e.radius||20,r=new THREE.CircleBufferGeometry(t,32),n=new THREE.Mesh(r);n.name="cameraPath",n.visible=!1,a.add(n),n.add(a.camera),n.update=function(){this.rotation.y+=.003}}else if("stop"===b){var i=a.camera.parent;i&&"cameraPath"===i.name&&(i.remove(a.camera),a.camera.parent=null)}},a.fitCameraToObject=function(e,t,r){if(e){t=void 0!==t?t:a.appWorks.camera,r=void 0===r||r;var n=new THREE.Vector3,i=new THREE.Vector3,o=a.computeBoundingBox(e);o.getSize(i);var s=e.position.clone();!0===r?(o.getCenter(n),s.sub(n),n.set(0,0,0)):n.copy(s);var l=t.fov*THREE.Math.DEG2RAD,u=Math.max(i.x,i.y,i.z),c=Math.abs(u/2/Math.tan(l/2));if(c*=1.25,t===a.appWorks.camera){var h=a.appWorks.controls;h instanceof THREE.OrbitControls?(h.reset(),h.maxDistance=100*c,h.saveState()):h instanceof THREE.TrackballControls&&(h.reset(),h.maxDistance=100*c)}var d=t.position.clone();d.normalize().multiplyScalar(c),t.lookAt(n);var f=c/100,p=100*c;if(a.appWorks.history&&t===a.appWorks.camera){var m=[];r&&m.push(new a.SetPositionCommand(e,s)),m.push(new a.SetPositionCommand(t,d)),m.push(new a.SetValueCommand(t,"near",f)),m.push(new a.SetValueCommand(t,"far",p)),a.appWorks.multiCmds(m)}else r&&e.position.copy(s),t.position.copy(d),t.near=f,t.far=p;t.updateProjectionMatrix()}},a.welcomeObject=function(e){if(e.traverse((function(e){e.isMesh&&(e.frustumCulled=!1,e.castShadow=!0,e.receiveShadow=!0)})),"natureWorks"===a.appWorks.appName)a.fitCameraToObject(e);else if("viewWorks"===a.appWorks.appName&&(a.resizeObject(e,1),a.fitCameraToObject(e),a.appWorks.selectObject=e,void 0===a.appWorks.showroom)){var t=a.createShowroom(e);a.appWorks.showroom=t,a.add(t)}},a.nextShowroom=function(e,t){if("background"===t){(n=e.getObjectByName("raymarch"))&&e.remove(n),i=((i=e.activeBackground)+1)%e.backgrounds.length,e.activeBackground=i;var r=e.backgrounds[i];r.isMesh?(a.scene.background=null,e.add(r)):a.scene.background=r}if("floor"===t){var n,i;(n=e.getObjectByName("floor"))&&e.remove(n),i=((i=e.activeFloor)+1)%e.floors.length,e.activeFloor=i;var o=e.floors[i];e.add(o)}},a.createShowroom=function(e){var t=new THREE.Object3D;t.name="showroom",t.activeBackground=-1,t.backgrounds=[];var r=["arctic","burlesque","denim","mercury","neo","origin","rouge","slate"];r.forEach(e=>{var r=(new THREE.TextureLoader).load("images/wallpaper/"+e+".jpg");t.backgrounds.push(a.createBackground(r))}),(r=["blueSky","cloud","galaxy","lake","bridge","park"]).forEach(e=>{t.backgrounds.push(a.createBackground(e))}),(r=["cloudsFS","cellsFS","fogFS","sunsetFS"]).forEach(e=>{var r=a.createBackground(e);r.name="raymarch",t.backgrounds.push(r)}),t.backgrounds.push(a.createBackground(12632256)),t.activeFloor=-1,t.floors=[];var n=new THREE.TextureLoader,i=a.computeBoundingBox(e),o=i.min.y,s=i.getSize(new THREE.Vector3),l=4*(s=Math.max(s.x,s.y,s.z));function u(e,t){t=t||8;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}(f=a.createAcrylicCircle(l)).rotation.x=-Math.PI/2,f.position.y=o,f.name="floor",t.floors.push(f);var c=[];c.push({map:n.load("images/rock/crackRockDiffuse.jpg",u),normalMap:n.load("images/rock/crackRockNormal.jpg",u),aoMap:n.load("images/rock/crackRockAO.jpg",u)}),c.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/wallA.png",u),normalMap:n.load("images/pbr/wallN.png",u),aoMap:n.load("images/pbr/wallAO.png",u),roughnessMap:n.load("images/pbr/wallR.png",u)}),c.push({roughness:1,metalness:0,map:n.load("images/pbr/bathroomtileA.png",u),normalMap:n.load("images/pbr/bathroomtileN.png",u),aoMap:n.load("images/pbr/bathroomtileAO.png",u),roughnessMap:n.load("images/pbr/bathroomtileR.png",u)}),c.push({roughness:1,metalness:0,map:n.load("images/pbr/charcoalA.png",u),normalMap:n.load("images/pbr/charcoalN.png",u),roughnessMap:n.load("images/pbr/charcoalR.png",u)}),c.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/grassA.png",u),normalMap:n.load("images/pbr/grassN.png",u),aoMap:n.load("images/pbr/grassAO.png",u),roughnessMap:n.load("images/pbr/grassR.png",u)}),c.push({color:8947848,roughness:.5,metalness:.5,map:n.load("images/pbr/rustIronA.png",e=>u(e,2)),normalMap:n.load("images/pbr/rustIronN.png",e=>u(e,2)),aoMap:n.load("images/pbr/rustIronAO.png",e=>u(e,2)),roughnessMap:n.load("images/pbr/rustIronR.png",e=>u(e,2)),metalnessMap:n.load("images/pbr/rustIronM.png",e=>u(e,2))});for(var h=new THREE.CircleBufferGeometry(l,64),d=0;d<c.length;d++){var f,p=new THREE.MeshStandardMaterial(c[d]);(f=new THREE.Mesh(h,p)).receiveShadow=!0,f.rotation.x=-Math.PI/2,f.position.y=o,f.name="floor",t.floors.push(f)}a.nextShowroom(t,"background"),a.nextShowroom(t,"floor"),a.add(a.createHemisphereLight());var m=a.createDirectionalLight({shadowCameraSize:.5*l});return m.position.set(0,.75*l,.5*l),a.add(m),t},a.manhatten2D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},a.manhatten3D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)},a.createKdTree=function(e,t,r){var n=e[0];Array.isArray(n)?e=a.flattenArray(e):n instanceof THREE.Vector2?e=a.flattenVector2s(e):n instanceof THREE.Vector3?e=a.flattenVector3s(e):n instanceof THREE.Vector4&&(e=a.flattenVector4s(e)),e=new Float32Array(e);r=r||2===t?a.manhatten2D:a.manhatten3D;return new THREE.TypedArrayUtils.Kdtree(e,r,t)},a.getKdTreeNearest=function(e,t,r,n){for(var i=e.nearest(t,r,n),a=[],o=0,s=i.length;o<s;o++){var l=i[o],u={};u.position=l[0].obj,u.index=l[0].pos,u.distance=l[1],a.push(u)}return a},a.OctreeHelper=function(e,t){if(!e instanceof E.PointOctree)return null;var r=(t=t||{}).leaves||!1,n=t.color||16777215,i=[],o=[];if(r){o=a.getLeafOctants(e,!0)}else{var s=t.topLevel||0,l=t.bottomLevel||e.getDepth();o=a.getOctantsByLevels(e,s,l)}o.forEach((function(e){var t=new THREE.Box3(e.min,e.max),r=new THREE.Box3Helper(t);r.updateMatrixWorld(!0),r.geometry.applyMatrix4(r.matrixWorld),i.push(r.geometry)}));var u=THREE.BufferGeometryUtils.mergeBufferGeometries(i),c=new THREE.LineBasicMaterial({color:n});THREE.LineSegments.call(this,u,c),this.name="octreeHelper",i.forEach((function(e){e.dispose()}))},a.OctreeHelper.prototype=Object.create(THREE.LineSegments.prototype),a.OctreeHelper.prototype.constructor=a.OctreeHelper,a.getOctantsByLevels=function(e,t,r){for(var n=[];t<=r;){var i=e.findNodesByLevel(t)[Symbol.iterator]();if(i)for(var a=i.next();!a.done;)n.push(a.value),a=i.next();t++}return n},a.getLeafOctants=function(e,t){var r=[],n=e.leaves(),i=n.next();if(t=t||!0)for(;!i.done;)i.value.points&&r.push(i.value),i=n.next();else for(;!i.done;)r.push(i.value),i=n.next();return r},CanvasRenderingContext2D.prototype.clear=function(e){e&&(this.beginPath(),this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),e&&this.restore()},CanvasRenderingContext2D.prototype.circle=function(e,t,r){return this.beginPath(),this.moveTo(e+r,t),this.arc(e,t,r,0,2*Math.PI),this},CanvasRenderingContext2D.prototype.fillCircle=function(e,t,r,n){return n&&(this.fillStyle=n),this.circle(e,t,r).fill(),this},CanvasRenderingContext2D.prototype.strokeCircle=function(e,t,r,n){return n&&(this.strokeStyle=n),this.circle(e,t,r).stroke(),this},CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,n,i){var a={tl:0,tr:0,bl:0,br:0};if("object"==typeof i)for(var o in i)a[o]=i[o];if("number"==typeof i)for(var o in a)a[o]=i;return this.beginPath(),this.moveTo(e+a.tl,t),this.lineTo(e+r-a.tr,t),this.quadraticCurveTo(e+r,t,e+r,t+a.tr),this.lineTo(e+r,t+n-a.br),this.quadraticCurveTo(e+r,t+n,e+r-a.br,t+n),this.lineTo(e+a.bl,t+n),this.quadraticCurveTo(e,t+n,e,t+n-a.bl),this.lineTo(e,t+a.tl),this.quadraticCurveTo(e,t,e+a.tl,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillRoundRect=function(e,t,r,n,i,a){return a&&(this.fillStyle=a),this.roundRect(e,t,r,n,i).fill(),this},CanvasRenderingContext2D.prototype.strokeRoundRect=function(e,t,r,n,i,a){return a&&(this.strokeStyle=a),this.roundRect(e,t,r,n,i).stroke(),this},CanvasRenderingContext2D.prototype.polygon=function(e,t){t>0&&(e=function(e,t){function r(e,t,r,n,i,a){var o=Math.sqrt(Math.pow(r-e,2)+Math.pow(n-t,2)),s=a?i/o:(o-i)/o;return[e+s*(r-e),t+s*(n-t)]}var n,i,a,o,s,l,u,c,h=e.length,d=new Array(h);for(i=0;i<h;i++)(n=i-1)<0&&(n=h-1),(a=i+1)==h&&(a=0),o=e[n],s=e[i],l=e[a],u=r(o[0],o[1],s[0],s[1],t,!1),c=r(s[0],s[1],l[0],l[1],t,!0),d[i]=[u[0],u[1],s[0],s[1],c[0],c[1]];return d}(e,t)),this.beginPath();for(var r=0,n=e.length;r<n;r++){var i=e[r];0==r?this.moveTo(i[0],i[1]):this.lineTo(i[0],i[1]),t>0&&this.quadraticCurveTo(i[2],i[3],i[4],i[5])}return this.closePath(),this},CanvasRenderingContext2D.prototype.fillPolygon=function(e,t,r){return r&&(this.fillStyle=r),this.polygon(e,t).fill(),this},CanvasRenderingContext2D.prototype.strokePolygon=function(e,t,r){return r&&(this.strokeStyle=r),this.polygon(e,t).stroke(),this},CanvasRenderingContext2D.prototype.speechBubble=function(e,t,r,n,i,a,o,s){e=e||0,r=r||1,n=n||1,i=i||.2*n,a=a||e+r/2,s=s||i;var l,u,c,h=e+r,d=(t=t||0)+n;return(o=o||t+n+i)<t||o>t+n?(l=Math.min(Math.max(e+i,a-s/2),h-i-s),u=Math.min(Math.max(e+i+s,a+s/2),h-i)):(l=Math.min(Math.max(t+i,o-s/2),d-i-s),u=Math.min(Math.max(t+i+s,o+s/2),d-i)),o<t&&(c=2),o>t&&(c=3),a<e&&o>=t&&o<=d&&(c=0),a>e&&o>=t&&o<=d&&(c=1),a>=e&&a<=h&&o>=t&&o<=d&&(c=-1),this.beginPath(),this.moveTo(e+i,t),2==c?(this.lineTo(l,t),this.lineTo(a,o),this.lineTo(u,t),this.lineTo(h-i,t)):this.lineTo(h-i,t),this.quadraticCurveTo(h,t,h,t+i),1==c?(this.lineTo(h,l),this.lineTo(a,o),this.lineTo(h,u),this.lineTo(h,d-i)):this.lineTo(h,d-i),this.quadraticCurveTo(h,d,h-i,d),3==c?(this.lineTo(u,d),this.lineTo(a,o),this.lineTo(l,d),this.lineTo(e+i,d)):this.lineTo(e+i,d),this.quadraticCurveTo(e,d,e,d-i),0==c?(this.lineTo(e,u),this.lineTo(a,o),this.lineTo(e,l),this.lineTo(e,t+i)):this.lineTo(e,t+i),this.quadraticCurveTo(e,t,e+i,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.fillStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).fill(),this},CanvasRenderingContext2D.prototype.strokeSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.strokeStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).stroke(),this},a.createFaceVertexUVs=function(e){!e instanceof THREE.Geometry||(e.faceVertexUvs[0]=[],e.faces.forEach((function(t){var r=["x","y","z"].sort((function(e,r){return Math.abs(t.normal[e])>Math.abs(t.normal[r])})),n=e.vertices[t.a],i=e.vertices[t.b],a=e.vertices[t.c];e.faceVertexUvs[0].push([new THREE.Vector2(n[r[0]],n[r[1]]),new THREE.Vector2(i[r[0]],i[r[1]]),new THREE.Vector2(a[r[0]],a[r[1]])])})),e.uvsNeedUpdate=!0)},a.loadObject3D=function(e){const t=["position","rotation","quaternion","scale"];var r=Array.isArray(e)?e:[e];return r.forEach(e=>{void 0===e.object?e.object={type:"Mesh"}:void 0===e.object.type&&(e.object.type="Mesh")}),function(r){const a=[];return r.forEach(e=>{a.push(function(e){var t=e.object;if(e.url){const t=[n(e.url)];return Promise.all(t).then(t=>(t[0].name=e.url,t[0]))}if("Sprite"===t.type){const t=[o(e.material)];return Promise.all(t).then(e=>new THREE.Sprite(e[0]))}if("Points"===t.type||"Mesh"===t.type||"SkinnedMesh"===t.type||"Line"===t.type||"LineLoop"===t.type||"LineSegments"===t.type){const r=[i(e.geometry),o(e.material)];return Promise.all(r).then(e=>new THREE[t.type](e[0],e[1]))}return Promise.resolve(void 0)}(e))}),Promise.all(a).then(n=>(n.forEach((e,n)=>{var i=r[n].object;Object.keys(i).map(r=>{"type"===r||(-1!==t.indexOf(r)?e[r].fromArray(i[r]):e[r]="userData"===r?JSON.parse(JSON.stringify(i[r])):"customDepthMaterial"===r||"customDistanceMaterial"===r?i[r].clone():i[r])})}),Array.isArray(e)?Promise.resolve(n):Promise.resolve(n[0])))}(r);function n(e){return e?new Promise(t=>{(new THREE.ObjectLoader).load(e,t)}):Promise.resolve(void 0)}function i(e){if(e){if(e instanceof THREE.BufferGeometry||e instanceof THREE.Geometry)return Promise.resolve(e);if(e.parameters)return new Promise(t=>{t(new THREE[e.type](...e.parameters))});if(e.attributes){var t=new THREE.BufferGeometry;return Object.keys(e.attributes).map(r=>{t.setAttribute(r,new THREE.Float32BufferAttribute(e.attributes[r],3))}),e.index&&t.setIndex(e.index),Promise.resolve(t)}return Promise.resolve(void 0)}return Promise.resolve(void 0)}function o(e){if(e){var t;const r={},n=Object.keys(e).map(n=>{if("type"===n)t=e[n];else{if(-1!==a.TEXTURE_MAPS.indexOf(n))return function(e){if(!e)return Promise.resolve(null);return e.isTexture?Promise.resolve(e):"string"==typeof e?new Promise(t=>{(new THREE.TextureLoader).load(e,t)}):Promise.resolve(void 0)}(e[n]).then(e=>{r[n]=e});r[n]=e[n]}});return Promise.all(n).then(()=>new THREE[t](r))}return Promise.resolve(void 0)}};var w=function(){var e=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),t=[new Uint8Array([]),new Uint8Array([0,8,3]),new Uint8Array([0,1,9]),new Uint8Array([1,8,3,9,8,1]),new Uint8Array([1,2,10]),new Uint8Array([0,8,3,1,2,10]),new Uint8Array([9,2,10,0,2,9]),new Uint8Array([2,8,3,2,10,8,10,9,8]),new Uint8Array([3,11,2]),new Uint8Array([0,11,2,8,11,0]),new Uint8Array([1,9,0,2,3,11]),new Uint8Array([1,11,2,1,9,11,9,8,11]),new Uint8Array([3,10,1,11,10,3]),new Uint8Array([0,10,1,0,8,10,8,11,10]),new Uint8Array([3,9,0,3,11,9,11,10,9]),new Uint8Array([9,8,10,10,8,11]),new Uint8Array([4,7,8]),new Uint8Array([4,3,0,7,3,4]),new Uint8Array([0,1,9,8,4,7]),new Uint8Array([4,1,9,4,7,1,7,3,1]),new Uint8Array([1,2,10,8,4,7]),new Uint8Array([3,4,7,3,0,4,1,2,10]),new Uint8Array([9,2,10,9,0,2,8,4,7]),new Uint8Array([2,10,9,2,9,7,2,7,3,7,9,4]),new Uint8Array([8,4,7,3,11,2]),new Uint8Array([11,4,7,11,2,4,2,0,4]),new Uint8Array([9,0,1,8,4,7,2,3,11]),new Uint8Array([4,7,11,9,4,11,9,11,2,9,2,1]),new Uint8Array([3,10,1,3,11,10,7,8,4]),new Uint8Array([1,11,10,1,4,11,1,0,4,7,11,4]),new Uint8Array([4,7,8,9,0,11,9,11,10,11,0,3]),new Uint8Array([4,7,11,4,11,9,9,11,10]),new Uint8Array([9,5,4]),new Uint8Array([9,5,4,0,8,3]),new Uint8Array([0,5,4,1,5,0]),new Uint8Array([8,5,4,8,3,5,3,1,5]),new Uint8Array([1,2,10,9,5,4]),new Uint8Array([3,0,8,1,2,10,4,9,5]),new Uint8Array([5,2,10,5,4,2,4,0,2]),new Uint8Array([2,10,5,3,2,5,3,5,4,3,4,8]),new Uint8Array([9,5,4,2,3,11]),new Uint8Array([0,11,2,0,8,11,4,9,5]),new Uint8Array([0,5,4,0,1,5,2,3,11]),new Uint8Array([2,1,5,2,5,8,2,8,11,4,8,5]),new Uint8Array([10,3,11,10,1,3,9,5,4]),new Uint8Array([4,9,5,0,8,1,8,10,1,8,11,10]),new Uint8Array([5,4,0,5,0,11,5,11,10,11,0,3]),new Uint8Array([5,4,8,5,8,10,10,8,11]),new Uint8Array([9,7,8,5,7,9]),new Uint8Array([9,3,0,9,5,3,5,7,3]),new Uint8Array([0,7,8,0,1,7,1,5,7]),new Uint8Array([1,5,3,3,5,7]),new Uint8Array([9,7,8,9,5,7,10,1,2]),new Uint8Array([10,1,2,9,5,0,5,3,0,5,7,3]),new Uint8Array([8,0,2,8,2,5,8,5,7,10,5,2]),new Uint8Array([2,10,5,2,5,3,3,5,7]),new Uint8Array([7,9,5,7,8,9,3,11,2]),new Uint8Array([9,5,7,9,7,2,9,2,0,2,7,11]),new Uint8Array([2,3,11,0,1,8,1,7,8,1,5,7]),new Uint8Array([11,2,1,11,1,7,7,1,5]),new Uint8Array([9,5,8,8,5,7,10,1,3,10,3,11]),new Uint8Array([5,7,0,5,0,9,7,11,0,1,0,10,11,10,0]),new Uint8Array([11,10,0,11,0,3,10,5,0,8,0,7,5,7,0]),new Uint8Array([11,10,5,7,11,5]),new Uint8Array([10,6,5]),new Uint8Array([0,8,3,5,10,6]),new Uint8Array([9,0,1,5,10,6]),new Uint8Array([1,8,3,1,9,8,5,10,6]),new Uint8Array([1,6,5,2,6,1]),new Uint8Array([1,6,5,1,2,6,3,0,8]),new Uint8Array([9,6,5,9,0,6,0,2,6]),new Uint8Array([5,9,8,5,8,2,5,2,6,3,2,8]),new Uint8Array([2,3,11,10,6,5]),new Uint8Array([11,0,8,11,2,0,10,6,5]),new Uint8Array([0,1,9,2,3,11,5,10,6]),new Uint8Array([5,10,6,1,9,2,9,11,2,9,8,11]),new Uint8Array([6,3,11,6,5,3,5,1,3]),new Uint8Array([0,8,11,0,11,5,0,5,1,5,11,6]),new Uint8Array([3,11,6,0,3,6,0,6,5,0,5,9]),new Uint8Array([6,5,9,6,9,11,11,9,8]),new Uint8Array([5,10,6,4,7,8]),new Uint8Array([4,3,0,4,7,3,6,5,10]),new Uint8Array([1,9,0,5,10,6,8,4,7]),new Uint8Array([10,6,5,1,9,7,1,7,3,7,9,4]),new Uint8Array([6,1,2,6,5,1,4,7,8]),new Uint8Array([1,2,5,5,2,6,3,0,4,3,4,7]),new Uint8Array([8,4,7,9,0,5,0,6,5,0,2,6]),new Uint8Array([7,3,9,7,9,4,3,2,9,5,9,6,2,6,9]),new Uint8Array([3,11,2,7,8,4,10,6,5]),new Uint8Array([5,10,6,4,7,2,4,2,0,2,7,11]),new Uint8Array([0,1,9,4,7,8,2,3,11,5,10,6]),new Uint8Array([9,2,1,9,11,2,9,4,11,7,11,4,5,10,6]),new Uint8Array([8,4,7,3,11,5,3,5,1,5,11,6]),new Uint8Array([5,1,11,5,11,6,1,0,11,7,11,4,0,4,11]),new Uint8Array([0,5,9,0,6,5,0,3,6,11,6,3,8,4,7]),new Uint8Array([6,5,9,6,9,11,4,7,9,7,11,9]),new Uint8Array([10,4,9,6,4,10]),new Uint8Array([4,10,6,4,9,10,0,8,3]),new Uint8Array([10,0,1,10,6,0,6,4,0]),new Uint8Array([8,3,1,8,1,6,8,6,4,6,1,10]),new Uint8Array([1,4,9,1,2,4,2,6,4]),new Uint8Array([3,0,8,1,2,9,2,4,9,2,6,4]),new Uint8Array([0,2,4,4,2,6]),new Uint8Array([8,3,2,8,2,4,4,2,6]),new Uint8Array([10,4,9,10,6,4,11,2,3]),new Uint8Array([0,8,2,2,8,11,4,9,10,4,10,6]),new Uint8Array([3,11,2,0,1,6,0,6,4,6,1,10]),new Uint8Array([6,4,1,6,1,10,4,8,1,2,1,11,8,11,1]),new Uint8Array([9,6,4,9,3,6,9,1,3,11,6,3]),new Uint8Array([8,11,1,8,1,0,11,6,1,9,1,4,6,4,1]),new Uint8Array([3,11,6,3,6,0,0,6,4]),new Uint8Array([6,4,8,11,6,8]),new Uint8Array([7,10,6,7,8,10,8,9,10]),new Uint8Array([0,7,3,0,10,7,0,9,10,6,7,10]),new Uint8Array([10,6,7,1,10,7,1,7,8,1,8,0]),new Uint8Array([10,6,7,10,7,1,1,7,3]),new Uint8Array([1,2,6,1,6,8,1,8,9,8,6,7]),new Uint8Array([2,6,9,2,9,1,6,7,9,0,9,3,7,3,9]),new Uint8Array([7,8,0,7,0,6,6,0,2]),new Uint8Array([7,3,2,6,7,2]),new Uint8Array([2,3,11,10,6,8,10,8,9,8,6,7]),new Uint8Array([2,0,7,2,7,11,0,9,7,6,7,10,9,10,7]),new Uint8Array([1,8,0,1,7,8,1,10,7,6,7,10,2,3,11]),new Uint8Array([11,2,1,11,1,7,10,6,1,6,7,1]),new Uint8Array([8,9,6,8,6,7,9,1,6,11,6,3,1,3,6]),new Uint8Array([0,9,1,11,6,7]),new Uint8Array([7,8,0,7,0,6,3,11,0,11,6,0]),new Uint8Array([7,11,6]),new Uint8Array([7,6,11]),new Uint8Array([3,0,8,11,7,6]),new Uint8Array([0,1,9,11,7,6]),new Uint8Array([8,1,9,8,3,1,11,7,6]),new Uint8Array([10,1,2,6,11,7]),new Uint8Array([1,2,10,3,0,8,6,11,7]),new Uint8Array([2,9,0,2,10,9,6,11,7]),new Uint8Array([6,11,7,2,10,3,10,8,3,10,9,8]),new Uint8Array([7,2,3,6,2,7]),new Uint8Array([7,0,8,7,6,0,6,2,0]),new Uint8Array([2,7,6,2,3,7,0,1,9]),new Uint8Array([1,6,2,1,8,6,1,9,8,8,7,6]),new Uint8Array([10,7,6,10,1,7,1,3,7]),new Uint8Array([10,7,6,1,7,10,1,8,7,1,0,8]),new Uint8Array([0,3,7,0,7,10,0,10,9,6,10,7]),new Uint8Array([7,6,10,7,10,8,8,10,9]),new Uint8Array([6,8,4,11,8,6]),new Uint8Array([3,6,11,3,0,6,0,4,6]),new Uint8Array([8,6,11,8,4,6,9,0,1]),new Uint8Array([9,4,6,9,6,3,9,3,1,11,3,6]),new Uint8Array([6,8,4,6,11,8,2,10,1]),new Uint8Array([1,2,10,3,0,11,0,6,11,0,4,6]),new Uint8Array([4,11,8,4,6,11,0,2,9,2,10,9]),new Uint8Array([10,9,3,10,3,2,9,4,3,11,3,6,4,6,3]),new Uint8Array([8,2,3,8,4,2,4,6,2]),new Uint8Array([0,4,2,4,6,2]),new Uint8Array([1,9,0,2,3,4,2,4,6,4,3,8]),new Uint8Array([1,9,4,1,4,2,2,4,6]),new Uint8Array([8,1,3,8,6,1,8,4,6,6,10,1]),new Uint8Array([10,1,0,10,0,6,6,0,4]),new Uint8Array([4,6,3,4,3,8,6,10,3,0,3,9,10,9,3]),new Uint8Array([10,9,4,6,10,4]),new Uint8Array([4,9,5,7,6,11]),new Uint8Array([0,8,3,4,9,5,11,7,6]),new Uint8Array([5,0,1,5,4,0,7,6,11]),new Uint8Array([11,7,6,8,3,4,3,5,4,3,1,5]),new Uint8Array([9,5,4,10,1,2,7,6,11]),new Uint8Array([6,11,7,1,2,10,0,8,3,4,9,5]),new Uint8Array([7,6,11,5,4,10,4,2,10,4,0,2]),new Uint8Array([3,4,8,3,5,4,3,2,5,10,5,2,11,7,6]),new Uint8Array([7,2,3,7,6,2,5,4,9]),new Uint8Array([9,5,4,0,8,6,0,6,2,6,8,7]),new Uint8Array([3,6,2,3,7,6,1,5,0,5,4,0]),new Uint8Array([6,2,8,6,8,7,2,1,8,4,8,5,1,5,8]),new Uint8Array([9,5,4,10,1,6,1,7,6,1,3,7]),new Uint8Array([1,6,10,1,7,6,1,0,7,8,7,0,9,5,4]),new Uint8Array([4,0,10,4,10,5,0,3,10,6,10,7,3,7,10]),new Uint8Array([7,6,10,7,10,8,5,4,10,4,8,10]),new Uint8Array([6,9,5,6,11,9,11,8,9]),new Uint8Array([3,6,11,0,6,3,0,5,6,0,9,5]),new Uint8Array([0,11,8,0,5,11,0,1,5,5,6,11]),new Uint8Array([6,11,3,6,3,5,5,3,1]),new Uint8Array([1,2,10,9,5,11,9,11,8,11,5,6]),new Uint8Array([0,11,3,0,6,11,0,9,6,5,6,9,1,2,10]),new Uint8Array([11,8,5,11,5,6,8,0,5,10,5,2,0,2,5]),new Uint8Array([6,11,3,6,3,5,2,10,3,10,5,3]),new Uint8Array([5,8,9,5,2,8,5,6,2,3,8,2]),new Uint8Array([9,5,6,9,6,0,0,6,2]),new Uint8Array([1,5,8,1,8,0,5,6,8,3,8,2,6,2,8]),new Uint8Array([1,5,6,2,1,6]),new Uint8Array([1,3,6,1,6,10,3,8,6,5,6,9,8,9,6]),new Uint8Array([10,1,0,10,0,6,9,5,0,5,6,0]),new Uint8Array([0,3,8,5,6,10]),new Uint8Array([10,5,6]),new Uint8Array([11,5,10,7,5,11]),new Uint8Array([11,5,10,11,7,5,8,3,0]),new Uint8Array([5,11,7,5,10,11,1,9,0]),new Uint8Array([10,7,5,10,11,7,9,8,1,8,3,1]),new Uint8Array([11,1,2,11,7,1,7,5,1]),new Uint8Array([0,8,3,1,2,7,1,7,5,7,2,11]),new Uint8Array([9,7,5,9,2,7,9,0,2,2,11,7]),new Uint8Array([7,5,2,7,2,11,5,9,2,3,2,8,9,8,2]),new Uint8Array([2,5,10,2,3,5,3,7,5]),new Uint8Array([8,2,0,8,5,2,8,7,5,10,2,5]),new Uint8Array([9,0,1,5,10,3,5,3,7,3,10,2]),new Uint8Array([9,8,2,9,2,1,8,7,2,10,2,5,7,5,2]),new Uint8Array([1,3,5,3,7,5]),new Uint8Array([0,8,7,0,7,1,1,7,5]),new Uint8Array([9,0,3,9,3,5,5,3,7]),new Uint8Array([9,8,7,5,9,7]),new Uint8Array([5,8,4,5,10,8,10,11,8]),new Uint8Array([5,0,4,5,11,0,5,10,11,11,3,0]),new Uint8Array([0,1,9,8,4,10,8,10,11,10,4,5]),new Uint8Array([10,11,4,10,4,5,11,3,4,9,4,1,3,1,4]),new Uint8Array([2,5,1,2,8,5,2,11,8,4,5,8]),new Uint8Array([0,4,11,0,11,3,4,5,11,2,11,1,5,1,11]),new Uint8Array([0,2,5,0,5,9,2,11,5,4,5,8,11,8,5]),new Uint8Array([9,4,5,2,11,3]),new Uint8Array([2,5,10,3,5,2,3,4,5,3,8,4]),new Uint8Array([5,10,2,5,2,4,4,2,0]),new Uint8Array([3,10,2,3,5,10,3,8,5,4,5,8,0,1,9]),new Uint8Array([5,10,2,5,2,4,1,9,2,9,4,2]),new Uint8Array([8,4,5,8,5,3,3,5,1]),new Uint8Array([0,4,5,1,0,5]),new Uint8Array([8,4,5,8,5,3,9,0,5,0,3,5]),new Uint8Array([9,4,5]),new Uint8Array([4,11,7,4,9,11,9,10,11]),new Uint8Array([0,8,3,4,9,7,9,11,7,9,10,11]),new Uint8Array([1,10,11,1,11,4,1,4,0,7,4,11]),new Uint8Array([3,1,4,3,4,8,1,10,4,7,4,11,10,11,4]),new Uint8Array([4,11,7,9,11,4,9,2,11,9,1,2]),new Uint8Array([9,7,4,9,11,7,9,1,11,2,11,1,0,8,3]),new Uint8Array([11,7,4,11,4,2,2,4,0]),new Uint8Array([11,7,4,11,4,2,8,3,4,3,2,4]),new Uint8Array([2,9,10,2,7,9,2,3,7,7,4,9]),new Uint8Array([9,10,7,9,7,4,10,2,7,8,7,0,2,0,7]),new Uint8Array([3,7,10,3,10,2,7,4,10,1,10,0,4,0,10]),new Uint8Array([1,10,2,8,7,4]),new Uint8Array([4,9,1,4,1,7,7,1,3]),new Uint8Array([4,9,1,4,1,7,0,8,1,8,7,1]),new Uint8Array([4,0,3,7,4,3]),new Uint8Array([4,8,7]),new Uint8Array([9,10,8,10,11,8]),new Uint8Array([3,0,9,3,9,11,11,9,10]),new Uint8Array([0,1,10,0,10,8,8,10,11]),new Uint8Array([3,1,10,11,3,10]),new Uint8Array([1,2,11,1,11,9,9,11,8]),new Uint8Array([3,0,9,3,9,11,1,2,9,2,11,9]),new Uint8Array([0,2,11,8,0,11]),new Uint8Array([3,2,11]),new Uint8Array([2,3,8,2,8,10,10,8,9]),new Uint8Array([9,10,2,0,9,2]),new Uint8Array([2,3,8,2,8,10,0,1,8,1,10,8]),new Uint8Array([1,10,2]),new Uint8Array([1,3,8,9,1,8]),new Uint8Array([0,9,1]),new Uint8Array([0,3,8]),new Uint8Array([])],r=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],n=[new Uint8Array([0,1]),new Uint8Array([1,2]),new Uint8Array([2,3]),new Uint8Array([3,0]),new Uint8Array([4,5]),new Uint8Array([5,6]),new Uint8Array([6,7]),new Uint8Array([7,4]),new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7])],i=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],a=[new Uint8Array([0,2,3,7]),new Uint8Array([0,6,2,7]),new Uint8Array([0,4,6,7]),new Uint8Array([0,6,1,2]),new Uint8Array([0,1,6,4]),new Uint8Array([5,6,1,4])],o=new Int32Array(24),s=new Int32Array(256);!function(){for(var e=0,t=0;t<8;++t)for(var r=1;r<=4;r<<=1){var n=t^r;t<=n&&(o[e++]=t,o[e++]=n)}for(t=0;t<256;++t){var i=0;for(r=0;r<24;r+=2){i|=!!(t&1<<o[r])!==!!(t&1<<o[r+1])?1<<(r>>1):0}s[t]=i}}();var l=new Array(4096);!function(){for(var e=0;e<l.length;++e)l[e]=0}();var u=[],c=function(e,t,r){var n=0;return n+=e[0],n+=u[1]*e[1],r[n+=u[2]*e[2]]};return{marchingCubes:function(i,a,o,s){s=s||0,u=[1,i[0],i[0]*i[1]],o||(o=[[0,0,0],i]);for(var l=[0,0,0],h=[0,0,0],d=0;d<3;++d)l[d]=(o[1][d]-o[0][d])/i[d],h[d]=o[0][d];var f=[],p=[],m=0,g=new Array(8),v=new Array(12),y=[0,0,0];for(y[2]=0;y[2]<i[2]-1;++y[2],m+=i[0])for(y[1]=0;y[1]<i[1]-1;++y[1],++m)for(y[0]=0;y[0]<i[0]-1;++y[0],++m){var _=0;if("function"==typeof a)for(d=0;d<8;++d){var b=r[d],E=a(l[0]*(y[0]+b[0])+h[0],l[1]*(y[1]+b[1])+h[1],l[2]*(y[2]+b[2])+h[2])-s;g[d]=E,_|=E>0?1<<d:0}else for(d=0;d<8;++d){b=r[d],E=c([y[0]+b[0],y[1]+b[1],y[2]+b[2]],0,a)-s;g[d]=E,_|=E>0?1<<d:0}var w=e[_];if(0!==w){for(d=0;d<12;++d)if(0!=(w&1<<d)){v[d]=f.length;var x=[0,0,0],T=n[d],M=r[T[0]],S=r[T[1]],A=g[T[0]],R=A-g[T[1]],k=0;Math.abs(R)>1e-6&&(k=A/R);for(var P=0;P<3;++P)x[P]=l[P]*(y[P]+M[P]+k*(S[P]-M[P]))+h[P];f.push(x)}var L=t[_];for(d=0;d<L.length;d+=3)p.push([v[L[d]],v[L[d+1]],v[L[d+2]]])}}return{vertices:f,faces:p}},marchingTetrahedra:function(e,t,r,n){n=n||0,u=[1,e[0],e[0]*e[1]],r||(r=[[0,0,0],e]);for(var o=[0,0,0],s=[0,0,0],l=0;l<3;++l)o[l]=(r[1][l]-r[0][l])/e[l],s[l]=r[0][l];var h=[],d=[],f=0,p=new Float32Array(8),m=[0,0,0];function g(e,t){var r=p[e],n=p[t],a=i[e],l=i[t],u=[m[0],m[1],m[2]],c=r-n;Math.abs(c)>1e-6&&(c=r/c);for(var d=0;d<3;++d)u[d]=o[d]*(u[d]+a[d]+c*(l[d]-a[d]))+s[d];return h.push(u),h.length-1}for(m[2]=0;m[2]<e[2]-1;++m[2],f+=e[0])for(m[1]=0;m[1]<e[1]-1;++m[1],++f)for(m[0]=0;m[0]<e[0]-1;++m[0],++f){if("function"==typeof t)for(l=0;l<8;++l){var v=i[l];p[l]=t(o[0]*(m[0]+v[0])+s[0],o[1]*(m[1]+v[1])+s[1],o[2]*(m[2]+v[2])+s[2])-n}else for(l=0;l<8;++l){v=i[l];p[l]=c([m[0]+v[0],m[1]+v[1],m[2]+v[2]],0,t)-n}for(l=0;l<a.length;++l){var y=a[l],_=0;switch(p[y[0]]<0&&(_|=1),p[y[1]]<0&&(_|=2),p[y[2]]<0&&(_|=4),p[y[3]]<0&&(_|=8),_){case 0:case 15:break;case 14:d.push([g(y[0],y[1]),g(y[0],y[3]),g(y[0],y[2])]);break;case 1:d.push([g(y[0],y[1]),g(y[0],y[2]),g(y[0],y[3])]);break;case 13:d.push([g(y[1],y[0]),g(y[1],y[2]),g(y[1],y[3])]);break;case 2:d.push([g(y[1],y[0]),g(y[1],y[3]),g(y[1],y[2])]);break;case 12:d.push([g(y[1],y[2]),g(y[1],y[3]),g(y[0],y[3]),g(y[0],y[2])]);break;case 3:d.push([g(y[1],y[2]),g(y[0],y[2]),g(y[0],y[3]),g(y[1],y[3])]);break;case 4:d.push([g(y[2],y[0]),g(y[2],y[1]),g(y[2],y[3])]);break;case 11:d.push([g(y[2],y[0]),g(y[2],y[3]),g(y[2],y[1])]);break;case 5:d.push([g(y[0],y[1]),g(y[1],y[2]),g(y[2],y[3]),g(y[0],y[3])]);break;case 10:d.push([g(y[0],y[1]),g(y[0],y[3]),g(y[2],y[3]),g(y[1],y[2])]);break;case 6:d.push([g(y[2],y[3]),g(y[0],y[2]),g(y[0],y[1]),g(y[1],y[3])]);break;case 9:d.push([g(y[2],y[3]),g(y[1],y[3]),g(y[0],y[1]),g(y[0],y[2])]);break;case 7:d.push([g(y[3],y[0]),g(y[3],y[1]),g(y[3],y[2])]);break;case 8:d.push([g(y[3],y[0]),g(y[3],y[2]),g(y[3],y[1])])}}}return{vertices:h,faces:d}},surfaceNets:function(e,t,r,n){n=n||0,u=[1,e[0],e[0]*e[1]],r||(r=[[0,0,0],e]);for(var i=[0,0,0],a=[0,0,0],h=0;h<3;++h)i[h]=(r[1][h]-r[0][h])/e[h],a[h]=r[0][h];var d=[],f=[],p=[0,0,0],m=[1,e[0]+1,(e[0]+1)*(e[1]+1)],g=[0,0,0,0,0,0,0,0],v=1;if(2*m[2]>l.length){var y=l.length;for(l.length=2*m[2];y<l.length;)l[y++]=0}for(p[2]=0;p[2]<e[2]-1;++p[2],e[0],v^=1,m[2]=-m[2]){var _=1+(e[0]+1)*(1+v*(e[1]+1));for(p[1]=0;p[1]<e[1]-1;++p[1],_+=2)for(p[0]=0;p[0]<e[0]-1;++p[0],++_){var b=0,E=0;if("function"==typeof t)for(var w=0;w<2;++w)for(var x=0;x<2;++x)for(h=0;h<2;++h,++E){var T=t(i[0]*(p[0]+h)+a[0],i[1]*(p[1]+x)+a[1],i[2]*(p[2]+w)+a[2])-n;g[E]=T,b|=T<0?1<<E:0}else for(w=0;w<2;++w)for(x=0;x<2;++x)for(h=0;h<2;++h,++E){T=c([p[0]+h,p[1]+x,p[2]+w],0,t)-n;g[E]=T,b|=T<0?1<<E:0}if(0!==b&&255!==b){var M=s[b],S=[0,0,0],A=0;for(h=0;h<12;++h)if(M&1<<h){++A;var R=o[h<<1],k=o[1+(h<<1)],P=g[R],L=P-g[k];if(Math.abs(L)>1e-6){L=P/L;for(x=0,w=1;x<3;++x,w<<=1){var C=R&w,I=k&w;S[x]+=C!==I?C?1-L:L:C?1:0}}}var H=1/A;for(h=0;h<3;++h)S[h]=i[h]*(p[h]+H*S[h])+a[h];l[_]=d.length,d.push(S);for(h=0;h<3;++h)if(M&1<<h){var O=(h+1)%3,D=(h+2)%3;if(0!==p[O]&&0!==p[D]){var F=m[O],N=m[D];1&b?(f.push([l[_],l[_-F],l[_-N]]),f.push([l[_-N],l[_-F],l[_-F-N]])):(f.push([l[_],l[_-N],l[_-F]]),f.push([l[_-F],l[_-N],l[_-F-N]]))}}}}}return{vertices:d,faces:f}}}},x=r(18),T=r.n(x),M=r(62),S={};S.sample=r(152),S.vol2Msh=r(155),S.rasterize=r(34),S.voxelize=r(157),S.normals=r(14),S.spatialGrid=r(35),S.signedDistance=r(37),S.convexHull=r(160),S.pointInPolygon=r(164),S.haarTree=r(23),S.refineMesh=r(41),S.fixMesh=r(166),S.smoothVertices=r(167),S.deformLaplacian=r(168),S.loopSubdivide=r(169),S.meanCurvature=r(171),S.alphaShape=r(175),S.geodesicDistance=r(188).geodesic_distance,S.hull2D=r(190),S.fft=r(46),S.gaussBlur=r(192),S.pool=r(1),S.ndarray=r(10),S.ndarrayOps=r(25),a.IsosurfaceGeometry=function(e,t,r,n,i){t=t||[[-1,-1,-1],[1,1,1]],i=i||"surfaceNets",n=n||0;if("number"==typeof(e=e||32)){g=t[1][0]-t[0][0],v=t[1][1]-t[0][1],y=t[1][2]-t[0][2];var o=Math.max(g,v,y)/e;(e=[])[0]=Math.max(~~(g/o),4),e[1]=Math.max(~~(v/o),4),e[2]=Math.max(~~(y/o),4)}THREE.Geometry.call(this);var s,l,u,c=new w;switch(i){case"surfaceNets":s=c.surfaceNets(e,r,t,n);break;case"marchingCubes":s=c.marchingCubes(e,r,t,n);break;case"marchingTetrahedra":s=c.marchingTetrahedra(e,r,t,n)}for(var h=0;h<s.vertices.length;++h)l=s.vertices[h],this.vertices.push(new THREE.Vector3(l[0],l[1],l[2]));for(h=0;h<s.faces.length;++h)3===(u=s.faces[h]).length?this.faces.push(new THREE.Face3(u[0],u[1],u[2])):4===u.length&&(this.faces.push(new THREE.Face3(u[0],u[1],u[2])),this.faces.push(new THREE.Face3(u[0],u[2],u[3])));if(this.mergeVertices(),"function"==typeof r){for(var d,f,p,m,g=new THREE.Vector3(.001,0,0),v=new THREE.Vector3(0,.001,0),y=new THREE.Vector3(0,0,.001),_=new THREE.Vector3,b=[],E=(h=0,this.vertices.length);h<E;h++)l=this.vertices[h],d=x(_.addVectors(l,g))-x(_.subVectors(l,g)),f=x(_.addVectors(l,v))-x(_.subVectors(l,v)),p=x(_.addVectors(l,y))-x(_.subVectors(l,y)),m=new THREE.Vector3(d,f,p).normalize(),b.push(m);for(h=0,E=this.faces.length;h<E;h++)(u=this.faces[h]).vertexNormals=[b[u.a],b[u.b],b[u.c]];function x(e){return r(e.x,e.y,e.z)}}else this.computeVertexNormals();a.createFaceVertexUVs(this)},a.IsosurfaceGeometry.prototype=Object.create(THREE.Geometry.prototype),a.IsosurfaceGeometry.prototype.constructor=a.IsosurfaceGeometry,a.UDelaunayGeometry=function(e,t){t=(t||"xz").toLowerCase();THREE.BufferGeometry.call(this);var r=null;"xz"===t?r=T.a.from(e.map(e=>[e.x,e.z])):"xy"===t?r=T.a.from(e.map(e=>[e.x,e.y])):"yz"===t&&(r=T.a.from(e.map(e=>[e.y,e.z])));var n=new Uint16Array(r.triangles);this.setIndex(new THREE.BufferAttribute(n,1)),this.setFromPoints(e),this.computeVertexNormals()},a.UDelaunayGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),a.UDelaunayGeometry.prototype.constructor=a.UDelaunayGeometry,a.CDelaunayGeometry=function(e,t,r){t=t||[],r=r||[];THREE.BufferGeometry.call(this);var n=0;e.forEach(e=>{e.id=n++});var i=new M.SweepContext(e);t.length>0&&(t.forEach(e=>{e.forEach(e=>{e.id=n++})}),i.addHoles(t)),r.length>0&&(r.forEach(e=>{e.id=n++}),i.addPoints(r)),i.triangulate();var o=i.getTriangles(),s=[];o.forEach(e=>{e.getPoints().forEach(e=>{s.push(e.id)})}),this.setIndex(new THREE.Uint16BufferAttribute(s,1));var l=e.concat(t,r);l=a.flattenArray(l),this.setFromPoints(l),this.computeVertexNormals()},a.CDelaunayGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),a.CDelaunayGeometry.prototype.constructor=a.CDelaunayGeometry,a.simplifyGeometry=function(e,t){t=t||.5;if(!e.isGeometry&&!e.isBufferGeometry)return null;e=a.toGeometry(e);var r=Math.floor(e.vertices.length*t);return(e=(new THREE.SimplifyModifier).modify(e,r)).computeVertexNormals(),e},a.subdivideGeometry=function(e,t){t=t||1;return e.isGeometry||e.isBufferGeometry?e=new THREE.SubdivisionModifier(t).modify(e):null},a.RingGeometry=function(e,t,r,n,i,a){THREE.Geometry.call(this),this.type="JamieRingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,l=[],u=e,c=(t-e)/(n=void 0!==n?Math.max(1,n):1);for(o=0;o<n+1;o++){for(s=0;s<r+1;s++){var h=new THREE.Vector3,d=i+s/r*a;h.x=u*Math.cos(d),h.z=u*Math.sin(d),this.vertices.push(h),l.push(new THREE.Vector2(s/r,o/n))}u+=c}var f=new THREE.Vector3(1,0,0);for(o=0;o<n;o++){var p=o*(r+1);for(s=0;s<r;s++){var m=d=s+p,g=d+r+1,v=d+r+2;this.faces.push(new THREE.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),m=d,g=d+r+2,v=d+1,this.faces.push(new THREE.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,u)},a.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),a.RingGeometry.prototype.constructor=a.RingGeometry,a.computeChildVertexFaceAmount=function(e){var t=0,r=0,n=0;return e.traverse((function(e){if(t++,e.isMesh){var i=1;e instanceof a.InstancedMesh&&(i=e.numInstances);var o=e.geometry;o.isGeometry?(r+=o.vertices.length,n+=o.faces.length):o.isBufferGeometry&&(r+=o.attributes.position.count*i,null!==o.index?n+=o.index.count/3*i:n+=o.attributes.position.count/3*i)}})),{objects:t,vertices:r,faces:n}},a.computeMassProperties=function(e){var t=0,r=0;return e.traverse((function(e){if(e.isMesh){var i=function(e){var t=0,r=0,i=new THREE.Triangle,o=e.geometry;if(o.isGeometry){if(o.faces.length<1)return{area:0,volume:0};var s=o.vertices;o.faces.forEach((function(e){t+=i.set(s[e.a],s[e.b],s[e.c]).getArea(),r+=n(s[e.a],s[e.b],s[e.c])}))}else if(o.isBufferGeometry){var l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3;if(o.index){if(o.index.count<3)return{area:0,volume:0};for(var h,d,f,p=o.attributes.position.array,m=o.index.array,g=0,v=o.index.count;g<v;g+=3)h=m[g+0],d=m[g+1],f=m[g+2],l.set(p[3*h],p[3*h+1],p[3*h+2]),u.set(p[3*d],p[3*d+1],p[3*d+2]),c.set(p[3*f],p[3*f+1],p[3*f+2]),t+=i.set(l,u,c).getArea(),r+=n(l,u,c)}else{if(o.attributes.position.count<3)return{area:0,volume:0};p=o.attributes.position.array;var y=3*o.attributes.position.count;for(g=0;g<y;g+=9)l.set(p[g+0],p[g+1],p[g+2]),u.set(p[g+3],p[g+4],p[g+5]),c.set(p[g+6],p[g+7],p[g+8]),t+=i.set(l,u,c).getArea(),r+=n(l,u,c)}}if(e instanceof a.InstancedMesh){var _=e.numInstances;return{area:t*_,volume:r*_}}return{area:t,volume:r}}(e);t+=i.area,r+=i.volume}})),{area:t,volume:r};function n(e,t,r){return(-(r.x*t.y*e.z)+t.x*r.y*e.z+r.x*e.y*t.z-e.x*r.y*t.z-t.x*e.y*r.z+e.x*t.y*r.z)/6}},a.computeBoundingBox=function(e){return(new THREE.Box3).setFromObject(e)},a.computeBoundingSphere=function(){var e,t,r,n=new THREE.Vector3;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)n.copy(o[t]),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}else if(a.isBufferGeometry){var s;if(void 0!==(s=a.attributes.instancePosition?a.attributes.instancePosition:a.attributes.position))for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}}return function(t){return e=[],t.updateMatrixWorld(!0),t.traverse(i),e.length>0?(new THREE.Sphere).setFromPoints(e):void 0}}(),a.isEmptyGeometry=function(e){return!(e.isGeometry&&e.vertices.length>0)&&!(e.isBufferGeometry&&e.attributes.position.count>0)},a.translateGeometry=function(e,t){if(t.isVector3){var r=(new THREE.Matrix4).makeTranslation(t.x,t.y,t.z);e.applyMatrix(r)}},a.rotateGeometry=function(e,t,r){if(0!==r){var n=new THREE.Matrix4;switch(t.toLowerCase()){case"x":n.makeRotationX(r);break;case"y":n.makeRotationY(r);break;case"z":n.makeRotationZ(r);break;default:return}e.applyMatrix(n)}},a.computeVertexNormals=function(e){var t=!1;if(!0===e.isGeometry){var r=e.faces[0].vertexNormals;r&&3===r.length&&(t=!0)}else if(!0===e.isBufferGeometry){var n=e.attributes.normal;n&&n.count>0&&(t=!0)}!1===t&&e.computeVertexNormals()},a.toNonIndexedBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry?t=(new THREE.BufferGeometry).fromGeometry(e):e instanceof THREE.BufferGeometry&&null!==e.index&&(t=e.toNonIndexed()),t},a.toBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry&&(t=(new THREE.BufferGeometry).fromGeometry(e)),t},a.toGeometry=function(e){return e instanceof THREE.BufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)).mergeVertices(),e},a.rectangularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.width?e.width:1,n=void 0!==e.height?e.height:1,i=void 0!==e.numWidth?Math.floor(e.numWidth):1,a=void 0!==e.numHeight?Math.floor(e.numHeight):1,o=[];function s(e,t,r,n,i,a,s){var l,u,c,h,d=a<=1?1:n/(a-1),f=s<=1?1:i/(s-1),p=a<=1?0:n/2,m=s<=1?0:i/2,g=new THREE.Vector3;for(u=0;u<s;u++)for(h=u*f-m,l=0;l<a;l++)c=l*d-p,g[e]=c,g[t]=h,g[r]=0,o.push(g.x,g.y,g.z)}return"x"===t?s("y","z",t,r,n,i,a):"y"===t?s("z","x",t,r,n,i,a):"z"===t&&s("x","y",t,r,n,i,a),o},a.circularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.radiusStart?e.radiusStart:1,n=void 0!==e.radiusLength?e.radiusLength:r+1,i=void 0!==e.numRadius?Math.floor(e.numRadius):1,a=void 0!==e.angleStart?e.angleStart:0,o=void 0!==e.angleLength?e.angleLength:2*Math.PI,s=void 0!==e.numAngle?Math.floor(e.numAngle):4,l=[];function u(e,t,u){var c,h,d,f,p=i<=1?1:n/(i-1),m=s<=1?1:o/(s-1);o===2*Math.PI&&(m=o/s);var g=new THREE.Vector3;for(c=0;c<i;c++)for(d=c*p+r,h=0;h<s;h++)f=h*m+a,g[e]=d*Math.cos(f),g[t]=d*Math.sin(f),g[u]=0,l.push(g.x,g.y,g.z)}return"x"===t?u("y","z",t):"y"===t?u("z","x",t):"z"===t&&u("x","y",t),l},a.structuredPositions=function(e){return(e=e||{}).positions?e.positions:"rectangular"===e.pattern?a.rectangularPositions(e):"circular"===e.pattern?a.circularPositions(e):[]},a.scatteredPositions=function(e){if((e=e||{}).positions)return{positions:e.positions,rotations:e.rotations,scales:e.scales};for(var t,r,n,i=void 0!==e.seed?a.createRandFloat(e.seed):a.randFloat,o=.5*a.WORLD_SIZE,s=e.pmin||[-o,-o,-o],l=e.pmax||[o,o,o],u=e.rmin||[0,0,0],c=e.rmax||[0,0,0],h=e.smin||[1,1,1],d=e.smax||[1,1,1],f=void 0!==e.numInstances?Math.floor(e.numInstances):1,p=[],m=[],g=[],v=0;v<f;v++)t=i(s[0],l[0]),r=i(s[1],l[1]),n=i(s[2],l[2]),p.push(t,r,n),t=i(u[0],c[0]),r=i(u[1],c[1]),n=i(u[2],c[2]),m.push(t,r,n),t=i(h[0],d[0]),r=i(h[1],d[1]),n=i(h[2],d[2]),g.push(t,r,n);return{positions:p,rotations:m,scales:g}},a.createNoiseHeightGeometry=function(e,t,r,n,i){e=e||500,t=t||500;var a=(i=i||50)/88,o=function(e,t){for(var r=e*t,n=1,i=Math.random(),a=new Uint8Array(r),o=new THREE.ImprovedNoise,s=0;s<4;s++){for(var l=0;l<r;l++){var u=l%e,c=~~(l/e);a[l]+=Math.abs(o.noise(u/n,c/n,i)*n)}n*=5}return a}(r=r||256,n=n||256),s=new THREE.PlaneBufferGeometry(e,t,r-1,n-1);s.rotateX(-Math.PI/2);for(var l=s.attributes.position.array,u=0,c=0,h=l.length/3;u<h;u++,c+=3)l[c+1]=o[u]*a;return s.computeVertexNormals(),s},a.ConvexInOut=function(e){this.convexPoints=new Array(3);var t=[];if(!0===e.isGeometry)for(var r=e.vertices,n=0,i=r.length;n<i;n++)t.push(r[n].toArray());else{if(!0!==e.isBufferGeometry)return void console.warn("warning: THREE.BufferGeometry or THREE.Geometry required in JAMIE.ConvexInOut()...");var a=e.attributes.position.array;for(n=0,i=a.length;n<i;n+=3)t.push([a[n],a[n+1],a[n+2]])}for(var o=0;o<3;o++){var s=(o+1)%3,l=(o+2)%3,u=t.map(e=>[e[s],e[l]]);this.convexPoints[o]=[];var c=S.convexHull(u);for(n=0,i=c.length;n<i;n++)this.convexPoints[o].push(u[c[n][0]])}},Object.assign(a.ConvexInOut.prototype,{isConvexInOut:!0,isPointOutside:function(e){for(var t=!0===e.isVector3?e.toArray():e,r=0;r<3;r++){var n=(r+2)%3,i=[t[(r+1)%3],t[n]];if(1===S.pointInPolygon(this.convexPoints[r],i))return!0}return!1}}),a.createIsosurfaceFromPoints=function(e,t,r,n){var i,o,s;n=n||0;"number"==typeof(r=r||64)?i=o=s=r:(i=r[0],o=r[1],s=r[2]);var l=Math.max(i,o,s),u=new THREE.Vector3,c=new THREE.Box3;c.setFromArray(e),c.getSize(u);var h,d,f,p,m,g,v=.1*Math.min(u.x,u.y,u.z);c.expandByScalar(v),h=c.min.x,d=c.max.x,f=c.min.y,p=c.max.y;var y=[[h,f,m=c.min.z],[d,p,g=c.max.z]],_=(d-h)/(i-1),b=(p-f)/(o-1),w=(g-m)/(s-1),x=Math.sqrt(_*_+b*b+w*w),T=2*x;a.Timer.start("octree");for(var M=new E.PointOctree(c.min,c.max,0,0,n),S=[],A=0,R=e.length;A<R;A+=3){var k={pi:A};(L=new THREE.Vector3).fromArray(e,A),M.insert(L,k),S.push(L)}a.Timer.end(),a.Timer.start("convex");var P,L,C,I,H,O,D=new THREE.ConvexBufferGeometry(S),F=new a.ConvexInOut(D);a.Timer.end();var N=[],U=new THREE.Vector3;a.Timer.start("volumeData");for(var B=0,z=m;B<s;B++,z+=w)for(var j=0,V=f;j<o;j++,V+=b){A=0;for(var G=h;A<i;A++,G+=_){if(U.set(G,V,z),null===(P=M.findNearestPoint(U,x))){if(F.isPointOutside(U)){N.push(T);continue}null===(P=M.findNearestPoint(U,x*l/4))&&(P=M.findNearestPoint(U))}L=P.point,C=t[k=P.data.pi],I=t[k+1],H=t[k+2],O=(U.x-L.x)*C+(U.y-L.y)*I+(U.z-L.z)*H,N.push(O)}}a.Timer.end(),a.Timer.start("isosurface");var W=new a.IsosurfaceGeometry([i,o,s],y,N);return a.Timer.end(),W},a.msh2Geometry=function(e,t){for(var r,n,i=new THREE.Geometry,o=i.vertices,s=i.faces,l=0,u=e.positions.length;l<u;l++)r=e.positions[l],o.push(new THREE.Vector3(r[0],r[1],r[2]));for(l=0,u=e.cells.length;l<u;l++)n=e.cells[l],s.push(new THREE.Face3(n[2],n[1],n[0]));i.mergeVertices();var c=(t=t||{}).uv,h=t.uv2,d=t.uvauto;if(void 0!==c||void 0!==h){var f=c&&c.isBufferAttribute,p=h&&h.isBufferAttribute;f||p?(i=a.toBufferGeometry(i),f&&i.setAttribute("uv",c),p&&i.setAttribute("uv2",h)):(Array.isArray(c)&&(i.faceVertexUvs[0]=c),Array.isArray(h)&&(i.faceVertexUvs[1]=h))}else!0===d&&a.createFaceVertexUVs(i);return i.computeVertexNormals(),i},a.geometry2Msh=function(e){for(var t,r,n=(e=a.toGeometry(e)).vertices,i=e.faces,o=new Array(n.length),s=0,l=n.length;s<l;s++)t=n[s],o[s]=[t.x,t.y,t.z];var u=new Array(i.length);for(s=0,l=i.length;s<l;s++)r=i[s],u[s]=[r.c,r.b,r.a];return{cells:u,positions:o}},a.updateVerticesFromMsh=function(e,t,r){var n,i=t.positions;if(!0===e.isGeometry){for(var o=e.vertices,s=0,l=i.length;s<l;s++)n=i[s],o[s].set(n[0],n[1],n[2]);e.verticesNeedUpdate=!0}else if(!0===e.isBufferGeometry){if(void 0===r){var u=a.toGeometry(e);r=a.geometryIndexMap(u,e)}var c,h=e.attributes.position;for(s=0,l=i.length;s<l;s++){n=i[s],c=r.vtx_to_pos[s];var d=0;for(l=posIndex.length;d<l;d++)h.setXYZ(c[d],n[0],n[1],n[2])}h.needsUpdate=!0}},a.geometryIndexMap=function(e,t,r){r=void 0!==r?r:4,r=Math.pow(10,r);for(var n,i,a=e.vertices,o=t.attributes.position.array,s=[],l={},u={},c=0,h=a.length;c<h;c++)i=a[c],n=Math.round(i.x*r)+"_"+Math.round(i.y*r)+"_"+Math.round(i.z*r),l[c]=n,u[n]=c;var d={},f={};for(c=0,h=o.length;c<h;c+=3){if(s[0]=o[c],s[1]=o[c+1],s[2]=o[c+2],void 0===u[n=Math.round(s[0]*r)+"_"+Math.round(s[1]*r)+"_"+Math.round(s[2]*r)])return console.warn("JAMIE.geometryIndexMap: index map not found due to different geometries"),{};d[c]=n,void 0===f[n]&&(f[n]=[]),f[n].push(c)}var p={},m={};for(c=0,h=a.length;c<h;c++)p[c]=f[l[c]];for(c=0,h=o.length;c<h;c+=3)m[c]=u[d[c]];return{vtx_to_pos:p,pos_to_vtx:m}},a.getTextureUV=function(e){return e.isGeometry?{uv:e.faceVertexUvs[0],uv2:e.faceVertexUvs[1]}:e.isBufferGeometry?{uv:e.getAttribute("uv"),uv2:e.getAttribute("uv")}:void 0},a.reconstructGeometry=function(e,t){var r=a.geometry2Msh(e),n=S.haarTree.rasterize(r.cells,r.positions,t);return r=S.haarTree.contour(n),a.msh2Geometry(r)},a.refineGeometry=function(e,t){if(!e.isGeometry&&!e.isBufferGeometry)return null;var r=a.geometry2Msh(e),n=S.normals.vertexNormals(r.cells,r.positions);return r=S.refineMesh(r.cells,r.positions,n,t),a.msh2Geometry(r)},a.fixGeometry=function(e,t){var r=a.geometry2Msh(e);return r=S.fixMesh(r.cells,r.positions,t),a.msh2Geometry(r)},a.smoothGeometry=function(e,t){var r=a.getTextureUV(e),n=a.geometry2Msh(e);return n.positions=S.smoothVertices(n.cells,n.positions,t),a.msh2Geometry(n,r)},a.deformGeometry=function(e,t,r){var n=a.getTextureUV(e),i=a.geometry2Msh(e),o=t.vertices.length;!function e(i,s){var l=[t.vertices[i],t.offsets[i],t.handles_rings[i],t.unconstrained_rings[i]];S.deformLaplacian.run(s,...l,(function(t){if(++i!=o)return e(i,t);var s=a.msh2Geometry(t,n);r&&r(s)}))}(0,i)},a.loopSubdivideGeometry=function(e){var t=a.geometry2Msh(e);return t=S.loopSubdivide(t.cells,t.positions),a.msh2Geometry(t)},a.addColorToGeometry=function(e,t,r){var n=void 0!==(r=r||{}).coloring?r.coloring:"vertex",i=void 0!==r.colorMap?r.colorMap:"rainbow",a=!0===Array.isArray(r.valueROI)?r.valueROI:[0,1],o=new THREE.Lut;o.setColorMap(i);var s,l,u=t.min(),c=t.max();if(o.setMin(u+(c-u)*a[0]),o.setMax(u+(c-u)*a[1]),!0===e.isGeometry){if("vertex"===n)for(var h=0,d=(s=e.faces).length;h<d;h++)(l=s[h]).vertexColors=[],l.vertexColors.push(o.getColor(t[l.a])),l.vertexColors.push(o.getColor(t[l.b])),l.vertexColors.push(o.getColor(t[l.c]));else if("face"===n)for(h=0,d=(s=e.faces).length;h<d;h++)p=(t[(l=s[h]).a]+t[l.b]+t[l.c])/3,l.color=o.getColor(p)}else if(!0===e.isBufferGeometry){var f,p,m,g=e.attributes.position.array,v=new Float32Array(g.length),y={},_=0;for(h=0,d=g.length;h<d;h+=3)void 0===y[f=Math.round(1e4*g[h])+"_"+Math.round(1e4*g[h+1])+"_"+Math.round(1e4*g[h+2])]&&(y[f]=t[_++]);if("vertex"===n)for(h=0,d=g.length;h<d;h+=3)p=y[f=Math.round(1e4*g[h])+"_"+Math.round(1e4*g[h+1])+"_"+Math.round(1e4*g[h+2])],m=o.getColor(p),v[h]=m.r,v[h+1]=m.g,v[h+2]=m.b;else if("face"===n)for(h=0,d=g.length;h<d;h+=9)p=(y[f=Math.round(1e4*g[h])+"_"+Math.round(1e4*g[h+1])+"_"+Math.round(1e4*g[h+2])]+y[f=Math.round(1e4*g[h+3])+"_"+Math.round(1e4*g[h+4])+"_"+Math.round(1e4*g[h+5])]+y[f=Math.round(1e4*g[h+6])+"_"+Math.round(1e4*g[h+7])+"_"+Math.round(1e4*g[h+8])])/3,m=o.getColor(p),v[h]=v[h+3]=v[h+6]=m.r,v[h+1]=v[h+4]=v[h+7]=m.g,v[h+2]=v[h+5]=v[h+8]=m.b;e.setAttribute("color",new THREE.BufferAttribute(v,3))}},a.computeGeometryCurvature=function(e,t){var r=a.geometry2Msh(e),n=S.meanCurvature(r.cells,r.positions);return void 0!==t&&a.addColorToGeometry(e,n,t),n},a.alphaShapeGeometry=function(e,t){var r=S.alphaShape(e,t);if(0!==r.length){t=a.removeIsolatedPositions(r,t);return a.msh2Geometry({cells:r,positions:t})}console.warn("No cells produced...")},a.computeGeodesicDistance=function(e,t,r){var n=a.geometry2Msh(e);return S.geodesicDistance(n.cells,n.positions,t,r)},a.voxelizeGeometry=function(e,t){if(void 0===t){var r=new THREE.Vector3;e.computeBoundingBox(),e.boundingBox.getSize(r),t=Math.max(r.x,r.y,r.z)/100}for(var n=a.geometry2Msh(e),i=S.voxelize(n.cells,n.positions,t),o=i.voxels,s=o.shape,l=i.origin,u=(t=i.resolution,[]),c=2;c<s[2];c++)for(var h=0;h<s[1];h++)for(var d=0;d<s[0];d++)0===o.get(d,h,c)&&u.push(t*d,t*h,t*c);return{origin:[l[0],l[1],l[2]],size:t,positions:u}},a.removeIsolatedPositions=function(e,t){for(var r,n,i=0,a=[],o={},s=0,l=e.length;s<l;s++){n=e[s];for(var u=0;u<3;u++)void 0===o[r=n[u]]?(o[r]=i,a.push(t[r].slice(0)),n[u]=i,i++):n[u]=o[r]}return console.log("isolated vertices:",t.length-a.length),a},a.getOuterloop2D=function(e,t,r){var n,i;t=t||1.5,r=void 0!==r?r:4,r=Math.pow(10,r);for(var a=[],o=[],s={},l=0,u=e.length;l<u;l++)n=e[l],a.push([n.x,n.y]),s[i=Math.round(n.x*r)+"_"+Math.round(n.y*r)]=l;var c=S.hull2D(a,t);for(l=0,u=c.length;l<u;l++)n=c[l],i=Math.round(n[0]*r)+"_"+Math.round(n[1]*r),o.push(s[i]);return o},a.ShaderChunk=a.ShaderChunk||{},a.ShaderChunk.intersectBox="\nvoid intersectBox(vec3 rayOrigin, vec3 rayDirection, vec3 boxMin, vec3 boxMax, out float tNear, out float tFar, out bool intersect) {\n    vec3 invRay = vec3(1.0) / rayDirection;\n    vec3 tBot = invRay * (boxMin - rayOrigin);\n    vec3 tTop = invRay * (boxMax - rayOrigin);\n    vec3 tMin = min(tTop, tBot);\n    vec3 tMax = max(tTop, tBot);\n    tNear = max( tMin.x, max(tMin.y, tMin.z) );\n    tFar  = min( tMax.x, min(tMax.y, tMax.z) );\n    intersect = tFar > tNear;\n}",a.ShaderChunk.phongShading="\nvec3 phongShading(vec3 ka, vec3 kd, vec3 ks, float shininess, vec3 p, vec3 eye, vec3 lp, vec3 lc, vec3 n, float tDepth) {\n// lp: light position\n// lc: light color\n\n    // float len, eps = 0.001;\n    // vec3 l = lp - p;  len = length(l); l = len > 0.0 ? l / len : l;\n    // float dotLN = dot(l,n);\n    // if( dotLN < eps ) return ka;\n    // vec3 v = eye - p; len = length(v); v = len > 0.0 ? v / len : v;\n    // vec3 r = reflect(-l,n); len = length(r); r = len > 0.0 ? r / len : r;\n    // float dotRV = dot(r,v);\n    // if( dotRV < eps ) return ka + lc * (kd * dotLN);\n    // dotRV = pow( dotRV, shininess );\n    // return ka + lc * (kd * dotLN + ks * dotRV);\n\n    float len, eps = 0.001;\n    vec3 l = normalize( lp - p );\n    vec3 v = normalize( eye - p );\n    vec3 h = normalize( l + v );\n    float dotLN = dot( l, n ); dotLN = step( eps, dotLN );\n    float dotNH = dot( n, h ); dotNH = pow( step( eps, dotNH ), shininess );\n    return ka + lc * ( kd * dotLN + ks * dotNH );\n\n    // float k1 = 0.1, k2 = 1.0, eps = 0.001;\n    // vec3 l = normalize( lp - p );\n    // vec3 v = normalize( eye - p );\n    // vec3 h = normalize( l + v );\n    // float dotLN = dot( l, n ); dotLN = step( eps, dotLN );\n    // float dotNH = dot( n, h ); dotNH = pow( step( eps, dotNH ), shininess );\n    // return lc * ka + lc / (k1 + k2 * tDepth) * (kd * (dotLN + ks * dotNH));\n}",a.ShaderChunk.texture3d="\nvoid texture3d(in ivec3 dataCoordinates, out vec4 dataValue, out int offset) {\n    float textureSizeF = float(uTextureSize);\n    int voxelsPerTexture = uTextureSize*uTextureSize;\n    int index = dataCoordinates.x + dataCoordinates.y * uDataDimensions.x + dataCoordinates.z * uDataDimensions.y * uDataDimensions.x;\n    int packedIndex = index/uPackedPerPixel;\n    offset = index - uPackedPerPixel*packedIndex;\n    int textureIndex = packedIndex/voxelsPerTexture;\n    int inTextureIndex = packedIndex - voxelsPerTexture*textureIndex;\n    int rowIndex = inTextureIndex/uTextureSize;\n    float rowIndexF = float(rowIndex);\n    float colIndexF = float(inTextureIndex - uTextureSize * rowIndex);\n    vec2 uv = vec2(0.0);\n    uv.x = (0.5 + colIndexF) / textureSizeF;\n    uv.y = 1.0 - (0.5 + rowIndexF) / textureSizeF;\n    float textureIndexF = float(textureIndex);\n#if MAX_TEX3D_IMAGES == 7\n    dataValue = vec4(0.0) + \n    step( abs( textureIndexF - 0.0 ), 0.0 ) * texture2D(uTextureContainer[0], uv) +\n    step( abs( textureIndexF - 1.0 ), 0.0 ) * texture2D(uTextureContainer[1], uv) +\n    step( abs( textureIndexF - 2.0 ), 0.0 ) * texture2D(uTextureContainer[2], uv) +\n    step( abs( textureIndexF - 3.0 ), 0.0 ) * texture2D(uTextureContainer[3], uv) +\n    step( abs( textureIndexF - 4.0 ), 0.0 ) * texture2D(uTextureContainer[4], uv) +\n    step( abs( textureIndexF - 5.0 ), 0.0 ) * texture2D(uTextureContainer[5], uv) +\n    step( abs( textureIndexF - 6.0 ), 0.0 ) * texture2D(uTextureContainer[6], uv);\n#endif\n#if MAX_TEX3D_IMAGES == 14\n    dataValue = vec4(0.0) + \n    step( abs( textureIndexF - 0.0 ), 0.0 ) * texture2D(uTextureContainer[0], uv) +\n    step( abs( textureIndexF - 1.0 ), 0.0 ) * texture2D(uTextureContainer[1], uv) +\n    step( abs( textureIndexF - 2.0 ), 0.0 ) * texture2D(uTextureContainer[2], uv) +\n    step( abs( textureIndexF - 3.0 ), 0.0 ) * texture2D(uTextureContainer[3], uv) +\n    step( abs( textureIndexF - 4.0 ), 0.0 ) * texture2D(uTextureContainer[4], uv) +\n    step( abs( textureIndexF - 5.0 ), 0.0 ) * texture2D(uTextureContainer[5], uv) +\n    step( abs( textureIndexF - 6.0 ), 0.0 ) * texture2D(uTextureContainer[6], uv) +\n    step( abs( textureIndexF - 7.0 ), 0.0 ) * texture2D(uTextureContainer[7], uv) +\n    step( abs( textureIndexF - 8.0 ), 0.0 ) * texture2D(uTextureContainer[8], uv) +\n    step( abs( textureIndexF - 9.0 ), 0.0 ) * texture2D(uTextureContainer[9], uv) +\n    step( abs( textureIndexF - 10.0 ), 0.0 ) * texture2D(uTextureContainer[10], uv) +\n    step( abs( textureIndexF - 11.0 ), 0.0 ) * texture2D(uTextureContainer[11], uv) +\n    step( abs( textureIndexF - 12.0 ), 0.0 ) * texture2D(uTextureContainer[12], uv) +\n    step( abs( textureIndexF - 13.0 ), 0.0 ) * texture2D(uTextureContainer[13], uv);\n#endif\n}",a.ShaderChunk.unpack="\nvoid uInt8(in float r, out float value) {\n    value = r * 255.0;\n}\nvoid uInt16(in float r, in float a, out float value) {\n    value = r * 255.0 + a * 255.0 * 256.0;\n}\nvoid uInt32(in float r, in float g, in float b, in float a, out float value) {\n    value = r * 255.0 + g * 255.0 * 256.0 + b * 255.0 * 256.0 * 256.0 + a * 255.0 * 256.0 * 256.0 * 256.0;\n}\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value) {\n    // 1) create arrays containing bits for rgba values (between 0 and 255)\n    value = r * 255.0;\n    int bytemeR[8];\n    bytemeR[0] = int(floor(value / 128.0)); value -= float(bytemeR[0] * 128);\n    bytemeR[1] = int(floor(value / 64.0)); value -= float(bytemeR[1] * 64);\n    bytemeR[2] = int(floor(value / 32.0)); value -= float(bytemeR[2] * 32);\n    bytemeR[3] = int(floor(value / 16.0)); value -= float(bytemeR[3] * 16);\n    bytemeR[4] = int(floor(value / 8.0)); value -= float(bytemeR[4] * 8);\n    bytemeR[5] = int(floor(value / 4.0)); value -= float(bytemeR[5] * 4);\n    bytemeR[6] = int(floor(value / 2.0)); value -= float(bytemeR[6] * 2);\n    bytemeR[7] = int(floor(value)); value = g * 255.0;\n    int bytemeG[8];\n    bytemeG[0] = int(floor(value / 128.0)); value -= float(bytemeG[0] * 128);\n    bytemeG[1] = int(floor(value / 64.0)); value -= float(bytemeG[1] * 64);\n    bytemeG[2] = int(floor(value / 32.0)); value -= float(bytemeG[2] * 32);\n    bytemeG[3] = int(floor(value / 16.0)); value -= float(bytemeG[3] * 16);\n    bytemeG[4] = int(floor(value / 8.0)); value -= float(bytemeG[4] * 8);\n    bytemeG[5] = int(floor(value / 4.0)); value -= float(bytemeG[5] * 4);\n    bytemeG[6] = int(floor(value / 2.0)); value -= float(bytemeG[6] * 2);\n    bytemeG[7] = int(floor(value)); value = b * 255.0;\n    int bytemeB[8];\n    bytemeB[0] = int(floor(value / 128.0)); value -= float(bytemeB[0] * 128);\n    bytemeB[1] = int(floor(value / 64.0)); value -= float(bytemeB[1] * 64);\n    bytemeB[2] = int(floor(value / 32.0)); value -= float(bytemeB[2] * 32);\n    bytemeB[3] = int(floor(value / 16.0)); value -= float(bytemeB[3] * 16);\n    bytemeB[4] = int(floor(value / 8.0)); value -= float(bytemeB[4] * 8);\n    bytemeB[5] = int(floor(value / 4.0)); value -= float(bytemeB[5] * 4);\n    bytemeB[6] = int(floor(value / 2.0)); value -= float(bytemeB[6] * 2);\n    bytemeB[7] = int(floor(value)); value = a * 255.0;\n    int bytemeA[8];\n    bytemeA[0] = int(floor(value / 128.0)); value -= float(bytemeA[0] * 128);\n    bytemeA[1] = int(floor(value / 64.0)); value -= float(bytemeA[1] * 64);\n    bytemeA[2] = int(floor(value / 32.0)); value -= float(bytemeA[2] * 32);\n    bytemeA[3] = int(floor(value / 16.0)); value -= float(bytemeA[3] * 16);\n    bytemeA[4] = int(floor(value / 8.0)); value -= float(bytemeA[4] * 8);\n    bytemeA[5] = int(floor(value / 4.0)); value -= float(bytemeA[5] * 4);\n    bytemeA[6] = int(floor(value / 2.0)); value -= float(bytemeA[6] * 2);\n    bytemeA[7] = int(floor(value));\n    // 2) compute float32 value from bit arrays\n    int issigned = 1 - 2 * bytemeR[0]; //issigned = int(pow(-1., float(bytemeR[0])));\n    int exponent = 0;\n    exponent += bytemeR[1] * int(pow(2.0, 7.0));\n    exponent += bytemeR[2] * int(pow(2.0, 6.0));\n    exponent += bytemeR[3] * int(pow(2.0, 5.0));\n    exponent += bytemeR[4] * int(pow(2.0, 4.0));\n    exponent += bytemeR[5] * int(pow(2.0, 3.0));\n    exponent += bytemeR[6] * int(pow(2.0, 2.0));\n    exponent += bytemeR[7] * int(pow(2.0, 1.0));\n    exponent += bytemeG[0];\n    float fraction = 0.0;\n    fraction  = float(bytemeG[1]) * pow(2.0, -1.0);\n    fraction += float(bytemeG[2]) * pow(2.0, -2.0);\n    fraction += float(bytemeG[3]) * pow(2.0, -3.0);\n    fraction += float(bytemeG[4]) * pow(2.0, -4.0);\n    fraction += float(bytemeG[5]) * pow(2.0, -5.0);\n    fraction += float(bytemeG[6]) * pow(2.0, -6.0);\n    fraction += float(bytemeG[7]) * pow(2.0, -7.0);//\n    fraction += float(bytemeB[0]) * pow(2.0, -8.0);\n    fraction += float(bytemeB[1]) * pow(2.0, -9.0);\n    fraction += float(bytemeB[2]) * pow(2.0, -10.0);\n    fraction += float(bytemeB[3]) * pow(2.0, -11.0);\n    fraction += float(bytemeB[4]) * pow(2.0, -12.0);\n    fraction += float(bytemeB[5]) * pow(2.0, -13.0);\n    fraction += float(bytemeB[6]) * pow(2.0, -14.0);\n    fraction += float(bytemeB[7]) * pow(2.0, -15.0);//\n    fraction += float(bytemeA[0]) * pow(2.0, -16.0);\n    fraction += float(bytemeA[1]) * pow(2.0, -17.0);\n    fraction += float(bytemeA[2]) * pow(2.0, -18.0);\n    fraction += float(bytemeA[3]) * pow(2.0, -19.0);\n    fraction += float(bytemeA[4]) * pow(2.0, -20.0);\n    fraction += float(bytemeA[5]) * pow(2.0, -21.0);\n    fraction += float(bytemeA[6]) * pow(2.0, -22.0);\n    fraction += float(bytemeA[7]) * pow(2.0, -23.0);//\n    value = float(issigned) * pow(2.0, float(exponent - 127)) * (1.0 + fraction);\n}\nvoid unpack(in vec4 packedData, in int offset, out vec4 unpackedData) {\n#if defined( BITS_ALLOCATED_8 )\n    float floatedOffset = float(offset);\n    float floatedOffsetSquared = floatedOffset * floatedOffset;\n    uInt8( step( floatedOffsetSquared, 0.0 ) * packedData.r +\n           step( floatedOffsetSquared - 2.0 * floatedOffset + 1.0, 0.0 ) * packedData.g +\n           step( floatedOffsetSquared - 2.0 * 2.0 * floatedOffset + 4.0, 0.0 ) * packedData.b +\n           step( floatedOffsetSquared - 2.0 * 3.0 * floatedOffset + 9.0, 0.0 ) * packedData.a, unpackedData.x );\n#elif defined( BITS_ALLOCATED_16 )\n    float floatedOffset = float(offset);\n    uInt16( packedData.r * (1.0 - floatedOffset) + packedData.b * floatedOffset, packedData.g * (1.0 - floatedOffset) + packedData.a * floatedOffset, unpackedData.x);\n#elif defined( BITS_ALLOCATED_32 )\n    uInt32( packedData.r, packedData.g, packedData.b, packedData.a, unpackedData.x );\n#elif defined( BITS_ALLOCATED_32F )\n    uFloat32( packedData.r, packedData.g, packedData.b, packedData.a, unpackedData.x );\n#else\n    unpackedData = packedData;\n#endif\n}",a.ShaderChunk.interpolation="\nvoid interpolationIdentity(in vec3 currentVoxel, out vec4 dataValue) {\n    vec3 rcurrentVoxel = floor(currentVoxel + 0.5);\n    ivec3 voxel = ivec3(int(rcurrentVoxel.x), int(rcurrentVoxel.y), int(rcurrentVoxel.z));\n    vec4 tmp = vec4(0.0);\n    int offset = 0;\n    texture3d(voxel, tmp, offset);\n    unpack(tmp, offset, dataValue);\n}\nvoid trilinearInterpolation( in vec3 normalizedPosition, out vec4 interpolatedValue, in vec4 v000, in vec4 v100, in vec4 v001, in vec4 v101, in vec4 v010, in vec4 v110, in vec4 v011, in vec4 v111) {\n    // vec4 c00 = v000 * ( 1.0 - normalizedPosition.x ) + v100 * normalizedPosition.x;\n    // vec4 c01 = v001 * ( 1.0 - normalizedPosition.x ) + v101 * normalizedPosition.x;\n    // vec4 c10 = v010 * ( 1.0 - normalizedPosition.x ) + v110 * normalizedPosition.x;\n    // vec4 c11 = v011 * ( 1.0 - normalizedPosition.x ) + v111 * normalizedPosition.x;\n    // vec4 c0 = c00 * ( 1.0 - normalizedPosition.y) + c10 * normalizedPosition.y;\n    // vec4 c1 = c01 * ( 1.0 - normalizedPosition.y) + c11 * normalizedPosition.y;\n    // vec4 c = c0 * ( 1.0 - normalizedPosition.z) + c1 * normalizedPosition.z;\n    // interpolatedValue = c;\n\n    vec4 c00 = mix( v000, v100, normalizedPosition.x );\n    vec4 c01 = mix( v001, v101, normalizedPosition.x );\n    vec4 c10 = mix( v010, v110, normalizedPosition.x );\n    vec4 c11 = mix( v011, v111, normalizedPosition.x );\n    vec4 c0 = mix( c00, c10, normalizedPosition.y );\n    vec4 c1 = mix( c01, c11, normalizedPosition.y );\n    vec4 c = mix( c0, c1, normalizedPosition.z );\n    interpolatedValue = c;\n}\nvoid interpolationTrilinear(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient) {\n    vec3 lower_bound = floor(currentVoxel);\n    lower_bound = max(vec3(0.0), lower_bound);\n\n    vec3 higher_bound = lower_bound + vec3(1.0);\n\n    vec3 normalizedPosition = currentVoxel - lower_bound;\n    normalizedPosition = max(vec3(0.0), normalizedPosition);\n\n    vec4 interpolatedValue = vec4(0.0);\n    vec4 v000 = vec4(0.0), v100 = vec4(0.0), v001 = vec4(0.0), v101 = vec4(0.0);\n    vec4 v010 = vec4(0.0), v110 = vec4(0.0), v011 = vec4(0.0), v111 = vec4(0.0);\n\n    interpolationIdentity(vec3(lower_bound.x, lower_bound.y, lower_bound.z), v000);\n    interpolationIdentity(vec3(higher_bound.x, lower_bound.y, lower_bound.z), v100);\n    interpolationIdentity(vec3(lower_bound.x, lower_bound.y, higher_bound.z), v001);\n    interpolationIdentity(vec3(higher_bound.x, lower_bound.y, higher_bound.z), v101);\n    interpolationIdentity(vec3(lower_bound.x, higher_bound.y, lower_bound.z), v010);\n    interpolationIdentity(vec3(higher_bound.x, higher_bound.y, lower_bound.z), v110);\n    interpolationIdentity(vec3(lower_bound.x, higher_bound.y, higher_bound.z), v011);\n    interpolationIdentity(vec3(higher_bound.x, higher_bound.y, higher_bound.z), v111);\n\n    // compute interpolation at position\n    trilinearInterpolation(normalizedPosition, interpolatedValue, v000, v100, v001, v101, v010, v110, v011, v111);\n    dataValue = interpolatedValue;\n\n    // compute gradient\n    float gradientStep = 0.005;\n\n    // x axis\n    vec4 vg100 = vec4(0.0), vgo100 = vec4(0.0);\n    vec3 g100 = vec3(1.0, 0.0, 0.0);\n    vec3 ng100 = normalizedPosition + g100 * gradientStep;\n    ng100.x = min(1.0, ng100.x);\n    trilinearInterpolation(ng100, vg100, v000, v100, v001, v101, v010, v110, v011, v111);\n    vec3 ngo100 = normalizedPosition - g100 * gradientStep;\n    ngo100.x = max(0.0, ngo100.x);\n    trilinearInterpolation(ngo100, vgo100, v000, v100, v001, v101, v010, v110, v011, v111);\n    gradient.x = (g100.x * vg100.x - g100.x * vgo100.x);\n\n    // y axis\n    vec4 vg010 = vec4(0.0), vgo010 = vec4(0.0);\n    vec3 g010 = vec3(0.0, 1.0, 0.0);\n    vec3 ng010 = normalizedPosition + g010 * gradientStep;\n    ng010.y = min(1.0, ng010.y);\n    trilinearInterpolation(ng010, vg010, v000, v100, v001, v101, v010, v110, v011, v111);\n    vec3 ngo010 = normalizedPosition - g010 * gradientStep;\n    ngo010.y = max(0.0, ngo010.y);\n    trilinearInterpolation(ngo010, vgo010, v000, v100, v001, v101, v010, v110, v011, v111);\n    gradient.y = (g010.y * vg010.x - g010.y * vgo010.x);\n\n    // z axis\n    vec4 vg001 = vec4(0.0), vgo001 = vec4(0.0);\n    vec3 g001 = vec3(0.0, 0.0, 1.0);\n    vec3 ng001 = normalizedPosition + g001 * gradientStep;\n    ng001.z = min(1.0, ng001.z);\n    trilinearInterpolation(ng001, vg001, v000, v100, v001, v101, v010, v110, v011, v111);\n    vec3 ngo001 = normalizedPosition - g001 * gradientStep;\n    ngo001.z = max(0.0, ngo001.z);\n    trilinearInterpolation(ngo001, vgo001, v000, v100, v001, v101, v010, v110, v011, v111);\n    gradient.z = (g001.z * vg001.x - g001.z * vgo001.x);\n\n    // normalize gradient\n    float gradientMagnitude = length(gradient);\n    if (gradientMagnitude > 0.0) {\n        gradient = (-1.0 / gradientMagnitude) * gradient;\n    }\n}\nvoid interpolation(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient) {\n    if( uInterpolation == 0 )\n        interpolationIdentity(currentVoxel, dataValue);\n    else\n        interpolationTrilinear(currentVoxel, dataValue, gradient);\n}",a.ShaderChunk.getIntensity="\nvoid getIntensity(in vec3 dataCoordinates, out float intensity, out vec3 gradient) {\n    vec4 dataValue = vec4(0.0);\n    interpolation(dataCoordinates, dataValue, gradient);\n    intensity = dataValue.r;\n    intensity = intensity * uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}",a.MedicalSliceShader={uniforms:{uTextureSize:{value:0},uTextureContainer:{value:[]},uDataDimensions:{value:[0,0,0]},uWorldToData:{value:null},uWindowCenterWidth:{value:[0,0]},uLowerUpperThreshold:{value:[0,0]},uRescaleSlopeIntercept:{value:[0,0]},uNumberOfChannels:{value:1},uBitsAllocated:{value:8},uInvert:{value:0},uLut:{value:0},uTextureLUT:{value:null},uLutSegmentation:{value:0},uTextureLUTSegmentation:{value:null},uPixelType:{value:0},uPackedPerPixel:{value:1},uInterpolation:{value:1},uCanvasWidth:{value:0},uCanvasHeight:{value:0},uBorderColor:{value:[1,0,.5]},uBorderWidth:{value:2},uBorderMargin:{value:2},uBorderDashLength:{value:10},uOpacity:{value:1},uSpacing:{value:0},uThickness:{value:0},uThicknessMethod:{value:0}},vertexShader:"\nvarying vec3 vPos;\nvarying vec3 vNormal;\nvoid main() {\n    vNormal = normal;\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vPos = worldPosition.xyz;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:`\nuniform int uTextureSize;\nuniform sampler2D uTextureContainer[14];\nuniform ivec3 uDataDimensions;\nuniform mat4 uWorldToData;\nuniform float uWindowCenterWidth[2];\nuniform float uLowerUpperThreshold[2];\nuniform float uRescaleSlopeIntercept[2];\nuniform int uNumberOfChannels;\nuniform int uBitsAllocated;\nuniform int uInvert;\nuniform int uLut;\nuniform sampler2D uTextureLUT;\nuniform int uLutSegmentation;\nuniform sampler2D uTextureLUTSegmentation;\nuniform int uPixelType;\nuniform int uPackedPerPixel;\nuniform int uInterpolation;\nuniform float uCanvasWidth;\nuniform float uCanvasHeight;\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform float uBorderMargin;\nuniform float uBorderDashLength;\nuniform float uOpacity;\nuniform float uSpacing;\nuniform float uThickness;\nuniform int uThicknessMethod;\nvarying vec3 vPos;\nvarying vec3 vNormal;\n${a.ShaderChunk.texture3d}\n${a.ShaderChunk.unpack}\n${a.ShaderChunk.interpolation}\nvoid main() {\n    // if( uCanvasWidth > 0.0 &&\n    // ((gl_FragCoord.x > uBorderMargin && (gl_FragCoord.x - uBorderMargin) < uBorderWidth) ||\n    // (gl_FragCoord.x < (uCanvasWidth - uBorderMargin) && (gl_FragCoord.x + uBorderMargin) > (uCanvasWidth - uBorderWidth) ))) {\n    //     float valueY = mod(gl_FragCoord.y, 2.0 * uBorderDashLength);\n    //     if( valueY < uBorderDashLength && gl_FragCoord.y > uBorderMargin && gl_FragCoord.y < (uCanvasHeight - uBorderMargin) ) {\n    //         gl_FragColor = vec4(uBorderColor, 1.0);\n    //         return;\n    //     }\n    // }\n    // if( uCanvasHeight > 0.0 &&\n    // ((gl_FragCoord.y > uBorderMargin && (gl_FragCoord.y - uBorderMargin) < uBorderWidth) ||\n    // (gl_FragCoord.y < (uCanvasHeight - uBorderMargin) && (gl_FragCoord.y + uBorderMargin) > (uCanvasHeight - uBorderWidth) ))) {\n    //     float valueX = mod(gl_FragCoord.x, 2.0 * uBorderDashLength);\n    //     if( valueX < uBorderDashLength && gl_FragCoord.x > uBorderMargin && gl_FragCoord.x < (uCanvasWidth - uBorderMargin) ) {\n    //         gl_FragColor = vec4(uBorderColor, 1.0);\n    //         return;\n    //     }\n    // }\n\n    // get texture coordinates of current pixel\n    vec4 dataValue = vec4(0.0);\n    vec3 gradient = vec3(1.0); // gradient calculations will be skipped if it is equal to vec3(1.0)\n    float steps = floor(uThickness / uSpacing + 0.5);\n\n    if( steps > 1.0 ) {\n        vec3 origin = vPos - uThickness * 0.5 * vNormal;\n        vec4 dataValueAcc = vec4(0.0);\n\n        for( float step = 0.0; step < 128.0; step++ ) {\n            if ( step >= steps ) break;\n\n            vec4 dataCoordinates = uWorldToData * vec4(origin + step * uSpacing * vNormal, 1.0);\n            interpolation(dataCoordinates.xyz, dataValueAcc, gradient);\n\n            if (step == 0.0) {\n                dataValue.r = dataValueAcc.r;\n                continue;\n            }\n            if (uThicknessMethod == 0) {\n                dataValue.r = max(dataValueAcc.r, dataValue.r);\n            }\n            else if (uThicknessMethod == 1) {\n                dataValue.r += dataValueAcc.r;\n            }\n            else if (uThicknessMethod == 2) {\n                dataValue.r = min(dataValueAcc.r, dataValue.r);\n            }\n        }\n        if (uThicknessMethod == 1) {\n            dataValue.r /= steps;\n        }\n    }\n    else {\n        vec4 dataCoordinates = uWorldToData * vec4(vPos, 1.0);\n        interpolation(dataCoordinates.xyz, dataValue, gradient);\n    }\n\n    if( uNumberOfChannels == 1 ) {\n        // rescale/slope\n        float realIntensity = dataValue.r * uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n        // threshold\n        if (realIntensity < uLowerUpperThreshold[0] || realIntensity > uLowerUpperThreshold[1]) {\n            discard;\n        }\n\n        // normalize\n        float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n        float normalizedIntensity = ( realIntensity - windowMin ) / uWindowCenterWidth[1];\n        dataValue.rgb = vec3( normalizedIntensity );\n        dataValue.a = 1.0;\n\n        // apply LUT\n        if( uLut == 1 ) {\n            dataValue.rgb = texture2D( uTextureLUT, vec2(normalizedIntensity, 1.0) ).rgb;\n            dataValue.a = 1.0;\n        }\n\n        // apply segmentation\n        if( uLutSegmentation == 1 ) {\n            float textureWidth = 256.0;\n            float textureHeight = 128.0;\n            // float min = 0.0;\n            int adjustedIntensity = int(floor(realIntensity + 0.5));\n\n            // get row and column in the texture\n            int colIndex = int(mod(float(adjustedIntensity), textureWidth));\n            int rowIndex = int(floor(float(adjustedIntensity)/textureWidth));\n\n            float texWidth = 1.0/textureWidth;\n            float texHeight = 1.0/textureHeight;\n\n            // map row and column to uv\n            vec2 uv = vec2(0.0);\n            uv.x = 0.5 * texWidth + (texWidth * float(colIndex));\n            uv.y = 1.0 - (0.5 * texHeight + float(rowIndex) * texHeight);\n            dataValue = texture2D( uTextureLUTSegmentation, uv );\n        }\n    }\n\n    if( uInvert == 1 ) {\n        dataValue.xyz = vec3(1.0) - dataValue.xyz;\n    }\n\n    dataValue.a = dataValue.a * uOpacity;\n    gl_FragColor = dataValue;\n}`},a.MedicalVolumeShader={uniforms:{uTextureSize:{value:0},uTextureContainer:{value:[]},uDataDimensions:{value:[0,0,0]},uWorldToData:{value:null},uDataToWorld:{value:null},uWindowCenterWidth:{value:[0,0]},uRescaleSlopeIntercept:{value:[0,0]},uNumberOfChannels:{value:1},uBitsAllocated:{value:8},uInvert:{value:0},uLut:{value:0},uTextureLUT:{value:null},uPixelType:{value:0},uPackedPerPixel:{value:1},uInterpolation:{value:1},uWorldBBox:{value:[0,0,0,0,0,0]},uSteps:{value:256},uAlphaCorrection:{value:.5},uFrequence:{value:0},uAmplitude:{value:0},uShading:{value:1},uAmbientIntensity:{value:.1},uAmbientColor:{value:[1,1,1]},uSampleColorToAmbient:{value:1},uSpecularIntensity:{value:.6},uSpecularColor:{value:[1,1,1]},uSampleColorToSpecular:{value:1},uDiffuseIntensity:{value:.3},uDiffuseColor:{value:[1,1,1]},uSampleColorToDiffuse:{value:1},uShininess:{value:5},uLightPosition:{value:[0,0,0]},uLightPositionInCamera:{value:1},uLightColor:{value:[.8,.8,.8]},uAlgorithm:{value:0},uCameraNear:{value:0},uCameraFar:{value:0}},vertexShader:"\nvarying vec3 vPos;\nvoid main() {\n    vPos = position;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:`\nuniform int uTextureSize;\nuniform sampler2D uTextureContainer[14];\nuniform ivec3 uDataDimensions;\nuniform mat4 uWorldToData;\nuniform mat4 uDataToWorld;\nuniform float uWindowCenterWidth[2];\nuniform float uRescaleSlopeIntercept[2];\nuniform int uNumberOfChannels;\nuniform int uBitsAllocated;\nuniform int uInvert;\nuniform int uLut;\nuniform sampler2D uTextureLUT;\nuniform int uPixelType;\nuniform int uPackedPerPixel;\nuniform int uInterpolation;\nuniform float uWorldBBox[6];\nuniform int uSteps;\nuniform float uAlphaCorrection;\nuniform float uFrequence;\nuniform float uAmplitude;\nuniform int uShading;\nuniform float uAmbientIntensity;\nuniform vec3 uAmbientColor;\nuniform int uSampleColorToAmbient;\nuniform float uSpecularIntensity;\nuniform vec3 uSpecularColor;\nuniform int uSampleColorToSpecular;\nuniform float uDiffuseIntensity;\nuniform vec3 uDiffuseColor;\nuniform int uSampleColorToDiffuse;\nuniform float uShininess;\nuniform vec3 uLightPosition;\nuniform int uLightPositionInCamera;\nuniform vec3 uLightColor;\nuniform int uAlgorithm;\nuniform float uCameraNear;\nuniform float uCameraFar;\nvarying vec3 vPos;\n${a.ShaderChunk.intersectBox}\n${a.ShaderChunk.phongShading}\n${a.ShaderChunk.texture3d}\n${a.ShaderChunk.unpack}\n${a.ShaderChunk.interpolation}\n${a.ShaderChunk.getIntensity}\nfloat getFragDepth( vec3 fragPosW ) {\n    vec4 fragPosV = viewMatrix * vec4(fragPosW, 1.0);\n    float fragDepth = uCameraFar * (uCameraNear + fragPosV.z) / ((uCameraFar - uCameraNear) * fragPosV.z);\n    return fragDepth;\n}\nvoid main() {\n    const int maxSteps = 1024;\n\n    vec3 ro = cameraPosition;\n    vec3 rd = normalize(vPos - ro);\n    vec3 lightPos = uLightPositionInCamera == 1 ? cameraPosition : uLightPosition;\n\n    vec3 AABBMin = vec3(uWorldBBox[0], uWorldBBox[2], uWorldBBox[4]);\n    vec3 AABBMax = vec3(uWorldBBox[1], uWorldBBox[3], uWorldBBox[5]);\n\n    float tNear, tFar;\n    bool intersect = false;\n    intersectBox(ro, rd, AABBMin, AABBMax, tNear, tFar, intersect);\n    if( intersect == false ) discard;\n    tNear = max( tNear, 0.0 );\n\n    // kill fragment near AABB boundary to improve speed (added by jamie)\n    vec3 box = AABBMax - AABBMin;\n    float boxSize = min( box.x, min( box.y, box.z ) );\n    if( tFar - tNear < boxSize*0.2 ) discard;\n\n    float dt = (tFar - tNear) / float(uSteps);\n    float t = tNear;\n    vec3 p = ro + rd * t;\n    vec3 dp = rd * dt;\n\n    float alphaScale = dt * uAlphaCorrection;\n    float maxIntensity = 0.0;  // mip volume rendering\n    vec4 colorSum = vec4(0.0); // accumulated color\n    float alphaSum = 0.0;      // accumulated alpha\n\n    vec4 dataCoordinatesRaw, color;\n    float intensity, alpha, gradlength;\n    vec3 transformed, gradient, ka, kd, ks;\n\n    float fragNull = 1.0;\n\n    for( int i = 0; i < maxSteps; i++ )\n    {\n        transformed = p; // transformPoint(p, uAmplitude, uFrequence);\n\n        dataCoordinatesRaw = uWorldToData * vec4(transformed, 1.0);\n        intensity = 0.0;\n        gradient = vec3(0.0);\n        getIntensity( dataCoordinatesRaw.xyz, intensity, gradient );\n\n        // create fragment (added by jamie)\n        if( fragNull * uCameraFar * intensity > 0.0 ) {\n            gl_FragDepth = getFragDepth( transformed );\n            fragNull = 0.0;\n        }\n\n        gradient = vec3( uDataToWorld * vec4(gradient, 0.0) );\n        gradlength = length( gradient );\n        gradient = gradlength > 0.0 ? gradient / gradlength : gradient;\n\n        if( uLut == 1 ) {\n            color = texture2D( uTextureLUT, vec2(intensity, 1.0) ); // 256 colors\n            alpha = color.a;\n        }\n        else {\n            color.rgb = vec3( intensity );\n            alpha = intensity;\n        }\n\n        if (uAlgorithm == 0 && uShading == 1 && uInterpolation != 0) {\n            ka = (uSampleColorToAmbient  == 1 ? color.rgb : uAmbientColor ) * uAmbientIntensity;\n            kd = (uSampleColorToDiffuse  == 1 ? color.rgb : uDiffuseColor ) * uDiffuseIntensity;\n            ks = (uSampleColorToSpecular == 1 ? color.rgb : uSpecularColor) * uSpecularIntensity;\n            color.rgb += phongShading( ka, kd, ks, uShininess, p, ro, lightPos, uLightColor, gradient, t/tFar );\n        }\n\n        // when using fewer slices, the opacity has to be scaled up\n        alpha = 1.0 - pow( (1.0 - alpha), alphaScale );\n\n        // front-to-back composition\n        alpha *= (1.0 - alphaSum);\n        colorSum += alpha * color;\n        alphaSum += alpha;\n\n        t += dt;\n        p += dp;\n\n        if( t > tFar || (uAlgorithm == 0 && alphaSum >= 0.95) ) break;\n\n        if( uAlgorithm == 1 && (intensity >= maxIntensity) ) {\n            maxIntensity = intensity;\n            colorSum = color;\n            alphaSum = 1.0;\n        }\n    }\n    gl_FragColor = vec4( colorSum.rgb, alphaSum );\n}`},a.GodRaysPass=function(e,t,r,n){THREE.Pass.call(this),this.scene=e,this.camera=t,this.width=r||512,this.height=n||512;var i=t.far;this.sunPosition=new THREE.Vector3(0,.5*i,-i),this.materialDepth=new THREE.MeshDepthMaterial,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(-.5,.5,.5,-.5,-i,i),this.camera2.position.z=i/100,this.scene2.add(this.camera2);var o={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureColors=new THREE.WebGLRenderTarget(r,n,o),this.rtTextureDepth=new THREE.WebGLRenderTarget(r,n,o),this.rtTextureDepthMask=new THREE.WebGLRenderTarget(r,n,o),this.rtResolutionMultiplier=.25;var s=r*this.rtResolutionMultiplier,l=n*this.rtResolutionMultiplier;this.rtTextureGodRays1=new THREE.WebGLRenderTarget(s,l,o),this.rtTextureGodRays2=new THREE.WebGLRenderTarget(s,l,o),void 0!==THREE.GodRaysDepthMaskShader&&void 0!==THREE.GodRaysGenerateShader&&void 0!==THREE.GodRaysCombineShader&&void 0!==THREE.GodRaysFakeSunShader||console.error("JAMIE.GodRaysPass: The pass relies on GodRaysShader.js.");var u=THREE.GodRaysDepthMaskShader;this.godrayMaskUniforms=THREE.UniformsUtils.clone(u.uniforms),this.materialGodraysDepthMask=new THREE.ShaderMaterial({uniforms:this.godrayMaskUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader});var c=THREE.GodRaysGenerateShader;this.godrayGenUniforms=THREE.UniformsUtils.clone(c.uniforms),this.materialGodraysGenerate=new THREE.ShaderMaterial({uniforms:this.godrayGenUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader});var h=THREE.GodRaysCombineShader;this.godrayCombineUniforms=THREE.UniformsUtils.clone(h.uniforms),this.materialGodraysCombine=new THREE.ShaderMaterial({uniforms:this.godrayCombineUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader});var d=THREE.GodRaysFakeSunShader;this.godraysFakeSunUniforms=THREE.UniformsUtils.clone(d.uniforms),this.materialGodraysFakeSun=new THREE.ShaderMaterial({uniforms:this.godraysFakeSunUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.godraysFakeSunUniforms.bgColor.value.setHex(0),this.godraysFakeSunUniforms.sunColor.value.setHex(a.SUN_COLOR),this.godrayCombineUniforms.fGodRayIntensity.value=.5;var f=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),this.materialGodraysGenerate);f.position.z=-.99*t.far,this.scene2.add(f)},a.GodRaysPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:a.GodRaysPass,dispose:function(){this.rtTextureColors.dispose(),this.rtTextureDepth.dispose(),this.rtTextureDepthMask.dispose(),this.rtTextureGodRays1.dispose(),this.rtTextureGodRays2.dispose(),this.materialGodraysDepthMask.dispose(),this.materialGodraysGenerate.dispose(),this.materialGodraysCombine.dispose(),this.materialGodraysFakeSun.dispose(),this.quad.geometry.dispose(),this.materialDepth.dispose()},setSize:function(e,t){this.rtTextureColors.setSize(e,t),this.rtTextureDepth.setSize(e,t),this.rtTextureDepthMask.setSize(e,t);var r=e*this.rtResolutionMultiplier,n=t*this.rtResolutionMultiplier;this.rtTextureGodRays1.setSize(r,n),this.rtTextureGodRays2.setSize(r,n)},render:function(e,t,r,n,i){var a=this.scene,o=this.camera,s=this.width,l=this.height,u=this.sunPosition,c=new THREE.Vector3;c.copy(u).project(o),c.x=(c.x+1)/2,c.y=(c.y+1)/2,this.godrayGenUniforms.vSunPositionScreenSpace.value.x=c.x,this.godrayGenUniforms.vSunPositionScreenSpace.value.y=c.y,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.x=c.x,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.y=c.y,e.setRenderTarget(this.rtTextureColors),e.clear(!0,!0,!1);var h=.74*l,d=.74*l;c.x*=s,c.y*=l,e.setScissor(c.x-d/2,c.y-h/2,d,h),e.setScissorTest(!0),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.scene2.overrideMaterial=this.materialGodraysFakeSun,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureColors),e.setScissorTest(!1),a.overrideMaterial=null,this.rendererRender(e,a,o,this.rtTextureColors),a.overrideMaterial=this.materialDepth,this.rendererRender(e,a,o,this.rtTextureDepth,!0),this.godrayMaskUniforms.tInput.value=this.rtTextureDepth.texture,this.scene2.overrideMaterial=this.materialGodraysDepthMask,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureDepthMask);this.filterGodRays(e,this.rtTextureDepthMask.texture,this.rtTextureGodRays2,this.getStepSize(.4,4,1)),this.filterGodRays(e,this.rtTextureGodRays2.texture,this.rtTextureGodRays1,this.getStepSize(.4,4,2)),this.filterGodRays(e,this.rtTextureGodRays1.texture,this.rtTextureGodRays2,this.getStepSize(.4,4,3)),this.godrayCombineUniforms.tColors.value=this.rtTextureColors.texture,this.godrayCombineUniforms.tGodRays.value=this.rtTextureGodRays2.texture,this.scene2.overrideMaterial=this.materialGodraysCombine,this.rendererRender(e,this.scene2,this.camera2,this.renderToScreen?null:t),this.scene2.overrideMaterial=null},getStepSize:function(e,t,r){return e*Math.pow(t,-r)},filterGodRays:function(e,t,r,n){this.godrayGenUniforms.fStepSize.value=n,this.godrayGenUniforms.tInput.value=t,this.scene2.overrideMaterial=this.materialGodraysGenerate,this.rendererRender(e,this.scene2,this.camera2,r),this.scene2.overrideMaterial=null},rendererRender:function(e,t,r,n,i){e.setRenderTarget(n),i&&e.clear(),e.render(t,r)}});var A=r(9);THREE.ShaderChunk.begin_vertex=["#ifndef INSTANCE_TRANSFORM","vec3 transformed = vec3( position );","#else","#ifndef INSTANCE_MATRIX","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","vec3 transformed = ( _instanceMatrix * vec4( position , 1. )).xyz;","#endif"].join("\n"),THREE.ShaderChunk.color_fragment=["#ifdef USE_COLOR","diffuseColor.rgb *= vColor;","#endif","#if defined(INSTANCE_COLOR)","diffuseColor.rgb *= vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_pars_fragment=["#ifdef USE_COLOR","varying vec3 vColor;","#endif","#if defined( INSTANCE_COLOR )","varying vec3 vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_vertex=["#ifdef USE_COLOR","vColor.xyz = color.xyz;","#endif","#if defined( INSTANCE_COLOR ) && defined( INSTANCE_TRANSFORM )","vInstanceColor = instanceColor;","#endif"].join("\n"),THREE.ShaderChunk.defaultnormal_vertex=["#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","#ifndef INSTANCE_TRANSFORM","vec3 transformedNormal = normalMatrix * objectNormal;","#else","#ifndef INSTANCE_MATRIX ","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","#ifndef INSTANCE_UNIFORM","vec3 transformedNormal =  transposeMat3( inversemat( mat3( modelViewMatrix * _instanceMatrix ) ) ) * objectNormal ;","#else","vec3 transformedNormal = ( modelViewMatrix * _instanceMatrix * vec4( objectNormal , 0.0 ) ).xyz;","#endif","#endif"].join("\n"),THREE.ShaderChunk.uv_pars_vertex=["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )","varying vec2 vUv;","uniform mat3 uvTransform;","#endif","#ifdef INSTANCE_TRANSFORM","mat3 inversemat(mat3 m) {","float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];","float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];","float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];","float b01 = a22 * a11 - a12 * a21;","float b11 = -a22 * a10 + a12 * a20;","float b21 = a21 * a10 - a11 * a20;","float det = a00 * b01 + a01 * b11 + a02 * b21;","return mat3(b01, (-a22 * a01 + a02 * a21), ( a12 * a01 - a02 * a11),","b11, ( a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),","b21, (-a21 * a00 + a01 * a20), ( a11 * a00 - a01 * a10)) / det;","}","attribute vec3 instancePosition;","attribute vec4 instanceQuaternion;","attribute vec3 instanceScale;","#if defined( INSTANCE_COLOR )","attribute vec3 instanceColor;","varying vec3 vInstanceColor;","#endif","mat4 getInstanceMatrix(){","vec4 q = instanceQuaternion;","vec3 s = instanceScale;","vec3 v = instancePosition;","vec3 q2 = q.xyz + q.xyz;","vec3 a = q.xxx * q2.xyz;","vec3 b = q.yyz * q2.yzz;","vec3 c = q.www * q2.xyz;","vec3 r0 = vec3( 1.0 - (b.x + b.z) , a.y + c.z , a.z - c.y ) * s.xxx;","vec3 r1 = vec3( a.y - c.z , 1.0 - (a.x + b.z) , b.y + c.x ) * s.yyy;","vec3 r2 = vec3( a.z + c.y , b.y - c.x , 1.0 - (a.x + b.x) ) * s.zzz;","return mat4(","r0 , 0.0,","r1 , 0.0,","r2 , 0.0,","v  , 1.0",");","}","#endif"].join("\n"),a.DEPTH_MATERIAL=new THREE.MeshDepthMaterial,a.DEPTH_MATERIAL.depthPacking=THREE.RGBADepthPacking,a.DEPTH_MATERIAL.clipping=!0,a.DEPTH_MATERIAL.defines={INSTANCE_TRANSFORM:""},a.DISTANCE_MATERIAL=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:"",INSTANCE_TRANSFORM:""},uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.distanceRGBA.uniforms),vertexShader:THREE.ShaderLib.distanceRGBA.vertexShader,fragmentShader:THREE.ShaderLib.distanceRGBA.fragmentShader,clipping:!0}),a.InstancedMesh=function(e,t,r,n,i,a){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i,a),this.isJamieInstancedMesh=!0,this.userData.type="InstancedMesh"},a.InstancedMesh.prototype=Object.create(THREE.Mesh.prototype),a.InstancedMesh.prototype.constructor=a.InstancedMesh,a.InstancedMesh.prototype.create=function(e,t,r,n,i,o){THREE.Mesh.call(this,(new THREE.InstancedBufferGeometry).copy(e)),this.numInstances=void 0!==r?r:1,this.dynamic=void 0!==n&&n,this.colors=void 0!==i&&i,this.uniformScale=void 0===o||o,this._setAttributes(),this.material=t.clone(),this.customDepthMaterial=a.DEPTH_MATERIAL,this.customDistanceMaterial=a.DISTANCE_MATERIAL,this.frustumCulled=!1,this.name="instancedMesh";var s=this.userData;s.numInstances=this.numInstances,s.dynamic=this.dynamic,s.colors=this.colors,s.uniformScale=this.uniformScale},Object.defineProperties(a.InstancedMesh.prototype,{material:{set:function(e){(e=e.clone()).defines?(e.defines.INSTANCE_TRANSFORM="",this.uniformScale?e.defines.INSTANCE_UNIFORM="":delete e.defines.INSTANCE_UNIFORM,this.colors?e.defines.INSTANCE_COLOR="":delete e.defines.INSTANCE_COLOR):(e.defines={INSTANCE_TRANSFORM:""},this.uniformScale&&(e.defines.INSTANCE_UNIFORM=""),this.colors&&(e.defines.INSTANCE_COLOR="")),this._material=e},get:function(){return this._material}},numInstances:{set:function(e){this._numInstances=e},get:function(){return this._numInstances}},geometry:{set:function(e){this._geometry=e},get:function(){return this._geometry}}}),a.InstancedMesh.prototype.setPositionAt=function(e,t){this.geometry.attributes.instancePosition.setXYZ(e,t.x,t.y,t.z)},a.InstancedMesh.prototype.setQuaternionAt=function(e,t){this.geometry.attributes.instanceQuaternion.setXYZW(e,t.x,t.y,t.z,t.w)},a.InstancedMesh.prototype.setScaleAt=function(e,t){this.geometry.attributes.instanceScale.setXYZ(e,t.x,t.y,t.z)},a.InstancedMesh.prototype.setColorAt=function(e,t){this.colors?this.geometry.attributes.instanceColor.setXYZ(e,Math.floor(255*t.r),Math.floor(255*t.g),Math.floor(255*t.b)):console.warn("JAMIE.InstancedMesh: color not enabled")},a.InstancedMesh.prototype.getPositionAt=function(e,t){var r=this.geometry.attributes.instancePosition.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},a.InstancedMesh.prototype.getQuaternionAt=function(e,t){var r=this.geometry.attributes.instanceQuaternion.array;return e<<=2,t?t.set(r[e++],r[e++],r[e++],r[e]):new THREE.Quaternion(r[e++],r[e++],r[e++],r[e])},a.InstancedMesh.prototype.getScaleAt=function(e,t){var r=this.geometry.attributes.instanceScale.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},a.InstancedMesh.prototype.getColorAt=function(e,t){if(!this.colors)return console.warn("JAMIE.InstancedMesh: color not enabled"),!1;var r=this.geometry.attributes.instanceColor.array;return e*=3,t?t.setRGB(r[e++]*(1/255),r[e++]*(1/255),r[e]*(1/255)):new THREE.Vector3(r[e++],r[e++],r[e]).multiplyScalar(1/255)},a.InstancedMesh.prototype.needsUpdate=function(e){switch(e){case"position":this.geometry.attributes.instancePosition.needsUpdate=!0;break;case"quaternion":this.geometry.attributes.instanceQuaternion.needsUpdate=!0;break;case"scale":this.geometry.attributes.instanceScale.needsUpdate=!0;break;case"colors":this.geometry.attributes.instanceColor.needsUpdate=!0;break;default:this.geometry.attributes.instancePosition.needsUpdate=!0,this.geometry.attributes.instanceQuaternion.needsUpdate=!0,this.geometry.attributes.instanceScale.needsUpdate=!0,this.colors&&(this.geometry.attributes.instanceColor.needsUpdate=!0)}},a.InstancedMesh.prototype._setAttributes=function(){this.geometry.setAttribute("instancePosition",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0)),this.geometry.setAttribute("instanceQuaternion",new THREE.InstancedBufferAttribute(new Float32Array(4*this.numInstances),4,!0)),this.geometry.setAttribute("instanceScale",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0));var e=!0===this.dynamic?THREE.DynamicDrawUsage:THREE.StaticDrawUsage;this.geometry.attributes.instancePosition.usage=e,this.geometry.attributes.instanceQuaternion.usage=e,this.geometry.attributes.instanceScale.usage=e,this.colors&&(this.geometry.setAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Uint8Array(3*this.numInstances),3,!0)),this.geometry.attributes.instanceColor.normalized=!0,this.geometry.attributes.instanceColor.usage=e)},a.InstancedMesh.prototype.fromObject=function(e){var t=e.geometry.clone();delete t.attributes.instanceColor,delete t.attributes.instancePosition,delete t.attributes.instanceQuaternion,delete t.attributes.instanceScale;var r=e.userData;this.create(t,e.material,r.numInstances,r.dynamic,r.colors,r.uniformScale);var n=this.geometry.attributes,i=e.geometry.attributes;n.instancePosition.copy(i.instancePosition),n.instanceQuaternion.copy(i.instanceQuaternion),n.instanceScale.copy(i.instanceScale),i.instanceColor&&n.instanceColor.copy(i.instanceColor)},a.InstancedMesh.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},a.InstancedMesh.prototype.clone=function(){var e=new a.InstancedMesh(this);return a.copyTransform(e,this),e},a.InstancedMesh.prototype.split=function(e){for(var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3,a=new THREE.Color,o=this.material,s=this.geometry.attributes,l=s.instancePosition,u=s.instanceQuaternion,c=s.instanceScale,h=s.instanceColor,d=l.count,f=0;f<d;f++){r.fromArray(l.array,3*f),n.fromArray(u.array,4*f),i.fromArray(c.array,3*f);var p=new THREE.BufferGeometry;for(var m in s){var g=s[m];!0!==g.isInstancedBufferAttribute&&p.setAttribute(m,g.clone())}var v=o;h&&(a.fromArray(h.array,3*f),a.multiplyScalar(1/255),(v=o.clone()).color.copy(a));var y=new THREE.Mesh(p,v);y.position.copy(r),y.quaternion.copy(n),y.scale.copy(i),t.push(y)}e&&e(t)},a.InstancedMesh.prototype.increaseInstances=function(e){!1===Array.isArray(e)&&(e=[e]);var t=this.geometry.attributes;for(var r in t){var n=t[r];if(!0===n.isInstancedBufferAttribute){var i=[];i.push(n),e.forEach(e=>{i.push(e.geometry.attributes[r])}),t[r]=THREE.BufferGeometryUtils.mergeInstancedBufferAttribute(i),t[r].needsUpdate=!0}}e.forEach(e=>{this.numInstances+=e.geometry.attributes.instancePosition.count}),this.userData.numInstances=this.numInstances},a.createStructuredMesh=function(e,t){t=t||{};var r=a.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=a.structuredPositions(t),o=i.length/3;if(0!==o){t.numInstances=o;var s=a.randomColors(t);s&&0!==s.length||(s=void 0);var l=new a.InstancedMesh(r,n,o,!1,!!s,!0);l.name="structuredMesh",l.frustumCulled=!1,a.copyTransform(l,e);for(var u=new THREE.Vector3,c=new THREE.Quaternion(0,0,0,1),h=new THREE.Vector3(1,1,1),d=new THREE.Color,f=0,p=0;f<o;f++,p+=3)u.fromArray(i,p),l.setPositionAt(f,u),l.setQuaternionAt(f,c),l.setScaleAt(f,h),void 0!==s&&(d.fromArray(s,p),l.setColorAt(f,d));return l}},a.createScatteredMesh=function(e,t){t=t||{};var r=a.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=a.scatteredPositions(t),o=i.positions,s=i.rotations,l=i.scales,u=o.length/3;if(0!==u){var c=a.randomColors(t);c&&0!==c.length||(c=void 0);var h=new a.InstancedMesh(r,n,u,!1,!!c,!0);h.name="scatteredMesh",h.frustumCulled=!1,a.copyTransform(h,e);for(var d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Euler,m=new THREE.Quaternion(0,0,0,1),g=new THREE.Vector3(1,1,1),v=new THREE.Color,y=0,_=0;y<u;y++,_+=3)d.fromArray(o,_),void 0!==s&&(f.fromArray(s,_),p.setFromVector3(f),m.setFromEuler(p)),void 0!==l&&g.fromArray(l,_),h.setPositionAt(y,d),h.setQuaternionAt(y,m),h.setScaleAt(y,g),void 0!==c&&(v.fromArray(c,_),h.setColorAt(y,v));return h}},a.createInstancedMeshes=function(e,t){t=t||{};!1===Array.isArray(e)&&(e=[e]);for(var r,n=[],i=0,o=e.length;i<o;i++)r=void 0!==t.pattern?a.createStructuredMesh(e[i],t):a.createScatteredMesh(e[i],t),n.push(r);return 1===n.length?n[0]:n},a.createInstancedObject=function(e,t){if(void 0===t.seed&&(t.seed=e.id),!0===e.isMesh)return a.createInstancedMeshes(e,t);var r=new THREE.Object3D;r.name=e.name;for(var n=e.children,i=0,o=n.length;i<o;i++){var s=a.createInstancedObject(n[i],t);r.add(s)}return a.copyTransform(r,e),r},a.CSGBoolean=function(e,t,r){t=t||"union";var n=new ThreeBSP(e),i=new ThreeBSP(r);"union"===t||"+"===t?n=n.union(i):"intersect"===t||"*"===t?n=n.intersect(i):"subtract"!==t&&"-"!==t||(n=n.subtract(i));var a=null;return e instanceof THREE.Mesh?a=n.toMesh(null):e instanceof THREE.BufferGeometry?a=n.toNonIndexedBufferGeometry():e instanceof THREE.Geometry&&(a=n.toGeometry()),a},a.union=function(e,t){return a.CSGBoolean(e,"+",t)},a.intersect=function(e,t){return a.CSGBoolean(e,"*",t)},a.subtract=function(e,t){return a.CSGBoolean(e,"-",t)},a.createWireframe=function(e,t,r){var n;t=void 0!==t?t:0,r=void 0!==r&&r;(i=e.material).polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=1,i.needsUpdate=!0,n=r?new THREE.EdgesGeometry(e.geometry):new THREE.WireframeGeometry(e.geometry);var i=new THREE.LineBasicMaterial({color:t,linewidth:2});return new THREE.LineSegments(n,i)},a.createVertexPoints=function(e,t,r){var n=a.getObjectSize(e);t=t||n/100,r=r||16777215;return new THREE.Points(e.geometry,new THREE.PointsMaterial({map:(new THREE.TextureLoader).load("images/sprites/ball.png"),size:t,color:r,transparent:!0,alphaTest:.1}))},a.TextSprite=function(e,t){t=t||{};var r={};r.string=e||"",r.height=t.textHeight||.5,r.widthScale=t.textWidthScale||1,r.color=t.textColor||"#ffffff",r.align=t.textAlign||"center",r.baseline=t.textBaseline||"middle",this.text=r;var n={};n.style=t.fontStyle||"normal",n.variant=t.fontVariant||"normal",n.weight=t.fontWeight||"normal",n.size=t.fontSize||"64px",n.family=t.fontFamily||"Karla, sans-serif",this.font=n;var i=document.createElement("canvas");i.height=parseInt(n.size),i.width=i.height*r.string.length;var o=i.getContext("2d");o.font=n.style+" "+n.variant+" "+n.weight+" "+n.size+" "+n.family,o.textAlign=r.align,o.textBaseline=r.baseline,o.fillStyle=a.toHexStyle(r.color),o.fillText(r.string,i.width/2,i.height/2),this.ctx=o;var s=new THREE.CanvasTexture(this.ctx.canvas),l=new THREE.SpriteMaterial({color:16777215,map:s});THREE.Sprite.call(this,l),this.type="TextSprite";var u=r.height*r.string.length*r.widthScale;this.scale.set(u,r.height,1)},a.TextSprite.prototype=Object.assign(Object.create(THREE.Sprite.prototype),{constructor:a.TextSprite,isTextSprite:!0,copy:function(e){return THREE.Sprite.prototype.copy.call(this,e),this.text=JSON.parse(JSON.stringify(e.text)),this.font=JSON.parse(JSON.stringify(e.font)),this.ctx.drawImage(e.ctx.canvas,0,0),this},clone:function(){return new this.constructor(this.text.string).copy(this)},updateText:function(e){var t=this.ctx.canvas,r=this.ctx,n=this.text,i=this.font;n.string=e||"",t.height=parseInt(i.size),t.width=t.height*n.string.length,r.font=i.style+" "+i.variant+" "+i.weight+" "+i.size+" "+i.family,r.textAlign=n.align,r.textBaseline=n.baseline,r.fillStyle=a.toHexStyle(n.color),r.fillText(n.string,t.width/2,t.height/2);var o=n.height*n.string.length*n.widthScale;this.scale.set(o,n.height,1),this.material.map.needsUpdate=!0}}),a.createTextSprite=function(e,t){return new a.TextSprite(e,t)},a.addTextMesh=function(e,t){e=e||"text",(t=t||{}).position=t.position||{x:0,y:0,z:0},t.color=t.color||16777215,t.height=t.height||1,t.thickRatio=t.thickRatio||.25,t.alignment=t.alignment||1,t.rotSpeed=t.rotSpeed||0,t.fontFile=t.fontFile||"fonts/gentilis_regular.typeface.json",(new THREE.FontLoader).load(t.fontFile,(function(r){var n=new THREE.MeshPhongMaterial({color:t.color,specular:t.color}),i=new THREE.TextBufferGeometry(e,{font:r,size:100,height:100*t.thickRatio,curveSegments:12,bevelEnabled:!0,bevelThickness:2,bevelSize:5,bevelSegments:3});i.computeBoundingBox();var o=(i.boundingBox.max.x-i.boundingBox.min.x)*t.alignment/2,s=(new THREE.Matrix4).makeTranslation(-o,0,0);i.applyMatrix(s);var l=new THREE.Mesh(i,n);l.scale.setScalar(t.height/100),l.position.set(t.position.x,t.position.y,t.position.z),l.castShadow=!0,l.receiveShadow=!0,l.name=e,0!==t.rotSpeed&&(l.update=function(e,r){this.rotation.y+=t.rotSpeed*e}),a.add(l)}))},a.createPrimitive=function(e){var t=new THREE[e.geometry.type](...e.geometry.parameters),r=e.material.type;delete e.material.type;var n=new THREE[r](e.material);e.material.type=n.type;var i=new THREE.Mesh(t,n),a=t.type.replace("Buffer","").replace("Geometry",""),o=n.type.replace("Mesh","").replace("Material","");return i.name=a+o,i.frustumCulled=!1,i.castShadow=!0,i.receiveShadow=!0,i},a.createCheckerboard=function(e,t){e=void 0!==e?e:100,t=void 0!==t?t:5;var r=(new THREE.TextureLoader).load("images/grid2x2.png",r=>{r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping,r.repeat.set(e/(2*t),e/(2*t))}),n=a.createPrimitive({geometry:{type:"PlaneBufferGeometry",parameters:[e,e]},material:{type:"MeshPhongMaterial",map:r}});return n.rotation.x=-Math.PI/2,n},a.tweenObject=function(e,t,r){var n=void 0!==(r=r||{}).duration?r.duration:1e3,i=new A.Tween(e).to(t,n);return void 0!==r.easing&&i.easing(r.easing),void 0!==r.interpolation&&i.interpolation(r.interpolation),void 0!==r.repeat&&i.repeat(r.repeat),void 0!==r.repeatDelay&&i.repeatDelay(r.repeatDelay),!0===r.yoyo&&i.yoyo(r.yoyo),void 0!==r.update&&i.onUpdate(e=>{r.update(e)}),void 0!==r.complete&&i.onComplete(e=>{r.complete(e)}),void 0!==r.start?i.start(r.start+(r.delay||0)):void 0!==r.delay&&i.delay(r.delay),i},a.tweenObjects=function(e,t,r){var n=new A.Group,i=r.delay,o=r.delay||0;return e.forEach((e,i)=>{void 0!==r.objectDelay&&(r.delay=o+i*r.objectDelay),n.add(a.tweenObject(e,t[i],r))}),r.delay=i,n},a.GridLOD=function(e){THREE.Object3D.apply(this),this.previousLodResolution=0,this.create(e,!1),this.name="gridLOD",this.frustumCulled=!1},a.GridLOD.prototype=Object.create(THREE.Object3D.prototype),a.GridLOD.prototype.constructor=Object.create(a.GridLOD),a.GridLOD.prototype.controlLODParameters=function(e,t){function r(e,t){return void 0!==e?e:t}void 0===e&&(e={}),(t=r(t,!1))?(this.lodResolution=r(e.resolution,this.lodResolution),this.lodLevels=r(e.levels,this.lodLevels),this.lodScale=r(e.scale,this.lodScale),this.lodMorphingLevels=r(e.morphingLevels,this.lodMorphingLevels),this.lodMaterial=r(e.material,this.lodMaterial)):(this.lodResolution=r(e.resolution,64),this.lodLevels=r(e.levels,8),this.lodScale=r(e.scale,1),this.lodMorphingLevels=r(e.morphingLevels,2),this.lodMaterial=r(e.material,void 0)),this.lodLevels=Math.max(1,Math.round(this.lodLevels)),this.lodScale=Math.max(1,this.lodScale),this.lodResolution=Math.max(1,this.lodResolution),this.lodResolution=Math.pow(2,Math.round(Math.log2(this.lodResolution))),this.lodMorphingLevels=Math.max(0,Math.min(2,Math.round(this.lodMorphingLevels))),this.previousLodResolution=this.lodResolution},a.GridLOD.prototype.createLODMaterial=function(){var e=a.GridLODShader,t=THREE.UniformsUtils.clone(e.uniforms);return t.u_resolution={value:this.lodResolution},t.u_level={value:this.lodLevels},t.u_scale={value:this.lodScale},t.u_morphingLevels={value:this.lodMorphingLevels},t.u_usePlaneParameters={value:0},t.u_planeUp={value:new THREE.Vector3(0,1,0)},t.u_planeAt={value:new THREE.Vector3(0,0,1)},t.u_planePoint={value:new THREE.Vector3(0,0,0)},t.u_planeDistance={value:0},new THREE.ShaderMaterial({uniforms:t,vertexShader:e.buildVertexShader("lod"),fragmentShader:e.fragmentShader,side:THREE.DoubleSide,wireframe:!1})},a.GridLOD.prototype.create=function(e,t){var r=this.previousLodResolution;if(this.controlLODParameters(e,t),!1===t&&(this.lodMaterial=this.createLODMaterial()),r!==this.lodResolution){for(this.gridGeometry=this.createLODGeometry(this.lodResolution),this.gridOutsideGeometry=this.createLODGeometry(this.lodResolution,!0);this.children.length>0;)this.remove(this.children[0]);this.lodMaterial.uniforms.u_resolution.value=this.lodResolution;for(var n=this.lodScale,i=0;i<this.lodLevels;i++){var a=0===i?this.gridGeometry:this.gridOutsideGeometry;this.add(this.createLODMesh(a,this.lodMaterial,n,i)),n*=2}}},a.GridLOD.prototype.createLODMesh=function(e,t,r,n){var i=t.clone();return i.uniforms.u_scale.value=r,i.uniforms.u_level.value=n,new THREE.Mesh(e,i)},a.GridLOD.prototype.createLODGeometry=function(e,t){function r(e,t){return void 0!==e?e:t}e=r(e,64),t=r(t,!1);var n=new THREE.BufferGeometry,i=Math.round(.5*e),a=(e+2)*(e+2)*2,o=new Float32Array(3*((e+3)*(e+3))),s=new(o.length/3>65535?Uint32Array:Uint16Array)(3*a);n.setIndex(new THREE.BufferAttribute(s,1)),n.setAttribute("position",new THREE.BufferAttribute(o,3));for(var l=0,u=-i-1;u<=i+1;u++)for(var c=-i-1;c<=i+1;c++)o[l]=u/e,o[l+1]=0,o[l+2]=c/e,l+=3;l=0;var h=e+3,d=e/4,f=3*d;for(u=0;u<=e+1;u++){var p=u,m=u+1,g=u>d&&u<=f;for(c=0;c<=e+1;c++){var v=c+1;if(!(t&&g&&(c>d&&c<=f))){var y=h*p+v,_=h*m+v,b=h*m+c,E=h*p+c;s[l]=y,s[l+1]=_,s[l+2]=E,s[l+3]=E,s[l+4]=_,s[l+5]=b,l+=6}}}return n},a.GridLOD.prototype.setLODScale=function(e){this.lodScale=e,this.controlLODParameters({},!0);var t=this.lodScale;this.children.forEach(e=>{e.material.uniforms.u_scale.value=t,t*=2})},a.GridLOD.prototype.setMorphingLevels=function(e){this.lodMorphingLevels=e,this.controlLODParameters({},!0),e=this.lodMorphingLevels,this.children.forEach(t=>{t.material.uniforms.u_morphingLevels.value=e})},a.GridLOD.prototype.setMaterialValue=function(e,t){this.lodMaterial[e]=t,this.children.forEach(r=>{r.material[e]=t})},a.GridLOD.prototype.setUniformValue=function(e,t){this.lodMaterial.uniforms[e].value=t,this.children.forEach(r=>{r.material.uniforms[e].value=t})},a.GridLOD.prototype.getUniformValue=function(e){return this.lodMaterial.uniforms[e].value},a.GridLOD.prototype.createParentCamera=function(){return this.parent instanceof THREE.PerspectiveCamera||(this.parent=a.camera.clone(),this.parent.add(this)),this.parent},a.GridLOD.prototype.update=function(e,t){!0===this.getUniformValue("u_animate")&&this.setUniformValue("u_time",t)},a.createGridLOD=function(e,t,r,n){return new a.GridLOD({resolution:e,levels:t,scale:r,morphingLevels:n})},a.TerrainLOD=function(e,t,r,n,i){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i),this.userData.type="TerrainLOD"},a.TerrainLOD.prototype=Object.create(THREE.Object3D.prototype),a.TerrainLOD.prototype.constructor=a.TerrainLOD,a.TerrainLOD.prototype.create=function(e,t,r,n,i){THREE.Object3D.call(this),this.name="terrainLOD",this.frustumCulled=!1;var o=0,s=1,l=2,u=4,c=8,h=new THREE.TextureLoader;this.diffuse1=h.load("images/terrain/rockyTerrainGrass.jpg"),this.diffuse2=h.load("images/terrain/rockyTerrainDirt.jpg"),this.diffuse1.wrapS=this.diffuse1.wrapT=THREE.RepeatWrapping,this.diffuse2.wrapS=this.diffuse2.wrapT=THREE.RepeatWrapping;var d=this.userData;d.landscape=void 0!==e?e:"GIANT",d.worldWidth=void 0!==t?t:1024,d.levels=void 0!==r?r:4,d.resolution=void 0!==n?n:64,d.maxHeight=void 0!==i?i:.1*a.WORLD_SIZE,d.globalOffset=new THREE.Vector3(0,0,0),this.heightMap=this.getHeightMap(d.worldWidth,d.landscape),this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,d.resolution,d.resolution),this.tileGeometry.translate(.5,.5,0);var f=d.worldWidth/Math.pow(2,d.levels);this.createTile(-f,-f,f,o),this.createTile(-f,0,f,o),this.createTile(0,0,f,o),this.createTile(0,-f,f,o);for(var p=f;p<d.worldWidth;p*=2)this.createTile(-2*p,-2*p,p,u|l),this.createTile(-2*p,-p,p,l),this.createTile(-2*p,0,p,l),this.createTile(-2*p,p,p,s|l),this.createTile(-p,-2*p,p,u),this.createTile(-p,p,p,s),this.createTile(0,-2*p,p,u),this.createTile(0,p,p,s),this.createTile(p,-2*p,p,u|c),this.createTile(p,-p,p,c),this.createTile(p,0,p,c),this.createTile(p,p,p,s|c)},a.TerrainLOD.prototype.createTile=function(e,t,r,n){var i=this.createTileMaterial(new THREE.Vector2(e,t),r,n),a=new THREE.Mesh(this.tileGeometry,i);a.rotation.x=-Math.PI/2,a.frustumCulled=!1,a.castShadow=!1,a.receiveShadow=!0,this.add(a)},a.TerrainLOD.prototype.createTileMaterial=function(e,t,r){var n=this.userData,i=a.TerrainLODShader,o=THREE.UniformsUtils.clone(i.uniforms);o.tDiffuse1.value=this.diffuse1,o.tDiffuse2.value=this.diffuse2,o.worldWidth.value=parseFloat(n.worldWidth),o.tileResolution.value=parseFloat(n.resolution),o.edgeMorph.value=r,o.globalOffset.value=n.globalOffset,o.tileOffset.value=e,o.heightMap.value=this.heightMap,o.tileScale.value=parseFloat(t),o.maxHeight.value=n.maxHeight,o.winterSnow.value=!1,o.summerGreen.value=!1;var s={};a.isWebGL2()&&(s.texture2DLod="textureLod");var l=new THREE.ShaderMaterial({defines:s,uniforms:o,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,lights:!0,fog:void 0!==a.scene.fog});return l.extensions={derivatives:!0,shaderTextureLOD:!0},l},a.TerrainLOD.prototype.getHeightMap=function(e,t){var r,n,i,o,s,l,u=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0];var n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0,s=0;s<5;s++){var l=Math.abs(t(n.x,n.y));i+=a*l/(1+(o+=l)*o*o),a*=.5,n.multiplyScalar(2).applyMatrix3(r)}return Math.pow(i,1)}}(),c=(r=new THREE.SimplexNoise,n=r.noise.bind(r),i=new THREE.Vector3(100,100,0),o=new THREE.Vector3,function(e){o.copy(e);for(var t=0,r=.5,a=0;a<5;a++)t+=r*Math.abs(n(o.x,o.y)),o.multiplyScalar(2).add(i),r*=.5;return Math.pow(.5*t+.5,2)}),h=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<2;o++)i+=a*Math.abs(t(n.x,n.y)),n.multiplyScalar(2).add(r),a*=.5;return Math.pow(i,1.5)}}(),d=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<5;o++){var s=1-Math.abs(t(n.x,n.y));i+=a*(s*s),n.multiplyScalar(2).add(r),a*=.5}return Math.pow(i,2)}}(),f=function(){var e=new THREE.Vector3;return function(t){var r=d(e.copy(t).multiplyScalar(9)),n=c(e.copy(t).multiplyScalar(2)),i=h(e.copy(t)),o=(i+=.25*i)/100;return a.mix(n,r,a.smoothstep(.45,.55,o))}}(),p=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3,n=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0],n.elements=[1.3623,1.7531,0,-1.7131,1.4623,0,0,0,0];var i=new THREE.Vector3,a=new THREE.Vector3;function o(e){i.copy(e);var n=0;return n+=.5*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.02).applyMatrix3(r),n+=.25*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.03).applyMatrix3(r),n+=.125*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.01).applyMatrix3(r),(n+=.0625*Math.abs(t(i.x,i.y)))/.9375}return function(e){i.copy(e).multiplyScalar(5),a.copy(i).multiplyScalar(.25);var t=.75*o(a)+.25;t*=2*t;for(var r=0,s=0;s<5;s++)r+=t*o(i),t=.5*-t,i.applyMatrix3(n);a.copy(i).multiplyScalar(.002);var l=o(a);return r+=Math.pow(Math.abs(l),10),Math.pow(r,2)}}(),m=function(){function e(e){return Math.abs(function(e){return e-parseInt(e)}(e)-.5)}function t(t){return e(t.x+e(1.5*(t.y-.25)))+e(t.y-e(1.5*(t.x+.5)))}function r(e){return.25+.25*Math.cos(6.2831853*e)}function n(e){return r(e.x+r(1.5*(e.y-.25)))+r(e.y-r(1.5*(e.x+.5)))}var i=new THREE.Vector3,a=new THREE.Vector3;return function(e){i.copy(e).multiplyScalar(2);var r=.66*n(a.copy(i).divideScalar(2))+.34*n(a.copy(i));return.75*(r=.75*function(e){return(e=Math.max((e-.3)/.7,0))*e*(3-2*e)}(r)+.15*t(a.copy(i))+.1*t(a.copy(i).multiplyScalar(4)))}}(),g=(s=a.createFbmNoise({octaves:4,persistence:.5,noiseType:"simplex3d"}),function(e){return Math.abs(s(e.x,e.y,1))}),v=function(){var e=new THREE.ImprovedNoise,t=new THREE.Vector3;return function(r){t.copy(r);for(var n=0,i=.5,a=0;a<4;a++)n+=i*Math.abs(e.noise(t.x,t.y,0))*2.5,t.multiplyScalar(2),i*=.5;return Math.pow(n,2)}}();e=void 0!==e?e:1024;switch(t=void 0!==t?t:"GIANT"){case"BADLAND":l=u;break;case"MOUNTAIN":l=c;break;case"DOME":l=h;break;case"RIDGE":l=d;break;case"DESIGN":l=f;break;case"GIANT":l=p;break;case"TRIANGLE":l=m;break;case"GREAT":l=g;break;case"HUGE":l=v;break;default:l=p}var y=0,_=256,b=new THREE.Vector3,E=new Uint8Array(e*e);"GIANT"===t&&(_=512);for(var w=0;w<e;w++)for(var x=0;x<e;x++)b.x=x/_,b.y=w/_,E[y++]=256*l(b);var T=new THREE.DataTexture(E,e,e,THREE.AlphaFormat);return T.wrapS=THREE.MirroredRepeatWrapping,T.wrapT=THREE.MirroredRepeatWrapping,T.magFilter=THREE.NearestFilter,T.minFilter=THREE.NearestFilter,T.generateMipmaps=!0,T.needsUpdate=!0,T},a.TerrainLOD.prototype.fromObject=function(e){var t=e.userData;this.create(t.landscape,t.worldWidth,t.levels,t.resolution,t.maxHeight)},a.TerrainLOD.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},a.TerrainLOD.prototype.clone=function(){var e=new a.TerrainLOD(this);return a.copyTransform(e,this),e},a.TerrainLOD.prototype.updateVisible=function(e){a.appWorks.setValue(this,"visible",e)},a.TerrainLOD.prototype.updateResolution=function(e){this.userData.resolution=e,this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,e,e);var t=new THREE.Matrix4;t.makeTranslation(.5,.5,0),this.tileGeometry.applyMatrix(t),this.children.forEach(t=>{t.material.uniforms.tileResolution=parseFloat(e)})},a.TerrainLOD.prototype.updateMaxHeight=function(e){this.userData.maxHeight=e,this.children.forEach(t=>{t.material.uniforms.maxHeight=e})},a.createTerrainLOD=function(e,t,r,n,i){return new a.TerrainLOD(e,t,r,n,i)},a.createHeightMapTerrain=function(e,t){var r=void 0!==t.highZoneFile?t.highZoneFile:"images/terrain/rockyTerrainGrass.jpg",n=void 0!==t.lowZoneFile?t.lowZoneFile:"images/terrain/rockyTerrainDirt.jpg",i=void 0!==t.worldWidth?t.worldWidth:1024,o=void 0!==t.resolution?t.resolution:1024,s=void 0!==t.tileOffset?t.tileOffset:new THREE.Vector2(0,0),l=void 0!==t.tileScale?t.tileScale:i,u=void 0!==t.maxHeight?t.maxHeight:.05*a.WORLD_SIZE,c=new THREE.PlaneBufferGeometry(1,1,o,o);c.translate(.5,.5,0);var h=function(t,i,o,s,l){var u=new THREE.TextureLoader,c=u.load(e);c.magFilter=THREE.LinearFilter,c.minFilter=THREE.LinearMipMapLinearFilter,c.generateMipmaps=!0,c.needsUpdate=!0;var h=u.load(r),d=u.load(n),f=a.TerrainLODShader,p=THREE.UniformsUtils.clone(f.uniforms);p.tDiffuse1.value=h,p.tDiffuse2.value=d,p.worldWidth.value=parseFloat(t),p.tileResolution.value=parseFloat(i),p.edgeMorph.value=0,p.globalOffset.value=new THREE.Vector3(0,0,0),p.tileOffset.value=o,p.heightMap.value=c,p.tileScale.value=parseFloat(s),p.maxHeight.value=l,p.winterSnow.value=!1,p.summerGreen.value=!0;var m={};a.isWebGL2()?m.texture2DLodEXT="textureLod":m.texture2DLodEXT="texture2DLod";var g=new THREE.ShaderMaterial({defines:m,uniforms:p,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,lights:!0,fog:void 0!==a.scene.fog});return g.extensions={derivatives:!0,shaderTextureLOD:!0},g}(i,o,s,l,u),d=new THREE.Mesh(c,h);return d.rotation.x=-Math.PI/2,d.position.x-=i/2,d.position.z+=i/2,d.frustumCulled=!1,d.castShadow=!1,d.receiveShadow=!0,d.name="heightMapTerrain",d};var R=r(63),k=r(64),P=r(65);a.DesignWorks=function(e){var t,r=this;e=e||{};if(this.appName=e.appName||"designWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=a.tabIndices[this.dom.id],this.dom.style.position="absolute",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight,this.signals=null,!0===e.signals){var n=R.Signal;this.signals={startPlayer:new n,stopPlayer:new n,appWorksCleared:new n,autoSaveStarted:new n,autoSaveFinished:new n,themeChanged:new n,transformModeChanged:new n,snapChanged:new n,spaceChanged:new n,sceneBackgroundChanged:new n,sceneFogChanged:new n,sceneGraphChanged:new n,cameraChanged:new n,geometryChanged:new n,objectSelected:new n,objectFocused:new n,objectsSelected:new n,objectAdded:new n,objectChanged:new n,objectRemoved:new n,helperAdded:new n,helperChanged:new n,helperRemoved:new n,materialChanged:new n,windowResize:new n,axesHelperChanged:new n,gridHelperChanged:new n,initSidebar:new n,historyChanged:new n},(t=r.signals).startPlayer.add((function(){r.history.historyDisabled=!0})),t.stopPlayer.add((function(){r.history.historyDisabled=!1})),t.themeChanged.add((function(){})),t.sceneBackgroundChanged.add((function(e){r.config.setSettings("background",e)})),t.sceneFogChanged.add((function(e){r.createSceneFog(e),w()})),t.gridHelperChanged.add((function(e,t,n){a.dispose(r.gridHelper),r.gridHelper=b(e,t,n),r.sceneHelpers.add(r.gridHelper),w()})),t.geometryChanged.add((function(e){})),t.materialChanged.add((function(e){})),t.objectAdded.add((function(e){var t=r.selectables;e.traverse((function(e){t.push(e)}))})),t.objectRemoved.add((function(e){r.transformControls&&r.transformControls.object===e&&r.transformControls.detach();var t=r.selectables;e.traverse((function(e){t.splice(t.indexOf(e),1)}))})),t.objectChanged.add((function(e){e instanceof THREE.PerspectiveCamera&&e.updateProjectionMatrix(),!e.helper||e.helper instanceof THREE.SkeletonHelper||(e.helper.update(),t.helperChanged.dispatch(e.helper)),w()})),t.objectsSelected.add((function(e){if(Array.isArray(e)){if(1===e.length){var t=e[0];if(null===t.parent)return;var n=r.transformControls.enabled;r.transformControls.detach(),r.transformControls.attach(t),r.transformControls.visible=n,r.transformControls.enabled=n}if(r.outlinePass.enabled){var i=r.outlinePass;i.selectedObjects=[],e.forEach((function(e){e.traverse((function(e){0===e.children.length&&i.selectedObjects.push(e)}))}))}}})),t.objectFocused.add((function(e){var t=new THREE.Vector3;e&&t.copy(e.position),r.controls instanceof THREE.OrbitControls||r.controls instanceof THREE.TrackballControls?(r.controls.target.copy(t),r.controls.update()):r.controls instanceof THREE.FirstPersonControls&&(r.controls.lookAt(t),r.controls.update(a.getDeltaTime()))})),t.helperAdded.add((function(e){var t=e.getObjectByName("picker");r.selectables.push(t)})),t.helperChanged.add((function(e){var t=e.light;t&&(e.visible=t.visible)})),t.helperRemoved.add((function(e){var t=r.selectables,n=e.getObjectByName("picker");t.splice(t.indexOf(n),1)})),t.cameraChanged.add((function(e){e&&(r.config.setSettings("cameraFov",e.fov),r.config.setSettings("cameraNear",e.near),r.config.setSettings("cameraFar",e.far)),w()})),t.historyChanged.add((function(){var e=r.history;e.undos.length,e.redos.length})),t.appWorksCleared.add((function(){r.select(null),r.focus(),w()})),t.autoSaveStarted.add((function(){})),t.autoSaveFinished.add((function(){})),t.transformModeChanged.add((function(e){r.transformControls.setMode(e)})),t.snapChanged.add((function(e){r.transformControls.setTranslationSnap(e)})),t.spaceChanged.add((function(e){r.transformControls.setSpace(e)})),t.windowResize.add((function(){x(),w()}))}if(this.config=null,!0===e.config&&(this.config=new a.Config(this.appName),this.config.initDatabase((function(){var e;function t(){!1!==r.config.getSettings("autosave")&&(clearTimeout(e),e=setTimeout((function(){r.signals.autoSaveStarted.dispatch(),e=setTimeout((function(){r.config.setDatabase(r.toJSON()),r.signals.autoSaveFinished.dispatch()}),100)}),1e3))}r.config.getDatabase((function(e){void 0!==e&&r.fromJSON(e)}));var n=r.signals;n.geometryChanged.add(t),n.materialChanged.add(t),n.objectAdded.add(t),n.objectChanged.add(t),n.objectRemoved.add(t),n.sceneBackgroundChanged.add(t),n.sceneFogChanged.add(t),n.sceneGraphChanged.add(t),n.historyChanged.add(t)}))),this.history=null,!0===e.history&&(this.history=new a.History(this)),2===e.glVersion&&a.isWebGL2Available()){var i=document.createElement("canvas"),o=i.getContext("webgl2");this.renderer=new THREE.WebGLRenderer({canvas:i,context:o,alpha:!0,powerPreference:"high-performance"})}else this.renderer=new THREE.WebGLRenderer({alpha:!0,powerPreference:"high-performance"});this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.outputEncoding=THREE.sRGBEncoding,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName,this.createSceneFog=function(e){this.scene.fog=a.createFog(e)},this.createSceneFog(e.fog),this.createSceneBackground=function(e){e=void 0!==e?e:this.config?this.config.getSettings("background"):null;this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.background=a.createBackground(e)},this.createSceneBackground(e.background);var s,l,u,c,h,d,f,p,m,g=e.cameraFov||this.config?this.config.getSettings("cameraFov"):50,v=e.cameraNear||this.config?this.config.getSettings("cameraNear"):.01,y=e.cameraFar||this.config?this.config.getSettings("cameraFar"):1e4,_=e.cameraPosition||this.config?this.config.getSettings("cameraPosition"):[0,0,50];function b(e,t,n){e=e||r.config?r.config.getSettings("gridHelperSize"):500,t=t||r.config?r.config.getSettings("gridHelperSpacing"):5,n=n||r.config?r.config.getSettings("gridHelperColor"):4210752;e=~~(e/t),e*=t;var i=new THREE.GridHelper(e,e/t,16729156,n);i.position.y=0,i.name="gridHelper";for(var o=.05*t,s=e/2,l=[],u=-s;u<=s;u+=t)l.push(u.toFixed(2));return l.forEach((function(e){var t=a.createTextSprite(e,{textHeight:o,fontWeight:"bold"}),r=t.clone();t.position.set(parseFloat(e),o/2,0),r.position.set(0,o/2,parseFloat(e)),i.add(t),i.add(r)})),i}function E(){requestAnimationFrame(E),function(){var e=a.getDeltaTime(),t=a.getCurrentTime();r.stats&&r.stats.update();r.animation.update(e),r.scene.traverse((function(r){r.update&&r.update(e,t)})),r.sceneHUD&&r.sceneHUD.traverse((function(r){r.update&&r.update(e,t)}));var n=r.controls;n.enabled&&(n instanceof THREE.OrbitControls?!0!==n.autoRotate&&!0!==n.enableDamping||n.update():n instanceof THREE.TrackballControls?n.update():(n instanceof THREE.FirstPersonControls||!0===n.isTPSCameraControl)&&n.update(e))}(),w()}function w(){r.effect?(r.renderer.setRenderTarget(null),r.effect.render(r.scene,r.camera)):r.composer?r.composer.render():"medicalWorks"===!r.appName&&r.renderer.render(r.scene,r.camera)}function x(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);r.width=r.widthRatio*e,r.height=r.heightRatio*t,r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix(),function(){if(!r.sceneHUD||!r.cameraHUD)return;var e=r.cameraHUD,t=e.right,n=e.top,i=r.width/2,a=r.height/2;e.left=-i,e.right=i,e.top=a,e.bottom=-a,e.updateProjectionMatrix(),r.sceneHUD.children.forEach(e=>{var r=e.position;r.x*=1+(i-t)/Math.abs(r.x),r.y*=1+(a-n)/Math.abs(r.y)})}(),r.FXAAShader.enabled&&r.FXAAShader.uniforms.resolution.value.set(1/r.width,1/r.height),r.renderer.setSize(r.width,r.height),r.composer&&r.composer.setSize(r.width,r.height),r.effect&&r.effect.setSize(r.width,r.height),r.controls.enabled&&(r.controls instanceof THREE.OrbitControls||r.controls.handleResize()),r.scene.getObjectsByType("FireParticles").forEach((function(e){e.setNearPlaneHeight()}))}function T(e){var t=r.dom.getBoundingClientRect(),n=a.getMouseScreenCoords(e);return n.x=(n.x-t.left)/t.width*2-1,n.y=-(n.y-t.top)/t.height*2+1,n}function M(e,t){return r.raycaster.setFromCamera(e,r.camera),r.raycaster.intersectObjects(t,!0)}function S(){var e=r.getIntersectObject(r.xinfo);e&&("picker"===e.name?r.select(e.userData.object):event.ctrlKey?r.select(e,"multiple"):event.altKey?r.select(e,"ancestor"):r.select(e),w())}function A(e){r.mouseUpPosition.copy(T(e)),S(),document.removeEventListener("mouseup",A,!1)}function P(e){e.preventDefault(),p&&(clearTimeout(p),m=!1),r.mouseUpPosition.copy(T(e)),S(),document.removeEventListener("touchend",P,!1)}function L(e){r.mouseUpPosition.copy(r.mouseDownPosition),C(e)}function C(e){r.guiContextMenu&&(r.getIntersectObject()&&r.guiContextMenu.toggle(e))}function I(e){switch(r.appName){case"viewWorks":!function(e){switch(e.stopPropagation(),e.keyCode){case 8:e.preventDefault();case 27:r.controls.enabled=!0;break;case 49:a.nextShowroom(r.showroom,"background");break;case 50:a.nextShowroom(r.showroom,"floor");break;case 79:if(r.animation&&r.selectObject){var t=r.selectObject.activeAction;t.paused=!t.paused}break;case 80:r.animation&&r.selectObject&&r.playNextAction(r.selectObject)}}(e);break;case"gameWorks":!function(e){switch(e.keyCode){case 66:a.demoApplication();break;case 191:a.gamePlay()}}(e);break;case"natureWorks":!function(e){122!==e.keyCode&&e.preventDefault();e.stopPropagation();var t=a.isCtrlKeyDown(e);if(t&&90===e.keyCode)return void r.undo();if(t&&89===e.keyCode)return void r.redo();switch(e.keyCode){case 8:e.preventDefault();case 46:var n=r.selectObject;n&&n.parent&&r.remove(n);break;case 18:break;case 27:r.controls.enabled=!0;break;case 49:a.filmGrainBackground();break;case 50:break;case 66:a.demoApplication();break;case 67:r.controls instanceof THREE.OrbitControls?r.controls=a.createCameraControls("FirstPersonControls"):r.controls instanceof THREE.FirstPersonControls&&(r.controls=a.createCameraControls("OrbitControls"));break;case 70:a.demoLoadFiles();break;case 72:a.add(a.createHemisphereLight());break;case 73:a.cameraAutoView({isWorking:!0})?a.cameraAutoView({viewMode:"stop"}):a.cameraAutoView({viewMode:"circle"});break;case 76:a.toggleLightHelpers();break;case 77:void 0!==r.sound&&(r.sound.playing()?r.sound.pause():r.sound.play());break;case 78:a.add(a.createSky()),a.add(a.createSunLight());break;case 79:if(r.animation&&r.selectObject){var i=r.selectObject.activeAction;i.paused=!i.paused}break;case 80:r.animation&&r.selectObject&&r.playNextAction(r.selectObject);break;case 86:a.demoRaymarchToPoints();break;case 112:r.appGUI&&r.appGUI.toggle(r.guiSceneGraph.dom);break;case 113:r.appGUI&&r.appGUI.toggle();break;case 114:r.dragControls.enabled=!r.dragControls.enabled;break;case 115:r.transformControls.visible=!r.transformControls.visible,r.transformControls.enabled=!r.transformControls.enabled;break;case 116:r.guiSidebar&&r.guiSidebar.select(r.guiStrings.getKey("menubar/edit/scene"),"inclusive");break;case 117:a.screenCapture();break;case 118:break;case 119:r.selectObject&&r.focus(r.selectObject);break;case 120:r.config.clearSettings(),console.log('>> clear the "window.localStorage"...');break;case 121:r.config.clearDatabase(),console.log('>> clear the "window.indexedDB"...');break;case 123:void 0!==r.dragVertexControls&&(r.dragVertexControls.enabled=!r.dragVertexControls.enabled,r.controls.enabled=!r.dragVertexControls.enabled);break;case 191:a.gamePlay();break;case 81:r.transformControls.setSpace("local"===r.transformControls.space?"world":"local");break;case 17:r.transformControls.setTranslationSnap(r.config.getSettings("translationSnap")),r.transformControls.setRotationSnap(THREE.Math.degToRad(r.config.getSettings("rotationSnap")));break;case 87:r.transformControls.setMode("translate");break;case 69:r.transformControls.setMode("rotate");break;case 82:r.transformControls.setMode("scale");break;case 187:case 107:r.transformControls.setSize(r.transformControls.size+.1);break;case 189:case 109:r.transformControls.setSize(Math.max(r.transformControls.size-.1,.1));break;case 88:r.transformControls.showX=!r.transformControls.showX;break;case 89:r.transformControls.showY=!r.transformControls.showY;break;case 90:r.transformControls.showZ=!r.transformControls.showZ;break;case 32:r.transformControls.visible=!r.transformControls.visible,r.transformControls.enabled=!r.transformControls.enabled}}(e);break;case"medicalWorks":a.MedicalKeyboard(e)}}this.defaultCamera=new THREE.PerspectiveCamera(g,this.width/this.height,v,y),this.defaultCamera.position.set(_[0],_[1],_[2]),this.defaultCamera.lookAt(this.scene.position),this.defaultCamera.name="camera",this.camera=this.defaultCamera.clone(),this.controls=a.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new a.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},this.stats=null,!0!==e.stats||a.isDeviceMobile()||(this.stats=new k,this.stats.dom.style.cssText="position:absolute; bottom:0px; right:0px",this.dom.appendChild(this.stats.dom)),this.raycaster=new THREE.Raycaster,this.selectObject=null,this.selectObjects=[],this.selectables=[],this.mouseMovePosition=new THREE.Vector2,this.mouseDownPosition=new THREE.Vector2,this.mouseUpPosition=new THREE.Vector2,this.mouseDoubleClickPosition=new THREE.Vector2,this.playAudio=function(e){this.sound&&this.sound.unload(),this.sound=a.playAudio(e)},this.playAudio(e.audioFiles),this.sceneHelpers=new THREE.Scene,this.gridHelper=b(),this.gridHelper.visible=e.gridVisible||!1,this.sceneHelpers.add(this.gridHelper),this.sceneHUD=null,this.cameraHUD=null,!0===e.hud&&(this.sceneHUD=new THREE.Scene,this.cameraHUD=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,100.1),this.cameraHUD.position.z=50.1),function(e){e=e||{};r.composer=new THREE.EffectComposer(r.renderer),r.composer.setSize(r.width,r.height),r.renderPass=new THREE.RenderPass(r.scene,r.camera),r.renderPass.clear=!0,r.renderPass.clearDepth=!1,r.composer.addPass(r.renderPass),r.sceneHelpers&&(r.renderPass2=new THREE.RenderPass(r.sceneHelpers,r.camera),r.renderPass2.clear=!1,r.renderPass2.clearDepth=!1,r.composer.addPass(r.renderPass2));r.sceneHUD&&(r.renderPass3=new THREE.RenderPass(r.sceneHUD,r.cameraHUD),r.renderPass3.clear=!1,r.renderPass3.clearDepth=!1,r.composer.addPass(r.renderPass3));void 0!==e.bleachEnabled&&(r.bleachShader=new THREE.ShaderPass(THREE.BleachBypassShader),r.bleachShader.enabled=e.bleachEnabled,r.composer.addPass(r.bleachShader));void 0!==e.bloomEnabled&&(r.bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(r.width,r.height),2.5,.45,.88),r.bloomPass.enabled=e.bloomEnabled,r.composer.addPass(r.bloomPass));void 0!==e.dotScreenEnabled&&(r.dotScreenShader=new THREE.ShaderPass(THREE.DotScreenShader),r.dotScreenShader.uniforms.scale.value=4,r.dotScreenShader.enabled=e.dotScreenEnabled,r.composer.addPass(r.dotScreenShader));void 0!==e.glitchEnabled&&(r.glitchPass=new THREE.GlitchPass(0),r.glitchPass.enabled=e.glitchEnabled,r.composer.addPass(r.glitchPass));void 0!==e.sepiaEnabled&&(r.sepiaShader=new THREE.ShaderPass(THREE.SepiaShader),r.sepiaShader.enabled=e.sepiaEnabled,r.composer.addPass(r.sepiaShader));if(void 0!==e.outlineEnabled){r.outlinePass=new THREE.OutlinePass(new THREE.Vector2(r.width,r.height),r.scene,r.camera),r.outlinePass.enabled=e.outlineEnabled,r.composer.addPass(r.outlinePass),(new THREE.TextureLoader).load("images/tri_pattern.jpg",(function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,r.outlinePass.patternTexture=e}))}e.FXAAEnabled=!0,void 0!==e.FXAAEnabled&&(r.FXAAShader=new THREE.ShaderPass(THREE.FXAAShader),r.FXAAShader.uniforms.resolution.value.set(1/r.width,1/r.height),r.FXAAShader.enabled=e.FXAAEnabled,r.composer.addPass(r.FXAAShader));void 0!==e.ssaoEnabled&&(r.ssaoPass=new THREE.SSAOPass(r.scene,r.camera,r.width,r.height),r.ssaoPass.enabled=e.ssaoEnabled,r.composer.addPass(r.ssaoPass));void 0!==e.godRaysEnabled&&(r.godRaysPass=new a.GodRaysPass(r.scene,r.camera,r.width,r.height),r.godRaysPass.enabled=e.godRaysEnabled,r.composer.addPass(r.godRaysPass));void 0!==e.bokehEnabled&&(r.bokehPass=new THREE.BokehPass(r.scene,r.camera,{width:r.width,height:r.height,vignetting:1}),r.bokehPass.enabled=e.bokehEnabled,r.composer.addPass(r.bokehPass));void 0!==e.vignetteEnabled&&(r.vignetteShader=new THREE.ShaderPass(THREE.VignetteShader),r.vignetteShader.enabled=e.vignetteEnabled,r.composer.addPass(r.vignetteShader));r.gammaCorrection=new THREE.ShaderPass(THREE.GammaCorrectionShader),r.composer.addPass(r.gammaCorrection)}(e),this.cameraEffect=function(e){this.effect=a.createCameraEffect(e,this.renderer),this.effect?this.effect.setSize(this.width,this.height):this.renderer.setSize(this.width,this.height)},this.cameraEffect(e.effectType),this.fileExplorer=null,!0===e.fileExplorer&&(this.fileExplorer=new a.FileExplorer(this)),this.dragControls=null,!0===e.dragControls&&(this.dragControls=(s=this.scene.children,l=this.camera,u=this.renderer,c=null,(h=new THREE.DragControls(s,l,u.domElement)).enabled=!1,h.addEventListener("dragstart",(function(e){if(this.enabled){var t=e.object;c=t.position.clone(),r.controls.enabled=!1,r.select(t)}})),h.addEventListener("dragend",(function(e){if(this.enabled){var t=e.object;void 0!==t&&(c.equals(t.position)||r.setPosition(t,t.position,c)),r.controls.enabled=!0}})),h)),this.transformControls=null,!0===e.transformControls&&(this.transformControls=function(e,t){var n=null,i=null,a=null,o=new THREE.TransformControls(e,t.domElement);return o.visible=!0,o.enabled=!0,o.addEventListener("change",(function(){var e=o.object;e&&e.helper&&!e.helper instanceof THREE.SkeletonHelper&&e.helper.update()})),o.addEventListener("mouseDown",(function(){var e=o.object;n=e.position.clone(),i=e.rotation.clone(),a=e.scale.clone(),r.controls.enabled=!1})),o.addEventListener("mouseUp",(function(){var e=o.object;if(void 0!==e)switch(o.getMode()){case"translate":n.equals(e.position)||r.setPosition(e,e.position,n);break;case"rotate":i.equals(e.rotation)||r.setRotation(e,e.rotation,i);break;case"scale":a.equals(e.scale)||r.setScale(e,e.scale,a)}r.controls.enabled=!0})),o}(this.camera,this.renderer),this.transformControls.setSize(.5),this.sceneHelpers.add(this.transformControls)),window.addEventListener("orientationchange",(function(){[r.widthRatio,r.heightRatio]=[r.heightRatio,r.widthRatio]}),!1),window.addEventListener("resize",x,!1),this.dom.addEventListener("click",(function(e){r.dom.focus()}),!1),this.dom.addEventListener("dblclick",(function(e){r.mouseDoubleClickPosition.copy(T(e));var t=r.getIntersectObject("mouseDoubleClick");t&&r.focus(t)}),!1),this.dom.addEventListener("mousemove",(function(e){r.mouseMovePosition.copy(T(e)),r.bokehPass&&r.bokehPass.enabled&&r.bokehPass.mouse.copy(r.mouseMovePosition)}),!1),this.dom.addEventListener("mousedown",(function(e){r.mouseDownPosition.copy(T(e)),document.addEventListener("mouseup",A,!1)}),!1),this.dom.addEventListener("touchmove",(function(e){e.preventDefault(),p&&clearTimeout(p);r.mouseMovePosition.copy(T(e)),r.bokehPass&&r.bokehPass.enabled&&r.bokehPass.mouse.copy(r.mouseMovePosition)}),!0),this.dom.addEventListener("touchstart",(function(e){r.guiContextMenu&&r.guiContextMenu.setDisplay("none");if(e.preventDefault(),m)return;p=setTimeout(L,500,e),m=!0,r.mouseDownPosition.copy(T(e)),document.addEventListener("touchend",P,!1)}),!1),this.dom.addEventListener("keydown",I,!1),this.dom.addEventListener("keyup",(function(e){switch(r.appName){case"natureWorks":!function(e){switch(e.preventDefault(),e.stopPropagation(),e.keyCode){case 17:r.transformControls.setTranslationSnap(null),r.transformControls.setRotationSnap(null),r.controls.enabled=!0}}(e)}}),!1),this.dom.addEventListener("contextmenu",C,!1),this.renderScene=function(){E()},this.onKeyDown=function(e){I(e)},this.getBoundingBox=function(){return a.computeBoundingBox(this.scene)},this.getMousePosition=function(e){return T(e)},this.getIntersectObject=function(e){if("string"==typeof e){var t;if("mouseDown"===e)t=this.mouseDownPosition;else if("mouseUp"===e)t=this.mouseUpPosition;else{if("mouseDoubleClick"!==e)return null;t=this.mouseDoubleClickPosition}return(r=M(t,this.selectables)).length>0?r[0].object:null}var r;return this.mouseDownPosition.equals(this.mouseUpPosition)&&(r=M(this.mouseUpPosition,this.selectables)).length>0?(void 0!==e&&(e.object=r[0].object,e.distance=r[0].distance,e.point=r[0].point,e.uv=r[0].uv),r[0].object):null},this.select=function(e,t){if(e){var n=e;if("ancestor"===t)e.traverseAncestors((function(e){e.parent===r.scene&&(n=e)})),this.selectObjects=[n];else if("multiple"===t){var i=this.selectObjects.indexOf(n);-1===i?this.selectObjects.push(n):this.selectObjects.splice(i,1)}else this.selectObjects=[n];this.selectObject=n,this.signals.objectSelected.dispatch(n),this.signals.objectsSelected.dispatch(this.selectObjects)}else this.selectObject=null,this.selectObjects=[],this.signals.objectSelected.dispatch(null),this.signals.objectsSelected.dispatch(this.selectObjects)},this.selectById=function(e,t){e!==this.camera.id?this.select(this.scene.getObjectById(e,!0),t):this.select(this.camera,t)},this.selectByUuid=function(e,t){this.scene.traverse((function(r){r.uuid===e&&this.select(r,t)}))},this.deselect=function(){this.selectObject=null},this.focus=function(e){this.signals.objectFocused.dispatch(e)},this.focusById=function(e){this.focus(this.scene.getObjectById(e,!0))},this.objectByUuid=function(e){return this.scene.getObjectByProperty("uuid",e)},this.addObject=function(e,t,n){e.traverse((function(e){r.addHelper(e)})),void 0===t?this.scene.add(e):(t.children.splice(n,0,e),e.parent=t),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},this.moveObject=function(e,t,r){if(void 0===t&&(t=this.scene),t.add(e),void 0!==r){var n=t.children.indexOf(r);t.children.splice(n,0,e),t.children.pop()}this.signals.sceneGraphChanged.dispatch()},this.removeObject=function(e){null!==e.parent&&(e.traverse((function(e){r.removeHelper(e)})),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch())},this.addHelper=(d=new THREE.SphereBufferGeometry(2,4,2),f=new THREE.MeshBasicMaterial({color:16711680,visible:!1}),function(e){if(!a.isDeviceMobile()){var t;if(e instanceof THREE.Camera)(t=new THREE.CameraHelper(e)).name="cameraHelper";else if(e instanceof THREE.PointLight)(t=new THREE.PointLightHelper(e,1)).name="pointLightHelper";else if(e instanceof THREE.DirectionalLight)(t=new THREE.DirectionalLightHelper(e,1)).name="directionalLightHelper","SunLight"===e.userData.type&&(t.visible=!1);else if(e instanceof THREE.SpotLight)(t=new THREE.SpotLightHelper(e)).name="spotLightHelper";else if(e instanceof THREE.HemisphereLight)(t=new THREE.HemisphereLightHelper(e,1)).name="hemisphereLightHelper";else{if(!(e instanceof THREE.SkinnedMesh))return;(t=new THREE.SkeletonHelper(e)).name="skeletonHelper"}var r=new THREE.Mesh(d,f);r.name="picker",r.userData.object=e,t.add(r),e.helper=t,this.sceneHelpers.add(t),this.signals.helperAdded.dispatch(t)}}),this.removeHelper=function(e){var t=e.helper;void 0!==t&&(t.parent.remove(t),this.signals.helperRemoved.dispatch(t))},this.getObjectMaterial=function(e,t){var r=void 0;return e&&(r=e.material,Array.isArray(r)&&void 0!==t&&(r=r[t])),r},this.setObjectMaterial=function(e,t,r){Array.isArray(e.material)&&void 0!==t?e.material[t]=r:e.material=r},this.clear=function(){this.history&&this.history.clear(),this.config&&this.config.clearDatabase(),this.camera.copy(this.defaultCamera);for(var e=this.scene.children;e.length>0;)this.removeObject(e[0]);this.deselect(),this.signals.appWorksCleared.dispatch(),this.signals.windowResize.dispatch()},this.fromJSON=function(e){var t=new THREE.ObjectLoader,n=t.parse(e.camera);this.camera.copy(n),this.camera.aspect=this.defaultCamera.aspect,this.camera.updateProjectionMatrix(),this.history.fromJSON(e.history),t.parse(e.scene,(function(e){r.setScene(e)}))},this.toJSON=function(){return{metadata:{},camera:this.camera.toJSON(),scene:this.scene.toJSON(),history:this.history.toJSON()}},this.execute=function(e,t){this.history.execute(e,t)},this.undo=function(){this.history.undo()},this.redo=function(){this.history.redo()},this.add=function(e){this.execute(new a.AddObjectCommand(e))},this.remove=function(e){this.execute(new a.RemoveObjectCommand(e))},this.replace=function(e,t){var r=[];r.push(new a.RemoveObjectCommand(e)),r.push(new a.AddObjectCommand(t)),this.multiCmds(r)},this.move=function(e,t,r){e.parent?this.execute(new a.MoveObjectCommand(e,t,r)):Alert("The object cannot be moved to the new parent")},this.moveTo=function(e,t,r){this.add(e),this.move(e,t,r)},this.setPosition=function(e,t,r){this.execute(new a.SetPositionCommand(e,t,r))},this.setRotation=function(e,t,r){this.execute(new a.SetRotationCommand(e,t,r))},this.setScale=function(e,t,r){this.execute(new a.SetScaleCommand(e,t,r))},this.setGeometry=function(e,t){this.execute(new a.SetGeometryCommand(e,t))},this.setGeometryValue=function(e,t,r){this.execute(new a.SetGeometryValueCommand(e,t,r))},this.setMaterial=function(e,t,r){this.execute(new a.SetMaterialCommand(e,t,r))},this.setMaterialValue=function(e,t,r,n){this.execute(new a.SetMaterialValueCommand(e,t,r,n))},this.setMaterialVector=function(e,t,r,n){this.execute(new a.SetMaterialVectorCommand(e,t,r,n))},this.setMaterialColor=function(e,t,r,n){this.execute(new a.SetMaterialColorCommand(e,t,r,n))},this.setMaterialMap=function(e,t,r,n){this.execute(new a.SetMaterialMapCommand(e,t,r,n))},this.setUuid=function(e,t){this.execute(new a.SetUuidCommand(e,t))},this.setValue=function(e,t,r){this.execute(new a.SetValueCommand(e,t,r))},this.setColor=function(e,t,r){this.execute(new a.SetColorCommand(e,t,r))},this.setScene=function(e){this.execute(new a.SetSceneCommand(e))},this.multiCmds=function(e){this.execute(new a.MultiCmdsCommand(e))},a.renderer=this.renderer,a.scene=this.scene,a.camera=this.camera,a.appWorks=this,"viewWorks"===this.appName?a.viewWorksInfo():"medicalWorks"===this.appName&&a.demoMedicalWorkSpace()},a.viewWorksInfo=function(){var e=document.createElement("div");e.id="infoButton",e.innerHTML='        <img src="images/info.png" border="0" />\n    ',e.style.cssText="        text-align: left;\n        margin: 0 0 0 0;\n        z-index: 13;\n        position: absolute;\n        display: block;\n        padding: 8px;\n    ",e.addEventListener("click",(function(e){var t=document.getElementById("infoPanel").style;t.display="block"==t.display?"none":"block"})),document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.createElement("div");t.id="infoPanel",t.innerHTML='        <b>ViewWorks - 3D model viewer</b>\n        <p>\n        To view your 3D models,<br>\n        <b>drag & drop the model file(s) onto the browser.</b><br><br>\n        Supported file formats<br>\n        JSON, OBJ(+MTL), STL, PLY, DAE(COLLADA),<br>\n        GLTF, GLB, AMF, 3MF, WRL(VRML), FBX,<br>\n        3DS, DRC, KMZ, MD2, SVG, VTK<br>\n        </p>\n        (C) <a href="https://www.nova-graphix.com/" target="_blank" style="color: #ffa500; text-decoration: none;">NovaGraphix, Co.</a>, 2018.\n    ',t.style.cssText="        text-align: left;\n        font-family: 'Karla', sans-serif;\n        font-size: 80%;\n        margin: 0.5em 0em 0em 0.4em;\n        z-index: 12;\n        position: absolute;\n        display: none;\n        color: #fff;\n        background: #121212;\n        opacity: 0.8;\n        border-radius: 20px;\n        padding: 32px;\n    ",document.getElementById("novaGraphix").parentNode.appendChild(t)},a.createBackground=function(e){if(!e)return null;if(e.isTexture)return e.encoding=THREE.sRGBEncoding,e;if("number"==typeof e)return new THREE.Color(e);if("string"==typeof e)return"FS"===e.substr(-2,2)?function(e){var t=new THREE.Vector2;a.renderer.getSize(t);var r=a.BackgroundShader;(l=THREE.UniformsUtils.clone(r.uniforms)).resolution.value=t;var n=r.vertexShader,i=r[e],o=a.isWebGL1()?{gl_FragDepth:"gl_FragDepthEXT"}:{},s=new THREE.ShaderMaterial({defines:o,uniforms:l,vertexShader:n,fragmentShader:i});if("cloudsFS"===e){var l=s.uniforms,u=(new THREE.TextureLoader).load("images/raymarch/rgbaNoise256.png",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping}));l.textureMaps.value.push(u)}s.extensions={derivatives:!0,fragDepth:!0,drawBuffers:!0,shaderTextureLOD:!0};var c=new THREE.PlaneBufferGeometry(2,2);return(e=new THREE.Mesh(c,s)).name="backgroundMesh",e.frustumCulled=!1,e.update=function(e,r){a.renderer.getSize(t);var n=this.material.uniforms;n.time.value=r,n.resolution.value=t},e}(e):function(e){var t=".jpg",r="images/background/"+e+"/";switch(e){case"cloud":case"galaxy":case"redSky":case"smallLake":t=".png";break;default:t=".jpg"}var n=["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t],i=(new THREE.CubeTextureLoader).setPath(r).load(n);return i.format=THREE.RGBFormat,i.encoding=THREE.sRGBEncoding,i}(e)},a.createFog=function(e){var t=void 0!==(e=e||{}).color?e.color:a.FOG_COLOR;if("linear"===e.type){var r=void 0!==e.near?e.near:this.camera.near,n=void 0!==e.far?e.far:this.camera.far;return new THREE.Fog(t,r,n)}if("exp2"===e.type){var i=void 0!==e.density?e.density:.001;return new THREE.FogExp2(t,i)}return null},a.createCameraControls=function(e,t,r){var n;e=void 0!==e?e:"OrbitControls",t=void 0!==t?t:a.appWorks.camera,r=void 0!==r?r:a.appWorks.renderer.domElement;return a.appWorks&&a.appWorks.controls&&a.appWorks.controls.dispose(),"TrackballControls"===e?((n=new THREE.TrackballControls(t,r)).rotateSpeed=10,n.zoomSpeed=5,n.panSpeed=2,n.staticMoving=!1,n.dynamicDampingFactor=.2,n.enabled=!0):"FirstPersonControls"===e?((n=new THREE.FirstPersonControls(t,r)).movementSpeed=100,n.lookSpeed=.05,n.lookVertical=!0,n.activeLook=!0,n.constrainVertical=!0,n.verticalMin=1.1,n.verticalMax=2.2,n.enabled=!0):((n=new THREE.OrbitControls(t,r)).enablePan=!0,n.enableZoom=!0,n.enableDamping=!0,n.screenSpacePanning=!0,n.dampingFactor=.5,n.panSpeed=1,n.rotateSpeed=1,n.enabled=!0),n},a.playAudio=function(e,t){if(!(Array.isArray(e)&&e.length>0))return null;var r=new P.Howl({src:[e[0]],autoplay:!0,loop:!0,volume:.5,onend:function(){e.shift(),e.length>0&&a.playAudio(e)}});return r.play(),r},a.createCameraEffect=function(e,t){e=void 0!==e?e:"NoEffect",t=void 0!==t?t:a.appWorks.renderer;return"AnaglyphEffect"===e?new THREE.AnaglyphEffect(t):"StereoEffect"===e?new THREE.StereoEffect(t):"ParallaxBarrierEffect"===e?new THREE.ParallaxBarrierEffect(t):null},a.Animation=function(e){e=void 0!==e?e:a.scene;this.mixer=new THREE.AnimationMixer(e),this.update=function(e){this.mixer.update(e)},this.addAnimation=function(e,t){t.length>0&&(e.animations=t)},this.createActions=function(e){var t={},r=e.animations;if(void 0!==r){for(var n of r)t[n.name]=this.mixer.clipAction(n,e),e.activeAction||(e.activeAction=t[n.name]);return t}},this.playAction=function(e,t,r){if(e.animations&&0!==e.animations.length){var n=(r=r||{}).duration||1,i=r.loopMode||THREE.LoopRepeat,o=r.repetitions||1/0,s=r.combine||"crossFade";e=void 0!==e?e:a.appWorks.selectObject,t=void 0!==t?t:e.animations[0];if("crossFade"==s){var l=e.activeAction,u=this.mixer.clipAction(t,e);return u?(u.enabled=!0,u.setLoop(i,o),l?(l.enabled=!0,l.crossFadeTo(u,n).play()):u.play(),e.activeAction=u,u):void 0}if("overlap"===s){var c=this.mixer.clipAction(t,e);return c.play(),e.activeAction=c,c}}},this.playNextAction=function(e){var t=(e=void 0!==e?e:a.appWorks.selectObject).animations;if(void 0!==t){var r=-1;if(e.activeAction){var n=e.activeAction.getClip();r=t.indexOf(n)}var i=t[r=~~((r+1)%t.length)];e.activeAction=this.playAction(e,i),console.log('>> playAction: "'+i.name+'"')}},this.stopAction=function(e,t){if(e&&t)(r=this.mixer.clipAction(t,e)).enabled=!0,r.stop();else if(e&&!t){var r;(r=e.activeAction)&&(r.enabled=!0,r.stop())}},this.stopAllActions=function(){this.mixer.stopAllAction()}};var L=r(3);a.loadJSON=function(e){function t(t,r){var n,i=new THREE.LegacyJSONLoader(e.manager).parse(t,r),o=i.geometry;if(o instanceof THREE.Geometry&&(o.morphTargets.length>0||o.skinIndices.length>0)){o=a.toNonIndexedBufferGeometry(i.geometry);var s=i.geometry.animations;s&&(o.animations=s)}var l=i.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach((function(e){e.vertexColors=r}))}(o,l),o instanceof THREE.BufferGeometry&&o.attributes.skinIndex){n=new THREE.SkinnedMesh(o,l);for(var u=[],c=t.bones,h=0,d=c.length;h<d;h++){var f=(new THREE.Vector3).fromArray(c[h].pos),p=(new THREE.Quaternion).fromArray(c[h].rotq),m=new THREE.Bone;m.position.copy(f),m.quaternion.copy(p),m.name=c[h].name,u.push(m)}var g=new THREE.Skeleton(u);n.bind(g)}else n=new THREE.Mesh(o,l);return o.animations&&(l.forEach((function(e){e.morphTargets=!0})),o.animations.length>0&&(n.animations=o.animations)),n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,n}function r(r,n){var i;switch(void 0===r.metadata&&(r.metadata={type:"Geometry"}),void 0===r.metadata.type&&(r.metadata.type="Geometry"),void 0!==r.metadata.formatVersion&&(r.metadata.version=r.metadata.formatVersion),r.metadata.type.toLowerCase()){case"buffergeometry":i=function(t){var r=new THREE.BufferGeometryLoader(e.manager).parse(t);return mesh=new THREE.Mesh(r),mesh.castShadow=!0,mesh.receiveShadow=!0,mesh.name=e.url,mesh}(r);break;case"geometry":i=t(r,n);break;case"object":i=function(t,r){var n=new THREE.ObjectLoader(e.manager);n.setPath(r),n.setResourcePath(r);var i=n.parse(t);return i instanceof THREE.Scene?(a.appWorks.setScene(i),i.name=e.url):(i.castShadow=!0,i.receiveShadow=!0,i.name=e.url),i}(r,n)}e.callback&&e.callback(i)}var n=e.basePath||"models/";new THREE.FileLoader(e.manager).load(e.url,(function(e){r(JSON.parse(e),n)}))},a.loadOBJ=function(e){var t=e.obj||null,r=e.mtl||null,n=e.basePath||"";function i(t,r,n){var i=new THREE.OBJLoader(e.manager);i.setPath(t),n&&i.setMaterials(n),i.load(r,(function(n){n.traverse((function(e){e instanceof THREE.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)})),n.name=t+r,e.callback&&e.callback(n)}),(function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}}),(function(e){console.log("OBJLoader: error happened")}))}if(r){var a=new THREE.MTLLoader(e.manager);a.setPath(n),a.load(r,(function(e){e.preload(),i(n,t,e)}))}else i(n,t)},a.loadSTL=function(e){new THREE.STLLoader(e.manager).load(e.url,(function(t){!function(t){var r;a.computeVertexNormals(t),r=t.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var n=new THREE.Mesh(t,r);n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,e.callback&&e.callback(n)}(t)}))},a.loadPLY=function(e){new THREE.PLYLoader(e.manager).load(e.url,(function(t){!function(t){a.computeVertexNormals(t);var r=new THREE.Mesh(t,new THREE.MeshStandardMaterial);r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)}))},a.loadDAE=function(e){new THREE.ColladaLoader(e.manager).load(e.url,(function(t){!function(t){var r=t.scene;t.animations.length>0&&(r.animations=t.animations),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)}))},a.loadGLB=function(e){var t=new THREE.GLTFLoader(e.manager);t.setCrossOrigin("anonymous");var r=new THREE.DRACOLoader(e.manager);r.setDecoderPath("js/draco/"),t.setDRACOLoader(r),t.load(e.url,(function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=a.scene.background;i&&i.isCubeTexture&&r.traverse((function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)})),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)}),void 0,(function(e){console.error(e)}))},a.loadGLTF=function(e){new THREE.GLTFLoader(e.manager).load(e.url,(function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=a.scene.background;i&&i.isCubeTexture&&r.traverse((function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)})),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)}),void 0,(function(e){console.error(e)}))},a.loadAMF=function(e){new THREE.AMFLoader(e.manager).load(e.url,(function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)}))},a.load3MF=function(e){var t=new THREE.ThreeMFLoader(e.manager);t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),t.load(e.url,(function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)}))},a.loadWRL=function(e){new THREE.VRMLLoader(e.manager).load(e.url,(function(t){!function(t){t.traverse((function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))})),t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)}))},a.loadFBX=function(e){var t=new THREE.FBXLoader(e.manager),r=e.basePath||"";t.setPath(r),t.setResourcePath(r),t.load(e.url,(function(t){!function(t){var r=t;r.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)}))},a.loadMedical=function(e){var t=new a.MedicalLoader,r=e.basePath||"";t.setPath(r),t.load(e.url,(function(t){!function(t){let r=new a.MedicalVolume(t);Array.isArray(e.url)&&e.url.length>0?r.name=e.url[0]:r.name="medicalVolume";let n=new a.LookupTables;n.lut="default",r.lutTexture=n.texture,r.lut=!0;let i=t.worldCenter();a.appWorks.camera.lookAt(i),a.appWorks.controls.target.copy(i),e.callback&&e.callback(r)}(t)}))},a.Loader=function(){var e=this;function t(e,t){t.length>0&&(e.animations=t)}function r(e){a.add(e),a.welcomeObject(e)}function n(e){a.appWorks.setScene(e)}function i(t){switch(void 0===t.metadata&&(t.metadata={type:"Geometry"}),void 0===t.metadata.type&&(t.metadata.type="Geometry"),void 0!==t.metadata.formatVersion&&(t.metadata.version=t.metadata.formatVersion),t.metadata.type.toLowerCase()){case"buffergeometry":var i=(o=new THREE.BufferGeometryLoader).parse(t);r(new THREE.Mesh(i));break;case"geometry":console.error('Loader: "Geometry" is no longer supported.');break;case"object":var o;(o=new THREE.ObjectLoader).setResourcePath(e.texturePath),o.parse(t,(function(e){e.isScene?n(e):r(e)}));break;case"app":a.appWorks.fromJSON(t)}}this.texturePath="",this.loadItemList=function(t){a.LoaderUtils.getFilesFromItemList(t,(function(t,r){e.loadFiles(t,r)}))},this.loadFiles=function(t,r){if(t.length>0){r=r||a.LoaderUtils.createFilesMap(t);var n=new THREE.LoadingManager;n.onStart=()=>{a.createProgressbar()},n.onProgress=(e,t,r)=>{a.updateProgressbar(t,r)},n.onLoad=()=>{a.hideProgressbar()},n.onError=e=>{a.errorProgressbar("There was an error loading "+e)},n.setURLModifier((function(e){var t=r[e];return t?(console.log("Loading",e),URL.createObjectURL(t)):e}));for(var i=0;i<t.length;i++)e.loadFile(t[i],n)}},this.loadFile=function(e,o){var s=e.name,l=s.split(".").pop().toLowerCase(),u=new FileReader;switch(u.addEventListener("progress",(function(e){var t="("+Math.floor(e.total/1e3).format()+" KB)",r=Math.floor(e.loaded/e.total*100)+"%";console.log("Loading",s,t,r)})),l){case"3ds":u.addEventListener("load",(function(e){var t=new THREE.TDSLoader(o).parse(e.target.result);t.name=s,r(t)}),!1),u.readAsArrayBuffer(e);break;case"3mf":u.addEventListener("load",(function(e){var t=new THREE.ThreeMFLoader;t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension);var n=t.parse(e.target.result);n.name=s,r(n)}),!1),u.readAsArrayBuffer(e);break;case"amf":u.addEventListener("load",(function(e){var t=(new THREE.AMFLoader).parse(e.target.result);t.name=s,r(t)}),!1),u.readAsArrayBuffer(e);break;case"dae":u.addEventListener("load",(function(e){var n=e.target.result,i=new THREE.ColladaLoader(o).parse(n);i.scene.name=s,t(i.scene,i.animations),r(i.scene)}),!1),u.readAsText(e);break;case"drc":u.addEventListener("load",(function(e){var t=e.target.result,n=new THREE.DRACOLoader;n.setDecoderPath("js/draco/"),n.decodeDracoFile(t,(function(e){e.center(),a.computeVertexNormals(e);var t=new THREE.MeshStandardMaterial,n=new THREE.Mesh(e,t);n.name=s,r(n)}))}),!1),u.readAsArrayBuffer(e);break;case"fbx":u.addEventListener("load",(function(e){var n=e.target.result,i=new THREE.FBXLoader(o).parse(n);i.name=s,t(i,i.animations),r(i)}),!1),u.readAsArrayBuffer(e);break;case"glb":u.addEventListener("load",(function(e){var n=e.target.result,i=new THREE.DRACOLoader;i.setDecoderPath("js/draco/");var a=new THREE.GLTFLoader;a.setDRACOLoader(i),a.parse(n,"",(function(e){var n=e.scene;n.name=s,t(n,e.animations),r(n)}))}),!1),u.readAsArrayBuffer(e);break;case"gltf":u.addEventListener("load",(function(e){var n,i=e.target.result;!function(e){var t;if("string"==typeof e)t=e;else{if("glTF"===THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4)))return new DataView(e).getUint32(4,!0)<2;t=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var r=JSON.parse(t);return null!=r.asset&&r.asset.version[0]<2}(i)?n=new THREE.GLTFLoader(o):alert("Import of glTF asset not possible. Only versions >= 2.0 are supported. Please try to upgrade the file to glTF 2.0 using glTF-Pipeline."),n.parse(i,"",(function(e){var n=e.scene;n.name=s,t(n,e.animations),r(n)}))}),!1),u.readAsArrayBuffer(e);break;case"js":case"json":case"3geo":case"3mat":case"3obj":case"3scn":u.addEventListener("load",(function(e){var t,r=e.target.result;if(-1!==r.indexOf("postMessage")){var n=new Blob([r],{type:"text/javascript"}),a=URL.createObjectURL(n),o=new Worker(a);return o.onmessage=function(e){e.data.metadata={version:2},i(e.data)},void o.postMessage(Date.now())}try{t=JSON.parse(r)}catch(e){return void alert(e)}i(t)}),!1),u.readAsText(e);break;case"kmz":u.addEventListener("load",(function(e){var t=(new THREE.KMZLoader).parse(e.target.result);t.scene.name=s,r(t.scene)}),!1),u.readAsArrayBuffer(e);break;case"md2":u.addEventListener("load",(function(e){var n=e.target.result,i=(new THREE.MD2Loader).parse(n),a=new THREE.MeshStandardMaterial({morphTargets:!0,morphNormals:!0}),o=new THREE.Mesh(i,a);o.mixer=new THREE.AnimationMixer(o),o.name=s,t(o,i.animations),r(o)}),!1),u.readAsArrayBuffer(e);break;case"obj":u.addEventListener("load",(function(e){var t=e.target.result,n=(new THREE.OBJLoader).parse(t);n.name=s,r(n)}),!1),u.readAsText(e);break;case"ply":u.addEventListener("load",(function(t){var n=t.target.result,i=(new THREE.PLYLoader).parse(n);i.sourceType="ply",i.sourceFile=e.name,a.computeVertexNormals(i);var o=new THREE.MeshStandardMaterial,l=new THREE.Mesh(i,o);l.name=s,r(l)}),!1),u.readAsArrayBuffer(e);break;case"stl":u.addEventListener("load",(function(t){var n,i=t.target.result,o=(new THREE.STLLoader).parse(i);o.sourceType="stl",o.sourceFile=e.name,a.computeVertexNormals(o),n=o.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var l=new THREE.Mesh(o,n);l.name=s,r(l)}),!1),void 0!==u.readAsBinaryString?u.readAsBinaryString(e):u.readAsArrayBuffer(e);break;case"svg":u.addEventListener("load",(function(e){var t=e.target.result,n=(new THREE.SVGLoader).parse(t).paths,i=new THREE.Group;i.scale.multiplyScalar(.1),i.scale.y*=-1;for(var a=0;a<n.length;a++)for(var o=n[a],l=new THREE.MeshBasicMaterial({color:o.color,depthWrite:!1}),u=o.toShapes(!0),c=0;c<u.length;c++){var h=u[c],d=new THREE.ShapeBufferGeometry(h),f=new THREE.Mesh(d,l);i.add(f)}i.name=s,r(i)}),!1),u.readAsText(e);break;case"vtk":u.addEventListener("load",(function(t){var n=t.target.result,i=(new THREE.VTKLoader).parse(n);i.sourceType="vtk",i.sourceFile=e.name,a.computeVertexNormals(i);var o=new THREE.MeshStandardMaterial,l=new THREE.Mesh(i,o);l.name=s,r(l)}),!1),u.readAsText(e);break;case"wrl":u.addEventListener("load",(function(e){var t=e.target.result,r=(new THREE.VRMLLoader).parse(t);r.traverse((function(e){e.isMesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))})),r.name=s,n(r)}),!1),u.readAsText(e);break;case"zip":u.addEventListener("load",(function(e){!function(e){var n=new L(e);if(n.files["model.obj"]&&n.files["materials.mtl"]){var i=(new THREE.MTLLoader).parse(n.file("materials.mtl").asText());r((new THREE.OBJLoader).setMaterials(i).parse(n.file("model.obj").asText()))}n.filter((function(e,i){var o=new THREE.LoadingManager;switch(o.onStart=()=>{a.createProgressbar()},o.onProgress=(e,t,r)=>{a.updateProgressbar(t,r)},o.onLoad=()=>{a.hideProgressbar()},o.onError=e=>{a.errorProgressbar("There was an error loading "+e)},o.setURLModifier((function(e){var t=n.files[e];if(t){console.log("Loading",e);var r=new Blob([t.asArrayBuffer()],{type:"application/octet-stream"});return URL.createObjectURL(r)}return e})),i.name.split(".").pop().toLowerCase()){case"fbx":r(new THREE.FBXLoader(o).parse(i.asArrayBuffer()));break;case"glb":(new THREE.GLTFLoader).parse(i.asArrayBuffer(),"",(function(e){var n=e.scene;t(n,e.animations),r(n)}));break;case"gltf":new THREE.GLTFLoader(o).parse(i.asText(),"",(function(e){var n=e.scene;t(n,e.animations),r(n)}))}}))}(e.target.result)}),!1),u.readAsBinaryString(e)}}},a.LoaderUtils={createFilesMap:function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];t[n.name]=n}return t},getFilesFromItemList:function(e,t){var r=0,n=0,i=[],a={};function o(){++r===n&&t(i,a)}function s(e){e.isDirectory?e.createReader().readEntries((function(e){for(var t=0;t<e.length;t++)s(e[t]);o()})):e.isFile&&e.file((function(t){i.push(t),a[e.fullPath.substr(1)]=t,o()}));n++}for(var l=0;l<e.length;l++)s(e[l].webkitGetAsEntry())}},a.Loader2=function(){var e=this;this.fromFiles=function(e,t){if(e[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void this._loadMedicalFiles(t);const r=new Map;e.forEach(e=>r.set(e.name,e)),this.loadFiles(r)},this.fromEvent=function(t){if(t.dataTransfer.files[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void this._loadMedicalFiles(t);let r;if(t.dataTransfer.items)r=[].slice.call(t.dataTransfer.items).map(e=>e.webkitGetAsEntry());else if(1===(t.dataTransfer.files||[]).length){const e=t.dataTransfer.files[0];return"application/zip"===e.type?void alert("zip file: not supported"):void this.loadFiles(new Map([[e.name,e]]))}r||alert("Required drag & drop is not supported in this browser."),1===r.length&&r[0].name.match(/\.zip$/)?alert("zip file: not supported"):function t(r,n){const i=n.pop();if(!i)return void e.loadFiles(r);if(i.isFile)i.file(e=>{r.set(i.fullPath,e),t(r,n)},()=>console.error("Could not load file: %s",i.fullPath));else if(i.isDirectory){const e=i.createReader(),a=i=>{i.length?(n=n.concat(i),e.readEntries(a)):t(r,n)};e.readEntries(a)}else console.warn("Unknown asset type: "+i.fullPath),t(r,n)}(new Map,r)},this.loadFiles=function(t){for(var r of t.values())console.log("Loading:",r.name,"("+a.humanFileSize(r.size)+")");var n;let i,o;var s=[];Array.from(t).forEach(([e,t])=>{t.name.match(/\.(js|json|obj|stl|ply|dae|gltf|glb|amf|3mf|wrl|fbx|md2|vtk)$/i)?(i=t,o=e.replace(t.name,""),n=t.name.split(".").pop().toLowerCase()):t.name.match(/\.(png|jpg|gif)$/i)&&s.push(t)}),i||console.warn("No asset found.");const l="string"==typeof i?i:URL.createObjectURL(i),u=THREE.LoaderUtils.extractUrlBase(l);return new Promise((r,c)=>{const h=[],d=new THREE.LoadingManager;switch(d.onStart=()=>{a.createProgressbar()},d.onProgress=(e,t,r)=>{a.updateProgressbar(t,r)},d.onLoad=()=>{a.hideProgressbar()},d.onError=e=>{a.errorProgressbar("There was an error loading "+e)},d.setURLModifier((e,r)=>{const n=o+e.replace(u,"").replace(/^(\.?\/)/,"");if(t.has(n)){const e=t.get(n),r=URL.createObjectURL(e);return h.push(r),r}return(r||"")+e}),n){case"js":case"json":!function(t,n){function o(e,t,r){var n,i=new THREE.LegacyJSONLoader(t).parse(e,r),o=i.geometry;if(o instanceof THREE.Geometry&&(o.morphTargets.length>0||o.skinIndices.length>0)){o=a.toNonIndexedBufferGeometry(i.geometry);var s=i.geometry.animations;s&&(o.animations=s)}var l=i.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach((function(e){e.vertexColors=r}))}(o,l),o instanceof THREE.BufferGeometry&&o.attributes.skinIndex){n=new THREE.SkinnedMesh(o,l);for(var u=[],c=e.bones,h=0,d=c.length;h<d;h++){var f=(new THREE.Vector3).fromArray(c[h].pos),m=(new THREE.Quaternion).fromArray(c[h].rotq),g=new THREE.Bone;g.position.copy(f),g.quaternion.copy(m),g.name=c[h].name,u.push(g)}var v=new THREE.Skeleton(u);n.bind(v)}else n=new THREE.Mesh(o,l);return o.animations&&(l.forEach((function(e){e.morphTargets=!0})),o.animations.length>0&&(n.animations=o.animations)),p(n),n}function s(e,t,r){switch(void 0===e.metadata&&(e.metadata={type:"Geometry"}),void 0===e.metadata.type&&(e.metadata.type="Geometry"),void 0!==e.metadata.formatVersion&&(e.metadata.version=e.metadata.formatVersion),e.metadata.type.toLowerCase()){case"buffergeometry":(function(e,t){var r=new THREE.BufferGeometryLoader(t).parse(e);return mesh=new THREE.Mesh(r),p(mesh),mesh})(e,t);break;case"geometry":o(e,t,r);break;case"object":(function(e,t,r){var n=new THREE.ObjectLoader(t);n.setPath(r),n.setResourcePath(r);var o=n.parse(e);return o instanceof THREE.Scene?(a.appWorks.setScene(o),o.name=i.name):"natureWorks"===a.appWorks.appName&&o.children.length>0?o.children.forEach((function(e){a.add(a.cloneObject(e))})):p(o),o})(e,t,r)}}new THREE.FileLoader(n).load(t,t=>{s(JSON.parse(t),n,e.basePath),h.forEach(URL.revokeObjectURL),r(t)},f,c)}(l,d);break;case"obj":!function(e,n){var i;for(var a of t.values())if(a.name.match(/\.(mtl|MTL)$/)){i=a;break}function o(t){var i=new THREE.OBJLoader(n);t&&i.setMaterials(t),i.load(e,e=>{p(e),h.forEach(URL.revokeObjectURL),r(e)},f,c)}!function(e){if(void 0!==e){const t=URL.createObjectURL(e);new THREE.MTLLoader(n).load(t,e=>{e.preload(),o(e),r(e)},f,c)}else o()}(i)}(l,d);break;case"stl":!function(e,t){new THREE.STLLoader(t).load(e,e=>{var t;t=e.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial,p(new THREE.Mesh(e,t)),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"ply":!function(e,t){new THREE.PLYLoader(t).load(e,e=>{a.computeVertexNormals(e),p(new THREE.Mesh(e,new THREE.MeshStandardMaterial)),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"dae":!function(e,t){new THREE.ColladaLoader(t).load(e,e=>{var t=e.scene;e.animations.length>0&&(t.animations=e.animations),p(t),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"gltf":case"glb":!function(e,t){const n=new THREE.GLTFLoader(t);n.setCrossOrigin("anonymous");const i=new THREE.DRACOLoader(t);i.setDecoderPath("js/draco/"),n.setDRACOLoader(i),n.load(e,e=>{var t=e.scene||e.scenes[0],n=e.animations||[],i=a.scene.background;i&&i.isCubeTexture&&t.traverse((function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)})),n.length>0&&(t.animations=n),p(t),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"amf":!function(e,t){new THREE.AMFLoader(t).load(e,e=>{p(e),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"3mf":!function(e,t){var n=new THREE.ThreeMFLoader(t);n.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),n.load(e,e=>{p(e),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"wrl":!function(e,t){new THREE.VRMLLoader(t).load(e,e=>{e.traverse((function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))})),p(e),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"fbx":!function(e,t){new THREE.FBXLoader(t).load(e,e=>{e.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),p(e),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"md2":!function(e,t){new THREE.MD2Loader(t).load(e,e=>{var t=null;1===s.length&&(t=(new THREE.TextureLoader).load(URL.createObjectURL(s[0])));var n=new THREE.MeshStandardMaterial({map:t,morphTargets:!0,morphNormals:!0}),i=new THREE.Mesh(e,n);i.mixer=new THREE.AnimationMixer(i),function(e,t){t.length>0&&(e.animations=t)}(i,e.animations),p(i),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;case"vtk":!function(e,t){new THREE.VTKLoader(t).load(e,e=>{e.center(),a.computeVertexNormals(e);var t=new THREE.MeshStandardMaterial;p(new THREE.Mesh(e,t)),h.forEach(URL.revokeObjectURL),r(e)},f,c)}(l,d);break;default:alert("Unsupported file format ("+n+").")}function f(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}}function p(e){e.name=i.name,a.add(e),a.welcomeObject(e)}})},this._loadMedicalFiles=function(e){a.MedicalLoadFiles(e,e=>{a.removeMedicalWorkspace(),a.createMedicalWorkspace(e,"quadWorkspace")})}},a.Saver=function(){var e=document.createElement("a");this.saveFile=function(t){var r,n=t.split(".").pop().toLowerCase();switch("natureWorks"===appWorks.appName?((r=new THREE.Object3D).name=appWorks.appName,appWorks.scene.children.forEach((function(e){r.add(a.cloneObject(e))}))):r=appWorks.scene,n){case"json":!function(e,t){t=t||"object.json";var r=e.toJSON();try{r=(r=JSON.stringify(r,i,"\t")).replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){r=JSON.stringify(r)}o(r,t)}(r,t);break;case"obj":!function(e,t){t=t||"model.obj";o((new THREE.OBJExporter).parse(e),t)}(r,t);break;case"dae":!function(e,t){t=t||"scene.dae";(new THREE.ColladaExporter).parse(e,(function(e){o(e.data,t)}))}(r,t);break;case"glb":!function(e,t){t=t||"scene.glb";(new THREE.GLTFExporter).parse(e,(function(e){s(e,t)}),{binary:!0,forceIndices:!0,forcePowerOfTwoTextures:!0})}(r,t);break;case"gltf":!function(e,t){t=t||"scene.gltf";(new THREE.GLTFExporter).parse(e,(function(e){o(JSON.stringify(e,null,2),t)}))}(r,t);break;case"stl":!function(e,t,r){t=t||"model.stl";var n=new THREE.STLExporter;!0===r?o(n.parse(e),t):s(n.parse(e,{binary:!0}),t)}(r,t);break;case"ply":!function(e,t){t=t||"model.ply";o((new THREE.PLYExporter).parse(e),t)}(r,t);break;default:alert('The file type "'+n+'" is not supported.')}function i(e,t){return"number"==typeof t?parseFloat(t.toFixed(6)):t}function o(e,t){l(new Blob([e],{type:"text/plain"}),t)}function s(e,t){l(new Blob([e],{type:"application/octet-stream"}),t)}function l(t,r){e.href=URL.createObjectURL(t),e.download=r||"data.json",e.dispatchEvent(new MouseEvent("click"))}}},a.FileExplorer=function(e){e=e||a.appWorks;var t=this;this.basePath="models/",this.openFile=function(){this.fileInput.click()},this.saveAsFile=function(e){this.fileOutput.fileExtension=e,this.fileOutput.click()},this.saver=new a.Saver,this.fileOutput=document.createElement("div"),this.fileOutput.addEventListener("click",(function(){var e=t.fileOutput.fileExtension;t.saver.saveFile("model."+e)})),this.loader=new a.Loader,this.loader2=new a.Loader2;var r=document.createElement("input");r.type="file",r.multiple=!0,r.style.display="none",this.fileInput=r,r.addEventListener("change",(function(e){for(var n,i=[].slice.call(r.files),a=0;a<i.length;a++)if((n=i[a].name).match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i)||n.match(/\.(obj|mtl|md2|vtk)$/i))return void t.loader2.fromFiles(i,e);t.loader.loadFiles(r.files)}));var n=e.dom;n.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),n.classList.add("dragover")})),n.addEventListener("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),n.classList.remove("dragover")})),n.addEventListener("drop",(function(e){if(e.preventDefault(),"text/plain"!==e.dataTransfer.types[0]){for(var r,n=e.dataTransfer.files,i=0;i<n.length;i++)if((r=n[i].name).match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i)||r.match(/\.(obj|mtl|md2|vtk)$/i))return void t.loader2.fromEvent(e);e.dataTransfer.items?t.loader.loadItemList(e.dataTransfer.items):t.loader.loadFiles(e.dataTransfer.files)}}),!1)},a.HGTLoader=function(){this.loadTile=function(e,t,r){var n=this,i=new THREE.TextureLoader;i.crossOrigin=!0;i.load("https://maps.googleapis.com/maps/api/staticmap?center="+e+","+t+"&zoom="+r+"&size=512x512&scale=2&maptype=satellite&key=AIzaSyA1qxvvl1sFBFLj5rx4cXHJ_1soxQ_GMpw",(function(i){var o=new THREE.PlaneBufferGeometry(20,20,128,128),s=new THREE.MeshPhongMaterial({map:i,shading:THREE.SmoothShading});n.heightMapping(o,e,t,r);var l=new THREE.Mesh(o,s);l.rotation.x=-Math.PI/2,l.frustumCulled=!1,l.castShadow=!1,l.receiveShadow=!0,l.name="SRTM.hgt",a.add(l)}))},this.heightMapping=function(e,t,r,n){var i=e.attributes.position,a=Math.sqrt(i.count),o=i.array,s=20/(Math.abs(40075160*Math.cos(t*(Math.PI/180)))/Math.pow(2,n-1)),l=360/Math.pow(2,n-1),u=Math.abs(360*Math.cos(t*(Math.PI/180))/Math.pow(2,n-1)),c=t-u/2,h=t+u/2;console.log(c);var d=r-l/2,f=r+l/2;console.log(l),console.log(u);var p=Math.abs(Math.floor(1201*l)),m=Math.abs(Math.floor(1201*u));console.log(p,m);var g=a/p,v=a/m;console.log(v,g);var y,_,b=1200-Math.abs(1200*(h-Math.floor(h))),E=Math.abs(1200*(d-Math.floor(d))),w=1200-Math.abs(1200*(c-Math.floor(c))),x=Math.abs(1200*(f-Math.floor(f)));console.log(b,E);for(var T=Math.floor(h);T>=Math.floor(c);T--)for(var M=Math.floor(d);M<=Math.floor(f);M++){y=T>0?"N"+Math.abs(Math.floor(T)):"S"+Math.abs(Math.floor(T)),_=M>0?M<100?"E0"+Math.abs(Math.floor(M)):"E"+Math.abs(Math.floor(M)):M>=-99?"W0"+Math.abs(Math.floor(M)):"W"+Math.abs(Math.floor(M));var S=0,A=0,R=1200,k=1200;T==Math.floor(c)&&(R=w),T==Math.floor(h)&&(S=b),M==Math.floor(d)&&(A=E),M==Math.floor(f)&&(k=x);var P=Math.floor(h)-T,L=M-Math.floor(d),C=0;P>0&&(C=1201-b+1201*(P-1));var I=0;L>0&&(I=1201-E+1201*(L-1));var H=new XMLHttpRequest;H.start_row=S,H.start_column=A,H.end_row=R,H.end_column=k,H.passed_rows=C,H.passed_columns=I;var O=Math.round(C/m*a),D=Math.round((C+R-S)/m*a);D=Math.min(D,500);var F=Math.round(I/p*a),N=Math.round((I+k-A)/p*a);N=Math.min(N,500),H.filename="models/hgt/"+y+_+".hgt",H.start_i=O,H.end_i=D,H.start_j=F,H.end_j=N,H.open("GET","models/hgt/"+y+_+".hgt",!0),H.responseType="arraybuffer",H.onload=function(t){var r=this.response;if(2884802==r.byteLength){new Int16Array(r);var n=new DataView(r),l=0,u=0;console.log(this.filename),console.log(this.start_row,this.start_column),console.log("Vertex rows:",this.start_i,this.end_i),console.log("Vertex columns:",this.start_j,this.end_j),console.log("Passed rows/columns:",this.passed_rows,this.passed_columns);for(var c=this.start_i;c<=this.end_i;c++){l=c/v;for(var h=this.start_j;h<=this.end_j;h++){u=h/g;var d=0,f=0;l>=this.passed_rows&&(d=(b+l)%1201),u>=this.passed_columns&&(f=(E+u)%1201),f=Math.min(1200,f),d=Math.min(1200,d);var p,m,y,_,w=f-Math.round(f),x=d-Math.round(d);d=Math.round(d),f=Math.round(f),c==this.start_i&&console.log("Start vertex row "+this.start_i+" at file row "+d),h==this.start_j&&console.log("Start vertex column "+this.start_j+" at file column "+f),c==this.end_i&&console.log("End vertex row "+this.end_i+" at file row "+d),h==this.end_j&&console.log("End vertex column "+this.end_j+" at file column "+f),p=Math.floor(1201*d+f),m=f<1200?Math.floor(1201*d+f+1):Math.floor(1201*d+f),y=d<1200?Math.floor(1201*(d+1)+f):Math.floor(1201*d+f),_=d<1200&&f<1200?Math.floor(1201*(d+1)+f+1):Math.floor(1201*d+f);var T=n.getInt16(2*p,!1),M=n.getInt16(2*m,!1),S=(1-w)*(1-x)*T+(1-w)*x*n.getInt16(2*y,!1)+w*(1-x)*M+w*x*n.getInt16(2*_,!1);o[3*(c*a+h)+2]=S*s}}i.needsUpdate=!0,e.computeVertexNormals()}},H.send(null)}}};var C=r(66),I=r.n(C);class H extends I.a{constructor(e=null,t=null){super(),this._loaded=-1,this._totalLoaded=-1,this._parsed=-1,this._totalParsed=-1,this._data=[],this._container=e,this._progressBar=t}dispose(){this._data.forEach(e=>{e.dispose()}),this._data=[],this._container=null,this._progressBar&&this._progressBar.onLoad()}fetch(e,t){return new Promise((r,n)=>{const i=new XMLHttpRequest;i.open("GET",e),i.crossOrigin=!0,i.responseType="arraybuffer",i.onloadstart=t=>{this.emit("fetch-start",{file:e,time:new Date}),this._progressBar&&this._progressBar.onStart()},i.onload=t=>{if(200===i.status||0===i.status){this._loaded=t.loaded,this._totalLoaded=t.total;let n=i.response,a={url:e,buffer:n};this.emit("fetch-success",{file:e,time:new Date,totalLoaded:t.total}),r(a)}else n(i.statusText)},i.onerror=()=>{this.emit("fetch-error",{file:e,time:new Date}),n(i.statusText)},i.onabort=t=>{this.emit("fetch-abort",{file:e,time:new Date}),n(i.statusText||"Aborted")},i.ontimeout=()=>{this.emit("fetch-timeout",{file:e,time:new Date}),n(i.statusText)},i.onprogress=t=>{this._loaded=t.loaded,this._totalLoaded=t.total,this.emit("fetch-progress",{file:e,total:t.total,loaded:t.loaded,time:new Date}),this._progressBar&&this._progressBar.onProgress(e,this._loaded,this._totalLoaded)},i.onloadend=t=>{this.emit("fetch-end",{file:e,time:new Date})},t instanceof Map&&t.set(e,i),i.send()})}parse(e){return new Promise((t,r)=>{t(e)})}loadSequenceGroup(e,t){const r=[];return e.forEach(e=>{r.push(this.fetch(e,t))}),Promise.all(r).then(e=>this.parse(e)).then(e=>(this._data.push(e),e)).catch((function(e){"Aborted"!==e&&(window.console.log("oops... something went wrong..."),window.console.log(e))}))}loadSequence(e,t){return this.fetch(e,t).then(e=>this.parse(e)).then(e=>(this._data.push(e),e)).catch((function(e){"Aborted"!==e&&(window.console.log("oops... something went wrong..."),window.console.log(e))}))}load(e,t){Array.isArray(e)||(e=[e]),this.emit("load-start",{files:e,time:new Date});const r=[];return e.forEach(e=>{Array.isArray(e)?r.push(this.loadSequenceGroup(e,t)):r.push(this.loadSequence(e,t))}),Promise.all(r)}set data(e){this._data=e}get data(){return this._data}}class O{constructor(){this._id=-1}mergeModels(e,t){if(!this._validateModelArray(e)||!this._validateModelArray(t))return window.console.log("invalid inputs provided."),!1;for(let r=0,n=t.length;r<n;r++)for(let n=0,i=e.length;n<i&&!e[n].merge(t[r]);n++)n===e.length-1&&e.push(t[r]);return!0}merge(e){return!!this.validate(e)&&this._id===e._id}validate(e){return!(!e||null===e||"function"!=typeof e.merge)}_validateModelArray(e){if(null===e||Array!==e.constructor)return window.console.log("invalid model array provided."),!1;for(let t=0;t<e.length;t++)if(!e[t]||null===e[t]||"function"!=typeof e[t].validate||!e[t].validate(e[t]))return!1;return!0}}class D extends O{constructor(){super(),this._concatenationUID=-1,this._seriesInstanceUID=-1,this._transferSyntaxUID="",this._seriesNumber=-1,this._seriesDescription="",this._seriesDate="",this._studyDescription="",this._studyDate="",this._accessionNumber=-1,this._modality="Modality not set",this._dimensionIndexSequence=[],this._numberOfFrames=0,this._numberOfChannels=1,this._rawHeader=null,this._patientID="",this._patientName="",this._patientAge="",this._patientBirthdate="",this._patientSex="",this._segmentationType=null,this._segmentationSegments=[],this._stack=[]}validate(e){return!!(super.validate(e)&&"function"==typeof e.mergeSeries&&e.hasOwnProperty("_seriesInstanceUID")&&e.hasOwnProperty("_numberOfFrames")&&e.hasOwnProperty("_numberOfChannels")&&e.hasOwnProperty("_stack")&&void 0!==e._stack&&Array===e._stack.constructor)}merge(e){return!!this.validate(e)&&(this._seriesInstanceUID===e.seriesInstanceUID&&(e.stack[0]&&(0===this._stack[0]._numberOfFrames&&this._stack[0].computeNumberOfFrames(),this._stack[0].computeCosines(),0===e.stack[0]._numberOfFrames&&e.stack[0].computeNumberOfFrames(),e.stack[0].computeCosines()),this.mergeModels(this._stack,e.stack)))}mergeSeries(e){let t=[this];return this.mergeModels(t,e),t}dispose(){this._stack.forEach(e=>{}),this._stack=[]}set seriesInstanceUID(e){this._seriesInstanceUID=e}get seriesInstanceUID(){return this._seriesInstanceUID}set transferSyntaxUID(e){this._transferSyntaxUID=e}get transferSyntaxUID(){return this._transferSyntaxUID}get transferSyntaxUIDLabel(){switch(this._transferSyntaxUID){case"1.2.840.10008.1.2.4.90":return"JPEG 2000 Lossless";case"1.2.840.10008.1.2.4.91":return"JPEG 2000 Lossy";case"1.2.840.10008.1.2.4.57":return"JPEG Lossless, Nonhierarchical (Processes 14)";case"1.2.840.10008.1.2.4.70":return"JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])";case"1.2.840.10008.1.2.4.50":return"JPEG Baseline lossy process 1 (8 bit)";case"1.2.840.10008.1.2.4.51":return"JPEG Baseline lossy process 2 & 4 (12 bit)";case"1.2.840.10008.1.2":return"Implicit VR Little Endian";case"1.2.840.10008.1.2.1":return"Explicit VR Little Endian";case"1.2.840.10008.1.2.2":return"Explicit VR Big Endian";default:return"Unknown transfersyntax: "+this._transferSyntaxUID}}set studyDate(e){this._studyDate=e}get studyDate(){return this._studyDate}set studyDescription(e){this._studyDescription=e}get studyDescription(){return this._studyDescription}set seriesDate(e){this._seriesDate=e}get seriesDate(){return this._seriesDate}set seriesDescription(e){this._seriesDescription=e}get seriesDescription(){return this._seriesDescription}set rawHeader(e){this._rawHeader=e}get rawHeader(){return this._rawHeader}set patientID(e){this._patientID=e}get patientID(){return this._patientID}set patientName(e){this._patientName=e}get patientName(){return this._patientName}set patientAge(e){this._patientAge=e}get patientAge(){return this._patientAge}set patientBirthdate(e){this._patientBirthdate=e}get patientBirthdate(){return this._patientBirthdate}set patientSex(e){this._patientSex=e}get patientSex(){return this._patientSex}set numberOfFrames(e){this._numberOfFrames=e}get numberOfFrames(){return this._numberOfFrames}set numberOfChannels(e){this._numberOfChannels=e}get numberOfChannels(){return this._numberOfChannels}set stack(e){this._stack=e}get stack(){return this._stack}set modality(e){this._modality=e}get modality(){return this._modality}set segmentationType(e){this._segmentationType=e}get segmentationType(){return this._segmentationType}set segmentationSegments(e){this._segmentationSegments=e}get segmentationSegments(){return this._segmentationSegments}}const F=r(201),N=r(1);var U=new i.Vector3,B=new i.Vector3,z=new i.Matrix4,j=new i.Matrix4;function V(e=50,t=0,r=0){if(!(e>=0&&e<=100))return null;const[n,i,a]=this.cielab2XYZ(e,t,r);return this.xyz2RGB(n,i,a)}function G(e=[]){let t=[65535,-32768],r=e.length;for(let n=0;n<r;n++){let r=e[n];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}function W(e,t,r){return e*t+r}class X extends O{constructor(){super(),this._uid=null,this._stackID=-1,this._frame=[],this._numberOfFrames=0,this._rows=0,this._columns=0,this._numberOfChannels=1,this._bitsAllocated=8,this._pixelType=0,this._pixelRepresentation=0,this._rawData=[],this._textureSize=8192,this._textureType=0,this._textureUnits=7,this._textures=[],this._windowCenter=0,this._windowWidth=0,this._rescaleSlope=1,this._rescaleIntercept=0,this._minMax=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this._regMatrix=new i.Matrix4,this._ijk2LPS=new i.Matrix4,this._lps2IJK=new i.Matrix4,this._aabb2LPS=new i.Matrix4,this._lps2AABB=new i.Matrix4,this._dimensionsIJK=new i.Vector3,this._halfDimensionsIJK=new i.Vector3,this._spacing=new i.Vector3(1,1,1),this._spacingBetweenSlices=0,this._sliceThickness=0,this._origin=new i.Vector3,this._rightHanded=!0,this._xCosine=new i.Vector3(1,0,0),this._yCosine=new i.Vector3(0,1,0),this._zCosine=new i.Vector3(0,0,1),this._prepared=!1,this._packed=!1,this._packedPerPixel=1,this._modality="Modality not set",this._segmentationType=null,this._segmentationSegments=[],this._segmentationDefaultColor=[63,174,128],this._frameSegment=[],this._segmentationLUT=[],this._segmentationLUTO=[],this._invert=!1}prepareSegmentation(){this._frameSegment=this._frame;let e=[];this.computeCosines(),this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort);let t=-1;for(let r=0;r<this._frame.length;r++){if(e[t]&&e[t]._dist==this._frame[r]._dist)for(let n=0;n<e[t]._rows*e[t]._columns;n++)e[t]._pixelData[n]+=this._frame[r].pixelData[n]*this._frame[r]._referencedSegmentNumber;else{e.push(this._frame[r]),t++;for(let n=0;n<e[t]._rows*e[t]._columns;n++)e[t]._pixelData[n]*=this._frame[r]._referencedSegmentNumber}e[t].minMax=G(e[t]._pixelData)}let r={},n=0,i=this._segmentationSegments;for(let e=0;e<i.length;e++){let t=i[e];n=Math.max(n,parseInt(t.segmentNumber,10));let a=t.recommendedDisplayCIELab;r[t.segmentNumber]=null===a?this._segmentationDefaultColor:V(...a)}for(let e=0;e<=n;e++){let t=e/n,i=e?1:0,a=[0,0,0];r.hasOwnProperty(e.toString())&&(a=r[e.toString()]),a[0]/=255,a[1]/=255,a[2]/=255,this._segmentationLUT.push([t,...a]),this._segmentationLUTO.push([t,i])}this._frame=e}prepare(){"SEG"===this._modality&&this.prepareSegmentation(),this.computeNumberOfFrames(),this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK.set(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK.set(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this._numberOfFrames>1&&this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin.fromArray(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB();const e=Math.floor(this._frame.length/2),t=this._frame[e];this._rescaleSlope=t.rescaleSlope||1,this._rescaleIntercept=t.rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=W(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=W(this._minMax[1],this._rescaleSlope,this._rescaleIntercept),this._windowWidth=t.windowWidth||this._minMax[1]-this._minMax[0],this._windowCenter=t.windowCenter||this._minMax[0]+this._windowWidth/2,this._bitsAllocated=t.bitsAllocated,this._prepared=!0}packEchos(){let e=[];for(let t=0;t<this._frame.length;t+=4){let r=this._frame[t];for(let e=0;e<this._rows*this._columns;e++){for(let n=1;n<4;n++)r.pixelData[e]+=this._frame[t+n].pixelData[e];r.pixelData[e]/=4}e.push(r)}this._frame=e,this._numberOfFrames=this._frame.length,this._dimensionsIJK.set(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK.set(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)}computeNumberOfFrames(){if(!(this._frame&&this._frame.length>0))return window.console.warn("_frame doesn't contain anything...."),window.console.warn(this._frame),!1;this._numberOfFrames=this._frame.length}computeCosines(){if(this._frame&&this._frame[0]){let e=this._frame[0].cosines();this._xCosine.copy(e[0]),this._yCosine.copy(e[1]),this._zCosine.copy(e[2])}}orderFrames(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):this._frame[0].imagePosition?window.console.warn("warning: unexpected case found..."):window.console.warn("warning: You have null imagePosition...")}computeSpacing(){this.xySpacing(),this.zSpacing()}zSpacing(){this._numberOfFrames>1&&(this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame[1].dist!==this._frame[0].dist?(this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist):this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].sliceThickness&&(this._spacing.z=this._frame[0].sliceThickness))),0===this._spacing.z&&(this._spacing.z=1)}xySpacing(){if(this._frame&&this._frame[0]){let e=this._frame[0].spacingXY();this._spacing.x=e[0],this._spacing.y=e[1]}}computeMinMaxIntensities(){for(let e=0;e<this._frame.length;e++){let t=this._frame[e].minMax[0];Number.isNaN(t)||(this._minMax[0]=Math.min(this._minMax[0],t));let r=this._frame[e].minMax[1];Number.isNaN(r)||(this._minMax[1]=Math.max(this._minMax[1],r))}}computeIJK2LPS(){this._ijk2LPS.copy(function(e,t,r,n,a,o=new i.Matrix4){return z.set(e.x*n.y,t.x*n.x,r.x*n.z,a.x,e.y*n.y,t.y*n.x,r.y*n.z,a.y,e.z*n.y,t.z*n.x,r.z*n.z,a.z,0,0,0,1),z.premultiply(o),z}(this._xCosine,this._yCosine,this._zCosine,this._spacing,this._origin,this._regMatrix)),this._lps2IJK.getInverse(this._ijk2LPS)}computeLPS2AABB(){var e,t,r,n;this._aabb2LPS.copy((e=this._xCosine,t=this._yCosine,r=this._zCosine,n=this._origin,j.set(e.x,t.x,r.x,n.x,e.y,t.y,r.y,n.y,e.z,t.z,r.z,n.z,0,0,0,1),j)),this._lps2AABB.getInverse(this._aabb2LPS)}merge(e){return!!(this._stackID===e.stackID&&1===this._numberOfFrames&&1===e._numberOfFrames&&this._frame[0].columns===e.frame[0].columns&&this._frame[0].rows===e.frame[0].rows&&this._xCosine.equals(e.xCosine)&&this._yCosine.equals(e.yCosine)&&this._zCosine.equals(e.zCosine))&&this.mergeModels(this._frame,e.frame)}pack(){const e=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;(8===this._bitsAllocated&&1===this._numberOfChannels||1===this._bitsAllocated)&&(this._packedPerPixel=4),16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);const t=this._textureSize*this._textureSize;let r=Math.ceil(e/(t*this._packedPerPixel)),n=0,a=this._packedPerPixel*t;a>e&&(a=e),this._textureUnits<r&&(console.warn("Insufficient number of supported textures. Some frames will not be packed."),r=this._textureUnits);for(var o=0;o<r;o++)this._rawData.push(N.mallocUint8(4*t));this._textureType=3===this._numberOfChannels?i.RGBFormat:i.RGBAFormat;for(let i=0;i<r;i++)this._packTo8Bits(this._numberOfChannels,this._frame,this._textureSize,n,a,i),n+=this._packedPerPixel*t,a+=this._packedPerPixel*t,a>e&&(a=e);this._packed=!0,this._prepareTexture()}_prepareTexture(){let e=window.THREE;this._textures=[];for(let t=0;t<this._rawData.length;t++){let r=new e.DataTexture(this._rawData[t],this._textureSize,this._textureSize,this._textureType,e.UnsignedByteType,e.UVMapping,e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.NearestFilter,e.NearestFilter);r.needsUpdate=!0,r.flipY=!0,this._textures.push(r)}}_packTo8Bits(e,t,r,n,i,a){const o=t[0].bitsAllocated,s=t[0].pixelType;let l=0;this._minMax[0]<0&&(l-=this._minMax[0]);const u=t[0].rows*t[0].columns;var c=~~(n/u),h=~~(i/u),d=0,f=this._rawData[a];if(8===o&&1===e||1===o)for(let e=c;e<h;e++)for(let r=0;r<u;r++){let n=t[e].pixelData[r]+l;f[d++]=n}else if(16===o&&1===e)for(let e=c;e<h;e++)for(let r=0;r<u;r++){let n=t[e].pixelData[r]+l;f[d++]=255&n,f[d++]=n>>>8&255}else if(32===o&&1===e&&0===s)for(let e=c;e<h;e++)for(let r=0;r<u;r++){let n=t[e].pixelData[r]+l;f[d++]=255&n,f[d++]=n>>>8&255,f[d++]=n>>>16&255,f[d++]=n>>>24&255}else if(32===o&&1===e&&1===s)for(let e=c;e<h;e++)for(let r=0;r<u;r++){let n=t[e].pixelData[r]+l;{let e=F(n).match(/.{1,8}/g);f[d++]=parseInt(e[0],2),f[d++]=parseInt(e[1],2),f[d++]=parseInt(e[2],2),f[d++]=parseInt(e[3],2)}}else if(8===o&&3===e)for(let e=c;e<h;e++)for(let r=0;r<u;r++){let n=3*r;f[d++]=t[e].pixelData[n],f[d++]=t[e].pixelData[n+1],f[d++]=t[e].pixelData[n+2]}}worldCenter(){return this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS)}worldBoundingBox(){let e=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];const t=this._dimensionsIJK;var r=new i.Vector3;for(let n=0;n<=t.x;n+=t.x)for(let i=0;i<=t.y;i+=t.y)for(let a=0;a<=t.z;a+=t.z)r.set(n,i,a).applyMatrix4(this._ijk2LPS),e[0]=Math.min(e[0],r.x),e[1]=Math.max(e[1],r.x),e[2]=Math.min(e[2],r.y),e[3]=Math.max(e[3],r.y),e[4]=Math.min(e[4],r.z),e[5]=Math.max(e[5],r.z);return e}worldSliceOrientation(){function e(e){let t=Math.abs(e.x),r=Math.abs(e.y),n=t,i=0;return n<r&&(n=r,i=1),n<Math.abs(e.z)&&(i=2),i}return[e(this._xCosine),e(this._yCosine),e(this._zCosine)]}AABBox(){let e=U.set(0,0,0).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),t=B.copy(this._dimensionsIJK).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB);return new i.Vector3(Math.abs(e.x-t.x),Math.abs(e.y-t.y),Math.abs(e.z-t.z))}centerAABBox(){let e=this.worldCenter();return e.applyMatrix4(this._lps2AABB),e}static indexInDimensions(e,t){return e.x>=0&&e.y>=0&&e.z>=0&&e.x<t.x&&e.y<t.y&&e.z<t.z}_orderFrameOnDimensionIndicesArraySort(e,t){if("dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e.dimensionIndexValues)&&"dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues))for(let r=0;r<e.dimensionIndexValues.length;r++){if(parseInt(e.dimensionIndexValues[r],10)>parseInt(t.dimensionIndexValues[r],10))return 1;if(parseInt(e.dimensionIndexValues[r],10)<parseInt(t.dimensionIndexValues[r],10))return-1}else window.console.warn("One of the frames doesn't have a dimensionIndexValues array."),window.console.warn(e),window.console.warn(t);return 0}_computeDistanceArrayMap(e,t){return t.imagePosition&&(t.dist=t.imagePosition[0]*e.x+t.imagePosition[1]*e.y+t.imagePosition[2]*e.z),t}_sortDistanceArraySort(e,t){return e.dist-t.dist}_sortInstanceNumberArraySort(e,t){return e.instanceNumber-t.instanceNumber}_sortSopInstanceUIDArraySort(e,t){return e.sopInstanceUID-t.sopInstanceUID}dispose(){this._frame.forEach(e=>{e.dispose()}),this._frame=[],this._textures.forEach(e=>{e.dispose()}),this._textures=[];for(var e=0;e<this._rawData.length;e++)N.freeUint8(this._rawData[e]);this._rawData=[]}set numberOfChannels(e){this._numberOfChannels=e}get numberOfChannels(){return this._numberOfChannels}set frame(e){this._frame=e}get frame(){return this._frame}set prepared(e){this._prepared=e}get prepared(){return this._prepared}set packed(e){this._packed=e}get packed(){return this._packed}set packedPerPixel(e){this._packedPerPixel=e}get packedPerPixel(){return this._packedPerPixel}set dimensionsIJK(e){this._dimensionsIJK=e}get dimensionsIJK(){return this._dimensionsIJK}set halfDimensionsIJK(e){this._halfDimensionsIJK=e}get halfDimensionsIJK(){return this._halfDimensionsIJK}set regMatrix(e){this._regMatrix=e}get regMatrix(){return this._regMatrix}set ijk2LPS(e){this._ijk2LPS=e}get ijk2LPS(){return this._ijk2LPS}set lps2IJK(e){this._lps2IJK=e}get lps2IJK(){return this._lps2IJK}set lps2AABB(e){this._lps2AABB=e}get lps2AABB(){return this._lps2AABB}set textureSize(e){this._textureSize=e}get textureSize(){return this._textureSize}set textureUnits(e){this._textureUnits=e}get textureUnits(){return this._textureUnits}set textureType(e){this._textureType=e}get textureType(){return this._textureType}set bitsAllocated(e){this._bitsAllocated=e}get bitsAllocated(){return this._bitsAllocated}set rawData(e){this._rawData=e}get rawData(){return this._rawData}get windowWidth(){return this._windowWidth}set windowWidth(e){this._windowWidth=e}get windowCenter(){return this._windowCenter}set windowCenter(e){this._windowCenter=e}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(e){this._rescaleSlope=e}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(e){this._rescaleIntercept=e}get xCosine(){return this._xCosine}set xCosine(e){this._xCosine=e}get yCosine(){return this._yCosine}set yCosine(e){this._yCosine=e}get zCosine(){return this._zCosine}set zCosine(e){this._zCosine=e}get minMax(){return this._minMax}set minMax(e){this._minMax=e}get stackID(){return this._stackID}set stackID(e){this._stackID=e}get pixelType(){return this._pixelType}set pixelType(e){this._pixelType=e}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(e){this._pixelRepresentation=e}set invert(e){this._invert=e}get invert(){return this._invert}set modality(e){this._modality=e}get modality(){return this._modality}get rightHanded(){return this._rightHanded}set rightHanded(e){this._rightHanded=e}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(e){this._spacingBetweenSlices=e}set segmentationSegments(e){this._segmentationSegments=e}get segmentationSegments(){return this._segmentationSegments}set segmentationType(e){this._segmentationType=e}get segmentationType(){return this._segmentationType}set segmentationLUT(e){this._segmentationLUT=e}get segmentationLUT(){return this._segmentationLUT}set segmentationLUTO(e){this._segmentationLUTO=e}get segmentationLUTO(){return this._segmentationLUTO}}var Y=new Uint8Array(262144);class q extends O{constructor(){super(),this._sopInstanceUID=null,this._url=null,this._stackID=-1,this._invert=!1,this._frameTime=null,this._ultrasoundRegions=[],this._rows=0,this._columns=0,this._dimensionIndexValues=[],this._imagePosition=null,this._imageOrientation=null,this._rightHanded=!0,this._sliceThickness=1,this._spacingBetweenSlices=null,this._pixelPaddingValue=null,this._pixelRepresentation=0,this._pixelType=0,this._pixelSpacing=null,this._pixelAspectRatio=null,this._pixelData=null,this._instanceNumber=null,this._windowCenter=null,this._windowWidth=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._bitsAllocated=8,this._numberOfChannels=1,this._minMax=null,this._dist=null,this._index=-1,this._referencedSegmentNumber=-1}validate(e){return!!(super.validate(e)&&"function"==typeof e.cosines&&"function"==typeof e.spacingXY&&e.hasOwnProperty("_sopInstanceUID")&&e.hasOwnProperty("_dimensionIndexValues")&&e.hasOwnProperty("_imageOrientation")&&e.hasOwnProperty("_imagePosition"))}merge(e){return!!this.validate(e)&&!!(this._compareArrays(this._dimensionIndexValues,e.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,e.imageOrientation)&&this._compareArrays(this._imagePosition,e.imagePosition)&&this._instanceNumber===e.instanceNumber&&this._sopInstanceUID===e.sopInstanceUID)}cosines(){let e=[new i.Vector3(1,0,0),new i.Vector3(0,1,0),new i.Vector3(0,0,1)];return this._imageOrientation&&6===this._imageOrientation.length?(e[0].set(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),e[1].set(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]),e[0].lengthSq()>0&&e[1].lengthSq()>0&&e[2].crossVectors(e[0],e[1]).normalize()):(console.log("No valid image orientation for frame"),console.log(this),console.log("Returning default orientation.")),this._rightHanded||e[2].negate(),e}spacingXY(){let e=[1,1];return this.pixelSpacing?(e[0]=this.pixelSpacing[0],e[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(e[0]=1,e[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),e}getPixelData(e,t){return e>=0&&e<this._columns&&t>=0&&t<this._rows?this.pixelData[e+this._columns*t]:null}setPixelData(e,t,r){this.pixelData[e+this._columns*t]=r}getImageDataUrl(){const e=document.createElement("canvas");e.width=this._columns,e.height=this._rows;const t=e.getContext("2d"),r=t.createImageData(e.width,e.height);return r.data.set(this._frameToCanvas()),t.putImageData(r,0,0),e.toDataURL()}_frameToCanvas(){const e=this._columns*this._rows,t={invert:this._invert,min:this._minMax[0],padding:this._pixelPaddingValue};let r=function(e){return e>262144&&alert("Warning: The number of elements per data buffer exceeds the maximum size."),Y}(4*e);if(null!==t.padding){t.min=this._minMax[1];for(let e=0,r=this._pixelData.length;e<r;e++)this._pixelData[e]!==t.padding&&(t.min=Math.min(t.min,this._pixelData[e]))}if(this._windowWidth&&null!==this._windowCenter){const e=this._rescaleIntercept||0,r=this._rescaleSlope||1;t.min=Math.max((this._windowCenter-this._windowWidth/2-e)/r,t.min),t.max=Math.min((this._windowCenter+this._windowWidth/2-e)/r,this._minMax[1])}else t.max=this._minMax[1];if(t.range=t.max-t.min||255,1===this._numberOfChannels)for(let n=0;n<e;n++){const e=this._pixelTo8Bit(this._pixelData[n],t);r[4*n]=e,r[4*n+1]=e,r[4*n+2]=e,r[4*n+3]=255}else if(3===this._numberOfChannels)for(let n=0;n<e;n++)r[4*n]=this._pixelTo8Bit(this._pixelData[3*n],t),r[4*n+1]=this._pixelTo8Bit(this._pixelData[3*n+1],t),r[4*n+2]=this._pixelTo8Bit(this._pixelData[3*n+2],t),r[4*n+3]=255;return r}_pixelTo8Bit(e,t){let r=e<=t.min||e===t.padding?0:255;return e>t.min&&e<t.max&&(r=Math.round(255*(e-t.min)/t.range)),Number.isNaN(r)?0:t.invert?255-r:r}_compareArrays(e,t){return e===t||!(!e||!t||e.join()!==t.join())}dispose(){this._pixelData=[]}get frameTime(){return this._frameTime}set frameTime(e){this._frameTime=e}get ultrasoundRegions(){return this._ultrasoundRegions}set ultrasoundRegions(e){this._ultrasoundRegions=e}get rows(){return this._rows}set rows(e){this._rows=e}get columns(){return this._columns}set columns(e){this._columns=e}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(e){this._spacingBetweenSlices=e}get sliceThickness(){return this._sliceThickness}set sliceThickness(e){this._sliceThickness=e}get imagePosition(){return this._imagePosition}set imagePosition(e){this._imagePosition=e}get imageOrientation(){return this._imageOrientation}set imageOrientation(e){this._imageOrientation=e}get windowWidth(){return this._windowWidth}set windowWidth(e){this._windowWidth=e}get windowCenter(){return this._windowCenter}set windowCenter(e){this._windowCenter=e}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(e){this._rescaleSlope=e}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(e){this._rescaleIntercept=e}get bitsAllocated(){return this._bitsAllocated}set bitsAllocated(e){this._bitsAllocated=e}get dist(){return this._dist}set dist(e){this._dist=e}get pixelSpacing(){return this._pixelSpacing}set pixelSpacing(e){this._pixelSpacing=e}get pixelAspectRatio(){return this._pixelAspectRatio}set pixelAspectRatio(e){this._pixelAspectRatio=e}get minMax(){return this._minMax}set minMax(e){this._minMax=e}get dimensionIndexValues(){return this._dimensionIndexValues}set dimensionIndexValues(e){this._dimensionIndexValues=e}get instanceNumber(){return this._instanceNumber}set instanceNumber(e){this._instanceNumber=e}get pixelData(){return this._pixelData}set pixelData(e){this._pixelData=e}set sopInstanceUID(e){this._sopInstanceUID=e}get sopInstanceUID(){return this._sopInstanceUID}get pixelPaddingValue(){return this._pixelPaddingValue}set pixelPaddingValue(e){this._pixelPaddingValue=e}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(e){this._pixelRepresentation=e}get pixelType(){return this._pixelType}set pixelType(e){this._pixelType=e}get url(){return this._url}set url(e){this._url=e}get referencedSegmentNumber(){return this._referencedSegmentNumber}set referencedSegmentNumber(e){this._referencedSegmentNumber=e}get rightHanded(){return this._rightHanded}set rightHanded(e){this._rightHanded=e}get index(){return this._index}set index(e){this._index=e}get invert(){return this._invert}set invert(e){this._invert=e}get numberOfChannels(){return this._numberOfChannels}set numberOfChannels(e){this._numberOfChannels=e}}class Z{constructor(){this._rightHanded=!0}pixelRepresentation(){return 0}pixelPaddingValue(e=0){return null}modality(){return"unknown"}segmentationType(){return"unknown"}segmentationSegments(){return[]}referencedSegmentNumber(e){return-1}rightHanded(){return this._rightHanded}spacingBetweenSlices(){return null}numberOfChannels(){return 1}sliceThickness(){return null}dimensionIndexValues(e=0){return null}instanceNumber(e=0){return e}windowCenter(e=0){return null}windowWidth(e=0){return null}rescaleSlope(e=0){return 1}rescaleIntercept(e=0){return 0}ultrasoundRegions(e=0){return[]}frameTime(e=0){return null}_decompressUncompressed(){}_swap16(e){return(255&e)<<8|e>>8&255}_swap32(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}invert(){return!1}transferSyntaxUID(){return"no value provided"}studyDate(){return"no value provided"}studyDescription(){return"no value provided"}seriesDate(){return"no value provided"}seriesDescription(){return"no value provided"}rawHeader(){return"no value provided"}patientID(){return"no value provided"}patientName(){return"no value provided"}patientAge(){return"no value provided"}patientBirthdate(){return"no value provided"}patientSex(){return"no value provided"}minMaxPixelData(e=[]){let t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],r=e.length;for(let n=0;n<r;n++){let r=e[n];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}}r(67);const K=function(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){const r=t,n=e.rows*e.columns,i=new ArrayBuffer(n*e.samplesPerPixel),a=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let l=0;const u=a.getInt32(0,!0);for(let e=0;e<u;++e){l=e*n;let t=a.getInt32(4*(e+1),!0),i=a.getInt32(4*(e+2),!0);0===i&&(i=r.length);const c=n*u;for(;t<i;){const e=o[t++];if(e>=0&&e<=127)for(let r=0;r<e+1&&l<c;++r)s[l]=o[t++],l++;else if(e<=-1&&e>=-127){const r=o[t++];for(let t=0;t<1-e&&l<c;++t)s[l]=r,l++}}}return e.pixelData=new Uint8Array(i),e}(e,t):function(e,t){const r=t,n=e.rows*e.columns,i=new ArrayBuffer(n*e.samplesPerPixel),a=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let l=0;const u=a.getInt32(0,!0);for(let t=0;t<u;++t){l=t;let i=a.getInt32(4*(t+1),!0),c=a.getInt32(4*(t+2),!0);0===c&&(c=r.length);const h=n*u;for(;i<c;){const t=o[i++];if(t>=0&&t<=127)for(let r=0;r<t+1&&l<h;++r)s[l]=o[i++],l+=e.samplesPerPixel;else if(t<=-1&&t>=-127){const r=o[i++];for(let n=0;n<1-t&&l<h;++n)s[l]=r,l+=e.samplesPerPixel}}}return e.pixelData=new Uint8Array(i),e}(e,t);if(16===e.bitsAllocated)return function(e,t){const r=t,n=e.rows*e.columns,i=new ArrayBuffer(n*e.samplesPerPixel*2),a=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i),l=a.getInt32(0,!0);for(let e=0;e<l;++e){let t=0;const i=0===e?1:0;let l=a.getInt32(4*(e+1),!0),u=a.getInt32(4*(e+2),!0);for(0===u&&(u=r.length);l<u;){const e=o[l++];if(e>=0&&e<=127)for(let r=0;r<e+1&&t<n;++r)s[2*t+i]=o[l++],t++;else if(e<=-1&&e>=-127){const r=o[l++];for(let a=0;a<1-e&&t<n;++a)s[2*t+i]=r,t++}}}0===e.pixelRepresentation?e.pixelData=new Uint16Array(i):e.pixelData=new Int16Array(i);return e}(e,t);throw new Error("unsupported pixel format for RLE")};let Q=r(213),J=r(214),$=r(216),ee=r(217);function te(e){let t=Number(e);if(t!=t){const r=(e.match(/\./g)||[]).length;if(1===(e.match(/\,/g)||[]).length&&r<2){const n=0===r?".":"",i=e.replace(/,/g,n);t=Number(i)}t!=t&&(console.error(`String could not be converted to number (${e}). Setting value to "1.0".`),t=1)}return t}class re extends Z{constructor(e,t){super(),this._id=t,this._arrayBuffer=e.buffer;let r=new Uint8Array(this._arrayBuffer);this._dataSet=null;try{this._dataSet=Q.parseDicom(r)}catch(e){throw console.log(e),new Error("parsers.dicom could not parse the file")}}seriesInstanceUID(){return this._dataSet.string("x0020000e")}studyInstanceUID(){return this._dataSet.string("x0020000d")}modality(){return this._dataSet.string("x00080060")}segmentationType(){return this._dataSet.string("x00620001")}segmentationSegments(){let e=[],t=this._dataSet.elements.x00620002;if(!t)return e;for(let r=0;r<t.items.length;r++){let n=this._recommendedDisplayCIELab(t.items[r]),i=this._segmentationCode(t.items[r]),a=t.items[r].dataSet.uint16("x00620004"),o=t.items[r].dataSet.string("x00620005"),s=t.items[r].dataSet.string("x00620008");e.push({recommendedDisplayCIELab:n,segmentationCodeDesignator:i.segmentationCodeDesignator,segmentationCodeValue:i.segmentationCodeValue,segmentationCodeMeaning:i.segmentationCodeMeaning,segmentNumber:a,segmentLabel:o,segmentAlgorithmType:s})}return e}_segmentationCode(e){let t="unknown",r="unknown",n="unknown",i=e.dataSet.elements.x00082218;return i&&i.items&&i.items.length>0&&(t=i.items[0].dataSet.string("x00080102"),r=i.items[0].dataSet.string("x00080100"),n=i.items[0].dataSet.string("x00080104")),{segmentationCodeDesignator:t,segmentationCodeValue:r,segmentationCodeMeaning:n}}_recommendedDisplayCIELab(e){if(!e.dataSet.elements.x0062000d)return null;let t=e.dataSet.elements.x0062000d.dataOffset,r=e.dataSet.elements.x0062000d.length,n=e.dataSet.byteArray.slice(t,t+r),i=new Uint16Array(r/2);for(let e=0;e<r/2;e++)i[e]=(n[2*e+1]<<8)+n[2*e];return[i[0]/65535*100,i[1]/65535*255-128,i[2]/65535*255-128]}rawHeader(){return this._dataSet}sopInstanceUID(e=0){return this._findStringEverywhere("x2005140f","x00080018",e)}transferSyntaxUID(){return this._dataSet.string("x00020010")}studyDate(){return this._dataSet.string("x00080020")}studyDescription(){return this._dataSet.string("x00081030")}seriesDate(){return this._dataSet.string("x00080021")}seriesDescription(){return this._dataSet.string("x0008103e")}patientName(){return this._dataSet.string("x00100010")}patientID(){return this._dataSet.string("x00100020")}patientBirthdate(){return this._dataSet.string("x00100030")}patientSex(){return this._dataSet.string("x00100040")}patientAge(){return this._dataSet.string("x00101010")}photometricInterpretation(){return this._dataSet.string("x00280004")}planarConfiguration(){let e=this._dataSet.uint16("x00280006");return void 0===e&&(e=null),e}samplesPerPixel(){return this._dataSet.uint16("x00280002")}numberOfFrames(){let e=this._dataSet.intString("x00280008");return void 0===e&&(e=null),e}numberOfChannels(){let e=1,t=this.photometricInterpretation();return"RGB"!==t&&"PALETTE COLOR"!==t&&"YBR_FULL"!==t&&"YBR_FULL_422"!==t&&"YBR_PARTIAL_422"!==t&&"YBR_PARTIAL_420"!==t&&"YBR_RCT"!==t||(e=3),e}invert(){return"MONOCHROME1"===this.photometricInterpretation()}imageOrientation(e=0){let t=this._findStringEverywhere("x00209116","x00200037",e);return t&&(t=t.split("\\").map(te)),t}referencedSegmentNumber(e=0){let t=-1,r=this._findInGroupSequence("x52009230","x0062000a",e);return null!==r&&(t=r.uint16("x0062000b")),t}pixelAspectRatio(){let e=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return void 0===e[0]&&(e=null),e}imagePosition(e=0){let t=this._findStringEverywhere("x00209113","x00200032",e);return t&&(t=t.split("\\").map(te)),t}instanceNumber(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r)if(r.items[e].dataSet.elements.x2005140f){t=r.items[e].dataSet.elements.x2005140f.items[0].dataSet.intString("x00200013")}else t=this._dataSet.intString("x00200013"),void 0===t&&(t=null);else t=this._dataSet.intString("x00200013"),void 0===t&&(t=null);return t}pixelSpacing(e=0){let t=this._findStringEverywhere("x00289110","x00280030",e);if(null===t&&(t=this._dataSet.string("x00181164"),void 0===t&&(t=null)),t){const e=t.split("\\");2!==e.length?(console.error('DICOM spacing format is not supported (could not split string on "\\"): '+t),t=null):t=e.map(te)}return t}ultrasoundRegions(e=0){const t=this._dataSet.elements.x00186011;if(!t||!t.items)return[];const r=[];return t.items.forEach(e=>{r.push({x0:e.dataSet.uint32("x00186018"),y0:e.dataSet.uint32("x0018601a"),x1:e.dataSet.uint32("x0018601c"),y1:e.dataSet.uint32("x0018601e"),axisX:e.dataSet.int32("x00186020")||null,axisY:e.dataSet.int32("x00186022")||null,unitsX:this._getUnitsName(e.dataSet.uint16("x00186024")),unitsY:this._getUnitsName(e.dataSet.uint16("x00186026")),deltaX:e.dataSet.double("x0018602c"),deltaY:e.dataSet.double("x0018602e")})}),r}frameTime(e=0){let t,r=this._dataSet.uint16("x00280009",1),n=this._dataSet.intString("x00082144");return"number"==typeof r&&(r=r.toString(16),t=this._dataSet.floatString("x0018"+r)),void 0===t&&"number"==typeof n&&(t=1e3/n),void 0===t&&(t=null),t}rows(e=0){let t=this._dataSet.uint16("x00280010");return void 0===t&&(t=null),t}columns(e=0){let t=this._dataSet.uint16("x00280011");return void 0===t&&(t=null),t}pixelType(e=0){return 0}pixelRepresentation(e=0){return this._dataSet.uint16("x00280103")}pixelPaddingValue(e=0){let t=this._dataSet.int16("x00280120");return void 0===t&&(t=null),t}bitsAllocated(e=0){return this._dataSet.uint16("x00280100")}highBit(e=0){return this._dataSet.uint16("x00280102")}rescaleIntercept(e=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",e)}rescaleSlope(e=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",e)}windowCenter(e=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",e)}windowWidth(e=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",e)}sliceThickness(e=0){return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",e)}spacingBetweenSlices(e=0){let t=this._dataSet.floatString("x00180088");return void 0===t&&(t=null),t}dimensionIndexValues(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r){let n=r.items[e].dataSet.elements.x00209111;if(null!=n){n=n.items[0].dataSet;let e=n.elements.x00209157;if(null!=e){let r=e.length/4;t=[];for(let e=0;e<r;e++)t.push(n.uint32("x00209157",e))}}}return t}inStackPositionNumber(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r){t=r.items[e].dataSet.elements.x00209111.items[0].dataSet.uint32("x00209057")}else t=null;return t}stackID(e=0){let t=null,r=this._dataSet.elements.x52009230;if(void 0!==r){t=r.items[e].dataSet.elements.x00209111.items[0].dataSet.intString("x00209056")}else t=null;return t}extractPixelData(e=0){let t=this._decodePixelData(e);return this.numberOfChannels()>1?this._convertColorSpace(t):t}_findInGroupSequence(e,t,r){let n=this._dataSet.elements[e];if(void 0!==n){let e=n.items[r].dataSet.elements[t];if(void 0!==e)return e.items[0].dataSet}return null}_findStringInGroupSequence(e,t,r,n){let i=this._findInGroupSequence(e,t,n);return null!==i?i.string(r):null}_findStringInFrameGroupSequence(e,t,r){return this._findStringInGroupSequence("x52009229",e,t,0)||this._findStringInGroupSequence("x52009230",e,t,r)}_findStringEverywhere(e,t,r){let n=this._findStringInFrameGroupSequence(e,t,r);if(null===n){const e="x00540022";n=this._findStringInSequence(e,t)}return null===n&&(n=this._dataSet.string(t)),void 0===n&&(n=null),n}_findStringInSequence(e,t,r){const n=this._dataSet.elements[e];let i;return n&&(i=n.items[0].dataSet.string(t)),void 0===i&&(i=null),i}_findFloatStringInGroupSequence(e,t,r,n){let i=this._dataSet.floatString(r);return void 0===i&&(i=this._findInGroupSequence(e,t,n),null!==i)?i.floatString(r):i}_findFloatStringInFrameGroupSequence(e,t,r){return this._findFloatStringInGroupSequence("x52009229",e,t,0)||this._findFloatStringInGroupSequence("x52009230",e,t,r)}_decodePixelData(e=0){let t=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t)return this._decodeJ2K(e);if("1.2.840.10008.1.2.5"===t)return this._decodeRLE(e);if("1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t)return this._decodeJPEGLossless(e);if("1.2.840.10008.1.2.4.50"===t||"1.2.840.10008.1.2.4.51"===t)return this._decodeJPEGBaseline(e);if("1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t)return this._decodeUncompressed(e);if("1.2.840.10008.1.2.2"===t){let t=this._decodeUncompressed(e);return this._swapFrame(t)}throw{error:"no decoder for transfer syntax "+t}}framesAreFragmented(){return this._dataSet.intString("x00280008")!==this._dataSet.elements.x7fe00010.fragments.length}getEncapsulatedImageFrame(e){return this._dataSet.elements.x7fe00010&&this._dataSet.elements.x7fe00010.basicOffsetTable.length?Q.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,e):this.framesAreFragmented()?Q.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,e,Q.createJPEGBasicOffsetTable(this._dataSet,this._dataSet.elements.x7fe00010)):Q.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,e)}_decodeJpx(e=0){const t=new ee;if(t.parse(this.getEncapsulatedImageFrame(e)),1!==t.componentsCount)throw new Error("JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected");if(1!==t.tiles.length)throw new Error("JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected");return t.tiles[0].items}_decodeOpenJPEG(e=0){const t=this.getEncapsulatedImageFrame(e),r=this.bitsAllocated(e)<=8?1:2,n=1===this.pixelRepresentation(e),i=(void 0)._malloc(t.length);(void 0).writeArrayToMemory(t,i);const a=(void 0)._malloc(4),o=(void 0)._malloc(4),s=(void 0)._malloc(4),l=(void 0)._malloc(4),u=(void 0)._malloc(4),c=(void 0).ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[i,t.length,a,o,s,l,u]),h=(void 0).getValue(a,"*");if(0!==c)return console.log("[opj_decode] decoding failed!"),(void 0)._free(i),(void 0)._free(h),(void 0)._free(s),(void 0)._free(l),(void 0)._free(o),void(void 0)._free(u);const d=(void 0).getValue(s,"i32")*(void 0).getValue(l,"i32")*(void 0).getValue(u,"i32"),f=new Int32Array((void 0).HEAP32.buffer,h,d);let p;if(1===r)if(Uint8Array.from)p=Uint8Array.from(f);else{p=new Uint8Array(d);for(let e=0;e<d;e++)p[e]=f[e]}else if(n)if(Int16Array.from)p=Int16Array.from(f);else{p=new Int16Array(d);for(let e=0;e<d;e++)p[e]=f[e]}else if(Uint16Array.from)p=Uint16Array.from(f);else{p=new Uint16Array(d);for(let e=0;e<d;e++)p[e]=f[e]}return(void 0)._free(i),(void 0)._free(a),(void 0)._free(h),(void 0)._free(o),(void 0)._free(s),(void 0)._free(l),(void 0)._free(u),p}_decodeJ2K(e=0){return this._decodeJpx(e)}_decodeRLE(e=0){const t=this.bitsAllocated(e),r=this.planarConfiguration(),n=this.columns(),i=this.rows(),a=this.samplesPerPixel(e),o={pixelRepresentation:this.pixelRepresentation(e),bitsAllocated:t,planarConfiguration:r,columns:n,rows:i,samplesPerPixel:a},s=Q.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,e);return K(o,s).pixelData}_decodeJPEGLossless(e=0){let t=this.getEncapsulatedImageFrame(e),r=this.pixelRepresentation(e),n=this.bitsAllocated(e)<=8?1:2,i=(new J.lossless.Decoder).decode(t.buffer,t.byteOffset,t.length,n);return 0===r?2===n?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)}_decodeJPEGBaseline(e=0){let t=this.getEncapsulatedImageFrame(e),r=this.rows(e),n=this.columns(e),i=this.bitsAllocated(e),a=new $;return a.parse(t),8===i?a.getData(n,r):16===i?a.getData16(n,r):void 0}_decodeUncompressed(e=0){let t=this.pixelRepresentation(e),r=this.bitsAllocated(e),n=this._dataSet.elements.x7fe00010.dataOffset,i=this.numberOfChannels(),a=this.rows(e)*this.columns(e)*i,o=0,s=this._dataSet.byteArray.buffer;if(0===t&&8===r)return o=n+e*a,new Uint8Array(s,o,a);if(0===t&&16===r)return o=n+e*a*2,new Uint16Array(s,o,a);if(1===t&&16===r)return o=n+e*a*2,new Int16Array(s,o,a);if(0===t&&32===r)return o=n+e*a*4,new Uint32Array(s,o,a);if(0===t&&1===r){let t=new ArrayBuffer(a),r=new Uint8Array(t);o=n+e*a;let i=0,l=e*a,u=e*a+a,c=Math.floor(l/8),h=l-8*c,d=Math.ceil(u/8),f=new Uint8Array(s,n);for(let e=c;e<=d;e++){for(;h<8;){switch(h){case 0:r[i]=1&f[e];break;case 1:r[i]=f[e]>>>1&1;break;case 2:r[i]=f[e]>>>2&1;break;case 3:r[i]=f[e]>>>3&1;break;case 4:r[i]=f[e]>>>4&1;break;case 5:r[i]=f[e]>>>5&1;break;case 6:r[i]=f[e]>>>6&1;break;case 7:r[i]=f[e]>>>7&1}if(h++,i++,i>=a)return r}h=0}}}_interpretAsRGB(e){return-1!==["RGB","YBR_RCT","YBR_ICT","YBR_FULL_422"].indexOf(e)}_convertColorSpace(e){let t=null,r=this.photometricInterpretation(),n=this.planarConfiguration();const i=this._interpretAsRGB(r);if(i&&0===n)t=e;else if(i&&1===n){if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array)){throw new Error("unsuported typed array: "+e)}t=new Uint16Array(e.length)}let r=e.length/3,n=0,i=0,a=r,o=2*r;for(let s=0;s<r;s++)t[n++]=e[i++],t[n++]=e[a++],t[n++]=e[o++]}else{if("YBR_FULL"!==r){throw new Error("photometric interpolation not supported: "+r)}{if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array)){throw new Error("unsuported typed array: "+e)}t=new Uint16Array(e.length)}let r=e.length/3,n=0,i=0;for(let a=0;a<r;a++){let r=e[n++],a=e[n++],o=e[n++];t[i++]=r+1.402*(o-128),t[i++]=r-.34414*(a-128)-.71414*(o-128),t[i++]=r+1.772*(a-128)}}}return t}_swapFrame(e){let t=this.bitsAllocated();if(16===t)for(let t=0;t<e.length;t++)e[t]=this._swap16(e[t]);else if(32===t)for(let t=0;t<e.length;t++)e[t]=this._swap32(e[t]);return e}_getUnitsName(e){const t={0:"none",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm2",9:"cm2/sec",10:"cm3",11:"cm3/sec",12:"degrees"};return t.hasOwnProperty(e)?t[e]:"none"}}class ne extends Z{constructor(e,t){super(),this._id=t,this._url=e.url,this._header={},this._buffer=null;try{(new TextDecoder).decode(e.mhdBuffer).split("\n").forEach(e=>{let t=e.split("=");2===t.length&&(this._header[t[0].trim()]=t[1].trim())}),this._header.DimSize=this._header.DimSize.split(" "),this._header.ElementSpacing=this._header.ElementSpacing.split(" "),this._header.TransformMatrix=this._header.TransformMatrix.split(" "),this._header.Offset=this._header.Offset.split(" "),this._buffer=e.rawBuffer}catch(e){window.console.log("ooops... :(")}}rightHanded(){let e=this._header.AnatomicalOrientation;return this._rightHanded="RAS"===e||"RPI"===e||"LPS"===e||"LAI"===e,this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return parseInt(this._header.DimSize[2],10)}sopInstanceUID(e=0){return e}rows(e=0){return parseInt(this._header.DimSize[1],10)}columns(e=0){return parseInt(this._header.DimSize[0],10)}pixelType(e=0){let t=0;return"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(t=1),t}bitsAllocated(e=0){let t=1;return"MET_UCHAR"===this._header.ElementType||"MET_CHAR"===this._header.ElementType?t=8:"MET_USHORT"===this._header.ElementType||"MET_SHORT"===this._header.ElementType?t=16:"MET_UINT"!==this._header.ElementType&&"MET_INT"!==this._header.ElementType&&"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(t=32),t}pixelSpacing(e=0){return[parseFloat(this._header.ElementSpacing[1],10),parseFloat(this._header.ElementSpacing[0],10),parseFloat(this._header.ElementSpacing[2],10)]}imageOrientation(e=0){let t=this._header.AnatomicalOrientation.match(/L/)?-1:1,r=this._header.AnatomicalOrientation.match(/P/)?-1:1,n=new i.Vector3(parseFloat(this._header.TransformMatrix[0])*t,parseFloat(this._header.TransformMatrix[1])*r,parseFloat(this._header.TransformMatrix[2]));n.normalize();let a=new i.Vector3(parseFloat(this._header.TransformMatrix[3])*t,parseFloat(this._header.TransformMatrix[4])*r,parseFloat(this._header.TransformMatrix[5]));return a.normalize(),[n.x,n.y,n.z,a.x,a.y,a.z]}imagePosition(e=0){return[parseFloat(this._header.Offset[0]),parseFloat(this._header.Offset[1]),parseFloat(this._header.Offset[2])]}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this._buffer,r=this.numberOfChannels(),n=this.rows(e)*this.columns(e)*r;this.rightHanded()||(e=this.numberOfFrames()-1-e);let i=e*n;return"MET_CHAR"===this._header.ElementType?new Int8Array(t,i,n):"MET_UCHAR"===this._header.ElementType?new Uint8Array(t,i,n):"MET_SHORT"===this._header.ElementType?(i*=2,new Int16Array(t,i,n)):"MET_USHORT"===this._header.ElementType?(i*=2,new Uint16Array(t,i,n)):"MET_INT"===this._header.ElementType?(i*=4,new Int32Array(t,i,n)):"MET_UINT"===this._header.ElementType?(i*=4,new Uint32Array(t,i,n)):"MET_FLOAT"===this._header.ElementType?(i*=4,new Float32Array(t,i,n)):void 0}}var ie=r(19),ae=r.n(ie);class oe extends Z{constructor(e,t){if(super(),this._id=t,this._arrayBuffer=e.buffer,this._url=e.url,this._dataSet=null,this._niftiHeader=null,this._niftiImage=null,this._ordered=!0,this._orderedData=null,this._qfac=1,!ae.a.isNIFTI(this._arrayBuffer)){throw new Error("parsers.nifti could not parse the file")}this._dataSet=ae.a.readHeader(this._arrayBuffer),this._niftiImage=ae.a.readImage(this._dataSet,this._arrayBuffer)}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.dims[3]}numberOfChannels(){let e=1;return this._dataSet.dims[0]>=5?(e=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?e=3:2304===this._dataSet.datatypeCode&&(e=4),e}sopInstanceUID(e=0){return e}rows(e=0){return this._dataSet.dims[2]}columns(e=0){return this._dataSet.dims[1]}pixelType(e=0){let t=0;return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(t=1),t}bitsAllocated(e=0){return this._dataSet.numBitsPerVoxel}pixelSpacing(e=0){return[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]}sliceThickness(){return null}imageOrientation(e=0){if(this._dataSet.qform_code>0){let e=0,t=this._dataSet.quatern_b,r=this._dataSet.quatern_c,n=this._dataSet.quatern_d;return e=1-(t*t+r*r+n*n),e<1e-7?(e=1/Math.sqrt(t*t+r*r+n*n),t*=e,r*=e,n*=e,e=0):e=Math.sqrt(e),this._dataSet.pixDims[0]<0&&(this._rightHanded=!1),[-(e*e+t*t-r*r-n*n),-2*(t*r+e*n),2*(t*n-e*r),-2*(t*r-e*n),-(e*e+r*r-t*t-n*n),2*(r*n+e*t)]}if(this._dataSet.sform_code>0){return[...[-this._dataSet.affine[0][0],-this._dataSet.affine[0][1],this._dataSet.affine[0][2]],...[-this._dataSet.affine[1][0],-this._dataSet.affine[1][1],this._dataSet.affine[0][2]]]}return this._dataSet.qform_code,[1,0,0,0,1,0]}imagePosition(e=0){return[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]}dimensionIndexValues(e=0){return null}instanceNumber(e=0){return e}windowCenter(e=0){return null}windowWidth(e=0){return null}rescaleSlope(e=0){return this._dataSet.scl_slope}rescaleIntercept(e=0){return this._dataSet.scl_inter}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this.numberOfChannels(),r=this.rows(e)*this.columns(e)*t,n=e*r,i=this._niftiImage;if(this._ordered||null!==this._orderedData||this._reorderData(),null!==this._orderedData)return this._orderedData.slice(n,n+r);if(2===this._dataSet.datatypeCode)return new Uint8Array(i,n,r);if(256===this._dataSet.datatypeCode)return new Int8Array(i,n,r);if(512===this._dataSet.datatypeCode)return n*=2,new Uint16Array(i,n,r);if(4===this._dataSet.datatypeCode)return n*=2,new Int16Array(i,n,r);if(8===this._dataSet.datatypeCode)return n*=4,new Int32Array(i,n,r);if(16===this._dataSet.datatypeCode){n*=4;const e=new Float32Array(i,n,r);for(let t=0;t<e.length;t++)e[t]!==1/0&&e[t]!==-1/0||(e[t]=0);return e}window.console.warn("Unknown data type: datatypeCode : "+this._dataSet.datatypeCode)}_reorderData(){let e=this.numberOfChannels(),t=this.rows()*this.columns()*e,r=this._niftiImage,n=t*this.numberOfFrames(),i=null;this._orderedData=null,2===this._dataSet.datatypeCode?(i=new Uint8Array(r,0,n),this._orderedData=new Uint8Array(i.length)):256===this._dataSet.datatypeCode?(i=new Int8Array(r,0,n),this._orderedData=new Int8Array(i.length)):512===this._dataSet.datatypeCode?(i=new Uint16Array(r,0,n),this._orderedData=new Uint16Array(i.length)):4===this._dataSet.datatypeCode?(i=new Int16Array(r,0,n),this._orderedData=new Int16Array(i.length)):16===this._dataSet.datatypeCode&&(i=new Float32Array(r,0,n),this._orderedData=new Float32Array(i.length));let a=i.length/3,o=0,s=0,l=a,u=2*a;for(let e=0;e<a;e++)this._orderedData[o++]=i[s++],this._orderedData[o++]=i[l++],this._orderedData[o++]=i[u++];this._ordered=!0}}let se=r(26),le=r(219);class ue extends Z{constructor(e,t){super(),this._id=t,this._arrayBuffer=e.buffer,this._url=e.url,this._dataSet=null,this._unpackedData=null;try{this._dataSet=le.parse(this._arrayBuffer)}catch(e){window.console.log("ooops... :(")}}rightHanded(){return this._dataSet.space&&(this._dataSet.space.match(/^right-anterior-superior/)||this._dataSet.space.match(/^left-posterior-superior/)?this._rightHanded=!0:this._rightHanded=!1),this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.sizes[2]}numberOfChannels(){return 1}sopInstanceUID(e=0){return e}rows(e=0){return this._dataSet.sizes[1]}columns(e=0){return this._dataSet.sizes[0]}pixelType(e=0){let t=0;return"float"===this._dataSet.type&&(t=1),t}bitsAllocated(e=0){let t=1;return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?t=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?t=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(t=32),t}pixelSpacing(e=0){if(this._dataSet.spaceDirections){const e=new i.Vector3(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2]),t=new i.Vector3(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),r=new i.Vector3(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[e.length(),t.length(),r.length()]}return[1,1,1]}imageOrientation(e=0){if(this._dataSet.space){let e=this._dataSet.space.match(/right/)?-1:1,t=this._dataSet.space.match(/anterior/)?-1:1,r=new i.Vector3(this._dataSet.spaceDirections[0][0]*e,this._dataSet.spaceDirections[0][1]*t,this._dataSet.spaceDirections[0][2]);r.normalize();let n=new i.Vector3(this._dataSet.spaceDirections[1][0]*e,this._dataSet.spaceDirections[1][1]*t,this._dataSet.spaceDirections[1][2]);return n.normalize(),[r.x,r.y,r.z,n.x,n.y,n.z]}return[1,0,0,0,1,0]}imagePosition(e=0){return this._dataSet.spaceOrigin?[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]:[0,0,0]}extractPixelData(e=0){return this._decompressUncompressed(e)}_decompressUncompressed(e=0){let t=this._dataSet.buffer;const r=this.numberOfChannels(),n=this.rows(e)*this.columns(e)*r;this.rightHanded()||(e=this.numberOfFrames()-1-e);let i=e*n;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){let e=se.inflate(this._dataSet.buffer);this._unpackedData=e.buffer,t=this._unpackedData}else"gzip"===this._dataSet.encoding&&(t=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?new Int8Array(t,i,n):"uint8"===this._dataSet.type?new Uint8Array(t,i,n):"int16"===this._dataSet.type||"short"===this._dataSet.type?(i*=2,new Int16Array(t,i,n)):"uint16"===this._dataSet.type?(i*=2,new Uint16Array(t,i,n)):"int32"===this._dataSet.type?(i*=4,new Int32Array(t,i,n)):"uint32"===this._dataSet.type?(i*=4,new Uint32Array(t,i,n)):"float"===this._dataSet.type?(i*=4,new Float32Array(t,i,n)):void 0}}class ce extends Z{constructor(e,t){if(super(),this._id=t,this._url=e.url,this._buffer=null,this._bufferPos=0,this._dataPos=0,this._pixelData=null,this._version=1,this._width=0,this._height=0,this._depth=0,this._nframes=0,this._type=ce.MRI_UCHAR,this._dof=0,this._goodRASFlag=0,this._spacingXYZ=[1,1,1],this._Xras=[-1,0,0],this._Yras=[0,0,-1],this._Zras=[0,1,0],this._Cras=[0,0,0],this._tr=0,this._flipAngle=0,this._te=0,this._ti=0,this._fov=0,this._tags=[],this._origin=[0,0,0],this._imageOrient=[0,0,0,0,0,0],this._buffer=e.buffer,this._version=this._readInt(),this._swapEndian=!1,1==this._version);else{if(16777216!=this._version){throw new Error("MGH/MGZ parser: Unknown Endian.  Version reports: "+this._version)}this._swapEndian=!0,this._version=this._swap32(this._version)}this._width=this._readInt(),this._height=this._readInt(),this._depth=this._readInt(),this._nframes=this._readInt(),this._type=this._readInt(),this._dof=this._readInt(),this._goodRASFlag=this._readShort(),this._spacingXYZ=this._readFloat(3),this._Xras=this._readFloat(3),this._Yras=this._readFloat(3),this._Zras=this._readFloat(3),this._Cras=this._readFloat(3),this._bufferPos=284;let r=this._width*this._height*this._depth*this._nframes;this._width,this._height,this._depth;switch(this._type){case ce.MRI_UCHAR:this._pixelData=this._readUChar(r);break;case ce.MRI_INT:this._pixelData=this._readInt(r);break;case ce.MRI_FLOAT:this._pixelData=this._readFloat(r);break;case ce.MRI_SHORT:this._pixelData=this._readShort(r);break;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}this._tr=this._readFloat(1),this._flipAngle=this._readFloat(1),this._te=this._readFloat(1),this._ti=this._readFloat(1),this._fov=this._readFloat(1);let n=new TextDecoder,a=this._tagReadStart();for(;null!=a[0];){let e=a[0],t=a[1],r=void 0;switch(e){case ce.TAG_OLD_MGH_XFORM:case ce.TAG_MGH_XFORM:r=this._readChar(t);break;default:r=this._readChar(t)}r=n.decode(r),this._tags.push({tagType:e,tagValue:r}),a=this._tagReadStart()}const o=(new i.Vector3).fromArray(this._Xras),s=(new i.Vector3).fromArray(this._Yras),l=(new i.Vector3).crossVectors(o,s),u=(new i.Vector3).fromArray(this._Zras);l.angleTo(u)>Math.PI/2&&(this._rightHanded=!1),this._imageOrient=[-this._Xras[0],-this._Xras[1],this._Xras[2],-this._Yras[0],-this._Yras[1],this._Yras[2]];let c=this._width/2,h=this._height/2,d=this._depth/2;for(let e=0;e<3;++e)this._origin[e]=this._Cras[e]-(this._Xras[e]*this._spacingXYZ[0]*c+this._Yras[e]*this._spacingXYZ[1]*h+this._Zras[e]*this._spacingXYZ[2]*d);this._origin=[-this._origin[0],-this._origin[1],this._origin[2]]}seriesInstanceUID(){return this._url}numberOfFrames(){return this._depth}sopInstanceUID(e=0){return e}rows(e=0){return this._width}columns(e=0){return this._height}pixelType(e=0){switch(this._type){case ce.MRI_UCHAR:case ce.MRI_INT:case ce.MRI_SHORT:return 0;case ce.MRI_FLOAT:return 1;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}bitsAllocated(e=0){switch(this._type){case ce.MRI_UCHAR:return 8;case ce.MRI_SHORT:return 16;case ce.MRI_INT:case ce.MRI_FLOAT:return 32;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}pixelSpacing(e=0){return this._spacingXYZ}imageOrientation(e=0){return this._imageOrient}imagePosition(e=0){return this._origin}extractPixelData(e=0){let t=this._width*this._height;return this._pixelData.slice(e*t,(e+1)*t)}_readInt(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*e));this._bufferPos+=4*e;let r=void 0;if(1==e)r=t.getInt32(0,this._swapEndian);else{r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.getInt32(4*n,this._swapEndian)}return r}_readShort(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+2*e));this._bufferPos+=2*e;let r=void 0;if(1==e)r=t.getInt16(0,this._swapEndian);else{r=new Int16Array(e);for(let n=0;n<e;n++)r[n]=t.getInt16(2*n,this._swapEndian)}return r}_readLong(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+8*e));this._bufferPos+=8*e;let r=new Uint16Array(e);for(let n=0;n<e;n++){let e=0,i=0;this._swapendian?e=4:i=4;let a=t.getInt32(8*n+e,this._swapEndian),o=t.getInt32(8*n+i,this._swapEndian);0!=a&&(console.log("Unable to read Int64 with high word: "+a+"low word: "+o),o=void 0),r[n]=o}return 0==e?void 0:1==e?r[0]:r}_readChar(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+e));this._bufferPos+=e;let r=void 0;if(1==e)r=t.getInt8(0,this._swapEndian);else{r=new Int8Array(e);for(let n=0;n<e;n++)r[n]=t.getInt8(n,this._swapEndian)}return r}_readUChar(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+e));this._bufferPos+=e;let r=void 0;if(1==e)r=t.getUint8(0,this._swapEndian);else{r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=t.getUint8(n,this._swapEndian)}return r}_readFloat(e=1){let t=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*e));this._bufferPos+=4*e;let r=void 0;if(1==e)r=t.getFloat32(0,this._swapEndian);else{r=new Float32Array(e);for(let n=0;n<e;n++)r[n]=t.getFloat32(4*n,this._swapEndian)}return r}_tagReadStart(){if(this._bufferPos>=this._buffer.byteLength)return[void 0,void 0];let e=this._readInt(),t=void 0;switch(e){case ce.TAG_OLD_MGH_XFORM:t=this._readInt(),t-=1;break;case ce.TAG_OLD_SURF_GEOM:case ce.TAG_OLD_USEREALRAS:case ce.TAG_OLD_COLORTABLE:t=0;break;default:t=this._readLong()}return null==t&&(e=void 0),[e,t]}}ce.MRI_UCHAR=0,ce.MRI_INT=1,ce.MRI_LONG=2,ce.MRI_FLOAT=3,ce.MRI_SHORT=4,ce.MRI_BITMAP=5,ce.MRI_TENSOR=6,ce.MRI_FLOAT_COMPLEX=7,ce.MRI_DOUBLE_COMPLEX=8,ce.MRI_RGB=9,ce.TAG_OLD_COLORTABLE=1,ce.TAG_OLD_USEREALRAS=2,ce.TAG_CMDLINE=3,ce.TAG_USEREALRAS=4,ce.TAG_COLORTABLE=5,ce.TAG_GCAMORPH_GEOM=10,ce.TAG_GCAMORPH_TYPE=11,ce.TAG_GCAMORPH_LABELS=12,ce.TAG_OLD_SURF_GEOM=20,ce.TAG_SURF_GEOM=21,ce.TAG_OLD_MGH_XFORM=30,ce.TAG_MGH_XFORM=31,ce.TAG_GROUP_AVG_SURFACE_AREA=32,ce.TAG_AUTO_ALIGN=33,ce.TAG_SCALAR_DOUBLE=40,ce.TAG_PEDIR=41,ce.TAG_MRI_FRAME=42,ce.TAG_FIELDSTRENGTH=43;const he=r(26);var de={};de.MedicalLoader=class extends H{parse(e){return this.emit("parse-start",{file:e.url,time:new Date}),new Promise((t,r)=>{setTimeout(()=>{t(new Promise((t,r)=>{let n=e;if(Array.isArray(n)||(n=[n]),n.forEach(e=>{this._preprocess(e)}),1===n.length)n=n[0];else{let e=n.filter(this._filterByExtension.bind(null,"MHD")),t=n.filter(this._filterByExtension.bind(null,"RAW"));2===n.length&&1===e.length&&1===t.length&&(n.url=e[0].url,n.extension=e[0].extension,n.mhdBuffer=e[0].buffer,n.rawBuffer=t[0].buffer)}let i=this._parser(n.extension);i||(this.emit("parse-error",{file:e.url,time:new Date,error:n.filename+"can not be parsed."}),r(n.filename+" can not be parsed."));let a=null;try{a=new i(n,0)}catch(t){console.warn(t),this.emit("parse-error",{file:e.url,time:new Date,error:t}),r(t)}let o=new D;o.rawHeader=a.rawHeader(),o.seriesInstanceUID=a.seriesInstanceUID(),o.transferSyntaxUID=a.transferSyntaxUID(),o.seriesDate=a.seriesDate(),o.seriesDescription=a.seriesDescription(),o.studyDate=a.studyDate(),o.studyDescription=a.studyDescription(),o.numberOfFrames=a.numberOfFrames(),o.numberOfFrames||(o.numberOfFrames=1),o.numberOfChannels=a.numberOfChannels(),o.modality=a.modality(),"SEG"===o.modality&&(o.segmentationType=a.segmentationType(),o.segmentationSegments=a.segmentationSegments()),o.patientID=a.patientID(),o.patientName=a.patientName(),o.patientAge=a.patientAge(),o.patientBirthdate=a.patientBirthdate(),o.patientSex=a.patientSex();let s=new X;s.numberOfChannels=a.numberOfChannels(),s.pixelRepresentation=a.pixelRepresentation(),s.pixelType=a.pixelType(),s.invert=a.invert(),s.spacingBetweenSlices=a.spacingBetweenSlices(),s.modality=o.modality,"SEG"===s.modality&&(s.segmentationType=o.segmentationType,s.segmentationSegments=o.segmentationSegments),o.stack.push(s),setTimeout(this.parseFrameClosure(o,s,e.url,0,a,t,r),0)}))},10)})}parseFrameClosure(e,t,r,n,i,a,o){return()=>{this.parseFrame(e,t,r,n,i,a,o)}}parseFrame(e,t,r,n,i,a,o){let s=new q;s.sopInstanceUID=i.sopInstanceUID(n),s.url=r,s.index=n,s.invert=t.invert,s.frameTime=i.frameTime(n),s.ultrasoundRegions=i.ultrasoundRegions(n),s.rows=i.rows(n),s.columns=i.columns(n),s.numberOfChannels=t.numberOfChannels,s.pixelPaddingValue=i.pixelPaddingValue(n),s.pixelRepresentation=t.pixelRepresentation,s.pixelType=t.pixelType,s.pixelData=i.extractPixelData(n),s.pixelSpacing=i.pixelSpacing(n),s.spacingBetweenSlices=i.spacingBetweenSlices(n),s.sliceThickness=i.sliceThickness(n),s.imageOrientation=i.imageOrientation(n),s.rightHanded=i.rightHanded(),t.rightHanded=s.rightHanded,null===s.imageOrientation&&(s.imageOrientation=[1,0,0,0,1,0]),s.imagePosition=i.imagePosition(n),s.dimensionIndexValues=i.dimensionIndexValues(n),s.bitsAllocated=i.bitsAllocated(n),s.instanceNumber=i.instanceNumber(n),s.windowCenter=i.windowCenter(n),s.windowWidth=i.windowWidth(n),s.rescaleSlope=i.rescaleSlope(n),s.rescaleIntercept=i.rescaleIntercept(n),s.minMax=i.minMaxPixelData(s.pixelData),"SEG"===e.modality&&(s.referencedSegmentNumber=i.referencedSegmentNumber(n)),t.frame.push(s),this._parsed=n+1,this._totalParsed=e.numberOfFrames,this.emit("parsing",{file:r,total:this._totalParsed,parsed:this._parsed,time:new Date}),this._parsed===this._totalParsed?(this.emit("parse-success",{file:r,total:this._totalParsed,parsed:this._parsed,time:new Date}),a(e)):setTimeout(this.parseFrameClosure(e,t,r,this._parsed,i,a,o),0)}_parser(e){let t=null;switch(e.toUpperCase()){case"NII":case"NII_":t=oe;break;case"DCM":case"DIC":case"DICOM":case"IMA":case"":t=re;break;case"MHD":t=ne;break;case"NRRD":t=ue;break;case"MGH":case"MGZ":t=ce;break;default:return console.warn("unsupported extension: "+e),!1}return t}_parseUrl(e){const t=new URL(e,"http://fix.me"),r={filename:t.searchParams.get("filename"),extension:"",pathname:t.pathname,query:t.search};r.filename||(r.filename=r.pathname.split("/").pop());const n=r.filename.split(".");r.extension=n.length>1?n.pop():"dicom";return(!isNaN(r.extension)||-1!==["asp","aspx","go","gs","hs","jsp","js","php","pl","py","rb","htm","html"].indexOf(r.extension)||r.query&&r.query.includes("contentType=application%2Fdicom"))&&(r.extension="dicom"),r}_preprocess(e){const t=this._parseUrl(e.url);if(e.filename=t.filename,e.extension=t.extension,e.pathname=t.pathname,e.query=t.query,"gz"===e.extension?(e.gzcompressed=!0,e.extension=e.filename.split(".gz").shift().split(".").pop()):"mgz"===e.extension?(e.gzcompressed=!0,e.extension="mgh"):"zraw"===e.extension?(e.gzcompressed=!0,e.extension="raw"):e.gzcompressed=!1,e.gzcompressed){let t=he.inflate(e.buffer);e.buffer=t.buffer}}_filterByExtension(e,t){return t.extension.toUpperCase()===e.toUpperCase()}},a.MedicalIntersects={aabbPlane:function(e,t){let r=[],n=new THREE.Matrix4;n.getInverse(e.toAABB);let i=t.direction.clone().applyMatrix4(e.toAABB),o=new THREE.Vector3(0,0,0).applyMatrix4(e.toAABB),s=this.posdir(t.position.clone().applyMatrix4(e.toAABB),new THREE.Vector3(i.x-o.x,i.y-o.y,i.z-o.z).normalize()),l=a.MedicalUtils.bbox(e.center,e.halfDimensions),u={x:new THREE.Vector3(1,0,0),y:new THREE.Vector3(0,1,0),z:new THREE.Vector3(0,0,1)},c=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.x);this.rayPlaneInBBox(c,s,l,r),c.direction=u.y,this.rayPlaneInBBox(c,s,l,r),c.direction=u.z,this.rayPlaneInBBox(c,s,l,r);let h=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z+e.halfDimensions.z),u.x);this.rayPlaneInBBox(h,s,l,r),h.direction=u.y,this.rayPlaneInBBox(h,s,l,r),h.direction=u.z,this.rayPlaneInBBox(h,s,l,r);let d=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.y);this.rayPlaneInBBox(d,s,l,r),d.direction=u.z,this.rayPlaneInBBox(d,s,l,r);let f=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.x);this.rayPlaneInBBox(f,s,l,r),f.direction=u.z,this.rayPlaneInBBox(f,s,l,r);let p=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z+e.halfDimensions.z),u.x);return this.rayPlaneInBBox(p,s,l,r),p.direction=u.y,this.rayPlaneInBBox(p,s,l,r),r.map((function(e){return e.applyMatrix4(n)})),r},rayPlane:function(e,t){if(0!==e.direction.dot(t.direction)){let r=(t.direction.x*(t.position.x-e.position.x)+t.direction.y*(t.position.y-e.position.y)+t.direction.z*(t.position.z-e.position.z))/(t.direction.x*e.direction.x+t.direction.y*e.direction.y+t.direction.z*e.direction.z);return new THREE.Vector3(e.position.x+r*e.direction.x,e.position.y+r*e.direction.y,e.position.z+r*e.direction.z)}return null},rayPlaneInBBox:function(e,t,r,n){let i=this.rayPlane(e,t);i&&this.inBBox(i,r)&&(n.find(this.findIntersection(i))||n.push(i))},findIntersection:function(e){return function(t,r,n){return e.x===t.x&&e.y===t.y&&e.z===t.z}},inBBox:function(e,t){return!!(e&&e.x>=t.min.x-1e-4&&e.y>=t.min.y-1e-4&&e.z>=t.min.z-1e-4&&e.x<=t.max.x+1e-4&&e.y<=t.max.y+1e-4&&e.z<=t.max.z+1e-4)},posdir:function(e,t){return{position:e,direction:t}}},a.MedicalUtils={raycaster:new THREE.Raycaster,box3:new THREE.Box3,minPos:new THREE.Vector3,maxPos:new THREE.Vector3,bbox:function(e,t){if(!(t.x>=0&&t.y>=0&&t.z>=0))return window.console.log("halfDimensions must be >= 0."),window.console.log(t),!1;return{min:e.clone().sub(t),max:e.clone().add(t)}},parseUrl:function(e){const t=new URL(e,"http://fix.me"),r={filename:t.searchParams.get("filename"),extension:"",pathname:t.pathname,query:t.search};r.filename||(r.filename=r.pathname.split("/").pop());const n=r.filename.split(".");r.extension=n.length>1?n.pop():"dicom";return(!isNaN(r.extension)||-1!==["asp","aspx","go","gs","hs","jsp","js","php","pl","py","rb","htm","html"].indexOf(r.extension)||r.query&&r.query.includes("contentType=application%2Fdicom"))&&(r.extension="dicom"),r},worldToData:function(e,t){let r=(new THREE.Vector3).copy(t).applyMatrix4(e);return r.addScalar(.5).floor(),r},getPixelData:function(e,t){return t.z>=0&&t.z<e._frame.length?e._frame[t.z].getPixelData(t.x,t.y):null},setPixelData:function(e,t,r){return t.z>=0&&t.z<e._frame.length&&e._frame[t.z].setPixelData(t.x,t.y,r),null},rescaleSlopeIntercept:function(e,t,r){return e*t+r},centerOfMass:function(e){let t=new THREE.Vector3(0,0,0);for(let r=0;r<e.length;r++)t.x+=e[r].x,t.y+=e[r].y,t.z+=e[r].z;return t.divideScalar(e.length),t},orderIntersections:function(e,t){let r,n,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=this.centerOfMass(e);a.subVectors(e[0],s).normalize(),o.crossVectors(a,t).normalize();let l=[];for(let t=0;t<e.length;t++){let u=e[t];i.subVectors(e[t],s),r=a.dot(i),n=o.dot(i),u.uv={u:r,v:n},u.angle=Math.atan2(n,r)*(180/Math.PI),l.push(u)}l.sort((function(e,t){return e.angle-t.angle}));let u=[l[0]];for(let e=1;e<l.length;e++)Math.abs(l[e-1].angle-l[e].angle)>1e-4&&u.push(l[e]);return u},getRoI:function(e,t,r){if(t.isCamera)return console.warn("warning: controls required instead of camera in getRoI()"),null;e.geometry.computeBoundingBox();const n=t.object,i=this.box3.setFromObject(e),a=this.minPos.copy(i.min).project(n),o=this.maxPos.copy(i.max).project(n),s=t.domElement.offsetWidth,l=t.domElement.offsetHeight,u=this.raycaster,c=[];a.x=Math.round((a.x+1)*s/2),a.y=Math.round((1-a.y)*l/2),o.x=Math.round((o.x+1)*s/2),o.y=Math.round((1-o.y)*l/2),[a.x,o.x]=[Math.min(a.x,o.x),Math.max(a.x,o.x)],[a.y,o.y]=[Math.min(a.y,o.y),Math.max(a.y,o.y)];let h=[],d=null,f={};for(let t=a.x;t<=o.x;t++)for(let i=a.y;i<=o.y;i++)f.x=t/s*2-1,f.y=-i/l*2+1,u.setFromCamera(f,n),h=u.intersectObject(e),0!==h.length&&(d=this.getPixelData(r,this.worldToData(r.lps2IJK,h[0].point)),null!==d&&1===r.numberOfChannels&&c.push(this.rescaleSlopeIntercept(d,r.rescaleSlope,r.rescaleIntercept)));if(0===c.length)return null;const p=c.reduce((e,t)=>e+t)/c.length;return{min:c.reduce((e,t)=>e<t?e:t),max:c.reduce((e,t)=>e>t?e:t),mean:p,sd:Math.sqrt(c.reduce((e,t)=>e+Math.pow(t-p,2),0)/c.length)}},getGeometryArea:function(e){let t=0,r=new THREE.Triangle;if(e.isGeometry){if(e.faces.length<1)return 0;let n=e.vertices;e.faces.forEach((function(e){t+=r.set(n[e.a],n[e.b],n[e.c]).getArea()}))}else if(e.isBufferGeometry){let h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;if(e.index){if(e.index.count<3)return 0;for(var n,i,a,o=e.attributes.position.array,s=e.index.array,l=0,u=e.index.count;l<u;l+=3)n=s[l+0],i=s[l+1],a=s[l+2],h.set(o[3*n],o[3*n+1],o[3*n+2]),d.set(o[3*i],o[3*i+1],o[3*i+2]),f.set(o[3*a],o[3*a+1],o[3*a+2]),t+=r.set(h,d,f).getArea()}else{if(e.attributes.position.count<3)return 0;o=e.attributes.position.array;var c=3*e.attributes.position.count;for(l=0;l<c;l+=9)h.set(o[l+0],o[l+1],o[l+2]),d.set(o[l+3],o[l+4],o[l+5]),f.set(o[l+6],o[l+7],o[l+8]),t+=r.set(h,d,f).getArea()}}return t},sliceGeometry:function(e,t,r,n,i,o){void 0===i&&(i=new THREE.Matrix4);let s={halfDimensions:e,center:t,toAABB:i},l={position:r,direction:n},u=a.MedicalIntersects.aabbPlane(s,l);u.length<3&&console.log("warning: sliceGeometry has less than 3 intersections between AABB and Plane...");let c=this.orderIntersections(u,n),h=new THREE.Shape,d=[];h.moveTo(c[0].uv.u,c[0].uv.v),d.push(c[0].x,c[0].y,c[0].z);for(let e=1;e<c.length;e++)h.lineTo(c[e].uv.u,c[e].uv.v),d.push(c[e].x,c[e].y,c[e].z);h.lineTo(c[0].uv.u,c[0].uv.v);let f=new THREE.ShapeBufferGeometry(h,c.length);switch(f.attributes.position.set(d,0),o){case 0:f.attributes.uv.set([1,0,0,0,0,1,1,1],0);break;case 1:f.attributes.uv.set([0,1,0,0,1,0,1,1],0);break;case 2:default:f.attributes.uv.set([1,0,0,0,0,1,1,1],0)}return f}},a.MedicalVoxel=function(){this.id=-1,this.worldCoordinates=null,this.dataCoordinates=null,this.screenCoordinates=null,this.value=null},a.SliceMesh=function(e,t,r,n,i){t=t||0,r=r||new THREE.Vector3(0,0,0),n=n||new THREE.Vector3(0,0,1),i=i||"IJK",THREE.Mesh.call(this),this.name="sliceMesh",this._stack=e,this._halfDimensions=null,this._spacing=1,this._thickness=0,this._thicknessMethod=0,this._opacity=1,this._invert=this._stack.invert,this._lut=!1,this._interpolation=1,this._windowWidth=null,this._windowCenter=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._lowerThreshold=null,this._upperThreshold=null,this._lutTexture=null,this._intensityAuto=!0,this._index=t,this._planePosition=r,this._planeDirection=n,this._center=new THREE.Vector3,this._aabbSpace=i,this._canvasWidth=0,this._canvasHeight=0,this._uniforms=null,this._init(),this._create()},a.SliceMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:a.SliceMesh,isSliceMesh:!0,_init(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aabbSpace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center.set(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new THREE.Matrix4;else{let e=this._stack.AABBox();this._halfDimensions=e.clone().multiplyScalar(.5),this._center.copy(this._stack.centerAABBox()),this._toAABB=this._stack.lps2AABB}},_create(){this._stack&&this._stack.prepared&&this._stack.packed&&(this._createGeometry(),this._createMaterial(),this.getIntensityFactors(),this.updateIntensityFactorsUniforms(),"IJK"===this._aabbSpace&&(this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1),this.matrixAutoUpdate=!0,this.applyMatrix4(this._stack.ijk2LPS)))},_createGeometry(){this.geometry=a.MedicalUtils.sliceGeometry(this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB,this.parent?this.parent.orientation:null);let e=this.parent;e&&e._updateSliceBorder()},_createMaterial(){this.material.isShaderMaterial||(this._uniforms=THREE.UniformsUtils.clone(a.MedicalSliceShader.uniforms),this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uSpacing.value=this._spacing,this._uniforms.uThickness.value=this._thickness,this._uniforms.uThicknessMethod.value=this._thicknessMethod,this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._stack._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._createShaderMaterial({side:THREE.DoubleSide,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}))},_createShaderMaterial(e){let t=a.MedicalSliceShader,r={},n=this._uniforms.uTextureContainer.value.length;if(r.MAX_TEX3D_IMAGES=n>7?14:7,1===this._uniforms.uNumberOfChannels.value){let e=this._uniforms.uBitsAllocated.value.toString(),t=this._uniforms.uPixelType.value.toString();e="1"===e||"8"===e?"BITS_ALLOCATED_8":"16"===e?"BITS_ALLOCATED_16":"32"===e&&"0"===t?"BITS_ALLOCATED_32":"32"===e&&"0"!==t?"BITS_ALLOCATED_32F":"BITS_ALLOCATED_IDENTITY",r[e]=""}let i={defines:r,uniforms:this._uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},o=Object.assign(e,i);this.material=new THREE.ShaderMaterial(o),this._uniforms=this.material.uniforms},getIntensityFactor(e){this["_"+e]=this._stack[e],this._intensityAuto&&this._stack.frame[this._index]&&this._stack.frame[this._index][e]&&(this["_"+e]=this._stack.frame[this._index][e])},getIntensityFactors(){this.getIntensityFactor("windowCenter"),this.getIntensityFactor("windowWidth"),this.getIntensityFactor("rescaleSlope"),this.getIntensityFactor("rescaleIntercept"),null===this._upperThreshold&&(this._upperThreshold=this._stack._minMax[1]),null===this._lowerThreshold&&(this._lowerThreshold=this._stack._minMax[0])},updateIntensityFactorsUniforms(){let e=Math.abs(this._stack._minMax[0]);this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[e+this._windowCenter,this._windowWidth],this._uniforms.uLowerUpperThreshold.value=[e+this._lowerThreshold,e+this._upperThreshold]},_update(){this.geometry.dispose(),this._create()},dispose(){var e;this.material.uniforms.uTextureContainer.value.forEach(e=>{e.dispose()}),(e=this.material.uniforms.uTextureLUT.value)&&(e.dispose(),this._lutTexture=null),(e=this.material.uniforms.uTextureLUTSegmentation.value)&&e.dispose(),this.geometry.dispose(),this.material.dispose(),this._uniforms=null,this._stack=null},cartesianEquation(){if(!this._geometry||!this._geometry.attributes||!this._geometry.attributes.position||this._geometry.attributes.position.count<3)return new THREE.Vector4;let e=this._geometry.attributes.position.array,t=this._stack.ijk2LPS,r=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3;r.fromArray(e,0).applyMatrix4(t),n.fromArray(e,3).applyMatrix4(t),i.fromArray(e,6).applyMatrix4(t);let s=a.subVectors(i,n).cross(o.subVectors(r,n)).normalize();return new THREE.Vector4(s.x,s.y,s.z,-s.dot(r))}}),Object.defineProperties(a.SliceMesh.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},spacing:{get:function(){return this._spacing},set:function(e){this._spacing=e,this._uniforms.uSpacing.value=this._spacing}},thickness:{get:function(){return this._thickness},set:function(e){this._thickness=e,this._uniforms.uThickness.value=this._thickness}},thicknessMethod:{get:function(){return this._thicknessMethod},set:function(e){this._thicknessMethod=e,this._uniforms.uThicknessMethod.value=this._thicknessMethod}},opacity:{get:function(){return this._opacity},set:function(e){this._opacity=e,this._uniforms.uOpacity.value=this._opacity}},invert:{get:function(){return this._invert},set:function(e){this._invert=e,this._uniforms.uInvert.value=!0===this._invert?1:0}},lut:{get:function(){return this._lut},set:function(e){this._lut=e,!1===this._lut?this._uniforms.uLut.value=0:this._uniforms.uLut.value=1}},lutTexture:{get:function(){return this._lutTexture},set:function(e){this._uniforms.uTextureLUT.value&&this._uniforms.uTextureLUT.value.dispose(),this._lutTexture=e,this._uniforms.uTextureLUT.value=this._lutTexture}},interpolation:{get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation}},windowWidth:{get:function(){return this._windowWidth},set:function(e){this._windowWidth=e,this.updateIntensityFactorsUniforms()}},windowCenter:{get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this.updateIntensityFactorsUniforms()}},rescaleSlope:{get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e,this.updateIntensityFactorsUniforms()}},rescaleIntercept:{get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e,this.updateIntensityFactorsUniforms()}},upperThreshold:{get:function(){return this._upperThreshold},set:function(e){this._upperThreshold=e,this.updateIntensityFactorsUniforms()}},lowerThreshold:{get:function(){return this._lowerThreshold},set:function(e){this._lowerThreshold=e,this.updateIntensityFactorsUniforms()}},intensityAuto:{get:function(){return this._intensityAuto},set:function(e){this._intensityAuto=e,this.getIntensityFactors(),this.updateIntensityFactorsUniforms()}},index:{get:function(){return this._index},set:function(e){this._index!==e&&(this._index=e,this._update())}},planePosition:{get:function(){return this._planePosition},set:function(e){this._planePosition.equals(e)||(this._planePosition.copy(e),this._update())}},planeDirection:{get:function(){return this._planeDirection},set:function(e){this._planeDirection.equals(e)||(this._planeDirection.copy(e),this._update())}},center:{get:function(){return this._center},set:function(e){this._center=e}},aabbSpace:{get:function(){return this._aabbSpace},set:function(e){this._aabbSpace=e,this._init()}},canvasWidth:{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._uniforms.uCanvasWidth.value=this._canvasWidth}},canvasHeight:{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._uniforms.uCanvasHeight.value=this._canvasHeight}}}),a.MedicalSlicer=function(e){THREE.Object3D.call(this),this.name="medicalSlicer",this._stack=e,this._bBox=null,this._slice=null,this._border=null,this._orientation=2,this._index=0,this._autoWindowLevel=!1,this._outOfBounds=!1,this._orientationMaxIndex=0,this._orientationSpacing=0,this._canvasWidth=0,this._canvasHeight=0,this._create()},a.MedicalSlicer.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:a.MedicalSlicer,isMedicalSlicer:!0,_create(){this._prepareStack(),this._createStackBBox(),this._createSliceMesh(),this._createSliceBorder(),this._computeOrientationMaxIndex(),this._computeOrientationSpacing()},_computeOrientationSpacing(){let e=this._stack._spacing;switch(this._orientation){case 0:this._orientationSpacing=e.y;break;case 1:this._orientationSpacing=e.x;break;case 2:this._orientationSpacing=e.z;break;default:this._orientationSpacing=0}},_computeOrientationMaxIndex(){let e=this._stack.dimensionsIJK;switch(this._orientation){case 0:this._orientationMaxIndex=e.x-1;break;case 1:this._orientationMaxIndex=e.y-1;break;case 2:this._orientationMaxIndex=e.z-1;break;default:this._orientationMaxIndex=0}},_computeIndexOutOfBounds(){this._computeOrientationMaxIndex(),this._outOfBounds=this._index>=this._orientationMaxIndex||this._index<0},_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()},_createStackBBox(){this._bBox=function(e,t){var r=e.dimensionsIJK,n=e.halfDimensionsIJK,i=new THREE.Vector3(-.5,-.5,-.5),a=new THREE.BoxBufferGeometry(r.x,r.y,r.z);a.applyMatrix4((new THREE.Matrix4).makeTranslation(n.x+i.x,n.y+i.y,n.z+i.z));var o=new THREE.Mesh(a,null);o.applyMatrix4(e.ijk2LPS);var s=new THREE.BoxHelper(o,t||16777215);return s.update=function(e){void 0===e&&THREE.BoxHelper.prototype.update.call(this)},s}(this._stack),this.add(this._bBox)},_createSliceMesh(){this._index=this._getSliceIndex(.5);let e=this._getSlicePosition(),t=this._getSliceDirection();this._slice=new a.SliceMesh(this._stack,this._index,e,t),this.add(this._slice)},_getStackVoxels(){let e=this._stack._textures[0].image.data,t=this._stack.dimensionsIJK;return{data:e,width:t.x,height:t.y,depth:t.z,components:this._stack.bitsAllocated*this._stack.numberOfChannels/8}},_getSliceIndices(){let e,t,r=this._getStackVoxels(),n=r.components,i=r.width,a=r.height,o=r.depth,s=0,l=i,u=0,c=a,h=0,d=o;switch(this._orientation){case 0:s=this._slice.index,l=s+1,e=a,t=o;break;case 1:u=this._slice.index,c=u+1,e=o,t=i;break;case 2:h=this._slice.index,d=h+1,e=i,t=a}let f=i*a,p=[];if(1===n)for(let e=h;e<d;e++){let t=f*e;for(let e=u;e<c;e++){let r=t+i*e;for(let e=s;e<l;e++){let t=r+e;p.push(t)}}}else for(let e=h;e<d;e++){let t=f*e;for(let e=u;e<c;e++){let r=t+i*e;for(let e=s;e<l;e++){let t=(r+e)*n;for(let e=0;e<n;e++)p.push(t+e)}}}return{data:p,width:e,height:t,components:n}},_getSlicePixels(){let e=this._getStackVoxels(),t=this._getSliceIndices(),r=e.data,n=t.data,i=[];for(let e=0,t=n.length;e<t;e++)i.push(r[n[e]]);return{data:i,width:t.width,height:t.height,components:t.components}},_createSliceTexture(){let e,t=this._getSlicePixels();switch(t.components){case 1:e=THREE.LuminanceFormat;break;case 2:e=THREE.LuminanceAlphaFormat;break;case 3:e=THREE.RGBFormat;break;case 4:e=THREE.RGBAFormat}let r=new THREE.DataTexture(new Uint8Array(t.data),t.width,t.height,e,THREE.UnsignedByteType);return r.needsUpdate=!0,r},_createSliceBorder(){var e,t,r,n;this._border=(e=this._slice,r=new THREE.LineBasicMaterial({color:t||16711680,linewidth:1}),n=new THREE.Line(e.geometry,r),"IJK"===e.aabbSpace&&n.applyMatrix4(e.stack.ijk2LPS),n),this.add(this._border)},_updateSliceBorder(){if("IJK"===this._slice.aabbSpace){let e=this._border;e.geometry=this._slice.geometry,e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.matrixAutoUpdate=!0,e.applyMatrix4(this._slice.stack.ijk2LPS)}},dispose(){var e=this._bBox,t=this._border,r=this._slice;this.remove(e),this.remove(t),this.remove(r),e.geometry.dispose(),e.material.dispose(),e.object.geometry.dispose(),e.object.material=null,t.material.dispose(),t.geometry=null,r.dispose(),this._bBox=null,this._border=null,this._slice=null,this._stack=null},_getSliceIndex(e){e=void 0!==e?e:.5;let t=this._stack.dimensionsIJK,r=0;switch(this._orientation){case 0:r=Math.floor(t.x*e);break;case 1:r=Math.floor(t.y*e);break;case 2:r=Math.floor(t.z*e)}return r},_getSlicePosition(){let e=this._stack.halfDimensionsIJK,t=new THREE.Vector3(0,0,0);switch(this._orientation){case 0:t.set(this._index,Math.floor(e.y),Math.floor(e.z));break;case 1:t.set(Math.floor(e.x),this._index,Math.floor(e.z));break;case 2:t.set(Math.floor(e.x),Math.floor(e.y),this._index)}return t},_getSliceDirection(){let e=new THREE.Vector3(0,0,1);switch(this._orientation){case 0:e.set(1,0,0);break;case 1:e.set(0,1,0);break;case 2:e.set(0,0,1)}return e}}),Object.defineProperties(a.MedicalSlicer.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},bbox:{get:function(){return this._bBox}},slice:{get:function(){return this._slice}},border:{get:function(){return this._border}},index:{get:function(){return this._index},set:function(e){this._index!==e&&(this._index=e,this._slice._index=e,this._slice.planePosition=this._getSlicePosition(),this._computeIndexOutOfBounds())}},orientation:{get:function(){return this._orientation},set:function(e){this._orientation!==e&&(this._orientation=e,this._index=this._getSliceIndex(.5),this._computeOrientationMaxIndex(),this._computeOrientationSpacing(),this._slice.spacing=Math.abs(this._orientationSpacing),this._slice.thickness=this._slice.spacing,this._slice.planeDirection=this._getSliceDirection())}},outOfBounds:{get:function(){return this._outOfBounds},set:function(e){this._outOfBounds=e}},orientationMaxIndex:{get:function(){return this._orientationMaxIndex},set:function(e){this._orientationMaxIndex=e}},orientationSpacing:{get:function(){return this._orientationSpacing},set:function(e){this._orientationSpacing=e}},canvasWidth:{get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._slice.canvasWidth=this._canvasWidth}},canvasHeight:{get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._slice.canvasHeight=this._canvasHeight}},bboxColor:{get:function(){return this._bBox.material.color},set:function(e){this._bBox.material.color=new THREE.Color(e)}},borderColor:{get:function(){return this._border.material.color},set:function(e){this._border.material.color=new THREE.Color(e)}}}),a.MedicalVolume=function(e){THREE.Mesh.call(this),this.name="medicalVolume",this._stack=e,this._uniforms=null,this._algorithm=0,this._alphaCorrection=.5,this._interpolation=1,this._shading=1,this._shininess=10,this._steps=256,this._offset=0,this._windowCenter=0,this._windowWidth=1,this._create()},a.MedicalVolume.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:a.MedicalVolume,isMedicalVolume:!0,_create(){this._prepareStack(),this._createGeometry(),this._createMaterial()},_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack(),this._offset=Math.min(0,this._stack._minMax[0]),this._windowCenter=this._stack.windowCenter,this._windowWidth=.8*this._stack.windowWidth},_createGeometry(){let e=this._stack.worldBoundingBox(),t=this._stack.worldCenter();this.geometry=new THREE.BoxBufferGeometry(e[1]-e[0],e[3]-e[2],e[5]-e[4]).translate(t.x,t.y,t.z)},_createMaterial(){this.material.isShaderMaterial||(this._uniforms=THREE.UniformsUtils.clone(a.MedicalVolumeShader.uniforms),this._uniforms.uWorldBBox.value=this._stack.worldBoundingBox(),this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._stack._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uDataToWorld.value=(new THREE.Matrix4).getInverse(this._stack.lps2IJK),this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uWindowCenterWidth.value=[this._windowCenter-this._offset,this._windowWidth],this._uniforms.uRescaleSlopeIntercept.value=[this._stack.rescaleSlope,this._stack.rescaleIntercept],this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uAlphaCorrection.value=this._alphaCorrection,this._uniforms.uInterpolation.value=this._interpolation,this._uniforms.uShading.value=this._shading,this._uniforms.uShininess.value=this._shininess,this._uniforms.uSteps.value=this._steps,this._uniforms.uAlgorithm.value=this._algorithm,this._createShaderMaterial({side:THREE.BackSide,transparent:!0}))},_createShaderMaterial(e){let t=a.MedicalVolumeShader,r={};a.isWebGL1()&&(r.gl_FragDepth="gl_FragDepthEXT");let n=this._uniforms.uTextureContainer.value.length;if(r.MAX_TEX3D_IMAGES=n>7?14:7,1===this._uniforms.uNumberOfChannels.value){let e=this._uniforms.uBitsAllocated.value.toString(),t=this._uniforms.uPixelType.value.toString();e="1"===e||"8"===e?"BITS_ALLOCATED_8":"16"===e?"BITS_ALLOCATED_16":"32"===e&&"0"===t?"BITS_ALLOCATED_32":"32"===e&&"0"!==t?"BITS_ALLOCATED_32F":"BITS_ALLOCATED_IDENTITY",r[e]=""}let i={defines:r,uniforms:this._uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},o=Object.assign(e,i);this.material=new THREE.ShaderMaterial(o),this.material.extensions={fragDepth:!0},this._uniforms=this.material.uniforms},_update(){this.geometry.dispose(),this._create()},_getStackVoxels(){let e=this._stack._textures[0].image.data,t=this._stack.dimensionsIJK;return{data:e,width:t.x,height:t.y,depth:t.z,components:this._stack.bitsAllocated*this._stack.numberOfChannels/8}},_getVolumeVoxels(){let e=this._getStackVoxels(),t=e.components,r=e.width,n=e.height,i=e.depth,a=r*n*i*t,o=e.data,s=[];for(let e=0;e<a;e++)s.push(o[e]);return{data:s,width:r,height:n,depth:i,components:t}},dispose(){this.material.uniforms.uTextureContainer.value.forEach(e=>{e.dispose()});var e=this.material.uniforms.uTextureLUT.value;e&&(e.dispose(),this._lutTexture=null),this.geometry.dispose(),this.material.dispose(),this._uniforms=null,this._stack=null}}),Object.defineProperties(a.MedicalVolume.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},uniforms:{get:function(){return this._uniforms},set:function(e){this._uniforms=e}},windowWidth:{get:function(){return this._windowWidth},set:function(e){this._windowWidth=Math.max(1,e),this._uniforms.uWindowCenterWidth.value[1]=this._windowWidth}},windowCenter:{get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this._uniforms.uWindowCenterWidth.value[0]=this._windowCenter-this._offset}},rescaleSlope:{get:function(){return this._uniforms.uRescaleSlopeIntercept.value[0]},set:function(e){this._uniforms.uRescaleSlopeIntercept.value[0]=e}},rescaleIntercept:{get:function(){return this._uniforms.uRescaleSlopeIntercept.value[1]},set:function(e){this._uniforms.uRescaleSlopeIntercept.value[1]=e}},steps:{get:function(){return this._steps},set:function(e){this._steps=e,this._uniforms.uSteps.value=this._steps}},alphaCorrection:{get:function(){return this._alphaCorrection},set:function(e){this._alphaCorrection=e,this._uniforms.uAlphaCorrection.value=this._alphaCorrection}},interpolation:{get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation}},shading:{get:function(){return this._shading},set:function(e){this._shading=e,this._uniforms.uShading.value=this._shading}},shininess:{get:function(){return this._shininess},set:function(e){this._shininess=e,this._uniforms.uShininess.value=this._shininess}},algorithm:{get:function(){return this._algorithm},set:function(e){this._algorithm=e,this._uniforms.uAlgorithm.value=this._algorithm}},lut:{get:function(){return this._lut},set:function(e){this._uniforms.uLut.value=!1===e?0:1}},lutTexture:{get:function(){return this._uniforms.uTextureLUT.value},set:function(e){this._uniforms.uTextureLUT.value&&this._uniforms.uTextureLUT.value.dispose(),this._uniforms.uTextureLUT.value=e}}}),a.MedicalIsosurface=function(e,t,r,n,i){t=t||32,r=r||2,n=n||0,i=i||"IJK",THREE.Mesh.call(this),this.name="medicalIsosurface",this._stack=e,this._isoLevel=t,this._stride=r,this._smoothing=n,this._aabbSpace=i,this._create()},a.MedicalIsosurface.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:a.MedicalIsosurface,isMedicalIsosurface:!0,_create(){this._prepareStack(),this._createGeometry(),this._createMaterial(),"IJK"===this._aabbSpace&&(this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1),this.matrixAutoUpdate=!0,this.applyMatrix4(this._stack.ijk2LPS))},_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()},_createGeometry(){var e=this,t=this._isoLevel,r=this._stride,n=this._smoothing,i=this._stack.dimensionsIJK,o=i.x,s=i.y,l=i.z,u=1+~~((o-1)/r),c=1+~~((s-1)/r),h=1+~~((l-1)/r),d=(o-1)%r,f=(s-1)%r,p=(l-1)%r,m=this._stack.frame;if(0===n){for(var g=[],v=0;v<l;v+=r)for(var y=0;y<s;y+=r)for(var _=o*y,b=0;b<o;b+=r)g.push(m[v].pixelData[_+b]);var E=[u,c,h],w=[[0,0,0],[o-d,s-f,l-p]];this.geometry=new a.IsosurfaceGeometry(E,w,g,t)}else{a.createSpincircle(),a.showSpincircle(),setTimeout((function(){for(var i,g,v=S.pool,y=S.ndarray,_=S.ndarrayOps,b=(T=m[0].pixelData,M=void 0,M=null,T&&T.constructor&&(M=(M=T.constructor.name).replace("Clamped","").replace("Array","").toLowerCase()),M),E=v.malloc(o*s*l,b),w=y(E,[o,s,l],[1,o,o*s]),x=0;x<l;x++)i=w.lo(0,0,x).hi(o,s,1),g=y(m[x].pixelData,[o,s,1],[1,o,o*s]),_.assign(i,g);var T,M;var A=5*n,R=S.gaussBlur(w,A),k=[];for(x=0;x<l;x+=r)for(var P=0;P<s;P+=r)for(var L=0;L<o;L+=r)k.push(R.get(L,P,x));v.free(E);var C=[u,c,h],I=[[0,0,0],[o-d,s-f,l-p]];e.geometry=new a.IsosurfaceGeometry(C,I,k,t),a.hideSpincircle()}),500)}},_createMaterial(){if(!this.material.isMeshMatcapMaterial){a.appWorks.renderer.localClippingEnabled=!0;let t=this._stack.worldCenter(),r=this._stack.worldBoundingBox(),n=[(r[1]-r[0])/2,(r[3]-r[2])/2,(r[5]-r[4])/2],i=[new THREE.Plane(new THREE.Vector3(1,0,0),n[0]).translate(t),new THREE.Plane(new THREE.Vector3(-1,0,0),n[0]).translate(t),new THREE.Plane(new THREE.Vector3(0,1,0),n[1]).translate(t),new THREE.Plane(new THREE.Vector3(0,-1,0),n[1]).translate(t),new THREE.Plane(new THREE.Vector3(0,0,1),n[2]).translate(t),new THREE.Plane(new THREE.Vector3(0,0,-1),n[2]).translate(t)];var e=new THREE.TextureLoader;this.material=new THREE.MeshMatcapMaterial({color:16777215,matcap:e.load("images/matcaps2/00086.png"),side:THREE.DoubleSide,opacity:.8,transparent:!0,clippingPlanes:i,clipIntersection:!1})}},updateClippingPlane(e,t){(e>=0||e<6)&&(this.material.clippingPlanes[e].constant=t)},_update(){this.geometry.dispose(),this._create()},dispose(){this.geometry.dispose(),this.material.dispose(),this._stack=null}}),Object.defineProperties(a.MedicalIsosurface.prototype,{stack:{get:function(){return this._stack},set:function(e){this._stack=e}},isoLevel:{get:function(){return this._isoLevel},set:function(e){this._isoLevel!==e&&(this._isoLevel=e,this._update())}},stride:{get:function(){return this._stride},set:function(e){this._stride!==e&&(this._stride=e,this._update())}},smoothing:{get:function(){return this._smoothing},set:function(e){this._smoothing!==e&&(this._smoothing=e,this._update())}}}),a.LookupTable=function(e,t,r,n,i,o){THREE.Object3D.call(this),this.name="lookupTable",this._dom=void 0===e?document.createElement("div"):"string"==typeof e?document.getElementById(e):e,this._lut=t||"grayscale",this._color=n||[[0,0,0,0],[1,1,1,1]],this._lutO=r||"linear",this._opacity=i||[[0,0],[1,1]],this._discrete=o||!1,this._presetLuts=a.LookupTable.presetLuts(),this._presetLutsO=a.LookupTable.presetLutsO(),this._canvasBg=null,this._canvas=null,this.initCanvas(),this.paintCanvas()},a.LookupTable.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:a.LookupTable,isLookupTables:!0,initCanvas(){let e=document.createElement("div");e.style.cssText="position: relative; height: 16px; width: 256px; border: 1px solid #f9f9f9;",this._canvas=this.createCanvas(),this._canvas.style.cssText="position: absolute;",e.appendChild(this._canvas),this._dom.appendChild(e)},createCanvas(){let e=document.createElement("canvas");return e.width=256,e.height=16,e.style.width="256px",e.style.height="16px",e},paintCanvas(){let e=this._canvas.getContext("2d");if(e.clearRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="source-over",this._discrete){e.lineWidth=2*this._canvas.height;for(let t=0;t<this._color.length;t++){let r=this._color[t][0],n=t<this._color.length-1?this._color[t+1][0]:1,i=t>0?this._color[t-1][0]:0,a=i+(r-i)/2,o=r+(n-r)/2,s=this._color[t],l=this._opacity[t]?this._opacity[t][1]:1;e.beginPath(),e.strokeStyle=`rgba( ${Math.round(255*s[1])}, ${Math.round(255*s[2])}, ${Math.round(255*s[3])}, ${l})`,e.moveTo(a*this._canvas.width,0),e.lineTo(o*this._canvas.width,0),e.stroke(),e.closePath()}}else{if(!this._color||!this._opacity)return;let t=e.createLinearGradient(0,0,this._canvas.width,0);for(let e=0;e<this._color.length;e++)t.addColorStop(this._color[e][0],`rgba( ${Math.round(255*this._color[e][1])}, ${Math.round(255*this._color[e][2])}, ${Math.round(255*this._color[e][3])}, 1)`);e.fillStyle=t,e.fillRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="destination-in";let r=e.createLinearGradient(0,0,this._canvas.width,0);for(let e=0;e<this._opacity.length;e++)r.addColorStop(this._opacity[e][0],"rgba(255, 255, 255, "+this._opacity[e][1]+")");e.fillStyle=r,e.fillRect(0,0,this._canvas.width,this._canvas.height)}},lutsAvailable(e){let t="color"===(e=e||"color")?this._presetLuts:this._presetLutsO;return Object.keys(t)}}),Object.defineProperties(a.LookupTable.prototype,{texture:{get:function(){let e=new THREE.CanvasTexture(this._canvas);return e.mapping=THREE.UVMapping,e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=e.minFilter=THREE.NearestFilter,e.premultiplyAlpha=!0,e.needsUpdate=!0,e}},lut:{get:function(){return this._lut},set:function(e){this._lut!==e&&(this._lut=e,this._color=this._presetLuts[e],this.paintCanvas())}},presetLuts:{get:function(){return this._presetLuts},set:function(e){this._presetLuts=e}},lutO:{get:function(){return this._lutO},set:function(e){this._lutO!==e&&(this._lutO=e,this._opacity=this._presetLutsO[e],this.paintCanvas())}},presetLutsO:{get:function(){return this._presetLutsO},set:function(e){this._presetLutsO=e}},discrete:{get:function(){return this._discrete},set:function(e){this._discrete!==e&&(this._discrete=e,this.paintCanvas())}}}),a.LookupTable.presetLuts=function(){return{grayscale:[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]],red_to_green:[[0,1,0,0],[1,0,1,0]],blue_to_green:[[0,0,0,1],[1,0,1,0]],red_to_white:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]],green_to_white:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]],blue_to_white:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]],walking_dead:[[0,.1,1,1],[1,1,1,1]],random:[[0,0,0,0],[.27,.18,.18,.18],[.41,1,1,1],[.7,1,0,0],[1,1,1,1]],fire:[[0,0,0,0],[.06,0,0,.36],[.16,.29,0,.75],[.22,.48,0,.89],[.31,.68,0,.6],[.37,.76,0,.36],[.5,.94,.31,0],[.56,1,.45,0],[.81,1,.91,0],[.88,1,1,.38],[1,1,1,1]],muscle_bone:[[0,0,0,0],[.00392156862745098,.00784313725490196,0,0],[.00784313725490196,.0196078431372549,0,0],[.011764705882352941,.03137254901960784,0,0],[.01568627450980392,.0392156862745098,0,.00392156862745098],[.0196078431372549,.050980392156862744,.00392156862745098,.00392156862745098],[.023529411764705882,.06274509803921569,.00392156862745098,.00392156862745098],[.027450980392156862,.07058823529411765,.00392156862745098,.00784313725490196],[.03137254901960784,.08235294117647059,.00392156862745098,.00784313725490196],[.03529411764705882,.09411764705882353,.00784313725490196,.00784313725490196],[.0392156862745098,.10196078431372549,.00784313725490196,.00784313725490196],[.043137254901960784,.11372549019607843,.00784313725490196,.011764705882352941],[.047058823529411764,.12549019607843137,.00784313725490196,.011764705882352941],[.050980392156862744,.13333333333333333,.011764705882352941,.011764705882352941],[.054901960784313725,.1450980392156863,.011764705882352941,.01568627450980392],[.058823529411764705,.1568627450980392,.011764705882352941,.01568627450980392],[.06274509803921569,.16470588235294117,.011764705882352941,.01568627450980392],[.06666666666666667,.17647058823529413,.011764705882352941,.0196078431372549],[.07058823529411765,.18823529411764706,.01568627450980392,.0196078431372549],[.07450980392156863,.2,.01568627450980392,.0196078431372549],[.0784313725490196,.20784313725490197,.01568627450980392,.0196078431372549],[.08235294117647059,.2196078431372549,.01568627450980392,.023529411764705882],[.08627450980392157,.23137254901960785,.0196078431372549,.023529411764705882],[.09019607843137255,.23921568627450981,.0196078431372549,.023529411764705882],[.09411764705882353,.25098039215686274,.0196078431372549,.027450980392156862],[.09803921568627451,.2627450980392157,.0196078431372549,.027450980392156862],[.10196078431372549,.27058823529411763,.023529411764705882,.027450980392156862],[.10588235294117647,.2823529411764706,.023529411764705882,.027450980392156862],[.10980392156862745,.29411764705882354,.023529411764705882,.03137254901960784],[.11372549019607843,.30196078431372547,.023529411764705882,.03137254901960784],[.11764705882352941,.3137254901960784,.023529411764705882,.03137254901960784],[.12156862745098039,.3254901960784314,.027450980392156862,.03529411764705882],[.12549019607843137,.3333333333333333,.027450980392156862,.03529411764705882],[.12941176470588237,.34509803921568627,.027450980392156862,.03529411764705882],[.13333333333333333,.3568627450980392,.027450980392156862,.0392156862745098],[.13725490196078433,.36470588235294116,.03137254901960784,.0392156862745098],[.1411764705882353,.3764705882352941,.03137254901960784,.0392156862745098],[.1450980392156863,.38823529411764707,.03137254901960784,.0392156862745098],[.14901960784313725,.4,.03137254901960784,.043137254901960784],[.15294117647058825,.40784313725490196,.03529411764705882,.043137254901960784],[.1568627450980392,.4196078431372549,.03529411764705882,.043137254901960784],[.1607843137254902,.43137254901960786,.03529411764705882,.047058823529411764],[.16470588235294117,.4392156862745098,.03529411764705882,.047058823529411764],[.16862745098039217,.45098039215686275,.03529411764705882,.047058823529411764],[.17254901960784313,.4627450980392157,.0392156862745098,.047058823529411764],[.17647058823529413,.47058823529411764,.0392156862745098,.050980392156862744],[.1803921568627451,.4823529411764706,.0392156862745098,.050980392156862744],[.1843137254901961,.49411764705882355,.0392156862745098,.050980392156862744],[.18823529411764706,.5019607843137255,.043137254901960784,.054901960784313725],[.19215686274509805,.5137254901960784,.043137254901960784,.054901960784313725],[.19607843137254902,.5254901960784314,.043137254901960784,.054901960784313725],[.2,.5333333333333333,.043137254901960784,.058823529411764705],[.20392156862745098,.5450980392156862,.047058823529411764,.058823529411764705],[.20784313725490197,.5568627450980392,.047058823529411764,.058823529411764705],[.21176470588235294,.5647058823529412,.047058823529411764,.058823529411764705],[.21568627450980393,.5764705882352941,.047058823529411764,.06274509803921569],[.2196078431372549,.5882352941176471,.047058823529411764,.06274509803921569],[.2235294117647059,.6,.050980392156862744,.06274509803921569],[.22745098039215686,.6078431372549019,.050980392156862744,.06666666666666667],[.23137254901960785,.6196078431372549,.050980392156862744,.06666666666666667],[.23529411764705882,.6313725490196078,.050980392156862744,.06666666666666667],[.23921568627450981,.6392156862745098,.054901960784313725,.06666666666666667],[.24313725490196078,.6509803921568628,.054901960784313725,.07058823529411765],[.24705882352941178,.6627450980392157,.054901960784313725,.07058823529411765],[.25098039215686274,.6705882352941176,.054901960784313725,.07058823529411765],[.2549019607843137,.6823529411764706,.058823529411764705,.07450980392156863],[.25882352941176473,.6941176470588235,.058823529411764705,.07450980392156863],[.2627450980392157,.7019607843137254,.058823529411764705,.07450980392156863],[.26666666666666666,.7137254901960784,.058823529411764705,.0784313725490196],[.27058823529411763,.7254901960784313,.058823529411764705,.0784313725490196],[.27450980392156865,.7333333333333333,.06274509803921569,.0784313725490196],[.2784313725490196,.7450980392156863,.06274509803921569,.0784313725490196],[.2823529411764706,.7568627450980392,.06274509803921569,.08235294117647059],[.28627450980392155,.7647058823529411,.06274509803921569,.08235294117647059],[.2901960784313726,.7764705882352941,.06666666666666667,.08235294117647059],[.29411764705882354,.788235294117647,.06666666666666667,.08627450980392157],[.2980392156862745,.8,.06666666666666667,.08627450980392157],[.30196078431372547,.807843137254902,.06666666666666667,.08627450980392157],[.3058823529411765,.8196078431372549,.07058823529411765,.08627450980392157],[.30980392156862746,.8313725490196079,.07058823529411765,.09019607843137255],[.3137254901960784,.8392156862745098,.07058823529411765,.09019607843137255],[.3176470588235294,.8509803921568627,.07058823529411765,.09019607843137255],[.3215686274509804,.8627450980392157,.07058823529411765,.09411764705882353],[.3254901960784314,.8705882352941177,.07450980392156863,.09411764705882353],[.32941176470588235,.8823529411764706,.07450980392156863,.09411764705882353],[.3333333333333333,.8941176470588236,.07450980392156863,.09803921568627451],[.33725490196078434,.9019607843137255,.07450980392156863,.09803921568627451],[.3411764705882353,.9137254901960784,.0784313725490196,.09803921568627451],[.34509803921568627,.9254901960784314,.0784313725490196,.09803921568627451],[.34901960784313724,.9333333333333333,.0784313725490196,.10196078431372549],[.35294117647058826,.9450980392156862,.0784313725490196,.10196078431372549],[.3568627450980392,.9568627450980393,.08235294117647059,.10196078431372549],[.3607843137254902,.9647058823529412,.08235294117647059,.10588235294117647],[.36470588235294116,.9764705882352941,.08235294117647059,.10588235294117647],[.3686274509803922,.9882352941176471,.08235294117647059,.10588235294117647],[.37254901960784315,1,.08235294117647059,.10588235294117647],[.3764705882352941,1,.09411764705882353,.10588235294117647],[.3803921568627451,1,.10588235294117647,.10588235294117647],[.3843137254901961,1,.11764705882352941,.10196078431372549],[.38823529411764707,1,.12941176470588237,.10196078431372549],[.39215686274509803,1,.1411764705882353,.10196078431372549],[.396078431372549,1,.15294117647058825,.09803921568627451],[.4,1,.16470588235294117,.09803921568627451],[.403921568627451,1,.17647058823529413,.09803921568627451],[.40784313725490196,1,.18823529411764706,.09411764705882353],[.4117647058823529,1,.2,.09411764705882353],[.41568627450980394,1,.21176470588235294,.09411764705882353],[.4196078431372549,1,.2235294117647059,.09019607843137255],[.4235294117647059,1,.23529411764705882,.09019607843137255],[.42745098039215684,1,.24705882352941178,.08627450980392157],[.43137254901960786,1,.25882352941176473,.08627450980392157],[.43529411764705883,1,.27058823529411763,.08627450980392157],[.4392156862745098,1,.2823529411764706,.08235294117647059],[.44313725490196076,1,.29411764705882354,.08235294117647059],[.4470588235294118,1,.3058823529411765,.08235294117647059],[.45098039215686275,1,.3176470588235294,.0784313725490196],[.4549019607843137,1,.32941176470588235,.0784313725490196],[.4588235294117647,1,.3411764705882353,.0784313725490196],[.4627450980392157,1,.35294117647058826,.07450980392156863],[.4666666666666667,1,.36470588235294116,.07450980392156863],[.47058823529411764,1,.3764705882352941,.07450980392156863],[.4745098039215686,1,.38823529411764707,.07058823529411765],[.47843137254901963,1,.4,.07058823529411765],[.4823529411764706,1,.4117647058823529,.07058823529411765],[.48627450980392156,1,.4235294117647059,.06666666666666667],[.49019607843137253,1,.43529411764705883,.06666666666666667],[.49411764705882355,1,.4470588235294118,.06274509803921569],[.4980392156862745,1,.4588235294117647,.06274509803921569],[.5019607843137255,1,.47058823529411764,.06274509803921569],[.5058823529411764,1,.4823529411764706,.058823529411764705],[.5098039215686274,1,.49411764705882355,.058823529411764705],[.5137254901960784,1,.5058823529411764,.058823529411764705],[.5176470588235295,1,.5137254901960784,.054901960784313725],[.5215686274509804,1,.5254901960784314,.054901960784313725],[.5254901960784314,1,.5372549019607843,.054901960784313725],[.5294117647058824,1,.5490196078431373,.050980392156862744],[.5333333333333333,1,.5607843137254902,.050980392156862744],[.5372549019607843,1,.5725490196078431,.050980392156862744],[.5411764705882353,1,.5843137254901961,.047058823529411764],[.5450980392156862,1,.596078431372549,.047058823529411764],[.5490196078431373,1,.6078431372549019,.043137254901960784],[.5529411764705883,1,.6196078431372549,.043137254901960784],[.5568627450980392,1,.6313725490196078,.043137254901960784],[.5607843137254902,1,.6431372549019608,.0392156862745098],[.5647058823529412,1,.6549019607843137,.0392156862745098],[.5686274509803921,1,.6666666666666666,.0392156862745098],[.5725490196078431,1,.6784313725490196,.03529411764705882],[.5764705882352941,1,.6901960784313725,.03529411764705882],[.5803921568627451,1,.6941176470588235,.0392156862745098],[.5843137254901961,1,.7019607843137254,.0392156862745098],[.5882352941176471,1,.7058823529411765,.043137254901960784],[.592156862745098,1,.7098039215686275,.043137254901960784],[.596078431372549,1,.7137254901960784,.047058823529411764],[.6,1,.7176470588235294,.047058823529411764],[.6039215686274509,1,.7254901960784313,.050980392156862744],[.6078431372549019,1,.7294117647058823,.050980392156862744],[.611764705882353,1,.7333333333333333,.054901960784313725],[.615686274509804,1,.7372549019607844,.058823529411764705],[.6196078431372549,1,.7411764705882353,.058823529411764705],[.6235294117647059,1,.7490196078431373,.06274509803921569],[.6274509803921569,1,.7529411764705882,.06274509803921569],[.6313725490196078,1,.7568627450980392,.06666666666666667],[.6352941176470588,1,.7607843137254902,.06666666666666667],[.6392156862745098,1,.7647058823529411,.07058823529411765],[.6431372549019608,1,.7725490196078432,.07058823529411765],[.6470588235294118,1,.7764705882352941,.07450980392156863],[.6509803921568628,1,.7803921568627451,.07450980392156863],[.6549019607843137,1,.7843137254901961,.0784313725490196],[.6588235294117647,1,.788235294117647,.08235294117647059],[.6627450980392157,1,.796078431372549,.08235294117647059],[.6666666666666666,1,.8,.08627450980392157],[.6705882352941176,1,.803921568627451,.08627450980392157],[.6745098039215687,1,.807843137254902,.09019607843137255],[.6784313725490196,1,.8117647058823529,.09019607843137255],[.6823529411764706,1,.8196078431372549,.09411764705882353],[.6862745098039216,1,.8235294117647058,.09411764705882353],[.6901960784313725,1,.8274509803921568,.09803921568627451],[.6941176470588235,1,.8313725490196079,.10196078431372549],[.6980392156862745,1,.8352941176470589,.10196078431372549],[.7019607843137254,1,.8431372549019608,.10588235294117647],[.7058823529411765,1,.8470588235294118,.10588235294117647],[.7098039215686275,1,.8509803921568627,.10980392156862745],[.7137254901960784,1,.8549019607843137,.10980392156862745],[.7176470588235294,1,.8627450980392157,.11372549019607843],[.7215686274509804,1,.8666666666666667,.11372549019607843],[.7254901960784313,1,.8705882352941177,.11764705882352941],[.7294117647058823,1,.8745098039215686,.12156862745098039],[.7333333333333333,1,.8784313725490196,.12156862745098039],[.7372549019607844,1,.8862745098039215,.12549019607843137],[.7411764705882353,1,.8901960784313725,.12549019607843137],[.7450980392156863,1,.8941176470588236,.12941176470588237],[.7490196078431373,1,.8980392156862745,.12941176470588237],[.7529411764705882,1,.9019607843137255,.13333333333333333],[.7568627450980392,1,.9098039215686274,.13333333333333333],[.7607843137254902,1,.9137254901960784,.13725490196078433],[.7647058823529411,1,.9176470588235294,.1411764705882353],[.7686274509803922,1,.9215686274509803,.1411764705882353],[.7725490196078432,1,.9254901960784314,.1450980392156863],[.7764705882352941,1,.9333333333333333,.1450980392156863],[.7803921568627451,1,.9372549019607843,.14901960784313725],[.7843137254901961,1,.9411764705882353,.14901960784313725],[.788235294117647,1,.9450980392156862,.15294117647058825],[.792156862745098,1,.9450980392156862,.16862745098039217],[.796078431372549,1,.9490196078431372,.1843137254901961],[.8,1,.9490196078431372,.2],[.803921568627451,1,.9490196078431372,.21568627450980393],[.807843137254902,1,.9490196078431372,.22745098039215686],[.8117647058823529,1,.9529411764705882,.24313725490196078],[.8156862745098039,1,.9529411764705882,.25882352941176473],[.8196078431372549,1,.9529411764705882,.27450980392156865],[.8235294117647058,1,.9529411764705882,.2901960784313726],[.8274509803921568,1,.9568627450980393,.3058823529411765],[.8313725490196079,1,.9568627450980393,.3215686274509804],[.8352941176470589,1,.9568627450980393,.33725490196078434],[.8392156862745098,1,.9568627450980393,.35294117647058826],[.8431372549019608,1,.9607843137254902,.3686274509803922],[.8470588235294118,1,.9607843137254902,.3843137254901961],[.8509803921568627,1,.9607843137254902,.4],[.8549019607843137,1,.9607843137254902,.4117647058823529],[.8588235294117647,1,.9647058823529412,.42745098039215684],[.8627450980392157,1,.9647058823529412,.44313725490196076],[.8666666666666667,1,.9647058823529412,.4588235294117647],[.8705882352941177,1,.9647058823529412,.4745098039215686],[.8745098039215686,1,.9686274509803922,.49019607843137253],[.8784313725490196,1,.9686274509803922,.5058823529411764],[.8823529411764706,1,.9686274509803922,.5215686274509804],[.8862745098039215,1,.9686274509803922,.5372549019607843],[.8901960784313725,1,.9725490196078431,.5529411764705883],[.8941176470588236,1,.9725490196078431,.5686274509803921],[.8980392156862745,1,.9725490196078431,.5843137254901961],[.9019607843137255,1,.9725490196078431,.6],[.9058823529411765,1,.9725490196078431,.611764705882353],[.9098039215686274,1,.9764705882352941,.6274509803921569],[.9137254901960784,1,.9764705882352941,.6431372549019608],[.9176470588235294,1,.9764705882352941,.6588235294117647],[.9215686274509803,1,.9764705882352941,.6745098039215687],[.9254901960784314,1,.9803921568627451,.6901960784313725],[.9294117647058824,1,.9803921568627451,.7058823529411765],[.9333333333333333,1,.9803921568627451,.7215686274509804],[.9372549019607843,1,.9803921568627451,.7372549019607844],[.9411764705882353,1,.984313725490196,.7529411764705882],[.9450980392156862,1,.984313725490196,.7686274509803922],[.9490196078431372,1,.984313725490196,.7843137254901961],[.9529411764705882,1,.984313725490196,.8],[.9568627450980393,1,.9882352941176471,.8117647058823529],[.9607843137254902,1,.9882352941176471,.8274509803921568],[.9647058823529412,1,.9882352941176471,.8431372549019608],[.9686274509803922,1,.9882352941176471,.8588235294117647],[.9725490196078431,1,.9921568627450981,.8745098039215686],[.9764705882352941,1,.9921568627450981,.8901960784313725],[.9803921568627451,1,.9921568627450981,.9058823529411765],[.984313725490196,1,.9921568627450981,.9215686274509803],[.9882352941176471,1,.996078431372549,.9372549019607843],[.9921568627450981,1,.996078431372549,.9529411764705882],[.996078431372549,1,.996078431372549,.9686274509803922],[1,1,.996078431372549,.984313725490196]]}},a.LookupTable.presetLutsO=function(){return{linear:[[0,0],[1,1]],lowpass:[[0,.8],[.2,.6],[.3,.1],[1,0]],bandpass:[[0,0],[.4,.8],[.6,.8],[1,0]],highpass:[[0,0],[.7,.1],[.8,.6],[1,.8]],flat:[[0,.7],[1,1]],random:[[0,0],[.38,0],[.55,1],[.72,1],[1,.05]],linear_full:[[0,0],[.00392156862745098,.00392156862745098],[.00784313725490196,.00784313725490196],[.011764705882352941,.011764705882352941],[.01568627450980392,.01568627450980392],[.0196078431372549,.0196078431372549],[.023529411764705882,.023529411764705882],[.027450980392156862,.027450980392156862],[.03137254901960784,.03137254901960784],[.03529411764705882,.03529411764705882],[.0392156862745098,.0392156862745098],[.043137254901960784,.043137254901960784],[.047058823529411764,.047058823529411764],[.050980392156862744,.050980392156862744],[.054901960784313725,.054901960784313725],[.058823529411764705,.058823529411764705],[.06274509803921569,.06274509803921569],[.06666666666666667,.06666666666666667],[.07058823529411765,.07058823529411765],[.07450980392156863,.07450980392156863],[.0784313725490196,.0784313725490196],[.08235294117647059,.08235294117647059],[.08627450980392157,.08627450980392157],[.09019607843137255,.09019607843137255],[.09411764705882353,.09411764705882353],[.09803921568627451,.09803921568627451],[.10196078431372549,.10196078431372549],[.10588235294117647,.10588235294117647],[.10980392156862745,.10980392156862745],[.11372549019607843,.11372549019607843],[.11764705882352941,.11764705882352941],[.12156862745098039,.12156862745098039],[.12549019607843137,.12549019607843137],[.12941176470588237,.12941176470588237],[.13333333333333333,.13333333333333333],[.13725490196078433,.13725490196078433],[.1411764705882353,.1411764705882353],[.1450980392156863,.1450980392156863],[.14901960784313725,.14901960784313725],[.15294117647058825,.15294117647058825],[.1568627450980392,.1568627450980392],[.1607843137254902,.1607843137254902],[.16470588235294117,.16470588235294117],[.16862745098039217,.16862745098039217],[.17254901960784313,.17254901960784313],[.17647058823529413,.17647058823529413],[.1803921568627451,.1803921568627451],[.1843137254901961,.1843137254901961],[.18823529411764706,.18823529411764706],[.19215686274509805,.19215686274509805],[.19607843137254902,.19607843137254902],[.2,.2],[.20392156862745098,.20392156862745098],[.20784313725490197,.20784313725490197],[.21176470588235294,.21176470588235294],[.21568627450980393,.21568627450980393],[.2196078431372549,.2196078431372549],[.2235294117647059,.2235294117647059],[.22745098039215686,.22745098039215686],[.23137254901960785,.23137254901960785],[.23529411764705882,.23529411764705882],[.23921568627450981,.23921568627450981],[.24313725490196078,.24313725490196078],[.24705882352941178,.24705882352941178],[.25098039215686274,.25098039215686274],[.2549019607843137,.2549019607843137],[.25882352941176473,.25882352941176473],[.2627450980392157,.2627450980392157],[.26666666666666666,.26666666666666666],[.27058823529411763,.27058823529411763],[.27450980392156865,.27450980392156865],[.2784313725490196,.2784313725490196],[.2823529411764706,.2823529411764706],[.28627450980392155,.28627450980392155],[.2901960784313726,.2901960784313726],[.29411764705882354,.29411764705882354],[.2980392156862745,.2980392156862745],[.30196078431372547,.30196078431372547],[.3058823529411765,.3058823529411765],[.30980392156862746,.30980392156862746],[.3137254901960784,.3137254901960784],[.3176470588235294,.3176470588235294],[.3215686274509804,.3215686274509804],[.3254901960784314,.3254901960784314],[.32941176470588235,.32941176470588235],[.3333333333333333,.3333333333333333],[.33725490196078434,.33725490196078434],[.3411764705882353,.3411764705882353],[.34509803921568627,.34509803921568627],[.34901960784313724,.34901960784313724],[.35294117647058826,.35294117647058826],[.3568627450980392,.3568627450980392],[.3607843137254902,.3607843137254902],[.36470588235294116,.36470588235294116],[.3686274509803922,.3686274509803922],[.37254901960784315,.37254901960784315],[.3764705882352941,.3764705882352941],[.3803921568627451,.3803921568627451],[.3843137254901961,.3843137254901961],[.38823529411764707,.38823529411764707],[.39215686274509803,.39215686274509803],[.396078431372549,.396078431372549],[.4,.4],[.403921568627451,.403921568627451],[.40784313725490196,.40784313725490196],[.4117647058823529,.4117647058823529],[.41568627450980394,.41568627450980394],[.4196078431372549,.4196078431372549],[.4235294117647059,.4235294117647059],[.42745098039215684,.42745098039215684],[.43137254901960786,.43137254901960786],[.43529411764705883,.43529411764705883],[.4392156862745098,.4392156862745098],[.44313725490196076,.44313725490196076],[.4470588235294118,.4470588235294118],[.45098039215686275,.45098039215686275],[.4549019607843137,.4549019607843137],[.4588235294117647,.4588235294117647],[.4627450980392157,.4627450980392157],[.4666666666666667,.4666666666666667],[.47058823529411764,.47058823529411764],[.4745098039215686,.4745098039215686],[.47843137254901963,.47843137254901963],[.4823529411764706,.4823529411764706],[.48627450980392156,.48627450980392156],[.49019607843137253,.49019607843137253],[.49411764705882355,.49411764705882355],[.4980392156862745,.4980392156862745],[.5019607843137255,.5019607843137255],[.5058823529411764,.5058823529411764],[.5098039215686274,.5098039215686274],[.5137254901960784,.5137254901960784],[.5176470588235295,.5176470588235295],[.5215686274509804,.5215686274509804],[.5254901960784314,.5254901960784314],[.5294117647058824,.5294117647058824],[.5333333333333333,.5333333333333333],[.5372549019607843,.5372549019607843],[.5411764705882353,.5411764705882353],[.5450980392156862,.5450980392156862],[.5490196078431373,.5490196078431373],[.5529411764705883,.5529411764705883],[.5568627450980392,.5568627450980392],[.5607843137254902,.5607843137254902],[.5647058823529412,.5647058823529412],[.5686274509803921,.5686274509803921],[.5725490196078431,.5725490196078431],[.5764705882352941,.5764705882352941],[.5803921568627451,.5803921568627451],[.5843137254901961,.5843137254901961],[.5882352941176471,.5882352941176471],[.592156862745098,.592156862745098],[.596078431372549,.596078431372549],[.6,.6],[.6039215686274509,.6039215686274509],[.6078431372549019,.6078431372549019],[.611764705882353,.611764705882353],[.615686274509804,.615686274509804],[.6196078431372549,.6196078431372549],[.6235294117647059,.6235294117647059],[.6274509803921569,.6274509803921569],[.6313725490196078,.6313725490196078],[.6352941176470588,.6352941176470588],[.6392156862745098,.6392156862745098],[.6431372549019608,.6431372549019608],[.6470588235294118,.6470588235294118],[.6509803921568628,.6509803921568628],[.6549019607843137,.6549019607843137],[.6588235294117647,.6588235294117647],[.6627450980392157,.6627450980392157],[.6666666666666666,.6666666666666666],[.6705882352941176,.6705882352941176],[.6745098039215687,.6745098039215687],[.6784313725490196,.6784313725490196],[.6823529411764706,.6823529411764706],[.6862745098039216,.6862745098039216],[.6901960784313725,.6901960784313725],[.6941176470588235,.6941176470588235],[.6980392156862745,.6980392156862745],[.7019607843137254,.7019607843137254],[.7058823529411765,.7058823529411765],[.7098039215686275,.7098039215686275],[.7137254901960784,.7137254901960784],[.7176470588235294,.7176470588235294],[.7215686274509804,.7215686274509804],[.7254901960784313,.7254901960784313],[.7294117647058823,.7294117647058823],[.7333333333333333,.7333333333333333],[.7372549019607844,.7372549019607844],[.7411764705882353,.7411764705882353],[.7450980392156863,.7450980392156863],[.7490196078431373,.7490196078431373],[.7529411764705882,.7529411764705882],[.7568627450980392,.7568627450980392],[.7607843137254902,.7607843137254902],[.7647058823529411,.7647058823529411],[.7686274509803922,.7686274509803922],[.7725490196078432,.7725490196078432],[.7764705882352941,.7764705882352941],[.7803921568627451,.7803921568627451],[.7843137254901961,.7843137254901961],[.788235294117647,.788235294117647],[.792156862745098,.792156862745098],[.796078431372549,.796078431372549],[.8,.8],[.803921568627451,.803921568627451],[.807843137254902,.807843137254902],[.8117647058823529,.8117647058823529],[.8156862745098039,.8156862745098039],[.8196078431372549,.8196078431372549],[.8235294117647058,.8235294117647058],[.8274509803921568,.8274509803921568],[.8313725490196079,.8313725490196079],[.8352941176470589,.8352941176470589],[.8392156862745098,.8392156862745098],[.8431372549019608,.8431372549019608],[.8470588235294118,.8470588235294118],[.8509803921568627,.8509803921568627],[.8549019607843137,.8549019607843137],[.8588235294117647,.8588235294117647],[.8627450980392157,.8627450980392157],[.8666666666666667,.8666666666666667],[.8705882352941177,.8705882352941177],[.8745098039215686,.8745098039215686],[.8784313725490196,.8784313725490196],[.8823529411764706,.8823529411764706],[.8862745098039215,.8862745098039215],[.8901960784313725,.8901960784313725],[.8941176470588236,.8941176470588236],[.8980392156862745,.8980392156862745],[.9019607843137255,.9019607843137255],[.9058823529411765,.9058823529411765],[.9098039215686274,.9098039215686274],[.9137254901960784,.9137254901960784],[.9176470588235294,.9176470588235294],[.9215686274509803,.9215686274509803],[.9254901960784314,.9254901960784314],[.9294117647058824,.9294117647058824],[.9333333333333333,.9333333333333333],[.9372549019607843,.9372549019607843],[.9411764705882353,.9411764705882353],[.9450980392156862,.9450980392156862],[.9490196078431372,.9490196078431372],[.9529411764705882,.9529411764705882],[.9568627450980393,.9568627450980393],[.9607843137254902,.9607843137254902],[.9647058823529412,.9647058823529412],[.9686274509803922,.9686274509803922],[.9725490196078431,.9725490196078431],[.9764705882352941,.9764705882352941],[.9803921568627451,.9803921568627451],[.984313725490196,.984313725490196],[.9882352941176471,.9882352941176471],[.9921568627450981,.9921568627450981],[.996078431372549,.996078431372549],[1,1]]}},a.MedicalHistogram=function(e,t){THREE.Object3D.call(this),this.name="medicalHistogram",this._dom=void 0===t?document.createElement("div"):"string"==typeof t?document.getElementById(t):t,this.range={},this.bins=0,this.histogram=new Uint32Array(256),this.maxBin=0,this.maxBinValue=0,this._object=e,this.initCanvas(),this.computeHistogram(),this.drawHistogram()},a.MedicalHistogram.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:a.MedicalHistogram,isMedicalHistogram:!0,_createCanvas(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=256,e.height=128,e.style.width="256px",e.style.height="128px",t.fillStyle="black",t.fillRect(0,0,e.width,e.height),e},initCanvas(){let e=document.createElement("div");e.style.cssText="position: relative; height: 128px; width: 256px; border: 1px solid #f9f9f9;",this._canvas=this._createCanvas(),this._canvas.style.cssText="position: absolute;",e.appendChild(this._canvas),this._dom.appendChild(e)},_statistics(e,t,r){if(!e)return this;let n=e.length-1;this.bins=Math.min(t||256,256),r=Math.min(r||1e3,1e3);let i=1/0,o=-1/0;for(let t=0;t<r;t++){let t=a.randInt(0,n);i=Math.min(i,e[t]),o=Math.max(o,e[t])}this.range={min:i,max:o};let s=this.histogram;s.fill(0);let l=this.bins/(o-i);for(let t=0;t<r;t++){let t=a.randInt(0,n);s[Math.floor((e[t]-i)*l)]+=1}this.maxBin=0,this.maxBinValue=0;for(let e=0;e<this.bins;e++)this.histogram[e]>this.maxBinValue&&(this.maxBin=e,this.maxBinValue=this.histogram[e])},computeHistogram(e){if(e&&(this._object=e),this._object&&!0===this._object.isMedicalSlicer){let e=this._object._getSlicePixels().data;this._statistics(e,256,5e3)}else if(this._object&&!0===this._object.isMedicalVolume){let e=this._object._getVolumeVoxels().data;this._statistics(e,256,1e4)}else console.warn("warning: histograms are available for slice or volume...")},drawHistogram(){let e=this._canvas,t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,e.width,e.height),t.lineWidth=1,t.strokeStyle="rgb( 128, 128, 128 )",t.beginPath();let r,n,i=e.width/this.bins,a=.8*e.height/this.maxBinValue;for(let r=0;r<this.bins;r++)t.moveTo(i*r,e.height),t.lineTo(i*r,e.height-a*this.histogram[r]);t.stroke(),t.closePath(),this._object.isMedicalSlicer?(r=this._object.slice.windowWidth,n=this._object.slice.windowCenter):this._object.isMedicalVolume&&(r=this._object.windowWidth,n=this._object.windowCenter),t.fillStyle="rgba( 128, 128, 0, 0.25 )";let o=this.range,s=e.width/(o.max-o.min),l=s*(n-r/2-o.min),u=s*r;t.fillRect(l,0,u,e.height)}}),Object.defineProperties(a.MedicalHistogram.prototype,{object:{get:function(){return this._object},set:function(e){this._object!==e&&this.computeHistogram(e),this.drawHistogram()}}}),a.MedicalLoader=function(){this.progressBar={},this.progressBar.onStart=()=>{a.createProgressbar()},this.progressBar.onProgress=(e,t,r)=>{a.updateProgressbar(t,r)},this.progressBar.onLoad=()=>{a.hideProgressbar()},this.progressBar.onError=e=>{a.errorProgressbar("There was an error loading "+e)}},a.MedicalLoader.prototype={constructor:a.MedicalLoader,load:function(e,t){e=!0===Array.isArray(e)?e:[e],"string"==typeof this.path&&(e=e.map(e=>this.path+e));let r=new de.MedicalLoader(a.appWorks.dom,this.progressBar),n=[];e.forEach(e=>{n.push(r.load(e))}),Promise.all(n).then(()=>{let e=r.data[0].mergeSeries(r.data)[0].stack[0];r.dispose(),t(e)}).catch(e=>{console.log("Error: loading failed in JAMIE.MedicalLoader()..."),console.log(e)})},setPath:function(e){return this.path=e,this}},a.MedicalLoadFiles=function(e,t){a.createProgressbar();let r=new de.MedicalLoader(a.appWorks.dom),n=[];function i(e,t){return t.extension.toUpperCase()===e.toUpperCase()}function o(e,t){return Promise.resolve().then(()=>new Promise((r,n)=>{setTimeout((function(){let n=new FileReader;n.addEventListener("load",e=>{r(e.target.result)}),n.readAsArrayBuffer(t[e])}),3e3*Math.random())})).then(n=>r.parse({url:t[e].name,buffer:n})).then(e=>{n.push(e)}).catch(e=>{console.log(e)})}const s=[],l=[],u=[];var c=e.dataTransfer?e.dataTransfer.files:e.target.files;for(let e=0;e<c.length;e++){let t=a.MedicalUtils.parseUrl(c[e].name);"MHD"===t.extension.toUpperCase()||"RAW"===t.extension.toUpperCase()||"ZRAW"===t.extension.toUpperCase()?u.push({file:c[e],extension:t.extension.toUpperCase()}):l.push(c[e])}if(2===u.length){const e=u.filter(i.bind(null,"MHD")),t=u.filter(i.bind(null,"RAW")),a=u.filter(i.bind(null,"ZRAW"));1!==e.length||1!==t.length&&1!==a.length||s.push(function(e){const t=[];for(let r=0;r<e.length;r++)t.push(new Promise((t,n)=>{setTimeout((function(){const n=new FileReader;n.addEventListener("load",e=>{t(e.target.result)}),n.readAsArrayBuffer(e[r].file)}),3e3*Math.random())}).then(t=>({url:e[r].file.name,buffer:t})));return Promise.all(t).then(e=>r.parse(e)).then(e=>{n.push(e)}).catch(e=>{console.log(e)})}(u))}for(let e=0;e<l.length;e++)s.push(o(e,l));(function(e,t){var r=e.length,n=0;return Promise.all(e.map((function(e){return e.then(()=>{n++,t(n,r)}),e})))})(s,(function(e,t){a.updateProgressbar(e,t)})).then(()=>{let e=n[0].mergeSeries(n)[0].stack[0];r.dispose(),t(e),a.hideProgressbar()}).catch(e=>{console.log(e)})},a.MedicalKeyboard=function(e){e.preventDefault(),e.stopPropagation();var t=a.appWorks,r=a.MedicalWorker;if(113===e.keyCode){let e;return t.guiSidebar&&(e=t.guiSidebar.dom.style.display,t.guiSidebar.setDisplay(""===e?"none":""),t.widthRatio=""===e?1:(window.innerWidth-300)/window.innerWidth,t.signals.windowResize.dispatch(),r.onWindowResize()),void(t.guiIconbar&&(e=t.guiIconbar.dom.style.display,t.guiIconbar.setDisplay(""===e?"none":"")))}if("quadWorkspace"===r.workspace){if((n=r.objectEntered)&&n.isMedicalSlicer)switch(e.keyCode){case 38:!function(e){e.index<e.orientationMaxIndex&&(e.index+=1)}(n),i(n),s(n),l(n);break;case 40:!function(e){e.index>0&&(e.index-=1)}(n),i(n),s(n),l(n);break;case 46:o(n)}}else if("slicesWorkspace"===r.workspace){var n;if((n=r.objectEntered)&&n.isMedicalSlicer)switch(e.keyCode){case 46:o(n)}}function i(e){e.children.forEach(t=>{t.isSketchBase&&(t.targetMesh=e.slice)})}function o(e){var t=a.MedicalWorker.sketches;for(let r=0,n=e.children.length;r<n;r++){let n=e.children[r];if(n.hovered){a.remove(n);let e=t.indexOf(n);return t.splice(e,1),void n.free()}}}function s(e){t.guiSlicer.update(e)}function l(e){var r=t.guiHistogram;!(!r||""!==r.dom.style.display)&&r.update(e,!0)}},a.MedicalWorker={stack:null,stackSize:0,workspace:"",medical:null,medicalDom:null,objectEntered:null,objectClicked:null,elementDblClicked:null,elements:[],raycaster:new THREE.Raycaster,sketchType:"Handle",sketches:[],getAppWorks:function(){var e=a.appWorks;return null!==e.composer&&(e.composer=null,e.renderer.setClearColor(1184274,1),e.renderer.setScissorTest(!0)),e},getMedicalSlicers:function(e){var[t,r,n]=e.worldSliceOrientation(),i=new a.MedicalSlicer(e);i.name="xSlicer",i.worldAxis=0,i.orientation=t,i.bbox.visible=!1,i.borderColor=16776960;var o=new a.MedicalSlicer(e);o.name="ySlicer",o.worldAxis=1,o.orientation=r,o.bbox.visible=!1,o.borderColor=65280;var s=new a.MedicalSlicer(e);return s.name="zSlicer",s.worldAxis=2,s.orientation=n,s.bbox.visible=!1,s.borderColor=16711680,[i,o,s]},getMedicalVolume:function(e){return new a.MedicalVolume(e)},getMedicalIsosurface:function(e,t,r,n){return new a.MedicalIsosurface(e,t,r,n)},onUpdateMedical:function(e,t){if(this.medical){var r=a.appWorks.renderer,n=r.domElement;this.medical.children.forEach((function(e,t){var i=e.userData.element.getBoundingClientRect();if(!(i.bottom<0||i.top>n.clientHeight||i.right<0||i.left>n.clientWidth)){var a=i.width,o=i.height,s=i.left,l=n.clientHeight-i.bottom;r.setViewport(s,l,a,o),r.setScissor(s,l,a,o);var u=e.userData.camera;e.userData.controls.update(),r.render(e,u)}}))}},prepareStack:function(e){return e.prepared||e.prepare(),e.packed||e.pack(),e},getStackCenter:function(e){return e.worldCenter()},getStackSizes:function(e){let t=e.worldBoundingBox();return[t[1]-t[0],t[3]-t[2],t[5]-t[4]]},getStackSize:function(e){return Math.max(...this.getStackSizes(e))},getElementSlicer:function(e){let t=parseInt(e.id);return this.medical.children[t].children[0]},getElementControls:function(e){let t=parseInt(e.id);return this.medical.children[t].userData.controls},getElementCamera:function(e){let t=parseInt(e.id);return this.medical.children[t].userData.camera},resizeCamera:function(e,t,r){if("quadWorkspace"===this.workspace)if(e.isPerspectiveCamera)e.aspect=t,e.updateProjectionMatrix();else{let r=this.stackSize,n=this.stackSize*t;e.left=-n/2,e.right=n/2,e.top=r/2,e.bottom=-r/2,e.updateProjectionMatrix()}if("slicesWorkspace"===this.workspace){let n=this.stackSize,i=this.stackSize*t;e.left=-i/2,e.right=i/2,e.top=n/2,e.bottom=-n/2,void 0!==r&&(e.zoom=r),e.updateProjectionMatrix()}},resizeElement:function(e,t,r,n){e.style.display="",e.style.width=t+"px",e.style.height=r+"px";let i=this.getElementCamera(e);this.resizeCamera(i,t/r,n)},onMouseEnter:function(e){let t=a.MedicalWorker,r=t.getElementSlicer(this);t.objectEntered=r,"slicesWorkspace"===t.workspace&&(this.style.transform="scale(1.1, 1.1)")},onMouseLeave:function(e){let t=a.MedicalWorker;t.objectEntered=null,"slicesWorkspace"===t.workspace&&(this.style.transform="scale(1.0, 1.0)")},onClick:function(e){let t=a.MedicalWorker,r=t.getElementSlicer(this);t.objectClicked=r,a.appWorks.signals.objectSelected.dispatch(r)},onDoubleClick:function(e){let t=a.MedicalWorker;if("quadWorkspace"===t.workspace){let e=a.appWorks.width,r=a.appWorks.height,n=~~(e/2),i=~~(r/2);t.elementDblClicked!==this?(t.elements.forEach(e=>{e.style.display="none"}),t.resizeElement(this,e,r),t.elementDblClicked=this):(t.elements.forEach(e=>{t.resizeElement(e,n,i)}),t.elementDblClicked=null),t.sketches.length>0&&a.triggerWindowResize()}if("slicesWorkspace"===t.workspace){let e=a.appWorks.width,r=a.appWorks.height,n=200,i=200;if(t.elementDblClicked!==this){t.elements.forEach(e=>{e.style.display="none"}),t.resizeElement(this,e,r),t.getElementControls(this).enabled=!0,t.elementDblClicked=this}else{t.elements.forEach(e=>{e.style.display=""}),t.resizeElement(this,n,i,1),t.getElementControls(this).enabled=!1,t.elementDblClicked=null}t.sketches.length>0&&a.triggerWindowResize()}},onWindowResize:function(e){let t=a.appWorks,r=a.MedicalWorker;if("quadWorkspace"===r.workspace){let e=t.width,n=t.height,i=~~(e/2),a=~~(n/2),o=r.medicalDom.style;if(o.width=e+"px",o.height=n+"px",r.elementDblClicked){let t=r.elementDblClicked;r.resizeElement(t,e,n)}else r.elements.forEach(e=>{r.resizeElement(e,i,a)})}if("slicesWorkspace"===r.workspace){let e=t.width,n=t.height,i=r.medicalDom.style;if(i.width=e+"px",i.height=n+"px",r.elementDblClicked){let t=r.elementDblClicked;r.resizeElement(t,e,n)}}},onMouseDown:function(e){if(!a.isCtrlKeyDown(e))return;let t=a.MedicalWorker,r=t.medical,n=t.raycaster,i=t.sketches,o=t.sketchType,s=parseInt(this.id),l=r.children[s],u=l.children[0];if(!u.isMedicalSlicer)return;let c=l.userData.camera,h=l.userData.controls;for(let t=0,r=i.length;t<r;t++){let r=i[t];if(r.hovered)return void r.onStart(e)}this.style.cursor="default";let d=this.getBoundingClientRect(),f={x:(e.clientX-d.left)/d.width*2-1,y:-(e.clientY-d.top)/d.height*2+1};n.setFromCamera(f,c);let p=n.intersectObject(u.slice);if(0===p.length)return;if(i.length>0){let e=i[i.length-1];if(e._active||e._dragged)return}let m=u.stack,g=null;switch(o){default:case"Handle":g=new a.SketchHandle(u.slice,h,{worldPosition:p[0].point});break;case"VoxelProbe":g=new a.SketchVoxelProbe(u.slice,h,{stack:m,worldPosition:p[0].point});break;case"Ruler":g=new a.SketchRuler(u.slice,h,{lps2IJK:m.lps2IJK,pixelSpacing:m.frame[u.index].pixelSpacing,ultrasoundRegions:m.frame[u.index].ultrasoundRegions,worldPosition:p[0].point});break;case"BiRuler":g=new a.SketchBiRuler(u.slice,h,{lps2IJK:m.lps2IJK,pixelSpacing:m.frame[u.index].pixelSpacing,ultrasoundRegions:m.frame[u.index].ultrasoundRegions,worldPosition:p[0].point});break;case"Angle":g=new a.SketchAngle(u.slice,h,{worldPosition:p[0].point});break;case"Rectangle":g=new a.SketchRectangle(u.slice,h,{frameIndex:u.index,stack:m,worldPosition:p[0].point});break;case"Polygon":g=new a.SketchPolygon(u.slice,h,{frameIndex:u.index,stack:m,worldPosition:p[0].point});break;case"Freehand":g=new a.SketchFreehand(u.slice,h,{frameIndex:u.index,stack:m,worldPosition:p[0].point});break;case"Annotation":g=new a.SketchAnnotation(u.slice,h,{worldPosition:p[0].point})}i.push(g),u.add(g)},onMouseUp:function(e){if(!a.isCtrlKeyDown(e))return;let t=a.MedicalWorker.sketches;if(2===e.button)for(let e=0,r=t.length;e<r;e++){let r=t[e];r.isSketchPolygon&&r._active&&this.dispatchEvent(new CustomEvent("rightclick"))}for(let r=0,n=t.length;r<n;r++){let n=t[r];if(n.active)return void n.onEnd(e)}},onMouseMove:function(e){if(!a.isCtrlKeyDown(e))return;let t=a.MedicalWorker.sketches,r="default";for(let n=0,i=t.length;n<i;n++){let i=t[n];i.onMove(e),i.hovered&&(r="pointer")}this.style.cursor=r}},a.MedSketchCSS='\n.sketch-handle {\n    position: absolute;\n    border: 1px solid;\n    border-radius: 50%;\n    width: 10px;\n    height: 10px;\n    margin: -6px; /* border + width / 2 */\n    z-index: 1; /* 3 */\n}\n.sketch-line {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    margin-top: -0.5px; /* height / 2 */\n}\n.sketch-dashline {\n    position: absolute;\n    border-top: 1px dashed;\n    margin-top: -0.5px; /* border / 2 */\n}\n.sketch-line::before,\n.sketch-dashline::before { /* for dragging */\n    content: " ";\n    position: absolute;\n    height: 12px;\n    left: 0;\n    right: 0;\n    margin-top: -6px;\n}\n.sketch-rectangle {\n    position: absolute;\n    border: 1px solid;\n    margin: -1px; /* border */\n}\n// .sketch-rectangle-helper {\n//     position: absolute;\n//     border: 1px dashed;\n//     margin: -1px; /* border */\n// }\n// .sketch-ellipse {\n//     position: absolute;\n//     border: 1px solid;\n//     border-radius: 50%;\n//     margin: -1px; /* border */\n//     // z-index: 2;\n// }\n.sketch-label {\n    position: absolute;\n    border: 1px solid;\n    border-radius: 6px; /* jamie */\n    background-color: rgba(0, 0, 0, 0.7);\n    color: rgb(255, 255, 255);\n    padding: 4px;\n    z-index: 1; /* 3 */\n}\n::selection {\n    background: rgba(0,0,0,0);\n}',a.SketchBase=function(e,t,r){if(r=r||{},THREE.Object3D.call(this),this.name="sketchBase",this._sketchType="Base",this._params=r,!0===r.hideMesh&&(this.visible=!1),null===document.getElementById("medical-sketches")){const e=document.createElement("style");e.id="medical-sketches",e.innerHTML=a.MedSketchCSS,document.head.appendChild(e)}this._enabled=!0,this._selected=!1,this._hovered=!0,this._active=!0,this._colors={default:"#0000ff",active:"#ffff00",hover:"#ff0000",select:"#008000",text:"#ffffff",error:"#ff7f50"},this._color=this._colors.default,this._dragged=!1,this._displayed=!0,this._targetMesh=e,this._controls=t,this._camera=t.object,this._container=t.domElement,this._worldPosition=new THREE.Vector3,r.worldPosition?this._worldPosition.copy(r.worldPosition):null!==this._targetMesh&&this._worldPosition.setFromMatrixPosition(this._targetMesh.matrixWorld),this._xaxis=new THREE.Vector3(1,0,0),this._yaxis=new THREE.Vector3(0,1,0)},a.SketchBase.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:a.SketchBase,isSketchBase:!0,initOffsets(){const e=this._container.getBoundingClientRect(),t=document.body,r=document.documentElement,n=window.pageYOffset||r.scrollTop||t.scrollTop,i=window.pageXOffset||r.scrollLeft||t.scrollLeft,a=r.clientTop||t.clientTop||0,o=r.clientLeft||t.clientLeft||0;this._offsets={top:Math.round(e.top+n-a),left:Math.round(e.left+i-o)}},getMouseOffsets(e){return{x:(e.clientX-this._offsets.left)/this._container.offsetWidth*2-1,y:-(e.clientY-this._offsets.top)/this._container.offsetHeight*2+1,screenX:e.clientX-this._offsets.left,screenY:e.clientY-this._offsets.top}},getArea(e){let t=0,r=e.length-1;for(let n=0;n<e.length;n++)t+=(e[r].x+e[n].x)*(e[r].y-e[n].y),r=n;return Math.abs(t/2)},getRegionByXY(e,t){let r=null;return e.some((e,n)=>{if(t.x>=e.x0&&t.x<=e.x1&&t.y>=e.y0&&t.y<=e.y1)return r=n,!0}),r},getPointInRegion:(e,t)=>e?new THREE.Vector2((t.x-e.x0-(e.axisX||0))*e.deltaX,(t.y-e.y0-(e.axisY||0))*e.deltaY):null,getUsPoint(e,t){return this.getPointInRegion(e[this.getRegionByXY(e,t)],t)},getUsDistance(e,t){const r=this._params.ultrasoundRegions||[];if(r.length<1)return null;const n=this.getRegionByXY(r,e),i=this.getRegionByXY(r,t);return null===n||null===i||n!==i||"cm"!==r[n].unitsX||"cm"!==r[n].unitsY?null:this.getPointInRegion(r[n],e).distanceTo(this.getPointInRegion(r[n],t))},getDistanceData(e,t,r){let n=null,i=null;if(r)n=e.distanceTo(t)*r;else if(this._params.ultrasoundRegions&&this._params.lps2IJK){const r=this.getUsDistance(a.MedicalUtils.worldToData(this._params.lps2IJK,e),a.MedicalUtils.worldToData(this._params.lps2IJK,t));null!==r?(n=10*r,i="mm"):(n=e.distanceTo(t),i=this._params.pixelSpacing?"mm":"units")}else n=e.distanceTo(t);return{distance:n,units:i}},getLineData(e,t){const r=t.clone().sub(e),n=t.clone().add(e).multiplyScalar(.5),i=r.length(),a=r.angleTo(this._xaxis);return{line:r,length:i,transformX:n.x-i/2,transformY:n.y,transformAngle:e.y<t.y?a:-a,center:n}},getRectData(e,t){const r=t.clone().sub(e),n=r.clone().projectOnVector(this._yaxis),i=e.clone().min(t);return{width:r.clone().projectOnVector(this._xaxis).length(),height:n.length(),transformX:i.x,transformY:i.y,paddingVector:n.clone().normalize()}},adjustLabelTransform(e,t,r){let n=Math.round(t.x-(r?0:e.offsetWidth/2)),i=Math.round(t.y-(r?0:e.offsetHeight/2));return new THREE.Vector2(n,i)},worldToScreen(e){const t=e.clone();return t.project(this._camera),t.x=Math.round((t.x+1)*this._container.offsetWidth/2),t.y=Math.round((1-t.y)*this._container.offsetHeight/2),t.z=0,t},update(){console.log("update() should be overloaded!")},updateColor(){this._active?this._color=this._colors.active:this._hovered?this._color=this._colors.hover:this._selected?this._color=this._colors.select:this._color=this._colors.default},setDefaultColor(e){this._colors.default=e,this._handles&&this._handles.forEach(t=>t._colors.default=e),this.update()},show(){this.showDOM(),this.showMesh(),this.update(),this._displayed=!0},hide(){this.hideDOM(),this.hideMesh(),this._displayed=!1},hideDOM(){console.log("hideDOM() should be overloaded!")},showDOM(){console.log("showDOM() should be overloaded!")},hideMesh(){this.visible=!1},showMesh(){!0!==this._params.hideMesh&&(this.visible=!0)},free(){this._camera=null,this._container=null,this._controls=null,this._params=null,this._targetMesh=null}}),Object.defineProperties(a.SketchBase.prototype,{sketchType:{get:function(){return this._sketchType}},targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._worldPosition.copy(e),this.update()}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},selected:{get:function(){return this._selected},set:function(e){this._selected=e,this.update()}},hovered:{get:function(){return this._hovered},set:function(e){this._hovered=e,this.update()}},dragged:{get:function(){return this._dragged},set:function(e){this._dragged=e,this.update()}},displayed:{get:function(){return this._displayed},set:function(e){this._displayed=e,this.update()}},active:{get:function(){return this._active},set:function(e){this._active=e,this.update()}},color:{get:function(){return this._color},set:function(e){this._color=e,this.update()}}}),a.SketchHandle=function(e,t,r){r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchHandle",this._sketchType="Handle",this._plane={position:new THREE.Vector3,direction:new THREE.Vector3},this._offset=new THREE.Vector3,this._raycaster=new THREE.Raycaster,this._active=!1,this._hovered=!1,this._tracking=!1,this._mouse=new THREE.Vector2,this._initialized=!1,this._dom=null,this._domHovered=!1,this._screenPosition=this.worldToScreen(this._worldPosition),this.create(),this.initOffsets(),this.onResize=this.onResize.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},a.SketchHandle.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchHandle,isSketchHandle:!0,addEventListeners(){window.addEventListener("resize",this.onResize),this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)},removeEventListeners(){window.removeEventListener("resize",this.onResize),this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)},onResize(){this.initOffsets()},onHover(e){e&&this.hoverDom(e),this._hovered=this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){const t=this.getMouseOffsets(e);if(this._mouse.set(t.x,t.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._hovered){if(this._active=!0,this._controls.enabled=!1,this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._offset.copy(e[0].point).sub(this._worldPosition)}else{this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()),this._raycaster.ray.position=this._raycaster.ray.origin;let e=a.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._offset.copy(e).sub(this._plane.position)}this.update()}},onMove(e,t){const r=this.getMouseOffsets(e);if(this._mouse.set(r.x,r.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._active||t)if(this._dragged=!0,null!==this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._worldPosition.copy(e[0].point.sub(this._offset))}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection())),this._raycaster.ray.position=this._raycaster.ray.origin;let e=a.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._worldPosition.copy(e.sub(this._offset))}else this.onHover(null);this.update()},onEnd(){!0!==this._tracking&&(!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected),this._initialized=!0,this._active=!1,this._dragged=!1,this._controls.enabled=!0,this.update())},create(){this.createDOM()},createDOM(){this._dom=document.createElement("div"),this._dom.className="sketch-handle",this._dom.style.transform=`translate3D(${this._screenPosition.x}px, ${this._screenPosition.y}px, 0)`,this.updateDOMColor(),this._container.appendChild(this._dom)},update(){this.updateColor(),this._screenPosition=this.worldToScreen(this._worldPosition),this.updateDOMColor(),this.updateDOMPosition()},updateWorldPosition(){let e=this._screenPosition,t=this._container.offsetWidth,r=this._container.offsetHeight,n={};if(n.x=2*e.x/t-1,n.y=-2*e.y/r+1,this._raycaster.setFromCamera(n,this._camera),this._targetMesh){let e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&this._worldPosition.copy(e[0].point)}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection())),this._raycaster.ray.position=this._raycaster.ray.origin;let e=a.MedicalIntersects.rayPlane(this._raycaster.ray,this._plane);null!==e&&this._worldPosition.copy(e)}},updateDOMColor(){this._dom.style.backgroundColor=this._color},updateDOMPosition(){this._dom&&(this._dom.style.transform=`translate3D(${this._screenPosition.x}px, ${this._screenPosition.y}px, 0)`)},free(){this.removeEventListeners(),this._container.removeChild(this._dom)},hideDOM(){this._dom.style.display="none"},showDOM(){this._dom.style.display=""}}),Object.defineProperties(a.SketchHandle.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this.updateWorldPosition(),this.update()}},screenPosition:{get:function(){return this._screenPosition},set:function(e){this._screenPosition=e}},active:{get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}},tracking:{get:function(){return this._tracking},set:function(e){this._tracking=e,this.update()}}}),a.SketchVoxelProbe=function(e,t,r){r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchVoxelProbe",this._sketchType="VoxelProbe",this._stack=r.stack,this._container.style.cursor="pointer",this._controls.enabled=!1,this._initialized=!1,this._active=!0,this._moving=!0,this._domHovered=!1,this._label=null,this._handle=new a.SketchHandle(e,t,r),this.add(this._handle),this._moveHandle=new a.SketchHandle(e,t,r),this.add(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},a.SketchVoxelProbe.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchVoxelProbe,isSketchVoxelProbe:!0,addEventListeners(){this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)},removeEventListeners(){this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)},onStart(e){this._moveHandle.onMove(e,!0),this._handle.onStart(e),this._active=this._handle.active||this._domHovered,this._domHovered&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handle.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}else this.onHover(null);this._handle.onMove(e),this.update()},onEnd(){this._handle.onEnd(),!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handle.selected=this._selected),this._initialized=!0,this._active=this._handle.active,this._dragged=!1,this._moving=!1,this.update()},onHover(e){e&&this.hoverDom(e),this._hovered=this._handle.hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},create(){this.createVoxel(),this.createDOM()},createVoxel(){this._voxel=new a.MedicalVoxel,this._voxel.id=this.id},createDOM(){this._label=document.createElement("div"),this._label.className="sketch-label";let e=document.createElement("div"),t=document.createElement("div");t.className="lpsPosition",e.appendChild(t);let r=document.createElement("div");r.className="ijkPosition",e.appendChild(r);let n=document.createElement("div");n.className="value",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},update(){this.updateColor(),this._handle.update(),this._worldPosition.copy(this._handle.worldPosition),this.updateVoxel(),this.updateDOM()},updateVoxel(){this._voxel.worldCoordinates=this._worldPosition,this._voxel.dataCoordinates=a.MedicalUtils.worldToData(this._stack.lps2IJK,this._worldPosition);let e=a.MedicalUtils.getPixelData(this._stack,this._voxel.dataCoordinates);this._voxel.value=e===this._stack.numberOfChannels>1?"NA":a.MedicalUtils.rescaleSlopeIntercept(e,this._stack.rescaleSlope,this._stack.rescaleIntercept).toFixed()},updateDOM(){const e=this._label.querySelector(".lpsPosition"),t=this._label.querySelector(".ijkPosition"),r=this._label.querySelector(".value");e.innerHTML=`LPS: \n            ${this._voxel.worldCoordinates.x.toFixed(2)}, \n            ${this._voxel.worldCoordinates.y.toFixed(2)}, \n            ${this._voxel.worldCoordinates.z.toFixed(2)}`,t.innerHTML=`IJK: \n            ${this._voxel.dataCoordinates.x}, \n            ${this._voxel.dataCoordinates.y}, \n            ${this._voxel.dataCoordinates.z}`,r.innerHTML="Value: "+this._voxel.value,this.updateDOMColor();const n=this.adjustLabelTransform(this._label,this._handle.screenPosition,!0);this._label.style.transform=`translate3D(${n.x}px, ${n.y}px, 0)`},updateDOMColor(){this._label.style.borderColor=this._color},free(){this.removeEventListeners(),this.remove(this._handle),this._handle.free(),this.remove(this._moveHandle),this._moveHandle.free(),this._container.removeChild(this._label),this._stack=null,this._voxel=null},hideDOM(){this._label.style.display="none",this._handle.hideDOM()},showDOM(){this._label.style.display="",this._handle.showDOM()}}),Object.defineProperties(a.SketchVoxelProbe.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handle.targetMesh=e,this._moveHandle.targetMesh=e,this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handle.worldPosition.copy(e),this._moveHandle.worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},active:{get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}}}),a.SketchRuler=function(e,t,r){let n;r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchRuler",this._sketchType="Ruler",this._calibrationFactor=r.calibrationFactor||null,this._distance=null,this._units=this._calibrationFactor||r.pixelSpacing?"mm":"units",this._moving=!1,this._domHovered=!1,this._line=null,this._label=null,this._handles=[];for(let i=0;i<2;i++)n=new a.SketchHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new a.SketchHandle(e,t,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},a.SketchRuler.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchRuler,isSketchRuler:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.update())},create(){this.createDOM()},createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="sketch-label",this._container.appendChild(this._label),this.updateDOMColor()},hideDOM(){this._line.style.display="none",this._label.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update();const e=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor);this._distance=e.distance,e.units&&(this._units=e.units),this.updateDOM()},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px","units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the distance in mm"),this._label.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${this._units}`;let t=Math.abs(e.transformAngle);t>Math.PI/2&&(t=Math.PI-t);const r=Math.tan(t)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(t)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-t)+15,n=e.line.normalize().multiplyScalar(r),i=e.length>2*r?this._handles[1].screenPosition.clone().sub(n):this._handles[1].screenPosition.clone().add(n),a=this.adjustLabelTransform(this._label,i);this._label.style.transform=`translate3D(${a.x}px, ${a.y}px, 0)`},updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label)},getMeasurements(){return{distance:this._distance,units:this._units}}}),Object.defineProperties(a.SketchRuler.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="mm",this.update()}}}),a.SketchBiRuler=function(e,t,r){let n;r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchBiRuler",this._sketchType="BiRuler",this._calibrationFactor=r.calibrationFactor||null,this._distance=null,this._distance2=null,this._units=this._calibrationFactor||r.pixelSpacing?"mm":"units",this._line=null,this._label=null,this._line2=null,this._label2=null,this._dashline=null,this._handles=[];for(let i=0;i<3;i++)n=new a.SketchHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0,this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},a.SketchBiRuler.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchBiRuler,isSketchBiRuler:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover),this._line2.addEventListener("mouseenter",this.onHover),this._line2.addEventListener("mouseleave",this.onHover),this._label2.addEventListener("mouseenter",this.onHover),this._label2.addEventListener("mouseleave",this.onHover),this._dashline.addEventListener("mouseenter",this.onHover),this._dashline.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover),this._line2.removeEventListener("mouseenter",this.onHover),this._line2.removeEventListener("mouseleave",this.onHover),this._label2.removeEventListener("mouseenter",this.onHover),this._label2.removeEventListener("mouseleave",this.onHover),this._dashline.removeEventListener("mouseenter",this.onHover),this._dashline.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){this._handles.forEach(t=>t.onStart(e)),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this.update()},onMove(e){this._active?this._dragged=!0:(this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered,this._container.style.cursor=this._hovered?"pointer":"default"),this._handles.forEach(t=>t.onMove(e)),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=!1,this.update())},create(){this.createDOM()},createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="sketch-label",this._container.appendChild(this._label),this._line2=document.createElement("div"),this._line2.className="sketch-line",this._container.appendChild(this._line2),this._label2=document.createElement("div"),this._label2.className="sketch-label",this._container.appendChild(this._label2),this._dashline=document.createElement("div"),this._dashline.className="sketch-dashline",this._container.appendChild(this._dashline),this.updateDOMColor()},hideDOM(){this._line.style.display="none",this._label.style.display="none",this._line2.style.display="none",this._label2.style.display="none",this._dashline.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._label.style.display="",this._line2.style.display="",this._label2.style.display="",this._dashline.style.display="",this._handles.forEach(e=>e.showDOM())},update(){this.updateColor(),this._handles.forEach(e=>e.update()),this.updateDOM()},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=this.getLineData(this._handles[0].screenPosition,this._handles[2].screenPosition);this._line2.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0) rotate(${t.transformAngle}rad)`,this._line2.style.width=t.length+"px";const r=this._handles[0].worldPosition.clone().add(this._handles[1].worldPosition).multiplyScalar(.5),n=this._handles[0].worldPosition.clone().add(this._handles[2].worldPosition).multiplyScalar(.5),i=this.getLineData(this.worldToScreen(r),this.worldToScreen(n));this._dashline.style.transform=`translate3D(${i.transformX}px, ${i.transformY}px, 0) rotate(${i.transformAngle}rad)`,this._dashline.style.width=i.length+"px";const a=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor),o=this.getDistanceData(this._handles[0].worldPosition,this._handles[2].worldPosition,this._calibrationFactor),s="Calibration is required to display the distance in mm";this._distance=a.distance,this._distance2=o.distance,a.units&&o.units&&a.units===o.units?this._units=a.units:(a.units||(a.units=this._units),o.units||(o.units=this._units)),"units"!==a.units||this._label.hasAttribute("title")?"units"!==a.units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",s),this._label.style.color=this._colors.error),"units"!==o.units||this._label2.hasAttribute("title")?"units"!==o.units&&this._label2.hasAttribute("title")&&(this._label2.removeAttribute("title"),this._label2.style.color=this._colors.text):(this._label2.setAttribute("title",s),this._label2.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${a.units}`,this._label2.innerHTML=`${this._distance2.toFixed(2)} ${o.units}`;let l=Math.abs(e.transformAngle);l>Math.PI/2&&(l=Math.PI-l);const u=Math.tan(l)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(l)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-l)+15,c=e.line.normalize().multiplyScalar(u),h=e.length>2*u?this._handles[1].screenPosition.clone().sub(c):this._handles[1].screenPosition.clone().add(c),d=this.adjustLabelTransform(this._label,h);this._label.style.transform=`translate3D(${d.x}px, ${d.y}px, 0)`;let f=Math.abs(t.transformAngle);f>Math.PI/2&&(f=Math.PI-f);const p=Math.tan(f)<this._label2.offsetHeight/this._label2.offsetWidth?this._label2.offsetWidth/2/Math.cos(f)+15:this._label2.offsetHeight/2/Math.cos(Math.PI/2-f)+15,m=t.line.normalize().multiplyScalar(p),g=t.length>2*p?this._handles[2].screenPosition.clone().sub(m):this._handles[2].screenPosition.clone().add(m),v=this.adjustLabelTransform(this._label2,g);this._label2.style.transform=`translate3D(${v.x}px, ${v.y}px, 0)`},updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color,this._line2.style.backgroundColor=this._color,this._label2.style.borderColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label),this._container.removeChild(this._line2),this._container.removeChild(this._label2),this._container.removeChild(this._dashline)},getDistances(){return[this._distance,this._distance2]}}),Object.defineProperties(a.SketchBiRuler.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach(t=>t.worldPosition.copy(e)),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="mm",this.update()}},shotestDistance:{get:function(){return this._distance<this._distance2?this._distance:this._distance2}},longestDistance:{get:function(){return this._distance>this._distance2?this._distance:this._distance2}}}),a.SketchAngle=function(e,t,r){let n;r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchAngle",this._sketchType="Angle",this._opangle=null,this._moving=!1,this._domHovered=!1,this._defaultAngle=!0,this._line=null,this._line2=null,this._label=null,this._handles=[];for(let i=0;i<3;i++)n=new a.SketchHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0,this._moveHandle=new a.SketchHandle(e,t,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()},a.SketchAngle.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchAngle,isSketchAngle:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._line2.addEventListener("mouseenter",this.onHover),this._line2.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._line2.removeEventListener("mouseenter",this.onHover),this._line2.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._handles[2].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._domHovered,!this._domHovered||this._handles[1].tracking||this._handles[2].tracking||(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this._handles[2].onMove(e),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||!this._handles[1].tracking&&this._handles[2].tracking&&this._handles[1].screenPosition.distanceTo(this._handles[2].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=this._handles[2].tracking,this._moving=!1,this.update())},create(){this.createDOM()},createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._line2=document.createElement("div"),this._line2.className="sketch-line",this._container.appendChild(this._line2),this._label=document.createElement("div"),this._label.className="sketch-label",this._container.appendChild(this._label),this.updateDOMColor()},hideDOM(){this._line.style.display="none",this._line2.style.display="none",this._label.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._line2.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM(),this._handles[2].showDOM()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this._handles[2].update(),this._opangle=180*this._handles[1].worldPosition.clone().sub(this._handles[0].worldPosition).angleTo(this._handles[1].worldPosition.clone().sub(this._handles[2].worldPosition))/Math.PI||0,this._opangle=this._defaultAngle?this._opangle:360-this._opangle,this.updateDOM()},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[1].screenPosition,this._handles[0].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=this.getLineData(this._handles[1].screenPosition,this._handles[2].screenPosition);this._line2.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0) rotate(${t.transformAngle}rad)`,this._line2.style.width=t.length+"px",this._label.innerHTML=this._opangle.toFixed(2)+"&deg;";let r=e.line.clone().add(t.line).normalize().negate(),n=r.angleTo(new THREE.Vector3(1,0,0));n>Math.PI/2&&(n=Math.PI-n);const i=Math.tan(n)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(n)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-n)+15,a=this._handles[1].screenPosition.clone().add(r.multiplyScalar(i)),o=this.adjustLabelTransform(this._label,a);this._label.style.transform=`translate3D(${o.x}px, ${o.y}px, 0)`},updateDOMColor(){this._line.style.backgroundColor=this._color,this._line2.style.backgroundColor=this._color,this._label.style.borderColor=this._color},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._line2),this._container.removeChild(this._label)},toggleDefaultAngle(){this._defaultAngle=!this._defaultAngle}}),Object.defineProperties(a.SketchAngle.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._handles[2].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},angle:{get:function(){return this._opangle}}}),a.SketchRectangle=function(e,t,r){let n;r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchRectangle",this._sketchType="Rectangle",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,r.stack.frame.length>r.frameIndex?this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units":this._units="units",this._moving=!1,this._domHovered=!1,this._mesh=null,this._rectangle=null,this._label=null,this._handles=[];for(let i=0;i<2;i++)n=new a.SketchHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new a.SketchHandle(e,t,r),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners(),this._newPos1=new THREE.Vector3,this._newPos2=new THREE.Vector3},a.SketchRectangle.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchRectangle,isSketchRectangle:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._rectangle.addEventListener("mouseenter",this.onHover),this._rectangle.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._rectangle.removeEventListener("mouseenter",this.onHover),this._rectangle.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){this._moveHandle.onMove(e,!0),this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){if(this._active){const t=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(e,!0),this._moving&&this._handles.slice(0,-1).forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))}),this.updateRoI(!0)}else this.onHover(null);this._handles[0].onMove(e),this._handles[1].onMove(e),this.update()},onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.updateRoI(),this.update())},hideDOM(){this._handles.forEach(e=>e.hideDOM()),this._rectangle.style.display="none",this._label.style.display="none"},showDOM(){this._handles[0].showDOM(),this._handles[1].showDOM(),this._rectangle.style.display="",this._label.style.display=""},create(){this.createMesh(),this.createDOM()},createMesh(){let e=new THREE.PlaneGeometry(1,1),t=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2});this._mesh=new THREE.Mesh(e,t),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},createDOM(){this._rectangle=document.createElement("div"),this._rectangle.className="sketch-rectangle",this._container.appendChild(this._rectangle),this._label=document.createElement("div"),this._label.className="sketch-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let r=document.createElement("div");r.className="max-min",e.appendChild(r);let n=document.createElement("div");n.className="area",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()},updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)},updateMeshPosition(){if(this._mesh){let e=this._mesh.geometry;const t=this._newPos1.subVectors(this._handles[1].worldPosition,this._handles[0].worldPosition).projectOnVector(this._camera.up);e.vertices[0].copy(this._handles[0].worldPosition),e.vertices[1].copy(this._newPos2.addVectors(this._handles[0].worldPosition,t)),e.vertices[2].copy(this._newPos2.subVectors(this._handles[1].worldPosition,t)),e.vertices[3].copy(this._handles[1].worldPosition),e.verticesNeedUpdate=!0,e.computeBoundingSphere()}},updateRoI(e){const t=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min");if(e)return t.innerHTML="",void(r.innerHTML="");const n=a.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==n?(t.innerHTML=`Mean: ${n.mean.toFixed(1)} / SD: ${n.sd.toFixed(1)}`,r.innerHTML=`Max: ${n.max.toFixed()} / Min: ${n.min.toFixed()}`):(t.innerHTML="",r.innerHTML="")},updateDOMColor(){this._rectangle.style.borderColor=this._color,this._label.style.borderColor=this._color},updateDOM(){this.updateDOMColor();let e=[];if(this._stack.frame.length>this._params.frameIndex&&(e=this._stack.frame[this._params.frameIndex].ultrasoundRegions),this._area=a.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(e&&e.length>0&&this._stack.lps2IJK){const t=this.getRegionByXY(e,a.MedicalUtils.worldToData(this._stack.lps2IJK,this._handles[0].worldPosition)),r=this.getRegionByXY(e,a.MedicalUtils.worldToData(this._stack.lps2IJK,this._handles[1].worldPosition));null!==t&&null!==r&&t===r&&"cm"===e[t].unitsX&&"cm"===e[t].unitsY?(this._area*=Math.pow(e[t].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);"units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the area in cm²"),this._label.style.color=this._colors.error),this._label.querySelector(".area").innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`;const t=this.getRectData(this._handles[0].screenPosition,this._handles[1].screenPosition),r=this.adjustLabelTransform(this._label,this._handles[1].screenPosition.clone().add(t.paddingVector.multiplyScalar(15+this._label.offsetHeight/2)));this._rectangle.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)`,this._rectangle.style.width=t.width+"px",this._rectangle.style.height=t.height+"px",this._label.style.transform="translate3D("+r.x+"px,"+r.y+"px, 0)"},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._rectangle),this._container.removeChild(this._label),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._stack=null},getMeasurements(){return{area:this._area,units:this._units}}}),Object.defineProperties(a.SketchRectangle.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update(),this.updateRoI()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}}),a.SketchPolygon=function(e,t,r){r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchPolygon",this._sketchType="Polygon",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._newHandleRequired=!0,this._moving=!1,this._domHovered=!1,this._material=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];let n=new a.SketchHandle(e,t,r);this.add(n),this._handles.push(n),this._moveHandle=new a.SketchHandle(e,t,r),this.add(this._moveHandle),this._moveHandle.hide(),this.onRightClick=this.onRightClick.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()},a.SketchPolygon.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchPolygon,isSketchPolygon:!0,addEventListeners(){this._container.addEventListener("rightclick",this.onRightClick),this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("rightclick",this.onRightClick),this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e);let t=!1;this._handles.forEach(e=>t=t||e.hovered),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){let t=!1;this._handles.forEach(r=>{r.onStart(e),t=t||r.active}),this._initialized&&(this._moveHandle.onMove(e,!0),this._active=t||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update())},onMove(e){let t=!1;if(this.active)if(this._dragged=!0,this._newHandleRequired&&!this._initialized){this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let e=new a.SketchHandle(this._targetMesh,this._controls,this._params);e.hovered=!0,e.active=!0,e.tracking=!0,this.add(e),this._handles.push(e),this.createLine(),this._newHandleRequired=!1}else{const t=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(e,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}this._handles.forEach(r=>{r.onMove(e),t=t||r.hovered}),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.update()},onEnd(){let e=this._handles.length,t=!1;!this._initialized&&e>1&&this._handles[e-2].screenPosition.distanceTo(this._handles[e-1].screenPosition)<10||(this._handles.forEach(e=>{e.onEnd(),t=t||e.active}),this._initialized?(this._dragged&&(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach(e=>e.selected=this._selected)),this._active=t||this._handles[e-1].active,this._dragged=!1,this._moving=!1,this.update()):this._newHandleRequired=!0)},onRightClick(){let e=this._handles.length;e<3||this._initialized||e>1&&this._handles[e-2].screenPosition.distanceTo(this._handles[e-1].screenPosition)<10||(this._handles[e-1].tracking=!1,this._handles.forEach(e=>e.onEnd()),this._active=!1,this._dragged=!1,this._moving=!1,this._initialized=!0,this.updateMesh(),this.updateDOMContent(),this.update())},create(){this.createMaterial(),this.createDOM()},createMaterial(){this._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2})},createDOM(){this.createLine(),this._label=document.createElement("div"),this._label.className="sketch-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let r=document.createElement("div");r.className="max-min",e.appendChild(r);let n=document.createElement("div");n.className="area",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},createLine(){const e=document.createElement("div");e.className="sketch-line",e.addEventListener("mouseenter",this.onHover),e.addEventListener("mouseleave",this.onHover),this._lines.push(e),this._container.appendChild(e)},hideDOM(){this._handles.forEach(e=>e.hideDOM()),this._lines.forEach(e=>e.style.display="none"),this._label.style.display="none"},showDOM(){this._handles.forEach(e=>e.showDOM()),this._lines.forEach(e=>e.style.display=""),this._label.style.display=""},update(){this.updateColor(),this._handles.forEach(e=>e.update()),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()},updateMesh(){let e=[];this._handles.forEach(t=>e.push(t.worldPosition));let t,r,n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,s=a.MedicalUtils.centerOfMass(e);n.crossVectors(i.subVectors(e[0],s),o.subVectors(e[1],s)),i.subVectors(e[0],s).normalize(),o.crossVectors(i,n).normalize();let l=new THREE.Shape,u=new Float32Array(3*(e.length+1));n.subVectors(e[0],s),t=i.dot(n),r=o.dot(n),l.moveTo(t,r),u.set(e[0].toArray(),0);for(let a=1;a<e.length;a++)n.subVectors(e[a],s),t=i.dot(n),r=o.dot(n),l.lineTo(t,r),u.set(e[a].toArray(),3*a);n.subVectors(e[0],s),t=i.dot(n),r=o.dot(n),l.lineTo(t,r),u.set(e[0].toArray(),3*e.length);let c=new THREE.ShapeBufferGeometry(l,e.length);c.setAttribute("position",new THREE.BufferAttribute(u,3)),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose()),this._mesh=new THREE.Mesh(c,this._material),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)},updateMeshPosition(){},updateDOMColor(){this._lines.forEach(e=>e.style.backgroundColor=this._color),this._label.style.borderColor=this._color},updateDOMContent(e){const t=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min"),n=this._label.querySelector(".area");if(e)return t.innerHTML="",r.innerHTML="",void(n.innerHTML="");const i=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=a.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(i&&i.length>0&&this._stack.lps2IJK){let e,t,r=!0;this._handles.forEach(n=>{e=this.getRegionByXY(i,a.MedicalUtils.worldToData(this._stack.lps2IJK,n.worldPosition)),(null===e||"cm"!==i[e].unitsX||void 0!==t&&t!==e)&&(r=!1),t=e}),r?(this._area*=Math.pow(i[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let o="units"===this._units?"Calibration is required to display the area in cm². ":"";""===o||this._label.hasAttribute("title")?""===o&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",o),this._label.style.color=this._colors.error);const s=a.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==s?(t.innerHTML=`Mean: ${s.mean.toFixed(1)} / SD: ${s.sd.toFixed(1)}`,r.innerHTML=`Max: ${s.max.toFixed()} / Min: ${s.min.toFixed()}`):(t.innerHTML="",r.innerHTML=""),n.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`},updateDOMPosition(){let e=null;this._lines.forEach((t,r)=>{const n=this.getLineData(this._handles[r].screenPosition,this._handles[r+1===this._handles.length?0:r+1].screenPosition);t.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0) rotate(${n.transformAngle}rad)`,t.style.width=n.length+"px",(null===e||e.y<this._handles[r].screenPosition.y)&&(e=this._handles[r].screenPosition.clone())}),this._initialized&&(e.y+=15+this._label.offsetHeight/2,e=this.adjustLabelTransform(this._label,e),this._label.style.transform=`translate3D(${e.x}px, ${e.y}px, 0)`)},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach(e=>{e.removeEventListener("mouseenter",this.onHover),e.removeEventListener("mouseleave",this.onHover),this._container.removeChild(e)}),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null),this._stack=null},getMeasurements(){return{area:this._area,units:this._units}}}),Object.defineProperties(a.SketchPolygon.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this._moveHandle.targetMesh=e,this.updateMesh(),this.updateDOMContent(),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach(t=>t.worldPosition.copy(e)),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}}),a.SketchFreehand=function(e,t,r){r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchFreehand",this._sketchType="Freehand",this._stack=r.stack,this._calibrationFactor=r.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||r.stack.frame[r.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._moving=!1,this._domHovered=!1,this._material=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];let n=new a.SketchHandle(e,t,r);this.add(n),this._handles.push(n),this._moveHandle=new a.SketchHandle(e,t,r),this.add(this._moveHandle),this._moveHandle.hide(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()},a.SketchFreehand.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchFreehand,isSketchFreehand:!0,addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e);let t=!1;this._handles.forEach(e=>t=t||e.hovered),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onStart(e){let t=!1;this._moveHandle.onMove(e,!0),this._handles.forEach(r=>{r.onStart(e),t=t||r.active}),this._active=t||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update()},onMove(e){let t=!1;if(this.active)if(this._dragged=!0,this._initialized){const t=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(e,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach(e=>{e.worldPosition.add(this._moveHandle.worldPosition.clone().sub(t))})}else{this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let e=new a.SketchHandle(this._targetMesh,this._controls,this._params);e.hovered=!0,e.active=!0,e.tracking=!0,this.add(e),this._handles.push(e),this.createLine()}this._handles.forEach(r=>{r.onMove(e),t=t||r.hovered}),this._hovered=t||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.active&&this._handles.length>2&&this.pushPopHandle(),this.update()},onEnd(){if(this._handles.length<3)return;let e=!1;this._handles.slice(0,-1).forEach(t=>{t.onEnd(),e=e||t.active}),this._dragged||!this._handles[this._handles.length-1].tracking?(this._handles[this._handles.length-1].tracking=!1,this._handles[this._handles.length-1].onEnd()):this._handles[this._handles.length-1].tracking=!1,this._lines.length<this._handles.length&&this.createLine(),!this._dragged&&this._initialized||(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach(e=>e.selected=this._selected)),this._active=e||this._handles[this._handles.length-1].active,this._dragged=!1,this._moving=!1,this._initialized=!0,this.update()},create(){this.createMaterial(),this.createDOM()},createMaterial(){this._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.2})},createDOM(){this._label=document.createElement("div"),this._label.className="sketch-label";const e=document.createElement("div");let t=document.createElement("div");t.className="mean-sd",e.appendChild(t);let r=document.createElement("div");r.className="max-min",e.appendChild(r);let n=document.createElement("div");n.className="area",e.appendChild(n),this._label.appendChild(e),this._container.appendChild(this._label),this.updateDOMColor()},createLine(){const e=document.createElement("div");e.className="sketch-line",e.addEventListener("mouseenter",this.onHover),e.addEventListener("mouseleave",this.onHover),this._lines.push(e),this._container.appendChild(e)},hideDOM(){this._handles.forEach(e=>e.hideDOM()),this._lines.forEach(e=>e.style.display="none"),this._label.style.display="none"},showDOM(){this._handles.forEach(e=>e.showDOM()),this._lines.forEach(e=>e.style.display=""),this._label.style.display=""},update(){this.updateColor(),this._handles.forEach(e=>e.update()),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()},updateMesh(){let e=[];this._handles.forEach(t=>e.push(t.worldPosition));let t,r,n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,s=a.MedicalUtils.centerOfMass(e);n.crossVectors(i.subVectors(e[0],s),o.subVectors(e[1],s)),i.subVectors(e[0],s).normalize(),o.crossVectors(i,n).normalize();let l=new THREE.Shape,u=new Float32Array(3*(e.length+1));n.subVectors(e[0],s),t=i.dot(n),r=o.dot(n),l.moveTo(t,r),u.set(e[0].toArray(),0);for(let a=1;a<e.length;a++)n.subVectors(e[a],s),t=i.dot(n),r=o.dot(n),l.lineTo(t,r),u.set(e[a].toArray(),3*a);n.subVectors(e[0],s),t=i.dot(n),r=o.dot(n),l.lineTo(t,r),u.set(e[0].toArray(),3*e.length);let c=new THREE.ShapeBufferGeometry(l,e.length);c.setAttribute("position",new THREE.BufferAttribute(u,3)),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose()),this._mesh=new THREE.Mesh(c,this._material),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},updateMeshColor(){this._mesh&&this._mesh.material.color.set(this._color)},updateMeshPosition(){},isPointOnLine(e,t,r){let n=new THREE.Vector3;return n.crossVectors(e.clone().sub(r),t.clone().sub(r)),!n.length()},pushPopHandle(){let e=this._handles[this._handles.length-3],t=this._handles[this._handles.length-2],r=this._handles[this._handles.length-1],n=this.isPointOnLine(e.worldPosition,t.worldPosition,r.worldPosition);return(n||e.screenPosition.distanceTo(r.screenPosition)<25)&&(this.remove(t),t.free(),this._handles[this._handles.length-2]=r,this._handles.pop(),this._container.removeChild(this._lines.pop())),n},updateDOMColor(){this._handles.length>=2&&this._lines.forEach(e=>e.style.backgroundColor=this._color),this._label.style.borderColor=this._color},updateDOMContent(e){const t=this._label.querySelector(".mean-sd"),r=this._label.querySelector(".max-min"),n=this._label.querySelector(".area");if(e)return t.innerHTML="",r.innerHTML="",void(n.innerHTML="");const i=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=a.MedicalUtils.getGeometryArea(this._mesh.geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(i&&i.length>0&&this._stack.lps2IJK){let e,t,r=!0;this._handles.forEach(n=>{e=this.getRegionByXY(i,a.MedicalUtils.worldToData(this._stack.lps2IJK,n.worldPosition)),(null===e||"cm"!==i[e].unitsX||void 0!==t&&t!==e)&&(r=!1),t=e}),r?(this._area*=Math.pow(i[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let o="units"===this._units?"Calibration is required to display the area in cm². ":"";""===o||this._label.hasAttribute("title")?""===o&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",o),this._label.style.color=this._colors.error);const s=a.MedicalUtils.getRoI(this._mesh,this._controls,this._stack);null!==s?(t.innerHTML=`Mean: ${s.mean.toFixed(1)} / SD: ${s.sd.toFixed(1)}`,r.innerHTML=`Max: ${s.max.toFixed()} / Min: ${s.min.toFixed()}`):(t.innerHTML="",r.innerHTML=""),n.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`},updateDOMPosition(){if(this._handles.length<2)return;let e=null;this._lines.forEach((t,r)=>{const n=this.getLineData(this._handles[r].screenPosition,this._handles[r+1===this._handles.length?0:r+1].screenPosition);t.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0) rotate(${n.transformAngle}rad)`,t.style.width=n.length+"px",(null===e||e.y<this._handles[r].screenPosition.y)&&(e=this._handles[r].screenPosition.clone())}),this._initialized&&(e.y+=15+this._label.offsetHeight/2,e=this.adjustLabelTransform(this._label,e),this._label.style.transform=`translate3D(${e.x}px, ${e.y}px, 0)`)},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach(e=>{e.removeEventListener("mouseenter",this.onHover),e.removeEventListener("mouseleave",this.onHover),this._container.removeChild(e)}),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null),this._stack=null},getMeasurements(){return{area:this._area,units:this._units}}}),Object.defineProperties(a.SketchFreehand.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this._moveHandle.targetMesh=e,this.updateMesh(),this.updateDOMContent(),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles.forEach(t=>t._worldPosition.copy(e)),this._worldPosition.copy(e),this.update()}},calibrationFactor:{get:function(){return this._calibrationFactor},set:function(e){this._calibrationFactor=e,this._units="cm²",this.update()}}}),a.SketchAnnotation=function(e,t,r){let n;r=r||{},a.SketchBase.call(this,e,t,r),this.name="sketchAnnotation",this._sketchType="Annotation",this._initialized=!1,this._movinglabel=null,this._labelmoved=!1,this._labelhovered=!1,this._manuallabeldisplay=!1,this._meshline=null,this._meshCone=null,this._line=null,this._dashline=null,this._label=null,this._labeltext=null,this._labelOffset=new THREE.Vector3,this._mouseLabelOffset=new THREE.Vector3,this._handles=[];for(let i=0;i<2;i++)n=new a.SketchHandle(e,t,r),this.add(n),this._handles.push(n);this._handles[1].active=!0,this.create(),this.initOffsets(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.onHoverlabel=this.onHoverlabel.bind(this),this.notonHoverlabel=this.notonHoverlabel.bind(this),this.changeLabelText=this.changeLabelText.bind(this),this.addEventListeners()},a.SketchAnnotation.prototype=Object.assign(Object.create(a.SketchBase.prototype),{constructor:a.SketchAnnotation,isSketchAnnotation:!0,addEventListeners(){this._label.addEventListener("mouseenter",this.onHoverlabel),this._label.addEventListener("mouseleave",this.notonHoverlabel),this._label.addEventListener("dblclick",this.changeLabelText),this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._dashline.addEventListener("mouseenter",this.onHover),this._dashline.addEventListener("mouseleave",this.onHover)},removeEventListeners(){this._label.removeEventListener("mouseenter",this.onHoverlabel),this._label.removeEventListener("mouseleave",this.notonHoverlabel),this._label.removeEventListener("dblclick",this.changeLabelText),this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._dashline.removeEventListener("mouseenter",this.onHover),this._dashline.removeEventListener("mouseleave",this.onHover)},onHover(e){e&&this.hoverDom(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},hoverDom(e){this._domHovered="mouseenter"===e.type},onHoverlabel(){this._labelhovered=!0,this._container.style.cursor="pointer"},notonHoverlabel(){this._labelhovered=!1,this._container.style.cursor="default"},onStart(e){if(this._labelhovered){const t=this.getMouseOffsets(e,this._container),r=this._handles[1].screenPosition.clone().sub(this._labelOffset);this._mouseLabelOffset=new THREE.Vector3(t.screenX-r.x,t.screenY-r.y,0),this._movinglabel=!0,this._labelmoved=!0}this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._labelhovered,this.update()},onMove(e){if(this._movinglabel){const t=this.getMouseOffsets(e,this._container);this._labelOffset=new THREE.Vector3(this._handles[1].screenPosition.x-t.screenX+this._mouseLabelOffset.x,this._handles[1].screenPosition.y-t.screenY+this._mouseLabelOffset.y,0),this._controls.enabled=!1}this._active&&(this._dragged=!0),this._handles[0].onMove(e),this._handles[1].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._labelhovered,this.update()},onEnd(){this._handles[0].onEnd(),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handles[0].selected=this._selected,this._handles[1].selected=this._selected),this._initialized||(this._labelOffset=this._handles[1].screenPosition.clone().sub(this._handles[0].screenPosition).multiplyScalar(.5),this.setLabelText(),this._initialized=!0),this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._movinglabel=!1,this.update()},setLabelText(){for(;!this._labeltext;)this._labeltext=prompt("Please enter the annotation text.","");this.displayLabel()},changeLabelText(e){e.stopPropagation();let t=this._labeltext;this._labeltext=prompt("Please enter a new annotation text.",this._label.innerHTML),null===this._labeltext&&(this._labeltext=t),this.displayLabel()},displayLabel(){this._label.innerHTML="string"==typeof this._labeltext&&this._labeltext.length>0?this._labeltext:"",this._label.style.display="",this._dashline.style.display="",this._label.style.transform=`translate3D(\n        ${this._handles[1].screenPosition.x-this._labelOffset.x-this._label.offsetWidth/2}px,\n        ${this._handles[1].screenPosition.y-this._labelOffset.y-this._label.offsetHeight/2-this._container.offsetHeight}px, 0)`},create(){this.createMesh(),this.createDOM()},createMesh(){let e=new THREE.LineBasicMaterial,t=new THREE.Geometry;t.vertices.push(this._handles[0].worldPosition),t.vertices.push(this._handles[1].worldPosition),this._meshline=new THREE.Line(t,e),this._meshline.visible=!0,this.add(this._meshline),t=new THREE.CylinderGeometry(0,2,10),t.translate(0,-5,0),t.rotateX(-Math.PI/2),this._meshCone=new THREE.Mesh(t,e),this._meshCone.visible=!0,this.add(this._meshCone),this.updateMeshColor()},createDOM(){this._line=document.createElement("div"),this._line.className="sketch-line",this._container.appendChild(this._line),this._dashline=document.createElement("div"),this._dashline.className="sketch-dashline",this._dashline.style.display="none",this._container.appendChild(this._dashline),this._label=document.createElement("div"),this._label.className="sketch-label",this._label.style.display="none",this._container.appendChild(this._label),this.updateDOMColor()},update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()},updateMeshColor(){this._meshline&&this._meshline.material.color.set(this._color)},updateMeshPosition(){this._meshline&&(this._meshline.geometry.verticesNeedUpdate=!0),this._meshCone&&(this._meshCone.position.copy(this._handles[1].worldPosition),this._meshCone.lookAt(this._handles[0].worldPosition))},updateDOM(){this.updateDOMColor();const e=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0) rotate(${e.transformAngle}rad)`,this._line.style.width=e.length+"px";const t=e.line.multiplyScalar(.5),r=this._handles[1].screenPosition.clone().sub(this._labelmoved?this._labelOffset:t),n=this.adjustLabelTransform(this._label,r);this._label.style.transform=`translate3D(${n.x}px, ${n.y}px, 0)`,this._manuallabeldisplay&&this.displayLabel();let i=this.getLineData(this._handles[0].screenPosition,r),a=this.getLineData(e.center,r),o=this.getLineData(this._handles[1].screenPosition,r);i.length>a.length&&(i=a),i.length>o.length&&(i=o),this._dashline.style.transform=`translate3D(${i.transformX}px, ${i.transformY}px, 0) rotate(${i.transformAngle}rad)`,this._dashline.style.width=i.length+"px"},updateDOMColor(){this._line.style.backgroundColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color,this._label.style.borderColor=this._color},hideDOM(){this._line.style.display="none",this._dashline.style.display="none",this._label.style.display="none",this._handles.forEach(e=>e.hideDOM())},showDOM(){this._line.style.display="",this._dashline.style.display="",this._label.style.display="",this._handles.forEach(e=>e.showDOM())},free(){this.removeEventListeners(),this._handles.forEach(e=>{this.remove(e),e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._dashline),this._container.removeChild(this._label),this.remove(this._meshline),this._meshline.geometry.dispose(),this._meshline.material.dispose(),this._meshline=null,this.remove(this._meshCone),this._meshCone.geometry.dispose(),this._meshCone=null}}),Object.defineProperties(a.SketchAnnotation.prototype,{targetMesh:{get:function(){return this._targetMesh},set:function(e){this._targetMesh=e,this._handles.forEach(t=>t.targetMesh=e),this.update()}},worldPosition:{get:function(){return this._worldPosition},set:function(e){this._handles[0].worldPosition.copy(e),this._handles[1].worldPosition.copy(e),this._worldPosition.copy(e),this.update()}}}),a.removeMedicalWorkspace=function(e){e=void 0===e||e;var t=a.MedicalWorker;t.workspace="",!0===e&&t.stack&&(t.stack.dispose(),t.stack=null),t.medical&&(a.dispose(t.medical),t.medical=null,t.sketches=[]),t.medicalDom&&(a.removeHTMLElement(t.medicalDom),t.medicalDom=null,t.elements=[])},a.createMedicalWorkspace=function(e,t,r){var n=a.MedicalWorker;n.stack=e,n.workspace=t||"quadWorkspace","quadWorkspace"===n.workspace?function(e){var t=a.MedicalWorker;t.prepareStack(e);var[r,n,i]=t.getMedicalSlicers(e),o=t.getMedicalVolume(e),s=t.getMedicalIsosurface(e),l=t.getStackCenter(e),u=1.2*t.getStackSize(e),c=t.getAppWorks(),h=c.width,d=c.height,f=~~(h/2),p=~~(d/2),m=new THREE.Object3D;m.name="medical",a.add(m);var g=document.createElement("div");g.id="medicalDom",g.style.cssText="position:absolute; top:0; width:100%; height:100%; overflow:hidden; z-index:0;",c.dom.appendChild(g),t.workspace="quadWorkspace",t.medical=m,t.medicalDom=g,t.stackSize=u;for(var v="\n        z-index: 1;\n        color: #fff;\n        font-size: 16px;\n        position: absolute;\n        padding: 4px;\n        border-radius: 50%;\n        width: 18px;\n        height: 18px;\n        text-align: center;\n        vertical-align: middle;\n        line-height: 18px;\n        background-color: rgba(0, 0, 0, 0.3);\n    ",y=`<div class="scene" style="width: ${f}px; height: ${p}px;"></div>\n        <div id="leftLabel" style="${v}"></div>\n        <div id="rightLabel" style="${v}"></div>\n        <div id="topLabel" style="${v}"></div>\n        <div id="bottomLabel" style="${v}"></div>`,_={0:["L","R","A","P"],2:["A","P","S","I"],3:["R","L","S","I"]},b=0;b<4;b++){var E=new THREE.Scene;switch(E.name="scene"+b,b){case 0:E.add(i);break;case 1:E.add(o),E.children.push(i),E.children.push(r),E.children.push(n),E.children.push(s);break;case 2:E.add(r);break;case 3:E.add(n)}var w=document.createElement("div");w.style.cssText="position: relative; display: inline-block; margin-bottom: -4px; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",w.innerHTML=y,C(w,b),g.appendChild(w);var x,T=w.querySelector(".scene");if(T.id=b,E.userData.element=T,t.elements.push(T),1===b){var M=(k=T.getBoundingClientRect()).width/k.height,S=.1,A=10*u,R=new THREE.PerspectiveCamera(50,M,S,A);E.userData.camera=R,R.up.set(0,0,1),R.position.copy(l),R.position.y-=u,R.lookAt(l),o.uniforms.uCameraNear.value=R.near,o.uniforms.uCameraFar.value=R.far}else{M=(k=T.getBoundingClientRect()).width/k.height,S=.1,A=2*u;var k,P=u,L=u*M;R=new THREE.OrthographicCamera(-L/2,L/2,P/2,-P/2,S,A);switch(E.userData.camera=R,b){case 0:R.up.set(0,-1,0),R.position.copy(l),R.position.z+=u;break;case 2:R.up.set(0,0,1),R.position.copy(l),R.position.x+=u;break;case 3:R.up.set(0,0,1),R.position.copy(l),R.position.y-=u}R.lookAt(l)}if(1===b)(x=new THREE.TrackballControls(R,T)).target.copy(l),x.panSpeed=.3,x.rotateSpeed=2,x.zoomSpeed=1.2,x.dynamicDampingFactor=.3,E.userData.controls=x,x.addEventListener("start",e=>{let t=a.MedicalWorker;if(t.elementDblClicked){a.appWorks.renderer.setPixelRatio(.5*window.devicePixelRatio),t.volumeSteps=o.uniforms.uSteps.value,o.uniforms.uSteps.value=Math.min(o.uniforms.uSteps.value,128)}}),x.addEventListener("end",e=>{let t=a.MedicalWorker;if(t.elementDblClicked){let e=a.appWorks.renderer;e.setPixelRatio(.75*window.devicePixelRatio),setTimeout(()=>{e.setPixelRatio(window.devicePixelRatio)},100),o.uniforms.uSteps.value=t.volumeSteps}});else(x=new THREE.OrthographicTrackballControls(R,T)).target.copy(l),x.panSpeed=.3,x.rotateSpeed=1,x.zoomSpeed=1.2,x.dynamicDampingFactor=.3,x.noRotate=!0,E.userData.controls=x;T.addEventListener("mouseenter",t.onMouseEnter,!1),T.addEventListener("mouseleave",t.onMouseLeave,!1),T.addEventListener("click",t.onClick,!1),T.addEventListener("dblclick",t.onDoubleClick,!1),T.addEventListener("mousedown",t.onMouseDown,!1),T.addEventListener("mouseup",t.onMouseUp,!1),T.addEventListener("mousemove",t.onMouseMove,!1),window.addEventListener("resize",t.onWindowResize,!1),m.add(E)}function C(e,t){let r;if(1===t)return r=e.querySelector("#leftLabel"),r.remove(),r=e.querySelector("#rightLabel"),r.remove(),r=e.querySelector("#topLabel"),r.remove(),r=e.querySelector("#bottomLabel"),void r.remove();r=e.querySelector("#leftLabel"),r.style.left="0",r.style.top="50%",r.textContent=_[t][0],r=e.querySelector("#rightLabel"),r.style.right="0",r.style.top="50%",r.textContent=_[t][1],r=e.querySelector("#topLabel"),r.style.top="0",r.style.left="50%",r.textContent=_[t][2],r=e.querySelector("#bottomLabel"),r.style.bottom="0",r.style.left="50%",r.textContent=_[t][3]}c.signals.initSidebar.dispatch(t),m.update=function(e,r){t.onUpdateMedical(e,r)}}(e):"slicesWorkspace"===n.workspace&&function(e,t){t=void 0!==t?t:2;var r=a.MedicalWorker;r.prepareStack(e);var n,i,[o,s,l]=e.worldSliceOrientation(),u=e.dimensionsIJK,c=e.worldCenter(),h=r.getStackSize(e);switch(t){case 0:n=o;break;case 1:n=s;break;case 2:n=l}switch(n){case 0:i=u.x-1;break;case 1:i=u.y-1;break;case 2:i=u.z-1}var d=new THREE.Vector3,f=new THREE.Vector3;switch(t){case 0:d.set(0,0,1),f.copy(c),f.x+=h;break;case 1:d.set(0,0,1),f.copy(c),f.y-=h;break;case 2:d.set(0,-1,0),f.copy(c),f.z+=h}var p=r.getAppWorks(),m=new THREE.Object3D;m.name="medical",a.add(m),document.body.style.backgroundColor="black";var g=document.createElement("div");g.id="medicalDom",g.style.cssText="position:absolute; top:0; width:100%; height:100%; text-align:center; overflow:auto; z-index:0;",p.dom.appendChild(g),r.workspace="slicesWorkspace",r.medical=m,r.medicalDom=g,r.stackSize=h;for(var o=0;o<=i;o++){var v=new THREE.Scene;v.name="scene"+o;var y=new a.MedicalSlicer(e);y.name="slicer"+o,y.bbox.visible=!1,y.border.visible=!1,y.worldAxis=t,y.orientation=n,y.index=o,v.add(y);var _=document.createElement("div");_.style.cssText="position: relative; display: inline-block; margin-bottom: -4px; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",_.innerHTML='<div class="scene" style="width: 200px; height: 200px;"></div>\n        <div id="index" style="\n        color: #fff;\n        font-size: 12px;\n        position: absolute;\n        left: 0;\n        top: 0;\n    "></div>',_.querySelector("#index").textContent=y.index.toString(),g.appendChild(_);var b=_.querySelector(".scene");b.id=o,v.userData.element=b,r.elements.push(b);var E=b.getBoundingClientRect(),w=E.width/E.height,x=2*h,T=h,M=h*w,S=new THREE.OrthographicCamera(-M/2,M/2,T/2,-T/2,.1,x);v.userData.camera=S,S.up.copy(d),S.position.copy(f),S.lookAt(c);var A=new THREE.OrthographicTrackballControls(S,b);A.target.copy(c),A.panSpeed=.3,A.rotateSpeed=1,A.zoomSpeed=1.2,A.dynamicDampingFactor=.3,A.noRotate=!0,A.enabled=!1,v.userData.controls=A,b.addEventListener("mouseenter",r.onMouseEnter,!1),b.addEventListener("mouseleave",r.onMouseLeave,!1),b.addEventListener("click",r.onClick,!1),b.addEventListener("dblclick",r.onDoubleClick,!1),b.addEventListener("mousedown",r.onMouseDown,!1),b.addEventListener("mouseup",r.onMouseUp,!1),b.addEventListener("mousemove",r.onMouseMove,!1),window.addEventListener("resize",r.onWindowResize,!1),m.add(v)}p.signals.initSidebar.dispatch(r),m.update=function(e,t){r.onUpdateMedical(e,t)}}(e,r)};var fe={Element:function(e){this.dom=e}};fe.Element.prototype={add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof fe.Element?this.dom.appendChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof fe.Element?this.dom.removeChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},clear:function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)},setId:function(e){return this.dom.id=e,this},setClass:function(e){return this.dom.className=e,this},setStyle:function(e,t){for(var r=0;r<t.length;r++)this.dom.style[e]=t[r];return this},setDisabled:function(e){return this.dom.disabled=e,this},setTextContent:function(e){return this.dom.textContent=e,this}};["position","left","top","right","bottom","width","height","maxHeight","display","overflow","border","borderLeft","borderTop","borderRight","borderBottom","borderRadius","borderColor","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","verticalAlign","textAlign","textDecoration","textTransform","textShadow","cursor","zIndex","transform","transition","lineHeight","visibility","textIndent","wordBreak","boxShadow"].forEach((function(e){var t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);fe.Element.prototype[t]=function(){return this.setStyle(e,arguments),this}}));var pe;function me(e,t,r,n){var i=void 0,a=void 0,o=void 0,s=void 0,l=(new THREE.Vector3).addVectors(n.max,n.min).multiplyScalar(.5),u=(new THREE.Vector3).subVectors(n.max,l),c=(new THREE.Vector3).subVectors(e,l),h=(new THREE.Vector3).subVectors(t,l),d=(new THREE.Vector3).subVectors(r,l),f=(new THREE.Vector3).subVectors(h,c),p=(new THREE.Vector3).subVectors(d,h),m=(new THREE.Vector3).subVectors(c,d),g=new THREE.Vector3(0,-f.z,f.y),v=new THREE.Vector3(0,-p.z,p.y),y=new THREE.Vector3(0,-m.z,m.y),_=new THREE.Vector3(f.z,0,-f.x),b=new THREE.Vector3(p.z,0,-p.x),E=new THREE.Vector3(m.z,0,-m.x),w=new THREE.Vector3(-f.y,f.x,0),x=new THREE.Vector3(-p.y,p.x,0),T=new THREE.Vector3(-m.y,m.x,0);if(i=c.dot(g),a=h.dot(g),o=d.dot(g),s=u.y*Math.abs(f.z)+u.z*Math.abs(f.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(v),a=h.dot(v),o=d.dot(v),s=u.y*Math.abs(p.z)+u.z*Math.abs(p.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(y),a=h.dot(y),o=d.dot(y),s=u.y*Math.abs(m.z)+u.z*Math.abs(m.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(_),a=h.dot(_),o=d.dot(_),s=u.x*Math.abs(f.z)+u.z*Math.abs(f.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(b),a=h.dot(b),o=d.dot(b),s=u.x*Math.abs(p.z)+u.z*Math.abs(p.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(E),a=h.dot(E),o=d.dot(E),s=u.x*Math.abs(m.z)+u.z*Math.abs(m.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(w),a=h.dot(w),o=d.dot(w),s=u.x*Math.abs(f.y)+u.y*Math.abs(f.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(x),a=h.dot(x),o=d.dot(x),s=u.x*Math.abs(p.y)+u.y*Math.abs(p.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=c.dot(T),a=h.dot(T),o=d.dot(T),s=u.x*Math.abs(m.y)+u.y*Math.abs(m.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(Math.max(c.x,h.x,d.x)<-u.x||Math.min(c.x,h.x,d.x)>u.x)return!1;if(Math.max(c.y,h.y,d.y)<-u.y||Math.min(c.y,h.y,d.y)>u.y)return!1;if(Math.max(c.z,h.z,d.z)<-u.z||Math.min(c.z,h.z,d.z)>u.z)return!1;var M=new THREE.Plane;return M.normal=(new THREE.Vector3).copy(p).cross(f).normalize(),M.constant=M.normal.dot(e),function(e,t){var r=(new THREE.Vector3).addVectors(e.max,e.min).multiplyScalar(.5),n=(new THREE.Vector3).subVectors(e.max,r),i=n.x*Math.abs(t.normal.x)+n.y*Math.abs(t.normal.y)+n.z*Math.abs(t.normal.z),a=t.normal.dot(r)-t.constant;return Math.abs(a)<=i}(n,M)}function ge(e,t){var r=0;return e.center.x<t.min.x&&(r+=(t.min.x-e.center.x)*(t.min.x-e.center.x)),e.center.x>t.max.x&&(r+=(e.center.x-t.max.x)*(e.center.x-t.max.x)),e.center.y<t.min.y&&(r+=(t.min.y-e.center.y)*(t.min.y-e.center.y)),e.center.y>t.max.y&&(r+=(e.center.y-t.max.y)*(e.center.y-t.max.y)),e.center.z<t.min.z&&(r+=(t.min.z-e.center.z)*(t.min.z-e.center.z)),e.center.z>t.max.z&&(r+=(e.center.z-t.max.z)*(e.center.z-t.max.z)),r<=e.radius*e.radius}function ve(e,t,r,n,i){var a=(new THREE.Vector3).subVectors(t,e.center),o=(new THREE.Vector3).subVectors(r,e.center),s=(new THREE.Vector3).subVectors(n,e.center),l=e.radius*e.radius,u=(new THREE.Vector3).crossVectors(o.clone().sub(a),s.clone().sub(a)),c=a.dot(u),h=u.dot(u);if(c*c>l*h)return!1;var d=a.dot(a),f=a.dot(o),p=a.dot(s),m=o.dot(o),g=o.dot(s),v=s.dot(s);if(d>l&f>d&p>d||m>l&f>m&g>m||v>l&p>v&g>v)return!1;var y=(new THREE.Vector3).subVectors(o,a),_=(new THREE.Vector3).subVectors(s,o),b=(new THREE.Vector3).subVectors(a,s),E=f-d,w=g-m,x=p-v,T=y.dot(y),M=_.dot(_),S=b.dot(b),A=(new THREE.Vector3).subVectors(a.multiplyScalar(T),y.multiplyScalar(E)),R=(new THREE.Vector3).subVectors(o.multiplyScalar(M),_.multiplyScalar(w)),k=(new THREE.Vector3).subVectors(s.multiplyScalar(S),b.multiplyScalar(x)),P=(new THREE.Vector3).subVectors(s.multiplyScalar(T),A),L=(new THREE.Vector3).subVectors(a.multiplyScalar(M),R),C=(new THREE.Vector3).subVectors(o.multiplyScalar(S),k);if(A.dot(A)>l*T*T&&A.dot(P)>=0||R.dot(R)>l*M*M&&R.dot(L)>=0||k.dot(k)>l*S*S&&k.dot(C)>=0)return!1;var I=Math.sqrt(c*c/h)-e.radius-1,H=new THREE.Vector3(-i.x,-i.y,-i.z);return{distance:I,contactPoint:e.center.clone().add(H.multiplyScalar(I))}}function ye(e,t,r,n,i){var a=n.clone().sub(r),o=i.clone().sub(r),s=e.clone().sub(t),l=a.clone().cross(o),u=s.dot(l);if(u<=0)return!1;var c=e.clone().sub(r),h=c.dot(l);if(h<0)return 0;if(h>u)return 0;var d=s.clone().cross(c),f=o.dot(d);if(f<0||f>u)return 0;var p=-1*a.clone().dot(d);if(p<0||f+p>u)return 0;var m=1/u;h*=m;var g=1-(f*=m)-(p*=m),v=r.clone().multiplyScalar(g),y=n.clone().multiplyScalar(f),_=i.clone().multiplyScalar(p);return{contactPoint:v.clone().add(y).add(_)}}function _e(e,t,r){this.min=e,this.max=t,this.maxDepth=r,this.nodes=[];for(var n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=0;o<this.maxDepth;o++){this.nodes.push([]);var s=Math.pow(2,o),l=Math.pow(4,o);n.subVectors(this.max,this.min).divideScalar(s);for(var u=0,c=Math.pow(8,o);u<c;u++){var h=u%s,d=~~(u/l),f=~~(u/s)%s,p=this.min.x+h*n.x,m=this.min.y+d*n.y,g=this.min.z+f*n.z;i.set(p,m,g),a.copy(i).add(n);var v=_e.getMortonNumber(h,d,f);this.nodes[o][v]=new be(this,o,v,i,a)}}}function be(e,t,r,n,i){this.tree=e,this.depth=t,this.mortonNumber=r,this.min=new THREE.Vector3(n.x,n.y,n.z),this.max=new THREE.Vector3(i.x,i.y,i.z),this.trianglePool=[]}["KeyDown","KeyUp","MouseDown","MouseUp","MouseEnter","MouseLeave","MouseOver","MouseOut","Click","DblClick","Change","Input"].forEach((function(e){var t="on"+e;fe.Element.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this),!1),this}})),fe.Span=function(){return fe.Element.call(this),this.dom=document.createElement("span"),this},fe.Span.prototype=Object.create(fe.Element.prototype),fe.Span.prototype.constructor=fe.Span,fe.Div=function(){return fe.Element.call(this),this.dom=document.createElement("div"),this},fe.Div.prototype=Object.create(fe.Element.prototype),fe.Div.prototype.constructor=fe.Div,fe.Row=function(){fe.Element.call(this);var e=document.createElement("div");return e.className="Row",this.dom=e,this},fe.Row.prototype=Object.create(fe.Element.prototype),fe.Row.prototype.constructor=fe.Row,fe.Column=function(){fe.Element.call(this);var e=document.createElement("div");return e.className="Column",this.dom=e,this},fe.Column.prototype=Object.create(fe.Element.prototype),fe.Column.prototype.constructor=fe.Column,fe.Panel=function(){fe.Element.call(this);var e=document.createElement("div");return e.className="Panel",this.dom=e,this},fe.Panel.prototype=Object.create(fe.Element.prototype),fe.Panel.prototype.constructor=fe.Panel,fe.Text=function(e){fe.Element.call(this);var t=document.createElement("span");return t.className="Text",t.style.cursor="default",t.style.display="inline-block",t.style.verticalAlign="middle",this.dom=t,this.setValue(e),this},fe.Text.prototype=Object.create(fe.Element.prototype),fe.Text.prototype.constructor=fe.Text,fe.Text.prototype.getValue=function(){return this.dom.textContent},fe.Text.prototype.setValue=function(e){return void 0!==e&&(this.dom.textContent=e),this},fe.Input=function(e){fe.Element.call(this);var t=document.createElement("input");return t.className="Input",t.style.padding="2px",t.style.border="1px solid transparent",t.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.dom=t,this.setValue(e),this},fe.Input.prototype=Object.create(fe.Element.prototype),fe.Input.prototype.constructor=fe.Input,fe.Input.prototype.getValue=function(){return this.dom.value},fe.Input.prototype.setValue=function(e){return this.dom.value=e,this},fe.TextArea=function(){fe.Element.call(this);var e=document.createElement("textarea");return e.className="TextArea",e.style.padding="2px",e.spellcheck=!1,e.addEventListener("keydown",(function(t){if(t.stopPropagation(),9===t.keyCode){t.preventDefault();var r=e.selectionStart;e.value=e.value.substring(0,r)+"\t"+e.value.substring(r),e.selectionStart=r+1,e.selectionEnd=e.selectionStart}}),!1),this.dom=e,this},fe.TextArea.prototype=Object.create(fe.Element.prototype),fe.TextArea.prototype.constructor=fe.TextArea,fe.TextArea.prototype.getValue=function(){return this.dom.value},fe.TextArea.prototype.setValue=function(e){return this.dom.value=e,this},fe.Select=function(){fe.Element.call(this);var e=document.createElement("select");return e.className="Select",e.style.padding="2px",this.dom=e,this},fe.Select.prototype=Object.create(fe.Element.prototype),fe.Select.prototype.constructor=fe.Select,fe.Select.prototype.setMultiple=function(e){return this.dom.multiple=e,this},fe.Select.prototype.setOptions=function(e){for(var t=this.dom.value;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var r in e){var n=document.createElement("option");n.value=r,n.innerHTML=e[r],this.dom.appendChild(n)}return this.dom.value=t,this},fe.Select.prototype.getValue=function(){return this.dom.value},fe.Select.prototype.setValue=function(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this},fe.Checkbox=function(e){fe.Element.call(this);var t=document.createElement("input");return t.className="Checkbox",t.type="checkbox",this.dom=t,this.setValue(e),this},fe.Checkbox.prototype=Object.create(fe.Element.prototype),fe.Checkbox.prototype.constructor=fe.Checkbox,fe.Checkbox.prototype.getValue=function(){return this.dom.checked},fe.Checkbox.prototype.setValue=function(e){return void 0!==e&&(this.dom.checked=e),this},fe.Color=function(){fe.Element.call(this);var e=document.createElement("input");e.className="Color",e.style.width="64px",e.style.height="17px",e.style.border="0px",e.style.padding="2px",e.style.backgroundColor="transparent";try{e.type="color",e.value="#ffffff"}catch(e){}return this.dom=e,this},fe.Color.prototype=Object.create(fe.Element.prototype),fe.Color.prototype.constructor=fe.Color,fe.Color.prototype.getValue=function(){return this.dom.value},fe.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},fe.Color.prototype.setValue=function(e){return this.dom.value=e,this},fe.Color.prototype.setHexValue=function(e){return this.dom.value="#"+("000000"+e.toString(16)).slice(-6),this},fe.Number=function(e){fe.Element.call(this);var t=this,r=document.createElement("input");r.className="Number",r.value="0.00",r.addEventListener("keydown",(function(e){e.stopPropagation(),13===e.keyCode&&r.blur()}),!1),this.value=0,this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.unit="",this.dom=r,this.setValue(e);var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var u=a+i/(e.shiftKey?5:50)*t.step;l!==(u=Math.min(t.max,Math.max(t.min,u)))&&(t.setValue(u),r.dispatchEvent(n)),s=[e.clientX,e.clientY]}function u(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",u,!1),Math.abs(i)<2&&(r.focus(),r.select())}function c(e){var l=t.value;o=[e.touches[0].pageX,e.touches[0].pageY],i+=o[0]-s[0]-(o[1]-s[1]);var u=a+i/(e.shiftKey?5:50)*t.step;l!==(u=Math.min(t.max,Math.max(t.min,u)))&&(t.setValue(u),r.dispatchEvent(n)),s=[e.touches[0].pageX,e.touches[0].pageY]}function h(e){0===e.touches.length&&(document.removeEventListener("touchmove",c,!1),document.removeEventListener("touchend",h,!1))}function d(e){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}return d(),r.addEventListener("mousedown",(function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1)}),!1),r.addEventListener("touchstart",(function(e){1===e.touches.length&&(i=0,a=t.value,s=[e.touches[0].pageX,e.touches[0].pageY],document.addEventListener("touchmove",c,!1),document.addEventListener("touchend",h,!1))}),!1),r.addEventListener("change",(function(e){t.setValue(r.value)}),!1),r.addEventListener("focus",(function(e){r.style.backgroundColor="",r.style.cursor=""}),!1),r.addEventListener("blur",d,!1),this},fe.Number.prototype=Object.create(fe.Element.prototype),fe.Number.prototype.constructor=fe.Number,fe.Number.prototype.getValue=function(){return this.value},fe.Number.prototype.setValue=function(e){return void 0!==e&&((e=parseFloat(e))<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,this.dom.value=e.toFixed(this.precision),""!==this.unit&&(this.dom.value+=" "+this.unit)),this},fe.Number.prototype.setPrecision=function(e){return this.precision=e,this},fe.Number.prototype.setStep=function(e){return this.step=e,this},fe.Number.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},fe.Number.prototype.setUnit=function(e){return this.unit=e,this},fe.Integer=function(e){fe.Element.call(this);var t=this,r=document.createElement("input");r.className="Number",r.value="0",r.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.value=0,this.min=-1/0,this.max=1/0,this.step=1,this.dom=r,this.setValue(e);var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var u=a+i/(e.shiftKey?5:50)*t.step;l!==(u=0|Math.min(t.max,Math.max(t.min,u)))&&(t.setValue(u),r.dispatchEvent(n)),s=[e.clientX,e.clientY]}function u(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",u,!1),Math.abs(i)<2&&(r.focus(),r.select())}function c(e){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}return c(),r.addEventListener("mousedown",(function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1)}),!1),r.addEventListener("change",(function(e){t.setValue(r.value)}),!1),r.addEventListener("focus",(function(e){r.style.backgroundColor="",r.style.cursor=""}),!1),r.addEventListener("blur",c,!1),this},fe.Integer.prototype=Object.create(fe.Element.prototype),fe.Integer.prototype.constructor=fe.Integer,fe.Integer.prototype.getValue=function(){return this.value},fe.Integer.prototype.setValue=function(e){return void 0!==e&&(e=parseInt(e),this.value=e,this.dom.value=e),this},fe.Integer.prototype.setStep=function(e){return this.step=parseInt(e),this},fe.Integer.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},fe.Break=function(){fe.Element.call(this);var e=document.createElement("br");return e.className="Break",this.dom=e,this},fe.Break.prototype=Object.create(fe.Element.prototype),fe.Break.prototype.constructor=fe.Break,fe.HorizontalRule=function(){fe.Element.call(this);var e=document.createElement("hr");return e.className="HorizontalRule",this.dom=e,this},fe.HorizontalRule.prototype=Object.create(fe.Element.prototype),fe.HorizontalRule.prototype.constructor=fe.HorizontalRule,fe.Button=function(e){fe.Element.call(this);var t=document.createElement("button");return t.className="Button",this.dom=t,this.dom.textContent=e,this},fe.Button.prototype=Object.create(fe.Element.prototype),fe.Button.prototype.constructor=fe.Button,fe.Button.prototype.setLabel=function(e){return this.dom.textContent=e,this},fe.TabbedPanel=function(){fe.Element.call(this);var e=document.createElement("div");return this.dom=e,this.setClass("TabbedPanel"),this.tabs=[],this.panels=[],this.tabsDiv=new fe.Div,this.tabsDiv.setClass("Tabs"),this.panelsDiv=new fe.Div,this.panelsDiv.setClass("Panels"),this.add(this.tabsDiv),this.add(this.panelsDiv),this.selected="",this},fe.TabbedPanel.prototype=Object.create(fe.Element.prototype),fe.TabbedPanel.prototype.constructor=fe.TabbedPanel,fe.TabbedPanel.prototype.select=function(e){var t,r,n=this;return this.selected&&this.selected.length&&(t=this.tabs.find((function(e){return e.dom.id===n.selected})),r=this.panels.find((function(e){return e.dom.id===n.selected})),t&&t.removeClass("selected"),r&&r.setDisplay("none")),t=this.tabs.find((function(t){return t.dom.id===e})),r=this.panels.find((function(t){return t.dom.id===e})),t&&t.addClass("selected"),r&&r.setDisplay(""),this.selected=e,this},fe.TabbedPanel.prototype.addTab=function(e,t,r){var n=new fe.TabbedPanel.Tab(t,this);n.setId(e),this.tabs.push(n),this.tabsDiv.add(n);var i=new fe.Div;i.setId(e),i.add(r),i.setDisplay("none"),this.panels.push(i),this.panelsDiv.add(i),this.select(e)},fe.TabbedPanel.Tab=function(e,t){fe.Text.call(this,e),this.parent=t,this.setClass("Tab");var r=this;return this.dom.addEventListener("click",(function(e){r.parent.select(r.dom.id)})),this},fe.TabbedPanel.Tab.prototype=Object.create(fe.Text.prototype),fe.TabbedPanel.Tab.prototype.constructor=fe.TabbedPanel.Tab,fe.Listbox=function(){fe.Element.call(this);var e=document.createElement("div");return e.className="Listbox",e.tabIndex=0,this.dom=e,this.items=[],this.listitems=[],this.selectedIndex=0,this.selectedValue=null,this},fe.Listbox.prototype=Object.create(fe.Element.prototype),fe.Listbox.prototype.constructor=fe.Listbox,fe.Listbox.prototype.setItems=function(e){Array.isArray(e)&&(this.items=e),this.render()},fe.Listbox.prototype.render=function(){for(;this.listitems.length;){(t=this.listitems[0]).dom.remove(),this.listitems.splice(0,1)}for(var e=0;e<this.items.length;e++){var t=this.items[e],r=new fe.Listbox.ListboxItem(this);r.setId(t.id||"Listbox-"+e),r.setTextContent(t.name||t.type),this.add(r)}},fe.Listbox.prototype.add=function(){var e=Array.from(arguments);this.listitems=this.listitems.concat(e),fe.Element.prototype.add.apply(this,e)},fe.Listbox.prototype.selectIndex=function(e){e>=0&&e<this.items.length&&this.setValue(this.listitems[e].getId()),this.selectedIndex=e},fe.Listbox.prototype.getValue=function(){return this.selectedValue},fe.Listbox.prototype.setValue=function(e){for(var t=0;t<this.listitems.length;t++){var r=this.listitems[t];r.getId()===e?r.addClass("active"):r.removeClass("active")}this.selectedValue=e;var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0),this.dom.dispatchEvent(n)},fe.Listbox.ListboxItem=function(e){fe.Element.call(this);var t=document.createElement("div");t.className="ListboxItem",this.parent=e,this.dom=t;var r=this;return t.addEventListener("click",(function(){r.parent&&r.parent.setValue(r.getId())}),!1),this},fe.Listbox.ListboxItem.prototype=Object.create(fe.Element.prototype),fe.Listbox.ListboxItem.prototype.constructor=fe.Listbox.ListboxItem,fe.Image=function(e){fe.Element.call(this);var t=document.createElement("img");return t.className="Image",t.src=e,this.dom=t,this},fe.Image.prototype=Object.create(fe.Element.prototype),fe.Image.prototype.constructor=fe.Image,fe.Tooltip=function(e){fe.Element.call(this);var t=document.createElement("span");return t.setAttribute("data-tooltip",e),t.setAttribute("data-tooltip-position","top"),this.dom=t,this},fe.Tooltip.prototype=Object.create(fe.Element.prototype),fe.Tooltip.prototype.constructor=fe.Tooltip,fe.Modal=function(){var e=this,t=document.createElement("div");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.display="none",t.style.alignItems="center",t.style.justifyContent="center",t.addEventListener("click",(function(t){e.hide()})),this.dom=t,this.container=new fe.Panel,this.container.dom.style.width="200px",this.container.dom.style.padding="20px",this.container.dom.style.backgroundColor="#ffffff",this.container.dom.style.boxShadow="0px 5px 10px rgba(0,0,0,0.5)",this.add(this.container),this},fe.Modal.prototype=Object.create(fe.Element.prototype),fe.Modal.prototype.constructor=fe.Modal,fe.Modal.prototype.show=function(e){return this.container.clear(),this.container.add(e),this.dom.style.display="flex",this},fe.Modal.prototype.hide=function(){return this.dom.style.display="none",this},fe.Texture=function(e){fe.Element.call(this);var t=this,r=document.createElement("span"),n=document.createElement("form"),i=document.createElement("input");i.type="file",i.addEventListener("change",(function(e){o(e.target.files[0])})),n.appendChild(i);var a=document.createElement("canvas");function o(r){if(r.type.match("image.*")){var i=new FileReader;"image/targa"===r.type?(i.addEventListener("load",(function(n){var i=(new THREE.TGALoader).parse(n.target.result),a=new THREE.CanvasTexture(i,e);a.sourceFile=r.name,t.setValue(a),t.onChangeCallback&&t.onChangeCallback(a)}),!1),i.readAsArrayBuffer(r)):(i.addEventListener("load",(function(n){var i=document.createElement("img");i.addEventListener("load",(function(){var n=new THREE.Texture(this,e);n.sourceFile=r.name,n.format="image/jpeg"===r.type?THREE.RGBFormat:THREE.RGBAFormat,n.needsUpdate=!0,t.setValue(n),t.onChangeCallback&&t.onChangeCallback(n)}),!1),i.src=n.target.result}),!1),i.readAsDataURL(r))}else{(i=new FileReader).addEventListener("load",(function(e){"hdr"===r.name.split(".").pop()&&(new THREE.RGBELoader).setDataType(THREE.UnsignedByteType).load(e.target.result,(function(e){e.sourceFile=r.name,e.isHDRTexture=!0,t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e)}))})),i.readAsDataURL(r)}n.reset()}return a.width=50,a.height=50,a.style.cursor="pointer",a.style.marginRight="5px",a.style.border="1px solid #888",a.addEventListener("click",(function(e){i.click()}),!1),a.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()}),!1),a.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),o(e.dataTransfer.files[0])}),!1),r.appendChild(a),this.dom=r,this.texture=null,this.onChangeCallback=null,this},fe.Texture.prototype=Object.create(fe.Element.prototype),fe.Texture.prototype.constructor=fe.Texture,fe.Texture.prototype.getValue=function(){return this.texture},fe.Texture.prototype.setValue=function(e){var t=this.dom.children[0],r=t.getContext("2d");if(null!==e){var n=e.isCubeTexture?e.image[0]:e.image;if(void 0!==n&&n.width>0){t.title=e.sourceFile;var i=t.width/n.width;if(void 0===n.data)r.drawImage(n,0,0,n.width*i,n.height*i);else{var a=function(e){void 0===pe&&(pe=new THREE.WebGLRenderer({canvas:new OffscreenCanvas(1,1)}));var t=e.image;pe.setSize(t.width,t.height,!1),pe.toneMapping=THREE.ReinhardToneMapping,pe.toneMappingExposure=2,pe.outputEncoding=THREE.sRGBEncoding;var r=new THREE.Scene,n=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=new THREE.MeshBasicMaterial({map:e}),a=new THREE.PlaneBufferGeometry(2,2),o=new THREE.Mesh(a,i);return r.add(o),pe.render(r,n),pe.domElement}(e);r.drawImage(a,0,0,n.width*i,n.height*i)}}else t.title=e.sourceFile+" (error)",r.clearRect(0,0,t.width,t.height)}else t.title="empty",null!==r&&r.clearRect(0,0,t.width,t.height);this.texture=e},fe.Texture.prototype.setEncoding=function(e){var t=this.getValue();return null!==t&&(t.encoding=e),this},fe.Texture.prototype.onChange=function(e){return this.onChangeCallback=e,this},fe.Tree=function(e){fe.Element.call(this);var t=this;this.appWorks=e;var r=document.createElement("div");return r.className="Tree",r.tabIndex=0,r.addEventListener("keydown",(function(e){switch(e.keyCode){case 38:case 40:e.preventDefault(),e.stopPropagation()}}),!1),r.addEventListener("keyup",(function(e){switch(e.keyCode){case 38:t.selectIndex(t.selectedIndex-1);break;case 40:t.selectIndex(t.selectedIndex+1)}}),!1),this.dom=r,this.items=[],this.selectedIndex=-1,this},fe.Tree.prototype=Object.create(fe.Element.prototype),fe.Tree.prototype.constructor=fe.Tree,fe.Tree.prototype.selectIndex=function(e){e>=0&&e<this.items.length&&(this.selectedIndex=e,this.appWorks.selectById(parseInt(this.items[e].id)))},fe.Tree.prototype.clean=function(e,t){for(var r=this.items,n=0,i=r.length;n<i;n++)r[n].classList.toggle(e,t)},fe.Tree.prototype.toggle=function(e,t,r){e.forEach((function(e){var n=document.getElementById(e);n&&n.classList.toggle(t,r)}))},fe.Tree.prototype.setInnerHTML=function(e){for(var t=this.appWorks;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);this.dom.innerHTML=e;for(var r,n,i,a=this.dom.getElementsByClassName("box"),o=0;o<a.length;o++){(w=a[o]).addEventListener("click",(function(e){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("check-box")}))}function s(e){e.stopPropagation();var r=void 0;e.ctrlKey?r="multiple":e.altKey&&(r="ancestor"),t.selectById(parseInt(this.id),r)}function l(e){e.stopPropagation(),e.preventDefault(),t.selectById(parseInt(this.id)),t.guiContextMenu.toggle(e)}function u(e){e.preventDefault(),r&&clearTimeout(r),t.mouseMovePosition.copy(t.getMousePosition(e))}function c(e){e.preventDefault(),n||(t.selectById(parseInt(this.id)),r=setTimeout(d,500,e),n=!0,t.mouseDownPosition.copy(t.getMousePosition(e)),document.addEventListener("touchend",h,!1))}function h(e){r&&(clearTimeout(r),n=!1),t.mouseUpPosition.copy(t.getMousePosition(e)),document.removeEventListener("touchend",h,!1)}function d(e){e.stopPropagation(),e.preventDefault(),t.guiContextMenu.toggle(e)}function f(e){i=this,e.stopPropagation()}function p(e){e.dataTransfer.setData("text","foo"),e.stopPropagation()}function m(e){if(this!==i){var t=e.offsetY/this.clientHeight;this.className=t<.25?"dragTop":t>.75?"dragBottom":"drag",e.preventDefault()}}function g(){this!==i&&(this.className="")}function v(e){if(this!==i){this.className="";var r=t.scene,n=r.getObjectById(parseInt(i.id));if(void 0!==n){var a=e.offsetY/this.clientHeight;if(a<.25)y(n,(o=r.getObjectById(parseInt(this.id))).parent,o);else if(a>.75){var o;y(n,(o=r.getObjectById(parseInt(this.nextSibling.id))).parent,o)}else{y(n,r.getObjectById(parseInt(this.id)))}e.stopPropagation()}}}function y(e,r,n){if(null!==r){null===n&&(n=void 0);var i=!1;e.traverse((function(e){e===r&&(i=!0)})),i||t.move(e,r,n)}}var _=this.dom.getElementsByTagName("li");this.items=_;var b=this.appWorks.scene.id.toString(),E=this.appWorks.camera.id.toString();for(o=0;o<_.length;o++){var w;(w=_[o]).className="",w.addEventListener("click",s,!1),w.addEventListener("contextmenu",l,!1),w.addEventListener("touchmove",u,!0),w.addEventListener("touchstart",c,!1),w.id===b||w.id===E?w.draggable=!1:(w.draggable=!0,w.addEventListener("drag",f,!1),w.addEventListener("dragstart",p,!1),w.addEventListener("dragover",m,!1),w.addEventListener("dragleave",g,!1),w.addEventListener("drop",v,!1))}var x=t.selectObjects.map((function(e){return e.id.toString()}));this.clean("selected",!1),this.toggle(x,"selected",!0);x=[];return t.scene.traverse((function(e){!1===e.visible&&x.push(e.id.toString())})),this.clean("translucent",!1),this.toggle(x,"translucent",!0),this},fe.Boolean=function(e,t){fe.Span.call(this),this.setMarginRight("10px"),this.checkbox=new fe.Checkbox(e),this.text=new fe.Text(t).setMarginLeft("3px"),this.add(this.checkbox),this.add(this.text)},fe.Boolean.prototype=Object.create(fe.Span.prototype),fe.Boolean.prototype.constructor=fe.Boolean,fe.Boolean.prototype.getValue=function(){return this.checkbox.getValue()},fe.Boolean.prototype.setValue=function(e){return this.checkbox.setValue(e)},a.createMedicalGUI=function(e){return(e=e||a.appWorks).appGUI=new a.MedicalGUI(e),e.appGUI},a.MedicalGUI=function(e,t){(e=e||a.appWorks).guiOptions=t||{},fe.Div.call(this);new a.MedicalGUIStrings(e);var r=new a.MedicalSidebar(e);this.add(r);var n=new a.MedicalIconbar(e);this.add(n);var i=new a.MedicalModal(e);this.add(i),document.addEventListener("keydown",(function(t){e.onKeyDown(t)}),!1)},a.MedicalGUI.prototype=Object.create(fe.Div.prototype),a.MedicalGUI.prototype.constructor=a.MedicalGUI,a.MedicalGUIStrings=function(e){var t={English:{"sidebar/slicer":"Slicer","sidebar/slicer/slicerview":"Slice View","sidebar/slicer/slicerview/axial":"Axial","sidebar/slicer/slicerview/sagittal":"Sagittal","sidebar/slicer/slicerview/coronal":"Coronal","sidebar/slicer/index":"Index","sidebar/slicer/thickness":"Thickness","sidebar/slicer/thicknessmethod":"Thickness Method","sidebar/slicer/thicknessmethod/mip":"MIP","sidebar/slicer/thicknessmethod/mean":"Mean","sidebar/slicer/thicknessmethod/minip":"MinIP","sidebar/slicer/windowwidth":"Window Width","sidebar/slicer/windowcenter":"Window Center","sidebar/slicer/rescaleslope":"Rescale Slope","sidebar/slicer/rescaleintercept":"Rescale Intercept","sidebar/slicer/intensityauto":"Auto Intensity","sidebar/slicer/invert":"Invert Intensity","sidebar/slicer/visible":"Visible","sidebar/slicer/lut":"Lookup Table","sidebar/slicer/lut/none":"none","sidebar/slicer/lut/grayscale":"grayscale","sidebar/slicer/lut/spectrum":"spectrum","sidebar/slicer/lut/hot_and_cold":"hot_and_cold","sidebar/slicer/lut/gold":"gold","sidebar/slicer/lut/red_to_green":"red_to_green","sidebar/slicer/lut/blue_to_green":"blue_to_green","sidebar/slicer/lut/red_to_white":"red_to_white","sidebar/slicer/lut/green_to_white":"green_to_white","sidebar/slicer/lut/blue_to_white":"blue_to_white","sidebar/slicer/lut/walking_dead":"walking_dead","sidebar/slicer/lut/random":"random","sidebar/slicer/lut/fire":"fire","sidebar/slicer/lut/muscle_bone":"muscle_bone","sidebar/volume":"Volume","sidebar/volume/windowwidth":"Window Width","sidebar/volume/windowcenter":"Window Center","sidebar/volume/rescaleslope":"Rescale Slope","sidebar/volume/rescaleintercept":"Rescale Intercept","sidebar/volume/visible":"Visible","sidebar/volume/steps":"Steps","sidebar/volume/alphacorrection":"Alpha","sidebar/volume/interpolation":"Trilinear","sidebar/volume/shading":"Phong Shading","sidebar/volume/algorithm":"Rendering Algorithm","sidebar/volume/algorithm/ray_marching":"ray_marching","sidebar/volume/algorithm/mip":"mip","sidebar/volume/lut":"Color LUT","sidebar/volume/lut/grayscale":"grayscale","sidebar/volume/lut/spectrum":"spectrum","sidebar/volume/lut/hot_and_cold":"hot_and_cold","sidebar/volume/lut/gold":"gold","sidebar/volume/lut/red_to_green":"red_to_green","sidebar/volume/lut/blue_to_green":"blue_to_green","sidebar/volume/lut/red_to_white":"red_to_white","sidebar/volume/lut/green_to_white":"green_to_white","sidebar/volume/lut/blue_to_white":"blue_to_white","sidebar/volume/lut/walking_dead":"walking_dead","sidebar/volume/lut/random":"random","sidebar/volume/lut/fire":"fire","sidebar/volume/lut/muscle_bone":"muscle_bone","sidebar/volume/luto":"Opacity LUT","sidebar/volume/luto/linear":"linear","sidebar/volume/luto/lowpass":"lowpass","sidebar/volume/luto/bandpass":"bandpass","sidebar/volume/luto/highpass":"highpass","sidebar/volume/luto/flat":"flat","sidebar/volume/luto/random":"random","sidebar/volume/luto/linear_full":"linear_full","sidebar/volume/tablediscrete":"Discrete LUT","sidebar/isosurface":"Isosurface","sidebar/isosurface/isolevel":"Iso-level","sidebar/isosurface/stride":"Resolution","sidebar/isosurface/stride/fine":"fine","sidebar/isosurface/stride/middle":"middle","sidebar/isosurface/stride/rough":"rough","sidebar/isosurface/smoothing":"Smoothing","sidebar/isosurface/smoothing/none":"none","sidebar/isosurface/smoothing/little":"little","sidebar/isosurface/smoothing/rough":"rough","sidebar/isosurface/smoothing/middle":"middle","sidebar/isosurface/smoothing/fine":"fine","sidebar/isosurface/smoothing/full":"full","sidebar/isosurface/visible":"Visible","sidebar/isosurface/color":"Color","sidebar/isosurface/opacity":"Opacity","sidebar/isosurface/matcap":"MatCap","sidebar/isosurface/clipping":"Clipping","sidebar/isosurface/zclipping":"Axial","sidebar/isosurface/xclipping":"Sagittal","sidebar/isosurface/yclipping":"Coronal","sidebar/sketch":"Sketch","sidebar/sketch/type":"Create Type","sidebar/sketch/type/handle":"handle","sidebar/sketch/type/voxelprobe":"voxelprobe","sidebar/sketch/type/ruler":"ruler","sidebar/sketch/type/biruler":"biruler","sidebar/sketch/type/angle":"angle","sidebar/sketch/type/rectangle":"rectangle","sidebar/sketch/type/polygon":"polygon","sidebar/sketch/type/freehand":"freehand","sidebar/sketch/type/annotation":"annotation","sidebar/settings":"Settings","sidebar/settings/aaa":"Aaa","modal/histogram":"Histogram","modal/histogram/graph/axial":"Axial","modal/histogram/graph/sagittal":"Sagittal","modal/histogram/graph/coronal":"Coronal","modal/histogram/graph/volume":"Volume","menubar/file":"File","menubar/file/new":"New","menubar/file/open":"Open Files...","others/confirmfilenew":"Any unsaved data will be lost. Are you sure?"},Korean:{}},r={getKey:function(e){return t.English[e]||"Undefined"}};return e.guiStrings=r,r},a.MedicalSidebar=function(e){var t=e.guiStrings,r=new fe.Panel;r.setId("sidebar"),r.setDisplay("none");var n=(new fe.Span).setClass("fas fa-landmark icon"),i=new fe.Text(t.getKey("sidebar/slicer")).setTextTransform("uppercase").onClick((function(){S(t.getKey("sidebar/slicer"))})).add(n),o=(new fe.Span).setClass("fas fa-igloo icon"),s=new fe.Text(t.getKey("sidebar/volume")).setTextTransform("uppercase").onClick((function(){S(t.getKey("sidebar/volume"))})).add(o),l=(new fe.Span).setClass("fas fa-shapes icon"),u=new fe.Text(t.getKey("sidebar/isosurface")).setTextTransform("uppercase").onClick((function(){S(t.getKey("sidebar/isosurface"))})).add(l),c=(new fe.Span).setClass("fas fa-palette icon"),h=new fe.Text(t.getKey("sidebar/sketch")).setTextTransform("uppercase").onClick((function(){S(t.getKey("sidebar/sketch"))})).add(c),d=(new fe.Span).setClass("fas fa-bars icon"),f=new fe.Text(t.getKey("sidebar/settings")).setTextTransform("uppercase").onClick((function(){S(t.getKey("sidebar/settings"))})).add(d),p=(new fe.Div).setLineHeight("32px").setWordBreak("keep-all");p.setId("tabs"),p.add(i,s,u,h,f),r.add(p);var m=new a.MedicalSidebar.Slicer(e),g=(new fe.Span).add(m);r.add(g);var v=new a.MedicalSidebar.Volume(e),y=(new fe.Span).add(v);r.add(y);var _=new a.MedicalSidebar.Isosurface(e),b=(new fe.Span).add(_);r.add(b);var E=new a.MedicalSidebar.Sketch(e),w=(new fe.Span).add(E);r.add(w);var x=new a.MedicalSidebar.Settings(e),T=(new fe.Span).add(x);r.add(T);var M="inclusive";function S(e,t){void 0!==t&&(M=t);var n=r.dom.children,i=n[0].children;if("inclusive"===M){r.dom.style.display="inclusive"===t?"none"===r.dom.style.display?"":"none":"";for(var a=0,o=i.length;a<o;a++){var s=n[a+1];(l=i[a]).textContent===e?(l.style.display="",l.className="selected",s.style.display=""):(l.style.display="",l.className="",s.style.display="none")}}else for(a=0,o=i.length;a<o;a++){var l;s=n[a+1];if((l=i[a]).textContent===e){var u="none"===s.style.display?"":"none";l.style.display=u,l.className="selected",l.style.lineHeight="32px",s.style.display=u,r.dom.style.display=u}else l.style.display="none",s.style.display="none"}}return S("Slicer"),r.select=function(e,t){S(e,t)},e.guiSidebar=r,e.guiSlicer=m,e.guiVolume=v,e.guiIsosurface=_,e.guiSketch=E,e.guiSettings=x,r},a.MedicalSidebar.Slicer=function(e){var t,r=e.signals,n=e.guiStrings,i=[],o=[];o[0]=n.getKey("sidebar/slicer/slicerview/axial"),o[1]=n.getKey("sidebar/slicer/slicerview/sagittal"),o[2]=n.getKey("sidebar/slicer/slicerview/coronal");var s=[],l=[],u=[],c=[],h=[],d=[],f=[],p=[],m=[],g=[],v=[],y=[],_=[],b=new fe.Panel;b.setBorderTop("0"),b.setPaddingTop("20px");var E=(new fe.Row).setDisplay("none"),w=(new fe.Select).setWidth("135px").setOptions({0:o[0],1:o[1],2:o[2]}).setValue("0").onChange(W);E.add(new fe.Text(n.getKey("sidebar/slicer/slicerview")).setWidth("120px")),E.add(w),b.add(E);for(var x=0;x<3;x++){var T=(new fe.Row).setDisplay("");T.add(new fe.Text(o[x]).setWidth("80px").setVerticalAlign("top"));var M=(new fe.Span).setDisplay("inline-block").setWidth("200px");M.setId(x),T.add(M);var S=(new fe.Integer).setWidth("60px").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/index")).setWidth("120px")),M.add(S);var A=(new fe.Number).setWidth("60px").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/thickness")).setWidth("120px")),M.add(A);var R=(new fe.Select).setWidth("65px").setOptions({0:n.getKey("sidebar/slicer/thicknessmethod/mip"),1:n.getKey("sidebar/slicer/thicknessmethod/mean"),2:n.getKey("sidebar/slicer/thicknessmethod/minip")}).setValue("0").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/thicknessmethod")).setWidth("120px")),M.add(R);var k=(new fe.Number).setWidth("60px").onChange(W),P=new fe.Text(n.getKey("sidebar/slicer/windowwidth")).setWidth("120px");P.slicerIndex=x,P.onClick(I.bind(P)),P.onMouseOver(H.bind(P)),P.onMouseOut(O.bind(P)),M.add(P),M.add(k);var L=(new fe.Number).setWidth("60px").onChange(W),C=new fe.Text(n.getKey("sidebar/slicer/windowcenter")).setWidth("120px");function I(){e.guiHistogram.setDisplay(""),e.guiHistogram.update(i[this.slicerIndex])}function H(){this.dom.style.cursor="pointer",this.dom.style.textDecoration="underline"}function O(){this.dom.style.cursor="",this.dom.style.textDecoration=""}C.slicerIndex=x,C.onClick(I.bind(C)),C.onMouseOver(H.bind(C)),C.onMouseOut(O.bind(C)),M.add(C),M.add(L);var D=(new fe.Number).setWidth("60px").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/rescaleslope")).setWidth("120px")),M.add(D);var F=(new fe.Number).setWidth("60px").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/rescaleintercept")).setWidth("120px")),M.add(F);var N=new fe.Checkbox(!1).setLeft("60px").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/intensityauto")).setWidth("120px")),M.add(N);var U=new fe.Checkbox(!1).setLeft("60px").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/invert")).setWidth("120px")),M.add(U);var B=new fe.Checkbox(!0).setLeft("60px").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/visible")).setWidth("120px")),M.add(B);var z=(new fe.Select).setWidth("65px").setOptions({none:n.getKey("sidebar/slicer/lut/none"),grayscale:n.getKey("sidebar/slicer/lut/grayscale"),spectrum:n.getKey("sidebar/slicer/lut/spectrum"),hot_and_cold:n.getKey("sidebar/slicer/lut/hot_and_cold"),gold:n.getKey("sidebar/slicer/lut/gold"),red_to_green:n.getKey("sidebar/slicer/lut/red_to_green"),blue_to_green:n.getKey("sidebar/slicer/lut/blue_to_green"),red_to_white:n.getKey("sidebar/slicer/lut/red_to_white"),green_to_white:n.getKey("sidebar/slicer/lut/green_to_white"),blue_to_white:n.getKey("sidebar/slicer/lut/blue_to_white"),walking_dead:n.getKey("sidebar/slicer/lut/walking_dead"),random:n.getKey("sidebar/slicer/lut/random"),fire:n.getKey("sidebar/slicer/lut/fire"),muscle_bone:n.getKey("sidebar/slicer/lut/muscle_bone")}).setValue("none").onChange(W);M.add(new fe.Text(n.getKey("sidebar/slicer/lut")).setWidth("120px")),M.add(z);var j=(new fe.Row).setWidth("200px"),V=new a.LookupTable(j.dom),G=j.dom.firstChild;G.style.width="200px",G.firstChild.width=200,M.add(j),b.add(T),s.push(T),l.push(S),u.push(A),c.push(R),h.push(k),d.push(L),f.push(D),p.push(F),m.push(N),g.push(U),v.push(B),y.push(z),_.push(V)}function W(r){function n(t){var r=i[t];if(r){var n=r.slice,a=e.guiHistogram,o=!(!a||""!==a.dom.style.display);r.index!==l[t].getValue()&&(r.index=l[t].getValue(),o&&a.update(r,!0)),n.thickness!==u[t].getValue()&&(n.thickness=u[t].getValue()),n.thicknessMethod!==parseInt(c[t].getValue())&&(n.thicknessMethod=parseInt(c[t].getValue())),n.invert!==g[t].getValue()&&(n.invert=g[t].getValue()),r.visible!==v[t].getValue()&&(r.visible=v[t].getValue());var s=_[t];s.lut!==y[t].getValue()&&(s.lut=y[t].getValue(),"none"===s.lut?(n.lutTexture=null,n.lut=!1):(n.lutTexture=s.texture,n.lut=!0)),n.intensityAuto=m[t].getValue(),!1===m[t].getValue()?(n.windowWidth=h[t].getValue(),n.windowCenter=d[t].getValue(),n.rescaleSlope=f[t].getValue(),n.rescaleIntercept=p[t].getValue(),o&&a.update(r)):(h[t].setValue(n.windowWidth),d[t].setValue(n.windowCenter),f[t].setValue(n.rescaleSlope),p[t].setValue(n.rescaleIntercept))}}if("number"==typeof r?n(r):r instanceof Event?n(parseInt(r.target.parentElement.id)):(n(0),n(1),n(2)),""==E.dom.style.display&&t!==parseInt(w.getValue())){let e=function(e){return 0===e?2:1===e?0:2===e?1:-1}(t=parseInt(w.getValue())),r=a.MedicalWorker;a.removeMedicalWorkspace(!1),a.createMedicalWorkspace(r.stack,"slicesWorkspace",e)}}function X(e){function r(e){var t=i[e];if(t){var r=t.slice;l[e].setValue(t.index),u[e].setValue(r.thickness),c[e].setValue(r.thicknessMethod.toString()),h[e].setValue(r.windowWidth),d[e].setValue(r.windowCenter),f[e].setValue(r.rescaleSlope),p[e].setValue(r.rescaleIntercept),m[e].setValue(r.intensityAuto),g[e].setValue(r.invert),v[e].setValue(t.visible),y[e].setValue(_[e].lut)}}"number"==typeof e?r(e):(r(0),r(1),r(2)),""==E.dom.style.display&&w.setValue(t.toString())}function Y(e){return 2===e.worldAxis?0:0===e.worldAxis?1:1===e.worldAxis?2:-1}return r.initSidebar.add((function(e){!function(e){if(E.setDisplay("none"),"quadWorkspace"===e.workspace){let t=e.medical;i[0]=t.children[0].children[0],i[1]=t.children[2].children[0],i[2]=t.children[3].children[0];for(let e=0;e<3;e++){let t=i[e],r=t.slice,n=t.stack;s[e].setDisplay(""),l[e].setRange(0,t.orientationMaxIndex),u[e].setRange(0,10),h[e].setRange(1,n.minMax[1]-n.minMax[0]),d[e].setRange(n.minMax[0],n.minMax[1]),f[e].setRange(-1/0,1/0),p[e].setRange(-1/0,1/0),_[e].lut="none",r.lutTexture=null,r.lut=!1,X(e)}}else if("slicesWorkspace"===e.workspace){E.setDisplay("");let r=e.medical.children[0].children[0],n=r.slice,a=r.stack,o=Y(r);if(-1===o)return;t=o,i[o]=r,i[(o+1)%3]=null,i[(o+2)%3]=null,s.forEach(e=>{e.setDisplay("none")}),s[o].setDisplay(""),l[o].setRange(0,r.orientationMaxIndex),u[o].setRange(0,10),h[o].setRange(1,a.minMax[1]-a.minMax[0]),d[o].setRange(a.minMax[0],a.minMax[1]),f[o].setRange(-1/0,1/0),p[o].setRange(-1/0,1/0),_[o].lut="none",n.lutTexture=null,n.lut=!1,X(o)}}(e)})),r.objectSelected.add((function(e){if("slicesWorkspace"===a.MedicalWorker.workspace){let r=Y(e);if(-1===r)return;r!==t&&console.warn("warning: unexpected slicer..."),i[r]=e,i[(r+1)%3]=null,i[(r+2)%3]=null,X(r),W(r)}})),b.update=function(e){if(void 0!==e){let t=Y(e);if(-1===t)return;l[t].setValue(i[t].index),W(t)}},b},a.MedicalSidebar.Volume=function(e){var t,r,n=e.signals,i=e.guiStrings,o=new fe.Panel;o.setBorderTop("0"),o.setPaddingTop("20px");var s=new fe.Row,l=(new fe.Number).setWidth("100px").onChange(B),u=new fe.Text(i.getKey("sidebar/volume/windowwidth")).setWidth("120px");u.onClick(f.bind(u)),u.onMouseOver(p.bind(u)),u.onMouseOut(m.bind(u)),s.add(u),s.add(l),o.add(s);var c=new fe.Row,h=(new fe.Number).setWidth("100px").onChange(B),d=new fe.Text(i.getKey("sidebar/volume/windowcenter")).setWidth("120px");function f(){e.guiHistogram.setDisplay(""),e.guiHistogram.update(t)}function p(){this.dom.style.cursor="pointer",this.dom.style.textDecoration="underline"}function m(){this.dom.style.cursor="",this.dom.style.textDecoration=""}d.onClick(f.bind(d)),d.onMouseOver(p.bind(d)),d.onMouseOut(m.bind(d)),c.add(d),c.add(h),o.add(c);var g=new fe.Row,v=(new fe.Number).setWidth("100px").onChange(B);g.add(new fe.Text(i.getKey("sidebar/volume/rescaleslope")).setWidth("120px")),g.add(v),o.add(g);var y=new fe.Row,_=(new fe.Number).setWidth("100px").onChange(B);y.add(new fe.Text(i.getKey("sidebar/volume/rescaleintercept")).setWidth("120px")),y.add(_),o.add(y);var b=new fe.Row,E=new fe.Checkbox(!0).setWidth("10px").onChange(B);b.add(new fe.Text(i.getKey("sidebar/volume/visible")).setWidth("120px")),b.add(E),o.add(b);var w=new fe.Row,x=(new fe.Integer).setWidth("100px").onChange(B);w.add(new fe.Text(i.getKey("sidebar/volume/steps")).setWidth("120px")),w.add(x),o.add(w);var T=new fe.Row,M=(new fe.Number).setWidth("100px").onChange(B);T.add(new fe.Text(i.getKey("sidebar/volume/alphacorrection")).setWidth("120px")),T.add(M),o.add(T);var S=new fe.Row,A=new fe.Checkbox(!0).setWidth("10px").onChange(B);S.add(new fe.Text(i.getKey("sidebar/volume/interpolation")).setWidth("120px")),S.add(A),o.add(S);var R=new fe.Row,k=new fe.Checkbox(!0).setWidth("10px").onChange(B);R.add(new fe.Text(i.getKey("sidebar/volume/shading")).setWidth("120px")),R.add(k),o.add(R);var P=new fe.Row,L=(new fe.Select).setWidth("135px").setOptions({0:i.getKey("sidebar/volume/algorithm/ray_marching"),1:i.getKey("sidebar/volume/algorithm/mip")}).setValue("ray_marching").onChange(B);P.add(new fe.Text(i.getKey("sidebar/volume/algorithm")).setWidth("120px")),P.add(L),o.add(P);var C=new fe.Row,I=(new fe.Select).setWidth("135px").setOptions({grayscale:i.getKey("sidebar/volume/lut/grayscale"),spectrum:i.getKey("sidebar/volume/lut/spectrum"),hot_and_cold:i.getKey("sidebar/volume/lut/hot_and_cold"),gold:i.getKey("sidebar/volume/lut/gold"),red_to_green:i.getKey("sidebar/volume/lut/red_to_green"),blue_to_green:i.getKey("sidebar/volume/lut/blue_to_green"),red_to_white:i.getKey("sidebar/volume/lut/red_to_white"),green_to_white:i.getKey("sidebar/volume/lut/green_to_white"),blue_to_white:i.getKey("sidebar/volume/lut/blue_to_white"),walking_dead:i.getKey("sidebar/volume/lut/walking_dead"),random:i.getKey("sidebar/volume/lut/random"),fire:i.getKey("sidebar/volume/lut/fire"),muscle_bone:i.getKey("sidebar/volume/lut/muscle_bone")}).setValue("grayscale").onChange(B);C.add(new fe.Text(i.getKey("sidebar/volume/lut")).setWidth("120px")),C.add(I),o.add(C);var H=new fe.Row,O=(new fe.Select).setWidth("135px").setOptions({linear:i.getKey("sidebar/volume/luto/linear"),lowpass:i.getKey("sidebar/volume/luto/lowpass"),bandpass:i.getKey("sidebar/volume/luto/bandpass"),highpass:i.getKey("sidebar/volume/luto/highpass"),flat:i.getKey("sidebar/volume/luto/flat"),random:i.getKey("sidebar/volume/luto/random"),linear_full:i.getKey("sidebar/volume/luto/linear_full")}).setValue("linear").onChange(B);H.add(new fe.Text(i.getKey("sidebar/volume/luto")).setWidth("120px")),H.add(O),o.add(H);var D=new fe.Row,F=new fe.Checkbox(!1).setWidth("10px").onChange(B);D.add(new fe.Text(i.getKey("sidebar/volume/tablediscrete")).setWidth("120px")),D.add(F),o.add(D);var N=new fe.Row,U=new a.LookupTable(N.dom);function B(){function n(){let r=e.guiHistogram;r&&""===r.dom.style.display&&r.update(t)}t.windowWidth!==l.getValue()&&(t.windowWidth=l.getValue(),n()),t.windowCenter!==h.getValue()&&(t.windowCenter=h.getValue(),n()),t.rescaleSlope!==v.getValue()&&(t.rescaleSlope=v.getValue()),t.rescaleIntercept!==_.getValue()&&(t.rescaleIntercept=_.getValue()),t.visible!==E.getValue()&&(t.visible=E.getValue()),r.uSteps.value!==x.getValue()&&(r.uSteps.value=x.getValue()),r.uAlphaCorrection.value!==M.getValue()&&(r.uAlphaCorrection.value=M.getValue()),r.uInterpolation.value!==A.getValue()&&(r.uInterpolation.value=A.getValue()),r.uShading.value!==k.getValue()&&(r.uShading.value=k.getValue()),r.uAlgorithm.value!==parseInt(L.getValue())&&(r.uAlgorithm.value=parseInt(L.getValue())),U.lut!==I.getValue()&&(U.lut=I.getValue(),t.lutTexture=U.texture,t.lut=!0),U.lutO!==O.getValue()&&(U.lutO=O.getValue(),t.lutTexture=U.texture,t.lut=!0),U.discrete!==F.getValue()&&(U.discrete=F.getValue(),t.lutTexture=U.texture,t.lut=!0)}function z(e){t=e.medical.children[1].children[0],r=t.uniforms;var n=t.stack;l.setRange(1,n.minMax[1]-n.minMax[0]),h.setRange(n.minMax[0],n.minMax[1]),v.setRange(0,1/0),_.setRange(-1/0,1/0),x.setRange(0,512),M.setRange(0,1).setStep(.01),U.lutO="linear",U.lut="grayscale",t.lutTexture=U.texture,t.lut=!0,U.discrete=!1,l.setValue(t.windowWidth),h.setValue(t.windowCenter),v.setValue(t.rescaleSlope),_.setValue(t.rescaleIntercept),E.setValue(t.visible),x.setValue(r.uSteps.value),M.setValue(r.uAlphaCorrection.value),A.setValue(r.uInterpolation.value),k.setValue(r.uShading.value),L.setValue(r.uAlgorithm.value.toString()),I.setValue(U.lut),O.setValue(U.lutO),F.setValue(U.discrete)}return o.add(N),n.initSidebar.add((function(e){"quadWorkspace"===e.workspace?(o.setDisplay(""),z(e)):"slicesWorkspace"===e.workspace&&o.setDisplay("none")})),o},a.MedicalSidebar.Isosurface=function(e){var t,r,n=e.signals,i=e.guiStrings,o=new fe.Panel;o.setBorderTop("0"),o.setPaddingTop("20px");var s=new fe.Row,l=(new fe.Integer).setWidth("100px").onChange(S);s.add(new fe.Text(i.getKey("sidebar/isosurface/isolevel")).setWidth("120px")),s.add(l),o.add(s);var u=new fe.Row,c=(new fe.Select).setWidth("135px").setOptions({1:i.getKey("sidebar/isosurface/stride/fine"),2:i.getKey("sidebar/isosurface/stride/middle"),4:i.getKey("sidebar/isosurface/stride/rough")}).setValue("2").onChange(S);u.add(new fe.Text(i.getKey("sidebar/isosurface/stride")).setWidth("120px")),u.add(c),o.add(u);var h=new fe.Row,d=(new fe.Select).setWidth("135px").setOptions({0:i.getKey("sidebar/isosurface/smoothing/none"),2:i.getKey("sidebar/isosurface/smoothing/little"),4:i.getKey("sidebar/isosurface/smoothing/rough"),6:i.getKey("sidebar/isosurface/smoothing/middle"),8:i.getKey("sidebar/isosurface/smoothing/fine"),10:i.getKey("sidebar/isosurface/smoothing/full")}).setValue("0").onChange(S);h.add(new fe.Text(i.getKey("sidebar/isosurface/smoothing")).setWidth("120px")),h.add(d),o.add(h);var f=new fe.Row,p=new fe.Checkbox(!1).setWidth("10px").onChange(S);f.add(new fe.Text(i.getKey("sidebar/isosurface/visible")).setWidth("120px")),f.add(p),o.add(f);var m=new fe.Row,g=(new fe.Color).onChange(S);m.add(new fe.Text(i.getKey("sidebar/isosurface/color")).setWidth("120px")),m.add(g),o.add(m);var v=new fe.Row,y=(new fe.Number).setWidth("100px").onChange(S);v.add(new fe.Text(i.getKey("sidebar/isosurface/opacity")).setWidth("120px")),v.add(y),o.add(v);var _=new fe.Row;_.setBorderTop("1px solid lightgrey"),_.setBorderBottom("1px solid lightgrey"),_.setVerticalAlign("middle");var b=new fe.Column,E=new fe.Checkbox(!1).onChange(S),w=(new fe.Texture).setDisplay("block").onChange(S);b.add(new fe.Text(i.getKey("sidebar/isosurface/matcap"))),b.add(E,new fe.Break),b.add(w),_.add(b),o.add(_);var x=new fe.Row,T=new fe.Checkbox(!0).setWidth("10px").onChange(S),M=[(new fe.Number).setWidth("70px").onChange(S),(new fe.Number).setWidth("70px").onChange(S),(new fe.Number).setWidth("70px").onChange(S),(new fe.Number).setWidth("70px").onChange(S),(new fe.Number).setWidth("70px").onChange(S),(new fe.Number).setWidth("70px").onChange(S)];function S(){if(t.isoLevel!==l.getValue()&&(t.isoLevel=l.getValue()),t.stride!==parseInt(c.getValue())&&(t.stride=parseInt(c.getValue())),t.smoothing!==parseFloat(d.getValue())&&(t.smoothing=.1*parseFloat(d.getValue())),t.visible!==p.getValue()&&(t.visible=p.getValue()),r.color.getHex()!==g.getHexValue()&&r.color.setHex(g.getHexValue()),r.opacity!==y.getValue()&&(r.opacity=y.getValue()),void 0!==r.matcap){var e=!0===E.getValue()?w.getValue():null;r.matcap!==e&&(r.matcap=e,r.needsUpdate=!0)}let n=a.appWorks.renderer;if(n.localClippingEnabled!==T.getValue()&&(n.localClippingEnabled=T.getValue()),r.clippingPlanes)if(!0===n.localClippingEnabled)for(var i=0;i<6;i++)r.clippingPlanes[i].constant!==M[i].getValue()&&(r.clippingPlanes[i].constant=M[i].getValue());else for(i=0;i<6;i++)M[i].setValue(r.clippingPlanes[i].constant)}function A(e){t=e.medical.children[1].children[4],r=t.material,l.setRange(0,255),t.visible=!1,y.setRange(0,1),b.setDisplay(void 0!==r.matcap?"":"none");for(var n=0;n<6;n++){let e=r.clippingPlanes[n].constant;M[n].setRange(0,e)}!function(){l.setValue(t.isoLevel),c.setValue(t.stride.toString()),d.setValue((10*t.smoothing).toString()),p.setValue(t.visible),g.setHexValue(r.color.getHex()),y.setValue(r.opacity),void 0!==r.matcap&&(E.setValue(null!==r.matcap),r.matcap&&w.setValue(r.matcap));let e=a.appWorks.renderer;if(T.setValue(e.localClippingEnabled),r.clippingPlanes)for(var n=0;n<6;n++)M[n].setValue(r.clippingPlanes[n].constant)}()}return x.add(new fe.Text(i.getKey("sidebar/isosurface/clipping")).setWidth("120px")),x.add(T,new fe.Break),x.add(new fe.Text(i.getKey("sidebar/isosurface/zclipping")).setWidth("120px")),x.add(M[4]),x.add(M[5]),x.add(new fe.Text(i.getKey("sidebar/isosurface/xclipping")).setWidth("120px")),x.add(M[0]),x.add(M[1]),x.add(new fe.Text(i.getKey("sidebar/isosurface/yclipping")).setWidth("120px")),x.add(M[2]),x.add(M[3]),o.add(x),n.initSidebar.add((function(e){"quadWorkspace"===e.workspace?(o.setDisplay(""),setTimeout(()=>A(e),1e3)):"slicesWorkspace"===e.workspace&&o.setDisplay("none")})),o},a.MedicalSidebar.Sketch=function(e){var t=e.signals,r=e.guiStrings,n=new fe.Panel;n.setBorderTop("0"),n.setPaddingTop("20px");var i=new fe.Row,o=(new fe.Select).setWidth("150px").setOptions({Handle:r.getKey("sidebar/sketch/type/handle"),VoxelProbe:r.getKey("sidebar/sketch/type/voxelprobe"),Ruler:r.getKey("sidebar/sketch/type/ruler"),BiRuler:r.getKey("sidebar/sketch/type/biruler"),Angle:r.getKey("sidebar/sketch/type/angle"),Rectangle:r.getKey("sidebar/sketch/type/rectangle"),Polygon:r.getKey("sidebar/sketch/type/polygon"),Freehand:r.getKey("sidebar/sketch/type/freehand"),Annotation:r.getKey("sidebar/sketch/type/annotation")}).setValue("Handle").onChange((function(){a.MedicalWorker.sketchType!==o.getValue()&&(a.MedicalWorker.sketchType=o.getValue())}));function s(e){e.sketchType="Handle",o.setValue(a.MedicalWorker.sketchType)}return i.add(new fe.Text(r.getKey("sidebar/sketch/type")).setWidth("90px")),i.add(o),n.add(i),t.initSidebar.add((function(e){s(e)})),n},a.MedicalSidebar.Settings=function(e){var t=e.guiStrings,r=new fe.Panel;r.setBorderTop("0"),r.setPaddingTop("20px");var n=new fe.Row,i=(new fe.Select).setOptions({111:"111",222:"222",333:"333"}).setWidth("150px").onChange((function(){console.log("updateAaa: aaaType = "+i.getValue()),console.log("refreshAaa: aaaType = "+i.getValue())}));return n.add(new fe.Text(t.getKey("sidebar/settings/aaa")).setWidth("90px")),n.add(i),r.add(n),r},a.MedicalIconbar=function(e){var t,r=e.guiStrings,n=new fe.Panel;return n.setId("iconbar"),(t=(new fe.Span).setClass("fas fa-file icon")).onClick((function(){confirm(r.getKey("others/confirmfilenew"))&&a.removeMedicalWorkspace()})),n.add(t),(t=(new fe.Span).setClass("fas fa-folder-open icon")).onClick((function(){e.fileExplorer.openFile()})),n.add(t),(t=(new fe.Span).setClass("fas fa-dice-four icon")).onClick((function(){a.removeMedicalWorkspace(!1),a.createMedicalWorkspace(a.MedicalWorker.stack,"quadWorkspace")})),n.add(t),(t=(new fe.Span).setClass("fas fa-city icon")).onClick((function(){a.removeMedicalWorkspace(!1),a.createMedicalWorkspace(a.MedicalWorker.stack,"slicesWorkspace")})),n.add(t),(t=(new fe.Span).setClass("fas fa-info icon")).onClick((function(){e.guiAbout.setDisplay("")})),n.add(t),e.guiIconbar=n,n},a.MedicalMenubar=function(e){var t=new fe.Panel;return t.setId("menubar"),t.add(new a.MedicalMenubar.File(e)),t},a.MedicalMenubar.File=function(e){var t=e.guiStrings,r=new fe.Panel;r.setClass("menu");var n=new fe.Panel;n.setClass("title"),n.setTextContent(t.getKey("menubar/file")),r.add(n);var i,a=new fe.Panel;return a.setClass("options"),r.add(a),(i=new fe.Row).setClass("option"),i.add((new fe.Span).setClass("fas fa-file icon")),i.add(new fe.Text(t.getKey("menubar/file/new"))),i.onClick((function(){confirm(t.getKey("others/confirmfilenew"))&&e.clear()})),a.add(i),(i=new fe.Row).setClass("option"),i.add((new fe.Span).setClass("fas fa-folder-open icon")),i.add(new fe.Text(t.getKey("menubar/file/open"))),i.onClick((function(){e.fileExplorer.openFile()})),a.add(i),r},a.MedicalModal=function(e){var t=new fe.Panel;return t.add(new a.MedicalModal.About(e)),t.add(new a.MedicalModal.Histogram(e)),t},a.MedicalModal.About=function(e){var t=new fe.Panel;t.setClass("Modal"),t.setDisplay("none");var r=new fe.Panel;r.setClass("content"),t.add(r);var n=(new fe.Row).setClass("header"),i=(new fe.Span).setClass("close").onClick((function(){t.setDisplay("none")})).add((new fe.Span).setClass("fas fa-times icon"));n.add(i),n.add(new fe.Text("About").setTextTransform("uppercase").setFontSize("18px")),r.add(n);var a=(new fe.Row).setClass("body");a.add(new fe.Text("Abstract").setFontSize("16px").setPadding("6px 0 6px 0"),new fe.Break,new fe.Text("This application is a 3D WebGL-based medical application that will provide versatile tools that import various kinds of medical files, construct anatomical models from these files, design patient-specific guides, and export the 3D models for CAE analysis or 3D printing.")),r.add(a);var o=(new fe.Row).setClass("body");return o.add(new fe.Text("Copyright Notice").setFontSize("16px ").setPadding("0 0 6px 0"),new fe.Break,new fe.Text("This presentation is protected by U.S. and International copyright laws. Reproduction and distribution of the presentation without written permission of the sponsor is prohibited."),new fe.Break,(new fe.Div).setPadding("6px 0").add(new fe.Text("Copyright"),(new fe.Span).setClass("fas fa-copyright icon").setPadding("0 6px"),new fe.Text("2020 NovaGraphix, Co. All rights reserved."))),r.add(o),e.guiAbout=t,t},a.MedicalModal.Histogram=function(e){var t,r=e.guiStrings,n=(new fe.Panel).setClass("Modal-draggble").setWidth("278px").setDisplay("none"),i=(new fe.Row).setClass("header"),o=(new fe.Span).setClass("close").onClick((function(){n.setDisplay("none")})).add((new fe.Span).setClass("fas fa-times icon"));i.add(new fe.Text(r.getKey("modal/histogram"))),i.add((new fe.Span).setClass("fas fa-chart-bar icon")),i.add(o),n.add(i);var s=new fe.Panel;n.add(s);var l=new fe.Row,u=new fe.Text("Title").setWidth("100px");l.add(u),s.add(l);var c={zSlicer:r.getKey("modal/histogram/graph/axial"),xSlicer:r.getKey("modal/histogram/graph/sagittal"),ySlicer:r.getKey("modal/histogram/graph/coronal"),volume:r.getKey("modal/histogram/graph/volume")};return a.setDraggable(n.dom),n.update=function(e,r){r=r||!1,t?!0===r?(t.computeHistogram(e),t.drawHistogram()):t.object=e:t=new a.MedicalHistogram(e,l.dom),function(){let e=t.object;e.isMedicalSlicer?u.setValue(c[e.name]):e.isMedicalVolume&&u.setValue(c.volume)}()},e.guiHistogram=n,n},Object.assign(_e.prototype,{isOctree:!0,importMesh:function(e){var t=this;function r(e){e.geometry=JAMIE.toGeometry(e.geometry),e.geometry.mergeVertices(),e.updateMatrix();var r=e.id,n=e.geometry.clone();n.applyMatrix(e.matrix),n.computeVertexNormals(),n.computeFaceNormals();for(var i=n.faces,a=n.vertices,o=0,s=i.length;o<s;o++){var l=new Ee(a[i[o].a],a[i[o].b],a[i[o].c],i[o].normal,r);t.addFace(l)}}e.isJamieInstancedMesh?e.split(e=>{e.forEach(e=>{r(e)})}):r(e)},addFace:function(e){for(var t=[],r=this.nodes[0].slice(0),n=0,i=this.maxDepth;n<i;n++){for(var a=0,o=r.length;a<o;a++){var s=r[a];me(e.a,e.b,e.c,s)&&(s.trianglePool.push(e),n+1!==this.maxDepth&&(t=t.concat(s.getChildNodes())))}if(0===t.length)break;r=t.slice(0),t.length=0}},removeMesh:function(e){this.nodes.forEach((function(t){t.forEach((function(t){var r=[];t.trianglePool.forEach((function(t){t.meshId!==e&&r.push(t)})),t.trianglePool=r}))}))},getIntersectedNodes:function(e,t){var r=[],n=[];if(!ge(e,this))return[];for(var i=this.nodes[0].slice(0),a=0,o=t;a<o;a++){for(var s=0,l=i.length;s<l;s++){var u=i[s];if(ge(e,u))a+1===t?0!==u.trianglePool.length&&n.push(u):r=r.concat(u.getChildNodes())}i=r.slice(0),r.length=0}return n}}),_e.separate3Bit=function(e){return e=2396745&((e=798915&((e=61455&(e|e<<8))|e<<4))|e<<2)},_e.getMortonNumber=function(e,t,r){return _e.separate3Bit(e)|_e.separate3Bit(t)<<1|_e.separate3Bit(r)<<2},_e.uniqTrianglesfromNodes=function(e){var t=[],r=!1;if(0===e.length)return[];if(1===e.length)return e[0].trianglePool.slice(0);for(var n=0,i=e.length;n<i;n++)for(var a=0,o=e[n].trianglePool.length;a<o;a++){for(var s=0,l=t.length;s<l;s++)e[n].trianglePool[a]===t[s]&&(r=!0);r||t.push(e[n].trianglePool[a]),r=!1}return t},Object.assign(be.prototype,{isOctreeNode:!0,getParentNode:function(){if(0===this.depth)return null;this.tree.nodes[this.depth][this.mortonNumber>>3]},getChildNodes:function(){if(this.tree.maxDepth===this.depth)return null;var e=this.mortonNumber<<3;return[this.tree.nodes[this.depth+1][e],this.tree.nodes[this.depth+1][e+1],this.tree.nodes[this.depth+1][e+2],this.tree.nodes[this.depth+1][e+3],this.tree.nodes[this.depth+1][e+4],this.tree.nodes[this.depth+1][e+5],this.tree.nodes[this.depth+1][e+6],this.tree.nodes[this.depth+1][e+7]]}});var Ee=function(e,t,r,n,i){this.a=e.clone(),this.b=t.clone(),this.c=r.clone(),this.normal=n.clone(),this.meshId=i};function we(){this.colliderPool=[],this.playerPool=[]}Object.assign(we.prototype,{isWorld:!0,add:function(e){e.isOctree?this.colliderPool.push(e):e.isHeroController&&(this.playerPool.push(e),e.world=this)},step:function(e){for(var t=0,r=this.playerPool.length;t<r;t++){for(var n,i=this.playerPool[t],a=0,o=this.colliderPool.length;a<o;a++){var s=this.colliderPool[a],l=new THREE.Sphere(i.center,i.radius+i.groundPadding),u=s.getIntersectedNodes(l,s.maxDepth);if((n=_e.uniqTrianglesfromNodes(u)).length>0)break}i.collisionCandidate=n,i.update(e)}}});Math.PI;function xe(e,t){var r,n,i=this;this.player=e,this.controller=t,this.explosionPoints=(r=Array(150).fill(0),(n=JAMIE.createPoints(r,{map:(new THREE.TextureLoader).load("images/sprites/ball.png"),color:16711680,size:.2})).name="game.explosionPoints",n.visible=!1,n.explosionPower=1.06,n.wasExplosion=!1,n.isExplosion=!1,JAMIE.add(n),n.explode=function(e){var t=i.controller.radius;this.position.x=e.x,this.position.y=e.y+t,this.position.z=e.z;for(var r=new THREE.Vector3,n=this.geometry.attributes.position,a=0,o=n.count;a<o;a++)r.fromBufferAttribute(n,a),r.x=JAMIE.randFloat(-.4,.4),r.y=JAMIE.randFloat(-.4,.4),r.z=JAMIE.randFloat(-.4,.4),n.setXYZ(a,r.x,r.y,r.z);this.explosionPower=1.2,this.visible=!0},n.update=function(e,t){this.visible&&(this.scale.setScalar(this.explosionPower),this.explosionPower>.5?this.explosionPower-=.008:this.visible=!1)},n)}function Te(e,t){this.object=e,this.center=this.object.position.clone(),this.radius=t,this.groundPadding=.5,this.maxSlopeGradient=Math.cos(50*THREE.Math.DEG2RAD),this.isGrounded=!1,this.isOnSlope=!1,this.isIdling=!1,this.isRunning=!1,this.isJumping=!1,this.direction=0,this.movementSpeed=10,this.velocity=new THREE.Vector3(0,-10,0),this.currentJumpPower=0,this.jumpStartTime=0,this.groundHeight=0,this.groundNormal=new THREE.Vector3,this.collisionCandidate,this.contactInfo=[]}Object.assign(xe.prototype,{isHeroAnimator:!0,play:function(e){if(JAMIE.appWorks&&JAMIE.appWorks.playAction(this.player,e,{duration:.3}),"Explode"===e){var t=this;this.controller.contactInfo.forEach((function(e){var r=JAMIE.scene.getObjectById(e.face.meshId);if(r){var n=t.explosionPoints;"game.terrain"===r.name?!1===n.isExplosion?(n.wasExplosion=!1,n.isExplosion=!1):(n.wasExplosion=!0,n.isExplosion=!1):!1===n.isExplosion?(n.wasExplosion=!1,n.isExplosion=!0,n&&n.explode(e.contactPoint)):(n.wasExplosion=!0,n.isExplosion=!0)}else console.warn(">> warning: collision detection but cannot find the intersected faces...")}))}},update:function(e,t){this.explosionPoints.update()}}),Te.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:Te,isHeroController:!0,printAnimState:function(e){console.log("--- "+e+" ---"),console.log("Ground: "+wasGrounded+" ==> "+this.isGrounded),console.log("Slope : "+wasOnSlope+" ==> "+this.isOnSlope),console.log("Idle  : "+wasIdling+" ==> "+this.isIdling),console.log("Run   : "+wasRunning+" ==> "+this.isRunning),console.log("Jump  : "+wasJumping+" ==> "+this.isJumping)},events:function(){var e,t,r,n,i=!0;return function(){if(i)return i=!1,e=this.isGrounded,t=this.isOnSlope,this.isIdling,r=this.isRunning,void(n=this.isJumping);r||this.isRunning||!this.isGrounded||this.isIdling?!r&&this.isRunning&&!this.isJumping&&this.isGrounded||!e&&this.isGrounded&&this.isRunning||t&&!this.isOnSlope&&this.isRunning&&this.isGrounded?(this.isIdling=!1,this.movementSpeed>10?this.dispatchEvent({type:"startRunning"}):this.dispatchEvent({type:"startWalking"})):!n&&this.isJumping?(this.isIdling=!1,this.dispatchEvent({type:"startJumping"})):!t&&this.isOnSlope?this.dispatchEvent({type:"startSliding"}):!e||this.isGrounded||this.isJumping||this.dispatchEvent({type:"startFalling"}):(this.isIdling=!0,this.dispatchEvent({type:"startIdling"})),!e&&this.isGrounded,e=this.isGrounded,t=this.isOnSlope,this.isIdling,r=this.isRunning,n=this.isJumping}}(),update:function(e){this.isGrounded=!1,this.isOnSlope=!1,this.groundHeight=-1/0,this.groundNormal.set(0,1,0),this.updateGrounding(),this.updateJumping(),this.updatePosition(e),this.collisionDetection(),this.solvePosition(),this.updateVelocity(),this.events()},updateVelocity:function(){var e=-Math.cos(this.direction),t=-Math.sin(this.direction),r=!1;if(this.velocity.set(t*this.movementSpeed*this.isRunning,-20,e*this.movementSpeed*this.isRunning),0!==this.contactInfo.length||this.isJumping){if(!this.isGrounded||this.isOnSlope||this.isJumping)if(this.isOnSlope){var n=20/(1-this.groundNormal.y)*.2;this.velocity.x=this.groundNormal.x*n,this.velocity.y=-20,this.velocity.z=this.groundNormal.z*n}else this.isGrounded||this.isOnSlope||!this.isJumping||(this.velocity.y=20*this.currentJumpPower);else this.velocity.y=0;for(var i=new THREE.Vector2(t,e),a=Math.atan2(-i.y,-i.x),o=0,s=this.contactInfo.length;o<s;o++){var l=this.contactInfo[o].face.normal;if(!(this.maxSlopeGradient<l.y||this.isOnSlope)){!r&&l.y<0&&(r=!0);var u=new THREE.Vector2(l.x,l.z).normalize(),c=Math.atan2(u.y,u.x);Math.abs(a-c)>=.5*Math.PI&&Math.abs(a-c)<=1.5*Math.PI||(u.set(i.dot(u)*u.x,i.dot(u)*u.y),i.sub(u),this.velocity.x=i.x*this.movementSpeed*this.isRunning,this.velocity.z=i.y*this.movementSpeed*this.isRunning)}}r&&(this.velocity.y=Math.min(0,this.velocity.y),this.isJumping=!1)}},updateGrounding:function(){for(var e=void 0,t=void 0,r=this.collisionCandidate,n=new THREE.Vector3(this.center.x,this.center.y+this.radius,this.center.z),i=new THREE.Vector3(this.center.x,this.center.y-1e10,this.center.z),a=0,o=r.length;a<o;a++)((t=ye(n,i,r[a].a,r[a].b,r[a].c))&&!e||t&&t.contactPoint.y>e.contactPoint.y)&&((e=t).face=r[a]);if(e){this.groundHeight=e.contactPoint.y,this.groundNormal.copy(e.face.normal);var s=n.y,l=this.center.y-this.radius-this.groundPadding;if(this.isJumping&&0<this.currentJumpPower)return this.isOnSlope=!1,void(this.isGrounded=!1);this.isGrounded=l<=this.groundHeight&&this.groundHeight<=s,this.isOnSlope=this.groundNormal.y<=this.maxSlopeGradient,this.isGrounded&&(this.isJumping=!1)}},updatePosition:function(e){var t=this.groundHeight+this.radius,r=this.center.x+this.velocity.x*e,n=this.center.y+this.velocity.y*e,i=this.center.z+this.velocity.z*e;this.center.set(r,this.isGrounded?t:n,i)},collisionDetection:function(){var e=this.collisionCandidate;this.contactInfo.length=0;for(var t=0,r=e.length;t<r;t++){var n=ve(this,e[t].a,e[t].b,e[t].c,e[t].normal);n&&(n.face=e[t],this.contactInfo.push(n))}},solvePosition:function(){var e,t,r=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3;if(0!==this.contactInfo.length){for(var s=0,l=this.contactInfo.length;s<l;s++)if(e=this.contactInfo[s].face,t=this.contactInfo[s].face.normal,!(this.maxSlopeGradient<t.y)){var u=this.maxSlopeGradient<=e.normal.y&&e.normal.y<1;if(this.isJumping&&0>=this.currentJumpPower&&u&&(this.isJumping=!1,this.isGrounded=!0),this.isGrounded||this.isOnSlope){r.copy(t).multiplyScalar(-this.radius).add(this.center),i.set(t.x,0,t.z).normalize();var c=(e.a.dot(t)-(t.x*r.x+t.y*r.y+t.z*r.z))/(t.x*i.x+t.y*i.y+t.z*i.z);n.copy(i).multiplyScalar(c).add(r),a.subVectors(n,r),Math.abs(o.x)>Math.abs(a.x)&&(o.x+=a.x),Math.abs(o.z)>Math.abs(a.z)&&(o.z+=a.z)}else;}this.center.add(o),this.object.position.copy(this.center)}else this.object.position.copy(this.center)},setDirection:function(){},jump:function(){this.isJumping||!this.isGrounded||this.isOnSlope||(this.jumpStartTime=Date.now(),this.currentJumpPower=1,this.isJumping=!0)},run:function(){!this.isJumping&&this.isGrounded&&(10===this.movementSpeed?this.movementSpeed=20:this.movementSpeed=10)},updateJumping:function(){if(this.isJumping){var e=(Date.now()-this.jumpStartTime)/1e3;this.currentJumpPower=Math.cos(Math.min(e,1)*Math.PI)}}});var Me=Math.PI/180,Se=0*Me,Ae=45*Me,Re=90*Me,ke=135*Me,Pe=180*Me,Le=225*Me,Ce=270*Me,Ie=315*Me;function He(e){this.dom=e||document.body,this.isDisabled=!1,this.isUp=!1,this.isDown=!1,this.isLeft=!1,this.isRight=!1,this.isMoveKeyHolded=!1,this.frontAngle=0,this._keydownListener=Oe.bind(this),this._keyupListener=De.bind(this),this._blurListener=Fe.bind(this),this.dom.addEventListener("keydown",this._keydownListener,!1),this.dom.addEventListener("keyup",this._keyupListener,!1),this.dom.addEventListener("blur",this._blurListener,!1)}function Oe(e){if(!this.isDisabled){switch(e.keyCode){case 87:case 38:this.isUp=!0;break;case 83:case 40:this.isDown=!0;break;case 65:case 37:this.isLeft=!0;break;case 68:case 39:this.isRight=!0;break;case 32:this.jump();break;case 18:case 21:e.preventDefault(),this.run();break;default:return}var t=this.frontAngle;this.updateAngle(),t!==this.frontAngle&&this.dispatchEvent({type:"movekeychange"}),(this.isUp||this.isDown||this.isLeft||this.isRight)&&!this.isMoveKeyHolded&&(this.isMoveKeyHolded=!0,this.dispatchEvent({type:"movekeyon"}))}}function De(e){if(!this.isDisabled){switch(e.keyCode){case 87:case 38:this.isUp=!1;break;case 83:case 40:this.isDown=!1;break;case 65:case 37:this.isLeft=!1;break;case 68:case 39:this.isRight=!1;break;case 32:break;default:return}var t=this.frontAngle;this.updateAngle(),t!==this.frontAngle&&this.dispatchEvent({type:"movekeychange"}),this.isUp||this.isDown||this.isLeft||this.isRight||87!==e.keyCode&&38!==e.keyCode&&83!==e.keyCode&&40!==e.keyCode&&65!==e.keyCode&&37!==e.keyCode&&68!==e.keyCode&&39!==e.keyCode||(this.isMoveKeyHolded=!1,this.dispatchEvent({type:"movekeyoff"}))}}function Fe(){this.isUp=!1,this.isDown=!1,this.isLeft=!1,this.isRight=!1,this.isMoveKeyHolded&&(this.isMoveKeyHolded=!1,this.dispatchEvent({type:"movekeyoff"}))}He.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:He,isKeyInputControl:!0,jump:function(){this.dispatchEvent({type:"jumpkeypress"})},run:function(){this.dispatchEvent({type:"runkeypress"})},updateAngle:function(){var e=this.isUp,t=this.isDown,r=this.isLeft,n=this.isRight;!e||r||t||n?e&&r&&!t&&!n?this.frontAngle=Ae:e||!r||t||n?!e&&r&&t&&!n?this.frontAngle=ke:e||r||!t||n?!e&&!r&&t&&n?this.frontAngle=Le:e||r||t||!n?e&&!r&&!t&&n&&(this.frontAngle=Ie):this.frontAngle=Ce:this.frontAngle=Pe:this.frontAngle=Re:this.frontAngle=Se}});var Ne=2*Math.PI,Ue=Math.PI/2,Be=new THREE.Matrix4,ze=new THREE.Matrix4,je=new THREE.Matrix4;function Ve(e,t,r){r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.camera=e,this.trackObject=t,this.dom=r.dom||document.body,this.offset=r.offset||new THREE.Vector3(0,0,0),this.radius=r.radius||10,this.minRadius=r.minRadius||1,this.maxRadius=r.maxRadius||80,this.rigidObjects=r.rigidObjects||[],this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.mouseAccelerationX=void 0!==r.mouseAccelerationX?r.mouseAccelerationX:100,this.mouseAccelerationY=void 0!==r.mouseAccelerationY?r.mouseAccelerationY:30,this._pointerStart={x:0,y:0},this._pointerLast={x:0,y:0},this.setNearPlainCornersWithPadding(),this.update(),this._mousedownListener=Ge.bind(this),this._mouseupListener=We.bind(this),this._mousedragListener=Xe.bind(this),this._scrollListener=Ye.bind(this),this.dom.addEventListener("mousedown",this._mousedownListener,!1),this.dom.addEventListener("mouseup",this._mouseupListener,!1),this.dom.addEventListener("wheel",this._scrollListener,!0),this.dom.addEventListener("DOMMouseScroll",this._scrollListener,!0)}function Ge(e){e.button===THREE.MOUSE.LEFT&&(this.dispatchEvent({type:"mousedown"}),this._pointerStart.x=e.clientX,this._pointerStart.y=e.clientY,this._pointerLast.x=this.lon,this._pointerLast.y=this.lat,this.dom.removeEventListener("mousemove",this._mousedragListener,!1),this.dom.addEventListener("mousemove",this._mousedragListener,!1))}function We(){event.button===THREE.MOUSE.LEFT&&(this.dispatchEvent({type:"mouseup"}),this.dom.removeEventListener("mousemove",this._mousedragListener,!1))}function Xe(e){if(e.button===THREE.MOUSE.LEFT){var t=this.dom.offsetWidth,r=this.dom.offsetHeight,n=(this._pointerStart.x-e.clientX)/t*2,i=(this._pointerStart.y-e.clientY)/r*2;this.setLatLon(this._pointerLast.y+i*this.mouseAccelerationY,this._pointerLast.x+n*this.mouseAccelerationX)}}function Ye(e){e.preventDefault(),e.wheelDeltaY?this.radius-=.05*e.wheelDeltaY/5:e.wheelDelta?this.radius-=.05*e.wheelDelta/5:e.detail&&(this.radius+=e.detail/5),this.radius=Math.max(this.radius,this.minRadius),this.radius=Math.min(this.radius,this.maxRadius)}Ve.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:Ve,isTPSCameraControl:!0,handleResize:function(){},update:function(){this._center=new THREE.Vector3(this.trackObject.matrixWorld.elements[12]+this.offset.x,this.trackObject.matrixWorld.elements[13]+this.offset.y,this.trackObject.matrixWorld.elements[14]+this.offset.z);var e=new THREE.Vector3(Math.cos(this.phi)*Math.cos(this.theta+Ue),Math.sin(this.phi),Math.cos(this.phi)*Math.sin(this.theta+Ue)),t=this.collisionTest(e.clone().normalize());e.multiplyScalar(t),e.add(this._center),this.camera.position.copy(e),90===this.lat?this.camera.up.set(Math.cos(this.theta+Math.PI),0,Math.sin(this.theta+Math.PI)):-90===this.lat?this.camera.up.set(Math.cos(this.theta),0,Math.sin(this.theta)):this.camera.up.set(0,1,0),this.camera.lookAt(this._center),this.dispatchEvent({type:"updated"})},getFrontAngle:function(){return Ne+this.theta},setNearPlainCornersWithPadding:function(){var e=this.camera.near,t=.5*this.camera.fov,r=Math.tan(t*THREE.Math.DEG2RAD)*e,n=r*this.camera.aspect;this.nearPlainCornersWithPadding=[new THREE.Vector3(-n-e,-r-e,0),new THREE.Vector3(n+e,-r-e,0),new THREE.Vector3(n+e,r+e,0),new THREE.Vector3(-n-e,r+e,0)]},setLatLon:function(e,t){this.lat=e>90?90:e<-90?-90:e,this.lon=t<0?360+t%360:t%360,this.phi=this.lat*THREE.Math.DEG2RAD,this.theta=-this.lon*THREE.Math.DEG2RAD},collisionTest:function(e){var t=this.radius;ze.makeRotationX(this.phi),je.makeRotationY(this.theta),Be.multiplyMatrices(ze,je);for(var r=0;r<4;r++){var n=this.nearPlainCornersWithPadding[r].clone();n.applyMatrix4(Be);var i=new THREE.Vector3(this._center.x+n.x,this._center.y+n.y,this._center.z+n.z),a=new THREE.Raycaster(i,e,this.camera.near,this.radius).intersectObjects(this.rigidObjects);0!==a.length&&a[0].distance<t&&(t=a[0].distance)}return t}}),window.MW=n,a.demoFallingLeaves=function(e,t){e=void 0!==e?e:"images/leaf.png",t=void 0!==t?t:1e4;for(var r=new a.InstancedMesh(new THREE.PlaneBufferGeometry(.1,.1),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(e),side:THREE.DoubleSide,transparent:!0,opacity:.99,depthWrite:!1}),t,!0,!0,!0),n=2*Math.PI,i=new THREE.Vector3,o=new THREE.Euler,s=new THREE.Quaternion,l=new THREE.Vector3,u=new THREE.Color,c=0;c<t;c++){i.set(50*(Math.random()-.5),50*(Math.random()-.5)+25,50*(Math.random()-.5)),o.set(0,Math.random()*n,0),s.setFromEuler(o);var h=1+Math.random();l.set(h,h,h),u.setHSL(1,Math.random(),.5),r.setPositionAt(c,i),r.setQuaternionAt(c,s),r.setScaleAt(c,l),r.setColorAt(c,u)}r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,a.add(r),r.update=function(e,t){for(var r=.1*e,n=new THREE.Vector3,i=new THREE.Euler,a=new THREE.Quaternion,o=new THREE.Vector3,s=0;s<this.numInstances;s++)this.getPositionAt(s,n),n.y<.01?n.x<-25?(n.x=50*(Math.random()-.5),n.y=50*(Math.random()-.5)+25,n.z=50*(Math.random()-.5)):(n.x-=5*r,n.z+=5*r*(Math.random()-.5),this.getQuaternionAt(s,a),i.setFromQuaternion(a),i.x=-Math.PI/2,i.y=0,a.setFromEuler(i),this.setQuaternionAt(s,a)):n.y-=5*r,this.setPositionAt(s,n),this.getQuaternionAt(s,a),this.getScaleAt(s,o),i.setFromQuaternion(a),i.x+=o.x*r,i.z+=o.z*r,a.setFromEuler(i),this.setQuaternionAt(s,a);this.needsUpdate("position"),this.needsUpdate("quaternion"),this.rotation.y=.1*Math.sin(.5*t)}},a.demoNatureWorks2018=function(){var e=a.scene,t=a.camera;a.appWorks.playAudio(["audio/NatureWorks.mp3"]),a.appWorks.bloomPass.enabled=!0,e.getObjectsByType("AmbientLight").forEach((function(e){e.visible=!1})),e.getObjectsByType("PointLight").forEach((function(e){e.visible=!1})),e.getObjectsByType("SpotLight").forEach((function(e){e.visible=!1})),e.getObjectsByType("DirectionalLight").forEach((function(e){e.visible=!1})),e.getObjectsByType("HemisphereLight").forEach((function(e){e.visible=!1})),a.demoTerrains();var r=a.sunLight;r.updateMotion("constant"),a.addTextMesh("www.natureworks.solutions",{position:{x:-3.5,y:1.1,z:0},color:2236962,height:.25,alignment:0,fontFile:"fonts/optimer_regular.typeface.json"});var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(.85,.85),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("images/leaf.png"),side:THREE.DoubleSide,transparent:!0,opacity:.99,depthWrite:!1}));n.position.x-=4,n.position.y+=.5,a.add(n);a.addTextMesh("N",{position:{x:-3,y:0,z:0},color:16716032,rotSpeed:0}),a.addTextMesh("ature",{position:{x:-1,y:0,z:0},color:8947848}),a.addTextMesh("W",{position:{x:4.2-3,y:0,z:0},color:4607,rotSpeed:.6}),a.addTextMesh("orks",{position:{x:5.9-3,y:0,z:0},color:8947848}),a.demoFallingLeaves("images/leaf.png",5e3);for(var i=[],o=0;o<6;o++){var s=Math.PI*o/4,l=7*Math.cos(s),u=5*Math.sin(2*s);u=Math.max(u,1);var c=9*Math.sin(s);i.push(new THREE.Vector3(l,u,c))}var h=new THREE.CatmullRomCurve3(i,!0),d=new THREE.Line((new THREE.BufferGeometry).setFromPoints(h.getPoints(20)),new THREE.LineBasicMaterial({color:16777215}));d.visible=!1,a.add(d),d.update=function(e,r){var n=r%40/40;t.position.copy(h.getPoint(n))};var f=new THREE.Object3D;f.stage=1,a.add(f),f.update=function(e,t){10<t&&1===this.stage?(a.demoFallingLeaves("images/leaf.png",5e3),this.stage++):20<t&&2===this.stage?(a.demoFallingLeaves("images/leaves/leaf1.png",1e4),this.stage++):40<t&&3===this.stage&&(a.demoFallingLeaves("images/leaves/leaf3.png",1e4),this.stage++,r.updateMotion("static"),r.updatePosition(.49))}},a.demoBasicPrimitives=function(){var e=(new THREE.TextureLoader).load("images/uv_grid_opengl.jpg"),t=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshBasicMaterial",map:e}}),r=a.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[5,5,10,32]},material:{type:"MeshBasicMaterial",map:e}}),n=a.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshBasicMaterial",map:e}}),i=a.createPrimitive({geometry:{type:"TorusBufferGeometry",parameters:[5,1.5,128,32]},material:{type:"MeshBasicMaterial",map:e}}),o=a.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.5,128,32]},material:{type:"MeshBasicMaterial",map:e}});t.position.y=0,r.position.y=10,n.position.y=20,i.position.y=30,o.position.y=40,a.add(t),a.add(r),a.add(n),a.add(i),a.add(o)},a.demoText=function(){a.addTextMesh("[NatureWorks]",{color:4521745,height:2.5,position:{x:0,y:18,z:-5}}),a.addTextMesh("Jamie.js",{position:new THREE.Vector3(0,5,0),color:13311,height:2,thickRatio:.2}),a.addTextMesh("www.nova-graphix.com",{position:{x:1.5,y:-5,z:0},color:16716168,height:1.5,thickRatio:.5})},a.demoSprite=function(){var e=new THREE.Sprite(new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load("images/jamieElly1024.png"),color:16777215,fog:!0}));e.position.z=8,e.scale.set(5,5,5),e.name="demoSprite",a.add(e)},a.demoBox=function(){var e=new THREE.TextureLoader,t=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",color:15990754,map:e.load("images/ground/stonewall.png"),normalMap:e.load("images/ground/stonewall_n.png"),specularMap:e.load("images/ground/stonewall_s.png")}});t.position.x=-15,t.name="demoBox",t.update=function(e,t){this.rotation.x+=.1*e,this.rotation.y+=.2*e,this.rotation.z+=.5*e},a.add(t)},a.demoSpheres=function(){var e,t;(t=a.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16711680,specular:2236962,shininess:150,transparent:!0,opacity:.5}})).name="demoSphere_transparent",a.add(t),(e=a.scene.background.clone()).mapping=THREE.CubeRefractionMapping,e.needsUpdate=!0,(t=a.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16777215,specular:2236962,shininess:150,envMap:e}})).position.z=10,t.name="demoSphere_refraction",a.add(t),(e=a.scene.background).mapping=THREE.CubeReflectionMapping,e.needsUpdate=!0,(t=a.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16777215,specular:2236962,shininess:150,envMap:e}})).position.z=20,t.name="demoSphere_reflection",a.add(t)},a.demoPBRSpheres=function(){for(var e=new THREE.SphereBufferGeometry(.8,32,16),t=new THREE.Vector3(0,0,-22),r=0;r<=1;r+=.2){for(var n=0;n<=1;n+=.2)for(var i=0;i<=1;i+=.2){var o=(new THREE.Color).setHSL(r,.5,.5*i+.1),s=new THREE.MeshStandardMaterial({color:o,metalness:n,roughness:1-r,bumpScale:1});0;var l=new THREE.Mesh(e,s);l.position.x=10*r-5+t.x,l.position.y=10*n-5+t.y,l.position.z=10*i-5+t.z,l.castShadow=!0,l.name="demoPBRSpheres",a.add(l)}0}},a.demoTorusKnot=function(){var e=(new THREE.TextureLoader).load("images/roughness_map.jpg",(function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.anisotropy=4,e.repeat.set(9,2)})),t=a.createPrimitive({geometry:{type:"TorusKnotGeometry",parameters:[18,8,128,32]},material:{type:"MeshStandardMaterial",color:16777215,metalness:1,roughness:0,bumpScale:-.05,transparent:!0,opacity:.9,map:e,roughnessMap:e,bumpMap:e,envMap:a.scene.background}});t.scale.set(.2,.2,.2),t.position.z=-10,t.castShadow=!0,t.receiveShadow=!0,t.name="demoTorusKnot",a.add(t)},a.demoTeapot=function(){a.loadOBJ({obj:"teapot.obj",basePath:"models/obj/",callback:function(e){var t=e.children[0];void 0!==t.material&&t.material.dispose();var r=a.ToonShader,n=THREE.UniformsUtils.clone(r.uniforms);n.uMaterialColor.value=(new THREE.Color).setHSL(.34,.68,.7),n.uDirLightPos.value=new THREE.Vector3(100,100,-100),n.uDirLightColor.value=new THREE.Color(16777215),t.material=new THREE.ShaderMaterial({uniforms:n,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),a.resizeObject(t,20),a.add(e),t.position.x+=15,t.castShadow=!0,t.receiveShadow=!0,t.name="demoTeapot"}})},a.demoNoise=function(){var e=a.NoiseShader,t=THREE.UniformsUtils.clone(e.uniforms);t.scale.value=20;var r=new THREE.Mesh(new THREE.SphereBufferGeometry(5,32,16),new THREE.ShaderMaterial({uniforms:t,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}));r.position.set(17.5,0,-10),r.castShadow=!0,r.receiveShadow=!0,r.name="demoNoise",a.add(r)},a.demoDecal=function(){var e=new THREE.BoxBufferGeometry(10,10,10),t=new THREE.TextureLoader,r=t.load("images/decal/decal-diffuse.png"),n=t.load("images/decal/decal-normal.jpg"),i=a.scene.background;i.mapping=THREE.CubeReflectionMapping,i.needsUpdate=!0;var o=new THREE.MeshPhongMaterial({map:r,normalMap:n,envMap:i,alphaTest:.5}),s=new THREE.Mesh(e,o);s.position.set(-15,0,15),s.castShadow=!0,s.receiveShadow=!0,s.name="demoDecal",a.add(s)},a.demoPrimitives=function(){a.demoBasicPrimitives(),a.demoSprite(),a.demoBox(),a.demoPBRSpheres(),a.demoTorusKnot(),a.demoTeapot(),a.demoNoise(),a.demoDecal()},a.demoReflectionSpheres=function(){for(var e=a.camera.near,t=a.camera.far,r=new THREE.SphereBufferGeometry(1,32,16),n=0;n<50;n++){var i=new THREE.Mesh(r);i.cubeCamera=new THREE.CubeCamera(e,t,256),i.material=new THREE.MeshBasicMaterial({envMap:i.cubeCamera.renderTarget.texture});var o=200*(Math.random()-.5),s=200*(Math.random()-.5),l=200*(Math.random()-.5),u=10*(Math.random()+.5);i.position.set(o,s,l),i.scale.setScalar(u),i.castShadow=!0,i.receiveShadow=!0,i.name="demoReflectionSpheres",i.cubeCamera.position.copy(i.position),i.update=function(e,t){this.visible=!1,this.cubeCamera.update(a.appWorks.renderer,a.appWorks.scene),this.visible=!0},a.add(i)}},a.demoRefractionSpheres=function(){for(var e=a.camera.near,t=a.camera.far,r=new THREE.SphereBufferGeometry(1,32,16),n=0;n<20;n++){var i=new THREE.Mesh(r);i.cubeCamera=new THREE.CubeCamera(e,t,256),i.material=new THREE.MeshBasicMaterial({envMap:i.cubeCamera.renderTarget.texture,refractionRatio:.99}),i.material.envMap.mapping=THREE.CubeRefractionMapping;var o=150*(Math.random()-.5),s=150*(Math.random()-.5),l=150*(Math.random()-.5),u=10*(Math.random()+.5);i.position.set(o,s,l),i.scale.setScalar(u),i.castShadow=!0,i.receiveShadow=!0,i.name="demoRefractionSpheres",i.cubeCamera.position.copy(i.position),i.update=function(e,t){this.visible=!1,this.cubeCamera.update(a.appWorks.renderer,a.appWorks.scene),this.visible=!0},a.add(i)}},a.demoReflectRefractSpheres=function(){a.demoReflectionSpheres(),a.demoRefractionSpheres()},a.demoPointSpriteColors=function(){for(var e=[],t=new THREE.Geometry,r=(new THREE.TextureLoader).load("images/sprites/ball.png"),n=0;n<5e4;n++){var i=new THREE.Vector3;i.x=1e4*(Math.random()-.5),i.y=1e4*(Math.random()-.5),i.z=1e4*(Math.random()-.5),t.vertices.push(i),e[n]=new THREE.Color(16777215),e[n].setHSL((i.x+500)/1e3,1,.5)}t.colors=e;var o=new THREE.PointsMaterial({size:85,map:r,vertexColors:!0,alphaTest:.5,transparent:!0});o.color.setHSL(1,1,.6);var s=new THREE.Points(t,o);s.name="demoPointSpriteColors",s.update=function(e,t){var r=360*(1+.2*t)%360/360;this.material.color.setHSL(r,1,.6),this.rotation.x+=.1*e,this.rotation.y+=.2*e,this.rotation.z+=.3*e},a.add(s)},a.demoInstancedBox=function(){var e=new THREE.TextureLoader,t=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[2,2,2]},material:{type:"MeshPhongMaterial",color:15990754,specular:1118481,shininess:30,map:e.load("images/ground/stonewall.png"),normalMap:e.load("images/ground/stonewall_n.png"),specularMap:e.load("images/ground/stonewall_s.png")}}),r=a.createInstancedMeshes(t,{pmin:[-100,-100,-100],pmax:[100,100,100],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"1"});r.name="demoInstancedBox",r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.update=function(){var e=new THREE.Euler,t=new THREE.Quaternion,r=new THREE.Vector3;return function(n,i){for(var a=2*n,o=0;o<this.numInstances;o++)this.getQuaternionAt(o,t),this.getScaleAt(o,r),e.setFromQuaternion(t),e.x+=r.x*a,e.z+=r.z*a,t.setFromEuler(e),this.setQuaternionAt(o,t);this.needsUpdate("quaternion")}}(),a.add(r)},a.demoInstancedBox2=function(){var e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[1,1,1]},material:{type:"MeshPhongMaterial",map:(new THREE.TextureLoader).load("images/crate.gif")}}),t=a.createInstancedMeshes(e,{pmin:[-50,-50,-50],pmax:[50,50,50],smin:[.5,.5,.5],smax:[2,2,2],numInstances:1e4,colorMode:"0"});t.name="demoInstancedBox2",t.frustumCulled=!1,t.castShadow=!0,t.receiveShadow=!0;for(var r=t.geometry,n=new THREE.Vector4,i=[],o=[],s=0;s<t.numInstances;s++)n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),n.normalize(),i.push(n.x,n.y,n.z,n.w),n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),n.normalize(),o.push(n.x,n.y,n.z,n.w);r.setAttribute("orientStart",new THREE.InstancedBufferAttribute(new Float32Array(i),4)),r.setAttribute("orientEnd",new THREE.InstancedBufferAttribute(new Float32Array(o),4)),t.material.onBeforeCompile=function(e){e.uniforms.time={value:0},e.vertexShader=e.vertexShader.replace("#include <clipping_planes_pars_vertex>\n","#include <clipping_planes_pars_vertex>\nuniform float time;\nattribute vec4 orientStart;\nattribute vec4 orientEnd;\nvec3 animatePosition( vec3 position )\n{\nfloat sineTime = sin(time * 0.5);\nvec3 animated = instanceScale * position;\nanimated = instancePosition * max( abs( sineTime * 2.0 + 1.0 ), 0.5 ) + animated;\nvec4 orient = normalize( mix( orientStart, orientEnd, sineTime ) );\nvec3 vcV = cross( orient.xyz, animated );\nanimated = vcV * ( 2.0 * orient.w ) + ( cross( orient.xyz, vcV ) * 2.0 + animated );\nreturn animated;\n}\n"),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","vec3 position = animatePosition( position );\n#include <begin_vertex>"),this.shader=e},t.update=function(e,t){t*=.1,this.rotation.y=t,this.material.shader.uniforms.time.value=2*t},a.add(t)},a.demoInstancedFish=function(){a.loadOBJ({obj:"fish.obj",mtl:"fish.mtl",basePath:"models/obj/fish/",callback:function(e){a.add(e),a.underWaterBackground();if(void 0!==e){var t=e.children[0];a.translateGeometry(t.geometry,{x:2.585,y:0,z:0}),t.material.transparent=!0,t.material.fog=!0;var r=new a.InstancedMesh(t.geometry,t.material,5e3,!0,!1,!0);r.material.onBeforeCompile=function(e){e.uniforms.time={value:0},e.uniforms.fishSpeed={value:.5+.5*Math.random()},e.uniforms.fishLength={value:18},e.vertexShader="uniform float time;\nuniform float fishSpeed;\nuniform float fishLength;\n"+a.ShaderChunk.fishAnimation+"\n"+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","vec3 position = fishAnimation( position );\n#include <begin_vertex>"),e.fragmentShader=e.fragmentShader.replace("gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","gl_FragColor.rgb = mix( gl_FragColor.rgb*(1.0-fogFactor), fogColor, fogFactor );"),r.material.shader=e};for(var n,i=new THREE.Vector3,o=new THREE.Euler,s=new THREE.Quaternion,l=new THREE.Vector3,u=2*Math.PI,c=[],h=0;h<5e3;h++)i.set(500*(Math.random()-.5),500*(Math.random()-.5)-250,500*(Math.random()-.5)),o.set(0,Math.random()*u,0),s.setFromEuler(o),c.push(o.y),n=2+1.5*Math.random(),l.set(n,n,n),r.setPositionAt(h,i),r.setQuaternionAt(h,s),r.setScaleAt(h,l);r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,r.name="demoInstancedFish",a.add(r),r.update=function(e,t){this.material.shader&&(this.material.shader.uniforms.time.value=t);for(var r=10*e,n=new THREE.Vector3,i=0;i<this.numInstances;i++){this.getPositionAt(i,n);var a=c[i];n.x<-250?n.x=250:n.x>250?n.x=-250:n.x+=r*Math.sin(a),n.z<-250?n.z=250:n.z>250?n.z=-250:n.z+=r*Math.cos(a),this.setPositionAt(i,n)}this.needsUpdate("position")}}}})},a.demoViewportCamera=function(){var e=new THREE.Object3D;e.name="multiViews";var t=a.camera.position.length();e.views=[],e.views.push({left:.5,bottom:.5,width:.5,height:.5,eye:[t,t,t],up:[0,1,0],camera:null},{left:0,bottom:.5,width:.5,height:.5,eye:[0,t,0],up:[0,1,-1],camera:null},{left:0,bottom:0,width:.5,height:.5,eye:[0,0,t],up:[0,1,0],camera:null},{left:.5,bottom:0,width:.5,height:.5,eye:[t,0,0],up:[0,1,0],camera:null},{left:0,bottom:0,width:.01,height:.01,eye:[t,t,t],up:[0,1,0],camera:null});for(var r=0,n=e.views.length;r<n;r++){var i=e.views[r];i.camera=new THREE.PerspectiveCamera(a.camera.fov,window.innerWidth/window.innerHeight,a.camera.near,a.camera.far),i.camera.position.fromArray(i.eye),i.camera.up.fromArray(i.up)}e.update=function(t,r){var n=window.innerWidth,i=window.innerHeight,o=a.renderer,s=a.appWorks.mouseMovePosition;o.setClearColor(0),o.setScissorTest(!0);for(var l=0,u=e.views.length;l<u;l++){var c=e.views[l],h=Math.floor(n*c.left),d=Math.floor(i*c.bottom),f=Math.floor(n*c.width),p=Math.floor(i*c.height);o.setViewport(h,d,f,p),o.setScissor(h,d,f,p),c.camera.lookAt(a.scene.position),c.camera.aspect=f/p,c.camera.updateProjectionMatrix(),o.render(a.scene,c.camera)}var m=s.x>0?s.y>0?0:3:s.y>0?1:2,g=a.appWorks.controls;g.object=e.views[m].camera,g.update()},a.add(e)},a.demoViewportScene=function(){a.appWorks.composer=null,a.appWorks.renderer.setClearColor(14540253),a.appWorks.renderer.setScissorTest(!0);var e=a.appWorks.width,t=a.appWorks.height,r=new THREE.Object3D;r.name="viewportScene";var n=[new THREE.BoxBufferGeometry(1,1,1),new THREE.SphereBufferGeometry(.5,12,8),new THREE.DodecahedronBufferGeometry(.5),new THREE.CylinderBufferGeometry(.5,.5,1,12)],i=new fe.Div;i.setPosition("absolute"),i.setTop("0px"),i.setWidth(e+"px"),i.setHeight(t+"px"),i.setOverflow("auto"),i.setZIndex("0"),a.appWorks.dom.appendChild(i.dom);var o=(new fe.Panel).setColor("#000080").setTextAlign("center").setFontSize("20px");o.dom.style.fontFamily="Arial, Helvetica, sans-serif",o.dom.style.fontVariant="small-caps",i.add(o);var s=new fe.Row;s.setMargin("0.5em 0 0 0"),s.setTextShadow("1px 1px 2px #888"),s.add(new fe.Text("2019 NovaGraphix, Co. All rights reserved.")),o.add(s);var l=new fe.Row,u=document.createElement("a");u.setAttribute("href","https://www.nova-graphix.com/"),u.innerHTML="https://www.nova-graphix.com/",l.dom.appendChild(u),o.add(l);for(var c='        <div class="scene" style="width: 200px; height: 200px;"></div>\n        <div class="description" style="color: #111; font-family: \'Karla\', sans-serif; font-size: 1.2em; width: 200px; margin-top: 0.5em;">\n            Scene $\n        </div>\n    ',h=0;h<40;h++){var d=new THREE.Scene,f=(new fe.Div).setClass("scene-item");f.dom.style.cssText="display: inline-block; margin: 0.5em; padding: 0.5em; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",f.dom.innerHTML=c.replace("$",h),i.add(f);var p=f.dom.querySelector(".scene");d.userData.element=p;var m=p.getBoundingClientRect(),g=m.width/m.height,v=new THREE.PerspectiveCamera(50,g,.1,50);v.position.z=2,d.userData.camera=v;var y=new THREE.OrbitControls(v,p);y.minDistance=1,y.maxDistance=7.5,y.enablePan=!0,y.enableZoom=!0,y.enableDamping=!0,y.screenSpacePanning=!0,y.dampingFactor=.1,y.panSpeed=.1,y.rotateSpeed=.07,y.enabled=!0,d.userData.controls=y;var _=n[n.length*Math.random()|0],b=new THREE.MeshStandardMaterial({color:(new THREE.Color).setHSL(Math.random(),1,.5),roughness:.5,metalness:0,flatShading:!0}),E=new THREE.Mesh(_,b);E.update=function(e,t){this.rotation.y=t},d.add(E),d.add(new THREE.HemisphereLight(11184810,4473924));var w=new THREE.DirectionalLight(16777215,.5);w.position.set(1,1,1),d.add(w),r.add(d)}a.add(r),r.update=function(e,t){var n=a.renderer;n.domElement.style.transform=`translateY(${window.scrollY}px)`,r.children.forEach((function(r){r.traverse(r=>{r.update&&r.update(e,t)});var i=r.userData.element.getBoundingClientRect();if(!(i.bottom<0||i.top>n.domElement.clientHeight||i.right<0||i.left>n.domElement.clientWidth)){var a=i.width,o=i.height,s=i.left,l=n.domElement.clientHeight-i.bottom;n.setViewport(s,l,a,o),n.setScissor(s,l,a,o);var u=r.userData.camera;n.render(r,u)}}))}},a.demoVideoTexture=function(){var e=document.createElement("video");e.width=window.innerWidth,e.height=window.innerHeight,e.loop=!0,e.muted=!0,e.src="video/EllyUSOpen2017.mp4",e.play();var t,r=new THREE.PlaneBufferGeometry(178,100);(t=new THREE.VideoTexture(e)).minFilter=THREE.LinearFilter,t.format=THREE.RGBFormat;var n,i=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide});(n=new THREE.Mesh(r,i)).name="demoVideoTexture",a.add(n)},a.demoTerrains=function(){var e=a.createSunLight(.49);e.userData.motion="variable",a.add(e),a.add(a.createSky());var t=a.createTerrain({resolution:256,height:100,landscape:5,waterDepth:20,waterColor:a.OCEAN_COLOR});a.add(t);var r=a.createWater({alpha:.9});a.add(r),a.add(a.createCloudDome(1024)),a.camera.position.set(0,5,100),a.camera.lookAt(a.scene.position)},a.demoMinecraft=function(){var e=a.appWorks.scene;if(0===a.scene.getObjectsByType("HemisphereLight").length&&a.add(a.createHemisphereLight()),0===a.scene.getObjectsByType("DirectionalLight").length){var t=a.createDirectionalLight({color:16777215,intensity:2});t.position.set(1,1,.5),a.add(t)}e.fog&&(e.fog.density=4e-4);var r=new THREE.TextureLoader,n=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/grass.png")}),i=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/grass_dirt.png")}),o=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/dirt.png")}),s=new THREE.PlaneBufferGeometry(1,1).rotateY(Math.PI/2).translate(.5,0,0),l=new THREE.PlaneBufferGeometry(1,1).rotateY(-Math.PI/2).translate(-.5,0,0),u=new THREE.PlaneBufferGeometry(1,1).rotateX(-Math.PI/2).translate(0,.5,0),c=new THREE.PlaneBufferGeometry(1,1).rotateX(Math.PI/2).translate(0,-.5,0),h=new THREE.PlaneBufferGeometry(1,1).translate(0,0,.5),d=new THREE.PlaneBufferGeometry(1,1).rotateY(Math.PI).translate(0,0,-.5),f=new THREE.Object3D;f.add(new THREE.Mesh(s,i)),f.add(new THREE.Mesh(l,i)),f.add(new THREE.Mesh(h,i)),f.add(new THREE.Mesh(d,i)),f.add(new THREE.Mesh(u,n)),f.add(new THREE.Mesh(c,o));var p=512,m=512;a.isDeviceMobile()&&(p=m=256);var g=function(e,t){for(var r=function(e,t){var r,n,i=2,a=100*Math.random(),o=e*t,s=new THREE.ImprovedNoise,l=[];l.zero(o);for(var u=0;u<4;u++){for(var c=0;c<o;c++)r=c%e,n=c/e|0,l[c]+=s.noise(r/i,n/i,a)*i;i*=4}return l}(e=Math.floor(e),t=Math.floor(t)),n=e/2,i=t/2,a=[],o=0;o<t;o++)for(var s=0;s<e;s++){var l=.2*r[s+o*e]|0;a.push(s-n,l,o-i)}return a}(p,m),v=a.createInstancedObject(f,{positions:g});v.name="demoMinecraft",a.add(v),void 0===e.getObjectsByProperty("userData","type","Water")[0]&&a.add(a.createWater());var y=a.createGlowingParticles({amount:1e3,width:p,height:p/4,depth:m,motion:"random"});y.position.y+=p/8,a.add(y),a.appWorks.createSceneBackground("cloud")},a.demoSponzaAnimals=function(){var e=new THREE.LoadingManager;e.onStart=()=>{a.createProgressbar()},e.onProgress=(e,t,r)=>{a.updateProgressbar(t,r)},e.onLoad=()=>{a.hideProgressbar()},e.onError=e=>{a.errorProgressbar("There was an error loading "+e)},a.loadOBJ({obj:"sponza.obj",mtl:"sponza.mtl",basePath:"models/obj/sponza/",manager:e,callback:function(e){a.add(e)}});var t=new THREE.Vector3(0,.5*-Math.PI,0),r=new THREE.Vector3;a.loadJSON({url:"models/json/cow.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(-240,0,0)),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/elk.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(-180,0,0)),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/flamingo.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(-120,40,0)),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/fox.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(-60,0,0)),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/horse.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(0,0,0)),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/monster.js",basePath:"models/json/",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(60,0,-30),t),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/parrot.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(120,40,0)),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/sittingBox.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(180,0,0)),a.add(e),a.appWorks.playAction(e)}}),a.loadJSON({url:"models/json/stork.js",manager:e,callback:function(e){a.resizeObject(e,100),a.transformObject(e,r.set(240,40,0)),a.add(e),a.appWorks.playAction(e)}})},a.demoForest=function(){function e(e,t){t=t||32;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}if(a.isDeviceMobile()){var t=50,r=50;(d=new THREE.PlaneBufferGeometry(t,r)).setAttribute("uv2",new THREE.BufferAttribute(d.attributes.uv.array,2));var n=new THREE.TextureLoader,i=new THREE.MeshStandardMaterial({color:8947848,roughness:1,metalness:0,map:n.load("images/terrain/dirtGrassTerrainD6.jpg",e),bumpMap:n.load("images/terrain/dirtGrassTerrainB.jpg",e),aoMap:n.load("images/terrain/dirtGrassTerrainAO.jpg",e)});(f=new THREE.Mesh(d,i)).name="ground",f.rotation.x=-Math.PI/2,a.add(f);var o=2,s=a.createGrassTufts(1e3,t,o,r,1188864,"images/grass/grass01.png");a.add(s);s=a.createGrassTufts(1e3,t,o,r,735232,"images/grass/grass02.png");a.add(s);o=2;var l=a.createFlowerTufts(100,t,o,r,null,"images/grass/flowers01.png");a.add(l);l=a.createFlowerTufts(100,t,o,r,null,"images/grass/flowers02.png");a.add(l);o=1.5;var u=a.createGrassQuads(100,t,o,r);a.add(u);var c=5401389,h=a.createProcTrees(t,r,10,"small",c);a.add(h);h=a.createProcTrees(t,r,25,"middleDense",c);a.add(h);c=9498256,h=a.createProcTrees(t,r,25,"middle",c);a.add(h);h=a.createProcTrees(t,r,10,"large",c);a.add(h),a.add(a.createAmbientLight()),a.add(a.createSunLight()),a.add(a.createSky()),a.appWorks.godRaysPass.enabled=!0,a.appWorks.createSceneFog({type:"exp2",color:a.FOG_COLOR,density:.01}),a.camera.lookAt(a.scene.position)}else{var d;t=250,r=250;(d=new THREE.PlaneBufferGeometry(t,r)).setAttribute("uv2",new THREE.BufferAttribute(d.attributes.uv.array,2));var f;n=new THREE.TextureLoader,i=new THREE.MeshStandardMaterial({color:8947848,roughness:1,metalness:0,map:n.load("images/terrain/dirtGrassTerrainD6.jpg",e),bumpMap:n.load("images/terrain/dirtGrassTerrainB.jpg",e),aoMap:n.load("images/terrain/dirtGrassTerrainAO.jpg",e)});(f=new THREE.Mesh(d,i)).name="ground",f.rotation.x=-Math.PI/2,a.add(f);o=2,s=a.createGrassTufts(1e4,t,o,r,1188864,"images/grass/grass01.png");a.add(s);s=a.createGrassTufts(1e4,t,o,r,735232,"images/grass/grass02.png");a.add(s);o=2,l=a.createFlowerTufts(1e3,t,o,r,null,"images/grass/flowers01.png");a.add(l);l=a.createFlowerTufts(1e3,t,o,r,null,"images/grass/flowers02.png");a.add(l);o=1.5,u=a.createGrassQuads(1e3,t,o,r);a.add(u);c=5401389,h=a.createProcTrees(t,r,100,"small",c);a.add(h);h=a.createProcTrees(t,r,250,"middleDense",c);a.add(h);c=9498256,h=a.createProcTrees(t,r,250,"middle",c);a.add(h);h=a.createProcTrees(t,r,100,"large",c);a.add(h),a.add(a.createAmbientLight()),a.add(a.createSunLight()),a.add(a.createSky()),a.appWorks.godRaysPass.enabled=!0,a.appWorks.createSceneFog({type:"exp2",color:a.FOG_COLOR,density:.003}),a.camera.lookAt(a.scene.position)}},a.demoLoadFiles=function(){a.loadGLTF({url:"models/gltf/AdamHead/adamHead.gltf",callback:function(e){a.add(e)}})},a.demoEarthSystem=function(){var e=a.appWorks.scene,t={earth:{radius:.18,orbitRadius:4.5,orbitPeriod:365,rotPeriod:1,inclination:0},moon:{radius:.04,orbitRadius:.75,orbitPeriod:30,rotPeriod:30,inclination:0}};e.earthData=t;var r=new THREE.TextureLoader,n=new THREE.SphereBufferGeometry(1,32,32),i=new THREE.Object3D;i.name="demoEarthPivot",a.add(i),i.scale.setScalar(100),a.add(a.createHemisphereLight({skyColor:(new THREE.Color).setHSL(.6,1,.6),groundColor:(new THREE.Color).setHSL(.095,1,.75),intensity:1}));var o=new THREE.MeshPhongMaterial({map:r.load("images/planets/earth_texture.jpg"),bumpScale:.5,bumpMap:r.load("images/planets/earthbump.jpg"),specular:new THREE.Color("grey"),specularMap:r.load("images/planets/earthspec.jpg")}),s=new THREE.Mesh(n,o);s.scale.setScalar(t.earth.radius),s.name="demoEarth",i.add(s),i.position.copy(s.position);o=new THREE.MeshPhongMaterial({map:r.load("images/planets/earthcloudmap.jpg"),alphaMap:r.load("images/planets/earthcloudmaptrans.jpg"),opacity:.8,transparent:!0,depthWrite:!1});var l=new THREE.Mesh(n,o);l.scale.setScalar(1.02),l.name="demoEarthCloud",s.add(l);var u=new THREE.Object3D;u.position.copy(s.position),u.rotation.x=t.moon.inclination*THREE.Math.DEG2RAD,i.add(u);o=new THREE.MeshPhongMaterial({map:r.load("images/planets/moonmap.jpg"),bumpMap:r.load("images/planets/moonbump.jpg"),bumpScale:.02});var c=new THREE.Mesh(n,o);c.scale.setScalar(t.moon.radius),c.position.x=t.moon.orbitRadius,c.name="demoMoon",u.add(c);var h=new THREE.EllipseCurve(0,0,t.moon.orbitRadius/t.earth.radius,t.moon.orbitRadius/t.earth.radius).getPoints(70),d=(n=(new THREE.BufferGeometry).setFromPoints(h),o=new THREE.LineBasicMaterial({color:2236962}),new THREE.Line(n,o));d.rotation.x=-Math.PI/2,d.rotation.x+=t.moon.inclination*THREE.Math.DEG2RAD,s.add(d),i.update=function(t,r){var n=.2*r*(2*Math.PI),i=e.earthData,a=i.earth.orbitPeriod,o=n/i.earth.rotPeriod;this.children[0].rotation.y=o,this.children[0].children[0].rotation.y=-o/2;a=n/i.moon.orbitPeriod,o=n/i.moon.rotPeriod;this.children[1].rotation.y=a,this.children[1].children[0].rotation.y=o},a.appWorks.createSceneBackground("galaxy")},a.demoSolarSystem=function(){var e=a.appWorks.scene,t={sun:{radius:1,orbitRadius:0,orbitPeriod:0,rotPeriod:0,inclination:0},mercury:{radius:.1,orbitRadius:2.25,orbitPeriod:88,rotPeriod:59,inclination:7},venus:{radius:.18,orbitRadius:3,orbitPeriod:225,rotPeriod:-243,inclination:3.9},earth:{radius:.18,orbitRadius:4.5,orbitPeriod:365,rotPeriod:1,inclination:0},moon:{radius:.04,orbitRadius:.75,orbitPeriod:30,rotPeriod:30,inclination:0},mars:{radius:.3,orbitRadius:5.25,orbitPeriod:697,rotPeriod:1.017,inclination:1.85},jupiter:{radius:.6,orbitRadius:7.5,orbitPeriod:4234,rotPeriod:.417,inclination:1.3},saturn:{radius:.5,orbitRadius:10.5,orbitPeriod:10753,rotPeriod:.433,inclination:2.49},uranus:{radius:.3,orbitRadius:12.75,orbitPeriod:30660,rotPeriod:.708,inclination:.77},neptune:{radius:.3,orbitRadius:13.5,orbitPeriod:60225,rotPeriod:.833,inclination:1.77},pluto:{radius:.05,orbitRadius:15,orbitPeriod:90520,rotPeriod:6.4,inclination:17.2}};e.solarData=t;for(var r=["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune","pluto"],n=0;n<r.length;n++)t[r[n]].rotPeriod*=40;var i=new THREE.TextureLoader,o=new THREE.SphereBufferGeometry(1,32,32),s=new THREE.MeshBasicMaterial({map:i.load("images/planets/sunmap.jpg"),transparent:!0,depthWrite:!1}),l=new THREE.Mesh(o,s);l.scale.setScalar(t.sun.radius),l.position.x=t.sun.orbitRadius,l.name="demoSun",a.add(l),l.scale.setScalar(20);var u=a.createPointLightFlare({color:15915482,intensity:2,flareSize:2500});u.position.copy(l.position),a.add(u);var c=a.appWorks.camera,h=c.position.length();u.update=function(e,t){var r=c.position.length(),n=u.children[0].children[0],i=h/r;n.flareSize=2500*i,n.flareRotation+=.005,n.flareOpacity=Math.min(.5+i,1)},(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.mercury.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/mercurymap.jpg"),bumpMap:i.load("images/planets/mercurybump.jpg"),bumpScale:.5});var d=new THREE.Mesh(o,s);d.scale.setScalar(t.mercury.radius),d.position.x=t.mercury.orbitRadius,d.name="demoMercury",M.add(d),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.venus.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/venusmap.jpg"),bumpMap:i.load("images/planets/venusbump.jpg"),bumpScale:.5});var f=new THREE.Mesh(o,s);f.scale.setScalar(t.venus.radius),f.position.x=t.venus.orbitRadius,f.name="demoVenus",M.add(f),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.earth.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/earthmap.jpg"),bumpScale:.5,bumpMap:i.load("images/planets/earthbump.jpg"),specular:new THREE.Color("grey"),specularMap:i.load("images/planets/earthspec.jpg")});var p=new THREE.Mesh(o,s);p.scale.setScalar(t.earth.radius),p.position.x=t.earth.orbitRadius,p.name="demoEarth",M.add(p);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/earthcloudmap.jpg"),alphaMap:i.load("images/planets/earthcloudmaptrans.jpg"),opacity:.8,transparent:!0,depthWrite:!1});var m=new THREE.Mesh(o,s);m.scale.setScalar(1.02),m.position.x=0,m.name="demoEarthCloud",p.add(m);var g=new THREE.Object3D;g.position.copy(p.position),g.rotation.x=t.moon.inclination*THREE.Math.DEG2RAD,M.add(g);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/moonmap.jpg"),bumpMap:i.load("images/planets/moonbump.jpg"),bumpScale:.5});var v=new THREE.Mesh(o,s);v.scale.setScalar(t.moon.radius),v.position.x=t.moon.orbitRadius,v.name="demoMoon",g.add(v),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.mars.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/marsmap.jpg"),bumpMap:i.load("images/planets/marsbump.jpg"),bumpScale:.5});var y=new THREE.Mesh(o,s);y.scale.setScalar(t.mars.radius),y.position.x=t.mars.orbitRadius,y.name="demoMars",M.add(y),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.jupiter.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/jupitermap.jpg")});var _=new THREE.Mesh(o,s);_.scale.setScalar(t.jupiter.radius),_.position.x=t.jupiter.orbitRadius,_.name="demoJupiter",M.add(_),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.saturn.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/saturnmap.jpg")});var b=new THREE.Mesh(o,s);b.scale.setScalar(t.saturn.radius),b.position.x=t.saturn.orbitRadius,b.name="demoSaturn",M.add(b);var E=new a.RingGeometry(1.2,2,64,5),w=(s=new THREE.MeshBasicMaterial({map:i.load("images/planets/saturnringmap.jpg"),side:THREE.DoubleSide,transparent:!0,opacity:.8}),new THREE.Mesh(E,s));w.position.x=0,w.name="demoSaturnRing",b.add(w),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.uranus.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/uranusmap.jpg")});var x=new THREE.Mesh(o,s);x.scale.setScalar(t.uranus.radius),x.position.x=t.uranus.orbitRadius,x.name="demoUranus",M.add(x);E=new a.RingGeometry(1.1,1.5,64,5),s=new THREE.MeshBasicMaterial({map:i.load("images/planets/uranusringmap.jpg"),side:THREE.DoubleSide,transparent:!0,opacity:.6});var T=new THREE.Mesh(E,s);T.position.x=0,T.name="demoUranusRing",x.add(T),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.neptune.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/neptunemap.jpg")});var M,S=new THREE.Mesh(o,s);S.scale.setScalar(t.neptune.radius),S.position.x=t.neptune.orbitRadius,S.name="demoNeptune",M.add(S),(M=new THREE.Object3D).position.copy(l.position),M.rotation.x=t.pluto.inclination*THREE.Math.DEG2RAD,l.add(M);s=new THREE.MeshPhongMaterial({map:i.load("images/planets/plutomap.jpg"),bumpMap:i.load("images/planets/plutobump.jpg"),bumpScale:.5});var A=new THREE.Mesh(o,s);A.scale.setScalar(t.pluto.radius),A.position.x=t.pluto.orbitRadius,A.name="demoPluto",M.add(A);for(n=0;n<r.length;n++){var R=new THREE.EllipseCurve(0,0,t[r[n]].orbitRadius,t[r[n]].orbitRadius).getPoints(50+20*n);o=(new THREE.BufferGeometry).setFromPoints(R),s=new THREE.LineBasicMaterial({color:1118481});(k=new THREE.Line(o,s)).rotation.x=-Math.PI/2,k.rotation.x+=t[r[n]].inclination*THREE.Math.DEG2RAD,l.add(k)}var k,P,L,C;R=new THREE.EllipseCurve(0,0,t.moon.orbitRadius/t.earth.radius,t.moon.orbitRadius/t.earth.radius).getPoints(50),o=(new THREE.BufferGeometry).setFromPoints(R),s=new THREE.LineBasicMaterial({color:2236962});(k=new THREE.Line(o,s)).rotation.x=-Math.PI/2,k.rotation.x+=t.moon.inclination*THREE.Math.DEG2RAD,p.add(k),l.update=function(t,r){for(var n=20*r*(2*Math.PI),i=e.solarData,a=["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune","pluto"],o=0;o<a.length;o++)if(2===o){var s=n/i.earth.orbitPeriod,l=n/i.earth.rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l,this.children[o].children[0].children[0].rotation.y=-l/2;s=n/i.moon.orbitPeriod,l=n/i.moon.rotPeriod;this.children[o].children[1].rotation.y=s,this.children[o].children[1].children[0].rotation.y=l}else if(5===o||6===o){s=n/i[a[o]].orbitPeriod,l=n/i[a[o]].rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l,this.children[o].children[0].children[0].rotation.y=l}else{s=n/i[a[o]].orbitPeriod,l=n/i[a[o]].rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l}},a.appWorks.createSceneBackground("galaxy"),a.isDeviceMobile()||(P=a.appWorks.cameraHUD,L=0,C=2*a.appWorks.cameraHUD.top-100,l.traverse(e=>{function r(e){return-1!==e.name.indexOf("Ring")}if(e.isMesh){if((e=e.clone()).parent=null,e.children=[],e.name=e.name.substr(4),e.position.x=P.left+50+L,e.position.y=P.bottom+50+C,e.position.z=0,r(e)&&(e.rotation.x+=Math.PI/2),e.scale.setScalar(1),a.resizeObject(e,100),"Sun"!==e.name&&!r(e)){var n=40*Math.PI,i="EarthCloud"===e.name?t.earth:t[e.name.toLowerCase()];e.update=function(t,r){e.rotation.y=r*n/i.rotPeriod}}a.appWorks.sceneHUD.add(e);var o=20;(r(e)||function(e){return-1!==e.name.indexOf("Cloud")}(e))&&(o=0);var s=a.createTextHUD(e.name,L+o,C-20);s.scale.setScalar(.8),a.appWorks.sceneHUD.add(s),L+=100}}),a.appWorks.sceneHUD.add(a.createHemisphereLight()))},a.demoUnderWater=function(){a.add(a.createHemisphereLight()),a.underWaterBackground();var e=Math.PI/2,t={sharks:{height:20,heightRange:2,radius:48,radiusRange:4,count:5,speed:.05,object:null,createFish:a.createFishShark},hammerSharks:{height:20,heightRange:2,radius:36,radiusRange:4,count:6,speed:.07,object:null,createFish:a.createFishHammerShark},tunas:{height:15,heightRange:4,radius:30,radiusRange:8,count:50,speed:.1,object:null,createFish:a.createFishTuna},snappers:{height:15,heightRange:5,radius:42,radiusRange:6,count:100,speed:.2,object:null,createFish:a.createFishSnapper},mackerels:{height:30,heightRange:10,radius:48,radiusRange:8,count:200,speed:.2,object:null,createFish:a.createFishMackerel}},r=new THREE.Object3D;for(var n in a.add(r),t){var i=t[n];i.object=new THREE.Object3D,i.object.name="fishes";for(var o=0;o<i.count;o++){var s=i.createFish(),l=a.circularRand(i.radius),u=Math.atan(l.y/l.x);s.rotation.y+=l.x>0?u+e:u-e;var c=i.heightRange*(Math.random()-.5),h=i.radiusRange*(Math.random()-.5);s.position.x=l.y+h*Math.sin(u),s.position.y=i.height+c,s.position.z=l.x+h*Math.cos(u),i.object.add(s)}r.add(i.object)}r.update=function(e,t){r.traverse((function(r){"fishes"===r.name&&(r.children.forEach((function(e){e.position.y+=.05*Math.sin(o+t)})),r.rotation.y+=i.speed*e)}))};for(o=0;o<20;o++){s=a.createBrokenArchColumn(),l=a.circularRand(60),u=Math.atan(l.y/l.x);s.rotation.y+=u,s.position.set(l.y,0,l.x),r.add(s)}for(o=0;o<10;o++){s=a.createRuinColumn(),l=a.circularRand(60*(.5*Math.random()+.5)),u=Math.atan(l.y/l.x);s.rotation.y+=u,s.position.set(l.y,0,l.x),r.add(s)}for(var d=0;d<2;d++)for(o=0;o<30;o++){var f=15*(.5+.5*Math.random());s=a.createSeaweed(d,3,f),l=a.diskRand(60);s.position.set(l.y,f/2,l.x),r.add(s)}l=new THREE.Vector3;var p=new THREE.Euler,m=new THREE.Quaternion,g=new THREE.Vector3,v=new THREE.Color,y=2*Math.PI,_=a.createCoral(),b=new a.InstancedMesh(_.geometry,_.material,100,!1,!0,!1);for(o=0;o<100;o++)l.set(96*(Math.random()-.5),0,96*(Math.random()-.5)),p.set(0,Math.random()*y,0),m.setFromEuler(p),g.setScalar(.4+Math.random()),v.setHSL(Math.random(),1,.5),b.setPositionAt(o,l),b.setQuaternionAt(o,m),b.setScaleAt(o,g),b.setColorAt(o,v);b.castShadow=!0,b.receiveShadow=!0,b.frustumCulled=!1,b.name="instCoral",r.add(b);for(d=0;d<2;d++){_=a.createCoralReef(d),b=new a.InstancedMesh(_.geometry,_.material,100,!1,!0,!1);for(o=0;o<100;o++)l.set(96*(Math.random()-.5),0,96*(Math.random()-.5)),p.set(0,Math.random()*y,0),m.setFromEuler(p),g.setScalar(1.5+Math.random()),v.setHSL(Math.random(),Math.random(),Math.random()),b.setPositionAt(o,l),b.setQuaternionAt(o,m),b.setScaleAt(o,g),b.setColorAt(o,v);b.castShadow=!0,b.receiveShadow=!0,b.frustumCulled=!1,b.name="instCoralReef"+d,r.add(b)}(s=a.createRock(0)).position.set(-10,0,-10),r.add(s),(s=a.createRock(1)).position.set(30,0,30),r.add(s),(s=a.createRock(2)).position.set(-20,0,20),r.add(s);s=a.createAquaFloor(64.5);r.add(s);(s=a.createAquaGlobeBase(64.5,25)).position.y-=12.5,r.add(s),(s=a.createAquaGlobeOuter(66.9)).position.y+=16.5,r.add(s);h=.36;var E,w=100;c=60;(E=a.createSpriteBubbles(h,w,3,c,3,"verticalMotion")).position.set(12,0,-18),r.add(E),(E=a.createSpriteBubbles(h,w,3,c,3,"verticalMotion")).position.set(-18,0,-18),r.add(E),(E=a.createSpriteBubbles(h,w,3,c,3,"verticalMotion")).position.set(-12,0,12),r.add(E),(E=a.createSpriteBubbles(h,w,3,c,3,"verticalMotion")).position.set(6,0,18),r.add(E)},a.demoFishSchools=function(){a.add(a.createHemisphereLight()),a.underWaterBackground();var e=appWorks.camera.far,t=a.createBoids({resolution:64,boidName:"fishShark",bounds:new THREE.Vector3(e/4,e/8,e/4),speedLimit:2});t.position.y=0,a.add(t)},a.demoRaymarch=function(){a.raymarchFish()},a.demoKdTree=function(){var e=a.appWorks;e.controls=a.createCameraControls("FirstPersonControls");var t=Math.pow(500,2);t=Math.sqrt(3*t);var r=(new THREE.TextureLoader).load("images/crate.gif");r.minFilter=THREE.LinearMipMapLinearFilter,r.magFilter=THREE.LinearFilter;var n=new THREE.ShaderMaterial({uniforms:{tex:{type:"t",value:r},size:{type:"f",value:4}},vertexShader:["uniform float size;","attribute float alpha;","varying float vAlpha;","void main() {","vAlpha = alpha;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = size * ( 300.0 / -mvPosition.z );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["tex;","varying float vAlpha;","void main() {","gl_FragColor = texture2D( tex, gl_PointCoord );","gl_FragColor.b = mix( gl_FragColor.b, 1.0, vAlpha );","}"].join("\n"),transparent:!0}),i=new Float32Array(15e5),o=new Float32Array(5e5),s=new THREE.BufferGeometry;s.setAttribute("position",new THREE.BufferAttribute(i,3)),s.setAttribute("alpha",new THREE.BufferAttribute(o,1));for(var l=0;l<5e5;l++)i[3*l+0]=500*(Math.random()-.5),i[3*l+1]=500*(Math.random()-.5),i[3*l+2]=500*(Math.random()-.5),o[l]=0;var u=new THREE.Points(s,n);a.add(u);var c=performance.now();u.kdtree=a.createKdTree(i,3);var h=performance.now()-c;console.log(">> time (creating kdtree) = "+h.toFixed(2)+" (ms)"),u.update=function(r,n){for(var i=0;i<5e5;i++)o[i]=0;var l=e.camera.position,u=a.getKdTreeNearest(this.kdtree,[l.x,l.y,l.z],100),c=new THREE.Frustum,h=new THREE.Matrix4;h.multiplyMatrices(e.camera.projectionMatrix,e.camera.matrixWorldInverse),c.setFromMatrix(h);for(var d=0,f=u.length;d<f;d++){var p=u[d],m=(new THREE.Vector3).fromArray(p.position);if(c.containsPoint(m)){var g=p.index,v=p.distance;o[g]=1-v/t}}s.attributes.alpha.needsUpdate=!0}},a.demoOctree=function(){var e=new THREE.Points(new THREE.TorusKnotBufferGeometry(10,4,64,64),new THREE.PointsMaterial({color:16711680,size:2,sizeAttenuation:!1}));a.add(e);var t=new THREE.Box3;t.setFromObject(e);for(var r=new E.PointOctree(t.min,t.max,0,15,8),n=e.geometry.attributes.position.array,i=new THREE.Vector3,o=0,s=n.length;o<s;o+=3)r.insert(i.fromArray(n,o),e);console.log(">> octree point count: ",r.pointCount),console.log(">> octree depth: ",r.getDepth());var l=new THREE.Vector3;a.getLeafOctants(r).forEach((function(e){e.getCenter(l),console.log(l)}));var u=new a.OctreeHelper(r,{topLevel:0,bottomLevel:4,color:16777215});a.add(u)},a.demoIsosurface=function(){var e=new THREE.MeshPhongMaterial({color:11184810,side:THREE.DoubleSide}),t=(new THREE.ImprovedNoise,function(e,t,r){var n=e*e+t*t+r*r;return Math.pow(e,4)+Math.pow(t,4)+Math.pow(r,4)+n*n*0+-1.5*n+1}),r=[[-2.4,-2.4,-2.4],[2.4,2.4,2.4]],n=performance.now(),i=new a.IsosurfaceGeometry(50,r,t),o=performance.now()-n;console.log(">> time (creating isosurface) = "+o.toFixed(2)+" (ms)");var s=new THREE.Mesh(i,e);a.add(s);var l=a.createWireframe(s,0,!0);s.add(l);var u=a.createVertexPoints(s,.05);s.add(u)},a.demoEditImage=function(){a.imgload2pixels("images/dummy/dip/harris_church.png",e=>{var t=performance.now(),r=new a.Sift,n=r.extractFeatures(e);n.forEach(e=>{console.log(e)});var i=r.draw_features(n,e),o=a.canvas2tex(i);console.log("time = "+(performance.now()-t).toFixed(1)+" ms");var s=e.width,l=e.height,u=new THREE.PlaneBufferGeometry(s/l*30,30),c=new THREE.MeshBasicMaterial({map:o}),h=new THREE.Mesh(u,c);a.add(h)})},a.demoFrankeTestRBF=function(){function e(e,t,r,n){var i=0;if(1===e)a=Math.pow(9*t-2,2),o=Math.pow(9*r-2,2),s=Math.pow(9*n-2,2),i=.75*Math.exp(-(a+o+s)/4),a=Math.pow(9*t+1,2),o=Math.pow(9*r+1,1),s=Math.pow(9*n+1,1),i+=.75*Math.exp(-(a/49+o/10+s/10)),a=Math.pow(9*t-7,2),o=Math.pow(9*r-3,2),s=Math.pow(9*n-5,2),i+=.5*Math.exp(-(a+o+s)/4),a=Math.pow(9*t-4,2),o=Math.pow(9*r-7,2),s=Math.pow(9*n-5,2),i-=.2*Math.exp(-(a+o+s));else if(2===e)i=(Math.tanh(9*n-9*t-9*r)+1)/9;else if(3===e)i=(1.25+Math.cos(5.4*r))*Math.cos(6*n)/(6+6*Math.pow(3*t-1,2));else if(4===e){a=Math.pow(t-.5,2),o=Math.pow(r-.5,2),s=Math.pow(n-.5,2),i=Math.exp(-81/16*(a+o+s))/3}else if(6===e){var a,o,s;a=Math.pow(t-.5,2),o=Math.pow(r-.5,2),s=Math.pow(n-.5,2),i=Math.sqrt(64-81*(a+o+s))/9-.5}return i}for(var t=[1,2,3,4,6],r=["grid","random"],n=["interpolate","approximate"],i=[7,10,15],o=[343,1e3,3375],s=["linear","cubic","thinPlate","gaussian","multiquadric","wendland31"],l=0;l<r.length;l++)for(var u=0;u<n.length;u++)for(var c=0;c<o.length;c++)for(var h=0;h<s.length;h++){var d,f={funcID:t[4],distributeType:r[l],constructType:n[u],ndataGrid:i[c],ndataRandom:o[c],rbf:s[h],linearTerm:!0,approxPct:.2,rbf0:"linear",rbf1:"linear",rbf2:"linear"};console.log("==========================================="),console.log(">> funcID          = "+f.funcID),console.log(">> distribute type = "+f.distributeType),console.log(">> construct type  = "+f.constructType),console.log(">> data size       = "+f.ndataRandom),console.log(">> RBF             = "+f.rbf),"grid"===f.distributeType&&(d=~~(Math.pow(f.ndataGrid,3)*f.approxPct)),"random"===f.distributeType&&(d=~~(f.ndataRandom*f.approxPct));var p=[],m=[];if("grid"===f.distributeType)for(var g=1/((A=f.ndataGrid)-1),v=0,y=0;v<A;v++,y+=g)for(var _=0,b=0;_<A;_++,b+=g)for(var E=0,w=0;E<A;E++,w+=g)p.push([w,b,y]),m.push(e(f.funcID,w,b,y));if("random"===f.distributeType){for(E=0;E<f.ndataRandom;E++){w=Math.random(),b=Math.random(),y=Math.random();p[E]=[w,b,y]}E=0;for(var x=(p=a.mergeArray3(p)).length;E<x;E++){w=p[E][0],b=p[E][1],y=p[E][2];m[E]=e(f.funcID,w,b,y)}}var T,M=performance.now();switch(f.constructType){case"interpolate":T=a.interpolateRBF(p,m,{rbf:f.rbf});break;case"approximate":T=a.approximateRBF(d,p,m,{rbf:f.rbf});break;case"multilevel":T=a.multiLevelRBF(p,m,{rbf0:f.rbf0,rbf1:f.rbf1,rbf2:f.rbf2})}var S=performance.now()-M;console.log(">> time (creating RBF)   = "+S.toFixed(2)+" (ms)");var A,R=0,k=0,P=0,L=1/0,C=-1/0;for(g=1/((A=21)-1),v=0,y=0;v<A;v++,y+=g)for(_=0,b=0;_<A;_++,b+=g)for(E=0,w=0;E<A;E++,w+=g){M=performance.now();var I=T([w,b,y]);P+=S=performance.now()-M;var H=e(f.funcID,w,b,y);R+=Math.pow(H-I[0],2),L=Math.min(L,H),C=Math.max(C,H),k++}R=Math.sqrt(R/k),R/=C-L,console.log(">> time (evaluating RBF) = "+(P/k).toFixed(4)+" (ms)"),console.log(">> RMS error (21 x 21 x 21) = "+R.toFixed(7))}},a.demoImageRBF=function(){(new THREE.TextureLoader).load("images/dummy/lena_24.bmp",(function(e){var t=a.img2pixels(e.image),r=e.image.width,n=e.image.height,i=r*n;console.log(">> image = "+i);var o,s=!0,l="linear",u="random",c="interpolate",h=32,d=2e3,f=.2,p="linear",m="linear",g="linear";console.log(">> RBF = "+l+", linearTerm = "+s),console.log(">> data distribution = "+u),console.log(">> construction type = "+c),"multilevel"===c&&console.log(">> multilevel[0,1,2] = "+p+", "+m+", "+g),"grid"===u&&(o=~~(Math.pow(h,2)*f)),"random"===u&&(o=~~(d*f));var v=[],y=[];if("grid"===u)for(var _=h,b=1/(_-1),E=0,w=0;E<_;E++,w+=b)for(var x=0,T=0;x<_;x++,T+=b){v.push([T,w]);var M=a.dipPixelColor(t,T,w);y.push([M.r,M.g,M.b])}if("random"===u){for(x=0;x<d;x++){T=a.randInt(0,r-1),w=a.randInt(0,n-1);v[x]=[T,w]}x=0;for(var S=(v=a.mergeArray2(v)).length;x<S;x++){T=v[x][0],w=v[x][1],M=a.dipPixelColor(t,T,w);y[x]=[M.r,M.g,M.b]}}"interpolate"===c&&(console.log(">> xdata   = "+v.length),console.log(">> xdata/image = "+(v.length/i*100).toFixed(2)+" (%)")),"approximate"===c&&(console.log(">> centers = "+o),console.log(">> xdata   = "+v.length),console.log(">> centers/xdata = "+(o/v.length*100).toFixed(2)+" (%)"),console.log(">> centers/image = "+(o/i*100).toFixed(2)+" (%)"));var A,R=performance.now();switch(c){case"interpolate":A=a.interpolateRBF(v,y,{rbf:l,linearTerm:s});break;case"approximate":A=a.approximateRBF(o,v,y,{rbf:l,linearTerm:s});break;case"multilevel":A=a.multiLevelRBF(v,y,{rbf0:p,rbf1:m,rbf2:g,linearTerm:s})}var k=performance.now()-R;console.log(">> time (creating RBF) = "+k.toFixed(2)+" (ms)");var P=[0,0,0],L=0;for(x=0;x<v.length;x++){T=v[x][0],w=v[x][1];R=performance.now();M=A([T,w]);L+=k=performance.now()-R,P[0]+=Math.pow(y[x][0]-M[0],2),P[1]+=Math.pow(y[x][1]-M[1],2),P[2]+=Math.pow(y[x][2]-M[2],2)}for(x=0;x<3;x++)P[x]=Math.sqrt(P[x]/v.length),P[x]=P[x]/255*100;var C=(P[0]+P[1]+P[2])/3;console.log(">> RMS error (sample xdata) = "+C.toFixed(2)+" (%)");for(P=[0,0,0],L=0,w=0;w<n;w++)for(T=0;T<r;T++){R=performance.now();M=A([T,w]);L+=k=performance.now()-R;var I=a.dipPixelColor(t,T,w);P[0]+=Math.pow(I.r-M[0],2),P[1]+=Math.pow(I.g-M[1],2),P[2]+=Math.pow(I.b-M[2],2),M[0]=~~M[0],M[1]=~~M[1],M[2]=~~M[2],M[3]=255,a.dipPixelColor(t,T,w,M)}for(x=0;x<3;x++)P[x]=Math.sqrt(P[x]/(r*n)),P[x]=P[x]/255*100;C=(P[0]+P[1]+P[2])/3;console.log(">> RMS error (whole image) = "+C.toFixed(2)+" (%)"),console.log(">> time (creating image) = "+L.toFixed(2)+" (ms)"),(e=new THREE.Texture(t)).needsUpdate=!0;var H=new THREE.Mesh(new THREE.PlaneBufferGeometry(10,10),new THREE.MeshBasicMaterial({map:e}));a.add(H)}))},a.demoSurfaceRBF=function(){a.loadSTL({url:"models/dummy/stl/bunny.stl",callback:function(e){a.add(e),e.material=new THREE.MeshNormalMaterial({flatShading:!0,side:THREE.DoubleSide});var t={rbf:"linear",maxPoints:256,resolution:32},r=a.toNonIndexedBufferGeometry(e.geometry),n=r.attributes.position.array,i=r.attributes.normal.array,o=performance.now(),s=new a.SurfaceRBF(n,i,t),l=performance.now()-o;console.log(">> time (creating surfaceRBF) = "+l.toFixed(2)+" (ms)");var u=new THREE.Box3,c=new THREE.Vector3;u.setFromObject(e),u.getSize(c),c.multiplyScalar(.1),u.expandByVector(c);var h=[u.min.toArray(),u.max.toArray()],d=(o=performance.now(),new a.IsosurfaceGeometry(t.resolution,h,(function(e,t,r){return s([e,t,r])[0]})));l=performance.now()-o;console.log(">> time (creating isosurface) = "+l.toFixed(2)+" (ms)");var f=new THREE.Mesh(d,e.material);if(a.add(f),"models/dummy/stl/bunny.stl"===e.name||"models/dummy/stl/shoelast.stl"===e.name||"models/dummy/stl/foot.stl"===e.name){var p=new THREE.Vector3(-Math.PI/2,0,0),m=new THREE.Vector3(20,0,0);a.resizeObject(e,20),a.transformObject(e,m,p),a.resizeObject(f,20),a.transformObject(f,null,p)}}})},a.demoTexturedSurfaceRBF=function(){function e(e){if(a.add(e),e instanceof THREE.Scene){var t=new THREE.TextureLoader;(g=e.children[0]).material=new THREE.MeshPhongMaterial({specular:1118481,map:t.load("models/LeePerrySmith/Map-COL.jpg"),specularMap:t.load("models/LeePerrySmith/Map-SPEC.jpg"),normalMap:t.load("models/LeePerrySmith/Infinite-Level_02_Tangent_SmoothUV.jpg"),shininess:25}),e=g}else if(e instanceof THREE.Group){e=g=e.children[0]}var r={rbf:"wendland31",maxPoints:16,resolution:64},n=a.toNonIndexedBufferGeometry(e.geometry),i=n.attributes.position.array,o=n.attributes.normal.array,s=n.attributes.uv.array,l=performance.now(),u=new a.TexturedSurfaceRBF(i,o,s,r),c=performance.now()-l;console.log(">> time (creating texturedSurfaceRBF) = "+c.toFixed(2)+" (ms)");var h=new THREE.Box3,d=new THREE.Vector3;h.setFromObject(e),h.getSize(d),d.multiplyScalar(.1),h.expandByVector(d);var f=[[h.min.x,h.min.y,h.min.z],[h.max.x,h.max.y,h.max.z]],p=(l=performance.now(),new a.IsosurfaceGeometry(r.resolution,f,(function(e,t,r){return u([e,t,r])[0]})));c=performance.now()-l;function m(e){var t=u([e.x,e.y,e.z]);return[t[1],t[2]]}console.log(">> time (creating isosurface) = "+c.toFixed(2)+" (ms)"),p.faceVertexUvs[0]=[],p.faces.forEach((function(e){var t=m(p.vertices[e.a]),r=m(p.vertices[e.b]),n=m(p.vertices[e.c]);p.faceVertexUvs[0].push([new THREE.Vector2(t[0],t[1]),new THREE.Vector2(r[0],r[1]),new THREE.Vector2(n[0],n[1])])})),p.uvsNeedUpdate=!0;var g=new THREE.Mesh(p,e.material);a.add(g)}a.loadOBJ({obj:"troll.obj",mtl:"troll.mtl",basePath:"models/obj/troll/",callback:e(object)}),a.loadGLTF({url:"models/LeePerrySmith/LeePerrySmith.glb",callback:e(object)}),a.loadOBJ({obj:"cyborg.obj",mtl:"cyborg.mtl",basePath:"models/obj/cyborg/",callback:e(object)})},a.demoQuadricSurfaces=function(){a.loadSTL({url:"models/dummy/woman.stl",callback:function(e){a.add(e),e.material=new THREE.MeshNormalMaterial({flatShading:!0,side:THREE.DoubleSide});var t={maxPoints:16,resolution:64},r=a.toNonIndexedBufferGeometry(e.geometry),n=r.attributes.position.array,i=r.attributes.normal.array,o=performance.now(),s=new a.QuadricSurfaces(n,i,t),l=performance.now()-o;console.log(">> time (creating quadricSurfaces) = "+l.toFixed(2)+" (ms)");var u=new THREE.Box3,c=new THREE.Vector3;u.setFromObject(e),u.getSize(c),c.multiplyScalar(.1),u.expandByVector(c);var h=[[u.min.x,u.min.y,u.min.z],[u.max.x,u.max.y,u.max.z]],d=(o=performance.now(),new a.IsosurfaceGeometry(t.resolution,h,(function(e,t,r){return s([e,t,r])[0]})));l=performance.now()-o;console.log(">> time (creating isosurface) = "+l.toFixed(2)+" (ms)");var f=new THREE.Mesh(d,e.material);a.add(f)}})},a.demoUDelaunayGeometry=function(){for(var e=100,t=100,r=100,n=[],i=new THREE.ImprovedNoise,o=0;o<1e3;o++){var s=a.randFloat(-e,e),l=a.randFloat(-t,t),u=a.randFloat(-r,r);l=10*i.noise(s,l,u),n.push(new THREE.Vector3(s,l,u))}var c=new a.UDelaunayGeometry(n,"xz");for(c=a.toGeometry(c),o=0;o<c.faces.length;o++)c.faces[o].color.setHex(16777215*Math.random());var h=new THREE.MeshBasicMaterial({vertexColors:!0,side:THREE.DoubleSide}),d=new THREE.Mesh(c,h);a.add(d)},a.demoCDelaunayGeometry=function(){var e=[280.35714,648.79075,286.78571,662.8979,263.28607,661.17871,262.31092,671.41548,250.53571,677.00504,250.53571,683.43361,256.42857,685.21933,297.14286,669.50504,289.28571,649.50504,285,631.6479,285,608.79075,292.85714,585.21932,306.42857,563.79075,323.57143,548.79075,339.28571,545.21932,357.85714,547.36218,375,550.21932,391.42857,568.07647,404.28571,588.79075,413.57143,612.36218,417.14286,628.07647,438.57143,619.1479,438.03572,618.96932,437.5,609.50504,426.96429,609.86218,424.64286,615.57647,419.82143,615.04075,420.35714,605.04075,428.39286,598.43361,437.85714,599.68361,443.57143,613.79075,450.71429,610.21933,431.42857,575.21932,405.71429,550.21932,372.85714,534.50504,349.28571,531.6479,346.42857,521.6479,346.42857,511.6479,350.71429,496.6479,367.85714,476.6479,377.14286,460.93361,385.71429,445.21932,388.57143,404.50504,360,352.36218,337.14286,325.93361,330.71429,334.50504,347.14286,354.50504,337.85714,370.21932,333.57143,359.50504,319.28571,353.07647,312.85714,366.6479,350.71429,387.36218,368.57143,408.07647,375.71429,431.6479,372.14286,454.50504,366.42857,462.36218,352.85714,462.36218,336.42857,456.6479,332.85714,438.79075,338.57143,423.79075,338.57143,411.6479,327.85714,405.93361,320.71429,407.36218,315.71429,423.07647,314.28571,440.21932,325,447.71932,324.82143,460.93361,317.85714,470.57647,304.28571,483.79075,287.14286,491.29075,263.03571,498.61218,251.60714,503.07647,251.25,533.61218,260.71429,533.61218,272.85714,528.43361,286.07143,518.61218,297.32143,508.25504,297.85714,507.36218,298.39286,506.46932,307.14286,496.6479,312.67857,491.6479,317.32143,503.07647,322.5,514.1479,325.53571,521.11218,327.14286,525.75504,326.96429,535.04075,311.78571,540.04075,291.07143,552.71932,274.82143,568.43361,259.10714,592.8979,254.28571,604.50504,251.07143,621.11218,250.53571,649.1479,268.1955,654.36208],t=[];t[0]=[325,437,320,423,329,413,332,423],t[1]=[320.72342,480,338.90617,465.96863,347.99754,480.61584,329.8148,510.41534,339.91632,480.11077,334.86556,478.09046];for(var r=[],n=0;n<e.length;n+=2){var i=new THREE.Vector3(e[n],e[n+1],0);r.push(i)}for(var o=[],s=0;s<t.length;s++){o[s]=[];for(n=0;n<t[s].length;n+=2){i=new THREE.Vector3(t[s][n],t[s][n+1],0);o[s].push(i)}}var l=new a.CDelaunayGeometry(r,o);for(l=a.toGeometry(l),n=0;n<l.faces.length;n++)l.faces[n].color.setHex(16777215*Math.random());l.center();var u=new THREE.MeshBasicMaterial({vertexColors:!0,side:THREE.DoubleSide}),c=new THREE.Mesh(l,u);a.add(c)},a.demoCSGBoolean=function(){var e=(new Date).getTime(),t=new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load("images/rock/roughRockD.png")}),r=new THREE.Mesh(new THREE.BoxBufferGeometry(3,3,3)),n=new THREE.Mesh(new THREE.SphereBufferGeometry(1.8,64,32)),i=a.union(r,n);i.material=t;var o=a.intersect(r,n);o.material=t;var s=a.subtract(r,n);s.material=t,i.position.x=-5,s.position.x=5,a.add(i),a.add(o),a.add(s);var l=(new Date).getTime();console.log("CSG time: "+(l-e)+" ms")},a.demoSimplifyMesh=function(){(new THREE.GLTFLoader).load("models/LeePerrySmith/LeePerrySmith.glb",(function(e){var t=e.scene.children[0];t.position.x=-3,t.rotation.y=Math.PI/2,a.add(t);var r=t.clone();r.geometry=a.simplifyGeometry(r.geometry,.875),r.position.x=3,r.rotation.y=-Math.PI/2,a.add(r);var n=a.createWireframe(t);t.add(n);n=a.createWireframe(r);r.add(n)}))},a.demoSubdivideMesh=function(){(new THREE.GLTFLoader).load("models/LeePerrySmith/LeePerrySmith.glb",(function(e){var t=e.scene.children[0];t.position.x=-3,t.rotation.y=Math.PI/2,a.add(t);var r=t.clone();r.geometry=a.subdivideGeometry(r.geometry,1),r.position.x=3,r.rotation.y=-Math.PI/2,a.add(r);var n=a.createWireframe(t);t.add(n);n=a.createWireframe(r);r.add(n)}))},a.demoCanvasDrawing=function(){var e;(e=a.createTextSprite("가나다라마바사아자차카타파하",{textHeight:1,textColor:16711680,textWidthScale:1})).position.set(0,7,0),a.add(e),(e=a.createTextSprite("abcdefghijklmnopqrstuvwxyz!@#$%^&*()")).position.set(0,8,0),a.add(e);var t=document.createElement("canvas"),r=t.getContext("2d");t.height=256,t.width=256;var n=[[0,0],[100,50],[200,0],[250,200],[50,150]];r.fillPolygon(n,30,"yellow");for(var i=0;i<n.length;i++)n[i][0]+=10;r.strokePolygon(n,30,"red"),r.fillRoundRect(128,128,64,64,10,"#D2691E"),r.strokeRoundRect(144,144,64,64,10,"#00008B"),r.fillRect(5,5,20,20),r.strokeRect(128,5,20,20),r.fillCircle(64,192,30,"red"),r.strokeCircle(128,192,30,"#4B0082"),a.add(a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshBasicMaterial",map:new THREE.CanvasTexture(t)}}))},a.demoAnimations=function(){a.loadGLB({url:"models/gltf/RobotExpressive/RobotExpressive.glb",callback:function(e){var t=a.createSpotLight({target:e});t.position.set(0,10,0),a.add(t),a.add(e)}})},a.demoParticles=function(){var e=a.Particles.examples.fountain;e.positionBase=new THREE.Vector3(0,1,0),e.positionSpread=new THREE.Vector3(1,0,1),e.velocityBase=new THREE.Vector3(0,16,0),e.velocitySpread=new THREE.Vector3(10,2,10),e.accelerationBase=new THREE.Vector3(0,-10,0),e.sizeTween.values[0]=.01,e.sizeTween.values[1]=1,e.emitterDeathAge=5;var t=a.createParticles(e);a.add(t)},a.demoImageSpritesHUD=function(){(new THREE.TextureLoader).load("images/sprites/metalBall.png",e=>{var t=e.image.width,r=e.image.height,n=a.createSpritesHUD(e,0,0,t,r);a.appWorks.sceneHUD.add(n);n=a.createSpritesHUD(n.material,0+t,0,t,r);a.appWorks.sceneHUD.add(n);n=a.createSpritesHUD(n.material,0+2*t,0,t,r);a.appWorks.sceneHUD.add(n)})},a.demoCanvasTextHUD=function(){var e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial"}});a.add(e),e.update=function(e,t){this.rotation.x+=.01,this.rotation.y-=.02,this.rotation.z+=.03};var t=[],r=a.computeMassProperties(e);t.push("surface area: "+r.area.toFixed(2)),t.push("volume size: "+r.volume.toFixed(2)),t.push("rot [x:-9.9, y:-9.9, z:-9.9]");var n=a.createTextHUD(t,10,0,null,null,!0);a.appWorks.sceneHUD.add(n),n.update=function(t,r){var n=this.userData.context2D,i=this.userData.texts,a=this.userData.lineHeight,o=2*Math.PI,s="rot [x:"+(e.rotation.x%o).toFixed(1)+", y:"+(e.rotation.y%o).toFixed(1)+", z:"+(e.rotation.z%o).toFixed(1)+"]";i[2]=s,n.clear();var l=a;i.forEach(e=>{n.fillText(e,0,l),l+=a}),this.material.map.needsUpdate=!0}},a.demoRenderTargetHUD=function(){var e=a.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.6,128,32]},material:{type:"MeshPhongMaterial"}});a.add(e),e.update=function(e,t){this.rotation.x+=.01,this.rotation.y-=.02,this.rotation.z+=.03};var t=2*a.appWorks.cameraHUD.top-200,r=a.createRenderTargetHUD(e,0,t,200,200,!0);a.appWorks.sceneHUD.add(r),r.update=function(t,r){var n=this.userData.renderTarget,i=this.userData.rtScene,o=this.userData.rtCamera;i.children[0].rotation.copy(e.rotation);var s=a.appWorks.renderer;s.setRenderTarget(n),s.render(i,o)}},a.demoNatureTextures=function(){var e,t=new THREE.TextureLoader;(e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",map:t.load("images/rock/crackRockDiffuse.jpg"),normalMap:t.load("images/rock/crackRockNormal.jpg"),aoMap:t.load("images/rock/crackRockAO.jpg")}})).name="demoCrackRocks",a.add(e),(e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:.2,metalness:.8,map:t.load("images/metal/metalPanelsDiffuse8.jpg"),normalMap:t.load("images/metal/metalPanelsNormal.jpg"),aoMap:t.load("images/metal/metalPanelsAO.jpg")}})).name="demoMetalPanels",a.add(e),(e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:1,metalness:0,map:t.load("images/terrain/wasteLandDiffuse6.jpg"),normalMap:t.load("images/terrain/wasteLandNormal.jpg"),aoMap:t.load("images/terrain/wasteLandAO.jpg")}})).name="demoWasteLand",a.add(e),(e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:1,metalness:0,map:t.load("images/terrain/dirtGrassTerrainD6.jpg"),normalMap:t.load("images/terrain/dirtGrassTerrainN.jpg"),aoMap:t.load("images/terrain/dirtGrassTerrainAO.jpg")}})).name="demoDirtGrassTerrain",a.add(e),(e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",map:t.load("images/fish/caviarDiffuse4.jpg"),normalMap:t.load("images/fish/caviarNormal.jpg"),aoMap:t.load("images/fish/caviarAO.jpg")}})).name="demoCaviar",a.add(e)},a.demoImageProcessing=function(){a.imageFileProcessing("images/jamieElly1024.png","EdgeDetection2Shader",{edgeFunc:"trueColorEdge",showImage:!0,saveImage:!0})},a.demoSketcher=function(){var e=a.appWorks.width,t=a.appWorks.height,r=new a.Sketcher({width:e,height:t});a.appWorks.dom.appendChild(r.dom)},a.demoMatcaps=function(){var e=a.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.6,128,32]},material:{type:"MeshPhongMaterial"}});a.add(e),a.add(a.createHemisphereLight());var t=a.getObjectSize(e),r=function(e){var t=(e=e||100)/2,r=new THREE.Object3D;r.name="pbrWalls";var n=new THREE.PlaneBufferGeometry(.9*e,.9*e),i=new THREE.Reflector(n,{clipBias:.003,textureWidth:~~(a.appWorks.width*window.devicePixelRatio),textureHeight:~~(a.appWorks.height*window.devicePixelRatio),color:8952217,recursion:1});i.position.y=t,i.position.z=.99*-t,r.add(i);n=new THREE.PlaneBufferGeometry(1.001*e,1.001*e);function o(e,t){t=t||4;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}var s=new THREE.TextureLoader,l=new THREE.MeshStandardMaterial({color:11184810,roughness:1,metalness:0,map:s.load("images/pbr/wallA.png",o),normalMap:s.load("images/pbr/wallN.png",o),aoMap:s.load("images/pbr/wallAO.png",o),roughnessMap:s.load("images/pbr/wallR.png",o)}),u=new THREE.Mesh(n,l);u.position.y=e,u.rotateX(Math.PI/2),r.add(u);var c=new THREE.Mesh(n,l);c.rotateX(-Math.PI/2),r.add(c);var h=new THREE.Mesh(n,l);h.position.z=t,h.position.y=t,h.rotateY(Math.PI),r.add(h);var d=new THREE.Mesh(n,l);d.position.z=-t,d.position.y=t,r.add(d);var f=new THREE.Mesh(n,l);f.position.x=t,f.position.y=t,f.rotateY(-Math.PI/2),r.add(f);var p=new THREE.Mesh(n,l);return p.position.x=-t,p.position.y=t,p.rotateY(Math.PI/2),r.add(p),r}(4*t);r.position.y=-4*t/2,a.add(r),a.appWorks.select(e),a.appWorks.guiMatcaps.setDisplay(""),a.appWorks.guiNormalMaps.setDisplay("")},a.demoLighting=function(){var e=a.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,10/6,128,32]},material:{type:"MeshPhongMaterial"}});a.add(e),a.fitCameraToObject(e);var t=a.createSunsetLights();a.add(t)},a.demoArenaRows=function(){var e;(e=a.createArenaRow({radius:.5,numSections:30,conesPerSection:5,heightMin:.1,heightMax:.15,radiusMin:.05,radiusMax:.05})).scale.setScalar(20),a.add(e),(e=a.createArenaRow({radius:.45,numSections:20,conesPerSection:2,heightMin:.05,heightMax:.075,radiusMin:.025,radiusMax:.05})).scale.setScalar(20),a.add(e)},a.demoInstancedMeshes=function(){var e,t=(new THREE.TextureLoader).load("images/matcaps3/00023.jpg"),r=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshMatcapMaterial",matcap:t}}),n=a.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[2.5,32,16]},material:{type:"MeshMatcapMaterial",matcap:t}}),i=a.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[1.5,1.5,5,32]},material:{type:"MeshMatcapMaterial",matcap:t}}),o={pattern:"circular",axis:"y",radiusStart:50,radiusLength:450,numRadius:100,angleStart:0,angleLength:2*Math.PI,numAngle:100,colorMode:"0"},s={pmin:[0,-500,-500],pmax:[0,500,500],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"2"},l=a.createInstancedMeshes(r,{pattern:"rectangular",axis:"z",width:1e3,height:1e3,numWidth:100,numHeight:100,colorMode:"1"}),u=a.createInstancedMeshes(n,o),c=a.createInstancedMeshes(i,s);l.update=function(e,t){this.rotation.y=.1*t},u.update=(e=10,function(t,r){(this.position.y>200||this.position.y<-200)&&(e*=-1),this.position.y+=t*e,this.rotation.y=.1*r}),c.update=function(e,t){this.rotation.y=.1*t},a.add(l),a.add(u),a.add(c)},a.demoInstancedObject=function(){var e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshPhongMaterial"}}),t=a.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[2.5,32,16]},material:{type:"MeshPhongMaterial"}}),r=a.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[1.5,1.5,5,32]},material:{type:"MeshPhongMaterial"}}),n=new THREE.Object3D;n.add(e,t,r),n.position.y=10;var i=a.createInstancedObject(n,{pmin:[-500,0,-500],pmax:[500,0,500],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"1"});a.add(i)},a.demoImgBase64ToFile=function(e){a.url2img(e,(function(e){var t=a.img2pixels(e);a.pixels2saveas(t,"image.png")}))},a.demoWebBrowserInfo=function(){console.log("# Navigator Info"),console.log(window.navigator),console.log("# Device Info");var e=[];e.push("isMobile: "+a.isDeviceMobile()),e.push("isLandscape: "+a.isDeviceLandscape()),e.push("isTouch: "+a.isDeviceTouch()),e.push("isWindowsOS: "+a.isDeviceWindowsOS()),e.push("isMacOS: "+a.isDeviceMacOS()),e.push("width class: "+(window.innerWidth<600?"extra small":window.innerWidth<768?"small":window.innerWidth<992?"medium":window.innerWidth<1200?"large":"extra large")),console.log(e.join("\n")),console.log("# WebGL Info"),console.log(a.getWebGLInfo().join("\n"))},a.demoLoadObject3D=function(){for(var e=[],t=0;t<1024;t++){var r=a.randFloat(-10,10),n=a.randFloat(-10,10),i=a.randFloat(-10,10);e.push(r,n,i)}var o=[];for(t=0;t<1024;t++){var s=a.randFloat(0,1),l=a.randFloat(0,1),u=a.randFloat(0,1);o.push(s,l,u)}a.loadObject3D({object:{type:"Points",name:"points"},geometry:{type:"BufferGeometry",attributes:{position:e,color:o}},material:{type:"PointsMaterial",map:"images/sprites/metalBall.png",color:16777215,size:1,transparent:!0,depthTest:!1,vertexColors:!0}}).then(e=>{a.add(e)})},a.demoTweenBox=function(){a.add(a.createHemisphereLight());var e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",map:(new THREE.TextureLoader).load("images/crate.gif")}});a.add(e);for(var t=a.getCurrentTime(),r=e,n=0;n<3;n++){let e=0===n?r:r.clone();0!==n&&a.add(e),e.tweens=a.tweenObjects([e.position,e.rotation,e.scale,e.material.color],[{y:20},{y:Math.PI/2},{x:2,y:2,z:2},{r:n/2,g:n/2,b:0}],{duration:3e3,easing:A.Easing.Elastic.InOut,repeat:1/0,yoyo:!0,start:1e3*t,delay:200*n}),e.update=function(t,r){e.tweens.update(1e3*r)}}},a.demoTweenBuildings=function(){a.loadOBJ({obj:"buildings.obj",basePath:"models/obj/",callback:function(e){a.appWorks.scene.background=a.createBackground("redSky"),a.appWorks.scene.fog=a.createFog({type:"exp2",color:a.FOG_COLOR,density:.0093});const t=a.createAmbientLight({color:10488330,intensity:.05});a.add(t);const r=a.createSpotLight({color:16711680,intensity:.2});r.position.set(100,150,100),a.add(r);const n=a.createPointLight({color:16777215,intensity:.4});n.position.set(16,100,-68),a.add(n);var i=new THREE.Object3D,o=[],s=e.children.map(e=>(e.scale.setScalar(.01),e.position.set(0,0,0),e.frustumCulled=!1,e.receiveShadow=!1,e.castShadow=!1,e));for(var l=new THREE.MeshPhysicalMaterial({color:16777215,metalness:.58,roughness:.18}),u=0;u<40;u++)for(var c=0;c<40;c++){const e=s[a.randInt(0,s.length-1)].clone();e.material=l,e.scale.y=Math.random()*(.008+.01),e.position.x=3*u,e.position.z=3*c,i.add(e),o.push(e)}a.add(i),i.position.set(-60,0,-60);var h=a.getCurrentTime();o.sort((e,t)=>e.position.lengthSq()-t.position.lengthSq());var d=o.length;o.forEach((e,t)=>{e.position.y=.5,e.tween=a.tweenObject(e.position,{y:-.5},{duration:2500,easing:A.Easing.Sinusoidal.InOut,repeat:1/0,yoyo:!0,start:1e3*h,delay:t/(d-1)*2500*2}),e.update=function(t,r){e.tween.update(1e3*r)}})}})},a.demoTweenInstancedMesh=function(){var e=a.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[4.5,4.5,10,32]},material:{type:"MeshMatcapMaterial",matcap:(new THREE.TextureLoader).load("images/matcapMetal.jpg")}}),t=a.createInstancedMeshes(e,{pattern:"rectangular",axis:"y",width:1e3,height:1e3,numWidth:100,numHeight:100});a.add(t);for(var r,n,i=a.getCurrentTime(),o=t.numInstances,s=new THREE.Vector3,l=2*Math.PI,u=[],c=[],h=0;h<o;h++)t.getPositionAt(h,s),u.push({x:s.x,y:s.y,z:s.z,w:h}),r=~~(h/100),n=h%100,c.push({y:s.y+20*Math.sin(r/99*l)*Math.cos(n/99*l)});t.tweens=a.tweenObjects(u,c,{duration:1e3,repeat:1/0,yoyo:!0,start:1e3*i,objectDelay:.5,update:function(e){s.set(e.x,e.y,e.z),t.setPositionAt(e.w,s)}}),t.update=function(e,r){t.tweens.update(1e3*r),t.needsUpdate("position")}},a.demoTerrainLOD=function(){a.add(a.createHemisphereLight());var e=a.createWater();e.position.y=5.3,a.add(e);var t=a.camera;t.position.set(-143,59.6,-132.3),t.rotation.set(-155.8*THREE.DEG2RAD,-44.6*THREE.DEG2RAD,-162.5*THREE.DEG2RAD),t.updateProjectionMatrix();var r=a.createTerrainLOD("GIANT",1024,4,64,100);a.add(r)},a.demoHeightMapTerrain=function(){var e=a.createDirectionalLight();e.position.set(0,10,0),a.add(e);var t=a.createWater();t.position.y=3.5,a.add(t);var r=a.camera;r.position.set(-467.7,48.5,511.6),r.rotation.set(-5.42*THREE.DEG2RAD,-42.31*THREE.DEG2RAD,-3.65*THREE.DEG2RAD),r.updateProjectionMatrix();var n=a.createHeightMapTerrain("images/terrain/heightmapCA.png",{worldWidth:1024,resolution:1024});a.add(n)},a.demoLoadHeightMaps=function(){(new a.HGTLoader).loadTile(28.661402,-17.872627,12)},a.demoLoadNRRD=function(){function e(){a.renderer.render(a.scene,a.camera)}var t=512,r=window.innerWidth/window.innerHeight,n=new THREE.OrthographicCamera(-t*r/2,t*r/2,256,-256,1,1e3);n.position.set(0,0,128),n.up.set(0,0,1),a.appWorks.camera=n,a.camera=n;var i=new THREE.OrbitControls(n,a.renderer.domElement);i.addEventListener("change",e),i.target.set(64,64,128),i.minZoom=.5,i.maxZoom=4,i.update(),a.appWorks.controls=i,(new THREE.NRRDLoader).load("models/nrrd/stent.nrrd",(function(t){var r=new THREE.DataTexture3D(t.data,t.xLength,t.yLength,t.zLength);r.format=THREE.RedFormat,r.type=THREE.FloatType,r.minFilter=r.magFilter=THREE.LinearFilter,r.unpackAlignment=1;var n=new THREE.TextureLoader,i={viridis:n.load("images/medical/cm_viridis.png",e),gray:n.load("images/medical/cm_gray.png",e)},o=0,s=1,l="iso",u=.15,c="viridis",h=THREE.VolumeRenderShader1,d=THREE.UniformsUtils.clone(h.uniforms);d.u_data.value=r,d.u_size.value.set(t.xLength,t.yLength,t.zLength),d.u_clim.value.set(o,s),d.u_renderstyle.value="mip"==l?0:1,d.u_renderthreshold.value=u,d.u_cmdata.value=i[c];var f=new THREE.ShaderMaterial({uniforms:d,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,side:THREE.BackSide}),p=new THREE.BoxBufferGeometry(t.xLength,t.yLength,t.zLength);p.translate(t.xLength/2-.5,t.yLength/2-.5,t.zLength/2-.5);var m=new THREE.Mesh(p,f);a.add(m)}))},a.demoSelectFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="select_files" name="files[]" multiple />\n        <output id="select_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("select_files").addEventListener("change",(function(e){for(var t,r=e.target.files,n=[],i=0;t=r[i];i++)t.name.match(/\.(jpg|png)$/)&&n.push("<li><strong>",a.escapeHTML(t.name),"</strong> (",t.type||"n/a",") - ",a.humanFileSize(t.size),", last modified: ",t.lastModifiedDate?t.lastModifiedDate.toLocaleDateString():"n/a","</li>");document.getElementById("select_result").innerHTML="<ul>"+n.join("")+"</ul>"}),!1)},a.demoDropFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <div id="drop_zone" style="\n            margin: 10px 5px 0 0;\n            border: 2px dashed #bbb;\n            -moz-border-radius: 5px;\n            -webkit-border-radius: 5px;\n            border-radius: 5px;\n            padding: 25px;\n            text-align: center;\n            font: 20pt bold \'Vollkorn\';\n            color: #bbb;\n        ">Drop files here</div>\n        <output id="drop_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.getElementById("drop_zone");t.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),!1),t.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault();for(var t,r=e.dataTransfer.files,n=[],i=0;t=r[i];i++)n.push("<li><strong>",a.escapeHTML(t.name),"</strong> (",t.type||"n/a",") - ",a.humanFileSize(t.size),", last modified: ",t.lastModifiedDate?t.lastModifiedDate.toLocaleDateString():"n/a","</li>");document.getElementById("drop_result").innerHTML="<ul>"+n.join("")+"</ul>"}),!1)},a.demoReadFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="read_files" name="files[]" multiple /><br>\n        <output id="read_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("read_files").addEventListener("change",(function(e){for(var t,r=e.target.files,n=0;t=r[n];n++)if(t.type.match("image.*")){var i=new FileReader;i.onload=function(e){return function(t){var r=document.createElement("span");r.innerHTML=['<img class="thumb" style="height: 75px; border: 1px solid #000; margin: 10px 5px 0 0;" src="',t.target.result,'" title="',a.escapeHTML(e.name),'"/>'].join(""),document.getElementById("read_result").insertBefore(r,null)}}(t),i.readAsDataURL(t)}}),!1)},a.demoProgressFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="progress_files" name="file" />\n        <button onclick="JAMIE.abortRead();">Cancel reading</button>\n        <div id="progress_bar"><div class="percent">0%</div></div>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.getElementById("progress_bar");t.style.cssText="        margin: 10px 0;\n        padding: 3px;\n        border: 1px solid #000;\n        font-size: 14px;\n        clear: both;\n        opacity: 0;\n        -moz-transition: opacity 1s linear;\n        -o-transition: opacity 1s linear;\n        -webkit-transition: opacity 1s linear;\n    ";var r,n=document.querySelector(".percent");n.style.cssText="        background-color: #99ccff;\n        height: auto;\n        width: 0;\n    ",a.abortRead=function(){r.abort()},document.getElementById("progress_files").addEventListener("change",(function(e){n.style.width="0%",n.textContent="0%",(r=new FileReader).onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:alert("File not found!");break;case e.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case e.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}},r.onprogress=function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);t<100&&(n.style.width=t+"%",n.textContent=t+"%")}},r.onabort=function(e){alert("File read canceled")},r.onloadstart=function(e){t.style.opacity="1.0"},r.onload=function(e){n.style.width="100%",n.textContent="100%",setTimeout((function(){t.style.opacity="0.0"}),2e3)},r.readAsBinaryString(e.target.files[0])}),!1)},a.demo3DFileTo2DImage=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="select_files" name="files[]" multiple />\n        <output id="select_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("select_files").addEventListener("change",(function(e){for(var t=e.target.files,r=[],n=0;i=t[n];n++)i.name.match(/\.(glb|GLB)$/)&&r.push("<li><strong>",a.escapeHTML(i.name),"</strong> (",i.type||"n/a",") - ",a.humanFileSize(i.size),", last modified: ",i.lastModifiedDate?i.lastModifiedDate.toLocaleDateString():"n/a","</li>");var i;for(document.getElementById("select_result").innerHTML="<ul>"+r.join("")+"</ul>",n=0;i=t[n];n++){var o=a.escapeHTML(i.name);a.loadGLB({url:"dummy/"+o,callback:function(e){a.add(e),o=(o=(o=e.name).split("/")[1]).split(".")[0],o+=".jpg",a.welcomeObject(e),a.screenCapture(o,!1),a.remove(e)}})}}),!1)},a.demoCaptureToAnimatedGIF=function(){function e(e){var t=a.camera,r=t.position.x,n=t.position.z,i=Math.sqrt(r*r+n*n);t.position.x=i*Math.sin(e*THREE.DEG2RAD),t.position.z=i*Math.cos(e*THREE.DEG2RAD)}e(30),a.screenCapture(!1),e(0),a.screenCapture(!1),e(-30),a.screenCapture(!1)},a.demoSplitInstMesh=function(){a.appWorks.scene.background=a.createBackground("redSky"),a.add(a.createHemisphereLight());var e=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshPhongMaterial"}});a.createInstancedMeshes(e,{pattern:"rectangular",axis:"z",width:100,height:100,numWidth:10,numHeight:10,colorMode:"1"}).split(e=>{e.forEach(e=>{a.add(e)})})},a.demoSpeechBubble=function(){var e=a.createTextSprite("Welcome to Jamie World",{textColor:4210752,textHeight:.5,fontWeight:"bold"});e.position.z=.001,e.name="speechText";var t=new THREE.Vector3;a.computeBoundingBox(e).getSize(t);var r=256*t.x,n=256*t.y,i=.2*n,o=r/2,s=n+i,l=4*i,u=document.createElement("canvas"),c=u.getContext("2d");u.width=o>r?o:r,u.height=s>n?s:n,c.lineWidth="2",c.fillSpeechBubble(0,0,r,n,i,o,s,l,"#fff");var h=new THREE.SpriteMaterial({color:16777215,map:new THREE.CanvasTexture(c.canvas),transparent:!0,opacity:.5,depthTest:!1}),d=new THREE.Sprite(h);d.scale.set(.7*t.x,1.5*t.y,1),d.name="speechBubble";var f=new THREE.Object3D;f.name="speech",f.add(e,d),a.add(f)},a.demoProgressbar=function(){const e=new THREE.LoadingManager;e.onStart=()=>{a.createProgressbar()},e.onProgress=(e,t,r)=>{a.updateProgressbar(t,r)},e.onLoad=()=>{a.hideProgressbar()},e.onError=e=>{a.errorProgressbar("There was an error loading "+e)};THREE.DRACOLoader.setDecoderPath("js/draco/gltf/");const t=new THREE.GLTFLoader(e);t.setCrossOrigin("anonymous"),t.setDRACOLoader(new THREE.DRACOLoader),["models/gltf/BarramundiFish.glb","models/gltf/ferrari.glb","models/gltf/Flamingo.glb","models/gltf/Horse.glb","models/gltf/Parrot.glb","models/gltf/PrimaryIonDrive.glb","models/gltf/Soldier.glb","models/gltf/Stork.glb"].forEach(e=>{t.load(e,e=>{var t=e.scene||e.scenes[0],r=e.animations;r&&(t.animations=r),a.add(t)})})},a.demoTrees=function(){{const e=new THREE.LoadingManager;e.onStart=()=>{a.createProgressbar()},e.onProgress=(e,t,r)=>{a.updateProgressbar(t,r)},e.onLoad=()=>{a.hideProgressbar()},e.onError=e=>{a.errorProgressbar("There was an error loading "+e)},a.loadOBJ({obj:"Tree_V9.obj",mtl:"Tree_V9.mtl",basePath:"models/obj/Tree_V9/",manager:e,callback:function(e){e.getObjectByName("tree_v9_leaves_tree_v9_leaves_leaves_01").material.side=THREE.DoubleSide,e.getObjectByName("tree_v9_leaves_tree_v9_leaves_leaves_02").material.side=THREE.DoubleSide,e.getObjectByName("tree_v9_leaves_tree_v9_leaves_leaves_03").material.side=THREE.DoubleSide,a.add(e)}})}},a.demoPrintInfo=function(){},a.demoObjectToPoints=function(){new Promise(e=>{a.add(a.createHemisphereLight());var t=a.createNoiseHeightGeometry(1e3,1e3,256,256,100),r=new THREE.TextureLoader,n=new THREE.MeshLambertMaterial({map:r.load("images/rock/roughRockD.png")}),i=new THREE.Mesh(t,n);i.name="sampleMesh",a.add(i),setTimeout(()=>e(i),500)}).then(e=>{a.add(e.clonedToPoints(.05))})},a.demoRaymarchToPoints=function(){var e=a.appWorks.selectObject;e&&e.isRaymarch&&a.add(e.clonedToPoints(.05,!1))},a.demoTerrainWaterCaustics=function(){var e=a.createDirectionalLight({intensity:.2});e.position.x=-100,e.position.y=60,a.add(e);var t=a.createTerrain({height:100,waterDepth:20,waterColor:a.OCEAN_COLOR});a.add(t);var r=a.createWater({waterColor:a.OCEAN_COLOR});a.add(r);var n=a.createCloudDome();a.add(n)},a.demoApplication=function(){a.demoFFT()},a.demoSceneEffect=function(){var e=a.createSceneEffectMesh({side:THREE.DoubleSide,caustics:!0,causticColor:a.OCEAN_COLOR});a.add(e)},a.createSceneEffectMesh=function(e){var t=(e=e||{}).color||16777215,r=e.opacity||1,n=e.side||THREE.DoubleSide,i=e.resolution||512,o=e.causticColor||a.OCEAN_COLOR,s=e.caustics||void 0,l=e.geometry||new THREE.PlaneBufferGeometry(a.WORLD_SIZE,a.WORLD_SIZE,i-1,i-1),u={};void 0!==s&&(u.CAUSTICS="");var c={time:{value:0},color:{value:new THREE.Color(t)},opacity:{value:r},tSceneMap:{value:null},causticColor:{value:new THREE.Color(o)}},h=new THREE.ShaderMaterial({defines:u,uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,c]),transparent:!0,side:n,fog:!0,vertexShader:"\n            #include <fog_pars_vertex>\n            varying vec2 vUv;\n            varying vec4 vClipPos;\n            void main() {\n                vUv = uv;\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 ); // used in fog_vertex\n                gl_Position = projectionMatrix * mvPosition;\n                vClipPos = gl_Position;\n                #include <fog_vertex>\n            }\n        ",fragmentShader:`\n            #include <common>\n\t\t    #include <fog_pars_fragment>\n            uniform float time;\n            uniform vec3 color;\n            uniform float opacity;\n            uniform sampler2D tSceneMap;\n            varying vec2 vUv;\n            varying vec4 vClipPos;\n            ${a.ShaderChunk.clipToScreenPos}\n        #ifdef CAUSTICS\n            uniform vec3 causticColor;\n            ${a.ShaderChunk.caustics}\n        #endif\n            void main() {\n                vec3 sceneColor = color;\n                sceneColor *= texture2D( tSceneMap, clipToScreenPos( vClipPos ) ).rgb;\n            #ifdef CAUSTICS\n                sceneColor = mix( sceneColor, caustics( vUv, 8.0, causticColor ), 0.5 );\n            #endif\n                gl_FragColor = vec4( sceneColor, opacity );\n                #include <tonemapping_fragment>\n\t\t        #include <fog_fragment>\n            }\n        `}),d=new THREE.WebGLRenderTarget(i,i,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat});h.uniforms.tSceneMap.value=d.texture;var f=new THREE.Mesh(l,h);return f.name="sceneEffectMesh",f.frustumCulled=!1,f.castShadow=!1,f.receiveShadow=!0,f.rotation.x=-Math.PI/2,f.update=function(e,t){var r=a.appWorks.renderer;this.visible=!1,r.setRenderTarget(d),r.clear(),r.render(a.appWorks.scene,a.appWorks.camera),this.visible=!0,this.material.uniforms.time.value=t},f},a.demoMedicalSlicer=function(){{let n=new a.MedicalLoader;n.setPath("models/dcm/1060_head_brain_lee/");for(var e,t=[],r=0;r<32;r++)e=r<10?"img_00"+r+".dcm":"img_0"+r+".dcm",t.push(e);n.load(t,e=>{var t=a.appWorks.scene,r=a.appWorks.camera,n=a.appWorks.controls;let i=new a.MedicalSlicer(e);t.add(i);i.update=function(e,t){let r=t,n=new THREE.Vector3;n.x=10*Math.cos(3*r),n.y=20*Math.sin(2*r),n.z=30*Math.sin(1*r),i.slice.planeDirection=n.normalize()};let o=e.worldCenter();r.lookAt(o),n.target.copy(o)})}},a.demoMedicalVolume=function(){(new a.MedicalLoader).load(["models/nii/sample.nii.gz"],e=>{var t=a.appWorks.scene,r=a.appWorks.camera,n=a.appWorks.controls;let i=new a.MedicalVolume(e);t.add(i);let o=document.createElement("div");o.style.cssText="position: fixed; bottom: 10px; left: 50%; transform: translate(-50%,0); z-index: 1;",a.appWorks.dom.appendChild(o);let s=new a.LookupTable(o);{i.lut=!0;let e=s.lutsAvailable("color"),t=s.lutsAvailable("opacity");var l=e.concat(t);let r=e.length(),n=l.length();var u=-1;i.update=function(e,t){let a=.5*t,o=Math.floor(a%n);o!==u&&(console.log("lut used: "+l[o]),o<r?s.lut=l[o]:s.lutO=l[o],i.lutTexture=s.texture,u=o)}}let c=e.worldCenter();r.lookAt(c),n.target.copy(c)})},a.demoMedicalIsosurface=function(){(new a.MedicalLoader).load(["models/nii/sample.nii.gz"],e=>{var t=a.appWorks.scene,r=a.appWorks.camera,n=a.appWorks.controls,i=new a.MedicalIsosurface(e,32,2);t.add(i);var o=e.worldCenter();r.lookAt(o),n.target.copy(o)})},a.demoMedicalWorkSpace=function(){(new a.MedicalLoader).load(["models/nii/sample.nii.gz"],e=>{a.createMedicalWorkspace(e,"quadWorkspace")})},a.testTriMesh=function(){var e=S.sample.solid.dense([-6,-6,-6],[7,7,7],(function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])-5})),t=S.vol2Msh(e),r=a.msh2Geometry(t),n=new THREE.MeshNormalMaterial({flatShading:!0}),i=new THREE.Mesh(r,n);a.add(i)},a.demoReconstructIsosurface=function(){a.loadSTL({url:"models/dummy/stl/bunny.stl",callback:function(e){a.add(a.createDirectionalLight()),"models/dummy/stl/bunny.stl"===e.name||"models/stl/lucy_120mm_simplified.stl"===e.name||"models/dummy/stl/shoelast.stl"===e.name||"models/dummy/stl/foot.stl"===e.name?e.geometry.rotateX(-Math.PI/2):"models/stl/venus_kissing_cupid.stl"===e.name&&e.geometry.rotateX(-Math.PI),e.geometry.center(),e.material=new THREE.MeshPhongMaterial({color:14737867,flatShading:!0}),a.add(e);var t=a.toNonIndexedBufferGeometry(e.geometry),r=t.attributes.position.array,n=t.attributes.normal.array;console.log(">> # points = "+r.length/3),console.log(">> resolution = 64"),console.log(">> max octree depth = 4");var i=a.createIsosurfaceFromPoints(r,n,64,4);console.log(">> # of vertices = "+i.vertices.length),console.log(">> # of triangles = "+i.faces.length);var o=new THREE.Mesh(i,e.material);a.add(o),a.transformObject(e,new THREE.Vector3(20,0,0))}})},a.demoReconstructInsole=function(){a.loadSTL({url:"models/dummy/stl/insole.stl",callback:function(e){a.add(e);var t=a.toGeometry(e.geometry).vertices,r=[];t.forEach(e=>{r.push(e.clone())});var n,i=a.getOuterloop2D(r);i.pop();for(var o=i.length,s=[],l=0;l<o;l++)n=i[l],s.push(r[n]);i.sortNumbers("descending");for(l=0;l<o;l++)n=i[l],r.splice(n,1);var u=new a.CDelaunayGeometry(s,null,r),c=new THREE.Mesh(u,e.material);a.add(c);u=(new THREE.BufferGeometry).setFromPoints(s);var h=new THREE.LineBasicMaterial({color:255,linewidth:5}),d=new THREE.Line(u,h);c.add(d)}})},a.demoReconstructMesh=function(){a.loadSTL({url:"models/dummy/stl/bunny.stl",callback:function(e){"models/dummy/stl/bunny.stl"===e.name&&e.geometry.rotateX(-Math.PI/2),e.geometry.center(),e.material=new THREE.MeshPhongMaterial({color:14737867,flatShading:!0}),a.add(e);var t=a.reconstructGeometry(e.geometry,{depth:7}),r=new THREE.Mesh(t,e.material);a.add(r)}})},a.demoRefineMesh=function(){a.loadSTL({url:"models/dummy/stl/bunny.stl",callback:function(e){e.geometry.rotateX(-Math.PI/2),e.geometry.center(),e.material=new THREE.MeshPhongMaterial({color:14737867,flatShading:!0}),a.add(e);var t=a.refineGeometry(e.geometry),r=new THREE.Mesh(t,e.material);a.add(r)}})},a.demoFixMesh=function(){a.loadPLY({url:"models/dummy/ply/bunny_hasHole.ply",callback:function(e){e.geometry.center(),a.add(e);var t=a.fixGeometry(e.geometry),r=new THREE.Mesh(t,e.material);a.add(r)}})},a.demoSmoothMesh=function(){a.loadPLY({url:"models/dummy/ply/test3.ply",callback:function(e){e.geometry.center(),e.material=new THREE.MeshPhongMaterial({color:14737867,flatShading:!0}),a.add(e);var t=a.smoothGeometry(e.geometry),r=new THREE.Mesh(t,e.material);a.add(r)}})},a.demoDeformMesh=function(){a.loadSTL({url:"models/stl/Armadillo.stl",callback:function(e){e.geometry.center(),a.add(e);a.deformGeometry(e.geometry,{vertices:[5546,111],offsets:[[0,0,-20],[0,0,-20]],handles_rings:[7,7],unconstrained_rings:[13,13]},t=>{var r=new THREE.Mesh(t,e.material);a.add(r)})}})},a.demoDeformMeshByDragVertex=function(){var e=a.appWorks.selectObject;if(e&&e.geometry){e.geometry=a.toGeometry(e.geometry);var t=e.geometry.clone(),r=new THREE.Vector3;(new THREE.Box3).setFromPoints(t.vertices).getSize(r);var n=new THREE.Points(t,new THREE.PointsMaterial({map:(new THREE.TextureLoader).load("images/sprites/ball.png"),size:Math.max(r.x,r.y,r.z)/100,color:16777215,transparent:!0,alphaTest:.1}));n.name="vertexPoints",e.add(n);var i=a.geometry2Msh(n.geometry);S.deformLaplacian.setMesh(i);var o=new THREE.BufferGeometry;o.setAttribute("position",new THREE.BufferAttribute(new Float32Array(3),3));var s=new THREE.Points(o,new THREE.PointsMaterial({map:n.material.map,size:n.material.size,color:16711680,transparent:!0,alphaTest:.1}));s.frustumCulled=!1,s.setPosition=function(e){var t=this.geometry.attributes.position;e.toArray(t.array,0),t.needsUpdate=!0},s.getPosition=function(e){void 0===e&&(e=new THREE.Vector3);var t=this.geometry.attributes.position;return e.fromArray(t.array,0),e},s.name="handlePoint",n.add(s);var l=new a.DragVertexControls(n,a.appWorks.camera,a.appWorks.renderer.domElement,n.material.size/4);l.enabled=!1,a.appWorks.dragVertexControls=l;var u=new THREE.Vector3,c=!0,h=!1,d=!1;l.addEventListener("hoveron",(function(e){if(!h&&!d){var t=e.object.index;s.setPosition(n.geometry.vertices[t]),s.visible=!0}})),l.addEventListener("dragstart",(function(e){if(!h){var t=e.object.index;s.setPosition(n.geometry.vertices[t]),this.enabled=!1,S.deformLaplacian.setROI(t,7,13,()=>{h=!0,this.enabled=!0})}})),l.addEventListener("drag",(function(e){if(h){var t=e.object.position;s.getPosition(u),u.subVectors(t,u),i=S.deformLaplacian.deform([u.x,u.y,u.z]),a.updateVerticesFromMsh(n.geometry,i),s.setPosition(t),d=!0}})),l.addEventListener("dragend",(function(t){h&&d&&(h=!1,d=!1,s.setPosition(t.object.position),c=!0,a.appWorks.setGeometry(e,n.geometry.clone()),c=!1)})),a.appWorks.signals.geometryChanged.add((function(e){if(!c){var t=e.geometry,r=a.geometry2Msh(t);S.deformLaplacian.setMesh(r,()=>{n.geometry.dispose(),n.geometry=t.clone(),s.visible=!1})}}))}},a.demoLoopSubvideMesh=function(){a.loadSTL({url:"models/dummy/stl/bunny.stl",callback:function(e){"models/dummy/stl/bunny.stl"===e.name&&e.geometry.rotateX(-Math.PI/2),e.geometry.center(),e.material=new THREE.MeshPhongMaterial({color:14737867,flatShading:!0}),a.add(e);var t=a.loopSubdivideGeometry(e.geometry),r=new THREE.Mesh(t,e.material);a.add(r)}})},a.demoMeshMeanCurvature=function(){a.loadSTL({url:"models/stl/Armadillo.stl",callback:function(e){"models/dummy/stl/bunny.stl"===e.name&&e.geometry.rotateX(-Math.PI/2),e.geometry.center(),e.material=new THREE.MeshLambertMaterial({color:16119285,side:THREE.DoubleSide,vertexColors:!0}),a.add(e),a.computeGeometryCurvature(e.geometry,{coloring:"vertex",colorMap:"rainbow",valueROI:[0,.02]})}})},a.demoAlphaShape=function(){a.loadPLY({url:"models/ply/Lucy100k.ply",callback:function(e){e.geometry.center(),a.add(e);var t=a.geometry2Msh(e.geometry);a.Timer.start("alphaShape");var r=a.alphaShapeGeometry(.018,t.positions);if(a.Timer.end(),r){var n=new THREE.Mesh(r,new THREE.MeshPhongMaterial({color:16777215,transparent:!0,opacity:.6}));a.add(n)}}})},a.demoGeodesicDistance=function(){a.loadSTL({url:"models/dummy/stl/bunny.stl",callback:function(e){e.geometry.center(),a.add(e),a.Timer.start("geodesicDistance");a.computeGeodesicDistance(e.geometry,0);a.Timer.end()}})},a.demoVoxelizeMesh=function(){a.loadSTL({url:"models/stl/Armadillo.stl",callback:function(e){"models/dummy/stl/bunny.stl"===e.name&&e.geometry.rotateX(-Math.PI/2),e.geometry.center(),a.add(e);var t=a.voxelizeGeometry(e.geometry),r=t.origin,n=t.size,i=t.positions,o=a.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[n,n,n]},material:{type:"MeshPhongMaterial",map:(new THREE.TextureLoader).load("images/crate.gif")}}),s=a.createInstancedMeshes(o,{positions:i});s.position.set(r[0],r[1],r[2]),a.add(s)}})},a.demoFFT=function(){a.imgload2pixels("images/dummy/dip/clahe_mountains.jpg",e=>{for(var[t,r,n,i]=a.dipSplit(e),o=t.width,s=t.height,l=S.ndarray(t.data,[o,s],[1,o]),u=S.gaussBlur(l,5),c=0,h=0;h<s;h++)for(var d=0;d<o;d++)t.data[c++]=u.get(d,h);a.dipMerge(t,t,t,i,e);var f=a.dipPixelsMesh(e);a.add(f)})},a.createViewWorks=function(e,t){return a.viewWorks=new a.DesignWorks({appName:"viewWorks",width:e||window.innerWidth,height:t||window.innerHeight,glVersion:2,background:(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg"),controlsType:"OrbitControls",FXAAEnabled:!0,fileExplorer:!0}),a.viewWorks.renderScene(),a.viewWorks},a.createGameWorks=function(e,t){return a.gameWorks=new a.DesignWorks({appName:"gameWorks",width:e||window.innerWidth,height:t||window.innerHeight,glVersion:2,hud:!0}),a.gameWorks.renderScene(),a.gameWorks},a.createNatureWorks=function(e,t){return a.natureWorks=new a.DesignWorks({appName:"natureWorks",width:e||window.innerWidth,height:t||window.innerHeight,signals:!0,config:!0,history:!0,glVersion:1,fog:{type:"exp2"},controlsType:"OrbitControls",stats:!0,audioFiles:void 0,gridVisible:!1,hud:!0,bleachEnabled:!1,bloomEnabled:!1,dotScreenEnabled:!1,glitchEnabled:!1,sepiaEnabled:!1,outlineEnabled:!1,FXAAEnabled:!0,ssaoEnabled:!1,godRaysEnabled:!1,bokehEnabled:!1,vignetteEnabled:!1,effectType:void 0,fileExplorer:!0,dragControls:!0,transformControls:!0}),a.natureWorks.renderScene(),a.natureWorks},a.createMedicalWorks=function(e,t){return a.medicalWorks=new a.DesignWorks({appName:"medicalWorks",width:e||window.innerWidth,height:t||window.innerHeight,signals:!0,glVersion:1,stats:!0,fileExplorer:!0}),a.medicalWorks.renderScene(),a.medicalWorks},a.add=function(e){a.updateMaterialMapEncoding(e,THREE.sRGBEncoding),a.appWorks.history?a.appWorks.add(e):a.scene.add(e)},a.remove=function(e){e&&(a.appWorks.history?a.appWorks.remove(e):e.parent&&e.parent.remove(e))},a.dispose=function(e){e&&(e.parent&&e.parent.remove(e),e.traverse((function(e){var t=e.geometry;t&&t.dispose();var r=e.material;r&&(Array.isArray(r)?r:[r]).forEach((function(e){Object.keys(e).forEach(t=>{e[t]&&"function"==typeof e[t].dispose&&e[t].dispose()}),e.dispose()}))})))},a.removeHTMLElement=function(e){for("string"==typeof e&&(e=document.getElementById(e)),e.parentNode&&e.parentNode.removeChild(e);e.firstChild;)e.removeChild(e.firstChild)},window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,window.JAMIE=a}]);